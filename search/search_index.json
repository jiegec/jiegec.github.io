{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u535a\u5ba2","text":""},{"location":"about/","title":"\u5173\u4e8e","text":"<p>\u6211\u662f\u6e05\u534e\u5927\u5b66\u8ba1\u7b97\u673a\u7cfb\u7684\u4e00\u540d\u5728\u8bfb\u535a\u58eb\u751f\u3002</p> <p>\u6211\u7684\u90ae\u4ef6\u662f c at jia.je\u3002</p> <p>\u6211\u7684 GitHub \u7528\u6237\u540d\u662f @jiegec\u3002</p> <p>\u6211\u7684 B \u7ad9\u4e3b\u9875\u662f https://space.bilibili.com/11372427\u3002</p> <p>\u6211\u7684\u77e5\u4e4e\u4e3b\u9875\u662f https://www.zhihu.com/people/jiege-chen\u3002</p>"},{"location":"benchmark/","title":"\u6027\u80fd\u6d4b\u8bd5","text":""},{"location":"benchmark/#\u6d4b\u8bd5\u73af\u5883","title":"\u6d4b\u8bd5\u73af\u5883","text":"<p>\u6d4b\u8bd5\u73af\u5883\u5982\u4e0b\uff1a</p> <ol> <li>\u5927\u90e8\u5206\u6d4b\u8bd5\uff1aDebian Bookworm, GCC 12.2.0</li> <li>LoongArch \u6d4b\u8bd5\uff1aDebian sid, GCC 14.2.0</li> <li>HarmonyOS NEXT \u6d4b\u8bd5\uff1aHarmonyOS NEXT 5\uff0cClang 15.0.4 + Flang 20.0.0\uff0c\u8be6\u89c1 jiegec/SPECCPU2017Harmony</li> </ol> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>\u5206\u6570\u53ea\u6709\u5728\u63a7\u5236\u53d8\u91cf\u65f6\uff08\u5373\u4e00\u822c\u6240\u8bf4\u7684\u201c\u7528\u76f8\u540c\u4e8c\u8fdb\u5236\u6d4b\u5f97\u201d\uff0c\u6b64\u5916\u8fd8\u6709\u4e00\u4e9b\u5f71\u54cd\u6027\u80fd\u7684\u53d8\u91cf\u89c1\u4e0b\uff09\u53ef\u4ee5\u7528\u6765\u6bd4\u8f83\u76f8\u540c\u6307\u4ee4\u96c6\u7684\u4e0d\u540c\u5904\u7406\u5668\u7684\u6027\u80fd\uff0c\u5373\u901a\u8fc7\u6d4b\u8bd5\u7ed3\u679c\u6bd4\u8f83\uff1a<ol> <li>AMD64 \u6307\u4ee4\u96c6\u7684 Intel \u548c AMD \u5904\u7406\u5668\u7684\u6027\u80fd</li> <li>ARM64 \u6307\u4ee4\u96c6\u7684 Apple\u3001ARM\u3001Huawei \u548c Qualcomm \u5904\u7406\u5668\u7684\u6027\u80fd</li> <li>LoongArch \u6307\u4ee4\u96c6\u7684\u4e0d\u540c\u5904\u7406\u5668\u7684\u6027\u80fd</li> </ol> </li> <li>\u7528\u5206\u6570\u6765\u8fdb\u884c\u4e0d\u540c\u6307\u4ee4\u96c6\u7684\u5904\u7406\u5668\u4e4b\u95f4\u7684\u6027\u80fd\u6bd4\u8f83\uff0c\u5219\u6ca1\u6709\u5f88\u5f3a\u7684\u8bf4\u670d\u529b</li> <li>\u5373\u4f7f\u662f\u76f8\u540c\u786c\u4ef6\uff0c\u5982\u4e0b\u56e0\u7d20\u90fd\u53ef\u80fd\u5bf9\u6d4b\u8bd5\u7ed3\u679c\u4ea7\u751f\u663e\u8457\u7684\u5f71\u54cd\uff1a<ol> <li>\u4e0d\u540c\u7f16\u8bd1\u5668\uff08\u4f8b\u5982\u540c\u7b49\u7f16\u8bd1\u9009\u9879\u4e0b GCC \u901a\u5e38\u6bd4 Clang \u5feb\uff09</li> <li>\u4e0d\u540c\u7f16\u8bd1\u5668\u7248\u672c\uff08\u901a\u5e38\u65b0\u7248\u672c\u6bd4\u65e7\u7248\u672c\u5feb\uff0c\u4f46\u4e5f\u6709\u53cd\u4f8b\uff09</li> <li>\u4e0d\u540c\u7f16\u8bd1\u9009\u9879\uff08\u4f8b\u5982\u662f\u5426\u5f00 LTO\uff0c\u662f\u5426\u8bbe\u7f6e -march=native\uff09</li> <li>\u4e0d\u540c\u7684\u5185\u5b58\u5206\u914d\u5668\u5b9e\u73b0\uff08libc \u81ea\u5e26 malloc \u6216 jemalloc\uff09</li> <li>\u4e0d\u540c\u7684\u6807\u51c6\u5e93\u5b9e\u73b0\uff08\u6bd4\u5982 glibc \u8fd8\u662f musl\uff09</li> <li>\u4e0d\u540c\u7684\u8c03\u9891\u3001\u8c03\u5ea6\u6216\u7ed1\u6838\u7b56\u7565\uff08\u6bd4\u5982\u4e0d\u5f53\u7684\u7ed1\u6838\u8ba9\u9891\u7387\u4ece 4.0GHz \u964d\u5230 3.4GHz\uff09</li> <li>\u4e0d\u540c\u7684\u5185\u6838\u7248\u672c\uff08\u6bd4\u5982\u90e8\u5206\u5185\u6838\u7248\u672c\u4f1a\u660e\u663e\u52a3\u5316\u6027\u80fd\uff09</li> </ol> </li> </ol> <p>\u5982\u679c\u60a8\u9700\u8981\u5f15\u7528\u672c\u6587\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u8bf7\u4fdd\u8bc1\u60a8\u5bf9\u4ee5\u4e0a\u6ce8\u610f\u4e8b\u9879\u6709\u5145\u5206\u7684\u7406\u89e3\u3002</p>"},{"location":"benchmark/#spec-int-2017-rate-1","title":"SPEC INT 2017 Rate-1","text":"<p>\u4e0b\u9762\u8d34\u51fa\u81ea\u5df1\u6d4b\u7684\u6570\u636e\uff08SPECint2017\uff0cEstimated\uff0crate\uff0cbase\uff0c1 copy\uff09\uff0c\u4e0d\u4fdd\u8bc1\u6ee1\u8db3 SPEC \u7684\u8981\u6c42\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\u603b\u8fd0\u884c\u65f6\u95f4\uff08\u79d2\uff09\u57fa\u672c\u548c\u5206\u6570\u6210\u53cd\u6bd4\uff0c\u4e58\u79ef\u6309 5e4 \u4f30\u7b97\u3002</p>"},{"location":"benchmark/#\u6570\u636e\u603b\u89c8","title":"\u6570\u636e\u603b\u89c8","text":"\u5206\u6570/GHz \u6bcf\u9879\u5206\u6570 IPC \u5206\u652f\u9884\u6d4b MPKI \u5206\u652f\u9884\u6d4b\u9519\u8bef\u7387 \u9891\u7387"},{"location":"benchmark/#\u539f\u59cb\u6570\u636e","title":"\u539f\u59cb\u6570\u636e","text":"<p>\u684c\u9762\u5e73\u53f0\uff08<code>-march=native</code> + LTO + Jemalloc\uff09\uff1a</p> <ul> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3 -march=native -flto -ljemalloc</code>\uff09: 9.43</li> </ul> <p>\u684c\u9762\u5e73\u53f0\uff08LTO + Jemalloc\uff09\uff1a</p> <ul> <li>AMD Ryzen 9 9950X @ 5.7 GHz Zen 5\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 12.9</li> <li>Intel Core i9-14900K @ 6.0 GHz Raptor Lake\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 12.1</li> <li>Intel Core i9-12900KS @ 5.5 GHz Alder Lake\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 10.4</li> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 9.25</li> <li>Loongson 3A6000 @ 2.5 GHz LA664\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 4.86</li> </ul> <p>\u684c\u9762\u5e73\u53f0\uff08LTO\uff09\uff1a</p> <ul> <li>AMD Ryzen 9 9950X @ 5.7 GHz Zen 5\uff08<code>-O3 -flto</code>\uff09: 11.7</li> <li>Intel Core i9-14900K @ 6.0 GHz Raptor Lake\uff08<code>-O3 -flto</code>\uff09: 11.7 11.7</li> <li>Intel Core i9-12900KS @ 5.5 GHz Alder Lake\uff08<code>-O3 -flto</code>\uff09: 9.97</li> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3 -flto</code>\uff09: 8.62</li> </ul> <p>\u684c\u9762\u5e73\u53f0\uff1a</p> <ul> <li>Intel Core i9-14900K @ 6.0 GHz Raptor Lake\uff08<code>-O3</code>\uff09: 11.3</li> <li>AMD Ryzen 9 9950X @ 5.7 GHz Zen 5\uff08<code>-O3</code>\uff09: 11.2</li> <li>Intel Core i9-12900KS @ 5.5 GHz Alder Lake\uff08<code>-O3</code>\uff09: 9.62</li> <li>AMD Ryzen 5 7500F @ 5.0 GHz Zen 4\uff08<code>-O3</code>\uff09: 9.51</li> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3</code>\uff09: 8.31</li> <li>AMD Ryzen 7 5700X @ 4.7 GHz Zen 3\uff08<code>-O3</code>\uff09: 7.87</li> <li>Apple M1 @ 3.1 GHz Firestorm\uff08<code>-O3</code>\uff09: 7.77</li> <li>Intel Core i9-10980XE @ 4.8 GHz Cascade Lake\uff08<code>-O3</code>\uff09: 6.24</li> <li>Qualcomm 8cx Gen3 P Core @ 3.0 GHz Cortex-X1C\uff08<code>-O3</code>\uff09: 5.73</li> <li>Loongson 3A6000 @ 2.5 GHz LA664\uff08<code>-O3</code>\uff09: 4.35 4.39</li> <li>Qualcomm 8cx Gen3 E Core @ 2.4 GHz Cortex-A78C\uff08<code>-O3</code>\uff09: 4.11</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff08<code>-march=native</code> + LTO + Jemalloc\uff09\uff1a</p> <ul> <li>Loongson 3C6000 @ 2.2 GHz LA664\uff08<code>-O3 -march=native -flto -ljemalloc</code>\uff09: 4.65</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff08LTO + Jemalloc\uff09\uff1a</p> <ul> <li>AWS Graviton 4 @ 2.8 GHz Neoverse V2\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 7.48</li> <li>AWS Graviton 3E @ 2.6 GHz Neoverse V1\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 6.17</li> <li>AMD EPYC 7742 @ 3.4 GHz Zen 2\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 5.33</li> <li>IBM POWER8NVL @ 4.0 GHz POWER8\uff08<code>-O3 -flto -ljemalloc</code>\uff09: 4.02</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff08LTO\uff09\uff1a</p> <ul> <li>AMD EPYC 7742 @ 3.4 GHz Zen 2\uff08<code>-O3 -flto</code>\uff09: 4.99</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff1a</p> <ul> <li>AWS Graviton 4 @ 2.8 GHz Neoverse V2\uff08<code>-O3</code>\uff09: 6.80 7.00</li> <li>AMD EPYC 9R14 @ 3.7 GHz Zen 4\uff08<code>-O3</code>\uff09: 6.57</li> <li>T-Head Yitian 710 @ 3.0 GHz Neoverse N2\uff08<code>-O3</code>\uff09: 5.79</li> <li>Intel Xeon Platinum 8576C Emerald Rapids\uff08<code>-O3</code>\uff09: 5.72</li> <li>Intel Xeon Platinum 8358P @ 3.4 GHz Ice Lake\uff08<code>-O3</code>\uff09: 5.66</li> <li>Kunpeng 920 HuaweiCloud kc2 @ 2.9 GHz\uff08<code>-O3</code>\uff09: 5.39</li> <li>AMD EPYC 9754 @ 3.1 GHz Zen 4c\uff08<code>-O3</code>\uff09: 5.32</li> <li>AMD EPYC 7K83 Zen 3\uff08<code>-O3</code>\uff09: 5.18</li> <li>AWS Graviton 3E @ 2.6 GHz Neoverse V1\uff08<code>-O3</code>\uff09: 5.53</li> <li>AWS Graviton 3 @ 2.6 GHz Neoverse V1\uff08<code>-O3</code>\uff09: 5.10</li> <li>AMD EPYC 7742 @ 3.4 GHz Zen 2\uff08<code>-O3</code>\uff09: 4.67</li> <li>Ampere Altra @ 3.0 GHz Neoverse N1\uff08<code>-O3</code>\uff09: 4.41</li> <li>Intel Xeon E5-2680 v4 @ 3.3 GHz Broadwell\uff08<code>-O3</code>\uff09: 4.35</li> <li>AMD EPYC 7H12 @ 3.3 GHz Zen 2\uff08<code>-O3</code>\uff09: 4.23</li> <li>Loongson 3C6000 @ 2.2 GHz LA664\uff08<code>-O3</code>\uff09: 4.18</li> <li>Intel Xeon E5-2680 v3 @ 3.0 GHz Haswell\uff08<code>-O3</code>\uff09: 4.01</li> <li>Intel Xeon D-2146NT @ 2.9 GHz Skylake\uff08<code>-O3</code>\uff09: 3.96</li> <li>IBM POWER8NVL @ 4.0 GHz POWER8\uff08<code>-O3</code>\uff09: 3.54</li> <li>Kunpeng 920 @ 2.6 GHz TaiShan V110\uff08<code>-O3</code>\uff09: 3.10</li> <li>Kunpeng 920 HuaweiCloud kc1 @ 2.6 GHz\uff08<code>-O3</code>\uff09: 3.03</li> <li>AMD EPYC 7551 @ 2.5 GHz Zen 1\uff08<code>-O3</code>\uff09: 3.06</li> <li>Loongson 3C5000 @ 2.2 GHz LA464\uff08<code>-O3</code>\uff09: 2.63</li> <li>Intel Xeon E5-2603 v4 @ 1.7 GHz Broadwell\uff08<code>-O3</code>\uff09: 2.48</li> </ul> <p>\u624b\u673a\u5e73\u53f0\uff08LTO\uff09\uff1a</p> <ul> <li>Huawei Kirin 9010 @ 2.3 GHz \uff08<code>-O3 -flto</code>\uff09: 3.99</li> </ul> <p>\u6ce8\uff1a</p> <ol> <li>SPEC INT 2017 Rate-1 \u7ed3\u679c\u53d7 <code>-flto</code>\uff08\u5206\u6570 +4%\uff09\u548c <code>-ljemalloc</code>\uff08\u5206\u6570 +4-10%\uff09\u5f71\u54cd\u5f88\u660e\u663e\u3002<code>-Ofast</code> \u548c <code>-O3</code> \u533a\u522b\u5f88\u5c0f\uff0c<code>-march=native</code> \u5f71\u54cd\u5f88\u5c0f\u3002</li> <li>\u5728\u90e8\u5206\u5904\u7406\u5668\u4e0a\uff0cLinux \u4e0d\u80fd\u4fdd\u8bc1\u7a0b\u5e8f\u88ab\u8c03\u5ea6\u5230\u6027\u80fd\u6700\u9ad8\u7684\u6838\u5fc3\u4e0a\uff0c\u4f8b\u5982\uff1a<ol> <li>Qualcomm X1E80100 \u4e0a\uff0c\u8d1f\u8f7d\u4e0d\u4e00\u5b9a\u4f1a\u8c03\u5ea6\u5230\u6709 Boost \u7684\u6838\u4e0a\uff0c\u56e0\u6b64\u9700\u8981\u624b\u52a8\u7ed1\u6838\u3002\u6ca1\u6709 Boost \u7684\u6838\u5fc3\u4f1a\u8dd1\u5728 3.4 GHz\uff0cBoost \u7684\u6838\u5fc3\u6700\u9ad8\u53ef\u4ee5\u8fbe\u5230 4.0 GHz\uff0c\u5bf9\u5e94 14% \u7684\u6027\u80fd\u63d0\u5347\u3002\u5177\u4f53\u5730\u8bb2\uff0c\u5b83\u6709\u4e09\u4e2a Cluster\uff0c0-3 \u662f\u6ca1\u6709 Boost \u7684 Cluster\uff0c4-7 \u548c 8-11 \u6bcf\u4e2a Cluster \u4e2d\u53ef\u4ee5\u6709\u4e00\u4e2a\u6838\u5fc3 Boost \u5230 4.0 GHz\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6700\u591a\u6709\u4e24\u4e2a\u6838\u8fbe\u5230 4.0 GHz\uff0c\u8fd9\u4e24\u4e2a\u6838\u9700\u8981\u5206\u522b\u4f4d\u4e8e 4-7 \u548c 8-11 \u4e24\u4e2a Cluster \u5f53\u4e2d\u3002\u5982\u679c\u4e00\u4e2a Cluster \u6709\u4e24\u4e2a\u6216\u8005\u4ee5\u4e0a\u7684\u6838\u6709\u8d1f\u8f7d\uff0c\u90a3\u4e48\u4ed6\u4eec\u90fd\u53ea\u6709 3.4 GHz\u3002</li> <li>AMD Ryzen 9 9950X \u4e0d\u540c\u6838\u80fd\u591f\u8fbe\u5230\u7684\u6700\u5927\u9891\u7387\u4e0d\u540c\uff0c\u76ee\u524d Linux\uff086.11\uff09\u7684\u8c03\u5ea6\u7b97\u6cd5\u4e0d\u4e00\u5b9a\u53ef\u4ee5\u4fdd\u8bc1\u8dd1\u5230\u6700\u5927\u9891\u7387 5.75 GHz \u4e0a\uff0c\u53ef\u80fd\u4f1a\u98d8\u5230\u9891\u7387\u4f4e\u4e00\u4e9b\uff085.45 GHz \u5de6\u53f3\uff09\u7684\u6838\u5fc3\u4e0a\uff0c\u635f\u5931 4% \u7684\u6027\u80fd\uff0c\u56e0\u6b64\u9700\u8981\u7ed1\u6838\u5fc3\uff0c\u8be6\u89c1 Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76 \u4ee5\u53ca \u8c08\u8c08 Linux \u4e0e ITMT \u8c03\u5ea6\u5668\u4e0e\u591a\u7c07\u5904\u7406\u5668\u3002\u8fd9\u4e2a\u95ee\u9898\u5df2\u7ecf\u6709 Patch \u8fdb\u884c\u4fee\u590d\u3002</li> </ol> </li> <li>\u5bf9\u4e8e\u670d\u52a1\u5668 CPU\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u53ef\u80fd\u6ca1\u6709\u6253\u5f00 C6 State\uff0c\u6b64\u65f6\u5355\u6838\u4e0d\u4e00\u5b9a\u80fd Boost \u5230\u5ba3\u79f0\u7684\u6700\u9ad8\u9891\u7387\uff0c\u9700\u8981\u8fdb BIOS \u6253\u5f00 C6 State\uff0c\u4f7f\u5f97\u7a7a\u95f2\u7684\u6838\u5fc3\u8fdb\u5165\u4f4e\u529f\u8017\u6a21\u5f0f\uff0c\u624d\u80fd\u53d1\u6325\u51fa\u6700\u9ad8\u7684 Boost \u9891\u7387\u3002</li> <li>\u5bf9\u4e8e\u9664\u4e86\u82f9\u679c\u4ee5\u5916\u7684 ARM64 \u6838\u5fc3\uff0c\u5185\u6838\u7684 branch-misses \u8ba1\u6570\u5668\u8003\u8651\u4e86 speculative \u800c\u4e0d\u53ea\u662f retired\uff0c\u56e0\u6b64\u6570\u5b57\u4f1a\u504f\u9ad8\uff0c\u6b64\u65f6\u8981\u7528 r22 \u8ba1\u6570\u66ff\u4ee3\u3002</li> </ol> <p>x86 \u5e73\u53f0\u7684\u5206\u652f\u9884\u6d4b\u51c6\u786e\u7387\uff08Average\uff09\u7531\u9ad8\u5230\u4f4e\uff1a</p> <ol> <li>Zen 5(9950X): MPKI=4.33 Mispred=2.45%</li> <li>Zen 4 Server(9R14): MPKI=4.38 Mispred=2.48%</li> <li>Zen 4c(9754): MPKI=4.51 Mispred=2.55%</li> <li>Zen 4 Desktop(7500F)/Zen 3(5700X): MPKI=4.53 Mispred=2.57%</li> <li>Zen 2(7742): MPKI=4.62 Mispred=2.62%</li> <li>Ice Lake(8358P)/Alder Lake(12900KS)/Raptor Lake(14900K): MPKI=4.71 Mispred=2.68%</li> <li>Skylake(D-2146NT)/Cascade Lake(10980XE): MPKI=5.34 Mispred=3.04%</li> <li>Zen 1(7551): MPKI=5.72 Mispred=3.26%</li> <li>Haswell(E5-2680 v3)/Broadwell(E5-2680 v4): MPKI=5.84 Mispred=3.27%</li> </ol> <p>ARM64 \u5e73\u53f0\u7684\u5206\u652f\u9884\u6d4b\u51c6\u786e\u7387\uff08Average\uff09\u7531\u9ad8\u5230\u4f4e\uff1a</p> <ol> <li>Neoverse V2(Graviton 4): MPKI=4.34 Mispred=2.39%</li> <li>Oryon(X1E80100): MPKI=4.56 Mispred=2.50%</li> <li>Neoverse N2(Yitian 710): MPKI=4.66 Mispred=2.57%</li> <li>Firestorm(M1): MPKI=4.67 Mispred=2.55%</li> <li>Neoverse V1(Graviton 3)/Cortex X1C(8cx Gen3 P Core): MPKI=4.75 Mispred=2.62%</li> <li>Neoverse N1(Ampere Altra)/Cortex A78C(8cx Gen3 E Core): MPKI=5.06 Mispred=2.79%</li> <li>TSV110(Kunpeng 920): MPKI=6.36 Mispred=3.49%</li> </ol>"},{"location":"benchmark/#\u7f51\u4e0a\u7684\u6570\u636e","title":"\u7f51\u4e0a\u7684\u6570\u636e","text":"<p>SPEC CPU 2017 by David Huang:</p> <ul> <li>AMD Ryzen 9950X Zen 5: 12.6</li> <li>Apple M3 Pro: 11.8</li> <li>Intel Core 13900K Raptor Lake: 11.5</li> <li>Apple M2 Pro: 10.3</li> <li>Apple M2: 9.95</li> <li>AMD HX 370 Strix Point Zen 5: 9.64</li> <li>Intel Core Ultra 258V Lunar Lake Lion Cove+Skymont: 9.46</li> <li>Apple M1 Max Firestorm+Icestorm: 9.2</li> <li>AMD Ryzen 5950X Zen 3: 9.15</li> <li>Kunpeng 920 TSV120: 6.00</li> <li>Loongson 3A6000 LA664: 4.29</li> <li>Phytium D3000 FTC862: 4.24</li> <li>Loongson 3A5000 LA464: 3.04</li> </ul> <p>\u9ad8\u901a X Elite Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b\uff1a\u8d70\u8d70\u505c\u505c by JamesAslan:</p> <ul> <li>AMD Ryzen 7700X Zen 4: 10.35</li> <li>Intel Core 13700K Raptor Lake: 9.81</li> <li>Intel Core 12700K Alder Lake: 9.13</li> <li>AMD Ryzen 5950X Zen 3: 8.45</li> <li>Apple M2 Avalanche+Blizzard: 8.40</li> <li>Qualcomm X1E80100 Oryon: 8.19</li> <li>Apple M1 Firestorm+Icestorm: 7.40</li> <li>Qualcomm 8 Gen 2 Cortex-X3: 6.58</li> </ul> <p>Running SPEC CPU2017 on Chinese CPUs, and More</p> <ul> <li>AMD Ryzen 9 7950X3D Non-VCache: 10.5</li> <li>Intel Core Ultra 7 258V Lion Cove: 9.37</li> <li>Intel Core Ultra 7 115H Redwood Cove: 7.6</li> <li>Intel Core Ultra 7 258V Skymont: 5.92</li> <li>Intel Core Ultra 7 115H Crestmont: 5.88</li> <li>Intel Core i5-6600K Skylake: 5.65</li> <li>Loongson 3A6000 LA664: 4.27</li> <li>Mediatek Genio 1200 Cortex A78: 3.8</li> <li>AMD FX-8150: 3.5</li> <li>Intel Core Ultra 7 115H Low Power Crestmont: 3.32</li> <li>Loongson 3A5000: 2.93</li> <li>Intel Celeron J4125 Goldmont Plus: 2.43</li> <li>Zhaoxin KaiXian KX-6640MA: 2.07</li> <li>Amlogic S922X Cortex A73: 1.77</li> <li>Mediatek Genio 1200 Cortex A55: 1.19</li> </ul> <p>Running SPEC CPU2017 at Chips and Cheese?</p> <ul> <li>AMD Ryzen 9 9950X: 11.9</li> <li>AMD Ryzen 9 7950X3D Non-VCache: 10.5</li> <li>AMD Ryzen 9 7950X3D VCache: 10.5</li> <li>Intel Core Ultra 7 115H Redwood Cove: 7.58</li> <li>Intel Core Ultra 7 115H Crestmont: 5.34</li> <li>AMD Ryzen 9 3950X 3.5GHz: 5.28</li> <li>Ampere Altra: 3.98</li> <li>AmpereOne: 3.94</li> <li>AMD FX-8159: 3.46</li> </ul> <p>The AMD Ryzen 9 9950X and Ryzen 9 9900X Review: Flagship Zen 5 Soars - and Stalls</p> <ul> <li>AMD Ryzen 9 9950X Zen 5: 10.95</li> <li>Intel Core i9-14900K Raptor Lake: 10.94</li> <li>AMD Ryzen 9 7950X Zen 4: 9.88</li> </ul> <p>Snapdragon X Elite Qualcomm Oryon CPU Design and Architecture Hot Chips 2024</p> <ul> <li>Qualcomm X Elite Oryon on Linux: 10.64</li> <li>Qualcomm X Elite Oryon on Windows: 9.70</li> </ul> <p>ARM Cortex X1 \u5fae\u67b6\u6784\u8bc4\u6d4b\uff08\u4e0a\uff09\uff1a\u5411\u5c71\u8fdb\u53d1</p> <ul> <li>Zen 3 @ 4.95 GHz: 8.4</li> <li>Firestorm @ 3.0 GHz: 7.4</li> <li>Cortex X1 @ 3.0 GHz: 5.7</li> <li>Cortex A78 @ 2.4 GHz: 3.9</li> </ul>"},{"location":"benchmark/#spec-fp-2017-rate-1","title":"SPEC FP 2017 Rate-1","text":"<p>\u4e0b\u9762\u8d34\u51fa\u81ea\u5df1\u6d4b\u7684\u6570\u636e\uff08SPECfp2017\uff0cEstimated\uff0crate\uff0cbase\uff0c1 copy\uff09\uff0c\u4e0d\u4fdd\u8bc1\u6ee1\u8db3 SPEC \u7684\u8981\u6c42\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\u603b\u8fd0\u884c\u65f6\u95f4\u57fa\u672c\u548c\u5206\u6570\u6210\u53cd\u6bd4\uff0c\u4e58\u79ef\u6309 1e5 \u4f30\u7b97\u3002</p>"},{"location":"benchmark/#\u6570\u636e\u603b\u89c8_1","title":"\u6570\u636e\u603b\u89c8","text":"\u5206\u6570/GHz \u6bcf\u9879\u5206\u6570 IPC \u5206\u652f\u9884\u6d4b MPKI \u5206\u652f\u9884\u6d4b\u9519\u8bef\u7387 \u9891\u7387"},{"location":"benchmark/#\u539f\u59cb\u6570\u636e_1","title":"\u539f\u59cb\u6570\u636e","text":"<p>\u684c\u9762\u5e73\u53f0\uff08<code>-march=native</code>\uff09\uff1a</p> <ul> <li>AMD Ryzen 9 9950X @ 5.7 GHz Zen 5\uff08<code>-O3 -march=native</code>\uff09: 17.6</li> <li>Intel Core i9-14900K @ 6.0 GHz Raptor Lake\uff08<code>-O3 -march=native</code>\uff09: 16.6</li> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3 -march=native</code>\uff09: 14.4</li> <li>Intel Core i9-10980XE @ 4.7 GHz (AVX-512 @ 4.0 GHz) Cascade Lake\uff08<code>-O3 -march=native</code>\uff09: 7.24</li> <li>Loongson 3A6000 @ 2.5 GHz LA664\uff08<code>-O3 -march=native</code>\uff09: 5.70</li> </ul> <p>\u684c\u9762\u5e73\u53f0\uff1a</p> <ul> <li>AMD Ryzen 9 9950X @ 5.7 GHz Zen 5\uff08<code>-O3</code>\uff09: 16.5</li> <li>Intel Core i9-14900K @ 6.0 GHz Raptor Lake\uff08<code>-O3</code>\uff09: 16.1</li> <li>Qualcomm X1E80100 @ 4.0 GHz X Elite\uff08<code>-O3</code>\uff09: 14.4</li> <li>Intel Core i9-12900KS @ 5.5 GHz Alder Lake\uff08<code>-O3</code>\uff09: 14.3</li> <li>AMD Ryzen 5 7500F Zen 4\uff08<code>-O3</code>\uff09: 11.6</li> <li>Apple M1 @ 3.1 GHz Firestorm\uff08<code>-O3</code>\uff09: 11.5</li> <li>AMD Ryzen 7 5700X @ 4.7 GHz Zen 3\uff08<code>-O3</code>\uff09: 9.91</li> <li>Qualcomm 8cx Gen3 P Core @ 3.0 GHz Cortex-X1C\uff08<code>-O3</code>\uff09: 8.07</li> <li>Intel Core i9-10980XE @ 4.7 GHz Cascade Lake\uff08<code>-O3</code>\uff09: 6.91</li> <li>Qualcomm 8cx Gen3 E Core @ 2.4 GHz Cortex-A78C\uff08<code>-O3</code>\uff09: 6.08</li> <li>Loongson 3A6000 @ 2.5 GHz LA664\uff08<code>-O3</code>\uff09: 5.57 5.56</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff08<code>-march=native</code>\uff09\uff1a</p> <ul> <li>AWS Graviton 4 @ 2.8 GHz Neoverse V2\uff08<code>-O3 -march=native</code>\uff09: 8.87</li> <li>Intel Xeon Platinum 8358P @ 3.4 GHz Ice Lake\uff08<code>-O3 -march=native</code>\uff09: 7.60</li> <li>Intel Xeon D-2146NT @ 2.9 GHz Skylake\uff08<code>-O3 -march=native</code>\uff09: 5.48</li> <li>Loongson 3C5000 @ 2.2 GHz LA464\uff08<code>-O3 -march=native</code>\uff09: 3.09</li> </ul> <p>\u670d\u52a1\u5668\u5e73\u53f0\uff1a</p> <ul> <li>AMD EPYC 9R14 @ 3.7 GHz Zen 4\uff08<code>-O3</code>\uff09: 9.03</li> <li>AWS Graviton 4 @ 2.8 GHz Neoverse V2\uff08<code>-O3</code>\uff09: 8.75</li> <li>Kunpeng 920 HuaweiCloud kc2 @ 2.9 GHz\uff08<code>-O3</code>\uff09: 8.19</li> <li>Intel Xeon Platinum 8576C Emerald Rapids\uff08<code>-O3</code>\uff09: 8.14</li> <li>AWS Graviton 3E @ 2.6 GHz Neoverse V1\uff08<code>-O3</code>\uff09: 8.10</li> <li>AWS Graviton 3 @ 2.6 GHz Neoverse V1\uff08<code>-O3</code>\uff09: 7.80</li> <li>AMD EPYC 7K83 Zen 3\uff08<code>-O3</code>\uff09: 7.63</li> <li>T-Head Yitian 710 @ 3.0 GHz Neoverse N2\uff08<code>-O3</code>\uff09: 7.63</li> <li>AMD EPYC 9754 @ 3.1 GHz Zen 4c\uff08<code>-O3</code>\uff09: 7.53</li> <li>AMD EPYC 7742 @ 3.4 GHz Zen 2\uff08<code>-O3</code>\uff09: 7.12</li> <li>Intel Xeon Platinum 8358P @ 3.4 GHz Ice Lake\uff08<code>-O3</code>\uff09: 7.12</li> <li>AMD EPYC 7H12 @ 3.3 GHz Zen 2\uff08<code>-O3</code>\uff09: 6.61</li> <li>Intel Xeon E5-2680 v4 @ 3.3 GHz Broadwell\uff08<code>-O3</code>\uff09: 5.44</li> <li>Ampere Altra @ 3.0 GHz Neoverse N1\uff08<code>-O3</code>\uff09: 5.26</li> <li>Intel Xeon E5-2680 v3 @ 3.3 GHz Haswell\uff08<code>-O3</code>\uff09: 5.15</li> <li>Intel Xeon D-2146NT @ 2.9 GHz Skylake\uff08<code>-O3</code>\uff09: 5.00</li> <li>Loongson 3C6000 @ 2.2 GHz LA664\uff08<code>-O3</code>\uff09: 4.94</li> <li>IBM POWER8NVL @ 4.0 GHz POWER8\uff08<code>-O3</code>\uff09: 4.10</li> <li>AMD EPYC 7551 @ 2.5 GHz Zen 1\uff08<code>-O3</code>\uff09: 3.47</li> <li>Kunpeng 920 HuaweiCloud kc1 @ 2.6 GHz\uff08<code>-O3</code>\uff09: 3.17</li> <li>Intel Xeon E5-2603 v4 @ 1.7 GHz Broadwell\uff08<code>-O3</code>\uff09: 3.14</li> <li>Kunpeng 920 @ 2.6 GHz TaiShan V110\uff08<code>-O3</code>\uff09: 3.13</li> <li>Loongson 3C5000 @ 2.2 GHz LA464\uff08<code>-O3</code>\uff09: 3.00</li> </ul> <p>\u624b\u673a\u5e73\u53f0\uff08LTO\uff09\uff1a</p> <ul> <li>Huawei Kirin 9010 @ 2.3 GHz \uff08<code>-O3 -flto</code>\uff09: 5.93</li> </ul> <p>\u6ce8\uff1a</p> <ol> <li>SPEC FP 2017 Rate-1 \u7ed3\u679c\u53d7 <code>-march=native</code> \u5f71\u54cd\u5f88\u660e\u663e\uff0c\u7279\u522b\u662f\u6709 AVX-512 \u7684\u5e73\u53f0\uff0c\u56e0\u4e3a\u4e0d\u5f00 <code>-march=native</code> \u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b SIMD \u6700\u591a\u7528\u5230 SSE\u3002</li> <li>\u90e8\u5206\u5185\u6838\u7248\u672c\uff08\u5927\u7ea6 6.7-6.11\uff0c\u5728 6.12/6.11.7 \u4e2d\u4fee\u590d\uff09\u4f1a\u663e\u8457\u5f71\u54cd 503.bwaves_r \u548c 507.cactuBSSN_r \u9879\u76ee\u7684\u6027\u80fd\uff0c\u8be6\u89c1 Intel Spots A 3888.9% Performance Improvement In The Linux Kernel From One Line Of Code\u3001mm, mmap: limit THP alignment of anonymous mappings to PMD-aligned sizes \u548c kernel 6.10 THP causes abysmal performance drop\u3002</li> <li>Qualcomm 8cx Gen3 P core \u5728\u8dd1\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u4f1a\u56e0\u4e3a\u8fc7\u70ed\u964d\u9891\uff0c\u5bfc\u81f4\u8fbe\u4e0d\u5230\u6700\u4f73\u6027\u80fd\u3002</li> </ol>"},{"location":"benchmark/#\u7f51\u4e0a\u7684\u6570\u636e_1","title":"\u7f51\u4e0a\u7684\u6570\u636e","text":"<p>\u9ad8\u901a X Elite Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b\uff1a\u8d70\u8d70\u505c\u505c by JamesAslan:</p> <ul> <li>Intel Core 13700K Raptor Lake: 14.56</li> <li>Qualcomm X1E80100 Oryon: 14.20</li> <li>AMD Ryzen 7700X Zen 4: 13.97</li> <li>Intel Core 12700K Alder Lake: 13.70</li> <li>Apple M2 Avalanche+Blizzard: 12.64</li> <li>AMD Ryzen 5950X Zen 3: 11.86</li> <li>Apple M1 Firestorm+Icestorm: 11.20</li> <li>Qualcomm 8 Gen 2 Cortex-X3: 9.91</li> </ul> <p>Running SPEC CPU2017 on Chinese CPUs, and More</p> <ul> <li>AMD Ryzen 9 7950X3D Non-VCache: 15.4</li> <li>Intel Core Ultra 7 258V Lion Cove: 13.9</li> <li>Intel Core Ultra 7 115H Redwood Cove: 12</li> <li>Intel Core Ultra 7 258V Skymont: 7.94</li> <li>Intel Core i5-6600K Skylake: 7.92</li> <li>Intel Core Ultra 7 115H Crestmont: 6.86</li> <li>Loongson 3A6000 LA664: 5.49</li> <li>Mediatek Genio 1200 Cortex A78: 5.09</li> <li>Intel Core Ultra 7 115H Low Power Crestmont: 4.32</li> <li>AMD FX-8150: 3.63</li> <li>Loongson 3A5000 LA464: 3.38</li> <li>Intel Celeron J4125 Goldmont Plus: 2.45</li> <li>Amlogic S922X Cortex A73: 2.01</li> <li>Zhaoxin KaiXian KX-6640MA: 1.97</li> <li>Mediatek Genio 1200 Cortex A55: 1.01</li> </ul> <p>Running SPEC CPU2017 at Chips and Cheese?</p> <ul> <li>AMD Ryzen 9 9950X: 19.8</li> <li>AMD Ryzen 9 7950X3D Non-VCache: 15.3</li> <li>AMD Ryzen 9 7950X3D VCache: 12.7</li> <li>Intel Core Ultra 7 115H Redwood Cove: 11.2</li> <li>AMD Ryzen 9 3950X 3.5GHz: 7.26</li> <li>Intel Core Ultra 7 115H Crestmont: 5.83</li> <li>Ampere Altra: 5.62</li> <li>AmpereOne: 4.29</li> <li>AMD FX-8159: 3.47</li> </ul> <p>The AMD Ryzen 9 9950X and Ryzen 9 9900X Review: Flagship Zen 5 Soars - and Stalls</p> <ul> <li>AMD Ryzen 9 9950X Zen 5: 17.72</li> <li>Intel Core i9-14900K Raptor Lake: 16.90</li> <li>AMD Ryzen 9 7950X Zen 4: 14.26</li> </ul> <p>Snapdragon X Elite Qualcomm Oryon CPU Design and Architecture Hot Chips 2024</p> <ul> <li>Qualcomm X Elite Oryon on Linux: 17.77</li> <li>Qualcomm X Elite Oryon on Windows: 16.66</li> </ul> <p>ARM Cortex X1 \u5fae\u67b6\u6784\u8bc4\u6d4b\uff08\u4e0a\uff09\uff1a\u5411\u5c71\u8fdb\u53d1</p> <ul> <li>Zen 3 @ 4.95 GHz: 11.9</li> <li>Firestorm @ 3.0 GHz: 11.2</li> <li>Cortex X1 @ 3.0 GHz: 8.9</li> <li>Cortex A78 @ 2.4 GHz: 5.9</li> </ul>"},{"location":"benchmark/#gcc--gfortran-vs-clang--flang-new","title":"GCC + GFortran vs Clang + Flang-new","text":"<p>\u5728 Intel i9-14900K \u4e0a\u7528 -O3 \u6d4b\u8bd5\u4e24\u79cd\u7f16\u8bd1\u5668\u7ec4\u5408\u7684\u6027\u80fd\uff1a</p> Benchmark GCC 12.2.0 LLVM 19.1.4 503.bwaves_r 75.9 74.5 507.cactuBSSN_r 14.9 14.2 508.namd_r 9.61 11.0 510.parest_r 15.6 15.8 511.povray_r 15.1 14.2 519.lbm_r 12.6 11.3 521.wrf_r 14.0 14.0 526.blender_r 12.7 12.5 527.cam4_r 16.3 13.7 538.imagick_r 10.7 12.5 544.nab_r 13.2 8.66 549.fotonik3d_r 25.0 21.6 554.roms_r 14.7 14.1 geomean 16.1 15.2"},{"location":"benchmark/#spec-int-2006-speed","title":"SPEC INT 2006 Speed","text":"<p>\u56e0\u4e3a GCC \u6ca1\u6709\u81ea\u52a8\u5e76\u884c\u5316\uff0c\u6240\u4ee5\u90fd\u662f\u5355\u6838\u8fd0\u884c\u3002\u8fd0\u884c\u65f6\u95f4\u57fa\u672c\u548c\u5206\u6570\u6210\u53cd\u6bd4\uff0c\u4e58\u79ef\u6309 400000 \u4f30\u7b97\u3002</p> <p>\u4e0b\u9762\u8d34\u51fa\u81ea\u5df1\u6d4b\u7684\u6570\u636e\uff08SPECint2006\uff0cEstimated\uff0cspeed\uff0cbase\uff09\uff0c\u4e0d\u4fdd\u8bc1\u6ee1\u8db3 SPEC \u7684\u8981\u6c42\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002</p> <ul> <li>Intel Core i9-14900K Raptor Lake\uff08<code>-O3</code>\uff09: 91.9</li> <li>Intel Core i9-14900K Raptor Lake\uff08<code>-O2</code>\uff09: 87.2</li> <li>Intel Core i9-13900K Raptor Lake\uff08<code>-Ofast -fomit-frame-pointer -march=native -mtune=native</code>\uff09: 85.3 86.8</li> <li>Intel Core i9-13900K Raptor Lake\uff08<code>-O2</code>\uff09: 79.6</li> <li>Intel Core i9-12900KS Alder Lake\uff08<code>-O2</code>\uff09: 74.4</li> <li>Intel Core i9-10980XE Cascade Lake\uff08<code>-O2</code>\uff09: 43.9</li> <li>Intel Xeon E5-2680 v3 Haswell\uff08<code>-O2</code>\uff09: 33.2</li> <li>POWER8NVL\uff08<code>-O2</code>\uff09: 26.5</li> <li>Kunpeng 920 TaiShan V110\uff08<code>-Ofast -fomit-frame-pointer -march=native -mtune=native</code>\uff09: 24.5</li> <li>Kunpeng 920 TaiShan V110\uff08<code>-O2</code>\uff09: 23.3</li> </ul>"},{"location":"benchmark/#\u7f51\u4e0a\u7684\u6570\u636e_2","title":"\u7f51\u4e0a\u7684\u6570\u636e","text":"<p>\u53ea\u8003\u8651\u5355\u6838\uff0c\u4e0d\u8003\u8651 ICC \u7684\u81ea\u52a8\u591a\u7ebf\u7a0b\u5e76\u884c\u5316\u3002</p> <p>Anandtech \u7684\u6570\u636e\uff1a</p> <ul> <li>Intel Core i9-10900K Comet Lake: 58.76</li> <li>AMD Ryzen 3950X Zen 2: 50.02</li> <li>AMD Ryzen 4800U Zen 2: 37.10</li> <li>Amazon Graviton 2 Neoverse-N1: 29.99</li> </ul> <p>Anandtech \u7684\u6570\u636e\uff1a</p> <ul> <li>Apple M1 Firestorm+Icestorm: 69.40</li> <li>AMD Ryzen 5950X Zen 3: 68.53</li> <li>Apple A14 Firestorm+Icestorm: 63.34</li> <li>Intel Core i9-10900K Comet Lake: 58.58</li> <li>Apple A13 Lightning+Thunder: 52.83</li> <li>AMD Ryzen 3950X Zen 2: 50.10</li> <li>AMD Ryzen 2700X Zen+: 39.01</li> </ul> <p>Anandtech \u7684\u6570\u636e\uff1a</p> <ul> <li>AMD EPYC 7742 Zen 2: 39.25</li> <li>AMD EPYC 7601 Zen 1: 31.45</li> </ul> <p>Baikal \u7684\u6570\u636e:</p> <ul> <li>Baikal-S\uff1a19</li> <li>Kunpeng 920 TSV110: 26</li> </ul> <p>\u9f99\u82af 3A6000 \u65b0\u95fb\uff1a</p> <ul> <li>Loongson 3A6000 LA664: 43.1</li> </ul> <p>\u9f99\u82af 3A6000:</p> <ul> <li>Loongson 3A6000 LA664: 43.1</li> <li>Intel Core i3-10100 Comet Lake: 42.5</li> <li>Hygon 3250: 39</li> <li>Kirin 990: 26.4</li> <li>Zhaoxin KX6780A: 20.5</li> <li>Phytium FT-D2000: 15.4</li> <li>Pangu M900: 12.4</li> </ul> <p>\u5728\u9f99\u82af 3A5000 \u4e0a\u6d4b\u8bd5 SPEC CPU 2006:</p> <ul> <li>Loongson 3A5000 LA464: 26.6</li> </ul> <p>\u9f99\u82af\u3001\u6d77\u5149\u3001\u98de\u817e\u3001\u5146\u82af\u540c\u684c\u5bf9\u6bd4\u6027\u80fd\u529b\u6c42\u516c\u5e73:</p> <ul> <li>Intel Core i9-10850K Comet Lake: 62.5</li> <li>AMD Ryzen 5600G: 48.2 59.9</li> <li>AMD Ryzen 2600: 36.1 40.5</li> <li>Intel Core i5-6500 Skylake: 40.1</li> <li>Hygon C86 3250: 30.5</li> <li>Loongson 3A5000HV LA464: 26.5</li> <li>Zhaoxin KX-U6780A: 15.5</li> <li>Phytium D2000: 15.3</li> </ul>"},{"location":"benchmark/#spec-int-2006-rate","title":"SPEC INT 2006 Rate","text":"<p>TODO</p>"},{"location":"benchmark/#\u7f51\u4e0a\u7684\u6570\u636e_3","title":"\u7f51\u4e0a\u7684\u6570\u636e","text":"<p>Kunpeng 920 \u5b98\u65b9\u6570\u636e\uff1a</p> <ul> <li>Kunpeng 920 TSV110 64 Cores: &gt;930</li> </ul> <p>\u590f\u6676\u7684\u6570\u636e\uff1a</p> <ul> <li>AMD Zen 2 64 Cores: ~1200</li> <li>Intel Skylake 8180 v5 28 Cores: ~750</li> <li>Cavium TX2 32 Cores: ~750</li> <li>AMD EPYC 7601 Zen 1 32 Cores: ~700</li> <li>Qualcomm 2400 48 Cores: ~650</li> <li>Phytium FT2000 64 Cores: ~600</li> <li>Intel 6148 Skylake 20 Cores: ~550</li> </ul> <p>\u9f99\u82af 3A6000 \u65b0\u95fb\uff1a</p> <ul> <li>Loongson 3A6000 LA664 4C 8T: 155</li> </ul> <p>\u9f99\u82af\u3001\u6d77\u5149\u3001\u98de\u817e\u3001\u5146\u82af\u540c\u684c\u5bf9\u6bd4\u6027\u80fd\u529b\u6c42\u516c\u5e73:</p> <ul> <li>Intel Core i9-10850K Comet Lake 10C 20T: 328 349</li> <li>AMD Ryzen 5600G 6C 12T: 192 232 235 278</li> <li>AMD Ryzen 2600 6C 12T: 166 179 192 199</li> <li>Hygon C86 3250 8C 16T: 173 197</li> <li>Intel Core i5-6500 Skylake 4C: 113</li> <li>Phytium D2000 8C: 90.2</li> <li>Zhaoxin KX-U6780A 8C: 82.9</li> <li>Loongson 3A5000HV 4C: 81.2</li> </ul>"},{"location":"benchmark/#spec-int-2017-speed","title":"SPEC INT 2017 Speed","text":"<p>\u4e0b\u9762\u8d34\u51fa\u81ea\u5df1\u6d4b\u7684\u6570\u636e\uff08SPECint2017\uff0cEstimated\uff0cspeed\uff0cbase\uff0c\u5355\u7ebf\u7a0b\uff09\uff0c\u4e0d\u4fdd\u8bc1\u6ee1\u8db3 SPEC \u7684\u8981\u6c42\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002</p> <p>\u8fd0\u884c\u65f6\u95f4\u57fa\u672c\u548c\u5206\u6570\u6210\u53cd\u6bd4\uff0c\u4e58\u79ef\u6309 1e5 \u4f30\u7b97\u3002</p> <ul> <li>Intel Core i9-14900K Raptor Lake\uff08<code>-O3</code>\uff09: 12.1</li> <li>Intel Core i9-12900KS Alder Lake\uff08<code>-O3</code>\uff09: 10.5 10.9</li> <li>Qualcomm X1E80100 X Elite\uff08<code>-O3</code>\uff09: 7.99</li> <li>Intel Core i9-10980XE Cascade Lake\uff08<code>-O3</code>\uff09: 7.18</li> <li>AMD EPYC 7742 Zen 2\uff08<code>-O3</code>\uff09: 5.55</li> <li>Kunpeng 920 TaiShan V110\uff08<code>-O3</code>\uff09: 3.65 3.62</li> </ul> <p>\u6ce8\uff1aSPEC INT 2017 \u5355\u7ebf\u7a0b OpenMP \u4e0b speed \u6d4b\u8bd5\u6309\u7406\u8bf4\u7ea6\u7b49\u4e8e rate-1\uff0c\u524d\u8005\u867d\u7136\u542f\u7528\u4e86 OpenMP\uff0c\u4f46\u4ec5\u5141\u8bb8\u5355\u7ebf\u7a0b\u3002\u4e0d\u8fc7\u5b9e\u6d4b\u4e0b\u6765\u8fd8\u662f\u4e0d\u592a\u4e00\u6837\u3002</p>"},{"location":"benchmark/#spec-fp-2017-speed","title":"SPEC FP 2017 Speed","text":"<p>\u4e0b\u9762\u8d34\u51fa\u81ea\u5df1\u6d4b\u7684\u6570\u636e\uff08SPECfp2017\uff0cEstimated\uff0cspeed\uff0cbase\uff0c\u5355\u7ebf\u7a0b\uff09\uff0c\u4e0d\u4fdd\u8bc1\u6ee1\u8db3 SPEC \u7684\u8981\u6c42\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002</p> <p>\u8fd0\u884c\u65f6\u95f4\u57fa\u672c\u548c\u5206\u6570\u6210\u53cd\u6bd4\uff0c\u4e58\u79ef\u6309 5e5 \u4f30\u7b97\u3002</p> <ul> <li>Intel Core i9-14900K Raptor Lake\uff08<code>-O3</code>\uff09: 12.8</li> <li>Intel Core i9-12900KS Alder Lake\uff08<code>-O3</code>\uff09: 13.1</li> <li>AMD EPYC 7742 Zen 2\uff08<code>-O3</code>\uff09: 6.99</li> <li>Intel Core i9-10980XE Cascade Lake\uff08<code>-O3</code>\uff09: 6.20</li> <li>Kunpeng 920 TaiShan V110\uff08<code>-O3</code>\uff09: 2.57</li> </ul> <p>\u6ce8\uff1aSPEC FP 2017 \u5355\u7ebf\u7a0b OpenMP \u4e0b speed \u6d4b\u8bd5\u4e0d\u7b49\u4ef7\u4e3a rate-1\uff0c\u56e0\u4e3a\u8dd1\u7684\u6d4b\u8bd5\u4e0d\u540c\u3002</p>"},{"location":"benchmark/#spec-\u8fd0\u884c\u914d\u7f6e","title":"SPEC \u8fd0\u884c\u914d\u7f6e","text":""},{"location":"benchmark/#spec-2006","title":"SPEC 2006","text":"<pre><code># match spec result standard\nreportable = yes\n# skip peak\nbasepeak = yes\n# show live output\nteeout = yes\n\n# optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O3 -fgnu89-inline -fcommon -fno-strict-aliasing\nCXXOPTIMIZE = -O3 -fpermissive --std=c++98 -fno-strict-aliasing\nFOPTIMIZE = -O3 -std=legacy -fno-strict-aliasing\n\n# specify compilers\ndefault=default=default=default:\nCC = /usr/bin/gcc\nCXX = /usr/bin/g++\nFC = /usr/bin/gfortran\n\n# fix compilation\ndefault=base=default=default:\nPORTABILITY = -DSPEC_CPU_LP64\n\n400.perlbench=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX_X64\n\n462.libquantum=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX\n\n483.xalancbmk=default=default=default:\nCXXPORTABILITY = -DSPEC_CPU_LINUX\n\n481.wrf=default=default=default:\nCPORTABILITY = -DSPEC_CPU_CASE_FLAG -DSPEC_CPU_LINUX\n</code></pre> <p>\u8fd0\u884c\u65b9\u5f0f\uff1a</p> <pre><code># int speed\ncd /mnt &amp;&amp; . ./shrc &amp;&amp; runspec int\n</code></pre>"},{"location":"benchmark/#spec-2017","title":"SPEC 2017","text":"<pre><code># match spec result standard\nreportable = yes\n# skip peak\nbasepeak = yes\n# show live output\nteeout = yes\n# speedup compilation\nmakeflags = --jobs=16\n\n# compilers\ndefault:\n   preENV_LD_LIBRARY_PATH  = /usr/lib64:/usr/lib:/lib64\n   SPECLANG                = /usr/bin/\n   CC                      = $(SPECLANG)gcc -std=c99\n   CXX                     = $(SPECLANG)g++\n   FC                      = $(SPECLANG)gfortran\n   # How to say \"Show me your version, please\"\n   CC_VERSION_OPTION       = -v\n   CXX_VERSION_OPTION      = -v\n   FC_VERSION_OPTION       = -v\n\n# perf: use runcpu --define perf=1 --noreportable to enable\n%if %{perf} eq \"1\"\n# override branch-misses counter if necessary\n%ifndef %{branchmisses}\n%define branchmisses branch-misses\n%endif\ndefault:\n   command_add_redirect = 1\n# bind to core if requested\n%ifdef %{bindcore}\n   monitor_wrapper = mkdir -p $[top]/result/perf.$lognum; echo \"$command\" &gt; $[top]/result/perf.$lognum/$benchmark.cmd.$iter.\\$\\$; taskset -c %{bindcore} perf stat -x \\\\; -e instructions,cycles,branches,%{branchmisses},task-clock -o $[top]/result/perf.$lognum/$benchmark.perf.$iter.\\$\\$ $command\n%else\n   monitor_wrapper = mkdir -p $[top]/result/perf.$lognum; echo \"$command\" &gt; $[top]/result/perf.$lognum/$benchmark.cmd.$iter.\\$\\$; perf stat -x \\\\; -e instructions,cycles,branches,%{branchmisses},task-clock -o $[top]/result/perf.$lognum/$benchmark.perf.$iter.\\$\\$ $command\n%endif\n%endif\n\n# portability flags\ndefault:\n   EXTRA_PORTABILITY = -DSPEC_LP64\n500.perlbench_r,600.perlbench_s:  #lang='C'\n%if %{machine} eq \"x86_64\"\n   PORTABILITY    = -DSPEC_LINUX_X64\n%else\n   PORTABILITY    = -DSPEC_LINUX_AARCH64\n%endif\n\n521.wrf_r,621.wrf_s:  #lang='F,C'\n   CPORTABILITY  = -DSPEC_CASE_FLAG\n   FPORTABILITY  = -fconvert=big-endian\n\n523.xalancbmk_r,623.xalancbmk_s:  #lang='CXX'\n   PORTABILITY   = -DSPEC_LINUX\n\n526.blender_r:  #lang='CXX,C'\n   PORTABILITY   = -funsigned-char -DSPEC_LINUX\n\n527.cam4_r,627.cam4_s:  #lang='F,C'\n   PORTABILITY   = -DSPEC_CASE_FLAG\n\n628.pop2_s:  #lang='F,C'\n   CPORTABILITY    = -DSPEC_CASE_FLAG\n   FPORTABILITY    = -fconvert=big-endian\n\nintspeed,fpspeed:\n   EXTRA_OPTIMIZE = -fopenmp -DSPEC_OPENMP\nfpspeed:\n   #\n   # 627.cam4 needs a big stack; the preENV will apply it to all\n   # benchmarks in the set, as required by the rules.\n   #\n   preENV_OMP_STACKSIZE = 120M\n\ndefault=base:         # flags for all base\n%ifdef %{extralibs}\n   EXTRA_LIBS     = %{extralibs}\n%endif\n%ifdef %{optflags}\n   OPTIMIZE       = %{optflags}\n%else\n   OPTIMIZE       = -O3\n%endif\n   # -std=c++03 required for https://www.spec.org/cpu2017/Docs/benchmarks/510.parest_r.html\n   CXXOPTIMIZE    = -std=c++03\n   # -fallow-argument-mismatch required for https://www.spec.org/cpu2017/Docs/benchmarks/521.wrf_r.html\n   FOPTIMIZE      = -fallow-argument-mismatch\n\nintrate,intspeed=base: # flags for integer base\n   EXTRA_COPTIMIZE = -fno-strict-aliasing -fno-unsafe-math-optimizations -fno-finite-math-only -fgnu89-inline -fcommon\n# Notes about the above\n#  - 500.perlbench_r/600.perlbench_s needs -fno-strict-aliasing, -fno-unsafe-math-optimizations and -fno-finite-math-only\n#  - 502.gcc_r/602.gcc_s             needs -fgnu89-inline or -z muldefs\n#  - 525.x264_r/625.x264_s           needs -fcommon\n#  - For 'base', all benchmarks in a set must use the same options.\n#  - Therefore, all base benchmarks get the above.  See:\n#       https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags\n#       https://www.spec.org/cpu2017/Docs/benchmarks/500.perlbench_r.html\n#       https://www.spec.org/cpu2017/Docs/benchmarks/502.gcc_r.html\n#       https://www.spec.org/cpu2017/Docs/benchmarks/525.x264_r.html\n\nfprate,fpspeed=base: # flags for fp base\n   EXTRA_COPTIMIZE = -Wno-error=implicit-int\n# Notes about the above\n#  - 527.cam4_r,627.cam4_s needs -Wno-error=implicit-int\n</code></pre> <p>\u8fd0\u884c\u65b9\u5f0f\uff1a</p> <pre><code># int speed\ncd /mnt &amp;&amp; . ./shrc &amp;&amp; runcpu intspeed\n# fp speed\nulimit -s unlimited &amp;&amp; cd /mnt &amp;&amp; . ./shrc &amp;&amp; runcpu fpspeed\n</code></pre>"},{"location":"benchmark/#\u6d6e\u70b9\u5cf0\u503c\u6027\u80fd","title":"\u6d6e\u70b9\u5cf0\u503c\u6027\u80fd","text":"uArch DP FLOP/cycle SP FLOP/cycle ISA AMD Zen 5 32 64 AVX512F Intel Skylake 32 64 AVX512F Intel Sunny Cove 32 64 AVX512F AMD Zen 2 16 32 FMA AMD Zen 3 16 32 AVX512F AMD Zen 4 16 32 AVX512F ARM Neoverse V1 16 32 SVE(256b) ARM Neoverse V2 16 32 SVE(128b) Apple Avalanche 16 32 ASIMD Apple Firestorm 16 32 ASIMD Intel Broadwell 16 32 FMA Intel Golden Cove 16 32 FMA Intel Haswell 16 32 FMA Loongson LA464 16 32 LASX Loongson LA664 16 32 LASX Qualcomm Oryon 16 32 ASIMD AMD Zen 1 8 16 FMA ARM Cortex A78 8 16 ASIMD ARM Cortex X1 8 16 ASIMD ARM Icestorm 8 16 ASIMD ARM Neoverse N1 8 16 ASIMD ARM Neoverse N2 8 16 SVE(128b) Intel Gracemont 8 16 FMA Hisilicon TSV110 4 16 ASIMD"},{"location":"benchmark/#\u56fa\u5b9a\u9891\u7387\u65b9\u6cd5","title":"\u56fa\u5b9a\u9891\u7387\u65b9\u6cd5","text":"<p>\u53ef\u4ee5\u5c1d\u8bd5\u7528 cpupower frequency-set \u6765\u56fa\u5b9a\u9891\u7387\uff0c\u4f46\u662f\u4e00\u4e9b\u5e73\u53f0\u4e0d\u652f\u6301\uff0c\u8fd8\u53ef\u80fd\u6709 Linux \u5185\u65e0\u6cd5\u5173\u95ed\u7684 Boost\u3002\u8bbe\u7f6e\u9891\u7387\u540e\uff0c\u7528 <code>cpupower frequency-info</code> \u9a8c\u8bc1\uff1a<code>current CPU frequency: 4.29 GHz (asserted by call to kernel)</code> \u662f\u5426\u548c\u9884\u671f\u9891\u7387\u4e00\u81f4\u5e76\u4e14\u4e0d\u53d8\u3002</p> <p>\u5bf9\u4e8e AMD CPU\uff0c\u5728 Linux \u4e0b\u4e3a\u4e86\u56fa\u5b9a CPU \u7684\u9891\u7387\uff0c\u9700\u8981\u901a\u8fc7 MSR \u8fdb\u884c\u8bbe\u7f6e\uff1ajiegec/ZenStates-Linux\uff1a</p> <ol> <li>\u5173\u95ed Core performance boost</li> <li>\u8bfb\u53d6\u5f53\u524d\u7684 pstate \u8bbe\u7f6e</li> <li>\u4fee\u6539\u5f53\u524d pstate \u7684 FID\uff0c\u4e5f\u5c31\u4fee\u6539\u4e86\u9891\u7387</li> </ol>"},{"location":"benchmark/#cpu-\u578b\u53f7","title":"CPU \u578b\u53f7","text":"<p>\u4e0b\u9762\u7ed9\u51fa\u6d4b\u8bd5\u7684\u5404 CPU \u578b\u53f7\u7684\u5b98\u7f51\u94fe\u63a5\uff1a</p> <ul> <li>AMD Ryzen 5 7500F: Max Boost Clock 5.0 GHz</li> <li>AMD Ryzen 9 9950X: Max Boost Clock 5.7 GHz</li> <li>AWS Gravition 2/3/3E/4</li> <li>Intel Core i9-10980XE: Max Boost Clock 4.8 GHz</li> <li>Intel Core i9-12900KS: Max Boost Clock 5.5 GHz</li> <li>Intel Core i9-14900K: Max Boost Clock 6.0 GHz</li> <li>Intel Xeon E5-2603 v4</li> <li>Qualcomm 8cx Gen3</li> <li>Qualcomm X Elite</li> </ul>"},{"location":"open-source-contributions/","title":"\u5f00\u6e90\u8f6f\u4ef6\u8d21\u732e","text":"<p>\u8bb0\u5f55\u6211\u5bf9\u5f00\u6e90\u8f6f\u4ef6\u7684\u4e00\u4e9b\u5fae\u5c0f\u7684\u8d21\u732e\uff0c\u4ee5\u52c9\u52b1\u81ea\u5df1\uff0c\u7763\u4fc3\u81ea\u5df1\u4e0d\u5fd8\u4e3a\u793e\u533a\u505a\u8d21\u732e\u3002</p>"},{"location":"open-source-contributions/#maintenance","title":"Maintenance","text":"<p>\u6211\u4e3b\u8981\u53c2\u4e0e\u5982\u4e0b\u5f00\u6e90\u9879\u76ee\u7684\u7ef4\u62a4\uff1a</p> <ul> <li>lsof-org/lsof</li> <li>AOSC-Dev</li> <li>NixOS/nixpkgs</li> <li>canokeys</li> <li>nfcim</li> </ul>"},{"location":"open-source-contributions/#aosc-os-abbs","title":"aosc-os-abbs","text":"<ul> <li>pull requests by jiegec</li> </ul>"},{"location":"open-source-contributions/#aws-cdk","title":"aws-cdk","text":"<ul> <li>feat(cloudfront): support Behavior-specific viewer protocol policy for CloudFrontWebDistribution</li> </ul>"},{"location":"open-source-contributions/#bandersnatch","title":"bandersnatch","text":"<ul> <li>Skip downloading based on file size and upload time instead of sha256sum</li> </ul>"},{"location":"open-source-contributions/#binutils","title":"binutils","text":"<ul> <li>as: Add new estimated reciprocal instructions in LoongArch v1.1</li> <li>as: Add new atomic instructions in LoongArch v1.1</li> </ul>"},{"location":"open-source-contributions/#cargo","title":"cargo","text":"<ul> <li>Don't create hardlink for library test and integrations tests, fixing #7960</li> </ul>"},{"location":"open-source-contributions/#chiseltest","title":"chiseltest","text":"<ul> <li>Fix VCS simulation binary path</li> <li>Fix issue #428: add blackbox sources to argument of icarus-verilog and vcs</li> <li>Fix VcsFlags not properly passed to vcs backend</li> </ul>"},{"location":"open-source-contributions/#emacs","title":"emacs","text":"<ul> <li>bug#23909: 25.1.50; `button-label' must be called in the buffer where ...<ul> <li>button-* function doc string clarifications</li> </ul> </li> </ul>"},{"location":"open-source-contributions/#flopoco","title":"FloPoCo","text":"<ul> <li>two more bug fixes by Jiajie Chen</li> <li>Remove the duplicate code lines: R &lt;= (bug reported by Jiajie Chen)</li> <li>Commits by me</li> </ul>"},{"location":"open-source-contributions/#force-riscv","title":"force-riscv","text":"<ul> <li>Fixed compilation error: std::string and int64_t undefined</li> </ul>"},{"location":"open-source-contributions/#freebsd","title":"FreeBSD","text":"<ul> <li>Add kf_file_nlink field to kf_file and populate it</li> </ul>"},{"location":"open-source-contributions/#gcc","title":"gcc","text":"<ul> <li>LoongArch: extend.texi: Fix typos in LSX intrinsics</li> </ul>"},{"location":"open-source-contributions/#gpaw","title":"gpaw","text":"<ul> <li>Fix issue #269 to add additional broadcast in some cases</li> <li>Capture and ignore AttributeError thrown in getpreferredencoding() in newer Python versions</li> </ul>"},{"location":"open-source-contributions/#gtkwave","title":"gtkwave","text":"<ul> <li>Fix compilation under macOS for Nix</li> </ul>"},{"location":"open-source-contributions/#homebrew-cask","title":"homebrew-cask","text":"<ul> <li>Update notion to 1.0.5</li> <li>Add MacGesture v2.2.5</li> <li>Update next to 0.07</li> <li>Update bilibili to 2.14</li> <li>Update bilibili to 2.13</li> </ul>"},{"location":"open-source-contributions/#iproute2mac","title":"iproute2mac","text":"<ul> <li>Fix ip route for macOS Catalina issue #30 </li> </ul>"},{"location":"open-source-contributions/#iwd","title":"iwd","text":"<ul> <li>[PATCH 1/2] knownnetworks: fix potential out of bounds write<ul> <li>knownnetworks: fix printing SSID in hex</li> <li>knownnetworks: fix potential out of bounds write</li> </ul> </li> </ul>"},{"location":"open-source-contributions/#kicad","title":"KiCad","text":"<ul> <li>libcontext: Initial support for Apple Silicon</li> </ul>"},{"location":"open-source-contributions/#knem","title":"KNEM","text":"<ul> <li>driver/linux: use the pin API added in Linux 5.6</li> </ul>"},{"location":"open-source-contributions/#litedram","title":"litedram","text":"<ul> <li>Add support for clam shell topology</li> </ul>"},{"location":"open-source-contributions/#litex","title":"litex","text":"<ul> <li>Add support for clam shell topology</li> </ul>"},{"location":"open-source-contributions/#legacy-homebrew","title":"legacy-homebrew","text":"<ul> <li>emscripten 1.35.9</li> <li>gnuradio 3.7.8.1</li> <li>emscripten 1.35.2</li> <li>emscripten 1.35.0</li> <li>emscripten 1.34.12</li> <li>emscripten 1.34.11</li> <li>airspy 1.0.6</li> <li>libbladerf 2015.07</li> <li>uhd 003.009.000</li> <li>uhd 003.008.005</li> <li>hbase v0.89.9</li> </ul>"},{"location":"open-source-contributions/#miktex","title":"MiKTeX","text":"<ul> <li>Initial support for native Apple Silicon target</li> </ul>"},{"location":"open-source-contributions/#nixpkgs","title":"Nixpkgs","text":"<ul> <li>hdf5_1_10: 1.10.9 -&gt; 1.10.11</li> <li>glibc: use libutil.a when libutil.so.1 is unavailable</li> <li>boost183: init at 1.83.0</li> <li>dhcpcd: 9.4.1 -&gt; 10.0.3</li> <li>ifrextractor-rs: init at 1.5.1</li> <li>mucommander: 1.2.0-1 -&gt; 1.3.0-1</li> <li>copilot-cli: 1.28.0 -&gt; 1.29.0</li> <li>cbmc: 5.87.0 -&gt; 5.88.1</li> <li>cbmc: 5.76.1 -&gt; 5.86.0</li> <li>spark2014: do not hardcode gnat12 version</li> <li>flashrom: unbreak darwin</li> <li>circt: 1.34.0 -&gt; 1.37.0</li> <li>mucommander: 1.1.0-1 -&gt; 1.2.0-1</li> <li>copilot-cli: 1.26.0 -&gt; 1.27.0</li> <li>rain: 1.2.0 -&gt; 1.3.3</li> <li>spice-gtk: unbreak on darwin</li> <li>pcsclite: fix libsystemd switch</li> <li>python3Packages.brian2: init at 2.5.1</li> <li>nest: init at 3.3</li> <li>bpftools: fix build on ppc64le</li> <li>ngspice: add darwin to platforms</li> <li>spark2014: init at unstable-2022-05-25</li> <li>Add support for gnuradio on darwin</li> <li>darwin.iproute2mac: 1.4.0 -&gt; 1.4.1</li> <li>jsonmerge: skip failed tests</li> <li>krunvm: add support for darwin</li> <li>recoll: fix no/bad configuration error on darwin</li> <li>sioyek: unbreak on darwin</li> <li>circleci-cli: 0.1.17142 -&gt; 0.1.20397</li> <li>foremost: unbreak on Darwin</li> <li>prometheus-influxdb-exporter: 0.8.0 -&gt; 0.10.0</li> <li>rain: init at 1.2.0</li> <li>hal-hardware-analyzer: fix build with python 3.10</li> <li>arpack: unbreak on aarch64-darwin</li> <li>cvc3: unbreak on darwin</li> <li>python310Packages.chalice: 1.26.6 -&gt; 1.27.1</li> <li>aws-sam-cli: 1.52.0 -&gt; 1.53.0</li> <li>python310Packages.aws-sam-translator: 1.46.0 -&gt; 1.47.0</li> <li>rustup: 1.24.3 -&gt; 1.25.1</li> <li>cbmc: init at 5.63.0</li> <li>lsof: fix -fno-common builds on darwin</li> <li>libbsd: fix build on darwin</li> <li>libressl: fix build on aarch64-darwin</li> <li>glances: fix tests on darwin</li> <li>mono: 6.12.0.122 -&gt; 6.12.0.182</li> <li>aws-workspaces: 4.0.1.1302 -&gt; 4.1.0.1523</li> <li>copilot-cli: init at 1.19.0</li> <li>wkhtmltopdf: unbreak on darwin</li> <li>Fix hdfview issue 179793 and bump hdfview to 3.1.4</li> <li>Add darwin support for hdfview</li> <li>hdf5_1_10: 1.10.6 -&gt; 1.10.9</li> <li>hdf5: 1.12.1 -&gt; 1.12.2</li> <li>musescore: 2.1 -&gt; 3.6.2.548020600 on darwin</li> <li>darwin.network_cmds: fix build on aarch64-darwin</li> <li>darwin.xnu: fix build on aarch64-darwin</li> <li>openconnect: 8.20 -&gt; 9.01</li> <li>python310Packages.cocotb: unbreak on Darwin</li> <li>darwin.iproute2mac: 1.2.1 -&gt; 1.4.0</li> <li>htmldoc: fix darwin build</li> <li>radare2: unbreak on Darwin</li> <li>radare2: 5.6.8 -&gt; 5.7.2</li> <li>gtkwave: support darwin build</li> <li>cairo: add patch to fix crashes on darwin</li> </ul>"},{"location":"open-source-contributions/#openfpgaloader","title":"openFPGALoader","text":"<ul> <li>Add flash support for VCU128</li> <li>Add initial support for VCU128</li> </ul>"},{"location":"open-source-contributions/#pynn","title":"PyNN","text":"<ul> <li>Fix quantities error and x-y order in plotting</li> <li>Fix weight type in brain2 backend for issue 711</li> <li>add missing new for neuron 8.0.0, fixing issue #722</li> </ul>"},{"location":"open-source-contributions/#qemu","title":"qemu","text":"<ul> <li>Lower TCG vector ops to LSX</li> <li>target/loongarch: fix ASXE flag conflict</li> <li>linux-user/elfload: Enable LSX/LASX in HWCAP for LoongArch</li> <li>hw/loongarch: Fix ACPI processor id off-by-one error</li> <li>Add la32 &amp; va32 support for loongarch64-softmmu</li> <li>target/loongarch: Split fcc register to fcc0-7 in gdbstub</li> <li>target/loongarch: Fix CSR.DMW0-3.VSEG check</li> </ul>"},{"location":"open-source-contributions/#rocket-chip","title":"rocket-chip","text":"<ul> <li>Doc fixes and add comments to axi4 bundles</li> </ul>"},{"location":"open-source-contributions/#spinalcrypto","title":"SpinalCrypto","text":"<ul> <li>Add cross scala version support, upgrade scalatest and fix scala 2.13 incompat code</li> </ul>"},{"location":"open-source-contributions/#spinalhdl","title":"SpinalHDL","text":"<ul> <li>Use scalafmt to format code</li> <li>Add support for write byte enable in BusSlaveFactory.writeMemWordAligned</li> <li>Fix typos and improve error messages</li> <li>Add option to enable logging of ghdl/iverlog backend</li> <li>Cross scala versions build</li> <li>Add support for Virtex UltraScale+ in xilinx eda bench</li> <li>Add axi4 slave factory</li> <li>Add writeByteEnable to BusSlaveFactory and support unaligned access in read/writeMultiWord for AXI4</li> <li>Pass simulator flags to iverilog and ghdl</li> <li>Add support for multiple rtl file benchmark</li> <li>Add support for multi word memory access in BusSlaveFactory</li> <li>Fix iverilog simulation under macOS</li> </ul>"},{"location":"open-source-contributions/#u-boot","title":"U-Boot","text":"<ul> <li>spi: xilinx_spi: Fix spi reset</li> </ul>"},{"location":"open-source-contributions/#\u5c1a\u672a\u5408\u5e76","title":"\u5c1a\u672a\u5408\u5e76","text":""},{"location":"series/","title":"\u7cfb\u5217","text":"<p>\u4e0b\u9762\u5217\u4e3e\u4e86\u6211\u7684\u535a\u5ba2\u91cc\u7684\u4e00\u4e9b\u7cfb\u5217\u6587\u7ae0\u3002</p>"},{"location":"series/#\u5fae\u67b6\u6784\u8bc4\u6d4b","title":"\u5fae\u67b6\u6784\u8bc4\u6d4b","text":"<p>#uarch-review</p>"},{"location":"series/#\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668","title":"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668","text":"<p>#write-a-linker</p>"},{"location":"series/#\u6559\u5b66\u7cfb\u5217","title":"\u6559\u5b66\u7cfb\u5217","text":"<p>#teaching</p>"},{"location":"series/#\u8fd1\u6765\u505a-stanford-cs140e-\u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003","text":"<p>#cs140e</p>"},{"location":"series/#\u6bcf\u5468\u5206\u4eab","title":"\u6bcf\u5468\u5206\u4eab","text":"<p>#weeklysharing</p>"},{"location":"series/#\u5728-fpga-\u4e0a\u5b9e\u73b0\u8def\u7531\u5668","title":"\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668","text":"<p>#router-on-fpga</p>"},{"location":"series/#\u6d45\u8c08\u4e71\u5e8f\u6267\u884c-cpu","title":"\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU","text":"<p>#brief-into-ooo</p>"},{"location":"series/#\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790","title":"\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790","text":"<p>#coherence</p>"},{"location":"tools/","title":"\u5de5\u5177","text":""},{"location":"tools/#\u5728\u7ebf\u5de5\u5177","title":"\u5728\u7ebf\u5de5\u5177","text":"<p>\u4e0b\u9762\u662f\u6211\u5e38\u7528\u7684\u4e00\u4e9b\u5728\u7ebf\u5de5\u5177\uff1a</p> <p>\u522b\u4eba\u7f16\u5199\u7684\uff1a</p> <ol> <li>https://gchq.github.io/CyberChef/</li> <li>https://godbolt.org/</li> <li>https://hpd.gasmi.net/</li> <li>https://tcpdump101.com/</li> <li>https://regexper.com/</li> <li>https://crontab.guru/</li> <li>https://salmanarif.bitbucket.io/visual/index.html</li> <li>https://mathpix.com/</li> <li>https://www.falstad.com/circuit/circuitjs.html</li> <li>https://merricx.github.io/qrazybox/</li> <li>https://www.epochconverter.com/</li> <li>https://www.vultr.com/resources/mac-converter/</li> <li>http://www.sunshine2k.de/coding/javascript/crc/crc_js.html</li> <li>https://www.easyunitconverter.com/</li> <li>https://gregstoll.com/~gregstoll/floattohex/</li> </ol> <p>\u81ea\u5df1\u7f16\u5199\u7684\uff1a</p> <ol> <li>S-DES \u53ef\u89c6\u5316 https://jia.je/sdes-visualization/</li> <li>Booth \u4e58\u6cd5\u53ef\u89c6\u5316 https://jia.je/booth-visualization/</li> <li>\u6574\u6570\u9664\u6cd5\u53ef\u89c6\u5316 https://jia.je/integer-divide-visualization/</li> <li>\u5728\u7ebf\u8fd0\u884c TAC \u4ee3\u7801 https://jia.je/online_tac_vm/</li> <li>\u5728\u7ebf\u7f16\u8bd1 Decaf https://jia.je/online_decaf/</li> <li>\u5728\u7ebf\u89e3\u7801\u767b\u673a\u724c\u4fe1\u606f BCBP https://jia.je/decode-bcbp/</li> <li>IEEE 754 \u7b49\u6d6e\u70b9\u683c\u5f0f\u8f6c\u6362 https://jia.je/floating/</li> </ol>"},{"location":"tools/#\u8c03\u8bd5\u5de5\u5177","title":"\u8c03\u8bd5\u5de5\u5177","text":"<ol> <li>CPU \u4e0a\u7684\u8c03\u8bd5\u5668\uff1aGDB LLDB</li> <li>\u7f16\u8bd1\u5668\u81ea\u5e26\uff1aAddressSanitizer, ThreadSanitizer, MemorySanitizer, UndefinedBehaviorSanitizer</li> <li>Valgrind \u7cfb\u5217\uff1avalgrind, memcheck, cachegrind, callgrind, helgrind, drd, massif, dhat, lackey, nulgrind, bbv</li> <li>MPI Tracing: Pilgrim: Logger for MPI communication</li> <li>GPU Race Detection: iGUARD: In-GPU Advanced Race Detection</li> <li>NUMA Profiling: NumaPerf: Predictive NUMA Profiling</li> <li>OpenMP Race Detection: archer: a data race detection tool for large OpenMP applications</li> <li>Python Profiling: cProfile, Guppy3: A Python Programming Environment &amp; Heap analysis toolset, PyInstrument: Call stack profiler for Python, Austin: Python frame stack sampler for CPython, py-spy: Sampling profiler for Python programs, Scalene: a high-performance, high-precision CPU, GPU, and memory profiler for Python</li> </ol>"},{"location":"2020/01/01/jielabs/","title":"JieLabs \u662f\u5982\u4f55\u5de5\u4f5c\u7684","text":""},{"location":"2020/01/01/jielabs/#\u7b80\u4ecb","title":"\u7b80\u4ecb","text":"<p>JieLabs \u662f\u9648\u5609\u6770\u3001\u9ad8\u4e00\u5ddd\u3001\u5218\u6653\u4e49\uff08\u6309\u59d3\u6c0f\u62fc\u97f3\u9996\u5b57\u6bcd\u6392\u5e8f\uff09\u4e8e 2020 \u5e74\u65b0\u578b\u51a0\u72b6\u75c5\u6bd2\u75ab\u60c5\u671f\u95f4\u5f00\u53d1\u7684\u5728\u7ebf\u6570\u5b57\u903b\u8f91\u7535\u8def\u5b9e\u9a8c\u7cfb\u7edf\uff0c\u7528\u4e8e\u6e05\u534e\u5927\u5b66 2020 \u5e74\u6625\u5b63\u5b66\u671f\u6570\u5b57\u903b\u8f91\u7535\u8def\u5b9e\u9a8c\u8bfe\u7a0b\u3002\u5176\u5305\u62ec\u524d\u7aef\u3001\u540e\u7aef\u548c\u56fa\u4ef6\u4e09\u90e8\u5206\uff0c\u5206\u522b\u4e3b\u8981\u7531\u5218\u6653\u4e49\u3001\u9648\u5609\u6770\u548c\u9ad8\u4e00\u5ddd\u8d1f\u8d23\u5f00\u53d1\u3002\u6838\u5fc3\u529f\u80fd\u5b9e\u73b0\u7528\u65f6\u4e00\u5468\uff0c\u540e\u7eed\u754c\u9762\u548c\u7a33\u5b9a\u6027\u4f18\u5316\u7528\u65f6\u4e24\u5468\u3002\u672c\u6587\u4f1a\u8be6\u7ec6\u5730\u4ecb\u7ecd JieLabs \u7684\u5de5\u4f5c\u539f\u7406\u548c\u4e00\u4e9b\u6280\u672f\u7ec6\u8282\uff0c\u5e0c\u671b\u5bf9\u5404\u4f4d\u540c\u5b66\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"2020/01/01/jielabs/#\u592a\u957f\u4e0d\u770b","title":"\u592a\u957f\uff1b\u4e0d\u770b\u3002","text":"<p>\u91c7\u7528\u4e86\u5982\u4e0b\u7684\u6280\u672f\u65b9\u6848\uff1a</p> <p>\u524d\u7aef\uff1aReact \u6846\u67b6 + Redux \u72b6\u6001\u7ba1\u7406 + Monaco \u7f16\u8f91\u5668 + WebAssembly \u8fd0\u884c Rust \u4ee3\u7801 + WebSocket \u5b9e\u65f6\u901a\u4fe1 + SASS \u6837\u5f0f</p> <p>\u540e\u7aef\uff1aActix-Web \u6846\u67b6 + Diesel/PostgreSQL \u6570\u636e\u5e93 + Redis \u6d88\u606f\u961f\u5217 + Quartus \u6784\u5efa + Kubernetes \u6784\u5efa\u5bb9\u5668\u7f16\u6392</p> <p>\u56fa\u4ef6\uff1aXilinx FPGA \u63a7\u5236 + Buildroot \u7cfb\u7edf + Linux \u5185\u6838</p>"},{"location":"2020/01/01/jielabs/#\u524d\u7aef","title":"\u524d\u7aef","text":"<p>\u524d\u7aef\u5927\u90e8\u5206\u90fd\u662f\u5218\u6653\u4e49\u540c\u5b66\u7f16\u5199\u7684\uff0c\u4e5f\u662f\u8fd9\u4e2a\u9879\u76ee\u5de5\u4f5c\u91cf\u6700\u5927\u7684\u4e00\u90e8\u5206\u3002\u9664\u4e86\u672c\u6587\uff0c\u8fd8\u53ef\u4ee5\u9605\u8bfb\u5218\u6653\u4e49\u540c\u5b66\u81ea\u5df1\u5199\u7684\u603b\u7ed3\u3002\u4e3b\u8981\u5206\u4ee5\u4e0b\u51e0\u90e8\u5206\u6765\u8c08\u524d\u7aef\u7684\u6280\u672f\u5b9e\u73b0\uff1a</p>"},{"location":"2020/01/01/jielabs/#\u7b2c\u4e09\u65b9\u5e93","title":"\u7b2c\u4e09\u65b9\u5e93","text":"<p>\u6574\u4f53\u4e0a\u91c7\u7528\u4e86\u65f6\u4e0b\u6bd4\u8f83\u6d41\u884c\u7684 React \u6846\u67b6\uff0c\u914d\u5408 Redux \u8fdb\u884c\u72b6\u6001\u7ba1\u7406\uff0c\u7528 React Hooks \u7f16\u5199\u7ec4\u4ef6\u7684\u903b\u8f91\u3002\u4e3a\u4e86\u5b9e\u73b0 VHDL/Verilog \u4ee3\u7801\u7684\u7f16\u8f91\uff0c\u91c7\u7528\u4e86\u6765\u81ea VSCode \u7684\u72ec\u7acb\u7f16\u8f91\u5668\u7a7a\u95f4 Monaco\uff0c\u5e76\u81ea\u884c\u7f16\u5199\u4e86 VHDL \u548c Verilog \u8bed\u8a00\u7684\u652f\u6301\uff0c\u4e00\u90e8\u5206\u5728 JS \u5b9e\u73b0\uff0c\u53e6\u4e00\u90e8\u5206\u5728 Rust \u4e2d\u5b9e\u73b0\uff0c\u901a\u8fc7 wasm-pack \u6253\u5305\u5230 JS \u4e2d\u6267\u884c\u3002\u53e6\u5916\u4e3a\u4e86\u5b9e\u73b0 gzip \u683c\u5f0f\u7684\u89e3\u538b\u7f29\u4e5f\u5f15\u5165\u4e86 pako \u5e93\u3002</p> <p>\u5728\u8fd9\u4e9b\u7b2c\u4e09\u65b9\u5e93\u91cc\uff0cMonaco \u7684\u4f53\u79ef\u6700\u5927\uff0c\u540e\u9762\u6211\u4eec\u9488\u5bf9 JS \u4f53\u79ef\u505a\u4e86\u8bb8\u591a\u4f18\u5316\uff0c\u5728\u4e0b\u9762\u4f1a\u518d\u63d0\u3002</p>"},{"location":"2020/01/01/jielabs/#rust-\u5728\u524d\u7aef\u7684\u5e94\u7528","title":"Rust \u5728\u524d\u7aef\u7684\u5e94\u7528","text":"<p>\u7531\u4e8e\u5f00\u53d1\u8005\u91cc\u5218\u6653\u4e49\u548c\u9648\u5609\u6770\u90fd\u662f Rust \u8bed\u8a00\u7684\u7231\u597d\u8005\uff0c\u8003\u8651\u5230\u76ee\u524d Rust to WASM \u7684\u6280\u672f\u6bd4\u8f83\u6210\u719f\uff0cWebAssembly \u7684\u53ef\u7528\u7a0b\u5ea6\u4e5f\u5f88\u9ad8\uff0c\u6211\u4eec\u628a\u4e00\u4e9b\u529f\u80fd\u632a\u5230\u4e86 Rust \u4e2d\u6267\u884c\uff1a</p> <p>\u4e00\u662f\u5e03\u7ebf\u7684\u8ba1\u7b97\u3002\u8fd9\u662f\u4e00\u4e2a\u6bd4\u8f83\u7eaf\u7cb9\u7684\u7b97\u6cd5\u95ee\u9898\uff0c\u4e00\u65b9\u9762\u5bf9\u6027\u80fd\u6709\u4e00\u5b9a\u7684\u8981\u6c42\uff0c\u4e00\u65b9\u9762\u5f00\u53d1\u8005\u6bd4\u8f83\u559c\u6b22 Rust\uff0c\u6240\u4ee5\u5c31\u7528 Rust \u5b9e\u73b0\u4e86\u3002\u8fd9\u91cc\u8981\u7279\u522b\u611f\u8c22\u5218\u5149\u54f2\u540c\u5b66\u5bf9\u5e03\u7ebf\u7b97\u6cd5\u7684\u6307\u70b9\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u7528 Rust \u5b9e\u73b0\u4e86\u51e0\u4e2a\u8bba\u6587\u4e2d\u7684\u5e03\u7ebf\u7b97\u6cd5\uff08Maze Router\uff09\uff0c\u5e76\u4e14\u901a\u8fc7\u548c JS \u4ee3\u7801\u7684\u914d\u5408\u5f97\u5230\u4e86\u4e00\u4e2a\u6bd4\u8f83\u4f18\u79c0\u7684\u6548\u679c\u3002</p> <p>\u4e8c\u662f VHDL/Verilog \u7684\u8bed\u8a00\u652f\u6301\u3002\u5b66\u8fc7\u7f16\u8bd1\u539f\u7406\u7684\u540c\u5b66\u5e94\u8be5\u77e5\u9053\uff0c\u5982\u679c\u8981\u5b9e\u73b0\u4e00\u4e2a\u80fd\u591f\u89e3\u6790\u4ee3\u7801\u91cc\u7684\u4fe1\u53f7\u7684\u7a0b\u5e8f\uff0c\u4e00\u822c\u662f\u4e0d\u80fd\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u89e3\u51b3\u7684\uff0c\u51b5\u4e14\u6211\u4eec\u8fd8\u5b9e\u73b0\u4e86\u4e00\u4e9b\u9519\u8bef\u4fe1\u606f\u7684\u663e\u793a\u3002VHDL \u8bed\u8a00\u652f\u6301\u91c7\u7528\u4e86\u5df2\u6709\u7684\u6bd4\u8f83\u5b8c\u5584\u7684\u5e93\uff0cVerilog \u7531\u4e8e\u73b0\u6709\u7684\u5e93\u90fd\u6bd4\u8f83\u5e9e\u5927\uff0c\u4e0d\u9002\u5408\u653e\u4e8e\u524d\u7aef\uff0c\u4e8e\u662f\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u6700\u5c0f\u7684 Verilog\uff08\u5b9e\u9645\u4e0a\u7b97\u662f SystemVerilog\uff09\u7684\u89e3\u6790\uff0c\u4ec5\u4ec5\u8db3\u591f\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u3002\u5982\u679c\u540c\u5b66\u4eec\u9047\u5230\u4e86\u4e00\u4e9b\u8bed\u6cd5\u4e0a\u529f\u80fd\u7684\u7f3a\u5c11\uff0c\u6b22\u8fce\u63d0\u51fa\u3002</p>"},{"location":"2020/01/01/jielabs/#canvas-\u7684\u5e94\u7528","title":"Canvas \u7684\u5e94\u7528","text":"<p>\u8fde\u7ebf\u90e8\u5206\u56e0\u4e3a\u662f\u52a8\u6001\u751f\u6210\u7684\uff0c\u6240\u4ee5\u4e5f\u662f\u52a8\u6001\u7ed8\u5236\u7684\uff0cCanvas \u5c31\u53ef\u4ee5\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\u6211\u4eec\u4e5f\u5229\u7528\u4e86 Canvas \u7684\u7279\u6027\uff0c\u9488\u5bf9\u6bcf\u4e00\u4e2a\u7f51\u7edc\u90fd\u753b\u5728\u4e00\u4e2a Canvas \u4e0a\uff0c\u90a3\u4e48\u5728\u68c0\u6d4b\u9f20\u6807\u4f4d\u7f6e\u7684\u65f6\u5019\uff0c\u53ea\u8981\u68c0\u67e5 Canvas \u5728\u9f20\u6807\u6240\u5728\u7684\u70b9\u4e0a\u662f\u5426\u989c\u8272\uff0c\u5c31\u77e5\u9053\u9f20\u6807\u662f\u5426\u5728\u5b83\u4e0a\u9762\u4e86\u3002</p>"},{"location":"2020/01/01/jielabs/#\u524d\u7aef\u52a0\u8f7d\u901f\u5ea6\u7684\u4f18\u5316","title":"\u524d\u7aef\u52a0\u8f7d\u901f\u5ea6\u7684\u4f18\u5316","text":"<p>\u4f18\u5316\u524d\u524d\u7aef JS \u548c WASM \u603b\u5927\u5c0f\u5927\u7ea6\u662f 4MB\uff0c\u5bf9\u4e8e\u7f51\u7edc\u4e0d\u597d\u7684\u7528\u6237\u6765\u8bf4\uff0c\u5b83\u7684\u52a0\u8f7d\u65f6\u95f4\u662f\u4e0d\u80fd\u5bb9\u5fcd\u7684\u3002\u4e8e\u662f\u6211\u4eec\u91c7\u7528\u4e86\u4ee5\u4e0b\u7684\u63aa\u65bd\uff1a</p> <ol> <li>\u6253\u5f00 gzip\uff1a\u6709\u5f88\u663e\u8457\u7684\u6548\u679c\uff0c\u4f46\u56e0\u4e3a\u4e00\u4e9b\u672a\u77e5\u7684\u539f\u56e0\uff0c\u5728\u5b9e\u9645\u90e8\u7f72\u7684\u65f6\u5019\u672a\u80fd\u6253\u5f00</li> <li>\u7f29\u5c0f JS \u4f53\u79ef\uff1a\u901a\u8fc7 Webpack Analyzer \u5206\u6790\u7a0b\u5e8f\u5404\u4e2a\u90e8\u5206\u7684\u5927\u5c0f\uff0c\u5220\u6389\u4e86 Monaco \u4e2d\u4e00\u4e9b\u6ca1\u6709\u7528\u5230\u7684\u529f\u80fd</li> <li>\u7f29\u5c0f WASM \u4f53\u79ef\uff1a\u6253\u5f00 LTO \u548c -Os \u9009\u9879</li> <li>\u4ee3\u7801\u5206\u5272\uff1a\u628a\u4e0d\u540c\u529f\u80fd\u7684\u4ee3\u7801\u5206\u5272\u5f00\uff0c\u5148\u8ba9\u4e00\u90e8\u5206\u4ee3\u7801\u52a0\u8f7d\u8fdb\u6765\uff0c\u53ef\u4ee5\u7ed8\u5236\u4e00\u4e2a\u90e8\u5206\u529f\u80fd\u7684\u754c\u9762\uff0c\u7136\u540e\u518d\u7ee7\u7eed\u52a0\u8f7d\u5269\u4e0b\u7684\u7ec4\u4ef6</li> <li>CDN\uff1a\u628a\u4e00\u90e8\u5206\u5916\u90e8\u7684\u4f9d\u8d56\u653e\u5230\u56fd\u5185\uff0c\u540e\u7eed\u5982\u679c\u6709\u9700\u6c42\u7684\u8bdd\u4e5f\u53ef\u4ee5\u628a\u5185\u90e8\u7684\u4f9d\u8d56\u4e5f\u653e\u5230\u56fd\u5185\u7684 CDN \u4e0a</li> </ol>"},{"location":"2020/01/01/jielabs/#\u540e\u7aef","title":"\u540e\u7aef","text":"<p>\u540e\u7aef\u7528 Rust \u8bed\u8a00\u7f16\u5199\uff0c\u91c7\u7528\u4e86\u76ee\u524d\u6bd4\u8f83\u6210\u719f\u7684 actix-web \u6846\u67b6\uff0c\u5927\u91cf\u4f7f\u7528\u4e86 async/await\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u7528 Redis \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\uff0c\u5728 Docker \u5bb9\u5668\u4e2d\u8fd0\u884c Quartus\uff0c\u7528 Kubernetes \u8fdb\u884c\u5bb9\u5668\u7684\u52a8\u6001\u8c03\u5ea6\u3002</p>"},{"location":"2020/01/01/jielabs/#\u4efb\u52a1\u8c03\u5ea6","title":"\u4efb\u52a1\u8c03\u5ea6","text":"<p>\u5bf9\u4e8e\u7528\u6237\u63d0\u4ea4\u7684\u4ee3\u7801\u548c\u7ea6\u675f\uff0c\u540e\u7aef\u9700\u8981\u8fdb\u884c\u4efb\u52a1\u7684\u8c03\u5ea6\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u4efb\u52a1\uff0c\u653e\u5165\u5230 Redis \u6d88\u606f\u961f\u5217\u4e2d\u3002\u53e6\u4e00\u65b9\u9762\uff0cDocker \u4e2d\u8fd0\u884c\u7684 python \u811a\u672c\u4f1a\u4ece Redis \u4e2d\u53d6\u4efb\u52a1\uff0c\u4efb\u52a1\u5b8c\u6210\u540e\u628a\u7ed3\u679c\u4e0a\u4f20\u5e76\u56de\u4f20\u7ed9\u540e\u7aef\u8868\u793a\u786e\u8ba4\u3002\u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u4e00\u76f4\u6ca1\u6709\u5b8c\u6210\uff0c\u540e\u7aef\u4f1a\u8fdb\u884c\u56de\u6536\u5e76\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u4efb\u52a1\u5230\u961f\u5217\u4e2d\u3002\u4e3a\u4e86\u9632\u6b62\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u91cd\u590d\u4efb\u52a1\u7684\u63d0\u4ea4\uff0c\u4e3a\u6bcf\u4e2a\u63d0\u4ea4\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u8db3\u591f\u957f\u7684\u968f\u673a ID\u3002Docker \u5bb9\u5668\u4e00\u5f00\u59cb\u662f\u901a\u8fc7 docker-compose \u8fdb\u884c\u914d\u7f6e\uff0c\u540e\u6765\u8003\u8651\u5230\u8fd9\u4e2a\u573a\u666f\u6bd4\u8f83\u9002\u5408 kubernetes\uff0c\u4e8e\u662f\u4f7f\u7528\u4e86\u4e00\u4e0b\uff0c\u8fd8\u633a\u597d\u7528\u7684\u3002\u4e00\u5f00\u59cb\u7528\u7684\u662f minikube\uff0c\u642d\u597d docker registry\uff0c\u7136\u540e\u5f80\u91cc\u9762\u90e8\u7f72\u51e0\u4e2a pod \u5e76\u8bbe\u7f6e hpa\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u7684\u53e6\u4e00\u7bc7\u535a\u5ba2\uff0c\u540e\u6765\u8fc1\u79fb\u5230\u4e86 kubeadm \u76f4\u63a5\u914d\u7f6e\u3002\u73b0\u5728\u8fc1\u79fb\u5230\u4e86\u4e00\u4e2a k3s \u642d\u5efa\u7684 k8s \u96c6\u7fa4\u4e0a\u3002</p>"},{"location":"2020/01/01/jielabs/#\u677f\u5b50\u901a\u4fe1","title":"\u677f\u5b50\u901a\u4fe1","text":"<p>\u7b2c\u4e8c\u4e2a\u4e3b\u8981\u529f\u80fd\u662f\u8fdb\u884c\u677f\u5b50\u7684\u5206\u914d\u548c\u901a\u4fe1\u3002\u6bcf\u4e2a\u7528\u6237\u4f1a\u521b\u5efa\u4e00\u4e2a WebSocket \u8fde\u63a5\u5230\u540e\u7aef\uff0c\u6bcf\u4e2a\u677f\u5b50\u4e5f\u662f\u4e00\u4e2a WebSocket\u3002\u5f53\u4e00\u4e2a\u7528\u6237\u5206\u914d\u5230\u4e00\u4e2a\u677f\u5b50\u7684\u65f6\u5019\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u540e\u7aef\u53d1\u9001\u547d\u4ee4\u7ed9\u5bf9\u5e94\u7684\u677f\u5b50\uff0c\u677f\u5b50\u7684\u56de\u590d\u4e5f\u4f1a\u539f\u8def\u8fd4\u56de\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a WebSocket Proxy\u3002\u53e6\u5916\u4e3a\u4e86\u4fdd\u8bc1\u8d44\u6e90\u7684\u5229\u7528\u7387\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e9b\u9650\u5236\u3001\u5fc3\u8df3\u5305\u548c\u8ba4\u8bc1\u3002</p>"},{"location":"2020/01/01/jielabs/#\u72b6\u6001\u76d1\u63a7","title":"\u72b6\u6001\u76d1\u63a7","text":"<p>\u4e3a\u4e86\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u5230\u5404\u4e2a\u6570\u636e\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u76d1\u63a7\u63a5\u53e3\uff0c\u63a5\u5165 Telegraf+InfluxDB+Grafana \u7684\u76d1\u63a7\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5b9e\u65f6\u770b\u5230\u5404\u4e2a\u8d44\u6e90\u7684\u60c5\u51b5\uff0c\u5982\u7528\u6237\u3001\u677f\u5b50\u548c\u4efb\u52a1\u7b49\u7b49\uff0c\u4e5f\u65b9\u4fbf\u6211\u4eec\u5728\u5728\u7ebf\u7528\u6237\u6bd4\u8f83\u5c11\u7684\u65f6\u5019\u8fdb\u884c\u66f4\u65b0\u3002</p>"},{"location":"2020/01/01/jielabs/#\u677f\u5b50","title":"\u677f\u5b50","text":"<p>\u8fd9\u4e2a\u5e73\u53f0\u867d\u7136\u662f\u7528\u4e8e\u6570\u5b57\u903b\u8f91\u5b9e\u9a8c\u8bfe\u7a0b\uff0c\u4f46\u5b9e\u9645\u7528\u7684\u677f\u5b50\u6765\u81ea\u6570\u5b57\u903b\u8f91\u8bbe\u8ba1\u8bfe\u7a0b\u3002\u6211\u4eec\u628a\u5176\u4e0a\u4e00\u4e2a Altera FPGA \u4f5c\u4e3a\u5b9e\u9a8c FPGA\uff0c\u5728\u63a7\u5236\u7684 Xilinx FPGA \u4e0a\u8fd0\u884c\u6211\u4eec\u7684\u56fa\u4ef6\uff0c\u8d1f\u8d23\u8bfb\u53d6\u548c\u5199\u5165 GPIO\u3001\u4e0b\u8f7d bitstream \u7b49\u7b49\u529f\u80fd\u3002</p>"},{"location":"crypto/2020/05/21/ecc-curves/","title":"\u5404\u79cd ecc \u66f2\u7ebf","text":"","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#\u80cc\u666f\u77e5\u8bc6","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>\u692d\u5706\u66f2\u7ebf\u6709\u5982\u4e0b\u7684\u5f62\u5f0f\uff1a</p> <p>\u7b2c\u4e00\u79cd\uff1a</p> \\[E: y^2 \\equiv x^3 + ax + b \\mod{p}\\] <p>\u66f2\u7ebf\u7684\u53c2\u6570\u5171\u6709 \\((p, a, b, G, n, h)\\)\u3002\\(G\\) \u662f\u4e00\u4e2a\u70b9 \\((G_x, G_y)\\)\uff0c\\(n\\) \u662f \\(G\\) \u7684\u9636\u3002</p> <p>\u7b2c\u4e8c\u79cd\uff1a</p> \\[E: y^2+xy=x^3+ax^2+1\\] <p>\u79f0\u4e3a Kbolitz curve\u3002\u4e0d\u540c\u7684\u66f2\u7ebf\u6709\u4e0d\u540c\u7684\u53c2\u6570 \\((m,f(x),a,b,G,n,h)\\)\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684 \\(GF(2^m)\\) \u57df\u3002</p>","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#openssl","title":"OpenSSL","text":"<p>\u770b\u4e00\u4e0b openssl \u652f\u6301\u7684\u66f2\u7ebf\u53c2\u6570\uff08<code>openssl ecparam -list_curves</code>\uff09\uff1a</p> <pre><code>  secp112r1 : SECG/WTLS curve over a 112 bit prime field\n  secp112r2 : SECG curve over a 112 bit prime field\n  secp128r1 : SECG curve over a 128 bit prime field\n  secp128r2 : SECG curve over a 128 bit prime field\n  secp160k1 : SECG curve over a 160 bit prime field\n  secp160r1 : SECG curve over a 160 bit prime field\n  secp160r2 : SECG/WTLS curve over a 160 bit prime field\n  secp192k1 : SECG curve over a 192 bit prime field\n  secp224k1 : SECG curve over a 224 bit prime field\n  secp224r1 : NIST/SECG curve over a 224 bit prime field\n  secp256k1 : SECG curve over a 256 bit prime field\n  secp384r1 : NIST/SECG curve over a 384 bit prime field\n  secp521r1 : NIST/SECG curve over a 521 bit prime field\n  prime192v1: NIST/X9.62/SECG curve over a 192 bit prime field\n  prime192v2: X9.62 curve over a 192 bit prime field\n  prime192v3: X9.62 curve over a 192 bit prime field\n  prime239v1: X9.62 curve over a 239 bit prime field\n  prime239v2: X9.62 curve over a 239 bit prime field\n  prime239v3: X9.62 curve over a 239 bit prime field\n  prime256v1: X9.62/SECG curve over a 256 bit prime field\n  sect113r1 : SECG curve over a 113 bit binary field\n  sect113r2 : SECG curve over a 113 bit binary field\n  sect131r1 : SECG/WTLS curve over a 131 bit binary field\n  sect131r2 : SECG curve over a 131 bit binary field\n  sect163k1 : NIST/SECG/WTLS curve over a 163 bit binary field\n  sect163r1 : SECG curve over a 163 bit binary field\n  sect163r2 : NIST/SECG curve over a 163 bit binary field\n  sect193r1 : SECG curve over a 193 bit binary field\n  sect193r2 : SECG curve over a 193 bit binary field\n  sect233k1 : NIST/SECG/WTLS curve over a 233 bit binary field\n  sect233r1 : NIST/SECG/WTLS curve over a 233 bit binary field\n  sect239k1 : SECG curve over a 239 bit binary field\n  sect283k1 : NIST/SECG curve over a 283 bit binary field\n  sect283r1 : NIST/SECG curve over a 283 bit binary field\n  sect409k1 : NIST/SECG curve over a 409 bit binary field\n  sect409r1 : NIST/SECG curve over a 409 bit binary field\n  sect571k1 : NIST/SECG curve over a 571 bit binary field\n  sect571r1 : NIST/SECG curve over a 571 bit binary field\n  c2pnb163v1: X9.62 curve over a 163 bit binary field\n  c2pnb163v2: X9.62 curve over a 163 bit binary field\n  c2pnb163v3: X9.62 curve over a 163 bit binary field\n  c2pnb176v1: X9.62 curve over a 176 bit binary field\n  c2tnb191v1: X9.62 curve over a 191 bit binary field\n  c2tnb191v2: X9.62 curve over a 191 bit binary field\n  c2tnb191v3: X9.62 curve over a 191 bit binary field\n  c2pnb208w1: X9.62 curve over a 208 bit binary field\n  c2tnb239v1: X9.62 curve over a 239 bit binary field\n  c2tnb239v2: X9.62 curve over a 239 bit binary field\n  c2tnb239v3: X9.62 curve over a 239 bit binary field\n  c2pnb272w1: X9.62 curve over a 272 bit binary field\n  c2pnb304w1: X9.62 curve over a 304 bit binary field\n  c2tnb359v1: X9.62 curve over a 359 bit binary field\n  c2pnb368w1: X9.62 curve over a 368 bit binary field\n  c2tnb431r1: X9.62 curve over a 431 bit binary field\n  wap-wsg-idm-ecid-wtls1: WTLS curve over a 113 bit binary field\n  wap-wsg-idm-ecid-wtls3: NIST/SECG/WTLS curve over a 163 bit binary field\n  wap-wsg-idm-ecid-wtls4: SECG curve over a 113 bit binary field\n  wap-wsg-idm-ecid-wtls5: X9.62 curve over a 163 bit binary field\n  wap-wsg-idm-ecid-wtls6: SECG/WTLS curve over a 112 bit prime field\n  wap-wsg-idm-ecid-wtls7: SECG/WTLS curve over a 160 bit prime field\n  wap-wsg-idm-ecid-wtls8: WTLS curve over a 112 bit prime field\n  wap-wsg-idm-ecid-wtls9: WTLS curve over a 160 bit prime field\n  wap-wsg-idm-ecid-wtls10: NIST/SECG/WTLS curve over a 233 bit binary field\n  wap-wsg-idm-ecid-wtls11: NIST/SECG/WTLS curve over a 233 bit binary field\n  wap-wsg-idm-ecid-wtls12: WTLS curve over a 224 bit prime field\n  Oakley-EC2N-3: \n    IPSec/IKE/Oakley curve #3 over a 155 bit binary field.\n    Not suitable for ECDSA.\n    Questionable extension field!\n  Oakley-EC2N-4: \n    IPSec/IKE/Oakley curve #4 over a 185 bit binary field.\n    Not suitable for ECDSA.\n    Questionable extension field!\n  brainpoolP160r1: RFC 5639 curve over a 160 bit prime field\n  brainpoolP160t1: RFC 5639 curve over a 160 bit prime field\n  brainpoolP192r1: RFC 5639 curve over a 192 bit prime field\n  brainpoolP192t1: RFC 5639 curve over a 192 bit prime field\n  brainpoolP224r1: RFC 5639 curve over a 224 bit prime field\n  brainpoolP224t1: RFC 5639 curve over a 224 bit prime field\n  brainpoolP256r1: RFC 5639 curve over a 256 bit prime field\n  brainpoolP256t1: RFC 5639 curve over a 256 bit prime field\n  brainpoolP320r1: RFC 5639 curve over a 320 bit prime field\n  brainpoolP320t1: RFC 5639 curve over a 320 bit prime field\n  brainpoolP384r1: RFC 5639 curve over a 384 bit prime field\n  brainpoolP384t1: RFC 5639 curve over a 384 bit prime field\n  brainpoolP512r1: RFC 5639 curve over a 512 bit prime field\n  brainpoolP512t1: RFC 5639 curve over a 512 bit prime field\n  SM2       : SM2 curve over a 256 bit prime field\n</code></pre> <p>\u8fd9\u4e2a\u5217\u8868\u5f88\u957f\uff0c\u4e3b\u8981\u6709\u51e0\u4e2a\u53c2\u6570\uff1a</p> <ol> <li>\u4ec0\u4e48\u57df\uff1a\u7d20\u6570\u57df\u8fd8\u662f \\(GF(2^m)\\) \u57df</li> <li>\u4f4d\u6570\uff1a\u57df\u6709\u591a\u5c11\u4f4d</li> <li>\u6807\u51c6\uff1aNIST/SECG/WTLS/X9.62/RFC 5639/SM2/Oakley \u8868\u793a\u7684\u662f\u4e0d\u540c\u7684\u6807\u51c6</li> </ol>","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#nist","title":"NIST","text":"<p>NIST \u5728 FIPS 186-4 \u4e2d\u5b9a\u4e49\u4e86\u57fa\u4e8e\u7d20\u6570\u57df\u7684 Curve P-192, Curve P-224, Curve P-256, Curve P-384 \u548c Curve P-521\u3002\u5728 RFC5656 \u4e2d\uff0c\u8fd9\u51e0\u6761\u66f2\u7ebf\u53c8\u540d nistp192 nistp224 nistp256 nistp384 \u548c nistp521\u3002</p> <p>Curve P-192: </p> \\[p = 2^{192}-2^{64}-1\\] <p>Curve P-224: </p> \\[p=2^{224}-2^{96}-1\\] <p>Curve P-256: </p> \\[p=2^{256}-2^{224}+2^{192}+2^{96}-1\\] <p>Curve P-384: </p> \\[p=2^{384}-2^{128}-2^{96}+2^{32}-1\\] <p>Curve P-521: </p> \\[p=2^{521}-1\\] <p>\u53e6\u4e00\u7c7b\u662f\u57fa\u4e8e Binary Field\uff08\\(GF(2^m)\\)\uff09\u7684\u66f2\u7ebf\uff0c\u6709 Curve K-163\uff0cCurve B-163\uff0cCurve K-233\uff0cCurve B-233\uff0cCurve K-283\uff0cCurve B-283\uff0cCurve K-409\uff0cCurve B-409\uff0cCurve K-571\uff0cCurve B-571\u3002\u76f8\u5e94\u5730\uff0cRFC 5656 \u91cc\u53c8\u540d nistk163\uff0cnistk233\uff0cnistb233\uff0cnistk283\uff0cnistk409\uff0cnistb409\uff0cnistt571\uff08\u6211\u89c9\u5f97\u662f nistb571/nistk571\uff0c\u4e0d\u77e5\u9053\u662f\u4e0d\u662f\u5199\u9519\u4e86\uff09</p> <p>Degree 163 (K-163/B-163) :</p> \\[p(t)=t^{163}+t^7+t^6+t^3+1\\] <p>Degree 233 (K-233/B-233) :</p> \\[p(t)=t^{233}+t^{74}+1\\] <p>Degree 283 (K-283/B-283) :</p> \\[p(t)=t^{283}+t^{12}+t^7+t^5+1\\] <p>Degree 409 (K-409/B-409) :</p> \\[p(t)=t^{409}+t^{87}+1\\] <p>Degree 571 (K-571/B-571) :</p> \\[p(t)=t^{571}+t^{10}+t^5+t^2+1\\]","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#secg","title":"SECG","text":"<p>SECG \u5728 SEC2 \u4e2d\u5b9a\u4e49\u4e86\u82e5\u5e72\u7684\u66f2\u7ebf\uff0c\u5176\u4e2d\u4e00\u90e8\u5206\u548c\u4e0a\u9762\u7684 NIST \u662f\u540c\u4e00\u4e2a\u66f2\u7ebf\u3002\u9996\u5148\u662f\u57fa\u4e8e\u7d20\u6570\u57df\u7684\uff1a</p> NIST SEC OID ANSI nistp192 secp192r1 1.2.840.10045.3.1.1 prime192v1 secp192k1 1.3.132.0.31 nistp224 secp224r1 1.3.132.0.33 secp224k1 1.3.132.0.32 nistp256 secp256r1 1.2.840.10045.3.1.7 prime256v1 secp256k1 1.3.132.0.10 nistp384 secp384r1 1.3.132.0.34 secp384k1 nistp521 secp521r1 1.3.132.0.35 secp521k1 <p>\u7136\u540e\u662f\u57fa\u4e8e \\(GF(2^m)\\) \u57df\u7684\uff1a</p> NIST SEC OID nistk163 sect163k1 1.3.132.0.1 sect163r1 1.3.132.0.2 nistb163 sect163r2 1.3.132.0.15 nistk233 sect233k1 1.3.132.0.26 nistb233 sect233r1 1.3.132.0.27 sect239k1 1.3.132.0.3 nistk283 sect283k1 1.3.132.0.16 nistb283 sect283r1 1.3.132.0.17 nistk409 sect409k1 1.3.132.0.36 nistb409 sect409r1 1.3.132.0.37 nistk571 (RFC 5656 \u5199\u7684\u662f nistt571) sect571k1 1.3.132.0.38 nistb571 sect571r1 1.3.132.0.39 <p>sec \u547d\u540d\u91cc\uff0c\u7b2c\u56db\u4e2a\u5b57\u7b26\u91cc \\(p\\) \u8868\u793a\u662f\u7d20\u6570\u57df\uff0c\\(t\\) \u8868\u793a\u662f \\(GF(2^m)\\) \u57df\u3002\u540e\u9762\u7684\u5b57\u6bcd\u8868\u793a\u7684 \\(k\\) \u8868\u793a Koblitz\uff0c\\(r\\) \u8868\u793a random\uff0c\u662f\u53c2\u6570\u7684\u9009\u53d6\u65b9\u5f0f\u3002</p> <p>OID \u6709\u4e24\u79cd\u524d\u7f00\uff1a</p> <pre><code>1.3.132.0.x:\niso(1) identified-organization(3) certicom(132) curve(0)\n1.2.840.10045.3.1.x:\niso(1) member-body(2) us(840) 10045 curves(3) prime(1)\n</code></pre> <p>\u5b8c\u6574\u5217\u8868\u89c1 OID 1.3.132.0 \u548c OID 1.2.840.10045.3.1</p>","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#ansi","title":"ANSI","text":"<p>ANSI \u4e5f\u6709 X9.62 \u6807\u51c6\uff0c\u5728\u9644\u5f55\u91cc\u9762\u4e5f\u5b9a\u4e49\u4e86\u82e5\u5e72\u4e2a\u66f2\u7ebf\u3002\u9644\u5f55 <code>J.5.1</code> \u91cc\u9762\u6709\u4e09\u4e2a\u4f8b\u5b50\uff0c\u5c31\u662f prime192v1 prime192v2 \u548c prime192v3\uff0c\u4e4b\u540e\u5219\u662f prime239v1 prime239v2 prime239v3 \u548c prime256v1\u3002</p> ANSI \u522b\u540d OID prime192v1 nistp192/secp192r1 1.2.840.10045.3.1.1 prime192v2 1.2.840.10045.3.1.2 prime192v3 1.2.840.10045.3.1.3 prime239v1 1.2.840.10045.3.1.4 prime239v2 1.2.840.10045.3.1.5 prime239v3 1.2.840.10045.3.1.6 prime256v1 nistp256/secp256r1 1.2.840.10045.3.1.7","tags":["ecc","crypto"]},{"location":"crypto/2020/05/21/ecc-curves/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u5bf9\u4e8e\u540c\u4e00\u4e2a\u66f2\u7ebf\uff0c\u4e0d\u540c\u7684\u7ec4\u7ec7\u7ed9\u51fa\u4e86\u4e0d\u540c\u7684\u540d\u5b57\uff0c\u89c1\u4e0b\u8868\uff1a</p> OpenSSL NIST SECG ANSI prime192v1 nistp192 secp192r1 prime192v1 secp224r1 nistp224 secp224r1 prime256v1 nistp256 secp256r1 prime256v1 secp384r1 nistp384 secp384r1 secp521r1 nistp521 secp521r1 sect163k1 nistk163 sect163k1 sect163r2 nistb163 sect163r2 sect233k1 nistk233 sect233k1 sect233r1 nistb233 sect233r1 sect283k1 nistk233 sect283k1 sect283r1 nistb283 sect283r1 sect409k1 nistk409 sect409k1 sect409r1 nistb409 sect409r1 sect571k1 nistk571 sect571k1 sect571r1 nistb571 sect571r1 <p>\u5728 RFC4492 \u91cc\u4e5f\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u7c7b\u4f3c\u7684\u8868\u3002</p>","tags":["ecc","crypto"]},{"location":"crypto/2023/07/14/ecdsa/","title":"ECDSA","text":"<p>ECDSA \u662f\u4e00\u4e2a\u57fa\u4e8e\u692d\u5706\u66f2\u7ebf\u7684\u7b7e\u540d\u7b97\u6cd5\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u786e\u5b9a\u4e00\u4e2a\u692d\u5706\u66f2\u7ebf\uff0c\u4ee5\u53ca\u5b83\u7684 base point \\(G\\)\uff0c\u4e14 \\(G\\) \u7684\u9636\u662f\u7d20\u6570 \\(n\\)\u3002ECDSA \u652f\u6301\u5982\u4e0b\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>\u751f\u6210\u7b7e\u540d</li> <li>\u9a8c\u8bc1\u7b7e\u540d</li> <li>\u4ece\u7b7e\u540d\u548c\u660e\u6587\u63a8\u5bfc\u51fa\u516c\u94a5</li> </ol> <p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p> <p>\u672c\u6587\u53c2\u8003\u4e86 ECDSA - Wikipedia\u3002</p>","tags":["ecdsa","ecc","crypto"]},{"location":"crypto/2023/07/14/ecdsa/#\u751f\u6210-key-pair","title":"\u751f\u6210 key pair","text":"<p>\u751f\u6210 key pair \u7684\u65f6\u5019\uff0c\u79c1\u94a5\u662f\u6574\u6570 \\(d_A \\in [1, n-1]\\)\uff0c\u90a3\u4e48\u516c\u94a5\u5c31\u662f\u5706\u9525\u66f2\u7ebf\u4e0a\u4e00\u70b9 \\(Q_A = d_A \\times G\\)\uff0c\u8fd9\u91cc \\(\\times\\) \u8868\u793a\u6574\u6570\u4e0e\u5706\u9525\u66f2\u7ebf\u4e0a\u4e00\u70b9\u7684\u4e58\u6cd5\u3002</p>","tags":["ecdsa","ecc","crypto"]},{"location":"crypto/2023/07/14/ecdsa/#\u7b7e\u540d","title":"\u7b7e\u540d","text":"<p>\u7b7e\u540d\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u6d88\u606f \\(m\\)\uff0c\u7b7e\u540d\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u8ba1\u7b97\u54c8\u5e0c\uff1a\\(e = \\mathrm{HASH}(m)\\)\uff0c\u4f8b\u5982\u7528 SHA \u7cfb\u5217\u7684\u54c8\u5e0c\u7b97\u6cd5</li> <li>\u8003\u8651\u5230 \\(e\\) \u7684\u4f4d\u6570\u53ef\u80fd\u6bd4 \\(n\\) \u7684\u4f4d\u6570\u66f4\u591a\uff0c\u53d6 \\(e\\) \u7684\u9ad8\u4f4d\uff0c\u4f7f\u5f97\u4f4d\u6570\u548c \\(n\\) \u4e00\u81f4\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u8bb0\u4e3a \\(z\\)</li> <li>\u751f\u6210\u4e00\u4e2a\u5bc6\u7801\u5b66\u5b89\u5168\u7684\u968f\u673a\u6570 \\(k \\in [1, n-1]\\)</li> <li>\u8ba1\u7b97 \\(k \\times G\\)\uff0c\u53d6\u5b83\u7684 X \u5750\u6807\u4e3a \\(x_1\\)</li> <li>\u8ba1\u7b97 \\(r = x_1 \\bmod n\\)</li> <li>\u8ba1\u7b97 \\(s = k^{-1}(z + r d_A) \\bmod n\\)</li> <li>\u5982\u679c \\(r\\) \u6216\u8005 \\(s\\) \u7b49\u4e8e 0\uff0c\u53d6\u65b0\u7684 \\(k\\) \u518d\u91cd\u8bd5</li> <li>\u5f97\u5230\u7684 ECDSA \u7b7e\u540d\u5c31\u662f \\((r, s)\\) \u4e24\u4e2a\u6570</li> </ol>","tags":["ecdsa","ecc","crypto"]},{"location":"crypto/2023/07/14/ecdsa/#\u9a8c\u8bc1","title":"\u9a8c\u8bc1","text":"<p>\u9a8c\u8bc1\u7b7e\u540d\u7684\u65f6\u5019\uff0c\u5df2\u77e5 \\(r, s, m, Q_A\\)\uff0c\u6309\u7167\u4e0b\u9762\u7684\u6d41\u7a0b\u8fdb\u884c\uff1a</p> <ol> <li>\u524d\u4e24\u6b65\u548c\u8ba1\u7b97\u7b7e\u540d\u7684\u7b97\u6cd5\u4e00\u81f4\uff0c\u6c42\u54c8\u5e0c\u548c\u622a\u65ad\u540e\u5f97\u5230 \\(z\\)</li> <li>\u8ba1\u7b97 \\(u_1 = zs^{-1} \\bmod n, u_2 = rs^{-1} \\bmod n\\)</li> <li>\u8ba1\u7b97 \\(u_1 \\times G + u_2 \\times Q_A\\)\uff0c\u53d6\u5b83\u7684 X \u5750\u6807\u4e3a \\(x_2\\)</li> <li>\u5982\u679c \\(r \\equiv x_2 \\pmod n\\)\uff0c\u5219\u7b7e\u540d\u5408\u6cd5</li> </ol> <p>\u4e0a\u9762\u7684\u8fc7\u7a0b\u5ffd\u7565\u4e86\u4e00\u4e9b\u8fb9\u754c\u60c5\u51b5\u7684\u68c0\u67e5\uff0c\u8be6\u7ec6\u7248\u672c\u89c1 Wikipedia\u3002</p> <p>\u4e0b\u9762\u8fdb\u884c\u9a8c\u7b97\uff1a</p> \\[\\begin{align} &amp; u_1 \\times G + u_2 \\times Q_A \\\\\\ &amp;= zs^{-1} \\times G + rs^{-1} \\times Q_A \\\\\\ &amp;= zs^{-1} \\times G + rs^{-1}d_A \\times G \\\\\\ &amp;= (zs^{-1} + rs^{-1}d_A) \\times G \\\\\\ &amp;= (z+rd_A)s^{-1} \\times G \\\\\\ &amp;= (z+rd_A)k(z+rd_A)^{-1} \\times G \\\\\\ &amp;= k \\times G \\end{align}\\] <p>\u7b49\u5f0f\u5de6\u8fb9\u7684 X \u5750\u6807\u7b49\u4e8e\u7b49\u5f0f\u53f3\u8fb9\u7684 X \u5750\u6807\uff0c\u7b49\u4ef7\u4e8e \\(r \\equiv x_2 \\pmod n\\)\uff0c\u9a8c\u7b97\u6ca1\u95ee\u9898\u3002</p>","tags":["ecdsa","ecc","crypto"]},{"location":"crypto/2023/07/14/ecdsa/#\u516c\u94a5\u6062\u590d","title":"\u516c\u94a5\u6062\u590d","text":"<p>ECDSA \u652f\u6301\u516c\u94a5\u6062\u590d\u7b97\u6cd5\uff0c\u5df2\u77e5 \\(r, s, m\\)\uff0c\u6062\u590d \\(Q_A\\)\u3002\u9996\u5148\u8fdb\u884c\u63a8\u5bfc\uff1a</p> \\[\\begin{align} Q_A &amp;= d_A \\times G \\\\\\ s &amp;= k^{-1}(z + rd_A) \\bmod n \\\\\\ sk &amp;= z + rd_A \\bmod n \\\\\\ sk \\times G &amp;= (z + rd_A) \\times G \\\\\\ rd_A \\times G &amp;= (sk - z) \\times G \\\\\\ Q_A &amp;= d_A \\times G = r^{-1}(sk-z) \\times G \\\\\\ Q_A &amp;= r^{-1}(s(k \\times G) - z \\times G) \\end{align}\\] <p>\u4e0a\u5f0f\u4e2d \\(r, s\\) \u5df2\u77e5\uff0c\\(z\\) \u53ef\u4ee5\u4ece \\(m\\) \u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u5f97\u51fa\uff0c\\(k \\times G\\) \u7684 X \u5750\u6807 \\(x_1\\) \u6ee1\u8db3 \\(r = x_1 \\bmod n\\)\uff0c\u56e0\u6b64\u6062\u590d\u8fc7\u7a0b\u5c31\u662f\uff1a</p> <ol> <li>\u5728\u692d\u5706\u66f2\u7ebf\u4e0a\u627e\u5230 X \u5750\u6807\u6a21 \\(n\\) \u7b49\u4e8e \\(r\\) \u7684\u70b9\uff0c\u8fd9\u4e2a\u70b9\u5c31\u662f \\(k \\times G\\)</li> <li>\u6309\u7167\u8ba1\u7b97\u54c8\u5e0c\u7684\u524d\u4e24\u6b65\uff0c\u4ece \\(m\\) \u8ba1\u7b97\u51fa \\(z\\)</li> <li>\u6309\u7167\u4e0a\u8ff0\u516c\u5f0f\uff0c\u8ba1\u7b97\u51fa \\(Q_A\\)</li> </ol> <p>\u4f46\u662f\u5b9e\u9645\u4e0a\u7b2c\u4e00\u6b65\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355\uff1a\u9996\u5148\u540c\u4e00\u4e2a X \u5750\u6807\u5bf9\u5e94\u692d\u5706\u66f2\u7ebf\u4e0a\u7684\u4e24\u4e2a\u70b9\uff0c\u5176\u6b21 \\(r\\) \u548c \\(x_1\\) \u53ea\u662f\u540c\u4f59\u5173\u7cfb\uff0c\u53ef\u80fd\u4e8c\u8005\u4e4b\u95f4\u5dee\u4e86\u4e00\u4e2a\u500d\u6570\u3002\u56e0\u6b64\u5b9e\u9645\u5728 BTC \u6216\u8005 ETH \u91cc\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u8fd8\u989d\u5916\u9644\u52a0\u4e86\u4e00\u4e2a\u53c2\u6570 recid\uff0c\u8303\u56f4\u662f 0 \u5230 3\uff0c\u5bf9\u5e94 Y \u5750\u6807\u662f\u6b63\u8fd8\u662f\u8d1f\uff0c\\(r\\) \u548c \\(x_1\\) \u4e4b\u95f4\u5dee 0 \u8fd8\u662f \\(n\\)\uff1a</p> <pre><code>// Source: https://github.com/ethereum/go-ethereum/blob/e1fe6bc8469c626afaa86b1dfb819737e980a574/crypto/secp256k1/libsecp256k1/src/modules/recovery/main_impl.h#L104-L112\nif (recid &amp; 2) {\n    if (secp256k1_fe_cmp_var(&amp;fx, &amp;secp256k1_ecdsa_const_p_minus_order) &gt;= 0) {\n        return 0;\n    }\n    secp256k1_fe_add(&amp;fx, &amp;secp256k1_ecdsa_const_order_as_fe);\n}\nif (!secp256k1_ge_set_xo_var(&amp;x, &amp;fx, recid &amp; 1)) {\n    return 0;\n}\n</code></pre> <p>\u53c2\u8003\uff1aCrypto Magic: Recovering Alice\u2019s Public Key From An ECDSA Signature \u548c Can We Recover The Public Key from an ECDSA Signature?</p>","tags":["ecdsa","ecc","crypto"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/","title":"Montgomery \u6a21\u4e58","text":"","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u5bc6\u7801\u5b66\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u6d89\u53ca\u5230\u6a21\u4e58\u64cd\u4f5c\uff1a\\(a * b \\bmod N\\)\u3002\u6734\u7d20\u7684\u5b9e\u73b0\u65b9\u6cd5\u662f\uff0c\u5148\u6c42\u51fa \\(a * b\\)\uff0c\u518d\u5bf9 N \u8fdb\u884c\u9664\u6cd5\uff0c\u90a3\u4e48\u4f59\u6570\u5c31\u662f\u6a21\u4e58\u7684\u7ed3\u679c\u3002</p> <p>\u4f46\u7531\u4e8e\u6b64\u65f6\u7684 \\(a\\) \\(b\\) \\(N\\) \u4e09\u4e2a\u6570\u90fd\u5f88\u5927\uff0c\u5728\u8ba1\u7b97\u673a\u4e0a\u9700\u8981\u7528\u5927\u6574\u6570\u6765\u8868\u793a\uff0c\u800c\u5927\u6574\u6570\u7684\u4e58\u6cd5\u548c\u9664\u6cd5\u90fd\u662f\u9700\u8981\u8017\u6bd4\u8f83\u591a\u7684\u65f6\u95f4\u7684\u3002\u5982\u679c\u7528 Sch\u00f6nhage\u2013Strassen \u7b97\u6cd5\uff0c\u8ba1\u7b97\u4e24\u4e2a \\(n\\) \u4f4d\u5927\u6574\u6570\u7684\u4e58\u6cd5\u9700\u8981\u7684\u65f6\u95f4\u662f \\(O(n \\log(n) \\log(\\log(n)))\\)\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u5b9a\u4e49","title":"\u5b9a\u4e49","text":"<p>Montgomery \u6a21\u4e58\u662f\u4e00\u79cd\u63d0\u9ad8\u6a21\u4e58\u7684\u6027\u80fd\u7684\u65b9\u6cd5\u3002\u5177\u4f53\u5730\uff0cMontgomery \u6a21\u4e58\u9700\u8981\u4e00\u4e2a\u53c2\u6570 \\(R\\) \u6ee1\u8db3 \\(R\\) \u548c \\(N\\) \u4e92\u8d28\uff0c\u4e14 \\(R &gt; N\\)\uff0c\u90a3\u4e48 Montgomery \u6a21\u4e58\u5b9e\u73b0\u7684\u662f\u5982\u4e0b\u8ba1\u7b97\uff1a</p> \\[ M(a, b) = a * b * R^{-1} \\bmod N \\] <p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u7528\u9014","title":"\u7528\u9014","text":"<p>\u8fd9\u770b\u8d77\u6765\u5f88\u5947\u602a\uff0c\u4e3a\u4ec0\u4e48\u8981\u5728\u539f\u6765\u7684 \\(a*b\\) \u4e0a\u518d\u591a\u4e58\u4e00\u9879\uff1a\u8fd9\u6837\u53ef\u4ee5\u628a\u539f\u6765\u5bf9 \\(N\\) \u7684\u9664\u6cd5\uff0c\u8f6c\u5316\u4e3a\u5bf9 \\(R\\) \u7684\u9664\u6cd5\uff0c\u800c\u5982\u679c\u628a \\(R\\) \u9009\u62e9\u4e3a\u4e8c\u7684\u5e42\u6b21\uff0c\u786c\u4ef6\u4e0a\u5b9e\u73b0 \\(R\\) \u7684\u9664\u6cd5\u5c31\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f4d\u8fd0\u7b97\u5373\u53ef\u3002\u8fd9\u6837\u5c31\u514d\u53bb\u4e86\u539f\u6765\u5f88\u6162\u7684\u9664\u6cd5\u64cd\u4f5c\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u79cd\u8ba1\u7b97\u65b9\u6cd5\u4f1a\u5f15\u5165\u989d\u5916\u7684 \\(R^{-1}\\) \u7cfb\u6570\uff0c\u5bfc\u81f4\u8ba1\u7b97\u7ed3\u679c\u4e0d\u662f\u60f3\u8981\u7684 \\(a * b\\)\u3002\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u9884\u5148\u8ba1\u7b97\u597d \\(R^2 \\bmod N\\)\uff0c\u7136\u540e\u5148\u7528 Montgomery \u6a21\u4e58\u628a\u8981\u8ba1\u7b97\u7684\u6570\u90fd\u4e58\u4ee5 \\(R\\)\uff1a</p> \\[\\begin{align} M(a, R^2) \\equiv a * R^2 * R^{-1} \\equiv aR \\pmod N \\\\ M(b, R^2) \\equiv b * R^2 * R^{-1} \\equiv bR \\pmod N \\\\ \\end{align}\\] <p>\u6b64\u65f6\u6240\u6709\u6570\u90fd\u81ea\u5e26\u4e00\u4e2a \\(R\\) \u7684\u7cfb\u6570\uff0c\u6b64\u65f6\u518d\u8fdb\u884c Montgomery \u4e58\uff0c\u4f1a\u53d1\u73b0\uff1a</p> \\[ M(aR, bR) \\equiv (aR) * (bR) * R^{-1} \\equiv abR \\pmod N \\] <p>\u5f97\u5230\u7684\u7ed3\u679c\u662f \\(ab\\) \u4e58\u4ee5 \\(R\\) \u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ed3\u679c\u53ef\u4ee5\u7ee7\u7eed\u548c\u5176\u4ed6\u5e26\u6709 \\(R\\) \u7cfb\u6570\u7684\u503c\u8fdb\u884c\u8fd0\u7b97\u3002\u5f53\u6700\u540e\u8fd0\u7b97\u5b8c\u6210\u4ee5\u540e\uff0c\u8981\u628a\u7ed3\u679c\u6062\u590d\u5230\u539f\u6765\u7684\u503c\u7684\u65f6\u5019\uff0c\u518d\u548c \\(1\\) \u8fdb\u884c Montgomery \u4e58\uff0c\u5373\u53ef\u5f97\u5230\u6700\u7ec8\u7ed3\u679c</p> \\[ M(abR, 1) \\equiv abR * 1 * R^{-1} \\equiv ab \\bmod N \\] <p>\u56e0\u6b64\uff0c\u5982\u679c\u8981\u7528 Montgomery \u6a21\u4e58\u6765\u8fdb\u884c\u52a0\u901f\uff0c\u9700\u8981\u7ecf\u8fc7\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u7b2c\u4e00\u6b65\uff0c\u628a\u6240\u6709\u6570\u90fd\u8fdb\u884c Montgomery \u6a21\u4e58\uff0c\u4e58\u4ee5 \\(R^2 \\bmod N\\)\uff0c\u628a\u6240\u6709\u6570\u90fd\u6dfb\u52a0\u4e0a \\(R\\) \u7684\u7cfb\u6570</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u6309\u7167\u6b63\u5e38\u7684\u6d41\u7a0b\u8ba1\u7b97\uff0c\u6240\u6709\u503c\u90fd\u5e26\u6709 \\(R\\) \u7cfb\u6570\uff0c\u540c\u65f6\u6240\u6709\u7684\u6a21\u4e58\u90fd\u88ab\u66ff\u6362\u4e3a\u4e86\u66f4\u52a0\u9ad8\u6548\u7684 Montgomery \u6a21\u4e58</li> <li>\u7b2c\u4e09\u6b65\uff0c\u628a\u7ed3\u679c\u548c \\(1\\) \u8fdb\u884c Montgomery \u6a21\u4e58\uff0c\u8fd8\u539f\u4e3a\u771f\u5b9e\u503c</li> </ol> <p>\u56e0\u6b64\uff0c\u53ea\u8981\u4e2d\u95f4\u8ba1\u7b97\u7684\u8fc7\u7a0b\u662f\u5927\u5934\uff0c\u521d\u59cb\u5316\u548c\u6700\u540e\u7684\u5904\u7406\u65f6\u95f4\u5c31\u53ef\u4ee5\u5ffd\u7565\uff0c\u53ef\u4ee5\u4eab\u53d7\u5230 Montgomery \u6a21\u4e58\u5e26\u6765\u7684\u6027\u80fd\u63d0\u5347\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u7b97\u6cd5","title":"\u7b97\u6cd5","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd Montgomery \u7684\u5177\u4f53\u7b97\u6cd5\uff0c\u770b\u770b\u5b83\u5982\u4f55\u63d0\u9ad8\u6a21\u4e58\u6027\u80fd\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#redc","title":"REDC","text":"<p>\u9996\u5148\u4ecb\u7ecd Montogomery \u7684 REDC \u7b97\u6cd5\uff0c\u5b83\u7684\u6b65\u9aa4\u662f\uff1a</p> <ol> <li>\u9884\u5148\u8ba1\u7b97 \\(N'\\)\uff0c\u6ee1\u8db3 \\(NN' \\equiv -1 \\bmod R\\)</li> <li>\u8ba1\u7b97 \\(T=a*b\\)</li> <li>\u8ba1\u7b97 \\(m=((T \\bmod R)N') \\bmod R\\)</li> <li>\u8ba1\u7b97 \\(t=(T + mN) / R\\)</li> <li>\u5982\u679c \\(t \\ge N\\)\uff0c\u90a3\u4e48 \\(a * b * R^{-1} \\bmod N = t - N\\)</li> <li>\u5426\u5219 \\(a * b * R^{-1} \\bmod N = t\\)</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53ea\u6d89\u53ca\u5230\u5173\u4e8e \\(R\\) \u7684\u9664\u6cd5\uff0c\u4e0d\u6d89\u53ca\u5230\u5173\u4e8e \\(N\\) \u7684\u9664\u6cd5\u3002\u4e0b\u9762\u63a8\u5bfc\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u4e0a\u9762\u7684\u516c\u5f0f\u662f\u6b63\u786e\u7684\uff1a</p> <p>\u9996\u5148\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86 \\(t = (T+mN) / R\\)\uff0c\u4e3a\u4e86\u4fdd\u8bc1 \\(t\\) \u662f\u6574\u6570\uff0c\u9700\u8981\u8bc1\u660e \\(T+mN\\) \u53ef\u4ee5\u6574\u9664 \\(R\\)\uff0c\u4e5f\u5c31\u662f\u8981\u6c42 \\(T + mN \\equiv 0 \\pmod R\\)\uff1a</p> \\[\\begin{align} T + mN &amp;\\equiv T + (((T \\bmod R)N') \\bmod R)N \\pmod R \\\\ &amp;\\equiv T + TN'N \\pmod R \\\\ &amp;\\equiv T + T(-1) \\pmod R \\\\ &amp;\\equiv 0 \\pmod R \\end{align}\\] <p>\u8bf4\u660e \\(t\\) \u662f\u6574\u6570\u3002\u5176\u6b21\uff0c\u9700\u8981\u8bc1\u660e \\(a * b * R^{-1} \\equiv t \\pmod N\\)\uff1a</p> \\[\\begin{align} t &amp;= (T + mN) / R \\\\ &amp;\\equiv (T + mN) R^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + mNR^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + 0 \\pmod N \\\\ &amp;\\equiv a * b * R^{-1} \\pmod N \\end{align}\\] <p>\u8bf4\u660e \\(t\\) \u548c\u7b54\u6848 \\(a * b * R^{-1}\\) \u5728\u6a21 \\(N\\) \u610f\u4e49\u4e0b\u76f8\u7b49\u3002</p> <p>\u6839\u636e \\(m\\) \u7684\u5b9a\u4e49\uff0c\\(m\\) \u7684\u8303\u56f4\u662f \\([0, R-1]\\)\uff0c\u540c\u65f6 \\(a, b \\in [0, N-1]\\)\uff0c\u4e14\u5df2\u77e5 \\(N &lt; R\\)\uff0c\u8ba1\u7b97 \\(t\\) \u7684\u8303\u56f4\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((N-1)(N-1) + (R-1)N) / R \\\\ &amp;&lt; (RN + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u56e0\u6b64 \\(t \\in [0, 2N-1]\\)\u3002\u524d\u9762\u5df2\u7ecf\u8bc1\u660e\uff0c\\(t\\) \u548c\u7b54\u6848 \\(a * b * R^{-1}\\) \u5728\u6a21 \\(N\\) \u610f\u4e49\u4e0b\u76f8\u7b49\u3002\u5728 \\([0, 2N-1]\\) \u8303\u56f4\u5185\uff0c\u6a21 \\(N\\) \u610f\u4e49\u4e0b\u76f8\u7b49\u53ea\u6709\u4e24\u79cd\u53ef\u80fd\uff1a\u76f8\u7b49\u6216\u8005\u5dee\u4e00\u4e2a \\(N\\)\u3002\u6240\u4ee5 REDC \u7b97\u6cd5\u7684\u6700\u540e\u4e00\u6b65\u5c31\u662f\uff1a\u5982\u679c \\(t \\ge N\\)\uff0c\u53ea\u53ef\u80fd \\(t\\) \u548c\u7b54\u6848\u5dee\u4e00\u4e2a \\(N\\)\uff0c\u6240\u4ee5\u7b54\u6848 \\(a * b * R^{-1} \\bmod N = t - N\\)\uff1b\u5426\u5219 \\(t &lt; N\\)\uff0c\u6b64\u65f6\u7b54\u6848 \\(a * b * R^{-1} \\bmod N = t\\)\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u5927\u6574\u6570-montgomery-\u6a21\u4e58","title":"\u5927\u6574\u6570 Montgomery \u6a21\u4e58","text":"<p>\u5b9e\u9645\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c Montgomery \u7b97\u6cd5\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u8fd9\u4e9b\u6570\u90fd\u5f88\u5927\uff0c\u56e0\u6b64\u4e3a\u4e86\u8868\u793a\u5927\u6574\u6570\uff0c\u9700\u8981\u7528\u56fa\u5b9a\u4f4d\u6570\u7684\u6574\u6570\u6570\u7ec4\u6765\u8868\u793a\uff0c\u4f8b\u5982\u7528\u591a\u4e2a 64 \u4f4d\u6574\u6570\u6765\u8868\u793a\u4e00\u4e2a\u5927\u6574\u6570\u3002\u6b64\u65f6\uff0c\u628a\u5927\u6574\u6570\u8fd0\u7b97\u62c6\u6210\u591a\u4e2a 64 \u4f4d\u6574\u6570\u7684\u8fd0\u7b97\uff0c\u7136\u540e\u628a\u5927\u6574\u6570\u7684\u8fd0\u7b97\u548c Montgomery \u6a21\u4e58\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u5f97\u5230\u66f4\u9ad8\u6027\u80fd\u7684 Montgomery \u6a21\u4e58\u3002</p> <p>\u8bba\u6587 Analyzing and Comparing Montgomery Multiplication Algorithms \u5206\u6790\u4e86\u51e0\u79cd\u6df7\u5408\u4e86\u5927\u6574\u6570\u8fd0\u7b97\u548c Montgomery \u6a21\u4e58\u7684\u7b97\u6cd5\u3002\u4e0b\u9762\u8bb2\u89e3\u8bba\u6587\u4e2d\u63d0\u5230\u7684\u90e8\u5206\u7b97\u6cd5\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u8ba8\u8bba\u4e2d\uff0c\u5047\u8bbe\u673a\u5668\u6574\u6570\u7684\u5bbd\u5ea6\u662f \\(w\\) \u4f4d\uff0c\u4f8b\u5982 \\(w=64\\) \u8868\u793a\u7528 64 \u4f4d\u6574\u6570\u8fdb\u884c\u8fd0\u7b97\uff0c\u6b64\u65f6 \\(R=2^{sw}\\)\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\\(R\\) \u7b49\u4e8e \\(s\\) \u4e2a \\(w\\) \u4f4d\u6574\u6570\u53ef\u4ee5\u8868\u793a\u7684\u6700\u5927\u503c\u52a0\u4e00\uff0c\u90a3\u4e48\u9664\u4ee5 \\(R\\) \u76f8\u5f53\u4e8e\u820d\u5f03\u6700\u4f4e\u7684 \\(s\\) \u4e2a \\(w\\) \u4f4d\u6574\u6570\u3002\u540c\u65f6\u4e5f\u610f\u5473\u7740\uff0c\\(a\\) \\(b\\) \\(N\\) \u90fd\u53ef\u4ee5\u7528 \\(s\\) \u4e2a \\(w\\) \u4f4d\u6574\u6570\u8868\u793a\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#separated-operand-scanning","title":"Separated Operand Scanning","text":"<p>\u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f Separated Operand Scanning \u65b9\u6cd5\uff08\u540c\u65f6\u4e5f\u662f Wikipedia \u4e2d\u63d0\u5230\u7684 MultiPrecisionREDC \u7b97\u6cd5\uff09\uff0c\u5b83\u7684\u6b65\u9aa4\u662f\uff1a</p> <p>\u7b2c\u4e00\u6b65\uff1a\u6309\u7167\u4f20\u7edf\u65b9\u5f0f\u8fdb\u884c\u5927\u6574\u6570\u4e58\u6cd5\uff0c\u8ba1\u7b97\u51fa \\(T = a*b\\)\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u653e\u5728 \\(t\\) \u6570\u7ec4\u4e2d\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff0c\u6c42 \\(t = (T + mN) / R\\)\uff0c\u6b64\u65f6 \\(T\\) \u5df2\u7ecf\u8ba1\u7b97\u51fa\u6765\uff0c\u63a5\u4e0b\u6765\u9996\u5148\u8981\u8ba1\u7b97\u51fa \\(m=((T \\bmod R)N') \\bmod R\\)\uff0c\u5728\u8fd9\u91cc \\(\\bmod R\\) \u5c31\u662f\u53d6\u5927\u6570\u7684\u6700\u4f4e \\(s\\) \u4e2a \\(w\\) \u4f4d\u6574\u6570\uff0c\u56e0\u6b64\u53ef\u4ee5\u7b80\u5316\u5927\u6574\u6570\u4e58\u6cd5\u4e3a\uff1a</p> <pre><code># m = ((T % R) * N') % R\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-i-1\n        (C, S) := m[i+j] + t[i]*n'[j] + C\n        m[i+j] := S\n</code></pre> <p>\u63a5\u4e0b\u6765\u6c42\u5927\u6574\u6570 \\(m\\) \u4e58\u4ee5\u5927\u6574\u6570 \\(N\\) \u7684\u79ef\uff0c\u6c42\u79ef\u7684\u540c\u65f6\u628a\u7ed3\u679c\u7d2f\u52a0\u5230 \\(T\\) \u4e0a\u3002\u4f2a\u4ee3\u7801\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + m[i]*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u8fd9\u91cc\u7684 ADD \u51fd\u6570\u6307\u7684\u662f\u5927\u6574\u6570\u52a0\u6cd5\u8fd0\u7b97\u91cc\u9762\uff0c\u6c42\u548c\u540e\u4e0d\u65ad\u8fdb\u4f4d\u76f4\u5230\u4e0d\u518d\u8fdb\u4f4d\u4e3a\u6b62\u7684\u51fd\u6570\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00\u4e86\u3002</p> <p>\u5728\u8fd9\u91cc\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u4f18\u5316\uff1a\u5b9e\u9645\u4e0a\uff0c\u4e0d\u9700\u8981\u628a \\(m\\) \u6574\u4e2a\u5927\u6574\u6570\u8ba1\u7b97\u51fa\u6765\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5\u6c42 \\(T + mN\\)\uff1a\u56de\u5fc6\u4e00\u4e0b\uff0c\u6700\u521d\u8ba1\u7b97 \\(T + mN\\) \u7684\u76ee\u7684\u662f\u8ba9\u7ed3\u679c\u6574\u9664 \\(R\\)\uff0c\u73b0\u5728\u628a \\(T + mN\\) \u7684\u8ba1\u7b97\u62c6\u6210 \\(s\\) \u4e2a\u5c0f\u6b65\uff1a\u7b2c \\(i\\) \u6b65\u8ba9\u7ed3\u679c\u6574\u9664 \\(2^{(i+1)w}\\)\uff1a</p> <p>\u7b2c\u4e00\u6b65\uff1a\\(T + m_1N \\equiv 0 \\pmod{2^w}\\)\uff0c\u6b64\u65f6 \\(m_1 = T * N' \\bmod 2^w\\)\uff0c\u5bf9\u5e94\u5728\u4ee3\u7801\u4e0a\uff0c\u5c31\u662f <code>m_1 = t[0] * n'[0]</code>\uff0c\u820d\u53bb\u6ea2\u51fa\u7684\u90e8\u5206\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff1a\\(T + m_1N + m_22^wN \\equiv 0 \\pmod{2^{2w}}\\)\uff0c\u6b64\u65f6 \\(m_2 * 2^w = (T + m_1N) * N' \\bmod 2^{2w}\\)\uff0c\u6b64\u65f6\u4f1a\u60ca\u559c\u5730\u53d1\u73b0\uff0c\u7531\u4e8e \\(T + m_1N\\) \u662f \\(2^w\\) \u7684\u500d\u6570\uff0c\u56e0\u6b64\u8ba1\u7b97 \\((T + m_1N) * N'\\) \u7684\u65f6\u5019\uff0c\\(T + m_1N\\) \u7684\u4f4e \\(w\\) \u4f4d\u5168\u662f 0\uff0c\u4e5f\u610f\u5473\u7740\u5b9e\u9645\u4e0a \\((T + m_1N) * N'\\) \u5c31\u662f\u62ff \\((T + m_1N) \\bmod 2^{2w}\\) \u7684\u9ad8 \\(w\\) \u4f4d\u4e58\u4ee5 \\(N'\\) \u7684\u4f4e \\(w\\) \u4f4d\uff0c\u518d\u5de6\u79fb \\(w\\) \u4f4d\uff0c\u7ed3\u679c\u7b49\u4e8e \\(m_2 * 2 ^ w\\)\uff0c\u6240\u4ee5 \\(m_2\\) \u5c31\u7b49\u4e8e \\(((T+m_1N) \\bmod 2^{2w}) / 2^w * (N' \\bmod 2^w)\\)\uff0c\u5bf9\u5e94\u5728\u4ee3\u7801\u4e0a\uff0c\u5c31\u662f <code>m_2 = t[1] * n'[0]</code>\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u4e00\u76f4\u7ee7\u7eed\u4e0b\u53bb\uff0c\u6bcf\u4e00\u6b65\u7684 <code>m_i</code> \u90fd\u53ef\u4ee5\u7528 <code>m_i = t[i] * n'[0]</code> \u8ba1\u7b97\u3002\u56e0\u6b64\u4e0d\u518d\u9700\u8981\u5148\u6c42 \\(m\\)\uff0c\u518d\u6c42 \\(T + mN\\)\uff0c\u800c\u662f\u53ef\u4ee5\u540c\u65f6\u8ba1\u7b97\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u8ba1\u7b97\u51fa \\(T + mN\\) \u4ee5\u540e\uff0c\u6700\u540e\u5c31\u662f\u9664\u4ee5 \\(R\\) \u4e86\uff0c\u5b9e\u9645\u4e0a\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u53bb\u6389 <code>t</code> \u6570\u7ec4\u7684\u4f4e \\(s\\) \u9879\u5373\u53ef\uff1a</p> <pre><code># u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n</code></pre> <p>\u6700\u540e\u518d\u7528\u5927\u6574\u6570\u51cf\u6cd5\u548c\u6bd4\u8f83\uff0c\u4f7f\u5f97\u7ed3\u679c \\(u\\) \u843d\u5728 \\([0, N-1]\\) \u7684\u8303\u56f4\u5185\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5355\u72ec\u5217\u4ee3\u7801\u4e86\u3002\u628a\u4e0a\u9762\u7684\u4ee3\u7801\u5408\u5728\u4e00\u8d77\uff0c\u5c31\u5f97\u5230\u6700\u7ec8\u5b8c\u6574 Separated Operand Scanning \u7b97\u6cd5\u7684\u4f2a\u4ee3\u7801\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n\n# t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n\n# u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n\n# return u or u - N\nB := 0\nfor i=0 to s-1\n    (B,D) := u[i] - n[i] - B\n    t[i] := D\n(B,D) := u[s] - B\nt[s] := D\nif B=0 then\n    return t[0], t[1], ... , t[s-1]\nelse\n    return u[0], u[1], ... , u[s-1]\n</code></pre>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#coarse-integrated-operand-scanning","title":"Coarse Integrated Operand Scanning","text":"<p>\u7b2c\u4e8c\u79cd\u7b97\u6cd5 Coarse Integrated Operand Scanning \u662f\u5728 Separated Operand Scanning \u7684\u57fa\u7840\u4e0a\uff0c\u628a \\(a*b\\) \u548c\u540e\u9762\u7684\u8ba1\u7b97\u8fc7\u7a0b\u4ea4\u9519\u8fdb\u884c\uff0c\u653e\u5728\u540c\u4e00\u4e2a\u5927\u5faa\u73af\u4e2d\uff0c\u56e0\u4e3a\u540e\u9762\u4f7f\u7528\u5230 <code>t</code> \u6570\u7ec4\u7684\u65f6\u5019\uff0c\u53ea\u4f1a\u4f9d\u8d56\u5df2\u7ecf\u8ba1\u7b97\u51fa\u6765\u7684\u90e8\u5206\u3002\u540c\u65f6\uff0c\u6bcf\u6b21\u5faa\u73af\u7ed3\u675f\u7684\u65f6\u5019\u5c31\u628a\u6574\u4e2a <code>t</code> \u6570\u7ec4\u53f3\u79fb\u4e00\u6b21\uff0c\u56e0\u6b64\u539f\u6765\u7684 <code>t[i]</code> \u5c31\u4f1a\u53d8\u6210 <code>t[0]</code>\uff0c<code>t[i+j]</code> \u53d8\u6210 <code>t[j]</code>\u3002</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t += m * N\n    C := 0\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := t[s+1] + C\n\n    # t /= W\n    for j=0 to s\n        t[j] := t[j+1]\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u6bcf\u6b21\u5faa\u73af\u90fd\u53f3\u79fb\u4e00\u6b21\uff0c\u90a3\u4e48\u5faa\u73af \\(s\\) \u6b21\u5c31\u662f\u9664\u4ee5 \\(R\\)\uff0c\u56e0\u6b64\u539f\u6765\u7684 \\(u = t / R\\) \u4e00\u6b65\u5c31\u4e0d\u9700\u8981\u4e86\u3002\u540c\u65f6\uff0c\\(t\\) \u6570\u7ec4\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u4e5f\u7f29\u5c0f\u4e86\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u4fdd\u5b58\u5b8c\u6574\u7684 \\(a*b\\) \u7684\u7ed3\u679c\u3002\u66f4\u8fdb\u4e00\u6b65\uff0c\u8fd8\u53ef\u4ee5\u628a <code>t += m * N</code> \u548c\u79fb\u4f4d\u4e24\u6b65\u5408\u5e76\u5728\u4e00\u8d77\u8fdb\u884c\uff1a</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t = (t + m * N) / W\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    (C, S) := t[0] + m*n[0]\n    for j=1 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j-1] := S\n    (C, S) := t[s] + C\n    t[s-1] := S\n    t[s] := t[s+1] + C\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u6700\u7ec8\u7684 Coarse Integrated Operand Scanning \u7b97\u6cd5\uff0c\u4e0b\u9762\u662f\u4e00\u6bb5\u7528 Rust \u8bed\u8a00\u7f16\u5199\u7684\u5b9e\u73b0\uff1a</p> <pre><code>// https://github.com/jiegec/rust-monty-comparison/blob/6c941d5c95d37dd9ee8f12aa57df577e0f2b623b/src/lib.rs#L89-L139\nlet mut res = [0u32; WORDS + 2];\n// for i=0 to s-1\nfor i in 0..WORDS {\n    // C := 0\n    let mut c = 0;\n    // for j = 0 to s-1\n    for j in 0..WORDS {\n        // (C, S) := t[j] + a[j] * b[i] + C\n        let mut cs = res[j] as u64;\n        cs += self.num[j] as u64 * other.num[i] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j] := S\n        res[j] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    let cs = res[WORDS] as u64 + c as u64;\n    // t[s] := S\n    res[WORDS] = cs as u32;\n    // t[s+1] := C\n    res[WORDS + 1] = (cs &gt;&gt; 32) as u32;\n\n    // m := t[0]*n'[0] mod W\n    let m: u32 = (res[0] as u64 * N_INV as u64) as u32;\n    // (C, S) := t[0] + m*n[0]\n    let mut cs = res[0] as u64 + m as u64 * N[0] as u64;\n    c = (cs &gt;&gt; 32) as u32;\n    // for j=1 to s-1\n    for j in 1..WORDS {\n        // (C, S) := t[j] + m*n[j] + C\n        cs = res[j] as u64;\n        cs += m as u64 * N[j] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j-1] := S\n        res[j - 1] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    cs = res[WORDS] as u64 + c as u64;\n    // t[s-1] := S\n    res[WORDS - 1] = cs as u32;\n    // t[s] := t[s+1] + C\n    res[WORDS] = res[WORDS + 1] + (cs &gt;&gt; 32) as u32;\n}\n\nlet res_scalar = MontyBigNum::from_u32_slice(&amp;res[0..WORDS]);\nlet mut res_scalar_sub = res_scalar;\nlet borrow = bignum_sub(&amp;mut res_scalar_sub, &amp;MODULO);\nif res[WORDS] != 0 || borrow == 0 {\n    res_scalar_sub\n} else {\n    res_scalar\n}\n</code></pre> <p>OpenSSL \u4e5f\u5728\u51fd\u6570 bn_mul_mont \u4e2d\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u7b97\u6cd5\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u5e38\u6570\u65f6\u95f4","title":"\u5e38\u6570\u65f6\u95f4","text":"<p>\u5728 Montgomery \u6a21\u4e58\u7684\u6700\u540e\u4e00\u6b65\uff0c\u9700\u8981\u628a\u8ba1\u7b97\u7ed3\u679c\u548c \\(N\\) \u6bd4\u8f83\uff0c\u7136\u540e\u8fdb\u884c\u51cf\u6cd5\uff0c\u8fd9\u4e00\u6b65\u4f1a\u51fa\u73b0\u4e00\u4e2a\u6761\u4ef6\u5206\u652f\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd0\u884c\u65f6\u95f4\u548c\u6570\u636e\u76f8\u5173\uff0c\u6210\u4e3a\u4e00\u4e2a\u6f5c\u5728\u7684\u6d4b\u4fe1\u9053\u653b\u51fb\u7684\u70b9\u3002\u56e0\u6b64\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u6709\u5982\u4e0b\u7684\u89e3\u51b3\u65b9\u6cd5\uff08\u53c2\u8003\u8bba\u6587 Montgomery Arithmetic from a Software Perspective\uff09\uff1a</p> <p>\u65e2\u7136\u6761\u4ef6\u5206\u652f\u662f\u4e3a\u4e86\u548c \\(N\\) \u6bd4\u8f83\uff0c\u90a3\u5982\u679c\u53bb\u6389\u8fd9\u4e2a\u9650\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\u8ba9\u7ed3\u679c\u5728 \\([0, 2N-1]\\) \u7684\u8303\u56f4\u800c\u4e0d\u662f \\([0, N-1]\\)\uff0c\u770b\u770b\u80fd\u5426\u7ee7\u7eed\u628a\u7ed3\u679c\u4f20\u7ed9\u4e0b\u4e00\u6b21\u7684 Montgomery \u6a21\u4e58\u3002\u9996\u5148\u8981\u6c42 \\(R &gt; 2N\\)\uff0c\u56e0\u4e3a\u8f93\u5165\u53c2\u6570\u7684\u8303\u56f4\u662f\u6a21 \\(2N\\)\uff0c\u800c\u4e0d\u662f\u6a21 \\(N\\)\uff1b\u5176\u6b21\uff0c\u91cd\u65b0\u8003\u8651 \\(t = (T+mN) / R\\) \u7684\u653e\u7f29\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\end{align}\\] <p>\u6b64\u65f6\u4e3a\u4e86\u8ba9 \\(t &lt; 2N\\) \u6210\u7acb\uff0c\u9700\u8981\u989d\u5916\u6dfb\u52a0\u6761\u4ef6 \\(R &gt; 4N\\)\uff0c\u6b64\u65f6\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\\\ &amp;&lt; ((\\frac{1}{2}R)(2N) + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u89c4\u5b9a \\(R &gt; 4N\\)\uff0c\u90a3\u4e48\u6700\u540e\u4e00\u6b65\u53ef\u4ee5\u4e0d\u548c \\(N\\) \u6bd4\u8f83\uff0c\u628a\u7ed3\u679c\u4fdd\u7559\u5728 \\([0, 2N-1]\\) \u7684\u8303\u56f4\uff0c\u7ee7\u7eed\u8fdb\u884c\u540e\u7eed\u7684 Montgomery \u6a21\u4e58\u3002\u4f46\u662f\u8fd9\u6837\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5728 RSA \u573a\u666f\u4e0b\uff0c\u901a\u5e38 \\(N\\) \u7684\u4f4d\u6570\u5c31\u662f\u4e8c\u7684\u5e42\u6b21\uff0c\u4f8b\u5982 \\(N\\) \u662f\u4e00\u4e2a 2048 \u4f4d\u7684\u5927\u6574\u6570\uff0c\u4e3a\u4e86\u6ee1\u8db3 \\(R &gt; 4N\\)\uff0c\u4e0d\u5f97\u4e0d\u591a\u5b58\u4e00\u4e2a\u6574\u6570\uff0c\u76f8\u5e94\u5730 Montgomery \u6a21\u4e58\u8ba1\u7b97\u4e2d\u7684\u5faa\u73af\u6b21\u6570\u4e5f\u8981\u589e\u52a0\u3002</p> <p>\u53e6\u4e00\u79cd\u601d\u8def\u662f\uff0c\u65e2\u7136\u548c \\(N\\) \u6bd4\u8f83\u6bd4\u8f83\u8d39\u65f6\u95f4\uff0c\u800c\u4e14\u9700\u8981\u6761\u4ef6\u5206\u652f\uff0c\u90a3\u5c31\u6539\u6210\u548c \\(R\\) \u6bd4\u8f83\uff0c\u8ba9\u7ed3\u679c\u4fdd\u6301\u5728 \\([0, R-1]\\) \u7684\u533a\u95f4\u5185\uff0c\u800c\u4e0d\u662f\u539f\u6765\u7684 \\([0, N-1]\\) \u533a\u95f4\u3002\u6b64\u65f6\u91cd\u65b0\u8003\u8651 \\(t = (T+mN) / R\\) \u7684\u653e\u7f29\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((R-1)(R-1) + (R-1)N) / R \\\\ &amp;&lt; (R^2 + RN) / R \\\\ &amp;= R + N \\end{align}\\] <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u7ed3\u679c\u4f1a\u5728 \\([0, R+N-1]\\) \u7684\u8303\u56f4\u5185\uff0c\u6b64\u65f6\u6700\u540e\u4e00\u6b65\u53d8\u6210\u548c \\(R\\) \u6bd4\u8f83\u5927\u5c0f\uff0c\u5982\u679c\u6bd4 \\(R\\) \u5927\uff0c\u5c31\u51cf\u53bb \\(N\\)\u3002\u548c \\(R\\) \u6bd4\u8f83\u5927\u5c0f\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u770b\u6700\u9ad8\u4f4d\u662f\u5426\u4e3a \\(0\\) \u5373\u53ef\u3002\u8fd9\u79cd\u65b9\u6cd5\u5e76\u6ca1\u6709\u6d88\u9664\u6761\u4ef6\u5206\u652f\uff0c\u4f46\u662f\u628a\u6761\u4ef6\u5206\u652f\u7684\u5f00\u9500\u964d\u5230\u4e86\u5355\u6b21\u6574\u6570\u6bd4\u8f83\u3002\u5982\u679c\u8981\u4fdd\u8bc1\u5e38\u6570\u65f6\u95f4\u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u7ed3\u679c\u5c0f\u4e8e \\(R\\) \u65f6\uff0c\u51cf\u53bb\u96f6\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u9006\u63a8","title":"\u9006\u63a8","text":"<p>\u4e0b\u9762\u5c1d\u8bd5\u9006\u63a8\u51fa Montgomery \u662f\u5982\u4f55\u8bbe\u8ba1 Montgomery \u6a21\u4e58\u7b97\u6cd5\u7684\u3002</p> <p>\u9996\u5148\u76ee\u6807\u662f\u6c42 \\(t = a * b \\bmod N\\)\uff0c\u4e5f\u5c31\u662f\u8981\u627e\u5230\u4e00\u4e2a \\(m\\) \u6ee1\u8db3 \\(t = a * b + mN \\in [0, N-1]\\)\uff0c\u4f46\u662f\u6c42 \\(m\\) \u7684\u8fd9\u4e00\u6b65\u9700\u8981\u8ba1\u7b97\u9664\u6cd5\u3002\u65e2\u7136 \\(N\\) \u4e0d\u65b9\u4fbf\u8ba1\u7b97\u9664\u6cd5\uff0c\u90a3\u5c31\u5c1d\u8bd5\u6362\u4e00\u4e2a\u9664\u6570 \\(R\\)\uff0c\u628a\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 \\(m\\) \u4f7f\u5f97 \\(t = (a * b + mN) / R \\in [0, N-1]\\)\uff0c\u6b64\u65f6 \\(t = a * b * R^{-1} \\bmod N\\)\uff0c\u4f46\u662f\u4e0d\u8981\u7d27\uff0c\u53ea\u8981\u80fd\u9ad8\u6548\u5730\u8ba1\u7b97 \\(a * b * R^{-1} \\bmod N\\)\uff0c\u5c31\u53ef\u4ee5\u9ad8\u6548\u5730\u8ba1\u7b97 \\(a * b \\bmod N\\)\u3002</p> <p>\u4e8e\u662f\u4e0b\u9762\u7684\u95ee\u9898\u5c31\u6765\u5230\u4e86\u600e\u4e48\u627e\u5230 \\(m\\) \u4f7f\u5f97 \\(t = (a * b + mN) / R \\in [0, N-1]\\)\u3002\u628a \\(R\\) \u632a\u5230\u7b49\u5f0f\u5de6\u8fb9\uff0c\u5f97\u5230</p> \\[ t * R = a * b + m * N \\] <p>\u7531\u4e8e \\(t\\) \u672a\u77e5\uff0c\u6240\u4ee5\u7b49\u5f0f\u5de6\u8fb9\u7684\u503c\u672a\u77e5\uff0c\u4e3a\u4e86\u6d88\u9664\u672a\u77e5\u6570\uff0c\u7b49\u5f0f\u4e24\u8fb9\u540c\u65f6\u5bf9 \\(R\\) \u53d6\u4f59\uff1a</p> \\[ 0 \\equiv a * b + m * N \\pmod R \\] <p>\u4e8e\u662f \\(m \\equiv - a * b * N^{-1} \\pmod R\\)\uff0c\u5176\u4e2d \\(-N^{-1} \\bmod R\\) \u7684\u90e8\u5206\u53ef\u4ee5\u9884\u5148\u8ba1\u7b97\u597d\u3002\u4f46\u662f\u8fd9\u91cc\u4f9d\u7136\u662f\u5728\u6a21 \\(R\\) \u7684\u610f\u4e49\u4e0b\u76f8\u7b49\uff0c\\(m\\) \u6709\u591a\u79cd\u53ef\u80fd\u3002</p> <p>\u5f88\u5e78\u8fd0\u7684\u662f\uff0c\u524d\u9762\u5df2\u7ecf\u63a8\u5bfc\u8fc7\uff0c\u5f53 \\(m = ((a * b) \\bmod R * -N^{-1}) \\bmod R\\) \u65f6\uff0c\u6070\u597d\u53ef\u4ee5\u4fdd\u8bc1\u6700\u7ec8\u7ed3\u679c \\(t \\in [0, 2N-1]\\)\uff0c\u6b64\u65f6\u53ea\u9700\u8981\u7b80\u5355\u5224\u65ad\u4e00\u4e0b \\(t\\) \u548c \\(N\\) \u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u3002\u8fd9\u6837\u5c31\u628a Montgomery \u6a21\u4e58\u7684\u6d41\u7a0b\u9006\u63a8\u51fa\u6765\u4e86\u3002</p> <p>\u6240\u4ee5\u4e24\u70b9\u89c2\u5bdf\u5f88\u91cd\u8981\uff1a\u4e00\u662f\u6362\u4e00\u4e2a\u5bb9\u6613\u505a\u9664\u6cd5\u7684\u9664\u6570 \\(R\\)\uff0c\u60f3\u5230\u8981\u8bbe \\(t = (a * b + mN) / R\\)\uff1b\u4e8c\u662f\u5373\u4f7f\u8ba9\u6a21\u4e58\u52a0\u4e0a\u4e00\u4e2a\u7cfb\u6570 \\(R^{-1}\\)\uff0c\u4e5f\u4e0d\u59a8\u788d\u5b83\u7684\u4f7f\u7528\u3002</p>","tags":["crypto","mulmod","montgomery"]},{"location":"crypto/2023/07/23/montgomery-mul-mod/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Wikipedia</li> <li>Analyzing and Comparing Montgomery Multiplication Algorithms</li> </ul>","tags":["crypto","mulmod","montgomery"]},{"location":"csdn/2014/12/06/android-studio-manual-update/","title":"Android Studio \u624b\u5de5\u66f4\u65b0\u5c0f\u8bb0","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/41776599</p> <p>\u56e0\u4e3a\u957f\u65f6\u95f4\u4e0d\u66f4\u65b0 Android Studio\uff0c\u56de\u5934\u4e00\u770b\uff0c\u6211\u7684\u7248\u672c\u624d 135.1339820\uff0c\u6700\u65b0\u7248\u672c\u90fd 135.1626825 \u53bb\u4e86\uff0c\u6211\u5c31\u840c\u751f\u4e86\u66f4\u65b0\u7684\u5ff5\u5934\u3002\u3002</p> <p>\u9996\u5148\uff0c\u6211\u5c1d\u8bd5\u8c03\u7528 update_studio.sh\u3002\u3002\u3002\u3002\u3002\u4f46\u662f\uff01\uff01404 Not Found\uff01\uff01\u770b\u6765\u7248\u672c\u8de8\u5ea6\u592a\u5927\u65e0\u6cd5\u6253\u8865\u4e01\u4e86\u5462\u3002\u3002</p> <p>\u90a3\u53ea\u597d\u770b\u770b https://dl.google.com/android/studio/patches/updates.xml \u8fd9\u4e2a\u91cc\u9762\u4e86\uff0c\u627e\u5230\u6211\u7684\u7248\u672c\u53f7\uff1a</p> <pre><code>&lt;channel\u00a0id=\"AI-0-beta\"\u00a0name=\"Android Studio updates\"\u00a0status=\"beta\"\u00a0url=\"http://tools.android.com/recent\"\u00a0feedback=\"https://code.google.com/p/android/issues/entry?template=Android+Studio+bug\"\u00a0majorVersion=\"0\"&gt;\n&lt;build\u00a0number=\"135.1623071\"\u00a0version=\"0.9.9\"&gt;\n&lt;message&gt;\n&lt;![CDATA[\n&lt;html&gt; A new Android Studio 0.9.9 is available in the beta channel.&lt;br&gt; This patch will allow you to update from 0.x to 1.x.&lt;br&gt; After updating, please check for updates again to install 1.0 RC.&lt;p/&gt; &lt;/html&gt;\n]]&gt;\n&lt;/message&gt;\n&lt;button\u00a0name=\"Download\"\u00a0url=\"http://developer.android.com/sdk/installing/studio.html\"\u00a0download=\"true\"/&gt;\n&lt;button\u00a0name=\"Release Notes\"\u00a0url=\"http://tools.android.com/recent\"/&gt;\n&lt;patch\u00a0from=\"135.1339820\"\u00a0size=\"176\"/&gt;\n&lt;!-- 0.8.6 --&gt;\n&lt;patch\u00a0from=\"135.1404660\"\u00a0size=\"176\"/&gt;\n&lt;!-- 0.8.9 --&gt;\n&lt;patch\u00a0from=\"135.1446794\"\u00a0size=\"161\"/&gt;\n&lt;!-- 0.8.11 --&gt;\n&lt;patch\u00a0from=\"135.1503853\"\u00a0size=\"90\"/&gt;\n&lt;!-- 0.8.12 --&gt;\n&lt;patch\u00a0from=\"135.1525417\"\u00a0size=\"89\"/&gt;\n&lt;!-- 0.8.13 --&gt;\n&lt;patch\u00a0from=\"135.1538390\"\u00a0size=\"89\"/&gt;\n&lt;!-- 0.8.14 --&gt;\n&lt;patch\u00a0from=\"135.1551333\"\u00a0size=\"71\"/&gt;\n&lt;!-- 0.9.0 --&gt;\n&lt;patch\u00a0from=\"135.1561280\"\u00a0size=\"71\"/&gt;\n&lt;!-- 0.9.1 --&gt;\n&lt;patch\u00a0from=\"135.1569493\"\u00a0size=\"71\"/&gt;\n&lt;!-- 0.9.2 --&gt;\n&lt;patch\u00a0from=\"135.1585741\"\u00a0size=\"71\"/&gt;\n&lt;!-- 0.9.3 --&gt;\n&lt;/build&gt;\n&lt;/channel&gt;\n</code></pre> <p>\u8fd8\u597d\u8fd8\u597d\uff0c\u5dee\u70b9\u5c31\u5347\u4e0d\u4e0a\u53bb\u4e86\u3002\u3002\u3002</p> <p>\u7acb\u9a6c\u4e0b\u8f7d\u00a0https://dl.google.com/android/studio/patches/AI-135.1339820-135.1623071-patch-mac.jar ..\u4e5f\u662f\u5927\uff0c\u5dee\u4e0d\u591a\u548c\u91cd\u65b0\u4e0b\u8f7d\u4e00\u6837\u5927\u4e86\u3002\u3002</p> <p>\u8fdb\u5165 Android Studio \u76ee\u5f55\uff0c\u8f93\u5165 java -cp\u00a0AI-135.1339820-135.1623071-patch-mac.jar com.intellij.updater.Runner install . \uff08\u8bb0\u4f4f\u540e\u9762\u7684\u3002\u8868\u793a\u5b89\u88c5\u76ee\u5f55\uff09\u3002</p> <p>\u5f39\u51fa\u7a97\u53e3\uff0c\u5347\u7ea7\u6210\u529f\uff0cyeah\uff01</p> <p>\u4ee5\u540e\u8981\u60f3\u7528 patch \u5347\u7ea7\uff0c\u4e00\u5b9a\u8981\u5c3d\u5feb\u554a\uff5e</p> <p>\u5410\u69fd\u4e00\u4e0b update_studio.sh \u7684\u7f16\u5199\u4eba\uff0c\u6211\u8981\u6539\u8fdb\u4e00\u4e0b\u4ed6\u7684\u811a\u672c\u3002\u3002\u5347\u4e0d\u4e0a\u53bb\u592a\u632b\u4e86\u3002\u3002</p> <p>\u9898\u5916\u8bdd\uff1a</p> <p>\u6253\u5b8c\u8865\u4e01\uff0c\u51fa\u73b0 Java not found \u9519\u8bef\uff0c\u53d1\u73b0\u6211\u7684 java \u7248\u672c\u662f Oracle1.8\uff0c\u800c\u4ed6\u8981\u7684\u662f Apple1.6.\u3002\u3002\u90a3\u6211\u53ea\u597d\u5b89\u88c5\u4e00\u4e0b\uff0c\u7136\u540e\u5462\uff1f\u5c31\u597d\u4e86\uff01\uff01\uff01\uff01\uff01</p>","tags":["java","intellijidea","android","androidstudio"]},{"location":"csdn/2014/07/06/include-relationship/","title":"\u5199\u4e86\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5206\u6790\u5404\u4e2a\u6e90\u6587\u4ef6\u4e4b\u95f4\u7684 include \u5173\u7cfb\u3002","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/37343993</p> <p></p> <p>\u6700\u5de6\u8fb9\u662f expat\uff0c\u4e0a\u9762 zlib\uff0c\u5de6\u4e0b\u89d2 mxml\uff0c\u4e2d\u95f4\u6700\u6076\u5fc3\u7684\u662f lua\uff0c\u53f3\u8fb9\u7684\u662f jpeg\u3002</p> <p>\u8bb2\u8bb2\u5927\u6982\u601d\u8def\uff1a</p> <p>1.\u626b\u63cf\u6e90\u6587\u4ef6\uff0c\u8fd9\u91cc\u5224\u65ad\u6700\u7b80\u5355\u7684#include\uff0c\u7136\u540e\u5efa\u7acb\u5173\u7cfb\u3002</p> <p>2.\u628a\u8fd9\u4e9b\u4f5c\u4e3a\u4e00\u4e2a\u4e2a body \u52a0\u5230 box2d \u7684\u4e16\u754c\u91cc\uff0c\u8ba9\u7269\u7406\u89e3\u51b3\u8fd9\u4e00\u5207\uff01\uff01</p> <p>3.\u7136\u540e\u628a\u6709 include \u5173\u7cfb\u7684\u7528\u4e00\u4e2a distancejoint \u8fde\u63a5\u8d77\u6765~\u4f60\u4f1a\u53d1\u73b0\u4ed6\u4eec\u5c31\u80fd\u4fdd\u6301\u4e00\u5b9a\u8ddd\u79bb\u4e86\u3002\u4f46\u662f\uff01\u6ca1\u6709\u88ab\u8fde\u63a5\u7684\u5168\u90fd\u805a\u5728\u4e00\u8d77\uff0c\u600e\u4e48\u529e\uff01</p> <p>4.\u628a\u8ddd\u79bb\u8fd1\u7684\uff0c\u4e0d\u548c\u81ea\u5df1\u76f8\u8fde\u7684\uff08\u6765\u4e2a dfs\uff09\u7ed9\u4e2a\u53cd\u65b9\u5411\u7684\u529b\uff01</p> <p>5.\u597d\u5427\uff0c\u8fd9\u5c31\u662f\u6700\u7ec8\u7ed3\u679c\uff0c\u6709\u4ec0\u4e48\u66f4\u597d\u7684\u65b9\u6cd5\uff1f\u5e0c\u671b\u5927\u5bb6\u4ea4\u6d41\u3002</p> <p>6.\u6211\u4e0d\u60f3\u5f00\u6e90\uff0c\u6bd5\u7adf\u8fd9\u8fd8\u53ea\u662f\u4e2a\u534a\u6210\u54c1\u3002\u3002\u3002\u3002\u3002\u505a\u597d\u4e86\u81ea\u7136\u4f1a\u5f00\u6e90\u7684</p> <p>7.\u50cf\u90a3\u4e2a\u6076\u5fc3\u7684 lua \u600e\u4e48\u89e3\u5f00\uff1f\u6587\u4ef6\u4e4b\u95f4\u7684\u4f9d\u8d56\u592a\u591a\u4e86\uff0c\u6210\u73af\u4e86\u3002</p> <p>8.\u4f7f\u7528 java+libgdx+box2d \u5199\u6210\uff0c\u4e5f\u5c31\u662f\u8bf4 android \u4e5f\u652f\u6301\u3002</p> <p>9.\u6ca1\u5565\u4e86\u3002\u3002\u3002\u3002</p>","tags":["java","android","libgdx","box2d"]},{"location":"csdn/2014/05/30/intellij-idea-manual-update/","title":"IntelliJ IDEA \u624b\u52a8\u66f4\u65b0\u65b9\u6cd5","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/27704683</p> <p>\u7ecf\u5e38\uff0cIntelliJ IDEA \u66f4\u65b0\u65f6\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a\uff1a</p> <p>download-cf.jetbrains.com/idea/IU-135.690-135.909-patch-win.jar \u4e0b\u8f7d\u4e0d\u4e86\u3002\u4e0d\u7136\u53ea\u80fd\u53bb\u4e0b\u8f7d\u5b8c\u5168\u7248\u91cd\u65b0\u5b89\u88c5\u4e00\u6b21</p> <p>\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1a</p> <p>\u4f7f\u7528\u4ee3\u7406\u4e0b\u8f7d\u4e0a\u9762\u90a3\u4e2a\u6587\u4ef6\uff08\u89c6\u7248\u672c\u800c\u5b9a\uff09\uff0c</p> <p>\u62f7\u8d1d\u5230 IntelliJ IDEA \u5b89\u88c5\u76ee\u5f55\uff0c</p> <p>\u6572\u51fb java -classpath IU-135.690-135.909-patch-win.jar com.intellij.updater.Runner install . </p> <p>\u6ce8\u610f\uff0c\u6700\u540e\u90a3\u4e2a\u70b9\u8868\u793a\u66f4\u65b0\u5230\u5f53\u524d\u76ee\u5f55\u3002</p> <p>\u4f1a\u8f93\u51fa\u8fd9\u4e2a\uff1aException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/log4j/Layo ut         at java.lang.Class.getDeclaredMethods0(Native Method)         at java.lang.Class.privateGetDeclaredMethods(Unknown Source)         at java.lang.Class.getMethod0(Unknown Source)         at java.lang.Class.getMethod(Unknown Source)         at sun.launcher.LauncherHelper.validateMainClass(Unknown Source)         at sun.launcher.LauncherHelper.checkAndLoadMain(Unknown Source) Caused by: java.lang.ClassNotFoundException: org.apache.log4j.Layout         at java.net.URLClassLoader\\(1.run(Unknown Source)         at java.net.URLClassLoader\\)1.run(Unknown Source)         at java.security.AccessController.doPrivileged(Native Method)         at java.net.URLClassLoader.findClass(Unknown Source)         at java.lang.ClassLoader.loadClass(Unknown Source)         at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)         at java.lang.ClassLoader.loadClass(Unknown Source)         ... 6 more</p> <p>\u53d1\u73b0\u5c11\u4e86 log4j\uff0c\u53d1\u73b0 lib \u76ee\u5f55\u4e0b\u5c31\u6709\uff0c\u679c\u65ad\u52a0\u5230 classpath\uff1a</p> <p>java -classpath IU-135.690-135.909-patch-win.jar;.\\lib\\log4j.jar com.intellij.updater.Runner install . \u5f39\u51fa\u5347\u7ea7\u7a97\u53e3\uff0c\u6210\u529f\uff01</p> <p>IntelliJ IDEA \u8bbe\u7f6e\u4ee3\u7406\u5347\u7ea7\u5931\u8d25\uff0c\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406\u4e5f\u5931\u8d25\u3002\u3002\u53ef\u80fd\u662f rp\uff1f\u4f46\u662f\u6d4f\u89c8\u5668\u5c31\u53ef\u4ee5\u3002</p>","tags":["java","intellijidea"]},{"location":"csdn/2014/04/26/linux-on-android/","title":"Linux on Android \u7b80\u5355\u6559\u7a0b","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/24544879</p> <p>\u4ecb\u7ecd\uff1a Linux on Android\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u8ba9\u4f60\u80fd\u5728 Android \u4e0a\u8dd1 linux\u3002\u3002\u3002\u3002</p> <p>\u6b65\u9aa4\uff1a 1.\u4e0b\u8f7d\u6240\u9700\u7684\u6587\u4ef6\uff1a \u9879\u76ee\u4e3b\u9875\u4e3a\uff1atinyurl.com cn3lxgz \u5728\u8fd9\u91cc\u4e3e Ubuntu 13.10 \u4e3a\u4f8b\uff0c\u4e0b\u8f7d tinyurl.com lp7fqw4 Core \u53ea\u6709\u6700\u57fa\u672c\u7684\u4e1c\u897f\uff0c\u6ca1\u754c\u9762\u3002\u3002\u4f46\u662f\u6211\u7684 sd \u5361\u7a7a\u95f4\u8fc7\u5c0f\uff0c\u53ea\u597d\u7528\u8fd9\u4e2a\uff0c Small \u5c31\u6709\u754c\u9762\u4e86\uff0cLarge \u8fd8\u6709\u5f88\u591a\u4e1c\u4e1c\uff0c\u5177\u4f53\u770b tinyurl.com m5tdmkj \u4e0b\u9762\u7684 Readme</p> <p>\u7136\u540e\u4e0b\u8f7d Complete Linux Installer\uff0c\u8fd9\u662f\u7528\u6765\u542f\u52a8 linux \u7684\uff1a tinyurl.com mzsbud8</p> <p>\u8fd8\u8981\u4e0b\u8f7d VNCViewer\uff08\u6d4f\u89c8 linux \u684c\u9762\uff09\uff0c\u7ec8\u7aef\u6a21\u62df\u5668</p> <p>2.\u505a\u597d\u51c6\u5907\u5de5\u4f5c\uff1a \u89e3\u538b\u4e0b\u8f7d\u597d\u7684 zip\uff0c\u628a\u91cc\u9762\u7684.img \u89e3\u538b\u51fa\u6765\u3002 \u5b89\u88c5\u597d Complete Linux Installer VNCViewer \u7ec8\u7aef\u6a21\u62df\u5668\u5230 android \u4e0a\uff0c\u628a\u89e3\u538b\u7684.img \u6587\u4ef6\u4f20\u5230 sd \u5361\u4e0a\uff0c\u6bd4\u5982\uff1a adb push ubuntu-13.10.CORE.ext2.img \u4f60\u7684 sd \u5361\u8def\u5f84</p> <p>\u5b89\u88c5\u5b8c\u662f\u8fd9\u4e2a\u6837\u5b50\u7684\uff1a</p> <p></p> <p>3.\u5f00\u59cb\u542f\u52a8\uff01 \u6253\u5f00 Complete Linux Installer\uff0c \u9009\u62e9\u542f\u52a8\u7cfb\u7edf\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2 Settings\uff0c\u9009\u62e9\u6dfb\u52a0\uff1a</p> <p></p> <p>\u5728\u540d\u79f0\u8f93\u5165\u4f60\u559c\u6b22\u7684\u540d\u79f0\uff0c\u6bd4\u5982 ubuntu\u3002 \u9009\u62e9...\uff0c\u7136\u540e\u9009\u62e9 sd \u5361\u4e0a\u7684 img \u6587\u4ef6\u3002\u4fdd\u5b58\u66f4\u6539</p> <p>\u9009\u62e9\u4f60\u521a\u624d\u521b\u5efa\u7684 ubuntu\uff0c\u70b9\u51fb\u542f\u52a8 linux\uff01</p> <p>\u4f60\u4f1a\u53d1\u73b0\u51fa\u73b0\u4e86\u4e00\u4e2a\u7ec8\u7aef\u6a21\u62df\u5668\u6709\u6ca1\u6709\uff01\uff01</p> <p></p> <p>\u5b8c\u6210\uff01\u4f60\u53ef\u4ee5\u7528 VNCViewer \u53bb\u67e5\u770b\u4ed6\u7684\u754c\u9762\uff1a \u8fde\u63a5 localhost\uff1a5900\u3002</p> <p></p> <p>\u4ec0\u4e48\u90fd\u6ca1\u6709\uff0c\u4ec0\u4e48\u60c5\u51b5\uff01\uff1f\uff01\uff1f \u56e0\u4e3a\u6211\u4e0b\u8f7d\u7684\u662f Core \u554a\uff01\u4ec0\u4e48\u90fd\u6ca1\u6709\u554a\u554a\u554a\u554a\u3002\u3002\u3002\u3002 \u5982\u679c\u4e0b\u8f7d\u7684\u662f\u522b\u7684\uff0c\u90a3\u4f30\u8ba1\u5df2\u7ecf\u6709\u754c\u9762\u4e86\u3002\u3002</p> <p>\u5982\u679c\u6ca1\u6cd5\u8fde\u63a5\u5230\uff0c\u8bf7\u5728\u7ec8\u7aef\u6a21\u62df\u5668\u8f93\u5165 vncserver \u5e76\u56de\u8f66\uff0c\u7136\u540e VNC \u8fde\u63a5 5901 \u7aef\u53e3\u5373\u53ef\uff01</p>","tags":["android","ubuntu","linuxonandroid"]},{"location":"csdn/2014/09/20/math/","title":"\u7528\u6570\u5b66\u65b9\u6cd5 + \u6570\u5b66\u8f6f\u4ef6\u53bb\u505a\u4e00\u4e2a\u7269\u7406\u9898~","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/39433177</p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0\u5fae\u4fe1\u5ba2\u6237\u7aef\u767b\u5f55 SDK \u6709\u4e00\u4e2a BUG\u3002\u6ce8\uff1a\u76ee\u524d\u53ea\u5728 iOS \u4e0a\u6d4b\u8bd5\u8fc7\uff0c\u53ef\u4ee5\u91cd\u73b0\u3002</p> <p>\u539f\u9898\uff1a</p> <p>\u8df3\u4f1e\u8fd0\u52a8\u5458\u5728\u4e0b\u843d\u8fc7\u7a0b\u4e2d\uff0c\u5047\u5b9a\u4f1e\u6240\u53d7\u7a7a\u6c14\u963b\u529b\u5927\u5c0f\u8ddf\u4e0b\u843d\u901f\u5ea6\u7684\u5e73\u65b9\u6210\u6b63\u6bd4\uff0c\u5373 F= kv2\uff0c\u6bd4\u4f8b\u7cfb\u6570 k=20N\u00b7s2/m2\uff0c\u8df3\u4f1e\u8fd0\u52a8\u5458\u4e0e\u4f1e\u7684\u603b\u8d28\u91cf\u4e3a 72 kg\uff0c\u8d77\u8df3\u9ad8\u5ea6\u8db3\u591f\u9ad8\uff0c\u5219\uff1a\uff08g \u53d6 10 m/s2\uff09 </p> <ol> <li>\u8df3\u4f1e\u8fd0\u52a8\u5458\u5728\u7a7a\u4e2d\u505a\u4ec0\u4e48\u8fd0\u52a8\uff1f\u6536\u5c3e\u901f\u5ea6\u591a\u5927\uff1f </li> <li>\u5f53\u901f\u5ea6\u8fbe\u5230 4 m/s\u65f6\uff0c\u4e0b\u843d\u52a0\u901f\u5ea6\u662f\u591a\u5927\uff1f</li> </ol> <p>\u505a\u6cd5\uff1a</p> <p>\u6211\u62ff\u51fa\u6211\u7684\u6570\u5b66\u5927\u6740\u5668\uff0c\u76f4\u63a5\u53d7\u529b\u5206\u6790 + \u725b\u987f\u7b2c\u4e8c\u5b9a\u5f8b\u5f97\u51fa a=g-k/mvv. \u6211\u4e00\u770b\uff0c\u8fd9\u8f6c\u5316\u6210\u6570\u5b66\u4e0d\u5c31\u662f f''(t)=10-5/18*f'(t)^2, f(0)=0, f'(0)=0\uff0c\u559c\u95fb\u4e50\u89c1\u7684\u5fae\u5206\u65b9\u7a0b\u554a\u54c8\u54c8\uff01</p> <p>\u76f4\u63a5\u4e22\u5230\u5404\u79cd\u6570\u5b66\u8f6f\u4ef6\uff0c\u6211\u7528\u4e86Wolfram|Alpha</p> <p>\u77ac\u95f4\u5f97\u5230\u7b54\u6848\uff1a f(t) = -6/5 (5 t-3 log(e^(10 t/3)+1)+log(8)) yeah~</p> <p>\u770b\u770b\u4e0a\u9762\u90a3\u4e2a\u7f51\u5740\u91cc\u9762\u4e0b\u9762\u7684\u51fd\u6570\u56fe\u50cf\uff0c\u8868\u793a\u7b2c\u4e00\u9898\u53ef\u4ee5\u79d2\u6740~</p> <p>\u597d\u7684\uff0c\u81f3\u4e8e\u7b2c\u4e8c\u9898\uff0c\u56e0\u4e3a\u901f\u5ea6\u4e3a 4\uff0c\u5219\u53ef\u4ee5\u5199\u51fa\uff1af'(t)=4 \u7684\u65b9\u7a0b\uff0c\u8f93\u5165 d(-6/5 (5 t-3 log(e^(10 t/3)+1)+log(8)))/dt=4 \u89e3\u51fa t = (3 log(5))/10 \u5e26\u5165 f''(t)\uff0c\u8f93\u5165 diff(diff(-6/5 (5 t-3 log(e^(10 t/3)+1)+log(8)),t),t),t=(3 log(5))/10\uff0c \u5f97 a=5.5556.</p> <p>\u5927\u529f\u9020\u6210~</p>","tags":["math","wolframalpha"]},{"location":"csdn/2014/10/06/weixin-sdk-bug/","title":"\"@\u5fae\u4fe1 SDK \u5f00\u53d1\u8005\uff0c\u53d1\u73b0\u4e00\u4e2a BUG~\"","text":"<p>\u8fc1\u79fb\u81ea\u672c\u4eba\u5728 CSDN \u4e0a\u7684\u535a\u5ba2\uff1ahttps://blog.csdn.net/build7601/article/details/39826065</p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0\u5fae\u4fe1\u5ba2\u6237\u7aef\u767b\u5f55 SDK \u6709\u4e00\u4e2a BUG\u3002\u6ce8\uff1a\u76ee\u524d\u53ea\u5728 iOS \u4e0a\u6d4b\u8bd5\u8fc7\uff0c\u53ef\u4ee5\u91cd\u73b0\u3002</p> <p>BUG \u91cd\u73b0</p> <p>1.\u505a\u4e00\u4e2a\u53ef\u4ee5\u7528\u5fae\u4fe1\u767b\u9646\u7684\u8f6f\u4ef6\uff0c\u5148\u5b89\u88c5\u5230\u8bbe\u5907\u3002 2.\u66f4\u6539 project \u7684 Bundle Identifier\uff0c\u53ea\u66f4\u6539\u5927\u5c0f\u5199\uff0c\u91cd\u65b0\u5b89\u88c5\u5230\u8bbe\u5907\u3002P.S.\u5b9e\u9645\u60c5\u51b5\u662f\u5305\u540d\u5927\u5c0f\u5199\u4fee\u6539\u8fc7\u5f15\u53d1\u8fd9\u4e2a\u95ee\u9898\u3002 3.\u6253\u5f00\u7b2c\u4e8c\u4e2a\u5b89\u88c5\u7684 APP\uff0c\u9009\u62e9\u5fae\u4fe1\u767b\u9646\uff0c\u8df3\u8f6c\u5230\u5fae\u4fe1\u3002 4.\u70b9\u51fb\u5fae\u4fe1\u767b\u9646\uff0c\u5219\u4f1a\u8df3\u8f6c\u5230\u7b2c\u4e00\u4e2a APP \u4e2d\uff0c\u800c\u4e0d\u4f1a\u8df3\u8f6c\u5230\u7b2c\u4e8c\u4e2a APP\u3002</p> <p>\u6211\u7684 BUG \u5206\u6790</p> <p>\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\uff0c\u5fae\u4fe1 sdk \u4f20\u5230\u5fae\u4fe1\u7684\u662f\u4e00\u4e2a bundle identifier+\u56de\u8c03\u51fd\u6570\u5730\u5740\uff0c\u56de\u8c03\u65f6\u627e\u5230\u53e6\u4e00\u4e2a APP \u518d\u6267\u884c\u56de\u8c03\u3002 \u53ef\u80fd\u5728\u67d0\u5904\u8fdb\u7a0b\u7684\u540d\u79f0\u4e0d\u5206\u5927\u5c0f\u5199\uff0c\u6309\u7167\u987a\u5e8f\u627e\u5230\u4e86\u7b2c\u4e00\u4e2a\u53bb\u4e86\u3002\u4e00\u65e6\u4e24\u4e2a APP \u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u53ef\u80fd\u6267\u884c\u5230\u7a7a\u7684\u5730\u5740\u751a\u81f3\u53d1\u751f\u4e0d\u53ef\u9884\u6d4b\u7684\u884c\u4e3a\u3002 \u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0\u540c\u4e00\u6837\u7684\u7248\u672c\u7684 APP \u4e5f\u53d1\u751f\u4e86\u5d29\u6e83\u3002</p>","tags":["java","intellijidea","android","androidstudio"]},{"location":"ctf/2018/10/04/2018-10-04-thuctf-2018-and-teaser-dragon-ctf-2018/","title":"THUCTF 2018 \u548c Teaser Dragon CTF 2018 \u5c0f\u8bb0","text":"<p>\u7ec8\u4e8e\u53ef\u4ee5\u516c\u5f00 writeup \u4e86\uff0c\u5927\u5bb6\u4e5f\u53ef\u4ee5\u53bb\u770b twd2 \u5199\u7684 writeup \u3002\u8fd9\u6b21\u662f\u6211\u7b2c\u4e00\u6b21\u6253 CTF\uff0c\u53d1\u73b0\u9898\u76ee\u8fd8\u633a\u6709\u610f\u601d\u7684\uff0c\u867d\u7136\u4e5f\u6709\u4e00\u4e9b\u9898\u76ee\u505a\u4e0d\u51fa\u6765\uff0c\u6709\u62ff\u94b1\u8fd8\u662f\u7f8e\u6ecb\u6ecb\u3002</p> <p>\u8fd9\u6b21\u4e5f\u8ba4\u8bc6\u4e86\u597d\u4e9b\u4f1a\u6253 CTF \u7684\u4eba\u5427\uff0c\u5982 0x00, user1, igoodvegetable \u7b49\u961f\u4f0d\u7684\u540c\u5b66\u3002\u4e00\u5f00\u59cb\u88ab\u86e4\u529b\u6a59\u53eb\u6765\u6253\u6bd4\u8d5b\uff0c\u6211\u89c9\u5f97\u5fc3\u91cc\u633a\u6ca1\u5e95\u7684\uff0c\u7136\u540e\u82b1\u4e86\u5f88\u591a\u65f6\u95f4\u505a\u9898\u76ee\uff0c\u4e00\u70b9\u4e00\u70b9\u8fd8\u662f\u505a\u51fa\u4e86\u4e0d\u5c11\u9898\u76ee\u6765\u3002\u6700\u7cbe\u5f69\u7684\u8fd8\u662f\u7ed3\u675f\u4ee5\u540e\uff0c\u5f53\u77e5\u6653\u6ca1\u505a\u51fa\u6765\u7684\u9898\u76ee\u7684\u505a\u6cd5\u65f6\u5019\uff0c\u4f1a\u4e0d\u81ea\u89c9\u611f\u53f9\u9898\u76ee\u7684\u5de7\u5999\u3002\u4e5f\u5b66\u5230\u4e86\u4e00\u4e9b\u6897\uff1a</p> <pre><code>#define 1000000007 twd2\n</code></pre> <p>\u63a5\u7740\u5c31\u53c2\u4e0e\u4e86\u4e00\u4e0b Teaser Dragon CTF 2018\uff0c\u662f\u4e2a\u5728\u7ebf\u8d5b\uff0c\u8bb8\u591a\u4eba\u4e00\u8d77\u505a\u9898\uff0c\u53ea\u6709 24 \u5c0f\u65f6\u3002\u770b\u4e86\u4e0b\u9898\u76ee\uff0c\u9664\u4e86\u7b7e\u5230\u9898\uff0c\u5176\u5b83\u9898\u90fd\u6bd4 THUCTF 2018 \u96be\u591a\u4e86\uff0c\u6211\u53ea\u80fd\u56f4\u89c2\u4ed6\u4eec\u505a\u9898\u3002\u6700\u540e\u770b\u5230\u522b\u4eba\u5199\u7684 writeup\uff0c\u771f\u662f\u592a\u5de7\u5999\u4e86\uff0c\u4e00\u73af\u63a5\u4e00\u73af\uff0c\u771f\u7684\u60f3\u4e0d\u5230\u3002\u4e0d\u8fc7\u4e5f\u6709\u5f88\u9ebb\u70e6\u7684\u9898\u76ee\uff0c\u7279\u522b\u662f\u6709\u7684\u9006\u5411\u7684\u9898\u76ee\uff0c\u592a\u8003\u9a8c\u4eba\u7684\u8010\u5fc3\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u7b49\u5f85\u5b98\u65b9\u7684 writeup \u548c\u522b\u4eba\u7684 writeup\uff0c\u5b66\u4e60\u4e00\u4e0b\u522b\u4eba\u7684\u505a\u6cd5\u5427\u3002</p>","tags":["ctf","thuctf"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/","title":"\u5728 rpi4 \u4e0a\u7528 PXE \u8fd0\u884c Alpine Linux","text":"","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u9700\u8981\u7ed9 rpi \u914d\u7f6e\u4e00\u4e2a pxe \u7684\u6700\u5c0f\u73af\u5883\uff0c\u7136\u540e\u770b\u5230 alpine \u6709 rpi \u7684\u652f\u6301\uff0c\u6240\u4ee5\u5c1d\u8bd5\u7ed9 rpi4 \u914d\u7f6e alpine\u3002</p>","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/#pxe-\u8bbe\u7f6e","title":"PXE \u8bbe\u7f6e","text":"<p>\u7b2c\u4e00\u6b65\u662f\u8bbe\u7f6e rpi4 \u7684\u542f\u52a8\u6a21\u5f0f\uff0c\u6253\u5f00 BOOT UART \u5e76\u4e14\u6253\u5f00 \u7f51\u7edc\u542f\u52a8\uff1a</p> <pre><code>&gt; cd /lib/firmware/raspberrypi/bootloader/critical\n&gt; rpi-eeprom-config pieeprom-2021-04-29.bin &gt; config.txt\n$ cat config.txt\n[all]\nBOOT_UART=1\nWAKE_ON_GPIO=1\nPOWER_OFF_ON_HALT=0\nDHCP_TIMEOUT=45000\nDHCP_REQ_TIMEOUT=4000\nTFTP_FILE_TIMEOUT=30000\nTFTP_IP=\nTFTP_PREFIX=0\nBOOT_ORDER=0x1\nSD_BOOT_MAX_RETRIES=3\nNET_BOOT_MAX_RETRIES=5\n[none]\nFREEZE_VERSION=0\n&gt; sed 's/BOOT_UART=0/BOOT_UART=1/;s/BOOT_ORDER=0x1/BOOR_ORDER=0x12/' config.txt &gt; config-pxe.txt\n&gt; rpi-eeprom-config --out pieeprom-2021-04-29-pxe.bin --config config-pxe.txt pieeprom-2021-04-29.bin\n&gt; rpi-eeprom-update -d -f pieeprom-2021-04-29-pxe.bin\n&gt; reboot\n</code></pre> <p>\u91cd\u542f\u4ee5\u540e\uff0c\u53ef\u4ee5\u7528 <code>vcgencmd bootloader_config</code> \u67e5\u770b\u5f53\u524d\u7684\u542f\u52a8\u914d\u7f6e\uff0c\u770b\u662f\u5426\u6b63\u786e\u5730\u66f4\u65b0\u4e86\u542f\u52a8\u914d\u7f6e\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u662f BOOT_ORDER\uff0c<code>0x12</code> \u8868\u793a\u5148\u5c1d\u8bd5\u7f51\u7edc\u542f\u52a8\uff0c\u518d\u5c1d\u8bd5 SD \u5361\u542f\u52a8\u3002</p>","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/#\u8def\u7531\u5668\u914d\u7f6e","title":"\u8def\u7531\u5668\u914d\u7f6e","text":"<p>\u7b2c\u4e8c\u6b65\uff0c\u9700\u8981\u914d\u7f6e\u8def\u7531\u5668\uff0c\u4ee5 OpenWrt \u4e3a\u4f8b\uff1a</p> <pre><code>&gt; uci add_list dhcp.lan.dhcp_option=\"66,ip_address_of_tftp_server\"\n&gt; uci commit dhcp\n&gt; /etc/init.d/dnsmasq restart\n$ cat /etc/config/dhcp\n...\nconfig dhcp 'lan'\n        ...\n    list dhcp_option '66,ip_address_of_tftp_server'\n...\n</code></pre> <p>\u8fd9\u6837\u5c31\u914d\u7f6e\u5b8c\u6bd5\u4e86\u3002\u5982\u679c\u662f isc-dhcp-server\uff0c\u4fee\u6539 <code>/etc/dhcp/dhcpd.conf</code>\uff1a</p> <pre><code>subnet 10.0.1.0 netmask 255.255.255.0 {\n    range 10.0.1.100 10.0.1.199;\n    option routers 10.0.1.1;\n    option tftp-server-name \"10.0.1.1\";\n}\n</code></pre>","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/#tftp-\u670d\u52a1\u5668\u914d\u7f6e","title":"TFTP \u670d\u52a1\u5668\u914d\u7f6e","text":"<p>\u4e0b\u8f7d alpine linux \u7684 rpi boot\uff0c\u89e3\u538b\u5230\u6307\u5b9a\u76ee\u5f55\uff1a</p> <pre><code>&gt; wget http://mirrors.tuna.tsinghua.edu.cn/alpine/v3.12/releases/aarch64/alpine-rpi-3.12.0-aarch64.tar.gz\n&gt; unar alpine-rpi-3.12.0-aarch64.tar.gz\n&gt; cd alpine-rpi-3.12.0-aarch64\n</code></pre> <p>\u4fee\u6539 <code>cmdline.txt</code> \uff0c\u628a <code>console=tty1</code> \u6539\u6210 <code>console=ttyAMA0,115200</code>\uff0c\u5e76\u4e14\u53bb\u6389 <code>quiet</code>\uff1b\u4fee\u6539 <code>usercfg.txt</code> \u4e3a\uff1a</p> <pre><code>dtoverlay=disable-bt\nenable_uart=1\n</code></pre> <p>\u63a5\u7740\uff0c\u542f\u52a8 TFTP \u670d\u52a1\u5668\uff1a</p> <pre><code>&gt; sudo python3 -m py3tftp -p 69\n</code></pre>","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/11/alpine-rpi-pxe/#\u6811\u8393\u6d3e\u542f\u52a8","title":"\u6811\u8393\u6d3e\u542f\u52a8","text":"<p>\u8fde\u63a5\u6811\u8393\u6d3e\u7684\u4e32\u53e3\uff0c\u7528 115200 Baudrate \u6253\u5f00\uff0c\u53ef\u4ee5\u770b\u5230\u542f\u52a8\u4fe1\u606f\uff1a</p> <pre><code>PM_RSTS: 0x00001000\nRPi: BOOTLOADER release VERSION:a5e1b95f DATE: Apr 16 2020 TIME: 18:11:29 BOOTMODE: 0x00000006 part: 0 BUILD_TIMESTAMP=1587057086 0xa049cc2f 0x00c03111\nuSD voltage 3.3V\n... \ninitramfs emergency recovery shell launched. Type 'exit' to continue boot\nsh: can't access tty; job control turned off\n/ #\n</code></pre> <p>\u7136\u540e\uff0c\u6309\u7167\u9700\u8981\u81ea\u5b9a\u4e49 initramfs \u5373\u53ef\u3002\u89e3\u538b\u540e\uff0c\u4fee\u6539\u6587\u4ef6\uff0c\u7136\u540e\u8fd0\u884c\uff1a</p> <pre><code>&gt; find . -print0 | cpio --null -ov --format=newc | gzip &gt; ../initramfs-rpi4\n</code></pre> <p>\u628a\u81ea\u5e26\u7684 initramfs \u66ff\u6362\u6389\u3002</p>","tags":["alpine","pxe","rpi","rpi4"]},{"location":"devops/2020/09/12/buildroot-rpi-pxe/","title":"\u5728 Rpi4 \u4e0a\u8fd0\u884c buildroot","text":"","tags":["buildroot","pxe","rpi","rpi4"]},{"location":"devops/2020/09/12/buildroot-rpi-pxe/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u9700\u8981\u7ed9 rpi \u914d\u7f6e\u4e00\u4e2a pxe \u7684\u6700\u5c0f\u73af\u5883\uff0c\u5728\u4e0a\u4e00\u7bc7\u535a\u6587\u4e86\u63d0\u5230\u53ef\u4ee5\u7528 alpine\uff0c\u4f46\u53d1\u73b0\u6709\u4e00\u4e9b\u4e0d\u597d\u7528\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u8bd5\u4e86\u8bd5 buildroot\u3002</p>","tags":["buildroot","pxe","rpi","rpi4"]},{"location":"devops/2020/09/12/buildroot-rpi-pxe/#pxe-\u8bbe\u7f6e\u548c\u8def\u7531\u5668\u8bbe\u7f6e","title":"PXE \u8bbe\u7f6e\u548c\u8def\u7531\u5668\u8bbe\u7f6e","text":"<p>\u89c1\u201c\u5728 Rpi4 \u4e0a\u8fd0\u884c Alpine Linux\u201d\u6587\u7ae0\u3002</p>","tags":["buildroot","pxe","rpi","rpi4"]},{"location":"devops/2020/09/12/buildroot-rpi-pxe/#buildroot-\u914d\u7f6e","title":"Buildroot \u914d\u7f6e","text":"<p>\u4e0b\u8f7d buildroot\uff1a</p> <pre><code>&gt; wget https://buildroot.org/downloads/buildroot-2020.08.tar.gz\n&gt; unar buildroot-2020.08.tar.gz\n&gt; cd buildroot-2020.08\n&gt; make raspberrypi4_64_defconfig\n</code></pre> <p>\u7136\u540e\u8fd0\u884c <code>make menuconfig</code> \uff0c\u5728 <code>Filesystem images</code> \u4e2d\u6253\u5f00 initramfs\uff0c\u5e76\u8bbe\u7f6e cpio \u538b\u7f29\u4e3a gz\u3002\u7136\u540e\u76f4\u63a5\u7f16\u8bd1\uff1a</p> <pre><code>&gt; make -j4\n$ ls -al target/images\nbcm2711-rpi-4-b.dtb*  boot.vfat  Image  rootfs.cpio  rootfs.cpio.gz  rootfs.ext2  rootfs.ext4@  rpi-firmware/  sdcard.img\n</code></pre> <p>\u63a5\u7740\uff0c\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u5f55\u91cc\uff0c\u628a\u8fd9\u4e9b\u6587\u4ef6\u6574\u7406\u4e00\u4e0b</p> <pre><code>&gt; cd ~/rpi-buildroot\n&gt; cp -r ~/buildroot-2020.08/output/images/rpi-firmware/* .\n&gt; cp ~/buildroot-2020.08/output/images/bcm2711-rpi-4-b.dtb .\n&gt; cp ~/buildroot-2020.08/output/images/Image .\n&gt; cp ~/buildroot-2020.08/output/images/rootfs.cpio.gz .\n&gt; # edit cmdline.txt: remove root= and rootwait\n&gt; # edit config.txt: uncomment initramfs rootfs.cpio.gz line\n# ls\nbcm2711-rpi-4-b.dtb*  cmdline.txt  config.txt  fixup.dat  Image  overlays/  rootfs.cpio.gz  start.elf\n</code></pre> <p>\u6700\u540e\u5f00\u542f TFTP \u670d\u52a1\u5668\u5373\u53ef\uff1a</p> <pre><code>&gt; sudo python3 -m py3tftp -p 69\n</code></pre>","tags":["buildroot","pxe","rpi","rpi4"]},{"location":"devops/2020/09/12/buildroot-rpi-pxe/#\u6811\u8393\u6d3e\u542f\u52a8","title":"\u6811\u8393\u6d3e\u542f\u52a8","text":"<p>\u8fde\u63a5\u6811\u8393\u6d3e\u7684\u4e32\u53e3\uff0c\u7528 115200 Baudrate \u6253\u5f00\uff0c\u53ef\u4ee5\u770b\u5230\u542f\u52a8\u4fe1\u606f\uff1a</p> <pre><code>PM_RSTS: 0x00001000\nRPi: BOOTLOADER release VERSION:a5e1b95f DATE: Apr 16 2020 TIME: 18:11:29 BOOTMODE: 0x00000006 part: 0 BUILD_TIMESTAMP=1587057086 0xa049cc2f 0x00c03111\nuSD voltage 3.3V\n... \nWelcome to Buildroot\nbuildroot login: root\n#\n</code></pre> <p>\u9ed8\u8ba4\u7528\u6237\u662f root\uff0c\u6ca1\u6709\u5bc6\u7801\u3002</p>","tags":["buildroot","pxe","rpi","rpi4"]},{"location":"devops/2022/07/16/ceph-cookbook/","title":"Ceph Cookbook","text":"","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u6982\u5ff5","title":"\u6982\u5ff5","text":"<ul> <li>OSD\uff1a\u8d1f\u8d23\u64cd\u4f5c\u786c\u76d8\u7684\u7a0b\u5e8f\uff0c\u4e00\u4e2a\u786c\u76d8\u4e00\u4e2a OSD</li> <li>MON\uff1a\u7ba1\u7406\u96c6\u7fa4\u72b6\u6001\uff0c\u6bd4\u8f83\u91cd\u8981\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u8282\u70b9\u4e0a\u5404\u8dd1\u4e00\u4e2a</li> <li>MGR\uff1a\u76d1\u6d4b\u96c6\u7fa4\u72b6\u6001</li> <li>RGW(optional)\uff1a\u63d0\u4f9b\u5bf9\u8c61\u5b58\u50a8 API</li> <li>MDS(optional)\uff1a\u63d0\u4f9b CephFS</li> </ul> <p>\u4f7f\u7528 Ceph \u505a\u5b58\u50a8\u7684\u65b9\u5f0f\uff1a</p> <ol> <li>librados: \u5e93</li> <li>radosgw: \u5bf9\u8c61\u5b58\u50a8 HTTP API</li> <li>rbd: \u5757\u5b58\u50a8</li> <li>cephfs: \u6587\u4ef6\u7cfb\u7edf</li> </ol>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u8ba4\u8bc1","title":"\u8ba4\u8bc1","text":"<p>Ceph \u5ba2\u6237\u7aef\u8ba4\u8bc1\u9700\u8981\u7528\u6237\u540d + \u5bc6\u94a5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u540d\u662f <code>client.admin</code>\uff0c\u5bc6\u94a5\u8def\u5f84\u662f <code>/etc/ceph/ceph.\u7528\u6237\u540d.keyring</code>\u3002<code>ceph --user abc</code> \u8868\u793a\u4ee5\u7528\u6237 <code>client.abc</code> \u7684\u8eab\u4efd\u8bbf\u95ee\u96c6\u7fa4\u3002</p> <p>\u7528\u6237\u7684\u6743\u9650\u662f\u6309\u7167\u670d\u52a1\u7c7b\u578b\u51b3\u5b9a\u7684\u3002\u53ef\u4ee5\u7528 <code>ceph auth ls</code> \u663e\u793a\u6240\u6709\u7684\u7528\u6237\u4ee5\u53ca\u6743\u9650\uff1a</p> <pre><code>$ ceph auth ls\nosd.0\n        key: REDACTED\n        caps: [mgr] allow profile osd\n        caps: [mon] allow profile osd\n        caps: [osd] allow *\nclient.admin\n        key: REDACTED\n        caps: [mds] allow *\n        caps: [mgr] allow *\n        caps: [mon] allow *\n        caps: [osd] allow *\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c<code>osd.0</code> \u5bf9 OSD \u6709\u6240\u6709\u6743\u9650\uff0c\u5bf9 mgr \u548c mon \u90fd\u53ea\u6709 osd \u76f8\u5173\u529f\u80fd\u7684\u6743\u9650\uff1b<code>client.admin</code> \u6709\u6240\u6709\u6743\u9650\u3002<code>profile</code> \u53ef\u4ee5\u8ba4\u4e3a\u662f\u9884\u5b9a\u4e49\u7684\u4e00\u4e9b\u6743\u9650\u96c6\u5408\u3002</p> <p>\u65b0\u5efa\u7528\u6237\u5e76\u8d4b\u4e88\u6743\u9650\uff1a</p> <pre><code>ceph auth get-or-create client.abc mon 'allow r'\n</code></pre> <p>\u4fee\u6539\u6743\u9650\uff1a</p> <pre><code>ceph auth caps client.abc mon 'allow rw'\n</code></pre> <p>\u83b7\u53d6\u6743\u9650\uff1a</p> <pre><code>ceph auth get client.abc\n</code></pre> <p>\u5220\u9664\u7528\u6237\uff1a</p> <pre><code>ceph auth print-key client.abc\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#osd","title":"OSD","text":"<p>\u7ba1\u7406 OSD \u5b9e\u9645\u4e0a\u5c31\u662f\u7ba1\u7406\u5b58\u50a8\u6570\u636e\u7684\u786c\u76d8\u3002</p> <p>\u67e5\u770b\u72b6\u6001\uff1a</p> <pre><code>ceph osd stat\n</code></pre> <p>\u663e\u793a\u6709\u591a\u5c11\u4e2a\u5728\u7ebf\u548c\u79bb\u7ebf\u7684 OSD\u3002</p> <pre><code>ceph osd tree\n</code></pre> <p>\u663e\u793a\u4e86\u5b58\u50a8\u7684\u5c42\u7ea7\uff0c\u5176\u4e2d ID \u975e\u8d1f\u6570\u662f\u5b9e\u9645\u7684 OSD\uff0c\u8d1f\u6570\u662f\u5176\u4ed6\u5c42\u7ea7\uff0c\u4f8b\u5982\u5b58\u50a8\u6c60\uff0c\u673a\u67dc\uff0c\u4e3b\u673a\u7b49\u7b49\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#crush","title":"CRUSH","text":"<p>CRUSH \u662f\u4e00\u4e2a\u7b97\u6cd5\uff0c\u6307\u5b9a\u4e86\u5982\u4f55\u7ed9 PG \u5206\u914d OSD\uff0c\u5230\u4ec0\u4e48\u7c7b\u578b\u7684\u8bbe\u5907\uff0c\u786e\u5b9a\u5b83\u7684 failure domain \u7b49\u7b49\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6307\u5b9a failure domain \u4e3a host\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u5206\u914d\u5230\u4e0d\u540c host \u4e0a\u7684 osd\uff0c\u8fd9\u6837\u4e00\u4e2a host \u6302\u4e86\u4e0d\u81f3\u4e8e\u5168\u519b\u8986\u6ca1\u3002\u7c7b\u4f3c\u5730\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u5b9a\u66f4\u591a\u7ea7\u522b\u7684 failure domain\uff0c\u4f8b\u5982 row\uff0crack\uff0cchassis \u7b49\u7b49\u3002</p> <p>OSD \u53ef\u4ee5\u8bbe\u7f6e\u5b83\u7684 CRUSH Location\uff0c\u5728 ceph.conf \u4e2d\u5b9a\u4e49\u3002</p> <p>\u4e3a\u4e86\u914d\u7f6e\u6570\u636e\u7f6e\u653e\u7684\u89c4\u5219\uff0c\u9700\u8981\u8bbe\u7f6e CRUSH Rule\u3002</p> <p>\u5217\u4e3e CRUSH Rule\uff1a</p> <pre><code>ceph osd crush rule ls\nceph osd crush rule dump\n</code></pre> <p>\u67e5\u770b CRUSH \u5c42\u7ea7\uff1a</p> <pre><code>ceph osd crush tree --show-shadow\n</code></pre> <p>\u5728\u91cc\u9762\u53ef\u80fd\u4f1a\u770b\u5230 <code>default~ssd</code>\uff0c\u5b83\u6307\u7684\u610f\u601d\u5c31\u662f\u53ea\u4fdd\u7559 default \u4e0b\u9762\u7684 ssd \u8bbe\u5907\u3002</p> <p>\u6587\u672c\u5f62\u5f0f\u5bfc\u51fa CRUSH \u914d\u7f6e\uff1a</p> <pre><code>ceph osd getcrushmap | crushtool -d - -o crushmap\ncat crushmap\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 Rule \u7684\u5b9a\u4e49\uff0c\u5982\uff1a</p> <pre><code># simple replicated\nrule replicated_rule {\n        id 0\n        # a replicated rule\n        type replicated\n        # iterate all devices of \"default\"\n        step take default\n        # select n osd with failure domain \"osd\"\n        # firstn: continuous\n        step chooseleaf firstn 0 type osd\n        step emit\n}\n\n# erasure on hdd\nrule erasure-hdd {\n        id 4\n        # an erasure rule\n        type erasure\n        # try more times to find a good mapping\n        step set_chooseleaf_tries 5\n        step set_choose_tries 100\n        # iterate hdd devices of \"default\", i.e. \"default~hdd\"\n        step take default class hdd\n        # select n osd with failure domain \"osd\"\n        # indep: replace failed osd with another\n        step choose indep 0 type osd\n        step emit\n}\n\n# replicated on hdd\nrule replicated-hdd-osd {\n        id 5\n        # a replicated rule\n        type replicated\n        # iterate hdd devices of \"default\", i.e. \"default~hdd\"\n        step take default class hdd\n        # select n osd with failure domain \"osd\"\n        # firstn: continuous\n        step choose firstn 0 type osd\n        step emit\n}\n\n# replicated on different hosts\nrule replicated-host {\n        id 6\n        # a replicated rule\n        type replicated\n        # iterate all devices of \"default\"\n        step take default\n        # select n osd with failure domain \"host\"\n        # firstn: continuous\n        step chooseleaf firstn 0 type host\n        step emit\n}\n\n# replicate one on ssd, two on hdd\nrule replicated-ssd-primary {\n        id 7\n        # a replicated rule\n        type replicated\n\n        # iterate ssd devices of \"default\"\n        step take default class ssd\n        step chooseleaf firstn 1 type host\n        step emit\n\n        # iterate hdd devices of \"default\"\n        step take default class hdd\n        step chooseleaf firstn 2 type host\n        step emit\n}\n</code></pre> <p>choose \u548c chooseleaf \u7684\u533a\u522b\u662f\uff0c\u524d\u8005\u53ef\u4ee5 choose \u5230\u4e2d\u95f4\u5c42\u7ea7\uff0c\u4f8b\u5982\u5148\u9009\u62e9 host\uff0c\u518d\u5728 host \u91cc\u9762\u9009 osd\uff1b\u800c chooseleaf \u662f\u76f4\u63a5\u627e\u5230 osd\u3002\u6240\u4ee5 <code>choose type osd</code> \u548c <code>chooseleaf type osd</code> \u662f\u7b49\u4ef7\u7684\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a\u641c\u7d22\u6761\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u4f8b\u5982\u627e\u5230\u4e86\u67d0\u4e00\u4e2a host\uff0c\u91cc\u9762\u7684 osd \u4e2a\u6570\u4e0d\u591f\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u641c\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2a Replicated CRUSH Rule\uff1a</p> <pre><code># root=default, failure domain=osd\nceph osd crush rule create-replicated xxx default osd\n# root=default, failure domain=host, class=ssd\nceph osd crush rule create-replicated yyy default host ssd\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86 device class\uff0c\u5b83\u53ea\u4f1a\u5728\u5bf9\u5e94\u7c7b\u578b\u7684\u8bbe\u5907\u4e0a\u5b58\u50a8\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#pool","title":"Pool","text":"<p>Pool \u662f\u5b58\u50a8\u6c60\uff0c\u540e\u7eed\u7684 RBD/CephFS \u529f\u80fd\u90fd\u9700\u8981\u6307\u5b9a\u5b58\u50a8\u6c60\u6765\u5de5\u4f5c\u3002</p> <p>\u521b\u5efa\u5b58\u50a8\u6c60\uff1a</p> <pre><code>ceph osd pool create xxx\nceph osd pool create PG_NUM\n</code></pre> <p>\u4e3a\u4e86\u6027\u80fd\u8003\u8651\uff0c\u53ef\u4ee5\u8bbe\u7f6e PG\uff08Placement Group\uff09\u6570\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f1a\u521b\u5efa replicated \u7c7b\u578b\u7684\u5b58\u50a8\u6c60\uff0c\u4e5f\u5c31\u662f\u4f1a\u5b58\u591a\u4efd\uff0c\u7c7b\u4f3c RAID1\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u6210 erasure \u7c7b\u578b\u7684\u5b58\u50a8\u6c60\uff0c\u7c7b\u4f3c RAID5\u3002</p> <p>\u6bcf\u4e2a Placement Group \u91cc\u7684\u6570\u636e\u4f1a\u4fdd\u5b58\u5728\u540c\u4e00\u7ec4 OSD \u4e2d\u3002\u6570\u636e\u901a\u8fc7 hash\uff0c\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u7684 PG \u91cc\u3002</p> <p>\u5217\u4e3e\u6240\u6709\u7684\u5b58\u50a8\u6c60\uff1a</p> <pre><code>ceph osd lspools\n</code></pre> <p>\u67e5\u770b\u5b58\u50a8\u6c60\u7684\u4f7f\u7528\u91cf\uff1a</p> <pre><code>rados df\n</code></pre> <p>\u5b58\u50a8\u6c60\u7684 IO \u72b6\u6001\uff1a</p> <pre><code>ceph osd pool stats\n</code></pre> <p>\u5bf9\u5b58\u50a8\u6c60\u505a\u5feb\u7167\uff1a</p> <pre><code>ceph osd mksnap xxx snap-xxx-123\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#pg","title":"PG","text":"<p>PG \u662f\u6570\u636e\u5b58\u653e\u7684\u7ec4\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u4f1a\u653e\u5230\u4e00\u4e2a PG \u91cc\u9762\uff0c\u800c PG \u4f1a\u51b3\u5b9a\u5b83\u4fdd\u5b58\u5230\u54ea\u4e9b OSD \u4e0a\uff08\u5177\u4f53\u54ea\u4e9b OSD \u662f\u7531 CRUSH \u51b3\u5b9a\u7684\uff09\u3002PG \u6570\u91cf\u53ea\u6709\u4e00\u4e2a\u7684\u8bdd\uff0c\u90a3\u4e48\u4e00\u4e2a pool \u7684\u6240\u6709\u6570\u636e\u90fd\u4f1a\u5b58\u653e\u5728\u67d0\u51e0\u4e2a OSD \u4e2d\uff0c\u4e00\u65e6\u8fd9\u51e0\u4e2a OSD \u90fd\u4e0d\u5de5\u4f5c\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a pool \u7684\u6570\u636e\u90fd\u4e0d\u80fd\u8bbf\u95ee\u4e86\u3002PG \u589e\u591a\u4e86\u4ee5\u540e\uff0c\u5c31\u4f1a\u5206\u5e03\u5230\u4e0d\u540c\u7684 OSD \u4e0a\uff0c\u5e76\u4e14\u5404\u4e2a OSD \u7684\u5360\u7528\u4e5f\u4f1a\u6bd4\u8f83\u5747\u5300\u3002</p> <p>\u67e5\u770b PG \u72b6\u6001\uff1a</p> <pre><code>ceph pg dump\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#auto-scale","title":"Auto Scale","text":"<p>PG \u6570\u91cf\u53ef\u4ee5\u8ba9\u96c6\u7fa4\u81ea\u52a8\u8c03\u6574\uff1a</p> <pre><code>ceph osd pool set xxx pg_autoscale_mode on\n</code></pre> <p>\u8bbe\u7f6e autoscale \u76ee\u6807\u4e3a\u6bcf\u4e2a OSD \u5e73\u5747 100 \u4e2a PG\uff1a</p> <pre><code>ceph config set global mon_target_pg_per_osd 100\n</code></pre> <p>\u5168\u5c40 autoscale \u5f00\u5173\uff1a</p> <pre><code># Enable\nceph osd pool unset noautoscale\n# Disable\nceph osd pool set unautoscale\n# Read\nceph osd pool get noautoscale\n</code></pre> <p>\u67e5\u770b autoscale \u72b6\u6001\uff1a</p> <pre><code>ceph osd pool autoscale-status\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u663e\u793a\uff0c\u8bf4\u660e autoscale \u6ca1\u6709\u5de5\u4f5c\uff0c\u53ef\u80fd\u7684\u539f\u56e0\u662f\uff0c\u90e8\u5206 pool \u91c7\u7528\u4e86\u6307\u5b9a osd class \u7684 crush rule\uff0c\u4f8b\u5982\u6307\u5b9a\u4e86 hdd \u76d8\uff0c\u4f46\u662f\u4e5f\u6709\u90e8\u5206 pool \u6ca1\u6709\u6307\u5b9a\u76d8\u7684\u7c7b\u578b\uff0c\u4f8b\u5982\u9ed8\u8ba4\u7684 replicated_rule\u3002\u8fd9\u65f6\u5019\uff0c\u628a\u8fd9\u4e9b\u76d8\u4e5f\u8bbe\u7f6e\u6210\u4e00\u4e2a\u6307\u5b9a osd class \u7684 crush rule \u5373\u53ef\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#rbd","title":"RBD","text":"<p>RBD \u628a Ceph \u66b4\u9732\u4e3a\u5757\u8bbe\u5907\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u521b\u5efa","title":"\u521b\u5efa","text":"<p>\u521d\u59cb\u5316 Pool \u7528\u4e8e RBD\uff1a</p> <pre><code>rbd pool init xxx\n</code></pre> <p>\u4e3a\u4e86\u5b89\u5168\u6027\u8003\u8651\uff0c\u4e00\u822c\u4f1a\u4e3a RBD \u7528\u6237\u521b\u5efa\u5355\u72ec\u7684\u7528\u6237\uff1a</p> <pre><code>ceph auth get-or-create client.abc mon 'profile rbd' osd 'profile rbd pool=xxx' mgr 'profile rbd pool=xxx'\n</code></pre> <p>\u521b\u5efa RBD \u955c\u50cf\uff1a</p> <pre><code>rbd create --size 1024 xxx/yyy\n</code></pre> <p>\u8868\u793a\u5728 Pool xxx \u4e0a\u9762\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u5b57\u4e3a yyy \u5927\u5c0f\u4e3a 1024MB \u7684\u955c\u50cf\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u72b6\u6001","title":"\u72b6\u6001","text":"<p>\u5217\u4e3e Pool \u91cc\u7684\u955c\u50cf\uff1a</p> <pre><code>rbd ls\nrbd ls xxx\n</code></pre> <p>\u9ed8\u8ba4\u7684 Pool \u540d\u5b57\u662f <code>rbd</code>\u3002</p> <p>\u67e5\u770b\u955c\u50cf\u4fe1\u606f\uff1a</p> <pre><code>rbd info yyy\nrbd info xxx/yyy\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u6269\u5bb9","title":"\u6269\u5bb9","text":"<p>\u4fee\u6539\u955c\u50cf\u7684\u5bb9\u91cf\uff1a</p> <pre><code>rbd resize --size 2048 yyy\nrbd resize --size 512 yyy --allow-shrink\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u6302\u8f7d","title":"\u6302\u8f7d","text":"<p>\u5728\u5176\u4ed6\u673a\u5668\u6302\u8f7d RBD \u7684\u65f6\u5019\uff0c\u9996\u5148\u8981\u4fee\u6539 <code>/etc/ceph</code> \u4e0b\u914d\u7f6e\uff0c\u786e\u8ba4\u6709\u7528\u6237\uff0c\u5bc6\u94a5\u548c MON \u7684\u5730\u5740\u3002</p> <p>\u7136\u540e\uff0c\u7528 rbd \u6302\u8f7d\u8bbe\u5907\uff1a</p> <pre><code>rbd device map xxx/yyy --id abc\n</code></pre> <p>\u4ee5\u7528\u6237 abc \u7684\u8eab\u4efd\u6302\u8f7d Pool xxx \u4e0b\u9762\u7684 yyy \u955c\u50cf\u3002</p> <p>\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u5728 <code>/dev/rbd*</code> \u6216\u8005 <code>/dev/rbd/</code> \u4e0b\u9762\u770b\u5230\u8bbe\u5907\u6587\u4ef6\u4e86\u3002</p> <p>\u663e\u793a\u5df2\u7ecf\u6302\u8f7d\u7684\u8bbe\u5907\uff1a</p> <pre><code>rbd device list\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#cephfs","title":"CephFS","text":"","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u521b\u5efa_1","title":"\u521b\u5efa","text":"<p>\u5982\u679c\u914d\u7f6e\u4e86\u7f16\u6392\u5668\uff08Orchestrator\uff09\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u547d\u4ee4\uff1a</p> <p><pre><code>ceph fs volume create xxx\n</code></pre> \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>xxx</code> \u7684 CephFS\u3002</p> <p>\u4e5f\u53ef\u4ee5\u624b\u52a8\u521b\u5efa\uff1a</p> <pre><code>ceph osd pool create xxx_data0\nceph osd pool create xxx_metadata\nceph fs new xxx xxx_metadata xxx_data0\n</code></pre> <p>\u8fd9\u6837\u5c31\u521b\u5efa\u4e86\u4e24\u4e2a pool\uff0c\u5206\u522b\u7528\u4e8e\u5b58\u50a8\u5143\u6570\u636e\u548c\u6587\u4ef6\u6570\u636e\u3002\u4e00\u4e2a CephFS \u9700\u8981\u4e00\u4e2a pool \u4fdd\u5b58\u5143\u6570\u636e\uff0c\u82e5\u5e72\u4e2a pool \u4fdd\u5b58\u6587\u4ef6\u6570\u636e\u3002</p> <p>\u521b\u5efa\u4e86 CephFS \u4ee5\u540e\uff0c\u76f8\u5e94\u7684 MDS \u4e5f\u4f1a\u542f\u52a8\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u72b6\u6001_1","title":"\u72b6\u6001","text":"<p>\u67e5\u770b MDS \u72b6\u6001\uff1a</p> <pre><code>ceph mds stat\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u5ba2\u6237\u7aef\u914d\u7f6e","title":"\u5ba2\u6237\u7aef\u914d\u7f6e","text":"<p>\u5728\u6302\u8f7d CephFS \u4e4b\u524d\uff0c\u9996\u5148\u8981\u914d\u7f6e\u5ba2\u6237\u7aef\u3002</p> <p>\u5728\u96c6\u7fa4\u91cc\u8fd0\u884c <code>ceph config generate-minimal-conf</code>\uff0c\u5b83\u4f1a\u751f\u6210\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>$ ceph config generate-minimal-conf\n# minimal ceph.conf for &lt;fsid&gt;\n[global]\n        fsid = &lt;fsid&gt;\n        mon_host = [v2:x.x.x.x:3300/0,v1:x.x.x.x:6789/0]\n</code></pre> <p>\u628a\u5185\u5bb9\u590d\u5236\u5230\u5ba2\u6237\u7aef\u7684 <code>/etc/ceph/ceph.conf</code>\u3002\u8fd9\u6837\u5ba2\u6237\u7aef\u5c31\u80fd\u627e\u5230\u96c6\u7fa4\u7684 MON \u5730\u5740\u548c FSID\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u5728\u96c6\u7fa4\u4e0a\u7ed9\u5ba2\u6237\u7aef\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff1a</p> <pre><code>ceph fs authorize xxx client.abc / rw\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a\u7528\u6237 abc\uff0c\u5bf9 CephFS xxx \u6709\u8bfb\u5199\u7684\u6743\u9650\u3002\u628a\u8f93\u51fa\u4fdd\u5b58\u5230\u5ba2\u6237\u7aef\u7684 <code>/etc/ceph/ceph.client.abc.keyring</code> \u5373\u53ef\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u6302\u8f7d_1","title":"\u6302\u8f7d","text":"<p>\u6302\u8f7d\uff1a</p> <pre><code>mount -t ceph abc@.xxx=/ MOUNTPOINT\n# or\nmount -t ceph abc@&lt;fsid&gt;.xxx=/ MOUNTPOINT\n# or\nmount -t ceph abc@&lt;fsid&gt;.xxx=/ -o mon_addr=x.x.x.x:6789,secret=REDACTED MOUNTPOINT\n#or\nmount -t ceph abc@.xxx=/ -o mon_addr=x.x.x.x:6789/y.y.y.y:6789,secretfile=/etc/ceph/xxx.secret MOUNTPOINT\n# or\nmount -t ceph -o name=client.abc,secret=REDACTED,mds_namespace=xxx MON_IP:/ MOUNTPOINT\n</code></pre> <p>\u4ee5\u7528\u6237 <code>client.abc</code> \u7684\u8eab\u4efd\u767b\u5f55\uff0c\u6302\u8f7d CepFS <code>xxx</code> \u4e0b\u9762\u7684 <code>/</code> \u76ee\u5f55\u5230 <code>MOUNTPOINT</code>\u3002\u5b83\u4f1a\u8bfb\u53d6 <code>/etc/ceph</code> \u4e0b\u9762\u7684\u914d\u7f6e\uff0c\u5982\u679c\u5df2\u7ecf <code>ceph.conf</code> \u5199\u4e86\uff0c\u547d\u4ee4\u884c\u91cc\u5c31\u53ef\u4ee5\u4e0d\u5199\u3002</p> <p>fsid \u6307\u7684\u4e0d\u662f CephFS \u7684 ID\uff0c\u5b9e\u9645\u4e0a\u662f\u96c6\u7fa4\u7684 ID\uff1a<code>ceph fsid</code>\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u9650\u989d","title":"\u9650\u989d","text":"<p>CephFS \u53ef\u4ee5\u5bf9\u76ee\u5f55\u8fdb\u884c\u9650\u989d\uff1a</p> <pre><code>setfattr -n ceph.quota.max_bytes -v LIMIT PATH\nsetfattr -n ceph.quota.max_files -v LIMIT PATH\ngetfattr -n ceph.quota.max_bytes PATH\ngetfattr -n ceph.quota.max_files PATH\n</code></pre> <p>\u9650\u5236\u76ee\u5f55\u5927\u5c0f\u548c\u6587\u4ef6\u6570\u91cf\u3002LIMIT \u662f 0 \u7684\u65f6\u5019\u8868\u793a\u6ca1\u6709\u9650\u5236\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#nfs","title":"NFS","text":"<p>\u53ef\u4ee5\u628a CephFS \u6216\u8005 RGW \u901a\u8fc7 NFS \u7684\u65b9\u5f0f\u5171\u4eab\u51fa\u53bb\u3002</p> <p>\u542f\u52a8 NFS \u670d\u52a1\uff1a</p> <pre><code>ceph nfs cluster create xxx\nceph nfs cluster create xxx \"host1,host2\"\n</code></pre> <p>\u5728\u4e3b\u673a\u4e0a\u8fd0\u884c NFS \u670d\u52a1\u5668\uff0cNFS \u96c6\u7fa4\u7684\u540d\u5b57\u53eb\u505a xxx\u3002</p> <p>\u67e5\u770b NFS \u96c6\u7fa4\u4fe1\u606f\uff1a</p> <pre><code>ceph nfs cluster info xxx\n</code></pre> <p>\u5217\u4e3e\u6240\u6709 NFS \u96c6\u7fa4\uff1a</p> <pre><code>ceph nfs cluster ls\n</code></pre> <p>NFS \u5bfc\u51fa CephFS\uff1a</p> <pre><code>ceph nfs export create cephfs --cluster-id xxx --pseudo-path /a/b/c --fsname some-cephfs-name [--path=/d/e/f] [--client_addr y.y.y.y]\n</code></pre> <p>\u8fd9\u6837\u5c31\u5bfc\u51fa\u4e86 CephFS \u5185\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7 NFS \u6302\u8f7d /a/b/c \u8def\u5f84\uff08pseudo path\uff09\u6765\u8bbf\u95ee\u3002\u53ef\u4ee5\u8bbe\u7f6e\u5ba2\u6237\u7aef\u7684 IP \u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u8fd9\u6837\u5728\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5 mount\uff1a</p> <pre><code>mount -t nfs x.x.x.x:/a/b/c /mnt\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#radosgw","title":"RadosGW","text":"<p>RGW \u63d0\u4f9b\u4e86 S3 \u6216\u8005 OpenStack Swift \u517c\u5bb9\u7684\u5bf9\u8c61\u5b58\u50a8 API\u3002</p> <p>TODO</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u7f16\u6392\u5668","title":"\u7f16\u6392\u5668","text":"<p>\u7531\u4e8e Ceph \u9700\u8981\u8fd0\u884c\u591a\u4e2a daemon\uff0c\u5e76\u4e14\u90fd\u5728\u4e0d\u540c\u7684\u5bb9\u5668\u4e2d\u8fd0\u884c\uff0c\u6240\u4ee5\u4e00\u822c\u4f1a\u8dd1\u4e00\u4e2a\u7cfb\u7edf\u7ea7\u7684\u7f16\u6392\u5668\uff0c\u7528\u4e8e\u65b0\u589e\u548c\u7ba1\u7406\u8fd9\u4e9b\u5bb9\u5668\u3002</p> <p>\u67e5\u770b\u5f53\u524d\u7f16\u6392\u5668\uff1a</p> <pre><code>$ ceph orch status\nBackend: cephadm\nAvailable: Yes\nPaused: No\n</code></pre> <p>\u6bd4\u8f83\u5e38\u89c1\u7684\u5c31\u662f cephadm\uff0c\u5b89\u88c5\u7684\u65f6\u5019\u5982\u679c\u7528\u4e86 cephadm\uff0c\u90a3\u4e48\u7f16\u6392\u5668\u4e5f\u662f\u5b83\u3002</p> <p>\u88ab\u7f16\u6392\u7684\u670d\u52a1\uff1a</p> <pre><code>ceph orch ls\n</code></pre> <p>\u88ab\u7f16\u6392\u7684\u5bb9\u5668\uff1a</p> <pre><code>ceph orch ps\n</code></pre> <p>\u88ab\u7f16\u6392\u7684\u4e3b\u673a\uff1a</p> <pre><code>ceph orch host ls\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u6dfb\u52a0\u65b0\u673a\u5668","title":"\u6dfb\u52a0\u65b0\u673a\u5668","text":"<p>\u9996\u5148\uff0c\u590d\u5236 <code>/etc/ceph/ceph.pub</code> \u5230\u65b0\u673a\u5668\u7684 <code>/root/.ssh/authorized_keys</code> \u4e2d</p> <p>\u63a5\u7740\uff0c\u6dfb\u52a0\u673a\u5668\u5230\u7f16\u6392\u5668\u4e2d\uff1a</p> <pre><code>ceph orch host add xxxx y.y.y.y\n</code></pre> <p>\u5bfc\u51fa\u7f16\u6392\u5668\u914d\u7f6e\uff1a</p> <pre><code>ceph orch ls --export &gt; cephadm.yaml\n</code></pre> <p>\u5982\u679c\u60f3\u8ba9\u4e00\u4e9b daemon \u53ea\u8fd0\u884c\u5728\u90e8\u5206\u4e3b\u673a\u4e0a\uff0c\u53ef\u4ee5\u4fee\u6539\uff1a</p> <pre><code># change\nplacement:\n  host_pattern: '*'\n# to\nplacement:\n  host_pattern: 'xxx'\n</code></pre> <p>\u7136\u540e\u5e94\u7528\uff1a</p> <pre><code>ceph orch apply -i cephadm.yaml\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u914d\u7f6e\u76d1\u63a7","title":"\u914d\u7f6e\u76d1\u63a7","text":"<p>\u6dfb\u52a0\u76d1\u63a7\u76f8\u5173\u7684\u670d\u52a1\uff1a</p> <pre><code>ceph orch apply node-exporter\nceph orch apply alertmanager\nceph orch apply prometheus\nceph orch apply grafana\nceph orch ps\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u8bbf\u95ee Grafana \u770b\u5230\u96c6\u7fa4\u7684\u72b6\u6001\u3002</p>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u66f4\u65b0","title":"\u66f4\u65b0","text":"<p>\u4f7f\u7528\u5bb9\u5668\u7f16\u6392\u5668\u6765\u5347\u7ea7\uff1a</p> <pre><code>ceph orch upgrade start --ceph-version x.x.x\nceph orch upgrade start --image quay.io/ceph/ceph:vx.x.x\n</code></pre> <p>\u5982\u679c docker hub \u4e0a\u627e\u4e0d\u5230 image\uff0c\u5c31\u4ece quay.io \u62c9\u53d6\u3002</p> <p>\u67e5\u770b\u5347\u7ea7\u72b6\u6001\uff1a</p> <pre><code>ceph orch upgrade status\nceph -s\n</code></pre> <p>\u67e5\u770b cephadm \u65e5\u5fd7\uff1a</p> <pre><code>ceph -W cephadm\n</code></pre>","tags":["ceph"]},{"location":"devops/2022/07/16/ceph-cookbook/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Ceph Architecture</li> <li>Ceph User Management</li> <li>Ceph Create a Ceph File System</li> <li>mount.ceph</li> <li>Ceph CephFS Quota</li> <li>Ceph Basic Block Device Commands</li> <li>Ceph Upgrade</li> <li>Ceph CephFS &amp; RGW Exports Over NFS</li> <li>CRUSH Maps</li> <li>CRUSH Map Edits</li> <li>ceph \u67b6\u6784\u548c\u6982\u5ff5</li> <li>RedHat Object Gateway Guide</li> </ul>","tags":["ceph"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/","title":"\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm","text":"","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u524d\u6bb5\u65f6\u95f4\u7528 rook \u642d\u5efa\u4e86\u4e00\u4e2a k8s \u5185\u90e8\u7684 ceph \u96c6\u7fa4\uff0c\u4f46\u662f\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u4e00\u4e9b\u7a33\u5b9a\u6027\u95ee\u9898\uff0c\u6240\u4ee5\u60f3\u8981\u7528 cephadm \u91cd\u5efa\u4e00\u4e2a ceph \u96c6\u7fa4\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u91cd\u5efa\u8fc7\u7a0b","title":"\u91cd\u5efa\u8fc7\u7a0b","text":"<p>\u91cd\u5efa\u7684\u65f6\u5019\uff0c\u6211\u9996\u5148\u7528 cephadm \u642d\u5efa\u4e86\u4e00\u4e2a ceph \u96c6\u7fa4\uff0c\u518d\u628a\u539f\u6765\u7684 MON \u6570\u636e\u5bfc\u5165\uff0c\u518d\u6062\u590d\u5404\u4e2a OSD\u3002\u7406\u8bba\u4e0a\uff0c\u53ef\u80fd\u6709\u66f4\u4f18\u96c5\u7684\u529e\u6cd5\uff0c\u4f46\u6211\u8fd8\u662f\u6162\u6162\u901a\u8fc7\u6bd4\u8f83\u590d\u6742\u7684\u529e\u6cd5\u89e3\u51b3\u4e86\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#cephadm-\u642d\u5efa-ceph-\u96c6\u7fa4","title":"cephadm \u642d\u5efa ceph \u96c6\u7fa4","text":"<p>\u9996\u5148\uff0c\u914d\u7f6e TUNA \u6e90\uff0c\u5728\u5404\u4e2a\u8282\u70b9\u4e0a\u5b89\u88c5 <code>docker-ce</code> \u548c <code>cephadm</code>\u3002\u63a5\u7740\uff0c\u5728\u4e3b\u8282\u70b9\u4e0a bootstrap\uff1a</p> <pre><code>cephadm bootstrap --mon-ip HOST1_IP\n</code></pre> <p>\u6b64\u65f6\uff0c\u5728\u4e3b\u8282\u70b9\u4e0a\u4f1a\u8fd0\u884c\u6700\u57fa\u7840\u7684 ceph \u96c6\u7fa4\uff0c\u4e0d\u8fc7\u6b64\u65f6\u8fd8\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u3002\u5bfb\u627e ceph \u5206\u533a\uff0c\u4f1a\u53d1\u73b0\u56e0\u4e3a FSID \u4e0d\u5339\u914d\u800c\u65e0\u6cd5\u5bfc\u5165\u3002\u6240\u4ee5\uff0c\u9996\u5148\u8981\u6062\u590d MON \u6570\u636e\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1acephadm install\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u6062\u590d-mon-\u6570\u636e","title":"\u6062\u590d MON \u6570\u636e","text":"<p>\u9996\u5148\uff0c\u5173\u6389 rook ceph \u96c6\u7fa4\uff0c\u627e\u5230\u7559\u5b58\u4e0b\u6765\u7684 MON \u6570\u636e\u76ee\u5f55\uff0c\u9ed8\u8ba4\u8def\u5f84\u662f <code>/var/lib/rook</code> \u4e0b\u7684 <code>mon-[a-z]</code> \u76ee\u5f55\uff0c\u627e\u5230\u6700\u65b0\u7684\u4e00\u4e2a\u5373\u53ef\u3002\u6211\u628a\u76ee\u5f55\u4e0b\u7684\u8def\u5f84\u8986\u76d6\u5230 cephadm \u751f\u6210\u7684 MON \u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u8dd1\u8d77\u6765\uff0c\u53d1\u73b0\u6709\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>cephadm \u751f\u6210\u7684 /etc/ceph/ceph.client.admin.keyring \u4e0e MON \u4e2d\u4fdd\u5b58\u7684 auth \u4fe1\u606f\u4e0d\u5339\u914d\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8bbf\u95ee</li> <li>FSID \u4e0d\u4e00\u81f4\uff0c\u800c cephadm \u4f1a\u5c06\u5404\u4e2a\u8bbe\u7f6e\u76ee\u5f55\u653e\u5230 <code>/var/lib/ceph/$FSID</code> \u4e0b</li> </ol> <p>\u7b2c\u4e00\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4e34\u65f6\u7528 MON \u76ee\u5f55\u4e0b\u7684 keyring \u8fdb\u884c\u8ba4\u8bc1\uff0c\u518d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 client.admin \u8ba4\u8bc1\u3002\u7b2c\u4e8c\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u5c06\u9047\u5230\u7684\u5404\u79cd cephadm \u751f\u6210\u7684 FSID \u66ff\u6362\u4e3a MON \u4e2d\u7684 FSID\uff0c\u5305\u62ec\u76ee\u5f55\u540d\u3001\u5404\u4e2a\u76ee\u5f55\u4e0b unit.run \u4e2d\u7684\u8def\u5f84\u548c systemd unit \u7684\u540d\u79f0\u3002</p> <p>\u8fdb\u884c\u4e00\u7cfb\u5217\u66ff\u6362\u4ee5\u540e\uff0c\u539f\u6765\u7684 MON \u5df2\u7ecf\u8d77\u6765\u4e86\uff0c\u53ef\u4ee5\u770b\u5230\u539f\u6765\u4fdd\u7559\u7684\u5404\u4e2a pool \u548c cephfs \u4fe1\u606f\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u6269\u5c55\u5230\u591a\u8282\u70b9","title":"\u6269\u5c55\u5230\u591a\u8282\u70b9","text":"<p>\u63a5\u4e0b\u6765\uff0c\u7531\u4e8e MON \u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u66f4\u65b0\u4e86\uff0c\u6240\u4ee5\u8981\u91cd\u65b0\u751f\u6210 cephadm \u7684 SSH \u5bc6\u94a5\u3002\u5c06 SSH \u5bc6\u94a5\u590d\u5236\u5230\u5404\u8282\u70b9\u540e\uff0c\u518d\u7528 cephadm \u7684 orch \u529f\u80fd\u90e8\u7f72\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\u3002\u6b64\u65f6 FSID \u90fd\u5df2\u7ecf\u662f MON \u4e2d\u7684 FSID\uff0c\u4e0d\u9700\u8981\u66ff\u6362\u3002\u6b64\u65f6\u53ef\u4ee5\u5728 <code>ceph orch ps</code> \u547d\u4ee4\u4e2d\u770b\u5230\u5728\u5404\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u7a0b\u5e8f\u3002\u63a5\u4e0b\u6765\uff0c\u8fd8\u9700\u8981\u6062\u590d\u5404\u4e2a OSD\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u5bfc\u5165-osd","title":"\u5bfc\u5165 OSD","text":"<p>\u4e3a\u4e86\u4ece ceph \u5206\u533a\u4ece\u5bfc\u51fa OSD \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u7528 <code>ceph-volume</code> \u5de5\u5177\u3002\u8fd9\u4e2a\u5de5\u5177\u4f1a\u751f\u6210\u4e00\u4e2a <code>/var/lib/ceph/osd-ID</code> \u76ee\u5f55\uff0c\u5728 cephadm \u7684\u6982\u5ff5\u91cc\u5c5e\u4e8e legacy\uff0c\u56e0\u6b64\u6211\u4eec\u9996\u5148\u8981\u628a\u8def\u5f84 mount \u5230 shell \u91cc\u9762\uff1a</p> <pre><code>$ cephadm shell --mount /var/lib/ceph:/var/lib/ceph\n</code></pre> <p>\u63a5\u7740\uff0c\u751f\u6210 osd \u76ee\u5f55\u914d\u7f6e\uff1a</p> <pre><code>$ ceph-volume lvm activate --all --no-systemd\n</code></pre> <p>\u7136\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u521b\u5efa\u4e86\u5bf9\u5e94\u7684 osd \u8def\u5f84\uff0c\u518d\u7528 cephadm \u8fdb\u884c\u8f6c\u6362\uff1a</p> <pre><code>$ cephadm adopt --style legacy --name osd.ID\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528 cephadm \u7ba1\u7406\u4e86\u3002</p>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/06/25/ceph-k8s-to-external/#\u914d\u7f6e-k8s","title":"\u914d\u7f6e k8s","text":"<p>\u914d\u7f6e\u597d\u5916\u90e8 ceph \u96c6\u7fa4\u540e\uff0c\u8fd8\u9700\u8981\u914d\u7f6e k8s rook\u3002</p> <p>\u53c2\u8003 https://rook.github.io/docs/rook/v1.8/ceph-cluster-crd.html#external-cluster\uff0c\u5927\u6982\u6709\u8fd9\u4e48\u51e0\u6b65\uff1a</p> <ol> <li>\u5728 ceph \u96c6\u7fa4\u4e0a\u8fd0\u884c create-external-cluster-resources.sh\uff0c\u521b\u5efa\u7528\u6237\uff0c\u5e76\u4e14\u5bfc\u51fa key</li> <li>\u5728 k8s \u96c6\u7fa4\u4e0a\u5e94\u7528\u7b2c\u4e00\u6b65\u751f\u6210\u7684\u73af\u5883\u53d8\u91cf\uff0c\u7136\u540e\u8fd0\u884c import-external-cluster.sh</li> <li>\u590d\u5236\u4e00\u4efd cluster-external.yaml \u7136\u540e\u5e94\u7528</li> <li>\u590d\u5236 storageclass.yaml\uff0c\u628a\u91cc\u9762\u7684 namespace \u6539\u6210 rook-ceph-external</li> </ol>","tags":["k8s","ceph","rook","cephfs","cephadm"]},{"location":"devops/2021/03/12/ceph-on-k8s/","title":"\u901a\u8fc7 rook \u5728 k8s \u4e0a\u90e8\u7f72 ceph \u96c6\u7fa4","text":"","tags":["ceph","k8s","kubernetes","rook"]},{"location":"devops/2021/03/12/ceph-on-k8s/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u96c6\u7fa4\u7684\u4f7f\u7528\uff0c\u60f3\u5728 k8s \u96c6\u7fa4\u91cc\u90e8\u7f72\u4e00\u4e2a ceph \u96c6\u7fa4\u3002</p> <p>Ceph \u4ecb\u7ecd</p> <p>Ceph \u6709\u8fd9\u4e9b\u7ec4\u6210\u90e8\u5206\uff1a</p> <ol> <li>mon\uff1amonitor</li> <li>mgr\uff1amanager</li> <li>osd\uff1astorage</li> <li>mds(optional)\uff1a\u7528\u4e8e CephFS</li> <li>radosgw(optional\uff1a\u7528\u4e8e Ceph Object Storage</li> </ol>","tags":["ceph","k8s","kubernetes","rook"]},{"location":"devops/2021/03/12/ceph-on-k8s/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u6211\u4eec\u91c7\u7528\u7684\u662f rook \u6765\u90e8\u7f72 ceph \u96c6\u7fa4\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1ahttps://rook.github.io/docs/rook/v1.5/ceph-examples.html</p> <p>\u9996\u5148\uff0c\u514b\u9686 rook \u7684\u4ed3\u5e93\u3002\u5efa\u8bae\u9009\u62e9\u4e00\u4e2a release \u7248\u672c\u3002</p> <p>\u63a5\u7740\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a</p> <pre><code>sudo apt install -y lvm2\n# required\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/crds.yaml\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/common.yaml\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/operator.yaml\n# debugging only\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/toolbox.yaml\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/direct-mount.yaml\n# CephFS\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/filesystem.yaml\nkubectl apply -f rook/cluster/examples/kubernetes/ceph/csi/cephfs/storageclass.yaml\n</code></pre> <p>\u524d\u9762\u4e09\u4e2a yaml \u662f\u5fc5\u987b\u7684\uff0ctoolbox \u662f\u7528\u6765\u67e5\u770b ceph \u72b6\u6001\u7684\uff0cdirect mount \u662f\u7528\u6765 mount cephfs \u7684\uff0c\u540e\u4e24\u4e2a\u662f\u4e3a\u4e86\u7528 cephfs \u7684\u3002</p> <p>\u63a5\u7740\uff0c\u6309\u7167\u81ea\u5df1\u7684\u9700\u6c42\u7f16\u8f91 <code>rook/cluster/exmaples/kuberenetes/ceph/cluster.yaml</code> \u7136\u540e\u5e94\u7528\u3002\u6b64\u65f6\u4f60\u7684\u96c6\u7fa4\u5e94\u8be5\u5c31\u5df2\u7ecf\u8d77\u6765\u4e86\u3002</p> <p>\u7136\u540e\uff0c\u53ef\u4ee5\u8fdb toolbox \u67e5\u770b ceph \u72b6\u6001\uff1a</p> <pre><code>$ kubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u8fdb direct-mount \u5bb9\u5668\u67e5\u770b pv \u8def\u5f84\uff1a</p> <pre><code># get volume path of pvc\nkubectl get pv -o custom-columns=NAME:.metadata.name,NAMSEPACE:.spec.claimRef.namespace,CLAIM:.spec.claimRef.name,PATH:.spec.csi.volumeAttributes.subvolumeName\n\nkubectl -n rook-ceph exec -it deploy/rook-direct-mount -- bash\n# in the pod\nmkdir /tmp/registry\nmon_endpoints=$(grep mon_host /etc/ceph/ceph.conf | awk '{print $3}')\nmy_secret=$(grep key /etc/ceph/keyring | awk '{print $3}')\nmount -t ceph -o mds_namespace=myfs,name=admin,secret=$my_secret $mon_endpoints:/ /tmp/registry\ndf -h\n\ncd /tmp/registry/volumes/csi/PATH\n</code></pre>","tags":["ceph","k8s","kubernetes","rook"]},{"location":"devops/2020/08/12/certbot-route53-letsencrypt-iam/","title":"\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM","text":"<p>\u6700\u8fd1\u9047\u5230\u4e86 AWS Certificate Manager \u7684\u4e00\u4e9b\u9650\u5236\uff0c\u6240\u4ee5\u53ea\u80fd\u7528 IAM \u8bc1\u4e66\u3002\u4e8e\u662f\u4e0a\u7f51\u627e\u5230\u4e86\u901a\u8fc7 certbot \u7533\u8bf7 LE \u8bc1\u4e66\uff0c\u901a\u8fc7 route53 API \u9a8c\u8bc1\u7684\u65b9\u6cd5\u3002</p> <p>\u9996\u5148\u914d\u7f6e aws \u7684 credential\u3002\u7136\u540e\uff0c\u6309\u7167 certbot\uff1a</p> <pre><code>pip3 install -U certbot certbot_dns_route53\n</code></pre> <p>\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u7533\u8bf7\u8bc1\u4e66\u4e86\uff1a</p> <pre><code>certbot certonly --dns-route53 --config-dir \"./letsencrypt\" --work-dir \"./letsencrypt\" --logs-dir \"./letsencrypt\"  -d example.com --email a@b.com --agree-tos\n</code></pre> <p>\u5982\u679c\u7533\u8bf7\u6210\u529f\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u53ef\u4ee5\u627e\u5230\u8bc1\u4e66\u3002\u7136\u540e\u4e0a\u4f20\u5230 IAM\uff1a</p> <pre><code>aws iam upload-server-certificate --server-certificate-name NameHere \\\n    --certificate-body file://letsencrypt/live/example.com/cert.pem \\\n    --private-key file://letsencrypt/live/example.com/privkey.pem \\\n    --certificate-chain file://letsencrypt/live/example.com/chain.pem \\\n    --path /cloudfront/\n</code></pre> <p>\u5982\u679c\u8981\u7528\u4e8e cloudfront\uff0c\u624d\u9700\u8981\u6700\u540e\u7684\u8def\u5f84\u53c2\u6570\uff1b\u5426\u5219\u53ef\u4ee5\u53bb\u6389\u3002\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86 IAM \u8bc1\u4e66\u7684\u4e0a\u4f20\u3002</p>","tags":["certbot","route53","aws","letsencrypt","iam"]},{"location":"devops/2019/10/19/configure-telegraf-for-cisco-wlc/","title":"\u4e3a Cisco WLC \u914d\u7f6e Telegraf","text":"<p>\u6700\u8fd1\u60f3\u5230\u53ef\u4ee5\u7ed9 Cisco WLC \u4e5f\u914d\u7f6e\u4e00\u4e0b\u76d1\u63a7\uff0c\u67e5\u4e86\u4e00\u4e0b\uff0c\u679c\u7136\u6709\u4e00\u4e9b\u65b9\u6cd5\u3002\u5927\u6982\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86\u65b9\u6cd5\uff1a</p> <p>\u628a https://github.com/haad/net-snmp/tree/master/mibs \u548c https://github.com/zampat/neteye4/tree/master/monitoring/monitoring-plugins/wireless/cisco/mibs \u76ee\u5f55\u4e0b\u7684\u6240\u6709 .txt \u6587\u4ef6\u653e\u5230 /usr/share/snmp/mibs \u76ee\u5f55\u4e0b\u3002</p> <p>\u7136\u540e\u628a https://github.com/zampat/neteye4/blob/master/monitoring/monitoring-plugins/wireless/cisco/telegraf.conf \u4e0b\u9762 snmp \u7684\u914d\u7f6e\u590d\u5236\u5230 telegraf \u914d\u7f6e\u4e2d\uff0c\u7136\u540e\u4fee\u6539\u4e00\u4e0b IP \u5730\u5740\u3002</p> <p>\u786e\u4fdd Cisco WLC \u7684 SNMP \u7684 Public Community \u5df2\u7ecf\u914d\u7f6e\u597d\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u62ff\u5230\u6570\u636e\u4e86\u3002</p> <p>\u76ee\u524d\u53ef\u4ee5\u62ff\u5230 WLC \u81ea\u8eab\u7684\u4e00\u4e9b\u8fd0\u884c\u02d9\u72b6\u6001\u4fe1\u606f\u3001AP \u7684\u4fe1\u606f\u3001SSID \u7684\u4fe1\u606f\u548c Client \u7684\u4fe1\u606f\uff0c\u57fa\u672c\u6ee1\u8db3\u4e86\u6211\u4eec\u7684\u9700\u6c42\u3002</p> <p>\u53c2\u8003\uff1ahttps://www.neteye-blog.com/2019/08/monitoring-a-cisco-wireless-controller/</p>","tags":["telegraf","cisco","wlc","snmp","mib"]},{"location":"devops/2020/10/18/deploy-esxi-vcsa-7/","title":"\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7","text":"<p>\u4e4b\u524d\u5728\u53e6\u4e00\u7bc7\u6587\u7ae0\u91cc\u63d0\u5230\u8fc7 vCSA \u7684\u5b89\u88c5\uff0c\u8fd9\u6b21\u53c8\u5728\u53e6\u4e00\u53f0\u673a\u5668\u4e0a\u91cd\u65b0\u505a\u4e86\u4e00\u904d\uff0c\u7279\u6b64\u8bb0\u5f55\u4e00\u4e0b\u3002</p> <p>\u9996\u5148\u5728\u5b98\u7f51\u4e0a\u4e0b\u8f7d ESXi+VCSA 7.0 \uff0c\u5e94\u8be5\u5f97\u5230\u4e24\u4e2a\u6587\u4ef6\uff1a</p> <pre><code>7.9G VMware-VCSA-all-7.0.1-16860138.iso\n358M VMware-VMvisor-Installer-7.0U1-16850804.x86_64.iso\n</code></pre> <p>\u9996\u5148\u5b89\u88c5 ESXi\uff0c\u7528 UNetBootin \u5236\u4f5c ESXi \u7684\u5b89\u88c5\u5149\u76d8\u3002\u6ce8\u610f\u4e0d\u80fd\u7528 dd\uff0c\u56e0\u4e3a\u5b83\u662f CDFS \u683c\u5f0f\u7684\uff0c\u4e0d\u80fd\u76f4\u63a5 boot\u3002\u542f\u52a8\u4ee5\u540e\uff0c\u6309\u7167\u754c\u9762\u8981\u6c42\uff0c\u4e00\u8def\u5b89\u88c5\u5373\u53ef\u3002</p> <p>\u63a5\u7740\uff0c\u5c31\u53ef\u4ee5\u7528\u7f51\u9875\u8bbf\u95ee ESXi \u8fdb\u884c\u914d\u7f6e\u3002\u6bd4\u5982\u5b89\u88c5\u4e00\u4e9b Linux \u53d1\u884c\u7248\uff0c\u7136\u540e\u5728 Linux \u865a\u62df\u673a\u91cc\u9762 mount \u4e0a\u9762\u7684 VCSA \u7684 iso\uff1a</p> <pre><code>sudo mount /dev/sr0 /mnt\n</code></pre> <p>\u63a5\u7740\uff0c\u590d\u5236\u5e76\u4fee\u6539 <code>/mnt/vcsa-cli-installer/templates/install/embedded_vCSA_on_ESi.json</code>\uff0c\u6309\u7167\u4ee3\u7801\u6ce8\u91ca\u8fdb\u884c\u4fee\u6539\u3002\u9700\u8981\u6ce8\u610f\u51e0\u70b9\uff1a</p> <ol> <li>\u5bc6\u7801\u90fd\u53ef\u4ee5\u8bbe\u4e3a\u7a7a\uff0c\u7136\u540e\u8fd0\u884c cli \u7684\u65f6\u5019\u8f93\u5165</li> <li>ESXi \u7684\u5bc6\u7801\u548c vCSA \u7684\u5bc6\u7801\u662f\u4e0d\u4e00\u6837\u7684</li> <li>\u53ef\u4ee5\u628a ceip \u5173\u6389\uff0c\u8bbe\u7f6e ceip_enabled: false</li> </ol> <p>\u63a5\u7740\uff0c\u8fdb\u884c\u5b89\u88c5\uff1a</p> <pre><code>/mnt/vcsa-cli-installer/lin64/vcsa-deploy install --accept-eula /path/to/customized.json -v\n</code></pre> <p>\u6162\u6162\u7b49\u5f85\u5b83\u5b89\u88c5\u6210\u529f\u5373\u53ef\u3002</p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fdb\u5165 vCSA\uff0c\u65b0\u5efa\u4e00\u4e2a Datacenter\uff0c\u7136\u540e\u9009\u62e9\u65b0\u5efa\u7684 Datacenter\uff0c\u9009\u62e9 Add host\uff0c\u8f93\u5165 ESXi \u7684\u5730\u5740\u548c\u7528\u6237\u5bc6\u7801\u4fe1\u606f\u5373\u53ef\u3002</p>","tags":["vmware","esxi","vcsa","baremetal","visualization"]},{"location":"devops/2018/05/20/deploy-vcsa-under-esxi/","title":"\u5728 VMware ESXi \u4e0a\u90e8\u7f72 vCSA \u5b9e\u8df5","text":"<p>\u9996\u5148\u83b7\u53d6 vCSA \u7684 ISO \u955c\u50cf\uff0c\u6302\u8f7d\u5230 Linux \u4e0b\uff08\u5982 /mnt\uff09\uff0c\u7136\u540e\u627e\u5230 /mnt/vcsa-cli-installer/templates/install \u4e0b\u7684 embedded_vCSA_on_ESXi.json\uff0c\u590d\u5236\u5230\u5176\u5b83\u76ee\u5f55\u5e76\u4e14\u4fee\u6539\u5fc5\u8981\u7684\u5b57\u6bb5\uff0c\u7b2c\u4e00\u4e2a <code>password</code> \u4e3a ESXi \u7684\u767b\u5f55\u5bc6\u7801\uff0c\u4e00\u4f1a\u5728\u5b89\u88c5\u7684\u8fc7\u7a0b\u4e2d\u518d\u8f93\u5165\u3002\u4e0b\u9762\u6709\u4e2a deployment_option\uff0c\u6839\u636e\u4f60\u7684\u96c6\u7fa4\u5927\u5c0f\u6765\u9009\u62e9\uff0c\u6211\u5219\u662f\u7528\u7684 small\u3002\u4e0b\u9762\u914d\u7f6e\u8fd9\u53f0\u673a\u5668\u7684 IP \u5730\u5740\uff0c\u7528\u5185\u7f51\u5730\u5740\u5373\u53ef\u3002\u4e0b\u9762\u7684 system_name \u5982\u679c\u8981\u5199 fqdn\uff0c\u8bb0\u5f97\u8981\u8ba9\u8fd9\u4e2a\u57df\u540d\u53ef\u4ee5\u89e3\u6790\u5230\u6b63\u786e\u7684\u5730\u5740\uff0c\u4e0d\u7136\u4f1a\u5b89\u88c5\u5931\u8d25\uff0c\u6211\u56e0\u6b64\u91cd\u88c5\u4e86\u4e00\u6b21\u3002\u4e0b\u9762\u7684\u5bc6\u7801\u90fd\u53ef\u4ee5\u7559\u7a7a\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u5373\u53ef\u3002SSO \u4e3a vSphere Client \u767b\u5f55\u65f6\u7528\u7684\u5bc6\u7801\u548c\u57df\u540d\uff0c\u9ed8\u8ba4\u7528\u6237\u540d\u4e3a Administrator@domain_name (\u9ed8\u8ba4\u7684\u8bdd\uff0c\u5219\u662f Administrator@vsphere.local) \u8fd9\u4e2a\u7528\u6237\u540d\u5728\u5b89\u88c5\u7ed3\u675f\u7684\u65f6\u5019\u4e5f\u4f1a\u63d0\u793a\u3002\u4e0b\u9762\u7684 CEIP \u6211\u9009\u62e9\u5173\u95ed\uff0c\u8bbe\u7f6e\u4e3a false\u3002</p> <p>\u63a5\u4e0b\u6765\u8fdb\u884c\u5b89\u88c5\u3002</p> <pre><code>$ /mnt/vcsa-cli-installer/lin64/vcsa-deploy install /path/to/embedded_vCSA_on_ESXi.json --accept-eula\n</code></pre> <p>\u4e00\u8def\u8f93\u5165\u5bc6\u7801\uff0c\u7b49\u5f85\u5b89\u88c5\u5b8c\u6bd5\u5373\u53ef\u3002\u7136\u540e\u901a\u8fc7 443 \u7aef\u53e3\u8fdb\u5165 vSphere Client, \u901a\u8fc7 5480 \u7aef\u53e3\u8bbf\u95ee vCSA \u7684\u7ba1\u7406\u9875\u9762\u3002\u4e24\u4e2a\u7684\u5bc6\u7801\u53ef\u4ee5\u4e0d\u4e00\u6837\u3002</p> <p>2018-05-21 Update: \u60f3\u8981\u8bbe\u7f6e VMKernel \u7684 IPv6 \u7f51\u5173\u7684\u8bdd\uff0cESXi \u4e2d\u6ca1\u627e\u5230\u914d\u7f6e\u7684\u5730\u65b9\uff0c\u4f46\u662f\u5728 vSphere Client \u4e2d\u53ef\u4ee5\u8fdb\u884c\u76f8\u5173\u914d\u7f6e\u3002</p>","tags":["vmware","vcsa","esxi"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/","title":"\u5728 Apple M1 \u4e0a\u8bd5\u7528 Gentoo/Prefix","text":"","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e0a\u4e00\u6b21\u6298\u817e Gentoo/Prefix \u662f\u4e94\u5e74\u591a\u4ee5\u524d\uff0c\u5f53\u65f6\u8fd8\u662f\u7528\u7684 Intel Mac\uff0c\u6700\u8fd1\u9700\u8981\u63a2\u7d22\u4e00\u4e0b\u5728\u73b0\u5728\u7684 macOS \u7cfb\u7edf\u4e0a\u7528 Gentoo/Prefix \u4f1a\u9047\u5230\u54ea\u4e9b\u95ee\u9898\uff0c\u56e0\u6b64\u4eca\u5929\u5728 Apple M1 \u4e0a\u91cd\u65b0\u5c1d\u8bd5\u4e00\u6b21\u3002</p>","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u6309\u7167\u5b98\u7f51\u7684\u6587\u6863\uff0c\u4e0b\u8f7d\u811a\u672c\u5e76\u8fd0\u884c\uff1a</p> <pre><code>wget https://gitweb.gentoo.org/repo/proj/prefix.git/plain/scripts/bootstrap-prefix.sh\nchmod +x bootstrap-prefix.sh\n./bootstrap-prefix.sh\n</code></pre> <p>\u6309\u7167\u63d0\u793a\u8f93\u5165\u5373\u53ef\u3002</p> <p>\u7f16\u8bd1\u4f7f\u7528\u4e86\u56db\u5230\u4e94\u4e2a\u591a\u5c0f\u65f6\uff0c\u5360\u7528 3GB \u7684\u786c\u76d8\u7a7a\u95f4\u3002\u6210\u529f\u4ee5\u540e\u8fdb\u5165 Gentoo Prefix\uff1a</p> <pre><code>./startprefix\n</code></pre>","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/#\u6298\u817e","title":"\u6298\u817e","text":"<p>\u7f16\u8bd1\u5e76\u8fd0\u884c\u5927\u6982\u4e24\u4e2a\u5c0f\u65f6\u4ee5\u540e\uff0c\u9047\u5230\u4e86\u7f16\u8bd1\u9519\u8bef\uff1a</p> <pre><code>Undefined symbols for architecture arm64:\n  \"_libintl_bindtextdomain\", referenced from:\n      __locale_bindtextdomain in _localemodule.o\n  \"_libintl_dcgettext\", referenced from:\n      __locale_dcgettext in _localemodule.o\n  \"_libintl_dgettext\", referenced from:\n      __locale_dgettext in _localemodule.o\n  \"_libintl_gettext\", referenced from:\n      __locale_gettext in _localemodule.o\n  \"_libintl_setlocale\", referenced from:\n      __locale_setlocale in _localemodule.o\n      __locale_localeconv in _localemodule.o\n  \"_libintl_textdomain\", referenced from:\n      __locale_textdomain in _localemodule.o\nld: symbol(s) not found for architecture arm64\n</code></pre> <p>\u662f\u5728\u7f16\u8bd1 python3.11.3 \u7684\u65f6\u5019\u9047\u5230\u7684\u95ee\u9898\uff0c\u7ecf\u8fc7\u4e00\u756a\u641c\u7d22\uff0c\u53d1\u73b0\u6709\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\u6bd4\u8f83\u76f8\u5173\uff1adev-lang/python-3.11.3: bootstrap-prefix.sh stage3 fails (on MacOS/Darwin)\uff0c\u4e5f\u662f\u5728\u7f16\u8bd1 python3.11.3 \u7684\u65f6\u5019\u51fa\u9519\uff0c\u53ea\u4e0d\u8fc7\u9519\u8bef\u4fe1\u606f\u4e0d\u592a\u4e00\u6837\u3002</p> <p>\u6211\u770b\u5230\u8fd9\u4e2a bug report \u65f6\uff0c\u91cc\u9762\u8bf4\u95ee\u9898\u5728\u65b0\u7684 commit \u5df2\u7ecf\u4fee\u590d\u4e86\uff0c\u4f46\u662f\u6211\u4ed4\u7ec6\u770b\u4e86\u4e00\u4e0b\uff0c\u4fee\u590d\u7684\u65f6\u95f4\u6b63\u597d\u5728\u6211\u8dd1 bootstrap \u811a\u672c\u540e\u51e0\u4e2a\u5c0f\u65f6\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u8dd1\u7684\u7248\u672c\u662f\u4fee\u590d\u524d\u7684\u7248\u672c\u3002\u4e8e\u662f\u6211\u91cd\u65b0\u4e0b\u8f7d\u4e86\u6700\u65b0\u7248\uff0c\u91cd\u65b0 bootstrap\uff0c\u53c8\u7b49\u4e86\u4e24\u4e2a\u5c0f\u65f6\uff0c\u8fd8\u662f\u51fa\u73b0\u4e86\u540c\u6837\u7684\u95ee\u9898\uff0c\u8bf4\u660e\u95ee\u9898\u5e76\u6ca1\u6709\u88ab\u89e3\u51b3\u3002</p>","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/#libintl","title":"libintl","text":"<p>\u89c2\u5bdf\u9519\u8bef\u4fe1\u606f\uff0c\u53d1\u73b0\u662f libintl \u76f8\u5173\u7684\u7b26\u53f7\u7f3a\u5931\u3002\u5411 @heroxbd \u5b66\u4e60\u5230\u4e86 libintl \u7684\u673a\u5236\uff1a\u5b83\u662f\u4e00\u5957 API\uff0c\u5728 glibc \u548c musl \u7b49\u4e00\u4e9b libc \u4e2d\u6709\u5b9e\u73b0\uff0c\u5728 gettext \u4e2d\u4e5f\u6709\u5b9e\u73b0\uff0c\u7cfb\u7edf\u91cc\u53ea\u9700\u8981\u6709\u4e00\u4efd\u5c31\u884c\u3002\u56e0\u6b64\u5728\u5e38\u89c1\u7684 Linux \u53d1\u884c\u7248\u91cc\uff0clibintl \u662f\u7531 libc \u63d0\u4f9b\u7684\uff0c\u6b64\u65f6 gettext \u7f16\u8bd1\u7684\u65f6\u5019\u5c31\u4e0d\u4f1a\u9644\u5e26 libintl\uff1b\u800c\u5982\u679c\u5728 macOS \u4e0a\uff0c\u7531\u4e8e macOS \u7684 libc \u6ca1\u6709 libintl \u7684 API\uff0c\u6240\u4ee5 gettext \u7f16\u8bd1\u7684\u65f6\u5019\u5c31\u8981\u9644\u5e26 libintl\u3002</p> <p>\u4f8b\u5982 Homebrew \u7684\u7f16\u8bd1\u811a\u672c\u91cc\uff0c\u5c31\u505a\u4e86\u8fd9\u4e2a\u7279\u6b8a\u5904\u7406\uff1a</p> <pre><code>$ brew cat gettext\n# omitted\n    args &lt;&lt; if OS.mac?\n      # Ship libintl.h. Disabled on linux as libintl.h is provided by glibc\n      # https://gcc-help.gcc.gnu.narkive.com/CYebbZqg/cc1-undefined-reference-to-libintl-textdomain\n      # There should never be a need to install gettext's libintl.h on\n      # GNU/Linux systems using glibc. If you have it installed you've borked\n      # your system somehow.\n      \"--with-included-gettext\"\n    else\n      \"--with-libxml2-prefix=#{Formula[\"libxml2\"].opt_prefix}\"\n    end\n# omitted\n</code></pre> <p>\u5728 Gentoo \u4e2d\uff0c\u5904\u7406\u65b9\u5f0f\u662f\u8fd9\u6837\u7684\uff1a\u628a gettext \u7684\u6e90\u7801\u7f16\u8bd1\u4e24\u4efd\uff0c\u5bf9\u5e94\u4e24\u4e2a\u5305\uff0c\u4e00\u4e2a\u5305\u53eb\u505a gettext\uff0c\u4e5f\u5c31\u662f gettext \u53bb\u6389 libintl \u7684\u90e8\u5206\uff1b\u53e6\u4e00\u4e2a\u5305\u53eb\u505a libintl\uff0c\u4e5f\u5c31\u662f gettext \u7684 libintl \u90e8\u5206\u3002\u4e24\u4e2a\u5305\u7528\u540c\u4e00\u4efd\u6e90\u7801\uff0c\u53ea\u662f\u7f16\u8bd1\u9009\u9879\u4e0d\u540c\uff0c\u56e0\u6b64\u5f97\u5230\u4e86\u4e0d\u540c\u7684\u7ed3\u679c\u3002</p> <p>\u90a3\u4e48\uff0c\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u7f3a\u7b26\u53f7\u5462\uff1f\u6bd4\u8f83\u4e00\u4e0b homebrew \u548c gentoo \u7f16\u8bd1\u51fa\u6765\u7684 libintl.dylib \u7b26\u53f7\uff0c\u53ef\u4ee5\u53d1\u73b0\u533a\u522b\uff1a</p> <pre><code>$ objdump -t /opt/homebrew/opt/gettext/lib/libintl.a | grep bindtextdomain\n0000000000000000 g     F __TEXT,__text _libintl_bindtextdomain\n000000000000001c g     F __TEXT,__text _bindtextdomain\n0000000000000000         *UND* _libintl_bindtextdomain\n$ objdump -t $EPREFIX/tmp/usr/lib/libintl.dylib | grep bindtextdomain\n0000000000009a34 l     F __TEXT,__text _bindtextdomain\n0000000000004800 g     F __TEXT,__text _libintl_bindtextdomain\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u8005\u7684\u533a\u522b\u662f visibility \u4ece global \u53d8\u6210\u4e86 local\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u4e5f\u51fa\u73b0\u4e86 warning\uff1a</p> <pre><code>ld: warning: cannot export hidden symbol _bindtextdomain from .libs/intl-compat.o\n</code></pre> <p>@heroxbd \u7ed9\u51fa\u4e86\u4e34\u65f6\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <pre><code>$ gl_cv_cc_visibility=no $EPREFIX/tmp/usr/bin/emerge -1v libintl\n</code></pre> <p>\u7f16\u8bd1\u7684\u65f6\u5019\u5f3a\u5236\u628a <code>-fvisibility=hidden</code> \u8986\u76d6\u6389\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u6709 visibility \u7684\u95ee\u9898\uff1a</p> <pre><code>$ objdump -t /Volumes/Data/gentoo/tmp/usr/lib/libintl.dylib | grep bindtextdomain\n0000000000009a34 g     F __TEXT,__text _bindtextdomain\n0000000000004800 g     F __TEXT,__text _libintl_bindtextdomain\n</code></pre> <p>\u6b64\u65f6\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\uff0c\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1 python3\u3002</p>","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2023/07/08/gentoo-prefix-m1/#\u5176\u4ed6\u95ee\u9898","title":"\u5176\u4ed6\u95ee\u9898","text":"<p>\u76ee\u524d\u8fd8\u9047\u5230\u4e86\u4e00\u4e2a\u5c0f bug\uff1agettext \u5f3a\u5236\u6253\u5f00\u4e86 xattr\uff08https://bugs.gentoo.org/910070\uff09\uff0c\u4f46\u662f attr \u5728 macOS \u4e0a\u7f16\u8bd1\u4e0d\u8fc7\uff0c\u89e3\u51b3\u529e\u6cd5\u662f\u518d force \u628a xattr USE \u5220\u6389\uff1a</p> <pre><code>$ cat /etc/portage/profile/package.use.force\n&gt;=sys-devel/gettext-0.22-r1 -xattr\n</code></pre>","tags":["gentoo","gentoo-prefix","macos","m1"]},{"location":"devops/2021/03/16/gitlab-ci-k8s-integration/","title":"\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s","text":"","tags":["k8s","kubernetes","docker","gitlab","gitlabci","ci","helm"]},{"location":"devops/2021/03/16/gitlab-ci-k8s-integration/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728 k8s \u96c6\u7fa4\u4e2d\u90e8\u7f72\u4e86 gitlab-runner\uff0c\u5e76\u4e14\u5e0c\u671b\u5728 gitlab ci \u6784\u5efa\u5b8c\u6210\u540e\uff0c\u628a\u65b0\u7684 docker image push \u5230 private repo\uff0c\u7136\u540e\u66f4\u65b0\u5e94\u7528\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1aGitlab CI \u4e0e Kubernetes \u7684\u7ed3\u5408\uff0cUsing Docker to build Docker images\u3002</p>","tags":["k8s","kubernetes","docker","gitlab","gitlabci","ci","helm"]},{"location":"devops/2021/03/16/gitlab-ci-k8s-integration/#\u5728-gitlab-ci-\u4e2d\u6784\u5efa-docker-\u955c\u50cf","title":"\u5728 gitlab ci \u4e2d\u6784\u5efa docker \u955c\u50cf","text":"<p>\u8fd9\u4e00\u6b65\u9700\u8981 DinD \u6765\u5b9e\u73b0\u5728\u5bb9\u5668\u4e2d\u6784\u5efa\u5bb9\u5668\u3002\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\uff0c\u9996\u5148\u8981\u5728 gitlab-runner \u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0\u4e00\u4e2a volume \u6765\u5171\u4eab DinD \u7684\u8bc1\u4e66\u8def\u5f84\uff1a</p> <pre><code>gitlabUrl: REDACTED\nrbac:\n  create: true\nrunnerRegistrationToken: REDACTED\nrunners:\n  config: |\n    [[runners]]\n      [runners.kubernetes]\n        image = \"ubuntu:20.04\"\n        privileged = true\n      [[runners.kubernetes.volumes.empty_dir]]\n        name = \"docker-certs\"\n        mount_path = \"/certs/client\"\n        medium = \"Memory\"\n  privileged: true\n</code></pre> <p>\u6ce8\u610f\u4e24\u70b9\uff1a1. privileged 2. \u591a\u51fa\u6765\u7684 volume</p> <p>\u7528 helm \u90e8\u7f72 gitlab runner \u4e4b\u540e\uff0c\u6309\u7167\u4e0b\u9762\u7684\u65b9\u5f0f\u914d\u7f6e gitlab-ci\uff1a</p> <pre><code>image: docker:19.03.12\n\nvariables:\n  DOCKER_HOST: tcp://docker:2376\n  #\n  # The 'docker' hostname is the alias of the service container as described at\n  # https://docs.gitlab.com/ee/ci/docker/using_docker_images.html#accessing-the-services.\n  # If you're using GitLab Runner 12.7 or earlier with the Kubernetes executor and Kubernetes 1.6 or earlier,\n  # the variable must be set to tcp://localhost:2376 because of how the\n  # Kubernetes executor connects services to the job container\n  # DOCKER_HOST: tcp://localhost:2376\n  #\n  # Specify to Docker where to create the certificates, Docker will\n  # create them automatically on boot, and will create\n  # `/certs/client` that will be shared between the service and job\n  # container, thanks to volume mount from config.toml\n  DOCKER_TLS_CERTDIR: \"/certs\"\n  # These are usually specified by the entrypoint, however the\n  # Kubernetes executor doesn't run entrypoints\n  # https://gitlab.com/gitlab-org/gitlab-runner/-/issues/4125\n  DOCKER_TLS_VERIFY: 1\n  DOCKER_CERT_PATH: \"$DOCKER_TLS_CERTDIR/client\"\n  DOCKER_DAEMON_OPTIONS: \"--insecure-registry=${REGISTRY}\"\n\nservices:\n  - name: docker:19.03.12-dind\n    entrypoint: [\"sh\", \"-c\", \"dockerd-entrypoint.sh $DOCKER_DAEMON_OPTIONS\"]\n\nbefore_script:\n  # Wait until client certs are generated\n  # https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27384\n  - until docker info; do sleep 1; done\n  - echo \"$REGISTRY_PASS\" | docker login $REGISTRY --username $REGISTRY_USER --password-stdin\n\nbuild:\n  stage: build\n  script: ./build.sh\n</code></pre> <p>\u8fd9\u91cc\u6709\u5f88\u591a\u7ec6\u8282\uff0c\u5305\u62ec DinD \u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u7b49\u5f85 client cert\uff0c\u8bbe\u7f6e docker \u7684 insecure registry \u548c login \u7b49\u7b49\u3002\u7ecf\u8fc7 @CircuitCoder \u7684\u4e0d\u65ad\u6478\u7d22\uff0c\u7ec8\u4e8e\u5199\u51fa\u4e86\u53ef\u4ee5\u7528\u7684\u914d\u7f6e\u3002</p> <p>\u5982\u6b64\u914d\u7f6e\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 gitlab ci \u7684\u6784\u5efa\u811a\u672c\u91cc\u7528 docker \u6765 build \u5e76\u4e14 push \u5230\u81ea\u5df1\u7684 registry \u4e86\u3002\u4e3a\u4e86\u9632\u6b62\u6cc4\u9732\u5bc6\u94a5\uff0c\u5efa\u8bae\u628a\u8fd9\u4e9b\u53d8\u91cf\u653e\u5230 gitlab ci \u8bbe\u7f6e\u7684 secrets \u4e2d\u3002</p>","tags":["k8s","kubernetes","docker","gitlab","gitlabci","ci","helm"]},{"location":"devops/2021/03/16/gitlab-ci-k8s-integration/#\u81ea\u52a8\u90e8\u7f72\u5230-k8s","title":"\u81ea\u52a8\u90e8\u7f72\u5230 k8s","text":"<p>\u4e3a\u4e86\u8ba9 k8s \u91cd\u542f\u4e00\u4e2a deployment\uff0c\u4e00\u822c\u7684\u505a\u6cd5\u662f\uff1a</p> <pre><code>kubectl -n NAMESPACE rollout restart deployment/NAME\n</code></pre> <p>\u6211\u4eec\u5e0c\u671b gitlab ci \u5728 build \u4e4b\u540e\uff0c\u53bb\u6267\u884c\u8fd9\u4e00\u4e2a\u547d\u4ee4\uff0c\u4f46\u53c8\u4e0d\u5e0c\u671b\u63d0\u4f9b\u592a\u591a\u7684\u6743\u9650\u7ed9 gitlab\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u521b\u5efa Service Account \u5e76\u8bbe\u7f6e\u6700\u5c0f\u6743\u9650\uff1a</p> <pre><code>---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: gitlab\n  namespace: default\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: gitlab-test\n  namespace: test\nrules:\n- verbs:\n    - get\n    - patch\n  apiGroups:\n    - 'apps'\n  resources:\n    - 'deployments'\n  resourceNames:\n    - 'test-deployment'\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: gitlab\n  namespace: test\nsubjects:\n  - kind: ServiceAccount\n    name: gitlab\n    namespace: default\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: gitlab-test\n</code></pre> <p>\u8981\u7279\u522b\u6ce8\u610f\u8fd9\u51e0\u4e2a\u914d\u7f6e\u7684 namespace \u7684\u5bf9\u5e94\u5173\u7cfb\uff1aRole \u548c RoleBinding \u9700\u8981\u653e\u5728\u540c\u4e00\u4e2a ns \u4e0b\u3002</p> <p>\u63a5\u7740\uff0c\u5230 GitLab \u7684 Operations-&gt;Kubernetes \u521b\u5efa cluster\uff0c\u628a service account \u7684 token \u548c ca.crt \u4ece secret \u91cc\u627e\u5230\u5e76\u8d34\u5230\u7f51\u9875\u4e0a\u3002GitLab \u4f1a\u6309\u7167 Environment scope \u5339\u914d\u5230 environment\uff0c\u5982\u679c\u67d0\u4e2a stage \u7684 environment \u5339\u914d\u4e0a\u4e86\uff0c\u5c31\u4f1a\u628a kube credentials \u914d\u7f6e\u597d\u3002\u4fee\u6539 gitlab-ci.yml\uff1a</p> <pre><code>deploy:\n  stage: deploy\n  image: bitnami/kubectl:1.20\n  environment:\n    name: production\n  only:\n    - master\n  script:\n    - kubectl -n test rollout restart deployment/test\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u914d\u7f6e\u4e86\u3002</p>","tags":["k8s","kubernetes","docker","gitlab","gitlabci","ci","helm"]},{"location":"devops/2019/05/25/htpdate-for-time-sync/","title":"\u7528 htpdate \u66ff\u4ee3 ntpdate \u5b9e\u73b0\u65f6\u95f4\u540c\u6b65","text":"<p>\u6700\u8fd1\u7528 ntpdate \u7684\u65f6\u5019\u9047\u5230\u4e86\u4e00\u4e9b\u9ebb\u70e6\uff0c\u65f6\u95f4\u540c\u6b65\u603b\u662f\u9047\u5230\u5404\u79cd\u95ee\u9898\u3002\u540e\u6765\u641c\u4e86\u641c\uff0c\u53d1\u73b0\u4e86\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff1ahtpdate\uff0c\u5b83\u901a\u8fc7 HTTP \u5934\u91cc\u7684 Date \u5b57\u6bb5\u83b7\u53d6\u65f6\u95f4\uff0c\u867d\u7136\u6ca1\u6709 ntp \u90a3\u4e48\u7cbe\u786e\uff0c\u4f46\u662f\u5927\u591a\u65f6\u5019\u90fd\u591f\u7528\u3002</p> <p>\u7528\u6cd5\u89c1 htpdate(8) \u3002</p>","tags":["ntp","ntpdate","http","httpdate"]},{"location":"devops/2018/07/11/installing-debian-in-lemote-yeeloong/","title":"\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie","text":"<p>\u53c2\u8003\u7f51\u7ad9\uff1a</p> <p>gNewSense To MIPS Run a TFTP server on macOS Debian on Yeeloong Debian MIPS port wiki Debian MIPS port</p> <p>\u9996\u5148\uff0c\u8fdb\u5165\u8bbe\u5907\u7684 PMON\uff1a <pre><code>Press Del to enter PMON\n</code></pre></p> <p>\u7136\u540e\uff0c\u4e0b\u8f7d Debian Jessie \u7684 netboot \u6587\u4ef6\uff1a <pre><code>$ wget https://mirrors.tuna.tsinghua.edu.cn/debian/dists/jessie/main/installer-mipsel/current/images/loongson-2f/netboot/vmlinux-3.16.0-6-loongson-2f\n$ wget https://mirrors.tuna.tsinghua.edu.cn/debian/dists/jessie/main/installer-mipsel/current/images/loongson-2f/netboot/initrd.gz\n</code></pre></p> <p>\u4ee5 macOS \u4e3a\u4f8b\uff0c\u8d77\u4e00\u4e2a tftp \u670d\u52a1\u5668\u4ee5\u4f9b\u8fdc\u7a0b\u4e0b\u8f7d\uff1a <pre><code># ln -s these files to /private/tftpboot:\n# initrd.gz\n# vmlinux-4.16.0-6-loongson-2f\n$ sudo launchctl load -F /System/Library/LaunchDaemons/tftp.plist\n# set addr manually to 192.168.2.1\n</code></pre></p> <p>\u56de\u5230 PMON\uff0c\u914d\u7f6e\u8fdc\u7a0b\u542f\u52a8\uff1a <pre><code>&gt; ifaddr rtl0 192.168.2.2\n&gt; load tftp://192.168.2.1/vmlinux-3.16.0-6-loongson-2f\n&gt; initrd tftp://192.168.2.1/initrd.gz\n&gt; g\n</code></pre></p> <p>\u4e4b\u540e\u5c31\u662f\u719f\u6089\u7684 Debian Installer \u754c\u9762\u3002\u8d77\u6765\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u987a\u624b\u628a tftp \u670d\u52a1\u5668\u5173\u4e86\uff1a <pre><code>$ sudo launchctl unload -F /System/Library/LaunchDaemons/tftp.plist\n</code></pre></p> <p>\u5b9e\u6d4b\u6eda\u5230 stretch \u4f1a\u6302\u3002\u56e0\u4e3a stretch \u867d\u7136\u4e5f\u6709 mipsel \u67b6\u6784\uff0c\u4f46\u662f\u5b83\u7684 revision \u4e0e Loongson-2f \u4e0d\u5927\u4e00\u6837\uff0c\u4f1a\u5230\u5904\u51fa\u73b0 SIGILL \u7684\u95ee\u9898\uff0c\u4e0d\u53ef\u7528\u3002\u9760 jessie \u548c jessie-backports \u5df2\u7ecf\u6709\u4e0d\u5c11\u7684\u8f6f\u4ef6\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002</p>","tags":["debian","mips","loongson","lemote","yeeloong","jessie"]},{"location":"devops/2021/03/12/k3s-deploy/","title":"\u7528 k3s \u90e8\u7f72 k8s","text":"","tags":["k8s","k3s","kubernetes"]},{"location":"devops/2021/03/12/k3s-deploy/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u9700\u8981\u90e8\u7f72\u4e00\u4e2a k8s \u96c6\u7fa4\uff0c\u89c9\u5f97\u4e4b\u524d\u914d\u7f6e kubeadm \u592a\u7e41\u7410\u4e86\uff0c\u60f3\u8981\u627e\u4e00\u4e2a\u7b80\u5355\u7684\u3002\u6bd4\u8f83\u4e86\u4e00\u4e0b k0s \u548c k3s\uff0c\u6700\u540e\u9009\u62e9\u4e86 k3s\u3002</p>","tags":["k8s","k3s","kubernetes"]},{"location":"devops/2021/03/12/k3s-deploy/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>k3s \u7684\u597d\u5904\u5c31\u662f\u914d\u7f6e\u5341\u5206\u7b80\u5355\uff1ahttps://rancher.com/docs/k3s/latest/en/quick-start/\u3002\u4e0d\u9700\u8981\u88c5 docker\uff0c\u4e5f\u4e0d\u9700\u8981\u88c5 kubeadm\u3002</p> <ol> <li>\u5728\u7b2c\u4e00\u4e2a node \u4e0a\u8dd1\uff1a<code>curl -sfL https://get.k3s.io | sh -</code></li> <li>\u5728\u7b2c\u4e00\u4e2a node \u4e0a\u83b7\u53d6 token\uff1a<code>cat /var/lib/rancher/k3s/server/node-token</code></li> <li>\u5728\u5176\u4ed6 node \u4e0a\u8dd1\uff1a<code>curl -sfL https://get.k3s.io | K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken sh -</code></li> </ol> <p>\u7136\u540e\u5c31\u641e\u5b9a\u4e86\u3002\u4ece\u7b2c\u4e00\u4e2a node \u7684 <code>/etc/rancher/k3s/k3s.yaml</code>\u83b7\u53d6 <code>kubectl</code> \u914d\u7f6e\u3002</p>","tags":["k8s","k3s","kubernetes"]},{"location":"devops/2022/02/22/k3s-traefik-client-ip/","title":"\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898","text":"","tags":["k8s","k3s","kubernetes","traefik","proxy"]},{"location":"devops/2022/02/22/k3s-traefik-client-ip/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u628a\u5e94\u7528\u8fc1\u79fb\u5230 k3s \u4e2d\uff0c\u7136\u540e\u7528\u4e86 traefik \u4f5c\u4e3a Ingress Controller\uff0c\u53d1\u73b0\u65e0\u6cd5\u83b7\u5f97\u771f\u5b9e\u7684\u7528\u6237 IP \u5730\u5740\uff0c\u800c\u662f cni \u5185\u90e8\u7684\u5730\u5740\u3002\u641c\u7d22\u4e86\u4e00\u756a\uff0c\u627e\u5230\u4e86\u9760\u8c31\u7684\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>Traefik Kubernetes Ingress and X-Forwarded-Headers</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u9700\u8981\u7ed9 traefik \u4f20\u989d\u5916\u7684\u53c2\u6570\uff0c\u65b9\u6cd5\u662f\u5728 k3s \u7684\u914d\u7f6e\u76ee\u5f55\u4e0b\uff0c\u6dfb\u52a0\u4e00\u4e2a HelmChartConfig\uff1a</p> <pre><code># edit /var/lib/rancher/k3s/server/manifests/traefik-config.yaml\n# content:\napiVersion: helm.cattle.io/v1\nkind: HelmChartConfig\nmetadata:\n  name: traefik\n  namespace: kube-system\nspec:\n  valuesContent: |-\n    additionalArguments:\n      - \"--entryPoints.web.proxyProtocol.insecure\"\n      - \"--entryPoints.web.forwardedHeaders.insecure\"\n</code></pre> <p>\u8fd9\u6837\u76f8\u5f53\u4e8e\u8ba9 traefik \u4fe1\u4efb\u524d\u4e00\u7ea7\u4ee3\u7406\u4f20\u8fc7\u6765\u7684\u8fd9\u4e9b\u5934\u90e8\u3002\u66f4\u7cbe\u7ec6\u7684\u8bdd\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u4fe1\u4efb\u7684 IP \u5730\u5740\u8303\u56f4\uff0c\u4e0d\u8fc7\u5982\u679c traefik \u4e0d\u4f1a\u76f4\u63a5\u66b4\u9732\u51fa\u53bb\uff0c\u5c31\u4e0d\u7528\u8003\u8651\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002</p>","tags":["k8s","k3s","kubernetes","traefik","proxy"]},{"location":"devops/2020/04/22/k8s-code-server/","title":"\u5728 k8s \u4e2d\u90e8\u7f72 code-server","text":"<p>\u5b9e\u9a8c\u4e86\u4e00\u4e0b\u5728 k8s \u4e2d\u90e8\u7f72 code-server\uff0c\u5e76\u4e0d\u590d\u6742\uff0c\u548c\u4e4b\u524d\u51e0\u7bc7\u535a\u5ba2\u7684\u914d\u7f6e\u662f\u7c7b\u4f3c\u7684\uff1a</p> <pre><code>apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: code\n  labels:\n    app: code\nspec:\n  selector:\n    matchLabels:\n      app: code\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: code\n    spec:\n      volumes:\n        - name: code-volume\n          persistentVolumeClaim:\n              claimName: code-pvc\n      initContainers:\n      - name: home-init\n        image: busybox\n        command: [\"sh\", \"-c\", \"chown -R 1000:1000 /home/coder\"]\n        volumeMounts:\n        - mountPath: \"/home/coder\"\n          name: code-volume\n      containers:\n      - image: codercom/code-server:latest\n        imagePullPolicy: Always\n        name: code\n        volumeMounts:\n          - mountPath: \"/home/coder\"\n            name: code-volume\n        resources:\n          limits:\n            cpu: \"0.5\"\n            memory: \"500Mi\"\n        ports:\n        - containerPort: 8080\n        env:\n          - name: PASSWORD\n            value: REDACTED\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: code\n  labels:\n    app: code\nspec:\n  ports:\n    - port: 8080\n  selector:\n    app: code\n\n---\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-code\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    cert-manager.io/cluster-issuer: \"letsencrypt-prod\"\n    nginx.org/websocket-services: \"code\"\nspec:\n  tls:\n  - hosts:\n    - example.com\n    secretName: code-tls\n  rules:\n  - host: example.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: code\n          servicePort: 8080\n\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: code-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  volumeMode: Filesystem\n  resources:\n    requests:\n      storage: 1Gi\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u51e0\u4e2a\u70b9\uff1a</p> <ol> <li>\u7528\u4e86\u4e00\u4e2a pvc \u7528\u4e8e /home/coder \u7684\u6301\u4e45\u5316\uff0c\u6240\u4ee5\u4f60\u7684\u96c6\u7fa4\u91cc\u5f97\u6709\u76f8\u5e94\u7684 pv/storage class</li> <li>\u6211\u7528\u7684\u662f Nginx Inc. \u7684 ingress controller\uff0c\u5b83\u7684 websocket \u652f\u6301\u9700\u8981\u4e00\u53e5 nginx.org/websocket-services \u8bbe\u7f6e</li> <li>\u989d\u5916\u6dfb\u52a0\u4e86\u4e00\u4e2a init container\uff0c\u4e3a\u4e86\u5904\u7406 home \u76ee\u5f55\u7684\u6743\u9650</li> </ol>","tags":["k8s","kubernetes","tencentcloud","vscode","code-server"]},{"location":"devops/2020/03/10/k8s-deploy-with-hpa/","title":"\u7528 Kubernetes \u90e8\u7f72\u65e0\u72b6\u6001\u670d\u52a1","text":"","tags":["k8s","kubernetes","docker"]},{"location":"devops/2020/03/10/k8s-deploy-with-hpa/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u9700\u8981\u90e8\u7f72\u4e00\u4e2a\u7528\u6765\u8dd1\u7f16\u8bd1\u7684\u670d\u52a1\uff0c\u670d\u52a1\u4ece MQ \u53d6\u4efb\u52a1\uff0c\u7f16\u8bd1\u5b8c\u4ee5\u540e\u63d0\u4ea4\u4efb\u52a1\u3002\u6700\u521d\u7684\u505a\u6cd5\u662f\u5305\u88c5\u6210 docker\uff0c\u7136\u540e\u7528 docker-compose \u6765 scale up\u3002\u4f46\u65e2\u7136\u6709 k8s \u8fd9\u4e48\u597d\u7684\u5de5\u5177\uff0c\u5c31\u8bd5\u7740\u5b66\u4e60\u4e86\u4e00\u4e0b\uff0c\u8e29\u4e86\u5f88\u591a\u5751\uff0c\u603b\u7ed3\u4e86\u4e00\u4e9b\u9700\u8981\u7528\u5230\u7684\u547d\u4ee4\u3002</p>","tags":["k8s","kubernetes","docker"]},{"location":"devops/2020/03/10/k8s-deploy-with-hpa/#\u642d\u5efa-docker-registry","title":"\u642d\u5efa Docker Registry","text":"<p>\u9996\u5148\u642d\u5efa\u4e00\u4e2a\u672c\u5730\u7684 Docker Repository\uff0c\u9996\u5148\u8bbe\u7f6e\u5bc6\u7801\uff1a</p> <pre><code>$ mkdir auth\n$ htpasswd user pass &gt; auth/passwd\n</code></pre> <p>\u7136\u540e\u8fd0\u884c registry\uff1a</p> <pre><code>$ docker run -d -p 5000:5000 \\\n        --restart=always \\\n        --name registry \\\n        -v \"$(pwd)/registry\":/var/lib/registry \\\n        -v \"$(pwd)/auth\":/auth \\\n        -e \"REGISTRY_AUTH=htpasswd\" \\\n        -e \"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm\" \\\n        -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \\\n        registry:2\n</code></pre> <p>\u7b80\u5355\u8d77\u89c1\u6ca1\u6709\u914d tls\u3002\u7136\u540e\u5427\u672c\u5730\u7684 image push \u4e0a\u53bb\uff1a</p> <pre><code>$ docker tag $image localhost:5000/$image\n$ docker push localhost:5000/$image\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["k8s","kubernetes","docker"]},{"location":"devops/2020/03/10/k8s-deploy-with-hpa/#\u642d\u5efa-k8s-\u73af\u5883","title":"\u642d\u5efa k8s \u73af\u5883","text":"<p>\u8003\u8651\u5230\u53ea\u7528\u4e86\u5355\u4e2a\u7269\u7406\u673a\uff0c\u6240\u4ee5\u91c7\u7528\u7684\u662f minikube\u3002\u9996\u5148\u4e0b\u8f7d minikube\uff0c\u4e0b\u8f7d\u65b9\u6cd5\u7565\u53bb\u3002</p> <p>\u63a5\u7740\u65b0\u5efa minikube \u865a\u62df\u673a\uff1a</p> <pre><code>$ minikube start --registry-mirror=https://registry.docker-cn.com --image-mirror-country=cn --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --vm-driver=kvm2 --insecure-registry=\"0.0.0.0/0\" --disk-size=50GB --cpus 128 --memory 131072\n</code></pre> <p>\u8fd9\u91cc\u7684 0.0.0.0/0 \u53ef\u4ee5\u7f29\u5c0f\uff0c\u78c1\u76d8\u3001CPU \u548c\u5185\u5b58\u9700\u8981\u5728\u8fd9\u91cc\u5c31\u8bbe\u597d\uff0c\u4e4b\u540e\u4e0d\u80fd\u6539\uff0c\u8981\u6539\u53ea\u80fd\u91cd\u65b0\u5f00\u4e2a\u865a\u62df\u673a\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u633a\u5feb\u7684\u3002</p> <p>\u7136\u540e\u521d\u59cb\u5316\u4e00\u4e9b\u7ec4\u4ef6\uff08metrics server \u548c kubernetes dashboard\uff09\uff1a</p> <pre><code>$ minikube addons enable metrics-server\n$ minikube dashboard\n</code></pre> <p>\u5982\u679c\u8981\u8bbf\u95ee dashboard \u7684\u8bdd\uff0c\u53ef\u4ee5\u7528\u4e0a\u9762\u547d\u4ee4\u8f93\u51fa\u7684\u94fe\u63a5\uff0c\u6216\u8005\u7528 <code>kubectl proxy</code> \u7136\u540e\u6253\u5f00  http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ \uff08\u6ce8\u610f http \u8fd8\u662f https\uff09\u3002</p> <p>\u5982\u679c\u95ee\u5230 Access Token\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b alias \u83b7\u5f97\uff08fish/macOS\uff09\uff1a</p> <pre><code>$ alias kubedashboard=\"kubectl -n kubernetes-dashboard describe secret (kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print \\$1}') | tail -n1 | awk '{print \\$2}' | pbcopy\"\n</code></pre> <p>\u63a5\u7740\uff0c\u914d\u7f6e\u4e00\u4e0b docker registry \u7684\u5bc6\u94a5\uff1a</p> <pre><code>$ kubectl create secret generic regcred --from-file=.dockerconfigjson=/path/to/config.json  --type=kubernetes.io/dockerconfigjson\n</code></pre> <p>\u7136\u540e\uff0c\u5728 Pod/Deployment \u91cc\u9762\u8bbe\u5b9a\u955c\u50cf\uff1a</p> <pre><code>containers:\n  - name: name\n    image: IP:5000/image\nimagePullSecrets:\n  - name: regcred\n</code></pre> <p>\u7136\u540e\u90e8\u7f72\u5373\u53ef\u3002</p>","tags":["k8s","kubernetes","docker"]},{"location":"devops/2020/03/10/k8s-deploy-with-hpa/#\u90e8\u7f72\u6c34\u5e73\u81ea\u52a8\u4f38\u7f29hpa","title":"\u90e8\u7f72\u6c34\u5e73\u81ea\u52a8\u4f38\u7f29\uff08HPA\uff09","text":"<p>\u8fd9\u4e00\u6b65\u914d\u7f6e\u7684\u662f\u81ea\u5e26\u7684 HPA \u529f\u80fd\uff0c\u9700\u8981\u4e0a\u8ff0\u7684 metrics-server \u6253\u5f00\uff0c\u5e76\u4e14\u5728 Pod/Deployment \u91cc\u9762\u5199\u660e resources.requests.cpu:</p> <pre><code>- name: name\n  resources:\n    requests:\n      cpu: \"xxx\"\n</code></pre> <p>\u7136\u540e\u521b\u5efa HPA \u5373\u53ef\uff1a</p> <pre><code>$ kubectl autoscale deployment $deployment --cpu-percent=50 --min=1 --max=10\n</code></pre> <p>\u901a\u8fc7\u538b\u6d4b\uff0c\u53ef\u4ee5\u770b\u5230\u81ea\u52a8\u4f38\u7f29\u7684\u8bb0\u5f55\uff1a</p> <pre><code>$ kubectl describe hpa\nNormal  SuccessfulRescale  22s   horizontal-pod-autoscaler  New size: 4; reason: cpu resource utilization (percentage of request) above target\nNormal  SuccessfulRescale  6s     horizontal-pod-autoscaler  New size: 1; reason: All metrics below target\n</code></pre> <p>\u53c2\u8003\uff1aKubernetes \u5b98\u65b9\u6587\u6863</p>","tags":["k8s","kubernetes","docker"]},{"location":"devops/2020/04/21/k8s-drone-ci/","title":"\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI","text":"<p>\u5b9e\u9a8c\u4e86\u4e00\u4e0b\u5728 k8s \u4e2d\u90e8\u7f72 CI\uff0c\u5728 drone gitlab-ci \u548c jenkins \u4e09\u8005\u4e2d\u9009\u62e9\u4e86 drone\uff0c\u56e0\u4e3a\u5b83\u6bd4\u8f83\u8f7b\u91cf\uff0c\u5e76\u4e14\u57fa\u4e8e docker\uff0c\u53ef\u4ee5\u7528 GitHub \u4e0a\u7684\u4ed3\u5e93\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u9996\u5148\uff0c\u914d\u7f6e helm\uff1a</p> <pre><code>helm repo add drone https://charts.drone.io\nkubectl create ns drone\n</code></pre> <p>\u53c2\u8003 drone \u7684\u6587\u6863\uff0c\u7f16\u5199 drone-values.yml:</p> <pre><code>ingress:\n  enabled: true\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    cert-manager.io/cluster-issuer: \"letsencrypt-prod\"\n  hosts:\n    - host: drone.example.com\n      paths:\n        - \"/\"\n  tls:\n  - hosts:\n    - drone.example.com\n    secretName: drone-tls\nenv:\n  DRONE_SERVER_HOST: drone.example.com\n  DRONE_SERVER_PROTO: https\n  DRONE_USER_CREATE: username:YOUR_GITHUB_USERNAME,admin:true\n  DRONE_USER_FILTER: YOUR_GITHUB_USERNAME\n  DRONE_RPC_SECRET: REDACTED\n  DRONE_GITHUB_CLIENT_ID: REDACTED\n  DRONE_GITHUB_CLIENT_SECRET: REDACTED\n</code></pre> <p>\u9700\u8981\u9996\u5148\u53bb GitHub \u4e0a\u914d\u7f6e OAuth application\uff0c\u5177\u4f53\u53c2\u8003 drone \u7684\u6587\u6863\u3002\u7136\u540e\uff0c\u751f\u6210\u4e00\u4e2a secret\uff0c\u8bbe\u7f6e admin \u7528\u6237\u5e76\u53ea\u5141\u8bb8 admin \u7528\u6237\u4f7f\u7528 drone\uff0c\u9632\u6b62\u5176\u4ed6\u4eba\u4f7f\u7528\u3002\u7136\u540e\u5e94\u7528\uff1a</p> <pre><code>helm install --namespace drone drone drone/drone -f drone-values.yml\n# or, to upgrade\nhelm upgrade --namespace drone drone drone/drone --values drone-values.yml \n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u8bbf\u95ee\u4e0a\u9762\u914d\u597d\u7684\u57df\u540d\u4e86\u3002\u9047\u5230\u4e86 cert manager \u6700\u8fd1\u7684\u4e00\u4e2a bug\uff0c\u6765\u56de\u6298\u817e\u51e0\u6b21\u5c31\u597d\u4e86\u3002</p> <p>\u63a5\u7740\u914d drone \u7684 k8s runnner\uff0c\u4e5f\u662f\u53c2\u8003 drone \u7684\u6587\u6863\uff0c\u7f16\u5199 drone-runner-kube-values.yml\uff1a</p> <pre><code>rbac:\n  buildNamespaces:\n    - drone\nenv:\n  DRONE_RPC_SECRET: REDACTED\n  DRONE_NAMESPACE_DEFAULT: drone\n</code></pre> <p>\u7136\u540e\u5e94\u7528\uff1a</p> <pre><code>helm install --namespace drone drone-runner-kube drone/drone-runner-kube -f drone-runner-kube-values.yml\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u53bb drone \u754c\u9762\u4e0a\u64cd\u4f5c\u4e86\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cdrone \u9700\u8981 pv\uff0c\u6240\u4ee5\u6211\u5148\u5728\u817e\u8baf\u4e91\u91cc\u9762\u914d\u7f6e\u4e86 CFS \u7684 storage class\uff0c\u7136\u540e\u5b83\u5c31\u4f1a\u81ea\u52a8 provision \u4e00\u4e2a\u65b0\u7684 pv \u548c pvc \u51fa\u6765\u3002</p> <p>\u63a5\u7740\u5c1d\u8bd5\u4e86\u4e00\u4e0b\u5728 drone \u91cc\u9762\u6784\u5efa docker \u955c\u50cf\u5e76\u4e14 push \u5230 registry \u4e0a\u3002\u4ee5\u817e\u8baf\u4e91\u4e3a\u4f8b\uff1a</p> <pre><code>kind: pipeline\ntype: kubernetes\nname: default\n\nsteps:\n- name: build\n  image: alpine\n  commands:\n  - make\n\n- name: publish\n  image: plugins/docker\n  settings:\n    registry: ccr.ccs.tencentyun.com\n    repo: ccr.ccs.tencentyun.com/abc/def\n    tags: [\"${DRONE_COMMIT_SHA:0:7}\",\"latest\"]\n    username:\n      from_secret: docker_username\n    password:\n      from_secret: docker_password\n</code></pre> <p>\u7136\u540e\u5728\u7f51\u9875\u91cc\u914d\u7f6e\u597d docker username \u548c password\uff0c\u5b83\u5c31\u4f1a\u81ea\u52a8\u6784\u5efa docker \u955c\u50cf\u5e76\u4e14 push \u5230 registry \u4e0a\uff0c\u7136\u540e\u518d rollout \u4e00\u4e0b deployment \u5c31\u80fd\u90e8\u7f72\u6700\u65b0\u7684 image \u4e86\u3002\u5b9e\u9645\u4e0a\u53ef\u4ee5\u5728 drone \u91cc\u9762\u628a\u90e8\u7f72\u8fd9\u4e00\u6b65\u4e5f\u5b8c\u6210\uff0c\u4f46\u76ee\u524d\u8fd8\u6ca1\u6709\u53bb\u5b9e\u8df5\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>Drone provider: GitHub</p> <p>Drone helm chart</p> <p>Drone runner kube helm chat</p> <p>Building a CD pipeline with drone CI and kubernetes</p>","tags":["k8s","kubernetes","tencentcloud","drone","ci"]},{"location":"devops/2021/04/02/k8s-fluentd-log-collect/","title":"\u7528 fluentd \u6536\u96c6 k8s \u4e2d\u5bb9\u5668\u7684\u65e5\u5fd7","text":"","tags":["k8s","kubernetes","fluentd","logging"]},{"location":"devops/2021/04/02/k8s-fluentd-log-collect/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u7ef4\u62a4\u4e00\u4e2a k8s \u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u9700\u6c42\u5c31\u662f\u628a\u65e5\u5fd7\u6301\u4e45\u5316\u5b58\u4e0b\u6765\uff0c\u4e00\u65b9\u9762\u662f\u65b9\u4fbf\u65e5\u540e\u56de\u6eaf\uff0c\u4e00\u65b9\u9762\u4e5f\u662f\u805a\u5408 replicate \u51fa\u6765\u7684\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u65e5\u5fd7\u3002</p> <p>\u5728\u6211\u76ee\u524d\u7684\u9700\u6c42\u4e0b\uff0c\u53ea\u9700\u8981\u628a\u65e5\u5fd7\u6301\u4e45\u4e0b\u6765\uff0c\u8fd8\u4e0d\u9700\u8981\u505a\u989d\u5916\u7684\u5206\u6790\u3002\u6240\u4ee5\u6211\u5e76\u6ca1\u6709\u90e8\u7f72\u7c7b\u4f3c ElasticSearch \u7684\u670d\u52a1\u6765\u5bf9\u65e5\u5fd7\u8fdb\u884c\u7d22\u5f15\u3002</p>","tags":["k8s","kubernetes","fluentd","logging"]},{"location":"devops/2021/04/02/k8s-fluentd-log-collect/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u5b9e\u73b0\u4e3b\u8981\u53c2\u8003\u5b98\u65b9\u7684\u4ed3\u5e93\uff1ahttps://github.com/fluent/fluentd-kubernetes-daemonset\u3002\u5b83\u628a\u4e00\u4e9b\u5e38\u7528\u7684\u63d2\u4ef6\u6253\u5305\u5230 docker \u955c\u50cf\u4e2d\uff0c\u7136\u540e\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u7684\u8bbe\u7f6e\uff0c\u6bd4\u5982\u83b7\u53d6 k8s \u65e5\u5fd7\u548c pod \u65e5\u5fd7\u7b49\u7b49\u3002\u4e3a\u4e86\u8fbe\u5230\u6211\u7684\u9700\u6c42\uff0c\u6211\u5e0c\u671b\uff1a</p> <ol> <li>\u6bcf\u4e2a\u7ed3\u70b9\u4e0a\u6709\u4e00\u4e2a fluentd \u6536\u96c6\u65e5\u5fd7\uff0cforward \u5230\u5355\u72ec\u7684 log server \u4e0a\u7684 fluentd</li> <li>log server \u4e0a\u7684 fluentd \u628a\u6536\u5230\u7684\u65e5\u5fd7\u4fdd\u5b58\u5230\u6587\u4ef6</li> </ol> <p>\u7531\u4e8e log server \u4e0d\u7531 k8s \u7ba1\u7406\uff0c\u6240\u4ee5\u6309\u7167\u5b98\u7f51\u7684\u65b9\u5f0f\u624b\u52a8\u5b89\u88c5\uff1a</p> <pre><code>curl -fsSL https://toolbelt.treasuredata.com/sh/install-debian-bookworm-fluent-package5.sh | sh\n</code></pre> <p>\u7136\u540e\uff0c\u7f16\u8f91\u914d\u7f6e <code>/etc/td-agent/td-agent.conf</code>\uff1a</p> <pre><code>&lt;source&gt;\n  @type forward\n  @id input_forward\n  bind x.x.x.x\n&lt;/source&gt;\n\n&lt;match **&gt;\n  @type file\n  path /var/log/fluentd/k8s\n  compress gzip\n  &lt;buffer&gt;\n    timekey 1d\n    timekey_use_utc true\n    timekey_wait 10m\n  &lt;/buffer&gt;\n&lt;/match&gt;\n</code></pre> <p>\u5206\u522b\u8bbe\u7f6e\u8f93\u5165\uff1a\u76d1\u542c fluentd forward \u534f\u8bae\uff1b\u8f93\u51fa\uff1a\u8bbe\u7f6e\u8f93\u51fa\u6587\u4ef6\uff0c\u548c buffer \u914d\u7f6e\u3002\u5982\u6709\u9700\u8981\uff0c\u53ef\u4ee5\u52a0\u9274\u6743\u3002</p> <p>\u63a5\u7740\uff0c\u6309\u7167 https://github.com/fluent/fluentd-kubernetes-daemonset/blob/master/fluentd-daemonset-forward.yaml\uff0c\u6211\u505a\u4e86\u4e00\u4e9b\u4fee\u6539\uff0c\u5f97\u5230\u4e86\u4e0b\u9762\u7684\u914d\u7f6e\uff1a</p> <pre><code>---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: fluentd\n  namespace: kube-system\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: fluentd\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - namespaces\n  verbs:\n  - get\n  - list\n  - watch\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: fluentd\nroleRef:\n  kind: ClusterRole\n  name: fluentd\n  apiGroup: rbac.authorization.k8s.io\nsubjects:\n- kind: ServiceAccount\n  name: fluentd\n  namespace: kube-system\n\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: fluentd\n  namespace: kube-system\n  labels:\n    k8s-app: fluentd-logging\n    version: v1\nspec:\n  selector:\n    matchLabels:\n      k8s-app: fluentd-logging\n      version: v1\n  template:\n    metadata:\n      labels:\n        k8s-app: fluentd-logging\n        version: v1\n    spec:\n      serviceAccount: fluentd\n      serviceAccountName: fluentd\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        effect: NoSchedule\n      containers:\n      - name: fluentd\n        image: fluent/fluentd-kubernetes-daemonset:v1-debian-forward\n        env:\n          - name: FLUENT_FOWARD_HOST\n            value: \"x.x.x.x\"\n          - name: FLUENT_FOWARD_PORT\n            value: \"24224\"\n          - name: FLUENTD_SYSTEMD_CONF\n            value: \"disable\"\n        resources:\n          limits:\n            memory: 200Mi\n          requests:\n            cpu: 100m\n            memory: 200Mi\n        volumeMounts:\n        - name: config-volume\n          mountPath: /fluentd/etc/tail_container_parse.conf\n          subPath: tail_container_parse.conf\n        - name: varlog\n          mountPath: /var/log\n        - name: varlibdockercontainers\n          mountPath: /var/lib/docker/containers\n          readOnly: true\n      terminationGracePeriodSeconds: 30\n      volumes:\n      - name: config-volume\n        configMap:\n          name: fluentd-config\n      - name: varlog\n        hostPath:\n          path: /var/log\n      - name: varlibdockercontainers\n        hostPath:\n          path: /var/lib/docker/containers\n\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: fluentd-config\n  namespace: kube-system\ndata:\n  tail_container_parse.conf: |-\n    &lt;parse&gt;\n      @type cri\n    &lt;/parse&gt;\n</code></pre> <p>\u548c\u539f\u7248\u6709\u51e0\u70b9\u7ec6\u8282\u4e0a\u7684\u4e0d\u540c\uff1a</p> <ol> <li>k8s \u542f\u7528\u4e86 rbac\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u5e94\u7684\u914d\u7f6e\uff1b\u7167\u7740\u4ed3\u5e93\u91cc\u5176\u4ed6\u5e26 rbac \u914d\u7f6e\u7684\u6587\u4ef6\u6284\u4e00\u4e0b\u5373\u53ef\u3002</li> <li>\u7981\u7528\u4e86 SYSTEMD \u65e5\u5fd7\u7684\u6293\u53d6\uff0c\u56e0\u4e3a\u6211\u7528\u7684\u662f k3s\uff0c\u800c\u4e0d\u662f kubeadm\uff0c\u81ea\u7136\u627e\u4e0d\u5230 kubelet \u7684 systemd service\u3002</li> <li>\u8986\u76d6\u4e86 container \u65e5\u5fd7\u7684\u8bfb\u53d6\uff0c\u56e0\u4e3a\u4f7f\u7528\u7684 container runtime \u65e5\u5fd7\u683c\u5f0f\u548c\u9ed8\u8ba4\u7684\u4e0d\u540c\uff0c\u8fd9\u90e8\u5206\u8bbe\u7f6e\u5728\u4ed3\u5e93\u7684 README \u4e2d\u4e5f\u6709\u63d0\u5230\u3002</li> </ol> <p>\u90e8\u7f72\u5230 k8s \u4e2d\u5373\u53ef\u3002\u4e3a\u4e86\u4fdd\u8bc1\u65e5\u5fd7\u7684\u51c6\u786e\u6027\uff0c\u5efa\u8bae\u5404\u4e2a\u7ed3\u70b9\u90fd\u4fdd\u6301 NTP \u7684\u540c\u6b65\u3002</p>","tags":["k8s","kubernetes","fluentd","logging"]},{"location":"devops/2020/03/14/k8s-gitlab-runner/","title":"\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u90e8\u7f72 gitlab\u2014runner","text":"<p>\u6309\u7167 GitLab \u4e0a\u7684\u6559\u7a0b\u8bd5\u7740\u628a gitlab-runner \u90e8\u7f72\u5230 k8s \u96c6\u7fa4\u4e0a\uff0c\u53d1\u73b0\u5f02\u5e38\u5730\u7b80\u5355\uff0c\u6240\u4ee5\u7b80\u5355\u505a\u4e2a\u7b14\u8bb0\uff1a</p> <p>\u7f16\u8f91 <code>values.yaml</code></p> <pre><code>gitlabUrl: GITLAB_URL\nrunnerRegistrationToken: \"REDACTED\"\nrbac:\n    create: true\n</code></pre> <p>\u6b64\u5904\u7684\u4fe1\u606f\u6309\u7167 \"Set up a specific Runner manually\" \u4e0b\u9762\u7684\u63d0\u793a\u586b\u5199\u3002\u7136\u540e\u7528 Helm \u8fdb\u884c\u5b89\u88c5\uff1a</p> <pre><code>$ helm repo add gitlab https://charts.gitlab.io\n$ kubectl create namespace gitlab-runner\n$ helm install --namespace gitlab-runner gitlab-runner -f values.yaml gitlab/gitlab-runner\n</code></pre> <p>\u7136\u540e\u53bb Kubernetes Dashboard \u5c31\u53ef\u4ee5\u770b\u5230\u90e8\u7f72\u7684\u60c5\u51b5\uff0c\u56de\u5230 GitLab \u4e5f\u53ef\u4ee5\u770b\u5230\u51fa\u73b0\u4e86\u201cRunners activated for this project\u201d \uff0c\u8868\u793a\u914d\u7f6e\u6210\u529f\u3002</p> <p>\u53c2\u8003\u914d\u7f6e\uff1ahttps://docs.gitlab.com/runner/install/kubernetes.html</p>","tags":["k8s","kubernetes","gitlab","gitlab-runner"]},{"location":"devops/2021/09/18/k8s-networking/","title":"\u7814\u7a76 k8s \u7f51\u7edc\u5de5\u4f5c\u539f\u7406","text":"","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2021/09/18/k8s-networking/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u7528 k8s \u4e5f\u6709\u4e00\u6bb5\u65f6\u95f4\u4e86\uff0c\u4e4b\u524d\u9047\u5230\u8fc7 iptables \u7b49\u51fa\u73b0\u95ee\u9898\uff0c\u5bfc\u81f4 k8s \u8282\u70b9\u95f4\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\uff0c\u4e8e\u662f\u60f3\u7814\u7a76\u4e00\u4e0b k8s \u7684\u7f51\u7edc\u5de5\u4f5c\u539f\u7406\u3002</p>","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2021/09/18/k8s-networking/#docker-\u7f51\u7edc","title":"Docker \u7f51\u7edc","text":"<p>\u9996\u5148\u7814\u7a76\u4e00\u4e0b Docker \u7f51\u7edc\u8fde\u63a5\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002Docker \u9996\u5148\u4f1a\u521b\u5efa\u4e00\u4e2a bridge\uff0c\u540d\u4e3a bridge0:</p> <pre><code>$ ip a show docker0\n3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c4:87:73:bf brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:c4ff:fe87:73bf/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u4f1a\u6709\u5355\u72ec\u7684\u4e00\u4e2a netns\uff0c\u7136\u540e\u521b\u5efa\u4e00\u5bf9 veth pair\uff0c\u4e00\u7aef\u7559\u5728 global netns\uff0c\u53e6\u4e00\u7aef\u653e\u5230\u5bb9\u5668\u4e2d\u3002\u5728 global netns \u4e2d\u7684 veth \u7aef\u53e3\u4f1a\u52a0\u5165\u5230 docker0 \u4e2d\uff1a</p> <pre><code>$ ip a show dev veth3db9316\n21: veth3db9316@if20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default\n    link/ether e2:49:a6:2d:5a:bd brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::e049:a6ff:fe2d:5abd/64 scope link\n       valid_lft forever preferred_lft forever\n$ brctl show docker0\nbridge name     bridge id               STP enabled     interfaces\ndocker0         8000.0242c48773bf       no              veth3db9316\n</code></pre> <p>\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc\uff0c\u5728 veth \u4e0a docker \u4f1a\u5206\u914d\u5e76\u914d\u7f6e\u4e00\u4e2a\u5730\u5740\uff08\u6bd4\u5982 172.17.0.2\uff09\uff0c\u7136\u540e\u8bbe\u7f6e\u9ed8\u8ba4\u8def\u7531 via 172.17.0.1\u3002\u4e00\u65b9\u9762\uff0c\u53ef\u4ee5\u901a\u8fc7\u9ed8\u8ba4\u8def\u7531\u5230 172.17.0.1 \u518d\u901a\u8fc7 iptables NAT \u8bbf\u95ee\u5916\u9762\u7684\u7f51\u7edc\uff1a</p> <pre><code>$ iptables-save -t nat\n# Generated by xtables-save v1.8.2 on Sat Sep 18 10:44:49 2021\n*nat\n:PREROUTING ACCEPT [0:0]\n:INPUT ACCEPT [0:0]\n:POSTROUTING ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n:DOCKER - [0:0]\n-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER\n-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE\n-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER\n-A DOCKER -i docker0 -j RETURN\nCOMMIT\n# Completed on Sat Sep 18 10:44:49 2021\n</code></pre> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u56e0\u4e3a\u8fde\u63a5\u4e0d\u540c\u5bb9\u5668\u7684 veth \u5728\u540c\u4e00\u4e2a bridge \u4e0b\u9762\uff0c\u6240\u4ee5\u4e0d\u540c\u5bb9\u5668\u7684\u53ef\u4ee5\u8ba4\u4e3a\u5728\u540c\u4e00\u4e2a\u4e8c\u5c42\u7f51\u7edc\u4e2d\uff0c\u81ea\u7136\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u3002</p>","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2021/09/18/k8s-networking/#k8s-\u7f51\u7edc","title":"K8s \u7f51\u7edc","text":"<p>\u5728 k8s \u4e2d\uff0c\u6240\u6709\u7684 pod \u90fd\u5e0c\u671b\u53ef\u4ee5\u901a\u8fc7 IP \u5730\u5740\u4e92\u8054\u3002\u4e00\u4e2a\u601d\u8def\u662f\u628a\u5404\u4e2a\u8282\u70b9\u4e0a\u7684 pod \u901a\u8fc7\u7c7b\u4f3c docker \u7684\u65b9\u6cd5\u5b9e\u73b0\uff0c\u5373\u6bcf\u4e2a netns \u901a\u8fc7 veth \u8fde\u63a5\u5230\u4e00\u4e2a bridge \u4e0a\uff0c\u7136\u540e\u518d\u60f3\u529e\u6cd5\u53bb\u8def\u7531\u5728\u5176\u5b83\u8282\u70b9\u4e0a\u7684 pod\u3002</p> <p>\u56e0\u4e3a\u6211\u7528 k3s \u642d\u5efa k8s \u96c6\u7fa4\uff0c\u5b83\u7528\u7684 cni \u662f flannel\u3002flannel \u91c7\u7528\u7684\u662f vxlan \u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\u3002</p> <p>\u9996\u5148\u8fd8\u662f\u770b\u770b\u8282\u70b9\u5185\u7684 pod \u5982\u4f55\u7ec4\u7f51\u3002</p> <pre><code>5: cni0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default qlen 1000\n    link/ether 6a:4f:ff:8b:b1:b3 brd ff:ff:ff:ff:ff:ff\n    inet 10.42.0.1/24 brd 10.42.0.255 scope global cni0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::7cf6:57ff:fed7:c49b/64 scope link\n       valid_lft forever preferred_lft forever\n6: vethc47d6140@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue master cni0 state UP group default\n    link/ether da:19:f8:48:f6:49 brd ff:ff:ff:ff:ff:ff link-netns cni-9d2a5120-16a3-453e-bf64-c4006c06c93b\n    inet6 fe80::d819:f8ff:fe48:f649/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u9996\u5148\uff0cflannel \u7ed9\u6bcf\u4e2a\u8282\u70b9\u5206\u914d\u4e86\u4e00\u4e2a /24 \u7684\u7f51\u6bb5\uff0c\u6bd4\u5982\u7b2c\u4e00\u4e2a\u8282\u70b9\u662f 10.42.0.0/24\uff0c\u7b2c\u4e8c\u4e2a\u662f 10.42.1.0/24\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002\u7136\u540e\uff0c\u8282\u70b9\u5185\u7684 pod \u5c31\u4ece\u8fd9\u4e2a\u7f51\u6bb5\u91cc\u5206\u914d\u5730\u5740\uff0c\u6bd4\u5982 10.42.0.50/24\uff0c\u5b83\u7684\u9ed8\u8ba4\u7f51\u5173\u662f 10.42.0.1\u3002\u8fd9\u4e9b veth \u90fd\u4f1a\u52a0\u5165\u5230 cni0 \u7684 bridge \u4e2d\u3002\u8fd9\u4e00\u90e8\u5206\u539f\u7406\u548c docker \u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u540d\u5b57\u4e0d\u540c\u4e86\u3002\u4e5f\u6709\u76f8\u5e94\u7684 iptables \u89c4\u5219\uff1a</p> <pre><code>$ iptables-save | grep MASQUERADE\n-A POSTROUTING -s 10.42.0.0/16 ! -d 224.0.0.0/4 -j MASQUERADE --random-fully\n-A POSTROUTING ! -s 10.42.0.0/16 -d 10.42.0.0/16 -j MASQUERADE --random-fully\n</code></pre> <p>\u90a3\u4e48\uff0c\u8282\u70b9\u95f4\u7f51\u7edc\u5982\u4f55\u5b9e\u73b0\u5462\uff1f\u5047\u5982\uff0c\u6211\u4eec\u8981\u4ece\u7b2c\u4e00\u4e2a\u8282\u70b9 pod 10.42.0.50/24 \u8bbf\u95ee\u7b2c\u4e8c\u4e2a\u8282\u70b9\u7684 pod 10.42.1.51/24\uff0c\u9996\u5148\uff0cpod \u6839\u636e\u9ed8\u8ba4\u8def\u7531\u4f1a\u53d1\u7ed9 10.42.0.1/24\uff0c\u5230\u8fbe\u7b2c\u4e00\u4e2a\u8282\u70b9\u7684 cni0\uff0c\u7136\u540e\u67e5\u8def\u7531\u8868\uff1a</p> <pre><code>$ ip r\n10.42.0.0/24 dev cni0 proto kernel scope link src 10.42.0.1\n10.42.1.0/24 via 10.42.1.0 dev flannel.1 onlink\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4f1a\u5339\u914d 10.42.1.0/24 via 10.42.1.0 dev flannel.1 \u7684\u8def\u7531\u3002flannel.1 \u662f\u4e00\u4e2a vxlan \u7684 interface\uff1a</p> <pre><code>$ ip a show flannel.1\n4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN group default\n    link/ether b6:2f:39:4a:02:c0 brd ff:ff:ff:ff:ff:ff\n    inet 10.42.0.0/32 scope global flannel.1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::b42f:39ff:fe4a:2c0/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u5f53\u8fd9\u4e2a interface \u63a5\u6536\u5230\u4e00\u4e2a packet \u7684\u65f6\u5019\uff0c\u4f1a\u67e5\u8be2 fdb\uff1a</p> <pre><code>$ bridge fdb show brport flannel.1\n...\n</code></pre> <p>\u8fd9\u4e2a fdb \u4e2d\u5305\u62ec\u4e86 (MAC \u5730\u5740\uff0cIP \u5730\u5740) \u7684 tuple\u3002\u5f53 flannel.1 \u6536\u5230\u4e00\u4e2a Ethernet Frame \u7684\u65f6\u5019\uff0c\u5982\u679c\u76ee\u7684\u5730\u5740\u5339\u914d\u8fd9\u91cc\u7684 MAC \u5730\u5740\uff0c\u5c31\u4f1a\u76f4\u63a5\u628a Eth Frame \u5c01\u88c5\u5230 UDP \u91cc\u9762\u53d1\u7ed9\u76ee\u7684 IP \u5730\u5740\uff1b\u5426\u5219\uff0c\u5c31\u4f1a\u5728\u8fd9\u4e2a\u8868\u91cc\u9762 broadcast\u3002\u8fd9\u6837\uff0c\u7b2c\u4e8c\u4e2a\u8282\u70b9\u5c31\u4f1a\u6536\u5230 packet \u5e76\u4e14\u8f6c\u7ed9\u5b9e\u9645\u7684 pod\u3002</p>","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2021/09/18/k8s-networking/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u603b\u7ed3\u4e00\u4e0b k8s \u7684\u7f51\u7edc\u4e92\u8054\u7684\u5b9e\u73b0\u65b9\u6cd5\uff1a\u8282\u70b9\u5185\u901a\u8fc7 bridge \u5b9e\u73b0\uff0c\u628a\u94fe\u63a5\u5404\u4e2a netns \u7684 veth \u6865\u63a5\u8d77\u6765\uff1b\u8282\u70b9\u95f4\u5212\u5206\u4e3a\u591a\u4e2a\u5b50\u7f51\uff0c\u5b50\u7f51\u95f4\u901a\u8fc7 flannel \u7684\u7f51\u5173\u8fdb\u884c\u8def\u7531\uff0cflannel \u7f51\u5173\u95f4\u901a\u8fc7 vxlan \u8fdb\u884c\u4e92\u8054\u3002</p>","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2021/09/18/k8s-networking/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<p>\u6280\u672f\u5e72\u8d27 | \u6df1\u5165\u7406\u89e3 flannel</p> <p>\u4e00\u6587\u770b\u61c2 k8s \u7684 Flannel \u7f51\u7edc</p>","tags":["k8s","cni","flannel","docker"]},{"location":"devops/2020/04/17/k8s-nginx-cert-manager-le/","title":"\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66","text":"<p>\u4e0a\u4e00\u7bc7\u535a\u5ba2\u8bb2\u4e86 nginx ingress \u7684\u914d\u7f6e\uff0c\u90a3\u81ea\u7136\u7b2c\u4e00\u6b65\u8981\u914d\u4e0a https\u3002\u9996\u5148\u914d\u7f6e cert-manager\uff1a</p> <pre><code>$ kubectl create namespace cert-manager\n$ kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v0.14.1/cert-manager.crds.yaml\n$ helm repo add jetstack https://charts.jetstack.io\n$ helm repo update\n$ helm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --version v0.14.1\n</code></pre> <p>\u7136\u540e\uff0c\u914d\u7f6e Cluster Issuer\uff0c\u5e94\u7528\u4ee5\u4e0b\u7684 yaml\uff1a</p> <pre><code>apiVersion: cert-manager.io/v1alpha2\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-prod\n  namespace: cert-manager\nspec:\n  acme:\n    email: example@example.com\n    server: https://acme-v02.api.letsencrypt.org/directory\n    privateKeySecretRef:\n      name: letsencrypt-prod\n    solvers:\n    - http01:\n        ingress:\n          class: nginx\n</code></pre> <p>\u7136\u540e\u5728 ingress \u91cc\u9762\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-example\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    cert-manager.io/cluster-issuer: \"letsencrypt-prod\"\nspec:\n  tls:\n  - hosts:\n    - example.com\n    secretName: example-tls\n  rules:\n  - host: example.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: example-service\n          servicePort: 80\n</code></pre> <p>\u5e94\u7528\u4ee5\u540e\uff0c\u7528 <code>kubectl describe certificate</code> \u67e5\u770b\u8bc1\u4e66\u83b7\u53d6\u8fdb\u5ea6\u3002\u6210\u529f\u540e\uff0c\u8bbf\u95ee\u6539\u57df\u540d\u7684 HTTP\uff0c\u5c31\u4f1a\u81ea\u52a8\u8df3\u8f6c\u5230 HTTPS\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u6b63\u786e\u7684\u8bc1\u4e66\u3002</p>","tags":["k8s","kubernetes","tencentcloud","ingress","nginx-ingress","letsencrypt","cert-manager"]},{"location":"devops/2020/07/10/k8s-prometheus/","title":"\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus","text":"<p>\u5b9e\u9a8c\u4e86\u4e00\u4e0b\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus\uff0c\u56e0\u4e3a\u5b83\u548c k8s \u6709\u6bd4\u8f83\u597d\u7684\u96c6\u6210\uff0c\u5f88\u591a App \u80fd\u5728 k8s \u91cc\u901a\u8fc7 service discovery \u88ab Prometheus \u627e\u5230\u5e76\u4e14\u6293\u53d6\u6570\u636e\u3002\u5b9e\u8df5\u4e86\u4e00\u4e0b\uff0c\u5176\u5b9e\u5f88\u7b80\u5355\u3002</p> <p>\u7528 helm \u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>helm upgrade --install prometheus stable/prometheus\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u679c\u5df2\u7ecf\u6709 StorageClass\uff08\u6bd4\u5982\u817e\u8baf\u4e91\u7684\u8bdd\uff0cCBS \u548c CFS\uff09\uff0c\u5b83\u5c31\u80fd\u81ea\u5df1\u8d77\u6765\u4e86\uff0c\u7136\u540e\u5728 Lens \u91cc\u9762\u4e5f\u53ef\u4ee5\u770b\u5230\u5404\u79cd metrics \u7684\u53ef\u89c6\u5316\u3002</p> <p>\u5982\u679c\u662f\u81ea\u5efa\u7684\u5355\u7ed3\u70b9\u7684 k8s \u96c6\u7fa4\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u81ea\u5df1\u521b\u9020 PV\uff0c\u5e76\u4e14\u628a PVC \u7ed1\u5b9a\u4e0a\u53bb\u3002\u6211\u91c7\u7528\u7684\u662f local \u7c7b\u578b\u7684 PV\uff1a</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-volume-1\n  labels:\n    type: local\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: \"/srv/k8s-data-1\"\n\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-volume-2\n  labels:\n    type: local\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: \"/srv/k8s-data-2\"\n</code></pre> <p>\u8fd9\u6837\uff0c\u7ed3\u70b9\u4e0a\u7684\u4e24\u4e2a\u8def\u5f84\u5206\u522b\u5bf9\u5e94\u4e24\u4e2a PV\uff0c\u7136\u540e\u53ea\u8981\u8ba9 PVC \u4e5f\u7528 manual \u7684 StorageClass \u5c31\u53ef\u4ee5\u4e86\uff1a</p> <pre><code>server:\n    persistentVolume:\n        storageClass: manual\n\nalertmanager:\n    persistentVolume:\n        storageClass: manual\n</code></pre> <p>\u628a\u8fd9\u4e2a\u6587\u4ef6\u4fdd\u5b58\u4e3a values.yaml \u7136\u540e\uff1a</p> <pre><code>helm upgrade --install prometheus stable/prometheus -f values.yaml\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002\u4e0d\u8fc7 PVC \u4e0d\u80fd\u5728\u7ebf\u6539\uff0c\u53ef\u80fd\u9700\u8981\u5220\u6389\u91cd\u6765\u3002</p> <p>\u7136\u540e\uff0c\u7531\u4e8e\u6743\u9650\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u5728\u7ed3\u70b9\u4e0a\u4fee\u6539\u4e00\u4e0b\u4e24\u4e2a\u76ee\u5f55\u7684\u6743\u9650\uff1a</p> <pre><code>sudo chown -R 65534:65534 /srv/k8s-data-1\nsudo chown -R 65534:65534 /srv/k8s-data-2\n</code></pre> <p>\u8fd9\u6837\u5bb9\u5668\u5185\u5c31\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u4e86\u3002</p>","tags":["k8s","kubernetes","tencentcloud","prometheus","helm"]},{"location":"devops/2019/03/21/new-clean-env-on-old-os/","title":"\u5728\u53e4\u8001\u7684 OS \u4e0a\u8fd0\u884c\u4e00\u4e2a\u5e72\u51c0\u7684\u65b0\u7684\u73af\u5883","text":"<p>\u7531\u4e8e\u67d0\u4e9b\u8bfe\u7a0b\u7684\u539f\u56e0\uff0c\u9700\u8981\u5728\u4e00\u4e2a CentOS 7 \u4e0a\u8dd1\u4e00\u4e9b\u7f16\u8bd1\u548c\u8fd0\u884c\u4ee3\u7801\u3002\u770b\u5230\u8fd9\u4e48\u53e4\u8001\u7684\u8f6f\u4ef6\uff0c\u6211\u5fc3\u60f3\u4e0d\u884c\uff0c\u80af\u5b9a\u8981\u627e\u65b0\u4e00\u4e9b\u7684\u8f6f\u4ef6\u6765\u7528\u3002\u9996\u5148\u60f3\u5230\u7684\u662f tmux\uff0c\u4e8e\u662f\u6309\u7167\u7f51\u4e0a\u7684\u811a\u672c \u5f88\u5feb\u88c5\u4e86\u4e00\u4e2a tmux 2.8 \u7248\u672c\uff0c\u679c\u7136\u597d\u4e86\u5f88\u591a\u3002\u4f46\u662f\u5e38\u7528\u7684\u5f88\u591a\u8f6f\u4ef6\u4f9d\u7136\u662f\u4e2a\u95ee\u9898\u3002\u8bd5\u4e86\u4e00\u4e0b\u6700\u8fd1\u6bd4\u8f83\u65b0\u7684 code-server\uff0c\u56e0\u4e3a ABI \u95ee\u9898\u8dd1\u4e0d\u8d77\u6765\u3002</p> <p>\u4e8e\u662f\u5f00\u59cb\u60f3\u73a9\u9a9a\u64cd\u4f5c\u3002\u9996\u5148\u60f3\u5230\u7684\u662f Gentoo Prefix\uff0c\u4e0d\u8fc7\u65e2\u7136\u662f\u522b\u4eba\u7684\u673a\u5668\uff0c\u8fd8\u662f\u7b97\u4e86\u3002\u53c8\u627e\u4e86 fakeroot \u914d\u5408 alpine rootfs \u7684\u65b9\u6848\uff0c\u4f46\u7f16\u8bd1\u4e0d\u8fc7\uff0c\u4f30\u8ba1\u662f\u5185\u6838\u7248\u672c\u95ee\u9898\u3002\u53c8\u8bd5\u4e86\u4e00\u4e0b fakechroot\uff0c\u4f46\u5b83\u9700\u8981\u914d\u5408 fakeroot \u4f7f\u7528\uff0c\u8fd9\u5c31\u51c9\u4e86\u3002</p> <p>\u7136\u540e\u53c8\u627e\u4e86\u4e00\u4e9b\u66ff\u4ee3\u65b9\u6848\u3002\u4e00\u662f uchroot\uff0c\u4f46\u7531\u4e8e CMake \u7248\u672c\u592a\u8001\u4e5f\u7f16\u8bd1\u4e0d\u8fc7\u3002\u6700\u540e\u53d1\u73b0\u4e86 PRoot \uff0c\u76f4\u63a5\u63d0\u4f9b prebuilt \u7136\u540e\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u8dd1\u8d77\u6765\uff1a</p> <pre><code>$ ./proot -b /proc -b /dev -r $CHROOT /bin/busybox sh\n</code></pre> <p>\u4e8e\u662f\u5c31\u8fdb\u5230\u4e86 alpine \u7684 rootfs \u4e2d\uff0c\u4e0b\u8f7d\u5730\u5740\u3002\u8fdb\u53bb\u4ee5\u540e\u53d1\u73b0\u6ca1\u6709\u7f16\u8f91\u5668\uff0c\u4e8e\u662f\u51fa\u6765\u628a apk \u7684\u6e90\u6539\u4e86\uff0c\u52a0\u4e86 resolv.conf\uff0c\u5c31\u6210\u529f\u5730\u5b89\u88c5\u4e86\u5f88\u591a\u5f88\u65b0\u7684\u8f6f\u4ef6\u4e86\u3002</p>","tags":["centos","alpine","slurm","redhat"]},{"location":"devops/2018/06/01/nginx-proxy-subpath/","title":"\u5728 Nginx \u5c06\u67d0\u4e2a\u5b50\u8def\u5f84\u53cd\u4ee3","text":"<p>\u73b0\u5728\u9047\u5230\u8fd9\u4e48\u4e00\u4e2a\u9700\u6c42\uff0c\u8bbf\u95ee\u6839\u4e0b\u9762\u662f\u63d0\u4f9b\u4e00\u4e2a\u670d\u52a1\uff0c\u8bbf\u95ee\u67d0\u4e2a\u5b50\u8def\u5f84\uff08/abc\uff09\uff0c\u5219\u9700\u8981\u63d0\u4f9b\u53e6\u4e00\u4e2a\u670d\u52a1\u3002\u8fd9\u4e24\u4e2a\u670d\u52a1\u5904\u4e8e\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u6211\u4eec\u73b0\u5728\u901a\u8fc7\u53cd\u4ee3\u628a\u4ed6\u4eec\u5408\u5728\u4e00\u8d77\u3002\u5728\u914d\u7f6e\u8fd9\u4e2a\u7684\u65f6\u5019\uff0c\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u6700\u540e\u5f97\u4ee5\u89e3\u51b3\u3002</p> <pre><code>upstream root {\n    server 1.2.3.4:1234;\n}\nupstream subpath {\n    server 4.3.2.1:4321;\n}\n\nserver {\n    listen 443 ssl;\n    server_name test.example.com;\n\n    # the last slash is useful, see below\n    location /abc/ {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        # the last slash is useful too, see below\n        proxy_pass http://subpath/;\n    }\n\n    location / {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_pass http://root;\n    }\n}\n</code></pre> <p>\u7531\u4e8e\u5e76\u4e0d\u60f3 subpath \u4ed6\u770b\u5230\u8def\u5f84\u4e2d /abc/ \u8fd9\u4e00\u5c42\uff0c\u5bfc\u81f4\u8def\u5f84\u548c\u539f\u6765\u5728\u6839\u4e0b\u4e0d\u540c\uff0c\u901a\u8fc7\u8fd9\u6837\u914d\u7f6e\u4ee5\u540e\uff0c\u7279\u522b\u662f\u4e24\u4e2a\u672b\u5c3e\u7684\u659c\u6760\uff0c\u53ef\u4ee5\u8ba9 nginx \u628a GET /abc/index.html \u6539\u5199\u4e3a GET /index.html\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bb8\u591a\u914d\u7f6e\u3002\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u662f\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u914d\u7f6e\uff0c\u73b0\u5728\u662f host \u5728\u4e00\u4e2a\u65b0\u7684\u57df\u540d\u7684\u4e00\u4e2a\u65b0\u7684\u5b50\u8def\u5f84\u4e0b\uff0c\u8fd9\u4e3b\u8981\u662f\u4e3a\u4e86\u5728\u8fd4\u56de\u7684\u9875\u9762\u4e2d\uff0c\u8fde\u63a5\u5199\u7684\u662f\u6b63\u786e\u7684\u3002</p>","tags":["nginx","http"]},{"location":"devops/2019/05/22/nginx-ssl-upstream/","title":"Nginx \u53cd\u4ee3\u5230 HTTPS \u4e0a\u6e38","text":"<p>\u8fd9\u6b21\u9047\u5230\u4e00\u4e2a\u9700\u6c42\uff0c\u8981\u53cd\u4ee3\u5230\u4e0d\u5728\u5185\u7f51\u7684\u5730\u5740\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b89\u5168\uff0c\u8fd8\u662f\u5f97\u4e0a HTTPS\uff0c\u6240\u4ee5\u5c1d\u8bd5\u4e86\u4e00\u4e0b\u600e\u4e48\u7ed9 upstream \u914d\u7f6e\u81ea\u7b7e\u540d HTTPS \u8bc1\u4e66\u7684\u9a8c\u8bc1\u3002</p> <pre><code>upstream subpath {\n    server 4.3.2.1:4321;\n}\n\nserver {\n    listen 443 ssl;\n    server_name test.example.com;\n\n    location /abc {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_ssl_trusted_certificate /path/to/self_signed_cert.crt;\n        proxy_ssl_name 1.2.3.4; // to override server name checking\n        proxy_ssl_verify on;\n        proxy_ssl_depth 2;\n        proxy_ssl_reuse on;\n        proxy_pass https://subpath;\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u7528 <code>openssl</code> \u83b7\u5f97\u81ea\u7b7e\u540d\u7684 cert :</p> <pre><code>echo | openssl s_client -showcerts -connect 4.3.2.1:4321 2&gt;/dev/null | \\\n                              openssl x509 -text &gt; /path/to/self_signed_cert.crt\n</code></pre> <p>ref: https://stackoverflow.com/questions/7885785/using-openssl-to-get-the-certificate-from-a-server</p>","tags":["nginx","https"]},{"location":"devops/2018/07/06/run-command-in-container-directly/","title":"\u901a\u8fc7 systemd-run \u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4","text":"<p>\u4e4b\u524d\u4f7f\u7528 <code>systemd-nspawn</code> \u5f00\u4e86\u5bb9\u5668\uff0c\u7136\u540e\u901a\u8fc7 <code>machinectl shell</code> \u8fdb\u53bb\uff0c\u60f3\u8981\u8d77\u4e00\u4e2a\u670d\u52a1\u7136\u540e\u4e22\u5230\u540e\u53f0\u7ee7\u7eed\u6267\u884c\uff0c\u4f46\u662f\u53d1\u73b0\u79bb\u5f00\u8fd9\u4e2a session \u540e\u8fd9\u4e2a\u8fdb\u7a0b\u603b\u662f\u4f1a\u88ab\u6740\u6389\uff0c\u4e8e\u662f\u627e\u4e86 <code>systemd-run</code> \u7684\u65b9\u6848\uff0c\u5373\uff1a</p> <pre><code>systemd-run --machine machine_name_here absolute_path_to_executable args_here\n</code></pre> <p>\u8fd9\u6837\u53ef\u4ee5\u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u8dd1\u670d\u52a1\uff0c\u800c\u4e14\u7528\u8fd9\u4e2a\u547d\u4ee4\u8f93\u51fa\u7684\u4e34\u65f6 server \u540d\u79f0\uff0c\u8fd8\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\uff1a</p> <pre><code>journalctl --machine machine_name_here -u unit_name_above\n</code></pre>","tags":["container","lxc","systemd-nspawn","systemd-run"]},{"location":"devops/2020/03/17/setup-k8s-tencentcloud/","title":"\u4f53\u9a8c Tencent Kubernetes Engine","text":"<p>\u4e4b\u524d\u5728\u673a\u5668\u4e0a\u8bd5\u9a8c\u4e86\u4e00\u4e0b kubernetes\uff0c\u611f\u89c9\u633a\u4e0d\u9519\u7684\uff0c\u6240\u4ee5\u5c31\u60f3\u628a\u817e\u8baf\u4e91\u4e0a\u9762\u7684\u673a\u5668\u4e5f\u4ea4\u7ed9 kubernetes \u7ba1\u7406\u3002\u627e\u5230\u5bb9\u5668\u670d\u52a1\uff0c\u65b0\u5efa\u96c6\u7fa4\uff0c\u9009\u62e9\u6a21\u677f\u91cc\u7684\u6807\u51c6\u6258\u7ba1\u96c6\u7fa4\u5c31\u53ef\u4ee5\u4e86\u3002\u7136\u540e\u5f00\u542f\u4e0b\u9762\u7684\u516c\u7f51\u8bbf\u95ee\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u6bd4\u8f83\u5c0f\u7684 IP \u5730\u5740\u6bb5\uff0c\u6309\u7167\u9875\u9762\u4e0b\u9762\u7684\u8981\u6c42\u5408\u5e76\u4e00\u4e0b kube config\uff08\u56e0\u4e3a\u8fd8\u6709\u522b\u7684 k8s cluster\uff09\uff1a</p> <pre><code>$ KUBECONFIG=~/.kube/config:/path/to/new/config kubectl config view --merge --flatten &gt; new_config\n$ cp new_config ~/.kube/config\n</code></pre> <p>\u8986\u76d6\u4e4b\u524d\u5148\u786e\u8ba4\u539f\u6765\u7684\u914d\u7f6e\u8fd8\u5728\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7528 kubectl \u5207\u6362\u5230\u65b0\u7684 context\uff1a</p> <pre><code>$ kubectl config get-contexts\n$ kubectl config use-context new-context-here\n$ kubectl get node\nNAME          STATUS   ROLES    AGE   VERSION\n172.21.0.17   Ready    &lt;none&gt;   75m   v1.16.3-tke.3\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684 k8s node \u5df2\u7ecf\u4e0a\u7ebf\u4e86\u3002\u6211\u4e00\u822c\u4e60\u60ef\u5148\u914d\u597d kubernetes-dashboard\uff1a</p> <pre><code>$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.6/install/kubernetes/quick-install.yaml\n$ kubectl proxy &amp;\n$ kubectl -n kubernetes-dashboard describe secret (kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print \\$1}') | tail -n1 | awk '{print \\$2}' | pbcopy\n</code></pre> <p>\u7136\u540e\u5728\u6d4f\u89c8\u5668\u91cc\u8bbf\u95ee http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/overview?namespace=default \u7136\u540e\u628a\u526a\u8d34\u677f\u91cc\u7684 token \u7c98\u8d34\u8fdb\u53bb\u5373\u53ef\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b kubernetes-dashboard \u7684\u6743\u9650\u6bd4\u8f83\u5c11\uff0c\u53ef\u4ee5\u8ba9\u5b83\u83b7\u5f97\u66f4\u591a\u6743\u9650\uff1a</p> <pre><code>$ kubectl edit clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard\n# use '*' for ultimate \n# use `kubectl get clusterrole.rbac.authorization.k8s.io/cluster-admin -o yaml` to see full permissions\n</code></pre> <p>\u63a5\u4e0b\u6765\u914d\u7f6e metrics-server\u3002\u4e0b\u8f7d metrics-server \u4ed3\u5e93\uff0c\u7136\u540e\u4fee\u6539\u955c\u50cf\u5730\u5740\uff1a</p> <pre><code>$ wget https://github.com/kubernetes-sigs/metrics-server/archive/v0.3.6.zip\n$ unar v0.3.6.zip\n$ cd metrics-server-0.3.6/deploy/1.8+\n$ vim metrics-server-deployment\n# change: k8s.gcr.io/metrics-server-amd64:v0.3.6\n# to: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\n# add line below image: args: [\"--kubelet-insecure-tls\"]\n$ kubectl apply -f .\n</code></pre> <p>\u7b49\u4e00\u6bb5\u65f6\u95f4\uff0c\u5c31\u53ef\u4ee5\u770b\u5230 metrics server \u6b63\u5e38\u8fd0\u884c\u4e86\u3002</p> <p>\u53c2\u8003\uff1ahttps://tencentcloudcontainerteam.github.io/tke-handbook/</p>","tags":["k8s","kubernetes","tencentcloud","dashboard"]},{"location":"devops/2021/03/12/switch-config/","title":"\u5e38\u7528\u4ea4\u6362\u673a\u547d\u4ee4","text":"","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u63a5\u89e6\u4e86 Cisco\uff0cDELL\uff0cHuawei\uff0cH3C\uff0cRuijie \u7684\u7f51\u7edc\u8bbe\u5907\uff0c\u53d1\u73b0\u914d\u7f6e\u65b9\u5f0f\u5404\u6709\u4e0d\u540c\uff0c\u6545\u8bb0\u5f55\u4e00\u4e0b\u5404\u4e2a\u5382\u5bb6\u7684\u547d\u4ee4\u3002</p>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#huawei","title":"Huawei","text":"<p>\u6d4b\u8bd5\u578b\u53f7\uff1aS5320</p>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u4fdd\u5b58\u914d\u7f6e","title":"\u4fdd\u5b58\u914d\u7f6e","text":"<pre><code>&lt;HUAWEI&gt;save\nThe current configuration will be written to flash:/vrpcfg.zip.\nAre you sure to continue?[Y/N]y\nNow saving the current configuration to the slot 0....\nSave the configuration successfully.\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f","title":"\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f","text":"<pre><code>&lt;HUAWEI&gt; system-view\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u5f53\u524d\u914d\u7f6e","title":"\u67e5\u770b\u5f53\u524d\u914d\u7f6e","text":"<pre><code>[HUAWEI] display current-configuration\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-lldp-\u90bb\u5c45","title":"\u67e5\u770b LLDP \u90bb\u5c45","text":"<pre><code>[HUAWEI]display lldp neighbor brief\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-cdp-\u90bb\u5c45","title":"\u67e5\u770b CDP \u90bb\u5c45","text":"<pre><code>[HUAWEI]display cdp neighbor brief\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-lldp","title":"\u542f\u7528 LLDP","text":"<pre><code>[HUAWEI]lldp enable\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-cdp","title":"\u542f\u7528 CDP","text":"<pre><code>[HUAWEI-XGigabitEthernet0/0/1]lldp compliance cdp txrx\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528\u53ea\u8bfb-snmpv1-community","title":"\u542f\u7528\u53ea\u8bfb SNMPv1 community","text":"<pre><code>[HUAWEI]snmp-agent sys-info version all\nWarning: This command may cause confliction in netconf status. Continue? [Y/N]:y\nWarning: SNMPv1/SNMPv2c is not secure, and it is recommended to use SNMPv3.\n[HUAWEI]snmp-agent community read [COMMUNITY NAME]\nWarning: This command may cause confliction in netconf status. Continue? [Y/N]:y\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-snmp-iso-view","title":"\u542f\u7528 SNMP iso view","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b SNMP \u4f1a\u7f3a\u5c11\u4e00\u4e9b\u6807\u51c6\u7684 MIB\uff08\u6bd4\u5982 LLDP\uff09\uff0c\u53ef\u4ee5\u6253\u5f00 iso view\uff1a</p> <pre><code>[HUAWEI]snmp-agent mib-view included iso-view iso\nWarning: This command may cause confliction in netconf status. Continue? [Y/N]:y\n[HUAWEI]snmp-agent community read [COMMUNITY NAME] mib-view iso-view\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-arp-\u8868","title":"\u67e5\u770b ARP \u8868","text":"<pre><code>[HUAWEI]display arp\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#arping","title":"ARPING","text":"<pre><code>[HUAWEI]arp send-packet X.X.X.X ffff-ffff-ffff interface Vlanif VLAN\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-stp-\u534f\u8bae","title":"\u542f\u7528 STP \u534f\u8bae","text":"<pre><code>[HUAWEI]stp enable\n[HUAWEI]stp mode vbst\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-ntp-\u670d\u52a1\u5668","title":"\u8bbe\u7f6e NTP \u670d\u52a1\u5668","text":"<pre><code>[HUAWEI]ntp-service unicast-server x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e\u8fdc\u7a0b-syslog-\u670d\u52a1\u5668","title":"\u8bbe\u7f6e\u8fdc\u7a0b syslog \u670d\u52a1\u5668","text":"<pre><code>[HUAWEI]info-center loghost x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-lacp-\u94fe\u8def\u805a\u5408","title":"\u8bbe\u7f6e LACP \u94fe\u8def\u805a\u5408","text":"<pre><code>[HUAWEI-XGigabitEthernet0/0/1]eth-trunk 1\n[HUAWEI-XGigabitEthernet0/0/2]eth-trunk 1\n[HUAWEI]interface Eth-Trunk 1\n[HUAWEI-Eth-Trunk1]mode lacp\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#dell","title":"DELL","text":"<p>\u6d4b\u8bd5\u578b\u53f7\uff1aN3048</p>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u4fdd\u5b58\u914d\u7f6e_1","title":"\u4fdd\u5b58\u914d\u7f6e","text":"<pre><code>console#copy running-config startup-config\n\nThis operation may take few minutes.\nManagement interfaces will not be available during this time.\n\nAre you sure you want to save? (y/n) y\n\nConfiguration Saved!\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f_1","title":"\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f","text":"<pre><code>console&gt;enable\nconsole# configure\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u5f53\u524d\u914d\u7f6e_1","title":"\u67e5\u770b\u5f53\u524d\u914d\u7f6e","text":"<pre><code>console# show running-config\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-lldp-\u90bb\u5c45_1","title":"\u67e5\u770b LLDP \u90bb\u5c45","text":"<pre><code>console#show lldp remote-device all\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#vlan-trunk-\u914d\u7f6e","title":"VLAN Trunk \u914d\u7f6e","text":"<pre><code>console(config)#interface Gi1/0/1\nconsole(config-if-Gi1/0/1)#switchport mode trunk\nconsole(config-if-Gi1/0/1)#switchport trunk allowed vlan xxx,xxx-xxx\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#vlan-access-\u914d\u7f6e","title":"VLAN Access \u914d\u7f6e","text":"<pre><code>console(config)#interface Gi1/0/1\nconsole(config-if-Gi1/0/1)#switchport mode access\nconsole(config-if-Gi1/0/1)#switchport access vlan xxx\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-vlan-\u914d\u7f6e","title":"\u67e5\u770b VLAN \u914d\u7f6e","text":"<pre><code>console#show vlan\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u6279\u91cf\u914d\u7f6e-interface","title":"\u6279\u91cf\u914d\u7f6e interface","text":"<pre><code>console(config)#interface range Gi1/0/1-4\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-ssh-\u670d\u52a1\u5668","title":"\u542f\u7528 SSH \u670d\u52a1\u5668","text":"<pre><code>console(config)#crypto key generate rsa\nconsole(config)#crypto key generate dsa\nconsole(config)#ip ssh server\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528-cdpdell-\u79f0\u4e4b\u4e3a-isdp","title":"\u542f\u7528 CDP(DELL \u79f0\u4e4b\u4e3a ISDP)","text":"<pre><code>console(config)#isdp enable\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u542f\u7528\u53ea\u8bfb-snmpv1-community_1","title":"\u542f\u7528\u53ea\u8bfb SNMPv1 community","text":"<pre><code>console(config)#snmp-server community [COMMUNITY NAME] ro\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-ntp-\u670d\u52a1\u5668_1","title":"\u8bbe\u7f6e NTP \u670d\u52a1\u5668","text":"<pre><code>console(config)#sntp unicast client enable\nconsole(config)#sntp server x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-ntp-\u670d\u52a1\u5668_2","title":"\u8bbe\u7f6e NTP \u670d\u52a1\u5668","text":"<pre><code>console(config)#sntp unicast client enable\nconsole(config)#sntp server x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-stp-\u534f\u8bae","title":"\u8bbe\u7f6e STP \u534f\u8bae","text":"<pre><code>console(config)#spanning-tree mode rapid-pvst\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#h3c","title":"H3C","text":"","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f_2","title":"\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f","text":"<pre><code>&lt;switch&gt;system-view\nSystem View: return to User View with Ctrl+Z.\n[switch]\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u5f53\u524d\u914d\u7f6e_2","title":"\u67e5\u770b\u5f53\u524d\u914d\u7f6e","text":"<pre><code>[switch]display current-configuration\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-lldp-\u90bb\u5c45_2","title":"\u67e5\u770b lldp \u90bb\u5c45","text":"<pre><code>[switch]display lldp neighbor-information\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u4fdd\u5b58\u914d\u7f6e_2","title":"\u4fdd\u5b58\u914d\u7f6e","text":"<pre><code>[switch]save\nThe current configuration will be written to the device. Are you sure? [Y/N]:y\nPlease input the file name(*.cfg)[flash:/startup.cfg]\n(To leave the existing filename unchanged, press the enter key):y\nThe file name is invalid(does not end with .cfg).\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u6279\u91cf\u914d\u7f6e-interface_1","title":"\u6279\u91cf\u914d\u7f6e interface","text":"<pre><code>[switch]interface range GigabitEthernet 1/0/1 to GigabitEthernet 1/0/24\n[switch-if-range]\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-mac-\u5730\u5740\u8868","title":"\u67e5\u770b MAC \u5730\u5740\u8868","text":"<pre><code>[switch]show mac-address\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u6253\u5f00-lldp-\u548c-cdp","title":"\u6253\u5f00 LLDP \u548c CDP","text":"<pre><code>[switch]lldp global enable\n[switch]lldp compliance cdp\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#mellanox","title":"Mellanox","text":"","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f_3","title":"\u8fdb\u5165\u914d\u7f6e\u6a21\u5f0f","text":"<pre><code>switch &gt; enable\nswitch # configure terminal\nswitch (config) #\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u5f53\u524d\u914d\u7f6e_3","title":"\u67e5\u770b\u5f53\u524d\u914d\u7f6e","text":"<pre><code>switch (config) # show running-config\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-interface-\u72b6\u6001","title":"\u67e5\u770b interface \u72b6\u6001","text":"<pre><code>switch (config) # show interfaces brief\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u4ee5\u592a\u7f51\u7aef\u53e3\u72b6\u6001","title":"\u67e5\u770b\u4ee5\u592a\u7f51\u7aef\u53e3\u72b6\u6001","text":"<pre><code>switch (config) # show interfaces ethernet status\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-lldp-\u90bb\u5c45_3","title":"\u67e5\u770b lldp \u90bb\u5c45","text":"<pre><code>switch (config) # show lldp remote\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u4fdd\u5b58\u914d\u7f6e_3","title":"\u4fdd\u5b58\u914d\u7f6e","text":"<pre><code>switch (config) # configuration write\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u6279\u91cf\u914d\u7f6e-interface_2","title":"\u6279\u91cf\u914d\u7f6e interface","text":"<pre><code>switch (config) # interface ethernet 1/1/1-1/1/4\nswitch (config interface ethernet 1/1/1-1/1/4) #\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b-mac-\u5730\u5740\u8868_1","title":"\u67e5\u770b MAC \u5730\u5740\u8868","text":"<pre><code>switch (config) # show mac-address-table\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u67e5\u770b\u94fe\u8def\u805a\u5408\u72b6\u6001","title":"\u67e5\u770b\u94fe\u8def\u805a\u5408\u72b6\u6001","text":"<pre><code>switch (config) # show interfaces port-channel summary\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u628a\u62c6\u5206\u7684\u56db\u4e2a-sfp-\u53e3\u6062\u590d\u6210\u4e00\u4e2a","title":"\u628a\u62c6\u5206\u7684\u56db\u4e2a SFP \u53e3\u6062\u590d\u6210\u4e00\u4e2a","text":"<pre><code>switch (config interface ethernet 1/1/1) # module-type qsfp \n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u628a\u4e00\u4e2a-qsfp-\u53e3\u62c6\u5206\u6210\u56db\u4e2a","title":"\u628a\u4e00\u4e2a QSFP \u53e3\u62c6\u5206\u6210\u56db\u4e2a","text":"<pre><code>switch (config interface ethernet 1/1) # shutdown\nswitch (config interface ethernet 1/1) # module-type qsfp-split-4\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e\u94fe\u8def\u805a\u5408","title":"\u8bbe\u7f6e\u94fe\u8def\u805a\u5408","text":"<pre><code>switch (config interface ethernet 1/1) # channel-group 1 mode active\nswitch (config interface ethernet 1/2) # channel-group 1 mode active\n</code></pre> <p>\u6a21\u5f0f\u53ef\u4ee5\u9009\u62e9\uff1aactive(LACP)/passive(LACP)/on(Static)</p>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-stp-\u534f\u8bae_1","title":"\u8bbe\u7f6e STP \u534f\u8bae","text":"<pre><code>switch (config) # spanning-tree mode rpvst\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e\u8fdc\u7a0b-syslog-\u670d\u52a1\u5668_1","title":"\u8bbe\u7f6e\u8fdc\u7a0b syslog \u670d\u52a1\u5668","text":"<pre><code>switch (config) # logging x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-ntp-\u670d\u52a1\u5668_3","title":"\u8bbe\u7f6e NTP \u670d\u52a1\u5668","text":"<pre><code>switch (config) # ntp server x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#cisco","title":"Cisco","text":"","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u8bbe\u7f6e-ntp-\u670d\u52a1\u5668_4","title":"\u8bbe\u7f6e NTP \u670d\u52a1\u5668","text":"<pre><code># ntp server x.x.x.x\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u914d\u7f6e-trunk","title":"\u914d\u7f6e Trunk","text":"<pre><code># config terminal\n(config)# interface ethernet 1/1\n(config-if)# switchport mode trunk\n(config-if)# switchport trunk allowed vlan 12-34\n</code></pre>","tags":["switch","router"]},{"location":"devops/2021/03/12/switch-config/#\u914d\u7f6e-access","title":"\u914d\u7f6e Access","text":"<pre><code># config terminal\n(config)# interface ethernet 1/1\n(config-if)# switchport mode access\n(config-if)# switchport access vlan 1234\n</code></pre>","tags":["switch","router"]},{"location":"devops/2020/04/17/tke-nginx-ingress-without-lb/","title":"\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller","text":"","tags":["k8s","kubernetes","tencentcloud","tke","nginx","nginx-ingress"]},{"location":"devops/2020/04/17/tke-nginx-ingress-without-lb/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u60f3\u8981\u5728 k8s \u91cc\u9762 host \u4e00\u4e2a\u7f51\u7ad9\uff0c\u4f46\u53c8\u4e0d\u60f3\u989d\u5916\u82b1\u94b1\u7528 LB\uff0c\u60f3\u76f4\u63a5\u7528\u8282\u70b9\u7684 IP\u3002</p>","tags":["k8s","kubernetes","tencentcloud","tke","nginx","nginx-ingress"]},{"location":"devops/2020/04/17/tke-nginx-ingress-without-lb/#\u65b9\u6cd5","title":"\u65b9\u6cd5","text":"<p>\u9996\u5148\u5b89\u88c5 nginx-ingress\uff1a</p> <pre><code>$ helm repo add nginx-stable https://helm.nginx.com/stable\n$ helm repo update\n$ helm install ingress-controller nginx-stable/nginx-ingress --set controller.service.type=NodePort --set controller.hostNetwork=true\n</code></pre> <p>\u8fd9\u91cc\u7ed9 ingress controller chart \u4f20\u4e86\u4e24\u4e2a\u53c2\u6570\uff1a\u7b2c\u4e00\u4e2a\u6307\u5b9a service \u7c7b\u578b\u662f NodePort\uff0c\u66ff\u4ee3\u9ed8\u8ba4\u7684 LoadBalancer\uff1b\u7b2c\u4e8c\u4e2a\u6307\u5b9a ingress controller \u76f4\u63a5\u5728\u8282\u70b9\u4e0a\u76d1\u542c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528\u8282\u70b9\u7684\u516c\u7f51 IP \u8bbf\u95ee\u4e86\u3002</p> <p>\u7136\u540e\u914d\u4e00\u4e2a ingress\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-example\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\nspec:\n  rules:\n  - host: example.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: example-service\n          servicePort: 80\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u53d1\u73b0\u8bf7\u6c42\u88ab\u6b63\u786e\u8def\u7531\u5230 example-service \u7684 80 \u7aef\u53e3\u4e86\u3002</p>","tags":["k8s","kubernetes","tencentcloud","tke","nginx","nginx-ingress"]},{"location":"devops/2017/12/27/try-gentoo-prefix-on-macOS/","title":"\u5728 macOS \u4e0a\u8bd5\u7528 Gentoo/Prefix","text":"<p>\u524d\u51e0\u5929\u53c2\u52a0\u4e86\u8bb8\u670b\u7a0b\u4e3b\u8bb2\u7684 Tunight\uff0c\u5bf9 Gentoo \u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u4e0d\u8fc7\u770b\u5230\u5982\u6b64\u590d\u6742\u7684\u5b89\u88c5\u8fc7\u7a0b\u548c\u957f\u4e45\u7684\u7f16\u8bd1\u65f6\u95f4\uff0c\u53c8\u770b\u770b\u6211\u7684 CPU\uff0c\u53ea\u80fd\u671b\u800c\u5374\u6b65\u4e86\u3002\u4e0d\u8fc7\uff0c\u6709 Gentoo/Prefix \u8fd9\u4e2a\u5de5\u5177\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5728\u5176\u5b83\u7684\u64cd\u4f5c\u7cfb\u7edf\uff08\u5982 macOS,Solaris \u7b49\uff09\u4e0a\u5728\u4e00\u4e2a $EPREFIX \u4e0b\u8dd1 Portage\uff0c\u4e5f\u5c31\u662f\u628a Portage \u8fd0\u884c\u5728\u522b\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5f53\u4f5c\u4e00\u4e2a\u5305\u7ba1\u7406\u5668\uff0c\u5e76\u4e14\u53ef\u4ee5\u548c\u522b\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e76\u5b58\u3002</p> <p>\u9996\u5148\u8fd8\u662f\u796d\u51fa\u5b98\u7f51\uff1aProject:Prefix\u3002</p> <p>\u9996\u5148\u8bbe\u5b9a\u597d\u73af\u5883\u53d8\u91cf <code>$EPREFIX</code> \uff0c\u4e4b\u540e\u6240\u6709\u7684\u4e1c\u897f\u90fd\u4f1a\u5b89\u88c5\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u628a <code>bootstrap-prefix.sh</code> \u4e0b\u8f7d\u5230 <code>$EPREFIX</code> \uff0c\u7136\u540e <code>./bootstrap-prefix.sh</code> \uff0c\u4f1a\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u95ee\u9898\uff0c\u4e00\u4e00\u56de\u7b54\u5373\u53ef\u3002\u5efa\u8bae\u5728\u8fd0\u884c\u524d\u8bbe\u7f6e\u597d <code>GENTOO_MIRRORS=http://mirrors.tuna.tsinghua.edu.cn/gentoo</code> \u7531\u4e8e TUNA \u6ca1\u6709\u5bf9 gentoo_prefix \u505a\u955c\u50cf\uff0c\u53ea\u80fd\u628a distfiles \u5207\u6362\u5230 TUNA \u7684\u955c\u50cf\u4e0a\u3002</p> <p>\u7136\u540e\u3002\u3002\u3002</p> <p>stage1...</p> <p>stage2..</p> <p>stage3.</p> <p><code>emerge -e @world</code> BOOM</p> <p>\u7ecf\u8fc7 n \u6b21\u8dd1\u6302\u4ee5\u540e\uff0c\u7ec8\u4e8e\u641e\u5b8c\u4e86 stage3\uff0c\u7136\u540e <code>SHELL=bash ./bootstrap-prefix.sh $EPREFIX startscript</code> \u751f\u6210 <code>startprefix</code> \uff0c\u5728\u5916\u9762\u7684 SHELL \u4e2d\u5411\u5207\u8fdb\u6765\u7684\u65f6\u5019\u8fd0\u884c\u8fd9\u4e2a\u5373\u53ef\u3002</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528Gentoo/Prefix\u4e86\u3002\u6ce8\u610f\uff01\u6b64\u65f6\u7684 <code>$PATH</code> \u4ec5\u9650\u4e8e <code>$EPREFIX</code> \u4e0b\u51e0\u4e2a\u76ee\u5f55\u548c <code>/usr/bin</code> <code>/bin</code> \u6240\u4ee5\u5f88\u591a\u4e1c\u897f\u90fd\u4f1a\u51fa\u95ee\u9898\uff08Emacs, Vim, Fish etc\uff09\u3002\u5c0f\u5fc3\u4e0d\u8981\u628a\u81ea\u5df1\u7684\u76ee\u5f55\u4ec0\u4e48\u7684\u641e\u6302\u4e86\u3002</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u5047\u88c5\u8bd5\u7528 Gentoo \u4e86\uff01</p> <p>\u54c8\u54c8\u54c8\u54c8\u54c8\u54c8\u54c8</p> <p>\u6b7b\u4e8e\u7f16\u8bd1 libgcrypt \u548c llvm\u3002</p>","tags":["gentoo","gentoo-prefix","macos","package-manager"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/","title":"\u8bb0\u5f55\u4e00\u6b21 CentOS AArch64 7 \u5230 8 \u7684\u5347\u7ea7","text":"","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6709\u4e00\u53f0 AArch64 \u673a\u5668\u5b89\u88c5\u4e86 CentOS 7\uff0c\u60f3\u8981\u5347\u7ea7\u5230 CentOS 8\uff0c\u8fd9\u7bc7\u535a\u5ba2\u4e3b\u8981\u8bb2\u8bb2\u6298\u817e\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u800c\u4e0d\u662f\u6559\u7a0b\uff1a\u5982\u679c\u771f\u8981\u8bf4\uff0c\u5c31\u662f\u4e0d\u8981\u5347\u7ea7 CentOS \u5927\u7248\u672c\uff0c\u76f4\u63a5\u91cd\u88c5\u5427\u3002\u5982\u679c\u771f\u7684\u60f3\u6298\u817e\uff0c\u53ef\u4ee5\u770b\u770b\u4e0b\u9762\u7684\u5185\u5bb9\u3002</p>","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#\u914d\u7f6e-yum-repo","title":"\u914d\u7f6e yum repo","text":"<p>\u4e4b\u524d\u5347\u7ea7\u8fc7\u5f88\u591a Debian/Ubuntu\uff0c\u64cd\u4f5c\u90fd\u5f88\u7b80\u5355\uff0c\u66ff\u6362 <code>/etc/apt/sources.list</code> \u7684\u7248\u672c\u4ee3\u53f7\uff0c\u7136\u540e\u4e00\u8def <code>apt</code> \u5c31\u53ef\u4ee5\u4e86\uff0c\u9047\u5230\u7684\u90fd\u662f\u5c0f\u95ee\u9898\u3002\u4f46\u662f CentOS 7 \u5230 CentOS 8 \u6709\u4e00\u4e9b\u4e0d\u540c\uff1a</p> <ol> <li>repos \u8def\u5f84\u53d8\u4e86\uff0c\u4e0d\u80fd\u7b80\u5355\u5730\u66ff\u6362 7 \u4e3a 8</li> <li>CentOS 7 \u7684 aarch64 \u5728 centos-altarch \u91cc\u9762\uff0c\u800c CentOS 8 \u7684 aarch64 \u5e76\u4e0d\u662f\u5355\u72ec\u7684\uff0c\u4f46\u53c8\u56e0\u4e3a CentOS 8 EOL \u4e86\uff0c\u6240\u4ee5\u5728 centos-vault \u91cc\u9762</li> </ol> <p>\u56e0\u6b64\u9700\u8981\u9996\u5148\u5b89\u88c5 centos 8 \u7684 repos \u5305\uff0c\u518d\u6309\u7167 TUNA \u955c\u50cf\u7684\u6587\u6863\u53bb\u914d\u7f6e\u3002</p> <p>\u4f46\u8fd9\u91cc\u53c8\u6709\u4e2a\u5751\uff1aCentOS 8 \u7528 dnf \u66ff\u4ee3\u4e86 yum\uff0cyum \u662f dnf \u7684 alias\u3002\u800c CentOS 7 \u9ed8\u8ba4\u53ea\u6709 yum\uff0c\u5982\u679c\u76f4\u63a5\u7528 yum \u914d\u5408 CentOS 8 \u7684 repo\uff0c\u4f1a\u51fa\u73b0\u9519\u8bef\uff1a<code>Invalid version flag If</code>\u3002\u6240\u4ee5\u8981\u5148\u5b89\u88c5\u4e00\u4e2a dnf\uff0c\u518d\u5347\u7ea7 yum repo\u3002</p> <p>\u6309\u7167 repos \u5305\u7684\u65f6\u5019\uff0c\u5728 TUNA \u955c\u50cf https://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/BaseOS/aarch64/os/Packages/ \u91cc\u627e\u8fd9\u4e48\u51e0\u4e2a\u5305\uff1a</p> <ol> <li>centos-linux-release</li> <li>centos-linux-repos</li> <li>centos-gpg-keys</li> </ol> <p>\u7136\u540e\u7528 <code>rpm</code> \u5b89\u88c5\u3002\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u6309\u7167 TUNA \u955c\u50cf\u6587\u6863\u73af\u6e90\u3002</p> <p>\u8fd9\u91cc\u4ecb\u7ecd\u51e0\u4e2a\u5e38\u7528\u7684 rpm \u547d\u4ee4\uff0c\u56e0\u4e3a\u540e\u9762\u4f1a\u7ecf\u5e38\u7528\uff1a</p> <ol> <li><code>rpm -qa</code>\uff1a\u5217\u51fa\u6240\u6709\u5df2\u7ecf\u5b89\u88c5\u7684 rpm</li> <li><code>rpm -i xxx.rpm yyy.rpm</code>\uff1a\u5b89\u88c5\u65b0\u7684 rpm\uff0c\u4f46\u4e0d\u4f1a\u5378\u8f7d\u540c\u540d\u7684\u65e7 rpm</li> <li><code>rpm -e xxx</code>\uff1a\u5378\u8f7d\u67d0\u4e2a\u5305</li> <li><code>rpm -U xxx.rpm</code>\uff1a\u5b89\u88c5\u65b0\u7684 rpm\uff0c\u540c\u65f6\u5378\u8f7d\u65e7 rpm</li> </ol> <p>\u6b64\u5916\u5b89\u88c5\u548c\u5378\u8f7d\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u8981\u7528\u4e0b\u9762\u7684\u53c2\u6570\uff1a</p> <ol> <li><code>--nodeps</code>\uff1a\u5ffd\u7565\u4e0d\u7b26\u5408\u7684\u4f9d\u8d56\uff0c\u6ce8\u610f\u8fd9\u5f88\u5371\u9669\uff0c\u4f46\u662f\u4e5f\u5f88\u5fc5\u8981</li> <li><code>--force</code>\uff1a\u8986\u76d6\u5df2\u6709\u7684\u6587\u4ef6\uff0c\u8fd9\u662f\u56e0\u4e3a\u5f88\u591a CentOS 7 \u7684\u5305\u5728 CentOS 8 \u6539\u4e86\u540d\u5b57\uff0c\u6240\u4ee5\u5373\u4f7f <code>rpm -U</code> \u4e5f\u4f1a\u51fa\u51b2\u7a81\uff0c\u6b64\u65f6\u53ef\u4ee5\u8986\u76d6</li> </ol> <p>\u91cd\u8981\uff1a\u5907\u597d\u4e00\u4efd\u9759\u6001\u7684 busybox\uff0c\u591a\u5f00\u4e00\u4e2a ssh session \u5e76\u4e14\u5728 root \u7528\u6237\u4e0b\u3002\u8fd9\u53ef\u4ee5\u4fdd\u8bc1\u51fa\u4e8b\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7528 busybox \u62a2\u6551\u4e00\u4e0b\u3002busybox \u81ea\u5e26\u4e86 wget \u548c rpm \u5b9e\u73b0\uff0c\u975e\u5e38\u91cd\u8981\uff01</p> <p>\u6b64\u65f6\u867d\u7136\u53ef\u4ee5\u8dd1 <code>dnf</code>\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u9762\u63d0\u5230\u7684 <code>Invalid version flag If</code> \u7684\u95ee\u9898\uff0c\u4f46\u662f <code>dnf</code> \u5bf9\u5347\u7ea7\u4e5f\u65e0\u80fd\u4e3a\u529b\uff1a\u5404\u79cd\u4f9d\u8d56\u51b2\u7a81\u3002\u6240\u4ee5\u63a5\u4e0b\u6765\u5c31\u662f\u624b\u52a8 <code>rpm</code> \u7684\u73af\u8282</p>","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#\u5b89\u88c5-rpm-\u5305","title":"\u5b89\u88c5 rpm \u5305","text":"<p>\u63a5\u4e0b\u6765\u8981\u505a\u7684\u662f\uff0c\u9010\u6e10\u66ff\u6362\u7cfb\u7edf\u4e2d\u7684\u5305\uff0c\u5347\u7ea7\u5230\u65b0\u7cfb\u7edf\u4e2d\u3002\u9996\u5148\u6bd4\u8f83\u9700\u8981\u5347\u7ea7\u7684\u51e0\u4e2a\u4e1c\u897f\uff1a</p> <ol> <li>rpm</li> <li>dnf</li> <li>glibc</li> <li>platform-python</li> <li>bash</li> </ol> <p>\u600e\u4e48\u5347\u7ea7\u5462\uff0c\u8fd8\u662f\u5728 TUNA \u955c\u50cf\u4e0a\u67e5\uff1a</p> <ol> <li>BaseOS: https://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/BaseOS/aarch64/os/Packages/</li> <li>AppStream: https://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/AppStream/aarch64/os/Packages/</li> </ol> <p>\u5927\u90e8\u5206\u5305\u90fd\u4f1a\u5728\u8fd9\u4e24\u4e2a\u8def\u5f84\u91cc\uff0c\u4e0b\u8f7d\u4e0b\u6765\u7136\u540e <code>rpm -U</code>\uff0c\u53d1\u73b0\u51b2\u7a81\uff0c\u5c31\u9012\u5f52\u5730\u4e0b\u8f7d\u5b83\u4f9d\u8d56\u7684\u5176\u4ed6\u5305\u3002\u8fd9\u91cc\u8981\u5bf9\u5e38\u89c1\u7684\u52a8\u6001\u5e93\u654f\u611f\uff0c\u5927\u90e8\u5206\u5305\u7684\u540d\u5b57\u548c\u52a8\u6001\u5e93\u7684\u540d\u5b57\u662f\u5339\u914d\u7684\uff0c\u4f46\u662f\u4e5f\u6709\u4f8b\u5916\uff0c\u6bd4\u5982 libssl\uff0clibcrypto \u5bf9\u5e94 openssl\uff0cliblzma \u5bf9\u5e94 xz \u7b49\u7b49\u3002\u4e0d\u77e5\u9053\u53eb\u4ec0\u4e48\u5c31\u5728\u7f51\u4e0a\u641c\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6f2b\u957f\u800c\u67af\u71e5\u7684\uff0c\u9700\u8981\u4e0d\u65ad\u5c1d\u8bd5\uff0c\u76f4\u5230\u67d0\u4e00\u523b\uff0c\u65b0\u7684 <code>dnf</code> \u53ef\u4ee5\u5b89\u88c5\uff0c<code>dnf update</code> \u53ef\u4ee5\u5de5\u4f5c\uff0c\u8ba9\u5b83\u63a5\u7ba1\u5269\u4e0b\u7684\u5927\u90e8\u5206\u5de5\u4f5c\u3002\u6211\u5217\u4e86\u4e00\u4e0b\uff0c\u6700\u540e\u7528 wget \u624b\u52a8\u4e0b\u8f7d\u7684 rpm \u6709 92 \u4e2a\u3002\u5982\u679c\u4f60\u6bd4\u8f83\u5e78\u8fd0\uff0c\u53ef\u80fd\u4e0d\u9700\u8981\u8fd9\u4e48\u591a\u3002</p>","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#rescue","title":"rescue","text":"<p>\u5f53\u7136\u4e86\uff0c\u5b9e\u9645\u8fc7\u7a0b\u5e76\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355\uff0c\u56e0\u4e3a\u5728\u5347\u7ea7 systemd \u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u5361\u4f4f\u4e86\uff0c\u8fd8\u597d\u6709 BMC\uff0c\u4f46\u662f\u5728 BMC \u4e0a\u91cd\u542f\u4ee5\u540e\uff0c\u8fdb\u5165\u5230 switching root \u9636\u6bb5\u7684\u65f6\u5019\u4e5f\u5361\u4f4f\u4e86\uff0c\u770b\u4e0d\u5230\u8f93\u51fa\u3002</p> <p>\u8fd9\u65f6\u5019\u53ea\u597d\u7528 LiveCD \u5927\u6cd5\u4e86\u3002\u8fd8\u597d\u7f51\u7edc\u91cc\u914d\u7f6e\u4e86 PXE\uff0c\u8fd9\u91cc\u63a8\u8350\u4e00\u4e2a iPXE \u914d\u7f6e\uff1ahttps://github.com/shankerwangmiao/tuna-ipxe\uff0c\u53ef\u4ee5\u7528\u5b83\u65b9\u4fbf\u5730\u542f\u52a8 Ubuntu/Debian/Arch Linux\u3002\u6211\u5c31\u76f4\u63a5\u8d77\u4e86\u4e00\u4e2a Debian Installer\uff0c\u7136\u540e\u5207\u6362\u5230\u65b0\u7684 TTY\uff0c\u5c31\u53ef\u4ee5\u62ff\u5230 Shell \u4e86\u3002\u7136\u540e\u5c31\u662f\u719f\u6089\u7684 mount\uff0c\u624b\u52a8 arch-chroot\uff0c\u7136\u540e\u91cd\u590d\u4e4b\u524d\u7684 rpm \u5b89\u88c5\u7684\u8fc7\u7a0b\u3002\u7531\u4e8e\u5728 BMC \u7684 Remote Console \u91cc\u8f93\u5165\u6bd4\u8f83\u9ebb\u70e6\uff0c\u53ef\u4ee5\u5f00\u4e00\u4e2a\u4e34\u65f6\u7684 sshd\uff0c\u7136\u540e ssh \u4e0a\u53bb\u3002\u91cd\u542f\u524d\uff0c\u68c0\u67e5 grub \u662f\u5426\u5b89\u88c5\u597d\uff0cUEFI \u542f\u52a8\u9879\u662f\u5426\u6b63\u786e\uff0c\u90fd\u6ca1\u95ee\u9898\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u91cd\u542f\u8fdb\u5165 CentOS 8 \u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u66ff\u6362\u4e00\u4e9b\u91cd\u8981\u7684\u5e93\u7684\u65f6\u5019\uff0c\u4e5f\u53d1\u751f\u4e86\u95ee\u9898\uff0c\u6bd4\u5982 rpm \u627e\u4e0d\u5230\u52a8\u6001\u5e93\uff0c\u8fd9\u65f6\u5019\u8981\u4e48\u7528 busybox \u7684 rpm\uff0c\u8981\u4e48\u5c31\u5728\u522b\u7684\u673a\u5668\u624b\u52a8\u89e3\u538b CentOS 7 \u7684 rpm\uff0c\u628a\u91cc\u9762\u7684\u52a8\u6001\u5e93 scp \u4e0a\u53bb\uff08\u6240\u4ee5\u8981\u4fdd\u8bc1 openssh server \u8fd8\u5728\uff09\uff0c\u590d\u5236\u5230\u5bf9\u5e94\u76ee\u5f55\u4e0b\u3002</p>","tags":["centos","aarch64"]},{"location":"devops/2023/07/31/upgrade-centos-aarch64-7-to-8/#stream","title":"stream","text":"<p>\u5347\u7ea7\u5230 CentOS 8 \u4ee5\u540e\uff0c\u7528 <code>rpm -qa</code> \u4f1a\u53d1\u73b0\u8fd8\u6709\u5f88\u591a\u5305\u9057\u7559\u5728 el7\uff0c\u8fd9\u662f\u56e0\u4e3a\u7248\u672c\u53f7\u4e0a\uff0c\u53ef\u80fd el7 \u6bd4 el8 \u8fd8\u8981\u9ad8\u3002\u6240\u4ee5\u6211\u5e72\u8106\u628a\u7cfb\u7edf\u5347\u7ea7\u5230\u4e86 CentOS 8 Stream \u4e0a\uff0c\u8fd9\u6b21\u4e0d\u7528\u8fd9\u4e48\u6298\u817e\uff0c\u76f4\u63a5\u6362 CentOS 8 Stream \u7684\u6e90\uff08<code>centos-stream-repos</code> \u548c <code>centos-stream-release</code>\uff09\uff0c\u7136\u540e <code>dnf update</code> \u5373\u53ef\u3002\u5269\u4e0b\u7684\u5c11\u91cf el7 \u5305\u624b\u52a8\u5347\u964d\u7ea7\u5373\u53ef\u3002</p>","tags":["centos","aarch64"]},{"location":"devops/2020/03/09/use-jailkit-for-scp-only-user/","title":"\u7528 jailkit \u9650\u5236\u7528\u6237\u4ec5 scp","text":"<p>\u6700\u8fd1\u9700\u8981\u7528 scp \u90e8\u7f72\u5230\u751f\u4ea7\u673a\u5668\uff0c\u4f46\u53c8\u4e0d\u60f3\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u6240\u4ee5\u7528\u4e86 jailkit \u7684\u65b9\u6cd5\u3002\u9996\u5148\u662f\u521b\u5efa\u5355\u72ec\u7684\u7528\u6237\uff0c\u7136\u540e\u751f\u6210 ssh key \u6765\u8ba4\u8bc1\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\u6b64\u65f6\u662f\u53ef\u4ee5 scp \u4e86\uff0c\u4f46\u7528\u6237\u4f9d\u7136\u53ef\u4ee5\u83b7\u5f97 shell\uff0c\u4e0d\u591f\u5b89\u5168\u3002</p> <p>\u7136\u540e\u627e\u5230\u4e86\u4e0b\u9762\u53c2\u8003\u94fe\u63a5\uff0c\u5927\u6982\u6458\u5f55\u4e00\u4e0b\u6240\u9700\u8981\u7684\u547d\u4ee4\u548c\u914d\u7f6e\uff1a</p> <pre><code>mkdir /path/to/jail\nchown root:root /path/to/jail\nchmod 701 /path/to/jail\njk_init -j /path/to/jail scp sftp jk_lsh\njk_jailuser -m -j /path/to/jail jailed_user\nvim /path/to/jail/etc/jailkit/jk_lsh.ini\n# Add following lines\n[jailed_user]\npaths = /usr/bin, /usr/lib\nexectuables = /usr/bin/scp\n</code></pre> <p>\u4e4b\u540e\u53ef\u4ee5\u53d1\u73b0\u8be5\u7528\u6237\u7684 shell \u5df2\u7ecf\u66f4\u6539 jk_chrootsh\uff0c\u5e76\u4e14\u53ea\u80fd\u7528 scp\u3002</p> <p>\u53c2\u8003\uff1ahttps://blog.tinned-software.net/restrict-linux-user-to-scp-to-his-home-directory/</p>","tags":["jailkit","chroot","scp"]},{"location":"devops/2018/07/15/use-mussh-to-upgrade-multiple-machines/","title":"\u7528 MuSSH \u5feb\u901f\u5bf9\u591a\u53f0\u673a\u5668\u8fdb\u884c\u8f6f\u4ef6\u5305\u5347\u7ea7","text":"<p>Debian Stretch 9.5 \u521a\u521a\u66f4\u65b0\uff0c\u81ea\u5df1\u624b\u4e0a\u6709\u4e0d\u5c11 stretch \u7684\u673a\u5668\uff0c\u4e8e\u662f\u987a\u624b\u628a\u4ed6\u4eec\u90fd\u5347\u7ea7\u4e86\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u6bd4\u8f83\u7e41\u7410\uff0c\u4e8e\u662f\u6211\u91c7\u7528\u4e86 MuSSH \u7684\u65b9\u6cd5\uff0c\u8ba9\u8fd9\u4e2a\u6548\u7387\u53ef\u4ee5\u63d0\u9ad8\uff0c\u5373\u81ea\u52a8\u540c\u65f6 SSH \u5230\u591a\u53f0\u673a\u5668\u4e0a\u8fdb\u884c\u66f4\u65b0\u3002</p> <p>\u9996\u5148\u7f16\u5199 hostlist \u6587\u4ef6\uff0c\u4e00\u884c\u4e00\u4e2a\u5730\u5740\uff0c\u5206\u522b\u5bf9\u5e94\u6bcf\u53f0\u673a\u5668\u3002</p> <p>\u7136\u540e\u91c7\u7528 MuSSH \u5bf9\u6bcf\u53f0\u673a\u5668\u6267\u884c\u540c\u6837\u7684\u547d\u4ee4</p> <pre><code>$ mussh -H hostlist -c 'apt update &amp;&amp; apt upgrade -y'\n</code></pre> <p>\u6b64\u65f6\u8981\u6c42\uff0cssh \u4e0a\u53bb\u4ee5\u540e\u6709\u76f8\u5e94\u7684\u6743\u9650\u3002\u8fd9\u4e2a\u6709\u8bb8\u591a\u65b9\u6cd5\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u770b\u5230\u4e00\u53f0\u53f0\u673a\u5668\u5347\u7ea7\uff0c\u6253\u4e0a\u5b89\u5168\u8865\u4e01\uff0c\u723d\u554a\u3002</p>","tags":["debian","stretch","mussh"]},{"location":"devops/2022/09/24/vmware-esxi-lacp/","title":"ESXi \u914d\u7f6e LACP \u94fe\u8def\u805a\u5408","text":"","tags":["esxi","vmware","lacp"]},{"location":"devops/2022/09/24/vmware-esxi-lacp/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u7ed9 ESXi \u63a5\u4e86\u4e24\u8def 10Gbps \u7684\u4ee5\u592a\u7f51\uff0c\u9700\u8981\u7528 LACP \u6765\u805a\u5408\u3002ESXi \u81ea\u5df1\u4e0d\u80fd\u914d\u7f6e LACP\uff0c\u9700\u8981\u914d\u5408 vCenter Server \u7684 Distributed Switch \u6765\u914d\u7f6e\u3002</p>","tags":["esxi","vmware","lacp"]},{"location":"devops/2022/09/24/vmware-esxi-lacp/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>\u53c2\u8003\u6587\u6863\uff1aLACP Support on a vSphere Distributed Switch</p> <p>\u7b2c\u4e00\u6b65\u662f\u521b\u5efa\u4e00\u4e2a Distributed Switch\u3002\u627e\u5230 Cluster\uff0c\u70b9\u51fb ACTIONS\uff0c\u5728 Distributed Switch \u91cc\u9762\u9009\u62e9 New Distributed Switch\u3002\u91cc\u9762\u7684\u9009\u9879\u90fd\u53ef\u4ee5\u7528\u9ed8\u8ba4\u7684\uff0c\u6309\u9700\u4fee\u6539\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff0c\u627e\u5230\u521a\u521a\u521b\u5efa\u7684 Distributed Switch\uff0c\u70b9\u51fb Configure\uff0c\u5728 Settings \u4e0b\u70b9\u51fb LACP\uff0c\u70b9\u51fb NEW\uff0c\u9009\u9879\u53ef\u4ee5\u7528\u9ed8\u8ba4\u7684\uff0c\u6309\u9700\u4fee\u6539\u3002</p> <p>\u7b2c\u4e09\u6b65\uff0c\u627e\u5230 Distributed Switch\uff0c\u70b9\u51fb ACTIONS\uff0c\u70b9\u51fb Add and Manage Hosts\uff0c\u627e\u5230\u8981\u914d\u7f6e\u7684\u4e3b\u673a\uff0c\u5728 Manage physical adapters \u8fd9\u4e00\u6b65\uff0c\u627e\u5230\u8981\u52a0\u5165\u5230\u94fe\u8def\u805a\u5408\u7684 vmnic\uff0c\u6bcf\u4e2a\u8981\u805a\u5408\u7684 vmnic \u90fd\u5728\u53f3\u8fb9\u7684 Assign uplink \u5904\u9009\u62e9\u521a\u521a\u521b\u5efa\u7684 LAG \u4e0b\u7684 Uplink\uff0c\u6309\u987a\u5e8f\uff0c\u4e00\u4e00\u5bf9\u5e94\u3002\u5176\u4f59\u9009\u9879\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u7684\u3002\u8fd9\u4e00\u6b65\u914d\u7f6e\u597d\u4ee5\u540e\uff0c\u5728\u4ea4\u6362\u673a\u4e0a\u5e94\u8be5\u5c31\u53ef\u4ee5\u770b\u5230 LACP \u6b63\u5e38\u8fd0\u8f6c\u3002</p> <p>\u7b2c\u56db\u6b65\uff0c\u5982\u679c\u8981\u628a\u865a\u62df\u673a\u8fde\u5230\u94fe\u8def\u805a\u5408\u7684\u7f51\u7edc\u4e0a\uff0c\u627e\u5230\u865a\u62df\u673a\uff0c\u70b9\u51fb ACTIONS\uff0c\u70b9\u51fb Edit Settings\uff0c\u65b0\u5efa\u4e00\u4e2a\u7f51\u5361\uff0cNetwork adapter \u5904\u9009\u62e9\u521a\u521a\u521b\u5efa\u7684 Distributed Port Group\u3002\u8fd9\u4e00\u6b65\u662f\u8ba9\u865a\u62df\u673a\u591a\u4e00\u4e2a\u7f51\u5361\uff0c\u53ef\u4ee5\u8fde\u63a5\u5230 Distributed Switch \u4e0a\u3002\u8fd9\u4e00\u6b65\u914d\u7f6e\u597d\u4ee5\u540e\uff0c\u865a\u62df\u673a\u5c31\u53ef\u4ee5\u6536\u5230\u6765\u81ea\u5176\u4ed6\u7269\u7406\u673a\u7684\u7f51\u7edc\u6d41\u91cf\uff0c\u4f46\u662f\u53d1\u9001\u4e0d\u51fa\u53bb\u3002</p> <p>\u6ce8\uff1aStatic Binding \u548c Ephemeral Binding \u7684\u533a\u522b\u89c1 Static (non-ephemeral) or ephemeral port binding on a vSphere Distributed Switch (1022312)\u3002\u5728 vCenter \u4e0a\u53ef\u4ee5\u7ed9\u865a\u62df\u673a\u5206\u914d\u5230 Static binding \u7684 Distributed Port Group \u4e0a\uff0c\u800c\u5728 ESXi \u4e0a\u53ea\u53ef\u4ee5\u5206\u914d\u5230 Ephemeral Port Group\u3002\u901a\u5e38\u6765\u8bb2\uff0c\u53ea\u9700\u8981 Static binding\uff0c\u800c Ephemeral binding \u662f\u5728\u7d27\u6025\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684\u3002</p> <p>\u7b2c\u4e94\u6b65\uff0c\u5982\u679c\u8981\u628a VMKernel \u8fde\u5230\u94fe\u8def\u805a\u5408\u7684\u7f51\u7edc\u4e0a\uff0c\u627e\u5230\u865a\u62df\u673a\uff0c\u6dfb\u52a0\u4e00\u4e2a VMKernel adapter\uff0c\u7aef\u53e3\u7ec4\u4e3a Distributed Port Group\uff0c\u5982\u9ed8\u8ba4\u521b\u5efa\u7684\u7b2c\u4e00\u4e2a Distributed Port Group\u3002\u7c7b\u4f3c\u5730\uff0c\u6b64\u65f6 VMKernel \u914d\u7f6e\u7684 IP \u5730\u5740\u8fd8\u4e0d\u80fd\u4ece\u5916\u9762\u8bbf\u95ee\uff0c\u4f46\u662f\u53ef\u4ee5\u4ece\u540c\u4e00\u4e2a Distributed Switch \u7684\u865a\u62df\u673a\u4e2d\u8bbf\u95ee\u3002</p> <p>\u7b2c\u516d\u6b65\uff0c\u4fee\u6539 Failover \u914d\u7f6e\uff0c\u627e\u5230 Distributed Switch\uff0c\u70b9\u51fb ACTIONS\uff0c\u5728 Distributed Port Group \u91cc\u70b9\u51fb Manager Distributed Port Groups\uff0c\u52fe\u9009 Teaming and failover\uff0c\u52fe\u4e0a\u6240\u6709\u7684 Distributed Port Group\uff0c\u4fee\u6539\u4e0b\u9762\u7684 Failover Order\uff0c\u9ed8\u8ba4\u72b6\u6001\u662f Active uplinks \u53ea\u6709 Uplink\uff0c\u6ca1\u6709 LAG\uff0c\u9700\u8981\u4fee\u6539\u4e3a Active uplinks \u53ea\u6709 LAG\uff0c\u800c Uplink \u90fd\u5728 Unused Uplinks \u4e2d\u3002\u8fd9\u6837\u624d\u53ef\u4ee5\u8ba9\u865a\u62df\u673a\u548c VMKernel \u51fa\u53bb\u7684\u6d41\u91cf\u8d70\u94fe\u8def\u805a\u5408\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1aLACP Teaming and Failover Configuration for Distributed Port Groups \u548c Configure a Link Aggregation Group to Handle the Traffic for Distributed Port Groups</p> <p>\u8fd9\u6837\u5c31\u914d\u7f6e\u5b8c\u6210\u4e86\u3002</p>","tags":["esxi","vmware","lacp"]},{"location":"devops/2022/09/24/vmware-esxi-lacp/#\u975e-lacp-\u7684\u94fe\u8def\u805a\u5408","title":"\u975e LACP \u7684\u94fe\u8def\u805a\u5408","text":"<p>\u5982\u679c\u60f3\u8981\u94fe\u8def\u805a\u5408\uff0c\u4f46\u662f\u53c8\u4e0d\u60f3\u7528 Virtual Distributed Switch\uff0c\u53ef\u4ee5\u5728\u4ea4\u6362\u673a\u4e0a\u914d\u7f6e Static Link Aggregation\uff0c\u7136\u540e\u5728 ESXi \u4e0a\u6dfb\u52a0\u591a\u4e2a Uplink\uff0c\u914d\u7f6e NIC teaming \u4e3a <code>Route based on IP hash</code> \u6a21\u5f0f\u5373\u53ef\u3002</p> <p>\u53c2\u8003\uff1aNIC teaming in ESXi and ESX</p>","tags":["esxi","vmware","lacp"]},{"location":"devops/2021/10/05/vmware-esxi-notes/","title":"ESXi \u5e38\u7528\u4fe1\u606f","text":"","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u5e38\u7528\u94fe\u63a5","title":"\u5e38\u7528\u94fe\u63a5","text":"<ul> <li>\u68c0\u67e5 CPU microcode \u7248\u672c\uff1a</li> </ul> <pre><code>vsish -e cat /hardware/cpu/cpuList/0 | grep -i -E 'family|model|stepping|microcode|revision'\n</code></pre> <ul> <li>AMD \u6700\u65b0 microcode \u7248\u672c</li> <li>ESXi \u4ece 6.7 \u5230 6.7U1 \u5347\u7ea7\u65f6\u51fa\u73b0\u7248\u672c\u95ee\u9898</li> <li>ESXi 6.7 OEM \u7248\u672c\u4e0b\u8f7d</li> <li>ESXi 7.0 OEM \u7248\u672c\u4e0b\u8f7d</li> <li>ESXi 8.0 OEM \u7248\u672c\u4e0b\u8f7d</li> <li>ESXi 7.0 \u6807\u51c6\u7248\u4e0b\u8f7d</li> <li>ESXi 8.0 \u6807\u51c6\u7248\u4e0b\u8f7d</li> <li>NUC 11 ESXi 7.0 \u7f51\u5361\u652f\u6301\uff1a</li> </ul> <pre><code>$ esxcli software vib install -d $PWD/Net-Community-Driver_1.2.0.0-1vmw.700.1.0.15843807_18028830.zip\n</code></pre>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u79bb\u7ebf\u5347\u7ea7\u65b9\u6cd5","title":"\u79bb\u7ebf\u5347\u7ea7\u65b9\u6cd5","text":"<ol> <li>\u4e0b\u8f7d Offline Bundle \u6587\u4ef6</li> <li>\u4e0a\u4f20\u5230 ESXi datastore \u4e2d</li> <li>\u5728 <code>/vmfs/volumes/</code> \u91cc\u627e\u5230\u66f4\u65b0\u6587\u4ef6</li> <li>\u67e5\u8be2 profile \u5217\u8868 <code>esxcli software sources profile list -d &lt;zip&gt;</code></li> <li>\u66f4\u65b0\u5230 profile <code>esxcli software profile update -p &lt;profile&gt; -d &lt;zip&gt;</code></li> </ol> <p>ref: Upgrade or Update a Host with Image Profiles</p> <p>\u5982\u679c CPU \u6bd4\u8f83\u65e7\uff0c\u53ef\u80fd\u4f1a\u6709\u8b66\u544a\uff1aUpdated Plan for CPU Support Discontinuation In Future Major vSphere Releases\uff0c\u6309\u7167\u4fe1\u606f\u6dfb\u52a0\u53c2\u6570\u5ffd\u7565\u5373\u53ef\uff0cESXi 7.0 \u7cfb\u5217\u90fd\u662f\u652f\u6301\u7684\uff0c\u5982\u679c\u4e4b\u540e\u51fa\u4e86\u65b0\u7684\u7248\u672c\u53ef\u80fd\u4e0d\u652f\u6301\u3002</p>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u5728\u7ebf\u5347\u7ea7\u65b9\u6cd5","title":"\u5728\u7ebf\u5347\u7ea7\u65b9\u6cd5","text":"<pre><code>$ esxcli network firewall ruleset set -e true -r httpClient\n# find profile name\n$ esxcli software sources profile list -d https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\n# upgrade to 7.0u3 for example\n$ esxcli software profile update -p ESXi-7.0U3-18644231-standard -d https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\n</code></pre> <p>ref: Update Standalone ESXi Host</p> <p>\u76ee\u524d OEM \u7248\u672c\u8fd8\u6ca1\u627e\u5230\u5728\u7ebf\u5347\u7ea7\u65b9\u6cd5\uff0c\u9700\u8981\u4e0b\u8f7d zip \u7136\u540e\u6309\u7167\u79bb\u7ebf\u5347\u7ea7\u65b9\u6cd5\u5b89\u88c5\u3002</p>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u9632\u706b\u5899","title":"\u9632\u706b\u5899","text":"<p>\u5217\u51fa\u6240\u6709\u9632\u706b\u5899\u89c4\u5219\uff1a</p> <pre><code>$ esxcli network firewall ruleset list\n</code></pre> <p>\u5141\u8bb8\u51fa\u7ad9 SSH\uff1a</p> <pre><code>$ esxcli network firewall ruleset set --enabled=true --ruleset-id=sshClient\n</code></pre> <p>\u5173\u95ed\u51fa\u7ad9 SSH\uff1a</p> <pre><code>$ esxcli network firewall ruleset set --enabled=false --ruleset-id=sshClient\n</code></pre>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#nuc11i5-esxi-70-\u5b89\u88c5\u8fc7\u7a0b","title":"NUC11i5 ESXi 7.0 \u5b89\u88c5\u8fc7\u7a0b","text":"<ol> <li>\u4e0b\u8f7d ESXi ISO \u6587\u4ef6\uff0c\u7528 UNetbootin \u5236\u4f5c\u5b89\u88c5\u76d8</li> <li>\u63d2\u5165 U \u76d8\uff0c\u5728 NUC \u4e0a\u5b89\u88c5 ESXi\uff0c\u5728 81% \u7684\u65f6\u5019\u5361\u4f4f\u4e86\uff0c\u4e0d\u7ba1\u76f4\u63a5\u91cd\u542f</li> <li>\u7528 root \u65e0\u5bc6\u7801\u767b\u5f55\u8fdb\u53bb\uff0c\u7136\u540e\u91cd\u7f6e\u7f51\u7edc\u8bbe\u7f6e</li> <li>\u914d\u7f6e usb \u7f51\u5361\uff0c\u7136\u540e\u901a\u8fc7\u7f51\u9875\u8bbf\u95ee ESXi\uff0c\u6253\u5f00 SSH</li> <li>\u4e0b\u8f7d Fling \u4e0a\u9762\u7684\u793e\u533a\u7f51\u5361\u652f\u6301\uff0c\u7528 esxcli \u5b89\u88c5</li> <li>\u91cd\u542f\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u770b\u5230 vmnic0 \u7f51\u5361\u4e86</li> </ol> <p>\u53c2\u8003\uff1aSolution: ESXi Installation with USB NIC only fails at 81%</p>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u63a8\u8350\u535a\u5ba2","title":"\u63a8\u8350\u535a\u5ba2","text":"<p>\u53d1\u73b0\u4ee5\u4e0b\u535a\u5ba2\u6709\u5f88\u591a\u5173\u4e8e ESXi \u7684\u5185\u5bb9\uff1a</p> <ul> <li>https://williamlam.com/</li> <li>https://www.virten.net/</li> </ul>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u91cd\u8981\u7248\u672c\u66f4\u65b0","title":"\u91cd\u8981\u7248\u672c\u66f4\u65b0","text":"<p>\u53c2\u8003 ESXi/vCSA Release Notes\uff1a</p> <ul> <li>Performance improvements for AMD Zen CPUs: With ESXi 7.0 Update 2, out-of-the-box optimizations can increase AMD Zen CPU performance by up to 30% in various benchmarks. The updated ESXi scheduler takes full advantage of the AMD NUMA architecture to make the most appropriate placement decisions for virtual machines and containers. AMD Zen CPU optimizations allow a higher number of VMs or container deployments with better performance.</li> <li>Reduced compute and I/O latency, and jitter for latency sensitive workloads: Latency sensitive workloads, such as in financial and telecom applications, can see significant performance benefit from I/O latency and jitter optimizations in ESXi 7.0 Update 2. The optimizations reduce interference and jitter sources to provide a consistent runtime environment. With ESXi 7.0 Update 2, you can also see higher speed in interrupt delivery for passthrough devices.</li> <li>vSphere Lifecycle Manager fast upgrades: Starting with vSphere 7.0 Update 2, you can configure vSphere Lifecycle Manager to suspend virtual machines to memory instead of migrating them, powering them off, or suspending them to disk. For more information, see Configuring vSphere Lifecycle Manager for Fast Upgrades.</li> <li>Zero downtime, zero data loss for mission critical VMs in case of Machine Check Exception (MCE) hardware failure: With vSphere 7.0 Update 3, mission critical VMs protected by VMware vSphere Fault Tolerance can achieve zero downtime, zero data loss in case of Machine Check Exception (MCE) hardware failure, because VMs fallback to the secondary VM, instead of failing. For more information, see How Fault Tolerance Works.</li> </ul>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#vcsa-\u76f8\u5173\u5e38\u89c1\u9519\u8bef","title":"vCSA \u76f8\u5173\u5e38\u89c1\u9519\u8bef","text":"<ul> <li>https://kb.vmware.com/s/article/85468 vCSA \u65e5\u5fd7\u5206\u533a <code>/storage/log</code> \u6ee1\uff0c\u539f\u56e0\u662f\u8bbf\u95ee vmware \u7f51\u7ad9\u5931\u8d25\u6253\u5370\u7684\u65e5\u5fd7\u592a\u5927\uff1a<code>/storage/log/vmware/analytics/analytics-runtime.log*</code>\uff1b\u89e3\u51b3\u65b9\u6cd5\uff1a<code>vmon-cli -r analytics</code> \u91cd\u542f\u670d\u52a1\uff0c\u7136\u540e\u5220\u6389\u65e7\u7684\u65e5\u5fd7\u3002</li> <li>https://kb.vmware.com/s/article/83070 vCSA \u65e5\u5fd7\u5206\u533a <code>/storage/log</code> \u6ee1\uff0c\u539f\u56e0\u662f tomcat \u65e5\u5fd7\u592a\u5927\u3002</li> <li><code>XXX Service Health Alarm</code>\uff1a\u5c1d\u8bd5\u91cd\u542f\u5bf9\u5e94\u670d\u52a1\uff0c\u6bd4\u5982 <code>vmon-cli -r perfcharts</code> \u5bf9\u5e94 <code>Performance Charts</code>\uff0c<code>vmon-cli -r vapi-endpoint</code> \u5bf9\u5e94 <code>VMWare vAPI Endpoint</code></li> </ul> <p>\u67e5\u770b\u66f4\u65b0\u72b6\u6001\uff1a<code>cat /storage/core/software-update/stage_operation</code>\uff1b\u66f4\u65b0\u6587\u4ef6\u4e0b\u8f7d\u8def\u5f84\uff1a<code>/storage/updatemgr/software-update*/stage</code>\u3002\u6709\u4e00\u4e2a\u5305\u7279\u522b\u5927\uff1a<code>wcpovf</code> \u9700\u8981\u4e24\u4e2a\u591a G\u3002</p> <p>CLI \u66f4\u65b0\u65b9\u6cd5\uff1ahttps://earlruby.org/2021/01/upgrading-vcenter-7-via-the-command-line/</p>","tags":["esxi","vmware"]},{"location":"devops/2021/10/05/vmware-esxi-notes/#\u8fc1\u79fb\u865a\u62df\u673a\u5230\u4e0d\u540c-vm","title":"\u8fc1\u79fb\u865a\u62df\u673a\u5230\u4e0d\u540c VM","text":"<p>\u9996\u5148\uff0cunregister \u539f\u6765\u7684 VM\uff0c\u7136\u540e\u628a\u6587\u4ef6\u79fb\u52a8\u5230\u65b0\u7684\u8def\u5f84\u4e0b\u3002\u5bf9\u4e8e Thin Provisioned Disk\uff0c\u9700\u8981\u7279\u6b8a\u5904\u7406\uff0c\u5426\u5219\u76f4\u63a5\u590d\u5236\u7684\u8bdd\uff0c\u4f1a\u53d8\u6210 Thick Provisioned Disk\uff0c\u6b63\u786e\u65b9\u6cd5\u662f\u91c7\u7528 <code>vmkfstool</code>\uff1a</p> <pre><code>vmkfstool -i \"old.vmdk\" -d thin \"new.vmdk\"\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684\u8def\u5f84\u7528\u7684\u662f\u4e0d\u5e26 <code>-flat</code> \u7684 vmdk\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86 metadata\uff0c\u800c <code>-flat.vmdk</code> \u4fdd\u5b58\u4e86\u5b9e\u9645\u7684\u6570\u636e\u3002\u53ef\u4ee5\u7528 <code>du</code> \u547d\u4ee4\u770b\u5b9e\u9645\u7684\u786c\u76d8\u5360\u7528\uff0c\u4ece\u800c\u786e\u8ba4\u5b83\u786e\u5b9e\u662f Thin Provisioned\u3002</p> <p>\u5982\u679c\u5df2\u7ecf\u5728 Web UI \u4e0a\u590d\u5236\u4e86\uff0c\u4f60\u4f1a\u53d1\u73b0\u65e0\u6cd5\u505c\u6b62\u590d\u5236\uff0c\u89e3\u51b3\u529e\u6cd5\u662f\uff1a</p> <pre><code>/etc/init.d/hostd restart\n</code></pre> <p>\u8fd9\u6837\u5c31\u4f1a\u91cd\u542f Web UI\uff0c\u4e0d\u8fc7\u7b49\u5b83\u6062\u590d\u9700\u8981\u5f88\u957f\u7684\u65f6\u95f4\uff0c\u8fd8\u8981\u5220\u6389 cookie\u3002</p>","tags":["esxi","vmware"]},{"location":"devops/2021/04/15/vmware-esxi-perccli/","title":"\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8","text":"","tags":["esxi","vmware","perc","perccli","raid","megaraid","lsi","avago"]},{"location":"devops/2021/04/15/vmware-esxi-perccli/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u6709\u4e00\u53f0\u673a\u5668\u7684\u76d8\u51fa\u73b0\u4e86\u62a5\u8b66\uff0c\u9700\u8981\u6362\u6389\uff0c\u7136\u540e\u91cd\u5efa RAID5 \u9635\u5217\u3002iDRAC \u51fa\u73b0\u62a5\u9519\uff1a</p> <ol> <li>Disk 2 in Backplane 1 of Integrated RAID Controller 1 is not functioning correctly.</li> <li>Virtual Disk 1 on Integrated RAID Controller 1 has become degraded.</li> <li>Error occurred on Disk2 in Backplane 1 of Integrated RAID Controller 1 : (Error 2)</li> </ol>","tags":["esxi","vmware","perc","perccli","raid","megaraid","lsi","avago"]},{"location":"devops/2021/04/15/vmware-esxi-perccli/#\u5b89\u88c5-perccli","title":"\u5b89\u88c5 PERCCli","text":"<p>\u9996\u5148\uff0c\u56e0\u4e3a\u7cfb\u7edf\u662f VMware ESXi 6.7\uff0c\u6240\u4ee5\u5728DELL \u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7684\u6587\u4ef6\u3002\u6309\u7167\u91cc\u9762\u7684 README \u5b89\u88c5 vib\uff1a</p> <pre><code>esxcli software vib install -v /vmware-perccli-007.1420.vib\n</code></pre> <p>\u5982\u679c\u8981\u5347\u7ea7\u7cfb\u7edf\uff0c\u9700\u8981\u5148\u5378\u8f7d vib\uff1a<code>esxcli software vib remove -n vmware-perccli</code>\uff0c\u56e0\u4e3a\u5347\u7ea7\u7684\u65f6\u5019\u4f1a\u53d1\u73b0\u7f3a\u5c11\u65b0\u7248\u7cfb\u7edf\u7684 perccli\uff0c\u5efa\u8bae\u5148\u5378\u8f7d\uff0c\u5347\u7ea7\u540e\u518d\u5b89\u88c5\u65b0\u7684\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u590d\u5236\u4e0a\u53bb Linux \u7248\u672c\u7684 PERCCli\uff0c\u867d\u7136\u4e5f\u53ef\u4ee5\u8fd0\u884c\uff0c\u4f46\u662f\u627e\u4e0d\u5230\u63a7\u5236\u5668\u3002\u5b89\u88c5\u597d\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8fd0\u884c <code>/opt/lsi/perccli/perccli</code> \u3002\u63a5\u7740\uff0c\u8fd0\u884c <code>perccli show all</code>\uff0c\u53ef\u4ee5\u770b\u5230\u7c7b\u4f3c\u4e0b\u9762\u7684\u4fe1\u606f\uff1a</p> <pre><code>$ perccli show all\n--------------------------------------------------------------------------------\nEID:Slt DID State  DG     Size Intf Med SED PI SeSz Model               Sp Type\n--------------------------------------------------------------------------------\n32:2      2 Failed  1 3.637 TB SATA HDD N   N  512B ST4000NM0033-9ZM170 U  -\n32:4      4 UGood   F 3.637 TB SATA HDD N   N  512B ST4000NM0033-9ZM170 U  -\n--------------------------------------------------------------------------------\n</code></pre> <p>\u5176\u4e2d E32S2 \u662f Failed \u7684\u76d8\uff0c\u5c5e\u4e8e Disk Group 1\uff1bE32S4 \u662f\u65b0\u63d2\u5165\u7684\u76d8\uff0c\u51c6\u5907\u66ff\u6362\u6389 E32S2\uff0c\u76ee\u524d\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u7684 Disk Group\u3002\u67e5\u770b\u4e00\u4e0b Disk Group\uff1a<code>perccli /c0/dall show</code></p> <pre><code>$ perccli /c0/dall show\n-----------------------------------------------------------------------------\nDG Arr Row EID:Slot DID Type  State BT       Size PDC  PI SED DS3  FSpace TR\n-----------------------------------------------------------------------------\n 1 -   -   -        -   RAID5 Dgrd   N    7.276 TB dflt N  N   dflt N      N\n 1 0   -   -        -   RAID5 Dgrd   N    7.276 TB dflt N  N   dflt N      N\n 1 0   0   32:1     1   DRIVE Onln   N    3.637 TB dflt N  N   dflt -      N\n 1 0   1   32:2     2   DRIVE Failed N    3.637 TB dflt N  N   dflt -      N\n 1 0   2   32:3     3   DRIVE Onln   N    3.637 TB dflt N  N   dflt -      N\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 DG1 \u5904\u4e8e Degraded \u72b6\u6001\uff0c\u7136\u540e E32S4 \u5904\u4e8e Failed \u72b6\u6001\u3002\u53c2\u8003\u4e86\u4e00\u4e0b PERCCli \u6587\u6863\uff0c\u5b83\u544a\u8bc9\u6211\u4eec\u8981\u8fd9\u4e48\u505a\uff1a</p> <pre><code>perccli /cx[/ex]/sx set offline\nperccli /cx[/ex]/sx set missing\nperccli /cx /dall show\nperccli /cx[/ex]/sx insert dg=a array=b row=c\nperccli /cx[/ex]/sx start rebuild\n</code></pre> <p>\u5177\u4f53\u5230\u6211\u4eec\u8fd9\u4e2a\u60c5\u666f\uff0c\u5c31\u662f\u628a E32S2 \u8bbe\u4e3a offline\uff0c\u7136\u540e\u7528 E32S4 \u6765\u66ff\u6362\u5b83\uff1a</p> <pre><code>perccli /c0/e32/s2 set offline\nperccli /c0/e32/s2 set missing\nperccli /cx /dall show\nperccli /cx/e32/s4 insert dg=1 array=0 row=2\nperccli /cx/e32/s4 start rebuild\n</code></pre> <p>\u5b8c\u6210\u4ee5\u540e\u7684\u72b6\u6001\uff1a</p> <pre><code>TOPOLOGY :\n========\n\n---------------------------------------------------------------------------\nDG Arr Row EID:Slot DID Type  State BT     Size PDC  PI SED DS3  FSpace TR\n---------------------------------------------------------------------------\n 1 -   -   -        -   RAID5 Dgrd  N  7.276 TB dflt N  N   dflt N      N\n 1 0   -   -        -   RAID5 Dgrd  N  7.276 TB dflt N  N   dflt N      N\n 1 0   0   32:1     1   DRIVE Onln  N  3.637 TB dflt N  N   dflt -      N\n 1 0   1   32:4     4   DRIVE Rbld  Y  3.637 TB dflt N  N   dflt -      N\n 1 0   2   32:3     3   DRIVE Onln  N  3.637 TB dflt N  N   dflt -      N\n---------------------------------------------------------------------------\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 E32S4 \u66ff\u6362\u4e86\u539f\u6765 E32S2 \u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14\u5f00\u59cb\u91cd\u5efa\u3002\u67e5\u770b\u91cd\u5efa\u8fdb\u5ea6\uff1a</p> <pre><code>$ perccli /c0/32/s4 show rebuild\n-----------------------------------------------------\nDrive-ID   Progress% Status      Estimated Time Left\n-----------------------------------------------------\n/c0/e32/s4         3 In progress -\n-----------------------------------------------------\n$ perccli show all\nNeed Attention :\n==============\n\nController 0 :\n============\n\n-------------------------------------------------------------------------------\nEID:Slt DID State DG     Size Intf Med SED PI SeSz Model               Sp Type\n-------------------------------------------------------------------------------\n32:4      4 Rbld   1 3.637 TB SATA HDD N   N  512B ST4000NM0033-9ZM170 U  -\n-------------------------------------------------------------------------------\n</code></pre> <p>\u7136\u540e\uff0c\u67e5\u770b\u4e00\u4e0b\u51fa\u9519\u7684\u76d8\uff1a</p> <pre><code>$ perccli /c0/e32/s2 show all\nDrive /c0/e32/s2 State :\n======================\nShield Counter = 0\nMedia Error Count = 0\nOther Error Count = 6\nDrive Temperature =  36C (96.80 F)\nPredictive Failure Count = 0\nS.M.A.R.T alert flagged by drive = No\n</code></pre> <p>\u679c\u7136\u6709\u9519\u8bef\uff0c\u4f46\u662f\u4e5f\u770b\u4e0d\u5230\u66f4\u591a\u4fe1\u606f\u4e86\u3002</p> <p>\u574f\u5757\u7edf\u8ba1\uff1a</p> <pre><code>$ perccli /c0 show badblocks\nDetailed Status :\n===============\n\n-------------------------------------------------------------\nCtrl Status Ctrl_Prop       Value ErrMsg               ErrCd\n-------------------------------------------------------------\n   0 Failed Bad Block Count -     BadBlockCount failed     2\n-------------------------------------------------------------\n</code></pre> <p>\u7ecf\u8fc7\u68c0\u67e5\u4ee5\u540e\uff0c\u53d1\u73b0 E32S2 \u76d8\u7684 SMART \u5e76\u6ca1\u6709\u62a5\u544a\u4ec0\u4e48\u95ee\u9898\uff0c\u6240\u4ee5\u4e5f\u6ca1\u6709\u628a\u76d8\u53d6\u8d70\uff0c\u800c\u662f\u4f5c\u4e3a hot spare \u5f53\u5907\u7528\uff1a</p> <pre><code>$ perccli /c0/e32/s2 add hotsparedrive DG=1\n$ perccli /c0/d1 show\nTOPOLOGY :\n========\n\n---------------------------------------------------------------------------\nDG Arr Row EID:Slot DID Type  State BT     Size PDC  PI SED DS3  FSpace TR\n---------------------------------------------------------------------------\n 1 -   -   -        -   RAID5 Dgrd  N  7.276 TB dflt N  N   dflt N      N\n 1 0   -   -        -   RAID5 Dgrd  N  7.276 TB dflt N  N   dflt N      N\n 1 0   0   32:1     1   DRIVE Onln  N  3.637 TB dflt N  N   dflt -      N\n 1 0   1   32:4     4   DRIVE Rbld  Y  3.637 TB dflt N  N   dflt -      N\n 1 0   2   32:3     3   DRIVE Onln  N  3.637 TB dflt N  N   dflt -      N\n 1 -   -   32:2     2   DRIVE DHS   -  3.637 TB -    -  -   -    -      N\n---------------------------------------------------------------------------\n\nDG=Disk Group Index|Arr=Array Index|Row=Row Index|EID=Enclosure Device ID\nDID=Device ID|Type=Drive Type|Onln=Online|Rbld=Rebuild|Optl=Optimal|Dgrd=Degraded\nPdgd=Partially degraded|Offln=Offline|BT=Background Task Active\nPDC=PD Cache|PI=Protection Info|SED=Self Encrypting Drive|Frgn=Foreign\nDS3=Dimmer Switch 3|dflt=Default|Msng=Missing|FSpace=Free Space Present\nTR=Transport Ready\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u540e\u5907\u76d8\uff0c\u5f53\u522b\u7684\u76d8\u574f\u7684\u65f6\u5019\uff0c\u4f5c\u4e3a\u5907\u7528\u3002</p>","tags":["esxi","vmware","perc","perccli","raid","megaraid","lsi","avago"]},{"location":"devops/2021/04/15/vmware-esxi-perccli/#\u76f8\u5173\u8f6f\u4ef6\u4e0b\u8f7d","title":"\u76f8\u5173\u8f6f\u4ef6\u4e0b\u8f7d","text":"<p>\u53ef\u4ee5\u5728\u8fd9\u91cc\u548c\u8fd9\u91cc\u5bfb\u627e StorCLI \u7248\u672c\u3002</p> <p>StorCLI\uff1a</p> <ul> <li>007.3007.0000.0000 May 16, 2024 007.3007.0000.0000_MR7.30_Storcli.zip</li> <li>007.1613.0000.0000 Oct 29, 2020 007.1613.0000.0000_Unified_StorCLI.zip</li> <li>007.1506.0000.0000 Aug 11, 2020 StorCLI_MR7.15.zip </li> <li>008.0010.0000.0010 Jun 14, 2024 008.0010.0000.0010_MR8.10_Storcli2.zip\uff0c\u6ce8\uff1a\u4e0d\u652f\u6301\u65e7\u578b\u53f7</li> <li>008.0005.0000.0010 Feb 22, 2023 008.0005.0000.0010_StorCLI.zip\uff0c\u6ce8\uff1a\u4e0d\u652f\u6301\u65e7\u578b\u53f7</li> <li>1.15.12 Apr 23, 2015 MR_SAS_StorCLI_6-7-1-15-12-SCGCQ00852539.zip</li> <li>1.15.05 Jan 22, 2015 1-15-05_StorCLI.zip</li> </ul> <p>MegaCLI:</p> <ul> <li>8.07.07 Dec 19, 2012 8-07-07_MegaCLI.zip</li> </ul> <p>PercCLI:</p> <ul> <li>007.1420.0000.0000 Dec 10, 2020 PERCCLI_N65F1_7.1420.00_A10_Linux.tar.gz PERCCLI_5V7XX_7.1420.0_A10_VMware.tar.gz</li> <li>007.1327.0000.0000 July 27, 2020 PERCCLI_D6YWP_7.1327.00_A09_Linux.tar.gz</li> <li>007.0127.0000.0000 July 13, 2017 perccli_7.1-007.0127_linux.tar.gz</li> </ul>","tags":["esxi","vmware","perc","perccli","raid","megaraid","lsi","avago"]},{"location":"hardware/2022/05/16/ace/","title":"\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u51e0\u5929\u5206\u6790\u4e86 TileLink \u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u90e8\u5206\u5185\u5bb9\uff0c\u89c1TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790\uff0c\u8d81\u6b64\u673a\u4f1a\u7814\u7a76\u4e00\u4e0b\u4e4b\u524d\u5c1d\u8bd5\u8fc7\u7814\u7a76\uff0c\u4f46\u662f\u56e0\u4e3a\u7f3a\u5c11\u4e00\u4e9b\u57fa\u7840\u77e5\u8bc6\u800c\u5f03\u5751\u7684 ACE \u534f\u8bae\u5206\u6790\u3002</p> <p>\u4e0b\u9762\u4e3b\u8981\u53c2\u8003\u4e86 IHI0022E \u7684\u7248\u672c\uff0c\u4e5f\u5c31\u662f AXI4 \u5bf9\u5e94\u7684 ACE \u7248\u672c\u3002</p>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#\u56de\u987e","title":"\u56de\u987e","text":"<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\u4e00\u4e2a\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u9700\u8981\u652f\u6301\u54ea\u4e9b\u64cd\u4f5c\u3002\u5bf9\u4e8e\u8f83\u4e0a\u4e00\u7ea7 Cache \u6765\u8bf4\uff0c\u5b83\u9700\u8981\u8fd9\u4e48\u51e0\u4ef6\u4e8b\u60c5\uff1a</p> <ol> <li>\u8bfb\u6216\u5199 miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bf7\u6c42\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\uff0c\u5e76\u4e14\u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u8bfb\u53d6\u5230 Shared\uff0c\u5199\u5165\u5230 Modified \u7b49\u3002</li> <li>\u5199\u5165\u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5347\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u4ece Shared \u5230 Modified\u3002</li> <li>\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a dirty \u6570\u636e\u5199\u56de\uff0c\u5e76\u4e14\u964d\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982 Modified -&gt; Shared/Invalid\u3002\u5982\u679c\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\uff0c\u53ef\u4ee5\u9009\u62e9\u901a\u77e5\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u901a\u77e5\u4e0b\u4e00\u7ea7\u3002</li> <li>\u6536\u5230 snoop \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u9700\u8981\u8fd4\u56de\u5f53\u524d\u7684\u7f13\u5b58\u6570\u636e\uff0c\u5e76\u4e14\u66f4\u65b0\u72b6\u6001\u3002</li> <li>\u9700\u8981\u4e00\u4e2a\u65b9\u6cd5\u6765\u901a\u77e5\u4e0b\u4e00\u7ea7 Cache/Interconnect\uff0c\u544a\u8bc9\u5b83\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4e86\u3002</li> </ol> <p>\u5982\u679c\u4e4b\u524d\u770b\u8fc7\u6211\u7684 TileLink \u5206\u6790\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u8fd9\u4e9b\u64cd\u4f5c\u5bf9\u5e94\u5230 TileLink \u5c31\u662f\uff1a</p> <ol> <li>\u8bfb\u6216\u5199 miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bf7\u6c42\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\uff08\u53d1\u9001 AcquireBlock\uff0c\u7b49\u5f85 GrantData\uff09\uff0c\u5e76\u4e14\u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u8bfb\u53d6\u5230 Shared\uff0c\u5199\u5165\u5230 Modified \u7b49\u3002</li> <li>\u5199\u5165\u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5347\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff08\u53d1\u9001 AcquirePerm\uff0c\u7b49\u5f85 Grant\uff09\uff0c\u6bd4\u5982\u4ece Shared \u5230 Modified\u3002</li> <li>\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a dirty \u6570\u636e\u5199\u56de\uff08\u53d1\u9001 ReleaseData\uff0c\u7b49\u5f85 ReleaseAck\uff09\uff0c\u5e76\u4e14\u964d\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982 Modified -&gt; Shared/Invalid\u3002\u5982\u679c\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\uff0c\u53ef\u4ee5\u9009\u62e9\u901a\u77e5\uff08\u53d1\u9001 Release\uff0c\u7b49\u5f85 ReleaseAck\uff09\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u901a\u77e5\u4e0b\u4e00\u7ea7\u3002</li> <li>\u6536\u5230 snoop \u8bf7\u6c42\u7684\u65f6\u5019\uff08\u6536\u5230 Probe\uff09\uff0c\u9700\u8981\u8fd4\u56de\u5f53\u524d\u7684\u7f13\u5b58\u6570\u636e\uff08\u53d1\u9001 ProbeAck/ProbeAckData\uff09\uff0c\u5e76\u4e14\u66f4\u65b0\u72b6\u6001\u3002</li> <li>\u9700\u8981\u4e00\u4e2a\u65b9\u6cd5\uff08\u53d1\u9001 GrantAck\uff09\u6765\u901a\u77e5\u4e0b\u4e00\u7ea7 Cache/Interconnect\uff0c\u544a\u8bc9\u5b83\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4e86\u3002</li> </ol> <p>\u79c9\u627f\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u518d\u5f80\u4e0b\u770b ACE \u7684\u8bbe\u8ba1\uff0c\u5c31\u4f1a\u89c9\u5f97\u5f88\u81ea\u7136\u4e86\u3002</p>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#cache-state-model","title":"Cache state model","text":"<p>\u9996\u5148\u6765\u770b\u4e00\u4e0b ACE \u7684\u7f13\u5b58\u72b6\u6001\u6a21\u578b\uff0c\u6211\u5728\u4e4b\u524d\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790\u4e2d\u4e5f\u5206\u6790\u8fc7\uff0c\u5b83\u6709\u8fd9\u4e48\u4e94\u79cd\uff0c\u5c31\u662f MOESI \u7684\u4e0d\u540c\u8bf4\u6cd5\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u6587\u6863\u4e2d\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>Valid, Invalid: When valid, the cache line is present in the cache. When invalid, the cache line is not present in the cache.</li> <li>Unique, Shared: When unique, the cache line exists only in one cache. When shared, the cache line might exist in more than one cache, but this is not guaranteed.</li> <li>Clean, Dirty: When clean, the cache does not have responsibility for updating main memory. When dirty, the cache line has been modified with respect to main memory, and this cache must ensure that main memory is eventually updated.</li> </ul> <p>\u5927\u81f4\u7406\u89e3\u7684\u8bdd\uff0cUnique \u8868\u793a\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\uff0cShared \u8868\u793a\u6709\u53ef\u80fd\u6709\u591a\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\uff1bClean \u8868\u793a\u5b83\u4e0d\u8d1f\u8d23\u66f4\u65b0\u5185\u5b58\uff0cDirty \u8868\u793a\u5b83\u8d1f\u8d23\u66f4\u65b0\u5185\u5b58\u3002\u4e0b\u9762\u7684\u5f88\u591a\u64cd\u4f5c\u90fd\u662f\u56f4\u7ed5\u8fd9\u4e9b\u72b6\u6001\u8fdb\u884c\u7684\u3002</p> <p>\u6587\u6863\u4e2d\u4e5f\u8bf4\uff0c\u5b83\u652f\u6301 MOESI \u7684\u4e0d\u540c\u5b50\u96c6\uff1aMESI, ESI, MEI, MOESI\uff0c\u6240\u4ee5\u4e5f\u8bb8\u5728\u4e00\u4e2a\u7b80\u5316\u7684\u7cfb\u7edf\u91cc\uff0c\u4e00\u4e9b\u72b6\u6001\u53ef\u4ee5\u4e0d\u5b58\u5728\uff0c\u5b9e\u73b0\u4f1a\u6709\u6240\u4e0d\u540c\u3002</p>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#channel-usage-examples","title":"Channel usage examples","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u8fd8\u6ca1\u6709\u4ecb\u7ecd ACE \u7684\u4fe1\u53f7\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u662f\u534f\u8bae\u7684\u8bbe\u8ba1\u8005\uff0c\u6211\u4eec\u8981\u5982\u4f55\u6dfb\u52a0\u4fe1\u53f7\u6765\u5b8c\u6210\u8fd9\u4e2a\u4e8b\u60c5\u3002</p> <p>\u9996\u5148\u8003\u8651\u4e0a\u9762\u63d0\u5230\u7684\u7b2c\u4e00\u4ef6\u4e8b\u60c5\uff1a\u8bfb\u6216\u5199 miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bf7\u6c42\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\uff0c\u5e76\u4e14\u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u8bfb\u53d6\u5230 Shared\uff0c\u5199\u5165\u5230 Modified \u7b49\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0cAXI \u6709 AR \u548c R channel \u7528\u4e8e\u8bfb\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u9047\u5230\u8bfb\u6216\u8005\u5199 miss \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5728 AR channel \u4e0a\u634e\u5e26\u4e00\u4e9b\u4fe1\u606f\uff0c\u8ba9\u4e0b\u4e00\u7ea7\u7684 Interconnect \u77e5\u9053\u81ea\u5df1\u7684\u610f\u56fe\u662f\u8bfb\u8fd8\u662f\u5199\uff0c\u7136\u540e Interconnect \u5c31\u5728 R channel \u4e0a\u8fd4\u56de\u6570\u636e\u3002</p> <p>\u90a3\u4e48\uff0c\u5177\u4f53\u8981\u634e\u5e26\u4ec0\u4e48\u4fe1\u606f\u5462\uff1f\u6211\u4eec\u201c\u4e0d\u59a8\u201d\u7528\u8fd9\u6837\u4e00\u79cd\u547d\u540d\u65b9\u5f0f\uff1a<code>\u64cd\u4f5c + \u76ee\u7684\u72b6\u6001</code>\uff0c\u6bd4\u5982\u6211\u8bfb miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bfb\u53d6\u6570\u636e\uff0c\u8fdb\u5165 Shared \u72b6\u6001\uff0c\u90a3\u5c31\u53eb ReadShared\uff1b\u6211\u5199 miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bfb\u53d6\u6570\u636e\uff08\u901a\u5e38\u5199\u5165\u7f13\u5b58\u7684\u53ea\u662f\u4e00\u4e2a\u7f13\u5b58\u884c\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u5148\u8981\u628a\u5b8c\u6574\u7684\u8bfb\u8fdb\u6765\uff09\uff0c\u90a3\u5c31\u53eb ReadUnique\u3002\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u7f16\u7801\u5230\u4e00\u4e2a\u4fe1\u53f7\u4e2d\uff0c\u4f20\u9012\u7ed9 Interconnect\u3002</p> <p>\u518d\u6765\u8003\u8651\u4e0a\u9762\u63d0\u5230\u7684\u7b2c\u4e8c\u4ef6\u4e8b\u60c5\uff1a\u5199\u5165\u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5347\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u4ece Shared \u5230 Modified\u3002</p> <p>\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u9700\u8981\u8ba9 Interconnect \u628a\u5176\u4ed6\u7f13\u5b58\u4e2d\u7684\u8fd9\u4e2a\u7f13\u5b58\u884c\u6570\u636e\u6e05\u7a7a\uff0c\u5e76\u4e14\u628a\u81ea\u5df1\u5347\u7ea7\u5230 Unique\u3002\u6839\u636e\u4e0a\u9762\u7684 <code>\u64cd\u4f5c + \u76ee\u7684\u72b6\u6001</code> \u7684\u547d\u540d\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u547d\u540d\u4e3a CleanUnique\uff0c\u5373\u628a\u5176\u4ed6\u7f13\u5b58\u90fd Clean \u6389\uff0c\u7136\u540e\u81ea\u5df1\u53d8\u6210 Unique\u3002</p> <p>\u63a5\u4e0b\u6765\u8003\u8651\u4e0a\u9762\u63d0\u5230\u7684\u7b2c\u4e09\u4ef6\u4e8b\u60c5\uff1a\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a dirty \u6570\u636e\u5199\u56de\uff0c\u5e76\u4e14\u964d\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982 Modified -&gt; Shared/Invalid\u3002</p> <p>\u6309\u7167\u524d\u9762\u7684 <code>\u64cd\u4f5c + \u76ee\u7684\u72b6\u6001</code> \u547d\u540d\u6cd5\uff0c\u53ef\u4ee5\u547d\u540d\u4e3a WriteBackInvalid\u3002ACE \u5b9e\u9645\u91c7\u7528\u7684\u547d\u540d\u662f WriteBack\u3002</p> <p>\u7ec8\u4e8e\u5230\u4e86\u7b2c\u56db\u4ef6\u4e8b\u60c5\uff1a\u6536\u5230 snoop \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u9700\u8981\u8fd4\u56de\u5f53\u524d\u7684\u7f13\u5b58\u6570\u636e\uff0c\u5e76\u4e14\u66f4\u65b0\u72b6\u6001\u3002</p> <p>\u65e2\u7136 snoop \u662f\u4ece Interconnect \u53d1\u7ed9 Master\uff0c\u5728\u5df2\u6709\u7684 AR R AW W B channel \u91cc\u6ca1\u529e\u6cd5\u505a\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4e0d\u7136\u4f1a\u6253\u7834\u5df2\u6709\u7684\u903b\u8f91\u3002\u90a3\u4e0d\u5f97\u4e0d\u6dfb\u52a0\u4e00\u5bf9 channel\uff0c\u6bd4\u5982\u6211\u89c4\u5b9a\u4e00\u4e2a AC channel \u53d1\u9001 snoop \u8bf7\u6c42\uff0c\u89c4\u5b9a\u4e00\u4e2a C channel \u8ba9 master \u53d1\u9001\u54cd\u5e94\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u5c31\u76f8\u5f53\u4e8e TileLink \u91cc\u9762\u7684 B channel\uff08Probe \u8bf7\u6c42\uff09\u548c C channel\uff08ProbeAck \u54cd\u5e94\uff09\u3002\u5b9e\u9645 ACE \u548c\u521a\u624d\u8bbe\u8ba1\u7684\u5b9e\u9645\u6709\u4e00\u4e9b\u533a\u522b\uff0c\u628a C channel \u62c6\u6210\u4e86\u4e24\u4e2a\uff1aCR \u7528\u4e8e\u8fd4\u56de\u6240\u6709\u54cd\u5e94\uff0cCD \u7528\u4e8e\u8fd4\u56de\u90a3\u4e9b\u9700\u8981\u6570\u636e\u7684\u54cd\u5e94\u3002\u8fd9\u5c31\u50cf AW \u548c W \u7684\u5173\u7cfb\uff0c\u4e00\u4e2a\u4f20\u5730\u5740\uff0c\u4e00\u4e2a\u4f20\u6570\u636e\uff1b\u7c7b\u4f3c\u5730\uff0cCR \u4f20\u72b6\u6001\uff0cCD \u4f20\u6570\u636e\u3002</p> <p>\u90a3\u4e48\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u4e00\u4e0b AC channel \u4e0a\u8981\u53d1\u9001\u4ec0\u4e48\u8bf7\u6c42\u5462\uff1f\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u4e0a\u9762\u5df2\u7ecf\u7528\u5230\u7684\u8bf7\u6c42\u7c7b\u578b\uff1a\u9700\u8981 snoop \u7684\u6709 ReadShared\uff0cReadUnique \u548c CleanUnique\uff0c\u4e0d\u9700\u8981 snoop \u7684\u6709 WriteBack\u3002\u90a3\u6211\u4eec\u76f4\u63a5\u901a\u8fc7 AC channel \u628a ReadShared\uff0cReadUnique \u548c CleanUnique \u8fd9\u4e09\u79cd\u8bf7\u6c42\u539f\u6837\u53d1\u9001\u7ed9\u9700\u8981 snoop \u7684 cache \u90a3\u91cc\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>Cache \u5728 AC channel \u6536\u5230\u8fd9\u4e9b\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u505a\u76f8\u5e94\u7684\u52a8\u4f5c\u3002\u7531\u4e8e MOESI \u534f\u8bae\u4e0b\u540c\u6837\u7684\u8bf7\u6c42\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u54cd\u5e94\u65b9\u6cd5\uff0c\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002</p> <p>\u8fd9\u65f6\u5019\u6211\u4eec\u5df2\u7ecf\u57fa\u672c\u628a ACE \u534f\u8bae\u7684\u4fe1\u53f7\u548c\u5927\u9898\u7684\u5de5\u4f5c\u6d41\u7a0b\u63a8\u5bfc\u51fa\u6765\u4e86\u3002\u54e6\uff0c\u6211\u4eec\u8fd8\u5fd8\u4e86\u7b2c\u4e94\u4ef6\u4e8b\u60c5\uff1a\u9700\u8981\u4e00\u4e2a\u65b9\u6cd5\u6765\u901a\u77e5\u4e0b\u4e00\u7ea7 Cache/Interconnect\uff0c\u544a\u8bc9\u5b83\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4e86\u3002TileLink \u6dfb\u52a0\u4e86\u4e00\u4e2a\u989d\u5916\u7684 E channel \u6765\u505a\u8fd9\u4e2a\u4e8b\u60c5\uff0cACE \u66f4\u52a0\u7c97\u66b4\uff1a\u76f4\u63a5\u7528\u4e00\u5bf9 RACK \u548c WACK \u4fe1\u53f7\u6765\u5206\u522b\u8868\u793a\u6700\u540e\u4e00\u6b21\u8bfb\u548c\u5199\u5df2\u7ecf\u5b8c\u6210\u3002</p> <p>\u5173\u4e8e WACK \u548c RACK \u8be6\u89c1 What's the purpose for WACK and RACK for ACE and what's the relationship with WVALID and RVALID? \u7684\u8ba8\u8bba\u3002</p>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u5230\u8fd9\u91cc\u5c31\u6682\u65f6\u4e0d\u7ee7\u7eed\u5206\u6790\u4e86\uff0c\u5176\u4ed6\u7684\u5f88\u591a\u8bf7\u6c42\u7c7b\u578b\u662f\u670d\u52a1\u4e8e\u66f4\u591a\u573a\u666f\uff0c\u6bd4\u5982\u4e00\u6b21\u5199\u6574\u4e2a Cache Line \u7684\u8bdd\uff0c\u5c31\u4e0d\u9700\u8981\u8bfb\u53d6\u5df2\u6709\u7684\u6570\u636e\u4e86\uff1b\u6216\u8005\u4e00\u6b21\u6027\u8bfb\u53d6\u5b8c\u5c31\u4e0d\u7ba1\u4e86\uff0c\u6216\u8005\u8fd9\u662f\u4e00\u4e2a\u4e0d\u5e26\u7f13\u5b58\u7684\u52a0\u901f\u5668\uff0cDMA \u7b49\uff0c\u6709\u4e00\u4e9b\u9488\u5bf9\u6027\u7684\u4f18\u5316\u6216\u8005\u7b80\u5316\u7684\u5904\u7406\uff0c\u6bd4\u5982\u5bf9\u4e8e\u4e0d\u5e26\u7f13\u5b58\u7684 master\uff0c\u53ef\u4ee5\u7b80\u5316\u4e3a ACE-Lite\uff0c\u6bd4\u5982 ARM \u7684 CCI-400 \u652f\u6301\u4e24\u4e2a ACE master \u548c \u4e09\u4e2a ACE-Lite Master\uff0c\u8fd9\u4e9b Master \u53ef\u4ee5\u7528\u6765\u63a5 GPU \u7b49\u5916\u8bbe\u3002\u518d\u7b80\u5316\u4e00\u4e0b ACE-Lite\uff0c\u5c31\u5f97\u5230\u4e86 ACP\uff08Accelerator Coherency Port\uff09\u3002</p> <p>\u6700\u540e\u6211\u4eec\u518d\u628a\u6587\u7ae0\u5f00\u5934\u7684\u4e94\u4ef6\u4e8b\u5bf9\u5e94\u5230 ACE \u4e0a\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u524d\u540e\u7684\u547c\u5e94\uff1a</p> <ol> <li>\u8bfb\u6216\u5199 miss \u7684\u65f6\u5019\uff0c\u9700\u8981\u8bf7\u6c42\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\uff08AR \u4e0a\u53d1\u9001 ReadShared/ReadUnique\uff09\uff0c\u5e76\u4e14\u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u8bfb\u53d6\u5230 Shared\uff0c\u5199\u5165\u5230 Modified \u7b49\u3002</li> <li>\u5199\u5165\u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5347\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff08AR \u4e0a\u53d1\u9001 CleanUnique\uff09\uff0c\u6bd4\u5982\u4ece Shared \u5230 Modified\u3002</li> <li>\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; dirty \u7684\u7f13\u5b58\u884c\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a dirty \u6570\u636e\u5199\u56de\uff08AW \u4e0a\u53d1\u9001 WriteBack\uff09\uff0c\u5e76\u4e14\u964d\u7ea7\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u6bd4\u5982 Modified -&gt; Shared/Invalid\u3002\u5982\u679c\u9700\u8981 evict \u4e00\u4e2a valid &amp;&amp; !dirty \u7684\u7f13\u5b58\u884c\uff0c\u53ef\u4ee5\u9009\u62e9\u901a\u77e5\uff08AW \u4e0a\u53d1\u9001 Evict\uff09\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u901a\u77e5\u4e0b\u4e00\u7ea7\u3002</li> <li>\u6536\u5230 snoop \u8bf7\u6c42\u7684\u65f6\u5019\uff08AC \u4e0a\u6536\u5230 snoop \u8bf7\u6c42\uff09\uff0c\u9700\u8981\u8fd4\u56de\u5f53\u524d\u7684\u7f13\u5b58\u6570\u636e\uff08\u901a\u8fc7 CR \u548c CD\uff09\uff0c\u5e76\u4e14\u66f4\u65b0\u72b6\u6001\u3002</li> <li>\u9700\u8981\u4e00\u4e2a\u65b9\u6cd5\uff08\u8bfb RACK \u5199 WACK\uff09\u6765\u901a\u77e5\u4e0b\u4e00\u7ea7 Cache/Interconnect\uff0c\u544a\u8bc9\u5b83\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4e86\u3002</li> </ol>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/05/16/ace/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>IHI0022E-AMBA AXI and ACE</li> </ul>","tags":["axi","bus","cache","coherence","teaching"]},{"location":"hardware/2022/12/10/acpi-notes/","title":"ACPI \u5b66\u4e60\u7b14\u8bb0","text":"","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u6807\u51c6","title":"\u6807\u51c6","text":"<p>ACPI \u6807\u51c6\u53ef\u4ee5\u4ece\u5b98\u7f51\u4e0b\u8f7d\u3002</p> <p>ACPI \u7684\u8868\u73b0\u5f62\u5f0f\u4e3a\u4e00\u9897\u6811\u52a0\u82e5\u5e72\u4e2a\u8868\uff0c\u8868\u7684\u7ed3\u6784\u6bd4\u8f83\u89c4\u6574\uff0c\u91cc\u9762\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u6709\u56fa\u5b9a\u7684\u542b\u4e49\u3002\u6811\u7684\u7ed3\u70b9\u53ef\u80fd\u662f\u5c5e\u6027\uff0c\u6216\u8005\u662f\u4e00\u4e9b\u51fd\u6570\u3002\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u64cd\u4f5c\u4e0a\u9762\u7684\u5c5e\u6027\uff0c\u8c03\u7528 ACPI \u4e2d\u7684\u51fd\u6570\uff0c\u6765\u8fdb\u884c\u4e00\u4e9b\u786c\u4ef6\u76f8\u5173\u7684\u64cd\u4f5c\u3002ACPI \u4e00\u822c\u4e0e\u4e3b\u677f\u5bc6\u5207\u76f8\u5173\uff0c\u4e3b\u677f\u5382\u5bb6\u914d\u7f6e\u597d ACPI \u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4e0d\u9700\u8981\u7ed9\u6bcf\u4e2a\u4e3b\u677f\u90fd\u5199\u4e00\u904d\u4ee3\u7801\u4e86\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#asl","title":"ASL","text":"<p>\u4e3a\u4e86\u5f00\u53d1 ACPI\uff0c\u9700\u8981\u4f7f\u7528 ACPI Source Language(ASL) \u6765\u8fdb\u884c\u7f16\u7a0b\uff0c\u4f7f\u7528 iasl \u7f16\u8bd1\u6210 ACPI \u8868\u4ee5\u540e\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u89e3\u91ca\u6267\u884c\u3002\u63a8\u8350\u9605\u8bfb\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684 ASL \u6559\u7a0b\uff1aACPI Source Language (ASL) Tutorial\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cASL \u4e2d\u7684\u53d8\u91cf\u7c7b\u578b\uff1a</p> <ul> <li>Integer: <code>int32_t/int64_t</code></li> <li>String: <code>char *</code></li> <li>Buffer: <code>uint8_t []</code></li> <li>Package: <code>object []</code></li> <li>Object Reference: <code>object &amp;</code></li> <li>Method</li> </ul> <p>ACPI \u9700\u8981\u8bbf\u95ee\u786c\u4ef6\uff0c\u4e00\u822c\u662f\u901a\u8fc7 MMIO \u6216\u8005 IO Port \u6765\u8fdb\u884c\u8bbf\u95ee\u3002\u5728\u5185\u6838\u5f00\u53d1\u7684\u65f6\u5019\uff0cMMIO \u4e00\u822c\u662f\u7528\u4e00\u7cfb\u5217 volatile \u6307\u9488\u6765\u5bf9\u5e94\u786c\u4ef6\u7684\u5bc4\u5b58\u5668\u5b9a\u4e49\u3002ASL \u4e2d\u4e5f\u53ef\u4ee5\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\uff0c\u5206\u4e3a\u4e24\u6b65\uff1a<code>OperationRegion</code> \u548c <code>Field</code>\u3002</p> <p><code>OperationRegion</code> \u5c31\u662f\u58f0\u660e\u4e86\u4e00\u7247\u5730\u5740\u7a7a\u95f4\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u7c7b\u578b\u6709 SystemMemory\u3001SystemIO\u3001PCI_Config\u3001SMBus \u7b49\u7b49\u3002\u5f53 ACPI \u4e2d\u7684\u4ee3\u7801\u8981\u8bbf\u95ee <code>OperationRegion</code> \u4e2d\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u5185\u6838\u6309\u7167\u7c7b\u578b\u53bb\u8fdb\u884c\u5b9e\u9645\u7684\u8bbf\u95ee\u3002</p> <p>\u6709\u4e86\u5730\u5740\u7a7a\u95f4\u4ee5\u540e\uff0c\u8fd8\u9700\u8981\u6839\u636e\u5bc4\u5b58\u5668\u7684\u5b9a\u4e49\uff0c\u7ed9\u5404\u4e2a\u5b57\u6bb5\u8d77\u4e2a\u540d\u5b57\uff0c\u8fd9\u5c31\u662f <code>Field</code>\u3002<code>Field</code> \u7ed9 <code>OperationRegion</code> \u4e2d\u7684\u5b57\u6bb5\u8d77\u540d\uff0c\u4e0e\u786c\u4ef6\u7684\u5b9a\u4e49\u60f3\u5bf9\u5e94\uff0c\u8fd9\u5c31\u50cf\u5728\u5185\u6838\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u4fdd\u8bc1\u7ed3\u6784\u4f53\u7684\u6210\u5458\u7684\u504f\u79fb\u548c\u786c\u4ef6\u662f\u4e00\u81f4\u7684\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u6210\u5458\u6765\u8bbf\u95ee\uff0c\u800c\u4e0d\u662f\u6bcf\u6b21\u90fd\u53bb\u8ba1\u7b97\u4e00\u6b21\u504f\u79fb\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u7684-acpi-\u8868","title":"\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u7684 ACPI \u8868","text":"<p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 ACPI \u8868\u5e76\u8f6c\u6362\u4e3a\u53ef\u4ee5\u9605\u8bfb\u7684\u683c\u5f0f\uff1a</p> <pre><code>sudo acpidump -o acpi.raw\nacpixtract -a acpi.raw\niasl -d *.dat\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u4e32\u53e3","title":"\u4e32\u53e3","text":"","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#x86_64","title":"x86_64","text":"<p>\u4e0b\u9762\u6765\u770b\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u4e3b\u677f <code>WS X299 PRO/SE</code> \u7684 ACPI \u8868\u4e2d\u8bb0\u5f55\u7684\u4e32\u53e3\u4fe1\u606f\uff1a</p> <pre><code>// UART 1\nDevice (UAR1)\n{\n    Name (_HID, EisaId (\"PNP0501\") /* 16550A-compatible COM Serial Port */)  // _HID: Hardware ID\n    Name (_UID, 0x00)  // _UID: Unique ID\n    Name (LDN, 0x02)\n    Method (_STA, 0, NotSerialized)  // _STA: Status\n    {\n        Return (^^SIO1.DSTA (0x00)) // Device Status\n    }\n\n    Method (_DIS, 0, NotSerialized)  // _DIS: Disable Device\n    {\n        ^^SIO1.DCNT (0x00, 0x00) // Device Control\n    }\n\n    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n    {\n        Return (^^SIO1.DCRS (0x00, 0x00))\n    }\n\n    Method (_SRS, 1, NotSerialized)  // _SRS: Set Resource Settings\n    {\n        ^^SIO1.DSRS (Arg0, 0x00)\n    }\n\n    Name (_PRS, ResourceTemplate ()  // _PRS: Possible Resource Settings\n    {\n        StartDependentFn (0x00, 0x00)\n        {\n            IO (Decode16,\n                0x03F8,             // Range Minimum\n                0x03F8,             // Range Maximum\n                0x01,               // Alignment\n                0x08,               // Length\n                )\n            IRQNoFlags ()\n                {4}\n            DMA (Compatibility, NotBusMaster, Transfer8, )\n                {}\n        }\n        StartDependentFnNoPri ()\n        {\n            IO (Decode16,\n                0x03F8,             // Range Minimum\n                0x03F8,             // Range Maximum\n                0x01,               // Alignment\n                0x08,               // Length\n                )\n            IRQNoFlags ()\n                {4}\n            DMA (Compatibility, NotBusMaster, Transfer8, )\n                {}\n        }\n        StartDependentFnNoPri ()\n        {\n            IO (Decode16,\n                0x02F8,             // Range Minimum\n                0x02F8,             // Range Maximum\n                0x01,               // Alignment\n                0x08,               // Length\n                )\n            IRQNoFlags ()\n                {3}\n            DMA (Compatibility, NotBusMaster, Transfer8, )\n                {}\n        }\n        StartDependentFnNoPri ()\n        {\n            IO (Decode16,\n                0x03E8,             // Range Minimum\n                0x03E8,             // Range Maximum\n                0x01,               // Alignment\n                0x08,               // Length\n                )\n            IRQNoFlags ()\n                {4}\n            DMA (Compatibility, NotBusMaster, Transfer8, )\n                {}\n        }\n        StartDependentFnNoPri ()\n        {\n            IO (Decode16,\n                0x02E8,             // Range Minimum\n                0x02E8,             // Range Maximum\n                0x01,               // Alignment\n                0x08,               // Length\n                )\n            IRQNoFlags ()\n                {3}\n            DMA (Compatibility, NotBusMaster, Transfer8, )\n                {}\n        }\n        EndDependentFn ()\n    })\n}\n</code></pre> <p>\u8fd9\u4e2a\u8bbe\u5907\u5728 Linux \u4e2d\u7684\u8def\u5f84\u662f <code>/sys/devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A08:00/device:86/PNP0501:00</code>\uff0c\u8fdb\u4e00\u6b65\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b83\u7684 <code>path</code> \u662f <code>\\_SB_.PC00.LPC0.UAR1</code>\uff0c\u4e0e DSDT \u4e2d\u7684\u8def\u5f84\u4e00\u81f4\u3002\u8fdb\u4e00\u6b65\u63a2\u7d22\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u5339\u914d\u5230\u4e86 Linux \u7684 <code>serial</code> \u9a71\u52a8\uff0c\u5e76\u4e14\u6700\u7ec8\u5bf9\u5e94\u5230\u4e86 <code>/dev/ttyS0</code> \u8bbe\u5907\u3002\u8fd8\u53ef\u4ee5\u770b\u5230 Linux \u751f\u6210\u7684 <code>resources</code> \u63cf\u8ff0\uff1a</p> <pre><code>state = active\nio 0x3f8-0x3ff\nirq 4\ndma disabled\n</code></pre> <p>\u8fd9\u548c\u4e0a\u9762\u770b\u5230\u7684\u662f\u4e00\u81f4\u7684\uff1a</p> <pre><code>IO (Decode16,\n    0x03F8,             // Range Minimum\n    0x03F8,             // Range Maximum\n    0x01,               // Alignment\n    0x08,               // Length\n    )\n</code></pre> <p>\u8fd9\u91cc\u8868\u8fbe\u7684\u6b63\u662f <code>0x3F8-0x3FF</code> \u8fd9\u4e00\u6bb5 IO Port\u3002\u8fd9\u4e2a\u5730\u5740\u548c OSDev \u4e0a\u770b\u5230\u7684\u4e5f\u662f\u543b\u5408\u7684\u3002</p> <p>\u8fdb\u4e00\u6b65\u5206\u6790\u4ee3\u7801\uff0c<code>_STA</code> \u51fd\u6570\u8fd4\u56de\u8bbe\u5907\u5f53\u524d\u7684\u72b6\u6001\u3002\u53ef\u4ee5\u5728 Linux \u7684 ACPI \u7ed3\u70b9\u8def\u5f84\u4e0b\u770b <code>status</code> \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u662f <code>15</code>\uff0c\u8868\u793a\u5de5\u4f5c\u6b63\u5e38\u3002\u5b9e\u73b0\u4e2d\uff0c\u5b83\u8c03\u7528\u4e86 <code>^^SIO1.DSTA(0x00)</code>\uff0c\u8fd9\u91cc\u7684 <code>^</code> \u8868\u793a\u4e0a\u4e00\u7ea7\u547d\u540d\u7a7a\u95f4\u3002\u8fdb\u4e00\u6b65\u627e\u5230 <code>DSTA</code> \u7684\u5b9e\u73b0\uff1a</p> <pre><code>// Device Status\nMethod (DSTA, 1, NotSerialized)\n{\n    // Enter Configuration Mode\n    ENFG (CGLD (Arg0))\n    Local0 = ACTR /* \\_SB_.PC00.LPC0.SIO1.ACTR */\n    // Exit Configuration Mode\n    EXFG ()\n    If ((Local0 == 0xFF))\n    {\n        Return (0x00)\n    }\n\n    Local0 &amp;= 0x01\n    If ((Arg0 &lt; 0x10))\n    {\n        // IO State\n        IOST |= (Local0 &lt;&lt; Arg0)\n    }\n\n    If (Local0)\n    {\n        Return (0x0F)\n    }\n    ElseIf ((Arg0 &lt; 0x10))\n    {\n        If (((0x01 &lt;&lt; Arg0) &amp; IOST))\n        {\n            Return (0x0D)\n        }\n        Else\n        {\n            Return (0x00)\n        }\n    }\n    Else\n    {\n        Return (0x00)\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6838\u5fc3\u662f\u8981\u5224\u65ad <code>ACTR</code> \u7684\u53d6\u503c\uff0c\u7ee7\u7eed\u5bfb\u627e\uff0c\u53ef\u4ee5\u53d1\u73b0 <code>ACTR</code> \u662f\u4e00\u4e2a SuperIO \u7684\u5bc4\u5b58\u5668\uff1a</p> <pre><code>// Super IO\nName (SP1O, 0x2E)\n\nOperationRegion (IOID, SystemIO, SP1O, 0x02)\nField (IOID, ByteAcc, NoLock, Preserve)\n{\n    INDX,   8, \n    DATA,   8\n}\n\nIndexField (INDX, DATA, ByteAcc, NoLock, Preserve)\n{\n    // omitted\n    Offset (0x30), \n    ACTR,   8,  // Activate Register\n}\n</code></pre> <p><code>ACTR</code> \u5bc4\u5b58\u5668\u9700\u8981\u901a\u8fc7 0x2E/0x2F \u8fd9\u4e24\u4e2a IO Port \u6765\u8bbf\u95ee\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528\u4e86 <code>IndexField</code>\uff0c\u4f8b\u5982\u8981\u8bfb\u53d6 <code>ACTR</code> \u7684\u5f53\u524d\u503c\u7684\u8bdd\uff0c\u9996\u5148\u8981\u5f80 <code>0x2E</code> \u5904\u5199\u5165 <code>ACTR</code> \u7684\u504f\u79fb\uff0c\u518d\u4ece <code>0x2F</code> \u5904\u8bfb\u51fa\u5f53\u524d\u503c\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u5e94\u8be5\u5c31\u5c5e\u4e8e SuperIO \u4e86\u3002</p> <p>\u5176\u4ed6\u7684\u51e0\u4e2a\u51fd\u6570\u542b\u4e49\u662f\uff0c<code>_CRS</code> \u8fd4\u56de\u5f53\u524d\u7684\u8d44\u6e90\u914d\u7f6e\uff0c<code>_SRS</code> \u53ef\u4ee5\u4fee\u6539\u8d44\u6e90\u914d\u7f6e\uff0c<code>_PRS</code> \u5217\u51fa\u53ef\u80fd\u7684\u8d44\u6e90\u914d\u7f6e\uff0c<code>_DIS</code> \u7981\u7528\u8bbe\u5907\u3002</p> <p>\u4ece Linux \u5185\u6838\u65e5\u5fd7\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6b3e\u4e3b\u677f\u7528\u7684\u662f NCT6796D \u517c\u5bb9\u7684 SuperIO \u82af\u7247\uff1a</p> <pre><code>nct6775: Found NCT6796D or compatible chip at 0x2e:0x290\n</code></pre> <p>\u67e5\u8be2 NCT6796D Datasheet\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ul> <li>\u82af\u7247\u901a\u8fc7 LPC \u603b\u7ebf\u4e0e CPU \u8fde\u63a5\uff0c\u652f\u6301\u591a\u79cd\u5916\u8bbe\u63a5\u53e3\uff0c\u5305\u62ec UART\uff0cPS/2\uff0c\u7ea2\u5916\uff0cGPIO\uff0cSMBus \u7b49\u7b49</li> <li>\u504f\u79fb 0x30 \u7684\u5bc4\u5b58\u5668 <code>ACTR</code> \u7684\u6700\u4f4e\u4f4d\u8868\u793a\u4e86 logical device \u7684\u5f53\u524d\u72b6\u6001\u3002</li> <li>\u8bfb\u53d6 <code>ACTR</code> \u4e4b\u524d\u9700\u8981\u8bbe\u7f6e LDN(Logical Device Number) \u4e3a 2\uff0c2 \u5bf9\u5e94 Serial Port 1(UARTA)\u3002\u8fd9\u4e00\u6b65\u662f\u5728 <code>ENFG(CGLD(Arg0))</code> \u4e2d\u5b8c\u6210\u7684\u3002</li> <li><code>CGLD</code> \u51fd\u6570\u67e5\u8be2\u4e86 <code>DCAT</code>\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e32\u53e3\u5728 <code>DCAT</code> \u7684\u4e0b\u6807\u662f 0\uff0c\u67e5\u8868\u5f97\u5230\u7684\u662f 2\uff0c\u4e5f\u5c31\u662f Logial Device Number \u4e3a 2\uff0c\u548c\u4e0a\u9762\u7684\u53d1\u73b0\u662f\u543b\u5408\u7684\u3002<code>DCAT</code> \u7684\u4e0b\u4e00\u9879\u662f <code>0x3</code>\uff0c\u4e5f\u5c31\u662f Logical Device Number \u4e3a 3\uff0c\u5728 Datasheet \u4e2d\u53ef\u4ee5\u770b\u5230\u662f Serial Port 2(UARTB)\u3002</li> <li>DSDT \u4e2d\u8fd8\u53ef\u4ee5\u627e\u5230 <code>PS2K</code> \u7684\u7ed3\u70b9\uff0c\u5c31\u662f PS/2 \u952e\u9f20\uff0c\u5c5e\u6027\u4e2d\u6807\u8bb0\u4e86 <code>LDN=5</code>\uff0c\u548c Datasheet \u4e5f\u662f\u4e00\u81f4\u7684\u3002</li> </ul>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#arm64","title":"ARM64","text":"<p>\u524d\u9762\u770b\u8fc7\u4e86 x86_64 \u5e73\u53f0\u7684\u4e32\u53e3\uff0c\u662f\u9700\u8981\u901a\u8fc7 IO Port \u8fdb\u884c\u8bbf\u95ee\u7684\u3002\u5728 ARM \u5e73\u53f0\u4e0a\uff0c\u5219\u4e00\u822c\u662f\u901a\u8fc7 MMIO \u8bbf\u95ee\u3002\u641c\u7d22\u5185\u6838\u65e5\u5fd7\uff0c\u53ef\u4ee5\u53d1\u73b0\u5185\u6838\u4ece SPCR(Serial Port Console Redirection table) \u8868\u83b7\u53d6\u5f97\u5230\u4e32\u53e3\u7684\u4fe1\u606f\uff1a</p> <pre><code>ACPI: SPCR: console: uart,mmio,0x3f00002f8,115200\n</code></pre> <p>SPCR \u8868\u7684\u5185\u5bb9\uff1a</p> <pre><code>[024h 0036   1]               Interface Type : 00\n[025h 0037   3]                     Reserved : 000000\n\n[028h 0040  12]         Serial Port Register : [Generic Address Structure]\n[028h 0040   1]                     Space ID : 00 [SystemMemory]\n[029h 0041   1]                    Bit Width : 08\n[02Ah 0042   1]                   Bit Offset : 00\n[02Bh 0043   1]         Encoded Access Width : 01 [Byte Access:8]\n[02Ch 0044   8]                      Address : 00000003F00002F8\n\n[034h 0052   1]               Interrupt Type : 08\n[035h 0053   1]          PCAT-compatible IRQ : 00\n[036h 0054   4]                    Interrupt : 000001E4\n[03Ah 0058   1]                    Baud Rate : 07\n[03Bh 0059   1]                       Parity : 00\n[03Ch 0060   1]                    Stop Bits : 01\n[03Dh 0061   1]                 Flow Control : 00\n[03Eh 0062   1]                Terminal Type : 03\n</code></pre> <p>SPCR \u8868\u7684\u5b9a\u4e49\u53ef\u4ee5\u5728 Serial Port Console Redirection Table (SPCR) \u5904\u770b\u5230\uff1a</p> <ul> <li>Interface Type(00): Full 16550 interface</li> <li>Interrupt Type(08): ARMH GIC interrupt (Global System Interrupt)</li> <li>Baud Rate(07): 115200</li> <li>Terminal Type(03): ANSI</li> </ul> <p>\u548c\u5185\u6838\u5f97\u5230\u7684\u4fe1\u606f\u662f\u4e00\u81f4\u7684\u3002\u5185\u6838\u4e2d\u89e3\u6790 SPCR \u8868\u7684\u51fd\u6570\u662f <code>acpi_sparse_spcr</code>\uff1a</p> <pre><code>int __init acpi_parse_spcr(bool enable_earlycon, bool enable_console)\n{\n    // omitted\n    if (table-&gt;serial_port.space_id == ACPI_ADR_SPACE_SYSTEM_MEMORY) {\n        // omitted\n        switch (ACPI_ACCESS_BIT_WIDTH((bit_width))) {\n        case 8:\n            iotype = \"mmio\";\n            break;\n        }\n    }\n\n    switch (table-&gt;interface_type) {\n        // omitted\n    case ACPI_DBG2_16550_COMPATIBLE:\n        uart = \"uart\";\n        break;\n    }\n\n    switch (table-&gt;baud_rate) {\n        // omitted\n    case 7:\n        baud_rate = 115200;\n        break;\n    }\n\n    if (!baud_rate) {\n        snprintf(opts, sizeof(opts), \"%s,%s,0x%llx\", uart, iotype,\n             table-&gt;serial_port.address);\n    } else {\n        // uart,mmio,0x3f00002f8,115200\n        snprintf(opts, sizeof(opts), \"%s,%s,0x%llx,%d\", uart, iotype,\n             table-&gt;serial_port.address, baud_rate);\n    }\n\n    // omitted\n}\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#ipmi","title":"IPMI","text":"","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#x86_65","title":"x86_64","text":"<p>\u63a5\u4e0b\u6765\uff0c\u518d\u6765\u770b ACPI \u4e2d\u662f\u5982\u4f55\u58f0\u660e IPMI \u7684\u3002\u4e3b\u677f\u4f9d\u7136\u662f <code>WS X299 PRO/SE</code>\uff0c\u4e3b\u677f\u81ea\u5e26\u4e86 BMC\uff0c\u53ef\u4ee5\u5728 DSDT \u4e2d\u641c\u5230\u76f8\u5173\u7684\u90e8\u5206\uff1a</p> <pre><code>Name (IDTP, 0x0CA2)\nName (ICDP, 0x0CA3)\nName (SRVV, 0x0200)\n\nDevice (SPMI)\n{\n    Name (_HID, EisaId (\"IPI0001\"))  // _HID: Hardware ID\n    Name (_STR, Unicode (\"IPMI_KCS\"))  // _STR: Description String\n    Name (_UID, 0x00)  // _UID: Unique ID\n    // IPMI Status\n    OperationRegion (IPST, SystemIO, ICDP, 0x01)\n    Field (IPST, ByteAcc, NoLock, Preserve)\n    {\n        STAS,   8\n    }\n\n    Method (_STA, 0, NotSerialized)  // _STA: Status\n    {\n        Local0 = STAS /* \\_SB_.PC00.LPC0.SPMI.STAS */\n        If ((Local0 == 0xFF))\n        {\n            Return (0x00)\n        }\n        Else\n        {\n            Return (0x0F)\n        }\n    }\n\n    Name (ICRS, ResourceTemplate ()\n    {\n        IO (Decode16,\n            0x0000,             // Range Minimum\n            0x0000,             // Range Maximum\n            0x00,               // Alignment\n            0x00,               // Length\n            _Y1E)\n        IO (Decode16,\n            0x0000,             // Range Minimum\n            0x0000,             // Range Maximum\n            0x00,               // Alignment\n            0x00,               // Length\n            _Y1F)\n    })\n    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n    {\n        If (IDTP)\n        {\n            CreateWordField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1E._MIN, IPDB)  // _MIN: Minimum Base Address\n            CreateWordField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1E._MAX, IPDH)  // _MAX: Maximum Base Address\n            CreateByteField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1E._LEN, IPDL)  // _LEN: Length\n            IPDB = IDTP /* \\IDTP */\n            IPDH = IDTP /* \\IDTP */\n            IPDL = 0x01\n        }\n\n        If (ICDP)\n        {\n            CreateWordField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1F._MIN, IPCB)  // _MIN: Minimum Base Address\n            CreateWordField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1F._MAX, IPCH)  // _MAX: Maximum Base Address\n            CreateByteField (ICRS, \\_SB.PC00.LPC0.SPMI._Y1F._LEN, IPCL)  // _LEN: Length\n            IPCB = ICDP /* \\ICDP */\n            IPCH = ICDP /* \\ICDP */\n            IPCL = 0x01\n        }\n\n        Return (ICRS) /* \\_SB_.PC00.LPC0.SPMI.ICRS */\n    }\n\n    Method (_IFT, 0, NotSerialized)  // _IFT: IPMI Interface Type\n    {\n        Return (0x01)\n    }\n\n    Method (_SRV, 0, NotSerialized)  // _SRV: IPMI Spec Revision\n    {\n        Return (SRVV) /* \\SRVV */\n    }\n}\n</code></pre> <p>\u5728 Linux \u4e2d\u53ef\u4ee5\u627e\u5230\u76f8\u5e94\u7684\u7ed3\u70b9\uff1a<code>/sys/devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A08:00/device:86/IPI0001:00</code>\u3002\u53ef\u4ee5\u53d1\u73b0\u5339\u914d\u5230\u4e86 <code>ipmi_si</code> \u9a71\u52a8\uff0c\u5e76\u4e14\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u51fd\u6570 <code>_STA</code> \u8fd4\u56de\u8bbe\u5907\u7684\u5f53\u524d\u72b6\u6001\uff0c\u5b83\u8bfb\u53d6\u4e86 IO Port 0x0CA3 \u7684\u5185\u5bb9\uff0c\u8fdb\u800c\u5224\u65ad IPMI \u662f\u5426\u6b63\u5e38\u3002</p> <p>\u51fd\u6570 <code>_CRS</code> \u8fd4\u56de\u5f53\u524d\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u5b83\u52a8\u6001\u5730\u8ba1\u7b97\u51fa\u4e00\u4e2a\u8d44\u6e90\u914d\u7f6e\uff0c\u5bf9\u5e94 IO Port \u662f 0x0CA2 \u548c 0x0CA3\u3002</p> <p>\u51fd\u6570 <code>_IFT</code> \u8fd4\u56de IPMI Interface Type\uff0c0x01 \u8868\u793a KCS(Keyboard Controller Style)\uff0c<code>_SRV</code> \u8fd4\u56de IPMI Spec Revision\uff0c\u5728\u8fd9\u91cc\u662f 0x0200\uff0c\u4e5f\u5c31\u662f IPMI 2.0\u3002</p> <p>\u8fd9\u4e9b\u5185\u5bb9\u53ef\u4ee5\u5728 Linux \u4e0b ACPI \u7ed3\u70b9\u7684 <code>physical_node/params</code> \u6587\u4ef6\u4e2d\u770b\u5230\uff1a<code>kcs,i/o,0xca2,rsp=1,rsi=1,rsh=0,irq=0,ipmb=32</code>\u3002</p> <p>\u67e5\u9605 Linux \u6e90\u7801\uff0c\u53ef\u4ee5\u627e\u5230 <code>acpi_ipmi_probe</code> \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u4ece ACPI \u4e2d\u5bfb\u627e IPMI \u914d\u7f6e\uff1a</p> <pre><code>static int acpi_ipmi_probe(struct platform_device *pdev)\n{\n    // omitted\n    dev_info(dev, \"probing via ACPI\\n\");\n\n    /* _IFT tells us the interface type: KCS, BT, etc */\n    status = acpi_evaluate_integer(handle, \"_IFT\", NULL, &amp;tmp);\n\n    switch (tmp) {\n    case 1:\n        io.si_type = SI_KCS;\n        break;\n    case 2:\n        io.si_type = SI_SMIC;\n        break;\n    case 3:\n        io.si_type = SI_BT;\n        break;\n    case 4: /* SSIF, just ignore */\n        return -ENODEV;\n    default:\n        dev_info(dev, \"unknown IPMI type %lld\\n\", tmp);\n        return -EINVAL;\n    }\n\n    res = ipmi_get_info_from_resources(pdev, &amp;io);\n    if (!res)\n        return -EINVAL;\n\n    // omitted\n}\n\nstatic const struct acpi_device_id acpi_ipmi_match[] = {\n    { \"IPI0001\", 0 },\n    { },\n};\n</code></pre> <p>\u548c\u4e0a\u9762\u7684\u5206\u6790\u662f\u53ef\u4ee5\u5bf9\u4e0a\u7684\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#ipmi-kcs","title":"IPMI KCS","text":"<p>\u67e5\u9605 IPMI \u6807\u51c6\u6587\u6863\uff0c\u53ef\u4ee5\u770b\u5230 KCS(Keyboard Controller Style) Interface \u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u4e24\u4e2a IO Port \u6765\u8bbf\u95ee BMC\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684 <code>base</code> \u5c31\u662f\u4e0a\u9762 ACPI \u8868\u8bb0\u5f55\u7684 <code>IDTP=0x0CA2</code>\uff0c<code>base+1</code> \u5c31\u662f ACPI \u8868\u8bb0\u5f55\u7684 <code>ICDP=0x0CA3</code>\u3002\u7ed3\u5408\u5bc4\u5b58\u5668\u7684\u7528\u9014\uff0c\u53ef\u4ee5\u731c\u6d4b IDTP \u662f IPMI Data Transfer Port \u7684\u7f29\u5199\uff0c\u56e0\u4e3a\u8fd9\u4e2a Port \u5bf9\u5e94\u7684\u662f <code>Data_In</code> \u548c <code>Data_Out</code>\uff1bICDP \u662f IPMI Command Data Port \u7684\u7f29\u5199\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#arm64_1","title":"ARM64","text":"<p>\u518d\u770b\u4e00\u4e2a ARM64 \u5e73\u53f0\u4e0a\u7684 IPMI\uff1a</p> <pre><code>Device (IPI0)\n{\n    Name (_HID, \"IPI0001\")  // _HID: Hardware ID\n    Method (_IFT, 0, NotSerialized)  // _IFT: IPMI Interface Type\n    {\n        Return (0x03) // BT\n    }\n\n    Name (_CRS, ResourceTemplate ()  // _CRS: Current Resource Settings\n    {\n        QWordMemory (ResourceConsumer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n            0x0000000000000000, // Granularity\n            0x00000003F00000E4, // Range Minimum\n            0x00000003F00000E7, // Range Maximum\n            0x0000000000000000, // Translation Offset\n            0x0000000000000004, // Length\n            ,, , AddressRangeMemory, TypeStatic)\n        Interrupt (ResourceConsumer, Level, ActiveHigh, Shared, ,, )\n        {\n            0x000001E4,\n        }\n    })\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>_IFT</code> \u8fd4\u56de\u503c\u662f 0x3\uff0c\u67e5\u9605\u6587\u6863\u53ef\u77e5\u8fd9\u8868\u793a\u7684\u662f BT \u7c7b\u578b\u3002<code>_CRS</code> \u4e2d\u4f7f\u7528\u4e86 QWordMemory \u5b8f\u6765\u63cf\u8ff0\u5730\u5740\u7a7a\u95f4\uff0c\u8fd9\u91cc\u5b9e\u9645\u4e0a\u5c31\u662f\u8868\u793a\u5185\u5b58\u5730\u5740 <code>0x3F00000E4-0x3F00000E7</code>\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#io-apic","title":"IO APIC","text":"<p>\u5728 DSDT \u4e2d\uff0c\u53ef\u4ee5\u627e\u5230 IO APIC \u7684\u57fa\u5730\u5740\uff1a</p> <pre><code>Device (APIC)\n{\n    Name (_HID, EisaId (\"PNP0003\") /* IO-APIC Interrupt Controller */)  // _HID: Hardware ID\n    Name (_CRS, ResourceTemplate ()  // _CRS: Current Resource Settings\n    {\n        Memory32Fixed (ReadOnly,\n            0xFEC00000,         // Address Base\n            0x00100000,         // Address Length\n            )\n    })\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 IO APIC \u57fa\u5730\u5740\u662f 0xFEC00000\uff0c\u5728\u7f51\u4e0a\u4e5f\u53ef\u4ee5\u67e5\u5230\u540c\u6837\u7684\u7ed3\u679c\u3002\u5b9e\u9645\u4e0a\uff0c\u5728 Multiple APIC Description Table (MADT) \u4e2d\u4e5f\u53ef\u4ee5\u627e\u5230 IO APIC \u7684\u57fa\u5730\u5740\uff1a</p> <pre><code>[1ECh 0492   1]                Subtable Type : 01 [I/O APIC]\n[1EDh 0493   1]                       Length : 0C\n[1EEh 0494   1]                  I/O Apic ID : 08\n[1EFh 0495   1]                     Reserved : 00\n[1F0h 0496   4]                      Address : FEC00000\n[1F4h 0500   4]                    Interrupt : 00000000\n\n[1F8h 0504   1]                Subtable Type : 01 [I/O APIC]\n[1F9h 0505   1]                       Length : 0C\n[1FAh 0506   1]                  I/O Apic ID : 09\n[1FBh 0507   1]                     Reserved : 00\n[1FCh 0508   4]                      Address : FEC01000\n[200h 0512   4]                    Interrupt : 00000018\n\n[204h 0516   1]                Subtable Type : 01 [I/O APIC]\n[205h 0517   1]                       Length : 0C\n[206h 0518   1]                  I/O Apic ID : 0A\n[207h 0519   1]                     Reserved : 00\n[208h 0520   4]                      Address : FEC08000\n[20Ch 0524   4]                    Interrupt : 00000020\n\n[210h 0528   1]                Subtable Type : 01 [I/O APIC]\n[211h 0529   1]                       Length : 0C\n[212h 0530   1]                  I/O Apic ID : 0B\n[213h 0531   1]                     Reserved : 00\n[214h 0532   4]                      Address : FEC10000\n[218h 0536   4]                    Interrupt : 00000028\n\n[21Ch 0540   1]                Subtable Type : 01 [I/O APIC]\n[21Dh 0541   1]                       Length : 0C\n[21Eh 0542   1]                  I/O Apic ID : 0C\n[21Fh 0543   1]                     Reserved : 00\n[220h 0544   4]                      Address : FEC18000\n[224h 0548   4]                    Interrupt : 00000030\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#dma","title":"DMA","text":"<p>\u7ee7\u7eed\u641c\u7d22 <code>_HID</code>\uff0c\u8fd8\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b\u4f20\u7edf\u7684\u8bbe\u5907\uff0c\u6bd4\u5982 DMA Controller\uff1a</p> <pre><code>// DMA Controller\nDevice (DMAC)\n{\n    Name (_HID, EisaId (\"PNP0200\") /* PC-class DMA Controller */)  // _HID: Hardware ID\n    Name (_CRS, ResourceTemplate ()  // _CRS: Current Resource Settings\n    {\n        IO (Decode16,\n            0x0000,             // Range Minimum\n            0x0000,             // Range Maximum\n            0x00,               // Alignment\n            0x10,               // Length\n            )\n        IO (Decode16,\n            0x0081,             // Range Minimum\n            0x0081,             // Range Maximum\n            0x00,               // Alignment\n            0x03,               // Length\n            )\n        IO (Decode16,\n            0x0087,             // Range Minimum\n            0x0087,             // Range Maximum\n            0x00,               // Alignment\n            0x01,               // Length\n            )\n        IO (Decode16,\n            0x0089,             // Range Minimum\n            0x0089,             // Range Maximum\n            0x00,               // Alignment\n            0x03,               // Length\n            )\n        IO (Decode16,\n            0x008F,             // Range Minimum\n            0x008F,             // Range Maximum\n            0x00,               // Alignment\n            0x01,               // Length\n            )\n        IO (Decode16,\n            0x00C0,             // Range Minimum\n            0x00C0,             // Range Maximum\n            0x00,               // Alignment\n            0x20,               // Length\n            )\n        DMA (Compatibility, NotBusMaster, Transfer8, )\n            {4}\n    })\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u5b9a\u4e49\u4e86\u5982\u4e0b\u7684 IO Port \u8303\u56f4\uff1a</p> <ul> <li><code>0x00-0x0F</code></li> <li>0x81, 0x87, 0x89, 0x8F</li> <li><code>0xC0-0xDE</code></li> </ul> <p>\u5bc4\u5b58\u5668\u5b9a\u4e49\u53ef\u4ee5\u5728 ISA DMA - OSDev \u5904\u627e\u5230\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#cmosrtc","title":"CMOS/RTC","text":"<p>\u7ecf\u5178\u7684 CMOS/RTC \u7684 IO \u7aef\u53e3\u5b9a\u4e49\u4e5f\u53ef\u4ee5\u627e\u5230\uff1a</p> <pre><code>Device (RTC)\n{\n    Name (_HID, EisaId (\"PNP0B00\") /* AT Real-Time Clock */)  // _HID: Hardware ID\n    Name (_CRS, ResourceTemplate ()  // _CRS: Current Resource Settings\n    {\n        IO (Decode16,\n            0x0070,             // Range Minimum\n            0x0070,             // Range Maximum\n            0x01,               // Alignment\n            0x02,               // Length\n            )\n        IO (Decode16,\n            0x0074,             // Range Minimum\n            0x0074,             // Range Maximum\n            0x01,               // Alignment\n            0x04,               // Length\n            )\n        IRQNoFlags ()\n            {8}\n    })\n    Method (_STA, 0, NotSerialized)  // _STA: Status\n    {\n        If ((STAS == 0x01))\n        {\n            Return (0x0F)\n        }\n        Else\n        {\n            Return (0x00)\n        }\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684 IO Port \u662f 0x70-0x71 \u548c 0x74-0x78\uff0c\u4e2d\u65ad\u53f7 8\uff0c\u548c CMOS - OSDev \u662f\u4e00\u81f4\u7684\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u542f\u52a8\u56fe\u7247","title":"\u542f\u52a8\u56fe\u7247","text":"<p>\u542f\u52a8\u56fe\u7247\u4ee5 BMP \u683c\u5f0f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u57fa\u5730\u5740\u8bb0\u5f55\u5728 BGRT \u8868\u4e2d\u3002\u53ef\u4ee5\u76f4\u63a5\u4ece <code>/sys/firmware/acpi/bgrt/image</code> \u83b7\u53d6\u542f\u52a8\u7684\u56fe\u7247\u5185\u5bb9\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#pcie","title":"PCIe","text":"","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#root-bridge","title":"Root Bridge","text":"<p>PCIe \u603b\u7ebf\u662f\u81ea\u5e26\u679a\u4e3e\u529f\u80fd\u7684\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u627e\u5230 Root Bridge\uff0c\u5176\u4ed6\u8bbe\u5907\u90fd\u53ef\u4ee5\u679a\u4e3e\u51fa\u6765\u3002\u800c ACPI \u5c31\u63d0\u4f9b\u4e86\u5bfb\u627e Root Bridge \u7684\u65b9\u6cd5\u3002</p> <p>\u641c\u7d22 <code>PNP0A08</code> \u53ef\u4ee5\u627e\u5230 PCIe \u603b\u7ebf\uff1a</p> <pre><code>// PCIe Bus 00\nDevice (PC00)\n{\n    Name (_HID, EisaId (\"PNP0A08\") /* PCI Express Bus */)  // _HID: Hardware ID\n    Name (_CID, EisaId (\"PNP0A03\") /* PCI Bus */)  // _CID: Compatible ID\n\n    Name (P0RS, ResourceTemplate ()\n    {\n        WordBusNumber (ResourceProducer, MinFixed, MaxFixed, PosDecode,\n            0x0000,             // Granularity\n            0x0000,             // Range Minimum\n            0x0015,             // Range Maximum\n            0x0000,             // Translation Offset\n            0x0016,             // Length\n            ,, )\n        IO (Decode16,\n            0x0CF8,             // Range Minimum\n            0x0CF8,             // Range Maximum\n            0x01,               // Alignment\n            0x08,               // Length\n            )\n        WordIO (ResourceProducer, MinFixed, MaxFixed, PosDecode, EntireRange,\n            0x0000,             // Granularity\n            0x0000,             // Range Minimum\n            0x0CF7,             // Range Maximum\n            0x0000,             // Translation Offset\n            0x0CF8,             // Length\n            ,, , TypeStatic, DenseTranslation)\n        WordIO (ResourceProducer, MinFixed, MaxFixed, PosDecode, EntireRange,\n            0x0000,             // Granularity\n            0x1000,             // Range Minimum\n            0x57FF,             // Range Maximum\n            0x0000,             // Translation Offset\n            0x4800,             // Length\n            ,, , TypeStatic, DenseTranslation)\n        DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n            0x00000000,         // Granularity\n            0x000A0000,         // Range Minimum\n            0x000BFFFF,         // Range Maximum\n            0x00000000,         // Translation Offset\n            0x00020000,         // Length\n            ,, , AddressRangeMemory, TypeStatic)\n        DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n            0x00000000,         // Granularity\n            0x00000000,         // Range Minimum\n            0x00000000,         // Range Maximum\n            0x00000000,         // Translation Offset\n            0x00000000,         // Length\n            ,, _Y00, AddressRangeMemory, TypeStatic)\n        DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, NonCacheable, ReadWrite,\n            0x00000000,         // Granularity\n            0xFE010000,         // Range Minimum\n            0xFE010FFF,         // Range Maximum\n            0x00000000,         // Translation Offset\n            0x00001000,         // Length\n            ,, , AddressRangeMemory, TypeStatic)\n        DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, NonCacheable, ReadWrite,\n            0x00000000,         // Granularity\n            0xFD000000,         // Range Minimum\n            0xFE7FFFFF,         // Range Maximum\n            0x00000000,         // Translation Offset\n            0x01800000,         // Length\n            ,, , AddressRangeMemory, TypeStatic)\n        DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, NonCacheable, ReadWrite,\n            0x00000000,         // Granularity\n            0x70000000,         // Range Minimum\n            0x92FFFFFF,         // Range Maximum\n            0x00000000,         // Translation Offset\n            0x23000000,         // Length\n            ,, , AddressRangeMemory, TypeStatic)\n        QWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, NonCacheable, ReadWrite,\n            0x0000000000000000, // Granularity\n            0x0000000000000000, // Range Minimum\n            0x0000000000000000, // Range Maximum\n            0x0000000000000000, // Translation Offset\n            0x0000000000000000, // Length\n            ,, , AddressRangeMemory, TypeStatic)\n    })\n\n    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n    {\n        EROM ()\n        Return (P0RS) /* \\_SB_.PC00.P0RS */\n    }\n}\n</code></pre> <p>\u4e0a\u9762\u7701\u7565\u6389\u4e86\u5f88\u591a\u5185\u5bb9\uff0c\u53ea\u4fdd\u7559\u4e86 Root Bridge \u7684\u8d44\u6e90 <code>_CRS</code>\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u548c Linux \u7684 dmesg \u662f\u4e00\u81f4\u7684\uff1a</p> <pre><code>ACPI: PCI Root Bridge [PC00] (domain 0000 [bus 00-15])\nacpi PNP0A08:00: _OSC: OS supports [ExtendedConfig ASPM ClockPM Segments MSI]\nacpi PNP0A08:00: _OSC: platform does not support [SHPCHotplug AER LTR]\nacpi PNP0A08:00: _OSC: OS now controls [PCIeHotplug PME PCIeCapability]\nacpi PNP0A08:00: host bridge window expanded to [mem 0xfd000000-0xfe7fffff window]; [mem 0xfd000000-0xfe7fffff window] ignored\nPCI host bridge to bus 0000:00\npci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]\npci_bus 0000:00: root bus resource [io  0x1000-0x57ff window]\npci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]\npci_bus 0000:00: root bus resource [mem 0x000c4000-0x000c7fff window]\npci_bus 0000:00: root bus resource [mem 0xfd000000-0xfe7fffff window]\npci_bus 0000:00: root bus resource [mem 0x70000000-0x92ffffff window]\npci_bus 0000:00: root bus resource [bus 00-15]\n</code></pre> <p>Linux \u76f8\u5173\u4ee3\u7801\u5728 <code>acpi_pci_root_create</code> \u51fd\u6570\u4e2d\uff1a</p> <pre><code>struct pci_bus *acpi_pci_root_create(struct acpi_pci_root *root,\n                     struct acpi_pci_root_ops *ops,\n                     struct acpi_pci_root_info *info,\n                     void *sysdata)\n{\n    // omitted\n    ret = acpi_pci_probe_root_resources(info);\n    // omitted\n    pci_acpi_root_add_resources(info);\n    pci_add_resource(&amp;info-&gt;resources, &amp;root-&gt;secondary);\n    bus = pci_create_root_bus(NULL, busnum, ops-&gt;pci_ops,\n                  sysdata, &amp;info-&gt;resources);\n}\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#mcfg","title":"MCFG","text":"<p>\u9664\u4e86\u4e0a\u9762\u7684 Root Bridge \u4ee5\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u95ee\u9898\u662f\uff0c\u5982\u4f55\u8bbf\u95ee PCIe \u7684 Configuration Space\u3002\u4f20\u7edf\u7684\u529e\u6cd5\u662f\u901a\u8fc7 IO Port 0xCF8 \u548c 0xCFC\uff0c\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u6162\uff0c\u5e76\u4e14\u6709\u5c40\u9650\u6027\u3002\u800c\u8f83\u65b0\u7684\u529e\u6cd5\u662f Enhanced Configuration Access Mechanism (ECAM)\uff0c\u628a PCIe \u8bbe\u5907\u7684 Configuration Space \u6620\u5c04\u5230\u5185\u5b58\u4e2d\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u4e2a\u57fa\u5730\u5740\u3002\u8fd9\u4e2a\u57fa\u5730\u5740\u662f\u5728 MCFG \u8868\u4e2d\u7ed9\u51fa\u7684\uff1a</p> <pre><code>[02Ch 0044   8]                 Base Address : 0000000060000000\n[034h 0052   2]         Segment Group Number : 0000\n[036h 0054   1]             Start Bus Number : 00\n[037h 0055   1]               End Bus Number : FF\n[038h 0056   4]                     Reserved : 00000000\n</code></pre> <p>\u5185\u6838\u8f93\u51fa\uff1a</p> <pre><code>PCI: MMCONFIG for domain 0000 [bus 00-ff] at [mem 0x60000000-0x6fffffff] (base 0x60000000)\nPCI: MMCONFIG at [mem 0x60000000-0x6fffffff] reserved in E820\n</code></pre> <p>\u6709\u4e86\u8fd9\u4e2a\u4fe1\u606f\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u8981\u8bbf\u95ee Configuration Space \u65f6 MMIO \u7684\u5730\u5740\u4e86\uff1a</p> <p></p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u76f8\u5173\u6587\u6863","title":"\u76f8\u5173\u6587\u6863","text":"<p>Linux \u7684\u6587\u6863 ACPI considerations for PCI host bridges \u5bf9 ACPI PCIe \u63cf\u8ff0\u7684\u6bd4\u8f83\u8be6\u7ec6\uff0c\u6458\u5f55\u5982\u4e0b\uff1a</p> <pre><code>The general rule is that the ACPI namespace should describe everything the\nOS might use unless there\u2019s another way for the OS to find it [1, 2].\n\nFor example, there\u2019s no standard hardware mechanism for enumerating PCI host\nbridges, so the ACPI namespace must describe each host bridge, the method\nfor accessing PCI config space below it, the address space windows the host\nbridge forwards to PCI (using _CRS), and the routing of legacy INTx\ninterrupts (using _PRT).\n\nPCI devices, which are below the host bridge, generally do not need to be\ndescribed via ACPI. The OS can discover them via the standard PCI\nenumeration mechanism, using config accesses to discover and identify\ndevices and read and size their BARs. However, ACPI may describe PCI devices\nif it provides power management or hotplug functionality for them or if the\ndevice has INTx interrupts connected by platform interrupt controllers and a\n_PRT is needed to describe those connections.\n</code></pre> <p>\u6587\u6863\u548c\u4e0a\u9762\u8bb2\u7684\u662f\u4e00\u81f4\u7684\uff0c\u5bf9\u4e8e PCIe \u81ea\u5df1\u53ef\u4ee5\u679a\u4e3e\u51fa\u6765\u7684\uff0cACPI \u5c31\u4e0d\u9700\u8981\u518d\u91cd\u590d\uff1b\u4f46\u662f\u679a\u4e3e\u9700\u8981\u9996\u5148\u77e5\u9053\u6709\u54ea\u4e9b Root Bridge \u4ee5\u53ca ECAM \u7684\u57fa\u5730\u5740\uff0c\u8fd9\u4e2a\u4fe1\u606f\u53ea\u80fd\u7531 ACPI \u6765\u63d0\u4f9b\u3002</p> <pre><code>The PCIe spec requires the Enhanced Configuration Access Method (ECAM)\nunless there\u2019s a standard firmware interface for config access, e.g., the\nia64 SAL interface [7]. A host bridge consumes ECAM memory address space and\nconverts memory accesses into PCI configuration accesses. The spec defines\nthe ECAM address space layout and functionality; only the base of the\naddress space is device-specific. An ACPI OS learns the base address from\neither the static MCFG table or a _CBA method in the PNP0A03 device.\n</code></pre> <p>\u8fd9\u4e00\u6bb5\u8bb2\u7684\u5176\u5b9e\u5c31\u662f ECAM \u4e0e MCFG \u7684\u5173\u7cfb\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#pcie-\u8bbe\u5907","title":"PCIe \u8bbe\u5907","text":"<p>\u867d\u7136\u6709\u4e86 Root Bridge \u4ee5\u540e\uff0cPCIe \u603b\u7ebf\u4e0b\u7684\u8bbe\u5907\u90fd\u53ef\u4ee5\u679a\u4e3e\u51fa\u6765\uff0c\u4f46\u662f ACPI \u8868\u4e2d\u4e5f\u53ef\u4ee5\u8bb0\u5f55 PCIe \u8bbe\u5907\uff0c\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u4fe1\u606f\uff0c\u4f8b\u5982 Power State \u7b49\u7b49\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u53ea\u9700\u8981\u5728 Root Bridge \u7684\u7ed3\u70b9\u4e0b\u7ee7\u7eed\u589e\u52a0 Device \u5c31\u53ef\u4ee5\u4e86\uff1a</p> <pre><code>Scope (_SB)\n{\n    Device (PC00)\n    {\n        // 00:00.0 DMI3 Registers\n        Device (DMI0)\n        {\n            Name (_ADR, 0x00)  // _ADR: Address\n        }\n\n        // 00:04.0 CBDMA Registers\n        Device (CB0A)\n        {\n            Name (_ADR, 0x00040000)  // _ADR: Address\n        }\n\n        Device (CB0B)\n        {\n            Name (_ADR, 0x00040001)  // _ADR: Address\n        }\n\n        // 00:05.0 MM/Vt-d Configuration Registers\n        Device (IIM0)\n        {\n            Name (_ADR, 0x00050000)  // _ADR: Address\n        }\n\n        // 00:08.0 Ubox Registers\n        Device (UBX0)\n        {\n            Name (_ADR, 0x00080000)  // _ADR: Address\n        }\n\n        Device (ALZA)\n        {\n            Name (_ADR, 0x000E0000)  // _ADR: Address\n        }\n\n        Device (DISP)\n        {\n            Name (_ADR, 0x000F0000)  // _ADR: Address\n        }\n\n        Device (IHC1)\n        {\n            Name (_ADR, 0x00100000)  // _ADR: Address\n        }\n\n        Device (IHC2)\n        {\n            Name (_ADR, 0x00100001)  // _ADR: Address\n        }\n\n        Device (IIDR)\n        {\n            Name (_ADR, 0x00100002)  // _ADR: Address\n        }\n\n        Device (IMKT)\n        {\n            Name (_ADR, 0x00100003)  // _ADR: Address\n        }\n\n        Device (IHC3)\n        {\n            Name (_ADR, 0x00100004)  // _ADR: Address\n        }\n\n        Device (MRO0)\n        {\n            Name (_ADR, 0x00110000)  // _ADR: Address\n        }\n\n        Device (MRO1)\n        {\n            Name (_ADR, 0x00110001)  // _ADR: Address\n        }\n\n        // 00:14.0 USB 3.0 xHCI Controller\n        Device (XHCI)\n        {\n            Name (_ADR, 0x00140000)  // _ADR: Address\n        }\n\n        Device (OTG0)\n        {\n            Name (_ADR, 0x00140001)  // _ADR: Address\n        }\n\n        // 00:14.2 PCH Thermal Subsystem\n        Device (TERM)\n        {\n            Name (_ADR, 0x00140002)  // _ADR: Address\n        }\n\n        Device (CAMR)\n        {\n            Name (_ADR, 0x00140003)  // _ADR: Address\n        }\n\n        Device (NTHP)\n        {\n            Name (_ADR, 0x00140004)  // _ADR: Address\n        }\n\n        // 00:16.0 PCH CSME HECI #1\n        Device (HEC1)\n        {\n            Name (_ADR, 0x00160000)  // _ADR: Address\n        }\n\n        Device (HEC2)\n        {\n            Name (_ADR, 0x00160001)  // _ADR: Address\n        }\n\n        Device (IDER)\n        {\n            Name (_ADR, 0x00160002)  // _ADR: Address\n        }\n\n        Device (MEKT)\n        {\n            Name (_ADR, 0x00160003)  // _ADR: Address\n        }\n\n        Device (HEC3)\n        {\n            Name (_ADR, 0x00160004)  // _ADR: Address\n        }\n\n        Device (NAN1)\n        {\n            Name (_ADR, 0x00180000)  // _ADR: Address\n        }\n    }\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>_ADR</code> \u7f16\u7801\u4e86\u8bbe\u5907\u7684 Device \u548c Function\uff0cACPI \u6807\u51c6 Table 6.2 \u5b9a\u4e49\uff1a\u9ad8 word \u8868\u793a Device\uff0c\u4f4e word \u8868\u793a Function\u3002\u6240\u4ee5\u4e0a\u9762\u7684 <code>DMI0</code> \u5c31\u662f <code>Device=0, Function=0</code>\uff0c<code>CB0A</code> \u5c31\u662f <code>Device=4, Function=0</code>\uff0c<code>CB0B</code> \u5c31\u662f <code>Device=4, Function=1</code>\u3002\u8fd9\u4e9b\u4e0e <code>lspci</code> \u7684\u8f93\u51fa\u57fa\u672c\u662f\u4e00\u81f4\u7684\uff0c\u6709\u4e00\u4e9b\u8bbe\u5907\u6ca1\u6709\u51fa\u73b0\uff0c\u53ef\u80fd\u548c\u5177\u4f53\u7684 CPU \u578b\u53f7\u6709\u5173\uff1a</p> <pre><code>00:00.0 Host bridge: Intel Corporation Sky Lake-E DMI3 Registers (rev 07)\n00:04.0 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.1 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.2 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.3 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.4 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.5 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.6 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:04.7 System peripheral: Intel Corporation Sky Lake-E CBDMA Registers (rev 07)\n00:05.0 System peripheral: Intel Corporation Sky Lake-E MM/Vt-d Configuration Registers (rev 07)\n00:05.2 System peripheral: Intel Corporation Sky Lake-E RAS (rev 07)\n00:05.4 PIC: Intel Corporation Sky Lake-E IOAPIC (rev 07)\n00:08.0 System peripheral: Intel Corporation Sky Lake-E Ubox Registers (rev 07)\n00:08.1 Performance counters: Intel Corporation Sky Lake-E Ubox Registers (rev 07)\n00:08.2 System peripheral: Intel Corporation Sky Lake-E Ubox Registers (rev 07)\n00:14.0 USB controller: Intel Corporation 200 Series/Z370 Chipset Family USB 3.0 xHCI Controller\n00:14.2 Signal processing controller: Intel Corporation 200 Series PCH Thermal Subsystem\n00:16.0 Communication controller: Intel Corporation 200 Series PCH CSME HECI #1\n00:17.0 SATA controller: Intel Corporation 200 Series PCH SATA controller [AHCI mode]\n</code></pre> <p>\u524d\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u4f20\u7edf\u7684\u8bbe\u5907\uff0c\u6bd4\u5982 DMA Controller\uff0cRTC \u7b49\uff0c\u5176\u5b9e\u5c31\u662f\u5728 PCIe \u4e0b\u7684 ISA bridge \u4e0b\u58f0\u660e\u7684\uff1a</p> <pre><code>Scope (_SB)\n{\n    Device (PC00)\n    {\n        // 00:1f.0 ISA bridge: Intel Corporation X299 Chipset LPC/eSPI Controller\n        Device (LPC0)\n        {\n            Name (_ADR, 0x001F0000)  // _ADR: Address\n\n            Device (DMAC)\n            {\n                Name (_HID, EisaId (\"PNP0200\") /* PC-class DMA Controller */)  // _HID: Hardware ID\n            }\n\n            Device (RTC)\n            {\n                Name (_HID, EisaId (\"PNP0B00\") /* AT Real-Time Clock */)  // _HID: Hardware ID\n            }\n\n            Device (PIC)\n            {\n                Name (_HID, EisaId (\"PNP0000\") /* 8259-compatible Programmable Interrupt Controller */)  // _HID: Hardware ID\n            }\n\n            Device (FPU)\n            {\n                Name (_HID, EisaId (\"PNP0C04\") /* x87-compatible Floating Point Processing Unit */)  // _HID: Hardware ID\n            }\n\n            Device (TMR)\n            {\n                Name (_HID, EisaId (\"PNP0100\") /* PC-class System Timer */)  // _HID: Hardware ID\n            }\n\n            Device (HPET)\n            {\n                Name (_HID, EisaId (\"PNP0103\") /* HPET System Timer */)  // _HID: Hardware ID\n            }\n\n            // omitted\n        }\n    }\n}\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u4fee\u6539-acpi-\u8868\u5185\u5bb9","title":"\u4fee\u6539 ACPI \u8868\u5185\u5bb9","text":"<p>\u60f3\u8981\u4fee\u6539 ACPI \u8868\u5185\u5bb9\uff0c\u6700\u6839\u672c\u7684\u529e\u6cd5\u662f\u4fee\u6539\u56fa\u4ef6\uff0c\u4f46\u662f\u4fee\u6539\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\u3002Linux \u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u6cd5\u6765\u8fd0\u884c\u65f6\u6253\u8865\u4e01\uff1a</p> <ul> <li>Upgrading ACPI tables via initrd\uff1a\u8986\u76d6 ACPI \u8868</li> <li>SSDT Overlays\uff1a\u6dfb\u52a0\u989d\u5916\u7684 SSDT \u8868\uff0c\u7c7b\u4f3c DT Overlay</li> </ul> <p>\u5728\u9ed1\u82f9\u679c\u4e2d\uff0c\u4e00\u822c\u5219\u662f\u5728 Bootloader(Clover/OpenCore) \u4e00\u6b65\u628a ACPI \u8868\u4fee\u6539\u4e86\uff0c\u5982 How to Patch Laptop DSDT and SSDTs\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#acpi-\u786c\u4ef6\u89c4\u8303","title":"ACPI \u786c\u4ef6\u89c4\u8303","text":"<p>\u9664\u4e86\u7528\u6765\u63cf\u8ff0\u7cfb\u7edf\u4e2d\u5df2\u6709\u7684\u8bbe\u5907\uff0cACPI \u8fd8\u5bf9\u786c\u4ef6\u505a\u51fa\u4e86\u4e00\u4e9b\u8981\u6c42\uff0c\u5728\u6807\u51c6\u7684 Chapter 4 ACPI Hardware Specification \u4e2d\u5b9a\u4e49\u3002\u4f8b\u5982\uff0c\u7535\u6e90\u6309\u94ae\u662f\u5982\u4f55\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u7684\uff1f\u64cd\u4f5c\u7cfb\u7edf\u7684\u91cd\u542f\u548c\u5173\u673a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u7535\u6e90\u6309\u94ae","title":"\u7535\u6e90\u6309\u94ae","text":"<p>\u9996\u5148\u6765\u770b\u7535\u6e90\u6309\u94ae\uff08Power Button\uff09\u3002\u5728 ACPI \u4e2d\uff0c\u5b9a\u4e49\u4e86\u4e24\u79cd Power Button \u7684\u5b9e\u73b0\u65b9\u6cd5\uff0c\u7b2c\u4e00\u79cd\u5c31\u662f\u6bd4\u8f83\u7ecf\u5178\u7684\u786c\u4ef6\u6309\u94ae + \u4e2d\u65ad\u7684\u6a21\u5f0f\uff0c\u5f53\u6309\u4e0b\u6309\u94ae\u7684\u65f6\u5019\uff0c\u4e2d\u65ad\u72b6\u6001\uff08<code>PWRBTN_STS</code>\uff09\u62c9\u9ad8\uff0c\u5982\u679c\u6b64\u65f6\u4e2d\u65ad\u4f7f\u80fd\uff08<code>PWRBTN_EN</code>\uff09\u4e5f\u4e3a\u9ad8\uff0c\u5c31\u89e6\u53d1\u4e2d\u65ad\u3002\u8fd9\u65f6\u5019\u64cd\u4f5c\u7cfb\u7edf\u5c31\u77e5\u9053\u7535\u6e90\u952e\u88ab\u6309\u4e0b\u4e86\uff0c\u5f00\u59cb\u8fdb\u884c\u5173\u673a\u64cd\u4f5c\u3002</p> <p>\u7b2c\u4e8c\u79cd\u5b9e\u73b0\u65b9\u6cd5\u5219\u5229\u7528\u4e86 ACPI \u7684\u53ef\u7f16\u7a0b\u6027\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5f53\u6309\u4e0b\u7535\u6e90\u952e\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6536\u5230\u4e00\u4e2a SCI\uff08System Control Interrupt\uff09\uff0c\u6b64\u65f6\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u4e2d\u65ad\u7f16\u53f7\uff0c\u53bb\u6267\u884c ACPI \u4e2d\u7684\u51fd\u6570\uff0c\u51fd\u6570\u53bb\u8bfb\u53d6\u5f53\u524d\u7684\u7535\u6e90\u952e\u72b6\u6001\uff0c\u7136\u540e\u8c03\u7528 <code>Notify</code> \u51fd\u6570\u6765\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7535\u6e90\u952e\u88ab\u6309\u4e0b\u4e86\u3002</p> <p>\u5728\u4f7f\u7528\u865a\u62df\u673a\u7684\u65f6\u5019\uff0c\u4f1a\u77e5\u9053 ACPI Shutdown \u7684\u8bf4\u6cd5\uff0c\u5176\u5b9e\u5c31\u662f\u6a21\u62df\u4e86\u6309\u4e0b\u7535\u6e90\u952e\u7684\u884c\u4e3a\u3002QEMU \u7684\u76f8\u5173\u4ee3\u7801\uff1a</p> <pre><code>void acpi_pm1_evt_power_down(ACPIREGS *ar)\n{\n    if (ar-&gt;pm1.evt.en &amp; ACPI_BITMASK_POWER_BUTTON_ENABLE) {\n        ar-&gt;pm1.evt.sts |= ACPI_BITMASK_POWER_BUTTON_STATUS;\n        ar-&gt;tmr.update_sci(ar);\n    }\n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u6a21\u62df\u4e86\u7535\u6e90\u6309\u94ae\uff0c\u5982\u679c <code>PWRBTN_EN=1</code>\uff0c\u5c31\u8bbe\u7f6e <code>PWRBTN_STS=1</code> \u5e76\u53d1\u9001 SCI \u4e2d\u65ad\u3002</p> <p>\u90a3\u4e48\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u8bbf\u95ee <code>PWRBTN_EN</code> \u548c <code>PWRBTN_STS</code> \u5462\uff1f\u5728 FADP(Fixed ACPI Descrption Table) \u8868\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230 PM1A/B Event Block Address \u548c PM1A/B Control Block Address\uff1a</p> <pre><code>[038h 0056   4]     PM1A Event Block Address : 0000B000\n[03Ch 0060   4]     PM1B Event Block Address : 00000000\n[040h 0064   4]   PM1A Control Block Address : 0000B004\n[044h 0068   4]   PM1B Control Block Address : 00000000\n\n[058h 0088   1]       PM1 Event Block Length : 04\n[059h 0089   1]     PM1 Control Block Length : 02\n</code></pre> <p>\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7 IO Port \u6765\u8bbf\u95ee\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e86\u3002<code>PWNBTN_STS</code> \u5c5e\u4e8e PM1 Status Registers\uff0c\u5730\u5740\u662f <code>PM1A/B Event Block Address=0xB000</code>\uff1b<code>PWNBTN_EN</code> \u5c5e\u4e8e PM1 Enable Registers\uff0c\u5730\u5740\u662f <code>PM1A/B Event Block Register + PM1 Event Block Length / 2=0xB002</code>\u3002</p> <p>\u8fd9\u91cc\u7684 PM1A/B \u662f Register Grouping\uff0c\u4f7f\u5f97\u786c\u4ef6\u4e0a\u53ef\u4ee5\u628a\u5bc4\u5b58\u5668\u5b9e\u73b0\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u82af\u7247\u4e0a\uff0c\u5206\u522b\u5b9e\u73b0\u4e00\u90e8\u5206\u529f\u80fd\u3002\u64cd\u4f5c\u7cfb\u7edf\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u8981\u8bfb\u53d6 A \u548c B \u7136\u540e OR \u8d77\u6765\uff0c\u5199\u5165\u7684\u65f6\u5019\u5219\u662f A \u548c B \u90fd\u8981\u5199\u3002\u50cf\u4e0a\u9762\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u53ea\u6709 A \u6ca1\u6709 B\uff0c\u90a3\u5c31\u76f4\u63a5\u8bfb\u5199 A \u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#\u5173\u673a","title":"\u5173\u673a","text":"<p>\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c OS \u60f3\u8981\u5173\u673a\uff0c\u90a3\u8981\u600e\u4e48\u544a\u8bc9\u786c\u4ef6\u5462\uff1f\u8fd8\u662f\u901a\u8fc7 ACPI\u3002\u5728 PM1 Control Registers \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5199\u5165 <code>SLP_TYPx</code> \u548c <code>SLP_EN</code> \u5b57\u6bb5\u6765\u8fdb\u884c\u4f11\u7720\u6216\u8005\u5173\u673a\u64cd\u4f5c\u3002</p> <p>\u4e0b\u9762\u662f QEMU \u9488\u5bf9 <code>SLP_EN</code> \u5199\u5165\u7684\u5904\u7406\u4ee3\u7801\uff1a</p> <pre><code>/* ACPI PM1aCNT */\nstatic void acpi_pm1_cnt_write(ACPIREGS *ar, uint16_t val)\n{\n    ar-&gt;pm1.cnt.cnt = val &amp; ~(ACPI_BITMASK_SLEEP_ENABLE);\n\n    if (val &amp; ACPI_BITMASK_SLEEP_ENABLE) {\n        /* change suspend type */\n        uint16_t sus_typ = (val &gt;&gt; 10) &amp; 7;\n        switch (sus_typ) {\n        case 0: /* soft power off */\n            qemu_system_shutdown_request(SHUTDOWN_CAUSE_GUEST_SHUTDOWN);\n            break;\n        case 1:\n            qemu_system_suspend_request();\n            break;\n        default:\n            if (sus_typ == ar-&gt;pm1.cnt.s4_val) { /* S4 request */\n                qapi_event_send_suspend_disk();\n                qemu_system_shutdown_request(SHUTDOWN_CAUSE_GUEST_SHUTDOWN);\n            }\n            break;\n        }\n    }\n}\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#pm-timer","title":"PM Timer","text":"<p>ACPI \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a 3.579545 MHz \u7684\u65f6\u949f PM_TMR\u3002QEMU \u76f8\u5173\u4ee3\u7801\uff1a</p> <pre><code>/* PM Timer ticks per second (HZ) */\n#define PM_TIMER_FREQUENCY  3579545\n\nstatic inline int64_t acpi_pm_tmr_get_clock(void)\n{\n    return muldiv64(qemu_clock_get_ns(QEMU_CLOCK_VIRTUAL), PM_TIMER_FREQUENCY,\n                    NANOSECONDS_PER_SECOND);\n}\n</code></pre> <p>Linux \u4e5f\u53ef\u4ee5\u628a\u5b83\u5f53\u6210\u4e00\u4e2a\u65f6\u949f\u6e90\uff1a</p> <pre><code>clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns\n</code></pre> <p>\u76f8\u5173\u4ee3\u7801\uff1a</p> <pre><code>/*\n * The I/O port the PMTMR resides at.\n * The location is detected during setup_arch(),\n * in arch/i386/kernel/acpi/boot.c\n */\nu32 pmtmr_ioport __read_mostly;\n\nstatic inline u32 read_pmtmr(void)\n{\n    /* mask the output to 24 bits */\n    return inl(pmtmr_ioport) &amp; ACPI_PM_MASK;\n}\n\nstatic u64 acpi_pm_read(struct clocksource *cs)\n{\n    return (u64)read_pmtmr();\n}\n\nstatic struct clocksource clocksource_acpi_pm = {\n    .name       = \"acpi_pm\",\n    .rating     = 200,\n    .read       = acpi_pm_read,\n    .mask       = (u64)ACPI_PM_MASK,\n    .flags      = CLOCK_SOURCE_IS_CONTINUOUS,\n};\n\n/* Number of PMTMR ticks expected during calibration run */\n#define PMTMR_TICKS_PER_SEC 3579545\n\nstatic int __init init_acpi_pm_clocksource(void)\n{\n    // omitted\n    return clocksource_register_hz(&amp;clocksource_acpi_pm,\n                        PMTMR_TICKS_PER_SEC);\n}\n</code></pre>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#gpe","title":"GPE","text":"<p>\u9664\u4e86\u4e0a\u9762 PM1 \u4e2d\u63d0\u5230\u7684\u4e00\u4e9b\u4e2d\u65ad\u6765\u6e90\uff0cACPI \u8fd8\u63d0\u4f9b\u4e86\u901a\u7528\u7684 General Purpose Event\uff0c\u786c\u4ef6\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e9b\u4e2d\u65ad\u7f16\u53f7\uff0c\u4f9d\u7136\u662f\u901a\u8fc7 SCI \u4e2d\u65ad\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e GPE \u7684 STS \u5bc4\u5b58\u5668\u6765\u5224\u65ad\u54ea\u4e2a GPE \u89e6\u53d1\u4e86\u4e2d\u65ad\uff0c\u7136\u540e\u6267\u884c\u5bf9\u5e94\u7684 ACPI \u51fd\u6570\u3002GPE \u7684\u5730\u5740\u4e5f\u662f\u5728 FADT \u4e2d\u63d0\u4f9b\uff1a</p> <pre><code>[050h 0080   4]           GPE0 Block Address : 0000AFE0\n\n[05Ch 0092   1]            GPE0 Block Length : 04\n</code></pre> <p>\u5728 DSDT \u7684 <code>\\_GPE</code> \u4e0b\u9762\uff0c\u53ef\u4ee5\u5b9a\u4e49\u51fd\u6570\uff0c\u5728 GPE \u5230\u8fbe\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6267\u884c\u3002\u683c\u5f0f\u662f <code>\\_GPE._Exx</code> \u6216 <code>\\_GPE._Lxx</code>\uff0cE \u8868\u793a Edge sensitive\uff0cL \u8868\u793a Level sensitive\u3002\u4f8b\u5982\u64cd\u4f5c\u7cfb\u7edf\u5224\u65ad\u6536\u5230\u4e86 GPE 4\uff0c\u90a3\u53ef\u80fd\u4f1a\u6267\u884c <code>\\_GPE._L04</code> \u6216 <code>\\_GPE._E04</code> \u51fd\u6570\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#pcie-hot-plug","title":"PCIe Hot Plug","text":"<p>\u5728 QEMU \u4e2d\uff0c\u5982\u679c\u865a\u62df\u673a\u8981\u8fdb\u884c PCIe Hot Plug \u7684\u65f6\u5019\uff0c\u4f8b\u5982\u8981\u589e\u52a0 PCIe \u8bbe\u5907\uff0c\u6216\u8005\u5220\u9664\u5df2\u6709\u7684 PCIe \u8bbe\u5907\uff0c\u9700\u8981\u8bbe\u6cd5\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u544a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u54ea\u4e2a\u5730\u65b9\u6709\u65b0\u7684\u8bbe\u5907\uff0c\u6216\u8005\u54ea\u4e2a\u5df2\u6709\u7684\u8bbe\u5907\u88ab\u5f39\u51fa\u3002QEMU \u7684\u5b9e\u73b0\u6587\u6863\u662fQEMU&lt;-&gt;ACPI BIOS PCI hotplug interface\uff0c\u8fd9\u91cc\u7ed3\u5408\u4ee3\u7801\u6765\u89e3\u91ca\u4e00\u4e0b\u3002</p> <p>\u5728 QEMU \u4e2d\uff0c\u8981\u63d2\u5165\u4e00\u4e2a\u65b0\u7684 PCIe \u8bbe\u5907\u7684\u65f6\u5019\uff0c\u6309\u7167\u8bbe\u5907\u7684 bus \u548c slot \u8bbe\u7f6e\u4f4d\u4e3a 1\uff0c\u5e76\u4e14\u53d1\u9001 GPE\uff1a</p> <pre><code>void acpi_pcihp_device_plug_cb(HotplugHandler *hotplug_dev, AcpiPciHpState *s,\n                               DeviceState *dev, Error **errp)\n{\n    // omitted\n\n    bsel = acpi_pcihp_get_bsel(bus);\n    g_assert(bsel &gt;= 0);\n    s-&gt;acpi_pcihp_pci_status[bsel].up |= (1U &lt;&lt; slot);\n    acpi_send_event(DEVICE(hotplug_dev), ACPI_PCI_HOTPLUG_STATUS);\n}\n\n// acpi_send_event eventually calls piix4_send_gpe\nstatic void piix4_send_gpe(AcpiDeviceIf *adev, AcpiEventStatusBits ev)\n{\n    PIIX4PMState *s = PIIX4_PM(adev);\n\n    acpi_send_gpe_event(&amp;s-&gt;ar, s-&gt;irq, ev);\n}\n\nvoid acpi_send_gpe_event(ACPIREGS *ar, qemu_irq irq,\n                         AcpiEventStatusBits status)\n{\n    ar-&gt;gpe.sts[0] |= status;\n    acpi_update_sci(ar, irq);\n}\n</code></pre> <p>\u67e5\u770b\u5934\u6587\u4ef6\uff0c\u53ef\u77e5 <code>ACPI_PCI_HOTPLUG_STATUS=2</code>\uff0c\u6839\u636e\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u53ef\u77e5\u8fd9\u5b9e\u9645\u4e0a\u5c31\u662f\u53d1\u9001\u4e86 GPE1\u3002\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6267\u884c <code>\\_GPE._E01</code> \u51fd\u6570\uff1a</p> <pre><code>Scope (_GPE)\n{\n    Name (_HID, \"ACPI0006\" /* GPE Block Device */)  // _HID: Hardware ID\n    Method (_E01, 0, NotSerialized)  // _Exx: Edge-Triggered GPE, xx=0x00-0xFF\n    {\n        Acquire (\\_SB.PCI0.BLCK, 0xFFFF)\n        \\_SB.PCI0.PCNT () // PCIe Notify\n        Release (\\_SB.PCI0.BLCK)\n    }\n}\n</code></pre> <p>\u8fd9\u4e2a\u4ee3\u7801\u4e0a\u4e86\u9501\uff0c\u7136\u540e\u8c03\u7528 <code>\\_SB.PCI0.PCNT</code> \u51fd\u6570\uff0c<code>PCNT</code> \u51fd\u6570\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>// PCIe Status\nOperationRegion (PCST, SystemIO, 0xAE00, 0x08)\nField (PCST, DWordAcc, NoLock, WriteAsZeros)\n{\n    PCIU,   32, // Up\n    PCID,   32  // Down\n}\n\n// PCIe Notify\nMethod (PCNT, 0, NotSerialized)\n{\n    BNUM = Zero // Bus Num = 0\n    DVNT (PCIU, One) // Device Notify\n    DVNT (PCID, 0x03) // Device Notify\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0cPCIU \u7684\u610f\u601d\u662f PCIe Up\uff0c\u5c31\u662f\u65b0\u51fa\u73b0\u7684\u8bbe\u5907\uff1bPCID \u7684\u610f\u601d\u662f PCIe Down\uff0c\u5c31\u662f\u8981\u5220\u9664\u7684\u8bbe\u5907\u3002PCIU \u548c PCID \u90fd\u8981\u901a\u8fc7 IO Port \u8bbf\u95ee\uff0c\u6839\u636e\u4e0a\u9762\u7684 <code>OperationRegion</code> \u53ef\u77e5 <code>PCIU=0xAE00</code>\uff0c<code>PCID=0xAE04</code>\u3002\u4f60\u53ef\u80fd\u5df2\u7ecf\u731c\u5230\u4e86 <code>PCIU</code> \u548c <code>PCID</code> \u7684\u5b9e\u73b0\uff1a\u5f53 CPU \u8bfb\u53d6\u8fd9\u4e24\u4e2a IO Port \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fd4\u56de\u524d\u9762 <code>acpi_pcihp_device_plug_cb</code> \u51fd\u6570\u5199\u5165\u7684 <code>acpi_pcihp_pci_status</code> \u6570\u7ec4\uff1a</p> <pre><code>static uint64_t pci_read(void *opaque, hwaddr addr, unsigned int size)\n{\n    // omitted\n    switch (addr) {\n    case PCI_UP_BASE:\n        val = s-&gt;acpi_pcihp_pci_status[bsel].up;\n        if (!s-&gt;legacy_piix) {\n            s-&gt;acpi_pcihp_pci_status[bsel].up = 0;\n        }\n        trace_acpi_pci_up_read(val);\n        break;\n    case PCI_DOWN_BASE:\n        val = s-&gt;acpi_pcihp_pci_status[bsel].down;\n        trace_acpi_pci_down_read(val);\n        break;\n    }\n    // omitted\n}\n</code></pre> <p>\u56e0\u6b64\u5728 <code>PCNT</code> \u51fd\u6570\u4e2d\uff0c\u8bfb\u53d6 <code>PCIU</code> \u548c <code>PCID</code> \u5c31\u53ef\u4ee5\u77e5\u9053\u4e00\u4e2a Bitmap\uff0c\u8bb0\u5f55\u4e86\u54ea\u4e9b\u8bbe\u5907\u51fa\u73b0\u4e86\u53d8\u5316\u3002\u6700\u540e\u4e00\u6b65\u5c31\u662f\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u4e86\u3002\u5728 ACPI \u4e2d\uff0c\u53ef\u4ee5\u8c03\u7528 <code>Notify</code> \u51fd\u6570\uff0c\u7528\u4e8e\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\uff0c\u901a\u77e5\u7684\u53c2\u6570\u89c1 Table 5.187\uff0c\u8fd9\u91cc\u5217\u51fa\u6765\u524d\u9762\u51e0\u79cd\uff1a</p> <ul> <li>0: Bus Check, This notification is performed on a device object to indicate to OSPM that it needs to perform a Plug and Play re-enumeration operation on the device tree starting from the point where it has been notified</li> <li>1: Device Check, Used to notify OSPM that the device either appeared or disappeared. If the device has appeared, OSPM will re-enumerate from the parent.</li> <li>2: Device Wake, Used to notify OSPM that the device has signaled its wake event, and that OSPM needs to notify OSPM native device driver for the device.</li> <li>3: Eject Request, Used to notify OSPM that the device should be ejected, and that OSPM needs to perform the Plug and Play ejection operation.</li> </ul> <p><code>PCNT</code> \u51fd\u6570\u8c03\u7528 <code>DVNT</code> \u51fd\u6570\u6765\u8fdb\u884c\u6700\u7ec8\u7684 <code>Notify</code>\uff0c\u5bf9\u4e8e PCI Up\uff0c\u9700\u8981\u53d1\u9001 1(Device Check) \u8ba9\u64cd\u4f5c\u7cfb\u7edf\u65b0\u7684\u8bbe\u5907\u51fa\u73b0\uff1b\u5bf9\u4e8e PCI Down\uff0c\u9700\u8981\u53d1\u9001 3(Eject Request) \u8ba9\u64cd\u4f5c\u7cfb\u7edf\u5f39\u51fa\u8bbe\u5907\u3002\u8fd9\u5c31\u89e3\u91ca\u4e86 <code>PCNT</code> \u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u5b9e\u73b0\uff1a</p> <pre><code>// PCIe Notify\nMethod (PCNT, 0, NotSerialized)\n{\n    BNUM = Zero // Bus Num = 0\n    DVNT (PCIU, One) // Device Notify(1=Device Check)\n    DVNT (PCID, 0x03) // Device Notify(3=Eject Request)\n}\n</code></pre> <p><code>DVNT</code> \u7684\u5b9e\u73b0\u65b9\u6cd5\u5f88\u7c97\u66b4\uff0c\u5c31\u662f\u68c0\u67e5\u5404\u4e2a\u4f4d\uff0c\u7136\u540e\u53d1\u9001 <code>Notify</code> \u5230\u76f8\u5e94\u7684 PCIe Slot \u4e0a\uff1a</p> <pre><code>// Device Notify\nMethod (DVNT, 2, NotSerialized)\n{\n    If ((Arg0 &amp; 0x08))\n    {\n        Notify (S18, Arg1)\n    }\n\n    If ((Arg0 &amp; 0x10))\n    {\n        Notify (S20, Arg1)\n    }\n\n    If ((Arg0 &amp; 0x20))\n    {\n        Notify (S28, Arg1)\n    }\n    // omitted\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u6574\u4e2a PCIe Hot Plug \u7684\u8fc7\u7a0b\u3002\u56de\u987e\u4e00\u4e0b\uff1a</p> <ul> <li>QEMU \u8981\u8fdb\u884c PCIe Hot Plug</li> <li>QEMU \u8bb0\u5f55\u8981 Hot Plug \u8bbe\u5907\u5230\u6570\u7ec4\u4e2d</li> <li>QEMU \u53d1\u9001 GPE</li> <li>OS \u6267\u884c GPE 1 Handler</li> <li>Handler \u8bfb\u53d6 PCIU/PCID\uff0c\u6839\u636e Bitmap \u53bb Notify</li> <li>OS \u6839\u636e Notify \u7684\u8bbe\u5907\u8fdb\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5927\u90e8\u5206\u7684\u5de5\u4f5c\u5176\u5b9e\u662f QEMU \u5b8c\u6210\u7684\uff0cOS \u53ea\u9700\u8981\u5728\u6536\u5230 SCI \u7684\u65f6\u5019\uff0c\u5224\u65ad\u662f GPE 1 \u4e8b\u4ef6\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570\uff0c\u7b49\u5f85 Notify \u7684\u5230\u6765\u3002</p>","tags":["acpi","notes","learn"]},{"location":"hardware/2022/12/10/acpi-notes/#power-state","title":"Power State","text":"<p>ACPI \u5b9a\u4e49\u7684 Power State\uff1a</p> <p></p> <ul> <li>G0-G3: \u5168\u5c40\u72b6\u6001\uff0cG0 \u8868\u793a\u6b63\u5728\u5de5\u4f5c</li> <li>S0-S5\uff1a\u7761\u7720\u72b6\u6001\uff0cS0 \u8868\u793a\u6b63\u5728\u5de5\u4f5c\uff0cS5 \u8868\u793a\u5173\u673a</li> <li>D0-D3\uff1a\u8bbe\u5907\u72b6\u6001</li> <li>C0-Cn\uff1aCPU \u72b6\u6001</li> </ul>","tags":["acpi","notes","learn"]},{"location":"hardware/2023/01/09/amd-cpu/","title":"AMD \u5904\u7406\u5668","text":"","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-\u7cfb\u5217","title":"Ryzen \u7cfb\u5217","text":"<p>\u6ce8\uff1a\u4e0b\u8868\u4e2d\u7701\u7565\u4e86 PRO \u524d\u7f00\uff0c\u90e8\u5206\u578b\u53f7\u6709\u5e26 PRO \u548c\u4e0d\u5e26 PRO \u7684\u7248\u672c\uff0c\u90e8\u5206\u578b\u53f7\u4ec5\u6709\u5e26 PRO \u7684\u7248\u672c\uff0c\u90e8\u5206\u578b\u53f7\u6ca1\u6709\u5e26 PRO \u7684\u7248\u672c\u3002</p>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-5000","title":"Ryzen 5000","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Vermeer \u684c\u9762 \u65e0 AM4 Zen 3 5950X/5945/5900(X)/5845/5800(X(3D))/5700(X(3D))/5645/5600(X(3D)) Chagall \u5de5\u4f5c\u7ad9 \u65e0 sWRX8 Zen 3 5995WX/5975WX/5965WX/5955WX/5945WX Cezanne \u684c\u9762 GCN5 AM4 Zen 3 5750G(E)/5700G(E)/5650G(E)/5600G(E)/5600GT/5500(GT)/5350G(E)/5300G(E) Cezanne \u7b14\u8bb0\u672c GCN5 FP6 Zen 3 5980HX/5980HS/5900HX/5900HS/5800H(S)/5800U/5600H(S)/5600U/5560U/5400U Barcel\u00f3 \u7b14\u8bb0\u672c GCN5 FP6 Zen 3 5825U/5825C/5625U/5625C/5425U/5425C/5125C Lucienne \u7b14\u8bb0\u672c GCN5 FP6 Zen 2 5700U/5500U/5300U <p>\u6ce8\uff1aRyzen 5 5500 \u867d\u7136\u4ee3\u53f7\u662f Cezanne\uff0c\u4f46\u662f\u53bb\u6389\u4e86\u6838\u663e\u3002</p> <p>Vermeer:</p> <ul> <li>5600</li> <li>5600X</li> <li>5600X3D</li> <li>PRO 5645</li> <li>5700X</li> <li>5800</li> <li>5800X</li> <li>5800X3D</li> <li>PRO 5845</li> <li>5900X</li> <li>5900</li> <li>PRO 5945</li> <li>5950X</li> </ul> <p>Chagall:</p> <ul> <li>PRO 5945WX</li> <li>PRO 5955WX</li> <li>PRO 5965WX</li> <li>PRO 5975WX</li> <li>PRO 5995WX</li> </ul> <p>Cezanne \u684c\u9762\uff1a</p> <ul> <li>5300G</li> <li>5300GE</li> <li>PRO 5350G</li> <li>PRO 5350GE</li> <li>5500</li> <li>5600G</li> <li>5600GE</li> <li>PRO 5650G</li> <li>PRO 5650GE</li> <li>5700G</li> <li>5700GE</li> <li>PRO 5750G</li> <li>PRO 5750GE</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-6000","title":"Ryzen 6000","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Rembrandt \u7b14\u8bb0\u672c RDNA2 FP7 Zen 3+ 6980HX/6980HS/6900HX/6900HS/6800H(S)/6800U/6600H(S)/6600U","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-7000","title":"Ryzen 7000","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Storm Peak \u5de5\u4f5c\u7ad9 \u65e0 sTR5 Zen 4 7995WX/7985WX/7980X/7975WX/7970X/7965WX/7060X/7955WX/7945WX Raphael \u684c\u9762 RDNA2 AM5 Zen 4 7950X(3D)/7945/7900(X(3D))/7800X3D/7745/7700(X)/7645/7600(X)/7500F Dragon Range \u7b14\u8bb0\u672c RDNA2 FL1 Zen 4 7945HX(3D)/7845HX/7745HX/7645HX Phoenix \u7b14\u8bb0\u672c RDNA3 FP7/FP7r2/FP8 Zen 4 7940H(S)/7840H(S)/7840U/7640H(S)/7640U/7540U Phoenix \u7b14\u8bb0\u672c RDNA3 FP7/FP7r2 Zen 4 + Zen4 c 7545U/7440U Rembrandt R \u7b14\u8bb0\u672c RDNA2 FP7/FP7r2 Zen 3+ 7735H(S)/7736U/7735U/7535HS/7535U/7335U Barcelo R \u7b14\u8bb0\u672c GCN5 FP6 Zen 3 7730U/7530U/7330U Mendocino \u7b14\u8bb0\u672c RDNA2 FT6 Zen 2 7520U//7520C/7320U/7320C <p>AMD \u7b14\u8bb0\u672c\u5904\u7406\u5668\u4ea7\u54c1\u4ece 2023 \u5e74\u5230 2025 \u5e74\u91c7\u7528\u65b0\u7684\u547d\u540d\u65b9\u5f0f\uff1a</p> <ul> <li>\u6570\u5b57\u7b2c\u4e00\u4f4d\uff1a7 \u5bf9\u5e94 2023\uff0c8 \u5bf9\u5e94 2024\uff0c9 \u5bf9\u5e94 2025\uff0c\u7ea6\u7b49\u4e8e Intel \u7684\u4ee3\u6b21</li> <li>\u6570\u5b57\u7b2c\u4e8c\u4f4d\uff1a1 \u5bf9\u5e94 Athlon Silver\uff0c2 \u5bf9\u5e94 Athlon Gold\uff0c3-4 \u5bf9\u5e94 Ryzen 3\uff0c5-6 \u5bf9\u5e94 Ryzen 5\uff0c7-8 \u5bf9\u5e94 Ryzen 7\uff0c8-9 \u5bf9\u5e94 Ryzen 9\uff0c\u7c7b\u4f3c Intel \u7684 i3/i5/i7/i9</li> <li>\u6570\u5b57\u7b2c\u4e09\u4f4d\uff1a1 \u5bf9\u5e94 Zen/Zen+\uff0c2 \u5bf9\u5e94 Zen 2\uff0c\u4f9d\u6b21\u7c7b\u63a8</li> <li>\u6570\u5b57\u7b2c\u56db\u4f4d\uff1a0 \u8868\u793a\u4f4e\u7aef\uff0c5 \u8868\u793a\u9ad8\u7aef</li> <li>\u540e\u7f00\uff1a\u6027\u80fd\u4ece\u9ad8\u5230\u4f4e HX\uff0cHS\uff0cU/C</li> </ul> <p>\u56e0\u6b64\u4ee3\u53f7\u548c\u7f16\u53f7\u6709\u76f4\u63a5\u7684\u5bf9\u5e94\u5173\u7cfb\uff1a</p> <ul> <li>Dragon Range: 7045, Extreme Gaming and Creator</li> <li>Phoenix: 7040, Elite Ultrathin</li> <li>Rembrandt R: 7035, Premium Thin &amp; Light</li> <li>Bracelo R: 7030, Mainstream Thin &amp; Light</li> <li>Mendocino: 7020, Everyday Computing</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-8000","title":"Ryzen 8000","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Hawk Point \u7b14\u8bb0\u672c RDNA3 FP7/FP7r2/FP8 Zen 4 8945HS/8945H/8845HS/8840HS/8840U/8645HS/8640HS/8640U/8540U/8440U Phoenix \u684c\u9762 RDNA3 AM5 Zen 4 8700G/8700GE/8600G/8600GE/8500G/8500GE/8300G/8300GE Phoenix \u684c\u9762 \u65e0 AM5 Zen 4 8700F/8400F","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ryzen-9000","title":"Ryzen 9000","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Granite Ridge \u684c\u9762 RDNA2 AM5 Zen 5 9950X/9900X/9700X/9600X","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#ai","title":"AI","text":"\u4ee3\u53f7 \u7528\u9014 \u6838\u663e \u63d2\u69fd \u5fae\u67b6\u6784 \u578b\u53f7 Strix Point \u7b14\u8bb0\u672c\uff0c\u684c\u9762 RDNA3.5 FP8 Zen 5 HX375/HX370/365","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#z1","title":"Z1","text":"<p>Ryzen Z1 \u7cfb\u5217\uff1a</p> <ul> <li>Ryzen Z1</li> <li>Ryzen Z1 Extreme</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#\u6838\u663e","title":"\u6838\u663e","text":"<ul> <li>AMD Radeon\u2122 890M: RDNA 3.5</li> <li>AMD Radeon\u2122 740M/760M/780M: RDNA 3</li> <li>AMD Radeon\u2122 610M/660M/680M: RDNA 2</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>List of AMD Ryzen processors</li> <li>Vermeer: AMD Zen 3 Ryzen Deep Dive Review: 5950X, 5900X, 5800X and 5600X Tested</li> <li>Chagall: AMD Announces Ryzen Threadripper Pro 5000 WX-Series: Zen 3 For OEM Workstations</li> <li>Cezanne: AMD Launches Ryzen 5000 Mobile: Zen 3 and Cezanne for Notebooks</li> <li>Cezanne: AMD Ryzen 9 5980HS Cezanne Review: Ryzen 5000 Mobile Tested</li> <li>Cezanne: The AMD Ryzen 7 5700G, Ryzen 5 5600G, and Ryzen 3 5300G Review</li> <li>Barcelo: AMD\u2019s Barcelo: Zen 3 APU Refresh for 2022</li> <li>Barcelo: AMD Announces Ryzen 5000 C-Series For High-End Chromebooks</li> <li>Lucienne: AMD's Ryzen 5000 Lucienne: Not Simply Rebranded Ryzen 4000 Renoir</li> <li>Rembrandt: AMD's Ryzen 9 6900HS Rembrandt Benchmarked: Zen3+ Power and Performance Scaling</li> <li>Raphael: AMD Zen 4 Ryzen 9 7950X and Ryzen 5 7600X Review: Retaking The High-End</li> <li>Mendocino: AMD Launches Mendocino APUs: Zen 2-based Ryzen and Athlon 7020 Series with RDNA 2 Graphics</li> <li>Barcelo R: Barcelo-R Ryzen 5 7530U brings Zen 3 into the mix for the messy AMD Ryzen 7000 mobile APU lineup</li> <li>Dragon Range: AMD Announces Ryzen Mobile 7045 HX-Series CPUs, Up to 16-Cores and 5.4 GHz for Laptops</li> <li>Phoenix/Rembrandt R: AMD Lays Out 2023 Ryzen Mobile 7000 CPUs: Top-to-Bottom Updates, New Zen 4 'Phoenix' CPU Takes Point</li> <li>Storm Peak: AMD Launches The Ryzen Threadripper 7000 Series: Up To 96 Cores, DDR5 RDIMMs, PRO &amp; HEDT CPUs</li> <li>Storm Peak: AMD Introduces New AMD Ryzen Threadripper 7000 Series Processors and Ryzen Threadripper PRO 7000 WX-Series Processors for the Ultimate Workstation</li> <li>Hawk Point: AMD Extends Mobile PC Leadership with AMD Ryzen\u2122 8040 Series Processors and Makes Ryzen\u2122 AI Software Widely Available, Advancing the AI PC Era</li> <li>Hawk Point: AMD Expands Commercial AI PC Portfolio to Deliver Leadership Performance Across Professional Mobile and Desktop Systems</li> <li>Phoenix: AMD Reveals Next-Gen Desktop Processors for Extreme PC Gaming and Creator Performance</li> <li>Granite Ridge: AMD Unveils Ryzen 9000 CPUs For Desktop, Zen 5 Takes Center Stage at Computex 2024</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#epyc-\u7cfb\u5217","title":"EPYC \u7cfb\u5217","text":"\u4ee3\u53f7 \u7f16\u53f7 \u6700\u5927\u6838\u5fc3\u6570 \u5fae\u67b6\u6784 \u63d2\u69fd Naples 7001 32 Zen 1 SP3 Rome 7002 64 Zen 2 SP3 Milan 7003 64 Zen 3 SP3 Milan-X 7003 64 Zen 3 SP3 Genoa 9004 96 Zen 4 SP5 Genoa-X 9004 96 Zen 4 SP5 Bergamo 97X4 128 Zen 4c SP5","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#\u53c2\u8003\u8d44\u6599_1","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>AMD Gives Details on EPYC Zen4: Genoa and Bergamo, up to 96 and 128 Cores</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#family-model-stepping","title":"Family, Model, Stepping","text":"<p>AMD \u7684 CPUID \u5206\u4e3a\u4e09\u90e8\u5206\uff1aFamily\uff0cModel \u548c Stepping\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>AMD EPYC 7001 Naples: Family=23(0x17), Model=1(0x01), Stepping=2(0x02)</li> <li>AMD EPYC 7002 Rome: Family=23(0x17), Model=49(0x31), Stepping=0(0x00)</li> <li>AMD Ryzen 7020U Mendocino: Family=23(0x17), Model=160(0xa0), Stepping=0(0x00)</li> </ul> <p>\u53ef\u4ee5\u5728 amd-ucode \u67e5\u9605\u6700\u65b0 microcode \u7248\u672c\u3002</p> <p>\u4fee\u590d EPYC 7002 Rome \u7684 Zenbleed \u6f0f\u6d1e\u7684 microcode \u7248\u672c\u662f 0x0830107a\u3002</p>","tags":["amd","cpu"]},{"location":"hardware/2023/01/09/amd-cpu/#intel","title":"Intel","text":"<ul> <li>Kaby Lake: Core ix-7xxx</li> <li>Coffee Lake: Core ix-8xxx/ix-9xxx</li> <li>Ice Lake: Core ix-10xxx</li> <li>Comet Lake: Core ix-10xxx</li> <li>Tiger Lake: Core ix-11xxx</li> <li>Alder Lake: Core ix-12xxx</li> <li>Raptor Lake: Core ix-13xxx/ix-14xxx</li> <li>Meteor Lake: Core Ultra 1xx</li> <li>Lunar Lake: Core Ultra 2xx</li> </ul>","tags":["amd","cpu"]},{"location":"hardware/2024/11/11/amd_zen5/","title":"AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b","text":"","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>Zen 5 \u662f AMD \u6700\u65b0\u7684\u4e00\u4ee3\u5fae\u67b6\u6784\uff0c\u5728\u5f88\u591a\u5730\u65b9\u548c\u4e4b\u524d\u4e0d\u540c\uff0c\u56e0\u6b64\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u5fae\u67b6\u6784\u5728\u5404\u4e2a\u65b9\u9762\u7684\u8868\u73b0\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u5b98\u65b9\u4fe1\u606f","title":"\u5b98\u65b9\u4fe1\u606f","text":"<p>AMD \u4e00\u5411\u516c\u5f00\u5f97\u6bd4\u8f83\u5927\u65b9\uff0c\u5173\u4e8e Zen 5 \u7684\u4fe1\u606f\u6709\uff1a</p> <ul> <li>Software Optimization Guide for the AMD Zen5 Microarchitecture</li> <li>5TH GEN AMD EPYC\u2122 PROCESSOR ARCHITECTURE</li> </ul>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u73b0\u6709\u8bc4\u6d4b","title":"\u73b0\u6709\u8bc4\u6d4b","text":"<p>\u7f51\u4e0a\u5df2\u7ecf\u6709\u8f83\u591a\u9488\u5bf9 Zen 5 \u5fae\u67b6\u6784\u7684\u8bc4\u6d4b\u548c\u5206\u6790\uff0c\u5efa\u8bae\u9605\u8bfb\uff1a</p> <ul> <li>AMD Reveals More Zen 5 CPU Core Details</li> <li>Zen 5\u2019s 2-Ahead Branch Predictor Unit: How a 30 Year Old Idea Allows for New Tricks</li> <li>Zen 5\u2019s Leaked Slides</li> <li>AMD\u2019s Strix Point: Zen 5 Hits Mobile</li> <li>AMD\u2019s Ryzen 9950X: Zen 5 on Desktop</li> <li>Discussing AMD\u2019s Zen 5 at Hot Chips 2024</li> <li>Zen 5 \u8865\u5145\u6d4b\u8bd5 (1/2): \u66f4\u591a\u5fae\u67b6\u6784\u7ec6\u8282</li> <li>Zen5's AVX512 Teardown + More...</li> </ul> <p>\u4e0b\u9762\u5206\u5404\u4e2a\u6a21\u5757\u5206\u522b\u8bb0\u5f55\u5b98\u65b9\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5b9e\u6d4b\u7684\u7ed3\u679c\u3002\u8bfb\u8005\u53ef\u4ee5\u5bf9\u7167\u5df2\u6709\u7684\u7b2c\u4e09\u65b9\u8bc4\u6d4b\u7406\u89e3\u3002\u5b98\u65b9\u4fe1\u606f\u4e0e\u5b9e\u6d4b\u7ed3\u679c\u4e00\u81f4\u7684\u6570\u636e\u4f1a\u52a0\u7c97\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#benchmark","title":"Benchmark","text":"<p>AMD Zen 5 \u7684\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\u89c1 SPEC\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#mop-vs-uop","title":"MOP vs uOP","text":"<p>MOP = Macro operation, uOP = Micro operation</p> <p>AMD \u7684\u6587\u6863\u91cc\u662f\u8fd9\u4e48\u8bf4\u7684\uff1a</p> <p>The processor implements AMD64 instruction set by means of macro-ops (the primary units of work managed by the processor) and micro-ops (the primitive operations executed in the processor's execution units). Instructions are marked as fast path single (one macro-op), fast path double (two macro-ops), or microcode (greater than two macro-ops). Macro ops can normally contain up to two micro-ops.</p> <p>\u4e00\u6761\u6307\u4ee4\u53ef\u4ee5\u5206\u6210\u82e5\u5e72\u4e2a MOP\uff08\u6bd4\u5982 REP MOVS \u4f1a\u62c6\u6210\u5f88\u591a\u4e2a MOP\uff09\uff0c\u4e00\u4e2a MOP \u53ef\u4ee5\u7ee7\u7eed\u7ec6\u5206\u4e3a uOP\uff08\u6bd4\u5982 store \u62c6\u5206\u6210 store data \u548c store address\uff1b\u628a\u5185\u5b58\u7684\u503c\u52a0\u5230\u5bc4\u5b58\u5668\u4e0a\u7684 add \u6307\u4ee4\u62c6\u5206\u6210 load \u548c add\uff09\u3002Dispatch \u7684\u5355\u4f4d\u662f MOP\uff0cROB \u4fdd\u5b58\u7684\u4e5f\u662f MOP\u3002\u4e0e Zen3/Zen4 \u4e0d\u540c\uff0cOp Cache \u4fdd\u5b58\u7684\u4e0d\u662f MOP\uff0c\u800c\u662f Fused Instructions\uff0c\u8fd9\u4e2a Fusion \u6765\u81ea\u4e8e Branch Fusion \u6216 MOV + ALU Fusion\u3002Fusion \u76f8\u5f53\u4e8e\u628a\u591a\u6761\u6307\u4ee4\u5408\u6210\u4e86\u4e00\u4e2a\uff0c\u51cf\u5c11\u4e86 MOP \u7684\u6570\u91cf\u3002</p> <p>MOP \u5230 uOP \u7684\u62c6\u5206\u9700\u8981\u7b49\u5230 Scheduler \u4e2d\u624d\u8fdb\u884c\uff0cScheduler \u8f93\u5165 MOP\uff0c\u8f93\u51fa uOP\uff0c\u4e5f\u5c31\u662f\u8bf4\u6700\u7ec8\u7ed9\u5230\u6267\u884c\u5355\u5143\u7684\u662f uOP\u3002</p> <p>\u548c ARM \u516c\u7248\u6838\u7684 MOP/uOP \u5bf9\u6bd4\uff0c\u5176\u5b9e\u662f\u5f88\u7c7b\u4f3c\u7684\uff1auOP \u662f\u6267\u884c\u5355\u5143\u770b\u5230\u7684\u6307\u4ee4\u7c92\u5ea6\uff0cMOP \u662f\u7ef4\u62a4\u7cbe\u786e\u5f02\u5e38\u7684\u6307\u4ee4\u7c92\u5ea6\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u524d\u7aef","title":"\u524d\u7aef","text":"","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#op-cache","title":"Op Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a64 set, 16 way, 1024 entry, 6 (fused) inst/entry, \u4f9b\u6307 2 entry/cycle</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u5f00\u542f\u5173\u95ed","title":"\u5f00\u542f/\u5173\u95ed","text":"<p>AMD \u5728 UEFI \u56fa\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u5173\u95ed Op Cache \u7684\u8bbe\u7f6e\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6d4b\u8bd5\u5728 Op Cache \u5f00\u542f/\u5173\u95ed\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u6027\u80fd\u3002\u901a\u8fc7\u8fdb\u4e00\u6b65\u7814\u7a76\uff0c\u53d1\u73b0\u56fa\u4ef6\u7684 Op Cache \u5173\u95ed\u8bbe\u7f6e\uff0c\u5b9e\u9645\u4e0a\u5bf9\u5e94\u4e86 MSR[0xc0011021] \u7684 bit 5\uff1a\u521d\u59cb\u60c5\u51b5\u4e0b\uff0cMSR[0xc0011021] \u7684\u503c\u4e3a 0x20000000000040\uff0c\u5982\u679c\u8fdb\u5165\u56fa\u4ef6\u5173\u95ed Op Cache\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230 MSR[0xc0011021] \u53d8\u6210\u4e86 0x20000000000060\u3002\u5b9e\u9645\u4e0a\uff0cOp Cache \u53ef\u4ee5\u5728\u8fdb\u5165 Linux \u540e\u52a8\u6001\u5f00\u542f/\u5173\u95ed\uff08\u611f\u8c22 David Huang \u5728\u535a\u5ba2\u4e2d\u63d0\u4f9b\u7684\u4fe1\u606f\uff09\uff1a</p> <pre><code>sudo modprobe msr\n# Disable Op Cache for Core 0\nsudo wrmsr -p 0 0xc0011021 0x20000000000060\n# Enable Op Cache for Core 0\nsudo wrmsr -p 0 0xc0011021 0x20000000000040\n</code></pre> <p>\u56e0\u6b64\u5f00\u5173 Op Cache \u4e0d\u9700\u8981\u91cd\u542f\u8fdb\u56fa\u4ef6\u4e86\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u5bb9\u91cf","title":"\u5bb9\u91cf","text":"<p>Zen 5 \u7684 Op Cache \u6bcf\u4e2a entry \u662f 6 (fused) inst\uff0c\u4e3a\u4e86\u6d4b\u51fa Op Cache \u7684\u5bb9\u91cf\uff0c\u4ee5\u53ca\u786e\u8ba4\u4fdd\u5b58\u7684\u662f fused inst\uff0c\u5229\u7528 MOV + ALU Fusion \u6765\u6784\u9020\u6307\u4ee4\u5e8f\u5217\uff1a</p> <pre><code># rsi = rdi\nmov %rdi, %rsi\n# rsi += rdx\nadd %rdx, %rsi\n</code></pre> <p>\u8fd9\u4e24\u6761\u6307\u4ee4\u6ee1\u8db3 Zen 5 \u7684 MOV + ALU Fusion \u8981\u6c42\uff0c\u786c\u4ef6\u4e0a\u878d\u5408\u6210\u4e00\u4e2a <code>rsi = rdx + rdi</code> \u7684\u64cd\u4f5c\u3002\u505a\u8fd9\u4e2a\u878d\u5408\u4e5f\u662f\u56e0\u4e3a x86 \u6307\u4ee4\u96c6\u7f3a\u5c11 3 \u5730\u5740\u6307\u4ee4\uff0c\u5f53\u7136\u672a\u6765 APX \u4f1a\u8865\u4e0a\u8fd9\u4e2a\u7f3a\u5931\u3002\u5b9e\u6d4b\u53d1\u73b0\uff0c\u8fd9\u6837\u7684\u6307\u4ee4\u5e8f\u5217\u53ef\u4ee5\u8fbe\u5230 12 \u7684 IPC\uff0c\u6b63\u597d Zen 5 \u7684 ALU \u6709 6 \u4e2a\uff0c\u4e5f\u5c31\u662f\u6bcf\u5468\u671f\u6267\u884c 6 \u6761\u878d\u5408\u540e\u7684\u6307\u4ee4\uff0c\u548c 12 IPC \u662f\u543b\u5408\u7684\u300212 \u7684 IPC \u53ef\u4ee5\u4e00\u76f4\u7ef4\u6301\u5230 36KB \u7684 footprint\uff0c\u8fd9\u91cc\u7684 mov \u548c add \u6307\u4ee4\u90fd\u662f 3 \u5b57\u8282\uff0c\u6362\u7b97\u4e0b\u6765 36KB \u5bf9\u5e94 <code>36*1024/6=6144</code> \u4e2a fused instruction\uff0c\u6b63\u597d <code>64*16*6=6144</code>\uff0c\u5bf9\u4e0a\u4e86\u3002\u5173\u6389 Op Cache \u540e\uff0c\u6027\u80fd\u4e0b\u964d\u5230 4 IPC\uff0c\u5bf9\u5e94\u4e86 Decode \u5bbd\u5ea6\uff0c\u540c\u65f6\u4e5f\u8bf4\u660e Decode \u7684 4 Wide \u5bf9\u5e94\u7684\u662f\u6307\u4ee4\uff0c\u800c\u4e0d\u662f\u878d\u5408\u540e\u7684\u6307\u4ee4\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u541e\u5410","title":"\u541e\u5410","text":"<p>\u63a5\u4e0b\u6765\u8981\u6d4b\u8bd5 Op Cache \u80fd\u5426\u5355\u5468\u671f\u7ed9\u5355\u4e2a\u7ebf\u7a0b\u63d0\u4f9b 2 \u4e2a entry \u7684\u541e\u5410\u3002\u7531\u4e8e\u6bcf\u4e2a entry \u6700\u591a\u53ef\u4ee5\u6709 6 (fused) inst\uff0c\u52a0\u8d77\u6765\u662f 12\uff0c\u800c dispatch \u53ea\u6709 8 MOP/cycle\uff0c\u56e0\u6b64\u9000\u800c\u6c42\u5176\u6b21\uff0c\u4e0d\u8981\u6c42\u7528\u5b8c entry \u7684 6 \u6761\u6307\u4ee4\uff0c\u800c\u662f\u7528 jmp \u6307\u4ee4\u6765\u63d0\u524d\u7ed3\u675f entry\uff1a</p> <pre><code># rsi = rdi\nmov %rdi, %rsi\njmp 2f\n2:\n</code></pre> <p>\u91cd\u590d\u4e0a\u8ff0\u6307\u4ee4\uff0c\u53d1\u73b0\u5728 5KB \u4e4b\u524d\u90fd\u53ef\u4ee5\u8fbe\u5230 4 \u7684 IPC\uff0c\u4e4b\u540e\u5219\u4e0b\u964d\u5230 2 IPC\uff0c\u8bf4\u660e 5KB \u65f6\u7528\u6ee1\u4e86 Op Cache\u3002\u8fd9\u91cc\u7684 mov \u6307\u4ee4\u662f 3 \u5b57\u8282\uff0cjmp \u6307\u4ee4\u662f 2 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u8bf4 5KB \u5bf9\u5e94\u4e0a\u8ff0\u6307\u4ee4\u6a21\u5f0f\u91cd\u590d\u4e86 1024 \u6b21\uff0c\u6b64\u65f6 Op Cache \u7528\u6ee1\u4e86\u5bb9\u91cf\uff0c\u6b63\u597d Op Cache \u4e5f\u662f <code>64*16=1024</code> \u4e2a entry\uff0c\u5370\u8bc1\u4e86 Op Cache \u7684 entry \u4f1a\u88ab jmp \u63d0\u524d\u7ed3\u675f\uff0c\u5728\u4e0a\u8ff0\u7684\u6307\u4ee4\u6a21\u5f0f\u4e0b\uff0centry \u4e0d\u4f1a\u8de8\u8d8a jmp \u6307\u4ee4\u8bb0\u5f55\u540e\u9762\u7684\u6307\u4ee4\uff0c\u6bcf\u4e2a entry \u53ea\u6709\u4e24\u6761\u6307\u4ee4\u3002\u90a3\u4e48 4 IPC \u8bc1\u660e\u4e86 Op Cache \u53ef\u4ee5\u6bcf\u5468\u671f\u63d0\u4f9b 2 entry\uff0c\u76f8\u6bd4 Decode \u53ea\u80fd\u6bcf\u5468\u671f\u7ed9\u5355\u7ebf\u7a0b\u63d0\u4f9b 4 \u6761\u6307\u4ee4\u660e\u663e\u8981\u5feb\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u53d6\u6307","title":"\u53d6\u6307","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u6bcf\u5468\u671f\u5171 64B\uff0c\u53ef\u4ee5\u53d6\u4e24\u4e2a 32B \u5bf9\u9f50\u7684\u6307\u4ee4\u5757</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u53d6\u6307\uff0c\u9700\u8981\u5173\u6389 Op Cache\uff0c\u4f46\u7531\u4e8e Decode \u74f6\u9888\u592a\u660e\u663e\uff0c\u4e0d\u5bb9\u6613\u6d4b\u51fa\u53d6\u6307\u7684\u6027\u80fd\uff0c\u4f8b\u5982\u662f\u5426\u4e00\u4e2a\u5468\u671f\u53ef\u4ee5\u7ed9\u5355\u7ebf\u7a0b\u53d6\u4e24\u4e2a 32B \u5bf9\u9f50\u7684\u6307\u4ee4\u5757\u3002\u76ee\u524d\u901a\u8fc7\u5b9e\u6d4b\u53ef\u4ee5\u77e5\u9053\uff0c\u5728\u5173\u95ed Op Cache \u7684\u60c5\u51b5\u4e0b\uff0c\u6d4b\u8bd5\u5faa\u73af\u4f53\u8de8\u8d8a 64B \u7f13\u5b58\u884c\u8fb9\u754c\u7684\u60c5\u51b5\uff0c\u6307\u4ee4\u6a21\u5f0f\u89c1\u4e0b\uff1a</p> <pre><code>1:\ndec %rdi\n# 64B cache line boundary here\njne 1b\n</code></pre> <p>\u5faa\u73af\u4e00\u6b21\u9700\u8981 1.5 \u4e2a\u5468\u671f\u3002\u5982\u679c Fetch \u6bcf\u5468\u671f\u53ea\u80fd\u53d6\u4e00\u4e2a 32B/64B \u5bf9\u9f50\u7684\u6307\u4ee4\u5757\uff0c\u90a3\u4e48\u4e00\u6b21\u5faa\u73af\u9700\u8981 2 \u4e2a\u5468\u671f\u6765\u53d6\u6307\uff0c\u4f46\u5982\u679c Fetch \u6bcf\u5468\u671f\u53ef\u4ee5\u53d6\u4e24\u4e2a 32B \u5bf9\u9f50\u7684\u6307\u4ee4\u5757\uff0c\u90a3\u4e48\u4e00\u6b21\u5faa\u73af\u53ea\u9700\u8981 1 \u4e2a\u5468\u671f\u53d6\u6307\uff0c\u4f46\u5b9e\u9645\u6d4b\u51fa\u6765\u53c8\u662f 1.5 \u4e2a\u5468\u671f\uff0c\u76ee\u524d\u8fd8\u6ca1\u6709\u627e\u5230\u5408\u7406\u7684\u89e3\u91ca\uff0c\u4f46\u5927\u6982\u7387 Fetch \u8fd8\u662f\u53ef\u4ee5\u7ed9\u5355\u7ebf\u7a0b\u6bcf\u5468\u671f\u63d0\u4f9b\u4e24\u4e2a 32B \u6307\u4ee4\u5757\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#decode","title":"Decode","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a2x 4-wide decode pipeline, one pipeline per thread</p> <p>AMD Zen 5 \u7684 Decode \u867d\u7136\u6709\u4e24\u4e2a Pipe\uff0c\u4f46\u662f\u6bcf\u4e2a\u903b\u8f91\u7ebf\u7a0b\u53ea\u80fd\u7528\u4e00\u4e2a\uff0c\u610f\u5473\u7740\u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u65e0\u6cd5\u505a\u5230 8-wide Decode\uff0c\u800c 4-wide Decode \u53c8\u592a\u7a84\u4e86\u70b9\uff0c\u56e0\u6b64 Op Cache \u7684\u547d\u4e2d\u7387\u5c31\u663e\u5f97\u5f88\u91cd\u8981\u3002</p> <p>\u4e3a\u4e86\u6d4b\u8bd5 Decode\uff0c\u9700\u8981\u9996\u5148\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u5173\u95ed Op Cache\uff0c\u7136\u540e\u6784\u9020\u4e0d\u540c\u7684\u6307\u4ee4\u5e8f\u5217\u4ee5\u89c2\u5bdf IPC\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <ul> <li>\u91cd\u590d 1-4 \u5b57\u8282 nop\uff1a4 IPC</li> <li>\u91cd\u590d 5 \u5b57\u8282 nop\uff1a3.2 IPC</li> <li>\u91cd\u590d 6 \u5b57\u8282 nop\uff1a2.67 IPC</li> <li>\u91cd\u590d 7 \u5b57\u8282 nop\uff1a2.3 IPC</li> <li>\u91cd\u590d 8 \u5b57\u8282 nop\uff1a2 IPC</li> <li>\u91cd\u590d 9 \u5b57\u8282 nop\uff1a1.78 IPC</li> <li>\u91cd\u590d 10 \u5b57\u8282 nop\uff1a1.6 IPC</li> <li>\u91cd\u590d 11-15 \u5b57\u8282 nop\uff1a1 IPC</li> </ul> <p>\u4e0a\u8ff0 nop \u7684\u7f16\u7801\u53d6\u81ea Software Optimization Guide \u7684 Encodings for NOP Instructions 1 to 15 \u8868\u683c\u3002</p> <p>\u9996\u5148\u53ef\u4ee5\u770b\u5230 Zen5 4-wide Decode \u7684\u9650\u5236\uff0c\u5176\u6b21\u53ef\u4ee5\u53d1\u73b0\u91cd\u590d 5-10 \u5b57\u8282\u7684 nop\uff0c\u6bcf\u5468\u671f\u7684 Decode \u541e\u5410\u90fd\u662f 16B\u300211 \u5b57\u8282\u4ee5\u4e0a\u5219\u662f\u649e\u5230\u4e86 Decode \u7684\u9650\u5236\uff1a<code>Only the first decode slot (of four) can decode instructions greater than 10 bytes in length</code>\u3002</p> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\u8fd9\u4e2a 16B \u7684\u9650\u5236\uff0c\u8003\u8651\u79fb\u52a8\u7a97\u53e3\u7684\u8bd1\u7801\u8bbe\u8ba1\uff0c\u6bcf\u5468\u671f\u53ef\u4ee5\u5bf9\u4e24\u4e2a\u8fde\u7eed 16B \u7684\u7a97\u53e3\u8bd1\u7801\uff08<code>IBQ entries hold 16 byte-aligned fetch windows of the instruction byte stream. The decode pipes each scan two IBQ entries.</code>\uff09\uff0c\u5728 5 \u5b57\u8282\u7684 nop \u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a\u5468\u671f\u7684 Decode \u5e94\u8be5\u662f\uff1a</p> <ul> <li>Cycle 0: Window 0-31, Decode 0, 5, 10, 15</li> <li>Cycle 1: Window 16-47, Decode 20, 25, 30, 35</li> <li>Cycle 2: Window 32-63, Decode 40, 45, 50, 55</li> <li>Cycle 3: Window 48-79, Decode 60, 65, 70, 75</li> <li>Cycle 4: Window 80-111, Decode 80, 85, 90, 95</li> </ul> <p>\u6309\u8fd9\u4e2a\u7406\u60f3\u7684\u65b9\u6cd5\u6765\u770b\uff0c\u5e94\u8be5\u53ef\u4ee5\u505a\u5230 4 \u7684 IPC\uff0c\u4f46\u5b9e\u9645\u4e0a\u6ca1\u6709\u3002\u4e00\u4e2a\u731c\u6d4b\u662f\uff0c\u6ed1\u52a8\u7a97\u53e3\u6bcf\u6b21\u53ea\u80fd\u79fb\u52a8 1 \u4e2a 16B\uff0c\u800c\u4e0d\u80fd\u4ece 48 \u8df3\u5230 80\uff0c\u90a3\u4e48\u4ece Cycle 4 \u5f00\u59cb\u4f1a\u51fa\u73b0\u6027\u80fd\u635f\u5931\uff1a</p> <ul> <li>Cycle 4: Window 64-95, Decode 80, 85, 90</li> <li>Cycle 5: Window 80-111, Decode 95, 100, 105</li> <li>Cycle 6: Window 96-127, Decode 110, 115, 120</li> <li>Cycle 7: Window 112-143, Decode 125, 130, 135</li> <li>Cycle 8: Window 128-159, Decode 140, 145, 150, 155</li> </ul> <p>\u8fd9\u4e2a\u89c4\u5f8b\u5ef6\u7eed\u4e0b\u53bb\uff0c\u5e73\u5747\u4e0b\u6765\u5c31\u662f 3.2 IPC\u3002</p> <p>\u6839\u636e\u8fd9\u4e2a\u731c\u60f3\uff0cDecode \u4ece\u4e24\u4e2a\u8fde\u7eed\u7684 IBQ entry \u8bd1\u7801\u6700\u591a\u56db\u6761\u6307\u4ee4\uff0c\u662f\u6ca1\u6709 16B \u7684\u9650\u5236\u7684\uff0c\u4f46 IBQ \u6bcf\u5468\u671f\u53ea\u80fd\u5f39\u51fa\u4e00\u4e2a entry\uff0c\u800c\u4e0d\u5141\u8bb8\u6bcf\u5468\u671f\u5f39\u51fa\u4e24\u4e2a\uff0c\u8fd9\u624d\u5bfc\u81f4\u4e86 16B \u7684\u541e\u5410\u3002\u603b\u4e4b\uff0c4-wide \u4ee5\u53ca 16B \u7684\u9650\u5236\uff0c\u5e94\u8be5\u8bf4\u662f\u5f88\u5c0f\u7684\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l1-icache","title":"L1 ICache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a32KB, 8-way set associative</p> <p>\u4e3a\u4e86\u6d4b\u8bd5 L1 ICache \u7684\u5bb9\u91cf\uff0c\u9700\u8981\u5173\u95ed Op Cache\uff0c\u4f46\u7531\u4e8e Decode \u7684\u9650\u5236\uff0c\u5373\u4f7f footprint \u5927\u4e8e L1 ICache \u5bb9\u91cf\uff0cIPC \u4f9d\u7136\u6ca1\u6709\u53d8\u5316\uff0c\u9488\u5bf9\u8fd9\u4e2a\u73b0\u8c61\uff0c\u731c\u6d4b L1 ICache \u7684\u9884\u53d6\u5728\u8d77\u4f5c\u7528\uff0c\u5e76\u4e14 L2 Cache \u5230 L1 ICache \u7684 Refill \u5e26\u5bbd\u4e0d\u5c0f\u4e8e Decode \u5e26\u5bbd\uff0c\u5bfc\u81f4\u74f6\u9888\u5728 Decode\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u6d4b\u8bd5 L1 ICache \u7684\u5bb9\u91cf\uff0c\u6784\u9020\u4e00\u4e2a jmp \u5e8f\u5217\uff0c\u4ee5 4B \u4f4d\u95f4\u8ddd\u6392\u5e03\uff0c\u89c2\u5bdf\u5230\u5728\u5173\u95ed Op Cache \u7684\u60c5\u51b5\u4e0b\uff0c\u5728 8192 \u6761 jmp \u6307\u4ee4\u4e4b\u524d\u53ef\u4ee5\u505a\u5230 1 CPI\uff0c\u4e4b\u540e\u9010\u6e10\u63d0\u5347\u5230 1.5 CPI\uff0c\u6b63\u597d 8192 \u5bf9\u5e94\u4e86 <code>8192*4=32768</code> \u4e5f\u5c31\u662f 32KB L1 ICache \u7684\u5bb9\u91cf\u9650\u5236\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l1-itlb","title":"L1 ITLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a64-entry, fully associative</p> <p>\u4e3a\u4e86\u6d4b\u8bd5 L1 ITLB \u7684\u5bb9\u91cf\uff0c\u6784\u9020 jmp \u5e8f\u5217\uff0c\u6bcf\u4e2a jmp \u5728\u4e00\u4e2a\u5355\u72ec\u7684\u9875\u4e2d\uff0c\u5728\u5173\u95ed Op Cache \u7684\u60c5\u51b5\u4e0b\u89c2\u5bdf jmp \u7684\u6027\u80fd\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u660e\u663e\u7684 64 pages \u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u4e86 64 entry \u7684 L1 ITLB\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l2-itlb","title":"L2 ITLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a2048-entry, 8-way set associative L2 ITLB</p> <p>\u7ee7\u7eed\u6cbf\u7528\u6d4b\u8bd5 L1 ITLB \u7684\u65b9\u5f0f\uff0c\u628a\u9875\u7684\u6570\u91cf\u63d0\u9ad8\u5230 2000+\uff0c\u5728\u5173\u95ed Op Cache \u7684\u60c5\u51b5\u4e0b\u5f97\u5230\u4ee5\u4e0b\u6d4b\u8bd5\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u660e\u663e\u7684 2048 pages \u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u4e86 2048 entry \u7684 L2 ITLB\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#btb","title":"BTB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a16K-entry L1 BTB, 8K-entry L2 BTB</p> <p>\u56e0\u4e3a L1 ICache \u53ea\u6709 32KB\uff0c\u800c L1 BTB \u6709 16K entry\uff0c\u6bcf\u4e2a entry \u6700\u591a\u80fd\u4fdd\u5b58\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u56e0\u6b64\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u9047\u5230\u7684\u662f L1 ICache \u7684\u74f6\u9888\uff0c\u800c\u4e0d\u662f L1 BTB \u7684\u74f6\u9888\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#return-address-stack","title":"Return Address Stack","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a52-entry per thread</p> <p>\u6784\u9020\u4e0d\u540c\u6df1\u5ea6\u7684\u8c03\u7528\u94fe\uff0c\u6d4b\u8bd5\u6bcf\u6b21\u8c03\u7528\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u5728\u5173\u95ed Op Cache \u7684\u60c5\u51b5\u4e0b\u5f97\u5230\u5982\u4e0b\u6d4b\u8bd5\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 52 \u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f Return Address Stack \u7684\u5927\u5c0f\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#indirect-target-predictor","title":"Indirect Target Predictor","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a3072-entry Indirect Target Array</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#move-elimination-zero-cycle-move-and-zeroingones-idiom","title":"Move Elimination (Zero Cycle Move) and Zeroing/Ones Idiom","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u652f\u6301 xor/sub/cmp/sbb/vxorp/vandnp/vpcmpgt/vpandn/vpxor/vpsub \u7684 Zeroing Idiom\uff0c\u652f\u6301 pcmpeq/vpcmpeq \u7684 Ones Idiom\uff0c\u652f\u6301 mov/movsxd/xchg/(v)vmovap/(v)movdp/(v)movup \u7684 Zero Cycle Move\u3002</p> <p>\u5b9e\u6d4b\u4e0b\u6765\uff0c\u4ee5\u4e0b\u6307\u4ee4\u5e8f\u5217\u7684 IPC \u4e3a\uff1a</p> <ul> <li>\u6709\u4f9d\u8d56\u94fe\u7684 mov r, r\uff1a7 IPC</li> <li>\u6ca1\u6709\u4f9d\u8d56\u7684 mov r, r\uff1a7 IPC</li> <li>xor r, r, r\uff1a7 IPC</li> <li>sub r, r, r\uff1a7 IPC</li> <li>\u6709\u4f9d\u8d56\u94fe\u7684 mov vr, vr\uff1a6 IPC</li> <li>\u6ca1\u6709\u4f9d\u8d56\u7684 mov vr, vr\uff1a6 IPC</li> <li>xor vr, vr, vr\uff1a6 IPC</li> <li>mov r, imm\uff1a6 IPC</li> </ul> <p>\u5176\u4e2d r \u8868\u793a\u6574\u6570\u5bc4\u5b58\u5668\uff0cvr \u8868\u793a\u6d6e\u70b9/\u5411\u91cf\u5bc4\u5b58\u5668\u3002\u603b\u4f53\u6765\u8bf4\u8fd8\u662f\u505a\u7684\u6bd4\u8f83\u5b8c\u5584\u7684\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#dispatch","title":"Dispatch","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a8 MOP/cycle, up to 2 taken branches/cycle</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u540e\u7aef","title":"\u540e\u7aef","text":"","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#rob","title":"ROB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a224-entry per thread, 1-2 MOP per entry</p> <p>\u628a\u4e24\u4e2a\u72ec\u7acb\u7684 long latency pointer chasing load \u653e\u5728\u5faa\u73af\u7684\u5934\u548c\u5c3e\uff0c\u4e2d\u95f4\u7528 NOP \u586b\u5145\uff0c\u5f53 NOP \u586b\u6ee1\u4e86 ROB\uff0c\u7b2c\u4e8c\u4e2a pointer chasing load \u65e0\u6cd5\u63d0\u524d\u6267\u884c\uff0c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5f53 NOP \u6307\u4ee4\u8fbe\u5230 446 \u6761\u65f6\u51fa\u73b0\u6027\u80fd\u7a81\u53d8\uff0c\u6b64\u65f6\u5e94\u8be5\u662f\u89e6\u53d1\u4e86 Zen 5 \u7684\u6bcf\u4e2a entry \u4fdd\u5b58\u4e24\u4e2a MOP \u7684\u6761\u4ef6\uff0c\u56e0\u6b64 446 \u6761 NOP \u6307\u4ee4\u5bf9\u5e94 223 \u4e2a entry\uff0c\u52a0\u4e0a\u5faa\u73af\u5f00\u5934\u7684 load \u6307\u4ee4\uff0c\u6b63\u597d\u628a\u5faa\u73af\u5c3e\u90e8\u7684 load \u62e6\u5728\u4e86 ROB \u5916\u9762\uff0c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002</p> <p>\u8bf4\u660e\u5355\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u5230\u7684 ROB \u5bb9\u91cf\u662f 224 entry\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#register-file","title":"Register File","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a240-entry(40 per thread for architectural) integer physical register file, 192-entry flag physical register file, 384-entry 512b vector register file</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u7269\u7406\u5bc4\u5b58\u5668\u5806\u5927\u5c0f\uff0c\u6784\u9020\u4e00\u4e2a\u5faa\u73af\uff0c\u5faa\u73af\u5f00\u5934\u548c\u7ed3\u5c3e\u5404\u662f\u4e00\u4e2a\u957f\u5ef6\u8fdf\u7684\u64cd\u4f5c\uff0c\u7531\u4e8e Zen 5 \u6ca1\u6709\u5b9e\u73b0 temporal prefetcher\uff0c\u4f7f\u7528\u7684\u662f pointer chasing load\u3002\u7136\u540e\u5728\u4e24\u4e2a\u957f\u5ef6\u8fdf\u7684\u64cd\u4f5c\u4e2d\u95f4\u7a7f\u63d2\u4e0d\u540c\u7684\u6307\u4ee4\u7c7b\u578b\uff0c\u4ece\u800c\u6d4b\u51fa\u5bf9\u5e94\u7684\u7269\u7406\u5bc4\u5b58\u5668\u5806\u53ef\u4f9b\u9884\u6d4b\u6267\u884c\u7684\u5bc4\u5b58\u5668\u6570\u91cf\uff1a</p> <p></p> <p>\u6574\u6570\u65b9\u9762\u4f7f\u7528 lea \u6307\u4ee4\u6765\u6d88\u8017\u6574\u6570\u7269\u7406\u5bc4\u5b58\u5668\u800c\u4e0d\u6d88\u8017 flags \u5bc4\u5b58\u5668\uff0c\u6b64\u65f6\u65e0\u8bba\u662f 32 \u4f4d\u8fd8\u662f 64 \u4f4d\u5bc4\u5b58\u5668\uff0c\u4f9b\u9884\u6d4b\u6267\u884c\u7684\u5bc4\u5b58\u5668\u6570\u90fd\u6709 200 \u4e2a\uff0c\u548c\u5b98\u65b9\u7684\u4fe1\u606f\u543b\u5408\uff1a<code>200+40=240</code>\uff0c\u8bf4\u660e\u8d85\u7ebf\u7a0b\u5728\u6ca1\u6709\u8d1f\u8f7d\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u5360\u7528\u6574\u6570\u7269\u7406\u5bc4\u5b58\u5668\u5806\uff0c\u8fd9\u5728 AMD \u7684\u6587\u6863\u4e2d\u53eb\u505a Watermarked\uff1a<code>Resource entries are assigned on demand</code>\u3002356 \u4e2a flags \u5bc4\u5b58\u5668\u8d85\u8fc7\u4e86\u5b98\u65b9\u5ba3\u4f20\u7684 192 \u7684\u5927\u5c0f\uff0c\u731c\u6d4b\u505a\u4e86\u4e00\u4e9b\u4f18\u5316\uff0c\u6d4b\u5230\u7684\u5e76\u975e flags \u5bc4\u5b58\u5668\u5806\u5927\u5c0f\u3002</p> <p>\u6d6e\u70b9\u65b9\u9762\uff0c\u6d4b\u5f97 430 \u4e2a\u4f9b\u9884\u6d4b\u6267\u884c\u7684\u6d6e\u70b9\u5bc4\u5b58\u5668\uff0c\u8d85\u8fc7\u4e86\u5b98\u65b9\u5ba3\u4f20\u7684 384 \u4e2a 512 \u4f4d\u6d6e\u70b9\u5bc4\u5b58\u5668\u3002\u8003\u8651\u5230 Zen5 \u5f15\u5165\u4e86\u5728 Rename \u4e4b\u524d\u7684 96-entry Non-Scheduling Queue(NSQ)\uff0c\u5728 NSQ \u4e2d\u7684\u6307\u4ee4\u8fd8\u6ca1\u6709\u7ecf\u8fc7\u91cd\u547d\u540d\uff0c\u56e0\u6b64\u4e0d\u6d88\u8017\u7269\u7406\u5bc4\u5b58\u5668\uff1a<code>384+96=480</code>\uff0c\u518d\u53bb\u6389\u81f3\u5c11 32 \u4e2a\u67b6\u6784\u5bc4\u5b58\u5668 zmm0-zmm31\uff0c\u548c\u89c2\u5bdf\u5230\u7684 430 \u662f\u6bd4\u8f83\u63a5\u8fd1\u7684\u3002</p> <p>\u9488\u5bf9\u6d6e\u70b9\u5bc4\u5b58\u5668\uff0cZen5 \u7684\u4e0d\u540c\u5e73\u53f0\u7684\u8bbe\u8ba1\u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u4e0a\u9762\u7684\u6d4b\u8bd5\u662f\u5728 9950X \u4e0a\u8fdb\u884c\u7684\uff0c\u5176\u4ed6\u5e73\u53f0\u7684\u6d4b\u8bd5\u4ee5\u53ca\u5206\u6790\u89c1 Zen5's AVX512 Teardown + More...\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l1-dcache","title":"L1 DCache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a48KB, 12-way set associative, index \u662f VA[11:6]</p> <p>\u4f7f\u7528\u4e0d\u540c footprint \u7684\u968f\u673a\u7684 pointer chasing load\uff0c\u6d4b\u8bd5\u6027\u80fd\uff0c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u89c2\u5bdf\u5230\u660e\u663e\u7684 48KB \u7684\u62d0\u70b9\uff0c\u547d\u4e2d L1 DCache \u65f6 load to use latency \u662f 4 cycle\uff0c\u547d\u4e2d L2 \u65f6\u589e\u5927\u5230\u4e86 14 cycle\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#linear-address-utagway-predictor","title":"Linear Address UTAG/Way-Predictor","text":"<p>\u590d\u73b0\u8bba\u6587 Take A Way: Exploring the Security Implications of AMD's Cache Way Predictors\uff0c\u53ef\u4ee5\u770b\u5230 Zen 5 \u7684 UTAG \u54c8\u5e0c\u51fd\u6570\u548c Zen 2 \u4e00\u6837\u4e5f\u662f\u5982\u4e0b 8 bit\uff1a</p> <ul> <li>VA[12] xor VA[27]</li> <li>VA[13] xor VA[26]</li> <li>VA[14] xor VA[25]</li> <li>VA[15] xor VA[20]</li> <li>VA[16] xor VA[21]</li> <li>VA[17] xor VA[22]</li> <li>VA[18] xor VA[23]</li> <li>VA[19] xor VA[24]</li> </ul> <p>\u5982\u679c\u4e24\u4e2a\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u540c\u4e00\u4e2a DCache Set \u4e0a\u7684\u4e0d\u540c Way\uff08Set \u6839\u636e VA[11:6] \u552f\u4e00\u786e\u5b9a\uff09\uff0c\u5e76\u4e14\u5b83\u4eec\u7684 uTag \u51fa\u73b0\u51b2\u7a81\uff0c\u90a3\u4e48\u8bbf\u95ee\u4e00\u4e2a\u865a\u62df\u5730\u5740\u4f1a\u628a\u53e6\u4e00\u4e2a\u865a\u62df\u5730\u5740\u4ece L1 DCache \u4e2d\u6e05\u6389\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#load-store-unit","title":"Load Store Unit","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u6bcf\u5468\u671f\u6700\u591a\u56db\u4e2a\u5185\u5b58\u64cd\u4f5c\u3002\u6bcf\u5468\u671f\u6700\u591a\u56db\u4e2a\u8bfb\uff0c\u5176\u4e2d\u6700\u591a\u4e24\u4e2a 128b/256b/512b \u8bfb\uff1b\u6bcf\u5468\u671f\u6700\u591a\u4e24\u4e2a\u5199\uff0c\u5176\u4e2d\u6700\u591a\u4e00\u4e2a 512b \u5199\u3002load to use latency\uff0c\u6574\u6570\u662f 4-5 \u4e2a\u5468\u671f\uff0c\u6d6e\u70b9\u662f 7-8 \u4e2a\u5468\u671f\u3002\u8de8\u8d8a 64B \u8fb9\u754c\u7684\u8bfb\u4f1a\u6709\u989d\u5916\u7684\u4e00\u4e2a\u5468\u671f\u7684\u5ef6\u8fdf\u3002\u652f\u6301 Store to load forwarding\uff0c\u8981\u6c42\u5148\u524d\u7684 store \u5305\u62ec\u4e86 load \u7684\u6240\u6709\u5b57\u8282\uff0c\u4e0d\u8981\u6c42\u5bf9\u9f50\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u541e\u5410_1","title":"\u541e\u5410","text":"<p>\u5b9e\u6d4b Zen 5 \u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u5b8c\u6210\u5982\u4e0b\u7684\u8bbf\u5b58\u64cd\u4f5c\uff1a</p> <ul> <li>4x 32b Load: 1 cycle</li> <li>4x 64b Load: 1 cycle</li> <li>2x 128b Load: 1 cycle</li> <li>2x 256b Load: 1 cycle</li> <li>2x 32b Store: 1 cycle</li> <li>2x 64b Store: 1 cycle</li> <li>2x 128b Store: 1 cycle</li> <li>2x 256b Store: 1 cycle</li> <li>1x 64b Load + 2x 64b Store: 1 cycle</li> <li>2x 64b Load + 2x 64b Store: 1 cycle</li> <li>3x 64b Load + 1x 64b Store: 1 cycle</li> <li>1x 128b Load + 2x 128b Store: 1 cycle</li> <li>2x 128b Load + 1x 128b Store: 1 cycle</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u6bcf\u5468\u671f\u652f\u6301 4 \u4e2a 64b \u7684 Load/Store\uff0c\u5176\u4e2d Store \u6700\u591a\u4e24\u6761\u3002\u4e00\u4e2a 128b \u7684 Load \u76f8\u5f53\u4e8e\u4e24\u4e2a 64b\uff0c\u5bf9\u5e94 IPC \u51cf\u534a\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u5ef6\u8fdf","title":"\u5ef6\u8fdf","text":"<p>\u6784\u9020\u4e32\u884c\u7684 load \u94fe\uff0c\u89c2\u5bdf\u5230\u591a\u6570\u60c5\u51b5\u4e0b load to use latency \u662f 4 \u4e2a\u5468\u671f\uff0c\u5728\u8de8\u8d8a 64B \u8fb9\u754c\u65f6\uff0c\u4f1a\u589e\u52a0\u4e00\u4e2a\u5468\u671f\u53d8\u6210 5 \u4e2a\u5468\u671f\u3002\u6b64\u5916\uff0c\u5982\u679c\u6d89\u53ca\u5230 index \u8ba1\u7b97\uff08\u5373 <code>offset(base, index, shift)</code>\uff09\uff0c\u4e5f\u4f1a\u589e\u52a0\u4e00\u4e2a\u5468\u671f\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#store-to-load-forwarding","title":"Store to Load Forwarding","text":"<p>\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\uff0c\u5982\u4e0b\u7684\u60c5\u51b5\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff1a</p> <p>\u5bf9\u5730\u5740 x \u7684 Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 Load \u6210\u529f\u65f6 y-x \u7684\u53d6\u503c\u8303\u56f4\uff1a</p> Store\\Load 8b Load 16b Load 32b Load 64b Load 8b Store {0} {} {} {} 16b Store [0,1] {0} {} {} 32b Store [0,3] [0,2] {0} {} 64b Store [0,7] [0,6] [0,4] {0} <p>\u53ef\u4ee5\u770b\u5230\uff0cZen 5 \u5728 Store \u5b8c\u5168\u5305\u542b Load \u7684\u60c5\u51b5\u4e0b\u90fd\u53ef\u4ee5\u8f6c\u53d1\uff0c\u6ca1\u6709\u989d\u5916\u7684\u5bf9\u9f50\u8981\u6c42\u3002\u4f46\u5f53 Load \u548c Store \u53ea\u6709\u90e8\u5206\u91cd\u5408\u65f6\uff0c\u5c31\u65e0\u6cd5\u8f6c\u53d1\u3002\u4e24\u4e2a\u8fde\u7eed\u7684 32 \u4f4d\u7684 Store \u548c\u4e00\u4e2a 64 \u4f4d\u7684 Load \u91cd\u5408\u4e5f\u4e0d\u80fd\u8f6c\u53d1\u3002</p> <p>\u53ef\u89c1 Zen 5 \u7684 Store to Load Forwarding \u5b9e\u73b0\u6bd4\u8f83\u7c97\u66b4\uff0c\u53ea\u5141\u8bb8 Load \u4ece\u5355\u4e2a\u5b8c\u5168\u5305\u542b Load \u7684 Store \u4e2d\u8f6c\u53d1\u6570\u636e\u3002\u548c Neoverse V2 \u76f8\u6bd4\uff0cZen 5 \u5bf9 Load \u5728 Store \u5185\u7684\u504f\u79fb\u6ca1\u6709\u8981\u6c42\uff0c\u4f46\u4e5f\u4e0d\u5141\u8bb8 Load \u548c Store \u53ea\u6709\u4e00\u90e8\u5206\u8986\u76d6\uff0c\u4e5f\u4e0d\u652f\u6301\u4e00\u4e2a Load \u4ece\u4e24\u4e2a\u6216\u66f4\u591a\u7684 Store \u4e2d\u83b7\u53d6\u6570\u636e\u3002</p> <p>\u6210\u529f\u8f6c\u53d1\u65f6 8 cycle\uff0c\u6709 Overlap \u4f46\u8f6c\u53d1\u5931\u8d25\u65f6 14-15 cycle\u3002</p> <p>\u5c0f\u7ed3\uff1aZen 5 \u7684 Store to Load Forwarding\uff1a</p> <ul> <li>1 ld + 1 st: \u8981\u6c42 st \u5305\u542b ld</li> <li>1 ld + 2+ st: \u4e0d\u652f\u6301</li> </ul>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l1-dtlb","title":"L1 DTLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a96-entry, fully associative</p> <p>\u4f7f\u7528\u4e0d\u540c footprint \u7684\u968f\u673a\u7684 pointer chasing load \u4e14\u6bcf\u6b21 load \u90fd\u5728\u5355\u72ec\u7684\u9875\u5185\uff0c\u6d4b\u8bd5\u6027\u80fd\uff0c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u89c2\u5bdf\u5230\u660e\u663e\u7684 96 page \u7684\u62d0\u70b9\uff0c\u547d\u4e2d L1 DTLB \u65f6 load to use latency \u662f 4 cycle\uff0c\u547d\u4e2d L2 DTLB \u65f6\u589e\u5927\u5230\u4e86 11 cycle\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l2-dtlb","title":"L2 DTLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a4096-entry, 16-way set associative</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l2-cache","title":"L2 Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a16-way set associative, inclusive, 1MB, &gt;= 14 cycle load to use latency</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#l3-cache","title":"L3 Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a16-way set associative, exclusive</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2024/11/11/amd_zen5/#\u6267\u884c\u5355\u5143","title":"\u6267\u884c\u5355\u5143","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aZen 5 \u7684\u540e\u7aef\u6709 6 \u6761 ALU \u6d41\u6c34\u7ebf\uff0c4 \u6761\u8bbf\u5b58\u6d41\u6c34\u7ebf\uff0c4 \u6761 512 \u4f4d\u5bbd\u5411\u91cf\u6d41\u6c34\u7ebf\uff08\u5176\u4e2d 2 \u6761\u652f\u6301 FMA\uff09\uff0c2 \u6761\u5411\u91cf\u8bbf\u5b58\u6d41\u6c34\u7ebf</p> <p>\u5b9e\u6d4b\u53d1\u73b0 Zen 5 \u6bcf\u5468\u671f\u6700\u591a\u53ef\u4ee5\u6267\u884c 2 \u6761 AVX512 \u7684\u6d6e\u70b9 FMA \u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u5468\u671f\u6d6e\u70b9\u5cf0\u503c\u6027\u80fd\uff1a</p> <ul> <li>\u5355\u7cbe\u5ea6\uff1a<code>512/32*2*2=64</code> FLOP per cycle</li> <li>\u53cc\u7cbe\u5ea6\uff1a<code>512/64*2*2=32</code> FLOP per cycle</li> </ul> <p>\u901a\u8fc7 512 \u4f4d\u7684\u6d6e\u70b9 datapath\uff0c\u7ec8\u4e8e\u8fbe\u5230\u4e86\u7b2c\u4e00\u68af\u961f\u7684\u6d6e\u70b9\u5cf0\u503c\u6027\u80fd\u3002</p>","tags":["cpu","amd","ryzen","zen5","performance","uarch-review"]},{"location":"hardware/2023/10/31/apple-silicon/","title":"Apple \u5904\u7406\u5668","text":"<p>\u672c\u6587\u8bb0\u5f55\u4e86 Apple \u5404\u5904\u7406\u5668\u7684\u53c2\u6570\u3002</p>","tags":["apple","cpu"]},{"location":"hardware/2023/10/31/apple-silicon/#m-\u7cfb\u5217","title":"M \u7cfb\u5217","text":"\u540d\u79f0 CPU \u6838\u5fc3 GPU \u6838\u5fc3 \u795e\u7ecf\u7f51\u7edc\u5f15\u64ce \u5185\u5b58\u5e26\u5bbd \u5185\u5b58\u5927\u5c0f M1 4+4 7/8 16 8GB/16GB M1 Pro 6+2/8+2 14/16 16 200GB/s 16GB/32GB M1 Max 8+2 24/32 16 400GB/s 32GB/64GB M1 Ultra 16+4 48/64 32 800GB/s 64GB/128GB M2 4+4 8/10 16 100GB/s 8GB/16GB/24GB M2 Pro 6+4/8+4 16/19 16 200GB/s 16GB/32GB M2 Max 8+4 30/38 16 400GB/s 32GB/64GB/96GB M2 Ultra 16+8 60/76 32 800GB/s 64GB/128GB/192GB M3 4+4 10 16 100GB/s 8GB/16GB/24GB M3 Pro 5+6/6+6 14/18 16 150GB/s 18GB/36GB M3 Max 10+4/12+4 30/40 16 300/400 GB/s 36GB/48GB/64GB/96GB/128GB M4 3+6/4+6 10 16 120GB/s 8GB/16GB <p>\u6765\u6e90\uff1a</p> <ul> <li>iPad Pro 13\u2011inch (M4) - Tech Specs</li> <li>MacBook Pro (14-inch, 2021) - Technical Specifications</li> <li>iMac (24-inch, M1, 2021) - Technical Specifications</li> <li>MacBook Air (M2, 2022) - Technical Specifications</li> <li>MacBook Pro (16-inch, 2023) - Technical Specifications</li> <li>Mac mini (2023) - Technical Specifications</li> <li>Mac Studio (2022) - Technical Specifications</li> <li>Mac Studio (2023) - Technical Specifications</li> </ul> <p>/proc/cpuinfo:</p> <p>Apple M1 Firestorm:</p> <pre><code>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint\nCPU implementer : 0x61\nCPU architecture: 8\nCPU variant     : 0x1\nCPU part        : 0x023\nCPU revision    : 1\n</code></pre> <p>Apple M1 Icestorm:</p> <pre><code>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint\nCPU implementer : 0x61\nCPU architecture: 8\nCPU variant     : 0x1\nCPU part        : 0x022\nCPU revision    : 1\n</code></pre> <p>See also: https://github.com/util-linux/util-linux/blob/198e920aa24743ef6ace4e07cf6237de527f9261/sys-utils/lscpu-arm.c#L200.</p>","tags":["apple","cpu"]},{"location":"hardware/2024/12/26/apple_m1/","title":"Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u867d\u7136 Apple M1 \u5df2\u7ecf\u662f 2020 \u5e74\u7684\u5904\u7406\u5668\uff0c\u4f46\u5b83\u5bf9\u82f9\u679c\u81ea\u7814\u82af\u7247\u6765\u8bf4\u662f\u4e00\u4e2a\u91cc\u7a0b\u7891\uff0c\u8003\u8651\u5230 X Elite \u5904\u7406\u5668\u7684 Oryon \u5fae\u67b6\u6784\u548c Apple M1 \u6027\u80fd\u6838 Firestorm \u5fae\u67b6\u6784\u7684\u76f8\u4f3c\u6027\uff0c\u8fd8\u662f\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a Firestorm + Icestorm \u5fae\u67b6\u6784\u5728\u5404\u4e2a\u65b9\u9762\u7684\u8868\u73b0\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u5b98\u65b9\u4fe1\u606f","title":"\u5b98\u65b9\u4fe1\u606f","text":"<p>Apple M1 \u7684\u5b98\u65b9\u4fe1\u606f\u4e4f\u5584\u53ef\u9648\uff0c\u5173\u4e8e\u5fae\u67b6\u6784\u7684\u4fe1\u606f\u51e0\u4e4e\u4e3a\u96f6\uff0c\u4f46\u80fd\u4ece\u64cd\u4f5c\u7cfb\u7edf\u6c47\u62a5\u7684\u786c\u4ef6\u4fe1\u606f\u4e2d\u627e\u5230\u4e00\u4e9b\u5185\u5bb9\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u73b0\u6709\u8bc4\u6d4b","title":"\u73b0\u6709\u8bc4\u6d4b","text":"<p>\u7f51\u4e0a\u5df2\u7ecf\u6709\u8f83\u591a\u9488\u5bf9 Apple M1 \u5fae\u67b6\u6784\u7684\u8bc4\u6d4b\u548c\u5206\u6790\uff0c\u5efa\u8bae\u9605\u8bfb\uff1a</p> <ul> <li>Apple Microarchitecture Research by Dougall Johnson</li> <li>Apple Announces The Apple Silicon M1: Ditching x86 - What to Expect, Based on A14 - Anandtech</li> <li>Exploration of Apple CPUs</li> <li>Apple M1 Icestorm \u5fae\u67b6\u6784\u8bc4\u6d4b\uff08\u4e0a\uff09:\u91cd\u94f8\u5c0f\u6838\u8363\u5149</li> <li>Apple M1 Icestorm \u5fae\u67b6\u6784\uff08\u4e0b\uff09:\u91cd\u94f8\u5c0f\u6838\u8363\u5149</li> <li>\u82f9\u679c\u7684\u9ed1\u9b54\u6cd5\uff1fApple M1 \u7684\u6808\u64cd\u4f5c\u6d88\u9664\uff08\u4e0a\uff09</li> <li>\u82f9\u679c\u7684\u9ed1\u9b54\u6cd5\uff1f\uff08\u4e0b\uff09Apple M1 \u7684\u6808\u64cd\u4f5c\u6d88\u9664</li> <li>Apple Firestorm/Icestorm CPU microarchitecture docs</li> <li>The 2020 Mac Mini Unleashed: Putting Apple Silicon M1 To The Test</li> <li>Exploration of Apple CPUs</li> </ul> <p>\u4e0b\u9762\u5206\u5404\u4e2a\u6a21\u5757\u5206\u522b\u8bb0\u5f55\u5b98\u65b9\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5b9e\u6d4b\u7684\u7ed3\u679c\u3002\u8bfb\u8005\u53ef\u4ee5\u5bf9\u7167\u5df2\u6709\u7684\u7b2c\u4e09\u65b9\u8bc4\u6d4b\u7406\u89e3\u3002\u5b98\u65b9\u4fe1\u606f\u4e0e\u5b9e\u6d4b\u7ed3\u679c\u4e00\u81f4\u7684\u6570\u636e\u4f1a\u52a0\u7c97\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#benchmark","title":"Benchmark","text":"<p>Apple Firestorm \u7684\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\u89c1 SPEC\u3002Apple Icestorm \u5c1a\u672a\u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u524d\u7aef","title":"\u524d\u7aef","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u53d6\u6307","title":"\u53d6\u6307","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u5b9e\u9645\u7684 Fetch \u5bbd\u5ea6\uff0c\u53c2\u8003 \u5982\u4f55\u6d4b\u91cf\u771f\u6b63\u7684\u53d6\u6307\u5e26\u5bbd\uff08I-fetch width\uff09 - JamesAslan \u6784\u9020\u4e86\u6d4b\u8bd5\u3002\u5176\u539f\u7406\u662f\u5f53 Fetch \u8981\u8de8\u9875\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4e24\u4e2a\u76f8\u90bb\u9875\u53ef\u80fd\u6620\u5c04\u5230\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u5982\u679c\u8981\u652f\u6301\u5355\u5468\u671f\u8de8\u9875\u53d6\u6307\uff0c\u9700\u8981\u67e5\u8be2\u4e24\u6b21 ITLB\uff0c\u6216\u8005 ITLB \u9700\u8981\u628a\u76f8\u90bb\u4e24\u4e2a\u9875\u7684\u6620\u5c04\u5b58\u5728\u4e00\u8d77\u3002\u8fd9\u4e2a\u573a\u666f\u4e00\u822c\u6bd4\u8f83\u5c11\uff0c\u5904\u7406\u5668\u5f88\u5c11\u4f1a\u9488\u5bf9\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u505a\u4f18\u5316\uff0c\u4f46\u4e5f\u4e0d\u662f\u6ca1\u6709\u3002\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u628a\u5faa\u73af\u653e\u5728\u4e24\u4e2a\u9875\u7684\u8fb9\u754c\u4e0a\uff0c\u53d1\u73b0 Firestorm \u5fae\u67b6\u6784\u9047\u5230\u8de8\u9875\u7684\u53d6\u6307\u65f6\u786e\u5b9e\u4f1a\u62c6\u6210\u4e24\u4e2a\u5468\u671f\u6765\u8fdb\u884c\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u6784\u9020\u4e00\u4e2a\u5faa\u73af\uff0c\u5faa\u73af\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u653e\u5728\u7b2c\u4e00\u4e2a\u9875\u7684\u6700\u540e\u56db\u4e2a\u5b57\u8282\uff0c\u5176\u4f59\u6307\u4ee4\u653e\u7b2c\u4e8c\u4e2a\u9875\u4e0a\uff0c\u90a3\u4e48\u6bcf\u6b21\u5faa\u73af\u7684\u53d6\u6307\u65f6\u95f4\uff0c\u5c31\u662f\u4e00\u4e2a\u5468\u671f\uff08\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u9875\u5185\u7684\u6307\u4ee4\uff09\u52a0\u4e0a\u7b2c\u4e8c\u4e2a\u9875\u5185\u6307\u4ee4\u9700\u8981 Fetch \u7684\u5468\u671f\u6570\uff0c\u591a\u7684\u8fd9\u4e00\u4e2a\u5468\u671f\u5c31\u8db3\u4ee5\u628a Fetch \u5bbd\u5ea6\u4ece\u540e\u7aef\u9650\u5236\u4e2d\u533a\u5206\u5f00\uff0c\u5b9e\u9a8c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u56fe\u4e2d\u84dd\u7ebf\uff08cross-page\uff09\u8868\u793a\u7684\u5c31\u662f\u4e0a\u9762\u6240\u8ff0\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u653e\u4e00\u4e2a\u9875\uff0c\u5176\u4f59\u6307\u4ee4\u653e\u7b2c\u4e8c\u4e2a\u9875\u7684\u60c5\u51b5\uff0c\u6a2a\u5750\u6807\u662f\u7b2c\u4e8c\u4e2a\u9875\u5185\u7684\u6307\u4ee4\u6570\uff0c\u90a3\u4e48\u4e00\u6b21\u5faa\u73af\u7684\u6307\u4ee4\u6570\u7b49\u4e8e\u6a2a\u5750\u6807 +1\u3002\u7eb5\u5750\u6807\u662f\u8fd0\u884c\u5f88\u591a\u6b21\u5faa\u73af\u7684\u603b cycle \u6570\u9664\u4ee5\u5faa\u73af\u6b21\u6570\uff0c\u4e5f\u5c31\u662f\u5e73\u5747\u6bcf\u6b21\u5faa\u73af\u8017\u8d39\u7684\u5468\u671f\u6570\u3002\u53ef\u4ee5\u770b\u5230\u6bcf 16 \u6761\u6307\u4ee4\u4f1a\u591a\u4e00\u4e2a\u5468\u671f\uff0c\u56e0\u6b64 Firestorm \u7684\u524d\u7aef\u53d6\u6307\u5bbd\u5ea6\u786e\u5b9e\u662f 16 \u6761\u6307\u4ee4\u3002\u4e3a\u4e86\u786e\u8ba4\u8fd9\u4e2a\u74f6\u9888\u662f\u7531\u53d6\u6307\u9020\u6210\u7684\uff0c\u53c8\u6784\u9020\u4e86\u4e00\u7ec4\u5b9e\u9a8c\uff0c\u628a\u5faa\u73af\u7684\u6240\u6709\u6307\u4ee4\u90fd\u653e\u5230\u4e00\u4e2a\u9875\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019 Fetch \u4e0d\u518d\u6210\u4e3a\u74f6\u9888\uff08\u56fe\u4e2d aligned\uff09\uff0c\u4e24\u4e2a\u66f2\u7ebf\u7684\u5bf9\u6bd4\u53ef\u4ee5\u660e\u786e\u5730\u5f97\u51fa\u4e0a\u8ff0\u7ed3\u8bba\u3002</p> <p>\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u6d4b\u8bd5 Icestorm\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6bcf 8 \u6761\u6307\u4ee4\u4f1a\u591a\u4e00\u4e2a\u5468\u671f\uff0c\u610f\u5473\u7740 Icestorm \u7684\u524d\u7aef\u53d6\u6307\u5bbd\u5ea6\u4e3a 8 \u6761\u6307\u4ee4\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l1-icache","title":"L1 ICache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u901a\u8fc7 sysctl \u53ef\u4ee5\u770b\u5230\uff0cFirestorm \u5177\u6709 192KB L1 ICache\uff0cIcestorm \u5177\u6709 128KB L1 ICache\uff1a</p> <pre><code>hw.perflevel0.l1icachesize: 196608\nhw.perflevel1.l1icachesize: 131072\n</code></pre> <p>\u4e3a\u4e86\u6d4b\u8bd5 L1 ICache \u5bb9\u91cf\uff0c\u6784\u9020\u4e00\u4e2a\u5177\u6709\u5de8\u5927\u6307\u4ee4 footprint \u7684\u5faa\u73af\uff0c\u7531\u5927\u91cf\u7684 nop \u548c\u6700\u540e\u7684\u5206\u652f\u6307\u4ee4\u7ec4\u6210\u3002\u89c2\u5bdf\u5728\u4e0d\u540c footprint \u5927\u5c0f\u4e0b Firestorm \u7684 IPC\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 footprint \u5728 192 KB \u4e4b\u524d\u65f6\u53ef\u4ee5\u8fbe\u5230 8 IPC\uff0c\u4e4b\u540e\u5219\u5feb\u901f\u964d\u5230 2.22 IPC\uff0c\u8fd9\u91cc\u7684 192 KB \u5c31\u5bf9\u5e94\u4e86 Firestorm \u7684 L1 ICache \u7684\u5bb9\u91cf\u3002\u867d\u7136 Fetch \u53ef\u4ee5\u6bcf\u5468\u671f 16 \u6761\u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u4e00\u6761 64B \u7684\u7f13\u5b58\u884c\uff0c\u7531\u4e8e\u540e\u7aef\u7684\u9650\u5236\uff0c\u53ea\u80fd\u89c2\u5bdf\u5230 8 \u7684 IPC\u3002</p> <p>\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u6d4b\u8bd5 Icestorm\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 footprint \u5728 128 KB \u4e4b\u524d\u65f6\u53ef\u4ee5\u8fbe\u5230 4 IPC\uff0c\u4e4b\u540e\u5219\u5feb\u901f\u964d\u5230 2.10 IPC\uff0c\u8fd9\u91cc\u7684 128 KB \u5c31\u5bf9\u5e94\u4e86 Icestorm \u7684 L1 ICache \u7684\u5bb9\u91cf\u3002\u867d\u7136 Fetch \u53ef\u4ee5\u6bcf\u5468\u671f 8 \u6761\u6307\u4ee4\uff0c\u7531\u4e8e\u540e\u7aef\u7684\u9650\u5236\uff0c\u53ea\u80fd\u89c2\u5bdf\u5230 4 \u7684 IPC\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#btb","title":"BTB","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm","title":"Firestorm","text":"<p>\u6784\u9020\u5927\u91cf\u7684\u65e0\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff08B \u6307\u4ee4\uff09\uff0cBTB \u9700\u8981\u8bb0\u5f55\u8fd9\u4e9b\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\uff0c\u90a3\u4e48\u5982\u679c\u5206\u652f\u6570\u91cf\u8d85\u8fc7\u4e86 BTB \u7684\u5bb9\u91cf\uff0c\u6027\u80fd\u4f1a\u51fa\u73b0\u660e\u663e\u4e0b\u964d\u3002\u5f53\u628a\u5927\u91cf B \u6307\u4ee4\u7d27\u5bc6\u653e\u7f6e\uff0c\u4e5f\u5c31\u662f\u6bcf 4 \u5b57\u8282\u4e00\u6761 B \u6307\u4ee4\u65f6\uff1a</p> <p></p> <p>\u53ef\u89c1\u5728 1024 \u4e2a\u5206\u652f\u4e4b\u5185\u53ef\u4ee5\u8fbe\u5230 1 \u7684 CPI\uff0c\u8d85\u8fc7 1024 \u4e2a\u5206\u652f\uff0c\u51fa\u73b0\u4e86 3 CPI \u7684\u5e73\u53f0\uff0c\u4e00\u76f4\u5ef6\u7eed\u5230 49152 \u4e2a\u5206\u652f\u3002\u8d85\u51fa BTB \u5bb9\u91cf\u4ee5\u540e\uff0c\u5206\u652f\u9884\u6d4b\u65f6\uff0c\u65e0\u6cd5\u4ece BTB \u4e2d\u5f97\u5230\u54ea\u4e9b\u6307\u4ee4\u662f\u5206\u652f\u6307\u4ee4\u7684\u4fe1\u606f\uff0c\u53ea\u80fd\u7b49\u5230\u53d6\u6307\u751a\u81f3\u8bd1\u7801\u540e\u624d\u80fd\u540e\u77e5\u540e\u89c9\u5730\u53d1\u73b0\u8fd9\u662f\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u6027\u80fd\u635f\u5931\uff0c\u51fa\u73b0\u4e86 3 CPI \u7684\u60c5\u51b5\u3002\u7b2c\u4e8c\u4e2a\u62d0\u70b9 49152\uff0c\u5bf9\u5e94\u7684\u662f\u6307\u4ee4 footprint \u8d85\u51fa L1 ICache \u7684\u60c5\u51b5\uff1aL1 ICache \u662f 192KB\uff0c\u6309\u7167\u6bcf 4 \u5b57\u8282\u4e00\u4e2a B \u6307\u4ee4\u8ba1\u7b97\uff0c\u6700\u591a\u53ef\u4ee5\u5b58\u653e 49152 \u6761 B \u6307\u4ee4\u3002</p> <p>\u964d\u4f4e\u5206\u652f\u6307\u4ee4\u7684\u5bc6\u5ea6\uff0c\u5728 B \u6307\u4ee4\u4e4b\u95f4\u63d2\u5165 NOP \u6307\u4ee4\uff0c\u4f7f\u5f97\u6bcf 8 \u4e2a\u5b57\u8282\u6709\u4e00\u6761 B \u6307\u4ee4\uff0c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 CPI=1 \u7684\u62d0\u70b9\u524d\u79fb\u5230 1024 \u4e2a\u5206\u652f\uff0c\u540c\u65f6 CPI=3 \u7684\u5e73\u53f0\u7684\u62d0\u70b9\u4e5f\u524d\u79fb\u5230\u4e86 24576\u3002\u62d0\u70b9\u7684\u524d\u79fb\uff0c\u610f\u5473\u7740 BTB \u91c7\u7528\u4e86\u7ec4\u76f8\u8fde\u7684\u7ed3\u6784\uff0c\u5f53 B \u6307\u4ee4\u7684 PC \u7684\u90e8\u5206\u4f4e\u4f4d\u603b\u662f\u4e3a 0 \u65f6\uff0c\u7ec4\u76f8\u8fde\u7684 Index \u53ef\u80fd\u65e0\u6cd5\u53d6\u5230\u6240\u6709\u7684 Set\uff0c\u5bfc\u81f4\u8868\u73b0\u51fa\u6765\u7684 BTB \u5bb9\u91cf\u53ea\u6709\u90e8\u5206 Set\uff0c\u4f8b\u5982\u6b64\u5904\u5bb9\u91cf\u51cf\u534a\uff0c\u8bf4\u660e\u53ea\u6709\u4e00\u534a\u7684 Set \u88ab\u7528\u5230\u4e86\u3002</p> <p>\u5982\u679c\u8fdb\u4e00\u6b65\u964d\u4f4e B \u6307\u4ee4\u7684\u5bc6\u5ea6\uff0c\u4f7f\u5f97\u5b83\u7684\u4f4e\u82e5\u5e72\u4f4d\u90fd\u7b49\u4e8e 0\uff0c\u6700\u7ec8 CPI=1 \u7684\u62d0\u70b9\u5b9a\u683c\u5728 2 \u6761\u5206\u652f\uff0c\u6b64\u65f6\u5206\u652f\u7684\u95f4\u8ddd\u5927\u4e8e\u6216\u7b49\u4e8e 2048B\uff1bCPI=3 \u7684\u62d0\u70b9\u5b9a\u683c\u5728 6 \u6761\u5206\u652f\uff0c\u6b64\u65f6\u5206\u652f\u7684\u95f4\u8ddd\u5927\u4e8e\u6216\u7b49\u4e8e 32KB\u3002\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\uff0c\u53ef\u4ee5\u8ba4\u4e3a Firestorm \u7684 BTB \u662f 512 Set 2 Way \u7684\u7ed3\u6784\uff0cIndex \u662f PC[10:2]\uff1b\u540c\u65f6\u4e5f\u4fa7\u9762\u4f50\u8bc1\u4e86 192KB L1 ICache \u662f 512 Set 6 Way\uff0cIndex \u662f PC[14:6]\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#icestorm","title":"Icestorm","text":"<p>\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u6d4b\u8bd5 Icestorm\uff0c\u9996\u5148\u7528 4B \u7684\u95f4\u8ddd\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 1024 \u7684\u62d0\u70b9\uff0c1024 \u4e4b\u524d\u662f 1 IPC\uff0c\u4e4b\u540e\u589e\u52a0\u5230 3 IPC\u3002\u6bd4\u8f83\u5947\u602a\u7684\u662f\uff0c\u6ca1\u6709\u770b\u5230\u7b2c\u4e8c\u4e2a\u62d0\u70b9\uff0c\u7b2c\u4e8c\u4e2a\u62d0\u70b9\u5728 8B \u7684\u95f4\u8ddd\u4e0b\u663e\u73b0\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u62d0\u70b9\u524d\u79fb\u5230 512\uff0c\u7b2c\u4e8c\u4e2a\u62d0\u70b9\u51fa\u73b0\u5728 16384\uff0c\u800c Icestorm \u7684 L1 ICache \u5bb9\u91cf\u662f 128KB\uff0c8B \u95f4\u8ddd\u4e0b\u6b63\u597d\u53ef\u4ee5\u4fdd\u5b58 16384 \u4e2a\u5206\u652f\u3002</p> <p>\u7528 16B \u95f4\u8ddd\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u62d0\u70b9\u524d\u79fb\u5230 256\uff0c\u7136\u540e\u51fa\u73b0\u4e86\u4e00\u4e2a 2 CPI \u7684\u65b0\u5e73\u53f0\uff0c2 CPI \u7684\u5e73\u53f0\u7684\u62d0\u70b9\u51fa\u73b0\u5728 2048\uff0c\u7b2c\u4e09\u4e2a\u62d0\u70b9\u51fa\u73b0\u5728 8192\uff0c\u5bf9\u5e94 L1 ICache \u5bb9\u91cf\u3002</p> <p>\u7528 32B \u95f4\u8ddd\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u62d0\u70b9\u5728 1024\uff0c\u7b2c\u4e8c\u4e2a\u62d0\u70b9\u51fa\u73b0\u5728 4096\uff0c\u5bf9\u5e94 L1 ICache \u5bb9\u91cf\uff0c\u6ca1\u6709\u89c2\u5bdf\u5230 2 CPI\u3002</p> <p>\u7528 64B \u95f4\u8ddd\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u62d0\u70b9\u5728 512\uff0c\u7b2c\u4e8c\u4e2a\u62d0\u70b9\u51fa\u73b0\u5728 2048\uff0c\u5bf9\u5e94 L1 ICache \u5bb9\u91cf\u3002</p> <p>Icestorm \u7684 BTB \u6d4b\u8bd5\u7ed3\u679c\u5e76\u4e0d\u50cf Firestorm \u90a3\u6837\u6709\u89c4\u5f8b\uff0c\u6839\u636e\u8fd9\u4e2a\u73b0\u8c61\uff0c\u7ed9\u51fa\u4e00\u4e9b\u731c\u6d4b\uff1a</p> <ol> <li>\u53ef\u80fd\u53ea\u6709\u4e00\u7ea7 BTB\uff0c\u4f46\u5b83\u7684 Index \u51fd\u6570\u8fdb\u884c\u4e86\u4e00\u4e9b Hash \u800c\u975e\u76f4\u63a5\u53d6 PC \u67d0\u51e0\u4f4d\uff0c\u4f7f\u5f97\u968f\u7740\u5206\u652f\u7684\u95f4\u8ddd\u589e\u5927\uff0cCPI=1 \u7684\u62d0\u70b9\u5e76\u975e\u5355\u8c03\u9012\u51cf\uff1b\u4f46\u8fd9\u65e0\u6cd5\u89e3\u91ca\u4e3a\u4f55 16B \u95f4\u8ddd\u65f6\u4f1a\u51fa\u73b0 2 CPI \u7684\u5e73\u53f0</li> <li>\u53ef\u80fd\u6709\u4e24\u7ea7 BTB\uff0c\u5b83\u4eec\u5e76\u975e\u7b80\u5355\u5730\u7ea7\u8054\uff0c\u800c\u662f\u901a\u8fc7\u4e0d\u540c\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u5728\u4e0d\u540c\u7684\u533a\u95f4\u5185\u53d1\u6325\u4f5c\u7528</li> </ol> <p>\u9488\u5bf9 4B \u95f4\u8ddd\u6ca1\u6709\u51fa\u73b0 CPI&gt;3 \u7684\u60c5\u51b5\uff0c\u7ed9\u51fa\u4e00\u4e9b\u731c\u6d4b\uff1a</p> <ol> <li>\u6d4b\u8bd5\u89c4\u6a21\u4e0d\u591f\u5927\uff0c\u628a\u5206\u652f\u6570\u91cf\u7ee7\u7eed\u589e\u5927\uff0c\u624d\u80fd\u51fa\u73b0 CPI&gt;3 \u7684\u60c5\u51b5</li> <li>\u6307\u4ee4\u9884\u53d6\u5668\u5728\u5de5\u4f5c\uff0c\u5f53 footprint \u5927\u4e8e 128KB L1 ICache \u65f6\uff0c\u80fd\u63d0\u524d\u628a\u6307\u4ee4\u53d6\u8fdb\u6765</li> </ol>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l1-itlb","title":"L1 ITLB","text":"<p>\u6784\u9020\u4e00\u7cfb\u5217\u7684 B \u6307\u4ee4\uff0c\u4f7f\u5f97 B \u6307\u4ee4\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 ITLB \u6210\u4e3a\u74f6\u9888\uff0c\u5728 Firestorm \u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u4ece 1 Cycle \u5230 3 Cycle \u7684\u589e\u52a0\u662f\u7531\u4e8e L1 BTB \u7684\u51b2\u7a81\u7f3a\u5931\uff0c\u4e4b\u540e\u5728 192 \u4e2a\u9875\u65f6\u4ece 3 Cycle \u5feb\u901f\u589e\u52a0\u5230 13 Cycle\uff0c\u5219\u5bf9\u5e94\u4e86 192 \u9879\u7684 L1 ITLB \u5bb9\u91cf\u3002</p> <p>\u5728 Icestorm \u4e0a\u91cd\u590d\u5b9e\u9a8c\uff1a</p> <p></p> <p>\u53ea\u6709\u4e00\u4e2a\u62d0\u70b9\uff0c\u5728 128 \u4e2a\u9875\u65f6\uff0c\u6027\u80fd\u4ece 1 Cycle \u4e0b\u964d\u5230 8 Cycle\uff0c\u610f\u5473 L1 ITLB \u5bb9\u91cf\u662f 128 \u9879\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#decode","title":"Decode","text":"<p>\u4ece\u524d\u9762\u7684\u6d4b\u8bd5\u6765\u770b\uff0cFirestorm \u6700\u5927\u89c2\u5bdf\u5230 8 IPC\uff0cIcestorm \u6700\u5927\u89c2\u5bdf\u5230 4 IPC\uff0c\u90a3\u4e48 Decode \u5bbd\u5ea6\u4e5f\u81f3\u5c11\u662f\u8fd9\u4e48\u591a\uff0c\u6682\u65f6\u4e5f\u4e0d\u80fd\u6392\u9664\u6709\u66f4\u5927\u7684 Decode \u5bbd\u5ea6\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#return-stack","title":"Return Stack","text":"<p>\u6784\u9020\u4e0d\u540c\u6df1\u5ea6\u7684\u8c03\u7528\u94fe\uff0c\u6d4b\u8bd5\u6bcf\u6b21\u8c03\u7528\u82b1\u8d39\u7684\u5e73\u5747\u65f6\u95f4\uff0c\u5728 Firestorm \u4e0a\u5f97\u5230\u4e0b\u9762\u7684\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8c03\u7528\u94fe\u6df1\u5ea6\u4e3a 50 \u65f6\u6027\u80fd\u7a81\u7136\u53d8\u5dee\uff0c\u56e0\u6b64 Firestorm \u7684 Return Stack \u6df1\u5ea6\u4e3a 50\u3002\u5728 Icestorm \u4e0a\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8c03\u7528\u94fe\u6df1\u5ea6\u4e3a 32 \u65f6\u6027\u80fd\u7a81\u7136\u53d8\u5dee\uff0c\u56e0\u6b64 Icestorm \u7684 Return Stack \u6df1\u5ea6\u4e3a 32\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u540e\u7aef","title":"\u540e\u7aef","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u7269\u7406\u5bc4\u5b58\u5668\u5806","title":"\u7269\u7406\u5bc4\u5b58\u5668\u5806","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u7269\u7406\u5bc4\u5b58\u5668\u5806\u7684\u5927\u5c0f\uff0c\u4e00\u822c\u4f1a\u7528\u4e24\u4e2a\u4f9d\u8d56\u94fe\u5f88\u957f\u7684\u64cd\u4f5c\u653e\u5728\u5f00\u5934\u548c\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u586b\u5165\u82e5\u5e72\u4e2a\u65e0\u5173\u7684\u6307\u4ee4\uff0c\u5e76\u4e14\u7528\u8fd9\u4e9b\u6307\u4ee4\u6765\u8017\u8d39\u7269\u7406\u5bc4\u5b58\u5668\u5806\u3002Firestorm \u6d4b\u8bd5\u7ed3\u679c\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <ul> <li>32b/64b int\uff1a\u6d4b\u8bd5 speculative 32/64 \u4f4d\u6574\u6570\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 362</li> <li>32b fp\uff1a\u6d4b\u8bd5 speculative 32 \u4f4d\u6d6e\u70b9\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 382</li> <li>flags\uff1a\u6d4b\u8bd5 speculative NZCV \u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 123</li> </ul> <p>Icestorm \u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>32b/64b int\uff1a\u6d4b\u8bd5 speculative 32/64 \u4f4d\u6574\u6570\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 78</li> <li>32b fp\uff1a\u6d4b\u8bd5 speculative 32 \u4f4d\u6d6e\u70b9\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 382</li> <li>flags\uff1a\u6d4b\u8bd5 speculative NZCV \u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 75</li> </ul> <p>\u6ce8\u610f\u8fd9\u91cc\u6d4b\u8bd5\u7684\u90fd\u662f\u80fd\u591f\u7528\u4e8e\u9884\u6d4b\u6267\u884c\u7684\u5bc4\u5b58\u5668\u6570\u91cf\uff0c\u5b9e\u9645\u7684\u7269\u7406\u5bc4\u5b58\u5668\u5806\u8fd8\u9700\u8981\u4fdd\u5b58\u67b6\u6784\u5bc4\u5b58\u5668\u3002\u4f46\u5177\u4f53\u4fdd\u5b58\u591a\u5c11\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u4e0d\u786e\u5b9a\uff0c\u4f46\u81f3\u5c11 32 \u4e2a\u6574\u6570\u901a\u7528\u5bc4\u5b58\u5668\u548c\u6d6e\u70b9\u5bc4\u5b58\u5668\u662f\u4e00\u5b9a\u6709\u7684\uff0c\u4f46\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b\u989d\u5916\u7684\u9700\u8981\u91cd\u547d\u540d\u7684\u72b6\u6001\u4e5f\u8981\u7b97\u8fdb\u6765\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#load-store-unit--l1-dcache","title":"Load Store Unit + L1 DCache","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l1-dcache-\u5bb9\u91cf","title":"L1 DCache \u5bb9\u91cf","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u901a\u8fc7 sysctl \u53ef\u4ee5\u770b\u5230\uff0cFirestorm \u5177\u6709 128KB L1 DCache\uff0cIcestorm \u5177\u6709 64KB L1 DCache\uff1a</p> <pre><code>hw.perflevel0.l1dcachesize: 131072\nhw.perflevel1.l1dcachesize: 65536\n</code></pre> <p>\u6784\u9020\u4e0d\u540c\u5927\u5c0f footprint \u7684 pointer chasing \u94fe\uff0c\u6d4b\u8bd5\u4e0d\u540c footprint \u4e0b\u6bcf\u6761 load \u6307\u4ee4\u8017\u8d39\u7684\u65f6\u95f4\uff0cFirestorm \u4e0a\u7684\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 128KB \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 128KB \u7684 L1 DCache \u5bb9\u91cf\u3002L1 DCache \u8303\u56f4\u5185\u5ef6\u8fdf\u662f 3 cycle\uff0c\u4e4b\u540e\u63d0\u5347\u5230 16 cycle\u3002</p> <p>Icestorm \u4e0a\u7684\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 64KB \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 64KB \u7684 L1 DCache \u5bb9\u91cf\u3002L1 DCache \u8303\u56f4\u5185\u5ef6\u8fdf\u662f 3 cycle\uff0c\u4e4b\u540e\u63d0\u5347\u5230 14 cycle\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l1-dtlb-\u5bb9\u91cf","title":"L1 DTLB \u5bb9\u91cf","text":"<p>\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6d4b\u8bd5 L1 DTLB \u5bb9\u91cf\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21 pointer chasing \u94fe\u7684\u6307\u9488\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 DTLB \u6210\u4e3a\u74f6\u9888\uff0c\u5728 Firestorm \u4e0a\uff1a</p> <p></p> <p>\u4ece 160 \u4e2a\u9875\u5f00\u59cb\u6027\u80fd\u4e0b\u964d\uff0c\u5230 250 \u4e2a\u9875\u65f6\u6027\u80fd\u7a33\u5b9a\u5728 9 CPI\uff0c\u8ba4\u4e3a Firestorm \u7684 L1 DTLB \u6709 160 \u9879\u3002</p> <p>Icestorm:</p> <p></p> <p>\u4ece 128 \u4e2a\u9875\u5f00\u59cb\u6027\u80fd\u4e0b\u964d\uff0c\u5230 160 \u4e2a\u9875\u65f6\u6027\u80fd\u7a33\u5b9a\u5728 10 CPI\uff0c\u8ba4\u4e3a Icestorm \u7684 L1 DTLB \u6709 128 \u9879\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#loadstore-\u5e26\u5bbd","title":"Load/Store \u5e26\u5bbd","text":"<p>\u9488\u5bf9 Load Store \u5e26\u5bbd\uff0c\u5b9e\u6d4b Firestorm \u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u5b8c\u6210\uff1a</p> <ul> <li>3x 128b Load + 1x 128b Store</li> <li>2x 128b Load + 2x 128b Store</li> <li>1x 128b Load + 2x 128b Store</li> <li>2x 128b Store</li> </ul> <p>\u5982\u679c\u628a\u6bcf\u6761\u6307\u4ee4\u7684\u8bbf\u5b58\u4f4d\u5bbd\u4ece 128b \u6539\u6210 256b\uff0c\u8bfb\u5199\u5e26\u5bbd\u4e0d\u53d8\uff0c\u6307\u4ee4\u541e\u5410\u51cf\u534a\u3002\u4e5f\u5c31\u662f\u8bf4\u6700\u5927\u7684\u8bfb\u5e26\u5bbd\u662f 48B/cyc\uff0c\u6700\u5927\u7684\u5199\u5e26\u5bbd\u662f 32B/cyc\uff0c\u4e8c\u8005\u4e0d\u80fd\u540c\u65f6\u8fbe\u5230\u3002</p> <p>\u5b9e\u6d4b Icestorm \u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u5b8c\u6210\uff1a</p> <ul> <li>2x 128b Load</li> <li>1x 128b Load + 1x 128b Store</li> <li>1x 128b Store</li> </ul> <p>\u5982\u679c\u628a\u6bcf\u6761\u6307\u4ee4\u7684\u8bbf\u5b58\u4f4d\u5bbd\u4ece 128b \u6539\u6210 256b\uff0c\u8bfb\u5199\u5e26\u5bbd\u4e0d\u53d8\uff0c\u6307\u4ee4\u541e\u5410\u51cf\u534a\u3002\u4e5f\u5c31\u662f\u8bf4\u6700\u5927\u7684\u8bfb\u5e26\u5bbd\u662f 32B/cyc\uff0c\u6700\u5927\u7684\u5199\u5e26\u5bbd\u662f 16B/cyc\uff0c\u4e8c\u8005\u4e0d\u80fd\u540c\u65f6\u8fbe\u5230\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#memory-dependency-predictor","title":"Memory Dependency Predictor","text":"<p>\u4e3a\u4e86\u9884\u6d4b\u6267\u884c Load\uff0c\u9700\u8981\u4fdd\u8bc1 Load \u548c\u4e4b\u524d\u7684 Store \u8bbf\u95ee\u7684\u5185\u5b58\u6ca1\u6709 Overlap\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u9884\u6d4b\u5668\u6765\u9884\u6d4b Load \u548c Store \u4e4b\u524d\u5728\u5185\u5b58\u4e0a\u7684\u4f9d\u8d56\u3002\u53c2\u8003 Store-to-Load Forwarding and Memory Disambiguation in x86 Processors \u7684\u65b9\u6cd5\uff0c\u6784\u9020\u4e24\u4e2a\u6307\u4ee4\u6a21\u5f0f\uff0c\u5206\u522b\u5728\u5730\u5740\u548c\u6570\u636e\u4e0a\u6709\u4f9d\u8d56\uff1a</p> <ul> <li>\u6570\u636e\u4f9d\u8d56\uff0c\u5730\u5740\u65e0\u4f9d\u8d56\uff1a<code>str x3, [x1]</code> \u548c <code>ldr x3, [x2]</code></li> <li>\u5730\u5740\u4f9d\u8d56\uff0c\u6570\u636e\u65e0\u4f9d\u8d56\uff1a<code>str x2, [x1]</code> \u548c <code>ldr x1, [x2]</code></li> </ul> <p>\u521d\u59cb\u5316\u65f6\uff0c<code>x1</code> \u548c <code>x2</code> \u6307\u5411\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u91cd\u590d\u5982\u4e0a\u7684\u6307\u4ee4\u6a21\u5f0f\uff0c\u89c2\u5bdf\u5230\u591a\u5c11\u6761 <code>ldr</code> \u6307\u4ee4\u65f6\u4f1a\u51fa\u73b0\u6027\u80fd\u4e0b\u964d\uff0c\u5728 Firestorm \u4e0a\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u6570\u636e\u4f9d\u8d56\u6ca1\u6709\u660e\u663e\u7684\u9608\u503c\uff0c\u4f46\u4ece 84 \u5f00\u59cb\u51fa\u73b0\u4e86\u4e00\u4e2a\u5c0f\u7684\u589e\u957f\uff0c\u4e14\u659c\u7387\u4e0d\u4e3a\u96f6\uff1b\u5730\u5740\u4f9d\u8d56\u7684\u9608\u503c\u662f 70\u3002</p> <p>Icestorm:</p> <p></p> <p>\u6570\u636e\u4f9d\u8d56\u548c\u5730\u5740\u4f9d\u8d56\u7684\u9608\u503c\u90fd\u662f 13\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#store-to-load-forwarding","title":"Store to Load Forwarding","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm_1","title":"Firestorm","text":"<p>\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\uff0cFirestorm \u4e0a\u5982\u4e0b\u7684\u60c5\u51b5\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff0c\u5bf9\u5730\u5740 x \u7684 Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 Load \u6210\u529f\u65f6 y-x \u7684\u53d6\u503c\u8303\u56f4\uff1a</p> Store\\Load 8b Load 16b Load 32b Load 64b Load 8b Store {0} [-1,0] [-3,0] [-7,0] 16b Store [0,1] [-1,1] [-3,1] [-7,1] 32b Store [0,3] [-1,3] [-3,3] [-7,3] 64b Store [0,7] [-1,7] [-3,7] [-7,7] <p>\u4ece\u4e0a\u8868\u53ef\u4ee5\u770b\u5230\uff0c\u6240\u6709 Store \u548c Load Overlap \u7684\u60c5\u51b5\uff0c\u65e0\u8bba\u5730\u5740\u504f\u79fb\uff0c\u90fd\u80fd\u6210\u529f\u8f6c\u53d1\u3002\u751a\u81f3\u5728 Load \u6216 Store \u8de8\u8d8a 64B \u7f13\u5b58\u884c\u8fb9\u754c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff0c\u4ee3\u4ef7\u662f\u591a\u4e00\u4e2a\u5468\u671f\u3002</p> <p>\u4e00\u4e2a Load \u9700\u8981\u8f6c\u53d1\u4e24\u4e2a\u3001\u56db\u4e2a\u751a\u81f3\u516b\u4e2a Store \u7684\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u8de8\u8d8a\u7f13\u5b58\u884c\uff0c\u5219\u4e0d\u80fd\u8f6c\u53d1\uff0c\u4f46\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u65e0\u8bba\u5730\u5740\u504f\u79fb\uff0c\u90fd\u53ef\u4ee5\u8f6c\u53d1\uff0c\u53ea\u662f\u6bd4\u4ece\u5355\u4e2a Store \u8f6c\u53d1\u9700\u8981\u591a\u8017\u8d39 1-4 \u4e2a\u5468\u671f\u3002</p> <p>\u6210\u529f\u8f6c\u53d1\u65f6 7.5 cycle\uff0c\u8de8\u7f13\u5b58\u884c\u4e14\u8f6c\u53d1\u5931\u8d25\u65f6 28+ cycle\u3002</p> <p>\u5c0f\u7ed3\uff1aApple Firestorm \u7684 Store to Load Forwarding\uff1a</p> <ul> <li>1 ld + 1 st: \u652f\u6301</li> <li>1 ld + 2 st: \u652f\u6301\uff0c\u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>1 ld + 4 st: \u652f\u6301\uff0c\u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>1 ld + 8 st: \u652f\u6301\uff0c\u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> </ul>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#icestorm_1","title":"Icestorm","text":"<p>\u5728 Icestorm \u4e0a\uff0c\u5982\u679c Load \u548c Store \u8bbf\u95ee\u8303\u56f4\u51fa\u73b0\u91cd\u53e0\uff0c\u5219\u9700\u8981 10 Cycle\uff0c\u65e0\u8bba\u662f\u548c\u51e0\u4e2a Store \u91cd\u53e0\uff0c\u4e5f\u65e0\u8bba\u662f\u5426\u8de8\u7f13\u5b58\u884c\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#load-to-use-latency","title":"Load to use latency","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm_2","title":"Firestorm","text":"<p>\u5b9e\u6d4b Firestorm \u7684 Load to use latency \u9488\u5bf9 pointer chasing \u573a\u666f\u505a\u4e86\u4f18\u5316\uff0c\u5728\u4e0b\u5217\u7684\u573a\u666f\u4e0b\u53ef\u4ee5\u8fbe\u5230 3 cycle:</p> <ul> <li><code>ldr x0, [x0]</code>: load \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> <li><code>ldr x0, [x0, 8]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u7acb\u5373\u6570\u504f\u79fb</li> <li><code>ldr x0, [x0, x1]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u5bc4\u5b58\u5668\u504f\u79fb</li> <li><code>ldp x0, x1, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e00\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul> <p>\u5982\u679c\u8bbf\u5b58\u8de8\u8d8a\u4e86 8B \u8fb9\u754c\uff0c\u5219\u9000\u5316\u5230 4 cycle\u3002</p> <p>\u5728\u4e0b\u5217\u573a\u666f\u4e0b Load to use latency \u5219\u662f 4 cycle\uff1a</p> <ul> <li>load \u7684\u76ee\u7684\u5bc4\u5b58\u5668\u4f5c\u4e3a alu \u7684\u6e90\u5bc4\u5b58\u5668\uff08\u4e0b\u79f0 load to alu latency\uff09</li> <li><code>ldr x0, [sp, x0, lsl #3]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230 index</li> <li><code>ldp x1, x0, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e8c\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#icestorm_2","title":"Icestorm","text":"<p>\u5b9e\u6d4b Icestorm \u7684 Load to use latency \u9488\u5bf9 pointer chasing \u573a\u666f\u505a\u4e86\u4f18\u5316\uff0c\u5728\u4e0b\u5217\u7684\u573a\u666f\u4e0b\u53ef\u4ee5\u8fbe\u5230 3 cycle:</p> <ul> <li><code>ldr x0, [x0]</code>: load \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> <li><code>ldr x0, [x0, 8]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u7acb\u5373\u6570\u504f\u79fb</li> <li><code>ldr x0, [x0, x1]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u5bc4\u5b58\u5668\u504f\u79fb</li> <li><code>ldp x0, x1, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e00\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul> <p>\u5982\u679c\u8bbf\u5b58\u8de8\u8d8a\u4e86 8B/16B/32B \u8fb9\u754c\uff0c\u4f9d\u7136\u662f 3 cycle\uff1b\u8de8\u8d8a\u4e86 64B \u8fb9\u754c\u5219\u9000\u5316\u5230 7 cycle\u3002</p> <p>\u5728\u4e0b\u5217\u573a\u666f\u4e0b Load to use latency \u5219\u662f 4 cycle\uff1a</p> <ul> <li>load \u7684\u76ee\u7684\u5bc4\u5b58\u5668\u4f5c\u4e3a alu \u7684\u6e90\u5bc4\u5b58\u5668\uff08\u4e0b\u79f0 load to alu latency\uff09</li> <li><code>ldr x0, [sp, x0, lsl #3]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230 index</li> <li><code>ldp x1, x0, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e8c\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#\u6267\u884c\u5355\u5143","title":"\u6267\u884c\u5355\u5143","text":"<p>\u60f3\u8981\u6d4b\u8bd5\u6709\u591a\u5c11\u4e2a\u6267\u884c\u5355\u5143\uff0c\u6bcf\u4e2a\u6267\u884c\u5355\u5143\u53ef\u4ee5\u8fd0\u884c\u54ea\u4e9b\u6307\u4ee4\uff0c\u9996\u5148\u8981\u6d4b\u8bd5\u5404\u7c7b\u6307\u4ee4\u5728\u65e0\u4f9d\u8d56\u60c5\u51b5\u4e0b\u7684\u7684 IPC\uff0c\u901a\u8fc7 IPC \u6765\u63a8\u65ad\u6709\u591a\u5c11\u4e2a\u80fd\u591f\u6267\u884c\u8fd9\u7c7b\u6307\u4ee4\u7684\u6267\u884c\u5355\u5143\uff1b\u4f46\u7531\u4e8e\u4e00\u4e2a\u6267\u884c\u5355\u5143\u53ef\u80fd\u53ef\u4ee5\u6267\u884c\u591a\u7c7b\u6307\u4ee4\uff0c\u4e8e\u662f\u8fdb\u4e00\u6b65\u9700\u8981\u89c2\u5bdf\u5728\u6df7\u5408\u4e0d\u540c\u7c7b\u7684\u6307\u4ee4\u65f6\u7684 IPC\uff0c\u4ece\u800c\u63a8\u65ad\u51fa\u5b8c\u6574\u7684\u7ed3\u679c\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm_3","title":"Firestorm","text":"<p>\u5728 Firestorm \u4e0a\u6d4b\u8bd5\u5982\u4e0b\u5404\u7c7b\u6307\u4ee4\u7684\u5ef6\u8fdf\u548c\u6bcf\u5468\u671f\u541e\u5410\uff1a</p> \u6307\u4ee4 \u5ef6\u8fdf \u541e\u5410 asimd int add 2 4 asimd aesd/aese 3 4 asimd aesimc/aesmc 2 4 asimd fabs 2 4 asimd fadd 3 4 asimd fdiv 64b 10 1 asimd fdiv 32b 8 1 asimd fmax 2 4 asimd fmin 2 4 asimd fmla 4 4 asimd fmul 4 4 asimd fneg 2 4 asimd frecpe 3 1 asimd frsqrte 3 1 asimd fsqrt 64b 13 0.5 asimd fsqrt 32b 10 0.5 fp cvtf2i (fcvtzs) - 2 fp cvti2f (scvtf) - 3 fp fabs 2 4 fp fadd 3 4 fp fdiv 64b 10 1 fp fdiv 32b 8 1 fp fjcvtzs - 1 fp fmax 2 4 fp fmin 2 4 fp fmov f2i - 2 fp fmov i2f - 3 fp fmul 4 4 fp fneg 2 4 fp frecpe 3 1 fp frecpx 3 1 fp frsqrte 3 1 fp fsqrt 64b 13 0.5 fp fsqrt 32b 10 0.5 int add 1 4.6 int addi 1 6 int bfm 1 1 int crc 3 1 int csel 1 3 int madd (addend) 1 1 int madd (others) 3 1 int mrs nzcv - 2 int mul 3 2 int nop - 8 int sbfm 1 4.7 int sdiv 7 0.5 int smull 3 2 int ubfm 1 4.7 int udiv 7 0.5 not taken branch - 2 taken branch - 1 mem asimd load - 3 mem asimd store - 2 mem int load - 3 mem int store - 2 <p>\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u521d\u6b65\u5f97\u5230\u7684\u4fe1\u606f\uff1a</p> <ol> <li>\u6807\u91cf\u6d6e\u70b9\u548c ASIMD \u541e\u5410\u6700\u5927\u90fd\u662f 4\uff0c\u610f\u5473\u7740\u6709 4 \u4e2a\u6d6e\u70b9/ASIMD \u6267\u884c\u5355\u5143\uff0c\u4f46\u5e76\u975e\u5b8c\u5168\u5bf9\u79f0\uff0c\u4f8b\u5982 fdiv/frecpe/frecpx/frsqrte/fsqrt/fjcvtzs \u7531\u4e8e\u541e\u5410\u4e0d\u8d85\u8fc7 1\uff0c\u5927\u6982\u7387\u53ea\u80fd\u5728\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\u6267\u884c\u3002\u4f46\u8fd9\u4e9b\u6307\u4ee4\u662f\u4e0d\u662f\u90fd\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\u6267\u884c\uff0c\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u6d4b\u8bd5</li> <li>\u6d6e\u70b9\u548c\u6574\u6570\u4e4b\u95f4\u7684 move \u6216 convert \u6307\u4ee4\uff0cfmov i2f/cvti2f \u541e\u5410\u662f 3\uff0cfmov f2i/cvtf2i \u541e\u5410\u662f 2\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6307\u4ee4\u662f\u5728\u54ea\u4e2a\u6267\u884c\u5355\u5143\u91cc\u5b9e\u73b0\u7684\uff0c\u662f\u5426\u9700\u8981\u540c\u65f6\u5360\u7528\u6574\u6570\u6267\u884c\u5355\u5143\u548c\u6d6e\u70b9\u6267\u884c\u5355\u5143\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6d4b\u8bd5</li> <li>\u6574\u6570\u65b9\u9762\uff0c\u6839\u636e\u541e\u5410\uff0c\u63a8\u65ad\u51fa\u5982\u4e0b\u51e0\u7c7b\u6307\u4ee4\u5bf9\u5e94\u7684\u6267\u884c\u5355\u5143\u6570\u91cf\uff1a<ol> <li>ALU: 6</li> <li>CSEL: 3</li> <li>Mul/Br/MRS NZCV: 2</li> <li>CRC/BFM/MAdd/Div: 1</li> </ol> </li> <li>\u867d\u7136 Br \u7684\u541e\u5410\u53ef\u4ee5\u8fbe\u5230 2\uff0c\u4f46\u662f\u6bcf\u5468\u671f\u53ea\u80fd\u6709\u4e00\u4e2a taken branch\uff1b\u76ee\u524d\u4e00\u4e9b\u67b6\u6784\u53ef\u4ee5\u505a\u5230\u6bcf\u5468\u671f\u8d85\u8fc7\u4e00\u4e2a taken branch\uff0c\u6b64\u65f6 Br \u7684\u541e\u5410\u4e00\u822c\u4f1a\u7ed9\u5230 3</li> <li>\u8bbf\u5b58\u65b9\u9762\uff0c\u6bcf\u5468\u671f\u6700\u591a 3 Load \u6216\u8005 2 Store</li> </ol> <p>\u9996\u5148\u6765\u770b\u6d6e\u70b9\u548c ASIMD \u5355\u5143\uff0c\u6839\u636e\u4e0a\u9762\u7684\u4fe1\u606f\uff0c\u8ba4\u4e3a\u81f3\u5c11\u6709 4 \u4e2a\u6267\u884c\u5355\u5143\uff0c\u6bcf\u4e2a\u6267\u884c\u5355\u5143\u90fd\u53ef\u4ee5\u505a\u8fd9\u4e9b\u64cd\u4f5c\uff1aasimd int add/aes/fabs/fadd/fmax/fmin/fmla/fmul/fneg\uff0c\u4e0b\u9762\u628a\u8fd9\u4e9b\u6307\u4ee4\u79f0\u4e3a basic fp/asimd ops + aes\u3002\u63a5\u4e0b\u6765\u8981\u5224\u65ad\uff0cfmov f2i/fmov i2f/fdiv/frecpe/frecpx/frsqrte/fsqrt \u7531\u54ea\u4e9b\u6267\u884c\u5355\u5143\u8d1f\u8d23\u6267\u884c\uff0c\u65b9\u6cd5\u662f\u628a\u8fd9\u4e9b\u6307\u4ee4\u6df7\u5408\u8d77\u6765\u6d4b\u8bd5\u541e\u5410\uff08\u6b64\u5904\u7684\u541e\u5410\u4e0d\u4ee3\u8868 CPI\uff0c\u800c\u662f\u6bcf\u5468\u80fd\u591f\u6267\u884c\u591a\u5c11\u6b21\u6307\u4ee4\u7ec4\u5408\uff0c\u4f8b\u5982\u7528 2 \u6761\u6307\u4ee4\u7684\u7ec4\u5408\u6d4b\u8bd5\uff0c\u90a3\u4e48\u541e\u5410\u7b49\u4e8e CPI \u9664\u4ee5 2\uff09\uff1a</p> \u6307\u4ee4 \u541e\u5410 fp fdiv + fp frecpe 0.5 fp fdiv + fp frecpx 0.5 fp fdiv + fp frsqrte 0.5 fp fdiv + fp fsqrt 0.32=3/3.12 fp fdiv + fmov f2i 1 fp fdiv + 2x fmov f2i 0.67=1/1.50 fp fdiv + 3x fmov i2f 1 fp fdiv + 4x fmov i2f 0.75=1/1.33 fmov i2f + 4x fp fadd 1 fmov f2i + 4x fp fadd 0.67=1/1.50 <p>\u6839\u636e\u4ee5\u4e0a\u6d4b\u8bd5\u7ed3\u679c\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u7684\u63a8\u8bba\uff1a</p> <ol> <li>fp fdiv/frecpe/frecpx/frsqrte \u6df7\u5408\u7684\u65f6\u5019\uff0c\u541e\u5410\u53ea\u6709\u4e00\u534a\uff0cIPC \u4e0d\u53d8\uff0c\u8bf4\u660e\u8fd9\u4e9b\u6307\u4ee4\u5728\u540c\u4e00\u4e2a\u6267\u884c\u5355\u5143\u4e2d\uff0c\u6df7\u5408\u5e76\u4e0d\u80fd\u5e26\u6765\u66f4\u9ad8\u7684 IPC</li> <li>fp fdiv \u548c fp fsqrt \u6df7\u5408\u65f6\uff0c\u541e\u5410\u4e0b\u964d\u5230 0.32 \u4e00\u4e2a\u4e0d\u592a\u6574\u7684\u6570\u5b57\uff0c\u731c\u6d4b\u662f\u56e0\u4e3a\u5b83\u4eec\u5c5e\u4e8e\u540c\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\u7684\u4e0d\u540c\u6d41\u6c34\u7ebf\uff0c\u62a2\u5360\u5bc4\u5b58\u5668\u5806\u5199\u53e3</li> <li>fp fdiv + fmov f2i \u7684\u65f6\u5019\u541e\u5410\u662f 1\uff0c\u800c fdiv + 2x fmov f2i \u65f6\u541e\u5410\u4e0b\u964d\u5230 0.67\uff0cIPC \u7ef4\u6301\u5728 2\uff0c\u8bf4\u660e\u6709\u4e24\u4e2a\u6267\u884c\u5355\u5143\uff0c\u90fd\u53ef\u4ee5\u6267\u884c fmov f2i\uff0c\u4f46\u53ea\u6709\u5176\u4e2d\u4e00\u4e2a\u53ef\u4ee5\u6267\u884c fp fdiv\uff0c\u5bfc\u81f4 fdiv + 2x fmov f2i \u7684\u65f6\u5019\u4f1a\u62a2\u6267\u884c\u5355\u5143</li> <li>fp fdiv + 3x fmov i2f \u7684\u65f6\u5019\u541e\u5410\u662f 1\uff0c\u800c fdiv + 4x fmov i2f \u65f6\u541e\u5410\u4e0b\u964d\u5230 0.75\uff0c\u6b64\u65f6\u6bcf\u5468\u671f\u8fd8\u662f\u6267\u884c 3 \u6761 fmov i2f \u6307\u4ee4\uff0c\u610f\u5473\u7740 fdiv \u6ca1\u6709\u62a2\u5360 fmov i2f \u7684\u6267\u884c\u5355\u5143\uff0c\u5b83\u4eec\u7528\u7684\u6267\u884c\u5355\u5143\u662f\u72ec\u7acb\u7684</li> <li>fmov i2f + 4x fp fadd \u7684\u65f6\u5019\u541e\u5410\u662f 1\uff0c\u8bf4\u660e fmov i2f \u6ca1\u6709\u62a2\u5360 fp fadd \u7684\u6267\u884c\u5355\u5143</li> </ol> <p>\u63a8\u65ad\u8fd9\u56db\u4e2a\u6267\u884c\u5355\u5143\u652f\u6301\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>basic fp/asimd ops + aes + fdiv + frecpe + frecpx + frsqrte + fsqrt + fmov f2i + cvtf2i</li> <li>basic fp/asimd ops + aes + fmov f2i + cvtf2i</li> <li>basic fp/asimd ops + aes</li> <li>basic fp/asimd ops + aes</li> </ol> <p>\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u6307\u4ee4\u6ca1\u6709\u6d4b\uff0c\u4e0d\u8fc7\u539f\u7406\u662f\u4e00\u6837\u7684\u3002</p> <p>\u8bbf\u5b58\u90e8\u5206\uff0c\u524d\u9762\u5df2\u7ecf\u5728\u6d4b LSU \u7684\u65f6\u5019\u6d4b\u8fc7\u4e86\uff0c\u6bcf\u5468\u671f Load + Store \u4e0d\u8d85\u8fc7 4 \u4e2a\uff0c\u5176\u4e2d Load \u4e0d\u8d85\u8fc7 3 \u4e2a\uff0cStore \u4e0d\u8d85\u8fc7 2 \u4e2a\u3002\u867d\u7136\u4ece IPC \u7684\u89d2\u5ea6\u6765\u770b LSU \u7684 Load/Store Pipe \u672a\u5fc5\u51c6\u786e\uff0c\u6bd4\u5982\u53ef\u80fd\u5b83\u53d1\u5c04\u548c\u63d0\u4ea4\u7684\u5e26\u5bbd\u662f\u4e0d\u540c\u7684\uff0c\u4f46\u5148\u6682\u65f6\u7b80\u5316\u4e3a\u5982\u4e0b\u7684\u6267\u884c\u5355\u5143\uff1a</p> <ol> <li>load + store</li> <li>load</li> <li>load</li> <li>store</li> </ol> <p>\u6700\u540e\u662f\u6574\u6570\u90e8\u5206\u3002\u4ece addi \u7684\u6307\u4ee4\u6765\u770b\uff0c\u6709 6 \u4e2a ALU\uff0c\u80fd\u591f\u6267\u884c\u57fa\u672c\u7684\u6574\u6570\u6307\u4ee4\uff08add/ubfm/sbfm \u7684\u541e\u5410\u6709\u65f6\u5019\u6d4b\u51fa\u6765 4.6-4.7\uff0c\u6709\u65f6\u5019\u6d4b\u51fa\u6765 6\uff0c\u6000\u7591\u662f\u8fdb\u5165\u4e86\u4ec0\u4e48\u4f4e\u529f\u8017\u6a21\u5f0f\uff09\u3002\u4f46\u5176\u4ed6\u5f88\u591a\u6307\u4ee4\u53ef\u80fd\u53ea\u6709\u4e00\u90e8\u5206\u6267\u884c\u5355\u5143\u53ef\u4ee5\u6267\u884c\uff1abfm/crc/csel/madd/mrs nzcv/mul/div/branch/fmov i2f\u3002\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e9b\u6307\u4ee4\u4f7f\u7528\u7684\u6267\u884c\u5355\u5143\u662f\u5426\u91cd\u5408\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u6df7\u5408\u6307\u4ee4\u6d4b\u8bd5\uff0c\u541e\u5410\u7684\u5b9a\u4e49\u548c\u4e0a\u9762\u76f8\u540c\uff1a</p> \u6307\u4ee4 \u541e\u5410 3x int csel + 3x fmov i2f 1 3x int csel + 2x fmov f2i 0.75=1/1.33 3x int csel + int bfm 1 3x int csel + int crc 1 3x int csel + int madd 1 3x int csel + int mul 1 3x int csel + int sdiv 0.5 3x int csel + mrs nzcv 0.75=1/1.33 3x int csel + not taken branch 0.75=1/1.33 mrs nzcv + not taken branch 1 mrs nzcv + 2x not taken branch 0.67=1/1.50 2x fmov f2i + 2x not taken branch 1 2x fmov f2i + 2x int mul 1 int madd + 2x int mul 0.67=1/1.50 int madd + int sdiv 0.5 int madd + int crc 0.5 <p>\u6839\u636e\u4e0a\u8ff0\u7ed3\u679c\u5206\u6790\uff1a</p> <ol> <li>\u541e\u5410\u4e0e\u4e0d\u6df7\u5408\u65f6\u76f8\u540c\uff0c\u4ee3\u8868\u6df7\u5408\u7684\u6307\u4ee4\u5bf9\u5e94\u7684\u6267\u884c\u5355\u5143\u4e0d\u91cd\u5408</li> <li>3x int csel + 2x fmov f2i \u7684 IPC \u7b49\u4e8e 4\uff0c\u610f\u5473\u7740\u6709\u56db\u4e2a\u6267\u884c\u5355\u5143\uff0c\u5176\u4e2d\u6709\u4e09\u4e2a\u53ef\u4ee5\u6267\u884c int csel\uff0c\u4e24\u4e2a\u53ef\u4ee5\u6267\u884c fmov f2i\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5176\u4e2d\u6709\u4e00\u4e2a\u6267\u884c\u5355\u5143\u53ef\u4ee5\u6267\u884c int csel \u548c fmov f2i\uff0c\u5373\u6709\u8fd9\u6837\u7684\u56db\u4e2a\u6267\u884c\u5355\u5143\uff1a<ol> <li>alu + csel</li> <li>alu + csel</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> </ol> </li> <li>3x int csel + mrs nzcv/not taken branch \u7684 IPC \u7b49\u4e8e 3\uff0c\u8bf4\u660e\u5b83\u4eec\u7684\u6267\u884c\u5355\u5143\u662f\u91cd\u5408\u7684\uff1b\u53c8\u56e0\u4e3a 2x fmov f2i + 2x not taken branch \u7684\u541e\u5410\u662f 1\uff0c\u8bf4\u660e\u5b83\u4eec\u7684\u6267\u884c\u5355\u5143\u4e0d\u91cd\u5408\uff0c\u90a3\u4e48\u4e0a\u8ff0\u56db\u4e2a\u6267\u884c\u5355\u5143\u53ea\u80fd\u662f\uff1a<ol> <li>alu + csel + branch</li> <li>alu + csel + branch</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> </ol> </li> <li>mrs nzcv + 2x not taken branch \u7684 IPC \u7b49\u4e8e 2\uff0c\u8bf4\u660e\u5b83\u4eec\u7684\u6267\u884c\u5355\u5143\u662f\u91cd\u5408\u7684\uff0c\u90a3\u4e48\u4e0a\u8ff0\u56db\u4e2a\u6267\u884c\u5355\u5143\u662f\uff1a<ol> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> </ol> </li> <li>csel \u548c mul \u4e0d\u91cd\u5408\uff0cf2i \u548c mul \u4e5f\u4e0d\u91cd\u5408\uff0c\u8bf4\u660e mul \u5728\u5269\u4e0b\u7684\u4e24\u4e2a\u6267\u884c\u5355\u5143\u5185\uff1a<ol> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> <li>alu + mul</li> <li>alu + mul</li> </ol> </li> <li>madd \u548c mul \u91cd\u5408\uff0cmadd \u548c crc \u91cd\u5408\uff0c\u90a3\u4e48\uff1a<ol> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> <li>alu + mul + madd + crc</li> <li>alu + mul</li> </ol> </li> </ol> <p>\u5f97\u5230\u521d\u6b65\u7684\u7ed3\u679c\uff1a</p> <ol> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> <li>alu + mul + madd + crc</li> <li>alu + mul</li> </ol> <p>\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684\u6307\u4ee4\u6ca1\u6709\u6d4b\u8bd5\uff0c\u4e0d\u8fc7\u65b9\u6cd5\u662f\u7c7b\u4f3c\u7684\u3002\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u503c\u5f97\u4e00\u63d0\u7684\u70b9\uff1a</p> <ol> <li>fmov f2i \u540c\u65f6\u5360\u7528\u4e86\u4e24\u4e2a\u6d6e\u70b9\u6267\u884c\u5355\u5143\u548c\u4e24\u4e2a\u6574\u6570\u6267\u884c\u5355\u5143\uff0c\u8fd9\u4e3b\u8981\u662f\u4e3a\u4e86\u590d\u7528\u5bc4\u5b58\u5668\u5806\u8bfb\u5199\u53e3\uff1afmov f2i \u9700\u8981\u8bfb\u6d6e\u70b9\u5bc4\u5b58\u5668\u5806\uff0c\u53c8\u9700\u8981\u5199\u6574\u6570\u5bc4\u5b58\u5668\u5806\uff0c\u90a3\u5c31\u5728\u6d6e\u70b9\u4fa7\u8bfb\u5bc4\u5b58\u5668\uff0c\u5728\u6574\u6570\u4fa7\u5199\u5bc4\u5b58\u5668\u3002</li> <li>fmov i2f \u65e2\u4e0d\u5728\u6d6e\u70b9\uff0c\u4e5f\u4e0d\u5728\u6574\u6570\uff0c\u90a3\u53ea\u80fd\u5728\u8bbf\u5b58\u4e86\uff1a\u800c\u6b63\u597d\u8bbf\u5b58\u6267\u884c\u5355\u5143\u9700\u8981\u8bfb\u6574\u6570\uff0c\u5199\u6574\u6570\u6216\u6d6e\u70b9\uff0c\u90a3\u5c31\u53ef\u4ee5\u590d\u7528\u5b83\u7684\u5bc4\u5b58\u5668\u5806\u5199\u53e3\u6765\u5b9e\u73b0 fmov i2f \u7684\u529f\u80fd\u3002</li> <li>\u53ef\u89c1\u6574\u6570/\u6d6e\u70b9/\u8bbf\u5b58\u6267\u884c\u5355\u5143\u5e76\u4e0d\u662f\u5b8c\u5168\u9694\u79bb\u7684\uff0c\u4f8b\u5982\u4e00\u4e9b\u5fae\u67b6\u6784\uff0c\u6574\u6570\u548c\u6d6e\u70b9\u662f\u76f4\u63a5\u653e\u5728\u4e00\u8d77\u7684\u3002</li> </ol> <p>\u5c0f\u7ed3\uff1aFirestorm \u7684\u6267\u884c\u5355\u5143\u5982\u4e0b\uff1a</p> <ol> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + branch + mrs nzcv</li> <li>alu + csel + fmov f2i</li> <li>alu + fmov f2i</li> <li>alu + mul + madd + crc</li> <li>alu + mul</li> <li>load + store</li> <li>load</li> <li>load</li> <li>store</li> <li>basic fp/asimd ops + aes + fdiv + frecpe + frecpx + frsqrte + fsqrt + fmov f2i + cvtf2i</li> <li>basic fp/asimd ops + aes + fmov f2i + cvtf2i</li> <li>basic fp/asimd ops + aes</li> <li>basic fp/asimd ops + aes</li> </ol>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#icestorm_3","title":"Icestorm","text":"<p>\u63a5\u4e0b\u6765\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6d4b\u8bd5 Icestorm\uff1a</p> \u6307\u4ee4 \u5ef6\u8fdf \u541e\u5410 asimd int add 2 2 asimd aesd/aese 3 2 asimd aesimc/aesmc 2 2 asimd fabs 2 2 asimd fadd 3 2 asimd fdiv 64b 11 0.5 asimd fdiv 32b 9 0.5 asimd fmax 2 2 asimd fmin 2 2 asimd fmla 4 2 asimd fmul 4 2 asimd fneg 2 2 asimd frecpe 4 0.5 asimd frsqrte 4 0.5 asimd fsqrt 64b 15 0.5 asimd fsqrt 32b 12 0.5 fp cvtf2i (fcvtzs) - 1 fp cvti2f (scvtf) - 2 fp fabs 2 2 fp fadd 3 2 fp fdiv 64b 10 1 fp fdiv 32b 8 1 fp fjcvtzs - 0.5 fp fmax 2 2 fp fmin 2 2 fp fmov f2i - 1 fp fmov i2f - 2 fp fmul 4 2 fp fneg 2 2 fp frecpe 3 1 fp frecpx 3 1 fp frsqrte 3 1 fp fsqrt 64b 13 0.5 fp fsqrt 32b 10 0.5 int add 1 3 int addi 1 3 int bfm 1 1 int crc 3 1 int csel 1 3 int madd (addend) 1 1 int madd (others) 3 1 int mrs nzcv - 3 int mul 3 1 int nop - 4 int sbfm 1 3 int sdiv 7 0.125=1/8 int smull 3 1 int ubfm 1 3 int udiv 7 0.125=1/8 not taken branch - 2 taken branch - 1 mem asimd load - 2 mem asimd store - 1 mem int load - 2 mem int store - 1 <p>\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u521d\u6b65\u5f97\u5230\u7684\u4fe1\u606f\uff1a</p> <ol> <li>\u6807\u91cf\u6d6e\u70b9\u548c ASIMD \u541e\u5410\u6700\u5927\u90fd\u662f 2\uff0c\u610f\u5473\u7740\u6709 2 \u4e2a\u6d6e\u70b9/ASIMD \u6267\u884c\u5355\u5143\uff0c\u4f46\u5e76\u975e\u5b8c\u5168\u5bf9\u79f0\uff0c\u4f8b\u5982 fdiv/frecpe/frecpx/frsqrte/fsqrt/fjcvtzs \u7531\u4e8e\u541e\u5410\u4e0d\u8d85\u8fc7 1\uff0c\u5927\u6982\u7387\u53ea\u80fd\u5728\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\u6267\u884c\u3002\u4f46\u8fd9\u4e9b\u6307\u4ee4\u662f\u4e0d\u662f\u90fd\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\u6267\u884c\uff0c\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u6d4b\u8bd5</li> <li>\u6574\u6570\u65b9\u9762\uff0c\u6839\u636e\u541e\u5410\uff0c\u63a8\u65ad\u51fa\u5982\u4e0b\u51e0\u7c7b\u6307\u4ee4\u5bf9\u5e94\u7684\u6267\u884c\u5355\u5143\u6570\u91cf\uff1a<ol> <li>ALU/CSEL/MRS NZCV/SBFM/UBFM: 3</li> <li>Br: 2</li> <li>Mul/CRC/BFM/MAdd/Div: 1</li> </ol> </li> <li>\u867d\u7136 Br \u7684\u541e\u5410\u53ef\u4ee5\u8fbe\u5230 2\uff0c\u4f46\u662f\u6bcf\u5468\u671f\u53ea\u80fd\u6709\u4e00\u4e2a taken branch</li> <li>\u8bbf\u5b58\u65b9\u9762\uff0c\u6bcf\u5468\u671f\u6700\u591a 2 Load \u6216\u8005 1 Store</li> </ol> <p>\u8fd8\u662f\u5148\u770b\u6d6e\u70b9\uff0c\u57fa\u672c\u6307\u4ee4 add/aes/fabs/fadd/fmax/fmin/fmla/fmul/fneg \u90fd\u80fd\u505a\u5230 2 \u7684\u541e\u5410\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e24\u4e2a\u6307\u5b9a\u5355\u5143\u90fd\u80fd\u6267\u884c\u8fd9\u4e9b\u57fa\u672c\u6307\u4ee4\u3002\u63a5\u4e0b\u6765\u6d4b\u5176\u4f59\u6307\u4ee4\u7684\u6df7\u5408\u541e\u5410\uff08\u541e\u5410\u5b9a\u4e49\u89c1\u4e0a\uff09\uff1a</p> \u6307\u4ee4 \u541e\u5410 fp fdiv + fp frecpe 0.5 fp fdiv + fp frecpx 0.5 fp fdiv + fp frsqrte 0.5 fp fdiv + fp fsqrt 0.31=3/3.25 fp fdiv + fmov f2i 0.5 fp fdiv + 2x fmov i2f 1 fp fdiv + 3x fmov i2f 0.67/1/1.50 <p>\u53ef\u89c1 fdiv/frecpe/frecpx/frsqrte/fsqrt/fmov f2i \u90fd\u5728\u540c\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5185\uff1a</p> <ol> <li>basic fp/asimd ops + aes + fdiv + frecpe + frecpx + frsqrte + fsqrt + fmov f2i</li> <li>basic fp/asimd ops + aes</li> </ol> <p>\u8fd8\u6709\u5f88\u591a\u6307\u4ee4\u6ca1\u6709\u6d4b\uff0c\u4e0d\u8fc7\u539f\u7406\u662f\u4e00\u6837\u7684\u3002\u8bbf\u5b58\u5728\u524d\u9762\u6d4b LSU \u7684\u65f6\u5019\u5df2\u7ecf\u6d4b\u8fc7\u4e86\uff1a</p> <ol> <li>load + store</li> <li>load</li> </ol> <p>\u6700\u540e\u662f\u6574\u6570\u90e8\u5206\u3002\u4ece addi \u7684\u6307\u4ee4\u6765\u770b\uff0c\u6709 3 \u4e2a ALU\uff0c\u80fd\u591f\u6267\u884c\u57fa\u672c\u7684\u6574\u6570\u6307\u4ee4\u3002\u4f46\u5176\u4ed6\u5f88\u591a\u6307\u4ee4\u53ef\u80fd\u53ea\u6709\u4e00\u90e8\u5206\u6267\u884c\u5355\u5143\u53ef\u4ee5\u6267\u884c\uff1abfm/crc/csel/madd/mul/div/branch\u3002\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e9b\u6307\u4ee4\u4f7f\u7528\u7684\u6267\u884c\u5355\u5143\u662f\u5426\u91cd\u5408\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u6df7\u5408\u6307\u4ee4\u6d4b\u8bd5\uff0c\u541e\u5410\u7684\u5b9a\u4e49\u548c\u4e0a\u9762\u76f8\u540c\uff1a</p> \u6307\u4ee4 \u541e\u5410 int madd + int mul 0.5 int madd + int crc 0.5 int madd + 2x not taken branch 1 <p>\u7531\u6b64\u53ef\u89c1\uff0cmadd/mul/crc \u662f\u4e00\u4e2a\u6267\u884c\u5355\u5143\uff0c\u548c branch \u7684\u4e24\u4e2a\u6267\u884c\u5355\u5143\u4e0d\u91cd\u5408\uff0c\u56e0\u6b64\u6574\u6570\u4fa7\u7684\u6267\u884c\u5355\u5143\u6709\uff1a</p> <ol> <li>alu + csel + mrs nzcv + branch</li> <li>alu + csel + mrs nzcv + branch</li> <li>alu + csel + mrs nzcv + madd + mul + crc</li> </ol> <p>\u5c0f\u7ed3\uff1aIcestorm \u7684\u6267\u884c\u5355\u5143\u5982\u4e0b\uff1a</p> <ol> <li>alu + csel + mrs nzcv + branch</li> <li>alu + csel + mrs nzcv + branch</li> <li>alu + csel + mrs nzcv + madd + mul + crc</li> <li>load + store</li> <li>load</li> <li>basic fp/asimd ops + aes + fdiv + frecpe + frecpx + frsqrte + fsqrt + fmov f2i</li> <li>basic fp/asimd ops + aes</li> </ol>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#scheduler","title":"Scheduler","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5 Scheduler \u7684\u5927\u5c0f\u548c\u7ec4\u7ec7\u65b9\u5f0f\uff08\u5206\u5e03\u5f0f\u8fd8\u662f\u96c6\u4e2d\u5f0f\uff09\uff0c\u6d4b\u8bd5\u65b9\u6cd5\u662f\uff1a\u9996\u5148\u7528\u957f\u5ef6\u8fdf\u7684\u64cd\u4f5c\u5835\u4f4f ROB\uff0c\u63a5\u7740\u7528\u82e5\u5e72\u6761\u4f9d\u8d56\u957f\u5ef6\u8fdf\u64cd\u4f5c\u7684\u6307\u4ee4\u5835\u4f4f Scheduler\uff0c\u5f53\u6307\u4ee4\u585e\u4e0d\u8fdb\u53bb\u7684\u65f6\u5019\uff0c\u5c31\u8bf4\u660e Scheduler \u6ee1\u4e86\u3002\u66f4\u8fdb\u4e00\u6b65\uff0c\u7531\u4e8e\u73b0\u5728\u5f88\u591a\u5904\u7406\u5668\u4f1a\u5f15\u5165 Non Scheduling Queue\uff0c\u91cc\u9762\u7684\u6307\u4ee4\u4e0d\u4f1a\u76f4\u63a5\u8c03\u5ea6\u8fdb\u6267\u884c\u5355\u5143\uff0c\u4e5f\u4e0d\u68c0\u67e5\u5b83\u4f9d\u8d56\u7684\u64cd\u4f5c\u6570\u662f\u5426\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u6b64\u65f6\u4e3a\u4e86\u533a\u5206\u53ef\u8c03\u5ea6\u90e8\u5206\u548c\u4e0d\u53ef\u8c03\u5ea6\u90e8\u5206\uff0c\u5728\u4f9d\u8d56\u957f\u5ef6\u8fdf\u64cd\u4f5c\u7684\u6307\u4ee4\u540e\u9762\uff0c\u6dfb\u52a0\u82e5\u5e72\u6761\u4e0d\u4f9d\u8d56\u957f\u5ef6\u8fdf\u64cd\u4f5c\u7684\u6307\u4ee4\uff0c\u8fd9\u6837\u6d4b\u51fa\u6765\u7684\u5c31\u662f\u53ef\u8c03\u5ea6\u90e8\u5206\u7684\u6df1\u5ea6\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm_4","title":"Firestorm","text":"<p>\u5728 Firestorm \u4e0a\u6d4b\u8bd5\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a</p> \u6307\u4ee4 \u53ef\u8c03\u5ea6 + \u4e0d\u53ef\u8c03\u5ea6 \u53ef\u8c03\u5ea6 ld 58 48 st 58 43 alu 158 134 fp 156 144 crc 40 28 idiv 40 28 bfm 40 28 fjcvtzs 42 36 fmov f2i 84 72 csel 76 64 mrs nzcv 62 50 <p>\u9996\u5148\u770b\u6d6e\u70b9\uff1a</p> <ol> <li>\u53ef\u8c03\u5ea6\u90e8\u5206 fp \u662f 144\uff0cfmov f2i \u662f 72\uff0cfjcvtzs \u662f 36\uff0c\u6709\u660e\u663e\u7684 4:2:1 \u7684\u5173\u7cfb</li> <li>fp/fmov f2i/fjcvtzs \u541e\u5410\u521a\u597d\u4e5f\u662f 4:2:1 \u7684\u5173\u7cfb</li> <li>\u56e0\u6b64\u56db\u4e2a\u6267\u884c\u5355\u5143\u524d\u9762\u5404\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 36 entry \u7684 Scheduler</li> <li>\u4e0d\u53ef\u8c03\u5ea6\u90e8\u5206\uff0c156-144=12\uff0c84-72=12\uff0c42-36=6\uff0c\u731c\u6d4b\u6709\u4e24\u4e2a Non Scheduling Queue\uff0c\u6bcf\u4e2a Non Scheduling Queue 6 entry\uff0c\u5206\u522b\u5bf9\u5e94\u4e24\u4e2a Scheduler</li> </ol> <p>\u4e0b\u9762\u662f\u8bbf\u5b58\u90e8\u5206\uff0cload \u548c store \u603b\u6570\u4e00\u6837\u4f46 Scheduler \u5dee\u4e86 5\uff0c\u4e0d\u786e\u5b9a\u662f\u6d4b\u8bd5\u8bef\u5dee\u8fd8\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u6682\u4e14\u8003\u8651\u4e3a\u4e00\u4e2a\u7edf\u4e00\u7684 Scheduler \u548c\u540c\u4e00\u4e2a Non Scheduling Queue\u3002</p> <p>\u6700\u540e\u662f\u6574\u6570\u90e8\u5206\uff0c\u7531\u4e8e\u6709 6 \u4e2a\u6574\u6570\u6267\u884c\u5355\u5143\uff0c\u60c5\u51b5\u4f1a\u6bd4\u8f83\u590d\u6742\uff1a</p> <ol> <li>\u53ef\u8c03\u5ea6\u90e8\u5206 alu \u4e00\u5171\u662f 134\uff0c\u5176\u4e2d csel \u662f 64\uff0ccrc/idiv/bfm \u90fd\u662f 28\uff0cmrs nzcv \u662f 50\uff0c\u7ed3\u5408\u516d\u4e2a\u6574\u6570\u6267\u884c\u5355\u5143\uff0c\u53ef\u4ee5\u5f97\u5230\u8fd9\u516d\u4e2a\u6267\u884c\u5355\u5143\u5bf9\u5e94\u7684 Scheduler \u5927\u5c0f\u5173\u7cfb\uff1a<ol> <li>alu + csel + branch + mrs nzcv: x entries</li> <li>alu + csel + branch + mrs nzcv: 50-x entries</li> <li>alu + csel + fmov f2i: 14 entries</li> <li>alu + fmov f2i: y entries</li> <li>alu + mul + madd + crc: 28 entries</li> <li>alu + mul: 42-y entries</li> </ol> </li> <li>alu \u4e0d\u53ef\u8c03\u5ea6\u90e8\u5206\u662f 158-134=24\uff0ccrc/idiv/bfm/csel/mrs nzcv \u4e0d\u53ef\u8c03\u5ea6\u90e8\u5206\u90fd\u662f 12\uff0c\u8003\u8651\u5230 csel \u5bf9\u5e94\u524d\u4e09\u4e2a\u6267\u884c\u5355\u5143\uff0c\u5e76\u4e14\u548c mrs nzcv \u4e00\u6837\u591a\uff0c\u8bf4\u660e\u524d\u4e09\u4e2a\u6267\u884c\u5355\u5143\u5171\u4eab\u4e00\u4e2a 12 entry \u7684 Non Scheduling Queue\uff1b\u5269\u4e0b\u4e09\u4e2a\u6267\u884c\u5355\u5143\u5171\u4eab\u5269\u4e0b\u7684 12 entry \u7684 Non Scheduling Queue</li> <li>\u6700\u540e\u53ea\u5dee x \u548c y \u7684\u53d6\u503c\u6ca1\u6709\u6c42\u51fa\u6765\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fdb\u4e00\u6b65\u6d4b\u8bd5\u6765\u66f4\u52a0\u7cbe\u786e\u5730\u6c42\u51fa</li> </ol>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#reorder-buffer","title":"Reorder Buffer","text":"","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#firestorm_5","title":"Firestorm","text":"<p>Firestorm \u7684 ROB \u91c7\u7528\u7684\u662f\u6bd4\u8f83\u7279\u522b\u7684\u65b9\u6848\uff0c\u5b83\u7684 entry \u5730\u4f4d\u4e0d\u662f\u7b49\u540c\u7684\uff0c\u800c\u662f\u82e5\u5e72\u4e2a entry \u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u6210\u4e3a\u4e00\u4e2a group\uff0c\u6bcf\u4e2a group \u6709\u82e5\u5e72\u4e2a entry\uff0c\u4e00\u4e2a group \u5bf9 group \u5185\u6307\u4ee4\u7684\u7c7b\u578b\u548c\u6570\u91cf\u6709\u8981\u6c42\uff0c\u8fd9\u5c31\u5bfc\u81f4\u7528\u4f20\u7edf\u65b9\u6cd5\u6d4b Firestorm \u7684 ROB\uff0c\u53ef\u80fd\u4f1a\u6d4b\u5230\u7279\u522b\u5de8\u5927\u7684\u6570\uff1a2200+\uff0c\u4e5f\u53ef\u80fd\u6d4b\u5230\u6bd4\u8f83\u5c0f\u7684\u6570\uff1a320+\uff0c\u8fd9\u5c31\u548c\u6307\u4ee4\u7c7b\u578b\u6709\u5173\u7cfb\u3002\u4e3a\u4ec0\u4e48\u5bf9\u6307\u4ee4\u7684\u7c7b\u578b\u548c\u4f4d\u7f6e\u6709\u8981\u6c42\u5462\uff0c\u8fd9\u662f\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u3002\u5f88\u591a\u6307\u4ee4\u662f\u6ca1\u6709\u526f\u4f5c\u7528\u7684\uff0c\u4e5f\u4e0d\u4f1a\u629b\u5f02\u5e38\uff0c\u8fd9\u4e9b\u6307\u4ee4\u53ef\u4ee5\u6bd4\u8f83\u968f\u610f\u5730\u653e\u7f6e\uff1b\u4f46\u662f\u5bf9\u4e8e\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\uff0cretire \u65f6\u662f\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\uff0c\u56e0\u6b64\u4e00\u4e2a\u5408\u7406\u7684\u8bbe\u8ba1\u5c31\u662f\uff0c\u8ba9\u8fd9\u4e9b\u6307\u4ee4\u53ea\u80fd\u653e\u5728 group \u7684\u5f00\u5934\u3002</p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0 Firestorm \u4e0a pointer chasing \u7684\u5ef6\u8fdf\u6ce2\u52a8\u6bd4\u8f83\u5927\uff0c\u76ee\u6d4b\u662f prefetcher \u505a\u4e86\u9488\u5bf9\u6027\u7684\u4f18\u5316\uff0c\u56e0\u6b64\u7528 fsqrt chain \u6765\u505a\u5ef6\u8fdf\uff0cFirestorm \u4e0a\u4e00\u6761\u53cc\u7cbe\u5ea6 fsqrt \u7684\u5ef6\u8fdf\u662f 13 \u4e2a\u5468\u671f\u3002\u6784\u9020\u4e00\u4e2a\u5faa\u73af\uff0c\u5faa\u73af\u5305\u62ec M \u4e2a\u4e32\u884c\u7684 sqrt \u548c N \u4e2a nop\uff0c\u5982\u679c\u6ca1\u6709\u89e6\u78b0\u5230 ROB \u7684\u74f6\u9888\uff0c\u90a3\u4e48\u5f53 N \u6bd4\u8f83\u5c0f\u7684\u65f6\u5019\uff0c\u74f6\u9888\u5728\u4e32\u884c fsqrt \u4e0a\uff0c\u6bcf\u6b21\u5faa\u73af\u7684\u5468\u671f\u6570\u5e94\u8be5\u4e3a <code>M*13</code>\uff1b\u5f53 N \u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u74f6\u9888\u5728\u6bcf\u4e2a\u5468\u671f\u6267\u884c 8 \u4e2a NOP \u4e0a\uff08NOP \u88ab eliminate \u4e86\uff0c\u4e0d\u7528\u8fdb ALU\uff0c\u53ef\u4ee5\u6253\u6ee1 8 \u7684\u53d1\u5c04\u5bbd\u5ea6\uff09\uff0c\u6bcf\u6b21\u5faa\u73af\u7684\u5468\u671f\u6570\u5e94\u8be5\u4e3a <code>N/8</code> \u518d\u52a0\u4e0a\u4e00\u4e2a\u5e38\u6570\u3002</p> <p>\u4f46\u5f53 N \u5f88\u5927\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u649e\u4e0a ROB \u5927\u5c0f\u7684\u9650\u5236\u3002\u4e0b\u9762\u7ed9\u51fa\u4e86\u4e0d\u540c\u7684 M \u53d6\u503c\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5faa\u73af\u5468\u671f\u6570\u5728 <code>M*13</code> \u5de6\u53f3\u7684\u6700\u5927\u7684 N \u53d6\u503c\uff1a</p> <ul> <li>M=21, N &lt;= 2109, cycle=273.74, M*13=273</li> <li>M=22, N &lt;= 2205, cycle=286.75, M*13=286</li> <li>M=23, N &lt;= 2269, cycle=299.76, M*13=299</li> <li>M=24, N &lt;= 2277, cycle=312.77, M*13=312</li> <li>M=25, N &lt;= 2275, cycle=325.77, M*13=325</li> <li>M=26, N &lt;= 2274, cycle=338.77, M*13=338</li> </ul> <p>\u53ef\u4ee5\u770b\u5230 N \u6700\u5927\u5728 2277 \u9644\u8fd1\u5c31\u4e0d\u80fd\u518d\u589e\u52a0\u4e86\uff0c\u8bf4\u660e\u9047\u5230\u4e86 ROB \u7684\u74f6\u9888\uff0c\u9884\u8ba1 ROB \u7684\u6240\u6709 group \u7684 entry \u4e2a\u6570\u52a0\u8d77\u6765\u5927\u6982\u662f 2277 \u5de6\u53f3\u3002</p> <p>\u800c\u5982\u679c\u628a\u586b\u5145\u7684\u6307\u4ee4\u6539\u6210 load/store\uff0cinflight \u7684 load \u548c store \u6700\u591a\u90fd\u662f 325 \u4e2a\uff0c\u5e76\u4e14\u8fd9\u548c load/store queue \u5927\u5c0f\u65e0\u5173\uff0c\u800c load/store \u53c8\u662f\u6709\u526f\u4f5c\u7528\u7684\uff0c\u5f88\u53ef\u80fd\u662f\u56e0\u4e3a\u5b83\u4eec\u53ea\u80fd\u5728 ROB \u6bcf\u4e2a group \u91cc\u53ea\u80fd\u653e\u4e00\u6761\uff0c\u4e8e\u662f\u770b\u8d77\u6765 ROB \u7684\u5bb9\u91cf\u6bd4 2277 \u5c0f\u4e86\u5f88\u591a\uff0c\u53ea\u8868\u73b0\u51fa 325\u3002\u6309\u7167\u8fd9\u4e2a\u731c\u60f3\uff0c\u5bf9\u4e8c\u8005\u8fdb\u884c\u9664\u6cd5\uff0c\u53d1\u73b0\u5546\u548c 7 \u5341\u5206\u63a5\u8fd1\uff0c\u8fd9\u5927\u6982\u7387\u610f\u5473\u7740 Firestorm \u7684 ROB \u6709 325 \u5de6\u53f3\u4e2a group\uff0c\u6bcf\u4e2a group \u5185\u6709 7 \u4e2a entry\uff0c\u6bcf\u4e2a entry \u53ef\u4ee5\u653e\u4e00\u6761\u6307\u4ee4\uff08uop\uff09\u3002\u6d4b\u8bd5\u91cc\u5f00\u5934\u7684 20 \u4e2a sqrt \u4e5f\u8981\u5360\u7528 ROB\uff0c\u5b9e\u9645\u7684 ROB group \u6570\u91cf\u53ef\u80fd\u6bd4 325 \u7565\u591a\u3002</p> <p>\u7ed3\u8bba\uff1aFirestorm \u7684 ROB \u6709\u5927\u7ea6 330 \u4e2a group\uff0c\u6bcf\u4e2a group \u6700\u591a\u4fdd\u5b58 7 \u4e2a uop\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l2-cache","title":"L2 Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u901a\u8fc7 sysctl \u53ef\u4ee5\u770b\u5230\uff0c4 \u4e2a Firestorm \u6838\u5fc3\u5171\u4eab\u4e00\u4e2a 12MB L2 Cache\uff0c4 \u4e2a Icestorm \u6838\u5fc3\u5171\u4eab\u4e00\u4e2a 4MB L2 Cache\uff1a</p> <pre><code>hw.perflevel0.l2cachesize: 12582912\nhw.perflevel0.cpusperl2: 4\nhw.perflevel1.l2cachesize: 4194304\nhw.perflevel1.cpusperl2: 4\n</code></pre>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2024/12/26/apple_m1/#l2-tlb","title":"L2 TLB","text":"<p>\u4ece\u82f9\u679c\u63d0\u4f9b\u7684\u6027\u80fd\u8ba1\u6570\u5668\u6765\u770b\uff0cL1 TLB \u5206\u4e3a\u6307\u4ee4\u548c\u6570\u636e\uff0c\u800c L2 TLB \u662f Unified\uff0c\u4e0d\u533a\u5206\u6307\u4ee4\u548c\u6570\u636e\u3002\u6cbf\u7528\u4e4b\u524d\u6d4b\u8bd5 L1 DTLB \u7684\u65b9\u6cd5\uff0c\u628a\u89c4\u6a21\u6269\u5927\u5230 L2 Unified TLB \u7684\u8303\u56f4\uff0c\u5c31\u53ef\u4ee5\u6d4b\u51fa\u6765 L2 Unified TLB \u7684\u5bb9\u91cf\uff0c\u4e0b\u9762\u662f Firestorm \u4e0a\u7684\u6d4b\u8bd5\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u62d0\u70b9\u662f 3072 \u4e2a Page\uff0c\u8bf4\u660e Firestorm \u7684 L2 TLB \u5bb9\u91cf\u662f 3072 \u9879\u3002</p> <p>\u5728 Icestorm \u4e0a\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u62d0\u70b9\u662f 1024 \u4e2a Page\uff0c\u8bf4\u660e Icestorm \u7684 L2 TLB \u5bb9\u91cf\u662f 1024 \u9879\u3002</p>","tags":["cpu","firestorm","icestorm","apple","m1","performance","uarch-review"]},{"location":"hardware/2018/11/06/archlinuxarm-on-sfpi/","title":"\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM","text":"<p>\u4e4b\u524d\u7531\u4e8e\u6211\u7684 macOS \u4e0a\u4e0d\u77e5\u9053\u4e3a\u5565\u4e0d\u80fd\u628a\u6211\u7684 TF \u5361\u8bbe\u5907\u653e\u5230\u6211\u7684\u865a\u62df\u673a\u91cc\uff0c\u6240\u4ee5\u4e4b\u524d\u5c31\u6ca1\u80fd\u5237 ArchLinuxARM \u4e0a\u53bb\u3002\u4eca\u5929\u6211\u60f3\u5230\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5b8c\u6210\u4e86\u8fd9\u4ef6\u65f6\u671f\uff1a</p> <pre><code>$ wget https://mirrors.tuna.tsinghua.edu.cn/archlinuxarm/os/ArchLinuxARM-armv7-latest.tar.gz\n$ dd if=/dev/zero of=archlinuxarm.img bs=1M count=1024\n$ mkfs.ext4 archlinuxarm.img\n$ sudo mkdir -p /mnt/archlinuxarm\n$ sudo mount -o loop archlinuxarm.img /mnt/archlinuxarm\n$ sudo bsdtar -xpf ArchLinuxARM-armv7-latest.tar.gz -C /mnt/archlinuxarm\n$ sudo umount /mnt/archlinuxarm\n</code></pre> <p>\u8fd9\u6837\u5c31\u83b7\u5f97\u4e86\u4e00\u4e2a ext4 \u7684 ArchlinuxARM \u955c\u50cf\u3002\u521a\u597d\u89e3\u538b\u51fa\u6765\u4e0d\u5230 1G\uff0c\u6240\u4ee5\u5f00\u4e86 1G \u7684\u955c\u50cf\u521a\u597d\u653e\u5f97\u4e0b\u3002\u7136\u540e\u628a archlinuxarm.img \u62f7\u56de macOS\uff0c\u7136\u540e\u7528 dd \u5199\u8fdb\u53bb\uff1a</p> <pre><code>$ sudo dd if=archlinuxarm.img of=/dev/rdisk4s2 bs=1048576\n</code></pre> <p>\u8fd9\u65f6\u5019\u53ef\u4ee5\u786e\u8ba4\uff0c\u6211\u4eec\u786e\u5b9e\u662f\u5f97\u5230\u4e86\u4e00\u4e2a\u6b63\u786e\u7684 ext4fs\uff1a</p> <pre><code>$ sudo /usr/local/opt/e2fsprogs/sbin/tune2fs -l /dev/disk4s2\n</code></pre> <p>\u4e0d\u8fc7\uff0c\u6211\u4eec\u5b9e\u9645\u7684\u5206\u533a\u5927\u5c0f\u53ef\u80fd\u4e0d\u6b62 1G\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fee\u6539\u4e00\u4e0b\u5927\u5c0f\uff1a</p> <pre><code>$ sudo /usr/local/opt/e2fsprogs/sbin/resize2fs -p /dev/disk4s2\n</code></pre> <p>\u8fd9\u6837\u5c31\u6210\u529f\u5730\u628a ArchlinuxARM \u5199\u8fdb\u53bb\u4e86\u3002\u9ed8\u8ba4\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u90fd\u662f root\uff0c\u53ef\u4ee5\u6210\u529f\u901a\u8fc7\u4e32\u53e3\u767b\u5f55\u3002</p>","tags":["sfpi","saltedfishpi","dd","extfs","ext4"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/","title":"ARM M1 MacBook Air \u5f00\u7bb1","text":"","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u8d2d\u4e70","title":"\u8d2d\u4e70","text":"<p>\u6211\u662f 11.12 \u7684\u65f6\u5019\u5728 Apple Store \u4e0a\u4e0b\u5355\u7684\uff0c\u9009\u7684\u662f MacBookAir\uff0c\u5e26 M1 \u82af\u7247\uff0c8 \u6838 CPU + 8 \u6838 GPU\uff0c\u52a0\u4e86\u4e00\u4e9b\u5185\u5b58\u548c\u786c\u76d8\u3002\u4eca\u5929\uff0811.19\uff09\u7684\u65f6\u5019\u987a\u4e30\u5230\u8d27\uff0c\u6bd4 Apple Store \u4e0a\u663e\u793a\u7684\u9884\u8ba1\u5230\u8fbe\u65f6\u95f4 21-28 \u53f7\u8981\u66f4\u65e9\u3002\u53e6\u5916\uff0c\u6211\u4e5f\u542c\u670b\u53cb\u8bf4\u73b0\u5728\u4e00\u4e9b\u7ebf\u4e0b\u7684\u5e97\u4e5f\u6709\u8d27\uff0c\u4e5f\u6709\u670b\u53cb\u76f4\u63a5\u5728\u4eac\u4e1c\u4e0a\u4e70\u5230\u4e86 Mac mini\uff0c\u603b\u4e4b\u7b2c\u4e00\u6ce2 M1 \u7684\u7528\u6237\u6700\u8fd1\u5e94\u8be5\u90fd\u53ef\u4ee5\u62ff\u5230\u8bbe\u5907\u4e86\u3002</p> <p>\u73b0\u5728\u8fd9\u7bc7\u535a\u5ba2\uff0c\u5c31\u662f\u5728 ARM MBA \u4e0a\u7f16\u5199\u7684\uff0c\u4f7f\u7528\u7684\u662f Intel \u7684 VSCode\uff0c\u6bd5\u7adf VSCode \u7684 ARM64 \u7248\u4e0d\u4e45\u540e\u624d\u6b63\u5f0f\u53d1\u5e03\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u5f00\u7bb1","title":"\u5f00\u7bb1","text":"<p>\u4ece\u5916\u89c2\u6765\u770b\uff0c\u4e00\u5207\u90fd\u548c Intel MBA \u4e00\u6837\uff0c\u5305\u88c5\u4e0a\u4e5f\u770b\u4e0d\u51fa\u533a\u522b\uff0c\u6a21\u5177\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p></p> <p>\u8fdb\u4e86\u7cfb\u7edf\u624d\u80fd\u770b\u5f97\u51fa\u533a\u522b\u3002\u9884\u88c5\u7684\u7cfb\u7edf\u662f macOS Big Sur 11.0\uff0c\u4e4b\u540e\u624b\u52a8\u66f4\u65b0\u5230\u4e86\u76ee\u524d\u6700\u65b0\u7684 11.0.1\u3002</p> <p>\u987a\u5e26 @FactorialN \u540c\u5b66\u63d0\u9192\u6211\u5728\u8fd9\u91cc\u63d0\u4e00\u53e5\uff1a\u5305\u88c5\u91cc\u6709\u7535\u6e90\u9002\u914d\u5668\uff0c\u4e0d\u592a\u73af\u4fdd\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u4f53\u9a8c","title":"\u4f53\u9a8c","text":"","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#arm64","title":"ARM64","text":"<p>\u9996\u5148\u81ea\u7136\u662f\u4f20\u7edf\u827a\u80fd\uff0c\u8bc1\u660e\u4e00\u4e0b\u786e\u5b9e\u662f Apple Silicon\uff1a</p> <pre><code>$ uname -a\nDarwin macbookair.lan 20.1.0 Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:10 PDT 2020; root:xnu-7195.50.7~2/RELEASE_ARM64_T8101 x86_64\n</code></pre> <p>\u554a\u5bf9\u4e0d\u8d77\u6211\u7528\u9519\u4e86\uff0c\u4e0a\u9762\u662f\u5728 Rosetta \u91cc\u9762\u8dd1\u7684 shell \u770b\u5230\u7684\u7ed3\u679c\u3002\u5b9e\u9645\u662f\u8fd9\u6837\u5b50\u7684\uff1a</p> <pre><code>$ uname -a\nDarwin macbookair.lan 20.1.0 Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:10 PDT 2020; root:xnu-7195.50.7~2/RELEASE_ARM64_T8101 arm64\n</code></pre> <p>\u8d27\u771f\u4ef7\u5b9e\u7684 ARM64 \u5185\u6838\uff0c\u7cfb\u7edf\u7684\u5f88\u591a binary \u4e5f\u90fd\u662f Universal \u7684\uff1a</p> <pre><code>$ file /bin/bash\n/bin/bash: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e]\n/bin/bash (for architecture x86_64):    Mach-O 64-bit executable x86_64\n/bin/bash (for architecture arm64e):    Mach-O 64-bit executable arm64e\n</code></pre>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#rosetta","title":"Rosetta","text":"<p>\u63a5\u7740\uff0c\u5c31\u662f\u91cd\u5934\u620f Rosetta \u4e86\u3002\u7b2c\u4e00\u6b21\u6253\u5f00 Intel \u7684\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u5f39\u51fa\u7a97\u53e3\u5b89\u88c5 Rosetta\uff0c\u786e\u5b9a\u4ee5\u540e\u7acb\u9a6c\u5c31\u88c5\u597d\u4e86\u3002\u63a5\u7740\u5e38\u7528\u7684\u5404\u79cd\u8f6f\u4ef6\u5565\u7684\uff0c\u90fd\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u3002</p> <p>\u552f\u4e00\u80fd\u770b\u51fa\u533a\u522b\u7684\uff0c\u5c31\u662f\u5728 Activity Monitor \u53ef\u4ee5\u770b\u5230\u67b6\u6784\u7684\u533a\u522b\uff1a</p> <p></p> <p>\u5b9e\u9645\u4f53\u9a8c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u6ca1\u6709\u4ec0\u4e48\u611f\u89c9\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 Terminal \u4e0b\u6253\u5f00\u7684\u662f ARM64 \u67b6\u6784\u7684\uff0c\u5982\u679c\u8981\u5207\u6362\u7684\u8bdd\uff0c\u53ea\u9700\u8981\uff1a</p> <pre><code>$ uname -m\narm64\n$ arch -arch x86_64 uname -m\nx86_64\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002\u5982\u679c\u5f00\u4e86\u4e00\u4e2a x86_64 \u7684 shell\uff0c\u5728 shell \u91cc\u9762\u6267\u884c\u7684\u547d\u4ee4\u5c31\u90fd\u662f x86_64 \u67b6\u6784\u7684\u4e86\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#homebrew","title":"Homebrew","text":"<p>\u76ee\u524d\uff0cHomebrew \u7684\u652f\u6301\u662f\u8fd9\u6837\u5b50\u7684\uff0cIntel \u7684 Homebrew \u5de5\u4f5c\u5f88\u6b63\u5e38\uff0c\u6ca1\u6709\u9047\u5230\u4efb\u4f55\u95ee\u9898\u3002\u3002ARM \u7684 Homebrew \u76ee\u524d\u8fd8\u5728\u8fdb\u884c\u79fb\u690d\uff0c\u7531\u4e8e\u5b98\u65b9\u7684 build farm \u8fd8\u6ca1\u6709\u652f\u6301 ARM\uff0c\u6240\u4ee5\u5404\u79cd\u5305\u90fd\u9700\u8981\u81ea\u5df1\u7f16\u8bd1\uff0c\u8bd5\u4e86\u51e0\u4e2a\u5e38\u7528\u7684\u8f6f\u4ef6\u90fd\u6ca1\u95ee\u9898\u3002</p> <p>\u76ee\u524d Homebrew \u63a8\u8350\u7684\u65b9\u6cd5\u662f\uff0c\u5728\u8001\u5730\u65b9 <code>/usr/local/Homebrew</code> \u4e0b\u9762\u653e Intel \u7684 Homebrew\uff0c\u5728 <code>/opt/homebrew</code> \u4e0b\u9762\u653e ARM \u7684 Homebrew\u3002\u867d\u7136\u8fd8\u662f\u6709\u5f88\u591a\u8b66\u544a\uff0c\u4f46\u76ee\u524d\u6765\u770b\u57fa\u672c\u4f7f\u7528\u90fd\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u3002Homebrew cask \u4e5f\u6b63\u5e38\uff0c\u6bd5\u7adf\u57fa\u672c\u5c31\u662f\u4e00\u4e2a\u4e0b\u8f7d\u5668\u3002</p> <p>\u53e6\u5916\uff0c\u8bd5\u4e86\u4e00\u4e0b\u7528 ARM Homebrew \u4ece\u6e90\u7801\u7f16\u8bd1 GCC\uff0c\u7f16\u8bd1\u4e2d\u9014\u5931\u8d25\u4e86\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u5176\u4ed6\u8f6f\u4ef6","title":"\u5176\u4ed6\u8f6f\u4ef6","text":"<p>\u6362\u5230 ARM \u4e0a\u81ea\u7136\u4f1a\u60f3\u5230\uff0c\u4e4b\u524d\u7684\u90a3\u4e9b\u8f6f\u4ef6\u8fd8\u80fd\u4e0d\u80fd\u8dd1\u3002\u7b54\u6848\u662f\uff0c\u5927\u591a\u90fd\u53ef\u4ee5\uff0c\u53ea\u662f\u5f88\u591a\u8fd8\u662f Intel \u7248\u8d70\u7ffb\u8bd1\u800c\u5df2\u3002</p> <p>\u76ee\u524d\u5df2\u7ecf\u6d4b\u8bd5\u8fc7\u6b63\u5e38\u4f7f\u7528\u7684\uff1aVSCode\u3001Google Chrome\u3001Alacrity\u3001iStat Menus\u3001Alfred\u3001Rectangle\u3001Typora\u3001Microsoft Office\u3001Karabiner Elements\u3001Jetbrains Toolbox\u3001WeChat\u3001CineBench\u3001Dozer\u3001Squirrel\u3001Zoom\u3001Tencent Meeting\u3001Seafile\u3001Skim\u3001Mendeley\u30011 Password\u3001Wireshark\u3001Slack\u3001iMazing\u3001Office for Mac\u3002</p> <p>\u8fd9\u4e9b\u91cc\u9762\u5df2\u7ecf\u79fb\u690d\u5230 ARM64 \u7684\u6709 Alfred\u3001iStat Menus\u3001Karabiner Elements\u3001Rectangle\u3001Google Chrome\u3001Slack\u3001Typora\u3001iMazing\u3001Office for Mac\u3001Zoom\u3001VSCode Insiders\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u90e8\u5206\u662f\u5df2\u7ecf\u79fb\u690d\u5230 ARM64 \u7684\uff0c\u6709\u4e00\u4e9b\u4e5f\u5f88\u5feb\u5c31\u4f1a\u79fb\u690d\u8fc7\u6765\u3002\u5176\u4e2d iStat Menus \u7684\u7535\u6c60\u5065\u5eb7\u663e\u793a\u6709\u70b9 BUG\uff0c\u5176\u4ed6\u6ca1\u53d1\u73b0\u95ee\u9898\uff08\u66f4\u65b0\uff1a\u5df2\u4fee\u590d\uff09\u3002</p> <p>\u53e6\u5916\uff0c\u5927\u5bb6\u4e5f\u77e5\u9053 ARM Mac \u5f88\u91cd\u8981\u7684\u4e00\u70b9\u662f\u53ef\u4ee5\u8dd1 iOS Apps\uff0c\u6211\u4eec\u4e5f\u786e\u5b9e\u8dd1\u4e86\u4e00\u4e9b\uff0c\u4e0d\u8fc7\u90fd\u6709\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li>Doodle Jump\uff1a\u8dd1\u8d77\u6765\u5f88\u6b63\u5e38\uff0c\u5c31\u662f\u5361\u5173\u4e86\uff0c\u522b\u95ee\u4e3a\u4ec0\u4e48\uff0c\u6ca1\u6709\u52a0\u901f\u5ea6\u8ba1\uff0c\u518d\u600e\u4e48\u6643\u7535\u8111\u4e5f\u4e0d\u4f1a\u52a8</li> <li>Bilibili\uff1a\u90e8\u5206\u5185\u5bb9\u53ef\u4ee5\u52a0\u8f7d\u51fa\u6765\uff0c\u90e8\u5206\u4e0d\u53ef\u4ee5\uff0c\u4f30\u8ba1\u662f\u4ec0\u4e48\u7ec4\u4ef6\u6ca1\u6709\u914d\u7f6e\u597d</li> <li>QQ Music\uff1a\u53ef\u4ee5\u8dd1\u8d77\u6765\uff0c\u4f46\u662f\u5728\u542f\u52a8\u4e4b\u540e\u7684\u5f15\u5bfc\u9875\u9762\uff0c\u671f\u671b\u7528\u6237\u70b9\u4e00\u4e0b\u5c4f\u5e55\uff0c\u4f46\u600e\u4e48\u7528\u9f20\u6807\u70b9\u90fd\u6ca1\u53cd\u5e94</li> <li>Weibo\uff1a\u6bd5\u7adf\u6b63\u5e38\uff0c\u53ef\u4ee5\u6b63\u5e38\u6d4f\u89c8\u5565\u90fd\uff0c\u5c31\u662f UI \u6709\u70b9\u9519\u4f4d\uff0c\u4f30\u8ba1\u662f\u56e0\u4e3a\u663e\u793a\u7a97\u53e3\u548c\u5b9e\u9645\u90fd\u4e0d\u5927\u4e00\u6837\uff0c\u5c0f\u95ee\u9898\u3002</li> <li>Network Tools\uff1a\u5f88\u6b63\u5e38\uff0c\u5404\u79cd\u7f51\u7edc\u4fe1\u606f\u90fd\u53ef\u4ee5\u6b63\u5e38\u53d6\u51fa\u6765\u3002</li> <li>NFSee\uff1a\u6ca1\u6709 NFC \u8bfb\u5361\u529f\u80fd\uff0c\u81ea\u7136\u6ca1\u6cd5\u7528\u3002</li> <li>\u5f69\u4e91\u5929\u6c14\uff08ColorfulClouds Weather\uff09\uff1a\u6b63\u5e38\u4f7f\u7528\u3002</li> </ul> <p>\u5176\u4ed6\u8fd8\u6709\u5f88\u591a App \u8fd8\u6ca1\u6709\u6d4b\u8bd5\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u53d1\u70ed","title":"\u53d1\u70ed","text":"<p>\u5927\u5bb6\u4e5f\u77e5\u9053\uff0c\u8fd9\u6b3e MBA \u662f\u6ca1\u6709\u98ce\u6247\u7684\u3002\u4f46\u6211\u5b9e\u9645\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff0c\u786e\u5b9e\u4e0d\u5927\u9700\u8981\u3002\u62ff stress \u8dd1\u4e86\u4e00\u6bb5\u65f6\u95f4 CPU \u6ee1\u8f7d\u8fd0\u884c\uff0c\u4e5f\u6ca1\u611f\u89c9\u5230\u7535\u8111\u53d1\u70ed\uff0c\u53ea\u662f\u5728\u66f4\u65b0 macOS Big Sur 11.0.1 \u7684\u65f6\u5019\u7a0d\u5fae\u70ed\u4e86\u4e00\u70b9\u70b9\uff0c\u4e5f\u53ea\u662f\u4e00\u70b9\u70b9\uff0c\u8ddd\u79bb\u70eb\u624b\u8fd8\u6709\u5f88\u957f\u7684\u8ddd\u79bb\u3002</p> <p>\u7eed\u822a\u65b9\u9762\u76ee\u524d\u6765\u770b\u4e5f\u633a\u597d\u7684\uff0c\u6363\u9f13\u4e86\u4e00\u4e2a\u4e0b\u5348\uff0c\u4e5f\u6ca1\u8017\u591a\u5c11\u7535\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u6027\u80fd\u6d4b\u8bd5","title":"\u6027\u80fd\u6d4b\u8bd5","text":"<p>\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u8fdb\u884c OpenSSL \u6d4b\u8bd5\uff1a</p> <pre><code>$ openssl speed -evp aes-128-cbc aes-256-cbc des-ede3 rsa2048 sha256\n# M1 MacBookAir\nOpenSSL 1.1.1j  16 Feb 2021\nbuilt on: Wed Feb 17 12:34:00 2021 UTC\noptions:bn(64,64) rc4(int) des(int) aes(partial) idea(int) blowfish(ptr) \ncompiler: clang -fPIC -arch arm64 -O3 -Wall -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DVPAES_ASM -DECP_NISTZ256_ASM -DPOLY1305_ASM -D_REENTRANT -DNDEBUG\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\ndes ede3         30466.76k    30644.63k    30592.26k    30106.97k    29961.69k    29951.49k\naes-256 cbc     229863.42k   238671.82k   232654.34k   237194.70k   238092.29k   237791.91k\naes-128-cbc    1020384.58k  1427866.73k  1521123.84k  1558199.30k  1569978.99k  1566288.55k\nsha256          378646.12k  1140355.52k  1894169.69k  2287211.18k  2445602.42k  2453209.09k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.000561s 0.000014s   1782.0  69645.9\n# AMD EPYC 7742\nOpenSSL 1.1.1d  10 Sep 2019\nbuilt on: Mon Dec  7 20:44:45 2020 UTC\noptions:bn(64,64) rc4(8x,int) des(int) aes(partial) blowfish(ptr)\ncompiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O2 -fdebug-prefix-map=/build/openssl-CKx7Fo/openssl-1.1.1d=. -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\ndes ede3         28734.07k    28942.08k    28982.78k    29217.91k    29136.21k    29103.45k\naes-256 cbc     176843.84k   183040.83k   183156.82k   184132.61k   184464.73k   184642.22k\naes-128-cbc     602680.15k  1178207.32k  1239931.82k  1251810.30k  1258359.47k  1261316.78k\nsha256          201482.20k   513504.00k  1075572.14k  1474850.82k  1648746.50k  1663030.61k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.000620s 0.000018s   1613.7  54756.4\n# AMD EPYC 7282\nOpenSSL 1.1.1d  10 Sep 2019\nbuilt on: Mon Apr 20 20:23:01 2020 UTC\noptions:bn(64,64) rc4(8x,int) des(int) aes(partial) blowfish(ptr)\ncompiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O2 -fdebug-prefix-map=/build/openssl-8Ocme2/openssl-1.1.1d=. -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\ndes ede3         27052.31k    27392.85k    27455.57k    27569.49k    27503.27k    27514.20k\naes-256 cbc     158578.10k   168502.21k   172365.91k   173904.90k   174391.30k   174429.53k\naes-128-cbc     594506.35k  1111762.07k  1169014.02k  1184384.00k  1192793.56k  1189167.10k\nsha256          194382.61k   487875.93k  1017121.56k  1390122.33k  1558735.53k  1572274.18k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.000655s 0.000019s   1526.8  52089.2\n# AMD EPYC 7551\nOpenSSL 1.1.1d  10 Sep 2019\nbuilt on: Tue Feb 16 22:08:43 2021 UTC\noptions:bn(64,64) rc4(8x,int) des(int) aes(partial) blowfish(ptr)\ncompiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O2 -fdebug-prefix-map=/build/openssl-m9Qnvk/openssl-1.1.1d=. -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\ndes ede3         20850.88k    21260.78k    21315.84k    21368.49k    21321.05k    21392.04k\naes-256 cbc     122059.94k   125701.42k   126591.06k   126770.52k   127049.73k   126937.77k\naes-128-cbc     441625.34k   883733.48k   928208.21k   941480.96k   944889.86k   945307.65k\nsha256          151161.13k   388304.60k   809272.15k  1106645.33k  1238966.27k  1249219.93k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.001096s 0.000033s    912.8  30284.7\n# Intel Xeon E5-2699 v4 (Broadwell)\nOpenSSL 1.0.2u  20 Dec 2019\nbuilt on: reproducible build, date unspecified\noptions:bn(64,64) rc4(16x,int) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx)\ncompiler: gcc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -Wa,--noexecstack -m64 -DL_ENDIAN -O3 -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DRC4_ASM -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes\ndes ede3         29863.80k    30156.69k    30243.07k    30237.70k    30302.21k\naes-256 cbc     103491.45k   110240.94k   112029.95k   112400.38k   112833.88k\naes-128-cbc     734225.68k   788483.88k   802857.39k   805860.69k   807848.62k\nsha256           82720.89k   184528.45k   342888.28k   425826.30k   457149.10k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.000573s 0.000017s   1745.5  60236.3\n# Intel Xeon E5-2680 v4 (Broadwell) TODO\n# Intel Xeon Gold 5218 (Cascade Lake) TODO\n# IBM POWER8NVL\nOpenSSL 1.1.1  11 Sep 2018\nbuilt on: Wed Feb 17 12:35:54 2021 UTC\noptions:bn(64,64) rc4(char) des(int) aes(partial) blowfish(ptr)\ncompiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O3 -fdebug-prefix-map=/build/openssl-avwOZX/openssl-1.1.1=. -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DAES_ASM -DVPAES_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\ndes ede3         25120.65k    25479.70k    25570.13k    25604.10k    25616.38k    25613.65k\naes-256 cbc      79140.44k    82350.23k    83815.94k    84183.72k    84290.22k    84306.60k\naes-128-cbc     310027.28k   647168.64k   890896.81k   984001.19k  1014827.69k  1017096.87k\nsha256           58347.98k   151006.68k   286465.28k   373490.69k   411044.52k   414012.76k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.001442s 0.000040s    693.5  25212.7\n</code></pre>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2020/11/19/arm-m1-macbookair/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u603b\u7684\u6765\u8bf4\uff0c\u8fd8\u662f\u633a\u9999\u7684\u3002\u4e0d\u9519\u7684\u6027\u80fd\uff0c\u6ca1\u6709\u98ce\u6247\u7684\u55a7\u95f9\uff0c\u6ca1\u6709\u70eb\u624b\u7684\u952e\u76d8\u3002\u53ef\u80fd\u6709\u5c11\u90e8\u5206\u8f6f\u4ef6\u8fd8\u4e0d\u80fd\u6b63\u5e38\u8fd0\u884c\uff0c\u7136\u540e\u5f88\u591a\u7a0b\u5e8f\u8fd8\u9700\u8981 Rosetta \u7ffb\u8bd1\uff0c\u4f46\u76ee\u524d\u6765\u770b\u517c\u5bb9\u6027\u8fd8\u662f\u633a\u4e0d\u9519\u7684\uff0c\u5e76\u4e14\u8fd9\u4e9b\u5e94\u8be5\u660e\u5e74\u5c31\u90fd\u9002\u914d\u5730\u5dee\u4e0d\u591a\u4e86\u5427\u3002</p>","tags":["m1","macbookair","applesilicon","macos","arm","arm64"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/","title":"ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b","text":"","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>ARM Neoverse V2 \u662f\u76ee\u524d\uff082024 \u5e74\uff09\u5728\u670d\u52a1\u5668\u4e0a\u80fd\u7528\u5230\u7684\u6700\u65b0\u7684 ARM \u516c\u7248\u6838\u5e73\u53f0\uff08AWS Graviton 4\uff09\uff0c\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u5fae\u67b6\u6784\u5728\u5404\u4e2a\u65b9\u9762\u7684\u8868\u73b0\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u5b98\u65b9\u4fe1\u606f","title":"\u5b98\u65b9\u4fe1\u606f","text":"<p>ARM \u5173\u4e8e Neoverse V2 \u5fae\u67b6\u6784\u6709\u5982\u4e0b\u516c\u5f00\u4fe1\u606f\uff1a</p> <ul> <li>Arm Neoverse V2 platform: Leadership Performance and Power Efficiency for Next-Generation Cloud Computing, ML and HPC Workloads</li> <li>Arm\u00ae Neoverse\u2122 V2 Core Technical Reference Manual</li> <li>Arm Neoverse V2 Software Optimization Guide</li> </ul> <p>\u8003\u8651\u5230 Neoverse V2 \u4e0e Cortex X3 \u7684\u9ad8\u5ea6\u76f8\u4f3c\u6027\uff0c\u8fd9\u91cc\u4e5f\u5217\u51fa Cortex X3 \u7684\u76f8\u5173\u4fe1\u606f\uff1a</p> <ul> <li>Arm Unveils Next-Gen Flagship Core: Cortex-X3</li> <li>Arm\u00ae Cortex\u2011X3 Core Technical Reference Manual</li> </ul>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u73b0\u6709\u8bc4\u6d4b","title":"\u73b0\u6709\u8bc4\u6d4b","text":"<p>\u7f51\u4e0a\u5df2\u7ecf\u6709 Neoverse V2 \u5fae\u67b6\u6784\u7684\u8bc4\u6d4b\u548c\u5206\u6790\uff0c\u5efa\u8bae\u9605\u8bfb\uff1a</p> <ul> <li>Hot Chips 2023: Arm\u2019s Neoverse V2</li> </ul> <p>\u4e0b\u9762\u5206\u5404\u4e2a\u6a21\u5757\u5206\u522b\u8bb0\u5f55\u5b98\u65b9\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5b9e\u6d4b\u7684\u7ed3\u679c\u3002\u8bfb\u8005\u53ef\u4ee5\u5bf9\u7167\u5df2\u6709\u7684\u7b2c\u4e09\u65b9\u8bc4\u6d4b\u7406\u89e3\u3002\u5b98\u65b9\u4fe1\u606f\u4e0e\u5b9e\u6d4b\u7ed3\u679c\u4e00\u81f4\u7684\u6570\u636e\u4f1a\u52a0\u7c97\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#benchmark","title":"Benchmark","text":"<p>Neoverse V2 (AWS Graviton 4) \u7684\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\u89c1 SPEC\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#mop-vs-uop","title":"MOP vs uOP","text":"<p>MOP = Macro operation, uOP = Micro operation</p> <p>ARM \u516c\u7248\u6838\u5fae\u67b6\u6784\u65e2\u6709 MOP \u7684\u6982\u5ff5\uff0c\u53c8\u6709 uOP \u7684\u6982\u5ff5\u3002uOP \u4e3b\u8981\u662f\u9488\u5bf9\u540e\u7aef\uff0c\u6267\u884c\u5355\u5143\u5904\u7406\u7684\u662f uOP\u3002MOP \u51fa\u73b0\u5728 MOP Cache \u4ee5\u53ca ROB \u5f53\u4e2d\u3002\u4ed6\u4eec\u548c\u6307\u4ee4\u90fd\u5e76\u4e0d\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\u3002</p> <p>\u4f8b\u5982 Instruction Fusion \u7279\u6027\uff0c\u53ef\u4ee5\u628a\u591a\u6761\u6307\u4ee4\u5408\u5e76\u5230\u4e00\u6761 uOP \u5f53\u4e2d\uff0c\u4f8b\u5982 CMP + CSET\uff0c\u5408\u5e76\u6210\u4e00\u4e2a uOP \u4ee5\u540e\uff0c\u53ea\u9700\u8981\u4e00\u4e2a ALU \u5c31\u53ef\u4ee5\u5b8c\u6210\u6574\u4e2a\u64cd\u4f5c\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u4e00\u6761\u6307\u4ee4\u4e5f\u53ef\u80fd\u62c6\u6210\u591a\u4e2a uOP\uff0c\u4f8b\u5982 128b Load Pair \u6307\u4ee4\uff0c\u4e00\u6761\u6307\u4ee4\u88ab\u62c6\u6210\u4e24\u4e2a uOP\uff0c\u53ef\u4ee5\u72ec\u7acb\u6267\u884c\uff0c\u4f46\u4e3a\u4e86\u4fdd\u8bc1\u7cbe\u786e\u5f02\u5e38\uff0c\u5728 ROB \u4e2d\u8fd8\u662f\u540c\u4e00\u4e2a MOP\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u5982\u679c\u4e0d\u8003\u8651\u8fd9\u4e9b\u7ec6\u8282\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e00\u6761\u6307\u4ee4\u5bf9\u5e94\u4e00\u4e2a MOP \u5bf9\u5e94\u4e00\u4e2a uOP \u4e5f\u662f\u6210\u7acb\u7684\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u524d\u7aef","title":"\u524d\u7aef","text":"","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#branch-predictor","title":"Branch Predictor","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aTwo predicted branches per cycle, nanoBTB + two level main BTB, 8 table 2 way TAGE direction predictor</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l1-icache","title":"L1 ICache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a64KB, 4-way set associative, VIPT behaving as PIPT, 64B cacheline, PLRU replacement policy</p> <p>\u4e3a\u4e86\u6d4b\u8bd5 L1 ICache \u5bb9\u91cf\uff0c\u6784\u9020\u4e00\u4e2a\u5177\u6709\u5de8\u5927\u6307\u4ee4 footprint \u7684\u5faa\u73af\uff0c\u7531\u5927\u91cf\u7684 nop \u548c\u6700\u540e\u7684\u5206\u652f\u6307\u4ee4\u7ec4\u6210\u3002\u89c2\u5bdf\u5728\u4e0d\u540c footprint \u5927\u5c0f\u4e0b\u7684 IPC\uff1a</p> <p></p> <p>\u5f00\u59cb\u6709\u4e00\u6bb5 IPC \u63a5\u8fd1 12\uff0c\u6b64\u65f6\u6307\u4ee4\u7531 MOP Cache \u63d0\u4f9b\uff0c\u7531\u4e8e\u8fde\u7eed\u7684\u4e24\u6761 NOP \u53ef\u4ee5\u88ab\u878d\u5408\u6210\u4e00\u4e2a uOP\uff0c\u56e0\u6b64\u53ef\u4ee5\u7a81\u7834 8 \u7684\u9650\u5236\uff0c\u4f46\u4e3a\u4ec0\u4e48\u662f 12 \u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u7814\u7a76\u3002</p> <p>\u5f53\u6307\u4ee4\u8d85\u51fa MOP Cache \u5bb9\u91cf\u540e\uff0c\u6307\u4ee4\u8d70 ICache + Decode\uff0c\u6b64\u65f6\u53ef\u4ee5\u8fbe\u5230 6 \u7684 IPC\uff0c\u4e0e 6-wide \u7684 Decode Width \u543b\u5408\u3002\u5f53 footprint \u8d85\u51fa 64 KB \u65f6\uff0cIPC \u4e0b\u964d\uff0c\u5bf9\u5e94\u4e86 64KB \u7684 L1 ICache \u5bb9\u91cf\u3002</p> <p>\u8d85\u51fa L1 ICache \u5bb9\u91cf\u540e\uff0c\u53ef\u4ee5\u8fbe\u5230 4 \u7684 IPC\uff0c\u8bf4\u660e L2 Cache \u53ef\u4ee5\u63d0\u4f9b\u6bcf\u5468\u671f 16 \u5b57\u8282\u7684\u53d6\u6307\u5e26\u5bbd\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#mop-cache","title":"MOP Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a1536 macro-operations, 4-way skewed associative, VIVT behaving as PIPT, NRU replacement policy, 8 MOP/cycle</p> <p>\u56e0\u4e3a MOP Cache \u7684\u5e26\u5bbd\u6bd4 Decode \u9ad8\uff0c\u4e3a\u4e86\u6d4b\u8bd5\u51fa MOP Cache \u7684\u89c4\u683c\uff0c\u9700\u8981\u6784\u9020\u6307\u4ee4\u5e8f\u5217\uff0c\u4f7f\u5176\u53ef\u4ee5\u8fbe\u5230 8 MOP/cycle \u7684 IPC\uff0c\u5982\u679c\u8d70\u7684\u662f Instruction Fetch + Decode\uff0c\u5219\u8fbe\u4e0d\u5230\u8fd9\u4e2a IPC\u3002\u4f46\u662f Neoverse V2 \u7684 Dispatch \u6709\u6bd4\u8f83\u660e\u786e\u7684\u9650\u5236\uff1a</p> <p>The dispatch stage can process up to 8 MOPs per cycle and dispatch up to 16 \u00b5OPs per cycle, with the following limitations on the number of \u00b5OPs of each type that may be simultaneously dispatched.</p> <ul> <li>Up to 4 \u00b5OPs utilizing the S\uff08\u5355\u5468\u671f\u6574\u6570\uff09or B\uff08\u5206\u652f\uff09pipelines</li> <li>Up to 4 \u00b5OPs utilizing the M\uff08\u591a\u5468\u671f\u6574\u6570\uff09pipelines</li> <li>Up to 2 \u00b5OPs utilizing the M0\uff08\u591a\u5468\u671f\u6574\u6570\uff09pipelines</li> <li>Up to 2 \u00b5OPs utilizing the V0\uff08\u6d6e\u70b9/\u5411\u91cf\uff09 pipeline</li> <li>Up to 2 \u00b5OPs utilizing the V1\uff08\u6d6e\u70b9/\u5411\u91cf\uff09 pipeline</li> <li>Up to 6 \u00b5OPs utilizing the L\uff08\u8bbf\u5b58\uff09pipelines</li> </ul> <p>\u8003\u8651\u5230\u8fd9\u4e2a\u9650\u5236\uff0c\u4f7f\u7528 4 \u6761 add \u6307\u4ee4\uff0c4 \u6761 fadd \u6307\u4ee4\u4e3a\u4e00\u7ec4\uff0c\u4e0d\u65ad\u91cd\u590d\u3002\u901a\u8fc7\u6d4b\u8bd5\uff0c\u8fd9\u6837\u7684\u6307\u4ee4\u5e8f\u5217\u786e\u5b9e\u53ef\u4ee5\u8fbe\u5230 8 \u7684 IPC\u3002\u5f53\u6307\u4ee4\u4e2a\u6570\u589e\u52a0\u5230\u8d85\u51fa MOP Cache \u5bb9\u91cf\u65f6\uff0c\u5c06\u4f1a\u89c2\u5bdf\u5230\u6027\u80fd\u7684\u4e0b\u964d\uff1a</p> <p></p> <p>\u62d0\u70b9\u51fa\u73b0\u5728 192 \u4e2a\u6307\u4ee4\u7ec4\uff0c\u6b64\u65f6\u8fbe\u5230 MOP Cache \u7684\u5bb9\u91cf\u74f6\u9888\uff0c<code>192*8=1536</code>\uff0c\u6b63\u597d\u662f MOP Cache \u7684\u5bb9\u91cf\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l1-itlb","title":"L1 ITLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aCaches entries at the 4KB, 16KB, 64KB, or 2MB granularity, Fully associative, 48 entries</p> <p>\u6784\u9020\u4e00\u7cfb\u5217\u7684 B \u6307\u4ee4\uff0c\u4f7f\u5f97 B \u6307\u4ee4\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 ITLB \u6210\u4e3a\u74f6\u9888\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 48 Page \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 48 \u7684 L1 ITLB \u5bb9\u91cf\u3002\u6b64\u540e\u6027\u80fd\u964d\u4f4e\u5230 7 CPI\uff0c\u6b64\u65f6\u5bf9\u5e94\u4e86 L2 Unified TLB \u7684\u5ef6\u8fdf\u3002</p> <p>\u8fdb\u4e00\u6b65\u589e\u52a0 Page \u6570\u91cf\uff0c\u53d1\u73b0\u5728\u5927\u7ea6 1000 \u4e2a\u9875\u7684\u65f6\u5019\uff0c\u65f6\u95f4\u4ece 7 cycle \u9010\u6e10\u4e0a\u5347\uff1a</p> <p></p> <p>\u8003\u8651\u5230 L2 Unified TLB \u4e00\u5171\u6709 2048 \u4e2a Entry\uff0c\u731c\u6d4b\u5b83\u9650\u5236\u4e86 ITLB \u80fd\u4f7f\u7528\u7684 L2 TLB \u7684\u5bb9\u91cf\u53ea\u6709 2048 \u7684\u4e00\u534a\uff0c\u4e5f\u5c31\u662f 1024 \u9879\u3002\u8d85\u51fa 1024 \u9879\u4ee5\u540e\uff0c\u9700\u8981 Page Table Walker \u8fdb\u884c\u5730\u5740\u7ffb\u8bd1\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#decode","title":"Decode","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a6-wide Decode</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#return-stack","title":"Return Stack","text":"<p>Return Stack \u8bb0\u5f55\u4e86\u6700\u8fd1\u7684\u51fd\u6570\u8c03\u7528\u94fe\uff0ccall \u65f6\u538b\u6808\uff0creturn \u65f6\u5f39\u6808\uff0c\u4ece\u800c\u5b9e\u73b0 return \u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u7684\u9884\u6d4b\u3002\u6784\u9020\u4e0d\u540c\u6df1\u5ea6\u7684\u8c03\u7528\u94fe\uff0c\u53d1\u73b0 Neoverse V2 \u7684 Return Stack \u6df1\u5ea6\u4e3a 32\uff1a</p> <p></p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u540e\u7aef","title":"\u540e\u7aef","text":"","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#dispatch","title":"Dispatch","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aup to 8 MOPs per cycle and up to 16 uOPs per cycle</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#store-to-load-forwarding","title":"Store to Load Forwarding","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <p>The Neoverse V2 core allows data to be forwarded from store instructions to a load instruction with the restrictions mentioned below:</p> <ul> <li>Load start address should align with the start or middle address of the older store</li> <li>Loads of size greater than or equal to 8 bytes can get the data forwarded from a maximum of 2 stores. If there are 2 stores, then each store should forward to either first or second half of the load</li> <li>Loads of size less than or equal to 4 bytes can get their data forwarded from only 1 store</li> </ul> <p>\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\uff0c\u5982\u4e0b\u7684\u60c5\u51b5\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff1a</p> <p>\u5bf9\u5730\u5740 x \u7684 Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 Load \u6210\u529f\u65f6 y-x \u7684\u53d6\u503c\u8303\u56f4\uff1a</p> Store\\Load 8b Load 16b Load 32b Load 64b Load 8b Store {0} {} {} {} 16b Store {0,1} {0} {} {} 32b Store {0,2} {0,2} {0} {-4,0} 64b Store {0,4} {0,4} {0,4} {-4,0,4} <p>\u4e00\u4e2a Load \u9700\u8981\u8f6c\u53d1\u4e24\u4e2a Store \u7684\u6570\u636e\u7684\u60c5\u51b5\uff1a\u5bf9\u5730\u5740 x \u7684 32b Store \u548c\u5bf9\u5730\u5740 x+4 \u7684 32b Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 64b Load\uff0c\u5728 Overlap \u7684\u60c5\u51b5\u4e0b\uff0c\u8981\u6c42 y=x\uff0c\u4e5f\u5c31\u662f\u6070\u597d\u524d\u534a\u6765\u81ea\u7b2c\u4e00\u4e2a Store\uff0c\u540e\u534a\u6765\u81ea\u7b2c\u4e8c\u4e2a Store\u3002</p> <p>\u548c\u5b98\u65b9\u7684\u63cf\u8ff0\u662f\u6bd4\u8f83\u7b26\u5408\u7684\uff0c\u53ea\u8003\u8651\u4e86\u5168\u90e8\u8f6c\u53d1\u3001\u8f6c\u53d1\u524d\u534a\u548c\u8f6c\u53d1\u540e\u534a\u7684\u4e09\u79cd\u573a\u666f\u3002\u7279\u522b\u5730\uff0c\u9488\u5bf9\u5e38\u89c1\u7684 64b Load\uff0c\u652f\u6301 y-x=-4\u3002\u540c\u65f6\u4e5f\u652f\u6301\u524d\u534a\u548c\u540e\u534a\u6765\u81ea\u4e24\u4e2a\u4e0d\u540c\u7684 Store\u3002\u5bf9\u5730\u5740\u672c\u8eab\u7684\u5bf9\u9f50\u6ca1\u6709\u8981\u6c42\uff0c\u751a\u81f3\u5728\u8de8\u7f13\u5b58\u884c\u8fb9\u754c\u65f6\u4e5f\u53ef\u4ee5\u8f6c\u53d1\uff0c\u53ea\u662f\u5bf9 Load \u548c Store \u7684\u76f8\u5bf9\u4f4d\u7f6e\u6709\u8981\u6c42\u3002</p> <p>\u548c Zen 5 \u76f8\u6bd4\uff0cNeoverse V2 \u5bf9 Store \u548c Load \u7684\u76f8\u5bf9\u4f4d\u7f6e\u6709\u989d\u5916\u7684\u8981\u6c42\uff08\u5f00\u5934\u6216\u6b63\u4e2d\u592e\uff09\uff0c\u4f46\u652f\u6301\u4e86 Store \u548c Load \u53ea\u6709\u4e00\u90e8\u5206\u8986\u76d6\u7684\u60c5\u51b5\uff0c\u4e5f\u5141\u8bb8\u4e00\u4e2a Load \u4ece\u4e24\u4e2a Store \u4e2d\u53d6\u5f97\u6570\u636e\u3002</p> <p>\u4ece\u6027\u80fd\u4e0a\uff0c\u53ef\u4ee5\u8f6c\u53d1\u65f6 5 Cycle\uff0c\u6709 Overlap \u4f46\u65e0\u6cd5\u8f6c\u53d1\u65f6 10.5 Cycle\u3002</p> <p>\u5c0f\u7ed3\uff1aARM Neoverse V2 \u7684 Store to Load Forwarding\uff1a</p> <ul> <li>1 ld + 1 st: \u8981\u6c42 ld \u548c st \u5730\u5740\u76f8\u540c\u6216\u5dee\u51fa\u534a\u4e2a st \u5bbd\u5ea6</li> <li>1 ld + 2 st: \u8981\u6c42 ld \u548c st \u5730\u5740\u76f8\u540c</li> <li>1 ld + 4 st: \u4e0d\u652f\u6301</li> </ul>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u8ba1\u7b97\u5355\u5143","title":"\u8ba1\u7b97\u5355\u5143","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a6x ALU, 2x Branch, 4x 128b SIMD</p> <p>\u5b9e\u6d4b\u4ee5\u4e0b\u6307\u4ee4\u7684\u541e\u5410\uff1a</p> <ul> <li>int add: 4 IPC\uff0c\u53d7\u5230 Dispatch \u9650\u5236\uff1a<code>Up to 4 \u00b5OPs utilizing the S\uff08\u5355\u5468\u671f\u6574\u6570\uff09or B\uff08\u5206\u652f\uff09pipelines</code></li> <li>int mul: 2 IPC\uff0c\u5bf9\u5e94\u4e24\u4e2a Multi Cycle \u5355\u5143</li> <li>int not taken branch: 2 IPC\uff0c\u5bf9\u5e94\u4e24\u4e2a Branch \u5355\u5143</li> <li>asimd fadd double: 4 IPC\uff0c\u5bf9\u5e94\u56db\u4e2a FP/ASIMD \u5355\u5143</li> </ul>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#load-store-unit","title":"Load Store Unit","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a2 Load/Store Pipe + 1 Load Pipe, Reduce bandwidth or incur additional latency for:</p> <ol> <li>Load operations that cross a cache-line (64-byte) boundary.</li> <li>Quad-word load operations that are not 4B aligned.</li> <li>Store operations that cross a 32B boundary.</li> </ol> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u4e00\u4e2a\u5468\u671f\u5185\u53ef\u4ee5\u6700\u591a\u5b8c\u6210\u5982\u4e0b\u7684 Load/Store \u6307\u4ee4\uff1a</p> <ul> <li>3x 64b Load</li> <li>2x 64b Load + 1x 64b Store</li> <li>1x 64b Load + 2x 64b Store</li> <li>2x 64b Store</li> </ul> <p>\u8fd9\u4e2a\u6027\u80fd\u7b26\u5408 2 LS + 1 LD pipe \u7684\u8bbe\u8ba1\u3002</p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5f53 Load \u6307\u4ee4\u6ca1\u6709\u8de8\u8d8a\u7f13\u5b58\u884c\u65f6\uff0cload to use \u5ef6\u8fdf\u662f 4 cycle\uff1b\u5f53 Load \u6307\u4ee4\u8de8\u8fc7 64B \u7f13\u5b58\u884c\u8fb9\u754c\u65f6\uff0cload to use \u5ef6\u8fdf\u589e\u52a0\u5230 5 cycle\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#memory-dependency-predictor","title":"Memory Dependency Predictor","text":"<p>\u4e3a\u4e86\u9884\u6d4b\u6267\u884c Load\uff0c\u9700\u8981\u4fdd\u8bc1 Load \u548c\u4e4b\u524d\u7684 Store \u8bbf\u95ee\u7684\u5185\u5b58\u6ca1\u6709 Overlap\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u9884\u6d4b\u5668\u6765\u9884\u6d4b Load \u548c Store \u4e4b\u524d\u5728\u5185\u5b58\u4e0a\u7684\u4f9d\u8d56\u3002\u53c2\u8003 Store-to-Load Forwarding and Memory Disambiguation in x86 Processors \u7684\u65b9\u6cd5\uff0c\u6784\u9020\u4e24\u4e2a\u6307\u4ee4\u6a21\u5f0f\uff0c\u5206\u522b\u5728\u5730\u5740\u548c\u6570\u636e\u4e0a\u6709\u4f9d\u8d56\uff1a</p> <ul> <li>\u6570\u636e\u4f9d\u8d56\uff0c\u5730\u5740\u65e0\u4f9d\u8d56\uff1a<code>str x3, [x1]</code> \u548c <code>ldr x3, [x2]</code></li> <li>\u5730\u5740\u4f9d\u8d56\uff0c\u6570\u636e\u65e0\u4f9d\u8d56\uff1a<code>str x2, [x1]</code> \u548c <code>ldr x1, [x2]</code></li> </ul> <p>\u521d\u59cb\u5316\u65f6\uff0c<code>x1</code> \u548c <code>x2</code> \u6307\u5411\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u91cd\u590d\u5982\u4e0a\u7684\u6307\u4ee4\u6a21\u5f0f\uff0c\u89c2\u5bdf\u5230\u591a\u5c11\u6761 <code>ldr</code> \u6307\u4ee4\u65f6\u4f1a\u51fa\u73b0\u6027\u80fd\u4e0b\u964d\uff1a</p> <p></p> <p>\u6709\u610f\u601d\u7684\u662f\uff0c\u5730\u5740\u4f9d\u8d56\u7684\u9608\u503c\u662f 40\uff0c\u800c\u6570\u636e\u4f9d\u8d56\u6ca1\u6709\u9608\u503c\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#move-elimination","title":"Move Elimination","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u7279\u5b9a\u60c5\u51b5\u4e0b\u8fd9\u4e9b\u6307\u4ee4\u53ef\u4ee5\u88ab\u4f18\u5316\uff1amov reg, 0; mov reg, zero; mov vreg, 0; mov reg, reg;mov vreg, vreg</p> <p>\u5b9e\u9645\u6d4b\u8bd5\uff0c\u5404\u79cd\u6a21\u5f0f\u7684 IPC \u5982\u4e0b\uff1a</p> <ul> <li>mov reg, 0: IPC 6</li> <li>mov vreg, 0: IPC 6</li> <li>mov reg, reg: \u65e0\u4f9d\u8d56\u94fe\u65f6 IPC 4</li> <li>mov vreg, vreg: \u65e0\u4f9d\u8d56\u94fe\u65f6 IPC 3.6</li> </ul> <p>\u867d\u7136\u505a\u4e86\u4f18\u5316\uff0c\u4f46\u7b97\u4e0d\u4e0a\u5f88\u5feb\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#reorder-buffer","title":"Reorder Buffer","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a320 MOP ROB, 8-wide retire</p> <p>\u628a\u4e24\u4e2a\u4e32\u884c\u7684 fsqrt \u5e8f\u5217\u653e\u5728\u5faa\u73af\u7684\u5934\u548c\u5c3e\uff0c\u4e2d\u95f4\u7528 NOP \u586b\u5145\uff0c\u5982\u679c ROB \u8db3\u591f\u5927\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u5f00\u5934\u4e32\u884c\u7684 fsqrt \u5e8f\u5217\u65f6\uff0c\u540c\u65f6\u6267\u884c\u7ed3\u5c3e\u4e32\u884c\u7684 fsqrt \u5e8f\u5217\uff0c\u6b64\u65f6\u6027\u80fd\u662f\u6700\u4f18\u7684\u3002\u5982\u679c ROB \u4e0d\u591f\u5927\uff0c\u90a3\u4e48\u4f1a\u89c2\u5bdf\u5230\u6027\u80fd\u4e0b\u964d\u3002\u7531\u4e8e Neoverse V2 \u6267\u884c NOP \u53ef\u4ee5\u8fbe\u5230\u63a5\u8fd1 12 \u7684 IPC\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5f88\u5c11\u7684 fsqrt \u5c31\u8db3\u591f\u751f\u6210\u8db3\u591f\u7684\u5ef6\u8fdf\u3002</p> <p>\u901a\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0\u5728\u5927\u7ea6 640 \u6761 NOP \u65f6\u51fa\u73b0\u6027\u80fd\u4e0b\u964d\uff0c\u800c Neoverse V2 \u5b9e\u73b0\u4e86 Instruction Fusion\uff0c\u4e24\u6761 NOP \u6307\u4ee4\u7b97\u505a\u4e00\u6761 uOP\uff0c\u540c\u65f6\u4e5f\u662f\u4e00\u6761 MOP\uff0c\u56e0\u6b64 640 \u6761 NOP \u5bf9\u5e94 320 MOP \u7684 ROB \u5927\u5c0f\u3002\u6781\u9650\u60c5\u51b5\u4e0b\uff0c320 MOP \u53ef\u4ee5\u5b58 640 uOP\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u6bd4\u8f83\u96be\u8fbe\u5230\uff0c\u5f88\u5bb9\u6613\u53d7\u9650\u4e8e\u5176\u4ed6\u7ed3\u6784\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l1-dcache","title":"L1 DCache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a64KB, 4-way set associative, VIPT behaving as PIPT, 64B cacheline, ECC protected, RRIP replacement policy, 4\u00d764-bit read paths and 4\u00d764-bit write paths for the integer execute pipeline, 3\u00d7128-bit read paths and 2\u00d7128-bit write paths for the vector execute pipeline</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u5bb9\u91cf","title":"\u5bb9\u91cf","text":"<p>\u6784\u9020\u4e0d\u540c\u5927\u5c0f footprint \u7684 pointer chasing \u94fe\uff0c\u6d4b\u8bd5\u4e0d\u540c footprint \u4e0b\u6bcf\u6761 load \u6307\u4ee4\u8017\u8d39\u7684\u65f6\u95f4\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 64KB \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 64KB \u7684 L1 DCache \u5bb9\u91cf\u3002\u4e4b\u540e\u5ef6\u8fdf\u5148\u4e0a\u5347\u540e\u4e0b\u964d\uff0c\u4e0e ARM \u91c7\u7528\u7684 Correlated Miss Caching(CMC) \u9884\u53d6\u5668\u8bb0\u4f4f\u4e86 pointer chasing \u7684\u5386\u53f2\u6709\u5173\uff0c\u8be6\u7ec6\u53ef\u4ee5\u9605\u8bfb Arm Neoverse N2: Arm\u2019s 2nd generation high performance infrastructure CPUs and system IPs\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u5ef6\u8fdf","title":"\u5ef6\u8fdf","text":"<p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0cL1 DCache \u7684 load to use latency \u662f 4 cycle\uff0c\u6ca1\u6709\u9488\u5bf9 pointer chasing \u505a 3 cycle \u7684\u4f18\u5316\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u541e\u5410","title":"\u541e\u5410","text":"<p>\u4f7f\u7528 FP/ASIMD 128b Load \u53ef\u4ee5\u8fbe\u5230 3 IPC\uff0c\u5bf9\u5e94\u4e86 3x128b read paths\uff1b\u800c\u5982\u679c\u4f7f\u7528 2x64b \u6574\u6570 LDP\uff0c\u5219\u53ea\u80fd\u8fbe\u5230 2 IPC\uff0c\u5bf9\u5e94 4x64b read paths\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8981\u8fbe\u5230\u5cf0\u503c\u7684\u8bfb\u53d6\u6027\u80fd\uff0c\u5fc5\u987b\u7528 FP/ASIMD \u6307\u4ee4\u3002\u5199\u5165\u65b9\u9762\uff0c\u5411\u91cf 128b Store \u53ef\u4ee5\u8fbe\u5230 2 IPC\uff0c\u5bf9\u5e94\u4e86 2x128b write paths\uff1b\u7c7b\u4f3c\u5730\uff0c2x64b \u6574\u6570 STP \u80fd\u8fbe\u5230 2 IPC\uff0c\u5bf9\u5e94 4x64b write paths\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#vipt","title":"VIPT","text":"<p>\u5728 4KB page \u7684\u60c5\u51b5\u4e0b\uff0c64KB 4-way \u7684 L1 DCache \u4e0d\u6ee1\u8db3 VIPT \u7684 Index \u5168\u5728\u9875\u5185\u504f\u79fb\u7684\u6761\u4ef6\uff08\u8be6\u89c1 VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb\uff09\uff0c\u6b64\u65f6\u8981\u4e48\u6539\u7528 PIPT\uff0c\u8981\u4e48\u5728 VIPT \u7684\u57fa\u7840\u4e0a\u5904\u7406 alias \u7684\u95ee\u9898\u3002\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e00\u70b9\uff0c\u53c2\u8003 \u6d45\u8c08\u73b0\u4ee3\u5904\u7406\u5668\u5b9e\u73b0\u8d85\u5927 L1 Cache \u7684\u65b9\u5f0f \u7684\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u7528 shm \u6784\u9020\u51fa\u4e24\u4e2a 4KB \u865a\u62df\u9875\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\u7684\u60c5\u51b5\uff0c\u7136\u540e\u5728\u4e24\u4e2a\u865a\u62df\u9875\u4e4b\u95f4 copy\uff0c\u53d1\u73b0\u76f8\u6bd4\u5728\u540c\u4e00\u4e2a\u865a\u62df\u9875\u5185 copy \u6709\u663e\u8457\u7684\u6027\u80fd\u4e0b\u964d\uff0c\u5e76\u4e14\u4ea7\u751f\u4e86\u5927\u91cf\u7684 L1 DCache Refill\uff1a</p> <pre><code>copy from aliased page = 3261121467 cycles, 285103870 refills\nbaseline = 1520692165 cycles, 1200 refills\nslowdown = 2.14x\n</code></pre> <p>\u56e0\u6b64\u9a8c\u8bc1\u4e86 L1 DCache \u91c7\u7528\u7684\u662f VIPT\uff0c\u5e76\u505a\u4e86\u9488\u5bf9 alias \u7684\u6b63\u786e\u6027\u5904\u7406\u3002\u5982\u679c\u662f PIPT\uff0c\u90a3\u4e48 L1 DCache \u4f1a\u53d1\u73b0\u8fd9\u4e24\u4e2a\u9875\u5bf9\u5e94\u7684\u662f\u76f8\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u6027\u80fd\u4e0d\u4f1a\u4e0b\u964d\uff0c\u4e5f\u4e0d\u9700\u8981\u9891\u7e41\u7684 refill\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#\u6784\u9020","title":"\u6784\u9020","text":"<p>\u8fdb\u4e00\u6b65\u5c1d\u8bd5\u7814\u7a76 Neoverse V2 \u7684 L1 DCache \u7684\u6784\u9020\uff0c\u4e3a\u4e86\u652f\u6301\u6bcf\u5468\u671f 3 \u6761 Load \u6307\u4ee4\uff0cL1 DCache \u901a\u5e38\u4f1a\u5206 Bank\uff0c\u6bcf\u4e2a Bank \u90fd\u6709\u81ea\u5df1\u7684\u8bfb\u53e3\u3002\u5982\u679c Load \u5206\u5e03\u5230\u4e0d\u540c\u7684 Bank \u4e0a\uff0c\u5404 Bank \u53ef\u4ee5\u540c\u65f6\u8bfb\u53d6\uff0c\u83b7\u5f97\u66f4\u9ad8\u7684\u6027\u80fd\uff1b\u5982\u679c Load \u547d\u4e2d\u76f8\u540c\u7684 Bank\uff0c\u4f46\u662f\u8bbf\u95ee\u7684 Bank \u5185\u5730\u5740\u4e0d\u540c\uff0c\u5c31\u53ea\u80fd\u7b49\u5230\u4e0b\u4e00\u4e2a\u5468\u671f\u518d\u8bfb\u53d6\u3002\u4e3a\u4e86\u6d4b\u8bd5 Bank \u7684\u6784\u9020\uff0c\u8bbe\u8ba1\u4e00\u7cfb\u5217\u4ee5\u4e0d\u540c\u7684\u56fa\u5b9a stride \u95f4\u9694\u7684 Load \u6307\u4ee4\uff0c\u89c2\u5bdf Load \u7684 IPC\uff1a</p> <ul> <li>Stride=1B/2B/4B/8B/16B/32B: IPC=3</li> <li>Stride=64B: IPC=2</li> <li>Stride=128B/256B/512B: IPC=1</li> </ul> <p>Stride=64B \u65f6\u51fa\u73b0\u6027\u80fd\u4e0b\u964d\uff0c\u8bf4\u660e\u6b64\u65f6\u51fa\u73b0\u4e86 Bank Conflict\uff0c\u8fdb\u4e00\u6b65\u5230 Stride=128B \u65f6\uff0c\u53ea\u80fd\u8fbe\u5230 1 \u7684 IPC\uff0c\u8bf4\u660e\u6b64\u65f6\u6240\u6709\u7684 Load \u90fd\u547d\u4e2d\u4e86\u540c\u4e00\u4e2a Bank\uff0c\u5e76\u4e14\u662f\u4e32\u884c\u8bfb\u53d6\u3002\u6839\u636e\u8fd9\u4e2a\u73b0\u8c61\uff0c\u8ba4\u4e3a Neoverse V2 \u7684 L1 DCache \u7ec4\u7ec7\u65b9\u5f0f\u662f\uff1a</p> <ul> <li>\u4e00\u5171\u6709\u4e24\u4e2a Bank\uff0cBank Index \u662f VA[6]</li> <li>\u6bcf\u4e2a Bank \u6bcf\u5468\u671f\u53ef\u4ee5\u4ece\u4e00\u4e2a\u7f13\u5b58\u884c\u8bfb\u53d6\u6570\u636e\uff0c\u652f\u6301\u591a\u4e2a Load \u8bbf\u95ee\u540c\u4e00\u4e2a\u7f13\u5b58\u884c</li> <li>\u5982\u679c\u591a\u4e2a Load \u8bbf\u95ee\u540c\u4e00\u4e2a Bank \u7684\u4e0d\u540c\u7f13\u5b58\u884c\uff0c\u53ea\u80fd\u4e00\u4e2a\u5468\u671f\u5b8c\u6210\u4e00\u4e2a Load</li> </ul>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l1-dtlb","title":"L1 DTLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aCaches entries at the 4KB, 16KB, 64KB, 2MB or 512MB granularity, Fully associative, 48 entries. A miss in the L1 data TLB and a hit in the L2 TLB has a 6-cycle penalty compared to a hit in the L1 data TLB.</p> <p>\u7528 pointer chasing \u7684\u65b9\u6cd5\u6d4b\u8bd5 L1 DTLB \u5bb9\u91cf\uff0c\u6307\u9488\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 DTLB \u6210\u4e3a\u74f6\u9888\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 48 Page \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 48 \u7684 L1 DTLB \u5bb9\u91cf\u3002\u8d85\u51fa\u5bb9\u91cf\u540e\uff0c\u9700\u8981\u989d\u5916\u7684 5 cycle \u7684 latency \u8bbf\u95ee L2 Unified TLB\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l2-unified-tlb","title":"L2 Unified TLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1aShared by instructions and data, 8-way set associative, 2048 entries</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#l2-cache","title":"L2 Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a1MB or 2MB, 8-way set associative, 4 banks, PIPT, ECC protected, 64B cacheline, 10 cycle load-to-use, 128 B/cycle</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2024/11/07/arm_neoverse_v2/#sve","title":"SVE","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a128b SVE vector length</p> <p>\u5728 Linux \u4e0b\u67e5\u770b <code>/proc/sys/abi/sve_default_vector_length</code> \u7684\u5185\u5bb9\uff0c\u5f97\u5230 SVE \u5bbd\u5ea6\u4e3a 16 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 128b\u3002</p> <p>\u5b9e\u6d4b\u53d1\u73b0 Neoverse V2 \u6bcf\u5468\u671f\u6700\u591a\u53ef\u4ee5\u6267\u884c 4 \u6761 ASIMD \u6216 SVE \u7684\u6d6e\u70b9 FMA \u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u5468\u671f\u6d6e\u70b9\u5cf0\u503c\u6027\u80fd\uff1a</p> <ul> <li>\u5355\u7cbe\u5ea6\uff1a<code>128/32*2*4=32</code> FLOP per cycle</li> <li>\u53cc\u7cbe\u5ea6\uff1a<code>128/64*2*4=16</code> FLOP per cycle</li> </ul> <p>\u4e0e Zen 2-4\u3001Oryon\u3001Firestorm\u3001LA464\u3001Haswell \u7b49\u5fae\u67b6\u6784\u770b\u9f50\uff0c\u4f46\u4e0d\u53ca Zen 5\u3001Skylake \u7b49\u901a\u8fc7 AVX512 \u63d0\u4f9b\u7684\u5cf0\u503c\u6d6e\u70b9\u6027\u80fd\u3002</p>","tags":["cpu","arm","neoverse","performance","uarch-review"]},{"location":"hardware/2022/05/19/async-sram-timing/","title":"\u300c\u6559\u5b66\u300d\u5f02\u6b65 SRAM \u65f6\u5e8f","text":"","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u4e00\u4e9b\u573a\u5408\u91cc\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u5f02\u6b65\u7684\uff08\u5373\u6ca1\u6709\u65f6\u949f\u4fe1\u53f7\u7684\uff09\u5916\u90e8 SRAM \u6765\u5b58\u50a8\u6570\u636e\uff0c\u800c\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684\u5f88\u591a\u5916\u90e8\u63a5\u53e3\u90fd\u662f\u540c\u6b65\u63a5\u53e3\uff08\u5373\u6709\u65f6\u949f\u4fe1\u53f7\u7684\u63a5\u53e3\uff09\uff0c\u6bd4\u5982 SPI \u548c I2C \u7b49\u7b49\uff0cUART \u867d\u7136\u662f\u5f02\u6b65\uff0c\u4f46\u662f\u5b83\u901f\u5ea6\u5f88\u4f4e\uff0c\u4e0d\u600e\u4e48\u9700\u8981\u8003\u8651\u65f6\u5e8f\u7684\u95ee\u9898\u3002\u6240\u4ee5\u5728 FPGA \u4e0a\u7f16\u5199\u4e00\u4e2a\u6b63\u786e\u7684\u5f02\u6b65 SRAM \u63a7\u5236\u5668\u662f\u5177\u6709\u4e00\u5b9a\u7684\u6311\u6218\u7684\u3002</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u5bc4\u5b58\u5668\u65f6\u5e8f","title":"\u5bc4\u5b58\u5668\u65f6\u5e8f","text":"<p>\u8003\u8651\u5230\u8bfb\u8005\u53ef\u80fd\u5df2\u7ecf\u4e0d\u8bb0\u5f97\u5bc4\u5b58\u5668\u7684\u65f6\u5e8f\u4e86\uff0c\u8fd9\u91cc\u9996\u5148\u6765\u590d\u4e60\u4e00\u4e0b setup \u548c hold \u7684\u6982\u5ff5\u3002\u5982\u679c\u4f60\u5df2\u7ecf\u6bd4\u8f83\u719f\u6089\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u9605\u8bfb\u4e0b\u4e00\u8282\u3002</p> <p>\u5bc4\u5b58\u5668\u5728\u65f6\u949f\u7684\u4e0a\u5347\u6cbf\uff08\u4e0b\u56fe\u7684 <code>a</code>\uff09\u8fdb\u884c\u91c7\u6837\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u91c7\u6837\u7684\u7a33\u5b9a\u6027\uff0c\u8f93\u5165\u5f15\u811a <code>D</code> \u9700\u8981\u5728\u65f6\u949f\u4e0a\u5347\u6cbf\u4e4b\u524d \\(t_{su}\\) \u7684\u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>b</code>\uff09\u5230\u65f6\u949f\u4e0a\u5347\u6cbf\u4e4b\u540e \\(t_h\\) \u7684\u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>c</code>\uff09\u4fdd\u6301\u7a33\u5b9a\uff0c\u8f93\u51fa\u5f15\u811a <code>Q</code> \u4f1a\u5728\u65f6\u949f\u4e0a\u5347\u6cbf\u4e4b\u540e \\(t_{cko}\\) \u7684\u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>d</code>\uff09\u53d8\u5316\uff1a</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u63a5\u53e3","title":"\u63a5\u53e3","text":"<p>\u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u5f02\u6b65 SRAM \u7684\u63a5\u53e3\u3002\u4e0b\u6587\u4e2d\uff0c\u91c7\u7528 IS61WV102416BLL-10TLI \u548c AS7C34098A-10TCN \u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6709 20 \u4f4d\u7684\u5730\u5740\uff0c16 \u4f4d\u7684\u6570\u636e\uff0c\u82e5\u5e72\u4e2a\u63a7\u5236\u4fe1\u53f7\uff0c\u540c\u65f6\u53ea\u80fd\u8fdb\u884c\u8bfb\u6216\u8005\u5199\uff08\u7b80\u79f0 <code>1RW</code>\uff09\u3002\u5b83\u6ca1\u6709\u65f6\u949f\u4fe1\u53f7\uff0c\u6240\u4ee5\u662f\u5f02\u6b65 SRAM\u3002</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u65f6\u5e8f","title":"\u65f6\u5e8f","text":"<p>\u5bf9\u4e8e\u4e00\u4e2a\u540c\u6b65\u63a5\u53e3\uff0c\u6211\u4eec\u901a\u5e38\u53ea\u9700\u8981\u7ed9\u4e00\u4e2a\u6ee1\u8db3\u65f6\u949f\u5468\u671f\u7684\u65f6\u949f\uff0c\u7136\u540e\u901a\u8fc7\u7ea6\u675f\u6587\u4ef6\u4fdd\u8bc1 setup \u548c hold \u6761\u4ef6\u6ee1\u8db3\u5373\u53ef\u3002\u4f46\u662f\u5bf9\u4e8e\u5f02\u6b65\u63a5\u53e3\uff0c\u7531\u4e8e\u8f93\u51fa\u7684\u65f6\u5019\u6ca1\u6709\u65f6\u949f\uff0c\u6211\u4eec\u9700\u8981\u66f4\u5c0f\u5fc3\u5730\u5b8c\u6210\u8fd9\u4ef6\u4e8b\u60c5\u3002</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u8bfb\u65f6\u5e8f","title":"\u8bfb\u65f6\u5e8f","text":"<p>\u9996\u5148\u6765\u770b\u4e00\u4e0b\u6bd4\u8f83\u7b80\u5355\u7684\u8bfb\u65f6\u5e8f\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5730\u5740\u548c\u6570\u636e\u7684\u5173\u7cfb\uff1a\u9996\u5148\u662f\u5730\u5740\u9700\u8981\u7a33\u5b9a \\(t_{RC}\\) \u7684\u65f6\u95f4\uff0c\u90a3\u4e48\u6570\u636e\u5408\u6cd5\u7684\u8303\u56f4\u662f\u5730\u5740\u7a33\u5b9a\u7684\u521d\u59cb\u65f6\u523b\u52a0\u4e0a \\(t_{AA}\\)\uff0c\u5230\u5730\u5740\u7a33\u5b9a\u7684\u7ed3\u675f\u65f6\u523b\u52a0\u4e0a \\(t_{OH}\\)\u3002\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e0b\u8fd9\u51e0\u4e2a\u65f6\u95f4\u7684\u8303\u56f4\uff1a</p> <p></p> <p>\u9996\u5148\u53ef\u4ee5\u770b\u5230\u8bfb\u5468\u671f\u65f6\u95f4 \\(t_{RC}\\) \u81f3\u5c11\u662f 10ns\uff0c\u8fd9\u5bf9\u5e94\u4e86\u578b\u53f7\u4e2d\u6700\u540e\u7684\u6570\u5b57\uff0c\u8fd9\u8868\u793a\u4e86\u8fd9\u4e2a SRAM \u6700\u5feb\u7684\u8bfb\u5199\u901f\u5ea6\u3002\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f \\(t_{AA}\\) \u6700\u591a\u662f 10ns\uff0c\u521a\u597d\u548c \\(t_{RC}\\) \u7684\u6700\u5c0f\u503c\u76f8\u7b49\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u5982\u4f55\u4e3a SRAM \u63a7\u5236\u5668\u65f6\u5e8f\u8bfb\u53d6\u7684\u529f\u80fd\u3002\u770b\u5230\u4e0a\u9762\u7684\u6ce2\u5f62\u56fe\uff0c\u5927\u6982\u53ef\u4ee5\u60f3\u5230\u51e0\u6761\u8bbe\u8ba1\u601d\u8def\uff1a</p> <ol> <li>\u9996\u5148\u8f93\u51fa\u8981\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u4e3a\u4e86\u8ba9\u5b83\u7a33\u5b9a\uff08\\(t_{RC}\\) \u7684\u65f6\u95f4\u5185\u4e0d\u80fd\u53d8\u5316\uff09\uff0c\u8981\u76f4\u63a5\u4ece FPGA \u5185\u90e8\u5bc4\u5b58\u5668\u7684\u8f93\u51fa\u7aef\u53e3\u8f93\u51fa</li> <li>\u7b49\u5f85\u82e5\u5e72\u4e2a\u5468\u671f\uff0c\u786e\u4fdd\u6570\u636e\u5df2\u7ecf\u7a33\u5b9a\uff0c\u5728\u6ee1\u8db3 FPGA \u5185\u90e8\u5bc4\u5b58\u5668\u7684 setup \u548c hold \u7ea6\u675f\u7684\u60c5\u51b5\u4e0b\uff0c\u628a\u7ed3\u679c\u4fdd\u5b58\u5728\u5185\u90e8\u5bc4\u5b58\u5668\u4e2d\u3002</li> </ol> <p>\u7b80\u5355\u8d77\u89c1\uff0c\u5148\u8bbe\u7f6e\u4e00\u4e2a\u975e\u5e38\u5feb\u7684 SRAM \u63a7\u5236\u5668\u9891\u7387\uff1a500MHz\uff0c\u6bcf\u4e2a\u5468\u671f 2ns\uff0c\u5047\u5982\u5728 <code>a</code> \u65f6\u523b\u5730\u5740\u5bc4\u5b58\u5668\u8f93\u51fa\u4e86\u5f53\u524d\u8981\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u90a3\u4e48\u6570\u636e\u4f1a\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\u53d8\u4e3a\u5408\u6cd5\u3002\u8fd9\u91cc <code>a-&gt;b</code> \u662f\u8bfb\u53d6\u5468\u671f\u65f6\u95f4 \\(t_{RC}\\)\uff0c<code>a-&gt;c</code> \u662f\u5730\u5740\u5230\u6570\u636e\u7684\u5ef6\u8fdf \\(t_{AA}\\)\uff0c<code>b-&gt;d</code> \u662f\u5730\u5740\u6539\u53d8\u540e\u6570\u636e\u7684\u4fdd\u6301\u65f6\u95f4 \\(t_{OH}\\)\u3002</p> <p>\u90a3\u4e48\u6839\u636e\u8fd9\u4e2a\u56fe\uff0c\u5f88\u81ea\u7136\u7684\u60f3\u6cd5\u662f\uff0c\u6211\u5148\u7ed9\u51fa\u5730\u5740\uff0c\u7136\u540e\u6570\u5468\u671f\uff0c\u6570\u4e86\u4e94\u4e2a\u5468\u671f\u540e\uff0c\u6b64\u65f6 \\(t_{RC}=10\\mathrm{ns}\\)\uff0c\u7136\u540e\u6211\u5c31\u5728 <code>e</code> \u7684\u4e0a\u5347\u6cbf\u4e0a\u628a\u8f93\u5165\u6570\u636e\u9501\u5b58\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u6ce2\u5f62\uff1a</p> <p>\u8fd9\u4e2a\u65f6\u5019 <code>data_reg</code> \u7684 setup \u65f6\u95f4\u662f <code>c-&gt;e</code>\uff0chold \u65f6\u95f4\u662f <code>e-&gt;d</code>\u3002\u4ece\u56fe\u4e2d\u770b\u8d77\u6765\u8fd8\u6709\u5f88\u591a\u7684\u4f59\u91cf\uff0c\u4f46\u5982\u679c\u8003\u8651\u6700\u574f\u60c5\u51b5\uff0c\\(t_{AA}=10\\mathrm{ns}\\)\uff0c\u5c31\u4f1a\u53d8\u6210\u4e0b\u9762\u7684\u6ce2\u5f62\uff1a</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5728 <code>e</code> \u65f6\u523b\u4e0d\u518d\u6ee1\u8db3 setup \u7ea6\u675f\u3002\u8fd9\u4e2a\u95ee\u9898\u5728\u4eff\u771f\u4e2d\uff0c\u53ef\u80fd\u4f1a\u201c\u6781\u9650\u64cd\u4f5c\u201d\u8868\u73b0\u4e3a\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u5730\u5740\u4ece FPGA \u5230 SRAM \u7684\u5ef6\u8fdf\u6709\uff1a</p> <ol> <li>\u5730\u5740\u5bc4\u5b58\u5668\u4ece\u65f6\u949f\u4e0a\u5347\u6cbf\u5230\u8f93\u51fa\u53d8\u5316\u7684\u5ef6\u8fdf\uff1a\\(T_{CKO}=0.40\\mathrm{ns}\\)</li> <li>\u5bc4\u5b58\u5668\u8f93\u51fa\u5230 FPGA \u8f93\u51fa\u5f15\u811a\u7684\u5ef6\u8fdf\uff1a\\(T_{IOOP} \\in (2.56, 3.80)\\mathrm{ns}\\)</li> <li>FPGA \u8f93\u51fa\u7684\u5730\u5740\u4fe1\u53f7\u901a\u8fc7\u4fe1\u53f7\u7ebf\u5230 SRAM \u7684\u5ef6\u8fdf\uff1a\\(T_{PD}\\)</li> </ol> <p>\u6570\u636e\u4ece SRAM \u5230 FPGA \u7684\u5ef6\u8fdf\u6709\uff1a</p> <ol> <li>SRAM \u6570\u636e\u4fe1\u53f7\u901a\u8fc7\u4fe1\u53f7\u7ebf\u5230 FPGA \u7684\u5ef6\u8fdf\uff1a\\(T_{PD}\\)</li> <li>FPGA \u7684\u8f93\u5165\u5f15\u811a\u5230\u5185\u90e8\u5bc4\u5b58\u5668\u8f93\u5165\u7aef\u7684\u5ef6\u8fdf\uff1a\\(T_{IOPI}=1.26ns\\)</li> <li>FPGA \u5185\u90e8\u5bc4\u5b58\u5668\u7684 setup \u65f6\u95f4\uff1a\\(T_{AS}=0.07\\mathrm{ns}\\)</li> </ol> <p></p> <p>\u4e0a\u9762\u7684\u4e00\u4e9b\u6570\u636e\u53ef\u4ee5\u4ece Artix-7 FPGA Datasheet \u91cc\u67e5\u5230\uff0c\u53d6\u7684\u662f\u901f\u5ea6\u7b49\u7ea7 <code>-3</code> \u7684\u6570\u636e\uff0cIO \u6807\u51c6\u662f <code>LVCMOS33</code>\u3002\u5176\u4e2d\u5bc4\u5b58\u5668\u5230 FPGA \u8f93\u5165\u8f93\u51fa\u5f15\u811a\u7684\u5ef6\u8fdf\uff0c\u5b9e\u9645\u4e0a\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a\u4ece\u5bc4\u5b58\u5668\u5230 IOB\uff08IO Block\uff09\u7684\u5ef6\u8fdf\uff0c\u4ee5\u53ca IOB \u5230 FPGA \u8f93\u5165\u8f93\u51fa\u5f15\u811a\u7684\u5ef6\u8fdf\u3002\u6211\u4eec\u628a\u5730\u5740\u5bc4\u5b58\u5668\u7684\u8f93\u51fa\u4f5c\u4e3a\u5730\u5740\u8f93\u51fa\uff0c\u8fd9\u6837 Vivado \u5c31\u4f1a\u628a\u5bc4\u5b58\u5668\u653e\u5230 IOB\uff0c\u4e8e\u662f\u53ef\u4ee5\u5ffd\u7565\u5bc4\u5b58\u5668\u5230 IOB \u7684\u5ef6\u8fdf\uff0c\u8be6\u60c5\u53ef\u4ee5\u9605\u8bfb\u6587\u6863 Successfully packing a register into an IOB with Vivado\u3002</p> <p>\u628a\u4e0a\u9762\u4e00\u4e32\u52a0\u8d77\u6765\uff0c\u5df2\u7ecf\u6709\u5927\u6982 4 \u5230 5ns \u4e86\u3002\u8003\u8651\u4e86\u5ef6\u8fdf\u4ee5\u540e\uff0c\u4e0a\u9762\u7684\u56fe\u53ef\u80fd\u5b9e\u9645\u4e0a\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a</p> <p>\u8003\u8651\u4e86\u8fd9\u4e48\u591a\u5b9e\u9645\u7684\u5ef6\u8fdf\u56e0\u7d20\u4ee5\u540e\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u4e8b\u60c5\u5e76\u4e0d\u7b80\u5355\uff0c\u9700\u8981\u9884\u5148\u4f30\u8ba1\u51fa\u6570\u636e\u5728\u5927\u6982\u4ec0\u4e48\u65f6\u5019\u7a33\u5b9a\uff0c\u8fd9\u65f6\u5019\u624d\u80fd\u4fdd\u8bc1\u6570\u636e\u5bc4\u5b58\u5668\u4e0a\u4fdd\u5b58\u7684\u6570\u636e\u662f\u6b63\u786e\u7684\u3002</p> <p>\u8f6c\u5ff5\u4e00\u60f3\uff0c\u6211\u4eec\u7684 SRAM Controller \u80af\u5b9a\u4e0d\u4f1a\u8dd1\u5728 500MHz \u8fd9\u4e48\u9ad8\u7684\u9891\u7387\u4e0b\u3002\u5047\u5982\u91c7\u7528 100MHz\uff0c\u53ef\u4ee5\u6bcf\u4e24\u4e2a\u5468\u671f\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\uff1a</p> <p>\u6b64\u65f6\u5728 <code>b</code> \u65f6\u949f\u4e0a\u8fb9\u6cbf\u5bf9 <code>data_fpga</code> \u91c7\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6ee1\u8db3\u65f6\u5e8f\u7684\u8981\u6c42\u3002\u6ce8\u610f\u8fd9\u91cc\u7b2c\u4e8c\u4e2a\u5468\u671f\uff08\u4e0a\u56fe\u7684 <code>a</code>\uff09\u4e0d\u80fd\u7ed9\u51fa\u7b2c\u4e8c\u6b21\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u5426\u5219\u7a33\u5b9a\u65f6\u95f4\u592a\u77ed\uff0c\u4e0d\u6ee1\u8db3 hold \u7ea6\u675f\u3002</p> <p>\u5982\u679c\u9891\u7387\u7ee7\u7eed\u964d\u4f4e\uff0c\u4f7f\u5f97\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5927\u4e8e \\(t_{AA}\\) \u52a0\u4e0a\u5404\u79cd\u5ef6\u8fdf\u548c setup \u65f6\u95f4\uff0c\u90a3\u5c31\u53ef\u4ee5\u6bcf\u4e2a\u5468\u671f\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\uff1a</p> <p>\u6b64\u65f6\u5728 <code>a</code> \u65f6\u949f\u4e0a\u5347\u6cbf\u4e0a\uff0c\u5bf9 <code>data_fpga</code> \u8fdb\u884c\u91c7\u6837\uff0c\u5e76\u4e14\u8f93\u51fa\u4e0b\u4e00\u6b21\u8bfb\u8bf7\u6c42\u7684\u5730\u5740\u3002</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u5199\u65f6\u5e8f","title":"\u5199\u65f6\u5e8f","text":"<p>\u63a5\u4e0b\u6765\u518d\u770b\u770b\u5199\u65f6\u5e8f\u3002\u5199\u65f6\u5e8f\u6d89\u53ca\u7684\u4fe1\u53f7\u66f4\u591a\uff0c\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\uff0c\u4f46\u597d\u5904\u662f\u4fe1\u53f7\u90fd\u662f\u4ece FPGA \u5230 SRAM\uff0c\u56e0\u6b64\u8003\u8651\u5ef6\u8fdf\u7684\u65f6\u5019\u4f1a\u6bd4\u8f83\u7b80\u5355\uff0c\u6bd4\u5982\u4e0a\u9762\u8bfb\u65f6\u5e8f\u4e2d\u9700\u8981\u8003\u8651\u4ece FPGA \u5230 SRAM \u7684\u5730\u5740\uff0c\u518d\u4ece SRAM \u5230 FPGA \u7684\u6570\u636e\u7684\u8def\u5f84\u3002\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u5199\u7684\u65f6\u5e8f\u56fe\uff0c\u4ece\u65f6\u95f4\u987a\u5e8f\u6765\u770b\u6709\u8fd9\u4e48\u51e0\u4ef6\u4e8b\u60c5\u6309\u987a\u5e8f\u53d1\u751f\uff1a</p> <ol> <li>\u5730\u5740\u4fdd\u6301\u7a33\u5b9a</li> <li>\u7ecf\u8fc7 \\(t_{AS}\\) \u65f6\u95f4\u540e\uff0c\u5199\u4f7f\u80fd\u4fe1\u53f7 \\(\\overline{WE}\\) \u53d8\u4e3a\u4f4e\u7535\u5e73\uff0c\u8868\u793a\u201c\u5f00\u59cb\u5199\u5165\u64cd\u4f5c\u201d\uff0c\u6b64\u65f6\u5730\u5740\u662f\u7a33\u5b9a\u7684</li> <li>\u7ecf\u8fc7 \\(t_{WP}\\) \u65f6\u95f4\u540e\uff0c\u5199\u4f7f\u80fd\u4fe1\u53f7\\(\\overline{WE}\\) \u53d8\u4e3a\u9ad8\u7535\u5e73\uff0c\u8868\u793a\u201c\u7ed3\u675f\u5199\u5165\u64cd\u4f5c\u201d\uff0c\u6b64\u65f6\u5730\u5740\u548c\u6570\u636e\u90fd\u662f\u7a33\u5b9a\u7684\uff0c\u5e76\u4e14\u6570\u636e\u6ee1\u8db3 setup\uff08\\(t_{DW}\\)\uff09\u548c hold\uff08\\(t_{DH}\\)\uff09\u7ea6\u675f</li> <li>\u7ee7\u7eed\u4fdd\u6301\u5730\u5740\u7a33\u5b9a\uff0c\u76f4\u5230\u5df2\u7ecf\u7a33\u5b9a\u4e86 \\(t_{WC}\\) \u65f6\u95f4</li> </ol> <p>\u8fd9\u4e9b\u6570\u636e\u7684\u8303\u56f4\u5982\u4e0b\uff1a</p> <p></p> <p>\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u8fd8\u662f\u5148\u8003\u8651\u4e00\u4e2a 500MHz \u7684 SRAM \u63a7\u5236\u5668\u3002\u63a7\u5236\u5668\u8981\u5199\u5165\u7684\u8bdd\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u7684\u987a\u5e8f\u64cd\u4f5c\uff1a</p> <ol> <li>\u7b2c\u4e00\u4e2a\u5468\u671f\uff08\u4e0b\u56fe\u7684 <code>a</code>\uff09\u5148\u8f93\u51fa\u8981\u5199\u5165\u7684\u5730\u5740\u548c\u6570\u636e\uff0c\u5e76\u4e14\u8bbe\u7f6e\u597d <code>ce_n</code>, <code>oe_n</code>, <code>we_n</code>, <code>ub_n</code> \u548c <code>lb_n</code>\u3002</li> <li>\u7b2c\u4e8c\u4e2a\u5468\u671f\uff08\u4e0b\u56fe\u7684 <code>c</code>\uff09\u8bbe\u7f6e \\(\\overline{WE}\\) \u4e3a\u4f4e\u7535\u5e73\uff0c\u8fd9\u662f\u4e3a\u4e86\u6ee1\u8db3 \\(t_{AS}\\) \uff08\u4e0b\u56fe\u7684 <code>a -&gt; c</code>\uff09\u7684\u6761\u4ef6</li> <li>\u7b49\u5f85\u82e5\u5e72\u4e2a\u5468\u671f\uff08\u4e0b\u56fe\u7684 <code>c -&gt; d</code>\uff09\uff0c\u76f4\u5230 \\(t_{WP}\\) \uff08\u4e0b\u56fe\u7684 <code>c -&gt; d</code>\uff09\u548c \\(t_{AW}\\) \uff08\u4e0b\u56fe\u7684 <code>a -&gt; d</code>\uff09\u65f6\u95f4\u6ee1\u8db3\u6761\u4ef6</li> <li>\u8bbe\u7f6e \\(\\overline{WE}\\) \u4e3a\u9ad8\u7535\u5e73\uff08\u4e0b\u56fe\u7684 <code>d</code>\uff09\uff0c\u7b49\u5f85\u82e5\u5e72\u4e2a\u5468\u671f\uff08\u4e0b\u56fe\u7684 <code>d -&gt; b</code>\uff09\uff0c\u76f4\u5230\u6ee1\u8db3\u56fe\u4e2d\u7684 \\(t_{WC}\\) \uff08\u4e0b\u56fe\u7684 <code>a -&gt; b</code>\uff09\u65f6\u95f4\u6ee1\u8db3\u6761\u4ef6</li> </ol> <p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u6709\u70b9\u7591\u60d1\uff0c\u4e4b\u524d\u5206\u6790\u8bfb\u65f6\u5e8f\u7684\u65f6\u5019\uff0c\u8003\u8651\u4e86\u90a3\u4e48\u591a\u5ef6\u8fdf\uff0c\u4e3a\u4ec0\u4e48\u5199\u7684\u65f6\u5019\u4e0d\u8003\u8651\u4e86\uff1f\u8fd9\u662f\u56e0\u4e3a\uff0c\u5199\u7684\u65f6\u5019\u6240\u6709\u7684\u4fe1\u53f7\u90fd\u662f\u4ece FPGA \u8f93\u51fa\u5230 SRAM \u7684\uff0c\u53ea\u8981\u8fd9\u4e9b\u4fe1\u53f7\u90fd\u662f\u4ece\u5bc4\u5b58\u5668\u76f4\u63a5\u8f93\u51fa\uff0c\u5b83\u4eec\u7684\u5ef6\u8fdf\u57fa\u672c\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5728 FPGA \u4fa7\u662f\u4ec0\u4e48\u6ce2\u5f62\uff0c\u5728 SRAM \u4fa7\u4e5f\u662f\u4ec0\u4e48\u6ce2\u5f62\uff08\u51c6\u786e\u6765\u8bf4\uff0c\u6570\u636e\u4fe1\u53f7\u56e0\u4e3a\u8f93\u51fa\u662f\u4e09\u6001\u95e8\uff0c\u6240\u4ee5\u5ef6\u8fdf\u4f1a\u7a0d\u5fae\u9ad8\u4e00\u70b9\uff0c\u4f46\u662f\u7531\u4e8e\u6570\u636e\u4fe1\u53f7\u7684\u65f6\u5e8f\u4f59\u91cf\u5f88\u5927\uff0c\u8fd9\u4e2a\u989d\u5916\u7684\u5ef6\u8fdf\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff09\u3002</p> <p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u53c8\u6709\u4e00\u4e2a\u7591\u60d1\u4e86\uff0c\u5728\u9605\u8bfb Datasheet \u540e\u53d1\u73b0\uff0c\\(t_{AS}\\) \u6700\u5c0f\u662f 0ns\uff0c\u90a3\u80fd\u4e0d\u80fd\u5728\u4e0a\u56fe\u7684 <code>a</code> \u65f6\u523b\u5c31\u8f93\u51fa <code>we_n=0</code>\uff1f\u7b54\u6848\u662f\u4e0d\u884c\uff0c\u867d\u7136\u4ece\u6ce2\u5f62\u4e0a\u6765\u770b\uff0c\u662f\u5728\u540c\u4e00\u4e2a\u65f6\u949f\u4e0a\u5347\u6cbf\u66f4\u65b0\uff0c\u4f46\u5b9e\u9645\u4e0a\u4f1a\u6709\u4e00\u5fae\u5c0f\u7684\u5ef6\u8fdf\u5dee\u8ddd\uff0c\u53ef\u80fd\u5bfc\u81f4 <code>we_n</code> \u5728 <code>addr</code> \u4e4b\u524d\u53d8\u5316\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u80fd\u5bfc\u81f4 SRAM \u89c2\u5bdf\u5230\u7684\u5730\u5740\u662f\u4e0d\u7a33\u5b9a\u7684\u3002</p> <p>\u518d\u8003\u8651\u4e00\u4e2a\u6bd4\u8f83\u5b9e\u9645\u7684 100MHz \u4e3b\u9891 SRAM \u63a7\u5236\u5668\uff0c\u6309\u7167\u5982\u4e0b\u7684\u6ce2\u5f62\uff0c\u5219\u662f\u6bcf\u4e09\u4e2a\u5468\u671f\u8fdb\u884c\u4e00\u6b21\u5199\u64cd\u4f5c\uff1a</p> <p>\u5982\u679c\u89c9\u5f97\u8fd9\u6837\u505a\u592a\u8fc7\u4fdd\u5b88\uff0c\u60f3\u8981\u63d0\u5347\u6027\u80fd\uff0c\u6709\u5982\u4e0b\u51e0\u4e2a\u53ef\u80fd\u7684\u601d\u8def\uff1a</p> <ol> <li>\u8ba9 <code>we_n=0</code> \u5728\u65f6\u949f\u4e0b\u964d\u6cbf\u8f93\u51fa\uff0c\u4f46\u662f\u7f16\u5199\u7684\u65f6\u5019\u9700\u8981\u6bd4\u8f83\u8c28\u614e\uff0c\u6bd4\u5982\u5148\u8bbe\u7f6e\u4e00\u4e2a\u4e0a\u5347\u6cbf\u89e6\u53d1\u7684\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u7528\u53e6\u4e00\u4e2a\u5bc4\u5b58\u5668\u5728\u4e0b\u964d\u6cbf\u5bf9\u8fd9\u4e2a\u5bc4\u5b58\u5668\u8fdb\u884c\u91c7\u6837\uff0c\u518d\u8f93\u51fa\u3002</li> <li>\u7528\u4e00\u4e2a\u66f4\u9ad8\u9891\u7387\u7684\u65f6\u949f\u9a71\u52a8 <code>we_n</code> \u7684\u5bc4\u5b58\u5668\u3002</li> <li>\u7528 FPGA \u63d0\u4f9b\u7684 <code>ODELAY</code> \u81ea\u5b9a\u4e49\u8f93\u51fa\u5ef6\u8fdf\u539f\u8bed\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u7684\u8f93\u51fa\u5ef6\u8fdf\uff0c\u6bd4\u5982 1ns\u3002</li> <li>\u7528 <code>ODDR</code> \u539f\u8bed\uff0c\u4eba\u4e3a\u5730\u6dfb\u52a0\u4e00\u4e2a\u5927\u7ea6 0.50ns \u7684\u5ef6\u8fdf\u3002</li> <li>\u5bf9 <code>we_n</code> \u8bbe\u7f6e\u4e00\u4e2a\u6700\u5c0f\u7684\u8f93\u51fa\u5ef6\u8fdf\uff08\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u5f88\u5927\u7684 hold\uff09\uff0c\u5e76\u4e14\u4e0d\u5141\u8bb8\u8f93\u51fa <code>we_n</code> \u7684\u5bc4\u5b58\u5668\u653e\u5728 IOB \u4e2d\uff08\u5426\u5219\u65e0\u6cd5\u4eba\u4e3a\u589e\u52a0\u4fe1\u53f7\u4f20\u64ad\u7684\u8def\u5f84\u957f\u5ea6\uff09\u3002\u7ea6\u675f\uff1a<code>set_output_delay -clock [get_clocks sram_clk] -min -5.00 [get_ports sram_we_n]</code> \u548c <code>set_property IOB FALSE [get_cells top/sram_controller/we_n_reg]</code>\u3002\u8fd9\u91cc\u7684\u4fe1\u53f7\u548c\u5bc4\u5b58\u5668\u540d\u79f0\u9700\u8981\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\uff0c\u7b2c\u4e8c\u4e2a\u4e0d\u5141\u8bb8\u653e\u7f6e\u5728 IOB \u7684\u7ea6\u675f\u4e5f\u53ef\u4ee5\u5728 Verilog \u4ee3\u7801\u4e2d\u7528 <code>(* IOB = \"FALSE\" *)</code> \u6765\u5b9e\u73b0\u3002</li> </ol> <p>\u6309\u7167\u4e0a\u9762\u7684\u601d\u8def\u5b9e\u73b0\uff0c\u4e0b\u9762\u662f\u53ef\u80fd\u8fbe\u5230\u7684\u6548\u679c\uff1a</p> <p>\u5355\u5468\u671f\uff1a</p> <p>\u53cc\u5468\u671f\uff1a</p>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#pl241-sram-\u63a7\u5236\u5668","title":"PL241 SRAM \u63a7\u5236\u5668","text":"<p>\u521a\u521a\u6211\u4eec\u5df2\u7ecf\u8bbe\u8ba1\u597d\u4e86\u6211\u4eec\u7684 SRAM \u63a7\u5236\u5668\uff0c\u518d\u8ba9\u6211\u4eec\u6765\u770b\u770b ARM \u63d0\u4f9b\u7684 SRAM \u63a7\u5236\u5668\u65f6\u5e8f\u662f\u600e\u4e48\u6837\u7684\uff1aARM \u6587\u6863\u63d0\u4f9b\u4e86 PrimeCell AHB SRAM/NOR Memory Controller (PL241) \u7684\u65f6\u5e8f\u56fe\u3002</p> <p>\u8bfb\u65f6\u5e8f\uff1a</p> <p></p> <p>\u5b83\u7b2c\u4e00\u4e2a\u5468\u671f\u8bbe\u7f6e\u4e86 <code>ce_n=0</code> \u548c <code>addr</code>\uff0c\u7b49\u5f85\u4e00\u4e2a\u5468\u671f\u540e\uff0c\u8bbe\u7f6e <code>oe_n=0</code>\uff0c\u518d\u7b49\u5f85\u4e24\u4e2a\u5468\u671f\uff0c\u5f97\u5230\u6570\u636e\u3002</p> <p>\u5199\u65f6\u5e8f\uff1a</p> <p></p> <p>\u5b83\u7b2c\u4e00\u4e2a\u5468\u671f\u8bbe\u7f6e\u4e86 <code>ce_n=0</code> <code>addr</code> \u548c <code>data</code>\uff0c\u7b49\u5f85\u4e00\u4e2a\u5468\u671f\u540e\uff0c\u8bbe\u7f6e <code>we_n=0</code>\uff0c\u7b49\u5f85\u4e24\u4e2a\u5468\u671f\uff0c\u518d\u8bbe\u7f6e <code>we_n=1</code>\uff0c\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u5199\u5165\u3002\u8fd9\u548c\u6211\u4eec\u7684\u5b9e\u73b0\u662f\u7c7b\u4f3c\u7684\uff1a\u7b49\u5f85\u4e00\u4e2a\u989d\u5916\u7684\u5468\u671f\uff0c\u4fdd\u8bc1\u6ee1\u8db3 <code>we_n</code> \u4e0b\u964d\u65f6\u5730\u5740\u5df2\u7ecf\u662f\u7a33\u5b9a\u7684\u3002ARM \u7684\u6587\u6863\u91cc\u4e5f\u5199\u4e86\u5982\u4e0b\u7684\u5907\u6ce8\uff1a</p> <pre><code>The timing parameter tWC is controlling the deassertion of smc_we_n_0. You can\nuse it to vary the hold time of smc_cs_n_0[3:0], smc_add_0[31:0] and\nsmc_data_out_0[31:0]. This differs from the read case where the timing\nparameter tCEOE controls the delay in the assertion of smc_oe_n_0.\nAdditionally, smc_we_n_0 is always asserted one cycle after smc_cs_n_0[3:0] to\nensure the address bus is valid.\n</code></pre>","tags":["sram","timing","teaching"]},{"location":"hardware/2022/05/19/async-sram-timing/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>1M x 16 HIGH-SPEED ASYNCHRONOUS CMOS STATIC RAM WITH 3.3V SUPPLY</li> <li>Artix-7 FPGAs Data Sheet: DC and AC Switching Characteristics</li> <li>Timing constraints for an Asynchronous SRAM interface</li> <li>Successfully packing a register into an IOB with Vivado</li> <li>How to verify whether an I/O register is packed into IOB</li> <li>PrimeCell AHB SRAM/NOR Memory Controller (PL241) - Memory interface operation</li> </ul>","tags":["sram","timing","teaching"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/","title":"\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead","text":"","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u968f\u7740 Zen 5 \u7684\u63a8\u51fa\uff0c\u66f4\u591a Zen5 \u7684\u67b6\u6784\u8bbe\u8ba1\u7ec6\u8282\u88ab\u516c\u5f00\uff0c\u53ef\u4ee5\u770b\u5230 Zen 5 \u524d\u7aef\u51fa\u73b0\u4e86\u4ee4\u4eba\u77a9\u76ee\u7684\u53d8\u5316\uff1a\u5f15\u5165\u4e86 2-taken, 2-ahead \u5206\u652f\u9884\u6d4b\u7684\u8bbe\u8ba1\u3002\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\uff1f\u5b83\u67b6\u6784\u4e0a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f\u53ef\u4ee5\u5e26\u6765\u54ea\u4e9b\u6027\u80fd\u63d0\u5347\uff1f</p>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#\u80cc\u666f\u77e5\u8bc6","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>\u9996\u5148\u8fd8\u662f\u56de\u987e\u4e00\u4e0b\u5904\u7406\u5668\u524d\u7aef\u5728\u505a\u7684\u4e8b\u60c5\uff1a\u6839\u636e PC\uff0c\u4ece ICache \u8bfb\u53d6\u6307\u4ee4\uff0c\u7136\u540e\u8bd1\u7801\uff0c\u53d1\u7ed9\u540e\u7aef\u53d6\u6267\u884c\u3002\u4f46\u662f\u6267\u884c\u7684\u7684\u6307\u4ee4\u91cc\u6709\u5927\u91cf\u7684\u5206\u652f\u6307\u4ee4\uff0c\u5b83\u4eec\u4f1a\u6539\u53d8 PC\uff0c\u540e\u7eed\u6307\u4ee4\u9700\u8981\u4ece\u65b0\u7684 PC \u5904\u53d6\uff0c\u4f46\u662f\u53d6\u6307\u7684\u65f6\u5019\u5e76\u4e0d\u77e5\u9053\u5206\u652f\u6307\u4ee4\u672a\u6765\u4f1a\u5982\u4f55\u8df3\u8f6c\uff0c\u5982\u679c\u6bcf\u6b21\u5206\u652f\u6307\u4ee4\u90fd\u8981\u5237\u6d41\u6c34\u7ebf\u91cd\u65b0\u53d6\u6307\uff0c\u5c31\u4f1a\u4ea7\u751f\u5f88\u591a\u7684\u6d41\u6c34\u7ebf\u7a7a\u6ce1\uff0c\u56e0\u6b64\u5c31\u6709\u4e86\u5206\u652f\u9884\u6d4b\u3002</p> <p>\u5206\u652f\u9884\u6d4b\u548c\u53d6\u6307\u662f\u540c\u65f6\u8fdb\u884c\u7684\uff1a\u53d6\u6307\u4ee4\u7684\u540c\u65f6\uff0c\u4e5f\u5728\u9884\u6d4b\u8fd9\u4e9b\u6307\u4ee4\u662f\u5426\u4f1a\u8df3\u8f6c\uff0c\u5982\u679c\u4f1a\u8df3\u8f6c\uff0c\u8df3\u8f6c\u7684\u76ee\u7684\u5730\u5740\u662f\u591a\u5c11\uff0c\u7528\u4e8e\u6307\u5bfc\u4e0b\u4e00\u4e2a\u5468\u671f\u4ece\u54ea\u91cc\u53d6\u6307\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u9996\u5148\u9700\u8981\u77e5\u9053\u6709\u6ca1\u6709\u5206\u652f\u6216\u8df3\u8f6c\u6307\u4ee4\uff0c\u8fd9\u4e2a\u4fe1\u606f\u4f1a\u4fdd\u5b58\u5728 BTB \u4e2d\uff0c\u6216\u8005\u8981\u7b49\u5230\u53d6\u6307\u5b8c\u6210\uff0c\u8bd1\u7801\u540e\u624d\u77e5\u9053\u54ea\u4e9b\u662f\u5206\u652f\u6216\u8df3\u8f6c\u6307\u4ee4\u3002\u5982\u679c\u6709\uff0c\u5bf9\u4e8e\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u6765\u8bf4\uff0c\u9700\u8981\u4e00\u4e2a\u65b9\u5411\u9884\u6d4b\u5668\uff08CBP\uff09\uff0c\u5224\u65ad\u5206\u652f\u662f\u5426\u4f1a\u8df3\u8f6c\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u5206\u652f\u76ee\u7684\u5730\u5740\u7f13\u5b58\uff08BTB\uff09\uff0c\u5982\u679c\u5206\u652f\u8981\u8df3\u7684\u8bdd\uff0c\u77e5\u9053\u8981\u8df3\u5230\u4ec0\u4e48\u5730\u65b9\u3002\u9664\u4e86\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u4ee5\u5916\uff0c\u9488\u5bf9 return \u6307\u4ee4\uff0c\u8df3\u8f6c\u7684\u5730\u5740\u548c\u6b64\u524d call \u5bf9\u5e94\uff0c\u9700\u8981\u8bb0\u5f55\u8c03\u7528\u7684\u8fd4\u56de\u5730\u5740\u6808\uff08RAS\uff09\u3002\u9488\u5bf9\u5176\u4ed6\u7684\u95f4\u63a5\u8df3\u8f6c\u6307\u4ee4\uff0c\u4f8b\u5982\u51fd\u6570\u6307\u9488\u8c03\u7528\uff0c\u4e00\u4e2a\u8df3\u8f6c\u53ef\u80fd\u6709\u591a\u4e2a\u76ee\u7684\u5730\u5740\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u9488\u5bf9\u95f4\u63a5\u8df3\u8f6c\u7684\u76ee\u7684\u5730\u5740\u7684\u9884\u6d4b\u5668\uff08IBP\uff09\u3002\u8fd9\u4e9b\u7ec4\u4ef6\uff08CBP\u3001BTB\u3001RAS \u548c IBP\uff09\u6784\u6210\u4e86\u73b0\u4ee3\u5904\u7406\u5668\u7684\u5206\u652f\u9884\u6d4b\u5668\u3002</p> <p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u76ee\u524d\u6bd4\u8f83\u6d41\u884c\u5206\u79bb\u5f0f/\u89e3\u8026\u5f0f\u524d\u7aef\uff08Decoupled Frontend\uff09\uff1a\u548c\u8026\u5408/\u975e\u5206\u79bb\u5f0f\u524d\u7aef\u76f8\u5bf9\uff0c\u8026\u5408\u524d\u7aef\u662f\u8bf4\u5206\u652f\u9884\u6d4b\u5668\u548c\u6307\u4ee4\u7f13\u5b58\u7d27\u5bc6\u534f\u4f5c\uff0c\u5206\u652f\u9884\u6d4b\u5668\u6307\u5bfc\u4e0b\u4e00\u6b21\u53d6\u6307\u7684\u5730\u5740\uff0c\u53d6\u51fa\u7684\u6307\u4ee4\u7acb\u5373\u7528\u4e8e\u5206\u652f\u9884\u6d4b\u5668\u3002\u5206\u79bb\u5f0f\u524d\u7aef\u628a\u5206\u652f\u9884\u6d4b\u5668\u53d8\u6210\u4e86\u751f\u4ea7\u8005\uff0c\u751f\u4ea7\u53d6\u6307\u7684\u5730\u5740\uff0c\u7136\u540e\u6307\u4ee4\u7f13\u5b58\u662f\u751f\u4ea7\u8005\uff0c\u6d88\u8d39\u53d6\u6307\u7684\u5730\u5740\uff0c\u4ece\u7f13\u5b58\u8bfb\u53d6\u6307\u4ee4\uff0c\u8fdb\u884c\u540e\u7eed\u7684\u8bd1\u7801\uff0c\u6d88\u8d39\u8005\u548c\u751f\u4ea7\u8005\u4e4b\u95f4\u901a\u8fc7\u961f\u5217\uff08Fetch Target Queue\uff09\u9694\u5f00\u3002\u8fd9\u6837\uff0c\u5206\u652f\u9884\u6d4b\u5668\u53ef\u4ee5\u72ec\u7acb\u6307\u4ee4\u7f13\u5b58\u5de5\u4f5c\uff0c\u5728\u524d\u9762\u62a2\u8dd1\uff0c\u5373\u4f7f\u6307\u4ee4\u7f13\u5b58\u51fa\u73b0\u4e86\u7f3a\u5931\uff0c\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u9884\u6d4b\u672a\u6765\u5f88\u591a\u4e2a\u6307\u4ee4\u4e4b\u540e\u7684\u5206\u652f\u3002\u66f4\u8fdb\u4e00\u6b65\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u62a2\u8dd1\u7684\u8fd9\u4e9b\u5206\u652f\u7684\u4fe1\u606f\uff0c\u63d0\u524d\u628a\u6307\u4ee4\u4ece L2 \u7f13\u5b58\u9884\u53d6\u5230 L1 \u6307\u4ee4\u7f13\u5b58\uff0c\u90a3\u4e48\u672a\u6765\u6307\u4ee4\u7f13\u5b58\u8981\u53d6\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u5927\u6982\u7387\u5df2\u7ecf\u5728\u7f13\u5b58\u5f53\u4e2d\u4e86\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u89e3\u8026\u5f0f\u524d\u7aef\u7684\u62a2\u8dd1\u4e5f\u662f\u6709\u4ee3\u4ef7\u7684\uff1a\u6b64\u65f6\u5206\u652f\u9884\u6d4b\u5668\u5bf9\u672a\u6765\u53d6\u51fa\u7684\u6307\u4ee4\u5b9e\u9645\u4e0a\u4f1a\u662f\u4ec0\u4e48\u6837\u662f\u4e0d\u77e5\u9053\u7684\uff0c\u53ea\u80fd\u4f9d\u8d56 BTB \u4e2d\u8bb0\u5f55\u7684\u5386\u53f2\u4fe1\u606f\uff0c\u6240\u4ee5 BTB \u4e00\u822c\u90fd\u4f1a\u505a\u7684\u6bd4\u8f83\u5927\u3002\u4f46\u4e0e\u6b64\u540c\u65f6\uff0c\u8026\u5408\u5f0f\u524d\u7aef\u53ef\u4ee5\u5728 L1 \u6307\u4ee4\u7f13\u5b58\u4ece L2 \u52a0\u8f7d\u6307\u4ee4\u65f6\u505a\u9884\u8bd1\u7801\uff0c\u627e\u5230\u5176\u4e2d\u7684\u5206\u652f\uff0c\u7136\u540e\u62ff L1 \u6307\u4ee4\u7f13\u5b58\u4f5c\u4e3a\u66f4\u5927\u7684 BTB\uff0c\u4f8b\u5982 Apple M1 Firestorm \u5c31\u53ef\u4ee5\u62ff\u5de8\u5927\u7684 192KB L1 \u6307\u4ee4\u7f13\u5b58\u4f5c\u4e3a BTB\uff0c\u7b49\u6548 BTB \u5bb9\u91cf\u7279\u522b\u5de8\u5927\u3002\u5b70\u597d\u5b70\u574f\uff0c\u73b0\u5728\u8fd8\u770b\u4e0d\u6e05\u695a\u3002</p> <p>\u90a3\u4e48\u4e00\u4e2a\u5206\u652f\uff0c\u4ece\u5206\u652f\u9884\u6d4b\uff0c\u5230\u53d6\u6307\uff0c\u6267\u884c\uff0c\u4f1a\u7ecf\u5386\u54ea\u4e9b\u9636\u6bb5\u5462\uff1f\u9996\u5148\u662f\u5206\u652f\u9884\u6d4b\uff0c\u5206\u652f\u9884\u6d4b\u5668\u4f1a\u628a\u90a3\u4e9b\u4f1a\u8df3\u8f6c\u7684\u60c5\u51b5\u627e\u51fa\u6765\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5f71\u54cd\u4e0b\u4e00\u6b21\u53d6\u6307\u7684\u5730\u5740\uff1b\u5982\u679c\u6ca1\u6709\u5206\u652f\u8df3\u8f6c\uff0c\u6216\u8005\u6709\u5206\u652f\u4f46\u662f\u4e0d\u8df3\u8f6c\uff0c\u90a3\u5c31\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0b\u4e00\u6b21\u53d6\u6307\u5730\u5740\u5c31\u76f4\u63a5\u987a\u7740\u5730\u5740\u5f80\u4e0b\u7b97\u5c31\u53ef\u4ee5\u3002\u53d6\u6307\u8bd1\u7801\u4ee5\u540e\uff0c\u4f1a\u548c\u4e4b\u524d\u9884\u6d4b\u7684\u60c5\u51b5\u505a\u6bd4\u5bf9\uff0c\u5982\u679c\u53d1\u73b0\u9884\u6d4b\u6210\u4e86\u5206\u652f\uff0c\u7ed3\u679c\u5b9e\u9645\u4e0a\u4e0d\u662f\u5206\u652f\uff0c\u8bf4\u660e\u5206\u652f\u9884\u6d4b\u5668\u9519\u4e86\uff0c\u53ca\u65f6\u4fee\u6b63\u3002\u6267\u884c\u7684\u65f6\u5019\uff0c\u6309\u7167\u5206\u652f\u6307\u4ee4\u7684\u64cd\u4f5c\u6570\uff0c\u5b9e\u9645\u5224\u65ad\u4e00\u4e0b\u8981\u4e0d\u8981\u8df3\u8f6c\uff0c\u548c\u4e4b\u524d\u9884\u6d4b\u7684\u7ed3\u679c\u6bd4\u5bf9\u3002\u5982\u679c\u5bf9\u4e86\uff0c\u90a3\u5c31\u7686\u5927\u6b22\u559c\uff1b\u5982\u679c\u9519\u4e86\uff0c\u90a3\u5c31\u8981\u5237\u6389\u90a3\u4e9b\u9519\u8bef\u9884\u6d4b\u7684\u6307\u4ee4\u3002\u5f53\u7136\u8fd8\u8981\u901a\u77e5\u4e00\u4e0b\u5206\u652f\u9884\u6d4b\u5668\uff0c\u8ba9\u4ed6\u66f4\u65b0\u9884\u6d4b\u7684\u8ba1\u6570\u5668\u3002</p> <p>\u63a5\u4e0b\u6765\u56de\u5230\u672c\u6587\u7684\u4e3b\u9898\uff1a\u5206\u652f\u9884\u6d4b\u6700\u8fd1\u51e0\u5e74\u6765\u6bd4\u8f83\u5927\u7684\u4e00\u4e9b\u6539\u52a8\u3002</p>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#2-branch","title":"2 branch","text":"<p>\u521a\u624d\u63d0\u5230\uff0c\u5206\u652f\u53c2\u4e0e\u5230\u9884\u6d4b\uff0c\u53d6\u6307\uff0c\u6267\u884c\u7b49\u9636\u6bb5\u4e4b\u4e2d\uff0c\u5176\u4e2d\u6267\u884c\u9636\u6bb5\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u6240\u4ee5\u6bd4\u8f83\u5bb9\u6613\u6269\u5c55\uff0c\u4f8b\u5982 Cortex-A77 \u5f15\u5165\u4e86\u7b2c\u4e8c\u4e2a\u5206\u652f\u6267\u884c\u5355\u5143\uff0c\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u6267\u884c\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u76ee\u524d\u5f88\u591a\u9ad8\u6027\u80fd\u5904\u7406\u5668\u90fd\u91c7\u7528\u4e86\u4e24\u4e2a\u5206\u652f\u6267\u884c\u5355\u5143\u3002\u4f46\u5927\u90e8\u5206\u5904\u7406\u5668\u6bcf\u4e2a\u5468\u671f\u53ea\u80fd\u9884\u6d4b\u4e00\u4e2a\u5206\u652f\uff0c\u8fd9\u6837\u6bcf\u4e2a\u5468\u671f\u53ea\u7528\u8bbf\u95ee\u4e00\u6b21 BTB \u7b49\u7ed3\u6784\uff0c\u90a3\u4f3c\u4e4e\u4e24\u4e2a\u5206\u652f\u6267\u884c\u5355\u5143\u6ca1\u6709\u4ec0\u4e48\u7528\uff1f\u6bd5\u7adf\u5982\u679c\u7b2c\u4e00\u4e2a\u5206\u652f\u8df3\u8f6c\u4e86\uff0c\u90a3\u7b2c\u4e8c\u4e2a\u5206\u652f\u7684\u5730\u5740\u9700\u8981\u4f9d\u8d56\u7b2c\u4e00\u4e2a\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\u8ba1\u7b97\u5f97\u51fa\uff0c\u8fd9\u6837\u8fd9\u4e24\u4e2a\u5206\u652f\u7684\u9884\u6d4b\u5c31\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5c31\u4e32\u884c\u5316\u4e86\uff0c\u8fd9\u4e2a\u662f\u6bd4\u8f83\u56f0\u96be\u7684\u3002\u4f46\u5982\u679c\u7b2c\u4e00\u4e2a\u5206\u652f\u4e0d\u8df3\u8f6c\uff0c\u53bb\u9884\u6d4b\u7b2c\u4e8c\u4e2a\u5206\u652f\u8df3\u8f6c\u6216\u8005\u4e0d\u8df3\u8f6c\uff0c\u8fd9\u4e2a\u8fd8\u662f\u76f8\u5bf9\u6bd4\u8f83\u597d\u652f\u6301\u7684\u3002\u8fd9\u6837\uff0c\u5206\u652f\u9884\u6d4b\u65f6\uff0c\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u6700\u591a\u9884\u6d4b\u4e00\u4e2a taken \u5206\u652f\uff0c\u4f46\u540c\u65f6\u8fd8\u53ef\u4ee5\u6709 not taken \u5206\u652f\u3002\u6b64\u5916\uff0c\u8fd8\u6709\u90a3\u79cd\u4ece\u6765\u6ca1\u6709 taken \u8fc7\u7684\u5206\u652f\uff0c\u8fd9\u79cd\u4e00\u822c\u4e3a\u4e86\u8282\u7701 BTB \u5b58\u50a8\uff0c\u4e00\u822c\u662f\u4e0d\u8bb0\u5f55\u5728 BTB \u5185\u90e8\u7684\u3002\u8003\u8651\u5230\u8fd9\u4e9b\u60c5\u51b5\uff0c\u8bbe\u8ba1\u4e24\u4e2a\u5206\u652f\u6267\u884c\u5355\u5143\u4f1a\u6709\u4e00\u4e9b\u6536\u76ca\u3002</p> <p>\u4f46\u662f\u4e3a\u4ec0\u4e48\u6ca1\u6709\u589e\u52a0\u5230\u4e09\u4e2a\u5462\uff1f\u8fd8\u771f\u6709\uff0cZen 5 \u5c31\u589e\u52a0\u5230\u4e86\u4e09\u4e2a\u5206\u652f\u6267\u884c\u5355\u5143\uff0c\u4f46\u662f\u589e\u52a0\u5230\u4e09\u4e2a\u7684\u524d\u63d0\u662f\u6bcf\u5468\u671f\u53ef\u4ee5\u9884\u6d4b\u4e24\u4e2a taken \u5206\u652f\uff0c\u5426\u5219\u6027\u80fd\u6536\u76ca\u5f88\u5c0f\u3002\u8fd9\u662f\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u4e0b\u9762\u6211\u4eec\u6765\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002</p>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#2-taken2-ahead","title":"2-taken/2-ahead","text":"<p>\u521a\u624d\u63d0\u5230\uff0c\u60f3\u8981\u8fdb\u4e00\u6b65\u63d0\u5347\u5206\u652f\u9884\u6d4b\u548c\u6267\u884c\u80fd\u529b\uff0c\u9700\u8981\u652f\u6301\u6bcf\u4e2a\u5468\u671f\u9884\u6d4b\u66f4\u591a\u7684 taken \u5206\u652f\uff0c\u521a\u624d\u662f 1 \u4e2a\uff0c\u73b0\u5728\u5c31\u8981 2 \u4e2a\u3002ARM \u5728 Cortex-A78 \u4e0a\u6dfb\u52a0\u4e86 2-taken \u5206\u652f\u9884\u6d4b\u7684\u652f\u6301\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u6bcf\u5468\u671f\u6700\u591a\u53ef\u4ee5\u9884\u6d4b\u4e24\u4e2a taken \u7684\u5206\u652f\u3002\u8fd9\u662f\u600e\u4e48\u505a\u5230\u7684\uff1f\u5982\u679c\u505a\u7684\u975e\u5e38\u901a\u7528\uff0c\u5c31\u8981\u50cf\u4e0a\u9762\u8bf4\u7684\u90a3\u6837\uff0c\u5148\u9884\u6d4b\u7b2c\u4e00\u4e2a\u5206\u652f\uff0c\u62ff\u7b2c\u4e00\u4e2a\u5206\u652f\u9884\u6d4b\u7684\u7ed3\u679c\uff0c\u518d\u53bb\u9884\u6d4b\u7b2c\u4e8c\u4e2a\u5206\u652f\uff0c\u8fd9\u4ef6\u4e8b\u60c5\u8981\u5728\u4e00\u4e2a\u5468\u671f\u5185\u5b8c\u6210\uff0c\u8fd9\u4e2a\u6311\u6218\u662f\u5f88\u5927\u7684\u3002\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\uff1a</p> <p>\u5047\u5982\u73b0\u5728\u6709\u56db\u4e2a\u57fa\u672c\u5757 A\u3001B\u3001C \u548c D\uff0c\u5e76\u4e14\u6309\u7167\u8fd9\u4e2a\u987a\u5e8f\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cA \u6700\u540e\u7684\u6307\u4ee4\u662f\u4e00\u4e2a\u5206\u652f\uff0c\u8df3\u8f6c\u5230 B\uff0c\u540c\u7406 B \u8df3\u8f6c\u5230 C\uff0cC \u8df3\u8f6c\u5230 D\u3002\u7ecf\u5178\u7684\u5206\u652f\u9884\u6d4b\u7b97\u6cd5\uff0c\u7528 A \u53bb\u9884\u6d4b B\uff0c\u7528 B \u53bb\u9884\u6d4b C\uff0c\u7528 C \u53bb\u9884\u6d4b D\uff0c\u8fd9\u6837\u6bcf\u4e2a\u5468\u671f\u9884\u6d4b\u4e00\u4e2a taken \u5206\u652f\u3002\u90a3\u4e48\u5982\u679c\u8981\u5b9e\u73b0 2-taken \u9884\u6d4b\u7b97\u6cd5\uff0c\u5047\u5982\u5df2\u77e5\u4e86 A\uff0c\u90a3\u5c31\u8981\u9884\u6d4b B \u548c C\uff0c\u4f46\u662f\u5c31\u5fc5\u987b\u5148\u62ff A \u9884\u6d4b B\uff0c\u518d\u62ff B \u9884\u6d4b C\uff0c\u8fd9\u6837\u5c31\u4e32\u884c\u4e86\uff0c\u65f6\u5e8f\u5f88\u96be\u4fdd\u8bc1\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u540c\u65f6\u641e\u4e24\u5957\u9884\u6d4b\uff0c\u4e00\u5957\u7528 A \u9884\u6d4b B\uff0c\u4e00\u5957\u7528 A \u9884\u6d4b C\uff0c\u4f46\u662f\u8fd9\u6837\u6bcf\u4e2a\u5206\u652f\u8981\u8bb0\u5f55\u7684\u4fe1\u606f\u5c31\u7ffb\u500d\u4e86\u3002</p> <p>\u5728\u8bba\u6587 Multiple-Block Ahead Branch Predictors \u4e2d\u53ef\u4ee5\u770b\u5230\u4e00\u79cd\u66f4\u901a\u7528\u505a\u6cd5\uff0c\u79f0\u4e3a 2-ahead\uff1a\u5df2\u77e5 A \u548c B\uff0c\u7528 A \u53bb\u9884\u6d4b C\uff0c\u7528 B \u53bb\u9884\u6d4b D\u3002\u6b64\u65f6\u5206\u652f\u9884\u6d4b\u7684\u5c31\u662f\u95f4\u9694\u4e00\u6b21\u4ee5\u540e\u7684\u76ee\u7684\u5730\u5740\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7684\u76ee\u7684\u5730\u5740\uff0c\u8fd9\u6837\u7684\u8bbe\u8ba1\u4e0b\uff0cBTB \u7b49\u7ed3\u6784\u9700\u8981\u53d8\u6210\u53cc\u7aef\u53e3\uff0c\u8fd9\u6837\u624d\u80fd\u540c\u65f6\u9884\u6d4b\u4e24\u4e2a\u5206\u652f\uff1aA \u548c B\u3002\u9884\u6d4b\u51fa C \u548c D \u4ee5\u540e\uff0c\u518d\u7528\u540c\u6837\u7684\u529e\u6cd5\u53bb\u9884\u6d4b E \u548c F\uff0c\u8fd9\u6837\u6301\u7eed\u4e0b\u53bb\u3002\u5f53\u7136\u8bba\u6587\u8bbe\u8ba1\u7684\u6bd4\u8fd9\u91cc\u8bb2\u7684\u66f4\u590d\u6742\u4e00\u70b9\uff0c\u5177\u4f53\u7ec6\u8282\u89c1\u8bba\u6587\u3002</p> <p>\u6211\u4eec\u4e0d\u77e5\u9053 ARM \u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u7684 2-taken\uff0c\u4f46\u662f\u53ef\u4ee5\u731c\u60f3\u5b83\u505a\u4e86\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u867d\u7136\u4e24\u4e2a\u5206\u652f\u90fd\u662f taken\uff0c\u4f46\u662f\u53ef\u80fd\u5bf9\u504f\u79fb\u3001\u5730\u5740\u6709\u4e00\u4e9b\u9650\u5236\uff0c\u4f8b\u5982\u8981\u6c42\u5728\u540c\u4e00\u4e2a cacheline \u5185\u3002Intel \u7684 Golden Cove \u67b6\u6784\uff0cAMD \u7684 Zen 4 \u67b6\u6784\u4e5f\u5b9e\u73b0\u4e86 2-taken\uff0c\u90fd\u6709\u6216\u591a\u6216\u5c11\u7c7b\u4f3c\u7684\u9650\u5236\u3002Chips and Cheese \u662f\u8fd9\u4e48\u63cf\u8ff0 Intel \u548c ARM \u7684 2-taken \u652f\u6301\u7684\uff1a</p> <p>Rocket Lake could unroll small loops within its loop buffer, turning taken branches into not-taken ones from the fetch perspective. Arm\u2019s Neoverse N2 and Cortex X2 can also sustain two taken branches per cycle by using a 64 entry nano-BTB.</p> <p>\u5728 AMD \u9488\u5bf9 Zen 2 \u7684 Software Optimization Guide for AMD Family 17h Models 30h and Greater Processors \u4e2d\u4e5f\u660e\u786e\u6307\u51fa\uff0cBTB \u6bcf\u4e2a\u6761\u76ee\u6700\u591a\u53ef\u4ee5\u8bb0\u5f55\u540c\u4e00\u4e2a cache line \u91cc\u7684\u4e24\u4e2a\u5206\u652f\uff0c\u4f46\u662f\u8981\u6c42\u7b2c\u4e00\u4e2a\u5206\u652f\u662f\u6761\u4ef6\u5206\u652f\uff0c\u8fd9\u4e3a 2-taken \u5206\u652f\u9884\u6d4b\u63d0\u4f9b\u4e86\u5fc5\u8981\u7684\u4fe1\u606f\uff0c\u4f46\u4e5f\u6709\u9650\u5236\uff1a</p> <p>The branch target buffer (BTB) is a three-level structure accessed using the fetch address of the current fetch block. Each BTB entry includes information for branches and their targets. Each BTB entry can hold up to two branches if the branches reside in the same 64-byte aligned cache line and the first branch is a conditional branch.</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u7528 2-taken \u8868\u793a\u9650\u5236\u6bd4\u8f83\u591a\u7684\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u9884\u6d4b 2 \u4e2a taken \u7684\u7b97\u6cd5\uff0c\u800c\u7528 2-ahead \u8868\u793a\u66f4\u52a0\u901a\u7528\u7684\u9884\u6d4b 2 \u4e2a taken \u7684\u7b97\u6cd5\u3002\u5373\u4f7f\u505a\u4e86 2-taken \u7684\u9884\u6d4b\u5668\u652f\u6301\uff0c\u4e5f\u672a\u5fc5\u53ef\u4ee5\u6bcf\u5468\u671f\u6267\u884c 2 \u4e2a taken \u5206\u652f\uff0c\u4f8b\u5982 AMD \u5728\u8bba\u6587 AMD Next-Generation \u201cZen 4\u201d Core and 4th Gen AMD EPYC Server CPUs \u662f\u8fd9\u4e48\u8868\u8ff0 Zen 4 \u7684 2-taken \u5b9e\u73b0\u7684\uff1a</p> <p>To better feed the wide execution engine, AMD has implemented several front-end bandwidth improvements on \u201cZen 4.\u201d One is the ability to predict and dispatch up to two taken branches per cycle. While the Instruction Cache (I-Cache) or Operation Cache (Op Cache) fetch limits the sustained fetch bandwidth to one taken branch per cycle, predicting two taken branches per cycle allows the branch predictor to run ahead more often and compensate for existing branch prediction stall cycles. Dispatching up to two taken branches per cycle, and optimizations of the integer scheduler assignment allow \u201cZen 4\u201d to fill the out-of-order part of the machine faster once a dispatch (allocation) stall has been resolved.</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u867d\u7136\u505a\u4e86 2-taken/2-ahead\uff0c\u53ea\u662f\u5206\u652f\u9884\u6d4b\u7684\u5e26\u5bbd\u589e\u52a0\u4e86\uff0c\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u9884\u6d4b\u66f4\u591a\u7684\u5206\u652f\uff0c\u4f46\u8fd9\u8fd8\u4e0d\u591f\u3002\u524d\u9762\u4e5f\u63d0\u5230\u4e86\uff0c\u5206\u652f\u9884\u6d4b\u5668\u662f\u751f\u4ea7\u8005\uff0c\u6307\u4ee4\u7f13\u5b58\u662f\u6d88\u8d39\u8005\uff0c\u751f\u4ea7\u8005\u7684\u6027\u80fd\u63d0\u5347\u4e86\uff0c\u90a3\u4e48\u6d88\u8d39\u8005\u7684\u6027\u80fd\u4e5f\u8981\u76f8\u5e94\u63d0\u5347\u624d\u662f\u3002\u4f46\u662f\u6307\u4ee4\u7f13\u5b58\u662f\u4e00\u7247\u5f88\u5927\u7684 SRAM\uff0c\u529f\u8017\u548c\u65f6\u5e8f\u90fd\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6240\u4ee5\u6539\u8d77\u6765\u6bd4\u8f83\u56f0\u96be\u3002\u5982\u679c\u5355\u7eaf\u589e\u52a0\u6307\u4ee4\u7f13\u5b58\u4e00\u6b21\u53d6\u6307\u7684\u5bbd\u5ea6\uff0c\u4f8b\u5982 8 \u5b57\u8282\u63d0\u5347\u5230 16 \u5b57\u8282\uff0c\u5bf9\u4e8e\u5206\u652f\u5bc6\u5ea6\u4f4e\u7684\u60c5\u51b5\u6bd4\u8f83\u6709\u6548\uff0c\u4f46\u5982\u679c\u5206\u652f\u5f88\u591a\uff0c\u90a3\u4e48\u8fd9\u6837\u6548\u679c\u4e5f\u4e0d\u4f1a\u5f88\u597d\uff0c\u8981\u63d0\u5347\u6027\u80fd\uff0c\u5c31\u8981\u8003\u8651\u53cc\u7aef\u53e3\uff0c\u6bcf\u4e2a\u5468\u671f\u4ece\u4e24\u4e2a\u4e0d\u540c\u7684\u5730\u5740\u53d6\u6307\u3002\u8fd9\u5c31\u662f Zen 5 \u505a\u7684\u4e8b\u60c5\u3002</p>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#2-fetch","title":"2-fetch","text":"<p>Zen 5 \u9664\u4e86 2-taken \u4ee5\u5916\uff0c\u8fd8\u5b9e\u73b0\u4e86 2-fetch\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u9884\u6d4b\u672a\u6765\u7684\u4e24\u4e2a\u5206\u652f\uff0c\u5e76\u4ece\u4e24\u4e2a\u5730\u5740\u53d6\u6307\u4ee4\uff0c\u5206\u522b\u8bd1\u7801\uff0c\u7136\u540e\u518d\u62fc\u8d77\u6765\u3002\u6b64\u5916\uff0cZen 5 \u7684\u53cc\u53d6\u6307\u8fd8\u53ef\u4ee5\u670d\u52a1\u4e8e\u8d85\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u7528\u4e00\u4e2a\u53d6\u6307\u6d41\u6c34\u7ebf\u3002\u5f53\u8d85\u7ebf\u7a0b\u7a7a\u95f2\u7684\u65f6\u5019\uff0c\u4e24\u4e2a\u53d6\u503c\u6d41\u6c34\u7ebf\u53ef\u4ee5\u670d\u52a1\u4e8e\u540c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u63d0\u4f9b\u66f4\u9ad8\u7684\u6027\u80fd\u3002</p> <p>\u76ee\u524d Zen 5 \u7684\u5b9e\u73b0\u7ec6\u8282\u8fd8\u4e0d\u6e05\u6670\uff0c\u671f\u5f85\u672a\u6765\u66f4\u591a\u7684\u5fae\u67b6\u6784\u89e3\u6790\u3002</p>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2024/08/02/branch-prediction-2-taken-2-ahead/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Zen 5\u2019s 2-Ahead Branch Predictor Unit: How a 30 Year Old Idea Allows for New Tricks</li> <li>Arm's New Cortex-A78 and Cortex-X1 Microarchitectures: An Efficiency and Performance Divergence - Anandtech</li> <li>AMD Zen 5 Technical Deep Dive</li> <li>AMD Zen 5 Architecture Reveal: A Ryzen 9000 And Ryzen AI 300 Deep Dive</li> <li>AMD deep-dives Zen 5 architecture \u2014 Ryzen 9000 and AI 300 benchmarks, RDNA 3.5 GPU, XDNA 2, and more</li> <li>Optimizations Enabled by a Decoupled Front-End Architecture</li> <li>The Cortex-A77 \u00b5arch: Added ALUs &amp; Better Load/Stores</li> <li>Multiple-Block Ahead Branch Predictors</li> <li>Popping the Hood on Golden Cove</li> <li>AMD Zen 4 Ryzen 9 7950X and Ryzen 5 7600X Review: Retaking The High-End</li> <li>AMD Next-Generation \u201cZen 4\u201d Core and 4th Gen AMD EPYC Server CPUs</li> </ul>","tags":["cpu","ooo","branch","prediction","arm","cortex","predictor"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/","title":"\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u5199\u8fc7\u4e00\u4e2a\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff0c\u968f\u7740\u5b66\u4e60\u7684\u6df1\u5165\uff0c\u5185\u5bb9\u8d8a\u6765\u8d8a\u591a\uff0c\u9875\u9762\u592a\u957f\uff0c\u56e0\u6b64\u628a\u540e\u9762\u7684\u4e00\u90e8\u5206\u5185\u5bb9\u72ec\u7acb\u51fa\u6765\uff0c\u53d8\u6210\u4e86\u8fd9\u7bc7\u535a\u5ba2\u6587\u7ae0\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u8ba8\u8bba\u8bbf\u5b58\u7684\u90e8\u5206\u3002</p> <p>\u672c\u7cfb\u5217\u7684\u6240\u6709\u6587\u7ae0\uff1a</p> <ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> </ul>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#\u5185\u5b58\u8bbf\u95ee","title":"\u5185\u5b58\u8bbf\u95ee","text":"<p>\u5185\u5b58\u8bbf\u95ee\u662f\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u5b83\u6d89\u53ca\u5230\u7f13\u5b58\u3001\u9875\u8868\u3001\u5185\u5b58\u5e8f\u7b49\u95ee\u9898\u3002\u5728\u4e71\u5e8f\u6267\u884c\u4e2d\uff0c\u8981\u5c3d\u91cf\u4f18\u5316\u5185\u5b58\u8bbf\u95ee\u5bf9\u5176\u4ed6\u6307\u4ee4\u7684\u5ef6\u8fdf\u7684\u5f71\u54cd\uff0c\u540c\u65f6\u4e5f\u8981\u4fdd\u8bc1\u6b63\u786e\u6027\u3002\u8fd9\u91cc\u53c2\u8003\u7684\u662f BOOM \u7684 LSU \u8bbe\u8ba1\u3002</p> <p>\u9996\u5148\u662f\u6b63\u786e\u6027\u3002\u4e00\u822c\u6765\u8bf4\u53ef\u4ee5\u8ba4\u4e3a\uff0cLoad \u662f\u6ca1\u6709\u526f\u4f5c\u7528\u7684\uff08\u5b9e\u9645\u4e0a\uff0cLoad \u4f1a\u5bfc\u81f4 Cache \u52a0\u8f7d\u6570\u636e\uff0c\u8fd9\u4e5f\u5f15\u53d1\u4e86\u4ee5 Meltdown \u4e3a\u9996\u7684\u4e00\u7cfb\u5217\u6f0f\u6d1e\uff09\uff0c\u56e0\u6b64\u53ef\u4ee5\u5f88\u6fc0\u8fdb\u5730\u9884\u6d4b\u6267\u884c Load\u3002\u4f46\u662f\uff0cStore \u662f\u6709\u526f\u4f5c\u7528\u7684\uff0c\u5199\u51fa\u53bb\u7684\u6570\u636e\u5c31\u6ca1\u6cd5\u8fd8\u539f\u4e86\u3002\u56e0\u6b64\uff0cStore \u6307\u4ee4\u53ea\u6709\u5728 ROB Head \u88ab Commit \u7684\u65f6\u5019\uff0c\u624d\u4f1a\u5199\u5165\u5230 Cache \u4e2d\u3002</p> <p>\u5176\u6b21\u662f\u6027\u80fd\uff0c\u6211\u4eec\u5e0c\u671b Load \u6307\u4ee4\u53ef\u4ee5\u5c3d\u5feb\u5730\u5b8c\u6210\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u540e\u7eed\u7684\u8ba1\u7b97\u6307\u4ee4\u53ef\u4ee5\u5c3d\u5feb\u5730\u5f00\u59cb\u8fdb\u884c\u3002\u5f53 Load \u6307\u4ee4\u7684\u5730\u5740\u5df2\u7ecf\u8ba1\u7b97\u597d\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u53bb\u53d6\u6570\u636e\uff0c\u8fd9\u65f6\u5019\uff0c\u9996\u5148\u8981\u53bb Store Queue \u91cc\u9762\u627e\uff0c\u5982\u679c\u6709 Store \u6307\u4ee4\u8981\u5199\u5165\u7684\u5730\u5740\u7b49\u4e8e Load \u7684\u5730\u5740\uff0c\u8bf4\u660e\u540e\u9762\u7684 Load \u4f9d\u8d56\u4e8e\u524d\u9762\u7684 Store\uff0c\u5982\u679c Store \u7684\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u6570\u636e\u8f6c\u53d1\u8fc7\u6765\uff0c\u5c31\u4e0d\u9700\u8981\u4ece Cache \u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u6570\u636e\u8fd8\u6ca1\u51c6\u5907\u597d\uff0c\u5c31\u9700\u8981\u7b49\u5f85\u8fd9\u4e00\u6761 Store \u5b8c\u6210\uff1b\u5982\u679c\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684 Store \u6307\u4ee4\uff0c\u518d\u4ece\u5185\u5b58\u4e2d\u53d6\u3002\u4e0d\u8fc7\uff0c\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f\uff0c\u5f53 Store \u6307\u4ee4\u7684\u5730\u5740\u8fdf\u8fdf\u6ca1\u6709\u8ba1\u7b97\u51fa\u6765\uff0c\u800c\u540e\u9762\u7684 Load \u5df2\u7ecf\u63d0\u524d\u4ece Cache \u4e2d\u83b7\u53d6\u6570\u636e\u4e86\uff0c\u8fd9\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0\u9519\u8bef\uff0c\u6240\u4ee5\u5f53 Store \u8ba1\u7b97\u51fa\u5730\u5740\u7684\u65f6\u5019\uff0c\u9700\u8981\u68c0\u67e5\u540e\u9762\u7684 Load \u6307\u4ee4\u662f\u5426\u51fa\u73b0\u5730\u5740\u91cd\u5408\uff0c\u5982\u679c\u51fa\u73b0\u4e86\uff0c\u5c31\u8981\u628a\u8fd9\u6761 Load \u4ee5\u53ca\u4f9d\u8d56\u8fd9\u6761 Load \u6307\u4ee4\u7684\u5176\u4f59\u6307\u4ee4\u91cd\u65b0\u6267\u884c\u3002POWER8 \u5904\u7406\u5668\u5fae\u67b6\u6784\u8bba\u6587\u4e2d\u5bf9\u6b64\u4e5f\u6709\u7c7b\u4f3c\u7684\u8868\u8ff0\uff1a</p> <pre><code>The POWER8 IFU also implements mechanisms to mitigate performance\ndegradation associated with pipeline hazards. A Store-Hit-Load (SHL) is\nan out-of-order pipeline hazard condition, where an older store executes\nafter a younger overlapping load, thus signaling that the load received\nstale data. The POWER8 IFU has logic to detect when this condition\nexists and provide control to avoid the hazard by flushing the load\ninstruction which received stale data (and any following instructions).\nWhen a load is flushed due to detection of a SHL, the fetch address of\nthe load is saved and the load is marked on subsequent fetches allowing\nthe downstream logic to prevent the hazard. When a marked load\ninstruction is observed, the downstream logic introduces an explicit\nregister dependency for the load to ensure that it is issued after the\nstore operation.\n</code></pre> <p>\u4e0b\u9762\u518d\u8be6\u7ec6\u8ba8\u8bba\u4e00\u4e0b LSU \u7684\u8bbe\u8ba1\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#load-store-unit","title":"Load Store Unit","text":"<p>LSU \u662f\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u6267\u884c\u5355\u5143\uff0c\u8d1f\u8d23 Load/Store/Atomic \u7b49\u6307\u4ee4\u7684\u5b9e\u73b0\u3002\u6700\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u6cd5\u662f\u6309\u987a\u5e8f\u6267\u884c\uff0c\u4f46\u7531\u4e8e pipeline \u4f1a\u88ab\u6e05\u7a7a\uff0cStore/Atomic/Uncached Load \u8fd9\u7c7b\u6709\u526f\u4f5c\u7528\uff08\u5f53\u7136\u4e86\uff0c\u5982\u679c\u8003\u8651 Meltdown \u7c7b\u653b\u51fb\u7684\u8bdd\uff0cCached Load \u4e5f\u6709\u526f\u4f5c\u7528\uff0c\u8fd9\u91cc\u5c31\u5ffd\u7565\u4e86\uff09\uff0c\u9700\u8981\u7b49\u5230 commit \u7684\u65f6\u5019\u518d\u6267\u884c\u3002\u8fd9\u6837 LSU \u5f88\u5bb9\u6613\u6210\u4e3a\u74f6\u9888\uff0c\u7279\u522b\u662f\u5728\u8bbf\u5b58\u6307\u4ee4\u6bd4\u8f83\u591a\u7684\u65f6\u5019\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f88\u91cd\u8981\u7684\u662f\u8ba9\u8bfb\u5199\u4e5f\u4e71\u5e8f\u8d77\u6765\uff0c\u5177\u4f53\u600e\u4e48\u4e71\u5e8f\uff0c\u53d7\u5230\u5b9e\u73b0\u7684\u5f71\u54cd\u548c Memory Order/Program Order \u7684\u8981\u6c42\u3002\u4ece\u6027\u80fd\u7684\u89d2\u5ea6\u4e0a\u6765\u770b\uff0c\u6211\u4eec\u80af\u5b9a\u5e0c\u671b Load \u53ef\u4ee5\u5c3d\u5feb\u6267\u884c\uff0c\u56e0\u4e3a\u53ef\u80fd\u6709\u5f88\u591a\u6307\u4ee4\u5728\u7b49\u5f85 Load \u7684\u7ed3\u679c\u3002\u90a3\u4e48\uff0c\u9700\u8981\u63d0\u524d\u6267\u884c Load\uff0c\u4f46\u662f\u600e\u4e48\u4fdd\u8bc1\u6b63\u786e\u6027\u5462\uff1f\u5728 Load \u66f4\u65e9\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u8fd8\u6709\u82e5\u5e72\u4e2a Store \u6307\u4ee4\u5c1a\u672a\u6267\u884c\uff0c\u4e00\u4e2a\u601d\u8def\u662f\u7b49\u5f85\u6240\u6709\u7684 Store \u6267\u884c\u5b8c\u6bd5\uff0c\u4f46\u662f\u8fd9\u6837\u6027\u80fd\u4e0d\u597d\uff1b\u53e6\u4e00\u4e2a\u601d\u8def\u662f\u7528\u5730\u5740\u6765\u641c\u7d22 Store \u6307\u4ee4\uff0c\u770b\u770b\u662f\u5426\u51fa\u73b0\u5bf9\u540c\u4e00\u4e2a\u5730\u5740\u7684 Store \u548c Load\uff0c\u5982\u679c\u6709\uff0c\u76f4\u63a5\u8f6c\u53d1\u6570\u636e\uff0c\u5c31\u4e0d\u9700\u8981\u4ece Cache \u83b7\u53d6\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u6cd5\u76f8\u5f53\u4e8e\u505a\u4e86\u4e00\u4e2a\u5168\u76f8\u8fde\u7684 Buffer\uff0c\u9762\u79ef\u5927\uff0c\u5ef6\u8fdf\u9ad8\uff0c\u4e0d\u597d\u6269\u5c55\u7b49\u95ee\u9898\u63a5\u8e35\u800c\u81f3\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3 Store Queue \u9700\u8981\u76f8\u8fde\u641c\u7d22\u7684\u95ee\u9898\uff0cA high-bandwidth load-store unit for single-and multi-threaded processors \u7684\u89e3\u51b3\u601d\u8def\u662f\uff0c\u628a Store \u6307\u4ee4\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u9700\u8981\u8f6c\u53d1\u7684\uff0c\u4e00\u7c7b\u662f\u4e0d\u9700\u8981\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u8ba1\u4e00\u4e2a\u5c0f\u7684\u76f8\u8fde\u5b58\u50a8\u5668\uff0c\u53ea\u4fdd\u5b58\u8fd9\u4e9b\u9700\u8981\u8f6c\u53d1\u7684 Store \u6307\u4ee4\uff1b\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\uff0c\u4fdd\u5b58\u6240\u6709 Store \u6307\u4ee4\u7684\u961f\u5217\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u76f8\u8fde\u641c\u7d22\uff0c\u6240\u4ee5\u53ef\u4ee5\u505a\u7684\u6bd4\u8f83\u5927\u3002</p> <p>\u4ed4\u7ec6\u60f3\u60f3\uff0c\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1aLoad \u5728\u6267\u884c\u524d\uff0c\u66f4\u65e9\u7684 Store \u7684\u5730\u5740\u53ef\u80fd\u8fd8\u6ca1\u6709\u5c31\u7eea\uff0c\u8fd9\u65f6\u5019\u53bb\u641c\u7d22 Store Queue \u5f97\u5230\u7684\u7ed3\u679c\u53ef\u80fd\u662f\u9519\u7684\uff0c\u8fd9\u65f6\u5019\u8981\u4e48\u7b49\u5f85\u6240\u6709\u7684 Store \u5730\u5740\u90fd\u5c31\u7eea\uff0c\u8981\u4e48\u5c31\u5148\u6267\u884c\uff0c\u518d\u7528\u4e00\u4e9b\u673a\u5236\u6765\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\uff0c\u663e\u7136\u540e\u8005 IPC \u8981\u66f4\u597d\u3002</p> <p>\u4fee\u590d Load Store \u6307\u4ee4\u76f8\u5173\u6027\u95ee\u9898\uff0c\u4e00\u4e2a\u65b9\u6cd5\u662f\u5f53\u4e00\u4e2a Store \u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u68c0\u67e5\u662f\u5426\u6709\u5730\u5740\u51b2\u7a81\u7684 Load \u6307\u4ee4\uff08\u90a3\u4e48 Load Queue \u4e5f\u8981\u505a\u6210\u76f8\u8fde\u641c\u7d22\u7684\uff09\uff0c\u662f\u5426\u8f6c\u53d1\u4e86\u9519\u8bef\u7684 Store \u6570\u636e\uff0c\u8fd9\u4e5f\u662f Boom LSU \u91c7\u7528\u7684\u65b9\u6cd5\u3002\u53e6\u4e00\u4e2a\u529e\u6cd5\u662f Commit \u7684\u65f6\u5019\uff08\u6216\u8005\u6309\u987a\u5e8f\uff09\u91cd\u65b0\u6267\u884c Load \u6307\u4ee4\uff0c\u5982\u679c Load \u7ed3\u679c\u548c\u4e4b\u524d\u4e0d\u540c\uff0c\u8981\u628a\u540e\u9762\u4f9d\u8d56\u7684\u5237\u65b0\u6389\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u7f3a\u70b9\u662f\u6bcf\u6761 Load \u6307\u4ee4\u90fd\u8981\u81f3\u5c11\u8bbf\u95ee\u4e24\u6b21 Cache\u3002Store Vulnerability Window (SVW): Re-Execution Filtering for Enhanced Load Optimization \u5c5e\u4e8e\u91cd\u65b0\u6267\u884c Load \u6307\u4ee4\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7 Bloom filter \u6765\u51cf\u5c11\u4e00\u4e9b\u6ca1\u6709\u5fc5\u8981\u91cd\u590d\u6267\u884c\u7684 Load\u3002\u8fd8\u6709\u4e00\u79cd\u529e\u6cd5\uff0c\u5c31\u662f\u9884\u6d4b Load \u6307\u4ee4\u548c\u54ea\u4e00\u6761 Store \u6307\u4ee4\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u7136\u540e\u76f4\u63a5\u53bb\u8bbf\u95ee\u90a3\u4e00\u9879\uff0c\u5982\u679c\u4e0d\u5339\u914d\uff0c\u5c31\u8ba4\u4e3a\u6ca1\u6709\u4f9d\u8d56\u3002Scalable Store-Load Forwarding via Store Queue Index Prediction \u628a Load \u6307\u4ee4\u5206\u4e3a\u4e09\u7c7b\uff0c\u4e00\u7c7b\u662f\u4e0d\u786e\u5b9a\u4f9d\u8d56\u54ea\u6761 Store \u6307\u4ee4\uff08Difficult Loads\uff09\uff0c\u4e00\u7c7b\u662f\u57fa\u672c\u786e\u5b9a\u4f9d\u8d56\u54ea\u4e00\u6761 Store \u6307\u4ee4\uff0c\u4e00\u7c7b\u662f\u4e0d\u4f9d\u8d56 Store \u6307\u4ee4\u3002\u8fd9\u4e2a\u6709\u70b9\u50cf Cache \u91cc\u9762\u7684 Way Prediction \u673a\u5236\u3002</p> <p>\u5206\u6790\u5b8c\u4e86\u4e0a\u8ff0\u4e00\u4e9b\u4f18\u5316\u65b9\u6cd5\uff0c\u6211\u4eec\u4e5f\u6765\u770b\u4e00\u4e9b CPU \u8bbe\u8ba1\u91c7\u7528\u4e86\u54ea\u79cd\u65b9\u6848\u3002\u9996\u5148\u6765\u5206\u6790\u4e00\u4e0b IBM POWER8 \u7684 LSU\uff0c\u9996\u5148\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u8bbe\u8ba1\u4e86\u6bd4\u8f83\u591a\u9879\u76ee\u7684 virtual STAG/LTAG\uff0c\u7136\u540e\u518d\u8f6c\u6362\u6210\u6bd4\u8f83\u5c11\u9879\u76ee\u7684 physical STAG/LTAG\uff0c\u8fd9\u6837 LSQ \u53ef\u4ee5\u505a\u7684\u6bd4\u8f83\u5c0f\uff0c\u539f\u6587\uff1a</p> <pre><code>A virtual STAG/LTAG scheme is used to minimize dispatch holds due to\nrunning out of physical SRQ/LRQ entries. When a physical entry in the\nLRQ is freed up, a virtual LTAG will be converted to a real LTAG. When a\nphysical entry in the SRQ is freed up, a virtual STAG will be converted\nto a real STAG. Virtual STAG/LTAGs are not issued to the LSU until they\nare subsequently marked as being real in the UniQueue. The ISU can\nassign up to 128 virtual LTAGs and 128 virtual STAGs to each thread.\n</code></pre> <p>\u8fd9\u4e2a\u601d\u8def\u5728 2007 \u5e74\u7684\u8bba\u6587 Late-Binding: Enabling Unordered Load-Store Queues \u91cc\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u4e5f\u8bb8 POWER8 \u53c2\u8003\u4e86\u8fd9\u7bc7\u8bba\u6587\u7684\u8bbe\u8ba1\u3002\u53ef\u4ee5\u770b\u5230\uff0cPOWER8 \u6ca1\u6709\u91c7\u7528\u90a3\u4e9b\u514d\u9664 CAM \u7684\u65b9\u6848\uff1a</p> <pre><code>The SRQ is a 40-entry, real address based CAM structure. Similar to the\nSRQ, the LRQ is a 44-entry, real address based, CAM structure. The LRQ\nkeeps track of out-of-order loads, watching for hazards. Hazards\ngenerally exist when a younger load instruction executes out-of-order\nbefore an older load or store instruction to the same address (in part\nor in whole). When such a hazard is detected, the LRQ initiates a flush\nof the younger load instruction and all its subsequent instructions from\nthe thread, without impacting the instructions from other threads. The\nload is then re-fetched from the I-cache and re-executed, ensuring\nproper load/store ordering.\n</code></pre> <p>\u800c\u662f\u5728\u4f20\u7edf\u7684\u4e24\u4e2a CAM \u8bbe\u8ba1\u7684\u57fa\u7840\u4e0a\uff0c\u505a\u4e86\u51cf\u5c11\u7269\u7406 LSQ \u9879\u76ee\u7684\u4f18\u5316\u3002\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0cPOWER7 \u548c POWER8 \u7684 L1 Cache \u90fd\u662f 8 \u8def\u7ec4\u76f8\u8fde\uff0c\u5e76\u4e14\u91c7\u7528\u4e86 set-prediction \u7684\u65b9\u5f0f\uff08\u5e94\u8be5\u662f\u901a\u5e38\u8bf4\u7684 way-prediction\uff09\u3002</p> <p>\u6b64\u5916\u8fd8\u6709\u4e00\u4e2a\u5b9e\u73b0\u4e0a\u7684\u5c0f\u7ec6\u8282\uff0c\u5c31\u662f\u5728\u5224\u65ad Load \u548c Store \u6307\u4ee4\u662f\u5426\u6709\u76f8\u5173\u6027\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5730\u5740\u4f4d\u6570\u6bd4\u8f83\u591a\uff0c\u5b8c\u6574\u6bd4\u8f83\u7684\u5ef6\u8fdf\u6bd4\u8f83\u5927\uff0c\u53ef\u4ee5\u727a\u7272\u7cbe\u5ea6\u7684\u524d\u63d0\u4e0b\uff0c\u9009\u53d6\u5730\u5740\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u6bd4\u8f83\u3002POWER9 \u8bba\u6587 \u63d0\u5230\u4e86\u8fd9\u4e00\u70b9\uff1a</p> <pre><code>POWER8 and prior designs matched the effective address (EA) bits 48:63\nbetween the younger load and the older store queue entry. In POWER9,\nthrough a combination of outright matches for EA bits 32:63 and hashed\nEA matches for bits 0:31, false positive avoidance is greatly improved.\nThis reduces the number of flushes, which are compulsory for false\npositives.\n</code></pre> <p>\u8fd9\u91cc\u53c8\u662f\u4e00\u4e2a\u7cbe\u786e\u5ea6\u548c\u65f6\u5e8f\u4e0a\u7684\u4e00\u4e2a tradeoff\u3002</p> <p>\u5177\u4f53\u5230 Load/Store Queue \u7684\u5927\u5c0f\uff0c\u5176\u5b9e\u90fd\u4e0d\u5927\uff1a</p> <ol> <li>Zen 2 Store Queue 48</li> <li>Intel Skylake Store Buffer 56 Load Buffer 72</li> <li>POWER 8 Store Queue 40 Load Queue 44 (Virtual 128+128)</li> <li>Alpha 21264 Store Queue 32 Load Queue 32</li> </ol>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#load-pipeline","title":"Load Pipeline","text":"<p>\u4e0b\u9762\u6765\u4e3e\u4f8b\u5206\u6790 LSU \u4e2d Load Pipeline \u6bcf\u4e00\u62cd\u9700\u8981\u505a\u4e9b\u4ec0\u4e48\u3002</p> <p>\u4ee5\u9999\u5c71\u96c1\u6816\u6e56\u5fae\u67b6\u6784\u4e3a\u4f8b\uff0c\u5b83\u7684 Load Pipeline \u5206\u4e3a\u4e09\u7ea7\u6d41\u6c34\u7ebf\uff1a</p> <ol> <li>\u7b2c\u4e00\u7ea7\uff1a\u8ba1\u7b97\u865a\u62df\u5730\u5740\uff08\u57fa\u5730\u5740 + \u7acb\u5373\u6570\u504f\u79fb\uff09\uff0c\u628a\u865a\u62df\u5730\u5740\u9001\u8fdb DTLB \u548c L1 DCache\uff08\u56e0\u4e3a VIPT\uff0c\u865a\u62df\u5730\u5740\u4f5c\u4e3a index \u8bbf\u95ee L1 DCache\uff09\uff0c\u4ece DTLB \u8bfb\u53d6\u7269\u7406\u5730\u5740\uff0c\u4ece L1 DCache Tag Array \u8bfb\u53d6\u5404\u8def\u7684 Tag</li> <li>\u7b2c\u4e8c\u7ea7\uff1a\u4ece DTLB \u5f97\u5230\u4e86\u7269\u7406\u5730\u5740\uff0c\u6839\u636e\u7269\u7406\u5730\u5740\u8ba1\u7b97\u51fa Tag\uff0c\u548c L1 DCache \u8bfb\u51fa\u7684 Tag \u505a\u6bd4\u8f83\uff0c\u627e\u5230\u5339\u914d\u7684 Way\uff0c\u4ece L1 DCache \u7684 Data Array \u8bfb\u53d6\u5bf9\u5e94 Way \u7684\u6570\u636e\uff1b\u628a\u7269\u7406\u5730\u5740\u9001\u5230 Store Queue\uff0c\u67e5\u627e\u5339\u914d\u7684 Store</li> <li>\u7b2c\u4e09\u7ea7\uff1a\u6839\u636e\u4ece L1 DCache \u8bfb\u53d6\u7684\u6570\u636e\u548c Store to Load Forwarding \u5f97\u5230\u7684\u6570\u636e\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u8bfb\u53d6\u7ed3\u679c\uff0c\u5199\u56de</li> </ol> <p>\u4ee5\u9999\u5c71\u5357\u6e56\u5fae\u67b6\u6784\u4e3a\u4f8b\uff0c\u5b83\u7684 Load Pipeline \u5206\u4e3a\u56db\u7ea7\u6d41\u6c34\u7ebf\uff1a</p> <ol> <li>\u7b2c\u4e00\u7ea7\uff1a\u8ba1\u7b97\u865a\u62df\u5730\u5740\uff08\u57fa\u5730\u5740 + \u7acb\u5373\u6570\u504f\u79fb\uff09\uff0c\u628a\u865a\u62df\u5730\u5740\u9001\u8fdb DTLB \u548c L1 DCache\uff08\u56e0\u4e3a VIPT\uff0c\u865a\u62df\u5730\u5740\u4f5c\u4e3a index \u8bbf\u95ee L1 DCache\uff09\uff0c\u4ece DTLB \u8bfb\u53d6\u7269\u7406\u5730\u5740\uff0c\u4ece L1 DCache Tag Array \u8bfb\u53d6\u5404\u8def\u7684 Tag</li> <li>\u7b2c\u4e8c\u7ea7\uff1a\u4ece DTLB \u5f97\u5230\u4e86\u7269\u7406\u5730\u5740\uff0c\u6839\u636e\u7269\u7406\u5730\u5740\u8ba1\u7b97\u51fa Tag\uff0c\u548c L1 DCache \u8bfb\u51fa\u7684 Tag \u505a\u6bd4\u8f83\uff0c\u627e\u5230\u5339\u914d\u7684 Way\uff0c\u4ece L1 DCache \u7684 Data Array \u8bfb\u53d6\u5bf9\u5e94 Way \u7684\u6570\u636e\uff1b\u628a\u7269\u7406\u5730\u5740\u9001\u5230 Store Queue\uff0c\u67e5\u627e\u5339\u914d\u7684 Store</li> <li>\u7b2c\u4e09\u7ea7\uff1a\u7531\u4e8e L1 DCache \u5bb9\u91cf\u8f83\u5927\uff0c\u9700\u8981\u7684\u5ef6\u8fdf\u6bd4\u8f83\u9ad8\uff0c\u5728\u8fd9\u4e00\u7ea7\u5b8c\u6210\u6570\u636e\u7684\u8bfb\u53d6\u548c Store to Load Forwarding</li> <li>\u7b2c\u56db\u7ea7\uff1a\u6839\u636e\u4ece L1 DCache \u8bfb\u53d6\u7684\u6570\u636e\u548c Store to Load Forwarding \u5f97\u5230\u7684\u6570\u636e\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u8bfb\u53d6\u7ed3\u679c\uff0c\u5199\u56de</li> </ol> <p>\u53ef\u89c1\u9999\u5c71\u5357\u6e56\u76f8\u6bd4\u96c1\u6816\u6e56\u7684\u4e3b\u8981\u533a\u522b\u5c31\u662f\u7559\u7ed9 L1 DCache \u8bfb\u53d6\u7684\u65f6\u95f4\u66f4\u957f\u4e86\uff0c4 \u5468\u671f\u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684 Load to use latency\u3002</p> <p>\u4e3a\u4e86\u51cf\u5c11\u989d\u5916\u7684 1 \u4e2a\u5468\u671f\u5bf9 pointer chasing \u573a\u666f\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u5357\u6e56\u67b6\u6784\u9488\u5bf9 pointer chasing \u505a\u4e86\u4f18\u5316\uff1apointer chasing \u573a\u666f\u4e0b\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u4f1a\u6210\u4e3a\u540e\u7eed load \u6307\u4ee4\u7684\u5730\u5740\u3002\u4e3a\u4e86\u4f18\u5316\u5b83\uff0c\u5357\u6e56\u67b6\u6784\u5728\u6d41\u6c34\u7ebf\u7684\u7b2c\u56db\u7ea7\u4e0a\u505a\u4e86\u524d\u4f20\uff0c\u76f4\u63a5\u4f20\u9012\u5230\u4e0b\u4e00\u6761 load \u6307\u4ee4\u7684\u7531\u865a\u62df\u5730\u5740\u8ba1\u7b97\u51fa\u7684 index\uff0c\u8fd9\u6837\u7684\u8bdd\u53ef\u4ee5\u505a\u5230 3 cycle \u7684 load to use latency\u3002\u4e3a\u4e86\u4f18\u5316\u65f6\u5e8f\uff0c\u524d\u4f20\u7684\u65f6\u5019\uff0c\u5047\u8bbe\u57fa\u5730\u5740\u52a0\u4e0a imm \u4ee5\u540e\uff0c\u4e0d\u4f1a\u5f71\u54cd index\uff0c\u8fd9\u6837\u9884\u6d4b\u7684\u65f6\u5019\u5c31\u4e0d\u7528\u52a0\u4e0a imm\uff0c\u65f6\u5e8f\u4e0a\u4f1a\u597d\u4e00\u4e9b\uff0c\u4e0d\u8fc7\u8fd9\u4e5f\u9650\u5236\u4e86\u4f18\u5316\u53ef\u4ee5\u751f\u6548\u7684 imm \u8303\u56f4\u3002</p> <p>\u6ce8\uff1aPPT \u91cc\u7ed8\u5236\u7684\u662f\u7b2c\u4e09\u7ea7\u524d\u4f20\uff0c\u4f46\u662f\u5982\u679c\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u662f 2 cycle \u7684 load to use latency \u4e86\uff0c\u548c\u63cf\u8ff0\u4e0d\u7b26\u3002</p> <p>\u7c7b\u4f3c\u7684\u4f18\u5316\u5728\u5546\u7528\u5904\u7406\u5668\u4e0a\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u6b63\u5e38\u7684 load to use latency \u662f 4 \u5468\u671f\uff0cload to load \u5219\u53ef\u4ee5 3 \u5468\u671f\u3002\u4f8b\u5982\u82f9\u679c\u7684\u4e13\u5229 Reducing latency for pointer chasing loads \u63d0\u5230\u4e86\u5b83\u7684 LSU \u6d41\u6c34\u7ebf\u8bbe\u8ba1\u4ee5\u53ca\u524d\u4f20\u7684\u505a\u6cd5\uff1a</p> <p></p> <p>\u548c\u9999\u5c71\u5357\u6e56\u7c7b\u4f3c\uff0c\u5b83\u7684 Load Pipeline \u4e5f\u662f\u56db\u7ea7\u6d41\u6c34\u7ebf\uff08\u5bf9\u5e94\u56fe\u4e2d Stage 3-6\uff09\uff0c\u529f\u80fd\u4e5f\u7c7b\u4f3c\u3002\u4e0d\u8fc7\u5b83\u7684 3 \u5468\u671f load to load \u524d\u4f20\u7684\u5b9e\u73b0\u65b9\u6cd5\u5219\u4e0d\u540c\u3002</p> <p>\u8fd9\u4e2a\u4e13\u5229\u7684\u524d\u4f20\u662f\u4ece\u7b2c\u4e09\u7ea7\u524d\u4f20\u5230\u8bfb\u5bc4\u5b58\u5668\u7684\u9636\u6bb5\uff0c\u8fd9\u6837\u4e5f\u53ef\u4ee5\u5b9e\u73b0 3 \u5468\u671f\u7684\u7684 load to load latency\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0cAGU \u9636\u6bb5\u4fdd\u7559\uff0c\u8fd9\u5bf9\u4e8e AGU \u9636\u6bb5\u6bd4\u8f83\u590d\u6742\u7684 ARM \u67b6\u6784\u662f\u6bd4\u8f83\u597d\u7684\uff0c\u56e0\u4e3a ARM \u67b6\u6784\u4e0b AGU \u9636\u6bb5\u53ef\u80fd\u6d89\u53ca\u5230\u52a0\u6cd5\u548c\u79fb\u4f4d\uff0c\u800c RISCV \u53ea\u6709\u7acb\u5373\u6570\u52a0\u6cd5\u3002\u4e0d\u8fc7\u8fd9\u6837\u4e5f\u8981\u6c42 Load \u4e0d\u547d\u4e2d Store Queue\uff0c\u800c\u662f\u4ece L1 DCache \u83b7\u5f97\uff0c\u56e0\u4e3a Store to Load Forwarding \u7684\u5408\u5e76\u64cd\u4f5c\u662f\u5728\u7b2c\u56db\u7ea7\u6d41\u6c34\u7ebf\uff0c\u4e3a\u4e86\u80fd\u5728\u7b2c\u4e09\u7ea7\u6d41\u6c34\u7ebf\u524d\u4f20\uff0c\u53ea\u80fd\u9884\u6d4b\u5b83\u4e0d\u547d\u4e2d Store Queue\uff0c\u6570\u636e\u5b8c\u5168\u4ece L1 DCache \u4e2d\u53d6\u5f97\u3002</p> <p>\u56fe\u4e2d\u628a AGU \u548c DTLB Lookup \u5e76\u7740\u753b\u53ef\u80fd\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u5e94\u8be5\u662f\u5148\u7531 AGU \u8ba1\u7b97\u51fa\u865a\u62df\u5730\u5740\uff0c\u518d\u8d70 DTLB Lookup\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#memory-dependence-predictor","title":"Memory Dependence Predictor","text":"<p>\u5728 Load \u6307\u4ee4\u8981\u6267\u884c\u65f6\uff0c\u5728\u5b83\u4e4b\u524d\u7684 Store \u6307\u4ee4\u53ef\u80fd\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u6b64\u65f6\u5982\u679c\u8981\u63d0\u524d\u6267\u884c Load\uff0c\u53ef\u80fd\u4f1a\u8bfb\u53d6\u5230\u9519\u8bef\u7684\u6570\u636e\u3002\u4f46\u662f\u5982\u679c\u8981\u7b49\u5f85 Load \u4e4b\u524d\u7684\u6240\u6709 Store \u6307\u4ee4\u90fd\u5c31\u7eea\u518d\u6267\u884c Load\uff0c\u6027\u80fd\u4f1a\u53d7\u9650\u3002\u56e0\u6b64\u5904\u7406\u5668\u53ef\u4ee5\u8bbe\u8ba1\u4e00\u4e2a Memory Dependence Predictor\uff0c\u9884\u6d4b Load \u548c\u54ea\u4e9b Store \u4f1a\u6709\u6570\u636e\u4f9d\u8d56\uff0c\u5982\u679c\u6709\u4f9d\u8d56\uff0c\u90a3\u5c31\u8981\u7b49\u5f85\u4f9d\u8d56\u7684 Store \u5b8c\u6210\uff0c\u518d\u53bb\u6267\u884c Load\uff1b\u5982\u679c\u6ca1\u6709\u4f9d\u8d56\uff0c\u90a3\u5c31\u53ef\u4ee5\u5927\u80c6\u63d0\u524d\u6267\u884c Load\uff0c\u5f53\u7136\u4e86\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6b63\u786e\u6027\uff0cStore \u6267\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u8981\u53bb\u770b\u662f\u5426\u7834\u574f\u4e86\u63d0\u524d\u6267\u884c\u7684 Load\u3002\u603b\u4e4b\uff0cMemory Dependency Predictor \u7684\u76ee\u7684\u662f\uff0c\u627e\u5230\u4e00\u4e2a\u5c3d\u91cf\u65e9\u7684\u65f6\u95f4\u53bb\u6267\u884c Load \u6307\u4ee4\uff0c\u540c\u65f6\u907f\u514d\u56de\u6eda\u3002</p> <p>Alpha 21264 \u4f7f\u7528\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6cd5 Load Wait Table \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1a\u5bf9\u4e8e\u90a3\u4e9b\u51fa\u73b0\u8fc7\u987a\u5e8f\u8fdd\u4f8b\u7684 Load \u6307\u4ee4\uff0c\u6253\u4e0a\u4e00\u4e2a\u6807\u8bb0\uff0c\u90a3\u4e48\u672a\u6765\u8fd9\u4e2a Load \u90fd\u8981\u7b49\u5230\u5728\u5b83\u4e4b\u524d\u7684\u6240\u6709 Store \u6267\u884c\u624d\u80fd\u6267\u884c\u3002\u8fd9\u4e2a\u6807\u8bb0\u7684\u65b9\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u7ef4\u62a4 Load \u6307\u4ee4\u7684 PC \u5230\u5355 bit \u7684\u6620\u5c04\u3002\u9999\u5c71\u5904\u7406\u5668\u6709\u5bf9\u5e94\u7684\u5b9e\u73b0\u3002</p> <p>\u53e6\u4e00\u4e2a\u5b9e\u73b0\u65b9\u6cd5\u53eb\u505a Store Set\u3002Store Set \u662f\u76f8\u5bf9 Load \u8bf4\u7684\uff0c\u6307\u7684\u662f\u4e00\u4e2a Load \u4f9d\u8d56\u8fc7\u7684\u6240\u6709\u7684 Store \u7684\u96c6\u5408\u3002\u5982\u679c\u4e00\u4e2a Load \u7684 Store Set \u5185\u7684\u6240\u6709\u7684 Store \u90fd\u6267\u884c\u5b8c\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a Load \u5c31\u53ef\u4ee5\u63d0\u524d\u6267\u884c\u4e86\uff0c\u4e0d\u7528\u8003\u8651\u522b\u7684 Store \u6307\u4ee4\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u4e00\u5f00\u59cb\u5e76\u4e0d\u77e5\u9053 Load \u4f9d\u8d56\u54ea\u4e9b Store\uff0c\u6240\u4ee5 Store Set \u662f\u7a7a\u7684\uff0c\u6b64\u65f6 Load \u53ef\u80fd\u4f1a\u63d0\u524d\u6267\u884c\u3002\u5f53\u53d1\u73b0\u6267\u884c\u987a\u5e8f\u9519\u8bef\uff0c\u9700\u8981\u56de\u6eda\u65f6\uff0c\u5c31\u628a\u5bfc\u81f4\u56de\u6eda\u7684 Store \u6dfb\u52a0\u5230\u5bf9\u5e94 Load \u7684 Store Set \u5f53\u4e2d\u3002</p> <p>\u5177\u4f53\u5230\u786c\u4ef6\u5b9e\u73b0\u4e0a\uff0c\u600e\u4e48\u53bb\u7ef4\u62a4 Store Set \u5c31\u662f\u4e00\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a Store Set \u53ef\u80fd\u4f1a\u5f88\u5927\uff0c\u540c\u4e00\u4e2a Store \u4e5f\u53ef\u80fd\u4f1a\u51fa\u73b0\u5728\u5f88\u591a\u4e2a Load \u7684 Store Set \u5f53\u4e2d\u3002\u4e0a\u8ff0\u8bba\u6587\u63d0\u51fa\u4e86\u4e00\u79cd\u786c\u4ef6\u4e0a\u7684\u7b80\u5316\u65b9\u5f0f\uff1a</p> <ol> <li>\u6bcf\u4e2a Store \u53ea\u80fd\u51fa\u73b0\u5728\u4e00\u4e2a Store Set \u5f53\u4e2d\uff0c\u8fd9\u4e2a Store Set \u53ef\u4ee5\u7531\u591a\u4e2a Load \u5171\u4eab\u3002</li> <li>\u6267\u884c Load \u4e4b\u524d\uff0c\u4e3a\u4e86\u4fdd\u8bc1 Store Set \u4e2d\u7684 Store \u6307\u4ee4\u90fd\u5b8c\u6210\u6267\u884c\uff0c\u8981\u6c42\u8fd9\u4e9b Store \u6307\u4ee4\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u5b8c\u6210\uff0c\u90a3\u4e48 Load \u53ea\u7528\u7b49\u5f85 Store Set \u5185\u7684\u6700\u540e\u4e00\u6761 Store \u6307\u4ee4\uff0c\u800c\u4e0d\u7528\u8003\u8651 Store Set \u5185\u6240\u6709 Store \u6307\u4ee4\u5b8c\u6210\u3002</li> </ol> <p>\u5177\u4f53\u5230\u786c\u4ef6\u4e0a\uff0c\u6709\u4e24\u4e2a\u8868\u6765\u7ef4\u62a4\u8fd9\u4e9b\u4fe1\u606f\uff1a\u9996\u5148\u662f Store Set Identifier Table (SSIT)\uff0c\u8fd9\u4e2a\u8868\u5b9e\u73b0\u4e86 Load/Store \u6307\u4ee4 PC \u5230 Store Set ID \u7684\u6620\u5c04\u3002\u901a\u8fc7 SSIT\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053 Load \u7684 Store Set \u662f\u54ea\u4e2a ID\uff0c\u54ea\u4e9b Store \u5728\u8fd9\u4e2a Store Set \u5f53\u4e2d\u3002\u7b2c\u4e8c\u4e2a\u8868\u662f Last Fetched Store Table (LFST)\uff0c\u5b83\u8bb0\u5f55\u4e86\u8fd9\u4e2a Store Set \u4e2d\u6700\u665a\u88ab\u53d6\u6307\u7684 Store \u6307\u4ee4\u3002</p> <p>\u524d\u9762\u63d0\u5230\uff0c\u4e3a\u4e86\u7b80\u5316\u4f9d\u8d56\u7684\u68c0\u67e5\uff0c\u540c\u4e00\u4e2a Store Set \u5185\u7684 Store \u6307\u4ee4\u9700\u8981\u6309\u7167\u987a\u5e8f\u6267\u884c\uff0c\u90a3\u4e48 Load \u53ea\u9700\u8981\u4f9d\u8d56 Store Set \u7684\u6700\u540e\u4e00\u6761 Store \u6307\u4ee4\u3002\u8fd9\u4e2a\u5c31\u662f\u901a\u8fc7 LFST \u6765\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u6bcf\u4e2a Store \u9996\u5148\u6839\u636e SSIT \u627e\u5230\u81ea\u5df1\u7684 Store Set ID\uff0c\u518d\u7528 Store Set ID \u8bbf\u95ee LFST\uff0c\u5982\u679c\u91cc\u9762\u5df2\u7ecf\u6709\u66f4\u65e9\u7684 Store\uff0c\u90a3\u5c31\u8981\u4f9d\u8d56\u8fd9\u4e2a\u66f4\u65e9\u7684 Store\uff1b\u540c\u65f6\u4e5f\u4f1a\u66f4\u65b0 LFST\uff0c\u628a\u81ea\u5df1\u5199\u8fdb\u53bb\u3002</li> <li>\u540c\u7406 Load \u4e5f\u4f1a\u6839\u636e SSIT \u627e\u5230 Store ID\uff0c\u7528 Store Set ID \u53cd\u95ee LFST\uff0c\u53bb\u4f9d\u8d56\u6700\u665a\u7684 Store\u3002</li> <li>\u5982\u679c Store \u5df2\u7ecf\u88ab\u6267\u884c\uff08\u51c6\u786e\u5730\u8bf4\uff0cIssue\uff09\uff0c\u81ea\u7136\u540e\u7eed\u7684 Load \u4e5f\u4e0d\u7528\u7b49\u5f85\u5b83\u4e86\uff0c\u5982\u679c LFST \u8bb0\u5f55\u7684\u8fd8\u662f\u8fd9\u6761 Store\uff0c\u5b83\u5c31\u53ef\u4ee5\u4ece LFST \u4e2d\u6e05\u9664\u6389\u3002</li> </ul> <p>\u4e0b\u9762\u5f15\u7528\u8bba\u6587\u4e2d\u7684\u4e00\u4e2a\u4f8b\u5b50\u3002\u5047\u5982\u4e00\u5f00\u59cb SSIT \u548c LFST \u90fd\u662f\u7a7a\u7684\uff0c\u6b64\u65f6\u6240\u6709\u7684 Load \u6307\u4ee4\u7684 Store Set \u90fd\u662f\u7a7a\u7684\uff0c\u9884\u6d4b\u4e3a\u63d0\u524d\u6267\u884c\u3002\u6b64\u65f6\u4e00\u6761 Load \u6307\u4ee4\u548c\u4e00\u6761 Store \u6307\u4ee4\u51fa\u73b0\u4e86\u6267\u884c\u987a\u5e8f\u9519\u8bef\uff0c\u8fd9\u65f6\u5019\u786c\u4ef6\u4f1a\u5206\u914d\u4e00\u4e2a Store Set ID\uff0c\u5199\u5165\u5230 SSIT \u4e2d\u5206\u522b\u5bf9\u5e94 Load \u548c Store \u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c31\u628a Load \u548c Store \u5173\u8054\u5230\u4e86\u540c\u4e00\u4e2a Store Set \u5f53\u4e2d\u3002</p> <p>\u672a\u6765 Store \u518d\u6b21\u88ab\u53d6\u6307\u65f6\uff0cStore \u901a\u8fc7 SSIT \u627e\u5230\u81ea\u5df1\u7684 Store Set ID\uff0c\u518d\u8bfb\u53d6 LFST\uff0c\u53d1\u73b0\u540c\u4e00\u4e2a Store Set \u5185\u6ca1\u6709\u66f4\u65e9\u7684 Store \u6307\u4ee4\uff0c\u90a3\u4e48\u4e0d\u521b\u5efa\u989d\u5916\u7684\u4f9d\u8d56\uff0c\u53ea\u662f\u628a\u81ea\u5df1\u5199\u5165\u5230 LFST \u5f53\u4e2d\u3002\u5f53 Load \u518d\u6b21\u88ab\u53d6\u6307\u65f6\uff0c\u901a\u8fc7 SSIT \u627e\u5230 Load \u7684 Store Set ID\uff0c\u518d\u8bfb\u53d6 LFST\uff0c\u53d1\u73b0 LFST \u8bb0\u5f55\u4e86 Store \u6307\u4ee4\u7684\u4fe1\u606f\uff0c\u90a3\u4e48\u5728\u8c03\u5ea6\u65f6\uff0c\u8fd9\u4e2a Load \u5c31\u8981\u4f9d\u8d56\u8fd9\u4e2a Store\u3002</p> <p>\u5982\u679c\u662f\u4e00\u6761 Load \u4f9d\u8d56\u4e24\u6761 Store\uff0c\u90a3\u4e48\u6309\u7167\u4e0a\u9762\u7684\u89c4\u5f8b\uff0c\u4e09\u6761\u6307\u4ee4\u5728 SSIT \u4e2d\u90fd\u6620\u5c04\u5230\u540c\u4e00\u4e2a Store Set ID\uff0c\u7b2c\u4e8c\u6761 Store \u4f9d\u8d56\u7b2c\u4e00\u6761 Store\uff0cLoad \u4f9d\u8d56\u7b2c\u4e8c\u6761 Store\u3002</p> <p>\u8fd9\u4e2a\u673a\u5236\u81ea\u7136\u652f\u6301\u4e86\u591a\u4e2a Load \u4f9d\u8d56\u540c\u4e00\u4e2a Store Set\uff0c\u53ea\u8981\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u76f8\u540c\u7684 Store Set ID \u5373\u53ef\u3002\u4f46\u7f3a\u70b9\u662f\uff0c\u6bcf\u6761 Store \u90fd\u53ea\u80fd\u5728\u4e00\u4e2a Store Set \u5f53\u4e2d\uff0c\u6709\u65f6\u5019\u4f1a\u51fa\u73b0\u8fd9\u4e48\u4e00\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>Load A \u7684 Store Set \u662f Store X, Store Y</li> <li>Load B \u7684 Store Set \u662f Store Z</li> </ul> <p>\u6b64\u65f6\u51fa\u73b0\u4e86 Load A \u548c Store Z \u4e4b\u95f4\u7684\u987a\u5e8f\u9519\u8bef\uff0c\u4f46\u662f Store Z \u548c Load A \u5c5e\u4e8e\u4e0d\u540c\u7684 Store Set\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5f15\u5165 Store Set \u5408\u5e76\u673a\u5236\uff1a\u5982\u679c\u4e00\u6761 Store \u8981\u540c\u65f6\u51fa\u73b0\u5728\u4e24\u4e2a Store Set \u5f53\u4e2d\uff0c\u90a3\u5c31\u628a\u8fd9\u4e24\u4e2a Store Set \u5408\u5e76\u6210\u4e00\u4e2a\uff1aLoad A\u3001Load B \u7684 Store Set \u90fd\u662f Store X\u3001Store Y \u548c Store Z\u3002\u4ee3\u4ef7\u662f\u53ef\u80fd\u5f15\u5165\u4e86\u4e00\u4e9b\u5047\u7684\u4f9d\u8d56\u3002</p> <p>\u9999\u5c71\u5904\u7406\u5668\u4e5f\u5b9e\u73b0\u4e86 Store Set \u7b97\u6cd5\u7684\u53d8\u79cd\uff0c\u5176\u533a\u522b\u53ef\u4ee5\u53c2\u8003\u9999\u5c71\u7684\u8bbf\u5b58\u4f9d\u8d56\u9884\u6d4b\u6587\u6863\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#store-to-load-forwarding","title":"Store to Load Forwarding","text":"<p>\u5bf9\u4e8e\u90a3\u4e9b\u4f9d\u8d56\u4e4b\u524d\u7684 Store \u7684 Load \u6307\u4ee4\uff0c\u5982\u679c Store \u8fd8\u6ca1\u6709\u5199\u8fdb\u7f13\u5b58\uff0c\u90a3\u4e48 Load \u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4ece Store \u8981\u5199\u5165\u7684\u6570\u636e\u91cc\u83b7\u53d6\u6570\u636e\uff0c\u8fd9\u5c31\u662f Store to Load Forwarding\u3002\u4f46\u5b9e\u9645\u60c5\u51b5\u53ef\u80fd\u4f1a\u6bd4\u8f83\u590d\u6742\uff0c\u4f8b\u5982 Load \u548c Store \u53ea\u6709\u4e00\u90e8\u5206\u7684\u91cd\u5408\uff0c\u4e0d\u91cd\u5408\u7684\u90e8\u5206\u8981\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\uff1b\u6216\u8005 Load \u548c\u591a\u4e2a Store \u91cd\u5408\uff0c\u8981\u4ece\u591a\u4e2a Store \u5206\u522b\u53d6\u6570\u636e\u5408\u5e76\u8d77\u6765\uff1b\u6216\u8005\u524d\u540e\u6709\u5bf9\u540c\u4e00\u4e2a\u5730\u5740\u7684 Store\uff0c\u90a3\u4e48\u8981\u9009\u53d6\u6700\u665a\u7684\u90a3\u4e00\u4e2a\u3002</p> <p>\u9996\u5148\u6765\u770b\u770b Intel \u5728 Intel\u00ae 64 and IA-32 Architectures Optimization Reference Manual \u4e2d\u5bf9 Core\uff08\u4e0d\u662f Core \u7cfb\u5217 CPU\uff09\u5fae\u67b6\u6784\u7684\u8868\u8ff0\uff1a</p> <ol> <li>\u5c3d\u91cf\u901a\u8fc7\u5bc4\u5b58\u5668\u4f20\u9012\u51fd\u6570\u53c2\u6570\uff0c\u800c\u4e0d\u662f\u6808\uff1b\u867d\u7136\u901a\u8fc7\u6808\u4f20\u53c2\u6570\uff0c\u6bd4\u8f83\u5bb9\u6613\u4eab\u53d7\u5230 Store to Load Forwarding \u7684\u4f18\u5316\uff0c\u4f46\u6d6e\u70b9\u7684\u8f6c\u53d1\u8fd8\u662f\u6bd4\u8f83\u6162\u3002</li> <li>\u8f6c\u53d1\u65f6\uff0cLoad \u7684\u8d77\u59cb\u5730\u5740\u548c Store \u76f8\u540c\u3002Load \u7684\u8bfb\u53d6\u8303\u56f4\u8981\u5305\u542b\u5728 Store \u7684\u5199\u5165\u8303\u56f4\u4e4b\u5185\u3002</li> <li>\u5982\u679c\u8981\u4ece Store \u5199\u5165\u8303\u56f4\u7684\u4e2d\u95f4\u800c\u4e0d\u662f\u5f00\u5934\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u63a5\u4ece\u4e2d\u95f4\u5f00\u59cb\u8bfb\u65e0\u6cd5\u4eab\u53d7 Store to Load Forwarding\uff0c\u60f3\u8981\u66f4\u597d\u7684\u6027\u80fd\uff0c\u9700\u8981\u5148\u4ece\u5934\u5f00\u59cb\u8bfb\uff0c\u6ee1\u8db3\u8f6c\u53d1\u6761\u4ef6\uff0c\u518d\u901a\u8fc7\u4f4d\u8fd0\u7b97\u63d0\u53d6\u51fa\u60f3\u8981\u7684\u90e8\u5206\u3002</li> </ol> <p>\u5f53\u7136\u4e86\uff0c\u8fd9\u662f\u5f88\u8001\u7684\u5fae\u67b6\u6784\u4e86\u3002</p> <p>\u518d\u770b\u770b ARM \u7684\u516c\u7248\u6838\uff0c\u4ece ARM Cortex-X925 Core Software Optimization Guide \u4e2d\u53ef\u4ee5\u770b\u5230\u8fd9\u6837\u7684\u63cf\u8ff0\uff1a</p> <p>Load start address should align with the start or middle address of the older store.</p> <p>Load \u7684\u8d77\u59cb\u5730\u5740\u7b49\u4e8e Store \u7684\u8d77\u59cb\u5730\u5740\u6216\u8005\u6b63\u597d\u5728\u4e2d\u95f4\u3002</p> <p>Loads of size greater than 8 bytes can get the data forwarded from a maximum of 2 stores. If there are 2 stores, then each store should forward to either first or second half of the load.</p> <p>\u5927\u4e8e 8 \u5b57\u8282\u7684 Load \u6700\u591a\u53ef\u4ee5\u4ece\u4e24\u4e2a Store \u4e2d\u8f6c\u53d1\u6570\u636e\uff0c\u6b64\u65f6\u6bcf\u4e2a Store \u5206\u522b\u8d21\u732e\u4e00\u534a\uff0c\u4f8b\u5982\u4e24\u4e2a Store \u5206\u522b\u5199\u5165 8 \u4e2a\u5b57\u8282\uff0c\u7136\u540e Load \u628a 16 \u4e2a\u5b57\u8282\u8bfb\u51fa\u6765\u3002</p> <p>Loads of size less than or equal to 4 bytes can get their data forwarded from only 1 store</p> <p>\u5c0f\u4e8e\u6216\u7b49\u4e8e 4 \u5b57\u8282\u7684 Load \u53ea\u80fd\u4ece\u4e00\u4e2a Store \u4e2d\u83b7\u53d6\u6570\u636e\u3002</p> <p>\u518d\u770b\u770b\u66f4\u65e9\u7684 ARM \u6838\u5fc3\uff0cARM Cortex-A78 Core Software Optimization Guide \u4e2d\u7684\u63cf\u8ff0\uff1a</p> <p>Load start address should align with the start or middle address of the older store. This does not apply to LDPs that load 2 32b registers or LDRDs Loads of size greater than 8 bytes can get the data forwarded from a maximum of 2 stores. If there are 2 stores, then each store should forward to either first or second half of the load. Loads of size less than or equal to 8 bytes can get their data forwarded from only 1 store.</p> <p>\u56e0\u6b64 X925 \u76f8\u6bd4 A78 \u7684\u4e3b\u8981\u533a\u522b\u662f\uff0c8 bytes Load \u4e5f\u53ef\u4ee5\u4ece\u591a\u4e2a Store \u4e2d\u8f6c\u53d1\u6570\u636e\u4e86\u3002</p> <p>\u4e0b\u9762\u662f\u5728\u51e0\u6b3e\u5904\u7406\u5668\u4e0a\u5b9e\u6d4b Store to Load Forwarding \u5728\u5404\u79cd\u8bbf\u5b58\u6a21\u5f0f\u4e0b\u80fd\u5426\u8f6c\u53d1\u4ee5\u53ca\u8f6c\u53d1\u7684\u6761\u4ef6\uff1a</p> uArch 1 ld + 1 st 1 ld + 2 st 1 ld + 4 st 1 ld + 8 st AMD Zen5 Yes [1] No No No ARM Neoverse V2 Yes [2] Yes [3] No No Qualcomm Oryon Yes [4] Yes [5] No No Apple Firestorm Yes Yes [6] Yes [6] Yes [6] <ul> <li>[1]: \u8981\u6c42 st \u5b8c\u5168\u5305\u542b ld</li> <li>[2]: \u8981\u6c42 ld \u548c st \u5730\u5740\u76f8\u540c\u6216\u5dee\u51fa\u534a\u4e2a st \u5bbd\u5ea6</li> <li>[3]: \u8981\u6c42 ld \u548c st \u5730\u5740\u76f8\u540c</li> <li>[4]: \u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>[5]: \u8981\u6c42 ld \u5bf9\u9f50\u5230 4B \u8fb9\u754c\u4e14\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>[6]: \u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> </ul>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#memory-renaming","title":"Memory Renaming","text":"<p>Register Renaming \u628a\u7269\u7406\u5bc4\u5b58\u5668\u91cd\u547d\u540d\u4e3a\u67b6\u6784\u5bc4\u5b58\u5668\uff0c\u90a3\u4e48 Memory Renaming: Fast, Early and Accurate Processing of Memory Communication \u7c7b\u4f3c\u5730\u628a\u5185\u5b58\u91cd\u547d\u540d\u4e3a\u5bc4\u5b58\u5668\u3002\u5177\u4f53\u5730\uff0c\u5982\u679c\u53d1\u73b0\u67d0\u4e2a Load \u7684\u6570\u636e\u603b\u662f\u6765\u81ea\u4e8e\u67d0\u4e2a Store\uff0c\u6309\u7167\u5148\u524d\u7684\u505a\u6cd5\uff0c\u8981\u7b49 Store \u5148\u6267\u884c\uff0c\u7136\u540e Load \u4ece Store Queue \u4e2d\u62ff\u5230 Store \u7684\u7ed3\u679c\uff0c\u66f4\u8fdb\u4e00\u6b65\uff0c\u4e0d\u5982\u76f4\u63a5\u628a Load \u7684\u76ee\u7684\u5bc4\u5b58\u5668\u590d\u5236\u4e3a Store \u7684\u6e90\u6570\u636e\u5bc4\u5b58\u5668\uff0c\u76f8\u5f53\u4e8e\u628a\u5185\u5b58\u91cd\u547d\u540d\u6210\u4e86\u5bc4\u5b58\u5668\uff0cLoad \u53d8\u6210\u4e86\u7b80\u5355\u7684\u5bc4\u5b58\u5668\u7684 Move\u3002</p> <p>\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5728 Memory Dependency Predictor \u7684\u57fa\u7840\u4e0a\uff0c\u8fd8\u628a Store \u5199\u5165\u7684\u6570\u636e\u4fdd\u5b58\u5230 Value File \u5f53\u4e2d\u3002\u5f53\u9884\u6d4b Load \u4f1a\u4ece\u67d0\u4e2a Store \u53d6\u6570\u636e\u65f6\uff0c\u5c31\u4ece Value File \u4e2d\u53d6\u51fa\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u63d0\u65e9\u6267\u884c\u4f9d\u8d56 Load \u7ed3\u679c\u7684\u6307\u4ee4\u3002</p> <p>\u8fd9\u4e2a\u4f18\u5316\u5728\u82f9\u679c\u7684\u4e13\u5229\u4e2d\u88ab\u79f0\u4e3a Zero cycle load\uff1aZero cycle load \u548c Zero cycle load bypass:</p> <p>a destination operand of the load is renamed with a same physical register identifier used for a source operand of the store. Also, the data of the store is bypassed to the load.</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#load-address-prediction","title":"Load Address Prediction","text":"<p>Prefetch \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u4f18\u5316\u624b\u6bb5\uff0c\u6839\u636e\u8bbf\u5b58\u6a21\u5f0f\uff0c\u63d0\u524d\u628a\u6570\u636e\u9884\u53d6\u5230\u7f13\u5b58\u5f53\u4e2d\u3002\u4e0d\u8fc7\u6700\u7ec8\u6570\u636e\u8fd8\u662f\u8981\u901a\u8fc7\u8bbf\u5b58\u6307\u4ee4\u628a\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u90a3\u4e48\u80fd\u5426\u66f4\u8fdb\u4e00\u6b65\uff0c\u628a\u6570\u636e\u9884\u53d6\u5230\u5bc4\u5b58\u5668\u4e2d\u5462\uff1f\u8fd9\u5b9e\u9645\u4e0a\u5c31\u76f8\u5f53\u4e8e\uff0c\u6211\u9700\u8981\u9884\u6d4b Load \u6307\u4ee4\u8981\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u8fd9\u6837\u624d\u80fd\u63d0\u524d\u628a\u6570\u636e\u8bfb\u5230\u5bc4\u5b58\u5668\u5f53\u4e2d\u3002</p> <p>\u5728 1993 \u5e74\u7684\u8bba\u6587 A load-instruction unit for pipelined processors \u63d0\u51fa\u4e86\u7c7b\u4f3c\u7684\u60f3\u6cd5\uff1a\u9884\u6d4b Load \u6307\u4ee4\u7684\u5730\u5740\uff0c\u63d0\u524d\u628a\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\uff0c\u5982\u679c\u547d\u4e2d\u4e86\uff0c\u628a\u6570\u636e\u5b58\u5230 Load Queue \u4e2d\uff0c\u5f53 Load \u6307\u4ee4\u88ab\u6267\u884c\uff0c\u8ba1\u7b97\u51fa\u5b9e\u9645\u5730\u5740\u65f6\uff0c\u5982\u679c\u5b9e\u9645\u5730\u5740\u548c\u9884\u6d4b\u7684\u5339\u914d\uff0c\u5c31\u76f4\u63a5\u4ece Load Queue \u4e2d\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u7528\u8bfb\u53d6\u7f13\u5b58\uff0c\u53ef\u4ee5\u8282\u7701\u4e00\u4e2a\u5468\u671f\uff1b\u5982\u679c\u7f13\u5b58\u7f3a\u5931\u4e86\uff0c\u5c31\u76f8\u5f53\u4e8e\u8fdb\u884c\u4e86\u4e00\u6b21\u7f13\u5b58\u7684\u9884\u53d6\u3002\u4e3a\u4e86\u5b9e\u73b0\u5730\u5740\u7684\u9884\u6d4b\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a Load Delta Table\uff0c\u6839\u636e Load \u6307\u4ee4\u7684\u5730\u5740\u6765\u67e5\u8be2\uff0cEntry \u8bb0\u5f55\u4e86\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u7684\u5730\u5740\u4ee5\u53ca\u6bcf\u6b21\u8bbf\u5b58\u5730\u5740\u7684\u504f\u79fb Delta\uff0c\u5f53 Delta \u4e3a 0 \u65f6\uff0c\u5bf9\u5e94 Constant Address\uff1b\u5f53 Delta \u4e0d\u7b49\u4e8e 0 \u65f6\uff0c\u5bf9\u5e94 Stride Address\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u6bd4\u8f83\u7b80\u5355\u548c\u4fdd\u5b88\uff0c\u56e0\u4e3a\u5b83\u8981\u7b49\u5230 Load \u7684\u5730\u5740\u5b9e\u9645\u8ba1\u7b97\u51fa\u6765\u624d\u80fd Bypass\u3002</p> <p>\u4e0b\u9762\u6765\u5206\u6790\u4e00\u4e2a\u6765\u81ea\u82f9\u679c\u516c\u53f8\u7684\u4e13\u5229\uff1aEarly load execution via constant address and stride prediction\uff0c\u5b83\u5b9e\u73b0\u7684\u4f18\u5316\u662f\uff0c\u5f53\u4e00\u6761 load \u6307\u4ee4\u7684\u5730\u5740\u662f\u53ef\u9884\u6d4b\u7684\uff0c\u4f8b\u5982\u5b83\u603b\u662f\u8bbf\u95ee\u540c\u4e00\u4e2a\u5730\u5740\uff08<code>constant address</code>\uff09\uff0c\u6216\u8005\u8bbf\u95ee\u7684\u5730\u5740\u6309\u7167\u56fa\u5b9a\u7684\u95f4\u9694\uff08<code>constant stride</code>\uff09\u53d8\u5316\uff0c\u90a3\u5c31\u6309\u7167\u8fd9\u4e2a\u89c4\u5f8b\u53bb\u9884\u6d4b\u8fd9\u6761 load \u6307\u4ee4\u8981\u8bbf\u95ee\u7684\u5730\u5740\uff0c\u800c\u4e0d\u7528\u7b49\u5230\u5730\u5740\u771f\u7684\u88ab\u8ba1\u7b97\u51fa\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u524d\u6267\u884c\u8fd9\u6761 load \u6307\u4ee4\u3002</p> <p>\u65e2\u7136\u662f\u4e00\u4e2a\u9884\u6d4b\u7b97\u6cd5\uff0c\u9996\u5148\u5c31\u8981\u770b\u5b83\u662f\u600e\u4e48\u9884\u6d4b\u7684\u3002\u4e13\u5229\u91cc\u63d0\u5230\u4e86\u4e24\u4e2a\u7528\u4e8e\u9884\u6d4b\u7684\u8868\uff1a</p> <ol> <li>Load Prediction Table\uff0c\u7ed9\u5b9a PC\uff0c\u9884\u6d4b Load \u6307\u4ee4\u8981\u8bbf\u95ee\u7684\u5730\u5740</li> <li>Load Prediction Learning Table\uff0c\u7528\u4e8e\u8ddf\u8e2a\u5404\u4e2a PC \u4e0b\u7684 Load \u6307\u4ee4\u7684\u8bbf\u5b58\u6a21\u5f0f\u4ee5\u53ca\u9884\u6d4b\u6b63\u786e\u7387</li> </ol> <p>\u4e00\u5f00\u59cb\uff0c\u4e24\u4e2a\u8868\u90fd\u662f\u7a7a\u7684\uff0c\u968f\u7740 Load \u6307\u4ee4\u7684\u6267\u884c\uff0c\u9996\u5148\u66f4\u65b0\u7684\u662f Load Prediction Learning Table\uff0c\u5b83\u4f1a\u8ddf\u8e2a Load \u6307\u4ee4\u7684\u6267\u884c\u5386\u53f2\uff0c\u8bad\u7ec3\u9884\u6d4b\u5668\uff0c\u8ba1\u7b97\u9884\u6d4b\u5668\u7684\u51c6\u786e\u7387\u3002</p> <p>\u5f53 Load Prediction Learning Table \u53d1\u73b0\u80fd\u591f\u4ee5\u8f83\u9ad8\u7684\u51c6\u786e\u7387\u9884\u6d4b\u67d0\u6761 Load \u6307\u4ee4\u65f6\uff0c\u5c31\u4f1a\u5728 Load Prediction Table \u4e2d\u5206\u914d\u4e00\u4e2a entry\uff0c\u90a3\u4e48\u4e4b\u540e\u524d\u7aef\uff08IFU\uff09\u518d\u6b21\u9047\u5230\u8fd9\u6761 Load \u6307\u4ee4\u65f6\uff0c\u901a\u8fc7\u68c0\u67e5 Load Prediction Table\uff0c\u5c31\u53ef\u4ee5\u9884\u6d4b\u8981\u8bbf\u95ee\u7684\u5730\u5740\u3002</p> <p>\u5f53 Load Prediction Learning Table \u53d1\u73b0\u67d0\u6761 Load \u6307\u4ee4\u7684\u9884\u6d4b\u9519\u8bef\u6b21\u6570\u591a\u4e86\uff0c\u5c31\u4f1a\u628a\u5bf9\u5e94\u7684\u8868\u9879\u4ece Load Prediction Table \u548c Load Prediction Learning Table \u4e2d\u5220\u9664\uff0c\u6b64\u65f6\u5c31\u4f1a\u56de\u9000\u5230\u6b63\u5e38\u7684\u6267\u884c\u8fc7\u7a0b\uff0cLoad \u6307\u4ee4\u9700\u8981\u7b49\u5f85\u5730\u5740\u8ba1\u7b97\u5b8c\u6210\u624d\u53ef\u4ee5\u6267\u884c\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u6d6a\u8d39\u529f\u8017\uff0c\u5982\u679c Load \u6307\u4ee4\u7684\u5730\u5740\u5f88\u5feb\u5c31\u53ef\u4ee5\u7b97\u51fa\u6765\uff0c\u90a3\u4e48\u9884\u6d4b\u4e5f\u5c31\u6ca1\u6709\u5fc5\u8981\u4e86\uff0c\u6b64\u65f6\u5373\u4f7f\u505a\u4e86\u9884\u6d4b\uff0c\u4e5f\u4e0d\u4f1a\u5e26\u6765\u5f88\u9ad8\u7684\u6027\u80fd\u63d0\u5347\u3002\u5224\u65ad\u7684\u4f9d\u636e\u662f\uff0c\u8ba1\u7b97\u4ece\u9884\u6d4b\u5730\u5740\u5230\u8ba1\u7b97\u51fa\u5730\u5740\u8017\u8d39\u7684\u5468\u671f\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u4e00\u4e2a\u9608\u503c\uff0c\u90a3\u4e48\u4f18\u5316\u5c31\u6709\u6548\u679c\uff1b\u5982\u679c\u6ca1\u6709\u8d85\u8fc7\u9608\u503c\uff0c\u90a3\u5c31\u4e0d\u9884\u6d4b\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c Load \u7684\u5730\u5740\u9700\u8981\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\u53bb\u8ba1\u7b97\uff0c\u4f46\u5b9e\u9645\u4e0a\u53c8\u662f\u53ef\u4ee5\u9884\u6d4b\u7684\uff0c\u90a3\u5c31\u53ef\u4ee5\u901a\u8fc7 Load Address Prediction \u7684\u65b9\u6cd5\uff0c\u6765\u63d0\u5347\u6027\u80fd\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#way-prediction","title":"Way Prediction","text":"<p>\u7ec4\u76f8\u8fde\u7ed3\u6784\u5728\u5904\u7406\u5668\u7684\u5f88\u591a\u5730\u65b9\u90fd\u6709\uff0c\u4f8b\u5982\u5404\u79cd\u7f13\u5b58\uff0c\u90a3\u4e48\u5728\u8bbf\u95ee\u7ec4\u76f8\u8fde\u7ed3\u6784\u7684\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u7528 Index \u53d6\u51fa\u4e00\u4e2a Set\uff0c\u518d\u8fdb\u884c Way \u7684\u5339\u914d\u3002\u4f46\u7f13\u5b58\u5728\u786c\u4ef6\u4e2d\u901a\u5e38\u662f\u7528 SRAM \u5b9e\u73b0\u7684\uff0c\u8bfb\u53d6\u6709\u4e00\u4e2a\u5468\u671f\u7684\u5ef6\u8fdf\uff0c\u56e0\u6b64\u8bfb\u53d6\u7684\u8fc7\u7a0b\u5e76\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355\uff0c\u4e0b\u9762\u5206\u6790\u51e0\u79cd\u8bfb\u53d6\u7ec4\u76f8\u8fde\u7f13\u5b58\u7684\u8bbe\u8ba1\uff1a</p> <p>\u7b2c\u4e00\u79cd\u6700\u7b80\u5355\u7684\u529e\u6cd5\u662f\uff0c\u7b2c\u4e00\u4e2a\u5468\u671f\u6839\u636e Index \u628a\u6574\u4e2a Set \u6240\u6709 Way \u7684 Tag \u548c\u6570\u636e\u90fd\u8bfb\u51fa\u6765\uff0c\u7b2c\u4e8c\u4e2a\u5468\u671f\u5c31\u53ef\u4ee5\u62ff\u5230\u6240\u6709\u7684 Tag \u548c\u6570\u636e\uff0c\u6bd4\u8f83 Tag \u540e\u5f97\u5230\u7ed3\u679c\u3002\u8fd9\u4e2a\u65b9\u6cd5\u6bd4\u8f83\u7b80\u5355\uff0c\u7f3a\u70b9\u662f\u529f\u8017\u6bd4\u8f83\u5927\uff0c\u5b9e\u9645\u53ea\u547d\u4e2d\u6700\u591a\u4e00\u4e2a Way\uff0c\u5374\u8981\u628a\u6240\u6709\u7684 Way \u548c Tag \u548c\u6570\u636e\u90fd\u8bfb\u51fa\u6765\u3002</p> <p>\u65e2\u7136\u53ea\u6709\u4e00\u4e2a Way \u7684\u6570\u636e\u9700\u8981\u7528\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u60f3\u6cd5\u662f\u628a\u8bfb\u53d6\u62c6\u6210\u4e24\u6b65\uff1a\u7b2c\u4e00\u4e2a\u5468\u671f\u6839\u636e Index \u628a\u6574\u4e2a Set \u6240\u6709 Way \u7684 Tag \u90fd\u8bfb\u51fa\u6765\uff0c\u53ea\u8bfb Tag \u4e0d\u8bfb\u6570\u636e\uff0c\u6bd4\u5bf9 Tag \u540e\uff0c\u7b2c\u4e8c\u4e2a\u5468\u671f\u518d\u628a Tag \u6b63\u786e\u7684\u90a3\u4e00\u4e2a Way \u7684\u6570\u636e\u8bfb\u51fa\u6765\u3002\u8fd9\u6837\u7701\u4e0b\u4e86\u5f88\u591a\u6570\u636e SRAM \u7684\u8bfb\u53d6\u529f\u8017\uff0cTag \u7684\u8bfb\u53d6\u6ca1\u6709\u7701\uff0c\u540c\u65f6\u4ed8\u51fa\u4e86\u591a\u4e86\u4e00\u4e2a\u5468\u671f\u7684\u4ee3\u4ef7\u3002</p> <p>\u6709\u6ca1\u6709\u4ec0\u4e48\u529e\u6cd5\u6539\u8fdb\u5462\uff1f\u80fd\u5426\u53ea\u8bfb\u4e00\u4e2a Way \u7684 Tag \u548c\u6570\u636e\uff1f\u8fd9\u5c31\u9700\u8981\u5f15\u5165 Way Prediction\uff0c\u8fd9\u5728\u8bba\u6587 Way-Predicting Set-Associative Cache for High Performance and Low Energy Consumption \u4e2d\u63d0\u51fa\uff0c\u5b83\u7684\u601d\u8def\u662f\uff0c\u5f15\u5165\u4e00\u4e2a\u9884\u6d4b\u5668\uff0c\u9884\u6d4b\u8fd9\u6b21\u8bbf\u95ee\u4f1a\u547d\u4e2d\u54ea\u4e2a Way\uff0c\u7136\u540e\u7b2c\u4e00\u4e2a\u5468\u671f\u53ea\u8bfb\u8fd9\u4e00\u4e2a Way \u7684 Tag \u548c\u6570\u636e\uff0c\u5982\u679c Tag \u547d\u4e2d\u4e86\uff0c\u6570\u636e\u4e5f\u6709\u4e86\uff0c\u8fd9\u6837\u529f\u8017\u548c\u6027\u80fd\u90fd\u662f\u6bd4\u8f83\u597d\u7684\u3002\u4e0d\u8fc7\u5982\u679c\u9884\u6d4b\u9519\u4e86\uff0c\u7b2c\u4e8c\u4e2a\u5468\u671f\u5c31\u9700\u8981\u628a\u5176\u4ed6\u51e0\u4e2a Way \u7684 Tag \u548c\u6570\u636e\u8bfb\u51fa\u6765\uff0c\u518d\u6bd4\u8f83\u4e00\u6b21\uff1a</p> <p></p> <p>\uff08\u56fe\u6e90 Way-Predicting Set-Associative Cache for High Performance and Low Energy Consumption\uff09</p> <p>\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u7f13\u5b58\u8bfb\u53d6\u7684\u529f\u8017\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u5728\u5546\u7528\u5904\u7406\u5668\u4e2d\u4e5f\u6709\u4f7f\u7528\uff0c\u89c1 Take A Way: Exploring the Security Implications of AMD\u2019s Cache Way Predictors\u3002</p> <p>Zen5 \u7684\u6587\u6863\u91cc\u63d0\u5230\u4e86\u5b83\u600e\u4e48\u5728 L1 DCache \u4e0a\u505a Way/Tag Prediction\uff1a</p> <ol> <li>\u5bf9\u4e8e VIPT \u7684 cache \u6765\u8bf4\uff0c\u5b83\u7684 tag \u6765\u81ea\u4e8e\u7269\u7406\u5730\u5740\uff0c\u610f\u5473\u7740\u5982\u679c\u8981\u505a way \u6bd4\u5bf9\uff0c\u9700\u8981\u7b49\u5230\u865a\u5b9e\u5730\u5740\u8f6c\u6362\uff0c\u624d\u80fd\u77e5\u9053\u5b9e\u9645\u7684 tag</li> <li>Zen 5 \u4e3a\u4e86\u907f\u514d\u7b49\u5f85\u865a\u5b9e\u5730\u5740\u8f6c\u6362\uff0c\u57fa\u4e8e\u865a\u62df\u5730\u5740\u8ba1\u7b97\u51fa\u4e00\u4e2a tag\uff0c\u53eb\u505a microtag(utag)\uff0c\u5e76\u4e14\u7528\u865a\u62df\u5730\u5740\u6765\u9884\u6d4b\u8981\u8bbf\u95ee\u7684\u662f 12 \u4e2a way \u4e2d\u7684\u54ea\u4e00\u4e2a\uff1b\u8bfb\u53d6\u51fa\u90a3\u4e00\u4e2a way \u4ee5\u540e\uff0c\u7528 utag \u6765\u63d0\u524d\u505a tag \u6bd4\u5bf9</li> <li>\u7531\u4e8e utag \u5b8c\u5168\u7528\u7684\u662f\u865a\u62df\u5730\u5740\uff0c\u5b83\u53ef\u80fd\u4f1a\u51fa\u9519\uff0c\u628a miss \u7684\u9884\u6d4b\u4e3a hit\uff08\u6bd4\u5982\u51fa\u73b0\u4e86 hash \u51b2\u7a81\uff09\uff0c\u6216\u8005\u628a hit \u7684\u9884\u6d4b\u4e3a miss\uff08\u6bd4\u5982\u4e24\u4e2a\u865a\u62df\u9875\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u6570\u636e\u786e\u5b9e\u5728 L1 DCache \u4e2d\uff0c\u7528\u7269\u7406\u5730\u5740\u7b97\u51fa\u6765\u7684 tag \u76f8\u540c\uff0c\u4f46\u7528\u865a\u62df\u5730\u5740\u7b97\u51fa\u6765\u7684 utag \u4e0d\u540c\uff09\u3002</li> </ol> <p>\u9664\u4e86 Way Prediction\uff0c\u5b9e\u9645\u7684 L1 DCache \u4e3a\u4e86\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u5904\u7406\u591a\u6761 Load/Store \u6307\u4ee4\uff0c\u8fd8\u4f1a\u5206 Bank\u3002\u90a3\u4e48\u6bcf\u6761\u8bbf\u5b58\u6307\u4ee4\u8981\u8bbf\u95ee\u54ea\u4e2a Bank\uff0c\u4e5f\u9700\u8981\u9884\u6d4b\uff0c\u8fd9\u548c Way Prediction \u662f\u7c7b\u4f3c\u7684\uff0c\u6bd4\u5982 Zen5 \u7684\u6587\u6863\u662f\u8fd9\u4e48\u8bf4\u7684\uff1a</p> <pre><code>Address bits 5:3 and the size of an access along with its DC way determine\nwhich DC banks are needed for that access. DC way is determined using the\nlinear-address-based utag/way-predictor.\n</code></pre> <p>\u8bba\u6587 Take A Way: Exploring the Security Implications of AMD\u2019s Cache Way Predictors \u662f\u8fd9\u4e48\u9006\u5411 AMD \u7684 utag/way predictor \u7684\uff1a</p> <ol> <li>\u7531\u4e8e\u662f VIPT\uff0c\u6240\u4ee5 cache \u7684 index \u4f4d\u662f VA[11:6]\uff0c\u56e0\u6b64\u53ef\u4ee5\u6784\u9020\u51fa\u4e0d\u540c\u7684\u865a\u62df\u5730\u5740\uff0c\u8ba9\u5b83\u5bf9\u5e94\u540c\u4e00\u4e2a set</li> <li>\u5982\u679c\u4e24\u4e2a\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\uff0c\u5e76\u4e14\u51fa\u73b0\u4e86 utag \u51b2\u7a81\uff0c\u90a3\u4e48\u6027\u80fd\u4f1a\u4e0b\u964d\uff1b\u4e0d\u65ad\u5bfb\u627e\u6709\u51b2\u7a81\u7684\u60c5\u51b5\uff0c\u53d1\u73b0\u6700\u591a\u53ef\u4ee5\u5f97\u5230 256 \u7ec4\u5730\u5740\uff0c\u7ec4\u5185 utag \u4e92\u76f8\u51b2\u7a81\uff0c\u7ec4\u95f4\u5219\u4e0d\u51b2\u7a81\uff1b\u8fd9\u6697\u793a\u4e86 utag \u51b2\u7a81\u6765\u6e90\u4e8e hash \u51fa\u6765\u7684 8 \u4e2a bit \u4fe1\u606f</li> <li>\u6839\u636e\u8fd9 256 \u7ec4\u5730\u5740\uff0c\u627e\u5230 AMD Zen/Zen+/Zen2 \u7684 uTag \u54c8\u5e0c\u51fd\u6570\uff1a<ol> <li>uTag[7] = VA[19] xor VA[24]</li> <li>uTag[6] = VA[18] xor VA[23]</li> <li>uTag[5] = VA[17] xor VA[22]</li> <li>uTag[4] = VA[16] xor VA[21]</li> <li>uTag[3] = VA[15] xor VA[20]</li> <li>uTag[2] = VA[14] xor VA[25]</li> <li>uTag[1] = VA[13] xor VA[26]</li> <li>uTag[0] = VA[12] xor VA[27]</li> </ol> </li> <li>\u7c7b\u4f3c\u5730\uff0c\u627e\u5230\u66f4\u65e9\u7684 AMD Bulldozer/Piledriver/Streamroller \u7684 uTag \u54c8\u5e0c\u51fd\u6570\uff1a<ol> <li>uTag[7] = VA[19] xor VA[27]</li> <li>uTag[6] = VA[18] xor VA[26]</li> <li>uTag[5] = VA[17] xor VA[25]</li> <li>uTag[4] = VA[16] xor VA[24]</li> <li>uTag[3] = VA[15] xor VA[23]</li> <li>uTag[2] = VA[14] xor VA[22]</li> <li>uTag[1] = VA[13] xor VA[21]</li> <li>uTag[0] = VA[12] xor VA[20]</li> </ol> </li> </ol>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#load-value-prediction","title":"Load Value Prediction","text":"<p>Value Locality and Load Value Prediction \u63d0\u51fa\u4e86 Load Value Prediction\uff0c\u5c31\u662f\u5bf9 Load \u5f97\u5230\u7684\u503c\u8fdb\u884c\u9884\u6d4b\u3002\u5b83\u8bbe\u8ba1\u4e86\u4e00\u4e2a Load Value Prediction Table\uff0c\u6839\u636e Load \u6307\u4ee4\u7684\u5730\u5740\u6765\u7d22\u5f15\uff0c\u5f97\u5230\u9884\u6d4b\u7684\u8bfb\u53d6\u7684\u503c\u3002\u7136\u540e\u8bbe\u8ba1\u4e00\u4e2a Load Classification Table \u6765\u8bb0\u5f55\u9884\u6d4b\u51c6\u786e\u4e0e\u5426\u7684\u5386\u53f2\uff0c\u8bb0\u5f55\u4e86 saturating counter\uff0c\u4ee5\u6b64\u6765\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u9884\u6d4b\u3002\u9884\u6d4b\u65f6\uff0c\u53ef\u4ee5\u63d0\u524d\u628a\u7ed3\u679c\u5199\u5165\u5230\u76ee\u7684\u5bc4\u5b58\u5668\u5185\uff0c\u4f46\u8fd8\u8981\u9a8c\u8bc1\u9884\u6d4b\u7684\u6b63\u786e\u6027\u3002\u9a8c\u8bc1\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u7b2c\u4e00\u662f\u4f9d\u7136\u5b8c\u6210\u6b63\u5e38\u7684\u8bbf\u5b58\uff0c\u628a\u8bfb\u51fa\u6765\u7684\u6570\u636e\u548c\u9884\u6d4b\u7684\u6570\u636e\u505a\u6bd4\u8f83\uff1b\u7b2c\u4e8c\u662f\u9488\u5bf9\u9884\u6d4b\u6b63\u786e\u7387\u5f88\u9ad8\u7684 Load\uff0c\u4ece\u4e00\u4e2a\u5c0f\u7684 Constant Verification Unit \u786e\u8ba4\u8fd9\u4e2a\u503c\u6ca1\u6709\u53d8\u8fc7\u3002</p> <p>\u5982\u679c\u8981\u62ff\u5206\u652f\u9884\u6d4b\u6765\u7c7b\u6bd4\uff0cBTB \u8bb0\u5f55\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\uff0c\u5bf9\u5e94\u8fd9\u91cc\u7684 Load Value Prediction Table\uff0c\u8bb0\u5f55 Load \u6307\u4ee4\u5f97\u5230\u7684\u503c\uff1bBHT \u8bb0\u5f55\u5206\u652f\u7684\u8df3\u8f6c\u65b9\u5411\uff0c\u5bf9\u5e94\u8fd9\u91cc\u7684 Load Classification Table\uff0c\u5224\u65ad Load \u7684\u53ef\u9884\u6d4b\u6027\u3002</p> <p>Constant Verification Unit \u7c7b\u4f3c\u4e00\u4e2a\u5c0f\u7684\u9488\u5bf9 Load Value Prediction \u7684 L0 Cache\uff0c\u53ea\u8bb0\u5f55\u90a3\u4e9b\u9884\u6d4b\u6b63\u786e\u7387\u5f88\u9ad8\u7684 Load \u7684\u5730\u5740-\u503c\u6620\u5c04\u5173\u7cfb\uff0c\u53ef\u4ee5\u5728\u5730\u5740\u8ba1\u7b97\u51fa\u6765\u540e\u67e5\u8be2\uff0c\u5224\u65ad\u8bbf\u5b58\u662f\u5426\u6b63\u786e\u9884\u6d4b\uff0c\u5982\u679c\u6b63\u786e\uff0c\u5c31\u4e0d\u7528\u8bbf\u95ee\u7f13\u5b58\u4e86\u3002</p> <p>\u53ef\u89c1\u8fd9\u4e2a\u4f18\u5316\u4e3b\u8981\u89e3\u51b3\u7684\u662f\u6253\u7834\u4e86 Load \u6307\u4ee4\u5e26\u6765\u7684\u4f9d\u8d56\uff0c\u4f46\u7f13\u5b58\u5e26\u5bbd\u8fd8\u662f\u8981\u8017\u8d39\u7684\uff08Constant Verification Unit \u53ef\u4ee5\u8282\u7701\u4e00\u4e9b\uff09\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#stable-load","title":"Stable Load","text":"<p>\u8bba\u6587 Constable: Improving Performance and Power Efficiency by Safely Eliminating Load Instruction Execution \u6307\u51fa\uff0c\u5f88\u591a Load \u6307\u4ee4\u603b\u662f\u4ece\u76f8\u540c\u7684\u5730\u5740\u53d6\u51fa\u76f8\u540c\u7684\u503c\uff0c\u5bf9\u4e8e\u8fd9\u79cd Load \u6307\u4ee4\uff08\u79f0\u4e3a Stable Load\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u786c\u4ef6\u7684\u6269\u5c55\u6765\u4f18\u5316\uff0c\u63d0\u5347\u6027\u80fd\u3002\u5b83\u662f\u8fd9\u4e48\u505a\u7684\uff1a</p> <ol> <li>\u68c0\u6d4b\u8fd9\u6837\u7684 Stable Load\uff1aLoad \u6267\u884c\u7684\u65f6\u5019\uff0c\u5224\u65ad\u8fd9\u6b21\u7684 Load \u5730\u5740\u548c\u6570\u636e\uff0c\u4e0e\u540c\u4e00\u4e2a PC \u7684\u4e0a\u4e00\u6b21 Load \u662f\u5426\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\uff0c\u5c31\u589e\u52a0\u7f6e\u4fe1\u5ea6</li> <li>\u5982\u679c\u4e00\u6bb5\u65f6\u95f4\u5185\u5730\u5740\u548c\u6570\u636e\u90fd\u4e0d\u53d8\uff08\u901a\u8fc7\u7f6e\u4fe1\u5ea6\u5224\u65ad\uff09\uff0c\u8ba4\u4e3a\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u6d88\u9664\u7684 Stable Load</li> <li>\u6d88\u9664\u7684\u65b9\u6cd5\u662f\uff0c\u76f4\u63a5\u628a Load \u7684\u6570\u636e\u590d\u5236\u7ed9\u76ee\u7684\u5bc4\u5b58\u5668\uff0c\u8df3\u8fc7\u4e86\u5730\u5740\u8ba1\u7b97\uff0c\u4e5f\u4e0d\u7528\u8bbf\u5b58</li> <li>\u5728 Register Monitor Table \u4e2d\u8bb0\u5f55 Stable Load \u4f7f\u7528\u7684\u6e90\u5bc4\u5b58\u5668\uff0c\u5982\u679c\u8fd9\u4e9b\u5bc4\u5b58\u5668\u88ab\u4fee\u6539\u4e86\uff0c\u90a3\u4e48\u5927\u6982\u7387\u5730\u5740\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4e0d\u518d\u6d88\u9664\u8fd9\u6761 Stable Load</li> <li>\u5728 Address Monitor Table \u4e2d\u8bb0\u5f55 Stable Load \u8bbf\u95ee\u7684\u5730\u5740\uff0c\u5982\u679c\u5bf9\u8fd9\u4e2a\u5730\u5740\u6709\u5199\u5165\u64cd\u4f5c\uff0c\u6216\u8005\u88ab\u5176\u4ed6\u6838\u5fc3\u8bbf\u95ee\uff0c\u90a3\u4e48\u5927\u6982\u7387\u6570\u636e\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4e0d\u518d\u6d88\u9664\u8fd9\u6761 Stable Load</li> </ol> <p>\u8fd9\u7bc7\u8bba\u6587\u53ef\u4ee5\u8ba4\u4e3a\u662f Load Value Prediction \u7684\u53d8\u4f53\uff1a\u7f29\u5c0f Load \u6307\u4ee4\u4f18\u5316\u7684\u8303\u56f4\uff0c\u53ea\u8003\u8651\u6570\u636e Constant \u4e14\u6e90\u5730\u5740\u5bc4\u5b58\u5668\u4e0d\u53d8\u7684 Load\uff0c\u6b64\u65f6\u4e0d\u518d\u9700\u8981\u53bb\u8bfb\u7f13\u5b58\u6765\u9a8c\u8bc1\u6b63\u786e\u6027\uff0c\u540c\u65f6\u4e5f\u7701\u53bb\u4e86\u5730\u5740\u7684\u91cd\u590d\u8ba1\u7b97\uff08Load Value Prediction \u4e2d\uff0c\u56e0\u4e3a\u6ca1\u6709\u8ddf\u8e2a\u5bc4\u5b58\u5668\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u9884\u6d4b\u65f6\uff0c\u8fd8\u662f\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u5730\u5740\uff0c\u53bb\u67e5\u8be2\u7f13\u5b58\u6216\u8005 Constant Verification Unit\uff09\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#\u6570\u636e\u9884\u53d6","title":"\u6570\u636e\u9884\u53d6","text":"<p>\u6570\u636e\u9884\u53d6\u7684\u76ee\u7684\u662f\u9884\u6d4b\u7a0b\u5e8f\u7684\u8bbf\u5b58\u6a21\u5f0f\uff0c\u63d0\u524d\u628a\u6570\u636e\u51c6\u5907\u5230\u7f13\u5b58\u5f53\u4e2d\uff0c\u63d0\u5347\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u3002\u4ee5 AMD Zen 5 \u4e3a\u4f8b\uff0c\u5b83\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u9884\u53d6\u5668\uff08\u6765\u6e90\uff1aProcessor Programming Reference (PPR) for AMD Family 1Ah Model 24h, Revision B0 Processors\uff09\uff1a</p> <ul> <li>L2 Up/Down Prefetcher: uses memory access history to determine whether to fetch the next or previous line into L2 cache for all memory accesses.</li> <li>L2 Stream Prefetcher: uses history of memory access patterns to fetch additional sequential lines into L2 cache.</li> <li>L1 Region Prefetcher: uses memory access history to fetch additional lines into L1 cache when the data access for a given instruction tends to be followed by a consistent pattern of other accesses within a localized region.</li> <li>L1 Stride Prefetcher: uses memory access history of individual instructions to fetch additional lines into L1 cache when each access is a constant distance from the previous.</li> <li>L1 Stream Prefetcher: uses history of memory access patterns to fetch additional sequential lines into L1 cache.</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0cStream Prefetcher \u5c31\u662f\u53d6\u4e00\u6bb5\u8fde\u7eed\u7684 Cache Line\uff0cStride Prefetcher \u5219\u662f\u6839\u636e Stride \u53bb\u9884\u53d6\u6570\u636e\uff0c\u672a\u5fc5\u662f\u8fde\u7eed\u7684 Cache Line\uff0cUp/Down Prefetcher \u66f4\u597d\u7406\u89e3\uff0c\u5c31\u662f\u53d6\u76f8\u90bb\u7684\u4e00\u4e2a Cache Line\u3002Region Prefetcher \u5219\u6bd4\u8f83\u590d\u6742\uff0c\u5c5e\u4e8e Spatial Prefetcher \u7684\u4e00\u79cd\u3002</p> <p>Intel \u7684\u5904\u7406\u5668\u901a\u8fc7 MSR 1A4H \u53ef\u4ee5\u914d\u7f6e\u5404\u4e2a\u9884\u53d6\u5668\uff1a</p> <ul> <li>the L2 hardware prefetcher, which fetches additional lines of code or data into the L2 cache.</li> <li>the L2 adjacent cache line prefetcher, which fetches the cache line that comprises a cache line pair (128 bytes). \u8fd9\u548c AMD \u7684 Up/Down Prefetcher \u5e94\u8be5\u662f\u4e00\u4e2a\u610f\u601d</li> <li>the L2 Adaptive Multipath Probability (AMP) prefetcher. \u6839\u636e\u4e13\u5229 Systems and methods for adaptive multipath probability (amp) prefetcher \u7684\u63cf\u8ff0\uff0c\u8fd9\u4e2a\u5e94\u8be5\u5c5e\u4e8e Spatial Prefetcher</li> <li>the L1 data cache prefetcher, which fetches the next cache line into L1 data cache. \u8fd9\u4e2a\u5e94\u8be5\u5c5e\u4e8e Next Line Prefetcher</li> <li>the L1 data cache IP prefetcher, which uses sequential load history (based on instruction pointer of previous loads) to determine whether to prefetch additional lines.</li> </ul> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd Spatial Prefetching \u548c Temporal Prefetching\u3002</p> <p>Spatial Prefetching \u7684\u601d\u60f3\u662f\u8fd9\u6837\u7684\uff1a\u7a0b\u5e8f\u7ecf\u5e38\u4f1a\u8bbf\u95ee\u6570\u7ec4\uff0c\u90a3\u4e48\u5bf9\u6570\u7ec4\u6bcf\u4e2a\u5143\u7d20\u7684\u8bbf\u95ee\u6a21\u5f0f\uff0c\u5e94\u8be5\u662f\u7c7b\u4f3c\u7684\u3002\u6bd4\u5982\u8bbf\u95ee\u6570\u7ec4\u524d\u5341\u4e2a\u5143\u7d20\u6709\u67d0\u79cd\u89c4\u5f8b\uff0c\u90a3\u4e48\u8bbf\u95ee\u63a5\u4e0b\u6765\u7684\u5341\u4e2a\u5143\u7d20\u5e94\u8be5\u4e5f\u6709\u7c7b\u4f3c\u7684\u89c4\u5f8b\uff0c\u53ea\u662f\u5730\u5740\u53d8\u4e86\u800c\u5df2\u3002\u5982\u679c\u8fd9\u4e2a\u6570\u7ec4\u7684\u5143\u7d20\u7684\u7ed3\u6784\u6bd4\u8f83\u590d\u6742\uff0c\u8fd9\u4e2a\u8bbf\u5b58\u6a21\u5f0f\uff08\u4f8b\u5982\u4ece 0\u3001256 \u548c 320 \u4e09\u4e2a\u504f\u79fb\u5206\u522b\u8bfb\u53d6\u6570\u636e\uff09\u53ef\u80fd\u65e2\u4e0d\u6ee1\u8db3 Stride \u53c8\u4e0d\u6ee1\u8db3 Stream\uff0c\u6b64\u65f6\u5c31\u9700\u8981 Spatial Prefetcher \u6765\u4ecb\u5165\u3002\u4f8b\u5982\u7a0b\u5e8f\u5728\u540c\u4e00\u4e2a\u7269\u7406\u9875\u5185\uff0c\u603b\u662f\u4f1a\u4ece A\u3001B\u3001C \u548c D \u56db\u4e2a\u9875\u5185\u504f\u79fb\u8bfb\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u5f53\u7a0b\u5e8f\u4ece\u9875\u5185\u504f\u79fb A \u8bfb\u53d6\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u9875\u7684\u6570\u636e\u65f6\uff0c\u5927\u6982\u7387\u65b0\u7684\u7269\u7406\u9875\u5185 B\u3001C \u548c D \u504f\u79fb\u5904\u7684\u6570\u636e\u5c06\u6765\u4f1a\u88ab\u8bfb\u53d6\uff0c\u90a3\u5c31\u9884\u53d6\u8fdb\u6765\u3002</p> <p>\u4e00\u79cd Spatial Prefetcher \u5b9e\u73b0\u662f Spatial Memory Streaming (SMS)\u3002\u5b83\u7684\u505a\u6cd5\u662f\uff0c\u628a\u5185\u5b58\u5206\u6210\u5f88\u591a\u4e2a\u76f8\u540c\u5927\u5c0f\u7684 Region\uff0c\u5f53\u7f13\u5b58\u51fa\u73b0\u7f3a\u5931\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a Region\uff0c\u8bb0\u5f55\u8fd9\u6b21\u8bbf\u5b58\u6307\u4ee4\u7684 PC \u4ee5\u53ca\u8bbf\u5b58\u7684\u5730\u5740\u76f8\u5bf9 Region \u7684\u504f\u79fb\uff0c\u7136\u540e\u5f00\u59cb\u8ddf\u8e2a\u8fd9\u4e2a Region \u5185\u54ea\u4e9b\u6570\u636e\u88ab\u8bfb\u53d6\u4e86\uff0c\u76f4\u5230\u8fd9\u4e2a Region \u7684\u6570\u636e\u88ab\u6362\u51fa Cache\uff0c\u5c31\u7ed3\u675f\u8bb0\u5f55\uff0c\u628a\u4fe1\u606f\u4fdd\u5b58\u4e0b\u6765\u3002\u4ee5\u4e0a\u9762\u7684 0\u3001256 \u548c 320 \u4e3a\u4f8b\u5b50\uff0c\u8bbf\u95ee 0 \u65f6\u51fa\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u90a3\u5c31\u521b\u5efa\u4e00\u4e2a Region\uff0c\u7136\u540e\u628a 256 \u548c 320 \u8fd9\u4e24\u4e2a\u504f\u79fb\u8bb0\u4e0b\u6765\u3002\u5f53\u540c\u4e00\u6761\u8bbf\u5b58\u6307\u4ee4\u53c8\u51fa\u73b0\u7f3a\u5931\uff0c\u5e76\u4e14\u504f\u79fb\u548c\u4e4b\u524d\u4e00\u6837\u65f6\uff0c\u6839\u636e\u4e4b\u524d\u4fdd\u5b58\u7684\u4fe1\u606f\uff0c\u628a Region \u91cc\u66fe\u7ecf\u8bfb\u8fc7\u7684\u5730\u5740\u9884\u53d6\u4e00\u904d\uff0c\u6309\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u4e5f\u5c31\u662f 256 \u548c 320\u3002\u8fd9\u91cc\u7684\u6838\u5fc3\u662f\u53ea\u5339\u914d\u504f\u79fb\u800c\u4e0d\u662f\u5b8c\u6574\u7684\u5730\u5740\uff0c\u5ffd\u7565\u4e86\u5730\u5740\u7684\u9ad8\u4f4d\uff0c\u6700\u540e\u9884\u53d6\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u62ff\u65b0\u7684\u5bfc\u81f4\u7f13\u5b58\u7f3a\u5931\u7684\u5730\u5740\u53bb\u52a0\u504f\u79fb\uff0c\u81ea\u7136\u800c\u7136\u5b9e\u73b0\u4e86\u5e73\u79fb\u3002\u4ece AMD \u7684\u4e13\u5229 DATA CACHE REGION PREFETCHER \u6765\u770b\uff0cAMD \u7684 L1 Region Prefetcher \u5e94\u8be5\u91c7\u7528\u7684\u662f SMS \u7684\u601d\u60f3\uff0c\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a Region\uff0c\u8bb0\u5f55\u8fd9\u4e2a Region \u4e2d\u54ea\u4e9b\u6570\u636e\u88ab\u8bbf\u95ee\u4e86\u3002</p> <p>\u53e6\u4e00\u79cd Spatial Prefetcher \u5b9e\u73b0\u662f Variable length delta prefetcher (VLDP)\uff0c\u5b83\u7684\u601d\u8def\u662f\uff0c\u5bf9\u8bbf\u5b58\u5e8f\u5217\u6c42\u5dee\u5206\uff0c\u5373\u7528\u7b2c k \u6b21\u8bbf\u5b58\u5730\u5740\u51cf\u53bb\u7b2c k-1 \u6b21\u8bbf\u5b58\u5730\u5740\uff0c\u5f97\u5230 Delta \u5e8f\u5217\uff0c\u7136\u540e\u5bf9\u5f53\u524d\u7684 Delta \u5e8f\u5217\uff0c\u9884\u6d4b\u4e0b\u4e00\u4e2a Delta\uff0c\u90a3\u4e48\u9884\u53d6\u7684\u5730\u5740\uff0c\u5c31\u662f Delta \u52a0\u4e0a\u6700\u540e\u4e00\u6b21\u8bbf\u5b58\u7684\u5730\u5740\u3002\u4ece Intel \u7684\u4e13\u5229 Systems and methods for adaptive multipath probability (amp) prefetcher \u6765\u770b\uff0c\u5b83\u7684 AMP Prefetcher \u5b9e\u73b0\u601d\u8def\u548c VLDP \u7c7b\u4f3c\uff0c\u4e13\u5229\u4e2d\u7ed9\u51fa\u4e86\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <ul> <li>\u5047\u5982\u7a0b\u5e8f\u5bf9\u67d0\u4e2a\u7269\u7406\u9875\u7684\u8bbf\u5b58\u6a21\u5f0f\u662f\uff1a0, 2, 4, 16, 15</li> <li>\u6c42\u5dee\u5206\uff0c\u5f97\u5230\uff1a+2, +2, +12, -1</li> <li>\u90a3\u4e48 AMP \u9884\u6d4b\u5668\u8981\u505a\u7684\u5c31\u662f\uff1a<ul> <li>\u65e0\u5386\u53f2\u65f6\uff0c\u9884\u6d4b\u7b2c\u4e00\u4e2a\u5dee\u5206\u503c\uff1aN/A -&gt; +2</li> <li>\u7b2c\u4e00\u4e2a\u5dee\u5206\u662f +2 \u65f6\uff0c\u9884\u6d4b\u7b2c\u4e8c\u4e2a\u5dee\u5206\u503c\uff1a+2 -&gt; +2</li> <li>\u5df2\u77e5\u524d\u4e24\u4e2a\u5dee\u5206\u65f6\uff0c\u9884\u6d4b\u7b2c\u4e09\u4e2a\u5dee\u5206\u503c\uff1a+2, +2 -&gt; +12</li> <li>\u5df2\u77e5\u524d\u4e09\u4e2a\u5dee\u5206\u65f6\uff0c\u9884\u6d4b\u7b2c\u56db\u4e2a\u5dee\u5206\u503c\uff1a+2, +2, +12 -&gt; -1</li> </ul> </li> </ul> <p>\u4e0d\u8fc7 Spatial Prefetcher \u9047\u5230\u52a8\u6001\u5206\u914d\u7684\u4e0d\u8fde\u7eed\u7684\u6570\u636e\u7ed3\u6784\u5c31\u72af\u4e86\u96be\uff08\u6bd4\u5982\u94fe\u8868\u548c\u6811\uff09\uff0c\u56e0\u4e3a\u6570\u636e\u5728\u5185\u5b58\u91cc\u7684\u5206\u5e03\u6bd4\u8f83\u968f\u673a\uff0c\u800c\u4e14\u8fd8\u6709\u5404\u79cd\u6307\u9488\uff0c\u8981\u8bbf\u95ee\u7684\u6570\u636e\u4e4b\u95f4\u7684\u504f\u79fb\u5927\u6982\u7387\u662f\u4e0d\u540c\u7684\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981 Temporal Prefetcher\uff0c\u5b83\u7684\u601d\u8def\u662f\u8ddf\u8e2a\u7f13\u5b58\u7f3a\u5931\u7684\u5386\u53f2\uff0c\u5982\u679c\u53d1\u73b0\u5f53\u524d\u7f3a\u5931\u7684\u5730\u5740\u5728\u5386\u53f2\u4e2d\u66fe\u7ecf\u51fa\u73b0\u8fc7\uff0c\u90a3\u5c31\u9884\u53d6\u5728\u5386\u53f2\u4e2d\u7d27\u968f\u5176\u540e\u7684\u51e0\u6b21\u7f13\u5b58\u7f3a\u5931\u3002\u6bd4\u5982\u94fe\u8868\u8282\u70b9\u6309\u987a\u5e8f\u662f A\u3001B \u548c C\uff0c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u6309\u7167 A B C \u7684\u987a\u5e8f\u51fa\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u8fd9\u4e9b\u7f3a\u5931\u88ab\u8bb0\u5f55\u5728\u5386\u53f2\u5f53\u4e2d\uff1b\u672a\u6765\u5982\u679c\u518d\u6b21\u8bbf\u95ee A\uff0c\u9884\u53d6\u5668\u5728\u5386\u53f2\u4e2d\u627e\u5230 A \u7684\u4f4d\u7f6e\uff0c\u53d1\u73b0\u5176\u540e\u7684\u7f13\u5b58\u7f3a\u5931\u4e3a B \u548c C\uff0c\u90a3\u5c31\u5bf9\u5b83\u4eec\u8fdb\u884c\u9884\u53d6\u3002\u5c31\u597d\u50cf\u9884\u53d6\u5668\u81ea\u5df1\u5b58\u4e86\u4e00\u4efd\u94fe\u8868\uff0c\u63d0\u524d\u53bb\u67e5\u540e\u7ee7\u7684\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f Record and Replay \u601d\u60f3\u7684\u5b9e\u8df5\u3002</p> <p>\u4e00\u79cd Temporal Prefetch \u7684\u5b9e\u73b0\u662f Sampled Temporal Memory Streaming (STMS)\u3002\u5b83\u7684\u601d\u8def\u662f\uff0c\u65e2\u7136\u8981\u5b58\u5386\u53f2\uff0c\u5c31\u628a\u6700\u8fd1\u82e5\u5e72\u6b21 Cache Miss \u7684\u5730\u5740\u7528\u4e00\u4e2a\u73af\u5f62\u6570\u7ec4\u90fd\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u4e3a\u4e86\u5728\u7f13\u5b58\u7f3a\u5931\u65f6\u5feb\u901f\u5b9a\u4f4d\u5730\u5740\u5728\u5386\u53f2\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6784\u5efa\u4e00\u4e2a\u7c7b\u4f3c\u54c8\u5e0c\u8868\u7684\u7ed3\u6784\uff0c\u8bb0\u5f55\u5404\u5185\u5b58\u5730\u5740\u6700\u8fd1\u4e00\u6b21\u51fa\u73b0\u5728\u5386\u53f2\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u3002\u8bbf\u5b58\u65f6\u67e5\u8be2\u54c8\u5e0c\u8868\uff0c\u5982\u679c\u547d\u4e2d\u4e86\uff0c\u5c31\u4ece\u5386\u53f2\u6570\u7ec4\u4e2d\u53d6\u51fa\u540e\u7eed\u7684\u7f13\u5b58\u7f3a\u5931\u7684\u5730\u5740\u6765\u9884\u53d6\u3002</p> <p>ARM \u516c\u7248\u6838\u4ece Cortex-A78/Cortex-X1/Neoverse-V1 \u5f00\u59cb\u5f15\u5165\u7684 Correlated Miss Caching (CMC) \u9884\u53d6\u5668\u5c31\u662f\u4e00\u79cd Temporal Prefetcher\uff0c\u5b83\u53ef\u4ee5\u660e\u663e\u964d\u4f4e pointer chasing \u7684\u5ef6\u8fdf\uff0c\u6b64\u65f6\u518d\u7528\u968f\u673a pointer chasing \u6d4b\u51fa\u6765\u7684\u7f13\u5b58\u5bb9\u91cf\u548c\u5ef6\u8fdf\u53ef\u80fd\u5c31\u4e0d\u51c6\u4e86\u3002\u6ca1\u6709\u914d\u5907 CMC Prefetcher \u7684 ARM \u516c\u7248\u6838\uff0c\u5f53 footprint \u8d85\u51fa L2 \u65f6\uff0c\u968f\u673a pointer chasing \u6d4b\u8bd5\u53ef\u4ee5\u89c2\u5bdf\u5230\u660e\u663e\u7684\u5ef6\u8fdf\u4e0a\u5347\uff0c\u800c\u914d\u5907\u4e86 CMC Prefetcher \u540e\uff0cfootprint \u9700\u8981\u5230\u63a5\u8fd1 L3 \u624d\u80fd\u770b\u5230\u660e\u663e\u7684\u5ef6\u8fdf\u4e0a\u5347\u3002</p> <p>\u5728 Golden Cove \u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5b83\u7684 L1 DCache \u5927\u5c0f\u662f 48KB\uff0c\u5982\u679c\u7528\u968f\u673a\u7684 pointer chasing \u65b9\u5f0f\u8bbf\u5b58\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\u5728 48KB \u4e4b\u5185\u662f 5 cycle latency\uff0c\u5728 L2 Cache \u8303\u56f4\u5185\u662f 16 cycle latency\u3002\u4f46\u5982\u679c\u628a pointer chasing \u7684\u8bbf\u5b58\u6a21\u5f0f\u6539\u6210\u6bd4\u8f83\u6709\u89c4\u5f8b\u7684\u6a21\u5f0f\uff0c\u6bd4\u5982\u6309 64B\u3001128B\u3001192B\u3001256B \u76f4\u81f3 512B \u7684\u8df3\u6b65\u8fdb\u884c\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5373\u4f7f\u8d85\u8fc7\u4e86 L1 DCache \u7684\u5bb9\u91cf\uff0c\u8fd8\u662f\u53ef\u4ee5\u505a\u5230\u5927\u7ea6 5-8 cycle \u7684 latency\u3002\u8fd9\u5c31\u662f L1 Prefetcher \u5728\u8d77\u4f5c\u7528\u3002</p> <p>\u5982\u679c\u6211\u4eec\u901a\u8fc7 <code>wrmsr -p 0 0x1a4 0x8</code> \u628a <code>DCU_IP_PREFETCHER_DISABLE</code> \u8bbe\u4e3a 1\uff0c\u5173\u95ed L1 data cache IP prefetcher\uff0c\u518d\u5728 0 \u53f7\u6838\u5fc3\u4e0a\u91cd\u65b0\u8dd1\u4e0a\u9762\u7684\u6d4b\u8bd5\uff0c\u5c31\u53ef\u4ee5\u770b\u5230 L2 Cache \u7684\u8303\u56f4\u5185\u7684\u6027\u80fd\u9000\u5316\u5230\u4e86 16 Cycle\uff0c\u548c\u968f\u673a pointer chasing \u4e00\u6837\u3002\u5173\u95ed\u5176\u4ed6\u7684 prefetcher \u5219\u6ca1\u6709\u8fd9\u4e2a\u73b0\u8c61\uff0c\u8bf4\u660e\u6b63\u662f L1 data cache IP prefetcher \u5b9e\u73b0\u4e86\u9488\u5bf9 L1 \u7684 Stride Prefetcher\u3002</p>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2022/03/31/brief-into-ooo-2/#\u7f13\u5b58\u5185\u5b58\u4eff\u771f\u6a21\u578b","title":"\u7f13\u5b58/\u5185\u5b58\u4eff\u771f\u6a21\u578b","text":"<p>\u6700\u540e\u5217\u4e3e\u4e00\u4e0b\u79d1\u7814\u91cc\u5e38\u7528\u7684\u4e00\u4e9b\u7f13\u5b58/\u5185\u5b58\u4eff\u771f\u6a21\u578b\uff1a</p> <ul> <li>DRAMSim2: \u8bba\u6587 DRAMSim2: A Cycle Accurate Memory System Simulator \u4ee3\u7801</li> <li>DRAMsim3: \u8bba\u6587 DRAMsim3: A Cycle-Accurate, Thermal-Capable DRAM Simulator \u4ee3\u7801</li> <li>DRAMSys4.0\uff1a\u8bba\u6587 DRAMSys4.0: A Fast and Cycle-Accurate SystemC/TLM-Based DRAM Simulator 4.0 \u4ee3\u7801 5.0 \u4ee3\u7801</li> <li>CACTI: \u8bba\u6587 CACTI 2.0: An Integrated Cache Timing and Power Model \u4ee3\u7801</li> <li>McPAT: \u8bba\u6587 McPAT: An integrated power, area, and timing modeling framework for multicore and manycore architectures \u4ee3\u7801</li> <li>Ramulator: \u8bba\u6587 Ramulator: A Fast and Extensible DRAM Simulator \u4ee3\u7801</li> </ul>","tags":["ooo","cpu","lsu","cache","dram","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/","title":"\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u8fd9\u662f \u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU \u7cfb\u5217\u535a\u5ba2\u7684\u7b2c\u4e09\u7bc7\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u8ba8\u8bba\u5904\u7406\u5668\u524d\u7aef\u7684\u90e8\u5206\u3002</p> <p>\u672c\u7cfb\u5217\u7684\u6240\u6709\u6587\u7ae0\uff1a</p> <ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> </ul>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#\u5904\u7406\u5668\u524d\u7aef","title":"\u5904\u7406\u5668\u524d\u7aef","text":"<p>\u518d\u6765\u5206\u6790\u4e00\u4e0b\u4e71\u5e8f\u6267\u884c CPU \u7684\u524d\u7aef\u90e8\u5206\u3002\u4ee5 RISC-V \u4e3a\u4f8b\uff0c\u6307\u4ee4\u957f\u5ea6\u6709 4 \u5b57\u8282\u6216\u8005 2 \u5b57\u8282\u4e24\u79cd\uff0c\u5176\u4e2d 2 \u5b57\u8282\u5c5e\u4e8e\u538b\u7f29\u6307\u4ee4\u96c6\u3002\u5982\u4f55\u6b63\u786e\u5e76\u9ad8\u6548\u5730\u8fdb\u884c\u53d6\u6307\u4ee4\u8bd1\u7801\uff1f</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5e0c\u671b\u524d\u7aef\u80fd\u591f\u5c3d\u53ef\u80fd\u5feb\u5730\u53d6\u6307\u4ee4\uff0c\u524d\u7aef\u7684\u53d6\u6307\u80fd\u529b\u8981\u548c\u540e\u7aef\u5339\u914d\uff0c\u6bd4\u5982\u5bf9\u4e8e\u4e00\u4e2a\u56db\u53d1\u5c04\u7684 CPU\uff0c\u524d\u7aef\u5bf9\u5e94\u5730\u9700\u8981\u4e00\u4e2a\u5468\u671f\u53d6 <code>4*4=16</code> \u5b57\u8282\u7684\u6307\u4ee4\u3002\u4f46\u662f\uff0c\u8fd9 16 \u5b57\u8282\u53ef\u80fd\u662f 4 \u6761\u975e\u538b\u7f29\u6307\u4ee4\uff0c\u4e5f\u53ef\u80fd\u662f 8 \u6761\u538b\u7f29\u6307\u4ee4\uff0c\u4e5f\u53ef\u80fd\u662f\u6df7\u5408\u7684\u60c5\u51b5\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u4f1a\u51fa\u73b0\u4e00\u4e2a\u53ef\u80fd\u51fa\u73b0\u6307\u4ee4\u6761\u6570\u4e0d\u5339\u914d\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u4e2d\u95f4\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a Fetch Buffer\uff0c\u6bd4\u5982 BOOM \u7684\u5b9e\u73b0\u4e2d\uff0cL1 ICache \u6bcf\u5468\u671f\u8bfb\u53d6 16 \u5b57\u8282\uff0c\u7136\u540e\u8fdb\u884c\u9884\u8bd1\u7801\uff0c\u51fa\u6765 8 \u6761\u6307\u4ee4\uff0c\u4fdd\u5b58\u5230 Fetch Buffer \u4e2d\u3002\u8fd9\u91cc\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u70b9\uff1a\u9996\u5148\u4ece ICache \u8bfb\u53d6\u7684\u6570\u636e\u662f\u5bf9\u9f50\u7684\uff0c\u4f46\u662f PC \u53ef\u80fd\u4e0d\u662f\uff0c\u6bd4\u5982\u4e2d\u95f4\u7684\u5730\u5740\u3002\u5176\u6b21\uff0c\u53ef\u80fd\u4e00\u4e2a 4 \u5b57\u8282\u7684\u975e\u538b\u7f29\u6307\u4ee4\u8de8\u8d8a\u4e86\u4e24\u6b21 Fetch\uff0c\u6bd4\u5982\u524d 2 \u4e2a\u5b57\u8282\u5728\u524d\u4e00\u4e2a Fetch Bundle\uff0c\u540e 2 \u4e2a\u5b57\u8282\u5728\u540e\u4e00\u4e2a Fetch Bundle\uff1b\u6b64\u5916\uff0c\u6bcf\u4e2a 2 \u5b57\u8282\u7684\u8fb9\u754c\u90fd\u9700\u8981\u5224\u65ad\u4e00\u4e0b\u662f\u538b\u7f29\u6307\u4ee4\u8fd8\u662f\u975e\u538b\u7f29\u6307\u4ee4\u3002\u4e00\u4e2a\u975e\u5e38\u7279\u6b8a\u7684\u60c5\u51b5\u5c31\u662f\uff0c\u4e00\u4e2a 4 \u5b57\u8282\u7684\u6307\u4ee4\u8de8\u8d8a\u4e86\u4e24\u4e2a\u9875\uff0c\u6240\u4ee5\u4e24\u4e2a\u9875\u90fd\u9700\u8981\u67e5\u8be2\u9875\u8868\uff1b\u5982\u679c\u6070\u597d\u5728\u7b2c\u4e8c\u4e2a\u9875\u5904\u53d1\u751f\u4e86\u9875\u7f3a\u5931\uff0c\u6b64\u65f6 epc \u662f\u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u4f46 tval \u662f\u7b2c\u4e8c\u4e2a\u9875\u7684\u5730\u5740\uff0c\u8fd9\u6837\u5185\u6838\u624d\u77e5\u9053\u662f\u54ea\u4e2a\u9875\u53d1\u751f\u4e86\u7f3a\u5931\u3002</p> <p>\u5176\u6b21\uff0c\u9700\u8981\u914d\u5408\u5206\u652f\u9884\u6d4b\u3002\u5982\u679c\u9700\u8981\u4fdd\u8bc1\u5206\u652f\u9884\u6d4b\u6b63\u786e\u7684\u60c5\u51b5\u4e0b\uff0c\u80fd\u591f\u5728\u5faa\u73af\u4e2d\u8fbe\u5230\u63a5\u8fd1 100% \u7684\u6027\u80fd\uff0c\u90a3\u4e48\uff0c\u5728 Fetch \u5206\u652f\u7ed3\u5c3e\u7684\u5206\u652f\u6307\u4ee4\u7684\u540c\u65f6\uff0c\u9700\u8981\u4fdd\u8bc1\u4e0b\u4e00\u6b21 Fetch \u5df2\u7ecf\u5f97\u5230\u4e86\u5206\u652f\u9884\u6d4b\u7684\u76ee\u7684\u5730\u5740\u3002\u8fd9\u4e2a\u5c31\u662f BOOM \u91cc\u9762\u7684 L0 BTB (1-cycle redirect)\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u5468\u671f\u5185\u5b8c\u6210\u7684\u5206\u652f\u9884\u6d4b\uff0c\u5b83\u7684\u9762\u79ef\u80af\u5b9a\u4e0d\u80fd\u5927\uff0c\u5426\u5219\u65f6\u5e8f\u65e0\u6cd5\u6ee1\u8db3\uff0c\u6240\u4ee5 BOOM \u91cc\u9762\u8fd8\u8bbe\u8ba1\u4e86 2-cycle \u548c 3-cycle \u7684\u6bd4\u8f83\u9ad8\u7ea7\u7684\u5206\u652f\u9884\u6d4b\u5668\uff0c\u8fd8\u6709\u9488\u5bf9\u51fd\u6570\u8c03\u7528\u7684 RAS\uff08Return Address Stack\uff09\u3002</p> <p>\u5206\u652f\u9884\u6d4b\u4e5f\u6709\u5f88\u591a\u65b9\u6cd5\u3002\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u5b9e\u73b0\u4e00\u4e2a BHT\uff0c\u6bcf\u4e2a\u9879\u662f\u4e00\u4e2a 2 \u4f4d\u7684\u9971\u548c\u8ba1\u6570\u5668\uff0c\u8d85\u8fc7\u4e00\u534a\u7684\u65f6\u5019\u589e\u52a0\uff0c\u5c11\u4e8e\u4e00\u534a\u65f6\u51cf\u5c11\u3002\u4f46\u662f\uff0c\u5982\u679c\u9047\u5230\u4e86\u8df3\u8f6c/\u4e0d\u8df3\u8f6c/\u8df3\u8f6c/\u4e0d\u8df3\u8f6c\u8fd9\u79cd\u6765\u56de\u5207\u6362\u7684\u60c5\u51b5\uff0c\u51c6\u786e\u7387\u5c31\u5f88\u4f4e\u3002\u4e00\u4e2a\u590d\u6742\u4e00\u4e9b\u7684\u8bbe\u8ba1\uff0c\u5c31\u662f\u7528 BHR\uff0c\u8bb0\u5f55\u8fd9\u4e2a\u5206\u652f\u6307\u4ee4\u6700\u8fd1\u51e0\u6b21\u7684\u5386\u53f2\uff0c\u5bf9\u4e8e\u6bcf\u79cd\u53ef\u80fd\u7684\u5386\u53f2\uff0c\u90fd\u5bf9\u5e94\u4e00\u4e2a 2 \u4f4d\u7684\u9971\u548c\u8ba1\u6570\u5668\u3002\u8fd9\u6837\uff0c\u9047\u5230\u521a\u624d\u6240\u8bf4\u7684\u60c5\u51b5\u5c31\u4f1a\u5f88\u597d\u5730\u9884\u6d4b\u3002\u4f46\u5b9e\u8df5\u4e2d\u4f1a\u9047\u5230\u95ee\u9898\uff1a\u5982\u679c\u5728\u5199\u56de\u4e4b\u524d\uff0c\u53c8\u8fdb\u884c\u4e86\u4e00\u6b21\u9884\u6d4b\uff0c\u56e0\u4e3a\u9884\u6d4b\u662f\u5728\u53d6\u6307\u7684\u65f6\u5019\u505a\u7684\uff0c\u4f46\u662f\u66f4\u65b0 BPU \u662f\u5728\u5199\u56de\u7684\u65f6\u5019\u5b8c\u6210\u7684\uff0c\u8fd9\u65f6\u5019\u9884\u6d4b\u5c31\u662f\u57fa\u4e8e\u65e7\u7684\u72b6\u6001\u8fdb\u884c\u9884\u6d4b\uff0c\u8fd9\u65f6\u5019 BHR \u5c31\u4f1a\u51fa\u73b0\u4e0d\u51c6\u786e\u7684\u95ee\u9898\uff1b\u800c\u4e14\u5199\u56de BPU \u7684\u65f6\u5019\uff0c\u4f1a\u6309\u7167\u539f\u6765\u7684\u72b6\u6001\u8fdb\u884c\u66f4\u65b0\uff0c\u8fd9\u4e2a\u72b6\u6001\u53ef\u80fd\u4e5f\u662f\u9519\u8bef\u7684\uff0c\u5bfc\u81f4\u4e22\u5931\u4e00\u6b21\u66f4\u65b0\uff0c\u8bc6\u522b\u7684\u6a21\u5f0f\u4ece\u8df3\u8f6c/\u4e0d\u8df3\u8f6c/\u8df3\u8f6c/\u4e0d\u8df3\u8f6c\u53d8\u6210\u4e86\u8df3\u8f6c/\u8df3\u8f6c/\u8df3\u8f6c/\u4e0d\u8df3\u8f6c\uff0c\u8fd9\u6837\u53c8\u4f1a\u9884\u6d4b\u9519\u8bef\u3002\u4e00\u4e2a\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u5728\u53d6\u6307\u9636\u6bb5\uff0cBPU \u9884\u6d4b\u5b8c\u5c31\u7acb\u5373\u6309\u7167\u9884\u6d4b\u7684\u7ed3\u679c\u66f4\u65b0 BHR\uff0c\u4e4b\u540e\u5199\u56de\u9636\u6bb5\u4f1a\u6062\u590d\u5230\u5b9e\u9645\u7684 BHR \u53d6\u503c\u3002\u8bba\u6587 The effect of speculatively updating branch history on branch prediction accuracy, revisited \u548c Speculative Updates of Local and Global Branch History: A Quantitative Analysis \u8ba8\u8bba\u4e86\u8fd9\u4e2a\u5b9e\u73b0\u65b9\u5f0f\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002</p> <p>\u6bd4\u8f83\u5bb9\u6613\u505a\u9884\u6d4b\u66f4\u65b0\u548c\u6062\u590d\u7684\u662f\u5168\u5c40\u5206\u652f\u5386\u53f2\uff0c\u53ef\u4ee5\u7ef4\u62a4\u4e24\u4e2a GHR\uff08Global History Register\uff09\uff0c\u4e00\u4e2a\u662f\u76ee\u524d\u53d6\u6307\u4ee4\u6700\u65b0\u7684\uff0c\u4e00\u4e2a\u662f\u63d0\u4ea4\u7684\u6700\u65b0\u7684\u3002\u5728\u9884\u6d4b\u7684\u65f6\u5019\uff0c\u7528 GHR \u53bb\u627e\u5bf9\u5e94\u7684 2-bit \u72b6\u6001\uff0c\u7136\u540e\u628a\u9884\u6d4b\u7ed3\u679c\u66f4\u65b0\u5230 GHR \u4e0a\u3002\u5728\u9884\u6d4b\u5931\u8d25\u7684\u65f6\u5019\uff0c\u628a GHR \u6062\u590d\u4e3a\u63d0\u4ea4\u7684\u72b6\u6001\u3002\u5982\u679c\u8981\u652f\u6301\u4e00\u4e2a Fetch Packet \u4e2d\u6709\u591a\u4e2a\u5206\u652f\uff0c\u53ef\u4ee5\u8ba9 GHR \u5bf9\u5e94\u82e5\u5e72\u4e2a 2-bit \u72b6\u6001\uff0c\u5206\u522b\u5bf9\u5e94\u76f8\u5e94\u4f4d\u7f6e\u4e0a\u7684\u5206\u652f\u7684\u72b6\u6001\uff0c\u5f53\u7136\u8fd9\u6837\u9762\u79ef\u4e5f\u4f1a\u589e\u52a0\u5f88\u591a\u3002</p> <p>\u9664\u4e86\u8bb0\u5f55\u6761\u4ef6\u5206\u652f\u7684\u8df3\u4e0e\u4e0d\u8df3\u4ee5\u5916\uff0c\u901a\u5e38\u8fd8\u53ef\u4ee5\u7ef4\u62a4 taken branch \u7684\u5730\u5740\uff0c\u8bb0\u5f55\u8fd9\u6837\u7684\u5206\u652f\u5386\u53f2\u7684 GHR \u5c31\u53eb\u505a PHR\uff08Path History Register\uff09\u3002</p> <p>\u76ee\u524d\u6bd4\u8f83\u4e3b\u6d41\u7684\u5206\u652f\u9884\u6d4b\u7b97\u6cd5\u5c31\u662f TAGE \u4e86\uff1a\u7ef4\u62a4\u591a\u4e2a\u8868\uff0c\u6bcf\u4e2a\u8868\u91c7\u53d6\u7684\u5386\u53f2\u957f\u5ea6\u4e0d\u540c\uff0c\u5448\u51e0\u4f55\u7ea7\u6570\uff0c\u4f7f\u5f97\u9700\u8981\u6bd4\u8f83\u77ed\u7684\u5386\u53f2\u5c31\u53ef\u4ee5\u9884\u6d4b\u7684\u5206\u652f\u53ef\u4ee5\u66f4\u5feb\u7684\u9884\u70ed\uff0c\u9700\u8981\u6bd4\u8f83\u957f\u7684\u5386\u53f2\u624d\u80fd\u9884\u6d4b\u7684\u5206\u652f\u4e5f\u53ef\u4ee5\u6709\u8f83\u597d\u7684\u51c6\u786e\u5ea6\u3002\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f TAGE \u7684\u8868\u9879\u5206\u914d\u548c\u66ff\u6362\u7684\u7b97\u6cd5\uff0cuseful counter \u548c altpred \u7684\u8bbe\u8ba1\uff0c\u4ee5\u53ca USE_ALT_ON_NA \u7684\u4f18\u5316\u3002\u4e3a\u4e86\u9884\u6d4b\u95f4\u63a5\u5206\u652f\uff0c\u53ef\u4ee5\u628a\u76ee\u7684\u5730\u5740\u653e\u5230 TAGE \u7684\u8868\u9879\u91cc\uff0c\u628a\u9884\u6d4b\u65b9\u5411\u53d8\u4e3a\u9884\u6d4b\u76ee\u7684\u5730\u5740\uff0c\u8fd9\u79cd\u9884\u6d4b\u95f4\u63a5\u5206\u652f\u7684 TAGE \u5c31\u53eb\u505a ITTAGE\u3002\u90e8\u5206\u5b9e\u73b0\u8fd8\u4f1a\u7ed9 TAGE \u6dfb\u52a0 Statistical Corrector \u6216\u8005 Loop Predictor\u3002\u8fd9\u4e9b\u7b97\u6cd5\u57fa\u672c\u7edf\u6cbb\u4e86\u5f53\u4eca\u9ad8\u6027\u80fd\u7684\u5904\u7406\u5668\u8bbe\u8ba1\u3002</p> <p>\u6211\u5728\u535a\u5ba2 \u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0 \u4e2d\u8be6\u7ec6\u5206\u6790\u4e86 Exynos \u5fae\u67b6\u6784\u7684\u524d\u7aef\u8bbe\u8ba1\uff0c\u5efa\u8bae\u611f\u5174\u8da3\u7684\u8bfb\u8005\u9605\u8bfb\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#short-forward-branch","title":"Short Forward Branch","text":"<p>\u8bba\u6587 SonicBOOM: The 3rd Generation Berkeley Out-of-Order Machine \u63d0\u5230\u4e86\u4e00\u4e2a\u6709\u610f\u601d\u7684\u4f18\u5316\uff1aShort Forward Branch\u3002\u5b83\u9762\u5bf9\u7684\u573a\u666f\u662f\u4e00\u4e9b\u5c0f\u7684 if \u8bed\u53e5\uff0c\u5728 if \u7684\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u6267\u884c\u5c11\u91cf\u7684\u6307\u4ee4\u3002\u6b63\u5e38\u6765\u8bf4\uff0c\u8fd9\u6837\u7684\u4ee3\u7801\u4f1a\u88ab\u7f16\u8bd1\u6210\u4e00\u4e2a Forward \u7684\u5206\u652f\uff0c\u88ab\u8df3\u8fc7\u7684\u5c31\u662f if \u6761\u4ef6\u6ee1\u8db3\u65f6\u8981\u6267\u884c\u7684\u4ee3\u7801\u5bf9\u5e94\u7684\u6307\u4ee4\u3002\u5982\u679c\u5206\u652f\u6bd4\u8f83\u597d\u9884\u6d4b\uff0c\u90a3\u73b0\u6709\u7684\u5206\u652f\u9884\u6d4b\u5668\u5c31\u53ef\u4ee5\u5f97\u5230\u5f88\u597d\u7684\u6027\u80fd\uff0c\u4f46\u5982\u679c\u5206\u652f\u4e0d\u597d\u9884\u6d4b\uff0c\u4f8b\u5982\u5b83\u4f1a\u4f9d\u8d56\u6570\u636e\u7684\u503c\uff0c\u5e76\u4e14\u5177\u6709\u4e00\u5b9a\u7684\u968f\u673a\u6027\uff0c\u8fd9\u65f6\u5019\u6027\u80fd\u5c31\u4f1a\u4e0b\u964d\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u6761\u4ef6\u6267\u884c\u6765\u4ee3\u66ff\u5206\u652f\uff1a\u628a\u5206\u652f\u6307\u4ee4\u66ff\u6362\u4e3a\u6bd4\u8f83\u6307\u4ee4\uff0c\u7136\u540e\u6839\u636e\u6bd4\u8f83\u7684\u7ed3\u679c\u6765\u6761\u4ef6\u6267\u884c\u672c\u6765\u53ef\u80fd\u4f1a\u88ab\u8df3\u8fc7\u7684\u6307\u4ee4\u3002\u4e0b\u9762\u662f\u8bba\u6587\u4e2d\u7ed9\u7684\u4f8b\u5b50\uff0c\u8bf4\u7684\u6bd4\u8f83\u7684\u6e05\u6670\uff1a</p> <p></p> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0c\u8fd9\u4e2a\u4f18\u5316\u662f\u5b8c\u5168\u7531\u786c\u4ef6\u6765\u505a\u7684\uff0c\u800c\u4e0d\u662f\u7f16\u8bd1\u5668\u3002\u5f53\u7136\u4e86\uff0c\u5982\u679c\u7f16\u8bd1\u5668\u8981\u505a\u7684\u524d\u63d0\u662f\u786c\u4ef6\u652f\u6301\u8fd9\u7c7b\u6807\u91cf\u7684\u6761\u4ef6\u6267\u884c\u6307\u4ee4\uff0c\u867d\u7136 Zicond \u6269\u5c55\u786e\u5b9e\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u7684\u529f\u80fd\uff0c\u5f88\u591a RISC-V \u5b9e\u73b0\u8fd8\u6ca1\u6709\u5b9e\u73b0 Zicond\u3002\u786c\u4ef6\u4e0a\u505a\u7684\u8bdd\uff0c\u5c31\u4e0d\u9700\u8981\u6269\u5c55\u6307\u4ee4\u96c6\uff0c\u76f4\u63a5\u5728\u524d\u7aef\u8fdb\u884c\u8bc6\u522b\uff0c\u5f53\u53d1\u73b0\u8fd9\u79cd Short Forward Branch \u65f6\uff0c\u628a\u5206\u652f\u6307\u4ee4\u672c\u8eab\u6539\u6210\u4e00\u6761 set-flag \u6307\u4ee4\uff0c\u7136\u540e\u628a\u5206\u652f\u5230\u8df3\u8f6c\u76ee\u7684\u5730\u8fd9\u4e00\u6bb5\u7684\u6307\u4ee4\u6539\u4e3a\u6761\u4ef6\u6267\u884c\u3002\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u5206\u652f\u9884\u6d4b\u4e86\uff0c\u65e0\u8bba\u539f\u6765\u7684\u5206\u652f\u662f\u5426\u8df3\u8f6c\uff0c\u540e\u7eed\u7684\u8fd9\u4e9b\u6307\u4ee4\u90fd\u4f1a\u8fdb\u5165\u6d41\u6c34\u7ebf\uff0c\u770b\u8d77\u6765\u505a\u4e86\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u4f46\u5f88\u591a\u65f6\u5019\u53cd\u800c\u6bd4\u9519\u8bef\u7684\u5206\u652f\u9884\u6d4b\u8fd8\u8981\u5feb\u3002</p> <p>\u8fd9\u4e2a\u4f18\u5316\u601d\u8def\u5728 Intel \u7684\u4e13\u5229 Converting conditional short forward branches to computationally equivalent predicated instructions \u4e5f\u6709\u9610\u8ff0\uff0c\u4e0d\u77e5\u9053\u8fd9\u4e2a\u4f18\u5316\u6709\u6ca1\u6709\u5b9e\u9645\u52a0\u5230 Intel \u7684\u5904\u7406\u5668\u5f53\u4e2d\u3002\u4e13\u5229\u7684\u56fe 6 \u5f88\u597d\u5730\u7528 X86 \u7684\u6307\u4ee4\u9610\u8ff0\u4e86\u8fd9\u4e2a\u4f18\u5316\uff1a</p> <p></p> <p>Intel \u5728 ISCA 2020 \u7684\u8bba\u6587 Auto-Predication of Critical Branches \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e9b\u786c\u4ef6\u7684\u5b9e\u73b0\u601d\u8def\uff0c\u8ba8\u8bba\u4e86\u600e\u6837\u53bb\u68c0\u6d4b\u8fd9\u6837\u7684\u5316\u5206\u652f\u6307\u4ee4\u4e3a\u6761\u4ef6\u6267\u884c\u6307\u4ee4\u7684\u60c5\u51b5\uff0c\u5982\u4f55\u5728\u786c\u4ef6\u4e2d\u5b9e\u73b0\u9ad8\u6548\u7684\u6761\u4ef6\u6267\u884c\uff0c\u600e\u4e48\u907f\u514d\u8d1f\u4f18\u5316\uff08\u4f8b\u5982\u53bb\u6389\u5206\u652f\u6307\u4ee4\u4ee5\u540e\uff0c\u5206\u652f\u9884\u6d4b\u5668\u773c\u91cc\u5c31\u4e22\u5931\u4e86\u5206\u652f\u7684\u5386\u53f2\uff1b\u8f6c\u5316\u4e3a\u6761\u4ef6\u6267\u884c\u4ee5\u540e\uff0c\u672c\u6765\u53ef\u80fd\u6ca1\u6709\u4f9d\u8d56\u7684\u6307\u4ee4\u4e5f\u53d8\u5f97\u5f3a\u5236\u6709\u4f9d\u8d56\u4e86\uff09\uff0c\u5efa\u8bae\u6709\u5174\u8da3\u7684\u8bfb\u8005\u9605\u8bfb\u3002</p> <p>\u90a3\u4e48\u8fd9\u6837\u7684\u6307\u4ee4\u5e8f\u5217\u5728\u5b9e\u9645\u7684\u7a0b\u5e8f\u91cc\u51fa\u73b0\u7684\u591a\u5417\uff1f\u8bba\u6587 The Effects of Predicated Execution on Branch Prediction \u5206\u6790\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u7ed3\u8bba\u662f\u8fd8\u771f\u4e0d\u5c11\u3002\u5f53\u7136\u4e86\uff0c\u8fd9\u7bc7\u8bba\u6587\u4e3b\u8981\u7684\u8bba\u70b9\u662f\uff0c\u6307\u4ee4\u96c6\u5e94\u8be5\u5f15\u5165\u5404\u79cd\u6761\u4ef6\u6267\u884c\u6307\u4ee4\uff0c\u8fd9\u6837\u7f16\u8bd1\u5668\u5c31\u53ef\u4ee5\u5229\u7528\u73b0\u6709\u5904\u7406\u5668\u7684\u6761\u4ef6\u6267\u884c\u6307\u4ee4\u6765\u4f18\u5316\uff0c\u6ca1\u6709\u53bb\u8ba8\u8bba\u7eaf\u786c\u4ef6\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002</p> <p>\u4ece SiFive \u63d0\u4ea4\u7ed9 GCC \u7684 patch \u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u7c7b\u4f3c\u7684\u4f18\u5316\u88ab\u5b9e\u88c5\u5230\u4e86 SiFive \u7684 CPU \u5f53\u4e2d\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u505a\u7684\u4f1a\u66f4\u52a0\u7b80\u5355\uff0c\u53ea\u8003\u8651\u4e86\u5206\u652f\u8df3\u8fc7\u4e00\u6761\u6307\u4ee4\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u4e5f\u6bd4\u8f83\u597d\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5728\u73b0\u6709\u7684\u6307\u4ee4\u878d\u5408\u673a\u5236\u7684\u57fa\u7840\u4e0a\uff0c\u628a\u4e24\u6761\u6307\u4ee4\u5408\u6210\u4e00\u6761\uff1a</p> <p>The SiFive 7 series cores have macro fusion support to convert a branch over a single instruction into a conditionally executed instruction.  This adds a conditional move pattern, enabled only for the SiFive 7 series cores, that implements the initial optimization support for this feature.  This gives us about a 10% increase in coremark scores for this core.</p> <p>SiFive \u7684\u4e13\u5229 Macro-op fusion \u4e5f\u63d0\u5230\u4e86\u5f88\u591a\u5728 RISC-V \u4e0a\u5b9e\u73b0\u7684\u6307\u4ee4\u878d\u5408\u7684\u4f18\u5316\uff0c\u4e0b\u9762\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>    bne x1, x0, target\n    add x3, x3, 1\ntarget:\n</code></pre> <p>\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1a</p> <pre><code>    ifeqz_addi x3, x3, x1, 1\n</code></pre> <p>\u8fd9\u5c31\u662f\u4e0a\u9762\u6240\u8bf4\u7684 SiFive \u5b9e\u73b0\u7684\u53ea\u8df3\u8fc7\u5355\u6761\u6307\u4ee4\u7684 Short Forward Branch\uff0c\u628a bne + add \u6307\u4ee4\u53d8\u6210\u4e86\u6761\u4ef6 add \u6307\u4ee4\uff0c\u5e76\u4e14\u81ea\u5e26\u548c 0 \u6bd4\u8f83\u7684\u903b\u8f91\uff1a\u5982\u679c x1 == 0\uff08ifeqz\uff0cif equals to zero\uff09\uff0c\u5c31\u8bbe\u7f6e x3 = x3 + 1\uff0c\u5426\u5219 x3 \u4fdd\u6301\u4e0d\u53d8\u3002\u7c7b\u4f3c\u5730\uff0c\u628a add \u6362\u6210 sub \u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u505a\u878d\u5408\uff0c\u751a\u81f3\u8fde\u51fd\u6570\u8c03\u7528 jal \u6307\u4ee4\u4e5f\u53ef\u4ee5\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u6709\u8da3\u7684\u6307\u4ee4\u878d\u5408\u573a\u666f\uff1a</p> <pre><code>    beq x8, x9, skip\n    j target\nskip:\n    // ...\ntarget:\n</code></pre> <p>\u53ef\u4ee5\u878d\u5408\u4e3a\uff1a</p> <pre><code>    jne x8, x9, target\n</code></pre> <p>\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\uff0c\u4e3a\u4ec0\u4e48\u7f16\u8bd1\u5668\u8981\u591a\u6b64\u4e00\u4e3e\uff0c\u4e0d\u76f4\u63a5\u751f\u6210\u4e00\u4e2a bne\uff1f\u7b54\u6848\u662f RISC-V \u7684 bne \u7684\u7acb\u5373\u6570\u8303\u56f4\u592a\u5c0f\uff0c\u8981\u60f3\u8df3\u5230\u66f4\u5927\u7684\u8303\u56f4\uff0c\u5c31\u9700\u8981\u7528 j \u6307\u4ee4\uff0c\u4e8e\u662f\u7f16\u8bd1\u5668\u53ea\u597d\u7528 beq + j \u7684\u7ec4\u5408\u6765\u5b9e\u73b0\u5927\u8303\u56f4\u7684 bne\u3002\u7136\u540e SiFive \u7684\u5904\u7406\u5668\u4f1a\u8bc6\u522b\u8fd9\u79cd\u6a21\u5f0f\uff0c\u628a\u5b83\u8f6c\u6362\u6210\u4e00\u6761 jne\uff1a\u6761\u4ef6\u5206\u652f\uff0c\u4f46\u53c8\u6709 j \u6307\u4ee4\u7684 imm \u8df3\u8f6c\u8303\u56f4\u3002\u8fd9\u4e5f\u633a\u6709\u610f\u601d\u7684\uff0c\u6307\u4ee4\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u4e0d\u597d\u505a\u592a\u591a\u7684 imm \u4f4d\u6570\uff0c\u7f16\u8bd1\u5668\u56e0\u6b64\u751f\u6210\u4e86\u66f4\u590d\u6742\u7684\u4ee3\u7801\uff0c\u786c\u4ef6\u518d\u7ffb\u8bd1\u56de\u6765\u3002</p> <p>\u82f9\u679c\u7533\u8bf7\u4e86 Using a Next Fetch Predictor Circuit with Short Branches and Return Fetch Groups \u4e13\u5229\uff0c\u5b83\u548c\u4e0a\u9762\u63d0\u5230\u7684\u4f18\u5316\u4e0d\u592a\u4e00\u6837\uff0c\u4f46\u662f\u6709\u4e9b\u7c7b\u4f3c\u3002\u4e13\u5229\u91cc\u63d0\u5230\u4e86\u8fd9\u4e48\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c Fetch Group \u5185\u6709\u4e00\u4e2a\u8981\u8df3\u8f6c\u7684\u5206\u652f\u6307\u4ee4\u4f1a Forward \u8df3\u8f6c\u5230\u540c\u4e00\u4e2a Fetch Group \u5185\u90e8\uff0c\u539f\u6765\u7684\u505a\u6cd5\u662f\u4ece\u5206\u652f\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u518d Fetch \u4e00\u6b21\uff0c\u4f46\u65e2\u7136\u662f\u540c\u4e00\u4e2a Fetch Group\uff0cFetch \u5206\u652f\u6307\u4ee4\u7684\u540c\u65f6\uff0c\u5df2\u7ecf\u628a\u4ece\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\u5f00\u59cb\u7684\u6307\u4ee4\u53d6\u8fdb\u6765\u4e86\uff0c\u8df3\u8fc7\u4e2d\u95f4\u7684\u6307\u4ee4\uff0c\u628a\u4e24\u6bb5\u6307\u4ee4\u62fc\u63a5\u8d77\u6765\uff0c\u53ef\u4ee5\u7701\u4e0b\u91cd\u65b0 Fetch \u4e00\u6b21\u7684\u65f6\u95f4\u3002</li> <li>\u5982\u679c Fetch Group \u5185\u6709\u4e00\u6761 call \u6307\u4ee4\uff0c\u5728\u539f\u6765\u7684\u505a\u6cd5\u91cc\uff0ccall \u6307\u4ee4\u4e4b\u540e\u7684\u6307\u4ee4\u5c31\u88ab\u4e22\u5f03\u4e86\uff0c\u7b49\u5230\u672a\u6765 return \u56de\u6765\u7684\u65f6\u5019\uff0c\u518d\u91cd\u65b0 Fetch \u4e00\u6b21\uff1b\u4e13\u5229\u91cc\u7684\u505a\u6cd5\u662f\uff0c\u5728 call \u7684\u65f6\u5019\uff0c\u628a call \u6307\u4ee4\u4e4b\u540e\u7684\u6307\u4ee4\u4fdd\u5b58\u4e0b\u6765\uff0c\u5f53\u672a\u6765 return \u56de\u6765\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u91cd\u65b0 Fetch\uff0c\u800c\u662f\u53d6\u51fa\u4fdd\u5b58\u4e0b\u6765\u7684 call \u6307\u4ee4\u4e4b\u540e\u7684\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u8282\u7701\u4e86\u91cd\u65b0 Fetch \u4e00\u6b21\u7684\u65f6\u95f4\u3002</li> </ul> <p>\u56e0\u6b64\u5b83\u7684\u76ee\u7684\u4e3b\u8981\u662f\u89e3\u51b3\u91cd\u590d Fetch \u7684\u80fd\u8017\u95ee\u9898\uff0c\u800c\u4e0d\u662f\u5206\u652f\u9884\u6d4b\u9519\u8bef\u7387\u9ad8\u7684\u95ee\u9898\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#clustered-decode","title":"Clustered Decode","text":"<p>\u63a8\u8350\u9605\u8bfb\uff1a\u89e3\u7801\u7c07\u4e8c\u4e09\u4e8b\uff08\u4e00\uff09\uff1a\u4e3a\u4ec0\u4e48\uff1f&amp;\u52a0\u6599\uff01</p> <p>Intel \u7684 E \u6838\u4ece Tremont \u5fae\u67b6\u6784\u5f00\u59cb\u5b9e\u73b0\u4e86 Clustered Decode\uff0c\u4ece Goldmont Plus \u5fae\u67b6\u6784\u7684\u4f20\u7edf\u7684 3-wide decode\uff0c\u53d8\u6210\u4e86\u4e24\u6761 3-wide decode \u7684\u6d41\u6c34\u7ebf\uff0c\u52a0\u8d77\u6765\u5b9e\u73b0 6-wide decode \u7684\u6548\u679c\u3002\u4f46\u662f\u8fd9\u4e24\u4e2a\u6d41\u6c34\u7ebf\u600e\u4e48\u534f\u540c\u5de5\u4f5c\u5462\uff1f</p> <p>Intel \u5728 Software Optimization Manual \u4e2d\u662f\u8fd9\u4e48\u63cf\u8ff0\u7684\uff1a</p> <p>Tremont microarchitecture has a 32B predict pipeline that feeds dual 3-wide decode clusters capable of 6 instruction decode per cycle. Each cluster can access a banked 32KB instruction cache at 16B/cycle for a maximum of 32B/cycle.</p> <p>ICache \u5206\u6210\u4e24\u4e2a bank\uff0c\u4e24\u4e2a bank \u53ef\u4ee5\u540c\u65f6\u8bbf\u95ee\uff0c\u6bcf\u4e2a bank \u63d0\u4f9b 16B/cycle \u7684\u5e26\u5bbd\uff0c\u5bf9\u5e94\u4e24\u4e2a decode pipeline\u3002\u7531\u4e8e\u4e0d\u540c\u7684 bank \u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u5730\u5740\u7684\u8bbf\u95ee\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u4e24\u6b21\u8bbf\u95ee\u53ef\u4ee5\u8bbf\u95ee\u4e0d\u540c cacheline \u5185\u7684\u6307\u4ee4\uff0c\u8fd9\u6b63\u597d\u5bf9\u5e94\u4e86\u6307\u4ee4\u6d41\u91cc\u6709\u8df3\u8f6c\u7684\u60c5\u51b5\uff1a</p> <p>\u5047\u5982\u6709\u4e00\u6bb5\u6307\u4ee4\uff08\u4e0b\u9762\u7684\u6307\u4ee4\u6d41 A\uff09\uff0c\u6700\u540e\u4e00\u6761\u6307\u4ee4\u4f1a\u8df3\u8f6c\u5230\u53e6\u4e00\u4e2a\u5730\u5740\uff08\u4e0b\u9762\u7684 1: label\uff09\uff0c\u5206\u652f\u9884\u6d4b\u5668\u5728\u770b\u5230\u8fd9\u4e2a\u6a21\u5f0f\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba9\u4e24\u4e2a decode cluster \u5206\u522b\u5904\u7406\u8df3\u8f6c\u524d\u7684\u4ee3\u7801\uff08\u6307\u4ee4\u6d41 A \u5185\u7684 <code>dec + jne</code>\uff09\u548c\u8df3\u8f6c\u540e\u7684\u4ee3\u7801\uff08\u6307\u4ee4\u6d41 B \u5185\u7684 <code>mov</code>\uff09\uff1a</p> <pre><code># instruction stream A\ndec %rsi\njne 1f\n\n# instruction stream B\n1:\nmov 0(%rsp), %rdi\n</code></pre> <p>\u8fd9\u6837\u5c31\u5728\u4fdd\u6301\u786c\u4ef6\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\u7684\u524d\u63d0\u4e0b\uff0c\u5b9e\u73b0\u4e86\u6bd4\u8f83\u5bbd\u7684 decode width\uff08Intel \u539f\u6587\uff1a<code>Whereas increasing decode width in a traditional fashion for x86 requires exponential resources and triggers efficiency loss, clustering allows for x86 decode to be built with linear resources and little efficiency loss.</code>\uff09\u3002\u8fd9\u5bf9\u4e8e x86 \u6765\u8bf4\u662f\u6bd4\u8f83\u96be\u63d0\u5347\u7684\uff0c\u56e0\u4e3a\u6307\u4ee4\u662f\u53d8\u957f\u7684\uff0c\u5982\u679c\u4e0d\u77e5\u9053\u6307\u4ee4\u4ece\u54ea\u91cc\u5f00\u59cb\uff0c\u8bd1\u7801\u5c06\u4f1a\u5341\u5206\u590d\u6742\u800c\u4e14\u4e32\u884c\u3002\u53ef\u4ee5\u770b\u5230 ARM \u9635\u8425\u7684\u9ad8\u6027\u80fd\u5904\u7406\u5668\u5728 decode width \u4e0a\u6709\u4e00\u5b9a\u7684\u9886\u5148\uff0c\u4e5f\u662f\u56e0\u4e3a ARMv8 \u662f\u5b9a\u957f\u6307\u4ee4\u96c6\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5047\u5982\u6ca1\u6709\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u600e\u4e48\u529e\uff1f\u5982\u679c\u9047\u5230\u4e00\u5927\u6bb5\u6ca1\u6709\u5206\u652f\u7684\u6307\u4ee4\uff0c\u4f3c\u4e4e\u5c31\u53ea\u80fd\u7528\u4e0a 3-wide decode\uff0c\u90a3\u4e48\u8fd9\u5f88\u5bb9\u6613\u6210\u4e3a\u4e00\u4e2a\u74f6\u9888\u3002Tremont \u6ca1\u6709\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5efa\u8bae\u7528\u6237\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u63d2\u5165\u4e00\u4e9b jmp \u6307\u4ee4\u3002</p> <p>Intel \u5728 Tremont \u7684\u4e0b\u4e00\u4ee3 Gracemont \u5fae\u67b6\u6784\u4e2d\u7f13\u89e3\u4e86\u8fd9\u4e2a\u74f6\u9888\u3002\u65e2\u7136\u63d2\u5165\u4e00\u4e9b jmp \u6307\u4ee4\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u7531\u786c\u4ef6\u81ea\u52a8\u63d2\u5165\u4e00\u4e9b\u4f2a jmp \u6307\u4ee4\uff0c\u4e5f\u89e3\u51b3\u4e86\u540c\u6837\u7684\u95ee\u9898\uff0c\u8fd9\u5c31\u662f Gracemont \u7684\u89e3\u51b3\u601d\u8def\uff1a</p> <p>Gracemont microarchitecture addresses this bottleneck by introducing a hardware load-balancer. When the hardware detects long basic blocks, additional toggle points can be created based on internal heuristics. These toggle points are added to the predictors, thus guiding the machine to toggle within the basic block.</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u786c\u4ef6\u4f1a\u68c0\u6d4b\u8fd9\u79cd\u957f\u7684\u8fde\u7eed\u6307\u4ee4\u5757\uff08\u4f8b\u5982\u8fde\u7eed 32 \u6761\u6307\u4ee4\u90fd\u6ca1\u6709\u4e00\u4e2a\u8df3\u8f6c\u7684\u6307\u4ee4\uff09\uff0c\u9002\u65f6\u63d2\u5165\u4e00\u4e9b toggle point\uff08\u4f8b\u5982\u63d2\u5230\u7b2c 24 \u6761\u6307\u4ee4\u540e\u9762\uff09\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u8bf4\u7684\u4f2a jmp \u6307\u4ee4\uff0c\u8fd9\u6761\u6307\u4ee4\u5e76\u4e0d\u5b58\u5728\uff0c\u800c\u662f\u5728\u5206\u652f\u9884\u6d4b\u5668\u4e2d\u505a\u6807\u8bb0\uff0c\u90a3\u4e48\u672a\u6765\u6267\u884c\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u4e0a\u4e24\u6761 Decode Pipeline \u4e86\uff1a</p> <p>If there are no natural toggle points (i.e., taken branches) within 32 uops, the hardware will insert a toggle point on the instruction after or corresponding to the 24th uop of the stream. As inserted toggle points consume resources in the predictor, it typically doesn't insert immediately but rather marks the location of the instruction in a table of addresses. If the same inserted toggle point is marked a second time, it allocates this location into the predictor.</p> <p>\u6b64\u5916\uff0c\u4e3a\u4e86\u89e3\u51b3\u53d8\u957f\u6307\u4ee4\u96c6\u7684\u8bd1\u7801\u95ee\u9898\uff0c\u8fd8\u6709\u4e00\u4e2a\u4f18\u5316\uff1a\u5728 ICache \u4e2d\u6807\u8bb0\u6bcf\u6761\u6307\u4ee4\u7684\u8fb9\u754c\uff0c\u8fd9\u6837\u8bd1\u7801\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u5bfb\u627e\u5230\u6307\u4ee4\u8fb9\u754c\uff0c\u4ece\u6307\u4ee4\u8fb9\u754c\u5e76\u884c\u5730\u8fdb\u884c\u8bd1\u7801\uff0c\u800c\u4e0d\u7528\u5148\u5224\u65ad\u7b2c\u4e00\u6761\u6307\u4ee4\u6709\u591a\u957f\uff0c\u518d\u627e\u5230\u7b2c\u4e8c\u6761\u6307\u4ee4\u5728\u54ea\uff0c\u518d\u5224\u65ad\u7b2c\u4e8c\u6761\u6307\u4ee4\u6709\u591a\u957f\uff0c\u518d\u53bb\u627e\u7b2c\u4e09\u6761\u6307\u4ee4\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u4fe1\u606f\u600e\u4e48\u6765\u5462\uff1f</p> <p>\u4e00\u79cd\u65b9\u6cd5\u662f\u5728 ICache \u4e2d\u8fdb\u884c\u9884\u8bd1\u7801\uff08Pre-decode\uff09\uff0c\u5f53 ICache \u5728 refill \u7684\u65f6\u5019\uff0c\u5c31\u8fdb\u884c\u4e00\u5b9a\u7684\u8bd1\u7801\uff0c\u628a\u6307\u4ee4\u8fb9\u754c\u6807\u8bb0\u51fa\u6765\u3002\u4f46 x86 \u7684\u6307\u4ee4\u4ece\u4e0d\u540c\u4f4d\u7f6e\u5f00\u59cb\u8bd1\u7801\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4e5f\u56e0\u4e3a\u8fd9\u4e00\u70b9 ROP \u653b\u51fb\u5728 x86 \u4e0a\u6bd4\u8f83\u5bb9\u6613\u5b9e\u73b0\u3002\u8fd9\u5bf9\u4e8e\u9884\u8bd1\u7801\u4e5f\u5e26\u6765\u4e86\u56f0\u96be\uff0c\u4e0d\u77e5\u9053\u4ece\u54ea\u4e2a\u5b57\u8282\u5f00\u59cb\u6267\u884c\u3002</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u7b49\u5230\u8bd1\u7801\u7684\u65f6\u5019\uff0c\u5148\u68c0\u67e5\u4e00\u4e0b\u6709\u6ca1\u6709\u6307\u4ee4\u8fb9\u754c\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e34\u65f6\u8017\u8d39\u4e24\u4e2a\u5468\u671f\u6765\u8fdb\u884c\u9884\u8bd1\u7801\u7684\u64cd\u4f5c\uff0c\u628a\u6307\u4ee4\u8fb9\u754c\u6807\u8bb0\u51fa\u6765\uff0c\u628a\u7ed3\u679c\u5199\u5165 ICache \u4e2d\u3002\u7531\u4e8e\u6b64\u65f6\u5df2\u7ecf\u4ece\u5206\u652f\u9884\u6d4b\u5668\u77e5\u9053\u4e86\u6307\u4ee4\u6267\u884c\u7684\u8d77\u59cb\u5730\u5740\uff0c\u6240\u4ee5\u5f97\u5230\u7684\u7ed3\u679c\u66f4\u52a0\u7cbe\u786e\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5728 Gracemont \u4e2d\u91c7\u7528\uff0c\u53eb\u505a On Demand Instruction Length Decoder\uff08OD-ILD\uff09\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u7684\u8bd1\u7801\u7ed3\u679c\u662f\u6307\u4ee4\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u5f97\u5230\u4e86\u6307\u4ee4\u7684\u8fb9\u754c\u4fe1\u606f\uff1a</p> <p>Instead of a second level predecode cache, the Gracemont microarchitecture introduces an \u201con-demand\u201d instruction length decoder (OD-ILD). This block is typically only active when new instruction bytes are brought into the instruction cache from a miss. When this happens, two extra cycles are added to the fetch pipeline in order to generate predecode bits on the fly.</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u5728 Intel \u7684\u4e13\u5229 Circuitry and methods for power efficient generation of length markers for a variable length instruction set \u6709\u6bd4\u8f83\u8be6\u7ec6\u7684\u63cf\u8ff0\u3002</p> <p>Intel \u5728 Skymont \u8fd9\u4e00\u4ee3 E-core \u5fae\u67b6\u6784\u5728\u5927\u5927\u62d3\u5bbd\u540e\u7aef\u7684\u540c\u65f6\uff0c\u628a Decode \u4ece\u4e24\u6761 3-wide pipeline \u6539\u6210\u4e86\u4e09\u6761 3-wide pipeline\uff0c\u90a3\u4e48\u600e\u4e48\u628a\u8fd9\u4e09\u6761 Decode pipeline \u5582\u6ee1\uff0c\u662f\u7ee7\u7eed\u5ef6\u7eed\u4e0a\u9762\u7684\u601d\u8def\uff0c\u53ea\u4e0d\u8fc7\u63d2\u5165\u66f4\u591a\u7684 toggle point\uff0c\u8fd8\u662f\u6709\u4e00\u4e9b\u65b0\u7684\u8bbe\u8ba1\uff0c\u8ba9\u6211\u4eec\u62ed\u76ee\u4ee5\u5f85\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#btb-organization","title":"BTB Organization","text":"<p>BTB \u7684\u76ee\u7684\u662f\u5728\u5206\u652f\u9884\u6d4b\u9636\u6bb5\uff0c\u63d0\u4f9b\u54ea\u4e9b\u6307\u4ee4\u662f\u5206\u652f\u6307\u4ee4\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u5206\u652f\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u7684\u4fe1\u606f\u3002\u90a3\u4e48 BTB \u662f\u600e\u4e48\u4fdd\u5b58\u8fd9\u4e9b\u4fe1\u606f\u7684\u5462\uff1f\u8bba\u6587 Branch Target Buffer Organizations \u603b\u7ed3\u4e86\u51e0\u79cd\u5e38\u89c1\u7684 BTB \u7ec4\u7ec7\u65b9\u6cd5\uff1a</p> <ol> <li>\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff1aI-BTB\uff0cInstruction BTB\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u53ef\u80fd\u51fa\u73b0\u5206\u652f\u6307\u4ee4\u7684\u5730\u5740\uff0c\u90fd\u8fdb\u884c\u4e00\u6b21 BTB \u67e5\u8be2\uff0c\u770b\u770b\u8fd9\u4e2a\u5730\u5740\u662f\u4e0d\u662f\u6709\u5206\u652f\u6307\u4ee4\u3002\u6b64\u65f6 BTB entry \u53ea\u9700\u8981\u8bb0\u5f55 tag\uff08\u7528\u4e8e\u7ec4\u76f8\u8fde\u7684 Way \u5339\u914d\uff09\u3001branch type \u548c branch target\u3002\u4ee5 ARMv8 \u4e3a\u4f8b\uff0c\u6307\u4ee4\u90fd\u662f 4 \u5b57\u8282\uff0c\u5047\u5982\u8981\u5bf9 32 \u5b57\u8282\u7684\u5757\u8fdb\u884c\u9884\u6d4b\uff0c\u90a3\u4e48\u5c31\u8981\u5bf9\u8fd9 32 \u5b57\u8282\u7684 8 \u4e2a 4 \u5b57\u8282\u90fd\u8fdb\u884c\u4e00\u6b21 BTB \u67e5\u8be2\uff0c\u5f97\u5230\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u5206\u652f\u4fe1\u606f\u3002x86 \u7684\u8bdd\u6bcf\u4e2a\u5b57\u8282\u90fd\u53ef\u80fd\u662f\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u7528\u8fd9\u6837\u7684\u65b9\u6cd5\u9700\u8981\u67e5\u8be2\u7684\u6b21\u6570\u8fc7\u591a\u3002</li> <li>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff1aR-BTB\uff0cRegion BTB\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5bf9\u9f50\u7684\u5757\uff0c\u8bb0\u5f55\u8fd9\u4e2a\u5757\u5185\u7684\u6709\u9650\u6761\u5206\u652f\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u5bf9\u6bcf\u4e2a\u5bf9\u9f50\u5230 32 \u5b57\u8282\u7684\u5757\uff0c\u8bb0\u5f55\u6700\u591a 4 \u6761\u5206\u652f\u3002\u6b64\u65f6 BTB entry \u9700\u8981\u8bb0\u5f55 tag\uff08\u7528\u4e8e\u7ec4\u76f8\u8fde\u7684 Way \u5339\u914d\uff09\u3001\u6bcf\u6761\u5206\u652f\u7684 offset\u3001\u7c7b\u578b \u548c target\u3002\u8fd9\u6837 BTB \u67e5\u8be2\u7684\u6b21\u6570\u4f1a\u6bd4\u8f83\u5c11\uff0c\u4f46\u5982\u679c\u4e00\u4e2a\u5757\u5185\u5206\u652f\u592a\u591a\uff0c\u4f1a\u51fa\u73b0\u5b58\u4e0d\u4e0b\u7684\u60c5\u51b5\u3002</li> <li>\u7b2c\u4e09\u79cd\u65b9\u6cd5\uff1aB-BTB\uff0cBlock BTB\uff0c\u8bb0\u5f55\u7684\u662f\u4ece\u67d0\u4e2a PC \u5f00\u59cb\u8fde\u7eed\u7684\u4e00\u6bb5\u6307\u4ee4\uff0c\u8fd9\u6bb5\u6307\u4ee4\u4e0d\u80fd\u6709\u591a\u4e8e n \u6761\u5206\u652f\uff0c\u5e76\u4e14\u4e0d\u80fd\u591a\u4e8e m \u6761\u6307\u4ee4\u6216 m \u4e2a\u5b57\u8282\u3002\u6b64\u65f6 BTB entry \u9700\u8981\u8bb0\u5f55 tag\uff08\u7528\u4e8e\u7ec4\u76f8\u8fde\u7684 Way \u5339\u914d\uff09\u3001\u6bcf\u6761\u5206\u652f\u7684 offset\u3001\u7c7b\u578b \u548c target\u3002\u8fd9\u79cd\u65b9\u6cd5\u5728\u5206\u652f\u5f88\u5bc6\u96c6\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u7528\u591a\u4e2a BTB entry \u4fdd\u5b58\u8fd9\u4e9b\u5206\u652f\u3002\u6b64\u5916\u4e5f\u6bd4\u8f83\u65b9\u4fbf\u505a 2 predictions/cycle\uff1a\u540c\u65f6\u9884\u6d4b\u4e24\u4e2a\u6761\u4ef6\u5206\u652f\uff0c\u5982\u679c\u7b2c\u4e00\u4e2a\u5206\u652f\u4e0d\u8df3\u8f6c\uff0c\u90a3\u5c31\u7528\u7b2c\u4e8c\u4e2a\u5206\u652f\u7684\u7ed3\u679c\u3002\u4f46\u540c\u4e00\u4e2a\u5206\u652f\u53ef\u80fd\u91cd\u590d\u4fdd\u5b58\u5728\u591a\u4e2a BTB entry \u4e2d\uff0c\u56e0\u4e3a\u5165\u53e3 PC \u53ef\u80fd\u4e0d\u540c\u3002</li> </ol> <p>\u4e0b\u9762\u770b\u4e00\u4e9b\u4f8b\u5b50\uff0c\u4f8b\u5982 AMD \u5728 Software Optimization Guide for AMD EPYC\u2122 7003 Processors \u4e2d\u6709\u5982\u4e0b\u8868\u8ff0\uff1a</p> <p>Each BTB entry includes information for branches and their targets. Each BTB entry can hold up to two branches if the last bytes of the branches reside in the same 64-byte aligned cache line and the first branch is a conditional branch.</p> <p>\u8fd9\u548c\u4e0a\u9762\u6240\u8bf4\u7684 B-BTB \u662f\u7c7b\u4f3c\u7684\uff0c\u5982\u679c\u4e24\u6761\u5206\u652f\u5728\u540c\u4e00\u4e2a 64B \u5bf9\u9f50\u7684 cacheline \u5185\uff0c\u5e76\u4e14\u7b2c\u4e00\u6761\u5206\u652f\u662f\u6761\u4ef6\u5206\u652f\uff0c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a BTB entry \u5185\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u4e00\u4e2a BTB entry \u53ef\u4ee5\u4fdd\u5b58 1 \u5230 2 \u6761\u5206\u652f\u3002</p> <p>\u9999\u5c71\u5357\u6e56\u5fae\u67b6\u6784\u4e5f\u91c7\u7528\u4e86\u7c7b\u4f3c\u7684B-BTB \u8bbe\u8ba1\uff0c\u4e0b\u9762\u662f\u9999\u5c71\u5fae\u67b6\u6784\u6587\u6863\u7684\u622a\u56fe\uff1a</p> <p></p> <p>\u5982\u679c\u7a0b\u5e8f\u91cc\u6709\u5f88\u591a\u7ecf\u5e38\u6216\u8005\u603b\u662f\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u90a3\u4e48\u4e0a\u9762\u8fd9\u79cd B-BTB \u8bbe\u8ba1\u5c31\u6709\u4e00\u4e9b\u6d6a\u8d39\uff0c\u56e0\u4e3a\u627e\u4e0d\u5230\u5f88\u591a\u6761\u4ef6\u5206\u652f + \u5206\u652f\u7684\u7ec4\u5408\uff0c\u5373\u4f7f\u627e\u5230\u4e86\uff0c\u5982\u679c\u6761\u4ef6\u5206\u652f\u603b\u662f\u8df3\u8f6c\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6761\u5206\u652f\u5c31\u6d6a\u8d39\u4e86\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cAMD \u5728 Software Optimization Guide for the AMD Zen4 Microarchitecture \u4e2d\u63d0\u5230\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>Each BTB entry can hold up to two branches, and two pair cases are supported: \u2022 A conditional branch followed by another branch with both branches having their last byte in the same 64 byte aligned cacheline. \u2022 A direct branch (excluding CALLs) followed by a branch ending within the 64 byte aligned cacheline containing the target of the first branch. Predicting with BTB pairs allows two fetches to be predicted in one prediction cycle.</p> <p>\u53ef\u4ee5\u770b\u5230\u7b2c\u4e00\u79cd\u60c5\u51b5\u5c31\u662f\u524d\u9762 Zen 3 \u7684\u6a21\u5f0f\uff0c\u4e00\u4e2a cacheline \u5185\uff0c\u6761\u4ef6\u5206\u652f + \u5206\u652f\uff1b\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5c31\u662f\u65b0\u7684\u8bbe\u8ba1\uff0c\u5b83\u53ef\u4ee5\u8bb0\u5f55\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u7b2c\u4e8c\u6761\u5206\u652f\u6307\u4ee4\u548c\u7b2c\u4e00\u6761\u5206\u652f\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u5728\u540c\u4e00\u4e2a cacheline \u4e2d\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a BTB \u8bb0\u5f55\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u7b2c\u4e00\u6761\u8df3\u5230\u7b2c\u4e8c\u6761\uff0c\u7b2c\u4e8c\u6761\u518d\u8df3\u8f6c\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4e00\u4e2a\u5468\u671f\u7ed9\u51fa\u4e24\u4e2a Fetch Bundle\uff0c\u4e5f\u5c31\u662f 2 taken predictions/cycle\u3002\u8bba\u6587\u4e2d\u8fd9\u79cd\u8bbe\u8ba1\u53eb\u505a MB-BTB\u3002</p> <p>\u63a8\u8350\u9605\u8bfb\uff1a\u73b0\u4ee3\u5206\u652f\u9884\u6d4b\uff1a\u4ece\u5b66\u672f\u754c\u5230\u5de5\u4e1a\u754c</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#instruction-prefetcher","title":"Instruction Prefetcher","text":"<p>\u968f\u7740\u7a0b\u5e8f\u7684\u6307\u4ee4 footprint \u589e\u5927\uff0c\u9664\u4e86\u589e\u5927 L1 ICache \u5bb9\u91cf\uff0c\u4e5f\u9700\u8981\u5b9e\u73b0\u5408\u7406\u7684 Instruction Prefetcher\uff0c\u628a\u6307\u4ee4\u9884\u53d6\u5230 L1 ICache \u5f53\u4e2d\u3002\u5bf9\u4e8e Decoupled Frontend\uff0c\u76ee\u524d\u6bd4\u8f83\u5e38\u89c1\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 Fetch Directed Intruction Prefetching(FDIP)\uff0c\u5229\u7528 Decoupled Frontend \u91cc\u5206\u652f\u9884\u6d4b\u53ef\u4ee5\u5728\u53d6\u6307\u4e4b\u524d\u8dd1\u5f97\u66f4\u8fdc\u7684\u7279\u6027\uff0c\u4f7f\u7528\u5206\u652f\u9884\u6d4b\u7684\u5730\u5740\u6765\u8fdb\u884c\u9884\u53d6\u3002\u5177\u4f53\u5730\uff0cDecoupled Frontend \u4f1a\u628a\u5206\u652f\u9884\u6d4b\u5f97\u5230\u7684\u5730\u5740\u5199\u5165 Fetch Target Queue(FTQ)\uff0c\u8fd9\u4e9b\u5730\u5740\u7531 ICache \u6765\u6d88\u8d39\u3002\u4e0e\u6b64\u540c\u65f6\uff0cFTQ \u4e2d\u7684\u5730\u5740\u4e5f\u4f1a\u7528\u4e8e\u6307\u4ee4\u9884\u53d6\uff0c\u7ed3\u6784\u5982\u8bba\u6587\u4e2d\u7684\u56fe 1\uff1a</p> <p></p> <p>\u5bf9\u4e8e Coupled Frontend\uff0c\u9884\u6d4b\u548c\u53d6\u6307\u7d27\u5bc6\u76f8\u8fde\uff0cFDIP \u7684\u65b9\u6cd5\u5c31\u4e0d\u597d\u7528\u4e86\uff0c\u9700\u8981\u5bfb\u627e\u5176\u4ed6\u7684\u65b9\u6cd5\u3002</p> <p>\u4e00\u79cd\u65b9\u6cd5\u662f Call Graph Prefetching(CGP)\uff0c\u6765\u81ea\u8bba\u6587 Call graph prefetching for database applications\u3002\u4ece\u540d\u5b57\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5b83\u9488\u5bf9\u7684\u662f\u6570\u636e\u5e93\u573a\u666f\uff0c\u800c\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u4ee3\u7801\u7684\u89c4\u6a21\u5f88\u5927\uff0c\u66f4\u52a0\u5bb9\u6613\u51fa\u73b0 ICache Miss\u3002</p> <p>\u5b83\u7684\u6838\u5fc3\u601d\u8def\u662f\uff0c\u7ef4\u62a4\u4e00\u4e2a Call Graph History Cache(CGHC) \u6765\u8bb0\u5f55\u7a0b\u5e8f\u6267\u884c\u7684\u8c03\u7528\u56fe\uff0c\u6839\u636e\u5386\u53f2\u4fe1\u606f\u6765\u9884\u53d6\u672a\u6765\u53ef\u80fd\u4f1a\u6267\u884c\u7684\u51fd\u6570\u7684\u6307\u4ee4\uff0c\u8fd9\u9488\u5bf9\u7684\u662f\u9891\u7e41\u7684\u51fd\u6570\u8c03\u7528\uff1b\u9488\u5bf9\u51fd\u6570\u4f53\u6bd4\u8f83\u5927\u7684\u60c5\u51b5\uff0c\u51fd\u6570\u8c03\u7528\u7684\u6bd4\u4f8b\u6bd4\u8f83\u5c0f\uff0c\u5229\u7528 Next N-Line Prefetching\uff0c\u4e5f\u5c31\u662f\u5728 miss \u7684\u65f6\u5019\u628a\u8fde\u7eed\u7684\u51e0\u6761\u7f13\u5b58\u884c\u9884\u53d6\u8fdb\u6765\u3002</p> <p>\u90a3\u4e48\u8fd9\u4e2a Call Graph History Cache \u662f\u600e\u4e48\u7ef4\u62a4\u51fd\u6570\u8c03\u7528\u7684\u5462\uff1f\u5b83\u8bb0\u5f55\u4e86\u4e24\u4e2a Array\uff1aTag Array \u548c Data Array\u3002Tag Array \u8bb0\u5f55\u7684\u662f\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\uff0c\u4ee5\u53ca\u5728\u8fd9\u4e2a\u51fd\u6570\u5185\u6267\u884c\u5230\u4e86\u7b2c\u51e0\u4e2a\u51fd\u6570\uff08Index\uff09\uff1bData Array \u5219\u8bb0\u5f55\u4e86\u88ab\u8be5\u51fd\u6570\u8c03\u7528\u7684\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\uff0c\u6700\u591a\u516b\u4e2a\u3002\u4f8b\u5982\u51fd\u6570 A \u4f1a\u8c03\u7528\u51fd\u6570 B \u548c C\uff0c\u90a3\u4e48 CGHC \u4f1a\u4fdd\u5b58\u8fd9\u4e48\u4e00\u6761\u8bb0\u5f55\uff1a</p> <ul> <li>Tag Array\uff1a\u8bb0\u5f55\u51fd\u6570 A \u7684\u5165\u53e3\u5730\u5740\u4ee5\u53ca Index\uff0cIndex \u521d\u59cb\u5316\u4e3a 1</li> <li>Data Array\uff1a\u8bb0\u5f55\u51fd\u6570 B \u548c C \u7684\u5730\u5740</li> </ul> <p>\u5f53\u524d\u7aef\u901a\u8fc7\u5206\u652f\u9884\u6d4b\uff0c\u9884\u6d4b\u5230\u8981\u6267\u884c\u51fd\u6570 A\uff0c\u90a3\u4e48\u5c31\u901a\u8fc7 A \u7684\u5730\u5740\u53bb\u67e5\u8be2 Tag Array\uff0c\u627e\u5230\u5339\u914d\uff0c\u5e76\u4e14\u53d1\u73b0\u5176 Index \u7b49\u4e8e 1\uff1b\u90a3\u4e48\u63a5\u7740\u7528 Index \u8bbf\u95ee Data Array\uff0c\u53d6\u51fa\u7b2c\u4e00\u4e2a\u51fd\u6570\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f B\uff0c\u90a3\u5c31\u9884\u53d6 B\u3002\u5f53\u51fd\u6570 B \u88ab\u8c03\u7528\u7684\u65f6\u5019\uff0c\u66f4\u65b0 Index \u4e3a 2\uff0c\u8868\u793a\u51fd\u6570 B \u5df2\u7ecf\u88ab\u8c03\u7528\uff0c\u4e0b\u4e00\u4e2a\u8981\u88ab\u8c03\u7528\u7684\u662f C\u3002\u5f53\u51fd\u6570 B \u8fd4\u56de\u7684\u65f6\u5019\uff0c\u7528 Index \u8bbf\u95ee Data Array\uff0c\u5f97\u5230\u51fd\u6570 C \u7684\u5730\u5740\uff0c\u9884\u53d6 C\u3002\u5982\u679c\u8bf4 Call Graph \u662f\u4e2a\u56fe\uff0c\u90a3\u4e48 Tag Array \u548c Data Array \u5c31\u7ec4\u6210\u4e86\u90bb\u63a5\u8868\u3002</p> <p>\u82f9\u679c\u7684\u4e13\u5229 Callgraph Signature Prefetch \u4f7f\u7528\u4e86\u7c7b\u4f3c\u7684\u601d\u60f3\uff0c\u4e0d\u8fc7\u5728\u7ef4\u62a4 Call Graph \u7684\u65b9\u5f0f\u4e0a\u4e0d\u540c\uff1a\u4e0a\u9762\u7684\u8bba\u6587\u662f\u901a\u8fc7\u663e\u5f0f\u7684\u65b9\u6cd5\u8bb0\u5f55 Call Graph\uff0c\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u4e86\u54ea\u4e9b\u51fd\u6570\uff0c\u800c\u4e13\u5229\u4e2d\uff0c\u53c2\u8003\u4e86\u5206\u652f\u9884\u6d4b\u8bb0\u5f55\u5206\u652f\u5386\u53f2\u7684\u65b9\u6cd5\uff0c\u628a\u6700\u8fd1\u7684 call \u548c return \u5730\u5740\u538b\u7f29\u8bb0\u5f55\u4e0b\u6765\uff0c\u901a\u8fc7 hash \u5f97\u5230 Signature\uff0c\u518d\u7528 Signature \u53bb\u67e5\u8be2 Prefetch Table\uff0c\u76f8\u5f53\u4e8e\u5728\u62ff\u6700\u8fd1\u82e5\u5e72\u6b21\u8c03\u7528\u548c\u8fd4\u56de\u7684\u5386\u53f2\u6765\u9884\u6d4b\u4e0b\u4e00\u6b21 call \u7684\u5730\u5740\u3002Prefetch Table \u7684\u6bcf\u4e2a Entry \u8bb0\u5f55\u4e86\u8fd9\u4e9b\u4fe1\u606f\uff1a</p> <ul> <li>Signature\uff1a\u8bb0\u5f55\u4e86\u8fd9\u4e2a Entry \u5bf9\u5e94\u7684 Signature\uff0c\u5373\u6700\u8fd1\u51fd\u6570\u8c03\u7528\u7684\u538b\u7f29\u8868\u793a\uff1b\u5b9e\u9645\u53ef\u80fd\u5b9e\u73b0\u4e3a\u5168\u76f8\u8fde\uff0c\u4e5f\u53ef\u80fd\u662f\u7ec4\u76f8\u8fde\uff0c\u901a\u8fc7 tag \u5339\u914d</li> <li>Address\uff1a\u8981\u9884\u53d6\u7684\u6307\u4ee4\u5730\u5740\uff1b\u4e13\u5229\u4e2d\u8fd8\u8c08\u5230\u4e86 Address \u7684\u538b\u7f29\uff0c\u5373\u628a Address \u7684\u9ad8\u4f4d\u5355\u72ec\u5b58\u653e\u5728\u4e00\u4e2a Address Table \u4e2d\uff0c\u90a3\u4e48 Prefetch Table \u7684 Entry \u8bb0\u5f55\u4e86 Address Table \u7684 Index \u4ee5\u53ca\u4f4e\u4f4d Offset\uff0c\u9700\u8981\u9884\u53d6\u65f6\uff0c\u518d\u4ece Address Table \u8bfb\u53d6\u9ad8\u4f4d\uff0c\u62fc\u63a5\u8d77\u6765</li> <li>Counter\uff1a\u7ed9\u4ece Address \u5f00\u59cb\u7684\u82e5\u5e72\u4e2a\u7f13\u5b58\u884c\u7ef4\u62a4 Saturating Counter\uff0c\u7528\u6765\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u9884\u53d6</li> <li>Order\uff1a\u7528\u6765\u7ef4\u62a4 Replacement Policy \u6240\u9700\u8981\u7684\u4fe1\u606f</li> </ul> <p>\u90a3\u4e48\u524d\u7aef\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\uff0c\u6839\u636e\u5206\u652f\u9884\u6d4b\u53bb\u66f4\u65b0 Signature\uff0c\u6839\u636e Signature \u67e5\u8be2 Prefetch Table\uff0c\u5982\u679c\u6709\u547d\u4e2d\uff0c\u6839\u636e Counter \u7684\u5927\u5c0f\u51b3\u5b9a\u662f\u5426\u8981\u9884\u53d6\uff0c\u4ece Address \u5f00\u59cb\u9884\u53d6\u54ea\u4e9b\u6570\u636e\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2024/09/12/brief-into-ooo-3/#championship-branch-prediction","title":"Championship Branch Prediction","text":"<p>\u9488\u5bf9\u5206\u652f\u65b9\u5411\u9884\u6d4b\uff0c\u66fe\u7ecf\u529e\u8fc7 5 \u5c4a\u7684 Championship Branch Prediction \u7ade\u8d5b\uff0c\u6700\u540e\u4e00\u6b21\u662f 2016 \u5e74\u7684 CBP-5\uff0c\u7f51\u7ad9\u662f Championship Branch Prediction (CBP-5)\u3002\u5176\u6587\u4ef6\u53ef\u4ee5\u4ece\u4e0b\u5217\u5730\u5740\u5f97\u5230\uff1a</p> <ul> <li>https://web.archive.org/web/20220814115014/http://hpca23.cse.tamu.edu/cbp2016/cbp2016.final.tar.gz</li> <li>https://web.archive.org/web/20190907061905/http://hpca23.cse.tamu.edu/cbp2016/MD5SUM.txt</li> <li>https://drive.google.com/drive/folders/1VAdmqdOEFLvnRKkQQidxvGJA_C6S2RWo \u6765\u81ea https://github.com/craymichael/CBP-16-Simulation</li> </ul> <p>\u540e\u7eed\u8fd8\u6709\u4e00\u4e9b\u8bba\u6587\u4e5f\u662f\u5728 CBP2016 \u7684\u73af\u5883\u4e0b\u8fdb\u884c\u7684\u6d4b\u8bd5\u3002</p>","tags":["ooo","cpu","bp","prediction","frontend","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/","title":"\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u65e9\u5b66\u4e60\u4e71\u5e8f\u6267\u884c CPU \u7684\u65f6\u5019\uff0c\u662f\u5728 Wikipedia \u4e0a\u81ea\u5b66\u7684\uff0c\u540e\u6765\u5728\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u8bfe\u4e0a\u53c8\u5b66\u4e86\u4e00\u904d\uff0c\u4f46\u53d1\u73b0\u5b66\u7684\u548c\u73b0\u5728\u5b9e\u9645\u91c7\u7528\u7684\u4e71\u5e8f\u6267\u884c CPU \u53c8\u6709\u5f88\u5927\u533a\u522b\uff0c\u540e\u6765\u53c8\u4ed4\u7ec6\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u89c9\u5f97\u7406\u89e3\u66f4\u591a\u4e86\uff0c\u5c31\u60f3\u603b\u7ed3\u4e00\u4e0b\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u8ba8\u8bba\u4e71\u5e8f\u6267\u884c\u7684\u90e8\u5206\u3002</p> <p>\u672c\u7cfb\u5217\u7684\u6240\u6709\u6587\u7ae0\uff1a</p> <ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> </ul>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#\u7ecf\u5178-tomasulo","title":"\u7ecf\u5178 Tomasulo","text":"<p>\u53c2\u8003 Stanford \u6559\u6750</p> <p>\u7ecf\u5178 Tomasulo\uff0c\u4e5f\u662f Wikipedia \u4e0a\u63cf\u8ff0\u7684 Tomasulo \u7b97\u6cd5\uff0c\u5b83\u7684\u6838\u5fc3\u662f\u4fdd\u7559\u7ad9\u3002\u6307\u4ee4\u5728 Decode \u4e4b\u540e\uff0c\u4f1a\u88ab\u5206\u914d\u5230\u4e00\u4e2a\u4fdd\u7559\u7ad9\u4e2d\u3002\u4fdd\u7559\u7ad9\u6709\u4ee5\u4e0b\u7684\u8fd9\u4e9b\u5c5e\u6027\uff1a</p> <ol> <li>Op\uff1a\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c</li> <li>Qj\uff0cQk\uff1a\u64cd\u4f5c\u6570\u4f9d\u8d56\u7684\u6307\u4ee4\u76ee\u524d\u6240\u5728\u7684\u4fdd\u7559\u7ad9 ID</li> <li>Vj\uff0cQk\uff1a\u64cd\u4f5c\u6570\u7684\u503c</li> <li>Rj\uff0cRk\uff1a\u64cd\u4f5c\u6570\u662f\u5426 ready\uff08\u6216\u8005\u7528\u7279\u6b8a\u7684 Qj\uff0cQk \u503c\u8868\u793a\u662f\u5426 ready\uff09</li> <li>Busy\uff1a\u8fd9\u4e2a\u4fdd\u7559\u7ad9\u88ab\u5360\u7528</li> </ol> <p>\u6b64\u5916\u8fd8\u6709\u4e00\u4e2a mapping\uff08Wikipedia \u4e0a\u53eb\u505a RegisterStat\uff09\uff0c\u8bb0\u5f55\u4e86\u5bc4\u5b58\u5668\u662f\u5426\u4f1a\u88ab\u67d0\u4e2a\u4fdd\u7559\u7ad9\u4e2d\u7684\u6307\u4ee4\u5199\u5165\u3002</p> <p>\u6307\u4ee4\u5206\u914d\u5230\u4fdd\u7559\u7ad9\u7684\u65f6\u5019\uff0c\u4f1a\u67e5\u8be2 RegisterStat\uff0c\u5f97\u77e5\u64cd\u4f5c\u6570\u5bc4\u5b58\u5668\u662f\u5426 ready\uff0c\u5982\u679c\u4e0d ready\uff0c\u8bf4\u660e\u6709\u4e00\u4e2a\u5148\u524d\u7684\u6307\u4ee4\u8981\u5199\u5165\u8fd9\u4e2a\u5bc4\u5b58\u5668\uff0c\u90a3\u5c31\u8bb0\u5f55\u4e0b\u5bf9\u5e94\u7684\u4fdd\u7559\u7ad9 ID\u3002\u5f53\u64cd\u4f5c\u6570\u90fd ready \u4e86\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u8ba1\u7b97\u5355\u5143\u8ba1\u7b97\u3002\u5f53\u4e00\u6761\u6307\u4ee4\u5728\u6267\u884c\u5355\u5143\u4e2d\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u672a\u51fa\u73b0 WAW \u65f6\u4f1a\u628a\u7ed3\u679c\u5199\u5165\u5bc4\u5b58\u5668\u5806\uff0c\u5e76\u4e14\u901a\u8fc7 Common Data Bus \u8fdb\u884c\u5e7f\u64ad\uff0c\u76ee\u524d\u5728\u4fdd\u7559\u7ad9\u4e2d\u7684\u6307\u4ee4\u5982\u679c\u53d1\u73b0\uff0c\u5b83\u6240\u9700\u8981\u7684\u64cd\u4f5c\u6570\u521a\u597d\u8ba1\u7b97\u51fa\u6765\u4e86\uff0c\u5c31\u4f1a\u628a\u53d6\u503c\u4fdd\u5b58\u4e0b\u6765\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u4e9b\u7ec6\u8282\uff1a\u56e0\u4e3a\u4fdd\u7559\u7ad9\u4e2d\u7684\u6307\u4ee4\u53ef\u80fd\u8981\u7b49\u5f85\u5176\u4ed6\u6307\u4ee4\u7684\u5b8c\u6210\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8ba1\u7b97\u5355\u5143\u5229\u7528\u7387\u66f4\u9ad8\uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a\u8ba1\u7b97\u7c7b\u578b\uff08\u6bd4\u5982 ALU\uff09\uff0c\u9700\u8981\u6709\u82e5\u5e72\u4e2a\u540c\u7c7b\u7684\u4fdd\u7559\u7ad9\uff08\u6bd4\u5982 Add1\uff0cAdd2\uff0cAdd3\uff09\u3002\u5728 Wikipedia \u7684\u8868\u8ff0\u4e2d\uff0c\u6bcf\u4e2a\u4fdd\u7559\u7ad9\u5bf9\u5e94\u4e86\u4e00\u4e2a\u8ba1\u7b97\u5355\u5143\uff0c\u8fd9\u6837\u6027\u80fd\u6bd4\u8f83\u597d\uff0c\u4f46\u81ea\u7136\u9762\u79ef\u4e5f\u5c31\u66f4\u5927\u3002\u5982\u679c\u8282\u7701\u9762\u79ef\uff0c\u4e5f\u53ef\u4ee5\u51cf\u5c11\u8ba1\u7b97\u5355\u5143\u7684\u6570\u91cf\uff0c\u7136\u540e\u6bcf\u4e2a\u8ba1\u7b97\u5355\u5143\u4ece\u591a\u4e2a\u4fdd\u7559\u7ad9\u4e2d\u83b7\u53d6\u8ba1\u7b97\u7684\u6307\u4ee4\u3002</p> <p>\u53ef\u4ee5\u601d\u8003\u4e00\u4e0b\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7684\u74f6\u9888\u5728\u4ec0\u4e48\u5730\u65b9\u3002\u9996\u5148\uff0c\u6bcf\u6761\u6307\u4ee4\u90fd\u653e\u5728\u4e00\u4e2a\u4fdd\u7559\u7ad9\u4e2d\uff0c\u5f53\u4fdd\u7559\u7ad9\u6ee1\u7684\u65f6\u5019\u5c31\u4e0d\u80fd\u53d1\u5c04\u65b0\u7684\u6307\u4ee4\u3002\u5176\u6b21\uff0c\u5982\u679c\u8ba1\u7b97\u5355\u5143\u7684\u541e\u5410\u8ddf\u4e0d\u4e0a\u4fdd\u7559\u7ad9\u7684\u586b\u5145\u901f\u5ea6\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u963b\u585e\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u7684\u4e00\u4e2a\u6bd4\u8f83\u9ebb\u70e6\u7684\u70b9\u5728\u4e8e\u96be\u4ee5\u5b9e\u73b0\u7cbe\u786e\u5f02\u5e38\u3002\u7cbe\u786e\u5f02\u5e38\u7684\u5173\u952e\u5728\u4e8e\uff0c\u5f02\u5e38\u4e4b\u524d\u7684\u6307\u4ee4\u90fd\u751f\u6548\uff0c\u5f02\u5e38\u548c\u5f02\u5e38\u4e4b\u540e\u7684\u6307\u4ee4\u4e0d\u751f\u6548\uff0c\u4f46\u8fd9\u79cd\u65b9\u6cd5\u65e0\u6cd5\u8fdb\u884c\u533a\u5206\u3002</p> <p>\u4ece\u5bc4\u5b58\u5668\u91cd\u547d\u540d\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u79cd\u65b9\u6cd5\u5c5e\u4e8e Implicit Register Renaming\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a Register \u91cd\u547d\u540d\u4e3a\u4fdd\u7559\u7ad9\u7684 ID\u3002</p> <p>\u518d\u5206\u6790\u4e00\u4e0b\u5bc4\u5b58\u5668\u5806\u9700\u8981\u54ea\u4e9b\u8bfb\u5199\u53e3\u3002\u6709\u4e00\u6761\u89c4\u5f8b\u662f\uff0c\u5bc4\u5b58\u5668\u5806\u7684\u9762\u79ef\u4e0e\u8bfb\u5199\u53e3\u4e2a\u6570\u7684\u5e73\u65b9\u6210\u6b63\u6bd4\u3002\u5bf9\u4e8e\u6bcf\u6761\u53d1\u5c04\u7684\u6307\u4ee4\uff0c\u90fd\u9700\u8981\u4ece\u5bc4\u5b58\u5668\u5806\u8bfb\u64cd\u4f5c\u6570\uff0c\u6240\u4ee5\u8bfb\u53e3\u662f\u64cd\u4f5c\u6570 x \u6307\u4ee4\u53d1\u5c04\u6570\u3002\u5f53\u6267\u884c\u5355\u5143\u5b8c\u6210\u8ba1\u7b97\u7684\u65f6\u5019\uff0c\u9700\u8981\u5199\u5165\u5bc4\u5b58\u5668\u5806\uff0c\u6240\u4ee5\u6bcf\u4e2a\u6267\u884c\u5355\u5143\u90fd\u5bf9\u5e94\u4e00\u4e2a\u5bc4\u5b58\u5668\u5806\u7684\u5199\u53e3\u3002</p> <p>\u786c\u4ef6\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u6027\u80fd\uff0c\u5e0c\u671b\u4fdd\u7559\u7ad9\u53ef\u4ee5\u505a\u7684\u6bd4\u8f83\u591a\uff0c\u8fd9\u6837\u53ef\u4ee5\u5bb9\u7eb3\u66f4\u591a\u7684\u6307\u4ee4\u3002\u4f46\u662f\uff0c\u4fdd\u7559\u7ad9\u91cc\u9762\u81f3\u5c11\u8981\u4fdd\u5b58\u64cd\u4f5c\u6570\u7684\u503c\uff0c\u4f1a\u6bd4\u8f83\u5360\u7528\u9762\u79ef\uff0c\u5e76\u4e14\u65f6\u5ef6\u4e5f\u6bd4\u8f83\u5927\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#rob-reorder-buffer","title":"ROB (ReOrder Buffer)","text":"<p>\u53c2\u8003\u6559\u6750</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u7cbe\u786e\u5f02\u5e38\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165 ROB\u3002\u5728\u4e0a\u9762\u7684 Tomasulo \u7b97\u6cd5\u4e2d\uff0c\u8ba1\u7b97\u5355\u5143\u8ba1\u7b97\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u628a\u7ed3\u679c\u5199\u5165\u5230\u5bc4\u5b58\u5668\u5806\u4e2d\uff0c\u56e0\u6b64\u7cbe\u786e\u5f02\u5e38\u65f6\u96be\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u5bc4\u5b58\u5668\u5806\u53d6\u503c\u3002\u65e2\u7136\u6211\u4eec\u5e0c\u671b\u5bc4\u5b58\u5668\u5806\u7684\u72b6\u6001\u4e0e\u987a\u5e8f\u6267\u884c\u7684\u7ed3\u679c\u4e00\u81f4\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165 ROB\u3002</p> <p>ROB \u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u5faa\u73af\u961f\u5217\uff0c\u961f\u5217\u5934\u5c3e\u6307\u9488\u4e4b\u95f4\u5c31\u662f\u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\uff0c\u6bcf\u4e2a ROB \u8868\u9879\u8bb0\u5f55\u4e86\u6307\u4ee4\u7684\u72b6\u6001\u3001\u76ee\u7684\u5bc4\u5b58\u5668\u548c\u76ee\u7684\u5bc4\u5b58\u5668\u5c06\u8981\u5199\u5165\u7684\u503c\u3002ROB \u4f1a\u68c0\u67e5\u961f\u5217\u5934\u7684\u6307\u4ee4\uff0c\u5982\u679c\u5df2\u7ecf\u6267\u884c\u5b8c\u6210\uff0c\u5e76\u4e14\u6ca1\u6709\u5f02\u5e38\uff0c\u5c31\u53ef\u4ee5\u8ba9\u7ed3\u679c\u751f\u6548\uff0c\u5e76\u628a\u6307\u4ee4\u4ece\u961f\u5217\u5934\u4e2d\u5220\u53bb\uff0c\u7ee7\u7eed\u68c0\u67e5\u540e\u9762\u7684\u3002Decode \u51fa\u6765\u7684\u6307\u4ee4\u5219\u4f1a\u63d2\u5165\u5230 ROB \u7684\u5c3e\u90e8\uff0c\u5e76\u4e14\u968f\u7740\u6307\u4ee4\u7684\u6267\u884c\u8fc7\u7a0b\u66f4\u65b0\u72b6\u6001\u3002\u9047\u5230\u5f02\u5e38\u7684\u6307\u4ee4\uff0c\u5c31\u628a\u961f\u5217\u4e2d\u7684\u6307\u4ee4\u3001\u4fdd\u7559\u7ad9\u548c\u6267\u884c\u5355\u5143\u6e05\u7a7a\uff0c\u4ece\u5f02\u5e38\u5904\u7406\u5730\u5740\u5f00\u59cb\u91cd\u65b0\u6267\u884c\u3002</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u5bc4\u5b58\u5668\u5806\u7684\u6b63\u786e\u6027\uff0c\u8fd0\u7b97\u5355\u5143\u7684\u8fd0\u7b97\u7ed3\u679c\u4f1a\u5199\u5165 ROB \u9879\u4e2d\uff0c\u5f53\u8fd9\u4e00\u9879\u5728 ROB \u961f\u5217\u5934\u90e8\u88ab\u5220\u53bb\u65f6\uff0c\u5c31\u4f1a\u5199\u5165\u5bc4\u5b58\u5668\u5806\u3002\u5728\u7ecf\u5178 Tomasulo \u4e2d\uff0c\u5bc4\u5b58\u5668\u91cd\u547d\u540d\u4e3a\u4fdd\u7559\u7ad9\u7684 ID\uff0c\u4f46\u5728\u8fd9\u79cd\u8bbe\u8ba1\u4e2d\uff0c\u5e94\u8be5\u91cd\u547d\u540d\u4e3a ROB \u7684 ID\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u5bc4\u5b58\u5668\u5230 ROB ID \u7684\u6620\u5c04\uff0c\u5f53\u6307\u4ee4\u8fdb\u5165\u4fdd\u7559\u7ad9\u7684\u65f6\u5019\uff0c\u9700\u8981\u4ece\u5bc4\u5b58\u5668\u5806\u6216\u8005 ROB \u4e2d\u53bb\u8bfb\u53d6\u64cd\u4f5c\u6570\u7684\u503c\u3002\u5728 CDB \u4e0a\u5e7f\u64ad\u7684\u4e5f\u662f ROB \u7684 ID\uff0c\u800c\u4e0d\u662f\u4fdd\u7559\u7ad9\u7684 ID\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0cROB \u7684\u5927\u5c0f\u6210\u4e3a\u4e86\u4e00\u4e2a\u65b0\u7684\u74f6\u9888\uff0c\u56e0\u4e3a\u6bcf\u6761\u5728\u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\u90fd\u9700\u8981\u5728 ROB \u4e2d\u8bb0\u5f55\u4e00\u4efd\u3002\u4e0d\u8fc7\u597d\u5904\u662f\u5b9e\u73b0\u4e86\u7cbe\u786e\u5f02\u5e38\u3002</p> <p>Pentium III \u91c7\u7528\u7684\u5c31\u662f\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5728 The Microarchitecture of the Pentium\uf8e84 Processor \u4e2d\u662f\u8fd9\u4e48\u63cf\u8ff0\u7684\uff1a</p> <p>It allocates the data result registers and the ROB entries as a single, wide entity with a data and a status field. The ROB data field is used to store the data result value of the uop, and the ROB status field is used to track the status of the uop as it is executing in the machine. These ROB entries are allocated and deallocated sequentially and are pointed to by a sequence number that indicates the relative age of these entries.  Upon retirement, the result data is physically copied from the ROB data result field into the separate Retirement Register File (RRF). The RAT points to the current version of each of the architectural registers such as EAX.  This current register could be in the ROB or in the RRF.</p> <p>\u8fd9\u548c\u4e0a\u9762\u63cf\u8ff0\u7684\u65b9\u6cd5\u662f\u4e00\u81f4\u7684\uff1aROB \u4f1a\u5b58\u6307\u4ee4\u7684\u7ed3\u679c\uff0cRAT \u8bb0\u5f55\u6bcf\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u5bf9\u5e94\u7684 ROB \u6216\u8005 RRF \u7684\u8868\u9879\uff0c\u6307\u4ee4\u4ece ROB \u63d0\u4ea4\u65f6\uff0c\u6307\u4ee4\u7684\u7ed3\u679c\u4f1a\u4ece ROB \u590d\u5236\u5230 RRF \u4e0a\uff0c\u540c\u65f6\u66f4\u65b0 RAT\u3002\u800c Intel \u5728 NetBurst \u5fae\u67b6\u6784\u628a\u5b9e\u73b0\u6362\u6210\u4e86\u4e0b\u9762\u8981\u8bb2\u7684\u65b9\u6cd5\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#explicit-register-renaming","title":"Explicit Register Renaming","text":"<p>\u4e0a\u9762\u4e24\u79cd\u8bbe\u8ba1\u90fd\u662f\u91c7\u7528\u7684 Implicit Register Renaming \u7684\u65b9\u6cd5\uff0c\u7b2c\u4e00\u79cd\u65b9\u6cd5\u91cd\u547d\u540d\u5230\u4e86\u4fdd\u7559\u7ad9\uff0c\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u91cd\u547d\u540d\u5230\u4e86 ROB\u3002\u8fd8\u6709\u4e00\u79cd\u8bbe\u8ba1\uff0c\u628a\u5bc4\u5b58\u5668\u7f16\u53f7\u6620\u5c04\u5230\u7269\u7406\u7684\u5bc4\u5b58\u5668\u3002\u628a ISA \u4e2d\u7684\u5bc4\u5b58\u5668\u79f0\u4e3a\u67b6\u6784\u5bc4\u5b58\u5668\uff08\u6bd4\u5982 32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668\uff09\uff0cCPU \u4e2d\u5b9e\u9645\u7684\u5bc4\u5b58\u5668\u79f0\u4e3a\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u7269\u7406\u5bc4\u5b58\u5668\u4e00\u822c\u4f1a\u6bd4\u67b6\u6784\u5bc4\u5b58\u5668\u591a\u5f88\u591a\uff08\u4e00\u4e24\u767e\u4e2a\u751a\u81f3\u66f4\u591a\uff09\u3002</p> <p>Explicit Register Renaming \u548c ReOrder Buffer \u8fd9\u4e24\u4e2a\u8bbe\u8ba1\u65b9\u5411\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u3002</p> <p>\u6620\u5c04\u7684\u65b9\u6cd5\u548c\u524d\u9762\u7684\u7c7b\u4f3c\uff0c\u4e5f\u662f\u7ef4\u62a4\u4e00\u4e2a mapping\uff0c\u4ece\u67b6\u6784\u5bc4\u5b58\u5668\u5230\u7269\u7406\u5bc4\u5b58\u5668\u3002\u5f53\u4e00\u6761\u6307\u4ee4 Dispatch \u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u6570\u5728 mapping \u4e2d\u627e\u5230\u5b9e\u9645\u7684\u7269\u7406\u5bc4\u5b58\u5668\u7f16\u53f7\u3002\u5982\u679c\u8fd9\u6761\u6307\u4ee4\u8981\u5199\u5165\u65b0\u7684\u67b6\u6784\u5bc4\u5b58\u5668\uff0c\u5219\u4ece\u672a\u5206\u914d\u7684\u7269\u7406\u5bc4\u5b58\u5668\u4e2d\u5206\u914d\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u5e76\u4e14\u66f4\u65b0 mapping\uff0c\u5373\u628a\u5199\u5165\u7684\u67b6\u6784\u5bc4\u5b58\u5668\u6620\u5c04\u5230\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668\u4e0a\u3002\u7136\u540e\uff0c\u653e\u5230 Issue Queue \u4e2d\u3002</p> <p>Issue Queue \u53ef\u4ee5\u7406\u89e3\u4e3a\u4fdd\u7559\u7ad9\u7684\u7b80\u5316\u7248\uff0c\u5b83\u4e0d\u518d\u4fdd\u5b58\u64cd\u4f5c\u6570\u7684\u53d6\u503c\uff0c\u800c\u4ec5\u4ec5\u7ef4\u62a4\u64cd\u4f5c\u6570\u662f\u5426 ready\u3002\u540e\u9762\u89e3\u91ca\u4e3a\u4ec0\u4e48\u4e0d\u9700\u8981\u4fdd\u5b58\u64cd\u4f5c\u6570\u7684\u53d6\u503c\u3002\u5728 Issue Queue \u4e2d\u7684\u6307\u4ee4\u5728\u6240\u6709\u64cd\u4f5c\u6570\u90fd ready \u7684\u65f6\u5019\uff0c\u5219\u4f1a Issue \u5230\u4e0d\u540c\u7684\u7aef\u53e3\u4e2d\u3002\u6bcf\u4e2a\u7aef\u53e3\u5bf9\u5e94\u7740\u4e00\u4e2a\u6267\u884c\u5355\u5143\uff0c\u6bd4\u5982\u4e24\u4e2a ALU \u7aef\u53e3\u5206\u522b\u5bf9\u5e94\u4e24\u4e2a ALU \u6267\u884c\u5355\u5143\u3002\u6307\u4ee4\u9996\u5148\u901a\u8fc7\u5bc4\u5b58\u5668\u5806\uff0c\u4ee5\u7269\u7406\u5bc4\u5b58\u5668\u4e3a\u7f16\u53f7\u53bb\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u8fd9\u4e2a\u503c\u76f4\u63a5\u4f20\u7ed9\u6267\u884c\u5355\u5143\uff0c\u4e0d\u4f1a\u5b58\u4e0b\u6765\u3002\u5f53\u6267\u884c\u5355\u5143\u6267\u884c\u5b8c\u6bd5\u7684\u65f6\u5019\uff0c\u7ed3\u679c\u4e5f\u662f\u5199\u5230\u7269\u7406\u5bc4\u5b58\u5668\u5806\u4e2d\uff0cROB \u4e0d\u4fdd\u5b58\u6570\u636e\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u4e2d\uff0c\u503c\u4ec5\u4fdd\u5b58\u5728\u5bc4\u5b58\u5668\u5806\u4e2d\uff0cIssue Queue \u548c ROB \u90fd\u53ea\u4fdd\u5b58\u4e00\u4e9b\u72b6\u6001\u4f4d\uff0c\u56e0\u6b64\u5b83\u4eec\u53ef\u4ee5\u505a\u7684\u5f88\u5927\uff0c\u5178\u578b\u7684 Issue Queue \u6709\u51e0\u5341\u9879\uff0cROB \u5219\u6709\u51e0\u767e\u9879\u3002</p> <p>\u63a5\u4e0b\u6765\u8ba8\u8bba\u4e00\u4e9b\u7ec6\u8282\u3002\u9996\u5148\u662f\uff0c\u7269\u7406\u5bc4\u5b58\u5668\u4f55\u65f6\u91ca\u653e\u3002\u5f53\u4e00\u6761\u6307\u4ee4\u5199\u5165\u4e00\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u7684\u65f6\u5019\uff0c\u5728\u4e0b\u4e00\u6b21\u8fd9\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u88ab\u5199\u5165\u4e4b\u524d\uff0c\u8fd9\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u90fd\u6709\u53ef\u80fd\u88ab\u8bfb\u53d6\uff0c\u56e0\u6b64\u8fd9\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u5230\u7269\u7406\u5bc4\u5b58\u5668\u7684\u6620\u5c04\u8981\u4fdd\u7559\u3002\u5982\u679c\u6211\u4eec\u80fd\u4fdd\u8bc1\u8bfb\u53d6\u8fd9\u4e2a\u503c\u7684\u6307\u4ee4\u90fd\u5df2\u7ecf\u5b8c\u6210\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u91ca\u653e\u8fd9\u4e2a\u7269\u7406\u5bc4\u5b58\u5668\u4e86\u3002\u4e00\u4e2a\u65b9\u6cd5\u662f\uff0c\u6211\u5728\u8986\u76d6\u67b6\u6784\u5bc4\u5b58\u5668\u5230\u7269\u7406\u5bc4\u5b58\u5668\u7684\u6620\u5c04\u65f6\uff0c\u6211\u8fd8\u8981\u8bb0\u5f55\u539f\u6765\u7684\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u5f53\u8be5\u6307\u4ee4\u5728 ROB \u4e2d\u63d0\u4ea4\u4e86\uff08\u4ece\u961f\u5934\u51fa\u53bb\u4e86\uff09\uff0c\u8bf4\u660e\u4e4b\u524d\u53ef\u80fd\u4f9d\u8d56\u8fd9\u4e2a\u7269\u7406\u5bc4\u5b58\u5668\u7684\u6240\u6709\u6307\u4ee4\u90fd\u5b8c\u6210\u4e86\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u628a\u539f\u6765\u7684\u7269\u7406\u5bc4\u5b58\u5668\u653e\u5230\u672a\u6620\u5c04\u7684\u5217\u8868\u4e2d\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5728\u9047\u5230\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u5982\u4f55\u6062\u590d\u5728\u5f02\u5e38\u6307\u4ee4\u5904\u7684\u67b6\u6784\u5bc4\u5b58\u5668\u5230\u7269\u7406\u5bc4\u5b58\u5668\u7684\u6620\u5c04\u5462\uff1f\u4e00\u4e2a\u529e\u6cd5\u662f\uff0c\u5229\u7528\u6211\u5728 ROB \u4e2d\u8bb0\u5f55\u7684\u88ab\u8986\u76d6\u7684\u7269\u7406\u5bc4\u5b58\u5668\u7f16\u53f7\uff0c\u4ece ROB \u961f\u5c3e\u5f80\u524d\u56de\u6eda\uff0c\u5f53\u53d1\u73b0\u4e00\u6761\u6307\u4ee4\u8986\u76d6\u4e86\u4e00\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u6620\u5c04\u7684\u65f6\u5019\uff0c\u5c31\u6062\u590d\u4e3a\u8986\u76d6\u4e4b\u524d\u7684\u503c\u3002\u8fd9\u6837\uff0c\u5f53\u56de\u6eda\u5230\u5f02\u5e38\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5f97\u5230\u6b63\u786e\u7684\u6620\u5c04\u3002MIPS R10K \u7684\u8bba\u6587\u4e2d\u662f\u8fd9\u4e48\u63cf\u8ff0\u7684\uff1a</p> <pre><code>The active list contains the logical-destination register number and its\nold physical-register number for each instruction. An instruction's\ngraduation commits its new mapping, so the old physical register can\nreturn to the free list for reuse. When an exception occurs, however,\nsubsequent instructions never graduate. Instead, the processor restores\nold mappings from the active list. The R1OOOO unmaps four instructions\nper cycle--in reverse order, in case it renamed the same logical\nregister twice. Although this is slower than restoring a branch,\nexceptions are much rarer than mispredicted branches. The processor\nreturns new physical registers to the free lists by restoring their read\npointers.\n</code></pre> <p>\u548c @CircuitCoder \u8ba8\u8bba\u5e76\u53c2\u8003 BOOM \u6587\u6863 \u540e\u53d1\u73b0\uff0c\u53e6\u4e00\u79cd\u529e\u6cd5\u662f\u8bb0\u5f55\u4e00\u4e2a Committed Map Table\uff0c\u4e5f\u5c31\u662f\uff0c\u53ea\u6709\u5f53 ROB Head \u7684\u6307\u4ee4\u88ab Commit \u7684\u65f6\u5019\uff0c\u624d\u66f4\u65b0 Committed Map Table\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u987a\u5e8f\u6267\u884c\u7684\u5bc4\u5b58\u5668\u6620\u5c04\u8868\u3002\u5f53\u53d1\u751f\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u628a Committed Map Table \u8986\u76d6\u5230 Register Map Table \u4e0a\u3002\u8fd9\u6837\u9700\u8981\u7684\u5468\u671f\u6bd4\u8f83\u5c11\uff0c\u4f46\u662f\u65f6\u5e8f\u53ef\u80fd\u6bd4\u8f83\u5dee\u3002\u4ece The Microarchitecture of the Pentium\uf8e84 Processor \u7684\u56fe 5 \u6765\u770b\uff0cPentium 4 \u4e5f\u662f\u91c7\u7528\u8fd9\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5206\u522b\u7ef4\u62a4 Frontend RAT \u548c Retirement RAT\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#implicit-renamingrob-\u548c-explicit-renaming-\u7684\u6bd4\u8f83","title":"Implicit Renaming(ROB) \u548c Explicit Renaming \u7684\u6bd4\u8f83","text":"<p>\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4e3b\u8981\u533a\u522b\uff1a</p> <ol> <li>Implicit Renaming \u5728\u5206\u53d1\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4ece\u5bc4\u5b58\u5668\u5806\u8bfb\u53d6\u6570\u636e\uff0c\u4fdd\u5b58\u5230\u4fdd\u7559\u7ad9\u4e2d\uff1b\u800c Explicit Renaming \u662f\u6307\u4ee4\u4ece Issue Queue \u5230\u6267\u884c\u5355\u5143\u65f6\u5019\u4ece\u5bc4\u5b58\u5668\u5806\u8bfb\u53d6\u6570\u636e</li> <li>Implicit Renaming \u7684\u5bc4\u5b58\u5668\u5806\u8bfb\u53d6\u53e3\u8f83\u5c11\uff0c\u53ea\u9700\u8981\u8003\u8651\u53d1\u5c04\u6570\u4e58\u4ee5\u64cd\u4f5c\u6570\u4e2a\u6570\uff0c\u4f46\u6240\u6709\u7c7b\u578b\u7684\u5bc4\u5b58\u5668\u5806\uff08\u6574\u6570\u3001\u6d6e\u70b9\uff09\u90fd\u9700\u8981\u8bfb\u53d6\uff1bExplicit Renaming \u7684\u5bc4\u5b58\u5668\u5806\u8bfb\u53d6\u53e3\u66f4\u591a\uff0c\u5bf9\u4e8e\u6bcf\u4e2a Issue Queue\uff0c\u90fd\u9700\u8981\u64cd\u4f5c\u6570\u4e2a\u6570\u4e2a\u8bfb\u53d6\u53e3\uff0c\u4f46\u597d\u5904\u662f\u53ef\u4ee5\u5c4f\u853d\u6389\u4e0d\u9700\u8981\u8bbf\u95ee\u7684\u8bfb\u53d6\u53e3\uff0c\u6bd4\u5982\u6d6e\u70b9 FMA \u6d41\u6c34\u4e0d\u9700\u8981\u8bfb\u53d6\u6574\u6570\u5bc4\u5b58\u5668\u5806\u3002\u5199\u548c\u8bfb\u662f\u7c7b\u4f3c\u7684\uff1aImplicit Renaming \u4e2d\uff0c\u5bc4\u5b58\u5668\u5806\u7684\u5199\u5165\u662f\u4ece ROB \u4e0a\u63d0\u4ea4\uff1b\u800c Explicit Renaming \u5219\u662f\u6267\u884c\u5355\u5143\u8ba1\u7b97\u5b8c\u540e\u5199\u5165\u5bc4\u5b58\u5668\u5806\u3002</li> </ol>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#\u5176\u4ed6\u4f18\u5316\u7684\u624b\u6bb5","title":"\u5176\u4ed6\u4f18\u5316\u7684\u624b\u6bb5","text":"<p>\u5728\u7b2c\u4e00\u548c\u7b2c\u4e8c\u79cd\u8bbe\u8ba1\u4e2d\uff0c\u5f53\u4e00\u6761\u6307\u4ee4\u8ba1\u7b97\u5b8c\u6210\u65f6\uff0c\u7ed3\u679c\u4f1a\u76f4\u63a5\u901a\u8fc7 CDB \u8f6c\u53d1\u5230\u5176\u4ed6\u6307\u4ee4\u7684\u8f93\u5165\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u8fd0\u884c\u6548\u7387\u3002\u5728\u7b2c\u4e09\u79cd\u8bbe\u8ba1\u4e2d\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u4e5f\u53ef\u4ee5\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\uff0c\u4f46\u56e0\u4e3a\u4e2d\u95f4\u591a\u4e86\u4e00\u7ea7\u5bc4\u5b58\u5668\u5806\u8bfb\u53d6\u7684\u6d41\u6c34\u7ebf\u7ea7\uff0c\u5904\u7406\u4f1a\u66f4\u52a0\u590d\u6742\u4e00\u70b9\u3002\u6bd4\u5982\uff0c\u6709\u4e00\u6761 ALU \u6307\u4ee4\uff0c\u53ef\u4ee5\u786e\u5b9a\u5b83\u5728\u4e00\u4e2a\u5468\u671f\u540e\u4e00\u5b9a\u4f1a\u5f97\u5230\u8ba1\u7b97\u7ed3\u679c\uff0c\u90a3\u4e48\u6211\u5c31\u53ef\u4ee5\u63d0\u524d\u628a\u4f9d\u8d56\u8fd9\u6761\u6307\u4ee4\u7684\u5176\u4ed6\u6307\u4ee4 Dispatch \u51fa\u53bb\uff0c\u7136\u540e\u5728 ALU \u4e4b\u95f4\u8fde\u63a5\u4e00\u4e2a bypass \u7f51\u7edc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u4e00\u4e9b\u5468\u671f\u3002</p> <p>\u6b64\u5916\uff0c\u4e3a\u4e86\u63d0\u9ad8\u541e\u5410\u7387\uff0c\u4e00\u822c\u8ba1\u7b97\u5355\u5143\u90fd\u88ab\u8bbe\u8ba1\u4e3a\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u63a5\u53d7\u4e00\u6761\u6307\u4ee4\uff0c\u5728\u5185\u90e8\u5b9e\u73b0\u6d41\u6c34\u7ebf\u6267\u884c\uff0c\u6bcf\u4e2a\u5468\u671f\u5b8c\u6210\u4e00\u6761\u6307\u4ee4\u7684\u8ba1\u7b97\u3002\u5f53\u7136\u4e86\uff0c\u5f88\u591a\u65f6\u5019\u7531\u4e8e\u6570\u636e\u4f9d\u8d56\u95ee\u9898\uff0c\u53ef\u80fd\u5e76\u4e0d\u80fd\u8fbe\u5230\u6bcf\u4e2a\u5468\u671f\u6bcf\u4e2a\u8ba1\u7b97\u5355\u5143\u90fd\u6ee1\u8f7d\u7684\u60c5\u51b5\u3002</p> <p>\u6709\u4e9b\u65f6\u5019\uff0c\u4e00\u4e9b\u6307\u4ee4\u4e0d\u65b9\u4fbf\u540e\u7aef\u5b9e\u73b0\uff0c\u5c31\u4f1a\u52a0\u4e00\u5c42\u8f6c\u6362\uff0c\u4ece\u6307\u4ee4\u8f6c\u6362\u4e3a uop\uff0c\u518d\u7531\u540e\u7aef\u6267\u884c\u3002\u8fd9\u5728 x86 \u5904\u7406\u5668\u4e0a\u5f88\u666e\u904d\uff0c\u56e0\u4e3a\u6307\u4ee4\u96c6\u592a\u590d\u6742\u4e86\u3002\u50cf AArch64 \u6307\u4ee4\u96c6\uff0c\u5b83\u5728 Load/Store \u7684\u65f6\u5019\u53ef\u4ee5\u5bf9\u5730\u5740\u8fdb\u884c\u8ba1\u7b97\uff0c\u8fd9\u79cd\u65f6\u5019\u4e5f\u662f\u62c6\u5206\u4e3a\u4e24\u6761 uop \u6765\u6267\u884c\u3002\u4e00\u4e9b\u5b9e\u7528\u7684\u6307\u4ee4\u9700\u8981\u4e09\u4e2a\u64cd\u4f5c\u6570\uff0c\u6bd4\u5982 <code>D = A ? B : C</code>\uff0c\u5728 Alpha 21264 \u4e2d\uff0c\u8fd9\u6761\u6307\u4ee4\u4f1a\u8f6c\u6362\u4e3a\u4e24\u6761 uop\uff0c\u8fd9\u4e24\u6761 uop \u7684\u64cd\u4f5c\u6570\u5c31\u53ea\u6709\u4e24\u4e2a\uff0c\u4fbf\u4e8e\u540e\u7aef\u5b9e\u73b0\uff0c\u5426\u5219\u5728\u5404\u4e2a\u5730\u65b9\u90fd\u5141\u8bb8\u4e09\u4e2a\u64cd\u4f5c\u6570\u4f1a\u5bfc\u81f4\u4e00\u5b9a\u7684\u6d6a\u8d39\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#rat-\u7684\u66f4\u65b0\u548c\u6062\u590d","title":"RAT \u7684\u66f4\u65b0\u548c\u6062\u590d","text":"<p>\u5728\u524d\u9762\u63d0\u5230\uff0c\u4f7f\u7528 Explicit Renaming + ROB \u65b9\u6cd5\u7684\u5904\u7406\u5668\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u6700\u65b0\u7684 Frontend RAT\uff0c\u4e5f\u8981\u4fdd\u8bc1\u51fa\u4e86\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u8fd8\u8981\u80fd\u591f\u6062\u590d\u5230\u6b63\u786e\u7684 RAT\u3002\u65b9\u6cd5\u4e0a\u9762\u4e5f\u63d0\u5230\u8fc7\uff0c\u53ef\u4ee5\u5728 ROB \u91cc\u8bb0\u5f55 Rename \u4fe1\u606f\u7684\u53d8\u5316\uff0c\u51fa\u73b0\u5f02\u5e38\u7684\u65f6\u5019\u6309\u7167\u9006\u8fc7\u7a0b\u6765\u6062\u590d\uff0c\u6216\u8005\u4fdd\u5b58\u4e00\u4efd Retirement RAT\uff0c\u51fa\u73b0\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u7528 Retirement RAT \u8986\u76d6 Frontend RAT \u5373\u53ef\u3002\u7531\u4e8e\u5f02\u5e38\u51fa\u73b0\u7684\u9891\u7387\u901a\u5e38\u6bd4\u8f83\u5c0f\uff0c\u6240\u4ee5\u5b9e\u73b0\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u4e0d\u4f1a\u5f88\u5927\u3002</p> <p>\u4f46\u662f\uff0c\u9664\u4e86\u5f02\u5e38\uff0c\u73b0\u4ee3\u5904\u7406\u5668\u901a\u5e38\u8fd8\u4f1a\u6709\u5f88\u591a\u5c0f\u8303\u56f4\u7684\u5fae\u67b6\u6784\u7ea7\u522b\u7684\u56de\u6eda\uff0c\u4f8b\u5982\u5206\u652f\u9884\u6d4b\u9519\u8bef\uff0c\u5185\u5b58\u5e8f\u9519\u8bef\u7b49\u7b49\uff0c\u7531\u4e8e\u5fae\u67b6\u6784\u4e0a\u7684\u4e00\u4e9b\u9884\u6d4b\u6267\u884c\uff0c\u9884\u6d4b\u5931\u8d25\u5bfc\u81f4\u9700\u8981\u56de\u6eda\u90e8\u5206\u6307\u4ee4\u518d\u6267\u884c\u65b0\u7684\u6307\u4ee4\uff0c\u6b64\u65f6\u56de\u6eda\u7684\u4f4d\u7f6e\u5c31\u53ef\u80fd\u5728 ROB \u4e2d\u95f4\u7684\u67d0\u4e2a\u4f4d\u7f6e\u4e86\uff0c\u5e76\u4e14\u7531\u4e8e\u8fd9\u4e9b\u5fae\u67b6\u6784\u7684\u56de\u6eda\u76f8\u6bd4\u5f02\u5e38\u4f1a\u66f4\u52a0\u9891\u7e41\uff0c\u5982\u4f55\u9ad8\u6548\u5730\u5b9e\u73b0 Frontend RAT \u7684\u56de\u6eda\uff0c\u5c31\u6210\u4e3a\u4e86\u65b0\u7684\u95ee\u9898\u3002</p> <p>\u5982\u679c\u8fd8\u662f\u50cf\u4e4b\u524d\u90a3\u6837\u5728 ROB \u6bcf\u4e2a\u8868\u9879\u91cc\u8bb0\u5f55 Rename \u4fe1\u606f\u7684\u53d8\u5316\uff0c\u53ef\u4ee5\u6309\u7167\u9006\u8fc7\u7a0b\u6765\u6062\u590d\uff1b\u4e5f\u53ef\u4ee5\u4ece Retirement RAT \u5f00\u59cb\u6309\u7167 Rename \u4fe1\u606f\u6b63\u5411\u8fc7\u7a0b\u6765\u6062\u590d\uff0c\u53ea\u662f\u6362\u4e86\u4e2a\u65b9\u5411\uff1b\u5982\u679c\u60f3\u8981\u4e00\u6b65\u76f4\u63a5\u5f97\u5230\u6b63\u786e\u7684 RAT\uff0c\u5c31\u9700\u8981\u5728\u4e4b\u524d\u9884\u6d4b\u6267\u884c\u7684\u65f6\u5019\u5c31\u5b58\u6863\u4e00\u4efd RAT\uff0c\u90a3\u4e48\u7a7a\u95f4\u4e0a\u7684\u9700\u6c42\u53c8\u6bd4\u8f83\u5927\u4e86\uff0c\u4f8b\u5982\u53ef\u80fd\u6bcf\u4e2a\u9884\u6d4b\u6267\u884c\u7684\u5206\u652f\u6267\u884c\u90fd\u8981\u8bb0\u5f55\u4e00\u4efd Checkpoint RAT\u3002</p> <p>\u4f46\u662f\u7ed3\u5408\u5b9e\u9645\u7684\u6307\u4ee4\u96c6\uff0c\u53c8\u4f1a\u53d1\u73b0\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a\u4e0d\u540c\u7684\u6307\u4ee4\u8981\u5199\u5165\u7684\u5bc4\u5b58\u5668\u4e2a\u6570\u4e0d\u540c\uff0c\u6709\u7684\u6307\u4ee4\u4e0d\u5199\u5165\u5bc4\u5b58\u5668\uff0c\u4f8b\u5982 store \u6307\u4ee4\uff0cnop \u6307\u4ee4\u7b49\u7b49\uff0c\u6709\u7684\u6307\u4ee4\u8981\u5199\u5165\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u4f8b\u5982 x86 \u5728\u8ba1\u7b97\u7684\u540c\u65f6\u8fd8\u8981\u751f\u6210 flags\uff0c\u8fd9\u6837\u5c31\u8981\u5199\u5165\u4fe9\u5bc4\u5b58\u5668\u4e86\u3002\u5982\u679c ROB \u8981\u4fdd\u5b58 Rename \u4fe1\u606f\uff0c\u90a3\u5c31\u8981\u6309\u6700\u591a\u53ef\u80fd\u5199\u5165\u7684\u5bc4\u5b58\u5668\u4e2a\u6570\u6765\u9884\u7559\u7a7a\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u6d6a\u8d39\u3002\u56e0\u6b64\u53ef\u4ee5\u628a\u8fd9\u4e9b Rename \u4fe1\u606f\u72ec\u7acb\u51fa\u6765\uff0c\u5b58\u5230\u4e00\u4e2a\u53eb\u505a History File \u7684\u5730\u65b9\uff0c\u53ea\u6709\u8981\u5199\u5165\u5bc4\u5b58\u5668\u7684\u6307\u4ee4\u624d\u4f1a\u5206\u914d entry\uff0c\u5982\u679c\u8981\u5199\u5165\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u90a3\u5c31\u5206\u914d\u591a\u4e2a entry\uff0c\u4e0d\u5199\u5165\u5bc4\u5b58\u5668\u7684\u6307\u4ee4\u5c31\u4e0d\u7528\u6d6a\u8d39\u7a7a\u95f4\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#move-elimination","title":"Move Elimination","text":"<p>\u73b0\u4ee3\u7684\u5904\u7406\u5668\u5f88\u591a\u4f1a\u5b9e\u73b0 Move Elimination\uff0c\u5c31\u662f\u628a\u5bc4\u5b58\u5668\u4e4b\u95f4\u7684 move \u6307\u4ee4\uff0c\u4e0d\u7ecf\u8fc7 ALU\uff0c\u76f4\u63a5\u5728\u91cd\u547d\u540d\u9636\u6bb5\u5b9e\u73b0\uff0c\u4f8b\u5982 <code>r1 = r0</code>\uff0c\u4e0d\u9700\u8981\u7ed9 r1 \u5206\u914d\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668\u518d\u628a r0 \u7684\u7ed3\u679c\u5199\u8fdb\u53bb\uff0c\u800c\u662f\u76f4\u63a5\u628a r1 \u6620\u5c04\u5230 r0 \u5bf9\u5e94\u7684\u7269\u7406\u5bc4\u5b58\u5668\u3002\u8fd9\u6837\uff0c\u907f\u514d\u4e86\u5bc4\u5b58\u5668\u7684\u8bfb\u5199\uff0c\u4e5f\u4e0d\u9700\u8981\u5360\u7528 ALU\uff0c\u53ef\u4ee5\u5e26\u6765\u6027\u80fd\u7684\u63d0\u5347\u3002</p> <p>\u4f46\u662f\uff0c\u76f4\u63a5\u8fd9\u4e48\u505a\u4f1a\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\uff1a\u6211\u4eec\u524d\u9762\u63d0\u5230\uff0c\u7269\u7406\u5bc4\u5b58\u5668\u7684\u91ca\u653e\u89c4\u5219\u662f\uff0c\u540c\u4e00\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\uff0c\u5728\u521b\u5efa\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668\u6620\u5c04\u7684\u6307\u4ee4\u4ece ROB \u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u65e7\u7684\u7269\u7406\u5bc4\u5b58\u5668\u53ef\u4ee5\u91ca\u653e\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <ol> <li>\u5047\u5982 r0 \u4e00\u5f00\u59cb\u6620\u5c04\u5230\u7269\u7406\u5bc4\u5b58\u5668 p0</li> <li>\u6765\u4e86\u4e00\u6761\u6307\u4ee4\uff0c\u8981\u5199\u5165 r0\uff0c\u8fd9\u65f6\u5019\u5206\u914d\u4e86\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668 p1\uff0c\u628a r0 \u6620\u5c04\u5230 p1</li> <li>\u5f53\u8fd9\u6761\u6307\u4ee4\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6240\u6709\u53ef\u80fd\u8bfb\u53d6 p0 \u7684\u6307\u4ee4\u90fd\u5df2\u7ecf\u63d0\u4ea4\u8fc7\u4e86\uff0c\u56e0\u6b64\u53ef\u4ee5\u628a p0 \u91ca\u653e\u6389</li> </ol> <p>\u73b0\u5728\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u5b9e\u73b0\u4e86 Move Elimination\uff0c\u628a r1 \u76f4\u63a5\u6307\u5411\u4e86 r0 \u7684\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u4e5f\u5c31\u662f p0\uff0c\u6b64\u65f6\u540c\u4e00\u4e2a\u7269\u7406\u5bc4\u5b58\u5668\u88ab\u4e24\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u6240\u4f7f\u7528\uff0c\u5982\u679c\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u505a\uff0cp0 \u4f1a\u88ab\u9519\u8bef\u7684\u91ca\u653e\u6389\u3002\u90a3\u4e48\u5c31\u9700\u8981\u6539\u8fdb\u5bc4\u5b58\u5668\u91ca\u653e\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002</p> <p>Zero cycle move \u4e13\u5229 \u548c Zero cycle move using free list counts \u4e13\u5229 \u63d0\u5230\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5bf9\u4e8e\u5728 Move Elimination \u88ab\u91cd\u590d\u6620\u5c04\u7684\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u5728 Duplicated Register Array \u4e2d\u8bb0\u5f55\u5b83\u7684\u91cd\u590d\u6b21\u6570\uff0c\u7c7b\u4f3c\u4e8e\u5f15\u7528\u8ba1\u6570\u6cd5\uff0cMove Elimination \u7684\u65f6\u5019\u589e\u52a0\u5f15\u7528\u8ba1\u6570\uff0c\u5f53\u5f15\u7528\u8ba1\u6570\u5230\u96f6\u7684\u65f6\u5019\u518d\u91ca\u653e\uff1a</p> <ol> <li>\u5047\u5982 r0 \u4e00\u5f00\u59cb\u6620\u5c04\u5230\u7269\u7406\u5bc4\u5b58\u5668 p0</li> <li>\u6267\u884c Move Elimination\uff0c\u628a r1 \u4e5f\u6307\u5411\u4e86 p0\uff0c\u5728 Duplicated Register Array \u4e2d\u8bb0\u5f55 p0 \u91cd\u590d\u4e86\u4e24\u6b21</li> <li>\u6765\u4e86\u4e00\u6761\u6307\u4ee4 A\uff0c\u8981\u5199\u5165 r0\uff0c\u8fd9\u65f6\u5019\u5206\u914d\u4e86\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668 p1\uff0c\u628a r0 \u6620\u5c04\u5230 p1</li> <li>\u5f53\u6307\u4ee4 A \u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u53d1\u73b0 Duplicated Register Array \u4e2d\u8bb0\u5f55 p0 \u91cd\u590d\u4e86\u4e24\u6b21\uff0c\u7531\u4e8e r0 \u4e0d\u518d\u6620\u5c04\u5230 p0\uff0c\u6240\u4ee5\u8ba1\u6570\u51cf\u53bb\u4e00\uff0c\u5982\u679c\u540e\u7eed\u6709\u6307\u4ee4\u5199\u5165 r1\uff0c\u63d0\u4ea4\u7684\u65f6\u5019\u624d\u4f1a\u628a p0 \u6700\u7ec8\u91ca\u653e\u6389</li> </ol> <p>Last physical register reference scheme \u4e13\u5229 \u63d0\u5230\u4e86\u53e6\u4e00\u79cd\u529e\u6cd5\uff1aRename \u7684\u65f6\u5019\uff0c\u201c\u904d\u5386\u201d\u4e00\u4e0b RAT\uff0c\u770b\u770b\u65e7\u7684\u7269\u7406\u5bc4\u5b58\u5668\u8fd8\u6709\u591a\u5c11\u4eba\u5728\u7528\uff0c\u5982\u679c\u53ea\u5269\u4e0b\u4e00\u4e2a\uff0c\u6253\u6807\u8bb0\uff0c\u5f53\u6307\u4ee4\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u91ca\u653e\u65e7\u7684\u7269\u7406\u5bc4\u5b58\u5668\uff1b\u5982\u679c\u5269\u4e0b\u4e0d\u6b62\u4e00\u4e2a\uff0c\u90a3\u5c31\u4e0d\u91ca\u653e\u65e7\u7684\u7269\u7406\u5bc4\u5b58\u5668\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <ol> <li>\u5047\u5982 r0 \u4e00\u5f00\u59cb\u6620\u5c04\u5230\u7269\u7406\u5bc4\u5b58\u5668 p0\uff0c\u6b64\u65f6\u7684 RAT \u662f r0 -&gt; p0</li> <li>\u6267\u884c Move Elimination\uff0c\u628a r1 \u4e5f\u6307\u5411\u4e86 p0\uff0c\u6b64\u65f6\u7684 RAT \u662f r0 -&gt; p0\uff0cr1 -&gt; p0</li> <li>\u6765\u4e86\u4e00\u6761\u6307\u4ee4 A\uff0c\u8981\u5199\u5165 r0\uff0cr0 \u4e4b\u524d\u6307\u5411 p0\uff0c\u626b\u63cf RAT\uff0c\u53d1\u73b0 p0 \u539f\u6765\u6709\u4e24\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u7684\u6620\u5c04\uff1ar0 -&gt; p0 \u548c r1 -&gt; p0\uff0c\u4e8e\u662f\u6807\u8bb0\u6307\u4ee4 A \u4e3a Not Last Reference\uff0c\u540c\u65f6\u5206\u914d\u4e86\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5bc4\u5b58\u5668 p1\uff0c\u628a r0 \u6620\u5c04\u5230 p1\uff0c\u6b64\u65f6\u7684 RAT \u662f r0 -&gt; p1\uff0cr1 -&gt; p0</li> <li>\u53c8\u6765\u4e86\u4e00\u6761\u6307\u4ee4 B\uff0c\u8981\u5199\u5165 r1\uff0cr1 \u4e4b\u524d\u6307\u5411 p0\uff0c\u626b\u63cf RAT\uff0c\u53d1\u73b0 p0 \u53ea\u6709\u4e00\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u7684\u6620\u5c04\uff1ar1 -&gt; p0\uff0c\u610f\u5473\u7740\u5f53\u6307\u4ee4 B \u8981\u63d0\u4ea4\u7684\u65f6\u5019\uff0cp0 \u53ef\u4ee5\u91ca\u653e\u4e86\uff0c\u6240\u4ee5\u6807\u8bb0\u6307\u4ee4 B \u4e3a Last Reference</li> <li>\u5f53\u6307\u4ee4 A \u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u6807\u8bb0\u4e3a Not Last Reference\uff0c\u6240\u4ee5\u4e0d\u4f1a\u91ca\u653e p0</li> <li>\u5f53\u6307\u4ee4 B \u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u6807\u8bb0\u4e3a Last Reference\uff0c\u6240\u4ee5\u8981\u91ca\u653e p0</li> </ol> <p>\u5b83\u7684\u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff1a\u4e0e\u5176\u8bb0\u5f55\u5f15\u7528\u8ba1\u6570\uff0c\u4e0d\u5982\u5c31\u53bb\u67e5\u67e5 RAT\uff0c\u770b\u770b\u5b9e\u9645\u4e0a\u5230\u5e95\u5f15\u7528\u4e86\u591a\u5c11\u6b21\uff0c\u5982\u679c\u53ea\u5269\u4e0b\u4e00\u6b21\u4e86\uff0c\u90a3\u63d0\u4ea4\u7684\u65f6\u5019\u5c31\u8981\u91ca\u653e\uff1b\u5982\u679c\u5f15\u7528\u4e86\u4e0d\u6b62\u4e00\u6b21\uff0c\u90a3\u5c31\u4e0d\u91ca\u653e\u3002\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u7684\u96be\u70b9\u662f\uff0c\u600e\u4e48\u5728\u786c\u4ef6\u4e0a\u5feb\u901f\u67e5\u8be2 RAT\uff0c\u77e5\u9053\u6709\u591a\u5c11\u4e2a\u67b6\u6784\u5bc4\u5b58\u5668\u6620\u5c04\u5230\u8fd9\u4e2a\u7269\u7406\u5bc4\u5b58\u5668\u4e0a\u3002</p> <p>\u8fd9\u90e8\u5206\u5185\u5bb9\u53c2\u8003\u4e86 AArch64-Explore: Exploration of Apple CPUs \u7684\u5206\u6790\u3002</p>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#\u7cbe\u786e\u5f02\u5e38-vs-\u975e\u7cbe\u786e\u5f02\u5e38","title":"\u7cbe\u786e\u5f02\u5e38 vs \u975e\u7cbe\u786e\u5f02\u5e38","text":"<p>\u7cbe\u786e\u5f02\u5e38\u662f\u6307\u53d1\u751f\u5f02\u5e38\u7684\u6307\u4ee4\u4e4b\u524d\u7684\u6307\u4ee4\u90fd\u5b8c\u6210\uff0c\u4e4b\u540e\u7684\u6ca1\u6709\u6267\u884c\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5b9e\u73b0\u65b9\u5f0f\u662f\u5b8c\u6210\u5f02\u5e38\u6307\u4ee4\u4e4b\u524d\u7684\u6240\u6709\u6307\u4ee4\uff0c\u5e76\u64a4\u9500\u5f02\u5e38\u6307\u4ee4\u4e4b\u540e\u7684\u6307\u4ee4\u7684\u4f5c\u7528\u3002\u975e\u7cbe\u786e\u5f02\u5e38\u5219\u662f\u4e0d\u4fdd\u8bc1\u8fd9\u4e2a\u6027\u8d28\uff0c\u7f51\u4e0a\u8d44\u6599 \u8bf4\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u786c\u4ef6\u5b9e\u73b0\u66f4\u7b80\u5355\uff0c\u4f46\u662f\u8f6f\u4ef6\u4e0a\u5904\u7406\u6bd4\u8f83\u56f0\u96be\u3002</p> <p>\u4e00\u4e2a\u975e\u7cbe\u786e\u5f02\u5e38\u7684\u4f8b\u5b50\u662f Alpha\uff0c\u5728\u7ae0\u8282 4.7.6.1 \u4e2d\u63d0\u5230\uff0c\u4e00\u4e9b\u6d6e\u70b9\u8ba1\u7b97\u5f02\u5e38\u53ef\u80fd\u662f\u975e\u7cbe\u786e\u7684\uff0c\u5e76\u4e14\u8bf4\u4e86\u4e00\u53e5\uff1a<code>In general, it is not feasible to fix up the result value or to continue from the trap.</code>\u3002\u540c\u65f6\u7ed9\u51fa\u4e86\u4e00\u4e9b\u6761\u4ef6\uff0c\u53ea\u6709\u5f53\u6307\u4ee4\u5e8f\u5217\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u5f02\u5e38\u624d\u662f\u53ef\u4ee5\u6062\u590d\u7684\u3002\u8fd8\u6709\u4e00\u6bb5\u63cf\u8ff0\uff0c\u6458\u5f55\u5728\u8fd9\u91cc\uff1a</p> <pre><code>Alpha lets the software implementor determine the precision of\narithmetic traps.  With the Alpha architecture, arithmetic traps (such\nas overflow and underflow) are imprecise\u2014they can be delivered an\narbitrary number of instructions after the instruction that triggered\nthe trap. Also, traps from many different instructions can be reported\nat once. That makes implementations that use pipelining and multiple\nissue substantially easier to build.  However, if precise arithmetic\nexceptions are desired, trap barrier instructions can be explicitly\ninserted in the program to force traps to be delivered at specific\npoints.\n</code></pre> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u5728 Reference Manual \u4e2d\u7b2c 5.4.1 \u7ae0\u8282\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u89e6\u53d1 Arithmetic Trap \u7684\u65f6\u5019\uff0c\u4f1a\u8fdb\u5165 Kernel \u7684 entArith \u51fd\u6570\uff0c\u5e76\u63d0\u4f9b\u53c2\u6570\uff1aa0 \u8868\u793a exception summary\uff0ca1 \u8868\u793a register write mask\u3002exception summary \u53ef\u4ee5\u7528\u6765\u5224\u65ad\u53d1\u751f\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684 exception\uff0c\u6bd4\u5982 integer overflow\uff0cinexact result \u7b49\u7b49\u3002\u4e00\u4e2a\u6bd4\u8f83\u7279\u522b\u7684 exception \u7c7b\u578b\u662f software completion\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u7684\u662f\u89e6\u53d1\u5f02\u5e38\u7684\u6307\u4ee4\uff08\u4e00\u4e2a\u6216\u591a\u4e2a\uff09\u4f1a\u5199\u5165\u54ea\u4e9b\u5bc4\u5b58\u5668\uff0864 \u4f4d\uff0c\u4f4e 32 \u4f4d\u5bf9\u5e94\u6574\u6570\u5bc4\u5b58\u5668\uff0c\u9ad8 32 \u4f4d\u5bf9\u5e94\u6d6e\u70b9\u5bc4\u5b58\u5668\uff09\uff0c\u7136\u540e\u4fdd\u5b58\u4e0b\u6765\u7684 PC \u503c\u4e3a\u6700\u540e\u4e00\u6761\u6267\u884c\u7684\u6307\u4ee4\u7684\u4e0b\u4e00\u4e2a\u5730\u5740\uff0c\u4ece\u89e6\u53d1\u5f02\u5e38\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5230\u6700\u540e\u4e00\u6761\u6307\u4ee4\u5c31\u662f trap shadow\uff0c\u8fd9\u90e8\u5206\u6307\u4ee4\u53ef\u80fd\u6267\u884c\u4e86\u4e00\u90e8\u5206\uff0c\u6ca1\u6709\u6267\u884c\u4e00\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u6267\u884c\u7ed3\u679c\u662f\u9519\u8bef\u7684\u3002</p> <p>Linux \u5904\u7406\u4ee3\u7801\u5728 <code>arch/alpha/kernel/traps.c</code> \u7684 <code>do_entArith</code> \u51fd\u6570\u4e2d\u3002\u9996\u5148\u5224\u65ad\uff0c\u5982\u679c\u662f software completion\uff0c\u90a3\u5c31\u8981\u8fdb\u884c\u5904\u7406\uff1b\u5426\u5219\u76f4\u63a5 SIGFPE \u8ba9\u7a0b\u5e8f\u81ea\u5df1\u5904\u7406\u6216\u8005\u9000\u51fa\u3002\u5982\u679c\u662f\u7cbe\u786e\u5f02\u5e38\uff0c\u90a3\u5c31\u5bf9 PC-4 \u8fdb\u884c\u6d6e\u70b9\u6a21\u62df\uff1b\u5982\u679c\u662f\u975e\u7cbe\u786e\u5f02\u5e38\uff0c\u5c31\u4ece trap shadow \u7684\u6700\u540e\u4e00\u6761\u6307\u4ee4\u5f00\u59cb\u5f80\u524d\u641c\u7d22\uff0c\u5e76\u540c\u65f6\u8bb0\u5f55\u9047\u5230\u7684\u6307\u4ee4\u5199\u5165\u7684\u5bc4\u5b58\u5668\uff0c\u5982\u679c\u53d1\u73b0\u6307\u4ee4\u7684\u5199\u5165\u7684\u5bc4\u5b58\u5668\u5df2\u7ecf\u8986\u76d6\u4e86 register write mask\uff0c\u5c31\u8bf4\u660e\u627e\u5230\u4e86 trap shadow \u7684\u5f00\u5934\uff0c\u5219\u6a21\u62df\u8fd9\u6761\u6307\u4ee4\uff0c\u7136\u540e\u4ece\u4e0b\u4e00\u6761\u5f00\u59cb\u91cd\u65b0\u6267\u884c\u3002\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>long\nalpha_fp_emul_imprecise (struct pt_regs *regs, unsigned long write_mask)\n{\n    unsigned long trigger_pc = regs-&gt;pc - 4;\n    unsigned long insn, opcode, rc, si_code = 0;\n\n    /*\n     * Turn off the bits corresponding to registers that are the\n     * target of instructions that set bits in the exception\n     * summary register.  We have some slack doing this because a\n     * register that is the target of a trapping instruction can\n     * be written at most once in the trap shadow.\n     *\n     * Branches, jumps, TRAPBs, EXCBs and calls to PALcode all\n     * bound the trap shadow, so we need not look any further than\n     * up to the first occurrence of such an instruction.\n     */\n    while (write_mask) {\n        get_user(insn, (__u32 __user *)(trigger_pc));\n        opcode = insn &gt;&gt; 26;\n        rc = insn &amp; 0x1f;\n\n        switch (opcode) {\n              case OPC_PAL:\n              case OPC_JSR:\n              case 0x30 ... 0x3f:   /* branches */\n            goto egress;\n\n              case OPC_MISC:\n            switch (insn &amp; 0xffff) {\n                  case MISC_TRAPB:\n                  case MISC_EXCB:\n                goto egress;\n\n                  default:\n                break;\n            }\n            break;\n\n              case OPC_INTA:\n              case OPC_INTL:\n              case OPC_INTS:\n              case OPC_INTM:\n            write_mask &amp;= ~(1UL &lt;&lt; rc);\n            break;\n\n              case OPC_FLTC:\n              case OPC_FLTV:\n              case OPC_FLTI:\n              case OPC_FLTL:\n            write_mask &amp;= ~(1UL &lt;&lt; (rc + 32));\n            break;\n        }\n        if (!write_mask) {\n            /* Re-execute insns in the trap-shadow.  */\n            regs-&gt;pc = trigger_pc + 4;\n            si_code = alpha_fp_emul(trigger_pc);\n            goto egress;\n        }\n        trigger_pc -= 4;\n    }\n\negress:\n    return si_code;\n}\n</code></pre> <p>ARM \u67b6\u6784\u4e5f\u6709 imprecise asynchronous external abort\uff1a</p> <pre><code>Normally, external aborts are rare. An imprecise asynchronous external\nabort is likely to be fatal to the process that is running. An example\nof an event that might cause an external abort is an uncorrectable\nparity or ECC failure on a Level 2 Memory structure.\n\nBecause imprecise asynchronous external aborts are normally fatal to the\nprocess that caused them, ARM recommends that implementations make\nexternal aborts precise wherever possible.\n</code></pre> <p>\u4e0d\u8fc7\u8fd9\u66f4\u591a\u662f\u56e0\u4e3a\u5185\u5b58\u7684\u65e0\u6cd5\u9884\u77e5\u7684\u9519\u8bef\uff0c\u8fd9\u79cd\u65f6\u5019\u673a\u5668\u76f4\u63a5\u53ef\u4ee5\u62ff\u53bb\u7ef4\u4fee\u4e86\u3002</p> <p>\u6587\u7ae0 \u63d0\u5230\u4e86\u4e24\u4e2a precise/imprecise async/sync\u7684\u4f8b\u5b50\uff1a</p> <ol> <li>\u5916\u90e8\u4e2d\u65ad\u662f\u5f02\u6b65\u7684\uff0c\u540c\u65f6\u4e5f\u662f precise \u7684\u3002</li> <li>\u5bf9\u4e8e\u4e00\u4e2a Write-allocate \u7684\u7f13\u5b58\uff0c\u5982\u679c\u7a0b\u5e8f\u5199\u5165\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u7269\u7406\u5730\u5740\uff0c\u90a3\u4e48\u5199\u5165\u7f13\u5b58\u7684\u65f6\u5019\u4e0d\u4f1a\u51fa\u73b0\u9519\u8bef\uff0c\u4f46\u5f53\u8fd9\u4e2a cache line \u88ab\u5199\u5165\u5230\u603b\u7ebf\u4e0a\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e6\u53d1\u5f02\u5e38\uff0c\u8fd9\u4e2a\u5f02\u5e38\u662f\u5f02\u6b65\u5e76\u4e14\u975e\u7cbe\u786e\u7684\uff0c\u56e0\u4e3a\u4e4b\u524d\u89e6\u53d1\u8fd9\u4e2a\u5f02\u5e38\u7684\u6307\u4ee4\u53ef\u80fd\u5df2\u7ecf\u5b8c\u6210\u5f88\u4e45\u4e86\u3002\u8fd9\u79cd\u65f6\u5019\u8fd9\u4e2a\u8fdb\u7a0b\u4e5f\u5927\u6982\u7387\u6ca1\u6551\u4e86\uff0c\u76f4\u63a5 SIGBUS \u9000\u51fa\u3002</li> </ol>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/09/14/brief-into-ooo/#\u5904\u7406\u5668\u4eff\u771f\u6a21\u578b","title":"\u5904\u7406\u5668\u4eff\u771f\u6a21\u578b","text":"<p>\u6700\u540e\u5217\u4e3e\u4e00\u4e0b\u79d1\u7814\u91cc\u5e38\u7528\u7684\u4e00\u4e9b\u5904\u7406\u5668\u4eff\u771f\u6a21\u578b\uff1a</p> <ul> <li>gem5: \u8bba\u6587 The gem5 Simulator: Version 20.0+ \u4ee3\u7801</li> <li>Multi2Sim: \u8bba\u6587 Multi2Sim: A simulation framework for CPU-GPU computing \u4ee3\u7801</li> <li>Scarab: \u4ee3\u7801</li> <li>Sniper: \u8bba\u6587 Sniper: exploring the level of abstraction for scalable and accurate parallel multi-core simulation \u5b98\u7f51 \u4ed3\u5e93</li> <li>ZSim: \u8bba\u6587 ZSim: fast and accurate microarchitectural simulation of thousand-core systems \u4ee3\u7801</li> <li>PTLsim: \u8bba\u6587 PTLsim: A Cycle Accurate Full System x86-64 Microarchitectural Simulator</li> </ul>","tags":["ooo","cpu","tomasulo","outoforder","renaming","brief-into-ooo"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/","title":"\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u300a\u9ad8\u7b49\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u300b\u8bfe\u7a0b\u4e2d\u5b66\u4e60\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u7b97\u6cd5\uff0c\u8fd9\u91cc\u7528\u81ea\u5df1\u7684\u8bed\u8a00\u6765\u7ec4\u7ec7\u4e00\u4e0b\u76f8\u5173\u77e5\u8bc6\u7684\u8bb2\u89e3\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#write-invalidate-\u548c-write-update","title":"Write-invalidate \u548c Write-update","text":"<p>\u6700\u57fa\u7840\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u601d\u60f3\u6709\u4e24\u79cd\uff1a</p> <ol> <li>Write-invalidate\uff1a\u5199\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c06\u5176\u4ed6 Cache \u4e2d\u8fd9\u6761 Cache Line \u8bbe\u4e3a Invalid</li> <li>Write-update\uff1a\u5199\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u628a\u65b0\u7684\u7ed3\u679c\u5199\u5165\u5230\u6709\u8fd9\u6761 Cache Line \u7684\u5176\u4ed6 Cache</li> </ol>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#write-once-\u534f\u8bae","title":"Write-once \u534f\u8bae","text":"<p>Write-once \u534f\u8bae\u5b9a\u4e49\u4e86\u56db\u4e2a\u72b6\u6001\uff1a</p> <ol> <li>Invalid\uff1a\u8868\u793a\u8fd9\u4e2a\u5757\u4e0d\u5408\u6cd5</li> <li>Valid\uff1a\u8868\u793a\u8fd9\u4e2a\u5757\u5408\u6cd5\uff0c\u5e76\u53ef\u80fd\u662f\u5171\u4eab\u7684\uff0c\u540c\u65f6\u6570\u636e\u6ca1\u6709\u4fee\u6539</li> <li>Reserved\uff1a\u8868\u793a\u8fd9\u4e2a\u5757\u5408\u6cd5\uff0c\u4e0d\u662f\u5171\u4eab\u7684\uff0c\u540c\u65f6\u6570\u636e\u6ca1\u6709\u66f4\u6539</li> <li>Dirty\uff1a\u8868\u793a\u8fd9\u4e2a\u5757\u5408\u6cd5\uff0c\u4e0d\u662f\u5171\u4eab\u7684\uff0c\u6570\u636e\u505a\u4e86\u4fee\u6539\uff0c\u548c\u5185\u5b58\u4e0d\u540c\u3002</li> </ol> <p>\u53ef\u89c1\uff0c\u5f53\u4e00\u4e2a\u7f13\u5b58\u72b6\u6001\u5728 R \u6216\u8005 D\uff0c\u5176\u4ed6\u7f13\u5b58\u53ea\u80fd\u662f I\uff1b\u800c\u7f13\u5b58\u72b6\u6001\u662f V \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\u7f13\u5b58\u5728 V \u72b6\u6001\u3002</p> <p>Write-once \u534f\u8bae\u7684\u7279\u70b9\u662f\uff0c\u7b2c\u4e00\u6b21\u5199\u7684\u65f6\u5019\uff0c\u4f1a\u5199\u5165\u5230\u5185\u5b58\uff08\u7c7b\u4f3c Write-through\uff09\uff0c\u8fde\u7eed\u5199\u5165\u5219\u53ea\u5199\u5230\u7f13\u5b58\u4e2d\uff0c\u7c7b\u4f3c Write-back\u3002</p> <p>\u5f53 Read hit \u7684\u65f6\u5019\uff0c\u72b6\u6001\u4e0d\u53d8\u3002</p> <pre><code>Read hit: The information is supplied by the current cache. No state change.\n</code></pre> <p>\u5f53 Read miss \u7684\u65f6\u5019\uff0c\u4f1a\u67e5\u770b\u6240\u6709\u7f13\u5b58\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7f13\u5b58\u5904\u4e8e Valid/Reserved/Dirty \u72b6\u6001\uff0c\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u5904\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u8bbe\u4e3a Valid\uff0c\u5176\u4ed6\u7f13\u5b58\u4e5f\u8bbe\u4e3a Valid\u3002\u5982\u679c\u5176\u4ed6\u7f13\u5b58\u5904\u4e8e Dirty \u72b6\u6001\uff0c\u8fd8\u8981\u628a\u6570\u636e\u5199\u5165\u5185\u5b58\u3002</p> <pre><code>Read miss: The data is read from main memory. The read is snooped by other caches; if any of them have the line in the Dirty state, the read is interrupted long enough to write the data back to memory before it is allowed to continue. Any copies in the Dirty or Reserved states are set to the Valid state.\n</code></pre> <p>\u5f53 Write hit \u7684\u65f6\u5019\uff0c\u5982\u679c\u662f Valid \u72b6\u6001\uff0c\u9996\u5148\u5199\u5165\u5185\u5b58\uff0c\u628a\u5176\u4ed6 Cache \u90fd\u8bbe\u4e3a Invalid\uff0c\u8fdb\u5165 Reserved \u72b6\u6001\uff0c\u8fd9\u610f\u5473\u7740\u7b2c\u4e00\u6b21\u5199\u662f Write-through\u3002\u5982\u679c\u662f Reserved/Dirty \u72b6\u6001\uff0c\u5219\u4e0d\u4fee\u6539\u5185\u5b58\uff0c\u8fdb\u5165 Dirty \u72b6\u6001\uff0c\u8fd9\u8868\u793a\u540e\u7eed\u7684\u5199\u5165\u90fd\u662f Write-back\u3002</p> <pre><code>Write hit: If the information in the cache is in Dirty or Reserved state, the cache line is updated in place and its state is set to Dirty without updating memory. If the information is in Valid state, a write-through operation is executed updating the block and the memory and the block state is changed to Reserved. Other caches snoop the write and set their copies to Invalid.\n</code></pre> <p>\u5f53 Write miss \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u884c\u4e3a Wikipedia \u4e0a\u548c\u4e0a\u8bfe\u8bb2\u7684\u4e0d\u4e00\u6837\u3002\u6309\u7167 Wikipedia \u7684\u8bf4\u6cd5\uff0c\u9996\u5148\u6309\u7167 Read miss \u5904\u7406\uff0c\u518d\u6309\u7167 Write hit \u5904\u7406\uff0c\u7c7b\u4f3c\u4e8e Write Allocate \u7684\u601d\u8def\u3002\u5982\u679c\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u90a3\u4e48\u9996\u5148\u4ece\u5176\u4ed6\u7f13\u5b58\u6216\u8005\u5185\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u628a\u5176\u4ed6\u7f13\u5b58\u90fd\u8bbe\u4e3a Invalid\uff0c\u628a\u66f4\u65b0\u540e\u7684\u6570\u636e\u5199\u5165\u5185\u5b58\uff0c\u8fdb\u5165 Reserved \u72b6\u6001\u3002\u76f8\u5f53\u4e8e Write miss \u7684\u65f6\u5019\uff0c\u4e5f\u662f\u6309\u7167 Write-through \u5b9e\u73b0\u3002</p> <pre><code>Write miss: A partial cache line write is handled as a read miss (if necessary to fetch the unwritten portion of the cache line) followed by a write hit. This leaves all other caches in the Invalid state, and the current cache in the Reserved state.\n</code></pre> <p>\u6559\u6750\u4e0a\u5219\u662f Write miss \u7684\u65f6\u5019\u6309\u7167 Write-back \u5904\u7406\u3002\u5982\u679c\u5176\u4ed6\u7f13\u5b58\u90fd\u662f Invalid \u65f6\uff0c\u4ece\u5185\u5b58\u91cc\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u5199\u5165\u5230\u7f13\u5b58\u4e2d\uff0c\u8fdb\u5165 Dirty \u72b6\u6001\u3002\u5982\u679c\u5176\u4ed6\u7f13\u5b58\u662f Valid/Reserved/Dirty \u72b6\u6001\uff0c\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u91cc\u8bfb\u53d6\u6570\u636e\uff0c\u8ba9\u5176\u4ed6\u7f13\u5b58\u90fd\u8fdb\u5165 Invalid \u72b6\u6001\uff0c\u7136\u540e\u66f4\u65b0\u81ea\u5df1\u7684\u6570\u636e\uff0c\u8fdb\u5165 Dirty \u72b6\u6001\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#msi-\u534f\u8bae","title":"MSI \u534f\u8bae","text":"<p>MSI \u534f\u8bae\u6bd4\u8f83\u7b80\u5355\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e09\u4e2a\u72b6\u6001\uff1a</p> <ol> <li>Modified\uff1a\u8868\u793a\u6570\u636e\u5df2\u7ecf\u4fee\u6539\uff0c\u548c\u5185\u5b58\u91cc\u4e0d\u4e00\u81f4</li> <li>Shared\uff1a\u6570\u636e\u548c\u5185\u5b58\u4e00\u81f4\uff0c\u53ef\u4ee5\u6709\u4e00\u5230\u591a\u4e2a\u7f13\u5b58\u540c\u65f6\u5904\u5728 Shared \u72b6\u6001</li> <li>Invalid\uff1a\u4e0d\u5728\u7f13\u5b58\u4e2d</li> </ol> <p>\u5f53 Read hit \u7684\u65f6\u5019\uff0c\u72b6\u6001\u4e0d\u53d8\u3002</p> <p>\u5f53 Read miss \u7684\u65f6\u5019\uff0c\u68c0\u67e5\u5176\u4ed6\u7f13\u5b58\u7684\u72b6\u6001\uff0c\u5982\u679c\u90fd\u662f Invalid\uff0c\u5c31\u4ece\u5185\u5b58\u91cc\u8bfb\u53d6\uff0c\u7136\u540e\u8fdb\u5165 Shared \u72b6\u6001\u3002\u5982\u679c\u6709 Shared\uff0c\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u5904\u8bfb\u53d6\u3002\u5982\u679c\u6709 Dirty\uff0c\u90a3\u5c31\u8981\u628a\u5176\u4ed6\u7f13\u5b58\u7684\u6570\u636e\u5199\u5165\u5185\u5b58\u548c\u672c\u5730\u7f13\u5b58\uff0c\u7136\u540e\u8fdb\u5165 Shared \u72b6\u6001\u3002</p> <p>\u5f53 Write hit \u7684\u65f6\u5019\uff0c\u5982\u679c\u73b0\u5728\u662f Shared \u72b6\u6001\uff0c\u5219\u8981\u8ba9\u5176\u4ed6\u7684 Shared \u7f13\u5b58\u8fdb\u5165 Invalid \u72b6\u6001\uff0c\u7136\u540e\u66f4\u65b0\u6570\u636e\uff0c\u8fdb\u5165 Modified \u72b6\u6001\u3002\u5982\u679c\u662f Modified \u72b6\u6001\uff0c\u90a3\u5c31\u4fee\u6539\u6570\u636e\uff0c\u72b6\u6001\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u5f53 Write miss \u7684\u65f6\u5019\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7f13\u5b58\u5904\u4e8e Modified/Shared \u72b6\u6001\uff0c\u90a3\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u5904\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u8ba9\u5176\u4ed6\u7f13\u5b58\u8fdb\u5165 Invalid \u72b6\u6001\uff0c\u7136\u540e\u4fee\u6539\u672c\u5730\u6570\u636e\uff0c\u8fdb\u5165 Modified \u72b6\u6001\u3002\u5982\u679c\u6240\u6709\u7f13\u5b58\u90fd\u662f Invalid \u72b6\u6001\uff0c\u90a3\u5c31\u4ece\u5185\u5b58\u8bfb\u5165\uff0c\u7136\u540e\u4fee\u6539\u7f13\u5b58\u6570\u636e\uff0c\u8fdb\u5165 Modified \u72b6\u6001\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#mesi-\u534f\u8bae","title":"MESI \u534f\u8bae","text":"<p>MESI \u534f\u8bae\u5b9a\u4e49\u4e86\u56db\u79cd\u72b6\u6001\uff1a</p> <ol> <li>Modified\uff1a\u6570\u636e\u4e0e\u5185\u5b58\u4e0d\u4e00\u81f4\uff0c\u5e76\u4e14\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u6570\u636e</li> <li>Exclusive\uff1a\u6570\u636e\u4e0e\u5185\u5b58\u4e00\u81f4\uff0c\u5e76\u4e14\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u6570\u636e</li> <li>Shared\uff1a\u6570\u636e\u4e0e\u5185\u5b58\u4e00\u81f4\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\u7f13\u5b58\u540c\u65f6\u6709\u6570\u636e</li> <li>Invalid\uff1a\u4e0d\u5728\u7f13\u5b58\u4e2d</li> </ol> <p>\u5f53 Read hit \u7684\u65f6\u5019\uff0c\u72b6\u6001\u4e0d\u53d8\u3002</p> <p>\u5f53 Read miss \u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u68c0\u67e5\u5176\u4ed6\u7f13\u5b58\u7684\u72b6\u6001\uff0c\u5982\u679c\u6709\u6570\u636e\uff0c\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u4e14\u90fd\u8fdb\u5165 Shared \u72b6\u6001\uff0c\u5982\u679c\u5176\u4ed6\u7f13\u5b58\u5904\u4e8e Modified \u72b6\u6001\uff0c\u8fd8\u9700\u8981\u628a\u6570\u636e\u5199\u5165\u5185\u5b58\uff1b\u5982\u679c\u5176\u4ed6\u7f13\u5b58\u90fd\u6ca1\u6709\u6570\u636e\uff0c\u5c31\u4ece\u5185\u5b58\u91cc\u8bfb\u53d6\uff0c\u7136\u540e\u8fdb\u5165 Exclusive \u72b6\u6001\u3002</p> <p>\u5f53 Write hit \u7684\u65f6\u5019\uff0c\u8fdb\u5165 Modified \u72b6\u6001\uff0c\u540c\u65f6\u8ba9\u5176\u4ed6\u7f13\u5b58\u8fdb\u5165 Invalid \u72b6\u6001\u3002</p> <p>\u5f53 Write miss \u7684\u65f6\u5019\uff0c\u68c0\u67e5\u5176\u4ed6\u7f13\u5b58\u7684\u72b6\u6001\uff0c\u5982\u679c\u6709\u6570\u636e\uff0c\u5c31\u4ece\u5176\u4ed6\u7f13\u5b58\u8bfb\u53d6\uff0c\u5426\u5219\u4ece\u5185\u5b58\u8bfb\u53d6\u3002\u7136\u540e\uff0c\u5176\u4ed6\u7f13\u5b58\u90fd\u8fdb\u5165 Invalid \u72b6\u6001\uff0c\u672c\u5730\u7f13\u5b58\u66f4\u65b0\u6570\u636e\uff0c\u8fdb\u5165 Modified \u72b6\u6001\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cShared \u72b6\u6001\u4e0d\u4e00\u5b9a\u8868\u793a\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u6570\u636e\uff1a\u6bd4\u5982\u672c\u6765\u6709\u4e24\u4e2a\u7f13\u5b58\u90fd\u662f Shared \u72b6\u6001\uff0c\u7136\u540e\u5176\u4e2d\u4e00\u4e2a\u56e0\u4e3a\u7f13\u5b58\u66ff\u6362\u53d8\u6210\u4e86 Invalid\uff0c\u90a3\u4e48\u53e6\u4e00\u4e2a\u662f\u4e0d\u4f1a\u53d7\u5230\u901a\u77e5\u53d8\u6210 Exclusive \u7684\u3002Exclusive \u7684\u8bbe\u7f6e\u662f\u4e3a\u4e86\u51cf\u5c11\u4e00\u4e9b\u603b\u7ebf\u8bf7\u6c42\uff0c\u6bd4\u5982\u5f53\u6570\u636e\u53ea\u6709\u4e00\u4e2a\u6838\u5fc3\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u53ea\u6709\u7b2c\u4e00\u6b21 Read miss \u4f1a\u53d1\u9001\u603b\u7ebf\u8bf7\u6c42\uff0c\u4e4b\u540e\u4e00\u76f4\u5728 Exclusive/Modified \u72b6\u6001\u4e2d\uff0c\u4e0d\u9700\u8981\u53d1\u9001\u603b\u7ebf\u8bf7\u6c42\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#moesi-\u534f\u8bae","title":"MOESI \u534f\u8bae","text":"<p>MOESI \u5b9a\u4e49\u4e86\u4e94\u4e2a\u72b6\u6001\uff1a</p> <ol> <li>Modified\uff1a\u6570\u636e\u7ecf\u8fc7\u4fee\u6539\uff0c\u5e76\u4e14\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u6570\u636e</li> <li>Owned\uff1a\u540c\u65f6\u6709\u591a\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u6570\u636e\uff0c\u4f46\u662f\u53ea\u6709\u8fd9\u4e2a\u7f13\u5b58\u53ef\u4ee5\u4fee\u6539\u6570\u636e</li> <li>Exclusive\uff1a\u6570\u636e\u6ca1\u6709\u4fee\u6539\uff0c\u5e76\u4e14\u53ea\u6709\u4e00\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u6570\u636e</li> <li>Shared\uff1a\u540c\u65f6\u6709\u591a\u4e2a\u7f13\u5b58\u6709\u8fd9\u4e2a\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u80fd\u4fee\u6539\u6570\u636e</li> <li>Invalid\uff1a\u4e0d\u5728\u7f13\u5b58\u4e2d</li> </ol> <p>\u72b6\u6001\u4e2d\uff0cM \u548c E \u662f\u72ec\u5360\u7684\uff0c\u6240\u6709\u7f13\u5b58\u91cc\u53ea\u80fd\u6709\u4e00\u4e2a\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u540c\u65f6\u6709\u591a\u4e2a S\uff0c\u6216\u8005\u591a\u4e2a S \u52a0\u4e00\u4e2a O\uff0c\u4f46\u662f\u4e0d\u80fd\u540c\u65f6\u6709\u591a\u4e2a O\u3002</p> <p>\u5b83\u7684\u72b6\u6001\u8f6c\u79fb\u4e0e MESI \u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\uff1a\u5f53\u6838\u5fc3\u5199\u5165 Owned \u72b6\u6001\u7684\u7f13\u5b58\u65f6\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a1\uff09\u901a\u77e5\u5176\u4ed6 Shared \u7684\u7f13\u5b58\u66f4\u65b0\u6570\u636e\uff1b2\uff09\u628a\u5176\u4ed6 Shared \u7f13\u5b58\u8bbe\u4e3a Invalid\uff0c\u7136\u540e\u672c\u5730\u7f13\u5b58\u8fdb\u5165 Modified \u72b6\u6001\u3002\u5728 Read miss \u7684\u65f6\u5019\uff0c\u5219\u53ef\u4ee5\u4ece Owned \u7f13\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u8fdb\u5165 Shared \u72b6\u6001\uff0c\u800c\u4e0d\u7528\u5199\u5165\u5185\u5b58\u3002\u5b83\u76f8\u6bd4 MESI \u7684\u597d\u5904\u662f\uff0c\u51cf\u5c11\u4e86\u5199\u56de\u5185\u5b58\u7684\u6b21\u6570\u3002</p> <p>AMD64 \u6587\u6863\u91cc\u91c7\u7528\u7684\u5c31\u662f MOESI \u534f\u8bae\u3002AMBA ACE \u534f\u8bae\u5176\u5b9e\u4e5f\u662f MOESI \u534f\u8bae\uff0c\u53ea\u4e0d\u8fc7\u6362\u4e86\u4e00\u4e9b\u540d\u79f0\uff0c\u8868\u793a\u53ef\u4ee5\u517c\u5bb9 MEI/MESI/MOESI \u4e2d\u7684\u4e00\u4e2a\u534f\u8bae\u3002ACE \u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSharedClean \u5e76\u4e0d\u4ee3\u8868\u5b83\u7684\u6570\u636e\u548c\u5185\u5b58\u4e00\u81f4\uff0c\u6bd4\u5982\u8bf4\u548c SharedDirty \u7f13\u5b58\u4e00\u81f4\uff0c\u5b83\u53ea\u662f\u8bf4\u7f13\u5b58\u66ff\u6362\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u5199\u56de\u5185\u5b58\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#dragon-\u534f\u8bae","title":"Dragon \u534f\u8bae","text":"<p>Dragon \u534f\u8bae\u662f\u4e00\u4e2a\u57fa\u4e8e\u66f4\u65b0\u7684\u534f\u8bae\uff0c\u610f\u5473\u7740\u5199\u5165\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u66f4\u65b0\u7684\u6570\u636e\u540c\u6b65\u5230\u62e5\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u5176\u4ed6\u6838\u5fc3\u3002\u5b83\u5b9a\u4e49\u4e86\u56db\u4e2a\u72b6\u6001\uff1a</p> <ol> <li>Exclusive clean(E)\uff1a\u72ec\u5360\uff0c\u5e76\u4e14\u6570\u636e\u548c\u5185\u5b58\u4e00\u81f4</li> <li>Shared clean(Sc)\uff1a\u6570\u636e\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e14\u81ea\u5df1\u4e0d\u662f\u6700\u540e\u4e00\u4e2a\u5199\u5165\u8be5\u7f13\u5b58\u6570\u636e\u7684</li> <li>Shared modified(Sm)\uff1a\u6570\u636e\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e14\u81ea\u5df1\u8bbe\u6700\u540e\u4e00\u4e2a\u5199\u5165\u8be5\u7f13\u5b58\u6570\u636e\u7684\uff0c\u7c7b\u4f3c\u4e8e\u524d\u9762 MOESI \u534f\u8bae\u7684 Owner \u72b6\u6001</li> <li>Modify(M)\uff1a\u72ec\u5360\uff0c\u5e76\u4e14\u6570\u636e\u548c\u5185\u5b58\u4e0d\u4e00\u81f4</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0cE \u548c M \u90fd\u662f\u72ec\u5360\u7684\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u591a\u4e2a\u7f13\u5b58\u6709\u540c\u4e00\u4e2a\u7f13\u5b58\u884c\uff0c\u90a3\u5c31\u662f\u82e5\u5e72\u4e2a Sc \u548c\u4e00\u4e2a Sm\u3002</p> <p>\u5f53 Read miss \u7684\u65f6\u5019\uff0c\u5728\u603b\u7ebf\u4e0a\u68c0\u67e5\u662f\u5426\u6709\u7f13\u5b58\u5df2\u7ecf\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4ece\u5185\u5b58\u8bfb\u53d6\u5e76\u8f6c\u5230 Exclusive clean \u72b6\u6001\uff1b\u5982\u679c\u5df2\u7ecf\u5728\u5176\u4ed6\u7f13\u5b58\u4e2d\uff0c\u5219\u4ece\u5176\u4ed6\u7f13\u5b58\u8bfb\u53d6\uff0c\u5c06\u5176\u4ed6\u7f13\u5b58\u8f6c\u79fb\u5230 Shared clean/Shared modified \u72b6\u6001\uff0c\u7136\u540e\u8be5\u7f13\u5b58\u8f6c\u79fb\u5230 Shared clean \u72b6\u6001\u3002</p> <p>\u5f53 Write miss \u7684\u65f6\u5019\uff0c\u540c\u6837\u68c0\u67e5\u5176\u4ed6\u7f13\u5b58\u7684\u72b6\u6001\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u4e2a\u8bbf\u95ee\u7684\uff0c\u5c31\u4ece\u5185\u5b58\u8bfb\u53d6\uff0c\u66f4\u65b0\u6570\u636e\uff0c\u7136\u540e\u8f6c\u5230 Modify \u72b6\u6001\uff1b\u5982\u679c\u4e0d\u662f\u7b2c\u4e00\u4e2a\u8bbf\u95ee\u7684\uff0c\u5c31\u8fdb\u5165 Shared modified \u72b6\u6001\uff0c\u5e76\u4e14\u8ba9\u539f\u6765 Shared modified \u7684\u7f13\u5b58\u8fdb\u5165 Shared clean \u72b6\u6001\u3002</p> <p>\u5f53 Write hit \u7684\u65f6\u5019\uff0c\u5982\u679c\u72b6\u6001\u662f Shared modified\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u901a\u77e5\u5176\u4ed6\u7f13\u5b58\u66f4\u65b0\u6570\u636e\uff1b\u5982\u679c\u72b6\u6001\u662f Shared clean\uff0c\u5219\u8981\u901a\u77e5\u5176\u4ed6\u7f13\u5b58\u66f4\u65b0\u6570\u636e\u7684\u540c\u65f6\uff0c\u8ba9\u539f\u6765 Shared modified \u7684\u7f13\u5b58\u8fdb\u5165 Shared clean \u72b6\u6001\uff1b\u5982\u679c\u72b6\u6001\u662f Exclusive clean\uff0c\u5219\u8fdb\u5165 Modify \u72b6\u6001\u3002</p> <p>\u5728\u8fd9\u91cc\uff0cShared modified \u7684\u7f13\u5b58\u8d1f\u8d23\u5728\u6362\u51fa\u7684\u65f6\u5019\uff0c\u5199\u5165\u6570\u636e\u5230\u5185\u5b58\u4e2d\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#ace-\u534f\u8bae","title":"ACE \u534f\u8bae","text":"<p>ACE \u534f\u8bae\u5728 AXI \u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u4e86\u4e09\u4e2a channel\uff1a</p> <ol> <li>AC: Coherent address channel, Input to master: ACADDR, ACSNOOP, ACPROT</li> <li>CR: Coherent response channel, Output from master: CRRESP</li> <li>CD: Coherent data channel, Output from master: CDDATA, CDLAST</li> </ol> <p>\u6b64\u5916\uff0c\u5df2\u6709\u7684 Channel \u4e5f\u6dfb\u52a0\u4e86\u4fe1\u53f7\uff1a</p> <ol> <li>ARSNOOP[3:0]/ARBAR[1:0]/ARDOMAIN[1:0]</li> <li>AWSNOOP[3:0]/AWBAR[1:0]/AWDOMAIN[1:0]/AWUNIQUE</li> <li>RRESP[3:2]</li> <li>RACK/WACK</li> </ol> <p>ACE-lite \u53ea\u5728\u5df2\u6709 Channel \u4e0a\u6dfb\u52a0\u4e86\u65b0\u4fe1\u53f7\uff0c\u6ca1\u6709\u6dfb\u52a0\u65b0\u7684 Channel\u3002\u56e0\u6b64\u5b83\u5185\u90e8\u4e0d\u80fd\u6709 Cache\uff0c\u4f46\u662f\u53ef\u4ee5\u8bbf\u95ee\u4e00\u81f4\u7684\u7f13\u5b58\u5185\u5bb9\u3002</p> <p>\u5f53 Read miss \u7684\u65f6\u5019\uff0c\u9996\u5148 AXI master \u53d1\u9001 read transaction \u7ed9 Interconnect\uff0cInterconnect \u5411\u4fdd\u5b58\u4e86\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u7f13\u5b58\u53d1\u9001 AC \u8bf7\u6c42\uff0c\u5982\u679c\u6709\u5176\u4ed6 master \u63d0\u4f9b\u4e86\u6570\u636e\uff0c\u5c31\u5411\u8bf7\u6c42\u7684 master \u8fd4\u56de\u6570\u636e\uff1b\u5982\u679c\u6ca1\u6709\u5176\u4ed6 master \u63d0\u4f9b\u6570\u636e\uff0c\u5219\u5411\u5185\u5b58\u53d1\u8d77\u8bfb\u8bf7\u6c42\uff0c\u5e76\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9 master\uff0c\u6700\u540e master \u63d0\u4f9b RACK \u4fe1\u53f7\u3002</p> <p>\u5f53 Write miss \u7684\u65f6\u5019\uff0c\u4e5f\u662f\u7c7b\u4f3c\u5730\uff0cAXI master \u53d1\u9001 MakeUnique \u8bf7\u6c42\u7ed9 Interconnect\uff0cInterconnect \u5411\u4fdd\u5b58\u4e86\u8be5\u7f13\u5b58\u884c\u7684\u7f13\u5b58\u53d1\u9001\u8bf7\u6c42\uff0c\u8981\u6c42\u5176\u4ed6 master \u72b6\u6001\u6539\u4e3a Invalid\uff1b\u5f53\u6240\u6709 master \u90fd\u5df2\u7ecf invalidate \u6210\u529f\uff0c\u5c31\u5411\u539f AXI master \u8fd4\u56de\u7ed3\u679c\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#\u57fa\u4e8e\u76ee\u5f55\u7684\u7f13\u5b58\u4e00\u81f4\u6027","title":"\u57fa\u4e8e\u76ee\u5f55\u7684\u7f13\u5b58\u4e00\u81f4\u6027","text":"<p>\u4e0a\u9762\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u4e2d\uff0c\u7ecf\u5e38\u6709\u8fd9\u4e48\u4e00\u4e2a\u64cd\u4f5c\uff1a\u5411\u6240\u6709\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u7f13\u5b58\u53d1\u9001/\u63a5\u53d7\u6d88\u606f\u3002\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u76f4\u63a5\u5e7f\u64ad\uff0c\u7136\u540e\u63a5\u53d7\u7aef\u81ea\u5df1\u5224\u65ad\u662f\u5426\u5904\u7406\u3002\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u5728\u6838\u5fc3\u5f88\u591a\u7684\u65f6\u5019\u4f1a\u5bfc\u81f4\u5e7f\u64ad\u6d41\u91cf\u592a\u5927\uff0c\u56e0\u6b64\u9700\u8981\u5148\u4fdd\u5b58\u4e0b\u6765\u54ea\u4e9b\u7f13\u5b58\u4f1a\u6709\u8fd9\u4e2a\u7f13\u5b58\u7684\u4fe1\u606f\uff0c\u7136\u540e\u5bf9\u8fd9\u4e9b\u7f13\u5b58\u70b9\u5bf9\u70b9\u5730\u53d1\u9001\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7701\u4e00\u4e9b\u7f51\u7edc\u6d41\u91cf\u3002</p> <p>\u90a3\u4e48\uff0c\u600e\u4e48\u8bb0\u5f55\u8fd9\u4e2a\u4fe1\u606f\u5462\uff1f\u4e00\u4e2a\u7b80\u5355\u7684\u529e\u6cd5\uff08Full bit vector format\uff09\u662f\uff0c\u6709\u4e00\u4e2a\u5168\u5c40\u7684\u8868\uff0c\u5bf9\u6bcf\u4e2a\u7f13\u5b58\u884c\uff0c\u90fd\u8bb0\u5f55\u4e00\u4e2a\u5927\u5c0f\u4e3a N\uff08N \u4e3a\u6838\u5fc3\u6570\uff09\u7684\u4f4d\u5411\u91cf\uff0c1 \u8868\u793a\u5bf9\u5e94\u7684\u6838\u5fc3\u4e2d\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\u3002\u4f46\u8fd9\u4e2a\u65b9\u6cd5\u4fdd\u5b58\u6570\u636e\u91cf\u592a\u5927\uff1a\u7f13\u5b58\u884c\u6570\u6b63\u6bd4\u4e8e N\uff0c\u8fd8\u8981\u518d\u4e58\u4ee5\u4e00\u6b21 N\uff0c\u603b\u5bb9\u91cf\u662f O(N^2) \u7684\u3002</p> <p>\u4e00\u4e2a\u7a0d\u5fae\u597d\u4e00\u4e9b\u7684\u65b9\u6cd5\uff08Coarse bit vector format\uff09\u662f\uff0c\u6211\u628a\u6838\u5fc3\u5206\u7ec4\uff0c\u6bd4\u5982\u6309\u7167 NUMA \u8282\u70b9\u8fdb\u884c\u5212\u5206\uff0c\u6b64\u65f6\u6bcf\u4e2a\u7f13\u5b58\u884c\u90fd\u4fdd\u5b58\u4e00\u4e2a\u5927\u5c0f\u4e3a M\uff08M \u4e3a NUMA \u6570\u91cf\uff09\u7684\u4f4d\u5411\u91cf\uff0c\u53ea\u8981\u8fd9\u4e2a NUMA \u8282\u70b9\u91cc\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\uff0c\u5bf9\u5e94\u4f4d\u5c31\u53d6 1\u3002\u8fd9\u6837\u76f8\u5f53\u4e8e\u662f\u4ee5\u727a\u7272\u4e00\u90e8\u5206\u6d41\u91cf\u4e3a\u4ee3\u4ef7\uff08NUMA \u8282\u70b9\u5185\u90e8\u5e7f\u64ad\uff09\uff0c\u6765\u8282\u7701\u4e00\u4e9b\u76ee\u5f55\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u7f13\u5b58\u884c\u901a\u5e38\u53ea\u4f1a\u5728\u5f88\u5c11\u7684\u6838\u5fc3\u4e2d\u4fdd\u5b58\uff0c\u6240\u4ee5\u8fd9\u91cc\u6709\u5f88\u5927\u7684\u4f18\u5316\u7a7a\u95f4\u3002\u6bd4\u5982\u8bf4\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u7f13\u5b58\u884c\u540c\u65f6\u51fa\u73b0\u7684\u7f13\u5b58\u6570\u91cf\u4e0a\u9650 (Limited pointer format)\uff0c\u7136\u540e\u4fdd\u5b58\u6838\u5fc3\u7684\u4e0b\u6807\u800c\u4e0d\u662f\u4f4d\u5411\u91cf\uff0c\u8fd9\u6837\u7684\u5b58\u50a8\u7a7a\u95f4\u5c31\u662f O(Nlog2N)\u3002\u4f46\u662f\u5462\uff0c\u8fd9\u6837\u9650\u5236\u4e86\u7f13\u5b58\u884c\u540c\u65f6\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\u4e0a\u9650\uff0c\u9700\u8981\u66ff\u6362\u6389\u5df2\u6709\u7684\u7f13\u5b58\uff0c\u53ef\u80fd\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u6027\u80fd\u4f1a\u964d\u4f4e\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u65b9\u5f0f\uff0c\u5c31\u662f\u94fe\u8868 (Chained directory format)\u3002\u76ee\u5f55\u4e2d\u4fdd\u5b58\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u7684\u6838\u5fc3\u7f16\u53f7\uff0c\u7136\u540e\u6bcf\u4e2a\u6838\u5fc3\u7684\u7f13\u5b58\u91cc\uff0c\u4fdd\u5b58\u4e86\u4e0b\u4e00\u4e2a\u4fdd\u5b58\u4e86\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u6838\u5fc3\u7f16\u53f7\uff0c\u6216\u8005\u8868\u793a\u94fe\u8868\u7ec8\u6b62\u3002\u8fd9\u6837\u5b58\u50a8\u7a7a\u95f4\u4e5f\u662f O(Nlog2N)\uff0c\u4e0d\u8fc7\u53d1\u9001\u6d88\u606f\u7684\u5ef6\u8fdf\u66f4\u957f\uff0c\u56e0\u4e3a\u8981\u4e32\u884c\u904d\u5386\u4e00\u904d\uff0c\u800c\u4e0d\u80fd\u540c\u65f6\u53d1\u9001\u3002\u7c7b\u4f3c\u5730\uff0c\u53ef\u4ee5\u7528\u4e8c\u53c9\u6811 (Number-balanced binary tree format) \u6765\u7ec4\u7ec7\uff1a\u6bcf\u4e2a\u7f13\u5b58\u4fdd\u5b58\u4e24\u4e2a\u6307\u9488\uff0c\u6307\u5411\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\uff0c\u7136\u540e\u5206\u522b\u904d\u5386\uff0c\u76ee\u7684\u8fd8\u662f\u52a0\u5feb\u904d\u5386\u7684\u901f\u5ea6\uff0c\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u6d88\u606f\u7ed9\u591a\u4e2a\u6838\u5fc3\u3002</p>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2021/12/17/cache-coherency-protocol/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Cache coherence</li> <li>MSI protocol</li> <li>Write-once (cache coherence)</li> <li>MESI protocol</li> <li>MOESI protocol</li> <li>Dragon protocol</li> <li>A Strategy to Verify an AXI/ACE Compliant Interconnect (2 of 4)</li> <li>Directory-based cache coherence</li> </ul>","tags":["cpu","cache","coherence","msi","mesi","moesi","teaching"]},{"location":"hardware/2023/01/12/chi-notes/","title":"CHI \u5b66\u4e60\u7b14\u8bb0","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2023/01/12/chi-notes/#chi-\u4ecb\u7ecd","title":"CHI \u4ecb\u7ecd","text":"<p>CHI \u534f\u8bae\u662f AMBA 5 \u6807\u51c6\u4e2d\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u524d\u8eab\u662f ACE \u534f\u8bae\u3002\u6700\u65b0\u7684 CHI \u6807\u51c6\u53ef\u4ee5\u4ece AMBA 5 CHI Architecture Specification \u5904\u4e0b\u8f7d\u3002</p> <p>\u76f8\u6bd4 AXI\uff0cCHI \u66f4\u52a0\u590d\u6742\uff0c\u8fdb\u884c\u4e86\u5206\u5c42\uff1a\u534f\u8bae\u5c42\uff0c\u7269\u7406\u5c42\u548c\u94fe\u8def\u5c42\u3002\u56e0\u6b64\uff0cCHI \u9002\u7528\u4e8e\u7247\u4e0a\u7f51\u7edc\uff0c\u652f\u6301\u6839\u636e Node ID \u8fdb\u884c\u8def\u7531\uff0c\u800c\u4e0d\u50cf AXI \u90a3\u6837\u53ea\u6309\u7167\u7269\u7406\u5730\u5740\u8fdb\u884c\u8def\u7531\u3002CHI \u7684\u5730\u4f4d\u5c31\u76f8\u5f53\u4e8e Intel \u7684\u73af\u5f62\u603b\u7ebf\u3002CHI \u4e5f\u53ef\u4ee5\u6865\u63a5\u5230 CCIX \u4e0a\uff0c\u7528 CCIX \u8fde\u63a5 SMP \u7684\u7684\u591a\u4e2a Socket\uff0c\u6216\u8005\u8fde\u63a5\u652f\u6301 CCIX \u7684\u663e\u5361\u7b49\u7b49\u3002</p>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2023/01/12/chi-notes/#\u7f13\u5b58\u884c\u72b6\u6001","title":"\u7f13\u5b58\u884c\u72b6\u6001","text":"<p>\u9996\u5148\u56de\u987e ACE \u7684\u7f13\u5b58\u884c\u72b6\u6001\uff0c\u5171\u6709\u4e94\u79cd\uff0c\u4e0e MOESI \u76f8\u5bf9\u5e94\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0cCHI \u8003\u8651\u7f13\u5b58\u884c\u53ea\u6709\u90e8\u5206\u5b57\u8282\u6709\u6548\u7684\u60c5\u51b5\uff0c\u5373 Full\uff0cPartial \u6216\u8005 Empty\u3002\u56e0\u6b64 CHI \u7684\u7f13\u5b58\u884c\u72b6\u6001\u5171\u6709\u4e03\u79cd\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>UniqueDirtyPartial: \u65b0\u589e\uff0c\u53ef\u80fd\u6709\u90e8\u5206\u5b57\u8282\u5408\u6cd5\uff0c\u5728\u5199\u56de\u7684\u65f6\u5019\uff0c\u9700\u8981\u548c\u4e0b\u4e00\u7ea7\u7f13\u5b58\u6216\u8005\u5185\u5b58\u4e2d\u7684\u5408\u6cd5\u7f13\u5b58\u884c\u5185\u5bb9\u8fdb\u884c\u5408\u5e76</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>UniqueCleanEmpty: \u65b0\u589e\uff0c\u6240\u6709\u5b57\u8282\u90fd\u4e0d\u5408\u6cd5\uff0c\u4f46\u662f\u672c\u7f13\u5b58\u5360\u6709\u8be5\u7f13\u5b58\u884c\uff0c\u5982\u679c\u8981\u4fee\u6539\u7684\u8bdd\uff0c\u4e0d\u9700\u8981\u901a\u77e5\u5176\u4ed6\u7f13\u5b58</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6bd4\u8f83\u7279\u522b\u7684\u5c31\u662f UniqueDirtyPartial \u548c UniqueCleanEmpty\u3002CHI \u6807\u51c6\u5728 4.1.1 \u7ae0\u8282\u7ed9\u51fa\u4e86\u4f7f\u7528\u573a\u666f\uff1a\u5982\u679c\u4e00\u4e2a CPU \u5373\u5c06\u8981\u5199\u5165\u4e00\u7247\u5185\u5b58\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u8f6c\u6362\u5230 UniqueCleanEmpty \u72b6\u6001\u4e2d\uff0c\u628a\u5176\u4ed6\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u90fd\u6e05\u7a7a\uff0c\u8fd9\u6837\u540e\u7eed\u5199\u5165\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u8be2\u95ee\u5176\u4ed6\u7f13\u5b58\uff0c\u6027\u80fd\u6bd4\u8f83\u597d\u3002\u4f46\u6b64\u65f6\u56e0\u4e3a\u6570\u636e\u8fd8\u6ca1\u5199\u8fdb\u53bb\uff0c\u6240\u4ee5\u5c31\u662f Empty\uff0c\u53ea\u66f4\u65b0\u72b6\u6001\uff0c\u4e0d\u5360\u7528\u7f13\u5b58\u7684\u7a7a\u95f4\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c CPU \u53ea\u5199\u4e86\u7f13\u5b58\u884c\u7684\u4e00\u90e8\u5206\u5b57\u8282\uff0c\u5176\u4ed6\u90e8\u5206\u6ca1\u6709\u78b0\uff0c\u90a3\u4e48\u5f15\u5165 UniqueDirtyPartial \u4ee5\u540e\uff0c\u53ef\u4ee5\u628a\u5408\u5e76\u65b0\u65e7\u7f13\u5b58\u884c\u6570\u636e\u8fd9\u4e00\u6b65\uff0c\u4e0b\u653e\u5230\u6bd4\u8f83\u9760\u8fd1\u5185\u5b58\u7684\u5c42\u7ea7\u4e0a\uff0c\u51cf\u5c11\u4e86\u6570\u636e\u642c\u8fd0\u7684\u6b21\u6570\u3002</p>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2023/01/12/chi-notes/#chi-\u7f51\u7edc\u8282\u70b9","title":"CHI \u7f51\u7edc\u8282\u70b9","text":"<p>CHI \u7684\u8282\u70b9\u7ec4\u7ec7\u6210\u4e00\u4e2a\u7f51\u7edc\uff0c\u53ef\u80fd\u662f\u7247\u4e0a\u7f51\u7edc\uff0c\u4e5f\u53ef\u80fd\u662f\u7247\u95f4\u7684\u8fde\u63a5\u3002CHI \u7684\u8282\u70b9\u5206\u6210\u4e09\u79cd\u7c7b\u578b\uff1a</p> <ol> <li>Request Node\uff1a\u53d1\u8d77 CHI \u8bf7\u6c42\u7684\u8282\u70b9\uff0c\u5bf9\u5e94 CPU \u7684\u7f13\u5b58\uff0c\u6216\u8005\u662f\u7f51\u5361\u7b49\u5916\u8bbe</li> <li>Home Node\uff1a\u7ba1\u7406 Request Node \u6765\u7684\u8bf7\u6c42\uff0c\u5bf9\u5e94\u6700\u540e\u4e00\u7ea7\u7f13\u5b58</li> <li>Subordinate Node\uff1a\u5904\u7406 Home Node \u6765\u7684\u8bf7\u6c42\uff0c\u5bf9\u5e94\u5185\u5b58\u6216\u8005\u663e\u5b58\u7b49\u6709\u5185\u5b58\u7684\u5916\u8bbe</li> </ol> <p>\u5728\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0cNode \u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u901a\u4fe1\uff0c\u56e0\u6b64\u65b9\u4fbf\u505a\u4e00\u4e9b\u65b0\u7684\u4f18\u5316\u3002\u4f8b\u5982\u4f20\u7edf\u7684\u7f13\u5b58\u5c42\u6b21\u91cc\uff0c\u8bf7\u6c42\u662f\u4e00\u7ea7\u4e00\u7ea7\u4e0b\u53bb\uff0c\u54cd\u5e94\u518d\u4e00\u7ea7\u4e00\u7ea7\u4e0a\u6765\u3002\u4f46\u662f CHI \u53ef\u80fd\u662f Request Node \u53d1\u7ed9 Home Node \u7684\u8bf7\u6c42\uff0c\u54cd\u5e94\u76f4\u63a5\u7531 Subordinate Node \u53d1\u9001\u56de Request Node \u4e86\u3002</p>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2023/01/12/chi-notes/#\u8bfb\u8bf7\u6c42","title":"\u8bfb\u8bf7\u6c42","text":"<p>CHI \u63d0\u4f9b\u4e86\u590d\u6742\u6027\u7684\u540c\u65f6\uff0c\u4e5f\u5e26\u6765\u4e86\u5f88\u591a\u7684\u7075\u6d3b\u6027\uff0c\u4e5f\u610f\u5473\u7740\u6f5c\u5728\u7684\u6027\u80fd\u4f18\u5316\u7684\u53ef\u80fd\u3002\u4f8b\u5982\u5728 CHI \u4e2d\u5b9e\u73b0\u4e00\u4e2a\u8bfb\u64cd\u4f5c\uff0c\u53ef\u80fd\u6709\u5f88\u591a\u79cd\u8fc7\u7a0b\uff08CHI \u6807\u51c6\u7b2c 2.3.1 \u7ae0\u8282\uff09\uff1a</p> <p>\u7b2c\u4e00\u79cd\u662f Home Node \u76f4\u63a5\u63d0\u4f9b\u4e86\u6570\u636e\uff08Combined response from home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u7b2c\u4e8c\u79cd\u662f Home Node \u628a\u54cd\u5e94\u62c6\u6210\u4e24\u4efd\uff0c\u4e00\u4efd\u8868\u793a\u8bfb\u53d6\u7ed3\u679c\uff0c\u4e00\u4efd\u643a\u5e26\u8bfb\u53d6\u7684\u6570\u636e\uff08Separate data and response from Home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u7b2c\u4e09\u79cd\u662f Home Node \u6ca1\u6709\u6570\u636e\uff0c\u8f6c\u800c\u8be2\u95ee Subordinate\uff0cSubordinate \u628a\u7ed3\u679c\u76f4\u63a5\u53d1\u56de\u7ed9\u4e86 Requester\uff08Combined response from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Subordinate: ReadNoSnp\n    Subordinate-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u7b2c\u56db\u79cd\u662f Home Node \u6ca1\u6709\u6570\u636e\uff0c\u8f6c\u800c\u8be2\u95ee Subordinate\uff0c\u4f46\u8fd9\u6b21\u63d0\u524d\u544a\u8bc9 Requester \u8bfb\u53d6\u7684\u7ed3\u679c\uff0c\u6700\u540e Subordinate \u628a\u7ed3\u679c\u53d1\u56de\u7ed9\u4e86 Requester\uff08Response from Home, Data from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Subordinate: ReadNoSnpSep\n    Subordinate-&gt;&gt;Home: ReadReceipt\n    Subordinate-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u7b2c\u4e94\u79cd\u662f\u6570\u636e\u5728\u5176\u4ed6\u7684 Requester Node \u4e2d\uff0c\u6b64\u65f6 Home \u8d1f\u8d23 Snoop\uff08Forwarding snoop\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Snoopee\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Snoopee: Snp*Fwd\n    Snoopee-&gt;&gt;Requester: CompData\n    Snoopee-&gt;&gt;Home: SnpRespFwded\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u7b2c\u516d\u79cd\u662f MakeReadUnique\uff0c\u6b64\u65f6\u53ea\u66f4\u65b0\u6743\u9650\uff0c\u4e0d\u6d89\u53ca\u6570\u636e\u7684\u4f20\u8f93\uff08MakeReadUnique only\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: MakeReadUnique\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: CompAck</code></pre>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2023/01/12/chi-notes/#\u5199\u8bf7\u6c42","title":"\u5199\u8bf7\u6c42","text":"<p>CHI \u6807\u51c6\u7b2c 2.3.2 \u63cf\u8ff0\u4e86\u5199\u8bf7\u6c42\u7684\u6d41\u7a0b\u3002\u548c\u8bfb\u8bf7\u6c42\u4e00\u6837\uff0c\u5199\u8bf7\u6c42\u4e5f\u6709\u5f88\u591a\u7c7b\u578b\uff0c\u4e0b\u9762\u8fdb\u884c\u4ecb\u7ecd\u3002\u4e0e\u8bfb\u8bf7\u6c42\u4e0d\u540c\u7684\u70b9\u5728\u4e8e\uff0c\u5199\u5165\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u628a\u5199\u5165\u7684\u5730\u5740\u548c\u6570\u636e\u7b49\u4e00\u6b21\u6027\u53d1\u9001\u8fc7\u53bb\uff0c\u800c\u662f\u5148\u53d1\u4e00\u4e2a\u5199\u6d88\u606f\uff0c\u5bf9\u65b9\u56de\u590d\u53ef\u4ee5\u53d1\u9001\u6570\u636e\u4e86\uff08DBIDResp\uff09\uff0c\u518d\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f20\u8f93\u8fc7\u53bb\uff08NCBWrData\uff09\u3002\u5f53\u7136\u4e86\uff0c\u4e5f\u53ef\u4ee5\u4e2d\u9014\u53cd\u6094\uff08WriteDataCancel\uff09\u3002</p> <p>\u7b2c\u4e00\u79cd\u662f Direct Write-data Transfer\uff0c\u610f\u601d\u662f\u6570\u636e\u8981\u4ece Requester \u76f4\u63a5\u4f20\u5230 Subordinate \u4e0a\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Subordinate: Write*\n    Subordinate-&gt;&gt;Requester: DBIDResp\n    Requester-&gt;&gt;Subordinate: NCBWrData/WriteDataCancel\n    Subordinate-&gt;&gt;Home: Comp\n    Home-&gt;&gt;Requester: Comp</code></pre> <p>\u7b2c\u4e8c\u79cd\u6bd4\u8f83\u5e38\u89c4\uff0c\u5c31\u662f\u628a\u6570\u636e\u5199\u7ed9 Home Node\uff0c\u5176\u4e2d Comp \u8868\u793a\u8bfb\u53d6\u7ed3\u679c\uff0cDBIDResp \u8868\u793a\u53ef\u4ee5\u53d1\u5199\u5165\u7684\u5185\u5bb9\u4e86\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: DBIDResp/DBIDRespOrd\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre> <p>\u7b2c\u4e09\u79cd\u662f\u628a\u7b2c\u4e8c\u79cd\u7684 DBIDResp \u548c Comp \u5408\u5e76\u6210\u4e00\u4e2a\u54cd\u5e94\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: CompDBIDResp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre>","tags":["chi","bus","coherence","notes","learn"]},{"location":"hardware/2022/01/03/chisel3-cookbook/","title":"Chisel3 Cookbook","text":"","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#chisel-\u7248\u672c\u9009\u62e9","title":"Chisel \u7248\u672c\u9009\u62e9","text":"<p>\u5c3d\u91cf\u9009\u62e9\u8f83\u65b0\u7248\u672c\u7684 Chisel\u3002Chisel v3.5 \u5b8c\u5584\u4e86\u7f16\u8bd1\u5668\u63d2\u4ef6\uff0c\u4f7f\u5f97\u751f\u6210\u7684\u4ee3\u7801\u4e2d\u4f1a\u5305\u62ec\u66f4\u591a\u53d8\u91cf\u540d\u4fe1\u606f\u3002</p>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#\u53bb\u6389\u8f93\u51fa-verilog-\u6587\u4ef6\u4e2d\u7684\u5bc4\u5b58\u5668\u968f\u673a\u521d\u59cb\u5316","title":"\u53bb\u6389\u8f93\u51fa Verilog \u6587\u4ef6\u4e2d\u7684\u5bc4\u5b58\u5668\u968f\u673a\u521d\u59cb\u5316","text":"<p>\u7248\u672c\uff1aFIRRTL &gt;= 1.5.0-RC2</p> <p>\u4ee3\u7801\uff1a</p> <pre><code>new ChiselStage().execute(\n  Array(\"-X\", \"verilog\", \"-o\", s\"${name}.v\"),\n  Seq(\n    ChiselGeneratorAnnotation(genModule),\n    CustomDefaultRegisterEmission(\n      useInitAsPreset = false,\n      disableRandomization = true\n    )\n  )\n)\n</code></pre> <p>\u8bbe\u7f6e disableRandomization=true \u5373\u53ef\u3002useInitAsPreset \u4e0d\u5efa\u8bae\u5f00\u542f\u3002</p>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#\u5173\u95ed-firrtl-\u4f18\u5316\u8f93\u51fa\u5c3d\u53ef\u80fd\u4e0e\u6e90\u4ee3\u7801\u4e00\u81f4\u7684-verilog","title":"\u5173\u95ed FIRRTL \u4f18\u5316\uff0c\u8f93\u51fa\u5c3d\u53ef\u80fd\u4e0e\u6e90\u4ee3\u7801\u4e00\u81f4\u7684 Verilog","text":"<p>\u8bbe\u7f6e Chisel \u751f\u6210 MinimumVerilog\uff1a</p> <pre><code>new ChiselStage().execute(\n  Array(\"-X\", \"mverilog\", \"-o\", s\"${name}.v\"),\n  Seq(\n    ChiselGeneratorAnnotation(genModule)\n  )\n)\n</code></pre> <p>\u6b64\u65f6\u4ee3\u7801\u4e2d\u4f1a\u4fdd\u7559\u66f4\u591a\u539f\u59cb Chisel \u4ee3\u7801\u7684\u5143\u7d20\u3002</p>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#\u91cd\u547d\u540d-axi4-\u4e3a\u6807\u51c6\u547d\u540d","title":"\u91cd\u547d\u540d AXI4 \u4e3a\u6807\u51c6\u547d\u540d","text":"<p>Rocket Chip \u4e2d AXI4Bundle \u76f4\u63a5\u751f\u6210\u7684\u540d\u5b57\u548c\u6807\u51c6\u5199\u6cd5\u4e0d\u540c\uff0c\u53ef\u4ee5\u5229\u7528 Chisel3 3.5.0 \u7684 DataView \u529f\u80fd\u8fdb\u884c\u91cd\u547d\u540d\uff1a</p> <pre><code>// https://www.chisel-lang.org/chisel3/docs/explanations/dataview.html\n// use standard names\nclass StandardAXI4BundleBundle(val addrBits: Int, val dataBits: Int, val idBits: Int)\n    extends Bundle {\n  val AWREADY = Input(Bool())\n  val AWVALID = Output(Bool())\n  val AWID = Output(UInt(idBits.W))\n  val AWADDR = Output(UInt(addrBits.W))\n  val AWLEN = Output(UInt(8.W))\n  val AWSIZE = Output(UInt(3.W))\n  val AWBURST = Output(UInt(2.W))\n  val AWLOCK = Output(UInt(1.W))\n  val AWCACHE = Output(UInt(4.W))\n  val AWPROT = Output(UInt(3.W))\n  val AWQOS = Output(UInt(4.W))\n\n  val WREADY = Input(Bool())\n  val WVALID = Output(Bool())\n  val WDATA = Output(UInt(dataBits.W))\n  val WSTRB = Output(UInt((dataBits / 8).W))\n  val WLAST = Output(Bool())\n\n  val BREADY = Output(Bool())\n  val BVALID = Input(Bool())\n  val BID = Input(UInt(idBits.W))\n  val BRESP = Input(UInt(2.W))\n\n  val ARREADY = Input(Bool())\n  val ARVALID = Output(Bool())\n  val ARID = Output(UInt(idBits.W))\n  val ARADDR = Output(UInt(addrBits.W))\n  val ARLEN = Output(UInt(8.W))\n  val ARSIZE = Output(UInt(3.W))\n  val ARBURST = Output(UInt(2.W))\n  val ARLOCK = Output(UInt(1.W))\n  val ARCACHE = Output(UInt(4.W))\n  val ARPROT = Output(UInt(3.W))\n  val ARQOS = Output(UInt(4.W))\n\n  val RREADY = Output(Bool())\n  val RVALID = Input(Bool())\n  val RID = Input(UInt(idBits.W))\n  val RDATA = Input(UInt(dataBits.W))\n  val RRESP = Input(UInt(2.W))\n  val RLAST = Input(Bool())\n}\n\nobject StandardAXI4BundleBundle {\n  implicit val axiView = DataView[StandardAXI4BundleBundle, AXI4Bundle](\n    vab =&gt;\n      new AXI4Bundle(\n        AXI4BundleParameters(vab.addrBits, vab.dataBits, vab.idBits)\n      ),\n    // AW\n    _.AWREADY -&gt; _.aw.ready,\n    _.AWVALID -&gt; _.aw.valid,\n    _.AWID -&gt; _.aw.bits.id,\n    _.AWADDR -&gt; _.aw.bits.addr,\n    _.AWLEN -&gt; _.aw.bits.len,\n    _.AWSIZE -&gt; _.aw.bits.size,\n    _.AWBURST -&gt; _.aw.bits.burst,\n    _.AWLOCK -&gt; _.aw.bits.lock,\n    _.AWCACHE -&gt; _.aw.bits.cache,\n    _.AWPROT -&gt; _.aw.bits.prot,\n    _.AWQOS -&gt; _.aw.bits.qos,\n    // W\n    _.WREADY -&gt; _.w.ready,\n    _.WVALID -&gt; _.w.valid,\n    _.WDATA -&gt; _.w.bits.data,\n    _.WSTRB -&gt; _.w.bits.strb,\n    _.WLAST -&gt; _.w.bits.last,\n    // B\n    _.BREADY -&gt; _.b.ready,\n    _.BVALID -&gt; _.b.valid,\n    _.BID -&gt; _.b.bits.id,\n    _.BRESP -&gt; _.b.bits.resp,\n    // AR\n    _.ARREADY -&gt; _.ar.ready,\n    _.ARVALID -&gt; _.ar.valid,\n    _.ARID -&gt; _.ar.bits.id,\n    _.ARADDR -&gt; _.ar.bits.addr,\n    _.ARLEN -&gt; _.ar.bits.len,\n    _.ARSIZE -&gt; _.ar.bits.size,\n    _.ARBURST -&gt; _.ar.bits.burst,\n    _.ARLOCK -&gt; _.ar.bits.lock,\n    _.ARCACHE -&gt; _.ar.bits.cache,\n    _.ARPROT -&gt; _.ar.bits.prot,\n    _.ARQOS -&gt; _.ar.bits.qos,\n    // R\n    _.RREADY -&gt; _.r.ready,\n    _.RVALID -&gt; _.r.valid,\n    _.RID -&gt; _.r.bits.id,\n    _.RDATA -&gt; _.r.bits.data,\n    _.RRESP -&gt; _.r.bits.resp,\n    _.RLAST -&gt; _.r.bits.last\n  )\n  implicit val axiView2 = StandardAXI4BundleBundle.axiView.invert(ab =&gt;\n    new StandardAXI4BundleBundle(\n      ab.params.addrBits,\n      ab.params.dataBits,\n      ab.params.idBits\n    )\n  )\n}\n\n// usage\nval MEM = IO(new StandardAXI4BundleBundle(32, 64, 4))\nMEM &lt;&gt; target.mem_axi4.head.viewAs[StandardAXI4BundleBundle]\n</code></pre>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#\u7ed9\u6240\u6709\u6a21\u5757\u6dfb\u52a0\u540d\u79f0\u524d\u7f00","title":"\u7ed9\u6240\u6709\u6a21\u5757\u6dfb\u52a0\u540d\u79f0\u524d\u7f00","text":"<p>\u6709\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u7ed9\u6240\u6709\u6a21\u5757\u6dfb\u52a0\u4e00\u4e2a\u540d\u79f0\u524d\u7f00\uff0c\u9632\u6b62\u53ef\u80fd\u51fa\u73b0\u7684\u51b2\u7a81\u3002</p> <p>\u5728 Chisel 3 \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49 FIRRTL Transform \u6765\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u3002\u8fd9\u4e00\u90e8\u5206\u7684\u5b9e\u73b0\u53c2\u8003\u4e86 chisel issue #1059\uff1a</p> <pre><code>import firrtl._\nimport firrtl.annotations.NoTargetAnnotation\nimport firrtl.options.Dependency\nimport firrtl.passes.PassException\nimport firrtl.transforms.DedupModules\n\n// adapted from https://github.com/chipsalliance/chisel3/issues/1059#issuecomment-814353578\n\n/** Specifies a global prefix for all module names. */\ncase class ModulePrefix(prefix: String) extends NoTargetAnnotation\n\n/** FIRRTL pass to add prefix to module names\n  */\nobject PrefixModulesPass extends Transform with DependencyAPIMigration {\n  // we run after deduplication to save some work\n  override def prerequisites = Seq(Dependency[DedupModules])\n\n  // we do not invalidate the results of any prior passes\n  override def invalidates(a: Transform) = false\n\n  override protected def execute(state: CircuitState): CircuitState = {\n    val prefixes = state.annotations.collect { case a: ModulePrefix =&gt;\n      a.prefix\n    }.distinct\n    prefixes match {\n      case Seq() =&gt;\n        logger.info(\"[PrefixModulesPass] No ModulePrefix annotation found.\")\n        state\n      case Seq(\"\") =&gt; state\n      case Seq(prefix) =&gt;\n        val c = state.circuit.mapModule(onModule(_, prefix))\n        state.copy(circuit = c.copy(main = prefix + c.main))\n      case other =&gt;\n        throw new PassException(\n          s\"[PrefixModulesPass] found more than one prefix annotation: $other\"\n        )\n    }\n  }\n\n  private def onModule(m: ir.DefModule, prefix: String): ir.DefModule =\n    m match {\n      case e: ir.ExtModule =&gt; e.copy(name = prefix + e.name)\n      case mod: ir.Module =&gt;\n        val name = prefix + mod.name\n        val body = onStmt(mod.body, prefix)\n        mod.copy(name = name, body = body)\n    }\n\n  private def onStmt(s: ir.Statement, prefix: String): ir.Statement = s match {\n    case i: ir.DefInstance =&gt; i.copy(module = prefix + i.module)\n    case other             =&gt; other.mapStmt(onStmt(_, prefix))\n  }\n}\n</code></pre> <p>\u5b9e\u73b0\u601d\u8def\u5c31\u662f\u904d\u5386 IR\uff0c\u627e\u5230\u6240\u6709\u7684 Module \u5e76\u6539\u540d\uff0c\u518d\u628a\u6240\u6709\u6a21\u5757\u4f8b\u5316\u4e5f\u505a\u4e00\u6b21\u66ff\u6362\u3002\u6700\u540e\u5728\u751f\u6210 Verilog \u7684\u65f6\u5019\u6dfb\u52a0 Annotation \u5373\u53ef\uff1a</p> <pre><code>new ChiselStage().execute(\n  Array(\"-o\", s\"${name}.v\"),\n  Seq(\n    ChiselGeneratorAnnotation(genModule),\n    RunFirrtlTransformAnnotation(Dependency(PrefixModulesPass)),\n    ModulePrefix(prefix)\n  )\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u65b0\u7684 MLIR FIRRTL Compiler\uff0c\u5219\u53ef\u4ee5\u5229\u7528 <code>sifive.enterprise.firrtl.NestedPrefixModulesAnnotation</code> annotation\uff0c\u8ba9 firtool \u6765\u8fdb\u884c prefix \u64cd\u4f5c\uff1a</p> <pre><code>package sifive {\n  package enterprise {\n    package firrtl {\n      import _root_.firrtl.annotations._\n\n      case class NestedPrefixModulesAnnotation(\n          val target: Target,\n          prefix: String,\n          inclusive: Boolean\n      ) extends SingleTargetAnnotation[Target] {\n\n        def duplicate(n: Target): Annotation =\n          NestedPrefixModulesAnnotation(target, prefix, inclusive)\n      }\n    }\n  }\n}\n\nobject AddPrefix {\n  def apply(module: Module, prefix: String, inclusive: Boolean = true) = {\n    annotate(new ChiselAnnotation {\n      def toFirrtl =\n        new NestedPrefixModulesAnnotation(module.toTarget, prefix, inclusive)\n    })\n  }\n}\n</code></pre> <p>\u8fd9\u4e2a\u65b9\u6cd5\u7684\u7075\u611f\u6765\u81ea @sequencer\u3002\u552f\u4e00\u7684\u7f3a\u70b9\u5c31\u662f\u6bd4\u8f83 Hack\uff0c\u5efa\u8bae SiFive \u628a\u76f8\u5173\u7684\u7c7b\u4e5f\u5f00\u6e90\u51fa\u6765\u7528\u3002</p>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2022/01/03/chisel3-cookbook/#\u5173\u95ed-rtl-\u7ea7\u522b\u7684\u4f18\u5316","title":"\u5173\u95ed RTL \u7ea7\u522b\u7684\u4f18\u5316","text":"<p>Chisel3 \u751f\u6210 Verilog/System Verilog \u7684\u65f6\u5019\u4f1a\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\u3002\u5982\u679c\u60f3\u8981\u5173\u95ed\u8fd9\u4e9b\u4f18\u5316\uff0c\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <ol> <li>dontTouch annotation</li> <li>\u6dfb\u52a0\u547d\u4ee4\u884c\u53c2\u6570\uff1a<code>--preserve-values=[none/named/all]</code>\uff0c\u89c1 FIRRTL Dialect Rationale</li> </ol>","tags":["chisel","verilog","hdl","cookbook"]},{"location":"hardware/2023/03/23/core-cosim/","title":"\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f","text":"","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4eca\u5e74\u7684\u9f99\u82af\u676f\u53c8\u5f00\u59cb\u62a5\u540d\u4e86\uff0c\u6211\u6765\u5199\u4e00\u7bc7\u5173\u4e8e\u534f\u540c\u4eff\u771f\uff08cosim\uff09\u7684\u535a\u5ba2\u8e6d\u8e6d\u70ed\u5ea6\u3002\u4e0b\u9762\u7684\u5185\u5bb9\u53c2\u8003\u4e86\u4e00\u4e9b\u5df2\u6709\u7684\u534f\u540c\u4eff\u771f\u7684\u6846\u67b6\uff0c\u4f8b\u5982 ibex co-sim \u548c OpenXiangShan/difftest\u3002</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u534f\u540c\u4eff\u771f","title":"\u534f\u540c\u4eff\u771f","text":"<p>RTL \u5c42\u6b21\u7684\u534f\u540c\u4eff\u771f\u53ef\u4ee5\u505a\u4e0d\u540c\u5c42\u6b21\u7684\uff0c\u8fd9\u91cc\u8ba8\u8bba\u7684\u662f\u6307\u4ee4\u63d0\u4ea4\u5c42\u6b21\uff0c\u5177\u4f53\u6765\u8bb2\uff0c\u5c31\u662f\u628a CPU \u548c\u4e00\u4e2a\u6a21\u62df\u5668\u653e\u5728\u4e00\u8d77\u534f\u540c\u4eff\u771f\uff0c\u68c0\u67e5\u6bcf\u6761\u6307\u4ee4\u6267\u884c\u5b8c\u4ee5\u540e\u7684\u72b6\u6001\u662f\u5426\u4e00\u81f4\u3002\u57fa\u4e8e\u4ee3\u7801\u6837\u4f8b\u7684\u6d4b\u8bd5\u867d\u7136\u53ef\u4ee5\u8986\u76d6\u5f88\u591a\u60c5\u51b5\uff0c\u4f46\u662f\u5982\u679c\u51fa\u4e86\u9519\u8bef\uff0c\u62a5\u9519\u7684\u5730\u65b9\u4e0d\u4e00\u5b9a\u662f\u51fa\u73b0\u95ee\u9898\u7684\u5730\u65b9\uff0c\u6709\u4e9b\u65f6\u5019\u5c31\u9700\u8981\u5f80\u56de\u627e\u5f88\u4e45\uff0c\u624d\u80fd\u627e\u5230\u521a\u51fa\u73b0\u95ee\u9898\u7684\u5730\u65b9\u3002\u8f6f\u4ef6\u4e0a\uff0c\u5927\u5bb6\u7ecf\u5e38\u82e6\u4e8e\u5185\u5b58\u9519\u8bef\uff0c\u7ecf\u5e38\u627e\u4e0d\u5230\u521a\u51fa\u73b0\u6ea2\u51fa\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u8981\u7528 valgrind \u6216\u8005 asan \u7b49\u5de5\u5177\u6765\u76f4\u63a5\u5b9a\u4f4d\u7b2c\u4e00\u6b21\u51fa\u9519\u7684\u5730\u65b9\u3002\u786c\u4ef6\u4e0a\u4e5f\u662f\u7c7b\u4f3c\uff0c\u4e3a\u4e86\u7cbe\u786e\u5b9a\u4f4d\u5230\u51fa\u9519\u7684\u6ce2\u5f62\uff0c\u53ef\u4ee5\u7528 cosim\u3002</p> <p>cosim \u662f\u600e\u4e48\u5de5\u4f5c\u7684\u5462\uff1f\u6a21\u62df\u5668\u662f\u8f6f\u4ef6\u5b9e\u73b0\u7684\uff0c\u5b83\u539f\u5b50\u5730\u6267\u884c\u4e00\u6761\u6761\u6307\u4ee4\uff0c\u540c\u65f6\u8bb0\u5f55\u4e0b\u5f53\u524d\u7684\u72b6\u6001\uff0c\u4f8b\u5982\u5bc4\u5b58\u5668\u7684\u53d6\u503c\u3001\u5185\u5b58\u7684\u72b6\u6001\u7b49\u7b49\u3002\u5982\u679c\u53ef\u4ee5\u8ba9 CPU \u548c\u6a21\u62df\u5668\u9501\u6b65\u8fd0\u884c\uff0c\u4e5f\u5c31\u662f CPU \u6267\u884c\u4e00\u6761\u6307\u4ee4\uff0c\u6a21\u62df\u5668\u6267\u884c\u4e00\u6761\u6307\u4ee4\uff0c\u7136\u540e\u6bd4\u5bf9\u72b6\u6001\uff0c\u4e00\u65e6\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u5c31\u76f4\u63a5\u62a5\u9519\u3002\u4f46\u5b9e\u9645\u4e0a CPU \u53ef\u80fd\u4f1a\u66f4\u52a0\u590d\u6742\uff0c\u56e0\u4e3a\u5b83\u6307\u4ee4\u7684\u6267\u884c\u62c6\u5206\u6210\u4e86\u5f88\u591a\u90e8\u5206\uff0c\u9700\u8981\u9488\u5bf9\u6d41\u6c34\u7ebf\u8fdb\u884c\u4e00\u4e9b\u4fee\u6539\uff0c\u4f7f\u5f97\u5b83\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a\u5339\u914d\u6a21\u62df\u5668\u7684\u539f\u5b50\u7684\u6267\u884c\u6d41\u3002</p> <p>\u6574\u4f53\u7684\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u9009\u62e9\u4e00\u4e2a\u6a21\u62df\u5668\uff0c\u81ea\u5df1\u5199\u6216\u8005\u4f7f\u7528\u4e00\u4e2a\u73b0\u6210\u7684\u3002\u8003\u8651\u5230\u6a21\u62df\u5668\u5b9e\u73b0\u7684\u529f\u80fd\u548c CPU \u4e0d\u4e00\u5b9a\u4e00\u81f4\uff0c\u6709\u65f6\u5019\u9700\u8981\u4fee\u6539\u6a21\u62df\u5668\u7684\u6e90\u7801\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u4e00\u4e9b\u73b0\u6210\u7684\u5f00\u6e90\u8f6f\u4ef6\uff0c\u5982\u679c\u662f\u4e3a\u4e86 cosim \u8bbe\u8ba1\u7684\u5c31\u66f4\u597d\u4e86\u3002</li> <li>\u627e\u5230\u6a21\u62df\u5668\u7684\u5355\u6b65\u6267\u884c\u63a5\u53e3\uff0c\u5e76\u4e14\u8ba9\u6a21\u62df\u5668\u53ef\u4ee5\u628a\u5185\u90e8\u72b6\u6001\u66b4\u9732\u51fa\u6765\u3002\u8fd9\u4e00\u6b65\u53ef\u80fd\u9700\u8981\u4fee\u6539\u6e90\u4ee3\u7801\u3002</li> <li>\u4fee\u6539 RTL\uff0c\u628a\u6307\u4ee4\u7684\u63d0\u4ea4\u4fe1\u606f\u3001\u5bc4\u5b58\u5668\u5806\u7684\u5185\u5bb9\u901a\u8fc7\u4e00\u4e9b\u65b9\u6cd5\u4f20\u9012\u51fa\u6765\u3002</li> <li>\u4fee\u6539\u4eff\u771f\u9876\u5c42\uff0c\u6bcf\u5f53\u6307\u4ee4\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u5355\u6b65\u6267\u884c\u6a21\u62df\u5668\uff0c\u7136\u540e\u6bd4\u5bf9\u53cc\u65b9\u7684\u72b6\u6001\u3002</li> </ol>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u6a21\u62df\u5668","title":"\u6a21\u62df\u5668","text":"<p>\u9009\u62e9\u6a21\u62df\u5668\uff0c\u8981\u6839\u636e\u4f60\u6240\u5b9e\u73b0\u7684\u6307\u4ee4\u96c6\u6765\u9009\u62e9\u3002\u4e0b\u9762\u4ee5 Spike \u4e3a\u4f8b\uff0c\u7528\u6765\u548c RISC-V CPU \u8fdb\u884c\u534f\u540c\u4eff\u771f\u3002spike \u5b9e\u73b0\u4e86\u6bd4\u8f83\u5b8c\u6574\u7684 RISC-V \u6307\u4ee4\u96c6\uff0c\u5e76\u4e14\u4ee5\u5e93\u7684\u5f62\u5f0f\u63d0\u4f9b\u4e86\u5b83\u7684 API\uff0c\u4f46\u8fd8\u9700\u8981\u4e00\u4e9b\u4fee\u6539\uff0c\u8ba9\u5b83\u66f4\u52a0\u9002\u5408\u534f\u540c\u4eff\u771f\u3002\u8fd9\u4e00\u90e8\u5206\u53c2\u8003\u4e86 ibex co-sim\u7684\u6587\u6863\u3002</p> <p>\u9996\u5148\uff0cspike \u63d0\u4f9b\u4e86 step \u51fd\u6570\uff0c\u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684\u5355\u6b65\u6267\u884c\u3002\u4f46\u662f\uff0cspike \u7684 step \u5728\u9047\u5230\u5f02\u5e38\u6216\u8005\u4e2d\u65ad\u7684\u65f6\u5019\u4e5f\u4f1a\u8fd4\u56de\uff0c\u4f46\u5b9e\u9645\u4e0a\u5728\u5904\u7406\u5668\u4e00\u4fa7\uff0c\u901a\u5e38\u5f02\u5e38\u662f\u5355\u72ec\u5904\u7406\u7684\uff0c\u6240\u4ee5\u8fd9\u65f6\u5019\u5c31\u8981\u4fee\u6539 spike \u7684 step \u51fd\u6570\uff0c\u5982\u679c\u9047\u5230\u5f02\u5e38\u4e86\uff0c\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u6267\u884c\u4e86\u4e00\u6761\u6307\u4ee4\u4e3a\u6b62\u3002\u4e0e\u6b64\u540c\u65f6\uff0cspike \u6ca1\u6709\u8bb0\u5f55\u6700\u540e\u4e00\u6b21\u6267\u884c\u7684\u6307\u4ee4\u7684 pc\uff0c\u53ea\u8bb0\u5f55\u4e86\u4e0b\u4e00\u4e2a PC\uff0c\u90a3\u4e48\u5728\u53d1\u751f\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u4f1a\u8bb0\u5f55\u5f02\u5e38\u5904\u7406\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u7684 PC\uff0c\u8fd9\u91cc\u4e5f\u8981\u8fdb\u884c\u9488\u5bf9\u6027\u7684\u4fee\u6539\u3002</p> <pre><code>state.last_inst_pc = pc;\npc = execute_insn_logged(this, pc, fetch);\nadvance_pc();\n</code></pre> <p>\u505a\u4e86\u8fd9\u4e9b\u4fee\u6539\u4ee5\u540e\uff0c\u5c31\u8db3\u591f\u5728 cosim \u4e2d\u8fd0\u884c\u4e00\u4e9b\u7b80\u5355\u7684\u7a0b\u5e8f\u4e86\u3002</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u5904\u7406\u5668","title":"\u5904\u7406\u5668","text":"<p>\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u4fee\u6539\u5904\u7406\u5668\uff0c\u8ba9\u5b83\u53ef\u4ee5\u6c47\u62a5\u6bcf\u4e2a\u5468\u671f\u5b8c\u6210\u6267\u884c\u7684\u6307\u4ee4\u60c5\u51b5\uff0c\u5177\u4f53\u7684\u683c\u5f0f\u56e0\u5b9e\u73b0\u800c\u5f02\uff0c\u6700\u540e\u90fd\u9700\u8981\u628a\u8fd9\u4e9b\u4fe1\u606f\u66b4\u9732\u7ed9\u4eff\u771f\u9876\u5c42\uff0c\u53ef\u80fd\u7684\u65b9\u6cd5\u6709\uff1a</p> <ol> <li>\u901a\u8fc7\u591a\u7ea7\u7684 module output \u4e00\u8def\u4f20\u5230\u9876\u5c42\uff0c\u6700\u7ec8\u662f\u9876\u5c42\u6a21\u5757\u7684\u8f93\u51fa\u4fe1\u53f7\u3002\u8fd9\u79cd\u65b9\u6cd5\u6539\u52a8\u6bd4\u8f83\u5927\uff0c\u800c\u4e14\u9ebb\u70e6\u3002</li> <li>\u901a\u8fc7 DPI \u51fd\u6570\uff0c\u6bcf\u4e2a\u5468\u671f\u8c03\u7528\u4e00\u6b21\uff0c\u628a\u4fe1\u606f\u901a\u8fc7 DPI \u7684\u53c2\u6570\u4f20\u9012\u7ed9 C \u51fd\u6570\u3002\u8fd9\u79cd\u65b9\u6cd5\u6bd4\u8f83\u63a8\u8350\u3002</li> <li>\u901a\u8fc7\u4eff\u771f\u5668\u7684\u529f\u80fd\uff0c\u4f8b\u5982 verilator \u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u6ce8\u91ca\u7684\u65b9\u6cd5\uff0c\u628a\u4fe1\u53f7\u66b4\u9732\u51fa\u53bb\u3002</li> </ol> <p>\u4eff\u771f\u9876\u5c42\u62ff\u5230\u4fe1\u606f\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c cosim \u4e86\uff1aCPU \u6267\u884c\u4e00\u6761\u6307\u4ee4\uff0c\u5c31\u8ba9\u6a21\u62df\u5668\u4e5f step \u4e00\u6b65\uff0c\u7136\u540e\u6bd4\u8f83\u4e8c\u8005\u7684\u72b6\u6001\u3002\u72b6\u6001\u600e\u4e48\u6bd4\u5bf9\u5462\uff1f\u5e38\u89c1\u7684\u6709\u901a\u7528\u5bc4\u5b58\u5668\uff0cRISC-V \u7684 CSR\u3002\u65e2\u53ef\u4ee5\u901a\u8fc7\u8bb0\u5f55\u5bc4\u5b58\u5668\u5806\u7684\u5199\u5165\u6765\u6bd4\u5bf9\uff0c\u53c8\u53ef\u4ee5\u76f4\u63a5\u628a\u6574\u4e2a\u5bc4\u5b58\u5668\u5806\u7684\u5185\u5bb9\u5bfc\u51fa\u6765\u6bd4\u5bf9\u3002\u5b9e\u9645\u4e0a\u8fd9\u4e9b\u90e8\u5206\u7684\u6027\u80fd\u5f71\u54cd\u90fd\u662f\u5f88\u5c0f\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u5185\u5b58\u600e\u4e48\u6bd4\u5bf9\u5462\uff1f\u5bf9\u4e8e\u7b80\u5355\u7684\u987a\u5e8f\u5904\u7406\u5668\uff0c\u8bfb\u5199\u4e5f\u662f\u987a\u5e8f\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a\u8bfb\u5199\u7684\u65e5\u5fd7\u653e\u5230\u4e00\u4e2a\u961f\u5217 deque \u4e2d\uff0c\u7136\u540e\u8ba9\u6a21\u62df\u5668\u4e5f\u8bb0\u5f55\u4e0b\u5185\u5b58\u7684\u8bfb\u5199\uff0c\u4ece deque \u8fdb\u884c pop \u548c\u6bd4\u5bf9\u3002\u4f46\u5b9e\u9645\u60c5\u51b5\u53ef\u80fd\u4f1a\u6bd4\u8f83\u590d\u6742\uff0c\u4f8b\u5982\u66f4\u590d\u6742\u7684\u5904\u7406\u5668\u91cc\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e71\u5e8f\u8bbf\u5b58\u7b49\u60c5\u51b5\uff0c\u540c\u65f6\u5904\u7406\u5668\u8fd8\u53ef\u80fd\u4f1a\u8fdb\u884c\u5199\u5408\u5e76\u7b49\u64cd\u4f5c\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u5728\u4eff\u771f\u9876\u5c42\u505a\u4e00\u4e9b\u5339\u914d\u548c\u5408\u5e76\u7684\u64cd\u4f5c\u3002\u5b9e\u5728\u89c9\u5f97\u9ebb\u70e6\uff0c\u4e5f\u53ef\u4ee5\u5148\u4e0d\u7ba1\u5185\u5b58\uff0c\u76f4\u63a5\u6bd4\u5bf9\u5bc4\u5b58\u5668\uff0c\u4e5f\u8db3\u591f\u5b9a\u4f4d\u5f88\u591a\u5185\u5b58\u95ee\u9898\uff0c\u56e0\u4e3a RISC-V \u8bfb\u5185\u5b58\u603b\u662f\u8981\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\u7684\u3002</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u7279\u6b8a\u60c5\u51b5","title":"\u7279\u6b8a\u60c5\u51b5","text":"<p>\u5b9e\u73b0\u4e86\u524d\u9762\u7684\u90e8\u5206\uff0c\u5c31\u53ef\u4ee5\u8dd1\u5f88\u591a\u7a0b\u5e8f\u4e86\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u7684\u7a0b\u5e8f\uff0c\u4f8b\u5982 Linux\uff0c\u8fd8\u7f3a\u5c11\u4e00\u6837\u4e1c\u897f\uff1a\u5916\u8bbe\u548c\u4e2d\u65ad\u3002\u80fd\u60f3\u5230\u7684\u7b2c\u4e00\u79cd\u65b9\u6cd5\u5c31\u662f\uff0c\u7528 C \u4ee3\u7801\u518d\u5199\u4e00\u4e2a\u5916\u8bbe\u7684\u6a21\u578b\uff0c\u7136\u540e\u63a5\u5230\u6a21\u62df\u5668\u7684\u865a\u62df\u603b\u7ebf\u4e0a\u3002\u4f46\u662f\u4e2d\u65ad\u5c31\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u4e2d\u65ad\u7684\u65f6\u673a\u6bd4\u8f83\u96be\u4fdd\u8bc1\u540c\u6b65\uff0c\u6240\u4ee5\u901a\u5e38\u7684\u65b9\u6cd5\u662f\uff0c\u628a\u6a21\u62df\u5668\u7684\u4e2d\u65ad\u5904\u7406\u5173\u6389\uff0c\u5f53 CPU \u53d1\u9001 trap \u7684\u65f6\u5019\uff0c\u8ba9\u6a21\u62df\u5668\u4e5f\u53d1\u751f\u4e00\u6b21 trap\u3002</p> <pre><code>// handle trap\nif (interrupt) {\n  trap_t trap = 0x8000000000000000 | interrupt;\n  proc-&gt;take_trap(trap, proc-&gt;get_state()-&gt;pc);\n  interrupt = 0;\n}\n</code></pre> <p>\u4f46\u6709\u4e00\u4e9b\u5916\u8bbe\u4e0d\u5bb9\u6613\u4fdd\u8bc1\u5b8c\u5168\u4e00\u81f4\uff0c\u4f8b\u5982 mtime \u8bfb\u53d6\u65f6\u95f4\uff0c\u5f88\u96be\u4fdd\u8bc1 CPU \u91cc\u8bfb\u53d6\u7684\u65f6\u95f4\u503c\u548c\u6a21\u62df\u5668\u91cc\u7684 mtime \u4e00\u81f4\u3002\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u91c7\u7528\u53e6\u4e00\u4e2a\u529e\u6cd5\uff1a\u8bb0\u5f55\u6240\u6709\u5bf9\u5916\u8bbe\u7684 load \u6307\u4ee4\uff0c\u56e0\u4e3a\u6709\u526f\u4f5c\u7528\u7684\u5173\u7cfb\uff0c\u4e00\u5b9a\u662f\u987a\u5e8f\u7684\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u50cf\u524d\u9762\u63d0\u5230\u7684\u961f\u5217\u7684\u65b9\u5f0f\uff0cCPU \u8fdb\u884c uncached load \u7684\u65f6\u5019\uff0c\u5c31\u628a load \u7684\u5730\u5740\u3001\u6570\u636e\u548c\u957f\u5ea6\u8bb0\u5f55\u5230\u961f\u5217\u4e2d\uff0c\u5f53\u6a21\u62df\u5668\u4e5f\u8981\u8fdb\u884c load \u7684\u65f6\u5019\uff0c\u5339\u914d\u4e0a\u5730\u5740\u548c\u957f\u5ea6\uff0c\u8fd4\u56de\u6570\u636e\u3002</p> <pre><code>// match rtl uncached load event\nif (!uncached_load_events.empty()) {\n  uncached_load_event ev = uncached_load_events.front();\n  if (ev.addr == addr &amp;&amp; ev.len == len) {\n    memcpy(bytes, (char *)&amp;ev.data, len);\n    uncached_load_events.pop_front();\n    return true;\n  }\n}\n</code></pre> <p>\u4f46\u8fd9\u6837\u5b9e\u9645\u4e0a\u5c31\u5047\u8bbe\u4e86\u5916\u8bbe\u5b9e\u73b0\u662f\u6b63\u786e\u7684\u3002\u5982\u679c\u8fd8\u9700\u8981\u9a8c\u8bc1\u5916\u8bbe\u5b9e\u73b0\u662f\u5426\u6b63\u786e\uff0c\u9700\u8981\u7ed3\u5408\u4e24\u79cd\u65b9\u6cd5\uff0c\u5bf9\u4e8e\u4e0d\u786e\u5b9a\u7ed3\u679c\u7684 load\uff08\u4f8b\u5982 mtime\uff09\uff0c\u5c31\u6309\u7167 CPU \u7684\u7ed3\u679c\u6765\uff0c\u5426\u5219\u5c31\u7528 C \u5b9e\u73b0\u7684\u5916\u8bbe\u6a21\u578b\u8fdb\u884c\u6bd4\u5bf9\u3002</p> <p>\u9664\u4e86\u8fd9\u4e9b\u610f\u5916\uff0c\u5904\u7406\u5668\u5b9e\u73b0\u7684 feature \u53ef\u80fd\u4f1a\u548c\u6a21\u62df\u5668\u6709\u4e00\u4e9b\u51fa\u5165\uff0c\u8fd9\u4e9b\u90fd\u6bd4\u8f83\u5bb9\u6613\u89e3\u51b3\uff0c\u76f4\u63a5\u4fee\u6539\u4ee3\u7801\uff0c\u5c4f\u853d\u6389\u6ca1\u6709\u5b9e\u73b0\u7684\u529f\u80fd\uff0c\u4fdd\u6301\u4e00\u81f4\u5373\u53ef\u3002</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#chatgptbard-\u7684\u56de\u590d","title":"ChatGPT/Bard \u7684\u56de\u590d","text":"<p>\u63d0\u95ee\uff1a</p> <p>How can I verify my RISC-V processor design via co-simulation with spike?</p> <p>ChatGPT:</p> <p>Co-simulation with Spike can be a great way to verify your RISC-V processor design. Here's a high-level overview of the process:</p> <ol> <li> <p>Write a testbench: You'll need to create a testbench that can generate inputs to your processor and check the outputs. This testbench can be written in any language you prefer, but most people use a hardware description language like Verilog or VHDL.</p> </li> <li> <p>Connect your processor to Spike: To run a co-simulation with Spike, you'll need to connect your processor design to Spike using a TLM (transaction-level modeling) interface. Spike has a built-in TLM interface called the \"Spike External Debug Interface\" (S-EDI) that you can use.</p> </li> </ol> <p>\u6ce8\uff1a\u67e5\u4e0d\u5230 Spike External Debug Interface</p> <ol> <li> <p>Configure the co-simulation: You'll need to configure the co-simulation by specifying the parameters of your processor design and Spike, such as the clock frequency and the reset signal.</p> </li> <li> <p>Run the simulation: Once your testbench is written, your processor is connected to Spike, and the co-simulation is configured, you can run the simulation. Your testbench will generate inputs to your processor, which will be processed by Spike and your processor design. The output of your processor will be checked by your testbench to verify that it's correct.</p> </li> <li> <p>Debug any issues: If you encounter any issues during the simulation, you'll need to debug them. This can involve looking at waveforms or logs to understand where things went wrong.</p> </li> </ol> <p>Here are some more detailed steps to follow:</p> <ol> <li> <p>Write your testbench in Verilog or VHDL. Your testbench should be able to generate inputs to your processor design and check the outputs. You can use any verification methodology you prefer, such as directed tests or random tests.</p> </li> <li> <p>Connect your processor design to Spike using the S-EDI interface. The S-EDI interface is a TLM interface that allows Spike to communicate with your processor design. You'll need to instantiate the S-EDI module in your testbench and connect it to your processor design. You can find more information about the S-EDI interface in the Spike documentation.</p> </li> <li> <p>Configure the co-simulation. You'll need to specify the clock frequency and reset signal for your processor design and Spike. You may also need to specify other parameters, such as the memory map for your processor design.</p> </li> <li> <p>Run the simulation. Once your testbench is written, your processor is connected to Spike, and the co-simulation is configured, you can run the simulation. You can use a simulator like ModelSim or QuestaSim to run the simulation.</p> </li> <li> <p>Debug any issues. If you encounter any issues during the simulation, you'll need to debug them. You can use the waveform viewer in your simulator to understand what's happening in your design. You can also use the Spike debugger to debug your processor design. The Spike debugger allows you to step through your code and examine the processor state.</p> </li> </ol> <p>By following these steps, you can use co-simulation with Spike to verify your RISC-V processor design.</p> <p>Bard:</p> <p>Co-simulation is a technique used in verification to run two or more models of a system in lockstep, with each model executing a different part of the system. This allows the models to be used together to verify that the system behaves as expected.</p> <p>To co-simulate your RISC-V processor design with Spike, you will need to create a model of your processor in Spike and a model of the system that your processor will be embedded in. You will then need to configure the two models to run in lockstep, with each model communicating with the other through a shared memory buffer.</p> <p>Once the co-simulation is running, you can use it to verify that your processor design behaves as expected. You can do this by running test cases on the system model and observing the behavior of your processor model. If the processor model behaves as expected, then you can be confident that your design is correct.</p> <p>Here are some of the benefits of using co-simulation:</p> <ul> <li>It can help you to find errors in your design early in the development process.</li> <li>It can help you to verify that your design meets the requirements of the system that it will be embedded in.</li> <li>It can help you to optimize your design for performance and power consumption.</li> </ul> <p>Here are some of the challenges of using co-simulation:</p> <ul> <li>It can be difficult to create accurate models of both your processor and the system that it will be embedded in.</li> <li>It can be difficult to configure the co-simulation to run in lockstep.</li> <li>It can be difficult to interpret the results of the co-simulation.</li> </ul> <p>Overall, co-simulation is a powerful technique that can be used to verify your RISC-V processor design. However, it is important to be aware of the challenges involved in using co-simulation.</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2023/03/23/core-cosim/#\u591a\u6838","title":"\u591a\u6838","text":"<p>\u4ee5\u4e0a\u7684\u65b9\u6cd5\u90fd\u662f\u9488\u5bf9\u5355\u6838 CPU \u8fdb\u884c\u534f\u540c\u4eff\u771f\u7684\uff0c\u4f46\u591a\u6838\u4f1a\u66f4\u52a0\u590d\u6742\uff0c\u591a\u6838\u6d89\u53ca\u5230\u4e0d\u540c\u6838\u5fc3\u4e4b\u95f4\u7684\u540c\u6b65\u3001\u901a\u4fe1\u7b49\u7b49\uff0c\u5f88\u96be\u628a\u4e00\u4e2a\u5468\u671f\u7cbe\u786e\u7684 CPU \u548c\u4e00\u4e2a\u4e0d\u7cbe\u786e\u7684\u6a21\u62df\u5668\u5339\u914d\u8d77\u6765\u3002\u9999\u5c71\u63d0\u4f9b\u4e86\u4e00\u4e2a\u601d\u8def\uff1ahttps://github.com/OpenXiangShan/XiangShan-doc/blob/main/slides/20210624-RVWC-SMP-Difftest%20%E6%94%AF%E6%8C%81%E5%A4%9A%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E5%B7%AE%E5%88%86%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95.pdf</p>","tags":["riscv","cpu","spike","cosim","simulation","verilator"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/","title":"CPU \u5fae\u67b6\u6784\u9006\u5411\u65b9\u6cd5\u5b66","text":"","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u505a\u4e86\u4e0d\u5c11\u5fae\u67b6\u6784\u7684\u8bc4\u6d4b\uff0c\u5176\u4e2d\u6d89\u53ca\u5230\u4e86\u5f88\u591a\u7684 CPU \u5fae\u67b6\u6784\u7684\u9006\u5411\uff1a</p> <ul> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul> <p>\u56e0\u6b64\u603b\u7ed3\u4e00\u4e0b CPU \u5fae\u67b6\u6784\u9006\u5411\u65b9\u6cd5\u5b66\u3002</p>","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u5b9a\u4e49","title":"\u5b9a\u4e49","text":"<p>\u9996\u5148\u5b9a\u4e49\u4e00\u4e0b\uff1a\u4ec0\u4e48\u662f CPU \u5fae\u67b6\u6784\u9006\u5411\uff0c\u6211\u8ba4\u4e3a CPU \u5fae\u67b6\u6784\u9006\u5411\u5305\u62ec\u4e24\u90e8\u5206\u542b\u4e49\uff1a</p> <ol> <li>\u5728\u5df2\u7ecf\u77e5\u9053\u67d0 CPU \u5fae\u67b6\u6784\u91c7\u7528\u67d0\u79cd\u8bbe\u8ba1\uff0c\u53ea\u662f\u4e0d\u77e5\u9053\u5176\u8bbe\u8ba1\u53c2\u6570\u65f6\uff0c\u901a\u8fc7\u9006\u5411\uff0c\u5f97\u5230\u5b83\u7684\u8bbe\u8ba1\u53c2\u6570</li> <li>\u5728\u4e0d\u786e\u5b9a\u67d0 CPU \u5fae\u67b6\u6784\u91c7\u7528\u7684\u662f\u4ec0\u4e48\u8bbe\u8ba1\uff0c\u7ed9\u51fa\u4e00\u4e9b\u53ef\u80fd\u7684\u8bbe\u8ba1\uff0c\u901a\u8fc7\u9006\u5411\uff0c\u6392\u9664\u6216\u786e\u8ba4\u5176\u8bbe\u8ba1\uff0c\u518d\u8fdb\u4e00\u6b65\u627e\u5230\u5b83\u7684\u8bbe\u8ba1\u53c2\u6570</li> </ol> <p>\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5df2\u7ecf\u77e5\u9053\u67d0 CPU \u5fae\u67b6\u6784\u6709\u4e00\u4e2a\u7ec4\u76f8\u8fde\u7684 L1 DCache\uff0c\u4f46\u4e0d\u77e5\u9053\u5b83\u7684\u5bb9\u91cf\uff0c\u51e0\u8def\u7ec4\u76f8\u8fde\uff0c\u6b64\u65f6\u901a\u8fc7\u5fae\u67b6\u6784\u9006\u5411\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5f97\u5230\u5b83\u7684\u5bb9\u91cf\uff0c\u5177\u4f53\u662f\u51e0\u8def\u7ec4\u76f8\u8fde\uff0c\u8fdb\u4e00\u6b65\u53ef\u80fd\u628a\u5b83\u7684 Index \u51fd\u6570\u4e5f\u9006\u5411\u51fa\u6765\u3002\u8fd9\u662f\u7b2c\u4e00\u90e8\u5206\u542b\u4e49\u3002</p> <p>\u518d\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5df2\u7ecf\u77e5\u9053\u67d0 CPU \u5fae\u67b6\u6784\u6709\u4e00\u4e2a\u5206\u652f\u9884\u6d4b\u5668\uff0c\u4f46\u4e0d\u77e5\u9053\u5b83\u4f7f\u7528\u4e86\u4ec0\u4e48\u4fe1\u606f\u6765\u505a\u9884\u6d4b\uff0c\u53ef\u80fd\u7528\u4e86\u5206\u652f\u7684\u5730\u5740\uff0c\u53ef\u80fd\u7528\u4e86\u5206\u652f\u8981\u8df3\u8f6c\u7684\u76ee\u7684\u5730\u5740\uff0c\u53ef\u80fd\u7528\u4e86\u5206\u652f\u7684\u65b9\u5411\uff0c\u8fd9\u65f6\u5019\u901a\u8fc7\u5fae\u67b6\u6784\u9006\u5411\u7684\u65b9\u6cd5\uff0c\u5bf9\u4e0d\u540c\u7684\u53ef\u80fd\u6027\u505a\u6392\u9664\uff0c\u627e\u5230\u771f\u6b63\u7684\u90a3\u4e00\u4e2a\u3002\u5982\u679c\u4e0d\u80fd\u6392\u9664\u5230\u53ea\u5269\u4e00\u4e2a\u53ef\u80fd\uff0c\u6216\u8005\u5168\u90e8\u53ef\u80fd\u90fd\u88ab\u6392\u9664\u6389\uff0c\u8bf4\u660e\u5b9e\u9645\u7684\u5fae\u67b6\u6784\u8bbe\u8ba1\u548c\u9884\u671f\u4e0d\u76f8\u7b26\u3002</p> <p>\u7b2c\u4e00\u90e8\u5206\u542b\u4e49\uff0c\u76ee\u524d\u5df2\u7ecf\u6709\u5927\u91cf\u7684\u6210\u719f\u7684 Microbenchmark\uff08\u9488\u5bf9\u5fae\u67b6\u6784 Microarchitecture \u8bbe\u8ba1\u7684 Benchmark\uff0c\u53eb\u505a Microbenchmark\uff09\u6765\u89e3\u51b3\uff0c\u5b83\u4eec\u9488\u5bf9\u5e38\u89c1\u7684\u5fae\u67b6\u6784\u8bbe\u8ba1\uff0c\u5b9e\u73b0\u4e86\u5bf9\u76f8\u5e94\u8bbe\u8ba1\u53c2\u6570\u7684\u9006\u5411\u7684 Microbenchmark\uff0c\u53ef\u4ee5\u5728\u5f88\u591a\u5e73\u53f0\u4e0a\u76f4\u63a5\u4f7f\u7528\u3002\u7b2c\u4e8c\u90e8\u5206\u542b\u4e49\uff0c\u76ee\u524d\u8fd8\u53ea\u80fd\u9010\u4e2a\u5206\u6790\uff0c\u53bb\u731c\u6d4b\u80cc\u540e\u7684\u8bbe\u8ba1\uff0c\u518d\u6839\u636e\u8bbe\u8ba1\u53bb\u6784\u9020\u5bf9\u5e94\u8be5\u8bbe\u8ba1\u7684 Microbenchmark\u3002</p> <p>\u4e0b\u9762\u4e3b\u8981\u6765\u4ecb\u7ecd\uff0c\u8bbe\u8ba1\u548c\u5b9e\u73b0 Microbenchmark \u7684\u65b9\u6cd5\u5b66\u3002</p>","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u539f\u7406","title":"\u539f\u7406","text":"<p>\u9996\u5148\u8981\u4e86\u89e3 Microbenchmark \u7684\u539f\u7406\uff0c\u5b83\u7684\u6838\u5fc3\u601d\u8def\u5c31\u662f\uff0c\u901a\u8fc7\u6784\u9020\u7a0b\u5e8f\uff0c\u8ba9\u67d0\u4e2a\u5fae\u67b6\u6784\u90e8\u4ef6\u6210\u4e3a\u74f6\u9888\uff0c\u63a5\u7740\u5728\u60f3\u8981\u9006\u5411\u7684\u8bbe\u8ba1\u53c2\u6570\u7684\u7ef4\u5ea6\u4e0a\u8fdb\u884c\u626b\u63cf\uff0c\u901a\u8fc7\u67d0\u79cd\u6307\u6807\u6765\u53cd\u6620\u662f\u5426\u51fa\u73b0\u4e86\u74f6\u9888\uff0c\u901a\u8fc7\u74f6\u9888\u5bf9\u5e94\u7684\u8bbe\u8ba1\u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u9006\u5411\u51fa\u6765\u8bbe\u8ba1\u53c2\u6570\u7684\u53d6\u503c\u3002\u8fd9\u4e00\u6bb5\u6709\u70b9\u96be\u7406\u89e3\uff0c\u4e0b\u9762\u7ed9\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p>\u6bd4\u5982\u8981\u6d4b\u8bd5\u7684\u662f L1 DCache \u7684\u5bb9\u91cf\uff0c\u90a3\u5c31\u5e0c\u671b L1 DCache \u7684\u5bb9\u91cf\u53d8\u6210\u74f6\u9888\u3002\u4e3a\u4e86\u8ba9\u5b83\u6210\u4e3a\u74f6\u9888\uff0c\u90a3\u5c31\u9700\u8981\u4e0d\u65ad\u5730\u8bbf\u95ee\u4e00\u7247\u5185\u5b58\uff0c\u5b83\u7684\u5927\u5c0f\u6bd4 L1 DCache \u8981\u66f4\u5927\uff0c\u8ba9 L1 DCache \u65e0\u6cd5\u5b8c\u6574\u4fdd\u5b58\u4e0b\u6765\uff0c\u51fa\u73b0\u7f13\u5b58\u7f3a\u5931\u3002\u4e3a\u4e86\u5224\u65ad\u7f13\u5b58\u7f3a\u5931\u662f\u5426\u51fa\u73b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u65f6\u95f4\u6216\u5468\u671f\uff0c\u56e0\u4e3a\u7f13\u5b58\u7f3a\u5931\u80af\u5b9a\u4f1a\u5e26\u6765\u6027\u80fd\u635f\u5931\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u7f13\u5b58\u7f3a\u5931\u7684\u6027\u80fd\u8ba1\u6570\u5668\u3002\u65e2\u7136\u8981\u9006\u5411\u7684\u8bbe\u8ba1\u53c2\u6570\u662f L1 DCache \u7684\u5bb9\u91cf\uff0c\u90a3\u5c31\u5728\u5bb9\u91cf\u4e0a\u8fdb\u884c\u4e00\u4e2a\u626b\u63cf\uff1a\u5728\u5185\u5b58\u4e2d\u5f00\u8f9f\u4e0d\u540c\u5927\u5c0f\u7684\u6570\u7ec4\uff0c\u6bd4\u5982\u4e00\u4e2a\u662f 32KB\uff0c\u53e6\u4e00\u4e2a\u662f 64KB\uff0c\u6bcf\u6b21\u6d4b\u8bd5\u7684\u65f6\u5019\u53ea\u8bbf\u95ee\u5176\u4e2d\u4e00\u4e2a\u6570\u7ec4\u3002\u6bcf\u4e2a\u6570\u7ec4\u626b\u63cf\u8bbf\u95ee\u82e5\u5e72\u6b21\uff0c\u7136\u540e\u7edf\u8ba1\u603b\u65f6\u95f4\u6216\u5468\u671f\u6570\u6216\u7f13\u5b58\u7f3a\u5931\u6b21\u6570\u3002\u5047\u5982\u5b9e\u9645 L1 DCache \u5bb9\u91cf\u4ecb\u4e8e 32KB \u548c 64KB \u4e4b\u95f4\uff0c\u90a3\u4e48\u5e94\u8be5\u53ef\u4ee5\u89c2\u5bdf\u5230 64KB \u6570\u7ec4\u5927\u5c0f\u6d4b\u5f97\u7684\u6027\u80fd\u76f8\u6bd4 32KB \u6709\u660e\u663e\u4e0b\u964d\u3002\u5982\u679c\u628a\u6d4b\u8bd5\u7c92\u5ea6\u53d8\u7ec6\uff0c\u6bcf 1KB \u8bbe\u7f6e\u4e00\u4e2a\u6570\u7ec4\u5927\u5c0f\uff0c\u6700\u7ec8\u5c31\u53ef\u4ee5\u786e\u5b9a\u5b9e\u9645\u7684 L1 DCache \u5bb9\u91cf\u3002</p> <p>\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u6210\u4e3a\u74f6\u9888\u7684\u5fae\u67b6\u6784\u90e8\u4ef6\u662f L1 DCache\uff0c\u60f3\u8981\u9006\u5411\u7684\u8bbe\u8ba1\u53c2\u6570\u662f\u5b83\u7684\u5bb9\u91cf\uff0c\u53cd\u6620\u662f\u5426\u51fa\u73b0\u74f6\u9888\u7684\u6307\u6807\u662f\u6027\u80fd\u6216\u7f13\u5b58\u7f3a\u5931\u6b21\u6570\uff0c\u6784\u9020\u7684\u7a0b\u5e8f\u505a\u7684\u4e8b\u60c5\u662f\u4e0d\u65ad\u5730\u8bbf\u95ee\u4e00\u4e2a\u53ef\u53d8\u5927\u5c0f\u7684\u6570\u7ec4\uff0c\u5176\u4e2d\u6570\u7ec4\u5927\u5c0f\u548c\u60f3\u8981\u9006\u5411\u7684\u8bbe\u8ba1\u53c2\u6570\u662f\u6302\u94a9\u7684\u3002</p> <p>\u56e0\u6b64\u53ef\u4ee5\u603b\u7ed3\u51fa Microbenchmark \u8bbe\u8ba1\u7684\u51e0\u4e2a\u8981\u7d20\uff1a</p> <ol> <li>\u9488\u5bf9\u4ec0\u4e48\u5fae\u67b6\u6784\u90e8\u4ef6</li> <li>\u9488\u5bf9\u8be5\u90e8\u4ef6\u7684\u4ec0\u4e48\u8bbe\u8ba1\u53c2\u6570</li> <li>\u53cd\u6620\u51fa\u73b0\u74f6\u9888\u7684\u6307\u6807\u662f\u4ec0\u4e48</li> <li>\u5982\u4f55\u6784\u9020\u7a0b\u5e8f\u6765\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0</li> <li>\u7a0b\u5e8f\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0</li> <li>\u7a0b\u5e8f\u7684\u53c2\u6570\u5982\u4f55\u5bf9\u5e94\u5230\u8bbe\u8ba1\u53c2\u6570\u4e0a</li> </ol> <p>\u6bd4\u5982\u4e0a\u9762\u7684 L1 DCache \u5bb9\u91cf\u7684\u6d4b\u8bd5\u4e0a\uff0c\u8fd9\u51e0\u4e2a\u8981\u7d20\u7684\u56de\u7b54\u662f\uff1a</p> <ol> <li>\u9488\u5bf9\u4ec0\u4e48\u5fae\u67b6\u6784\u90e8\u4ef6\uff1aL1 DCache</li> <li>\u9488\u5bf9\u8be5\u90e8\u4ef6\u7684\u4ec0\u4e48\u8bbe\u8ba1\u53c2\u6570\uff1aL1 DCache \u7684\u5bb9\u91cf</li> <li>\u53cd\u6620\u51fa\u73b0\u74f6\u9888\u7684\u6307\u6807\u662f\u4ec0\u4e48\uff1a\u65f6\u95f4\uff0c\u5468\u671f\u6570\uff0c\u7f13\u5b58\u7f3a\u5931\u6b21\u6570</li> <li>\u5982\u4f55\u6784\u9020\u7a0b\u5e8f\u6765\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0\uff1a\u5728\u5185\u5b58\u4e2d\u5f00\u8f9f\u6570\u7ec4\uff0c\u7136\u540e\u4e0d\u65ad\u5730\u626b\u63cf\u8bbf\u95ee</li> <li>\u7a0b\u5e8f\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0\uff1a\u6570\u7ec4\u5927\u5c0f\u8d85\u8fc7 L1 DCache \u5bb9\u91cf</li> <li>\u7a0b\u5e8f\u7684\u53c2\u6570\u5982\u4f55\u5bf9\u5e94\u5230\u8bbe\u8ba1\u53c2\u6570\u4e0a\uff1a\u6570\u7ec4\u7684\u5927\u5c0f\u5bf9\u5e94\u5230 L1 DCache \u7684\u5bb9\u91cf</li> </ol> <p>\u5047\u5982\u8981\u8bbe\u8ba1\u4e00\u4e2a\u9488\u5bf9 ROB(ReOrder Buffer) \u5bb9\u91cf\u7684\u6d4b\u8bd5\uff0c\u601d\u8003\u540c\u6837\u7684\u8981\u7d20\uff1a</p> <ol> <li>\u9488\u5bf9\u4ec0\u4e48\u5fae\u67b6\u6784\u90e8\u4ef6\uff1aROB</li> <li>\u9488\u5bf9\u8be5\u90e8\u4ef6\u7684\u4ec0\u4e48\u8bbe\u8ba1\u53c2\u6570\uff1aROB \u80fd\u5bb9\u7eb3\u591a\u5c11\u6761\u6307\u4ee4</li> <li>\u53cd\u6620\u51fa\u73b0\u74f6\u9888\u7684\u6307\u6807\u662f\u4ec0\u4e48\uff1a\u65f6\u95f4\uff0c\u5468\u671f\u6570</li> <li>\u5982\u4f55\u6784\u9020\u7a0b\u5e8f\u6765\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0\uff1a\u5728 ROB \u5f00\u5934\u548c\u7ed3\u5c3e\u5404\u653e\u4e00\u6761\u957f\u5ef6\u8fdf\u6307\u4ee4\uff0c\u4e2d\u95f4\u586b\u5145\u82e5\u5e72\u6761\u6307\u4ee4</li> <li>\u7a0b\u5e8f\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u74f6\u9888\u51fa\u73b0\uff1a\u5982\u679c\u6307\u4ee4\u586b\u5145\u5f97\u8db3\u591f\u591a\uff0c\u5bfc\u81f4\u7ed3\u5c3e\u7684\u957f\u5ef6\u8fdf\u6307\u4ee4\u4e0d\u80fd\u8fdb\u5165 ROB\uff0c\u90a3\u4e48\u5b83\u65e0\u6cd5\u88ab\u9884\u6d4b\u6267\u884c</li> <li>\u7a0b\u5e8f\u7684\u53c2\u6570\u5982\u4f55\u5bf9\u5e94\u5230\u8bbe\u8ba1\u53c2\u6570\u4e0a\uff1a\u628a\u7ed3\u5c3e\u7684\u957f\u5ef6\u8fdf\u6307\u4ee4\u963b\u62e6\u5728 ROB \u4e4b\u5916\u65f6\uff0c\u5728 ROB \u4e2d\u7684\u6307\u4ee4\u6570</li> </ol> <p>\u601d\u8003\u660e\u767d\u8fd9\u4e9b\u8981\u7d20\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u600e\u4e48\u8bbe\u8ba1\u51fa\u4e00\u4e2a Microbenchmark \u4e86\u3002</p> <p>\u539f\u7406\u4ecb\u7ecd\u5b8c\u4e86\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u7528\u7684\u65b9\u6cd5\u3002</p>","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u6307\u6807\u7684\u83b7\u53d6","title":"\u6307\u6807\u7684\u83b7\u53d6","text":"<p>\u4e0a\u9762\u63d0\u5230\uff0c\u4e3a\u4e86\u53cd\u6620\u51fa\u74f6\u9888\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u6307\u6807\uff0c\u5b83\u6700\u597d\u80fd\u591f\u7cbe\u786e\u5730\u53cd\u6620\u51fa\u74f6\u9888\u7684\u53d1\u751f\u4e0e\u5426\uff0c\u540c\u65f6\u4e5f\u5c3d\u91cf\u8981\u51cf\u5c11\u566a\u58f0\u3002\u80fd\u7528\u7684\u6307\u6807\u4e0d\u591a\uff0c\u53ea\u6709\u4e24\u7c7b\uff1a</p> <ol> <li>\u65f6\u95f4\uff1a\u6700\u901a\u7528\uff0c\u6240\u6709\u5e73\u53f0\u90fd\u53ef\u4ee5\u7528\uff0c\u5728\u7a0b\u5e8f\u524d\u540e\u5404\u8bb0\u4e00\u6b21\u65f6\u95f4\uff0c\u53d6\u5dee</li> <li>\u6027\u80fd\u8ba1\u6570\u5668\uff1a\u4f7f\u7528\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6709\u65f6\u9700\u8981 root \u6743\u9650\uff0c\u6216\u8005\u786c\u4ef6\u76f8\u5173\u4fe1\u606f\u4e0d\u516c\u5f00\uff0c\u53c8\u6216\u8005\u786c\u4ef6\u5c31\u6ca1\u6709\u5b9e\u73b0\u5bf9\u5e94\u7684\u6027\u80fd\u8ba1\u6570\u5668\u3002\u5404\u5e73\u53f0\u6027\u80fd\u8ba1\u6570\u5668\u53ef\u7528\u60c5\u51b5\uff1a<ol> <li>Windows\uff1a\u53ef\u7528\uff0c\u6709\u73b0\u6210 API</li> <li>macOS\uff1a\u53ef\u7528\uff0c\u6709\u9006\u5411\u51fa\u6765\u7684\u79c1\u6709\u6846\u67b6 API</li> <li>Linux\uff1a\u53ef\u7528\uff0c\u6709\u73b0\u6210 API</li> <li>iOS\uff1a\u5728 iOS \u5916\u53ef\u4ee5\u901a\u8fc7 Xcode Instruments \u8bbf\u95ee\u6240\u6709 PMU\uff0c\u4f46\u4e0d\u65b9\u4fbf\u81ea\u52a8\u5316\uff1b\u5728 iOS \u5185\u53ea\u80fd\u901a\u8fc7 PROC_PIDTHREADCOUNTS \u83b7\u5f97\u5468\u671f\u6570\u548c\u6307\u4ee4\u6570</li> <li>Android\uff1a\u9700\u8981 root \u6216\u901a\u8fc7 adb shell \u4f7f\u7528\uff0c\u6bd4\u8f83\u9ebb\u70e6\uff0cAPI \u548c Linux \u4e00\u6837</li> <li>HarmonyOS NEXT\uff1a\u6ca1\u627e\u5230\u65b9\u6848</li> </ol> </li> </ol> <p>\u867d\u7136\u6d4b\u65f6\u95f4\u6700\u7b80\u5355\u4e5f\u6700\u901a\u7528\uff0c\u4f46\u5b83\u4f1a\u53d7\u5230\u9891\u7387\u6ce2\u52a8\u7684\u9650\u5236\uff0c\u5982\u679c\u5728\u8fd0\u884c\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u9891\u7387\u5267\u70c8\u53d8\u5316\uff08\u7279\u522b\u662f\u624b\u673a\u5e73\u53f0\uff09\uff0c\u5f15\u5165\u4e86\u5927\u91cf\u566a\u58f0\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6709\u6548\u4fe1\u606f\u88ab\u6df9\u6ca1\u5728\u566a\u58f0\u5f53\u4e2d\u3002</p> <p>\u5176\u4e2d\u6027\u80fd\u8ba1\u6570\u5668\u662f\u6700\u4e3a\u7cbe\u786e\u7684\uff0c\u867d\u7136\u4f7f\u7528\u8d77\u6765\u8f83\u4e3a\u9ebb\u70e6\uff0c\u4f46\u4e5f\u786e\u5b9e\u652f\u6491\u4e86\u5f88\u591a\u66f4\u6df1\u5165\u7684 CPU \u5fae\u67b6\u6784\u7684\u9006\u5411\u3002\u5e0c\u671b\u786c\u4ef6\u5382\u5546\u770b\u5230\u8fd9\u7bc7\u6587\u7ae0\uff0c\u4e0d\u8981\u4e3a\u4e86\u907f\u514d\u9006\u5411\u628a\u6027\u80fd\u8ba1\u6570\u5668\u85cf\u8d77\u6765\uff1a\u56e0\u4e3a\u5b83\u5bf9\u4e8e\u5e94\u7528\u7684\u6027\u80fd\u5206\u6790\u771f\u7684\u5f88\u6709\u7528\u3002\u5177\u4f53\u600e\u4e48\u7528\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u53ef\u4ee5\u53c2\u8003\u4e00\u4e9b\u73b0\u6210\u7684 Microbenchmark \u6846\u67b6\u3002</p> <p>\u5728\u6709\u5f02\u6784\u6838\u7684\u5904\u7406\u5668\u4e0a\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6d4b\u8bd5\u7684\u662f\u9884\u671f\u5fae\u67b6\u6784\u7684\u6838\u5fc3\uff0c\u4e00\u822c\u8fd8\u4f1a\u914d\u5408\u7ed1\u6838\uff0c\u7ed1\u6838\u5728\u9664\u4e86 macOS \u548c iOS \u4ee5\u5916\u7684\u7cfb\u7edf\u90fd\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u7ed1\u54ea\u4e2a\u6838\u5fc3\uff0c\u800c macOS \u548c iOS \u53ea\u80fd\u901a\u8fc7\u6307\u5b9a QoS \u6765\u5efa\u8bae\u8c03\u5ea6\u5668\u8c03\u5ea6\u5230 P \u6838\u8fd8\u662f E\u6838\uff0c\u9996\u5148\u662f\u4e0d\u80fd\u786e\u5b9a\u662f\u54ea\u4e2a P \u6838\u6216\u54ea\u4e2a E \u6838\uff0c\u5176\u6b21\u8fd9\u53ea\u662f\u4e2a\u5efa\u8bae\uff0c\u5e76\u975e\u5f3a\u5236\u3002</p>","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u5957\u8def","title":"\u5957\u8def","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e9b\u6784\u9020\u74f6\u9888\u7684\u4e00\u4e9b\u5e38\u89c1\u5957\u8def\uff1a</p> <ol> <li>\u6d4b\u8bd5\u5bb9\u91cf\uff08\u6bd4\u5982\u5404\u7ea7 I/D Cache \u548c TLB\uff09\uff1a\u6784\u9020\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u53bb\u628a\u5bb9\u91cf\u7528\u6ee1\uff0c\u5f53\u5bb9\u91cf\u88ab\u7528\u6ee1\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u89c2\u5bdf\u5230\u6027\u80fd\u4e0b\u964d</li> <li>\u6d4b\u8bd5\u5fae\u67b6\u6784\u961f\u5217\u6216 Buffer \u6df1\u5ea6\uff08\u6bd4\u5982 ROB\uff0c\u5bc4\u5b58\u5668\u5806\uff0c\u8c03\u5ea6\u961f\u5217\uff09\uff1a\u5728\u961f\u5217\u5f00\u5934\u901a\u8fc7\u6307\u4ee4\u5835\u4f4f\u961f\u5217\u7684\u51fa\u961f\uff0c\u63a5\u7740\u4e0d\u65ad\u5730\u5411\u961f\u5217\u4e2d\u5165\u961f\u65b0\u7684\u6307\u4ee4\uff0c\u5f53\u961f\u5217\u6ee1\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u80fd\u591f\u5165\u961f\u65b0\u7684\u6307\u4ee4\uff0c\u6b64\u65f6\u518d\u5f15\u5165\u4e00\u4e9b\u539f\u6765\u4e0d\u4f1a\u88ab\u5835\u4f4f\u7684\u6307\u4ee4\uff0c\u73b0\u5728\u56e0\u4e3a\u961f\u5217\u88ab\u5835\u4f4f\u4e86\u800c\u8fdb\u4e0d\u53bb\uff0c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d</li> <li>\u6d4b\u8bd5\u7ec4\u76f8\u8fde\u7ed3\u6784\uff08\u6bd4\u5982 BTB\uff0cCache \u7b49\u7ec4\u76f8\u8fde\u7ed3\u6784\uff09\uff1a\u7ec4\u76f8\u8fde\u7ed3\u6784\u4e0b\uff0c\u6bcf\u4e2a Index \u5185\u7684\u5bb9\u91cf\u662f\u56fa\u5b9a\u7684\uff0c\u901a\u8fc7\u6d4b\u8bd5\u5bb9\u91cf\uff0c\u53ef\u4ee5\u5f97\u5230\u6709\u591a\u5c11 Index \u88ab\u8986\u76d6\u4e86\uff0c\u5982\u679c\u901a\u8fc7\u4fee\u6539 Index \u51fd\u6570\u7684\u8f93\u5165\uff08\u6bd4\u5982 PC\uff09\uff0c\u4f7f\u5f97\u67d0\u4e9b Index \u65e0\u6cd5\u88ab\u8bbf\u95ee\u5230\uff0c\u5c31\u53ef\u4ee5\u89c2\u5bdf\u5230\u5bb9\u91cf\u4e0a\u7684\u51cf\u5c11\uff0c\u5e76\u4e14\u5b9e\u9645\u5bb9\u91cf\u4e5f\u53cd\u9988\u51fa\u4e86\u8fd8\u6709\u591a\u5c11 Index \u80fd\u591f\u88ab\u8bbf\u95ee\u5230\u7684\u4fe1\u606f</li> <li>\u6784\u9020 pointer chasing\uff1a\u4ee5 8B(\u5bf9\u5e94 64 \u4f4d\u6307\u9488)\u3001\u7f13\u5b58\u884c\u5927\u5c0f\u6216\u9875\u5927\u5c0f\u4e3a\u7c92\u5ea6\uff0c\u8fdb\u884c\u968f\u673a\u6253\u4e71\uff0c\u7136\u540e\u628a\u5b83\u4eec\u7528\u6307\u9488\u4e32\u8054\u8d77\u6765\uff0c\u524d\u4e00\u4e2a\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u4e2d\u4fdd\u5b58\u540e\u4e00\u4e2a\u6307\u9488\u7684\u5730\u5740</li> <li>\u6784\u9020\u957f\u5ef6\u8fdf\u6307\u4ee4\uff1a\u5728\u6d4b\u8bd5\u6307\u4ee4\u961f\u5217\u76f8\u5173\u7684\u573a\u666f\u4e0b\u5e38\u7528\uff0c\u901a\u5e38\u53ef\u4ee5\u7528 pointer chasing long latency load \u6216\u8005\u4e00\u6bb5\u5177\u6709\u4e32\u884c\u4f9d\u8d56\u7684\u6d6e\u70b9\u9664\u6cd5\u6216\u5f00\u6839\u6307\u4ee4\u6765\u5b9e\u73b0</li> </ol> <p>\u518d\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u89c1\u7684\u5751\uff1a</p> <ol> <li>\u5c3d\u91cf\u7528\u6c47\u7f16\u6765\u6784\u9020\u6d4b\u4f8b\uff0cC/C++ \u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5e26\u6765\u4e0d\u671f\u671b\u7684\u884c\u4e3a</li> <li>\u94fe\u63a5\u5668\u6709\u4e00\u4e9b\u884c\u4e3a\u53ef\u80fd\u662f\u9700\u8981\u907f\u514d\u7684\uff0c\u4f8b\u5982\u5b83\u53ef\u80fd\u4f1a\u4fee\u6539\u4e00\u4e9b\u6307\u4ee4</li> <li>\u94fe\u63a5\u5668\u8fd8\u53ef\u80fd\u6709\u4e00\u4e9b\u5c40\u9650\u6027\uff0c\u4f8b\u5982\u5b83\u4e0d\u652f\u6301\u5de8\u5927\u7684\u5bf9\u9f50</li> </ol>","tags":["cpu","uarch-review"]},{"location":"hardware/2024/12/27/cpu_uarch_reverse_engineering_methodology/#\u73b0\u6210-microbenchmark","title":"\u73b0\u6210 Microbenchmark","text":"<p>\u5b9e\u9645\u4e0a\uff0c\u73b0\u5728\u5df2\u7ecf\u6709\u5f88\u591a\u73b0\u6210\u7684 Microbenchmark\uff0c\u4ee5\u53ca\u4e00\u4e9b\u8bb0\u5f55\u4e86 Microbenchmark \u7684\u6587\u6863\uff1a</p> <ul> <li>https://www.agner.org/optimize/</li> <li>https://github.com/clamchowder/Microbenchmarks/</li> <li>https://github.com/JamesAslan/MicroArchBench</li> <li>https://github.com/name99-org/AArch64-Explore</li> <li>https://github.com/jiegec/cpu-micro-benchmarks</li> </ul> <p>\u4ee5\u53ca\u4e00\u4e9b\u7528 Microbenchmark \u505a\u9006\u5411\u5e76\u516c\u5f00\u7684\u7f51\u7ad9\uff1a</p> <ul> <li>https://chipsandcheese.com</li> <li>https://www.anandtech.com\uff08\u53ef\u60dc\u4e0d\u518d\u66f4\u65b0\uff09</li> <li>https://blog.hjc.im/</li> <li>https://www.zhihu.com/people/jamesaslan</li> <li>\u672c\u535a\u5ba2</li> </ul> <p>\u5982\u679c\u4f60\u60f3\u8981\u53bb\u9006\u5411\u67d0\u4e2a\u5fae\u67b6\u6784\u7684\u67d0\u4e2a\u90e8\u4ef6\uff0c\u4f46\u4e0d\u77e5\u9053\u600e\u4e48\u505a\uff0c\u4e0d\u59a8\u5728\u4e0a\u9762\u8fd9\u4e9b\u7f51\u7ad9\u4e0a\u5bfb\u627e\u4e00\u4e0b\uff0c\u662f\u4e0d\u662f\u5df2\u7ecf\u6709\u73b0\u6210\u7684\u5b9e\u73b0\u4e86\u3002</p> <p>\u5982\u679c\u4f60\u5bf9\u5982\u4f55\u7f16\u5199\u8fd9\u4e9b Microbenchmark \u4e0d\u611f\u5174\u8da3\uff0c\u4e5f\u53ef\u4ee5\u8bd5\u8bd5\u5728\u81ea\u5df1\u7535\u8111\u4e0a\u8fd0\u884c\u8fd9\u4e9b\u7a0b\u5e8f\uff0c\u6216\u8005\u76f4\u63a5\u9605\u8bfb\u5df2\u6709\u7684\u5206\u6790\u3002</p>","tags":["cpu","uarch-review"]},{"location":"hardware/2022/11/20/cxl-notes/","title":"CXL \u5b66\u4e60\u7b14\u8bb0","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u524d\u6bb5\u65f6\u95f4\u5b66\u4e60\u4e86 PCIe\uff0c\u8d81\u6b64\u673a\u4f1a\uff0c\u8fdb\u4e00\u6b65\u5b66\u4e60\u4e00\u4e0b\u5bc6\u5207\u76f8\u5173\u7684 CXL\u3002</p> <p>CXL \u7684\u6807\u51c6\u662f\u516c\u5f00\u4e0b\u8f7d\u7684\uff1ahttps://www.computeexpresslink.org/download-the-specification\uff0c\u6211\u76ee\u524d\u53c2\u8003\u7684\u662f 2022 \u5e74 8 \u6708 1 \u65e5\u7684 CXL 3.0 \u7248\u672c\u3002</p>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#cxl-\u8bbe\u5907\u7c7b\u578b","title":"CXL \u8bbe\u5907\u7c7b\u578b","text":"<p>CXL \u5bf9 PCIe \u7684\u91cd\u8981\u7684\u6269\u5c55\uff0c\u4e00\u662f\u5728\u4e8e\u8ba9\u8bbe\u5907\u53ef\u4ee5\u548c CPU \u5b9e\u73b0\u7f13\u5b58\u4e00\u81f4\u6027\uff08CXL.cache\uff09\uff0c\u4e8c\u662f\u53ef\u4ee5\u505a\u8fdc\u7a0b\u7684\u5185\u5b58\uff08CXL.mem\uff09\u3002</p> <p>\u5177\u4f53\u4e0b\u6765\uff0cCXL \u6807\u51c6\u4e3b\u8981\u5b9a\u4e49\u4e86\u4e09\u7c7b\u8bbe\u5907\uff1a</p> <ul> <li>CXL Type 1: \u8bbe\u5907\u5e26\u6709\u4e0e CPU \u4e00\u81f4\u7684\u7f13\u5b58\uff0c\u5b9e\u73b0 CXL.io \u548c CXL.cache</li> <li>CXL Type 2: \u8bbe\u5907\u5e26\u6709\u81ea\u5df1\u7684\u5185\u5b58\u548c\u4e0e CPU \u4e00\u81f4\u7684\u7f13\u5b58\uff0c\u5b9e\u73b0 CXL.io\uff0cCXL.cache \u548c CXL.mem</li> <li>CXL Type 3: \u8bbe\u5907\u5e26\u6709\u81ea\u5df1\u7684\u5185\u5b58\uff0c\u5b9e\u73b0 CXL.io \u548c CXL.mem</li> </ul>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#cxl-\u4f20\u8f93\u5c42","title":"CXL \u4f20\u8f93\u5c42","text":"","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#cxlio","title":"CXL.io","text":"<p>CXL.io \u57fa\u672c\u4e0a\u5c31\u662f PCIe \u534f\u8bae\uff1a</p> <pre><code>CXL.io provides a non-coherent load/store interface for I/O devices. Figure\n3-1 shows where the CXL.io transaction layer exists in the Flex Bus layered\nhierarchy. Transaction types, transaction packet formatting, credit-based\nflow control, virtual channel management, and transaction ordering rules\nfollow the PCIe* definition; please refer to the \u201cTransaction Layer\nSpecification\u201d chapter of PCIe Base Specification for details. This chapter\nhighlights notable PCIe operational modes or features that are used for\nCXL.io.\n</code></pre> <p>CXL 3.0 \u901f\u5ea6\u662f 64.0 GT/s\uff0c\u4f7f\u7528 PAM4 \u7f16\u7801\uff0c\u5bf9\u5e94\u7684\u662f PCIe 6.0\u3002</p>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#cxlcache","title":"CXL.cache","text":"<p>CXL.cache \u6bcf\u4e2a\u65b9\u5411\u4e0a\u6709\u4e09\u4e2a channel\uff1a\u8bf7\u6c42\uff0c\u54cd\u5e94\u548c\u6570\u636e\u3002\u8003\u8651\u5230 Host \u548c Device \u7684\u4f20\u8f93\u65b9\u5411\uff0c\u5c31\u662f\u516d\u4e2a channel\uff1aD2H Req\uff0cD2H Resp\uff0cD2H Data\uff0cH2D Req\uff0cH2D Resp\uff0cH2D Data\u3002\u5728 Data channel \u4e0a\u4f20\u8f93\u7684\u7f13\u5b58\u884c\u5927\u5c0f\u662f 64 \u5b57\u8282\u3002</p> <p>CXL.cache \u7684\u7f13\u5b58\u884c\u72b6\u6001\u91c7\u7528\u7684\u662f MESI\u3002</p> <p>CXL.cache \u4f20\u8f93\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a68B Flit\uff0c256B Flit \u548c PBR Flit\u3002</p> <p>H2D Request \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li><code>Address[51:6]</code>: \u7269\u7406\u5730\u5740</li> <li>UQID: Unique Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>D2H Response \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>UQID: Unique Queue ID</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Data \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>UQID: Unique Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>Poison: data is corrupted</li> <li>BEP: Only in 256B Flit &amp; PBR Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Request \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>CQID: Command Queue ID</li> <li>NT: Non Temporal</li> <li>CacheID: Only in 256B Flit</li> <li>Address: 46 \u4f4d\u7269\u7406\u5730\u5740</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>H2D Response \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>RspData</li> <li>RSP_PRE</li> <li>CQID: Command Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>H2D Data \u7684\u5b57\u6bb5\uff1a</p> <ul> <li>Valid</li> <li>CQID: Command Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>GO-Err</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#\u8bf7\u6c42\u7c7b\u578b","title":"\u8bf7\u6c42\u7c7b\u578b","text":"<p>\u9996\u5148\u8003\u8651 Host \u4f1a\u53d1\u9001\u7684\u8bf7\u6c42\u3002</p> <p>\u7b2c\u4e00\u79cd\u662f SnpData\uff0c\u4f8b\u5982\u5728 Host \u5728\u8bfb\u53d6\u7684\u65f6\u5019\u51fa\u73b0\u7f3a\u5931\uff0c\u6b64\u65f6\u9700\u8981\u5411 Device \u53d1\u9001 Snoop\uff0c\u83b7\u53d6\u6700\u65b0\u7684 Dirty \u7684 Data\uff0c\u6216\u8005\u8ba9 Device \u7684\u7f13\u5b58\u884c\u964d\u7ea7\u4e3a Shared \u72b6\u6001\u3002</p> <p>Device \u6536\u5230 SnpData \u540e\uff0c\u5982\u679c\u53d1\u73b0\u7f13\u5b58\u884c\u4e0d\u5728\u7f13\u5b58\u4e2d\uff08\u72b6\u6001\u662f I\uff09\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a RspIHitI\uff1b\u5982\u679c\u7f13\u5b58\u884c\u5728\u7f13\u5b58\u4e2d\u4e14\u6570\u636e\u6ca1\u6709\u4fee\u6539\uff08\u72b6\u6001\u662f S \u6216\u8005 E\uff09\uff0c\u964d\u7ea7\u5230 S\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a RspSHitSE\uff1b\u5982\u679c\u7f13\u5b58\u884c\u662f dirty\uff08\u72b6\u6001\u662f M\uff09\uff0c\u53ef\u4ee5\u9009\u62e9\u964d\u7ea7\u5230 S\uff0c\u7136\u540e\u56de\u590d RspSFwdM \u4ee5\u53ca\u7f13\u5b58\u884c\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u53d8\u6210 Invalid\uff0c\u56de\u590d RspIFwdM \u4ee5\u53ca\u7f13\u5b58\u884c\u7684\u6570\u636e\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e9b D2H Response \u7684 Opcode \u7684\u540d\u5b57\u683c\u5f0f\u5f88\u6709\u89c4\u5f8b\uff0c<code>Rsp+A+Hit/Fwd+B</code>\uff0cA \u8868\u793a\u65b0\u7684\u7f13\u5b58\u884c\u72b6\u6001\uff0cB \u662f\u539f\u6765\u7684\u7f13\u5b58\u884c\u72b6\u6001\uff0cHit \u4e0d\u9644\u5e26\u6570\u636e\uff0cFwd \u9644\u5e26\u6570\u636e\u3002</p> <p>\u7b2c\u4e8c\u79cd\u662f SnpInv\uff0c\u4f8b\u5982 Host \u8981\u5199\u5165\u7f13\u5b58\uff0c\u5c31\u8981 invalidate \u5176\u4ed6\u7f13\u5b58\u3002Device \u6536\u5230\u4ee5\u540e\uff0c\u53ef\u80fd\u8fd4\u56de RspIHitI\u3001RspIHitSE \u548c RspIFwdM\uff0c\u5206\u522b\u5bf9\u5e94\u4e0d\u540c\u7684\u521d\u59cb\u72b6\u6001\uff0c\u6700\u7ec8\u90fd\u662f Invalid \u6001\u3002</p> <p>\u7b2c\u4e09\u79cd\u662f SnpCur\uff0c\u83b7\u53d6\u5f53\u524d\u7684\u7f13\u5b58\u884c\u72b6\u6001\u3002Device \u53ef\u4ee5\u4fee\u6539\u7f13\u5b58\u884c\u72b6\u6001\uff0c\u4f46\u662f\u4e0d\u5efa\u8bae\u3002\u53ef\u80fd\u7684\u8fd4\u56de\u6709 RspIHitI\uff0cRspVHitV\uff0cRspSHitSE\uff0cRspSFwdM\uff0cRspIFwdM \u548c RspVFwdV\u3002\u8fd9\u91cc\u7684 V \u8868\u793a Valid\uff0c\u5bf9\u5e94 MESI \u4e2d\u7684 MES \u4e09\u79cd\u72b6\u6001\u3002\u6240\u4ee5\u5982\u679c\u7f13\u5b58\u884c\u72b6\u6001\u4e0d\u53d8\u7684\u8bdd\uff0c\u5c31\u662f RspIHitI\uff0cRspVHitV \u548c RspVFwdV \u4e09\u79cd\u54cd\u5e94\u3002</p> <p>\u518d\u8003\u8651 Device \u4f1a\u53d1\u9001\u7684\u8bf7\u6c42\u3002\u9996\u5148\uff0c\u8bf7\u6c42\u53ef\u4ee5\u5206\u4e3a\u56db\u7c7b\uff1a</p> <ol> <li>Read\uff1a\u53d1\u9001 D2H Request\uff0c\u63a5\u6536 H2D Response \u548c H2D Data</li> <li>Read0\uff1a\u53d1\u9001 D2H Request\uff0c\u63a5\u6536 H2D Response</li> <li>Write\uff1a\u53d1\u9001 D2H Request\uff0c\u63a5\u6536 H2D Response\uff0c\u53d1\u9001 D2H Data\uff0c\u53ef\u9009\u63a5\u6536 H2D Response</li> <li> <p>Read0-Write\uff1a\u53d1\u9001 D2H Request\uff0c\u63a5\u6536 H2D Response\uff0c\u53d1\u9001 D2H Data</p> </li> <li> <p>RdCurr(Read)\uff0cDevice \u8bfb\u53d6 Host \u7684\u7f13\u5b58\u884c\uff0c\u4e0d\u9020\u6210\u4efb\u4f55\u7684\u7f13\u5b58\u72b6\u6001\u7684\u4fee\u6539\u3002Device \u7f13\u5b58\u8fd8\u662f\u5904\u4e8e Invalid \u72b6\u6001\u3002</p> </li> <li>RdOwn(Read)\uff0cDevice \u8bfb\u53d6 Host \u7684\u7f13\u5b58\u884c\uff0c\u53ef\u4ee5\u8fdb\u5165 E \u6001\u6216\u8005 M \u6001\u3002Host \u54cd\u5e94 GO-Err/GO-I/GO-E/GO-M\u3002</li> <li>RdShared(Read)\uff0cDevice \u8bfb\u53d6 Host \u7684\u7f13\u5b58\u884c\uff0c\u8fdb\u5165 S \u6001\u3002Host \u54cd\u5e94 GO-Err/GO-I/GO-S\u3002</li> <li>RdAny(Read)\uff0cDevice \u8bfb\u53d6 Host \u7684\u7f13\u5b58\u884c\uff0c\u8fdb\u5165 M \u6001\uff0cE \u6001\u6216 S \u6001\u3002Host \u54cd\u5e94 GO-Err/GO-I/GO-S/GO-E/GO-M\u3002</li> <li>RdOwnNoData(Read0)\uff0cDevice \u4e0d\u8bfb\u53d6\u73b0\u5728\u7f13\u5b58\u884c\u7684\u6570\u636e\uff0c\u8fdb\u5165 E \u6001\u3002\u4e00\u822c\u7528\u4e8e\u6574\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\u90fd\u8981\u66f4\u65b0\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u6216\u8bb8\u5f53\u524d\u7f13\u5b58\u884c\u7684\u6570\u636e\u3002</li> <li>ItoMWr(Read0-Write)\uff0cDevice \u5199\u5165\u65b0\u7684\u5b8c\u6574\u7f13\u5b58\u884c\u5230 Host \u4e2d\uff0c\u5e76\u4e14\u8fdb\u5165 M \u6001\u3002Host \u54cd\u5e94 GO_WritePull/GO_ERR_WritePull\u3002</li> <li>WrCur(Read0-Write)\uff0c\u548c ItoMWr \u57fa\u672c\u4e00\u6837\uff0c\u533a\u522b\u5728\u4e8e\uff0c\u5982\u679c\u7f13\u5b58\u884c\u547d\u4e2d\u4e86\uff0c\u5c31\u5199\u5165\u5230\u7f13\u5b58\u4e2d\uff1b\u5982\u679c\u7f3a\u5931\u4e86\uff0c\u5c31\u5199\u5165\u5230\u5185\u5b58\u4e2d\u3002Host \u54cd\u5e94 GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CLFlush(Read0)\uff0c\u8981\u6c42 Host Invalidate \u4e00\u4e2a\u7f13\u5b58\u884c\u3002Host \u54cd\u5e94 GO-Err/GO-I\u3002</li> <li>CleanEvict(Write)\uff0cDevice \u8981 Evict \u4e00\u4e2a Exclusive \u7684\u7f13\u5b58\u884c\u3002Host \u54cd\u5e94 GO_WritePull/GO_WritePull_Drop\u3002</li> <li>DirtyEvict(Write)\uff0cDevice \u8981 Evict \u4e00\u4e2a Modified \u7684\u7f13\u5b58\u884c\u3002Host \u54cd\u5e94 GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CleanEvictNoData(Write)\uff0cDevice \u8981 Evict \u4e00\u4e2a Exclusive \u7684\u7f13\u5b58\u884c\uff0c\u4f46\u662f\u4e0d\u4f20\u8f93\u6570\u636e\uff0c\u53ea\u7528\u4e8e\u66f4\u65b0 Snoop Filter\u3002Host \u54cd\u5e94 GO-I\u3002</li> <li>WrInv(Write)\uff0cWrite Invalidate Line\uff0c\u5411 Host \u5199\u5165 0-64 \u5b57\u8282\u7684\u6570\u636e\uff0c\u5e76\u4e14 Invalidate \u7f13\u5b58\u3002Host \u54cd\u5e94 WritePull/GO-Err/GO-I\u3002</li> <li>WOWrInv(Write)\uff0cWeakly Ordered \u7248\u672c\u7684 WrInV\uff0c\u5199\u5165 0-63 \u5b57\u8282\u7684\u6570\u636e\u3002Host \u54cd\u5e94 ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>WOWrInvF(Write)\uff0cWeakly Ordered \u7248\u672c\u7684 WrInv\uff0c\u5199\u5165 64 \u5b57\u8282\u7684\u6570\u636e\u3002Host \u54cd\u5e94 ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>CacheFlushed(Read0)\uff0c\u544a\u8bc9 Host \u81ea\u5df1\u7684\u7f13\u5b58\u90fd\u88ab\u6e05\u7a7a\u4e86\uff0c\u6240\u6709\u7f13\u5b58\u884c\u90fd\u5728 I \u72b6\u6001\u3002Host \u54cd\u5e94 GO-I\u3002</li> </ol>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#\u548c\u5176\u4ed6\u534f\u8bae\u7684\u5bf9\u6bd4","title":"\u548c\u5176\u4ed6\u534f\u8bae\u7684\u5bf9\u6bd4","text":"<p>\u4e4b\u524d\u5728 TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790 \u5206\u6790\u8fc7 TileLink \u7684\u7f13\u5b58\u4e00\u81f4\u6027\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5982\u679c\u67d0\u4e00\u4e2a\u7f13\u5b58\uff08Master A\uff09\u51fa\u73b0\u4e86\u7f3a\u5931\uff0c\u9700\u8981\u7ecf\u8fc7\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u5728 TileLink Cached \u91cc\u9762\uff0c\u6240\u6709\u7684 Master \u90fd\u662f\u5e73\u7b49\u7684\u3002\u800c\u5728 CXL \u4e2d\uff0c\u9700\u8981\u7ef4\u62a4\u7f13\u5b58\u4e00\u81f4\u6027\u7684\uff0c\u6709 CPU \u5185\u90e8\u7684\u5404\u4e2a\u7f13\u5b58\u4e4b\u95f4\uff0c\u8fd8\u6709 CPU \u548c\u8bbe\u5907\u4e4b\u95f4\u3002\u800c CXL.cache \u4e3b\u8981\u8d1f\u8d23\u7684\u662f\u4e0e\u8bbe\u5907\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u90e8\u5206\uff0c\u7ef4\u62a4\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u6838\u5fc3\u662f\u5728 CPU \u4e00\u4fa7\uff0cHost \u76f8\u5f53\u4e8e TileLink \u7684 Slave\uff0cDevice \u76f8\u5f53\u4e8e TileLink \u7684 Master A\u3002\u53ef\u4ee5\u8bf4 CXL.cache \u662f\u4e0d\u5bf9\u79f0\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u3002</p> <p>\u53e6\u4e00\u4e2a\u76f8\u5173\u7684\u534f\u8bae\u662f ACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u548c TileLink \u7c7b\u4f3c\u3002</p> <p>\u4f8b\u5982 CXL \u4e2d\u8bbe\u5907\u8bfb\u53d6\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u51fa\u73b0\u4e86\u7f3a\u5931\uff0c\u90a3\u4e48\u9700\u8981\u7ecf\u8fc7\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>Device -&gt; Host: RdShared/RdOwn</li> <li>Host -&gt; CPU Caches: Custom Snoop Messages</li> <li>Host -&gt; Other CXL Device: SnpData</li> <li>Other CXL Device -&gt; Host: RspSHitSE/RspSFwdM</li> <li>Host -&gt; Device: GO-S</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4f53\u7684\u6d41\u7a0b\u4e5f\u662f\u5dee\u4e0d\u591a\u7684\u3002</p>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2022/11/20/cxl-notes/#cxlmem","title":"CXL.mem","text":"<p>CXL.mem \u7528\u4e8e\u6269\u5c55\u5185\u5b58\uff0c\u6839\u636e\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u5b83\u53ef\u80fd\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u80fd\u548c CXL.cache \u914d\u5408\u4f7f\u7528\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6709\u4e09\u79cd\u4e00\u81f4\u6027\u6a21\u578b\uff1a</p> <ol> <li>HDM-H(Host-only Coherent)\uff1a\u4ec5 Type 3 \u8bbe\u5907\uff0c\u4e5f\u5c31\u662f\u65e0 CXL.cache</li> <li>HDM-D(Device Coherent)\uff1a\u4ec5 Legacy Type 2 \u8bbe\u5907\uff0c\u4e5f\u5c31\u662f\u6709 CXL.cache</li> <li>HDM-DB(Device Coherent using Back-Invalidation)\uff1aType 2 \u6216 Type 3 \u8bbe\u5907</li> </ol> <p>\u5728 CXL.cache \u4e2d\uff0c\u4e24\u7aef\u662f Host \u548c Device\uff1b\u800c CXL.mem\uff0c\u4e24\u7aef\u662f Master \u548c Subordinate\u3002</p> <p>\u4ece Master \u5230 Subordinate \u7684\u6d88\u606f\uff08M2S\uff09\u6709\u4e09\u7c7b\uff1a</p> <ol> <li>Request(Req)</li> <li>Request with Data(RwD)</li> <li>Back-Invalidation Response(BIRsp)</li> </ol> <p>\u4ece Subordinate \u5230 Master \u7684\u6d88\u606f\uff08S2M\uff09\u6709\u4e09\u7c7b\uff1a</p> <ol> <li>Response without data(NDR, No Data Response)</li> <li>Response with Data(DRS, Data Response)</li> <li>Back-Invalidation Snoop(BiSnp)</li> </ol> <p>\u5176\u4e2d\u6bd4\u8f83\u7279\u522b\u7684\u662f Back-Invalidation\uff0c\u8fd9\u4e2a\u7684\u76ee\u7684\u662f\u8ba9 Device \u53ef\u4ee5\u901a\u8fc7 Snoop \u4fee\u6539 Host \u4e2d\u7f13\u5b58\u4e86 Device \u5185\u5b58\u4e2d\u7684\u6570\u636e\u7684\u7f13\u5b58\u884c\u3002</p> <p>\u5bf9\u4e8e Type 3 \u7684\u8bbe\u5907\uff08\u65e0 CXL.cache\uff09\u6765\u8bf4\uff0cDevice \u5c31\u662f\u4e00\u4e2a\u6269\u5c55\u7684\u5185\u5b58\uff0c\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u652f\u6301\u8bfb\u5199\u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\u3002Host \u53d1\u9001 <code>MemRd*</code>\uff0cDevice \u54cd\u5e94 MemData\uff1bHost \u53d1\u9001 <code>MemWr*</code>\uff0cDevice \u54cd\u5e94 Cmp\u3002</p> <p>\u5bf9\u4e8e Type 2 \u7684\u8bbe\u5907\uff08\u6709 CXL.cache\uff09\u6765\u8bf4\uff0cDevice \u65e2\u6709\u81ea\u5df1\u7684\u7f13\u5b58\uff0c\u53c8\u6709\u81ea\u5df1\u7684\u5185\u5b58\uff0c\u6240\u4ee5\u8fd9\u65f6\u5019\u5c31\u6bd4\u8f83\u590d\u6742\u4e86\u3002\u4f8b\u5982 Host \u5728\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff08MemRd\uff0cSnpData/SnpInv/SnpCur\uff09\uff0c\u8fd8\u9700\u8981\u5bf9 Device Cache \u8fdb\u884c Snoop\uff08SnpData/SnpInv/SnpCur\uff09\uff0c\u4fdd\u8bc1\u7f13\u5b58\u7684\u4e00\u81f4\u6027\u3002Host \u60f3\u8981\u5199\u5165\u6570\u636e\u5230 Device Memory \u7684\u65f6\u5019\uff0c\u5982\u679c\u6b64\u65f6 Device Cache \u4e2d\u6709 Dirty \u6570\u636e\uff0c\u9700\u8981\u8fdb\u884c\u5199\u5408\u5e76\uff0c\u518d\u628a\u5408\u5e76\u540e\u7684\u6570\u636e\u5199\u5165\u5230 Device Memory\u3002\u5f53 Device \u60f3\u8981\u4ece\u81ea\u5df1\u7684\u7f13\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u53c8\u7f3a\u5931\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u5224\u65ad\u6570\u636e\u5728 Host \u7aef\u7684\u7f13\u5b58\u4e2d\uff0c\u8fd8\u662f\u5728 Device Memory \u4e2d\uff0c\u4e0d\u540c\u7684\u504f\u7f6e\uff08Bias\uff09\u6a21\u5f0f\u51b3\u5b9a\u4e86\u6570\u636e\u5e94\u8be5\u653e\u5728 Host \u8fd8\u662f Device \u7684\u7f13\u5b58\u4e0a\u3002Device \u8981\u5199\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u5982\u679c Host \u4e2d\u7f13\u5b58\u4e86\u8be5\u7f13\u5b58\u884c\uff0c\u5219\u9700\u8981 Back-Invalidation\u3002\u4e3a\u4e86\u652f\u6301\u8fd9\u4e9b\u573a\u666f\uff0cCXL.cache \u548c CXL.mem \u4f1a\u6bd4\u8f83\u590d\u6742\u3002</p>","tags":["cxl","bus","coherence","notes","learn"]},{"location":"hardware/2024/07/30/debian-linux-on-surface-laptop-7/","title":"\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux","text":"","tags":["surface","linux","qcom","qualcomm","xelite","aarch64","debian"]},{"location":"hardware/2024/07/30/debian-linux-on-surface-laptop-7/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u501f\u5230\u4e00\u53f0 Surface Laptop 7 \u53ef\u4ee5\u62ff\u6765\u6298\u817e\uff0c\u5b83\u7528\u7684\u662f\u9ad8\u901a Snapdragon X Elite \u5904\u7406\u5668\uff0c\u8dd1\u7684\u662f Windows on Arm \u7cfb\u7edf\u3002\u4f46\u4f5c\u4e3a Linux \u7528\u6237\uff0c\u80af\u5b9a\u4e0d\u6ee1\u8db3\u4e8e WSL\uff0c\u800c\u8981\u88f8\u673a\u4e0a\u5b89\u88c5 Linux\u3002\u7531\u4e8e\u8fd9\u4e2a\u673a\u5668\u592a\u65b0\uff0c\u6240\u4ee5\u5b89\u88c5\u7684\u8fc7\u7a0b\u9047\u5230\u4e86\u5f88\u591a\u574e\u5777\u3002</p>","tags":["surface","linux","qcom","qualcomm","xelite","aarch64","debian"]},{"location":"hardware/2024/07/30/debian-linux-on-surface-laptop-7/#\u4e0a\u6e38\u8fdb\u5c55","title":"\u4e0a\u6e38\u8fdb\u5c55","text":"<p>\u76ee\u524d X Elite \u5904\u7406\u5668\u7684\u4e0a\u6e38\u652f\u6301\u5df2\u7ecf\u9010\u6b65\u5b8c\u5584\uff0c\u4f46\u662f\u8fd8\u662f\u9700\u8981\u5f88\u65b0\u7684\u5185\u6838\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1\u624d\u5408\u5e76\u4e86 X Elite \u7684\u4e24\u4e2a\u7b14\u8bb0\u672c\u7684 device tree \u652f\u6301\u8fdb\u5185\u6838\u3002\u6211\u7528\u7684\u662f v6.11-rc1-43-g94ede2a3e913 \u7248\u672c\u7684\u5185\u6838\uff0c\u76ee\u524d\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\uff0cWi-Fi \u6b63\u5e38\uff0cUSB Type-C \u53e3\u6b63\u5e38\u5de5\u4f5c\uff08\u952e\u76d8\uff0c\u9f20\u6807\uff0c\u6709\u7ebf\u7f51\u90fd\u53ef\u4ee5\u901a\u8fc7 USB \u63a5\u5230\u7535\u8111\u4e0a\uff09\uff0c\u5185\u7f6e\u7684\u952e\u76d8\u3001\u89e6\u6478\u677f\u548c\u89e6\u6478\u5c4f\u4e0d\u5de5\u4f5c\u3002\u5e0c\u671b\u540e\u7eed\u53ef\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u786c\u4ef6\u652f\u6301\u3002</p>","tags":["surface","linux","qcom","qualcomm","xelite","aarch64","debian"]},{"location":"hardware/2024/07/30/debian-linux-on-surface-laptop-7/#\u6298\u817e\u8fc7\u7a0b","title":"\u6298\u817e\u8fc7\u7a0b","text":"<p>\u9ad8\u901a\u548c Linaro \u5728\u53bb\u5e74\u7684\u65f6\u5019\u63a8\u51fa\u4e86\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684 Debian Installer Image\uff1ahttps://git.codelinaro.org/linaro/qcomlt/demos/debian-12-installer-image\uff0c\u5b83\u9488\u5bf9\u7684\u8bbe\u5907\u662f\u9ad8\u901a\u81ea\u5df1\u7684 CRD \u8bbe\u5907\uff0c\u548c Surface Laptop 7 \u4e0d\u540c\u3002\u81ea\u7136\uff0c\u628a\u8fd9\u4e2a image \u5199\u5230 U \u76d8\u91cc\u5e76\u542f\u52a8\u662f\u4e0d\u884c\u7684\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSurface Laptop 7 \u9ed8\u8ba4\u5b89\u88c5\u4e86 Windows\uff0c\u5e76\u4e14\u5f00\u542f\u4e86\u5b89\u5168\u542f\u52a8\uff0c\u800c\u6211\u4eec\u81ea\u5df1\u7f16\u8bd1\u7684 Linux \u5185\u6838\u81ea\u7136\u662f\u8fc7\u4e0d\u4e86\u5b89\u5168\u542f\u52a8\u7684\uff0c\u6240\u4ee5\u8981\u53bb\u56fa\u4ef6\u5173\u95ed\u5b89\u5168\u542f\u52a8\u3002\u7531\u4e8e Windows \u7684 Bitlocker \u9ed8\u8ba4\u662f\u6253\u5f00\u7684\uff0c\u8bf7\u5148\u4fdd\u8bc1\u4f60\u53ef\u4ee5\u83b7\u53d6 Bitlocker recovery key\uff0c\u4e0d\u7136\u4e4b\u540e\u53ef\u80fd\u8fdb\u4e0d\u53bb Windows \u7cfb\u7edf\u4e86\u3002\u5b89\u88c5\u53cc\u7cfb\u7edf\u524d\uff0c\u8bb0\u5f97\u5728 Windows \u91cc\u51c6\u5907\u597d\u5206\u533a\u8868\uff0c\u7a7a\u95f4\u4e0d\u591f\u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u7ebf\u7f29\u5c0f NTFS\u3002</p> <p>\u8fdb\u5165\u56fa\u4ef6\u7684\u65b9\u6cd5\uff1a\u6309\u4f4f\u97f3\u91cf\u4e0a\u952e\u5f00\u673a\u3002\u5f00\u673a\u540e\uff0c\u53ef\u4ee5\u770b\u5230 Surface UEFI \u7684\u754c\u9762\uff0c\u53ef\u4ee5\u8c03\u542f\u52a8\u987a\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u5173\u95ed\u5b89\u5168\u542f\u52a8\u3002\u4e3a\u4e86\u5b89\u88c5\u65b9\u4fbf\uff0c\u5efa\u8bae\u628a USB Storage \u653e\u5230\u7b2c\u4e00\u4e2a\u3002</p> <p>\u63a5\u7740\u5c31\u5f00\u59cb\u542f\u52a8 U \u76d8\u91cc\u7684 Debian Installer Image \u4e86\u3002\u542f\u52a8\u4ee5\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fdb\u5165\u4e86 grub shell\uff0c\u76ee\u6d4b\u662f grub \u627e\u4e0d\u5230\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728 (hd1,msdos1)/boot/grub \u4e0b\u9762\u627e\u5230\u3002\u4f46\u662f\u8fd9\u4e2a image \u7684 device tree \u548c kernel \u90fd\u6bd4\u8f83\u8001\uff0c\u76f4\u63a5\u542f\u52a8\u4f1a\u53d1\u73b0\uff0cDebian Install \u8fdb\u53bb\u4e86\uff0c\u4f46\u662f\u5185\u7f6e\u952e\u76d8\u548c\u5916\u7f6e USB \u952e\u76d8\u90fd\u4e0d\u5de5\u4f5c\uff0c\u4e8e\u662f\u6ca1\u6cd5\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5b89\u88c5\u3002</p> <p>\u8fd9\u65f6\u5019\uff0c\u5728\u7f51\u4e0a\u641c\u7d22\u4e86\u4e00\u4e0b\u5df2\u6709\u7684\u5728 X Elite \u4e0a\u8fd0\u884c Linux \u7684\u5c1d\u8bd5\uff0c\u53d1\u73b0\u6709\u4eba\u5728 ASUS \u7684 X Elite \u7b14\u8bb0\u672c\u4e0a\u88c5\u597d\u4e86\uff08\u6765\u6e90\uff09\uff0c\u6211\u5c31\u8bd5\u7740\u7528 ASUS \u5bf9\u5e94\u578b\u53f7\u7b14\u8bb0\u672c\u7684 device tree \u53bb\u542f\u52a8\uff0c\u4f9d\u7136\u4e0d\u884c\uff0c\u7ecf\u8fc7\u4e86\u89e3\u540e\uff08\u611f\u8c22 @imbushuo\uff09\uff0c\u5f97\u77e5 Surface \u7684\u5185\u7f6e\u952e\u76d8\u7b49\u5916\u8bbe\u9700\u8981\u901a\u8fc7 SAM \u8bbf\u95ee\uff0c\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\uff0c\u76ee\u524d\u4e0d\u786e\u5b9a\u80fd\u5426\u901a\u8fc7 device tree \u542f\u7528\u3002</p> <p>\u4f46\u5f88\u5feb\u4e5f\u53d1\u73b0\u6709\u4eba\u5728 Surface Laptop 7 \u4e0a\u8dd1\u8d77\u6765\u4e86\uff08\u6765\u6e90\uff09\uff0c\u6211\u53d1\u90ae\u4ef6\u95ee\u4e86\u8fd9\u4e2a\u4f5c\u8005\uff0c\u4f5c\u8005\u8bf4\u4ed6\u7528\u7684\u662f\u5916\u7f6e\u7684\u952e\u76d8\uff0c\u5185\u7f6e\u7684\u952e\u76d8\u4e5f\u4e0d\u5de5\u4f5c\u3002\u653e\u5927\u89c2\u5bdf\u4f5c\u8005\u5f55\u7684\u89c6\u9891\uff0c\u53d1\u73b0\u7528\u7684\u662f\u6700\u65b0\u7684 master \u5206\u652f\u7684 Linux \u5185\u6838\uff0c\u5e76\u4e14\u7528\u7684\u5c31\u662f CRD \u7684 device tree\u3002\u5230\u8fd9\u91cc\u5c31\u6bd4\u8f83\u6709\u601d\u8def\u4e86\uff1a\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e2a\u5185\u6838\uff0c\u7136\u540e\u7528 x1e80100-crd.dtb \u4f5c\u4e3a device tree\u3002</p> <p>\u4e8e\u662f\u9b54\u6539\u4e86 Debian Installer Image\uff1a\u66ff\u6362\u6389 linux \u5185\u6838\uff0c\u6362\u6210\u81ea\u5df1\u7f16\u8bd1\u7684\u6700\u65b0\u7248\uff0c\u89e3\u5f00 initrd\uff0c\u628a\u91cc\u9762\u7684 kernel modules \u4e5f\u6362\u6210\u65b0\u5185\u6838\u7684\u7248\u672c\uff0c\u518d\u628a\u65b0\u7684 x1e80100-crd.dtb \u590d\u5236\u4e0a\u53bb\uff0c\u518d\u7528 grub \u542f\u52a8\u65b0\u5185\u6838 + \u65b0 initrd + \u65b0 Device Tree\uff0c\u53d1\u73b0 USB \u5916\u63a5\u952e\u76d8\u5de5\u4f5c\u4e86\uff01\u867d\u7136\u53ea\u6709 Type-C \u5de5\u4f5c\uff0c\u4f46\u662f\u4e5f\u8db3\u591f\u5b8c\u6210\u5269\u4e0b\u7684\u5de5\u4f5c\u4e86\u3002</p> <p>\u4e0d\u8fc7\u5728\u5b89\u88c5 Debian \u7684\u65f6\u5019\uff0c\u8fd8\u9047\u5230\u4e86\u5c0f\u63d2\u66f2\uff1aglibc \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u4f30\u8ba1\u662f Linaro \u7684 Image \u592a\u8001\u4e86\u3002\u4e8e\u662f\u6211\u4ece\u65b0\u7684 debian arm64 \u91cc\u590d\u5236\u4e86 libc.so.6 \u548c ld-linux-aarch64.so.1\uff0c\u8986\u76d6\u6389 initrd \u91cc\u7684\u65e7\u7248\u672c\uff0c\u8fd9\u6837\u5c31\u597d\u4e86\u3002</p> <p>\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u5b89\u88c5\u7684\u7cfb\u7edf\u91cc\u7684\u5185\u6838\u662f debian \u7684\u6700\u65b0\u5185\u6838\uff0c\u4f46\u662f\u4e0d\u591f\u65b0\uff0c\u4e8e\u662f\u53c8\u8001\u4f20\u7edf\uff1a\u624b\u52a8 arch-chroot \u8fdb\u65b0\u7684 sysroot\uff0c\u5b89\u88c5\u65b0\u7684\u5185\u6838\u3002\u4e5f\u53ef\u4ee5\u50cf Linaro \u4ed3\u5e93\u91cc\u6307\u51fa\u7684\u90a3\u6837\uff0c\u76f4\u63a5\u66ff\u6362 Debian Installer Image \u91cc\u7684 deb\uff0c\u4f46\u662f\u6211\u53d1\u73b0\u6211\u6253\u7684 deb \u592a\u5927\u4e86\uff08\u6bd5\u7adf defconfig\uff09\uff0c\u653e\u4e0d\u8fdb\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ea\u597d\u6700\u540e\u81ea\u5df1\u624b\u52a8\u88c5\u3002</p> <p>\u6700\u540e\u5728 grub \u914d\u7f6e\u91cc\u6dfb\u52a0 devicetree \u52a0\u8f7d\u547d\u4ee4\uff0c\u518d\u4ece Debian Installer Image \u7684 grub \u914d\u7f6e\u5077 linux cmdline\uff0c\u6700\u7ec8\u662f grub \u914d\u7f6e\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a</p> <pre><code>devicetree /boot/x1e80100-crd.dtb\necho    'Loading Linux 6.11.0-rc1-00043-g94ede2a3e913 ...'\nlinux   /boot/vmlinuz-6.11.0-rc1-00043-g94ede2a3e913 root=UUID=aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee ro efi=novamap pd_ignore_unused clk_ignore_unused fw_devlink=off cma=128M quiet\necho    'Loading initial ramdisk ...'\ninitrd  /boot/initrd.img-6.11.0-rc1-00043-g94ede2a3e913\n</code></pre> <p>\u8fd9\u6837\u641e\u5b8c\uff0cDebian \u7cfb\u7edf\u5c31\u6b63\u5e38\u8d77\u6765\u4e86\uff01</p> <p>\u672c\u6587\u4e5f\u53d1\u5230\u4e86 Reddit \u4e0a\uff1ahttps://www.reddit.com/r/SurfaceLinux/comments/1efmyb3/managed_to_install_baremetal_linux_on_snapdragon/</p> <p>UPDATE:</p> <ol> <li>(2024-07-31 \u66f4\u65b0) \u4e0d\u77e5\u9053\u4e3a\u5565\uff0c\u65e0\u7ebf\u7f51\u5361\u5ffd\u7136\u88ab rfkill \u4e86\uff0c\u6ca1\u6709\u627e\u5230\u539f\u56e0\uff0cWindows \u91cc\u53ef\u4ee5\u7ee7\u7eed\u6b63\u5e38\u4f7f\u7528</li> <li>(2024-07-31 \u66f4\u65b0) CPUFreq \u9a71\u52a8\u5df2\u7ecf\u6709 patch\uff1a[PATCH V6 0/5] qcom: x1e80100: Enable CPUFreq\uff0c\u6253\u4e0a\u5373\u53ef\u81ea\u52a8\u8c03\u9891</li> <li>(2024-07-31 \u66f4\u65b0) \u5185\u7f6e\u7684\u952e\u76d8\u7684\u95ee\u9898\u4fee\u597d\u4e86\uff0c\u9700\u8981\u989d\u5916\u7684\u8865\u4e01\uff0c\u89c1 https://github.com/jiegec/linux/tree/surface-laptop-7\u3002</li> <li>(2024-09-05 \u66f4\u65b0) \u4e0a\u6e38\u5408\u5e76\u4e86 Surface Laptop 7 (Romulus 13/15) \u7684 Device Tree (<code>arch/arm64/boot/dts/qcom/x1e80100-microsoft-romulus13.dts</code>)\uff0c\u5185\u7f6e\u7684\u952e\u76d8\u4e5f\u76f4\u63a5\u652f\u6301\u4e86\uff0c\u76f4\u63a5\u7528\u4e0a\u6e38\u7684 Device Tree \u5373\u53ef\u542f\u52a8\uff0c\u89c1 https://github.com/jiegec/linux/tree/surface-laptop-7-next\uff0c\u4f30\u8ba1 6.12 \u5c31\u6709\u6b63\u5f0f\u652f\u6301\u4e86</li> <li>(2024-09-05 \u66f4\u65b0) \u66f4\u65b0 Mesa \u5230 24.2.1\uff0c\u663e\u5361\u52a0\u901f\u4e5f\u5de5\u4f5c\u4e86</li> </ol>","tags":["surface","linux","qcom","qualcomm","xelite","aarch64","debian"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/","title":"Synopsys Design Compiler \u7efc\u5408\u5b9e\u8df5","text":"","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/#\u5de5\u827a\u5e93","title":"\u5de5\u827a\u5e93","text":"<p>\u7efc\u5408\u5f88\u91cd\u8981\u7684\u4e00\u6b65\u662f\u628a HDL \u7684\u903b\u8f91\u53d8\u6210\u4e00\u4e2a\u4e2a\u5355\u5143\uff0c\u8fd9\u4e9b\u5355\u5143\u52a0\u4e0a\u8fde\u63a5\u65b9\u5f0f\u5c31\u6210\u4e3a\u4e86\u7f51\u8868\u3002\u90a3\u4e48\uff0c\u57fa\u672c\u5355\u5143\u6709\u54ea\u4e9b\uff0c\u600e\u4e48\u51b3\u5b9a\u7528\u54ea\u4e9b\u57fa\u672c\u5355\u5143\uff1f</p> <p>\u8fd9\u4e2a\u5c31\u9700\u8981\u5de5\u827a\u5e93\u4e86\uff0c\u5de5\u827a\u5e93\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e2a\u5355\u5143\uff0c\u5355\u5143\u7684\u5f15\u811a\u3001\u529f\u80fd\uff0c\u8fd8\u6709\u5404\u79cd\u53c2\u6570\uff0c\u8fd9\u6837 Design Compiler \u5c31\u53ef\u4ee5\u6309\u7167\u8fd9\u4e9b\u4fe1\u606f\u53bb\u627e\u5230\u4e00\u4e2a\u4f18\u5316\u7684\u7f51\u8868\u3002</p>","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/#liberty-\u683c\u5f0f","title":"Liberty \u683c\u5f0f","text":"<p>\u7f51\u4e0a\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b Liberty \u683c\u5f0f\u7684\u5de5\u827a\u5e93\uff0c\u6bd4\u5982 Nangate45\uff0c\u5b83\u7684\u8bbe\u5b9a\u662f 25 \u6444\u6c0f\u5ea6\uff0c1.10 \u4f0f\uff0c\u5c5e\u4e8e TT\uff08Typical/Typical\uff09\u7684 Process Corner\u3002</p> <p>\u5728\u91cc\u9762\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u57fa\u672c\u5355\u5143\u7684\u5b9a\u7406\uff0c\u6bd4\u5982 <code>AND2_X1</code>\uff0c\u5c31\u662f\u4e00\u4e2a drive strength \u662f 1 \u7684\u4e8c\u8f93\u5165\u4e0e\u95e8\uff1a</p> <pre><code>cell (AND2_X1) {\n    drive_strength : 1;\n    pin (A1) {\n        direction : input;\n    }\n    pin (A2) {\n        direction : input;\n    }\n    pin (ZN) {\n        direction : output;\n        function : \"(A1 &amp; A2)\";\n    }\n    /* ... */\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b9a\u4e49\u4e86\u4e24\u4e2a\u8f93\u5165 pin\uff0c\u4e00\u4e2a\u8f93\u51fa pin\uff0c\u8fd8\u6709\u5b83\u5b9e\u73b0\u7684\u529f\u80fd\u3002\u8fd8\u6709\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u662f\u4fdd\u5b58\u4e86\u65f6\u5e8f\u4fe1\u606f\uff0c\u6bd4\u5982\uff1a</p> <pre><code>lu_table_template (Timing_7_7) {\n    variable_1 : input_net_transition;\n    variable_2 : total_output_net_capacitance;\n    index_1 (\"0.0010,0.0020,0.0030,0.0040,0.0050,0.0060,0.0070\");\n    index_2 (\"0.0010,0.0020,0.0030,0.0040,0.0050,0.0060,0.0070\");\n}\ncell (AND2_X1) {\n    pin (ZN) {\n        timing () {\n            related_pin : \"A1\";\n            timing_sense : positive_unate;\n            cell_fall(Timing_7_7) {\n                index_1 (\"0.00117378,0.00472397,0.0171859,0.0409838,0.0780596,0.130081,0.198535\");\n                index_2 (\"0.365616,1.893040,3.786090,7.572170,15.144300,30.288700,60.577400\");\n                values (\"0.0217822,0.0253224,0.0288237,0.0346827,0.0448323,0.0636086,0.100366\", \\\n                        \"0.0233179,0.0268545,0.0303556,0.0362159,0.0463659,0.0651426,0.101902\", \\\n                        \"0.0296429,0.0331470,0.0366371,0.0425000,0.0526603,0.0714467,0.108208\", \\\n                        \"0.0402311,0.0440292,0.0477457,0.0538394,0.0641187,0.0829203,0.119654\", \\\n                        \"0.0511250,0.0554077,0.0595859,0.0662932,0.0771901,0.0963434,0.133061\", \\\n                        \"0.0625876,0.0673198,0.0719785,0.0794046,0.0910973,0.110757,0.147656\", \\\n                        \"0.0748282,0.0800098,0.0851434,0.0933663,0.106111,0.126669,0.163872\");\n            }\n    }\n}\n</code></pre> <p>\u9996\u5148\u8981\u770b cell_fall \u540e\u9762\u7684 template \u662f Timing_7_7\uff0c\u53ef\u4ee5\u770b\u5230 variable_1 \u548c variable_2 \u5bf9\u5e94\u7684\u662f input_net_transition \u548c total_output_net_capacitance\u3002\u8fd9\u91cc cell_fall \u6307\u7684\u662f\u8f93\u51fa pin ZN \u4ece 1 \u53d8\u6210 0 \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u53d8\u5316\u4ece A1 \u7684\u53d8\u5316\u4f20\u64ad\u5230 ZN \u7684\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u548c\u8f93\u5165\u7684 transition \u65f6\u95f4\uff08\u5927\u6982\u662f\u4ece 0 \u5230 1\u3001\u4ece 1 \u5230 0 \u7684\u65f6\u95f4\uff0c\u5177\u4f53\u4ece\u591a\u5c11\u767e\u5206\u6bd4\u5230\u591a\u5c11\u767e\u5206\u6bd4\u89c1\u8bbe\u7f6e\uff09\u548c\u8f93\u51fa\u7684 capacitance \u6709\u5173\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u67e5\u627e\u8868\uff0c\u67e5\u627e\u7684\u65f6\u5019\u627e\u6700\u8fd1\u7684\u70b9\u8fdb\u884c\u63d2\u503c\u3002\u8f93\u51fa\u7684 capacitance \u53d6\u51b3\u4e8e wire load \u548c\u8fde\u63a5\u4e86\u8fd9\u4e2a\u8f93\u51fa\u7684\u5176\u4ed6\u5355\u5143\u7684\u8f93\u5165\u3002</p> <p>\u9664\u4e86 cell_fall/cell_rise \u4e24\u79cd\u7c7b\u578b\uff0c\u8fd8\u6709 fall_transition \u548c rise_transition\uff0c\u8fd9\u5c31\u662f\u8f93\u51fa\u5f15\u811a\u7684\u53d8\u5316\u65f6\u95f4\uff0c\u53c8\u4f5c\u4e3a\u540e\u7ee7\u5355\u5143\u7684\u8f93\u5165 transition \u65f6\u95f4\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8fd8\u80fd\u770b\u5230\u529f\u8017\u7684\u6570\u636e\uff1a</p> <pre><code>power_lut_template (Power_7_7) {\n    variable_1 : input_transition_time;\n    variable_2 : total_output_net_capacitance;\n    index_1 (\"0.0010,0.0020,0.0030,0.0040,0.0050,0.0060,0.0070\");\n    index_2 (\"0.0010,0.0020,0.0030,0.0040,0.0050,0.0060,0.0070\");\n}\ninternal_power () {\n    related_pin          : \"A1\";\n    fall_power(Power_7_7) {\n        index_1 (\"0.00117378,0.00472397,0.0171859,0.0409838,0.0780596,0.130081,0.198535\");\n        index_2 (\"0.365616,1.893040,3.786090,7.572170,15.144300,30.288700,60.577400\");\n        values (\"2.707163,2.939134,3.111270,3.271119,3.366153,3.407657,3.420511\", \\\n                \"2.676697,2.905713,3.073189,3.236823,3.334156,3.373344,3.387400\", \\\n                \"2.680855,2.891263,3.047784,3.212948,3.315296,3.360694,3.377614\", \\\n                \"2.821141,3.032707,3.182020,3.338567,3.444608,3.488752,3.508229\", \\\n                \"3.129641,3.235525,3.357993,3.567372,3.743682,3.792092,3.808289\", \\\n                \"3.724304,3.738737,3.808381,3.980825,4.147999,4.278043,4.311323\", \\\n                \"4.526175,4.492292,4.510220,4.634217,4.814899,4.934862,5.047389\");\n    }\n    rise_power(Power_7_7) {\n        index_1 (\"0.00117378,0.00472397,0.0171859,0.0409838,0.0780596,0.130081,0.198535\");\n        index_2 (\"0.365616,1.893040,3.786090,7.572170,15.144300,30.288700,60.577400\");\n        values (\"1.823439,1.926997,1.963153,2.028865,1.957837,2.123314,2.075262\", \\\n                \"1.796317,1.896145,1.960625,2.014112,2.050786,2.046472,1.972327\", \\\n                \"1.811604,1.886741,1.955658,1.978263,1.965671,1.963736,2.071227\", \\\n                \"1.997387,2.045930,2.092357,2.063643,2.099127,1.932089,2.131341\", \\\n                \"2.367285,2.439718,2.440043,2.403446,2.305848,2.351146,2.195145\", \\\n                \"2.916140,2.994325,3.044451,2.962881,2.836259,2.781564,2.633645\", \\\n                \"3.687718,3.756085,3.789394,3.792984,3.773583,3.593022,3.405552\");\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e5f\u662f\u4e00\u4e2a\u67e5\u627e\u8868\uff0c\u4e5f\u662f\u6309\u7167\u8f93\u51fa\u7684 rise/fall \u6709\u4e0d\u540c\u7684\u529f\u8017\u3002\u5de7\u5408\u7684\u662f\uff0c\u529f\u8017\u7684\u67e5\u627e\u8868\u7684 index_1/index_2 \u548c\u4e0a\u9762\u7684\u65f6\u5e8f\u67e5\u627e\u8868\u662f\u4e00\u6837\u7684\u3002\u9664\u4e86 internal power\uff0c\u8fd8\u6709 leakage power\uff0c\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>leakage_power_unit : \"1nW\";\n/* ... */\ncell_leakage_power  : 50.353160;\n\nleakage_power () {\n    when           : \"!A1 &amp; !A2\";\n    value          : 40.690980;\n}\nleakage_power () {\n    when           : \"!A1 &amp; A2\";\n    value          : 62.007550;\n}\nleakage_power () {\n    when           : \"A1 &amp; !A2\";\n    value          : 41.294331;\n}\nleakage_power () {\n    when           : \"A1 &amp; A2\";\n    value          : 57.419780;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684 leakage power \u53d6\u51b3\u4e8e\u8f93\u5165\u7684\u72b6\u6001\uff0c\u5355\u4f4d\u662f 1nW\u3002</p> <p>\u518d\u6765\u770b Flip Flop \u7684\u5b9a\u4e49\uff1a</p> <pre><code>cell (DFFRS_X1) {\n    ff (\"IQ\" , \"IQN\") {\n        next_state          : \"D\";\n        clocked_on          : \"CK\";\n        preset              : \"!SN\";\n        clear               : \"!RN\";\n        clear_preset_var1   : L;\n        clear_preset_var2   : L;\n    }\n    pin (D) {\n        direction       : input;\n        capacitance     : 1.148034;\n        fall_capacitance    : 1.081549;\n        rise_capacitance    : 1.148034;\n\n        timing () {\n\n            related_pin    : \"CK\";\n            timing_type    : hold_rising;\n            when               : \"RN &amp; SN\";\n            sdf_cond       : \"RN_AND_SN === 1'b1\";\n            fall_constraint(Hold_3_3) {\n                index_1 (\"0.00117378,0.0449324,0.198535\");\n                index_2 (\"0.00117378,0.0449324,0.198535\");\n                values (\"0.002921,0.012421,0.011913\", \\\n                        \"0.002707,0.008886,0.005388\", \\\n                        \"0.139993,0.148595,0.137370\");\n            }\n            rise_constraint(Hold_3_3) {\n                index_1 (\"0.00117378,0.0449324,0.198535\");\n                index_2 (\"0.00117378,0.0449324,0.198535\");\n                values (\"0.004193,0.015978,0.019836\", \\\n                        \"0.020266,0.031864,0.035343\", \\\n                        \"0.099118,0.113075,0.120979\");\n            }\n        }\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u5c5e\u6027\u53d8\u6210\u4e86 setup/hold \u65f6\u95f4\u3002</p> <p>SRAM \u4e5f\u6709\u7c7b\u4f3c\u7684\u5b9a\u4e49\uff0c\u901a\u5e38\u662f\u5199\u5728\u5355\u72ec\u7684 lib \u6587\u4ef6\u4e2d\uff0c\u6839\u636e width \u548c depth \u751f\u6210\uff0c\u6bd4\u5982 fakeram45_32x64.lib\uff1a</p> <pre><code>cell(fakeram45_32x64) {\n    area : 1754.536;\n    interface_timing : true;\n    memory() {\n        type : ram;\n        address_width : 5;\n        word_width : 64;\n    }\n    pin(clk)   {\n        direction : input;\n        min_period : 0.174 ;\n        internal_power(){\n            rise_power(scalar) {\n                values (\"1498.650\")\n            }\n            fall_power(scalar) {\n                values (\"1498.650\")\n            }\n        }\n    }\n    bus(wd_in)   {\n        bus_type : fakeram45_32x64_DATA;\n        direction : input;\n        timing() {\n            related_pin     : clk;\n            timing_type     : setup_rising ;\n            rise_constraint(scalar) {\n                values (\"0.050\");\n            }\n            fall_constraint(scalar) {\n                values (\"0.050\");\n            }\n        } \n        internal_power(){\n            when : \"(we_in)\";\n            rise_power(scalar) {\n                values (\"14.987\");\n            }\n            fall_power(scalar) {\n                values (\"14.987\");\n            }\n        }\n    }\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u770b\u5230\uff0c\u5b83\u7684\u8f93\u5165 setup/hold\uff0c\u529f\u8017\uff0c\u9762\u79ef\u7b49\u7b49\u4fe1\u606f\u3002</p>","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/#db-\u683c\u5f0f","title":"DB \u683c\u5f0f","text":"<p>\u5728\u7ed9 Design Compiler \u914d\u7f6e\u5de5\u827a\u5e93\u524d\uff0c\u9700\u8981\u7528 Library Compiler \u5148\u628a lib \u683c\u5f0f\u8f6c\u6362\u4e3a\u66f4\u7d27\u51d1\u7684\u4e8c\u8fdb\u5236 db \u683c\u5f0f\uff1a</p> <pre><code>read_lib xxx.lib\nwrite_lib -format db xxx\n</code></pre> <p>\u5b9e\u6d4b\u90e8\u5206 Liberty \u6587\u4ef6\u4f1a\u62a5\u9519\uff0c\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u4fee\u590d\u7684\u529e\u6cd5\u3002\u53e6\u5916\uff0c\u4e0d\u540c\u7248\u672c\u7684 Library Compiler \u751f\u6210\u7684\u683c\u5f0f\u4e5f\u4e0d\u5927\u4e00\u6837\uff0c\u4f46\u90fd\u662f\u517c\u5bb9\u7684\u3002</p> <p>\u5728 Design Compiler \u4e2d\uff0c\u8bbe\u7f6e\u5f53\u524d\u5de5\u827a\u5e93\u547d\u4ee4\uff1a</p> <pre><code>set_app_var target_library xxx.db\nset_link_var target_library xxx.db\n# or\nset_app_var target_library {xxx.db yyy.db}\nset_link_var target_library {xxx.db yyy.db}\n</code></pre>","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/#\u7efc\u5408\u811a\u672c","title":"\u7efc\u5408\u811a\u672c","text":"<p>\u51c6\u5907\u597d\u5de5\u827a\u5e93\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u7efc\u5408\u811a\u672c\u4e86\uff0c\u901a\u5e38\u6709\u8fd9\u4e48\u4e9b\u6b65\u9aa4\uff1a</p> <pre><code># step 1: read source code &amp; set top level module name\nread_file -format verilog xxx.v\nread_file -format vhdl yyy.vhdl\ncurrent_design xxx\n\n# step 2: setup timing constraints\ncreate_clock clock -period 1.0000 # 1GHz for example\n# other timing constraints:\n# e.g. set_input_delay/set_output_delay\n\n# step 3: synthesis\nlink\nuniquify\n# use this if you want to ungroup all hierarchy\n# ungroup -flatten -all\n# use this to retime design\n# set_optimize_registers\ncompile_ultra\n\n# step 4: check &amp; report\ncheck_timing\ncheck_design\nreport_design\nreport_area -hierarchy\nreport_power -hierarchy\nreport_cell\nreport_timing -delay_type max\nreport_timing -delay_type min\nreport_constraint -all_violators\nreport_qor\n\n# step 5: export\nwrite -format ddc -hierarchy -output xxx.ddc\nwrite_sdc -version 1.0 xxx.sdf\nwrite -format verilog -hierarchy -output xxx.syn.v\nwrite_sdc xxx.sdc\n</code></pre> <p>\u6839\u636e\u9700\u6c42\uff0c\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u4fee\u6539\u3002\u7efc\u5408\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u751f\u6210\u7684 <code>xxx.syn.v</code> \u6587\u4ef6\u91cc\u90fd\u662f\u4e00\u4e2a\u4e2a\u7684 cell\uff0c\u6bd4\u5982\uff1a</p> <pre><code>AND2X2 U3912 ( .A(n4416), .B(n2168), .Y(n3469) );\nOAI21X1 U3913 ( .A(n2872), .B(n4589), .C(n2461), .Y(n3471) );\nDFFPOSX1 clock_r_REG147_S1 ( .D(n7634), .CLK(clock), .Q(n7773) );\n</code></pre> <p>\u8fd8\u6709\u4e00\u4e9b\u6bd4\u8f83\u7279\u6b8a\u7684 cell\uff0c\u6bd4\u5982 TIEHI/TIELO \u5c31\u662f\u6052\u5b9a\u8f93\u51fa 1/0\uff0c\u7528\u4e8e\u95e8\u63a7\u65f6\u949f\u7684 CLKGATE/ICG \u7b49\uff0c\u8fd8\u6709\u4e00\u4e9b\u7efc\u5408\u9636\u6bb5\u4e0d\u4f1a\u51fa\u73b0\u7684 cell\uff0c\u5728\u540e\u7eed\u9636\u6bb5\u4f1a\u4f7f\u7528\u3002</p>","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2022/03/14/design-compiler-synthesis/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Liberty format: an introduction</li> <li>Digital VLSI Design Lecture 4: Standard Cell Libraries</li> </ul>","tags":["synthesis","synopsys","dc","designcompiler"]},{"location":"hardware/2023/03/19/digital-modulation/","title":"\u6570\u5b57\u8c03\u5236","text":"","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5b66\u4e60 802.11\uff0c\u9700\u8981\u5b66\u4e60\u5f88\u591a\u6570\u5b57\u8c03\u5236\u76f8\u5173\u7684\u77e5\u8bc6\uff0c\u56e0\u6b64\u81ea\u5b66\u4e86\u4e00\u4e0b\u901a\u4fe1\u539f\u7406\u3002</p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#ask","title":"ASK","text":"<p>Amplitude-Shift Keying \u8c03\u6574\u8f7d\u6ce2\u4fe1\u53f7\u7684\u5e45\u5ea6</p> <p></p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#fsk","title":"FSK","text":"<p>Frequency-Shift Keying \u8c03\u6574\u8f7d\u6ce2\u4fe1\u53f7\u7684\u9891\u7387</p> <p></p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#psk","title":"PSK","text":"<p>Phase-Shift Keying \u8c03\u6574\u8f7d\u6ce2\u4fe1\u53f7\u7684\u76f8\u4f4d</p> <p></p> <p>DPSK(Differential Phase-Shift Keying) \u662f\u5728 PSK \u7684\u57fa\u7840\u4e0a\uff0c\u628a\u76f8\u4f4d\u7684\u7edd\u5bf9\u503c\u53d8\u6210\u76f8\u4f4d\u7684\u5dee\u3002\u4f8b\u5982 BPSK \u4f20\u8f93 0 \u5bf9\u5e94 0 \u5ea6\u76f8\u4f4d\uff0c\u4f20\u8f93 1 \u5bf9\u5e94 180 \u5ea6\u76f8\u4f4d\uff0c\u90a3\u4e48 DBPSK \u4f20\u8f93 0 \u65f6\u4fdd\u6301\u76f8\u4f4d\u548c\u4e0a\u4e00\u4e2a symbol \u4e00\u6837\uff0c\u4f20\u8f93 1 \u65f6\u76f8\u4f4d\u76f8\u5bf9\u4e0a\u4e00\u4e2a symbol \u589e\u52a0 180 \u5ea6\u3002</p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#qam","title":"QAM","text":"<p>Quadrature Amplitude Modulation \u4e24\u4e2a\u6b63\u4ea4\u8f7d\u6ce2\u4fe1\u53f7\u4e4b\u548c\uff0c\u8c03\u6574\u4e24\u4e2a\u4fe1\u53f7\u7684\u76f8\u4f4d\u548c\u5e45\u5ea6</p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#4-qam","title":"4-QAM","text":"<p>4-QAM \u4e5f\u7b49\u4ef7\u4e8e 4-PSK\uff08Phase-Shift Keying\uff09\uff0c\u76f8\u5f53\u4e8e\u8c03\u6574\u4e00\u4e2a\u8f7d\u6ce2\u4fe1\u53f7\u7684\u76f8\u4f4d\u3002</p> <p></p>","tags":["modulation","digital"]},{"location":"hardware/2023/03/19/digital-modulation/#16-qam","title":"16-QAM","text":"","tags":["modulation","digital"]},{"location":"hardware/2022/01/05/diplomacy/","title":"\u5206\u6790 Rocket Chip \u4e2d Diplomacy \u7cfb\u7edf","text":"","tags":["chisel","rocketchip","diplomacy"]},{"location":"hardware/2022/01/05/diplomacy/#\u6982\u5ff5","title":"\u6982\u5ff5","text":"<p>Diplomacy \u4e3b\u8981\u5b9e\u73b0\u4e86\u4e24\u4e2a\u529f\u80fd\uff1a</p> <ol> <li>\u628a\u6574\u4e2a\u603b\u7ebf\u7ed3\u6784\u5728\u4ee3\u7801\u4e2d\u8868\u73b0\u51fa\u6765</li> <li>\u81ea\u52a8\u914d\u7f6e\u603b\u7ebf\u4e2d\u5404\u4e2a\u7aef\u53e3\u7684\u53c2\u6570</li> </ol> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u7b2c\u4e00\u70b9\u5b9e\u73b0\u4e86\u7c7b\u4f3c Vivado Board Design \u4e2d\u8fde\u7ebf\u7684\u529f\u80fd\uff0c\u7b2c\u4e8c\u70b9\u5219\u662f\u4fdd\u8bc1\u603b\u7ebf\u4e24\u7aef\u7684\u53c2\u6570\u4e00\u81f4\uff0c\u53ef\u4ee5\u8fde\u63a5\u8d77\u6765\u3002</p> <p>Diplomacy \u4e3a\u4e86\u8868\u793a\u603b\u7ebf\u7684\u7ed3\u6784\uff0c\u6bcf\u4e2a\u6a21\u5757\u53ef\u4ee5\u5bf9\u5e94\u4e00\u4e2a Node\uff0cNode \u548c Node \u4e4b\u95f4\u8fde\u63a5\u5f62\u6210\u4e00\u4e2a\u56fe\u3002Node \u7684\u7c7b\u578b\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a</p> <ol> <li>Client\uff1a\u5bf9\u5e94 AXI \u91cc\u9762\u7684 Master\uff0c\u53d1\u8d77\u8bf7\u6c42</li> <li>Manager\uff1a\u5bf9\u5e94 AXI \u91cc\u9762\u7684 Slave\uff0c\u5904\u7406\u8bf7\u6c42</li> <li>Adapter\uff1a\u5bf9\u5e94 AXI Width Converter/Clock Converter/AXI4 to AXI3/AXI4 to AHB bridge \u7b49\uff0c\u4f1a\u4fee\u6539 AXI \u7684\u53c2\u6570\uff0c\u7136\u540e\u6bcf\u4e2a\u8f93\u5165\u5bf9\u5e94\u4e00\u4e2a\u8f93\u51fa</li> <li>Nexus\uff1a\u5bf9\u5e94 AXI Crossbar\uff0c\u591a\u4e2a\u8f93\u5165\u548c\u591a\u4e2a\u8f93\u51fa</li> </ol> <p>\u6bcf\u4e2a Node \u53ef\u80fd\u4f5c\u4e3a Manager \u8fde\u63a5\u4e0a\u6e38\u7684 Client\uff0c\u8fd9\u4e2a\u53eb\u505a\u5165\u8fb9\uff08Inward Edge\uff09\uff1b\u540c\u6837\u5730\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a Client \u8fde\u63a5\u4e0b\u6e38\u7684 Manager\uff0c\u8fd9\u4e2a\u662f\u51fa\u8fb9\uff08Outward Edge\uff09\u3002\u60f3\u8c61\u6210\u4e00\u4e2a DAG\uff0c\u4ece\u82e5\u5e72\u4e2a Client \u6d41\u5411 Manager\u3002</p> <p>\u8fde\u63a5\u65b9\u5f0f\u91c7\u7528\u7684\u662f <code>:=</code> <code>:=*</code> <code>:*=</code> <code>:*=*</code> \u64cd\u4f5c\u7b26\uff0c\u5de6\u4fa7\u662f Client\uff0c\u53f3\u4fa7\u662f Manager\u3002</p>","tags":["chisel","rocketchip","diplomacy"]},{"location":"hardware/2022/01/05/diplomacy/#rocket-chip-\u603b\u7ebf\u7ed3\u6784","title":"Rocket Chip \u603b\u7ebf\u7ed3\u6784","text":"<p>Rocket Chip \u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u603b\u7ebf\uff1a</p> <ol> <li>sbus: System Bus</li> <li>mbus: Memory Bus</li> <li>cbus: Control Bus</li> <li>pbus: Periphery Bus</li> <li>fbus: Frontend Bus</li> </ol> <p>\u56fe\u793a\u53ef\u4ee5\u89c1\u53c2\u8003\u6587\u6863\u4e2d\u7684\u94fe\u63a5\uff0c\u4e0d\u8fc7\u94fe\u63a5\u4e2d\u7684\u7ed3\u6784\u548c\u5b9e\u9645\u7684\u6709\u4e00\u4e9b\u533a\u522b\u3002\u76ee\u524d\u7684 Rocket Chip \u5185\u5b58\u7ed3\u6784\u5927\u81f4\u662f\u8fd9\u6837\uff1a</p> <pre><code>fbus -&gt; sbus -&gt; mbus\ntile --/    \\-&gt; cbus -&gt; pbus\n</code></pre> <p>\u4e3b\u8981\u662f pbus \u7684\u4f4d\u7f6e\u4ece\u8fde\u63a5 sbus \u79fb\u52a8\u5230\u4e86\u8fde\u63a5 cbus\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\uff1a</p> <pre><code>/** Parameterization of a topology containing three additional, optional buses for attaching MMIO devices. */\ncase class HierarchicalBusTopologyParams(\n  pbus: PeripheryBusParams,\n  fbus: FrontBusParams,\n  cbus: PeripheryBusParams,\n  xTypes: SubsystemCrossingParams,\n  driveClocksFromSBus: Boolean = true\n) extends TLBusWrapperTopology(\n  instantiations = List(\n    (PBUS, pbus),\n    (FBUS, fbus),\n    (CBUS, cbus)),\n  connections = List(\n    (SBUS, CBUS, TLBusWrapperConnection  .crossTo(xTypes.sbusToCbusXType, if (driveClocksFromSBus) Some(true) else None)),\n    (CBUS, PBUS, TLBusWrapperConnection  .crossTo(xTypes.cbusToPbusXType, if (driveClocksFromSBus) Some(true) else None)),\n    (FBUS, SBUS, TLBusWrapperConnection.crossFrom(xTypes.fbusToSbusXType, if (driveClocksFromSBus) Some(false) else None)))\n)\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c\u4e5f\u6709\u7b80\u5316\u7248\u7684 JustOneBusTopology\uff0c\u90a3\u5c31\u53ea\u6709 SystemBus \u4e86\u3002\u5982\u679c\u518d\u914d\u7f6e\u4e86 CoherentBusTopology\uff0c\u90a3\u4e48 SBUS \u548c MBUS \u4e4b\u95f4\u8fd8\u6709\u4e00\u5c42 L2:</p> <pre><code>/** Parameterization of a topology containing a banked coherence manager and a bus for attaching memory devices. */\ncase class CoherentBusTopologyParams(\n  sbus: SystemBusParams, // TODO remove this after better width propagation\n  mbus: MemoryBusParams,\n  l2: BankedL2Params,\n  sbusToMbusXType: ClockCrossingType = NoCrossing,\n  driveMBusClockFromSBus: Boolean = true\n) extends TLBusWrapperTopology(\n  instantiations = (if (l2.nBanks == 0) Nil else List(\n    (MBUS, mbus),\n    (L2, CoherenceManagerWrapperParams(mbus.blockBytes, mbus.beatBytes, l2.nBanks, L2.name, sbus.dtsFrequency)(l2.coherenceManager)))),\n  connections = if (l2.nBanks == 0) Nil else List(\n    (SBUS, L2,   TLBusWrapperConnection(driveClockFromMaster = Some(true), nodeBinding = BIND_STAR)()),\n    (L2,  MBUS,  TLBusWrapperConnection.crossTo(\n      xType = sbusToMbusXType,\n      driveClockFromMaster = if (driveMBusClockFromSBus) Some(true) else None,\n      nodeBinding = BIND_QUERY))\n  )\n)\n</code></pre>","tags":["chisel","rocketchip","diplomacy"]},{"location":"hardware/2022/01/05/diplomacy/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>TileLink and Diplomacy Reference</li> <li>Rocket Chip - Memory System</li> </ul>","tags":["chisel","rocketchip","diplomacy"]},{"location":"hardware/2021/05/06/disk/","title":"\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5","text":"","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#ata","title":"ATA","text":"<p>ATA \u5b9a\u4e49\u4e86\u53d1\u9001\u7ed9\u786c\u76d8\u7684\u547d\u4ee4\uff0c\u6807\u51c6\u5b9a\u4e49\u4e86\u547d\u4ee4\uff1a</p> <ul> <li>ech IDENTIFY DEVICE: \u83b7\u53d6\u8bbe\u5907\u4fe1\u606f</li> <li>25h READ DMA EXT: \u8bfb\u53d6\u6247\u533a</li> <li>35h WRITE DMA EXT: \u5199\u5165\u6247\u533a</li> </ul> <p>ATA \u540c\u65f6\u4e5f\u662f\u63a5\u53e3\uff0c\u56fe\u7247\u5982\u4e0b\u3002ATA \u524d\u8eab\u662f IDE\uff0c\u73b0\u5728 ATA \u53eb\u505a PATA\u3002</p> <p></p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#ahci","title":"AHCI","text":"<p>AHCI \u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a PCIe &lt;-&gt; SATA \u7684\u8f6c\u6362\u5668\u3002AHCI \u66b4\u9732\u4e3a\u4e00\u4e2a PCIe \u8bbe\u5907\uff1a</p> <pre><code>$ lspci -vv\n00:1f.2 SATA controller: Intel Corporation C600/X79 series chipset 6-Port SATA AHCI Controller (rev 05)\n        Kernel modules: ahci\n</code></pre> <p>\u5904\u7406\u5668\u901a\u8fc7 IO port/MMIO \u8bbf\u95ee AHCI\uff0c\u7136\u540e AHCI HBA \u8fde\u63a5\u5230 SATA \u8bbe\u5907\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sata","title":"SATA","text":"<p>SATA \u4e00\u822c\u8bf4\u7684\u662f\u63a5\u53e3\u3002\u5b83\u4e00\u822c\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u6570\u636e\u548c\u7535\u6e90\u3002\u6570\u636e\u90e8\u5206\u53ea\u6709 7 \u4e2a pin\uff0c\u4e09\u4e2a GND \u548c\u4e24\u5bf9\u5dee\u5206\u7ebf\uff08A+A- B+B-\uff09\uff0c\u56fe\u7247\u5982\u4e0b\uff1a</p> <p></p> <p>\u7535\u6e90\u90e8\u5206\u6709 15 \u4e2a pin\uff0c\u6709 GND 3.3V 5V \u548c 12V\uff0c\u56fe\u7247\u5982\u4e0b\uff1a</p> <p></p> <p>\u5e38\u89c1\u7684 SATA \u76d8\u6709 2.5 \u82f1\u5bf8\uff08small form factor, SFF\uff09\u548c 3.5 \u82f1\u5bf8\uff08large form factor\uff0cLFF\uff09\u4e24\u79cd\u89c4\u683c\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#m2","title":"M.2","text":"<p>M.2 \u53c8\u79f0 NGFF\uff0c\u6709\u4e0d\u540c\u7684 key \u7c7b\u578b\u3002\u5e38\u89c1\u7684\u662f B \u548c M\uff1a</p> <ul> <li>B key: 12-19 notched, PCIe x2, SATA</li> <li>M key: 59-66 notched, PCIe x4, SATA</li> </ul> <p>\u90fd\u6709\u90e8\u5206\u5f15\u811a\u7684\u4f4d\u7f6e\u662f\u7a7a\u7684\uff1a</p> <p></p> <p>\u5728\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u4e24\u79cd key \u7684 pinout\u3002</p> <ul> <li>B key: SATA pin B(41,43) A(47,49), PCIe x2 pin R1(29,31) T1(35,37) R0(41,43) T0(47,49), USB 3.0 pin TX(29, 31) RX(35,37)</li> <li>M key: SATA \u540c\u4e0a\uff0cPCIe x4 pin R3(5,7) T3(11,13) R2(17,19) T2(23,25) Lane 0,1 \u540c\u4e0a</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cSATA pin \u548c PCIe \u7684\u4e24\u4e2a lane \u5728 B \u548c M key \u4e2d\u662f\u4e00\u6837\u7684\uff0c\u7269\u7406\u4e0a\u4e5f\u662f\u53ef\u4ee5\u517c\u5bb9\u7684\u3002</p> <p>\u56e0\u4e3a\u652f\u6301 SATA \u548c PCIe\uff0c\u5c31\u6709\u4e0b\u9762\u4e09\u79cd\u53ef\u80fd\u7684\u4f7f\u7528\u65b9\u5f0f\uff1a</p> <ul> <li>PCIe -- AHCI HBA(Board) -- SATA(M.2) -- Disk: \u4f20\u7edf\u65b9\u5f0f\uff0c\u53ea\u4e0d\u8fc7\u7269\u7406\u63a5\u53e3\u4ece SATA \u53d8\u6210\u4e86 M.2</li> <li>PCIe -- PCIe Device(M.2) -- Disk(AHCI)\uff1a\u786c\u76d8\u5b9e\u73b0\u4e86 AHCI \u7684\u63a5\u53e3\uff0c\u901a\u8fc7 PCIe \u8fde\u63a5\u5230 CPU</li> <li>PCIe -- PCIe Device(M.2) -- Disk(NVMe)\uff1a\u786c\u76d8\u5b9e\u73b0\u4e86 NVMe \u7684\u63a5\u53e3\uff0c\u901a\u8fc7 PCIe \u8fde\u63a5\u5230 CPU</li> </ul> <p></p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sata-express","title":"SATA express","text":"<p>SATA express \u5728 SATA 3.2 \u5f15\u5165\uff0c\u5b83\u7528\u7684\u5f88\u5c11\uff0c\u88ab U.2 \u53d6\u4ee3\u3002\u63d0\u4f9b\u4e86 PCIe x2 \u6216\u8005 SATA x2\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#u2","title":"U.2","text":"<p>U.2 \u4e5f\u53eb SFF-8639\u3002\u5b83\u548c SATA express \u63a5\u53e3\u4e00\u6837\uff0c\u4f46\u63d0\u4f9b\u4e86 PCIe x4 \u6216\u8005 SATA x2\u3002\u8be6\u89c1 pinout\u3002</p> <p></p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#\u901f\u5ea6\u6bd4\u8f83","title":"\u901f\u5ea6\u6bd4\u8f83","text":"<p>\u4e0d\u540c\u7684\u534f\u8bae\u7684\u901f\u5ea6\u5982\u4e0b\uff1a</p> <ul> <li>SATA 3.0: 6Gb/s(8b/10b, 4Gb/s uncoded)</li> <li>SAS-1: 3Gb/s</li> <li>SAS-2: 6Gb/s</li> <li>SAS-3: 12Gb/s</li> <li>SAS-4: 22.5Gb/s</li> <li>PCIe 3.0 x4: 32Gb/s(8GT/s, 128b/130b, 31.5 Gb/s uncoded)</li> </ul> <p>\u66f4\u5b8c\u6574\u7684\u53ef\u4ee5\u770bList of interface bit rates\u3002</p> <p>Intel SSD DC P4618 Series \u8bfb\u5199\u901f\u5ea6\u53ef\u4ee5\u8fbe\u5230 40~50 Gb/s\uff0c\u5b83\u91c7\u7528\u7684\u662f PCIe 3.0 x8(64Gb/s) NVMe\u3002</p> <p>Intel SSD 545s Series \u8bfb\u5199\u901f\u5ea6\u7ea6 4Gb/s\uff0c\u91c7\u7528\u7684\u662f SATA 3.0 6Gb/s\u3002</p> <p>SAMSUNG 970 EVO \u8bfb\u5199\u901f\u5ea6 20~30 Gb/s\uff0c\u5b83\u91c7\u7528\u7684\u662f PCIe 3.0 x4(32Gb/s) NVMe\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sas","title":"SAS","text":"<p>SAS \u6d89\u53ca\u7684\u7269\u7406\u63a5\u53e3\u6bd4\u8f83\u591a\uff0c\u4e0b\u9762\u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1aDELL SCv2000</p> <p>\u6587\u6863\uff1ahttps://dl.dell.com/topicspdf/storage-sc2000_owners-manual_en-us.pdf</p> <p>\u5b83\u7684\u80cc\u9762\uff1a</p> <p></p> <p>\u5b83\u6709\u56db\u4e2a\u524d\u7aef\u63a5\u53e3 Mini-SAS High Density (HD)\uff0c\u5373 SFF-8644\uff1b\u4e24\u4e2a\u540e\u7aef\u63a5\u53e3 Mini-SAS\uff0c\u5373 SFF-8088\u3002</p> <p>RAID \u5361\u4f8b\u5b50\uff1aMegaRAID SAS 9361-8i</p> <p>\u6587\u6863\uff1ahttps://docs.broadcom.com/doc/12351995</p> <p>\u5b83\u7684\u63a5\u53e3\u6709\uff1a</p> <ol> <li>\u4e24\u4e2a mini-SAS SFF-8643(Mini Multilane 4/8X 12 Gb/s Unshielded Connector (HD12un)) \u5185\u90e8\u8fde\u63a5\u5668\uff0c\u8fde\u63a5\u5230\u786c\u76d8</li> <li>PCIe 3.0 8x \u8fde\u63a5\u4e3b\u677f</li> </ol> <p>SAS \u6807\u51c6\uff1a</p> <ul> <li>INCITS 417 Serial Attached SCSI 1.1 (SAS-1.1)</li> <li>INCITS 457 Serial Attached SCSI 2 (SAS-2)</li> <li>INCITS 478 Serial Attached SCSI 2.1 (SAS-2.1)</li> <li>INCITS 519 Serial Attached SCSI - 3 (SAS-3)</li> <li>INCITS 534 Serial Attached SCSI - 4 (SAS-4)</li> </ul> <p>\u53ef\u4ee5\u4ece https://www.t10.org/drafts.htm#SCSI3_SAS \u514d\u8d39\u4e0b\u8f7d\u5c1a\u672a\u6210\u4e3a\u6807\u51c6\u7684 SAS-4.1 Working Draft\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sas-\u76f8\u5173\u7684\u7269\u7406\u63a5\u53e3","title":"SAS \u76f8\u5173\u7684\u7269\u7406\u63a5\u53e3","text":"<p>\u67e5\u627e SFF \u6807\u51c6\uff1ahttps://www.snia.org/technology-communities/sff/specifications</p> <p>\u4e2d\u6587\u4ecb\u7ecd\uff1ahttps://www.163.com/dy/article/H8TGPEUA0532B75P.html</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-8087","title":"SFF-8087","text":"<p>Mini Multilane 4X Unshielded Connector Shell and Plug</p> <p></p> <p>\u4ecb\u7ecd\uff1ahttps://cs-electronics.com/sff-8087/</p> <p>Mini SAS 4i \u8fde\u63a5\u5668\u5c31\u662f 36 pin \u7684 SFF-8087\uff0c\u652f\u6301\u56db\u8def SAS\u3002i \u8868\u793a\u7528\u4e8e internal \u8fde\u63a5\u3002\u5bf9\u5e94\u7684 external \u63a5\u53e3\u662f SFF-8088\u3002</p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/25823</p> <p>\u5b83\u7684\u5f15\u811a\u5b9a\u4e49\u53ef\u4ee5\u5728 SFF-9402 \u770b\u5230\uff0c\u5b83\u7684\u5f15\u811a\u5206\u4e3a A \u9762\u548c B \u9762\uff0c\u6bcf\u9762\u6709 18 \u4e2a PIN\uff0c\u7528\u9014\u5982\u4e0b\uff1a</p> <ul> <li>A2(Rx0+), A3(Rx0-), B2(Tx0+), B3(Tx0-)\uff1a\u7b2c\u4e00\u7ec4\u5dee\u5206\u5bf9</li> <li>A4(Rx1+), A5(Rx1-), B4(Tx1+), B5(Tx1-)\uff1a\u7b2c\u4e8c\u7ec4\u5dee\u5206\u5bf9</li> <li>A13(Rx2+), A14(Rx2-), B13(Tx2+), B14(Tx2-)\uff1a\u7b2c\u4e09\u7ec4\u5dee\u5206\u5bf9</li> <li>A16(Rx3+), A17(Rx3-), B16(Tx3+), B17(Tx3-)\uff1a\u7b2c\u56db\u7ec4\u5dee\u5206\u5bf9</li> <li>B8(Sclock), B9(Sload), A10(SDataOut), A11(SDataIn)\uff1aSGPIO \u534f\u8bae</li> <li>B8(2W-CLK), B9(2W-DATA)\uff1a\u7528\u4e8e SES \u7684 I2C \u534f\u8bae</li> </ul> <p>\u8fd9\u56db\u7ec4\u5dee\u5206\u5bf9\u5bf9\u5e94\u56db\u8def SAS \u6216\u8005 SATA\u3002SGPIO \u534f\u8bae\u7684\u6807\u51c6\u662f SFF-8485\uff0c\u4e3b\u8981\u7528\u9014\u662f\u63a7\u5236\u786c\u76d8\u72b6\u6001\u706f\uff0c\u4ee5\u53ca\u5224\u65ad\u76d8\u662f\u5426\u63d2\u5165\u3002</p> <p>\u76f8\u5173\u6807\u51c6\uff1a</p> <ul> <li>SFF-8086: Mini Multilane 10 Gb/s 4X Common Elements Connector</li> </ul>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-8088","title":"SFF-8088","text":"<p>Mini Multilane 4X Shielded Connector Shell and Plug</p> <p></p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/25824</p> <p>Mini SAS 4x \u8fde\u63a5\u5668\u5c31\u662f 26 pin \u7684 SFF-8088\uff0c\u652f\u6301\u56db\u8def SAS\u3002\u7528\u4e8e external \u8fde\u63a5\u3002\u5bf9\u5e94\u7684 internal \u63a5\u53e3\u662f SFF-8087\u3002</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-8482sff-8678sff-8680sff-8681","title":"SFF-8482/SFF-8678/SFF-8680/SFF-8681","text":"<p>SFF-8482: Serial Attachment 2X Unshielded Connector (EIA-966)</p> <p></p> <p>\u4ecb\u7ecd\uff1ahttps://cs-electronics.com/sff-8482/</p> <p>\u652f\u6301\u4e24\u8def SAS\uff0c29 \u4e2a\u5f15\u811a\u3002\u548c SATA \u7684\u63a5\u53e3\u5927\u5c0f\u4e00\u6837\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u53ef\u4ee5\u517c\u5bb9 SATA \u548c SAS \u76d8\uff0c\u6bd4\u8f83\u5e38\u89c1\u3002</p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/25920</p> <p>\u4e0d\u540c\u901f\u7387\u7684\u7248\u672c\uff1a</p> <ul> <li>SFF-8678: Serial Attachment 2X 6Gb/s Unshielded Connector</li> <li>SFF-8680: Serial Attachment 2X 12Gb/s Unshielded Connector, \u652f\u6301 SAS-2.x \u548c SAS-3</li> <li>SFF-8681: Serial Attachment 2X 24Gb/s Unshielded Connector, \u652f\u6301 SAS-4</li> </ul>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-86148644","title":"SFF-8614/8644","text":"<p>SFF-8614: Mini Multilane 4/8X Shielded Cage/Connector (HDsh)</p> <p></p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/25939</p> <p>\u5bf9\u5e94\u7684 internal \u7248\u672c\u662f SFF-8643: Mini Multilane 4/8X 12 Gb/s Unshielded Connector</p> <p>\u540d\u79f0\uff1aExternal Mini-SAS HD(High Density)</p> <p>\u5347\u7ea7\u7248\u672c\uff1a</p> <p>SFF-8644: Mini Multilane 4/8X 12 Gb/s Shielded Cage/Connector (HD12sh)</p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/25952</p> <p>\u652f\u6301 SAS-3 \u548c PCIe 3.0</p>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-8639","title":"SFF-8639","text":"<p>Multifunction 6X Unshielded Connector</p> <p>\u53c8\u79f0 U.2</p> <p></p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/26489</p> <p>\u7528\u9014\uff1a</p> <ul> <li>Single port SATA (as defined by Serial ATA revision 3.1)</li> <li>Two port SATA Express (as defined in Serial ATA Technical Proposal #TPR_C109, currently under development)</li> <li>Dual port SAS (as defined by SFF-8482)</li> <li>MultiLink SAS (as defined by SFF-8630)</li> <li>Up to 4 lanes of PCIe (as defined in this specification)</li> </ul>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#sff-8611","title":"SFF-8611","text":"<p>MiniLink 4/8X I/O Cable Assemblies</p> <p>\u53c8\u79f0 OCuLink 1.0</p> <p></p> <p>\u6807\u51c6\u4e0b\u8f7d\u5730\u5740\uff1ahttps://members.snia.org/document/dl/27937</p> <p>\u7528\u9014\uff1a</p> <ul> <li>PCIe</li> <li>SAS</li> </ul>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2021/05/06/disk/#\u786c\u76d8\u6027\u80fd\u6307\u6807","title":"\u786c\u76d8\u6027\u80fd\u6307\u6807","text":"<p>\u786c\u76d8\u6027\u80fd\u4e00\u822c\u4f1a\u770b\u5982\u4e0b\u51e0\u4e2a\u6307\u6807\uff1a</p> <ol> <li>\u987a\u5e8f\u8bfb\u5199\u6027\u80fd\uff0c\u5728\u6307\u5b9a\u7684 block size \u4e0b\uff0c\u987a\u5e8f\u8bfb\u5199\u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u5355\u4f4d\u901a\u5e38\u662f MB/s</li> <li>\u968f\u673a\u8bfb\u5199\u6027\u80fd\uff0c\u5728\u6307\u5b9a\u7684 block size \u4e0b\uff08\u4e00\u822c\u662f 4KB\uff09\uff0c\u968f\u673a\u5730\u5740\u8bfb\u5199\u7684\u6bcf\u79d2\u8bfb\u5199\u64cd\u4f5c\u6b21\u6570\uff0c\u5355\u4f4d\u901a\u5e38\u662f IOPS</li> <li>\u5ef6\u8fdf</li> </ol> <p>CrystalDiskInfo \u672f\u8bed\uff1a</p> <ul> <li>SEQ1MQ8T1\uff1a\u987a\u5e8f\u8bfb\u5199\uff08SEQ\uff09\uff0c\u4e00\u6b21\u8bfb\u5199 1 MB\uff081M\uff09\uff0c\u961f\u5217\u6df1\u5ea6\u662f 8\uff08Q8\uff09\uff0c\u5355\u7ebf\u7a0b\uff08T1\uff09</li> <li>SEQ128KQ32T1\uff1a\u987a\u5e8f\u8bfb\u5199\uff08SEQ\uff09\uff0c\u4e00\u6b21\u8bfb\u5199 128 KB\uff08128K\uff09\uff0c\u961f\u5217\u6df1\u5ea6\u662f 32\uff08Q32\uff09\uff0c\u5355\u7ebf\u7a0b\uff08T1\uff09</li> <li>RND4KQ32T16\uff1a\u968f\u673a\u8bfb\u5199\uff08RND\uff09\uff0c\u4e00\u6b21\u8bfb\u5199 4KB\uff084K\uff09\uff0c\u961f\u5217\u6df1\u5ea6\u662f 32\uff08Q32\uff09\uff0c16 \u7ebf\u7a0b\uff08T16\uff09</li> <li>RND4KQ1T1\uff1a\u968f\u673a\u8bfb\u5199\uff08RND\uff09\uff0c\u4e00\u6b21\u8bfb\u5199 4KB\uff084K\uff09\uff0c\u961f\u5217\u6df1\u5ea6\u662f 1\uff08Q1\uff09\uff0c\u5355\u7ebf\u7a0b\uff08T1\uff09</li> </ul> <p>\u6839\u636e SSD vs HDD - Should You Buy a Solid State Drive or Hard Disk Drive?\uff0cSSD \u548c HDD \u5728\u987a\u5e8f\u8bfb\u5199\u6027\u80fd\u4e0a\u7684\u5e38\u89c1\u8303\u56f4\uff1a</p> <ul> <li>SSD: 300 ~ 500 MB/s</li> <li>HDD: 100 ~ 160 MB/s</li> </ul> <p>SSD \u548c HDD \u5728\u968f\u673a\u8bfb\u5199\u6027\u80fd\u4e0a\u7684\u5e38\u89c1\u8303\u56f4\uff1a</p> <ul> <li>SSD: 20,000 ~ 100,000 IOPS</li> <li>HDD: 75 ~ 100 IOPS</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cSSD \u548c HDD \u76f8\u6bd4\uff0c\u987a\u5e8f\u8bfb\u5199\u6027\u80fd\u9ad8\uff0c\u968f\u673a\u8bfb\u5199\u6027\u80fd\u663e\u8457\u9ad8\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u6570\u636e\u6709\u4e9b\u8fc7\u65f6\u4e86\u3002</p> <p>\u4e0b\u9762\u770b\u4e00\u4e9b\u5177\u4f53\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>HDD TOSHIBA AL15SEB120N: \u987a\u5e8f\u8bfb\u5199\u6027\u80fd 234.0 MB/s\uff0c\u5ef6\u8fdf 2.86ms</li> <li>HDD SEAGATE ST10000NM0096: \u987a\u5e8f\u8bfb\u5199\u6027\u80fd 254 MB/s\uff0c\u968f\u673a\u8bfb 170 IOPS\uff0c\u968f\u673a\u5199 370 IOPS\uff0c\u5ef6\u8fdf 4.16ms</li> <li>SSD Ultrastar DC SS200: \u987a\u5e8f\u8bfb 1,800 MB/s\uff0c\u987a\u5e8f\u5199 1,000 MB/s\uff0c\u968f\u673a\u8bfb 250,000 IOPS\uff0c\u968f\u673a\u5199 86,000 IOPS\uff0c\u5ef6\u8fdf 100us</li> <li>SSD KIOXIA EXCERIA PRO NVMe SSD: \u987a\u5e8f\u8bfb 7,300 MB/s\uff0c\u987a\u5e8f\u5199 6,400 MB/s\uff0c\u968f\u673a\u8bfb 800,000 IOPS\uff0c\u968f\u673a\u5199 1,300,000 IOPS</li> <li>SSD SAMSUNG PM9A1: \u987a\u5e8f\u8bfb 7,000 MB/s\uff0c\u987a\u5e8f\u5199 5,200 MB/s\uff0c\u968f\u673a\u8bfb 1,000,000 IOPS\uff0c\u968f\u673a\u5199 850,000 IOPS</li> </ul>","tags":["disk","pcie","ahci","sata","sas","nvme"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/","title":"\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a","text":"","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u4e70\u5230\u4e86\u9f99\u82af 3A6000 \u4ee5\u53ca\u914d\u5957\u4e3b\u677f\uff0c\u5728\u6b64\u8bb0\u5f55\u6211\u7ec4\u88c5\u53f0\u5f0f\u673a\u7684\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u5728\u5176\u4e0a\u7684\u4f53\u9a8c\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u8d2d\u4e70","title":"\u8d2d\u4e70","text":"<p>\u7ec4\u88c5\u7684\u7b2c\u4e00\u6b65\u662f\u8d2d\u4e70\u5404\u4e2a\u914d\u4ef6\uff0c\u6211\u4e70\u4e86\u5982\u4e0b\u7684\u914d\u4ef6\uff1a</p> <ol> <li>\u4e3b\u677f + CPU\uff1aLoongson-3A6000-7A2000-1w-V0.1-EVB\uff08LS3A6000-7A2000-1w-EVB-V1.21\uff0cXA612A0_V1.1\uff09\uff0c\u6682\u672a\u6b63\u5f0f\u4e0a\u5e02</li> <li>\u5185\u5b58\uff1aKingston HyperX HX426C16FB3/8 8GB\uff0c169 \u5143</li> <li>\u663e\u5361\uff1aAMD RADEON RX550 4G 379 \u5143</li> <li>\u65e0\u7ebf\u7f51\u5361\uff1aIntel AX200 79 \u5143</li> <li>\u786c\u76d8\uff1a\u81f4\u6001 TiPlus5000 Gen3 1TB\uff0c369 \u5143</li> <li>\u673a\u7bb1\uff1a\u7231\u56fd\u8005 A15 ATX\uff0c100 \u5143</li> <li>\u7535\u6e90\uff1a\u7231\u56fd\u8005 DK \u7cfb\u5217 500W\uff0c149 \u5143</li> </ol> <p>\u9664\u4e86\u4e3b\u677f\u548c CPU \u4ee5\u5916\u603b\u4ef7\u4e00\u5343\u51fa\u5934\u3002\u76ee\u524d\u4e3b\u677f\u548c CPU \u8fd8\u6ca1\u6709\u6b63\u5f0f\u4e0a\u5e02\uff0c\u6309\u7167 3A5000 \u73b0\u5728\u7684\u4ef7\u683c\u7684\u4f30\u8ba1\u7684\u8bdd\u5927\u6982\u4e5f\u662f\u4e00\u5343\u591a\uff0c\u52a0\u8d77\u6765\u6574\u673a\u4e0d\u5230\u4e09\u5343\u3002\u5f53\u7136\u4e86\uff0c\u73b0\u5728 3A6000 \u624d\u521a\u51fa\u6765\uff0c\u6240\u4ee5\u6211\u4e70\u7684\u4ef7\u683c\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u4f46\u81ea\u5df1\u7ec4\u88c5\u4e5f\u80fd\u7701\u4e0b\u6765\u4e0d\u5c11\u94b1\u3002 3A6000 \u5df2\u7ecf\u6b63\u5f0f\u4e0a\u5e02\u3002</p> <p>\u5b9e\u9645\u4e0a\u8fd9\u91cc\u7535\u6e90\u4e70\u7684\u504f\u5927\u4e86\uff0c\u4e0d\u8fc7 400W \u548c 500W \u4e5f\u53ea\u5dee 20 \u5757\u94b1\uff0c\u5c31\u6109\u5feb\u5730\u52a0\u4ef7\u4e86\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u5185\u5b58\u517c\u5bb9\u6027","title":"\u5185\u5b58\u517c\u5bb9\u6027","text":"<p>\u6211\u6d4b\u8bd5\u7684\u5185\u5b58\u6761\uff1a</p> <ol> <li>Kingston HyperX HX426C16FB3/8(KHX2666C16/8G) 8GB DDR4-2666(PnP) 1Rx8\uff1a\u652f\u6301\uff0c\u80fd\u8fbe\u5230 2600 MT/s</li> <li>Kingston HyperX KF432C16BB/8(KF3200C16D4/8GX) 8GB DDR4-2400(JEDEC) 1Rx8\uff1a\u652f\u6301\uff0c\u80fd\u8fbe\u5230 2400 MT/s</li> <li>\u91d1\u767e\u8fbe\uff08KingBank\uff09\u94f6\u7235 \u957f\u946b\u9897\u7c92 DDR4 3200MHz\uff08\u5b9e\u9645\u662f MT/s\uff0cJEDEC 2666\uff0916GB U-DIMM 1.35V CL 16\uff1a\u4e0d\u652f\u6301 \u56fa\u4ef6 V4.0.05634 \u652f\u6301\uff0c\u80fd\u8fbe\u5230 2600 MT/s</li> <li>\u7d2b\u5149 SCC16GP02H1F1C-26V 16GB 2666 ECC\uff1a\u4e0d\u652f\u6301</li> <li>\u7d2b\u5149 SCC32GP12H1F1C-26V 32GB 2666 ECC: \u4e0d\u652f\u6301</li> </ol> <p>\u5173\u4e8e 2600 MT/s vs 2666 MT/s \u7684\u95ee\u9898\uff1a\u4ece Memory PLL \u6765\u770b\uff0c\u662f 100 MHz \u7684\u9891\u7387\u901a\u8fc7 PLL \u5f97\u5230 1300 MHz\uff0c\u786e\u5b9e\u662f 2600 MT/s\uff0c\u4e0d\u8fc7\u5f53\u6210 2666 \u6765\u7528\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>\u7f51\u53cb\u8868\u793a\u5728 3A6000 \u4e0a\u53ef\u4ee5\u5de5\u4f5c\u7684\u5185\u5b58\u578b\u53f7\uff1a</p> <ol> <li>\u4e09\u661f M393A4G43AB3-CWEGY 32GB 2Rx8 PC4-3200AA-RE3-12-R80 RDIMM</li> <li>\u7d2b\u5149 SCC16GU03H2F1C-32AA 16GB 1Rx8 PC4-3200U-22-22-22</li> <li>\u7d2b\u5149 SCE08GU04APA-32 8GB 1Rx16 PC4-3200U-22-22-22</li> <li>\u7d2b\u5149 SCE16GU03BPB-32 16GB 1Rx8 PC4-3200U-22-22-22</li> </ol> <p>\u7f51\u53cb\u8868\u793a\u5728 3A5000 \u4e0a\u53ef\u4ee5\u5de5\u4f5c\u7684\u5185\u5b58\u578b\u53f7\uff1a</p> <ol> <li>\u7d2b\u5149 SCC08GU03H3F1C-32AA 8G UDIMM PC4-3200</li> <li>\u7d2b\u5149 SCC16GU03H4F1C-32AA 16G UDIMM PC4-3200</li> </ol> <p>\u6ce8\uff1a\u517c\u5bb9\u6027\u968f UEFI \u56fa\u4ef6\u7248\u672c\u548c\u786c\u4ef6\u7248\u672c\u4e0d\u540c\u53ef\u80fd\u4e0d\u540c\uff0c\u56e0\u6b64\u8bfb\u8005\u9047\u5230\u4e0d\u540c\u7684\u517c\u5bb9\u6027\u60c5\u51b5\u4e5f\u662f\u53ef\u80fd\u7684\u3002\u6211\u76ee\u524d\u4f7f\u7528\u7684 UEFI \u56fa\u4ef6\u7248\u672c\u662f Loongson-UDK2018-V4.0.05420-stable202302\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u663e\u5361\u517c\u5bb9\u6027","title":"\u663e\u5361\u517c\u5bb9\u6027","text":"<p>\u6211\u6d4b\u8bd5\u7684\u663e\u5361\uff1a</p> <ol> <li>AMD RX550\uff1a\u53ef\u7528</li> <li>AMD RX6400\uff1a\u4e0d\u53ef\u7528\uff0c\u89c1\u4e0d\u5230 BIOS \u754c\u9762 \u66f4\u65b0\u56fa\u4ef6\u5e76\u5173\u95ed GPU Emulation \u540e\uff0c\u5728 BIOS \u4e0d\u53ef\u7528\uff0c\u4f46\u662f\u53ef\u4ee5\u8fdb Linux \u4ee5\u540e\u7528</li> </ol> <p>\u5728\u6211\u8fd9\u91cc\u4e3b\u677f\u4e0a\u7684 HDMI \u4e0d\u5de5\u4f5c\uff0c\u53ea\u6709\u72ec\u663e AMD RX550 \u7684 HDMI \u53ef\u4ee5\u5de5\u4f5c\uff0c\u4e0d\u786e\u5b9a\u662f\u5426\u548c 4K \u663e\u793a\u5668\u6709\u5173\u3002\u53e6\u5916\u6709\u7f51\u53cb\u8868\u793a\u4e3b\u677f\u4e0a\u7684 VGA \u53ef\u4ee5\u5de5\u4f5c\u3002\u56fa\u4ef6\u7248\u672c\u662f Loongson-UDK2018-V4.0.05420-stable202302\u3002</p> <p>UPDATE\uff1a\u66f4\u65b0\u56fa\u4ef6\u5230 Loongson-UDK2018-V4.0.05494-stable202305 \u4ee5\u540e\uff0c\u4e3b\u677f\u4e0a\u7684 HDMI \u4e5f\u5de5\u4f5c\u4e86\uff1a\u5177\u4f53\u5730\u8bb2\uff0c\u662f\u5728 VGA \u4e0b\u65b9\u7684 HDMI\u3002</p> <p>UPDATE\uff1a\u66f4\u65b0\u56fa\u4ef6\u5230 UDK2018-3A6000-7A2000_EVB_V4.0.05634_prestable2311dbg.fd \u4ee5\u540e\uff0c\u5173\u95ed GPU Emulation \u9009\u9879\uff0cAMD RX6400 \u4e5f\u53ef\u7528\u4e86\uff0c\u53ea\u4e0d\u8fc7\u5728\u56fa\u4ef6\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u8f93\u51fa\u5230\u4e3b\u677f\u4e0a\u7684 HDMI\uff0c\u89c1 3A6000: Add EVB_XA61200 Board Support\u3002</p> <p>\u5907\u6ce8\uff1a\u5df2\u77e5\u7684\u56fa\u4ef6\u7248\u672c\uff1a</p> <ul> <li>V4.0.05420-stable202302\uff1a\u9884\u88c5\u7248\u672c</li> <li>V4.0.05494-stable202305\uff1a\u4fee\u590d\u4e86\u4e3b\u677f\u4e0a\u7684 HDMI \u7684\u95ee\u9898\uff0c\u4fee\u590d\u4e86 ACPI PPTT \u8868</li> <li>V4.0.05569-stable202308\uff1a\u89c1\u4e8e gitea whlug</li> <li>V4.0.05634-stable202308\uff1a\u6dfb\u52a0 GPU Emu Disable \u9009\u9879\u4ee5\u89e3\u51b3 AMD RX6400 \u7684\u95ee\u9898</li> </ul>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#linux-\u53d1\u884c\u7248","title":"Linux \u53d1\u884c\u7248","text":"<p>\u76ee\u524d\u67e5\u5230\u7684\u652f\u6301 LoongArch \u7684\u53d1\u884c\u7248\u6709\uff1a</p> <ul> <li>AOSC OS: \u6709 LiveCD\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709 DeployKit\uff0c\u53ef\u4ee5\u7528\u89e3\u538b base tarball \u7684\u65b9\u6cd5\u5b89\u88c5</li> <li>LoongArchLinux\uff1a\u6709\u5b89\u88c5 CD\uff0c\u53ef\u7528</li> <li>Gentoo\uff1a\u6ca1\u6709\u5b89\u88c5 CD\uff0c\u9700\u8981\u501f\u522b\u7684\u53d1\u884c\u7248\u7684\u73af\u5883\u6765\u5b89\u88c5</li> <li>Debian\uff1a\u6ca1\u6709\u5b98\u65b9\u5b89\u88c5 CD\uff0c\u6709\u7b2c\u4e09\u65b9\u7684\u5b89\u88c5 CD</li> <li>UOS\uff1a\u6ca1\u8bd5\u8fc7</li> <li>openEuler\uff1a\u6ca1\u8bd5\u8fc7</li> <li>Loongnix\uff1a\u6ca1\u8bd5\u8fc7</li> <li>Anolis OS\uff1a\u6ca1\u8bd5\u8fc7</li> </ul> <p>\u65e2\u7136\u4e70\u7684\u76d8\u6bd4\u8f83\u5927\uff0c\u5c31\u9884\u7559\u4e86\u591a\u4e2a\u7cfb\u7edf\u5206\u533a\u7684\u7a7a\u95f4\uff0c\u7136\u540e\u4fdd\u7559\u4e00\u4e2a\u5927\u7684\u6570\u636e\u5206\u533a\u3002\u76ee\u524d\u88c5\u4e86 AOSC OS\u3001LoongArchLinux\u3001Debian\u3001Gentoo \u548c NixOS\u3002</p> <p>\u76ee\u524d Debian \u8fd8\u7f3a\u5f88\u591a\u5305\uff0c\u4f46\u662f\u53ef\u4ee5\u624b\u52a8 bootstrap \u8d77\u6765\u3002\u6211\u76ee\u524d\u7528\u7684\u662f AOSC OS \u7684 Kernel\uff0c\u5176\u4f59\u7684\u90e8\u5206\u662f\u5728 Debian \u4e2d\u4ece\u6e90\u7801\u5f00\u59cb\u7f16\u8bd1\u3002\u4e2d\u95f4\u4f1a\u9047\u5230\u5404\u79cd\u5faa\u73af\u4f9d\u8d56\uff0c\u9700\u8981\u901a\u8fc7 DEB_BUILD_PROFILES \u6765\u6253\u7834\u5faa\u73af\uff0c\u5f88\u591a\u5305\u9700\u8981\u624b\u52a8\u5904\u7406\uff0c\u5148\u628a\u4e00\u4e9b\u96be\u5904\u7406\u7684\u5305\u53bb\u6389\uff0c\u7136\u540e\u4e4b\u540e\u518d\u91cd\u65b0\u6253\u5305\u3002</p> <p>UPDATE: \u73b0\u5728\u5df2\u7ecf\u6709\u5f88\u591a\u5305\u53ef\u4ee5\u7528\u4e86\u3002Revy \u6307\u51fa\u53ef\u4ee5\u7528 debootstrap \u751f\u6210\u4e00\u4e2a rootfs\uff1a</p> <pre><code>debootstrap --no-check-gpg --arch=loong64 --variant=buildd --foreign --include=ca-certificates,apt-transport-https,debian-ports-archive-keyring --extra-suites=unreleased unstable sid-loong64-sbuild http://mirror.sjtu.edu.cn/debian-ports\narch-chroot sid-loong64-sbuild\n/debootstrap/debootstrap --second-stage\napt -f install\n</code></pre> <p>Gentoo \u7684\u8bdd\uff0c\u6309\u7167\u5b98\u65b9\u7684\u5b89\u88c5\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u7528 loongarch \u7684 stage3 tarball\u3002\u76ee\u524d\u9047\u5230\u4e86\u4e00\u4e2a\u5c0f\u5751\uff0c\u5c31\u662f linux stable 6.4 \u5185\u6838\u9047\u5230\u6700\u65b0\u7684 binutils \u4f1a\u6709\u95ee\u9898\uff0c\u8868\u73b0\u662f Unsupport relocation type 65, please add its support(R_LARCH_B21)\uff0c\u8fd9\u662f\u56e0\u4e3a\u7f3a\u4e86\u7f16\u8bd1\u53c2\u6570\uff0c\u5bfc\u81f4 binutils \u751f\u6210\u4e86 Linux \u5185\u6838\u4e0d\u652f\u6301\u7684 relocation type\u3002\u95ee\u9898\u5df2\u7ecf\u5728 6.5 \u89e3\u51b3\uff08commit\uff09\u3002\u53ef\u4ee5\u7528 sys-kernel/git-sources \u6765\u4f7f\u7528\u6700\u65b0\u7684 rc\u3002</p> <p>UPDATE: Linux 6.5 \u6b63\u5f0f\u7248\u51fa\u4e86\uff0c\u76f4\u63a5\u88c5 6.5 \u5373\u53ef\u3002</p> <p>NixOS \u7684\u8bdd\uff0c\u53ef\u4ee5\u5148\u5728 x86 \u4e0a\u751f\u6210\u4e00\u4e2a bootstrap tarball\uff0c\u7136\u540e\u5728 LoongArch64 \u4e0a\u7528\u8fd9\u4e2a bootstrap tarball\uff0c\u89c1 Add loongarch64 bootstrap tarball\u3002\u9700\u8981\u4e00\u4e9b\u624b\u52a8\u64cd\u4f5c\uff0c\u4f46 bootstrap tarball \u914d\u597d\u4e86\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u7528 nixpkgs \u88c5\u4e1c\u897f\u4e86\u3002\u5982\u679c\u8981\u751f\u6210 NixOS \u7684\u5b89\u88c5\u955c\u50cf\uff0c\u53ef\u4ee5\u7528 nixos-generator\uff1a</p> <pre><code>git clone git@github.com:nix-community/nixos-generators\n./nixos-generators/nixos-generate -I nixpkgs=/path/to/nixpkgs -f install-iso --system loongarch64-linux\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u8fdb\u4e00\u6b65\u7f29\u77ed ISO \u6784\u5efa\u65f6\u95f4\uff0c\u53ef\u4ee5\u4fee\u6539 <code>nixos-generators/formats/install-iso.nix</code>\uff0c\u628a installation-cd-base \u6539\u6210 installation-cd-minimal\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u5df2\u6709\u7684\u7cfb\u7edf\u4e0a\u88c5\u65b0\u7684 NixOS\uff1a</p> <pre><code>nix build -L .#nixos-install-tools\n</code></pre> <p>\u8fd9\u91cc\u9762\u8fd8\u6709\u5f88\u591a\u5c0f\u7684 trick\uff0c\u9700\u8981\u5bf9 nixpkgs \u505a\u4e00\u4e9b\u4fee\u6539\uff1ahttps://github.com/jiegec/nixpkgs/commits/loongarch64\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#vscode","title":"VSCode","text":"<p>VSCode \u5b98\u65b9\u5927\u6982\u7387\u662f\u4e0d\u4f1a\u51fa loongarch \u7248\u672c\u7684\uff0c\u4f46\u662f\u81ea\u5df1\u53ef\u4ee5\u7f16\u8bd1\u4e00\u4e2a\u3002\u76ee\u524d\u8fd0\u884c VSCode \u7684\u4e3b\u8981\u969c\u788d\u662f Electron\u3002Electron \u7684\u4e0a\u6e38\u5316\u8fd8\u5728\u8fdb\u884c\uff0c\u4f46\u73b0\u5728\u4e5f\u6709\u4e00\u4e9b\u6253\u4e86 patch \u7684 Electron \u53ef\u7528\uff0c\u4f8b\u5982 LoongArchLinux \u7684\u6e90\u91cc\u63d0\u4f9b\u4e86 electron22 \u548c electron17-bin\u3002LoongArchLinux \u7684\u6e90\u91cc\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6bd4\u8f83\u8001\u7684 vscode 1.67.0 \u7248\u672c\uff08\u5bf9\u5e94\u7684 PKGBUILD\uff09\u3002\u6709\u7fa4\u53cb\u5df2\u7ecf\u7528 electron22 \u628a vscode 1.84.2 \u8dd1\u8d77\u6765\u4e86\uff1aLiarOnce/vscodium-electron-loong64\u3002</p> <p>Chrome \u7684\u60c5\u51b5\u548c VSCode \u7c7b\u4f3c\uff0c\u6838\u5fc3\u5176\u5b9e\u90fd\u662f Chromium \u5185\u6838\u7684\u79fb\u690d\u3002LoongArchLinux \u7684\u6e90\u91cc\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4efd Chromium 102.0.5005.63\u3002Firefox \u5219\u5df2\u7ecf\u80fd\u6bd4\u8f83\u5bb9\u6613\u5730\u8dd1\u8d77\u6765\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#vscode-remote","title":"VSCode Remote","text":"<p>VSCode Remote Server \u662f\u95ed\u6e90\u7684\uff08\u6ce8\uff1a\u8fd9\u91cc\u7684\u8868\u8ff0\u53ef\u80fd\u4e0d\u51c6\u786e\uff0c\u6709\u7fa4\u53cb\u53cd\u9988\u53ef\u4ee5\u5728 LoongArch \u4e0a\u7f16\u8bd1\u5f00\u6e90\u7248\u672c\uff09\uff0c\u4f46\u662f\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528 lat \u6765\u5bf9 nodejs \u505a\u4e8c\u8fdb\u5236\u7ffb\u8bd1\u3002\u53ea\u9700\u8981\u9b54\u6539 <code>~/.vscode/extensions/ms-vscode-remote.remote-ssh-0.102.0/out/extension.js</code>\uff08\u7248\u672c\u53f7\u53ef\u80fd\u4e0d\u540c\uff09\uff0c\u628a\u91cc\u9762\u5bf9 x86_64 \u67b6\u6784\u7684\u5224\u65ad\uff0c\u52a0\u4e0a loongarch64\uff0c\u4e5f\u5c31\u662f\u628a loongarch64 \u5f53\u6210 x86_64 \u53bb\u5904\u7406\uff0c\u90a3\u4e48 VSCode Remote \u5c31\u4f1a\u4e0b\u8f7d x86_64 \u7684 binary \u5e76\u8fd0\u884c\uff0c\u6b64\u65f6\u7528 lat \u5c31\u53ef\u4ee5\u8dd1 server \u4e86\u3002</p> <p>\u6309\u7167\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u8df5\u4e86\u4e00\u4e0b\uff1aQEMU \u8fd8\u6ca1\u652f\u6301 LASX \u6307\u4ee4\uff08\u6709 patch \u4f46\u662f\u8fd8\u6ca1\u6709\u5408\u5e76\uff09\uff0c\u6240\u4ee5\u8dd1\u7684\u65f6\u5019\u4f1a SIGILL\u3002\u771f\u673a 3A6000 \u4e0a\u4f1a\u5728 lat \u91cc\u9762\u5931\u8d25\uff0c\u56e0\u4e3a\u6211\u7528\u7684\u662f\u65b0\u4e16\u754c\u53d1\u884c\u7248\uff0c\u548c\u65e7\u4e16\u754c\u53d1\u884c\u7248\u7684 syscall \u4e0d\u517c\u5bb9\u3002\u6216\u8bb8\u7528\u65e7\u4e16\u754c\u53d1\u884c\u7248\u53ef\u4ee5\u7528 lat \u6b63\u5e38\u8fd0\u884c\u3002</p> <p>UPDATE: \u4f7f\u7528 LoongArchLinux \u7684\u65b0\u4e16\u754c lat 1.3.1\uff0cVSCode Remote Server \u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u8fd8\u6709 BUG\u3002</p> <p>UPDATE: \u4f7f\u7528 LoongArchLinux \u7684\u65b0\u4e16\u754c lat 1.4.3\uff0cVSCode Remote Server \u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u6ca1\u6709\u4e86\u4e4b\u524d\u7684 BUG\u3002</p> <p>\u4e5f\u5c1d\u8bd5\u4e86\u7528 qemu user \u53bb\u8fd0\u884c x86 \u7684 nodejs\uff0c\u4f46\u662f\u9047\u5230\u4e86 page size \u4e0d\u5339\u914d\u7684\u95ee\u9898\uff1a16KB != 4KB\uff0c\u4e5f\u6ca1\u8dd1\u8d77\u6765\u3002</p> <p>\u53e6\u4e00\u4e2a\u66f2\u7ebf\u6551\u56fd\u7684\u65b9\u6cd5\u662f\uff0c\u4fee\u6539 extension.js \u8ba9 VSCode \u8ba4\u4e3a\u662f AArch64\uff0c\u7136\u540e\u7528 qemu-user \u6765\u8dd1\u3002\u8fd9\u6b21\u6ca1\u6709\u9047\u5230 page size \u7684\u95ee\u9898\u4e86\uff1a</p> <pre><code>sudo apt install qemu-aarch64-static\nwget https://repo.aosc.io/debs/pool/stable/main/g/gcc-runtime_12.2.0-0_arm64.deb\nwget https://repo.aosc.io/debs/pool/stable/main/g/glibc_2.36-4_arm64.deb\ndpkg --extract gcc-runtime_12.2.0-0_arm64.deb /path/to/prefix\ndpkg --extract glibc_2.36-4_arm64.deb /path/to/prefix\n\n# add to shell init\nexport QEMU_LD_PREFIX=/path/to/prefix\n</code></pre> <p>\u8fd9\u6837\u6709\u4e2a\u4f18\u52bf\u4e5f\u662f\u52a3\u52bf\uff0c\u5c31\u662f Extension \u4e5f\u4f1a\u8ba4\u4e3a Remote \u662f AArch64\uff0c\u90a3\u4e48\u5c31\u4f1a\u8dd1\u81ea\u5e26\u7684 AArch64 \u7684\u7a0b\u5e8f\uff0c\u4f46\u5982\u679c\u6709\u539f\u751f\u7684 LoongArch64 \u7a0b\u5e8f\uff0c\u90a3\u8fd8\u662f\u7528\u540e\u8005\u66f4\u597d\u3002\u4e00\u4e2a\u4f8b\u5b50\u662f rust-analyzer\uff0c\u53ef\u4ee5\u6307\u5b9a native binary\uff1a</p> <pre><code>{\n    \"rust-analyzer.server.path\": \"/usr/bin/rust-analyzer\"\n}\n</code></pre> <p>\u8fd9\u6837\u53ea\u6709 vscode server \u672c\u8eab\u662f\u7528 qemu-aarch64-static \u8dd1\u7684\uff0c\u5176\u4ed6\u5219\u6ca1\u6709\u5f71\u54cd\u3002</p> <p>\u6b64\u5916\uff0ccode-server \u4e5f\u662f\u53ef\u4ee5\u7528\u7684\uff0c\u5b89\u88c5 node v16 \u548c npm\uff0c\u7136\u540e\u8fd0\u884c code-server \u5b89\u88c5\u811a\u672c\u5373\u53ef\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u5bb9\u5668","title":"\u5bb9\u5668","text":"<p>\u53ef\u4ee5 podman \u8dd1\u5176\u4ed6\u67b6\u6784\u7684\u5bb9\u5668\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sudo podman run --arch x86_64 -it --rm debian:stable\nsudo podman run --arch arm64 -it --rm debian:stable\n</code></pre> <p>\u53ea\u8981\u8fd9\u4e2a image \u6709\u5bf9\u5e94\u67b6\u6784\u7684\u7248\u672c\uff0c\u5e76\u4e14\u63d0\u524d\u914d\u597d binfmt\uff0c\u6ce8\u610f binfmt \u7684 flags\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a POCF\uff0c\u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u662f F\uff0c\u4e0d\u7136 binfmt \u4f1a\u5728\u5bb9\u5668\u91cc\u627e binfmt \u7684 executable\uff0c\u81ea\u7136\u5c31\u627e\u4e0d\u5230\u4e86\uff0c\u4f1a\u62a5\u9519 <code>exec container process (missing dynamic library?)</code>\u3002</p> <p>docker \u6253\u4e0a\u7b80\u5355\u7684 patch \u4ee5\u652f\u6301 loong64 \u4ee5\u540e\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code>docker run -it --rm --platform arm64 debian\n</code></pre>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#loong-arch-linux-\u4e0a-xrdp-\u517c\u5bb9\u6027\u95ee\u9898","title":"Loong Arch Linux \u4e0a XRDP \u517c\u5bb9\u6027\u95ee\u9898","text":"<p>\u5728 Loong Arch Linux \u4e0a\u8fd0\u884c XRDP\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u542f\u52a8\u9ed1\u5c4f\u7684\u95ee\u9898\u3002\u5b83\u7684\u95ee\u9898\u6709\u4e24\u4e2a\uff1a</p> <ol> <li><code>/etc/xrdp/sesman.ini</code> \u4e2d\uff0c\u5e94\u8be5\u6307\u5b9a Xorg \u7684\u5b8c\u6574\u8def\u5f84\uff0c\u628a <code>param=Xorg</code> \u6539\u6210 <code>param=/usr/lib/Xorg</code>\u3002\u8fd9\u5728 xrdp AUR \u4e0b\u9762\u7684\u8ba8\u8bba\u91cc\u53ef\u4ee5\u770b\u5230\u3002</li> <li>\u5728 <code>/usr/share/X11/xorg.conf.d</code> \u4e2d\uff0c\u5982\u679c\u6709 <code>10-modeset.conf</code>\uff0c\u5b83\u4f1a\u5bfc\u81f4 xrdp \u542f\u52a8\u7684 Xorg \u5c1d\u8bd5\u6253\u5f00 virtual console\uff0c\u4f46\u662f\u56e0\u4e3a\u4e0d\u662f root \u7528\u6237\uff0c\u6240\u4ee5\u4f1a\u5931\u8d25\uff1b\u5373\u4f7f\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u6dfb\u52a0\u4e86 <code>-configdir /</code> \u53c2\u6570\u4e5f\u6ca1\u6709\u7528\uff0c\u56e0\u4e3a <code>/usr/share/X11/xorg.conf.d</code> \u662f\u5168\u5c40\u7684\u914d\u7f6e\u76ee\u5f55\uff0c\u4e0d\u53d7 <code>-configdir</code> \u9009\u9879\u5f71\u54cd\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u628a 10-modeset.conf \u6539\u540d\uff0c\u6216\u8005\u632a\u5230\u5176\u4ed6\u5730\u65b9\u3002\u4f46\u662f\u8981\u5c0f\u5fc3\u662f\u5426\u4f1a\u5f71\u54cd\u672c\u673a root \u81ea\u5df1\u7684 X11 \u670d\u52a1\u542f\u52a8\u3002</li> </ol> <p>\u5176\u4e2d <code>10-modeset.conf</code> \u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>Section \"Device\"\n        Identifier \"Generic Kernel Modesetting Device\"\n        Driver \"modesetting\"\n        Option \"kmsdev\" \"/dev/dri/card0\"\n        Option \"ShadowFB\" \"true\"\nEndSection\n</code></pre> <p>\u8fd9\u4e2a\u6587\u4ef6\u7531 <code>xorg-server</code> \u5305\u5b89\u88c5\uff1a</p> <pre><code>$ pacman -F 10-modeset.conf\nextra/xorg-server 21.1.8-3 (xorg) [installed]\n    usr/share/X11/xorg.conf.d/10-modeset.conf\n</code></pre> <p>\u662f\u4ece 10-modeset.conf \u5b89\u88c5\u800c\u6765\u3002modesetting Driver \u7684\u6587\u6863\u89c1 MODESETTING(4)\u3002\u8bbe\u7f6e\u8fd9\u4e2a\u5e94\u8be5\u662f\u4e3a\u4e86 7A2000 \u7684 GPU\uff1a<code># fix modesetting driver for loongson and gsgpu</code>\uff0c\u4f46\u662f\u8bef\u4f24\u4e86 xrdp\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#benchmark","title":"Benchmark","text":"<p>\u63a8\u8350\u9605\u8bfb\uff1a\u534e\u4e3a VS \u9f99\u82af \u56fd\u4ea7 CPU \u67b6\u6784\u521d\u6b65\u63a2\u6d4b\u3001\u5bf9\u6bd4\u4e0e\u5206\u6790</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#aosc","title":"AOSC","text":"<p>\u5728 AOSC \u4e0a\u8dd1\u4e00\u4e9b\u6d4b\u8bd5\u8f6f\u4ef6\u7684\u6d4b\u8bd5\u7ed3\u679c\uff08\u5192\u53f7\u540e\u591a\u4e2a\u6570\u5b57\u4e3a\u8dd1\u591a\u6b21\u7684\u7ed3\u679c\uff09\uff0c\u4e0d\u4e00\u5b9a\u51c6\u786e\uff1a</p> <ul> <li>p7zip <code>7z -mmt1 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a3681 3678 3680</li> <li>p7zip <code>7z -mmt4 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a13998 13995 14038</li> <li>p7zip <code>7z -mmt8 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a20585 20816 20407</li> <li>Coremark v1.01 \u5355\u7ebf\u7a0b\uff08<code>make</code>\uff09: 21134 21164 21161</li> <li>Coremark v1.01 \u56db\u7ebf\u7a0b\uff08<code>make XCFLAGS=\"-DMULTITHREAD=4 -DUSE_PTHREAD\"</code>\uff09\uff1a83571 83629 83565</li> <li>Coremark v1.01 \u516b\u7ebf\u7a0b\uff08<code>make XCFLAGS=\"-DMULTITHREAD=8 -DUSE_PTHREAD\"</code>\uff09\uff1a113111 113143 113250</li> </ul> <p>\u5176\u4e2d\u56db\u7ebf\u7a0b\u7684\u6d4b\u8bd5\u7ed1\u5b9a\u5230 <code>0,2,4,6</code> \u6838\u5fc3\u3002\u7f16\u8bd1\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u5411\u91cf\u5316\uff0cLSX/LASX \u53ea\u6709\u7279\u5b9a\u7684\u6c47\u7f16\u4f18\u5316\u3002</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u7f51\u53cb\u7684\u8bc4\u6d4b","title":"\u7f51\u53cb\u7684\u8bc4\u6d4b","text":"<ul> <li>https://www.bilibili.com/video/BV1gr4y1o7P8/</li> </ul> <p>\u5b98\u65b9\u53d1\u5e03\uff1ahttps://mp.weixin.qq.com/s/Lm_6varu0ovntPGfVzeGLw</p>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#microbenchmark","title":"Microbenchmark","text":"<p>\u4e0b\u9762\u662f\u6211\u7528 microbenchmark \u65b9\u6cd5\u6d4b\u5230\u7684\u4e00\u4e9b\u5fae\u67b6\u6784\u6570\u636e\uff0c\u4e0d\u4e00\u5b9a\u51c6\u786e\uff1a</p> <p>3A6000:</p> <ol> <li>\u4e3b\u9891\uff1a2500 MHz</li> <li>L1 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a1.2ns\uff0c3 \u5468\u671f</li> <li>L2 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a4.81ns\uff0c12 \u5468\u671f</li> <li>L3 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a17.63ns\uff0c44 \u5468\u671f<ol> <li>add.w/d: 4 per cycle, 1 cycle latency</li> <li>mul.w/d: 2 per cycle, 4 cycle latency</li> <li>fadd.s/d: 4 per cycle, 3 cycle latency</li> <li>fmul.s/d: 2 per cycle, 5 cycle latency</li> <li>fmadd.s/d: 2 per cycle, 5 cycle latency</li> <li>crc.w.b.w: 2 per cycle, 1 cycle latency</li> <li>crc.w.h.w: 2 per cycle, 1 cycle latency</li> <li>crc.w.w.w: 2 per cycle, 1 cycle latency</li> <li>crc.w.d.w: 2 per cycle, 1 cycle latency</li> <li>xvadd/vadd.d: 4 per cycle, 1 cycle latency</li> <li>xvmul/vmul.d: 2 per cycle, 4 cycle latency</li> <li>xvfadd/vfadd.d: 4 per cycle, 3 cycle latency</li> <li>xvfmul/vfmul.d: 2 per cycle, 5 cycle latency</li> </ol> </li> <li>\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6027\u80fd\uff1a<ol> <li>\u5355\u6838\u6807\u91cf\uff1a2500 * 2 * 2 = 10 GFLOPS</li> <li>\u5355\u6838\u5411\u91cf\uff1a2500 * 2 * 2 * 4 = 40 GFLOPS</li> <li>\u5168\u6838\u5411\u91cf\uff1a4 * 40 = 160 GFLOPS</li> </ol> </li> </ol> <p>\u8bbf\u5b58\u5ef6\u8fdf\u4e0e\u5de5\u4f5c\u96c6\u5927\u5c0f\u7684\u5173\u7cfb\uff08\u4f7f\u7528 jiegec/cpu-micro-benchmarks \u6d4b\u8bd5\uff09\uff1a</p> <p></p> <p>\u4e3b\u8981\u5206\u4e09\u6bb5\uff1a</p> <ol> <li>&lt;64KB: \u547d\u4e2d L1D\uff0cLatency \u662f 1.2 ns\uff0c3 \u5468\u671f\u300264KB \u4e0e L1D \u5bb9\u91cf 64 KB \u4e00\u81f4\u3002</li> <li>&lt;320KB: \u547d\u4e2d L2\uff0cLatency \u662f 4.8 ns\uff0c12 \u5468\u671f\u3002320KB \u7b49\u4e8e L1D \u5bb9\u91cf 64 KB \u4e0e L2 \u5bb9\u91cf 256 KB \u603b\u548c\uff0c\u800c\u4e0d\u50cf\u5f88\u591a\u5fae\u67b6\u6784\u90a3\u6837\u7b49\u4e8e L2 \u5bb9\u91cf\u3002</li> <li>&lt;256MB: \u547d\u4e2d L3\uff0cLatency \u662f 17.6 ns\uff0c44 \u5468\u671f\u3002256MB \u4e0d\u7b49\u4e8e L3 \u5bb9\u91cf 16 MB\uff0c\u548c\u7f13\u5b58\u66ff\u6362\u7b56\u7565\u6216\u9884\u53d6\u5668\u884c\u4e3a\u6709\u5173\u3002</li> </ol> <p>3C5000:</p> <ol> <li>\u4e3b\u9891\uff1a2200 MHz</li> <li>L1 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a1.82ns\uff0c4 \u5468\u671f</li> <li>L2 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a6.37ns\uff0c14 \u5468\u671f</li> <li>\u6307\u4ee4\u541e\u5410/\u5ef6\u8fdf\uff1a<ol> <li>add.w/d: 4 per cycle, 1 cycle latency</li> <li>mul.w/d: 2 per cycle, 4 cycle latency</li> <li>fadd.s/d: 2 per cycle, 5 cycle latency</li> <li>fmul.s/d: 2 per cycle, 5 cycle latency</li> <li>fmadd.s/d: 2 per cycle, 5 cycle latency</li> <li>crc.w.b.w: 1/3.5 per cycle, 5 cycle latency</li> <li>crc.w.h.w: 1/4.5 per cycle, 7 cycle latency</li> <li>crc.w.w.w: 1/6.5 per cycle, 11 cycle latency</li> <li>crc.w.d.w: 1/10.5 per cycle, 19 cycle latency</li> <li>xvadd/vadd.d: 2 per cycle, 1 cycle latency</li> <li>xvmul/vmul.d: 2 per cycle, 4 cycle latency</li> <li>xvfadd/vfadd.d: 2 per cycle, 5 cycle latency</li> <li>xvfmul/vfmul.d: 2 per cycle, 5 cycle latency</li> </ol> </li> </ol> <p>\u5bf9\u6bd4\uff1a</p> Inst latency &amp; throughput 3A6000 @ 2.5 GHz 3C5000 @ 2.2 GHz Kunpeng 920 @ 2.6 GHz 64b int add 4 per cyc, 1 cyc lat 4 per cyc, 1 cyc lat 3 per cyc, 1 cyc lat 64b int mul 2 per cyc, 4 cyc lat 2 per cyc, 4 cyc lat 1 per cyc, 4 cyc lat 64b fp add 4 per cyc, 3 cyc lat 2 per cyc, 5 cyc lat 2 per cyc, 4 cyc lat 64b fp mul 2 per cyc, 5 cyc lat 2 per cyc, 5 cyc lat 2 per cyc, 5 cyc lat 128b vec 64b int add 4 per cyc, 1 cyc lat 2 per cyc, 1 cyc lat 2 per cyc, 2 cyc lat 128b vec 64b int mul 2 per cyc, 4 cyc lat 2 per cyc, 4 cyc lat N/A 128b vec 64b fp add 4 per cyc, 3 cyc lat 2 per cyc, 5 cyc lat 1 per cyc, 4 cyc lat 128b vec 64b fp mul 2 per cyc, 5 cyc lat 2 per cyc, 5 cyc lat 1 per cyc, 5 cyc lat 256b vec 64b int add 4 per cyc, 1 cyc lat 2 per cyc, 1 cyc lat N/A 256b vec 64b int mul 2 per cyc, 4 cyc lat 2 per cyc, 4 cyc lat N/A 256b vec 64b fp add 4 per cyc, 3 cyc lat 2 per cyc, 5 cyc lat N/A 256b vec 64b fp mul 2 per cyc, 5 cyc lat 2 per cyc, 5 cyc lat N/A <p>\u53c2\u8003\uff1a</p> <ul> <li>https://www.7-cpu.com/cpu/Loongson_3A5000.html</li> <li>https://chipsandcheese.com/2023/04/09/loongsons-3a5000-chinas-best-shot/</li> <li>https://chipsandcheese.com/2023/02/26/loongsons-lsx-and-lasx-vector-extensions/</li> </ul>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2023/08/10/diy-ls3a6000-machine/#\u5df2\u77e5\u95ee\u9898","title":"\u5df2\u77e5\u95ee\u9898","text":"<p>\u9664\u4e86\u524d\u9762\u6240\u8ff0\u7684\u5185\u5b58\u6761\u548c\u663e\u5361\u517c\u5bb9\u6027\u4ee5\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u5df2\u77e5\u95ee\u9898\uff1a</p> <ul> <li>AMD \u663e\u5361\u5173\u5c4f\u4e45\u4e86\u4ee5\u540e\uff0c\u53ef\u80fd\u4f1a hang\uff0c\u6000\u7591\u662f\u7535\u6e90\u7ba1\u7406\u95ee\u9898 \u5347\u7ea7 6.5 \u5185\u6838\u540e\u95ee\u9898\u6d88\u5931</li> <li>\u56fa\u4ef6\u7684 PCIe Above 4G \u529f\u80fd\u4e0d\u53ef\u7528 \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li> <li>\u56fa\u4ef6\u7684 ACPI PPTT \u8868\u5185\u5bb9\u6709\u95ee\u9898 \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li> <li>\u677f\u8f7d HDMI \u6709\u95ee\u9898 \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li> </ul>","tags":["loongson","loongarch","cpu","machine","diy","ls3a6000"]},{"location":"hardware/2021/12/13/dram-fpga-vref-problem/","title":"DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898","text":"","tags":["dram","ddr","fpga","7series","xilinx","kintex7","mig"]},{"location":"hardware/2021/12/13/dram-fpga-vref-problem/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u6211\u4eec\u8bbe\u8ba1\u7684 Kintex 7 FPGA \u5f00\u53d1\u677f\u5728\u6d4b\u8bd5 DDR SDRAM \u7684\u65f6\u5019\u9047\u5230\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u91c7\u7528\u4e86 Internel VREF\uff0cMIG \u5728\u914d\u7f6e\u7684\u65f6\u5019\u9650\u5236\u4e86\u9891\u7387\u53ea\u80fd\u662f 400 MHz\uff0c\u5bf9\u5e94 800 MT/s\uff0c\u8fd9\u6837\u65e0\u6cd5\u8fbe\u5230 DDR \u7684\u6700\u597d\u6027\u80fd\u3002</p>","tags":["dram","ddr","fpga","7series","xilinx","kintex7","mig"]},{"location":"hardware/2021/12/13/dram-fpga-vref-problem/#\u539f\u7406","title":"\u539f\u7406","text":"<p>\u9996\u5148\uff0cVREF \u5728 DDR \u4e2d\u662f\u7528\u6765\u533a\u5206\u4f4e\u7535\u5e73\u548c\u9ad8\u7535\u5e73\u7684\u3002\u5728 JESD79-4B \u6807\u51c6\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9\u4e8e\u76f4\u6d41\u4fe1\u53f7\uff0c\u7535\u538b\u4e0d\u5c0f\u4e8e VREF+0.075V \u65f6\u8868\u793a\u9ad8\u7535\u5e73\uff0c\u800c\u7535\u538b\u4e0d\u9ad8\u4e8e VREF-0.075V \u65f6\u8868\u793a\u4f4e\u7535\u5e73\u3002VREF \u672c\u8eab\u5e94\u8be5\u4ecb\u4e8e VDD \u7684 0.49 \u500d\u5230 0.51 \u500d\u4e4b\u95f4\u3002</p> <p>\u5728\u8fde\u63a5 FPGA \u7684\u65f6\u5019\uff0c\u6709\u4e24\u79cd\u9009\u62e9\uff1a</p> <ul> <li>Internal VREF: \u4ece FPGA \u8f93\u51fa VREF \u4fe1\u53f7\u5230 DRAM</li> <li>External VREF\uff1a\u63a5\u5165 FPGA \u4ee5\u5916\u7684 VREF</li> </ul> <p>\u5bf9\u4e8e 7 Series \u7684 FPGA\uff0cXilinx \u8981\u6c42\u5982\u4e0b\uff1a</p> <pre><code>For DDR3 SDRAM interfaces running at or below 800 Mb/s (400 MHz),\nusers have the option of selecting Internal VREF to save two I/O\npins or using external VREF. VREF is required for banks containing\nDDR3 interface input pins (DQ/DQS).\n</code></pre> <p>\u8fdb\u4e00\u6b65\uff0cXilinx \u5728 UltraScale \u6587\u6863\u4e0b\u89e3\u91ca\u4e86\u80cc\u540e\u7684\u539f\u56e0\uff1a</p> <pre><code>The UltraScale internal VREF circuit includes enhancements compared\nto the 7 Series internal VREF circuit. Whereas 7 Series MIG had datarate\nlimitations on internal VREF usage (see (Xilinx Answer 42036)), internal\nVREF is recommended in UltraScale. The VREF for 7 Series had coarse steps\nof VREF value that were based on VCCAUX. This saved pins but limited the\nperformance because VCCAUX did not track with VCCO as voltage went up and\ndown. Not being able to track with VCCO enforced the performance\nlimitations of internal VREF in MIG 7 Series. UltraScale includes several\nchanges to internal VREF including a much finer resolution of VREF for DDR4\nread VREF training. Additionally, internal VREF is based on the VCCO supply\nenabling it to track with VCCO. Internal VREF is not subject to PCB and\nPackage inductance and capacitance. These changes in design now give internal\nVREF the highest performance.\n</code></pre> <p>\u7528\u4e2d\u6587\u7b80\u5355\u6765\u8bf4\uff1a</p> <ol> <li>7 Series FPGA \u4e2d\uff0cInternal VREF \u53ef\u4ee5\u8282\u7701\u5f15\u811a\uff0c\u4ee3\u4ef7\u662f VREF \u4e0d\u4f1a\u968f\u7740 VCCO \u53d8\u5316\u800c\u53d8\u5316\uff08\u800c\u662f\u968f\u7740 VCCAUX \u53d8\u5316\u800c\u53d8\u5316\uff09\uff0c\u5f53 DRAM \u9891\u7387\u63d0\u9ad8\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3 VREF \u7ea6\u7b49\u4e8e VDD \u4e00\u534a\u7684\u8981\u6c42</li> <li>UltraScale FPGA \u4e2d\uff0cInternal VREF \u662f\u968f\u7740 VCCO \u53d8\u5316\u800c\u53d8\u5316\u7684\uff0c\u5e76\u4e14\u4f1a\u6bd4 External VREF \u6027\u80fd\u66f4\u597d\uff1b\u56e0\u6b64 UltraScale FPGA \u7684 DDR4 \u53ea\u652f\u6301 Internal VREF\u3002</li> </ol> <p>\u4ee5 MA703FA-35T \u5f00\u53d1\u677f\u4e3a\u4f8b\uff0c\u5b83\u4f7f\u7528\u7684 FPGA \u662f Artix7 35T\uff0c\u5185\u5b58\u662f DDR3\uff0c\u91c7\u7528\u7684\u662f External VREF\u3002\u5b83\u91c7\u7528\u4e86 TPS51200 Sink and Source DDR Termination Regulator \u82af\u7247\uff0c\u5c06\u82af\u7247\u7684 REFOUT \u82af\u7247\u63a5\u5230 DRAM \u7684 VREFDQ \u548c VREFCA \u5f15\u811a\u4e0a\u3002</p>","tags":["dram","ddr","fpga","7series","xilinx","kintex7","mig"]},{"location":"hardware/2021/12/13/dram-fpga-vref-problem/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>MIG 7 Series - Internal/External VREF Guidelines</li> <li>UltraScale/UltraScale+ Memory IP - Can either external or internal VREF be used?</li> </ul>","tags":["dram","ddr","fpga","7series","xilinx","kintex7","mig"]},{"location":"hardware/2023/04/20/dram-topology-training/","title":"DRAM \u7684\u62d3\u6251\u548c\u8bad\u7ec3","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#dram-training","title":"DRAM Training","text":"<p>DRAM \u4e00\u76f4\u6709\u4e00\u4e2a\u6bd4\u8f83\u9ebb\u70e6\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\uff0c\u5c31\u662f DRAM Training\uff0c\u5176\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u6b65\u5c31\u662f\u8ba1\u7b97\u51fa\u5404\u4e2a\u6570\u636e\u7ebf\u76f8\u5bf9\u4e8e\u65f6\u949f\u7684\u504f\u79fb\uff08skew\uff09\u3002\u8fd9\u4e2a\u504f\u79fb\u662f\u600e\u4e48\u6765\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e SRAM\uff0c\u5982\u679c\u60f3\u8981\u66f4\u591a\u7684\u4f4d\u5bbd\uff0c\u53ea\u9700\u8981\u628a\u5730\u5740\u7ebf\u548c\u63a7\u5236\u4fe1\u53f7\u8fde\u63a5\u5230\u591a\u4e2a SRAM \u4e0a\uff0c\u7136\u540e\u628a SRAM \u7684\u6570\u636e\u4fe1\u53f7\u5e76\u884c\u8fde\u63a5\u5230 FPGA \u4e0a\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u524d\u63d0\u662f\u8981\u5c3d\u91cf\u4fdd\u8bc1\u7b49\u957f\uff0c\u5426\u5219\u4e00\u6837\u6709\u504f\u79fb\u7684\u95ee\u9898\u3002DRAM \u4e5f\u662f\u91c7\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u8fdb\u884c\u6269\u5c55\u7684\uff0c\u4f46\u662f DRAM \u901a\u5e38\u9700\u8981\u5e76\u884c\u8fde\u63a5\u5f88\u591a\u4e2a\u82af\u7247\uff0c\u4f8b\u5982 8 \u4e2a x8 \u7684\u82af\u7247\u7684\u5408\u5e76\u6210\u4e00\u4e2a 64 \u4f4d\u7684 DDR SDRAM\u3002\u6b64\u65f6\u6570\u636e\u7ebf\u4f9d\u7136\u662f\u5e76\u884c\u8fde\u63a5\uff0c\u4f46\u662f\u5730\u5740\u7ebf\u548c\u63a7\u5236\u4fe1\u53f7\u5c31\u51fa\u73b0\u4e86\u8d70\u7ebf\u56f0\u96be\uff1a\u5f88\u96be\u5728\u90a3\u4e48\u5c0f\u7684\u7a7a\u95f4\u91cc\uff0c\u7b49\u957f\u5730\u628a\u5730\u5740\u548c\u63a7\u5236\u4fe1\u53f7\u5206\u5e03\u5230\u5404\u4e2a\u82af\u7247\u4e0a\uff0c\u800c\u4e14\u8fd8\u6709\u4fe1\u53f7\u5b8c\u6574\u6027\u7684\u95ee\u9898\u3002</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#fly-by-topology","title":"Fly-by topology","text":"<p>\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u5730\u5740\u548c\u63a7\u5236\u4fe1\u53f7\u662f\u91c7\u7528\u4e86\u4e32\u8054\u7684\u65b9\u5f0f\u8fde\u63a5\uff0c\u4e5f\u5c31\u662f\u4e0b\u56fe\u7684\u53f3\u8fb9\u7684\u8fde\u63a5\u65b9\u5f0f\uff1a</p> <p></p> <p>\u56fe\u6e90 Versal ACAP PCB Design User Guide (UG863)\u3002</p> <p>\u4f46\u662f\u6570\u636e\u4fe1\u53f7\uff08DQ \u548c DQS\uff09\u4f9d\u7136\u662f\u5e76\u884c\u70b9\u5bf9\u70b9\u8fde\u63a5\u5230 DRAM \u4e0a\u7684\uff08\u4e0a\u56fe\u5de6\u4fa7\uff09\u3002\u8fd9\u5c31\u51fa\u73b0\u4e86\u95ee\u9898\uff1a\u4e0d\u540c\u7684 DRAM \u82af\u7247\uff0c\u6570\u636e\u548c\u65f6\u949f\u7684\u504f\u5dee\u4e0d\u540c\uff0c\u6570\u636e\u53ef\u80fd\u5dee\u4e0d\u591a\u65f6\u95f4\u5230\uff0c\u4f46\u662f\u65f6\u949f\u7684\u5ef6\u8fdf\u8d8a\u6765\u8d8a\u5927\uff1a</p> <p>\u6ce8\uff1a\u8fd9\u91cc\u7b80\u5316\u4e86\uff0c\u5f53\u6210 SDR \u6765\u753b\u3002</p> <p>\u4e0d\u505a\u4efb\u4f55\u5904\u7406\u7684\u8bdd\uff0cDRAM \u91c7\u6837\u5f97\u5230\u7684\u6570\u636e\u5c31\u4e0d\u6b63\u786e\u4e86\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u9700\u8981\u4eba\u4e3a\u5730\u5728\u6570\u636e\u4fe1\u53f7\u4e0a\u4e5f\u52a0\u4e0a\u53ef\u53d8\u7684\u5ef6\u8fdf\uff0c\u4fdd\u8bc1\u65f6\u949f\u548c\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u6837 DRAM \u624d\u53ef\u4ee5\u5b9e\u73b0\u6b63\u786e\u7684\u5199\u5165\uff1a</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#write-leveling","title":"Write Leveling","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u5199\u5165\u65f6\uff0c\u65f6\u949f\u548c\u6570\u636e\u6709\u504f\u79fb\u7684\u95ee\u9898\uff0c\u9700\u8981\u91c7\u7528 Write Leveling \u65b9\u6cd5\u6765\u89e3\u51b3\u3002\u5177\u4f53\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a\u5982\u679c DRAM \u4ee5\u65f6\u949f\u4fe1\u53f7\u53bb\u91c7\u6837\u6570\u636e\u4fe1\u53f7\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u90a3\u53cd\u8fc7\u6765\uff0c\u5982\u679c\u8ba4\u4e3a\u6570\u636e\u4fe1\u53f7\u662f\u65f6\u949f\u4fe1\u53f7\uff0c\u5728\u6570\u636e\u4fe1\u53f7\u7684\u4e0a\u5347\u6cbf\u53bb\u91c7\u6837\u65f6\u949f\uff0c\u5e94\u8be5\u4e5f\u53ef\u4ee5\u89c2\u6d4b\u5230\u7a33\u5b9a\u7684\u7ed3\u679c\u3002</p> <p>\u6240\u4ee5 Write Leveling \u7684\u5de5\u4f5c\u65b9\u5f0f\u5c31\u662f\uff1a</p> <ol> <li>\u8bbe\u7f6e DRAM \u8fdb\u5165 Write Leveling \u6a21\u5f0f\uff0c\u6b64\u65f6 DRAM \u4f1a\u4f7f\u7528 DQS \u4fe1\u53f7\u6765\u91c7\u6837 CK \u4fe1\u53f7\uff0c\u628a\u7ed3\u679c\u8f93\u51fa\u5230 DQ \u4e0a</li> <li>DDR \u63a7\u5236\u5668\u4e0d\u65ad\u5730\u4fee\u6539 DQS \u7684\u8f93\u51fa\u5ef6\u8fdf\uff0c\u7136\u540e\u7edf\u8ba1 DQ \u4e0a\u7684\u8f93\u51fa</li> </ol> <p>\u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p>\u4e0a\u56fe\u4e2d\uff0c\u7528\u4e0d\u65ad\u589e\u5927\u7684\u56db\u79cd\u5ef6\u8fdf\u7684 <code>dqs</code> \u5bf9 <code>ck</code> \u8fdb\u884c\u91c7\u6837\uff1a\u7528 <code>dqs_0</code> \u548c <code>dqs_1</code> \u91c7\u6837\u5f97\u5230\u4e86 0\uff0c\u7528 <code>dqs_2</code> \u548c <code>dqs_3</code> \u91c7\u6837\u5f97\u5230\u4e86 1\u3002\u628a\u8fd9\u4e9b\u7ed3\u679c\u5217\u51fa\u6765\uff0c\u53ef\u80fd\u4f1a\u5f97\u5230\u7c7b\u4f3c\u4e0b\u9762\u7684\u7ed3\u679c\uff1a</p> <pre><code>001111111111111111110000\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u968f\u7740\u5ef6\u8fdf\u589e\u5927\uff0c\u91c7\u6837\u7684\u6570\u636e\u4ece 0 \u53d8\u6210 1\uff0c\u518d\u4ece 1 \u53d8\u6210 0\u3002\u6211\u4eec\u7684\u76ee\u6807\u662f\uff0c\u8ba9 <code>dqs</code> \u548c <code>ck</code> \u540c\u6b65\u3002\u5728\u4e0a\u56fe\u4e2d\uff0c<code>dqs_2</code> \u7684\u4e0a\u5347\u6cbf\u548c <code>ck</code> \u4e0a\u5347\u6cbf\u662f\u6700\u63a5\u8fd1\u7684\uff0c\u800c\u521a\u597d <code>dqs_2</code> \u4e5f\u6b63\u597d\u51fa\u73b0\u5728\u91c7\u6837 0 \u53d8\u6210\u91c7\u6837 1 \u7684\u4f4d\u7f6e\u3002\u8fd9\u610f\u5473\u7740\uff0c\u53ea\u8981\u627e\u5230\u91c7\u6837\u6570\u636e\u4ece 0 \u53d8\u6210 1 \u7684\u4f4d\u7f6e\uff0c\u5c31\u77e5\u9053\u5982\u4f55\u8ba9 DQS \u4e0e CK \u540c\u6b65\u4e86\u3002</p> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86 Write Leveling \u7684\u6b65\u9aa4\uff0c\u5b9e\u73b0\u4e86 DQS \u4e0e CK \u540c\u6b65\u7684\u76ee\u6807\uff0c\u90a3\u4e48\u5728\u5199\u5165\u6570\u636e\u7684\u65f6\u5019\uff0cDRAM \u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684 DQS \u4fe1\u53f7\u4e86\u3002</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#read-leveling","title":"Read Leveling","text":"<p>\u5728\u4e0a\u4e00\u6b65\u7684 Write Leveling \u5f53\u4e2d\uff0c\u901a\u8fc7\u4fee\u6539\u5185\u5b58\u63a7\u5236\u5668\u7684\u8f93\u51fa\u5ef6\u8fdf\uff0c\u4fdd\u8bc1\u4e86 DRAM \u53ef\u4ee5\u5f97\u5230\u540c\u6b65\u7684 DQS \u548c CK \u4fe1\u53f7\uff0c\u89e3\u51b3\u4e86 Fly by topology \u5f15\u5165\u7684\u5ef6\u8fdf\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u8bfb\u64cd\u4f5c\uff0c\u6570\u636e\u4ece DRAM \u8f93\u51fa\uff0c\u8f93\u5165\u5230\u5185\u5b58\u63a7\u5236\u5668\uff0c\u53c8\u4f1a\u5f15\u5165\u4e00\u5b9a\u7684\u5ef6\u8fdf\u3002\u6240\u4ee5\u5bf9\u8bfb\u64cd\u4f5c\uff0c\u4e5f\u9700\u8981\u8fdb\u884c\u6821\u51c6\u3002</p> <p>\u56de\u987e SRAM\uff0c\u5f53\u60f3\u8981\u6d4b\u8bd5\u8bfb\u53d6\u529f\u80fd\u7684\u65f6\u5019\uff0c\u4f1a\u9996\u5148\u5199\u5165\u4e00\u4e9b\u6570\u636e\uff0c\u518d\u8bfb\u51fa\u6765\uff0c\u5224\u65ad\u8bfb\u53d6\u7684\u6570\u636e\u548c\u4e4b\u524d\u5199\u5165\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002DRAM \u4e5f\u662f\u7c7b\u4f3c\u7684\uff1a\u5148\u5411 MPR \u5199\u5165\u4e00\u4e9b\u4f2a\u968f\u673a\u6570\u636e\uff0c\u7136\u540e\u8981\u6c42 DRAM \u4ece MPR \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4ece memory cell \u4e2d\u8bfb\u53d6\u6570\u636e\uff1b\u7136\u540e\u5185\u5b58\u63a7\u5236\u5668\u4e00\u4fa7\u4e0d\u65ad\u8fdb\u884c\u8bfb\u53d6\u64cd\u4f5c\uff0c\u5728\u4e0d\u540c\u7684\u5ef6\u8fdf\u4e0b\uff0c\u6bd4\u8f83\u8bfb\u53d6\u7684\u6570\u636e\u4e0e\u9884\u671f\u7684\u968f\u673a\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002\u6700\u540e\u4e5f\u4f1a\u5f97\u5230\u4e00\u4e2a\u5ef6\u8fdf\u7684\u533a\u95f4\uff0c\u5728\u8fd9\u4e2a\u533a\u95f4\u5185\u53ef\u4ee5\u8bfb\u53d6\u51fa\u6b63\u786e\u7684\u7ed3\u679c\u3002\u6700\u540e\uff0c\u628a\u5ef6\u8fdf\u8bbe\u5b9a\u5728\u533a\u95f4\u7684\u4e2d\u592e\u4f4d\u7f6e\u3002</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#clam-shell-topology","title":"Clam Shell Topology","text":"<p>\u518d\u56de\u5230\u62d3\u6251\u7684\u95ee\u9898\u4e0a\u6765\uff0c\u5b9e\u9645\u4e0a\u9664\u4e86 Fly by topology\uff0c\u8fd8\u6709\u4e00\u79cd\u62d3\u6251\u662f Clam shell topology\uff1a\u628a DRAM \u5206\u5e03\u5728 PCB \u7684\u4e0a\u9762\u548c\u4e0b\u9762\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7701 PCB \u7684\u9762\u79ef\uff0c\u4f46\u662f\u8d70\u7ebf\u5c31\u4f1a\u6bd4\u8f83\u56f0\u96be\uff1a</p> <p></p> <p>\u56fe\u6e90 Versal ACAP Programmable Network on Chip and Integrated Memory Controller LogiCORE IP Product Guide (PG313) .</p> <p>\u76f4\u89c2\u5730\u8bb2\uff0c\u4e24\u4e2a\u82af\u7247\u90fd\u653e\u5728 PCB \u7684\u6b63\u9762\uff0c\u5982\u679c\u8981\u8fde\u7ebf\u7684\u8bdd\uff0c\u5982\u679c\u4fdd\u8bc1\u5f15\u811a\u987a\u5e8f\u63a5\u8fd1\u4e00\u81f4\uff0c\u5c31\u53ef\u4ee5\u6bd4\u8f83\u5bb9\u6613\u5730\u8fde\u63a5\uff0c\u4e0d\u4f1a\u6709\u5f88\u591a\u4ea4\u53c9\u7684\u5730\u65b9\u3002\u4f46\u5982\u679c\u4e00\u4e2a\u5728\u6b63\u9762\uff0c\u53e6\u4e00\u4e2a\u5728\u80cc\u9762\uff0c\u5f15\u811a\u7684\u987a\u5e8f\u5c31\u5012\u8f6c\u8fc7\u6765\u4e86\uff0c\u8fde\u7ebf\u7684\u65f6\u5019\u5c31\u6bd4\u8f83\u56f0\u96be\u3002\u89e3\u51b3\u7684\u529e\u6cd5\u662f\uff0c\u4fee\u6539\u5f15\u811a\u7684\u987a\u5e8f\uff0c\u628a\u4e00\u4e9b\u5f15\u811a\u7684\u529f\u80fd\u8fdb\u884c\u5bf9\u8c03\uff0c\u4f7f\u5f97\u8d70\u7ebf\u66f4\u52a0\u7b80\u5355\uff1a</p> <p></p> <p>\u56fe\u6e90 Versal ACAP PCB Design User Guide (UG863)</p> <p>\u8fd9\u91cc\u7279\u610f\u6311\u9009\u4e86\u4e00\u4e9b\u4e0d\u5f71\u54cd\u7279\u6b8a\u529f\u80fd\u7684\u5f15\u811a\u6765\u4ea4\u6362\uff0c\u4f7f\u5f97\u5927\u90e8\u5206\u529f\u80fd\uff0c\u5373\u4f7f\u4ea4\u6362\u4e86\u5f15\u811a\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e Mode Register Set \u64cd\u4f5c\uff0c\u5fc5\u987b\u8981\u5185\u5b58\u63a7\u5236\u5668\u81ea\u5df1\u5148\u5185\u90e8\u4ea4\u6362\u4f4d\u7684\u987a\u5e8f\uff0c\u624d\u80fd\u4fdd\u8bc1\u5728 DRAM \u4e00\u4fa7\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <p>\u6b64\u5916\uff0cClam Shell Topology \u7684\u6b63\u9762\u548c\u80cc\u9762\u5404\u6709\u4e00\u4e2a cs_n \u7247\u9009\u4fe1\u53f7\uff0c\u4f46\u662f\u8fd9\u548c Dual Rank \u4e0d\u540c\uff1aDual Rank \u662f\u6b63\u9762\u548c\u80cc\u9762\u90fd\u6709\u540c\u6837\u6570\u91cf\u7684 DRAM \u82af\u7247\uff0c\u5171\u4eab\u5730\u5740\u4fe1\u53f7\u3001\u6570\u636e\u4fe1\u53f7\u548c\u63a7\u5236\u4fe1\u53f7\uff0c\u603b\u7ebf\u4e0a\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4fa7\u7684 DRAM \u82af\u7247\u5728\u4f7f\u7528\uff0c\u597d\u5904\u662f\u5185\u5b58\u5bb9\u91cf\u7ffb\u500d\uff0c\u5e76\u4e14\u4e24\u4e2a rank \u53ef\u4ee5\u4e92\u76f8\u63a9\u76d6\u5ef6\u8fdf\uff1b\u800c Clam Shell Topology \u7684\u4e24\u4e2a cs_n \u662f\u4e3a\u4e86\u7ed9 Mode Register Set \u64cd\u4f5c\u6307\u5b9a\u6b63\u9762\u6216\u80cc\u9762\uff0c\u800c\u5176\u4f59\u7684\u5927\u90e8\u5206\u64cd\u4f5c\uff0c\u53ef\u4ee5\u6b63\u9762\u548c\u80cc\u9762\u540c\u65f6\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u6570\u636e\u4fe1\u53f7\u5e76\u6ca1\u6709\u5171\u4eab\u3002</p> <p></p> <p>\u56fe\u6e90 DIFFERENCE BETWEEN DUAL RANK AND SINGLE RANK RAM</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5b9e\u9645\u4e0a\uff0c\u524d\u9762\u7684\u6574\u4e2a\u7814\u7a76\u8fc7\u7a0b\uff0c\u6765\u81ea\u4e8e\u6211\u5bf9 VCU128 LiteX \u79fb\u690d\u7684\u89c2\u5bdf\uff1aVCU128 DDR4 memory calibration failure\u3002\u6211\u5728\u914d\u7f6e litedram \u7684\u65f6\u5019\uff0c\u53d1\u73b0\u603b\u662f\u6709\u4e00\u534a\u7684 DRAM \u82af\u7247\u65e0\u6cd5\u4f7f\u7528\uff0c\u548c Datasheet \u5bf9\u7167\u4e86\u4ee5\u540e\uff0c\u53d1\u73b0\u6b63\u597d\u662f PCB \u80cc\u9762\u7684\u90a3\u4e00\u534a\u3002\u63a5\u7740\uff0c\u53d1\u73b0\u5b83\u662f Clam Shell Topology \u65b9\u5f0f\u6765\u5206\u5e03\u7684\uff0c\u7136\u540e Top \u548c Bottom \u5404\u6709\u4e00\u4e2a cs_n \u4fe1\u53f7\uff0c\u8fd9\u4e00\u70b9\u5728 UG1302 \u91cc\u662f\u6ca1\u6709\u5199\u7684\uff0c\u5728 xdc \u91cc\u624d\u53ef\u4ee5\u627e\u5230\uff1a</p> <pre><code>set_property PACKAGE_PIN BK48       [get_ports \"PL_DDR4_BOT_CS_B\"] ;# Bank  66 VCCO - DDR4_VDDQ_1V2 - IO_L7P_T1L_N0_QBC_AD13P_66\nset_property IOSTANDARD  SSTL12_DCI [get_ports \"PL_DDR4_BOT_CS_B\"] ;# Bank  66 VCCO - DDR4_VDDQ_1V2 - IO_L7P_T1L_N0_QBC_AD13P_66\nset_property PACKAGE_PIN BP49     [get_ports \"PL_DDR4_CS_B\"] ;# Bank  66 VCCO - DDR4_VDDQ_1V2 - IO_L1N_T0L_N1_DBC_66\nset_property IOSTANDARD  SSTL12   [get_ports \"PL_DDR4_CS_B\"] ;# Bank  66 VCCO - DDR4_VDDQ_1V2 - IO_L1N_T0L_N1_DBC_66\n</code></pre> <p>\u6240\u4ee5 Xilinx \u6587\u6863\u4e5f\u662f\u53ef\u80fd\u51fa\u9519\u7684\uff0c\u9700\u8981\u7ed3\u5408\u591a\u4e2a\u4fe1\u606f\u6e90\u6765\u5224\u65ad\u3002\u8fd9\u91cc\u6709 xdc \u548c schematic \u53ef\u4ee5\u53c2\u8003\uff0c\u90fd\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u7ed3\u8bba\u3002</p> <p>\u6cbf\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u6211\u7ed9 litedram \u6dfb\u52a0\u4e86 clam shell topology \u7684\u652f\u6301\uff1ahttps://github.com/enjoy-digital/litedram/pull/332 \u548c https://github.com/enjoy-digital/litex/pull/1673\uff0c\u5b9e\u73b0\u65b9\u6cd5\uff1a</p> <ol> <li>\u5728\u6821\u51c6\u9636\u6bb5\uff0c\u628a Top \u548c Bottom \u4e24\u4e2a cs_n \u66b4\u9732\u7ed9\u8f6f\u4ef6\uff0c\u8f6f\u4ef6\u5728 MRS \u7684\u65f6\u5019\uff0c\u5206\u4e24\u6b21\u5199\u5165\uff0c\u7b2c\u4e00\u6b21\u539f\u6837\u5199\u5230 Top\uff0c\u7b2c\u4e8c\u6b21\u4ea4\u6362\u5730\u5740\u987a\u5e8f\uff0c\u518d\u5199\u5165 Bottom\u3002</li> <li>\u6b63\u5e38\u5de5\u4f5c\u9636\u6bb5\uff0c\u628a Top \u548c Bottom \u7684\u4e24\u4e2a cs_n \u5f53\u6210\u4e00\u4e2a\u7528\uff0c\u4e5f\u5c31\u662f\u5f53\u6210 single rank dram\u3002</li> </ol>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#\u8bad\u7ec3\u4ee3\u7801","title":"\u8bad\u7ec3\u4ee3\u7801","text":"<p>\u4e0b\u9762\u7ed3\u5408 litex \u548c litedram \u7684\u4ee3\u7801\uff0c\u4ee5\u53ca DDR4 \u6807\u51c6\uff0c\u6765\u9a8c\u8bc1\u4e0a\u9762\u7684\u89c2\u5bdf\u3002</p>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#write-leveling_1","title":"Write Leveling","text":"<p>Write Leveling \u7684\u6838\u5fc3\u51fd\u6570\u662f <code>sdram_write_leveling_scan</code>\uff0c\u5b83\u7684\u6838\u5fc3\u601d\u8def\u662f\uff1a</p> <p>\u7b2c\u4e00\u6b65\u8c03\u7528 <code>sdram_write_leveling_on</code> \u6253\u5f00 DRAM \u7684 Write Leveling \u6a21\u5f0f\uff1a</p> <pre><code>  sdram_write_leveling_on();\n</code></pre> <p>\u5faa\u73af\u6bcf\u4e2a DRAM \u82af\u7247\u7684\u6bcf\u4e2a DQS \u4fe1\u53f7\uff1a</p> <pre><code>for(i=0;i&lt;SDRAM_PHY_MODULES;i++) {\n  for (dq_line = 0; dq_line &lt; DQ_COUNT; dq_line++) {\n    /* \u8bbe\u7f6e DQS \u521d\u59cb\u5ef6\u8fdf\u4e3a 0 */\n    sdram_leveling_action(i, dq_line, write_rst_delay);\n\n    /* \u5faa\u73af DQS \u5ef6\u8fdf */\n    for(j=0;j&lt;err_ddrphy_wdly;j++) {\n      int zero_count = 0;\n      int one_count = 0;\n\n      for (k=0; k&lt;loops; k++) {\n        /* \u53d1\u9001 DQS \u5e8f\u5217\uff1a00000001 */\n        ddrphy_wlevel_strobe_write(1);\n\n        /* \u7edf\u8ba1 1 \u548c 0 \u7684\u4e2a\u6570 */\n        if (buf[SDRAM_PHY_MODULES-1-i] != 0)\n          one_count++;\n        else\n          zero_count++;\n      }\n      if (one_count &gt; zero_count)\n        /* DQS \u91c7\u6837\u5230\u4e86 CK \u7684\u6b63\u534a\u5468\u671f */\n        taps_scan[j] = 1;\n      else\n        /* DQS \u91c7\u6837\u5230\u4e86 CK \u7684\u8d1f\u534a\u5468\u671f */\n        taps_scan[j] = 0;\n\n      /* \u6bcf\u6b21\u5faa\u73af\u589e\u52a0\u4e00\u6b21 DQS \u5ef6\u8fdf */\n      sdram_leveling_action(i, dq_line, write_inc_delay);\n    }\n\n    /* \u627e\u5230\u4e00\u4e2a\u6700\u957f\u7684\u8fde\u7eed 1 \u7684\u5e8f\u5217 */\n    one_window_active = 0;\n    one_window_start = 0;\n    one_window_count = 0;\n    one_window_best_start = 0;\n    one_window_best_count = -1;\n    for(j=0;j&lt;err_ddrphy_wdly+1;j++) {\n      if (one_window_active) {\n        if ((j == err_ddrphy_wdly) || (taps_scan[j] == 0)) {\n          /* \u7ed3\u675f\u4e86\u4e00\u6bb5\u8fde\u7eed\u7684 1 */\n          one_window_active = 0;\n          one_window_count = j - one_window_start;\n          /* \u8bb0\u5f55\u6700\u957f\u7684\u8fde\u7eed 1 \u7684\u957f\u5ea6\u548c\u4f4d\u7f6e */\n          if (one_window_count &gt; one_window_best_count) {\n            one_window_best_start = one_window_start;\n            one_window_best_count = one_window_count;\n          }\n        }\n      } else {\n        /* \u627e\u5230\u8fde\u7eed\u7684 1 \u7684\u5f00\u5934 */\n        if (j != err_ddrphy_wdly &amp;&amp; taps_scan[j]) {\n          one_window_active = 1;\n          one_window_start = j;\n        }\n      }\n    }\n\n    /* \u8981\u627e\u7684\u5ef6\u8fdf\u5c31\u662f\u8fde\u7eed\u7684 1 \u5e8f\u5217\u7684\u5f00\u59cb\u4f4d\u7f6e */\n    delays[i] = one_window_best_start;\n  }\n}\n\nsdram_write_leveling_off();\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86 Write Leveling \u7684\u5168\u6d41\u7a0b\uff1a</p> <ol> <li>\u8bbe\u7f6e DRAM \u8fdb\u5165 Write Leveling \u6a21\u5f0f\uff0cDRAM \u7528 DQS \u5bf9 CK \u91c7\u6837\uff0c\u7ed3\u679c\u8f93\u51fa\u5230 DQ</li> <li>\u5728\u4e0d\u540c\u7684 DQS \u5ef6\u8fdf\u4e0b\uff0c\u53d1\u9001\u540c\u6837\u7684 00000001 DQS \u6a21\u5f0f\uff0c\u89c2\u5bdf DQ \u4e0a\u7684\u6570\u636e</li> <li>\u7edf\u8ba1 DQ \u4e0a\u7684 1 \u548c 0 \u7684\u4e2a\u6570\uff0c\u5982\u679c 1 \u66f4\u591a\uff0c\u5c31\u8ba4\u4e3a\u5f53\u524d DQS \u5ef6\u8fdf\u4e0b\uff0cDQS \u91c7\u6837\u5230\u4e86 CK \u7684\u6b63\u534a\u5468\u671f\uff1b\u53cd\u4e4b\u5982\u679c 0 \u66f4\u591a\uff0c\u5c31\u8ba4\u4e3a\u5f53\u524d DQS \u5ef6\u8fdf\u4e0b\uff0cDQS \u91c7\u6837\u5230\u4e86 CK \u7684\u8d1f\u534a\u5468\u671f</li> <li>\u5728\u7b2c\u4e09\u6b65\u7684\u7ed3\u679c\u4e2d\uff0c\u627e\u5230\u6700\u957f\u7684\u8fde\u7eed\u7684 1 \u5e8f\u5217\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5e8f\u5217\u7684\u5f00\u59cb\uff0c\u5c31\u5bf9\u5e94\u4e86\u91c7\u6837\u503c\u4ece 0 \u5230 1 \u7684\u53d8\u5316\uff0c\u6b64\u65f6 DQS \u4e0e CK \u57fa\u672c\u540c\u6b65</li> <li>\u6700\u540e\u8bbe\u7f6e DRAM \u9000\u51fa Write Leveling \u6a21\u5f0f</li> </ol>","tags":["ddr","sdram","dram"]},{"location":"hardware/2023/04/20/dram-topology-training/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>https://www.systemverilog.io/design/ddr4-initialization-and-calibration/</li> <li>https://docs.xilinx.com/r/en-US/ug863-versal-pcb-design/Signals-and-Connections-for-DDR4-Interfaces</li> <li>https://docs.xilinx.com/r/en-US/pg353-versal-acap-soft-ddr4-mem-ip/Calibration-Overview</li> <li>https://docs.xilinx.com/r/en-US/pg313-network-on-chip/Clamshell-Topology</li> <li>https://docs.xilinx.com/r/en-US/ug863-versal-pcb-design/Utilizing-Address-Mirroring-to-Ease-Clamshell-Routing</li> <li>https://blog.memory4less.com/2022/09/16/difference-between-dual-rank-and-single-rank-ram/</li> <li>https://daffy1108.wordpress.com/2010/09/02/understanding-ddr3-write-leveling-and-read-leveling/</li> </ul>","tags":["ddr","sdram","dram"]},{"location":"hardware/2021/12/12/dram/","title":"\u300c\u6559\u5b66\u300dDRAM \u7ed3\u6784\u548c\u7279\u6027","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#dram-\u662f\u5982\u4f55\u7ec4\u7ec7\u7684","title":"DRAM \u662f\u5982\u4f55\u7ec4\u7ec7\u7684","text":"<p>DRAM \u5206\u6210\u5f88\u591a\u5c42\u6b21\uff1aBank Group\uff0cBank\uff0cRow\uff0cColumn\uff0c\u4ece\u5927\u5230\u5c0f\uff0c\u5bb9\u91cf\u4e5f\u662f\u5404\u7ea7\u522b\u7684\u4e58\u79ef\u3002</p> <p>\u4e3e\u4f8b\u5b50\uff1a</p> <ul> <li>4 Bank Group</li> <li>4 Bank per Bank Group</li> <li>32,768 Row per Bank</li> <li>1024 Column per Row</li> <li>4 Bits per Column</li> </ul> <p>\u90a3\u4e48\u603b\u5927\u5c0f\u5c31\u662f <code>4*4*32768*1024*4=2 Gb</code>\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u8bbf\u95ee\u6a21\u5f0f","title":"\u8bbf\u95ee\u6a21\u5f0f","text":"<p>DRAM \u7684\u8bbf\u95ee\u6a21\u5f0f\u51b3\u5b9a\u4e86\u8bbf\u95ee\u5185\u5b58\u7684\u5b9e\u9645\u5e26\u5bbd\u3002\u5bf9\u4e8e\u6bcf\u6b21\u8bbf\u95ee\uff0c\u9700\u8981\u8fd9\u6837\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>\u7528 ACT(Bank Activate) \u547d\u4ee4\u6253\u5f00\u67d0\u4e2a Bank Group \u4e0b\u9762\u7684\u67d0\u4e2a Bank \u7684\u67d0\u4e2a Row\uff0c\u6b64\u65f6\u6574\u4e2a Row \u7684\u6570\u636e\u90fd\u4f1a\u590d\u5236\u5230 Sense Amplifier \u4e2d\u3002\u8fd9\u4e00\u6b65\u53eb\u505a RAS\uff08Row Address Strobe\uff09</li> <li>\u7528 RD(Read)/WR(Write) \u547d\u4ee4\u6309\u7167 Column \u8bbf\u95ee\u6570\u636e\u3002\u8fd9\u4e00\u6b65\u53eb\u505a CAS\uff08Column Address Strobe\uff09\u3002</li> <li>\u5728\u8bbf\u95ee\u5176\u4ed6 Row \u4e4b\u524d\uff0c\u9700\u8981\u7528 PRE(Single Bank Precharge) \u547d\u4ee4\u5c06 Sense Amplifier \u4e2d\u6574\u4e2a Row \u7684\u6570\u636e\u5199\u56de Row \u4e2d\u3002</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u8bbf\u95ee\u8fde\u7eed\u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u7701\u4e0b ACT \u547d\u4ee4\u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u8fde\u7eed\u7684\u8fdb\u884c RD/WR \u547d\u4ee4\u64cd\u4f5c\u3002</p> <p>\u9664\u4e86\u663e\u5f0f PRE \u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728\u67d0\u6b21\u8bfb\u5199\u4e4b\u540e\u81ea\u52a8\u8fdb\u884c PRE\uff1aWRA(Write with Auto-Precharge) \u548c RDA(Read with Auto-Precharge)\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\u4e0a\u9762\u63d0\u5230\u7684\u516d\u79cd\u547d\u4ee4\uff1a</p> <ol> <li>ACT: Bank Activate\uff0c\u6fc0\u6d3b\u4e00\u4e2a Row\uff0c\u7528\u4e8e\u63a5\u4e0b\u6765\u7684\u8bbf\u95ee</li> <li>PRE: Single Bank Precharge\uff0c\u4e0e ACT \u662f\u9006\u64cd\u4f5c\uff0c\u89e3\u9664 Row \u7684\u6fc0\u6d3b\u72b6\u6001</li> <li>RD: Read\uff0c\u8bfb\u53d6\u5f53\u524d Row \u7684\u67d0\u4e2a Column \u6570\u636e</li> <li>RDA: Read with Auto-Precharge\uff0c\u8bfb\u53d6\u540e\u6267\u884c Precharge</li> <li>WR: Write\uff0c\u5199\u5165\u5f53\u524d Row \u7684\u67d0\u4e2a Column \u6570\u636e</li> <li>WRA: Write with Auto-Precharge\uff0c\u5199\u5165\u540e\u6267\u884c Precharge</li> </ol> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5e38\u7528\u547d\u4ee4\uff1a</p> <ol> <li>REF: Refresh\uff0c\u9700\u8981\u5b9a\u671f\u6267\u884c\uff0c\u4fdd\u8bc1 DRAM \u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002</li> </ol>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u53c2\u6570","title":"\u53c2\u6570","text":"<p>DRAM \u6709\u5f88\u591a\u53c2\u6570\uff0c\u4ee5\u670d\u52a1\u5668\u4e0a\u7684\u5185\u5b58 MTA36ASF2G72PZ-2G3A3 \u4e3a\u4f8b\u5b50\uff1a</p> <ul> <li>16GB \u5bb9\u91cf\uff0cDDR4 SDRAM RDIMM</li> <li>PC4-2400</li> <li>Row address: 64K A[15:0]</li> <li>Column address: 1K A[9:0]</li> <li>Device bank group address: 4 BG[1:0]</li> <li>Device bank address per group: 4 BA[1:0]</li> <li>Device configuration: 4Gb (1Gig x 4), 16 banks</li> <li>Module rank address: 2 CS_n[1:0]</li> <li>Configuration: 2Gig x 72</li> <li>Module Bandwidth: 19.2 GB/s=2400 MT/s * 8B/T</li> <li>Memory Clock: 0.83ns(1200 MHz)</li> <li>Data Rate: 2400 MT/s</li> <li>Clock Cycles: CL-nRCD-nRP = 17-17-17</li> </ul> <p>\u5bb9\u91cf\uff1a\u6bcf\u4e2a DRAM \u9897\u7c92 <code>64K*1K*4*4*4=4Gb</code>\uff0c\u4e0d\u8003\u8651 ECC\uff0c\u4e00\u5171\u6709 <code>16*2=32</code> \u4e2a\u8fd9\u6837\u7684\u9897\u7c92\uff0c\u5b9e\u9645\u5bb9\u91cf\u662f 16 GB\u300232 \u4e2a\u9897\u7c92\u5206\u4e3a\u4e24\u7ec4\uff0c\u6bcf\u7ec4 16 \u4e2a\u9897\u7c92\uff0c\u4e24\u7ec4\u4e4b\u95f4\u901a\u8fc7 CS_n \u7247\u9009\u4fe1\u53f7\u533a\u5206\u3002\u6bcf\u7ec4 16 \u4e2a\u9897\u7c92\uff0c\u6bcf\u4e2a\u9897\u7c92 4 \u4f4d DQ \u6570\u636e\u4fe1\u53f7\uff0c\u5408\u5e76\u8d77\u6765\u5c31\u662f 64 \u4f4d\uff0c\u5982\u679c\u8003\u8651 ECC \u5c31\u662f 72 \u4f4d\u3002</p> <p>\u518d\u4e3e\u4e00\u4e2a FPGA \u5f00\u53d1\u677f\u4e0a\u5185\u5b58\u7684\u4f8b\u5b50\uff1aMT40A512M16LY-075E\uff0c\u53c2\u6570\u5982\u4e0b\uff1a</p> <ol> <li>Data Rate: 2666 MT/s, Clock Frequency: 1333 MHz, tCK=0.750ns=750ps</li> <li>Target CL-nRCD-nRP: 18-18-18</li> <li>tAA(Internal READ command to first data)=<code>13.50ns(=18*0.750)</code></li> <li>tRCD(ACTIVATE to internal READ or WRITE delay time)=<code>13.50ns(=18*0.750)</code></li> <li>tRP(PRECHARGE command period)=<code>13.50ns(=18*0.750)</code></li> <li>tRAS(ACTIVATE-to-PRECHARGE command period)=32ns</li> <li>512 Meg x 16</li> <li>Number of bank groups: 2</li> <li>Bank count per group: 4</li> <li>Row addressing: 64K</li> <li>Column addressing: 1K</li> <li>Page size: 2KB=2K*16b</li> </ol> <p>\u603b\u5927\u5c0f\uff1a<code>2*4*64K*1K*16=1GB</code>\u3002\u8fd9\u4e2a\u5f00\u53d1\u677f\u7528\u4e86 5 \u4e2a DRAM \u82af\u7247\uff0c\u53ea\u91c7\u7528\u4e86\u5176\u4e2d\u7684 4.5 \u4e2a\u82af\u7247\uff1a\u6700\u540e\u4e00\u4e2a\u82af\u7247\u53ea\u7528\u4e86 8 \u4f4d\u6570\u636e\uff0c\u8fd9\u6837\u5c31\u662f <code>4.5*16=72</code> \u4f4d\u7684\u6570\u636e\u7ebf\uff0c\u5bf9\u5e94 64 \u4f4d+ECC\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u65f6\u5e8f","title":"\u65f6\u5e8f","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u7684 DRAM Datasheet \u91cc\u63d0\u5230\u4e86\u4e09\u4e2a\u65f6\u5e8f\u53c2\u6570\uff1a</p> <ol> <li>CL=17: CAS Latency\uff0c\u4ece\u53d1\u9001\u8bfb\u8bf7\u6c42\u5230\u7b2c\u4e00\u4e2a\u6570\u636e\u7684\u5ef6\u8fdf\u5468\u671f\u6570</li> <li>RCD=17: ACT to internal read or write delay time\uff0c\u8868\u793a\u4ece ACT \u5230\u8bfb/\u5199\u9700\u8981\u7684\u5ef6\u8fdf\u5468\u671f\u6570</li> <li>RP=17: Row Precharge Time\uff0c\u8868\u793a Precharge \u540e\u9700\u8981\u5ef6\u8fdf\u5468\u671f\u6570</li> </ol> <p>\u5982\u679c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u4e00\u4e2a Row \u4e2d\u7684\u6570\u636e\uff0c\u5e76\u4e14\u4e4b\u524d\u6ca1\u6709\u5df2\u7ecf\u6253\u5f00\u7684 Row\uff0c\u90a3\u4e48\u8981\u6267\u884c ACT \u548c RD \u547d\u4ee4\uff0c\u9700\u8981\u7684\u5468\u671f\u6570\u662f RCD+CL\uff1b\u5982\u679c\u4e4b\u524d\u5df2\u7ecf\u6709\u6253\u5f00\u4e86\u7684 Row\uff0c\u90a3\u4e48\u8981\u6267\u884c PRE\uff0cACT \u548c RD \u547d\u4ee4\uff0c\u9700\u8981\u7684\u5468\u671f\u6570\u662f RP+RCD+CL\u3002\u4f46\u5982\u679c\u662f\u8fde\u7eed\u8bbf\u95ee\uff0c\u867d\u7136\u8fd8\u9700\u8981 CL \u7684\u5ef6\u8fdf\uff0c\u4f46\u662f\u53ef\u4ee5\u6d41\u6c34\u7ebf\u8d77\u6765\uff0c\u5145\u5206\u5229\u7528 DDR \u7684\u5e26\u5bbd\u3002</p> <p>\u5982\u679c\u628a\u8fd9\u4e2a\u6362\u7b97\u5230 CPU \u89d2\u5ea6\u7684\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u7684\u8bdd\uff0c\u5982\u679c\u6bcf\u6b21\u8bbf\u95ee\u90fd\u662f\u6700\u574f\u60c5\u51b5\uff0c\u90a3\u4e48\u9700\u8981 17+17+17=51 \u4e2a DRAM \u65f6\u949f\u5468\u671f\uff0c\u8003\u8651 DRAM \u65f6\u949f\u662f 1200MHz\uff0c\u90a3\u5c31\u662f 42.5ns\uff0c\u8fd9\u4e2a\u76f8\u5f53\u4e8e\u662f DRAM \u5185\u90e8\u7684\u5ef6\u8fdf\uff0c\u5b9e\u9645\u4e0a\u6d4b\u5f97\u7684\u662f 100ns \u5de6\u53f3\u3002</p> <p>\u66f4\u4e25\u683c\u6765\u8bf4\uff0c\u8bfb\u5ef6\u8fdf READ Latency = AL + CL + PL\uff0c\u5176\u4e2d AL \u548c PL \u662f\u53ef\u4ee5\u914d\u7f6e\u7684\uff0cCL \u662f\u56fa\u6709\u7684\uff0c\u6240\u4ee5\u7b80\u5355\u53ef\u4ee5\u8ba4\u4e3a READ Latency = CL\u3002\u540c\u7406 WRITE Latency = AL + CWL + PL\uff0c\u53ef\u4ee5\u7b80\u5355\u8ba4\u4e3a WRITE Latency = CWL\u3002CWL \u4e5f\u662f\u53ef\u4ee5\u914d\u7f6e\u7684\uff0c\u4e0d\u540c\u7684 DDR \u901f\u7387\u5bf9\u5e94\u4e0d\u540c\u7684 CWL\uff0c\u8303\u56f4\u4ece 1600 MT/s \u7684 CWL=9 \u5230 3200 MT/s \u7684 CWL=20\uff0c\u5177\u4f53\u89c1 JESD79-4B \u6807\u51c6\u7684 Table 7 CWL (CAS Write Latency)\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u6ce2\u5f62","title":"\u6ce2\u5f62","text":"<p>\u7528 Micron \u63d0\u4f9b\u7684 Verilog Model \u8fdb\u884c\u4eff\u771f\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u6ce2\u5f62\u56fe\uff1a</p> <p></p> <p>\u9996\u5148\u770b\u7b2c\u4e00\u4e2a\u547d\u4ee4\uff0cACT_n=0, ADDR=0x009C, CAS_n_A15=0, CKE=1-&gt;1, CS_n=0, RAS_n_A16=0, WE_n_A14=1\uff0c\u67e5\u9605\u6807\u51c6\u53ef\u77e5\u8fd9\u662f ACT(Bank Activate) \u547d\u4ee4\u3002\u63a5\u7740\u7b2c\u4e8c\u4e2a\u547d\u4ee4\uff0cACT_n=1, ADDR=0x0400, CAS_n_A15=0, CKE=1-&gt;1, CS_n=0, RAS_n_A16=1, WE_n_A14=1, A10=1, \u8fd9\u662f RDA(Read with Auto Precharge) \u547d\u4ee4\u3002\u82e5\u5e72\u4e2a\u5468\u671f\u540e\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u4ece DQ \u4e0a\u8f93\u51fa\uff0c\u4e00\u5171 8 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u5237\u65b0","title":"\u5237\u65b0","text":"<p>DRAM \u7684\u4e00\u4e2a\u7279\u70b9\u662f\u9700\u8981\u5b9a\u671f\u5237\u65b0\u3002\u6709\u4e00\u4e2a\u53c2\u6570 tREFI\uff0c\u8868\u793a\u5237\u65b0\u7684\u65f6\u95f4\u5468\u671f\uff0c\u8fd9\u4e2a\u503c\u901a\u5e38\u662f 7.8us\uff0c\u5728\u6e29\u5ea6\u5927\u4e8e 85 \u6444\u6c0f\u5ea6\u65f6\u662f 3.9 us\uff08\u89c1 JESD79-4B Table 131\uff09\u3002\u5728\u5237\u65b0\u4e4b\u524d\uff0c\u6240\u6709\u7684 bank \u90fd\u9700\u8981 Precharge \u5b8c\u6210\u5e76\u7b49\u5f85 RP \u7684\u65f6\u95f4\uff0c\u8fd9\u65f6\u5019\u6240\u6709\u7684 Bank \u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u518d\u6267\u884c REF(Refresh) \u547d\u4ee4\u3002\u7b49\u5f85 tRFC(Refresh Cycle) \u65f6\u95f4\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u6027\u80fd\uff0cDDR4 \u6807\u51c6\u5141\u8bb8\u63a8\u8fdf\u4e00\u5b9a\u6b21\u6570\u7684\u5237\u65b0\uff0c\u4f46\u662f\u8981\u5728\u4e4b\u540e\u8865\u5145\uff0c\u4fdd\u8bc1\u5e73\u5747\u4e0b\u6765\u4f9d\u7136\u6ee1\u8db3\u6bcf\u8fc7 tREFI \u65f6\u95f4\u81f3\u5c11\u4e00\u6b21\u5237\u65b0\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u5730\u5740\u6620\u5c04","title":"\u5730\u5740\u6620\u5c04","text":"<p>\u5982\u679c\u7814\u7a76 DRAM \u5185\u5b58\u63a7\u5236\u5668\uff0c\u6bd4\u5982 FPGA \u4e0a\u7684 MIG\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u7684\u5730\u5740\u6620\u5c04\u65b9\u5f0f\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>ROW_COLUMN_BANK</li> <li>ROW_BANK_COLUMN</li> <li>BANK_ROW_COLUMN</li> <li>ROW_COLUMN_LRANK_BANK</li> <li>ROW_LRANK_COLUMN_BANK</li> <li>ROW_COLUMN_BANK_INTLV</li> </ul> <p>\u5c31\u662f\u5c06\u5730\u5740\u7684\u4e0d\u540c\u90e8\u5206\u6620\u5c04\u5230 DRAM \u7684\u51e0\u4e2a\u5730\u5740\uff1aRow\uff0cColumn\uff0cBank\u3002\u53ef\u4ee5\u60f3\u8c61\uff0c\u4e0d\u540c\u7684\u5730\u5740\u6620\u5c04\u65b9\u5f0f\u9488\u5bf9\u4e0d\u540c\u7684\u8bbf\u5b58\u6a21\u5f0f\u4f1a\u6709\u4e0d\u540c\u7684\u6027\u80fd\u3002\u5bf9\u4e8e\u8fde\u7eed\u7684\u5185\u5b58\u8bbf\u95ee\uff0cROW_COLUMN_BANK \u65b9\u5f0f\u662f\u6bd4\u8f83\u9002\u5408\u7684\uff0c\u56e0\u4e3a\u8fde\u7eed\u7684\u8bbf\u95ee\u4f1a\u5206\u5e03\u5230\u4e0d\u540c\u7684 Bank \u4e0a\uff0c\u8fd9\u6837\u6027\u80fd\u5c31\u4f1a\u66f4\u597d\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u8bbf\u95ee\u4f1a\u8fde\u7eed\u547d\u4e2d\u540c\u4e00\u4e2a Page\uff0c\u90a3\u4e48\u76f4\u63a5\u8bfb\u5199\u5373\u53ef\uff1b\u53cd\u4e4b\u5982\u679c\u6bcf\u6b21\u8bfb\u5199\u51e0\u4e4e\u90fd\u4e0d\u4f1a\u547d\u4e2d\u540c\u4e00\u4e2a Page\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e Auto Precharge\uff0c\u5373\u8bfb\u5199\u4ee5\u540e\u81ea\u52a8 Precharge\uff0c\u51cf\u5c11\u4e86\u4e0b\u4e00\u6b21\u8bbf\u95ee\u524d\u56e0\u4e3a Row \u4e0d\u540c\u5bfc\u81f4\u7684 PRE \u547d\u4ee4\u3002\u4e00\u4e2a\u601d\u8def\u662f\u5728\u5bf9\u6bcf\u4e2a Page \u7684\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u91c7\u7528 Auto Precharge\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u4f20\u8f93\u901f\u7387","title":"\u4f20\u8f93\u901f\u7387","text":"<p>DDR SDRAM \u7684\u4f20\u8f93\u901f\u7387\u8ba1\u7b97\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>Memory Speed (MT/s) * 64 (bits/transfer)\n</code></pre> <p>\u4f8b\u5982\u4e00\u4e2a DDR4-3200 \u7684\u5185\u5b58\uff0c\u5e26\u5bbd\u5c31\u662f <code>3200 * 64 = 204.8 Gb/s = 25.6 GB/s</code>\u3002\u4f46\u524d\u9762\u5df2\u7ecf\u770b\u5230\uff0c\u9664\u4e86\u4f20\u8f93\u6570\u636e\uff0c\u8fd8\u9700\u8981\u8fdb\u884c\u5f88\u591a\u547d\u4ee4\uff0c\u5b9e\u9645\u4e0a\u5f88\u96be\u8fbe\u5230 100% \u7684\u5e26\u5bbd\u3002\u7136\u540e CPU \u53ef\u4ee5\u8fde\u63a5\u591a\u4e2a channel \u7684 DRAM\uff0c\u518d\u8003\u8651\u591a\u4e2a CPU Socket\uff0c\u7cfb\u7edf\u7684\u603b\u5e26\u5bbd\u5c31\u662f</p> <pre><code>Memory Speed (MT/s) * 64 (bits/transfer) * Channels * Sockets\n</code></pre> <p>\u4f7f\u7528 MLC \u7b49\u5de5\u5177\u8fdb\u884c\u6d4b\u8bd5\uff0c\u8ba1\u7b97\u5b9e\u9645\u4e0e\u7406\u8bba\u7684\u6bd4\u503c\uff0c\u6211\u6d4b\u8bd5\u5f97\u5230\u7684\u5927\u6982\u5728 70%-90% \u4e4b\u95f4\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#hbm","title":"HBM","text":"<p>HBM \u76f8\u6bd4\u524d\u9762\u7684 DDR SDRAM\uff0c\u5b83\u5806\u53e0\u4e86\u591a\u4e2a DRAM\uff0c\u63d0\u4f9b\u591a\u4e2a channel \u5e76\u4e14\u63d0\u9ad8\u4e86\u4f4d\u5bbd\u3002\u4f8b\u5982 Micron HBM with ECC\uff0c\u5806\u53e0\u4e86 4/8 \u5c42 DRAM\uff0c\u63d0\u4f9b 8 \u4e2a channel\uff0c\u6bcf\u4e2a channel \u7684\u6570\u636e\u5bbd\u5ea6\u662f 128 \u4f4d\uff0c\u4ee5 3200 MT/s \u8ba1\u7b97\uff0c\u4e00\u4e2a HBM \u82af\u7247\u7684\u4f20\u8f93\u901f\u7387\u6700\u5927\u662f\uff1a</p> <pre><code>3200 (MT/s) * 128 (bits/transfer) * 8 (Channels) = 3276.8 Gb/s = 409.6 GB/s\n</code></pre> <p>\u6240\u4ee5\u4e00\u7247 HBM \u7684\u4f20\u8f93\u901f\u7387\u5c31\u76f8\u5f53\u4e8e 16 \u4e2a\u4f20\u7edf\u7684 DDR SDRAM\uff1a8 \u4e2a Channel \u52a0\u53cc\u500d\u7684\u4f4d\u5bbd\u3002128 \u4f4d\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u4e24\u7247 64-bit DDR SDRAM \u5e76\u8d77\u6765\u4e86\uff0c\u53ef\u4ee5\u5f53\u6210\u4e00\u4e2a 128 \u4f4d\u7684\u7528\uff0c\u4e5f\u53ef\u4ee5\u5728 Pseudo Channel \u6a21\u5f0f\u4e0b\uff0c\u5f53\u6210\u5171\u4eab\u5730\u5740\u548c\u547d\u4ee4\u4fe1\u53f7\u7684\u4e24\u4e2a DDR SDRAM \u7528\u3002</p> <p>Xilinx \u7684 Virtex Ultrascale Plus HBM FPGA \u63d0\u4f9b\u4e86 <code>1800 (MT/s) * 128 (bits/transfer) * 8 (Channels) = 230.4 GB/s</code> \u7684\u5e26\u5bbd\uff0c\u5982\u679c\u7528\u4e86\u4e24\u7247 HBM \u5c31\u662f 460.8 GB/s\u3002\u66b4\u9732\u7ed9 FPGA \u903b\u8f91\u7684\u662f 16 \u4e2a 256 \u4f4d\u7684 AXI3 \u7aef\u53e3\uff0cAXI \u9891\u7387 450 MHz\uff0c\u5185\u5b58\u9891\u7387 900 MHz\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2a AXI3 \u5c31\u5bf9\u5e94\u4e86\u4e00\u4e2a HBM \u7684 pseudo channel\u3002\u6bcf\u4e2a pseudo channel \u662f 64 \u4f4d\uff0c\u4f46\u662f AXI \u7aef\u53e3\u662f 256 \u4f4d\uff1a\u5728\u901f\u7387\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u4ece 450MHz \u5230 900MHz\uff0c\u518d\u52a0\u4e0a DDR\uff0c\u76f8\u5f53\u4e8e\u9891\u7387\u7ffb\u4e86\u56db\u500d\uff0c\u6240\u4ee5\u4f4d\u5bbd\u8981\u4ece 64 \u4f4d\u7ffb\u56db\u500d\u5230 256 \u4f4d\u3002</p> <p>\u5f53\u7136\u4e86\uff0cHBM \u7684\u9ad8\u5e26\u5bbd\u7684\u4ee3\u4ef7\u5c31\u662f\u5f15\u811a\u6570\u91cf\u5f88\u591a\u3002\u6839\u636e HBM3 JESD238A\uff0c\u6bcf\u4e2a Channel \u8981 120 \u4e2a pin\uff0c\u4e00\u5171 16 \u4e2a channel\uff08HBM2 \u662f 8 channel\uff0c\u6bcf\u4e2a channel 128 \u4f4d\uff1bHBM3 \u662f 16 channel\uff0c\u6bcf\u4e2a channel 64 \u4f4d\uff09\uff0c\u7136\u540e\u8fd8\u6709\u5176\u4ed6\u7684 52 \u4e2a pin\uff0c\u8fd9\u4e9b\u52a0\u8d77\u6765\u5c31 1972 \u4e2a pin \u4e86\u3002\u6240\u4ee5\u4e00\u822c\u5728 Silicon Interposer \u4e0a\u8fde\u63a5\uff0c\u800c\u4e0d\u662f\u4f20\u7edf\u7684\u5728 PCB \u4e0a\u8d70\u7ebf\uff08\u56fe\u6e90 A 1.2V 20nm 307GB/s HBM DRAM with At-Speed Wafer-Level I/O Test Scheme and Adaptive Refresh Considering Temperature Distribution\uff09\uff1a</p> <p></p> <p>\u6240\u4ee5\u5728 HBM3 \u6807\u51c6\u91cc\uff0c\u7528 Microbump \u6765\u63cf\u8ff0 HBM \u7684 pin\u3002</p> <p>\u53ef\u4ee5\u7406\u89e3\u4e3a\u628a\u539f\u6765\u63d2\u5728\u4e3b\u677f\u4e0a\u7684\u5185\u5b58\u6761\uff0c\u901a\u8fc7\u5806\u53e0\uff0c\u53d8\u6210\u4e00\u4e2a HBM Die\uff0c\u7136\u540e\u7d27\u5bc6\u5730\u8fde\u63a5\u5230 CPU \u4e2d\u3002\u4f46\u662f\u53e6\u4e00\u65b9\u9762\uff0c\u5bc6\u5ea6\u4e0a\u53bb\u4e86\uff0c\u4ef7\u683c\u4e5f\u66f4\u8d35\u4e86\u3002</p> <p>A100 \u663e\u5361 40GB PCIe \u7248\u672c\u63d0\u4f9b\u4e86 1555 GB/s \u7684\u5185\u5b58\u5e26\u5bbd\u3002\u6839\u636e\u500d\u6570\u5173\u7cfb\uff0c\u53ef\u4ee5\u731c\u6d4b\u662f 5 \u4e2a 8GB \u7684 HBM\uff0c\u6bcf\u4e2a\u63d0\u4f9b <code>1555 / 5 = 311 GB/s</code> \u7684\u5e26\u5bbd\uff0c\u90a3\u4e48\u65f6\u949f\u9891\u7387\u5c31\u662f <code>311 (GB/s) * 8 (bits/byte) / 128 (bits/transfer) / 8 (channels) / 2 (DDR) = 1215 MHz</code>\uff0c\u8fd9\u4e0e <code>nvidia-smi -q</code> \u770b\u5230\u7684\u7ed3\u679c\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u8fdb\u4e00\u6b65\uff0cA100 80GB PCIe \u7248\u672c\u63d0\u4f9b\u4e86 1935 GB/s \u7684\u5e26\u5bbd\uff0c\u6309\u7167\u540c\u6837\u7684\u65b9\u6cd5\u8ba1\u7b97\uff0c\u53ef\u5f97\u65f6\u949f\u9891\u7387\u662f <code>1935 (GB/s) / 5 * 8 (bits/byte) / 128 (bits/transfer) / 8 (channels) / 2(DDR) = 1512 MHz</code>\uff0c\u4e0e Product Brief \u4e00\u81f4\u3002\u9891\u7387\u7684\u63d0\u9ad8\u662f\u56e0\u4e3a\u4ece HBM2 \u5347\u7ea7\u5230\u4e86 HBM2e\u3002</p> <p>A100 \u6587\u6863\u4e2d\u7684 Memory bus width 5120 \u7684\u8ba1\u7b97\u65b9\u5f0f\u4e5f\u5c31\u6e05\u695a\u4e86\uff1a<code>128 (bits/transfer) * 8 (channels) * 5 (stacks) = 5120 (bits)</code>\u3002</p> <p>H100 SXM5 \u5347\u7ea7\u5230\u4e86 HBM3\uff0c\u5185\u5b58\u5bb9\u91cf\u4f9d\u7136\u662f 80GB\uff0c\u4f46\u662f\u65f6\u949f\u9891\u7387\u63d0\u9ad8\uff0c\u5185\u5b58\u5e26\u5bbd\u662f <code>2619 (MHz) * 2 (DDR) * 128 (bits/transfer) * 8 (channels) * 5 (stacks) / 8 (bits/byte) = 3352 GB/s</code>\u3002</p>","tags":["dram","ddr","teaching"]},{"location":"hardware/2021/12/12/dram/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Memory systems: Cache, DRAM &amp; Disk</li> <li>\u8bd1\u6587\uff1aDDR4 SDRAM - Understanding the Basics\uff08\u4e0a\uff09</li> <li>\u8bd1\u6587\uff1aDDR4 SDRAM - Understanding the Basics\uff08\u4e0b\uff09</li> <li>JEDEC STANDARD DDR5 SDRAM JESD79-5</li> <li>JEDEC STANDARD DDR4 SDRAM JESD79-4B</li> <li>JEDEC STANDARD DDR3 SDRAM JESD79-3E</li> </ul>","tags":["dram","ddr","teaching"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/","title":"\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u9010\u6e10\u63a5\u89e6\u5230\u4e86\u4e00\u4e9b\u9ad8\u901f\u7684\u4ee5\u592a\u7f51\u7684\u63a5\u53e3\uff0c\u88ab\u4e00\u5927\u5806\u7684\u540d\u5b57\u641e\u5f97\u6709\u70b9\u61f5\uff0c\u6240\u4ee5\u7279\u610f\u5b66\u4e60\u4e86\u4e00\u4e0b\u5e76\u6574\u7406\u6210\u8fd9\u7bc7\u535a\u5ba2\u3002</p> <p>\u66f4\u65b0\uff1a\u7ecf @z4yx \u6307\u51fa\uff0c\u8fd8\u53ef\u4ee5\u770b\u534e\u4e3a\u7684\u4ecb\u7ecd\u6587\u6863</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u51e0\u51e0-base-\u6760\u4ec0\u4e48\u662f\u4ec0\u4e48\u610f\u601d","title":"\u51e0\u51e0 BASE \u6760\u4ec0\u4e48\u662f\u4ec0\u4e48\u610f\u601d","text":"<p>\u5728\u4e0b\u6587\u91cc\uff0c\u7ecf\u5e38\u53ef\u4ee5\u770b\u5230\u7c7b\u4f3c 100BASE-TX \u8fd9\u79cd\u5199\u6cd5\uff0c\u5b83\u8868\u793a\u7684\u610f\u601d\u662f\uff1a</p> <ol> <li>BASE \u524d\u9762\u7684\u6570\u5b57\u8868\u793a\u901f\u7387\uff0c\u6bd4\u5982 10\uff0c100\uff0c1000\uff0c10G \u7b49\u7b49</li> <li>BASE \u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\uff0c\u5e38\u89c1\u7684 T \u8868\u793a\u53cc\u7ede\u7ebf\uff0cS \u8868\u793a 850nm \u5149\u7ea4\uff0cL \u8868\u793a 1310nm \u5149\u7ea4\uff0cC \u8868\u793a\u540c\u8f74\u7535\u7f06</li> <li>\u4e4b\u540e\u53ef\u80fd\u8fd8\u6709\u522b\u7684\u5b57\u6bcd\uff0c\u6bd4\u5982 X \u8868\u793a 8b/10b \u6216\u8005 4b/5b\uff08FE\uff09\u7684\u7f16\u7801\uff0cR \u8868\u793a 64b/66b \u7684\u7f16\u7801</li> <li>\u4e4b\u540e\u53ef\u80fd\u8fd8\u6709\u522b\u7684\u6570\u5b57\uff0c\u5982\u679c\u662f LAN PHY \u8868\u793a\u7684\u662f\u6240\u4f7f\u7528\u7684 lane \u6570\u91cf\uff1b\u5982\u679c\u662f WAN PHY \u8868\u793a\u7684\u662f\u4f20\u8f93\u7684\u516c\u91cc\u6570</li> </ol> <p>\u8be6\u89c1 Wikipedia - Ethernet Physical Layer # Naming Conventions \u548c IEEE 802.3 1.2.3 \u8282 Physical Layer and media notation\uff1a</p> <pre><code>The data rate, if only a number, is in Mb/s, and if suffixed by a \u201cG\u201d, is in\nGb/s. The modulation type (e.g., BASE) indicates how encoded data is\ntransmitted on the medium. The additional distinction may identify\ncharacteristics of transmission or medium and, in some cases, the type of PCS\nencoding used (examples of additional distinctions are \u201cT\u201d for twisted pair,\n\u201cB\u201d for bidirectional optics, and \u201cX\u201d for a block PCS coding used for that\nspeed of operation). Expansions for defined Physical Layer types are included\nin 1.4.\n</code></pre> <p>\u548c IEEE 802.3 1.4 \u8282 Definitions \u4e2d\u7684\u51e0\u4e2a\u4f8b\u5b50\uff1a</p> <ul> <li>100BASE-T: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network. (See IEEE Std 802.3, Clause 22 and Clause 28.)</li> <li>100BASE-TX: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network over two pairs of Category 5 twisted-pair cabling. (See IEEE Std 802.3, Clause 24 and Clause 25.)</li> <li>1000BASE-T: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN using four pairs of Category 5 balanced copper cabling. (See IEEE Std 802.3, Clause 40.)</li> <li>1000BASE-X: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN that uses a Physical Layer derived from ANSI X3.230-1994 (FC-PH) [B21]23. (See IEEE Std 802.3, Clause 36.)</li> <li>2.5GBASE-T: IEEE 802.3 Physical Layer specification for a 2.5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>5GBASE-T: IEEE 802.3 Physical Layer specification for a 5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>10GBASE-T: IEEE 802.3 Physical Layer specification for a 10 Gb/s LAN using four pairs of Class E or Class F balanced copper cabling. (See IEEE Std 802.3, Clause 55.)</li> </ul>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u5404\u4e2a\u901f\u7387\u5bf9\u5e94\u7684\u82f1\u6587\u5355\u8bcd\u662f\u4ec0\u4e48","title":"\u5404\u4e2a\u901f\u7387\u5bf9\u5e94\u7684\u82f1\u6587\u5355\u8bcd\u662f\u4ec0\u4e48","text":"<ul> <li>Fast Ethernet: 100Mbps</li> <li>Gigabit Ethernet: 1Gbps</li> <li>Multi Gigabit Ethernet: 2.5Gbps</li> <li>Ten Gigabit Ethernet: 10Gbps</li> <li>Forty Gigabit Ethernet: 40Gbps</li> <li>Hundred Gigabit Ethernet: 100Gbps</li> </ul>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u5e38\u89c1\u7684\u8fde\u63a5\u5668","title":"\u5e38\u89c1\u7684\u8fde\u63a5\u5668","text":"<p>\u8fde\u63a5\u5668\uff08connector\uff09\u4e00\u822c\u6765\u8bf4\u6307\u7684\u5c31\u662f\u7ebf\u7f06\u548c\u7f51\u7edc\u8bbe\u5907\u4e4b\u95f4\u7684\u7269\u7406\u63a5\u53e3\u4e86\u3002\u5e38\u89c1\u7684\u6709\uff1a</p> <ul> <li>8P8C\uff1a\u4e00\u822c\u6211\u4eec\u4f1a\u79f0\u4e4b\u4e3a RJ45\uff0c\u5173\u4e8e\u5b83\u4eec\u4fe9\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u770b Wikipedia \u4e0a\u9762\u7684\u8bf4\u660e\uff0c\u4e0d\u8fc7\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u8fd9\u4e24\u4e2a\u6df7\u7528\u5176\u5b9e\u4e5f\u6ca1\u6709\u4ec0\u4e48\u5927\u95ee\u9898</li> <li>LC\uff1a\u4e00\u79cd\u5149\u7ea4\u7684\u63a5\u53e3\uff0c\u6709\u4e24\u4e2a\u7a81\u51fa\u6765\u7684\u63d2\u5230 SFP \u5149\u6a21\u5757\u4e2d\u7684\u7a81\u8d77\uff0c\u6bd4\u8f83\u5e38\u89c1</li> <li>SFP+ DAC\uff1a\u4e00\u822c\u662f DAC\uff08Direct Attatched Cable\uff09\u7ebf\uff0c\u7ebf\u7684\u4e24\u7aef\u76f4\u63a5\u5c31\u662f SFP+ \u7684\u63a5\u53e3\uff0c\u76f4\u63a5\u63d2\u5230 SFP+ \u7b3c\u5b50\u4e2d\uff0c\u4e0d\u9700\u8981\u5149\u6a21\u5757\uff1b\u66f4\u9ad8\u901f\u7387\u7684\u4e5f\u6709 DAC \u7ebf</li> </ul> <p>\u5bf9\u4e8e\u5149\u7ea4\u7684\u63a5\u53e3\uff0c\u6ce8\u610f\u8d2d\u4e70\u7684\u65f6\u5019\u8981\u548c\u5149\u6a21\u5757\u5bf9\u5e94\uff0c\u4e0d\u7136\u53ef\u80fd\u63d2\u4e0d\u8fdb\u53bb\u3002\u5e38\u89c1\u7684\u6709 LC-LC\uff0cSC-LC\uff0cSC-SC \u7b49\u7b49\uff0c\u8868\u793a\u7ebf\u7684\u4e24\u7aef\u5206\u522b\u662f\u4ec0\u4e48\u63a5\u53e3\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#mdi-\u548c-mdi-x","title":"MDI \u548c MDI-X","text":"<p>\u8fd9\u5176\u5b9e\u5c31\u662f\u5927\u5bb6\u5e38\u89c1\u7684 RJ45 \u91cc\u9762 8 \u6839\u7ebf\u5bf9\u5e94\u7684\u4fe1\u53f7\uff0c\u5728\u5341\u5146\u548c\u767e\u5146\u7684\u65f6\u5019\uff0c\u9700\u8981\u533a\u5206 MDI \u548c MDI-X\uff0c\u5728\u540c\u79cd\u7c7b\u578b\u7684\u7aef\u53e3\u4e4b\u95f4\u7528\u4ea4\u53c9\u7ebf\uff0c\u5728\u4e0d\u540c\u7c7b\u578b\u7684\u7aef\u53e3\u4e4b\u95f4\u7528\u76f4\u901a\u7ebf\u3002\u5728\u540e\u6765\uff0c\u6709\u4e86 Auto MDI-X\uff0c\u4e5f\u5c31\u662f\u4f1a\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5339\u914d\u3002\u4ece\u5343\u5146\u5f00\u59cb\uff0c\u8bbe\u5907\u90fd\u652f\u6301 Auto MDI-X \u4e86\uff0c\u6240\u4ee5\u7ebf\u672c\u8eab\u662f\u4ea4\u53c9\u8fd8\u662f\u76f4\u901a\u5c31\u65e0\u6240\u8c13\u4e86\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u5404\u79cd-sfp","title":"\u5404\u79cd SFP","text":"<p>SFP \u662f\u5f88\u5e38\u89c1\u7684\uff0c\u7279\u522b\u662f\u5728\u9ad8\u901f\u7684\u7f51\u7edc\u4e4b\u4e2d\u3002\u800c\u5b83\u53c8\u5206\u4e3a\u51e0\u79cd\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u901f\u7387\uff1a</p> <ul> <li>SFP: 1Gbps/100Mbps</li> <li>SFP+: 10Gbps</li> <li>SFP28: 25Gbps</li> <li>SFP56: 50Gbps</li> <li>QSFP: 4Gbps</li> <li>QSFP+: 40Gbps</li> <li>QSFP28: 100Gbps/50Gbps</li> <li>QSFP56: 200Gbps</li> <li>QSFP-DD: 400Gbps/200Gbps</li> <li>QSFP-DD112: 800Gbps</li> <li>OSFP: 800Gbps/400Gbps</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u540d\u5b57\u524d\u9762\u52a0\u4e86\u4e2a Q\uff08Quad\uff09\uff0c\u901f\u7387\u5c31\u7ffb\u4e86 4 \u500d\uff0c\u56e0\u4e3a\u6709 4 \u4e2a lane\uff0c\u540c\u65f6\u7269\u7406\u63a5\u53e3\u7684\u5c3a\u5bf8\u4e5f\u53d8\u5927\u4e86\u3002\u6240\u4ee5\uff0c\u4e0d\u5e26 Q \u7684 SFP \u7684\u7269\u7406\u5c3a\u5bf8\u90fd\u4e00\u6837\uff0c\u5e26 Q \u7684 SFP \u7269\u7406\u5c3a\u5bf8\u90fd\u4e00\u6837\u5927\uff0c\u4f46\u540e\u8005\u6bd4\u524d\u8005\u5927\u4e00\u4e9b\uff08SFP \u662f 113.9 mm^2\uff0cQSFP \u662f 156 mm^2\uff09\u3002OSFP \u53c8\u6bd4 QSFP \u66f4\u5927\u4e00\u4e9b\uff0cO \u8868\u793a Octal\uff0c\u5c31\u662f 8 \u4e2a lane \u7684\u610f\u601d\u3002</p> <p>\u53ef\u4ee5\u5728 400G QSFP Transceiver Types and Fiber Connections \u548c 400G OSFP Transceiver Types Overview \u770b\u5230 QSFP-DD \u548c OSFP \u7684\u5bf9\u6bd4\u3002</p> <p>\u901a\u5e38\uff0c\u7f51\u7edc\u8bbe\u5907\u4e5f\u4f1a\u652f\u6301\u628a\u4e00\u4e2a QSFP \u63a5\u53e3\u62c6\u6210\u591a\u4e2a SFP \u63a5\u53e3\u6765\u4f7f\u7528\uff0c\u6bd4\u5982\u6709\u7684\u7ebf\uff0c\u4e00\u8fb9\u662f QSFP28\uff0c\u53e6\u4e00\u8fb9\u662f 4xSFP28\uff0c\u53ea\u8981\u8bbe\u5907\u652f\u6301\u5373\u53ef\uff0c\u76ee\u7684\u662f\u8282\u7701\u7a7a\u95f4\u3002</p> <p>SFP \u6807\u51c6 SFF INF-8074 \u89c4\u5b9a\u4e86 20 \u6839\u4fe1\u53f7\u7ebf\uff0c\u6b63\u53cd\u9762\u5404 10 \u6839\uff0c\u91cd\u8981\u7684\u662f\u4e0b\u9762\u7684\u8fd9\u4e9b\uff08\u62ec\u53f7\u91cc\u5199\u5f97\u662f Pin \u7684\u7f16\u53f7\uff09\uff1a</p> <ol> <li>Mod_ABS\uff086\uff09\uff1a\u6a21\u5757\u662f\u5426\u63d2\u5165</li> <li>RD+\uff0813\uff09\u3001RD-\uff0812\uff09\uff1a\u63a5\u6536\u6570\u636e\u7684\u5dee\u5206\u5bf9</li> <li>TD+\uff0818\uff09\u3001TD-\uff0819\uff09\uff1a\u4f20\u8f93\u6570\u636e\u7684\u5dee\u5206\u5bf9</li> <li>SDA\uff084\uff09\u3001SCL\uff085\uff09\uff1a\u6a21\u5757\u7684 I2C</li> <li>Tx_Fault\uff082\uff09\u3001Tx_Disable\uff083\uff09\u3001Rx_LOS\uff088\uff09\uff1a\u4e00\u4e9b\u72b6\u6001\u4fe1\u53f7</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6536\u548c\u53d1\u5404\u6709\u4e00\u4e2a\u5dee\u5206\u5bf9\u5171 4 \u6761\u6570\u636e\u7ebf\u3002\u76f8\u5bf9\u5e94\u7684\uff0cQSFP \u6536\u548c\u53d1\u5404\u6709\u56db\u5bf9\u5dee\u5206\u5bf9\u5171 16 \u6761\u6570\u636e\u7ebf\uff0c\u4e00\u5171 38 \u6839\u7ebf\u3002\u5e76\u4e14\u6709\u4e00\u4e9b\u4fe1\u53f7\u662f\u590d\u7528\u4e86\u540c\u6837\u7684 pin\uff0c\u8fd9\u6837\u7684\u8bbe\u8ba1\u53ef\u4ee5\u8282\u7701\u4e00\u4e9b pin\uff0c\u662f\u5f88\u5e38\u89c1\u7684\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#mii","title":"MII","text":"<p>\u6709\u65f6\u5019\uff0c\u8fd8\u4f1a\u9047\u5230\u5404\u79cd MII \u63a5\u53e3\uff0c\u4e5f\u5c31\u662f MAC \u548c PHY \u4e4b\u95f4\u7684\u63a5\u53e3\u3002\u6709\u65f6\u5019\uff0c\u8fd8\u4f1a\u4f34\u968f\u7740 MDIO \u63a5\u53e3\uff0c\u6765\u8fdb\u884c\u63a7\u5236\u4fe1\u606f\u7684\u4f20\u8f93\u3002\u5b83\u53c8\u5206\u4e0d\u540c\u7684\u7c7b\u578b\uff1a</p> <ul> <li>Standard MII\uff1a\u901f\u7387\u662f 100Mbps\uff0825MHz*4\uff09\u6216\u8005 10Mbps\uff082.5Mhz*4\uff09\uff0cTX 7 \u6839\u7ebf\uff084 DATA+CLK+EN+ER\uff09\uff0cRX 7+2 \u6839\u7ebf\uff084 DATA+CLK+DV+ER+CRS+COL\uff09\uff0c\u52a0\u4e0a MDIO 2 \u6839\u7ebf\u5171 18 \u6839\u7ebf</li> <li>RMII\uff1a\u901f\u7387\u662f 100Mbps \u6216\u8005 10Mbps\uff0c\u9891\u7387\u90fd\u662f 50MHz\uff0c\u4e00\u5171 10 \u6839\u7ebf\uff084 DATA+CLK+TX_EN+CRS_DV+RX_ER+MDIO+MDC\uff09\uff0c\u6570\u636e\u7ebf\u662f TX \u548c RX \u5404 2 \u6839</li> <li>GMII\uff1a\u901f\u7387\u662f 1000Mbps\uff08125MHz*8\uff09\uff0c\u6570\u636e\u7ebf\u662f TX \u548c RX \u5404 8 \u6839\uff1b\u4e5f\u652f\u6301\u901f\u7387 100Mbps\uff0825MHz\uff09\u548c 10Mbps\uff082.5MHz\uff09</li> <li>RGMII\uff1a\u901f\u7387\u662f 1000Mbps\uff08125MHz*4*2\uff0cDDR\uff09\uff0c\u6570\u636e\u7ebf\u662f TX \u548c RX \u5404 4 \u6839\uff1b\u4e5f\u652f\u6301\u901f\u7387 100Mbps\uff0825MHz*4\uff09\u548c 10Mbps\uff082.5MHz*4\uff09\uff0c\u4e00\u5171\u662f 5+5+2 \u6839\u7ebf</li> <li>SGMII\uff1a\u901f\u7387\u662f 1000Mbps\uff08625MHz*2*8/10\uff09\uff0c\u91c7\u7528 625MHz DDR \u5dee\u5206\u5bf9 SerDes\uff0c\u91c7\u7528 8b/10b \u7684\u7f16\u7801</li> <li>XGMII\uff1a\u652f\u6301 2500Mbps/5000Mbps/10000Mbps\uff08156.25 MHz*32*2\uff0cDDR\uff09\u901f\u7387\uff0c\u6570\u636e\u7ebf\u662f TX \u548c RX \u5404 32 \u6839</li> </ul> <p>\u6709\u7684\u65f6\u5019\uff0cMAC \u548c PHY \u662f\u72ec\u7acb\u7684\uff0c\u6bd4\u5982\u5f88\u591a\u5e38\u89c1\u7684 FPGA \u5f00\u53d1\u677f\uff0c\u5728\u4f7f\u7528\u5343\u5146\u7f51\u7684\u65f6\u5019\uff0c\u5728\u677f\u5b50\u4e0a\u662f PHY \u82af\u7247\uff0c\u4ece FPGA \u5230 PHY \u901a\u8fc7 RGMII \u8fde\u63a5\uff0c\u7136\u540e PHY \u518d\u8fde\u63a5\u5230 8P8C\uff08RJ45\uff09\u7684\u8fde\u63a5\u5668\u4e0a\u3002\u4e00\u822c\u8fd8\u4f1a\u628a MDIO \u4e5f\u63a5\u5230 FPGA \u4e0a\u9762\u3002\u5982\u679c\u6709\u591a\u4e2a PHY\uff0c\u5c31\u4f1a\u5427 MDIO \u901a\u8fc7\u603b\u7ebf\u7684\u65b9\u5f0f\u5408\u5e76\u8d77\u6765\uff0c\u7ed9\u6bcf\u4e2a PHY \u914d\u7f6e\u4e0d\u540c\u7684\u5730\u5740\uff08\u4e00\u822c\u662f\u5728\u6307\u5b9a\u7684 PIN \u4e0a\u8bbe\u7f6e\u4e0a\u62c9/\u4e0b\u62c9\u7535\u963b\u5b9e\u73b0\uff09\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u51b2\u7a81\u7684\u8bbf\u95ee\u3002</p> <p>\u6269\u5c55\u9605\u8bfb\uff1aKXZ9031RNX Datasheet</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#sgmii","title":"SGMII","text":"<p>\u4e0a\u9762\u6bd4\u8f83\u5e38\u89c1\u7684\u662f GMII/RGMII/SGMII\u3002\u5176\u4e2d\u6bd4\u8f83\u7279\u6b8a\u7684\u662f SGMII\uff0c\u9996\u5148\u53ef\u4ee5\u53d1\u73b0\u5b83\u4fe1\u53f7\u5f88\u5c11\uff0c\u53ea\u6709\u4e24\u5bf9\u5dee\u5206\u7ebf TX_P TX_N RX_P RX_N\uff0c\u5176\u4e2d\u65f6\u949f\u662f\u53ef\u9009\u7684\uff0c\u56e0\u4e3a\u53ef\u4ee5\u4ece\u6570\u636e\u4e2d\u6062\u590d\u3002\u4f60\u53ef\u80fd\u611f\u5230\u5f88\u5947\u602a\uff0c\u90a3\u4e48\u5176\u4ed6\u7684\u4fe1\u53f7\uff0c\u6bd4\u5982 DV/ER/CRS \u7b49\u90fd\u53bb\u54ea\u91cc\u4e86\u5462\uff1f\u5176\u5b9e\u662f\u56e0\u4e3a\uff0cSGMII \u91c7\u7528\u4e86 8b/10b \u7684\u7f16\u7801\u7684\u540c\u65f6\uff0c\u628a\u8fd9\u4e9b\u63a7\u5236\u4fe1\u53f7\u901a\u8fc7\u4e00\u5b9a\u7684\u65b9\u5f0f\u987a\u4fbf\u7f16\u7801\u8fdb\u53bb\u4e86\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u4ece 8 \u4f4d\u7684\u6570\u636e\u4fe1\u53f7\u7f16\u7801\u4e3a 10 \u4f4d\u7684\u65f6\u5019\uff0c\u6709\u4e00\u4e9b\u7279\u6b8a\u7684 10 \u4f4d\u7b26\u53f7\u662f\u6ca1\u6709\u5bf9\u5e94 8 \u4f4d\u7684\u6570\u636e\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u7528\u8fd9\u4e9b\u7279\u6b8a\u7b26\u53f7\u6765\u8868\u793a\u4e00\u4e9b\u4fe1\u53f7\uff0c\u6bd4\u5982\u7528 SPD\uff08Start_of_Packet Delimiter\uff0c\u5bf9\u5e94 /S/\uff09\u548c EPD\uff08End_of_Packet Delimiter\uff0c\u5bf9\u5e94 /T/R/ \u7b49\uff09\u8868\u793a\u4f20\u8f93\u6570\u636e\u7684\u5f00\u59cb\u548c\u7ed3\u5c3e\uff0c\u5bf9\u5e94 TX_EN/RX_DV \u4fe1\u53f7\uff1b\u7528 Error_Propagation\uff08/V/\uff09\u8868\u793a\u9519\u8bef\uff0c\u5bf9\u5e94 RX_ER \u4fe1\u53f7\u7b49\u7b49\u3002\u6240\u4ee5\uff0cSGMII \u5176\u5b9e\u8fd8\u662f\u4e00\u4e2a GMII \u7684\u53d8\u79cd\uff0c\u53ea\u4e0d\u8fc7\u91c7\u7528 SerDes \u7684\u65b9\u5f0f\u51cf\u5c11\u4e86\u5f15\u811a\uff0cMAC \u5185\u90e8\u6216\u8005 PHY \u5185\u90e8\u4e5f\u662f\u7ecf\u8fc7\u4e00\u4e2a GMII-SGMII \u7684\u8f6c\u6362\uff0c\u800c\u5176\u4f59\u90e8\u5206\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5173\u4e8e 8b/10b \u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u53ef\u4ee5\u9605\u8bfb IEEE 802.3 \u6807\u51c6\u4e2d\u7684 <code>Table 36\u20131a\u2014Valid data code-groups</code>\uff0c\u91cc\u9762\u63d0\u5230\u4e86\u4e24\u7c7b\u7684 Code Group\uff1aD \u6253\u5934\u7684\uff0c\u8868\u793a\u6570\u636e\uff0c\u6709 256 \u79cd\uff0c\u4ece 8b \u6620\u5c04\u5230 10b \u7684\u8868\u8fbe\u65b9\u5f0f\uff0c\u5e76\u4e14\u4e3a\u4e86\u4fdd\u6301\u76f4\u6d41\u5e73\u8861\uff0c\u6709\u4e00\u79cd\u5230\u4e24\u79cd\u8868\u793a\u65b9\u6cd5\u3002\u6b64\u5916\u8fd8\u6709 12 \u4e2a\u7279\u6b8a\u7684 Code Group\uff1aK \u6253\u5934\uff0c\u5b83\u4eec\u7684 10b \u8868\u8fbe\u65b9\u5f0f\u4e0d\u4f1a\u548c\u6570\u636e\u51b2\u7a81\u3002\u8868 <code>Table 36\u20133\u2014Defined ordered sets</code> \u4e2d\u5b9a\u4e49\u4e86 K \u6253\u5934\u7684 Code Group \u542b\u4e49\uff1a</p> <ul> <li>/C/ Configuration:</li> <li>/C1/ Configuration 1: /K28.5/D21.5/Config_Reg</li> <li>/C2/ Configuration 2: /K28.5/D2.2/Config_Reg</li> <li>/I/ IDLE:</li> <li>/I1/ IDLE 1: /K28.5/D5.6/</li> <li>/I2/ IDLE 2: /K28.5/D16.2/</li> <li>Encapsulation:</li> <li>/R/ Carrier_Extend: /K23.7/</li> <li>/S/ Start_of_Packet: /K27.7/</li> <li>/T/ End_of_Packet: /K29.7/</li> <li>/V/ Error_Propagation: /K30.7/</li> <li>/LI/ LPI (Low Power Idle):</li> <li>/LI1/ LPI 1: /K28.5/D6.5/</li> <li>/LI2/ LPI 2: /K28.5/D26.4/</li> </ul> <p>IEEE 802.3 Figure 36-4 \u4e2d\u7ed9\u4e86\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5c31\u662f\u5728\u53d1\u9001\u4e00\u6bb5\u6570\u636e\u7684\u65f6\u5019\uff0c\u9996\u5148\u662f /I/\uff0c\u7136\u540e /S/\uff0c\u63a5\u7740\u4e00\u7cfb\u5217\u7684 /D/\uff0c\u6700\u540e\u7ed3\u675f\u7684\u65f6\u5019 /T/R/I/\u3002</p> <p>\u6269\u5c55\u9605\u8bfb\uff1a</p> <ul> <li>Serial Gigabit Media Independent Interface</li> <li>1G/2.5G Ethernet PCS/PMA or SGMII v16.0</li> <li>https://en.wikipedia.org/wiki/Physical_coding_sublayer</li> </ul>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#1000base-x-\u4e0e-sfp-\u7684\u5173\u7cfb","title":"1000BASE-X \u4e0e SFP \u7684\u5173\u7cfb","text":"<p>1000BASE-X \u5728 802.3 Clause 36 \u4e2d\u5b9a\u4e49\uff0c\u5b83\u7684\u5c42\u7ea7\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u5b83\u652f\u6301\u4e09\u79cd\u4e0d\u540c\u7684\u4ecb\u8d28\uff0c\u5bf9\u5e94\u4e86\u4e09\u4e2a PMD \u5c42\uff0c\u4e5f\u5c31\u662f LX\u3001SX \u548c CX\u3002\u8fd9\u4e9b\u4f53\u73b0\u5728\u8bbe\u5907\u4e0a\uff0c\u5176\u5b9e\u5c31\u662f\u4e0d\u540c\u7684 SFP \u6a21\u5757\u3002SFP \u6a21\u5757\u5b9e\u9645\u4e0a\u5c31\u662f\u56fe\u4e2d\u7684 PMD \u5c42\uff0cSFP \u63a5\u53e3\u4e0a\u8fde\u63a5\u7684\u662f 1000BASE-X \u7684 PCS/PMA\uff0c\u8fd9\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u8bf4\u5728\u5e26\u6709 SFP \u7684 FPGA \u4e0a\uff0cXilinx \u7684 IP \u53eb\u505a 1G/2.5G Ethernet PCS/PMA\u3002\u5728\u8fd9\u91cc\uff0cPCS \u548c PMA \u5c42\u5728 FPGA \u5185\u90e8\u901a\u8fc7 IP \u5b9e\u73b0\uff0c\u901a\u8fc7 PCB \u8fde\u63a5\u5230 SFP \u4e0a\uff0c\u5149\u6a21\u5757\u5c31\u662f PMD \u5c42\u3002\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5de6\u8fb9\u901a\u8fc7 GMII \u8fde\u63a5\u5230\u5185\u90e8\u7684 MAC\uff0c\u53f3\u8fb9\u8fde\u63a5\u5230 SFP \u4e0a\uff0c\u901a\u8fc7\u5149\u6a21\u5757\uff0c\u8fde\u63a5\u5230\u5149\u7ea4\u3002\u8fd9\u91cc\u5149\u6a21\u5757\u53ea\u9700\u8981\u8d1f\u8d23\u5149\u7535\u8f6c\u6362\u3002\u53e6\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u5f62\u5f0f\uff0c\u5c31\u662f MAC \u5728 FPGA \u5185\u90e8\uff0cPHY\uff08\u5305\u62ec PCS/PMA/PMD\uff09\u90fd\u5728 FPGA \u5916\u90e8\uff0c\u6b64\u65f6 FPGA IO \u4e0a\u5c31\u662f\u5404\u79cd MII\u3002</p> <p>\u90a3\u4e48 SFP \u7535\u53e3\u6a21\u5757\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u5462\uff1f\u6211\u4eec\u77e5\u9053\uff0c\u7535\u53e3\u91c7\u7528\u7684\u662f 1000BASE-T \u6807\u51c6\u3002\u5b9e\u9645\u4e0a\uff0c\u5b83\u91cc\u9762\u6709\u4e00\u4e2a PHY \u82af\u7247\uff0c\u53d1\u9001\u7684\u65f6\u5019\uff0c\u9996\u5148\u89e3\u7801 1000BASE-X \u53d8\u56de\u539f\u59cb\u6570\u636e\uff0c\u518d\u6309\u7167 1000BASE-T \u7684\u65b9\u5f0f\u7f16\u7801\u518d\u53d1\u51fa\u53bb\uff1b\u63a5\u6536\u7684\u65f6\u5019\uff0c\u6309\u7167 1000BASE-T \u8fdb\u884c\u89e3\u7801\uff0c\u518d\u91cd\u65b0\u7f16\u7801\u4e3a 1000BASE-X \u53d1\u9001\u7ed9 PMA \u5c42\u3002</p> <p>\u8fd8\u6709\u4e00\u7c7b\u7535\u53e3\u6a21\u5757\uff0c\u4e0e\u4e0a\u9762\u4e0d\u540c\u7684\u5730\u65b9\u5728\u4e8e\uff0cSFP \u4e0a\u8d70\u7684\u662f SGMII\uff0c\u800c\u4e0d\u662f 1000BASE-X\u3002\u8fd9\u4e24\u79cd\u6a21\u5f0f\u6ca1\u6709\u592a\u5927\u7684\u533a\u522b\uff0c\u90fd\u662f\u4e24\u5bf9\u5dee\u5206\u7ebf\uff0c\u4e00\u6536\u4e00\u53d1\uff0c\u6240\u4ee5\u5f88\u591a\u65f6\u5019\u4e8c\u8005\u662f\u540c\u65f6\u652f\u6301\uff0c\u53ef\u4ee5\u5207\u6362\u7684\u3002\u4f8b\u5982 Cisco Compatible 10/100/1000BASE-T SFP SGMII Copper RJ-45 100m Industrial Transceiver Module (LOS) \u5c31\u662f\u5728 SFP \u4e0a\u8d70 SGMII \u534f\u8bae\u3002</p> <p>\u63a8\u8350\u9605\u8bfb Designing a Copper SFP using the VSC8221 10/100/1000BASE-T PHY\uff0c\u5b83\u91cc\u9762\u8bb2\u4e86\u5982\u4f55\u5c06 VSC8221 \u82af\u7247\u7528\u4e8e\u7535\u53e3\u6a21\u5757\uff1aVSC8221 \u82af\u7247\u4e00\u5934\u662f 1000BASEX\uff08\u53c8\u79f0 802.3z SerDes\uff0c802.3z \u5c31\u662f 1000BASE-X\uff09\u6216\u8005 SGMII\uff0c\u53e6\u4e00\u5934\u662f 1000BASE-T MDI\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#\u7269\u7406\u5c42","title":"\u7269\u7406\u5c42","text":"","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#100base-tx","title":"100BASE-TX","text":"<p>\u5728 IEEE 802.3 \u7684 Clause 24 \u548c 25 \u4e2d\u5b9a\u4e49\u3002</p> <p>100BASE-TX \u7684\u7269\u7406\u5c42\u5206\u4e3a PCS\uff0cPMA\uff0cPMD\u3002\u4e0e MAC \u7684\u8fde\u63a5\u662f MII \u63a5\u53e3\uff0cMII \u9891\u7387\u662f 25MHz\uff0c\u6bcf\u5468\u671f\u4f20\u8f93 4 bit \u7684\u6570\u636e\u3002\u7136\u540e PCS \u8d1f\u8d23\u628a 4 bit \u7684\u6570\u636e\u901a\u8fc7 4B/5B \u8f6c\u6362\u4e3a 5 bit \u7684 code group\uff1bPMA \u4f7f\u7528 NRZI \u8fdb\u884c\u7f16\u7801\uff1bPMD \u5c42\u501f\u7528\u4e86 FDDI \u534f\u8bae\u7684 PMD \u5c42\uff0c\u53ea\u4f7f\u7528 MDI \u7684 1-3 \u548c 6 \u56db\u6839\u7ebf\u4f20\u8f93\uff0c\u4e24\u5bf9\u5dee\u5206\u5bf9\uff0c\u4e00\u6536\u4e00\u53d1\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#1000base-t","title":"1000BASE-T","text":"<p>\u5728 IEEE 802.3ab-1999 \u4e2d\u5b9a\u4e49\uff0c\u5177\u4f53\u4f4d\u7f6e\u662f Clause 40\u3002</p> <p></p> <p>\u7269\u7406\u5c42\u5f80\u4e0a\u901a\u8fc7 GMII \u8fde\u63a5 MAC\uff0c\u5f80\u4e0b\u901a\u8fc7 MDI \u8fde\u63a5\u5176\u4ed6\u7f51\u7edc\u8bbe\u5907\u3002\u7269\u7406\u5c42\u53c8\u5305\u62ec PCS \u548c PMA\u3002</p> <p>1000BASE-T \u4f7f\u7528\u56db\u5bf9\u5dee\u5206\u7ebf\uff0c\u6bcf\u5bf9\u5dee\u5206\u7ebf\u4e0a\u90fd\u662f\u5168\u53cc\u5de5\u4f20\u8f93\uff0c\u6ce2\u7279\u7387 125Mbaud\uff0csymbol \u7684\u8303\u56f4\u662f <code>{2, 1, 0, -1, -2}</code>\uff0c\u901a\u8fc7 PAM5 \u4f20\u8f93\u3002</p> <p>\u5177\u4f53\u6765\u8bb2\uff0cPCS \u4ece MAC \u7684 GMII \u63a5\u53e3\u63a5\u6536\u8981\u53d1\u9001\u7684\u6570\u636e\uff0cGMII \u662f 125MHz\uff0c\u6bcf\u4e2a\u5468\u671f 8 \u4f4d\u6570\u636e\u3002\u8fd9\u4e9b\u6570\u636e\u4e0e scrambler \u4e00\u8d77\uff0c\u751f\u6210 9 \u4f4d\u7684 <code>Sd_n[8:0]</code>\uff0c\u7136\u540e\u518d\u7f16\u7801\u4e3a <code>(TA_n, TB_n, TC_n, TD_n)</code>\uff0c\u4e5f\u5c31\u662f\u5728\u56db\u5bf9\u5dee\u5206\u7ebf\u4e0a\u4f20\u8f93\u7684 symbol\uff0c\u53d6\u503c\u8303\u56f4\u662f <code>[-2, 2]</code>\u3002\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c\u5c31\u662f\u6bcf\u4e2a\u5468\u671f 8 \u4f4d\u6570\u636e\uff0c\u5148\u53d8\u6210 9 \u4f4d\u6570\u636e\uff0c\u518d\u53d8\u6210 4 \u4e2a symbol\uff0c\u6bcf\u4e2a symbol \u53d6\u503c\u8303\u56f4\u662f -2 \u5230 2\uff0c\u8fd9\u5c31\u53eb\u505a 8B1Q4\uff0c<code>converting GMII data (8B-8 bits) to four quinary symbols (Q4) that are transmitted during one clock (1Q4)</code>\uff0c\u628a 8 \u4f4d\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u56db\u4e2a symbol\uff0c\u6bcf\u4e2a symbol \u6709\u4e94\u79cd\u53d6\u503c\uff08Quinary \u8868\u793a 5\uff09\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/12/27/ethernet-physical-interfaces/#mdio","title":"MDIO","text":"<p>MDIO \u662f MAC \u548c PHY \u4e4b\u95f4\u4e00\u4e2a\u4f4e\u901f\u7684\u901a\u4fe1\u63a5\u53e3\uff0c\u5b9a\u4e49\u5728 IEEE 802.3 Clause 45\uff0c\u53ef\u4ee5\u7528\u6765\u914d\u7f6e\u4e00\u4e9b\u5bc4\u5b58\u5668\u3002\u5b83\u652f\u6301\u8bfb\u548c\u5199\uff0c\u591a\u4e2a PHY \u53ef\u4ee5\u5171\u4eab\u4e00\u4e2a MDIO \u603b\u7ebf\uff0c\u901a\u8fc7 5 \u4f4d\u7684\u5730\u5740\u533a\u5206\u3002\u4e3a\u4e86\u8ba9 PHY \u5206\u914d\u5230\u4e0d\u540c\u7684\u5730\u5740\uff0cPHY \u901a\u5e38\u4f1a\u901a\u8fc7\u67d0\u4e9b\u5f15\u811a\u7684\u4e0a\u4e0b\u62c9\u6765\u51b3\u5b9a\u5b83\u81ea\u5df1\u7684 MDIO \u5730\u5740\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u51b2\u7a81\u3002\u4ee5 RTL8201F \u4e3a\u4f8b\uff0c\u5b83\u7684 PHY \u7684 MDIO \u5730\u5740\u914d\u7f6e\u4e0e LED \u8f93\u51fa\u5f15\u811a\u662f\u5171\u4eab\u7684\uff0c\u6839\u636e\u5916\u90e8\u7535\u8def\u7684\u4e0a\u4e0b\u62c9\u4e0d\u540c\uff0c\u914d\u7f6e MDIO \u5730\u5740\u7684\u6700\u4f4e\u4e24\u4f4d\uff1a</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u6b3e\u82af\u7247\u7684 MDIO \u5730\u5740\u53ef\u4ee5\u5728\u4e8c\u8fdb\u5236\u7684 00000 \u5230 00011 \u4e4b\u95f4\u53d6\u3002\u4f46\u4e0d\u5efa\u8bae\u7528 00000 \u5730\u5740\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e00\u4e9b\u82af\u7247\u4f1a\u628a 00000 \u91cd\u5b9a\u4e49\u4e3a\u5e7f\u64ad\uff0c\u6b64\u65f6\u603b\u7ebf\u4e0a\u7684\u6240\u6709 PHY \u82af\u7247\u90fd\u8981\u54cd\u5e94\u76ee\u6807\u5730\u5740\u4e3a\u81ea\u5df1\u7684\u5730\u5740\uff08\u975e 00000\uff09\u6216\u8005 00000 \u5730\u5740\u7684\u8bf7\u6c42\uff08\u89c1 MDIO Addressing\uff09\u3002RTL8211 \u5728\u5b83\u7684\u6587\u6863\u91cc\u63cf\u8ff0\u4e86\u8fd9\u4e2a\u884c\u4e3a\uff1a</p> <p></p> <p>\u8fd9\u6837\u7684\u597d\u5904\u662f\u53ef\u4ee5\u540c\u65f6\u5f80\u591a\u4e2a PHY \u82af\u7247\u5199\u5165\u5bc4\u5b58\u5668\uff0c\u4f46\u5982\u679c\u8981\u4ece 00000 \u5730\u5740\u8bfb\u5bc4\u5b58\u5668\u7684\u8bdd\uff0c\u4e00\u65e6\u591a\u4e2a PHY \u540c\u65f6\u54cd\u5e94\uff0cMDIO \u603b\u7ebf\u4e0a\u5c31\u4f1a\u51fa\u73b0\u51b2\u7a81\u3002\u4e0d\u8fc7\u5982\u679c\u53ea\u6709\u4e00\u4e2a PHY \u82af\u7247\u8fde\u63a5\u5230 MDIO \u603b\u7ebf\u4e0a\uff0c\u90a3\u4e48\u8ba9 MAC \u901a\u8fc7 00000 \u5730\u5740\u8bbf\u95ee PHY \u4e5f\u662f\u53ef\u4ee5\u7684\u3002</p>","tags":["ethernet","ieee","fiber","sfp","qsfp","gigabitethernet","rgmii","sgmii","qsgmii"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/","title":"FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb","text":"","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>2012 \u5e74\uff0cYubico \u548c Google \u8bbe\u8ba1\u4e86 U2F \u534f\u8bae\uff0c\u7b2c\u4e8c\u5e74 U2F \u6210\u4e3a FIDO \u7ec4\u7ec7\u7684\u6807\u51c6\uff0c\u4e4b\u540e\u52a0\u5165\u4e86 NFC \u7684\u652f\u6301\u3002\u4e4b\u540e\uff0cFIDO2 \u4f5c\u4e3a\u66ff\u4ee3 U2F \u7684\u65b0\u6807\u51c6\u4ea7\u751f\uff0c\u539f\u6765\u7684 U2F \u4ee5\u517c\u5bb9\u7684\u65b9\u5f0f\u6210\u4e3a\u4e86 CTAP1\uff0c\u800c\u91c7\u7528 CBOR \u5c01\u88c5\u683c\u5f0f\u7684 CTAP(CTAP2) \u5219\u662f FIDO2 \u7684\u4e3b\u8981\u534f\u8bae\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#u2f","title":"U2F","text":"","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u547d\u4ee4\u683c\u5f0f","title":"\u547d\u4ee4\u683c\u5f0f","text":"<p>U2F \u5b9a\u4e49\u4e86\u5b83\u7684\u547d\u4ee4\u683c\u5f0f\uff0c\u57fa\u4e8e ISO7816-4 APDU\uff08short APDU\uff09 \uff1a</p> CLA INS P1 P2 Lc data Le 1 byte 1 byte 1 byte 1 byte 0-1 bytes variable length 0-1 bytes <p>\u6bd4\u5982 U2F_VERSION \u5c31\u662f\uff1a</p> CLA INS P1 P2 Lc data Le 00 03 00 00 0 empty 00 <p>\u8fd4\u56de\u7684\u6570\u636e\u5c31\u662f <code>U2F_V2</code> \u7684 ASCII \u52a0\u4e0a <code>9000</code> \u7684\u72b6\u6001\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5b83\u8fd8\u6709\u4e00\u79cd extended length \u683c\u5f0f\u7684 APDU\uff0c\u548c\u4e0a\u9762\u7684\u662f\u7b49\u4ef7\u7684\u4e0d\u540c\u8868\u793a\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u4f20\u8f93\u65b9\u5f0f","title":"\u4f20\u8f93\u65b9\u5f0f","text":"<p>\u5b9e\u9645\u4f7f\u7528 U2F \u7684\u65f6\u5019\uff0c\u53c8\u6709\u4e09\u79cd\u60c5\u51b5\uff0c\u5206\u522b\u662f USB\u3001Bluetooth \u548c NFC\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#usb","title":"USB","text":"<p>\u5728 U2FHID \u91cc\u9762\uff0c\u4e3a\u4e86\u8ba9 U2F \u7684\u547d\u4ee4\u901a\u8fc7 HID \u63a5\u53e3\u4f20\u8f93\uff0c\u5b83\u89c4\u5b9a\u4e86\u4e24\u4e2a endpoint\uff0c\u5206\u522b\u662f Interrupt IN \u548c Interrupt OUT\uff0c\u8fd8\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684 HID Report Descriptor\u3002\u4e3a\u4e86\u53d1 U2F \u547d\u4ee4\uff0c\u9996\u5148\u4f1a\u8fdb\u884c\u4e00\u6b21\u5c01\u88c5\uff1a</p> CMD BCNT DATA U2FHID_MSG 4..n n bytes <p>\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5934\uff0c\u8868\u793a\u8f7d\u8377\u662f\u4e00\u4e2a U2F \u7684 command\uff08\u81ea\u7136\u4e5f\u662f APDU\uff09\u3002</p> <p>\u5728 cmd \u4e4b\u4e0a\uff0c\u8fd8\u4f1a\u5c01\u88c5\u4e00\u5c42\uff0c\u4e3a\u4e86\u89e3\u51b3 USB \u7684 packet size \u9650\u5236\u7b49\u95ee\u9898\uff0c\u5b9a\u4e49\u4e86 init packet\uff1a</p> CID CMD BCNTH BCNTL DATA 4 bytes 1 byte 1 byte 1 byte variable length <p>\u5982\u679c\u6570\u636e\u592a\u957f\uff0c\u5c31\u4f1a\u62c6\u5206\u6210\u4e00\u4e2a init \u548c \u591a\u4e2a continuation packet\uff1a</p> CID SEQ DATA 4 bytes 1 byte variable length <p>\u628a init \u548c continuation \u91cc\u9762\u7684 data \u7ec4\u5408\u8d77\u6765\uff0c\u5c31\u662f U2F \u7684 message\uff0cmessage \u91cc\u9762\u53ef\u80fd\u53c8\u6709 U2F raw command\uff0c\u4e5f\u5c31\u662f APDU\u3002</p> <p>\u53d1\u9001\u7684\u65f6\u5019\uff0c\u5148 Interrupt OUT \u53d1\u9001\u8bf7\u6c42\uff0c\u518d Interrupt IN \u8bfb\u53d6\u56de\u5e94\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#bluetooth","title":"Bluetooth","text":"<p>\u5728 U2F/Bluetooth \u91cc\u9762\uff0c\u4e5f\u7528\u4e86\u4e00\u4e2a\u7c7b\u4f3c\u7684\u5c01\u88c5\u683c\u5f0f\uff0c\u8bf7\u6c42\uff1a</p> CMD HLEN LLEN DATA 1 byte 1 byte 1 byte variable length <p>\u8fd9\u91cc\u7684 DATA payload \u5c31\u662f extended length \u683c\u5f0f\u7684 APDU</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#nfc","title":"NFC","text":"<p>\u5728 U2F/NFC \u91cc\u9762\uff0c\u65e2\u7136 ISO 7816-4 \u672c\u6765\u5c31\u662f NFC-native \u7684\u683c\u5f0f\uff0c\u5c31\u4e0d\u8981\u989d\u5916\u7684\u5c01\u88c5\u4e86\u3002\u53ea\u9700\u8981\u89c4\u5b9a\u4e00\u4e2a Applet \u7684 AID \u5373\u53ef\uff1a<code>A0000006472F0001</code></p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u603b\u800c\u8a00\u4e4b\uff0cU2F raw commands \u5c31\u662f\u5728 APDU \u683c\u5f0f\u4e0a\u5b9a\u4e49\u4e86\u51e0\u4e2a\u547d\u4ee4\u3002\u5728 USB \u548c Bluetooth \u4e0a\u90fd\u52a0\u4e86\u51e0\u4e2a\u5c0f\u7684 Header\uff0c\u800c NFC \u4e0a\u5219\u662f\u89c4\u5b9a\u4e86\u4e00\u4e2a AID\u3002\u8fd9\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u5f88\u65b9\u4fbf\uff0c\u6838\u5fc3\u7684\u547d\u4ee4\u53ea\u6709\u4e00\u5957\uff0c\u9700\u8981\u7684\u65f6\u5019\u5c01\u88c5\u4e00\u4e0b\u5373\u53ef\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#fido2","title":"FIDO2","text":"<p>\u5728\u4e4b\u540e\uff0cFIDO2 \u51fa\u73b0\u4e86\uff0c\u5728\u4fdd\u6301 U2F \u517c\u5bb9\u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e86\u65b0\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u51fa\u73b0\u4e86 WebAuthN \u4f5c\u4e3a\u6d4f\u89c8\u5668\u4f7f\u7528 FIDO2 \u7684\u534f\u8bae\u3002U2F \u5c31\u53d8\u6210\u4e86\u7b2c\u4e00\u4ee3\u7684 CTAP\uff0c\u79f0\u4e3a CTAP1\uff0c\u7136\u540e CTAP \u9ed8\u8ba4\u6307\u7684\u5c31\u662f CTAP2\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u547d\u4ee4\u683c\u5f0f_1","title":"\u547d\u4ee4\u683c\u5f0f","text":"<p>FIDO2 \u91cc\u9762\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e9b CTAP \u547d\u4ee4\uff0c\u6bd4\u5982 authenticatorMakeCredential\uff0c\u5bf9\u5e94 U2F \u7684 U2F_REGISTER \u547d\u4ee4\u3002\u7136\u540e\uff0c\u89c4\u5b9a\u4e86\u4e00\u4e2a CBOR \u7684\u683c\u5f0f\uff0c\u6765\u8868\u793a\u547d\u4ee4\u9644\u5e26\u7684\u6570\u636e\u3002CBOR \u662f RFC 7049\uff0c\u6240\u4ee5\u4e5f\u662f\u501f\u7528\u8fc7\u6765\u7684\u683c\u5f0f\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u4f20\u8f93\u65b9\u5f0f_1","title":"\u4f20\u8f93\u65b9\u5f0f","text":"<p>FIDO2 \u5b9a\u4e49\u4e86\u5728 USB \u548c NFC \u4e0a\u7684\u4f20\u8f93\u683c\u5f0f\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#usb_1","title":"USB","text":"<p>\u5728 USB \u4e0a\u4f20\u8f93\u7684\u65f6\u5019\uff0c\u5b9a\u4e49\u4e86 CTAPHID \u7684\u534f\u8bae\uff0c\u4e0e U2FHID \u57fa\u672c\u662f\u4e00\u6837\u7684\uff0c\u89c4\u5b9a\u4e86 init packet \u548c continuation packet\uff0cpacket \u91cc\u9762\u4e5f\u662f CTAPHID \u7684\u6d88\u606f\uff0c\u8fd9\u90e8\u5206\u662f\u517c\u5bb9 U2F \u7684\u3002\u5e76\u4e14\uff0c\u989d\u5916\u6dfb\u52a0\u4e86 CTAPHID_CBOR \u6d88\u606f\uff1a</p> CMD BCNT DATA DATA + 1 CTAPHID_CBOR 1..(n+1) CTAP command n bytes of CBOR data <p>\u5b83\u7684\u8f7d\u8377\u5c31\u662f CBOR \u683c\u5f0f\u7684\u8bf7\u6c42\u3002</p> <p>\u7c7b\u4f3c\u5730\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7 Interrupt OUT \u53d1\u9001\u8bf7\u6c42\uff0c\u4ece Interrupt IN \u8bfb\u53d6\u56de\u5e94\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#nfc_1","title":"NFC","text":"<p>\u5728 NFC \u4e0a\u4f20\u8f93\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5185\u90e8\u7684\u683c\u5f0f\u662f CBOR\uff0c\u4e0d\u518d\u662f APDU \u4e86\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u5c01\u88c5\u3002</p> <p>\u9996\u5148\uff0c\u5b83\u4e5f\u5b9a\u4e49\u4e86\u4e00\u4e2a Applet ID\uff1a<code>A0000006472F0001</code>\uff0c\u548c U2F \u4e00\u6837\u3002\u4e3a\u4e86\u4fdd\u6301\u517c\u5bb9\uff0c\u5b83\u90fd\u652f\u6301 U2F \u5b9a\u4e49\u7684 APDU \u547d\u4ee4\u3002</p> <p>\u90a3\u600e\u4e48\u533a\u5206\u8bbe\u5907\u662f\u5426\u652f\u6301 CTAP1/U2F \u548c CTAP2 \u5462\uff1f\u4f7f\u7528\u524d\u9762\u63d0\u5230\u7684 U2F_VERSION \u547d\u4ee4\u5373\u53ef\u3002\u5982\u679c\u5f97\u5230 U2F_V2\uff0c\u8bf4\u660e\u662f\u652f\u6301 CTAP1/U2F \u7684\uff1b\u5982\u679c\u5f97\u5230\u662f\u5176\u4ed6\u7684\uff0c\u8bf4\u660e\u53ea\u652f\u6301 CTAP2\uff0c\u4e0d\u652f\u6301 CTAP1/U2F\u3002</p> <p>\u5982\u679c\u8981\u53d1 CTAP2 \u7684\u547d\u4ee4\uff0c\u5c31\u8981\u628a CTAP command \u548c CBOR \u683c\u5f0f\u7684\u6570\u636e\u5c01\u88c5\u5230 APDU \u91cc\u9762\uff1a</p> CLA INS P1 P2 Data Le 80 10 00 00 CTAP Command || CBOR Data variable <p>\u5b83\u89c4\u5b9a\uff0c\u5982\u679c\u8bf7\u6c42\u91c7\u7528\u7684\u662f extended length \u7684 APDU\uff0c\u90a3\u4e48\u54cd\u5e94\u4e5f\u8981\u662f extended length \u7684 APDU\uff1b\u5982\u679c\u8bf7\u6c42\u662f short APDU\uff0c\u90a3\u4e48\u54cd\u5e94\u4e5f\u8981\u652f\u6301 short APDU \u7684 chaining\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u517c\u5bb9\u6027","title":"\u517c\u5bb9\u6027","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0cCTAP2 \u8bbe\u8ba1\u7684\u57fa\u672c\u90fd\u8003\u8651\u4e86\u517c\u5bb9 U2F\uff0c\u5141\u8bb8\u7528 U2F \u7684 API \u64cd\u4f5c U2F \u548c CTAP2 \u7684\u8bbe\u5907\uff1b\u4e5f\u5141\u8bb8\u7528 CTAP2 \u7684 API \u64cd\u4f5c U2F\uff08\u53ea\u652f\u6301\u90e8\u5206\u547d\u4ee4\uff09\u548c  CTAP2 \u7684\u8bbe\u5907\u3002</p>","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2020/05/18/fido-u2f-fido2-ctap/#\u603b\u7ed3_1","title":"\u603b\u7ed3","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u6709\u4e00\u5806\u5957\u5a03\u7684\u8fc7\u7a0b\uff1a</p> <p>U2F\uff1a</p> USB HID Bluetooth NFC 4 APDU APDU APDU 3 U2F message 2 USB HID packet 1 USB Bluetooth ISO 14443-4/ISO 18092 <p>FIDO2:</p> USB HID NFC 4 CTAP command + CBOR data CTAP command + CBOR data 3 CTAP message APDU 2 USB HID packet 1 USB ISO 14443-4/ISO 18092","tags":["nfc","usb","fido","fido2","ctap","u2f"]},{"location":"hardware/2023/04/04/firtool/","title":"firtool \u5c1d\u8bd5","text":"","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>Chisel 3.6 \u5f88\u5feb\u5c31\u8981\u53d1\u5e03\u4e86\uff08\u76ee\u524d\u6700\u65b0\u7248\u672c\u662f 3.6.0-RC2\uff09\uff0c\u8fd9\u4e2a\u5927\u7248\u672c\u7684\u4e3b\u8981\u66f4\u65b0\u5185\u5bb9\u5c31\u662f\u5f15\u5165\u4e86 CIRCT \u7684 firtool \u4f5c\u4e3a FIRRTL \u5230 Verilog \u7684\u8f6c\u6362\u6d41\u7a0b\uff1a</p> <pre><code>The primary change in Chisel v3.6.0 is the transition from the Scala FIRRTL\nCompiler to the new MLIR FIRRTL Compiler. This will have a minimal impact on\ntypical Chisel user APIs but a large impact on custom compiler flows. For\nmore information, please see the ROADMAP.\n</code></pre> <p>\u56e0\u6b64\u63d0\u524d\u6d4b\u8bd5\u4e00\u4e0b firtool\uff0c\u770b\u770b\u5176\u548c Scala FIRRTL Compiler \u6709\u54ea\u4e9b\u533a\u522b\uff0c\u662f\u5426\u6709\u66f4\u597d\u7684\u8f93\u51fa\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u4f7f\u7528-firtool","title":"\u4f7f\u7528 firtool","text":"<p>\u4f7f\u7528 firtool \u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ol> <li>\u4f7f\u7528 chisel3 3.6 \u7684 <code>circt.stage.ChiselStage</code> \u5bf9\u8c61\uff1a</li> </ol> <pre><code>circt.stage.ChiselStage\n  .emitSystemVerilogFile(new Top)\n</code></pre> <p>\u4ee3\u7801\u4e2d\u4f1a\u751f\u6210 Chisel \u6a21\u5757\u5bf9\u5e94\u7684 FIRRTL \u6587\u4ef6\uff0c\u7136\u540e\u5582\u7ed9 firtool\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>circt.stage.ChiselMain</code> \u6765\u8fd0\u884c\uff1a</p> <pre><code>$ sbt \"runMain circt.stage.ChiselMain --help\"\n[info] running circt.stage.ChiselMain --help\nUsage: circt [options] [&lt;arg&gt;...]\n\nShell Options\n  &lt;arg&gt;...                 optional unbounded args\n  -td, --target-dir &lt;directory&gt;\n                           Work directory (default: '.')\n  -faf, --annotation-file &lt;file&gt;\n                           An input annotation file\n  -foaf, --output-annotation-file &lt;file&gt;\n                           An output annotation file\n  --show-registrations     print discovered registered libraries and transforms\n  --help                   prints this usage text\nLogging Options\n  -ll, --log-level {error|warn|info|debug|trace}\n                           Set global logging verbosity (default: None\n  -cll, --class-log-level &lt;FullClassName:{error|warn|info|debug|trace}&gt;...\n                           Set per-class logging verbosity\n  --log-file &lt;file&gt;        Log to a file instead of STDOUT\n  -lcn, --log-class-names  Show class names and log level in logging output\nCIRCT (MLIR FIRRTL Compiler) options\n  --target {chirrtl|firrtl|hw|verilog|systemverilog}\n                           The CIRCT\n  --preserve-aggregate &lt;value&gt;\n                           Do not lower aggregate types to ground types\n  --module &lt;package&gt;.&lt;module&gt;\n                           The name of a Chisel module to elaborate (module must be in the classpath)\n  --full-stacktrace        Show full stack trace when an exception is thrown\n  --throw-on-first-error   Throw an exception on the first error instead of continuing\n  --warnings-as-errors     Treat warnings as errors\n  --source-root &lt;file&gt;     Root directory for source files, used for enhanced error reporting\n  --split-verilog          Indicates that \"firtool\" should emit one-file-per-module and write separate outputs to separate files\nFIRRTL Transform Options\n  --no-dce                 Disable dead code elimination\n  --no-check-comb-loops    Disable combinational loop checking\n  -fil, --inline &lt;circuit&gt;[.&lt;module&gt;[.&lt;instance&gt;]][,...]\n                           Inline selected modules\n  -clks, --list-clocks -c:&lt;circuit&gt;:-m:&lt;module&gt;:-o:&lt;filename&gt;\n                           List which signal drives each clock of every descendent of specified modules\n  --no-asa                 Disable assert submodule assumptions\n  --no-constant-propagation\n                           Disable constant propagation elimination\nAspectLibrary\n  --with-aspect &lt;package&gt;.&lt;aspect&gt;\n                           The name/class of an aspect to compile with (must be a class/object without arguments!)\nMemLib Options\n  -firw, --infer-rw        Enable read/write port inference for memories\n  -frsq, --repl-seq-mem -c:&lt;circuit&gt;:-i:&lt;file&gt;:-o:&lt;file&gt;\n                           Blackbox and emit a configuration file for each sequential memory\n  -gmv, --gen-mem-verilog &lt;blackbox|full&gt;\n                           Blackbox and emit a Verilog behavior model for each sequential memory\n</code></pre> <ol> <li>\u5728 Scala \u4e2d\u751f\u6210 FIRRTL \u6587\u4ef6\uff0c\u7136\u540e\u7528 firtool \u547d\u4ee4\u8f6c\u6362 <code>.fir</code> \u4e3a <code>.sv</code>\u3002\u7531\u4e8e Rocket Chip \u8fd8\u6ca1\u6709\u8fc1\u79fb\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7 firtool \u6765\u8f6c\u6362\u3002</li> </ol> <p>\u7531\u4e8e\u76ee\u524d chisel3 \u5e76\u6ca1\u6709\u6253\u5305 firtool\uff0c\u76ee\u524d\u9700\u8981\u81ea\u5df1\u88c5 firtool\uff0c\u4f8b\u5982\u901a\u8fc7 nix \u6216\u4e0b\u8f7d GitHub \u4e0a\u7684 Release \u6587\u4ef6\u3002\u672c\u6587\u91c7\u7528\u7684\u662f firtool 1.34.0\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u5bf9\u6bd4","title":"\u5bf9\u6bd4","text":"<p>\u628a\u540c\u4e00\u4efd\u6e90\u7801\uff0c\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u751f\u6210 Verilog \u7136\u540e\u8fdb\u884c\u89c2\u5bdf\uff0c\u4e0b\u9762\u662f\u4e00\u4e9b\u751f\u6210\u7684\u4ee3\u7801\u7684\u533a\u522b\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u72b6\u6001\u673a","title":"\u72b6\u6001\u673a","text":"<p>\u9996\u5148\u662f\u4e00\u4e2a\u72b6\u6001\u673a\u7684\u4f8b\u5b50\uff08\u53d6\u81ea chisel3 \u7684 DetectTwoOnes \u6837\u4f8b\uff09\uff1a</p> <pre><code>is(State.sTwo1s) {\n  when(!io.in) {\n    state := State.sNone\n  }\n}\n</code></pre> <p>Scala FIRRTL:</p> <pre><code>  wire [1:0] _GEN_2 = ~io_in ? 2'h0 : state; // @[src/main/scala/DetectTwoOnes.scala 33:20 34:15 15:22]\n  // ...\n    end else if (2'h2 == state) begin // @[src/main/scala/DetectTwoOnes.scala 19:17]\n      state &lt;= _GEN_2;\n    end\n</code></pre> <p>CIRCT firtool:</p> <pre><code>    else if (state == 2'h2 &amp; ~io_in)    // src/main/scala/DetectTwoOnes.scala:15:22, :17:20, :19:17, :33:{12,20}, :34:15\n      state &lt;= 2'h0;    // src/main/scala/DetectTwoOnes.scala:15:22, :29:15\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0cScala FIRRTL Compiler \u591a\u751f\u6210\u4e86\u4e00\u4e2a <code>_GEN_2</code>\uff0c\u9700\u8981\u628a\u524d\u540e\u4e00\u8d77\u770b\u624d\u77e5\u9053\u662f\u4ec0\u4e48\u610f\u601d\uff0c\u800c CIRCT \u751f\u6210\u7684\u4e0e\u6e90\u7801\u6bd4\u8f83\u63a5\u8fd1\uff0c\u53ef\u8bfb\u6027\u8f83\u597d\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#syncreadmem","title":"SyncReadMem","text":"<p>\u63a5\u4e0b\u6765\u770b SyncReadMem\u3002\u5728 Scala FIRRTL Compiler \u4e2d\uff0c\u9ed8\u8ba4\u662f\u76f4\u63a5\u5728\u6a21\u5757\u4e2d\u5d4c\u5165\u4ee3\u7801\uff1a</p> <pre><code>  reg [31:0] mem [0:31]; // @[src/main/scala/Memory.scala 10:24]\n  wire  mem_rdata_MPORT_en; // @[src/main/scala/Memory.scala 10:24]\n  wire [4:0] mem_rdata_MPORT_addr; // @[src/main/scala/Memory.scala 10:24]\n  wire [31:0] mem_rdata_MPORT_data; // @[src/main/scala/Memory.scala 10:24]\n  wire [31:0] mem_MPORT_data; // @[src/main/scala/Memory.scala 10:24]\n  wire [4:0] mem_MPORT_addr; // @[src/main/scala/Memory.scala 10:24]\n  wire  mem_MPORT_mask; // @[src/main/scala/Memory.scala 10:24]\n  wire  mem_MPORT_en; // @[src/main/scala/Memory.scala 10:24]\n  reg  mem_rdata_MPORT_en_pipe_0;\n  reg [4:0] mem_rdata_MPORT_addr_pipe_0;\n  assign mem_rdata_MPORT_en = mem_rdata_MPORT_en_pipe_0;\n  assign mem_rdata_MPORT_addr = mem_rdata_MPORT_addr_pipe_0;\n  assign mem_rdata_MPORT_data = mem[mem_rdata_MPORT_addr]; // @[src/main/scala/Memory.scala 10:24]\n  assign mem_MPORT_data = wdata;\n  assign mem_MPORT_addr = waddr;\n  assign mem_MPORT_mask = 1'h1;\n  assign mem_MPORT_en = 1'h1;\n  assign rdata = mem_rdata_MPORT_data; // @[src/main/scala/Memory.scala 11:9]\n  always @(posedge clock) begin\n    if (mem_MPORT_en &amp; mem_MPORT_mask) begin\n      mem[mem_MPORT_addr] &lt;= mem_MPORT_data; // @[src/main/scala/Memory.scala 10:24]\n    end\n    mem_rdata_MPORT_en_pipe_0 &lt;= 1'h1;\n    if (1'h1) begin\n      mem_rdata_MPORT_addr_pipe_0 &lt;= raddr;\n    end\n  end\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c\u5b83\u6709 repl-seq-mem \u7684\u9009\u9879\uff0c\u53ef\u4ee5\u751f\u6210 BlackBox \u65b9\u4fbf\u66ff\u6362\u4e3a\u5b9e\u9645\u7684 SRAM IP\uff1a</p> <pre><code>$ sbt \"runMain firrtl.stage.FirrtlMain -i Memory.fir --repl-seq-mem -c:Memory:-o:Memory.conf\"\n$ cat Memory.v\nmodule mem(\n  input  [4:0]  R0_addr,\n  input         R0_clk,\n  output [31:0] R0_data,\n  input  [4:0]  W0_addr,\n  input         W0_clk,\n  input  [31:0] W0_data\n);\n  wire [4:0] mem_ext_R0_addr;\n  wire  mem_ext_R0_en;\n  wire  mem_ext_R0_clk;\n  wire [31:0] mem_ext_R0_data;\n  wire [4:0] mem_ext_W0_addr;\n  wire  mem_ext_W0_en;\n  wire  mem_ext_W0_clk;\n  wire [31:0] mem_ext_W0_data;\n  mem_ext mem_ext (\n    .R0_addr(mem_ext_R0_addr),\n    .R0_en(mem_ext_R0_en),\n    .R0_clk(mem_ext_R0_clk),\n    .R0_data(mem_ext_R0_data),\n    .W0_addr(mem_ext_W0_addr),\n    .W0_en(mem_ext_W0_en),\n    .W0_clk(mem_ext_W0_clk),\n    .W0_data(mem_ext_W0_data)\n  );\n  assign mem_ext_R0_clk = R0_clk;\n  assign mem_ext_R0_en = 1'h1;\n  assign mem_ext_R0_addr = R0_addr;\n  assign R0_data = mem_ext_R0_data;\n  assign mem_ext_W0_clk = W0_clk;\n  assign mem_ext_W0_en = 1'h1;\n  assign mem_ext_W0_addr = W0_addr;\n  assign mem_ext_W0_data = W0_data;\nendmodule\n$ cat Memory.conf\nname mem_ext depth 32 width 32 ports write,read  \n</code></pre> <p>\u4e0b\u6e38\u5de5\u5177\u8bfb\u53d6 Memory.conf \u53bb\u751f\u6210\u5bf9\u5e94\u7684 mem_ext \u6a21\u5757\u3002\u8fd9\u91cc\u53ea\u8003\u8651\u4e86 Read Latency \u4e3a 1 \u7684\u60c5\u51b5\uff0c\u5982\u679c\u662f Mem\uff0c\u5c31\u4e0d\u4f1a\u751f\u6210 BlackBox\uff0c\u6bd5\u7adf\u53c2\u6570\u540d\u5b57\u662f sequential memory\u3002</p> <p>CIRCT firtool \u4e5f\u6709\u7c7b\u4f3c\u7684\u8868\u73b0\uff0c\u53ea\u4e0d\u8fc7\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c31\u4f1a\u7528\u4e00\u4e2a\u5355\u72ec\u7684\u6a21\u5757\uff1a</p> <pre><code>module Memory(  // &lt;stdin&gt;:3:10\n  input         clock,  // &lt;stdin&gt;:4:11\n                reset,  // &lt;stdin&gt;:5:11\n  input  [4:0]  raddr,  // src/main/scala/Memory.scala:4:17\n                waddr,  // src/main/scala/Memory.scala:7:17\n  input  [31:0] wdata,  // src/main/scala/Memory.scala:8:17\n  output [31:0] rdata   // src/main/scala/Memory.scala:5:17\n);\n\n  mem_combMem mem_ext ( // src/main/scala/Memory.scala:10:24\n    .R0_addr (raddr),\n    .R0_en   (1'h1),    // &lt;stdin&gt;:3:10\n    .R0_clk  (clock),\n    .W0_addr (waddr),\n    .W0_en   (1'h1),    // &lt;stdin&gt;:3:10\n    .W0_clk  (clock),\n    .W0_data (wdata),\n    .R0_data (rdata)\n  );\nendmodule\n\nmodule mem_combMem( // src/main/scala/Memory.scala:10:24\n  input  [4:0]  R0_addr,\n  input         R0_en,\n                R0_clk,\n  input  [4:0]  W0_addr,\n  input         W0_en,\n                W0_clk,\n  input  [31:0] W0_data,\n  output [31:0] R0_data\n);\n\n  reg [31:0] Memory[0:31];  // src/main/scala/Memory.scala:10:24\n  reg        _GEN;  // src/main/scala/Memory.scala:10:24\n  reg [4:0]  _GEN_0;    // src/main/scala/Memory.scala:10:24\n  always @(posedge R0_clk) begin    // src/main/scala/Memory.scala:10:24\n    _GEN &lt;= R0_en;  // src/main/scala/Memory.scala:10:24\n    _GEN_0 &lt;= R0_addr;  // src/main/scala/Memory.scala:10:24\n  end // always @(posedge)\n  always @(posedge W0_clk) begin    // src/main/scala/Memory.scala:10:24\n    if (W0_en)  // src/main/scala/Memory.scala:10:24\n      Memory[W0_addr] &lt;= W0_data;   // src/main/scala/Memory.scala:10:24\n  end // always @(posedge)\n  assign R0_data = _GEN ? Memory[_GEN_0] : 32'bx;   // src/main/scala/Memory.scala:10:24\nendmodule\n</code></pre> <p>firtool \u4e5f\u652f\u6301 <code>-repl-seq-mem</code> \u53c2\u6570\uff0c\u7528\u6cd5\u548c\u8f93\u51fa\u4e0e Scala FIRRTL Compiler \u7c7b\u4f3c\u3002</p> <p>\u6211\u6700\u8fd1\u4e5f\u5199\u4e86\u4e00\u4e2a\u5c0f\u5de5\u5177\uff1achisel-memory-lower\u6765\u89e3\u6790\u751f\u6210\u7684 conf \u6587\u4ef6\uff0c\u751f\u6210\u5bf9\u5e94\u7684 BlackBox\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u590d\u6742\u7ec4\u5408\u903b\u8f91","title":"\u590d\u6742\u7ec4\u5408\u903b\u8f91","text":"<p>\u518d\u6765\u770b Hardfloat \u7684\u4f8b\u5b50\u3002\u4ee3\u7801\uff1a</p> <pre><code>val exp = in(expWidth + sigWidth - 1, sigWidth - 1)\nval isZero    = exp(expWidth, expWidth - 2) === 0.U\nval isSpecial = exp(expWidth, expWidth - 1) === 3.U\n\nval out = Wire(new RawFloat(expWidth, sigWidth))\nout.isNaN  := isSpecial &amp;&amp;   exp(expWidth - 2)\n</code></pre> <p>Scala FIRRTL Compiler:</p> <pre><code>wire [8:0] rawA_exp = io_a[31:23]; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 51:21]\nwire  rawA_isZero = rawA_exp[8:6] == 3'h0; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 52:53]\nwire  rawA_isSpecial = rawA_exp[8:7] == 2'h3; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 53:53]\nwire  rawA__isNaN = rawA_isSpecial &amp; rawA_exp[6]; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 56:33]\n</code></pre> <p>\u57fa\u672c\u662f\u5fe0\u5b9e\u7684\u7ffb\u8bd1\u3002</p> <p>CIRCT Firtool:</p> <pre><code>wire        rawA_isNaN = (&amp;(io_a[31:30])) &amp; io_a[29];   // submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala:51:21, :53:{28,53}, :56:{33,41}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u5bf9\u4ee3\u7801\u8fdb\u884c\u4e86\u53d8\u6362\uff0c\u628a <code>=== 3.U</code> \u53d8\u6210\u4e86 AND\uff0c\u4e0d\u518d\u5fe0\u5b9e\u539f\u6765\u7684\u4ee3\u7801\uff0c\u800c\u662f\u91c7\u53d6\u4e86\u66f4\u52a0\u95f4\u63a5\u7684\u8868\u8fbe\u65b9\u5f0f\u3002</p> <p>\u518d\u770b\u4e00\u4e2a\u7c7b\u4f3c\u7684\u4f8b\u5b50\uff0c\u6e90\u7801\uff1a</p> <pre><code>    val signProd = rawA.sign ^ rawB.sign ^ io.op(1)\n</code></pre> <p>Scala FIRRTL Compiler:</p> <pre><code>  wire  rawA__sign = io_a[32]; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 59:25]\n  wire  rawB__sign = io_b[32]; // @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 59:25]\n  wire  signProd = rawA__sign ^ rawB__sign ^ io_op[1]; // @[submodules/berkeley-hardfloat/src/main/scala/MulAddRecFN.scala 96:42]\n</code></pre> <p>CIRCT firtool:</p> <pre><code>  wire        signProd = io_a[32] ^ io_b[32] ^ io_op[1];    // submodules/berkeley-hardfloat/src/main/scala/MulAddRecFN.scala:96:{42,49}, submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala:59:25\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cCIRCT firtool \u6bd4\u8f83\u503e\u5411\u4e8e\u5185\u8054\u4e00\u4e9b\u7b80\u5355\u7684\u8fde\u7ebf\u3002\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u4e0d\u662f\u7edd\u5bf9\u7684\uff0c\u901a\u8fc7\u4fee\u6539\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u53ef\u80fd\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#rocket-chip","title":"Rocket Chip","text":"<p>\u5728 rocket-chip-vcu128 \u9879\u76ee\u4e2d\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u8fc1\u79fb\u5230 CIRCT firtool \u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u628a FirrtlMain \u7684\u8c03\u7528\u6539\u6210\u76f4\u63a5\u8fd0\u884c firtool\u3002\u4f46\u662f\uff0c\u5728\u7efc\u5408\u7684\u65f6\u5019\uff0c\u53d1\u73b0 Vivado \u65e0\u6cd5\u63a8\u65ad\u51fa\u4e00\u4e2a SyncReadMem\uff0c\u5bfc\u81f4 LUT \u548c Register \u5360\u7528\u7279\u522b\u591a\u3002\u89e3\u51b3\u601d\u8def\u6709\u4e24\u4e2a\uff1a</p> <ol> <li>\u5229\u7528\u4e0a\u9762\u6240\u8bf4\u7684 <code>--repl-seq-mem</code> \u751f\u6210 BlackBox\uff0c\u7136\u540e\u751f\u6210 XPM Macro \u63a5\u8d77\u6765</li> <li>\u6dfb\u52a0 <code>--lower-memories</code> \u53c2\u6570\uff0c\u7b80\u5316 SRAM\uff0c\u7136\u540e Vivado \u5c31\u53ef\u4ee5\u8bc6\u522b\u51fa\u6765\u4e86\u3002</li> </ol>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2023/04/04/firtool/#\u901f\u5ea6","title":"\u901f\u5ea6","text":"<p>\u8fd0\u884c\u5927\u9879\u76ee\u7684\u65f6\u5019\uff0cScala FIRRTL Compiler \u7684\u901f\u5ea6\u660e\u663e\u6bd4 CIRCT Firtool \u6162\uff0c\u4f53\u9a8c\u8fd8\u662f\u4e0d\u9519\u7684\u3002</p>","tags":["chisel","verilog","hdl","firtool","circt"]},{"location":"hardware/2022/10/24/gnuradio-fm-radio/","title":"\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad","text":"","tags":["gnuradio","rtlsdr","grc","fm"]},{"location":"hardware/2022/10/24/gnuradio-fm-radio/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4ee5\u524d\u4e70\u8fc7 RTL-SDR\uff0c\u7528 Gqrx \u505a\u8fc7\u6536\u97f3\u673a\uff0c\u5f53\u65f6\u8fd8\u7ed9 Homebrew \u5c1d\u8bd5\u63d0\u4ea4\u8fc7\u51e0\u4e2a sdr \u76f8\u5173\u7684 pr\uff0c\u4f46\u662f\u9650\u4e8e\u77e5\u8bc6\u7684\u7f3a\u4e4f\uff0c\u540e\u6765\u5c31\u6ca1\u6709\u518d\u7ee7\u7eed\u5c1d\u8bd5\u4e86\u3002</p> <p>\u524d\u4e24\u5929\uff0c@OceanS2000 \u8bb2\u4e86\u4e00\u6b21 Tunight: \u9ad8\u7ea7\u6536\u97f3\u673a\u4f7f\u7528\u5165\u95e8\uff0c\u53c8\u52fe\u8d77\u4e86\u6211\u7684\u5174\u8da3\uff0c\u6240\u4ee5\u6211\u6765\u5c1d\u8bd5\u4e00\u4e0b\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad\u7535\u53f0\u3002</p> <p>\u6211\u6ca1\u6709\u4e0a\u8fc7\u65e0\u7ebf\u7535\u76f8\u5173\u8bfe\u7a0b\uff0c\u6240\u4ee5\u4e0b\u9762\u6709\u4e00\u4e9b\u5185\u5bb9\u53ef\u80fd\u4e0d\u6b63\u786e\u6216\u8005\u4e0d\u51c6\u786e\u3002</p>","tags":["gnuradio","rtlsdr","grc","fm"]},{"location":"hardware/2022/10/24/gnuradio-fm-radio/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u6211\u7684\u5b9e\u9a8c\u73af\u5883\u662f NixOS\uff0c\u6240\u4ee5\u662f\u7528\u4e0b\u9762\u7684\u914d\u7f6e\u6765\u5b89\u88c5 gnuradio \u7684\uff1a</p> <pre><code># SDR\n# https://github.com/NixOS/nixpkgs/pull/170253\n(gnuradio.override { extraMakeWrapperArgs = [ \"--prefix\" \"SOAPY_SDR_PLUGIN_PATH\" \":\" (soapyrtlsdr + \"/lib/SoapySDR/modules0.8/\") ]; })\nsoapysdr-with-plugins\n</code></pre> <p>\u5176\u4e2d gnuradio \u7684 override \u662f\u4e3a\u4e86\u8ba9\u5b83\u53ef\u4ee5\u627e\u5230 soapyrtlsdr \u7684\u5e93\uff0c\u5426\u5219\u5b83\u4f1a\u627e\u4e0d\u5230\u8bbe\u5907\uff1b<code>soapysdr-with-plugins</code> \u662f\u4e3a\u4e86\u63d0\u4f9b <code>SoapySDRUtil</code> \u547d\u4ee4\uff0c\u6765\u786e\u8ba4\u5b83\u53ef\u4ee5\u627e\u5230 RTL-SDR \u8bbe\u5907\uff1a</p> <pre><code>$ SoapySDRUtil --probe\n----------------------------------------------------\n-- Device identification\n----------------------------------------------------\n  driver=RTLSDR\n  hardware=R820T\n  origin=https://github.com/pothosware/SoapyRTLSDR\n  rtl=0\n\n----------------------------------------------------\n-- Peripheral summary\n----------------------------------------------------\n  Channels: 1 Rx, 0 Tx\n  Timestamps: NO\n  Other Settings:\n     * Direct Sampling - RTL-SDR Direct Sampling Mode\n       [key=direct_samp, default=0, type=string, options=(0, 1, 2)]\n     * Offset Tune - RTL-SDR Offset Tuning Mode\n       [key=offset_tune, default=false, type=bool]\n     * I/Q Swap - RTL-SDR I/Q Swap Mode\n       [key=iq_swap, default=false, type=bool]\n     * Digital AGC - RTL-SDR digital AGC Mode\n       [key=digital_agc, default=false, type=bool]\n\n----------------------------------------------------\n-- RX Channel 0\n----------------------------------------------------\n  Full-duplex: NO\n  Supports AGC: YES\n  Stream formats: CS8, CS16, CF32\n  Native format: CS8 [full-scale=128]\n  Stream args:\n     * Buffer Size - Number of bytes per buffer, multiples of 512 only.\n       [key=bufflen, units=bytes, default=262144, type=int]\n     * Ring buffers - Number of buffers in the ring.\n       [key=buffers, units=buffers, default=15, type=int]\n     * Async buffers - Number of async usb buffers (advanced).\n       [key=asyncBuffs, units=buffers, default=0, type=int]\n  Antennas: RX\n  Full gain range: [0, 49.6] dB\n    TUNER gain range: [0, 49.6] dB\n  Full freq range: [23.999, 1764] MHz\n    RF freq range: [24, 1764] MHz\n    CORR freq range: [-0.001, 0.001] MHz\n  Sample rates: 0.25, 1.024, 1.536, 1.792, 1.92, 2.048, 2.16, 2.56, 2.88, 3.2 MSps\n</code></pre>","tags":["gnuradio","rtlsdr","grc","fm"]},{"location":"hardware/2022/10/24/gnuradio-fm-radio/#\u5bfb\u627e-fm-\u5e7f\u64ad","title":"\u5bfb\u627e FM \u5e7f\u64ad","text":"<p>\u63a5\u7740\uff0c\u5c31\u53ef\u4ee5\u5728 GRC(GNURadio Companion) \u4e2d\u4ece RTL-SDR \u8bfb\u53d6\u6570\u636e\u4e86\u3002\u9996\u5148\uff0c\u6211\u6309\u7167 Guided Tutorial Hardware Considerations \u7684\u65b9\u6cd5\u8fdb\u884c\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u9891\u7387\u4e0a\u6709\u4fe1\u53f7\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684\u53c2\u6570\uff1a</p> <ul> <li>Sample Rate: 3.2MHz\uff0c\u8fd9\u91cc\u8981\u53d6\u6bd4\u8f83\u5927\uff0c\u5982\u679c\u592a\u5c0f\u53ef\u80fd\u627e\u4e0d\u5230\u4fe1\u53f7</li> </ul> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5728 100.6MHz \u9644\u8fd1\u6709\u6bd4\u8f83\u660e\u663e\u7684\u4fe1\u53f7\uff0c\u67e5\u8be2\u4e86\u4e00\u4e0b\uff0c\u8fd9\u5bf9\u5e94\u4e86\u5317\u4eac\u65b0\u95fb\u5e7f\u64ad FM100.6\uff0c\u786e\u5b9e\u662f\u4e00\u4e2a FM \u5e7f\u64ad\u7535\u53f0\u3002\u901a\u8fc7\u4fee\u6539\u4e2d\u5fc3\u9891\u7387\uff0c\u8fd8\u53ef\u4ee5\u627e\u5230\u9644\u8fd1\u7684 FM97.4 \u97f3\u4e50\u5e7f\u64ad\u548c FM 103.9 \u4ea4\u901a\u5e7f\u64ad\u3002</p> <p></p>","tags":["gnuradio","rtlsdr","grc","fm"]},{"location":"hardware/2022/10/24/gnuradio-fm-radio/#\u6536\u542c-fm-\u5e7f\u64ad","title":"\u6536\u542c FM \u5e7f\u64ad","text":"<p>\u627e\u5230\u9891\u7387\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c FM \u89e3\u8c03\u4e86\u3002\u6211\u7ee7\u7eed\u6309\u7167 FM Demod \u7684\u65b9\u6cd5\u8fdb\u884c\u642d\u5efa\uff0c\u7531\u4e8e\u6211\u7528\u7684\u662f RTL-SDR\uff0c\u8003\u8651\u5230\u5b83\u652f\u6301\u7684\u91c7\u6837\u7387\uff0c\u6211\u9009\u53d6\u4e86 2.88MHz \u91c7\u6837\u7387\uff0c\u7ecf\u8fc7\u4e00\u4e2a 1/10 \u7684 Rational Resampler \u53d8\u6210 288KHz \u91c7\u6837\u7387\uff0c\u518d\u8fdb\u884c FM \u89e3\u8c03\uff0c\u6700\u540e\u5f97\u5230 <code>288KHz / 6 = 48KHz</code> \u7684\u97f3\u9891\uff0c\u7136\u540e\u4fdd\u5b58\u5728 WAV \u6587\u4ef6\u4e2d\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684\u53c2\u6570\uff1a</p> <ul> <li>Sample Rate: 2.88MHz\uff0c\u8fd9\u91cc\u53d6\u4e86 48KHz \u7684\u6574\u6570\u500d\u6570</li> <li>Rational Resampler - Decimation: FM Demod \u7684 Decimation \u4e0d\u80fd\u592a\u5927\uff0c\u6240\u4ee5\u8fd9\u91cc\u5148\u8fdb\u884c 10 \u500d\u964d\u91c7\u6837\uff0c\u628a\u91c7\u6837\u7387\u4ece 2.88MHz \u964d\u5230 288KHz</li> <li>FM Demod - Channel Rate: \u8f93\u5165\u7684\u91c7\u6837\u7387\u662f 288KHz</li> <li>FM Demod - Audio Decimation: 6 \u500d\u964d\u91c7\u6837\uff0c\u8fd9\u6837\u8f93\u51fa\u5c31\u662f 48KHz</li> <li>FM Demod - Deviation: 75KHz\uff0c\u7ef4\u57fa\u767e\u79d1\uff1a<code>The maximum frequency deviation of the carrier is usually specified and regulated by the licensing authorities in each country. For a stereo broadcast, the maximum permitted carrier deviation is invariably \u00b175 kHz, although a little higher is permitted in the United States when SCA systems are used. For a monophonic broadcast, again the most common permitted maximum deviation is \u00b175 kHz. However, some countries specify a lower value for monophonic broadcasts, such as \u00b150 kHz.[5]</code></li> <li>FM Demod - Audio Pass/Audio Stop: \u4f4e\u901a\u6ee4\u6ce2\u5668\u53c2\u6570\uff0c\u4fdd\u7559 0-16 KHz \u7684\u9891\u7387\uff08Passband\uff09\uff0c\u5230 20KHz \u622a\u6b62\uff08Stopband\uff09</li> </ul> <p>\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u6536\u542c\u4fdd\u5b58\u4e0b\u6765\u7684 wav \u6587\u4ef6\uff0c\u53d1\u73b0\u53ef\u4ee5\u6e05\u6670\u5730\u542c\u5230\u5e7f\u64ad\u7535\u53f0\u7684\u58f0\u97f3\u3002</p> <p>\u628a\u8f93\u51fa\u6539\u6210 Audio Sink(Sample Rate = 48KHz)\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5f53\u6210\u6536\u97f3\u673a\u5e94\u7528\u6765\u8dd1\u4e86\uff1a</p> <pre><code>grcc -r rtlsdr_fm_play.grc\n</code></pre>","tags":["gnuradio","rtlsdr","grc","fm"]},{"location":"hardware/2023/05/03/i2c/","title":"I2C \u534f\u8bae","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u6570\u8bbe\u8bfe\u4e0a\uff0c\u540c\u5b66\u4eec\u5f00\u59cb\u8d2d\u4e70\u5916\u8bbe\uff0c\u5176\u4e2d\u5c31\u6d89\u53ca\u5230 I2C \u534f\u8bae\uff0c\u56e0\u6b64\u987a\u5e26\u5199\u4e00\u4e0b I2C \u534f\u8bae\u7684\u6559\u7a0b\uff0c\u5e2e\u52a9\u540c\u5b66\u4eec\u8fdb\u884c\u7406\u89e3\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#\u63a5\u53e3","title":"\u63a5\u53e3","text":"<p>I2C \u534f\u8bae\u6d89\u53ca\u5230\u4e24\u4e2a\u4fe1\u53f7\uff1a</p> <ul> <li>SCL: \u65f6\u949f\u4fe1\u53f7\uff0cMaster -&gt; Slave</li> <li>SDA\uff1a\u6570\u636e\u4fe1\u53f7\uff0cMaster &lt;-&gt; Slave</li> </ul> <p>\u7531\u4e8e\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u4fe1\u53f7\uff0c\u6240\u4ee5 SDA \u7531 Master \u548c Slave \u8f6e\u6d41\u8f93\u51fa\u3002\u4e00\u6b21\u8bf7\u6c42\u7684\u5f00\u59cb\u6761\u4ef6\u662f\uff0cSDA \u4ece 1 \u53d8\u6210 0\uff0c\u4e4b\u540e SCL \u4ece 1 \u53d8\u6210 0\u3002\u5f00\u59cb\u8bf7\u6c42\u4ee5\u540e\uff0c\u6bcf\u6b21 SCL \u4e0a\u5347\u6cbf\u91c7\u6837\u4e00\u4f4d\u7684\u6570\u636e\u3002\u8bf7\u6c42\u7ed3\u675f\u65f6\uff0cSCL \u4ece 0 \u53d8\u6210 1\uff0c\u7136\u540e SDA \u4ece 0 \u53d8\u6210 1\u3002\u4e00\u6b21\u8bf7\u6c42\u7684\u6ce2\u5f62\u5982\u4e0b\uff1a</p> <ol> <li>idle \u9636\u6bb5\uff0cscl \u548c sda \u90fd\u662f 1</li> <li>start \u9636\u6bb5\uff0c\u9996\u5148\u662f sda \u53d8\u6210 0\uff0c\u4e4b\u540e\u662f scl \u53d8\u6210 0</li> <li>data/ack \u9636\u6bb5\uff0c\u5728 scl \u4e0a\u5347\u6cbf\u91c7\u6837\u6570\u636e\uff0c\u5728 scl \u4e0b\u964d\u6cbf\uff08\u51c6\u786e\u6765\u8bf4\uff0c\u8d1f\u534a\u5468\u671f\uff09\u4fee\u6539\u6570\u636e</li> <li>stop \u9636\u6bb5\uff0c\u9996\u5148\u662f scl \u53d8\u6210 1\uff0c\u4e4b\u540e\u662f sda \u53d8\u6210 1</li> </ol> <p>\u4f20\u8f93\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u4fdd\u8bc1 sda \u5728 scl \u6b63\u534a\u5468\u671f\u7684\u65f6\u5019\u4fdd\u6301\u4e0d\u53d8\u3002\u5982\u679c\u53d8\u4e86\uff0c\u90a3\u5c31\u662f start \u6216\u8005 stop\u3002\u56e0\u6b64\uff0c\u5728 data/ack \u9636\u6bb5\uff0c\u5efa\u8bae sda \u7684\u53d8\u5316\u76f8\u6bd4 scl \u4e0b\u964d\u6cbf\u6709\u4e00\u4e2a\u5ef6\u8fdf\uff08Hold Time\uff0c\u4e00\u822c\u7684\u8981\u6c42\u662f Min 0us\uff09\u3002\u5b9e\u73b0\u65b9\u6cd5\u53ef\u80fd\u662f\u5728\u5206\u9891\u7684\u65f6\u5019\uff0c\u5ef6\u8fdf\u4e00\u4e2a\u5468\u671f\u3002</p> <p>\u8fd9\u91cc\u7684 data/ack \u6307\u7684\u5219\u662f\u4f20\u8f93\u7684\u5177\u4f53\u5185\u5bb9\uff1a\u4f8b\u5982 master \u8981\u4f20\u8f93 7 \u4f4d\u7684\u5730\u5740\u548c 1 \u4f4d\u7684\u8bfb\u4f7f\u80fd\uff0c\u54cd\u5e94\u5730\u5740\u7684 slave \u8981\u8fd4\u56de ack\uff1b\u4e4b\u540e\uff0c\u65e0\u8bba\u662f master \u8fd8\u662f slave \u53d1\u9001\u6570\u636e\uff0c\u63a5\u6536\u7684\u4e00\u65b9\u90fd\u8981\u8fd4\u56de ack\u3002ack \u662f\u4f4e\u6709\u6548\uff0c\u610f\u5473\u7740 0 \u8868\u793a\u6210\u529f\uff0c1 \u8868\u793a\u5931\u8d25\u3002</p> <p>\u7531\u4e8e sda \u5e26\u6709\u4e0a\u62c9\u7535\u963b\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709 slave \u54cd\u5e94\uff0cack \u9636\u6bb5\u7684 sda \u5c31\u4f1a\u53d8\u6210 1\uff0c\u610f\u5473\u7740\u5931\u8d25\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#i2c-\u63a7\u5236\u5668\u5b9e\u73b0","title":"I2C \u63a7\u5236\u5668\u5b9e\u73b0","text":"<p>\u7ed3\u5408\u4e0a\u9762\u7684 I2C \u6ce2\u5f62\uff0c\u53ef\u4ee5\u8bbe\u8ba1\u4e00\u4e2a\u72b6\u6001\u673a\uff1a</p> <ol> <li>INIT \u72b6\u6001\uff1a\u521d\u59cb\u60c5\u51b5\u4e0b\uff0cSCL \u548c SDA \u90fd\u4e3a 1\uff0c\u8981\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u8f6c\u79fb\u5230 START1 \u72b6\u6001</li> <li>START1 \u72b6\u6001\uff1a\u8bbe\u7f6e SDA=0\uff0c\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0c\u8f6c\u79fb\u5230 START2 \u72b6\u6001</li> <li>START2 \u72b6\u6001\uff1a\u8bbe\u7f6e SCL=0\uff0c\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0cSTART \u53d1\u9001\u5b8c\u6210\uff0c\u8f6c\u79fb\u5230 SEND \u72b6\u6001</li> <li>SEND \u72b6\u6001\uff1a\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0cSCL \u53d6\u53cd\uff0c\u5982\u679c SCL \u8981\u4ece 1 \u53d8\u6210 0\uff0c\u5ef6\u8fdf\u4e00\u4e2a\u5468\u671f\uff0c\u518d\u8f93\u51fa 1 \u4f4d\u7684\u6570\u636e\u5230 SDA \u4e0a\uff0c\u4fdd\u8bc1 SDA \u7684\u53d8\u5316\u5728 SCL \u7684\u8d1f\u534a\u5468\u671f\uff1b\u540c\u65f6\u7edf\u8ba1\u4f20\u8f93\u4f4d\u6570\uff0c\u6bcf\u4f20\u8f93 8 \u4f4d\uff0c\u5c31\u8981\u7b49\u5f85\u4e00\u4e2a\u5468\u671f\u8ba9 Slave \u54cd\u5e94 ACK\uff0c\u6b64\u65f6\u8981\u8bbe\u7f6e inout \u8f93\u51fa\u4e3a\u9ad8\u963b\u6001\uff1b\u5982\u679c\u8981\u8f6c\u6362\u4f20\u8f93\u65b9\u5411\uff0c\u5373 Master \u8981\u8bfb\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u8f6c\u79fb\u5230 RECV \u72b6\u6001\uff1b\u5982\u679c\u4f20\u8f93\u7ed3\u675f\uff0c\u8f6c\u79fb\u5230 STOP1 \u72b6\u6001</li> <li>RECV \u72b6\u6001\uff1a\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0cSCL \u53d6\u53cd\uff0c\u5982\u679c SCL \u4ece 0 \u53d8\u6210 1\uff0c\u5bf9 SDA \u8fdb\u884c\u91c7\u6837\u5e76\u4e14\u4fdd\u5b58\u4e0b\u6765\uff1b\u540c\u65f6\u7edf\u8ba1\u4f20\u8f93\u4f4d\u6570\uff0c\u6bcf\u4f20\u8f93 8 \u4f4d\uff0c\u5c31\u8981\u5728 SDA \u8f93\u51fa\u4e00\u6b21 ACK\uff1b\u5982\u679c\u4f20\u8f93\u7ed3\u675f\uff0c\u8f6c\u79fb\u5230 STOP1 \u72b6\u6001</li> <li>STOP1 \u72b6\u6001\uff1a\u8bbe\u7f6e SCL=1\uff0c\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0c\u8f6c\u79fb\u5230 STOP2 \u72b6\u6001</li> <li>STOP2 \u72b6\u6001\uff1a\u8bbe\u7f6e SDA=1\uff0c\u5f53\u8fbe\u5230\u5206\u9891\u6761\u4ef6\u65f6\uff0c\u8f6c\u79fb\u5230 INIT \u72b6\u6001</li> </ol> <p>\u5206\u9891\u662f\u56e0\u4e3a\u4e00\u822c I2C \u7684\u9891\u7387\u6bd4\u8f83\u4f4e\uff0c\u662f kHz \u7684\u91cf\u7ea7\u3002\u9700\u8981\u6309\u7167\u63a7\u5236\u903b\u8f91\u7684\u4e3b\u9891\uff0c\u7ed3\u5408\u5916\u8bbe\u80fd\u63a5\u53d7\u7684 I2C \u9891\u7387\u8303\u56f4\uff0c\u8ba1\u7b97\u51fa\u5206\u9891\u7684\u500d\u6570\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#\u4e0a\u5c42\u534f\u8bae","title":"\u4e0a\u5c42\u534f\u8bae","text":"<p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u53ef\u4ee5\u8bbe\u8ba1\u4e0a\u5c42\u534f\u8bae\uff0c\u4f8b\u5982 WM8731\uff0c\u652f\u6301\u901a\u8fc7 I2C \u5199\u5165\u5185\u90e8\u5bc4\u5b58\u5668\uff0c\u4e00\u6b21\u5199\u64cd\u4f5c\u5206\u4e3a\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>start</li> <li>master \u53d1\u9001 7 \u4f4d\u7684\u8bbe\u5907\u5730\u5740\u548c 0\uff08\u8868\u793a\u5199\uff09\uff0cslave \u53d1\u9001 ack</li> <li>master \u53d1\u9001 7 \u4f4d\u7684\u5bc4\u5b58\u5668\u5730\u5740 \u548c 1 \u4f4d\u7684\u5bc4\u5b58\u5668\u6570\u636e\uff0cslave \u53d1\u9001 ack</li> <li>master \u53d1\u9001 8 \u4f4d\u7684\u5bc4\u5b58\u5668\u6570\u636e\uff0cslave \u53d1\u9001 ack</li> <li>stop</li> </ol> <p>\u8fd9\u91cc\u7684\u7b2c\u4e8c\u6b65\u53d1\u9001\u7684 7 \u4f4d\u5730\u5740 + \u8bfb/\u5199\u4f4d\u662f\u6807\u51c6\u7684\uff0cI2C Slave \u90fd\u4f1a\u6839\u636e 7 \u4f4d\u5730\u5740\u6765\u51b3\u5b9a\u662f\u5426\u7531\u81ea\u5df1\u6765\u54cd\u5e94\u3002\u6b64\u540e\u7684\u6570\u636e\u7684\u5b9a\u4e49\uff0c\u5219\u662f\u5404\u4e2a\u82af\u7247\u6309\u7167\u5404\u81ea\u7684\u534f\u8bae\u6765\u8fdb\u884c\u3002</p> <p>\u4e3a\u4e86\u8ba9\u591a\u4e2a\u540c\u578b\u53f7 I2C \u82af\u7247\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff0c\u901a\u5e38\u82af\u7247\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5f15\u811a\u6765\u914d\u7f6e\u5b83\u7684\u5730\u5740\uff0c\u90a3\u4e48\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u7ed9\u4e0d\u540c\u7684\u82af\u7247\u8bbe\u7f6e\u4e0d\u540c\u7684\u5730\u5740\uff0c\u5c31\u89e3\u51b3\u4e86\u5730\u5740\u51b2\u7a81\u7684\u95ee\u9898\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#i2c-eeprom","title":"I2C EEPROM","text":"<p>\u4ee5 AT24C32/AT24C64 \u4e3a\u4f8b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a I2C \u63a5\u53e3\u7684 EEPROM\uff0c\u652f\u6301\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u5199\u5165\u6570\u636e\uff1astart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cW\uff0cACK\uff1b\u5199\u5165\u5730\u5740\u7684\u9ad8 8 \u4f4d\uff0cack\uff1b\u5199\u5165\u5730\u5740\u7684\u4f4e 8 \u4f4d\uff0cack\uff1b\u6570\u636e\u7684\u6bcf\u4e2a\u5b57\u8282\uff0cack\uff1b\u6700\u7ec8 stop\u3002</p> <p>\u8bfb\u53d6\u6570\u636e\uff1astart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cW\uff0cack\uff1b\u8bfb\u53d6\u5730\u5740\u7684\u9ad8 8 \u4f4d\uff0cack\uff1b\u8bfb\u53d6\u5730\u5740\u7684\u4f4e 8 \u4f4d\uff0cack\uff1bstart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cR\uff0cack\uff1b\u6570\u636e\u7684\u6bcf\u4e2a\u5b57\u8282\uff0cack\uff1b\u6700\u7ec8\u4e0d\u60f3\u8bfb\u7684\u65f6\u5019 nack\uff0cstop\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u8bbe\u8ba1\u6210\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ea\u6709 Master \u5230 Slave \u7684\u6570\u636e\u4f20\u8f93\uff0c\u53cd\u8fc7\u6765\u8bfb\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ea\u6709 Slave \u5230 Master \u7684\u6570\u636e\u4f20\u8f93\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u4f20\u8f93\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u8981\u9996\u5148\u201c\u5199\u5165\u201d\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\uff0c\u628a\u6570\u636e\u8bfb\u51fa\u6765\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#i2c-audio-codec","title":"I2C Audio Codec","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u7684 WM8731 \u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a Audio Codec\uff0c\u53ef\u4ee5\u901a\u8fc7 I2C \u5bf9\u5176\u5bc4\u5b58\u5668\u8fdb\u884c\u5199\u5165\u3002WM8731 \u7684\u5bc4\u5b58\u5668\u5730\u5740\u6709 9 \u4f4d\uff0c\u6bcf\u4e2a\u5bc4\u5b58\u5668\u6709 8 \u4f4d\u7684\u6570\u636e\uff0c\u56e0\u6b64\u5199\u5165\u6d41\u7a0b\u662f\uff1astart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cW\uff0cack\uff1b7 \u4f4d\u5bc4\u5b58\u5668\u5730\u5740\uff0c1 \u4f4d\u5bc4\u5b58\u5668\u6570\u636e\uff0cack\uff1b8 \u4f4d\u5bc4\u5b58\u5668\u6570\u636e\uff0cack\uff1bstop\u3002</p>","tags":["i2c"]},{"location":"hardware/2023/05/03/i2c/#i2c-sensor","title":"I2C Sensor","text":"<p>\u4e3e\u4e00\u4e2a\u4f20\u611f\u5668\u7684\u4f8b\u5b50\uff1aPAJ7620U2: Integrated Gesture Recognition Sensor \uff0c\u5b83\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5bc4\u5b58\u5668\u8bfb\u5199\u7684\u63a5\u53e3\uff0c\u652f\u6301\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u5355\u6b21\u5199\u5165\uff1astart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cW\uff0cack\uff1b8 \u4f4d\u5730\u5740\uff0cack\uff1b8 \u4f4d\u6570\u636e\uff0cack\uff1bstop\u3002</p> <p>\u5355\u6b21\u8bfb\u53d6\uff1astart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cW\uff0cack\uff1b8 \u4f4d\u5730\u5740\uff0cack\uff1bstop\uff1bstart\uff0c7 \u4f4d\u8bbe\u5907\u5730\u5740\uff0cR\uff0cack\uff1b8 \u4f4d\u6570\u636e\uff0cnack\uff1bstop\u3002\u8fd9\u91cc\u7684\u8bfb\u53d6\u4e5f\u62c6\u6210\u4e86\u4e24\u6b65\uff1a\u7b2c\u4e00\u6b65\u201c\u5199\u5165\u201d\u8bfb\u53d6\u7684\u5730\u5740\uff0c\u7b2c\u4e8c\u6b65\u8bfb\u53d6\u51fa\u6570\u636e\u3002\u6700\u540e\u7684 nack \u8868\u793a master \u4e0d\u9700\u8981\u8bfb\u53d6\u66f4\u591a\u7684\u6570\u636e\u3002</p> <p>\u5982\u679c\u8981\u6279\u91cf\u8bfb\u53d6\u7684\u8bdd\uff0c\u53ea\u8981\u5728\u5355\u6b21\u8bfb\u53d6\u7684\u57fa\u7840\u4e0a\uff0c\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u53d1 ack\uff0c\u7b49\u5230\u4e0d\u9700\u8981\u7ee7\u7eed\u8bfb\u7684\u65f6\u5019\u518d\u53d1 nack\uff0c\u5c31\u53ef\u4ee5\u8fde\u7eed\u8bfb\u53d6\u591a\u4e2a\u5bc4\u5b58\u5668\u7684\u6570\u636e\u3002</p> <p>\u8fd9\u4e9b\u547d\u4ee4\u683c\u5f0f\u548c\u4e0a\u9762\u7684 I2C EEPROM \u57fa\u672c\u662f\u4e00\u6837\u7684\u3002</p> <p>\u989c\u8272\u4f20\u611f\u5668 TCS3472 \u7684\u547d\u4ee4\u683c\u5f0f\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p>","tags":["i2c"]},{"location":"hardware/2024/09/21/ibm-z15-branch-predictor/","title":"IBM z15 Mainframe CPU \u5206\u652f\u9884\u6d4b\u5668\u5b66\u4e60\u7b14\u8bb0","text":"","tags":["cpu","microarchitecture","ibm","bp"]},{"location":"hardware/2024/09/21/ibm-z15-branch-predictor/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>ISCA 2020 \u7684\u4e00\u7bc7\u6587\u7ae0 The IBM z15 High Frequency Mainframe Branch Predictor Industrial Product \u975e\u5e38\u8be6\u7ec6\u5730\u89e3\u6790\u4e86 IBM z15 Mainframe CPU \u7684\u5206\u652f\u9884\u6d4b\u5668\u8bbe\u8ba1\u3002\u672c\u6587\u662f\u5bf9\u8fd9\u7bc7\u8bba\u6587\u7684\u5b66\u4e60\u548c\u6574\u7406\u7684\u7b14\u8bb0\u3002</p>","tags":["cpu","microarchitecture","ibm","bp"]},{"location":"hardware/2024/09/21/ibm-z15-branch-predictor/#\u8bbe\u8ba1\u601d\u8def","title":"\u8bbe\u8ba1\u601d\u8def","text":"<p>\u8bba\u6587\u7684\u7b2c\u4e8c\u8282 Branch Prediction Design Considerations \u63d0\u5230\u4e86\u5b83\u8bbe\u8ba1\u5206\u652f\u9884\u6d4b\u5668\u65f6\u9700\u8981\u8003\u8651\u7684\u4e8b\u60c5\u3002z15 \u5904\u7406\u5668\u9762\u5411\u7684\u662f\u5177\u6709\u5f88\u5927\u6307\u4ee4 footprint \u7684\u7a0b\u5e8f\uff0c\u4e3a\u6b64\u51c6\u5907\u4e86 128KB \u7684 L1 ICache\uff0c\u4ee5\u53ca 4MB \u7684 L2 Private ICache\u3002\u4e3a\u4e86\u652f\u6491 MB \u7ea7\u522b\u7684\u6307\u4ee4\uff0cBTB \u4e5f\u8981\u76f8\u5e94\u589e\u5927\u3002</p> <p>IBM z \u7cfb\u5217\u7528\u7684\u662f\u53d8\u957f\u6307\u4ee4\u96c6\uff0c\u6307\u4ee4\u957f\u5ea6\u53ef\u80fd\u662f 2 \u6216 4 \u6216 6 \u5b57\u8282\uff0c\u5e73\u5747\u957f\u5ea6\u662f 5 \u5b57\u8282\u3002\u8003\u8651\u5230\u6bcf 5 \u6761\u6307\u4ee4\u6709\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u90a3\u5c31\u662f\u6bcf 25 \u4e2a\u5b57\u8282\u6709\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u90a3\u4e48 4MB \u7684 L2 ICache \u5e73\u5747\u4e0b\u6765\u53ef\u80fd\u6709 164K \u6761\u5206\u652f\u3002\u56e0\u6b64\uff0cz15 \u8bbe\u8ba1\u4e86\u53ef\u4ee5\u4fdd\u5b58 128K \u6761\u5206\u652f\u7684 L2 BTB\u3002z15 \u7684\u6d41\u6c34\u7ebf\u5f88\u957f\uff0c\u5206\u652f\u9884\u6d4b\u9519\u8bef\u4f1a\u5e26\u6765 26 \u4e2a\u5468\u671f\u7684\u5f00\u9500\uff0c\u56e0\u6b64\u5206\u652f\u9884\u6d4b\u7684\u6b63\u786e\u7387\u5c31\u5f88\u91cd\u8981\u3002z15 \u5904\u7406\u5668\u8bbe\u8ba1\u4e86\u4e24\u7ea7\u7684 BTB\uff0cL1 BTB\uff08\u8bba\u6587\u4e2d\u79f0 BTB1\uff09\u5bb9\u91cf\u662f 16K=2K x 8 way\uff0cL2 BTB\uff08\u8bba\u6587\u4e2d\u79f0 BTB2\uff09\u5bb9\u91cf\u662f 128K=32K x 4-way\u3002\u4e3a\u4e86\u52a0\u901f L1 BTB \u7684\u9884\u6d4b\uff0cz15 \u6709 Column Predictor\uff08CPRED\uff0c1K x 8\uff09\u3002\u4e3a\u4e86\u9884\u6d4b\u5206\u652f\u7684\u65b9\u5411\uff0cz15 \u8fd8\u5f15\u5165\u4e86 PHT\uff08short \u548c long \u4e24\u4e2a PHT\uff0c\u90fd\u662f 512 x 8\uff09\uff0cPerceptron\uff0816 x 2\uff09\u3002\u4e3a\u4e86\u9884\u6d4b\u95f4\u63a5\u5206\u652f\u548c\u8fd4\u56de\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\uff0cz15 \u8bbe\u8ba1\u4e86 Changing Target Buffer\uff08CTB\uff0c2K x 1\uff09\u548c Call/Return Stack\uff08CRS\uff09\u3002</p>","tags":["cpu","microarchitecture","ibm","bp"]},{"location":"hardware/2024/09/21/ibm-z15-branch-predictor/#\u5177\u4f53\u5b9e\u73b0","title":"\u5177\u4f53\u5b9e\u73b0","text":"<p>z15 \u91c7\u7528\u7684\u662f\u5206\u79bb\u5f0f\u524d\u7aef\uff0c\u5206\u652f\u9884\u6d4b\u5668\u6709 6 \u7ea7\u7684\u6d41\u6c34\u7ebf\uff0c\u6bcf\u4e00\u7ea7\u5206\u522b\u8bb0\u4e3a b0-b5\u3002\u5404\u7ea7\u7684\u529f\u80fd\u5982\u4e0b\uff1a</p> <p>Indexing into the BTB arrays occurs in the b0 cycle, which when superimposed over the z15 core pipeline in figure 1 coincides with the very stage after a restart, but deviates away from the core pipeline after that. An array access cycle is in b1. Metadata from the arrays is obtained in b2, and hit detection and direction application on a per branch basis performed across the b2 and b3 cycles. Ordering of the branches based on their low-order instruction address bits is also done in b3. In b4, the final prediction is prepared, including selection of the appropriate target address provider. The prediction is presented to the consumers, namely the IDU and ICM, in the b5 cycle.</p> <p>\u5982\u679c\u7b49\u5230 b5 \u624d\u51fa\u9884\u6d4b\u7ed3\u679c\u5c31\u6bd4\u8f83\u6162\u4e86\uff0c\u56e0\u6b64\u5b83\u8fd8\u53ef\u4ee5\u5728 b2 \u5468\u671f\u51fa\u7ed3\u679c\uff0c\u5229\u7528\u7684\u662f CPRED \u9884\u6d4b\u5668\u3002\u5728 CPRED \u5de5\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e24\u4e2a\u5468\u671f\u53ef\u4ee5\u9884\u6d4b\u4e00\u4e2a taken branch\uff0c\u5982\u679c CPRED \u6ca1\u6709\u9884\u6d4b\uff0c\u90a3\u5c31\u9700\u8981\u6bcf 5 \u4e2a\u5468\u671f\u9884\u6d4b\u4e00\u4e2a taken branch\uff0c\u800c\u5728 SMT2 \u6a21\u5f0f\u4e0b\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u8f6e\u6d41\u8bbf\u95ee BTB\uff0c\u6b64\u65f6\u6bcf\u4e2a\u7ebf\u7a0b\u9700\u8981\u6bcf 6 \u4e2a\u5468\u671f\u9884\u6d4b\u4e00\u4e2a taken branch\u3002</p> <p>z15 \u7684 L1 BTB \u7684 8-way \u610f\u5473\u7740\u5728\u4e00\u4e2a\u5468\u671f\u53ef\u4ee5\u8fdb\u884c 8 \u6761\u5206\u652f\u7684\u9884\u6d4b\uff0c\u4ece 64B \u7684\u6307\u4ee4\u4e2d\uff0c\u8bc6\u522b\u6700\u591a 8 \u6761\u6307\u4ee4\uff0c\u4ece\u4e2d\u627e\u5230\u7b2c\u4e00\u6761\u8df3\u8f6c\u7684\u5206\u652f\u3002\u4e3a\u4e86\u4f18\u5316\u6027\u80fd\u548c\u529f\u8017\uff0c\u5728\u9762\u5bf9\u8fde\u7eed\u7684\u65e0\u5206\u652f\u6307\u4ee4\u7684\u4ee3\u7801\u65f6\uff0c\u53ef\u4ee5\u5feb\u901f\u8df3\u8fc7\uff0c\u8fd9\u91cc\u7528\u7684\u662f SKOOT\uff08Skip Over OffseT\uff09\u9884\u6d4b\u5668\uff0c\u5728 BTB \u7684\u5206\u652f\u8bb0\u5f55\u4e86\u5230\u4e0b\u4e00\u6b21\u5206\u652f\u7684\u8ddd\u79bb\uff0c\u5982\u679c\u8fd9\u4e2a\u8ddd\u79bb\u5f88\u957f\uff0c\u90a3\u5c31\u53ef\u4ee5\u5feb\u901f\u8df3\u8fc7\u82e5\u5e72\u4e2a 64B \u6307\u4ee4\u5757\u3002</p> <p>\u4e3a\u4e86\u9884\u6d4b\u5206\u652f\u7684\u65b9\u5411\uff0c\u5728 L1 BTB \u91cc\uff0c\u4e5f\u4fdd\u5b58\u4e86 2 bit saturating counter\uff0c\u4e5f\u5c31\u662f BTB \u4e5f\u5145\u5f53\u4e86\u901a\u5e38\u8bf4\u7684 BHT\u3002\u9664\u4e86 BHT \u4ee5\u5916\uff0c\u4e3a\u4e86\u9884\u6d4b\u5206\u652f\u65b9\u5411\uff0cz15 \u8bb0\u5f55\u4e86 Global Path Vector\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684 PHR\uff0c\u8bb0\u5f55\u6700\u8fd1\u7684 n \u6761 taken branch \u7684\u5386\u53f2\u3002z14 \u4e4b\u524d\uff0cGPV \u8bb0\u5f55\u4e86\u6700\u8fd1 9 \u6761 taken branch \u7684\u5386\u53f2\uff0cz14 \u548c z15\uff0cGPV \u8bb0\u5f55\u4e86\u6700\u8fd1 17 \u6761 taken branch \u7684\u5386\u53f2\u3002GPV \u4e2d\u6bcf\u4e2a taken branch \u63d0\u4f9b 2 bit \u7684\u4fe1\u606f\u3002</p> <p>GPV \u548c PC \u4f5c\u4e3a TAGE \u7684\u8f93\u5165\uff0c\u8fdb\u884c\u65b9\u5411\u9884\u6d4b\u3002z15 \u91c7\u7528\u4e86\u4e24\u4e2a TAGE PHT\uff0c\u90fd\u662f 512 x 8 way\uff0c\u4e00\u5171\u662f 8K \u5206\u652f\u7684\u5bb9\u91cf\uff0c\u5386\u53f2\u77ed\u7684 TAGE PHT \u53ea\u7528\u6700\u8fd1 9 \u6761 taken branch \u7684\u5386\u53f2\uff0c\u5386\u53f2\u957f\u7684 TAGE PHT \u5219\u4f1a\u7528\u5b8c\u6574\u7684 17 \u6761 taken branch \u7684\u5386\u53f2\u3002\u8bba\u6587\u91cc\u6bd4\u8f83\u8be6\u7ec6\u5730\u63cf\u8ff0\u4e86 TAGE \u7684\u5b9e\u73b0\uff0c\u57fa\u672c\u548c A. Seznec \u7684\u8bbe\u8ba1\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u505a\u4e86 USE_ALT_ON_NA \u7684\u6539\u8fdb\u3002\u9664\u4e86 TAGE \u4ee5\u5916\uff0cz15 \u8fd8\u6709 Perceptron \u9884\u6d4b\u5668\uff0c\u6709 32 \u4e2a entry\uff0c16 x 2 way\uff0c\u628a\u7cfb\u6570\u548c GPV \u8fdb\u884c\u70b9\u79ef\uff08GPV \u7684\u6bcf\u4e2a bit \u6620\u5c04\u4e3a 1 \u548c -1\uff09\uff0c\u6839\u636e\u7ed3\u679c\u7684\u7b26\u53f7\u51b3\u5b9a\u8df3\u8f6c\u7684\u65b9\u5411\u3002</p> <p>\u56e0\u6b64\u4e00\u5171\u6709 BHT\u3001TAGE \u548c Perceptron \u53ef\u4ee5\u63d0\u4f9b\u65b9\u5411\u9884\u6d4b\u3002\u4e3a\u4e86\u5224\u65ad\u7528\u54ea\u4e2a\u9884\u6d4b\u5668\u6765\u63d0\u4f9b\u6700\u7ec8\u7684\u65b9\u5411\uff0c\u89c4\u5219\u662f\uff1a</p> <ol> <li>\u5bf9\u4e8e\u6761\u4ef6\u5206\u652f\uff0c\u8bb0\u5f55\u5b83\u662f\u5426\u66fe\u7ecf\u8df3\u548c\u4e0d\u8df3\u8fc7\uff08Bidirectional\uff09\uff0c\u5982\u679c\u53ea\u5f80\u4e00\u4e2a\u65b9\u5411\u8df3\uff0c\u5c31\u67e5 BHT</li> <li>\u5982\u679c\u4e24\u4e2a\u65b9\u5411\u90fd\u8df3\u8fc7\uff0c\u6b64\u65f6 Perceptron \u4f18\u5148\u7ea7\u66f4\u9ad8\uff0c\u5982\u679c Perceptron \u547d\u4e2d\u4e14\u7f6e\u4fe1\u5ea6\u9ad8\uff0c\u5219\u7528 Perceptron \u7684\u7ed3\u679c</li> <li>\u5426\u5219\u8003\u5bdf TAGE \u7684\u9884\u6d4b\u7ed3\u679c\uff0c\u5982\u679c TAGE \u547d\u4e2d\u4e14\u7f6e\u4fe1\u5ea6\u9ad8\uff0c\u5219\u7528 TAGE \u7684\u7ed3\u679c</li> <li>\u5982\u679c Perceptron \u548c TAGE \u90fd\u6ca1\u6709\u547d\u4e2d\uff0c\u518d\u7528 BHT \u7684\u7ed3\u679c</li> </ol> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u4f18\u5148\u7ea7\u662f Perceptron &gt; TAGE &gt; BHT\u3002</p> <p>\u4e3a\u4e86\u9884\u6d4b\u95f4\u63a5\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\uff0cz15 \u4e0a PC \u548c GPV \u901a\u8fc7\u54c8\u5e0c\u6620\u5c04\u5230 CTB\uff08Changing Target Buffer\uff09\u7684\u8868\u9879\u4e0a\uff0c\u6bcf\u4e2a\u8868\u9879\u8bb0\u5f55\u4e86\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\u3002</p> <p>\u6709\u610f\u601d\u7684\u662f\uff0cz15 \u6307\u4ee4\u96c6\u91cc\u6ca1\u6709\u5355\u72ec\u7684 call \u548c return \u6307\u4ee4\uff0c\u56e0\u6b64\u786c\u4ef6\u9700\u8981\u8bc6\u522b\u95f4\u63a5\u5206\u652f\u91cc\u7684 call \u548c return \u6a21\u5f0f\u3002\u8bba\u6587\u91cc\u4ecb\u7ecd\u4e86\u5177\u4f53\u7684\u8bc6\u522b\u65b9\u6cd5\uff0c\u4f46\u76ee\u524d\u4e3b\u6d41\u6307\u4ee4\u96c6\u90fd\u505a\u4e86\u533a\u5206\uff08\u8981\u4e48\u662f\u5355\u72ec\u7684\u6307\u4ee4\uff0c\u8981\u4e48\u5efa\u8bae\u7f16\u8bd1\u5668\u7528\u7279\u5b9a\u7684\u5bc4\u5b58\u5668\uff0c\u6807\u8bb0 call \u548c return\uff09\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u6ca1\u5565\u53c2\u8003\u4ef7\u503c\u3002</p>","tags":["cpu","microarchitecture","ibm","bp"]},{"location":"hardware/2022/12/06/infiniband-notes/","title":"InfiniBand \u5b66\u4e60\u7b14\u8bb0","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#\u6982\u89c8","title":"\u6982\u89c8","text":"<p>InfiniBand \u7684\u7f51\u7edc\u5206\u4e3a\u4e24\u5c42\uff0c\u7b2c\u4e00\u5c42\u662f\u7531 End Node \u548c Switch \u7ec4\u6210\u7684 Subnet\uff0c\u7b2c\u4e8c\u5c42\u662f\u7531 Router \u8fde\u63a5\u8d77\u6765\u7684\u82e5\u5e72\u4e2a Subnet\u3002\u6709\u70b9\u7c7b\u4f3c\u4ee5\u592a\u7f51\u4ee5\u53ca IP \u7684\u5173\u7cfb\uff0c\u540c\u4e00\u4e2a\u4e8c\u5c42\u5185\u901a\u8fc7 MAC \u5730\u5740\u8f6c\u53d1\uff0c\u4e09\u5c42\u95f4\u901a\u8fc7 IP \u5730\u5740\u8f6c\u53d1\u3002</p> <p>\u5728 IB \u7f51\u7edc\u4e2d\uff0cEnd Node \u4e00\u822c\u662f\u63d2\u5728\u7ed3\u70b9\u4e0a\u7684 IB \u5361\uff08Host Channel Adapter\uff0cHCA\uff09\u6216\u8005\u662f\u5b58\u50a8\u7ed3\u70b9\u4e0a\u7684 Target Channel Adapter\u3002End Node \u4e4b\u95f4\u901a\u8fc7 Switch \u8fde\u63a5\u6210\u4e00\u4e2a Subnet\uff0c\u7531 Subnet Manager \u7ed9\u6bcf\u4e2a Node \u548c Switch \u5206\u914d Local ID\uff0c\u540c\u4e00\u4e2a Subnet \u4e2d\u901a\u8fc7 LID\uff08Local ID\uff09\u6765\u8def\u7531\u3002\u4f46\u662f LID \u4f4d\u6570\u6709\u9650\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u53ef\u4ee5\u7528 Router \u8fde\u63a5\u591a\u4e2a Subnet\uff0c\u6b64\u65f6\u8981\u901a\u8fc7 GID\uff08Global ID\uff09\u6765\u8def\u7531\u3002</p> <p></p> <p></p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#queue-pair","title":"Queue Pair","text":"<p>\u56de\u987e\u4e00\u4e0b\uff0c\u4ee5\u592a\u7f51\u7f51\u5361\u5728\u4f20\u8f93\u7684\u65f6\u5019\uff0c\u6d89\u53ca\u5230\u4e24\u7c7b\u961f\u5217\uff0c\u5206\u522b\u7528\u4e8e\u53d1\u9001\u548c\u63a5\u6536\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u8d1f\u8d23\u7ef4\u62a4\u3002\u5f53\u8981\u53d1\u9001\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5411\u53d1\u9001\u961f\u5217\u4e0a\u63d2\u5165\u4e00\u9879\uff0c\u5e76\u63d0\u4f9b\u8981\u53d1\u9001\u7684\u6570\u636e\u7684\u6307\u9488\uff0c\u7136\u540e\u8ba9\u7f51\u5361\u81ea\u5df1\u8fdb\u884c DMA \u5e76\u53d1\u9001\uff1b\u540c\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4f1a\u5206\u914d\u4e00\u4e9b\u7f13\u51b2\u533a\uff0c\u586b\u5165\u63a5\u6536\u961f\u5217\uff0c\u5f53\u7f51\u5361\u63a5\u6536\u5230\u65b0\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fdb\u884c DMA \u628a\u6570\u636e\u586b\u5165\u7f13\u51b2\u533a\uff0c\u7136\u540e\u901a\u8fc7\u4e2d\u65ad\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u53bb\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u5728 IB \u4e2d\uff0c\u4e5f\u6709\u7c7b\u4f3c\u7684\u6982\u5ff5\uff0c\u5c31\u662f Queue Pair\uff08QP\uff09\uff0c\u5176\u5b9e\u5c31\u662f Send Queue \u548c Receive Queue \u6210\u5bf9\u51fa\u73b0\u3002\u53e6\u5916\u8fd8\u6709 Completion Queue\uff0c\u5f53\u8bf7\u6c42\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u4f1a\u5728 CQ \u4e0a\u5f97\u5230\u7ed3\u679c\u3002</p> <p></p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#transport-functions","title":"Transport Functions","text":"<p>\u6709\u4e86 Queue Pair \u4ee5\u540e\uff0c\u4e0a\u5c42\u5e94\u7528\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\u4e86\uff1a</p> <ul> <li>SEND\uff1a\u53d1\u9001\u6570\u636e</li> <li>RESYNC\uff1a\u540c\u6b65 PSN</li> <li>RDMA WRITE\uff1a\u8fdc\u7a0b\u5199\u5165\u5185\u5b58</li> <li>RDMA READ\uff1a\u8fdc\u7a0b\u8bfb\u53d6\u5185\u5b58</li> <li>ATOMIC\uff1a\u8fdc\u7a0b\u8fdb\u884c\u5185\u5b58\u539f\u5b50\u64cd\u4f5c</li> </ul> <p>\u6709\u53d1\u5c31\u6709\u6536\uff0c\u63a5\u6536\u65b9\u9700\u8981\u5728 Receive Queue \u4e2d\u51c6\u5907\u597d\u63a5\u53d7\u6570\u636e\u7684\u7f13\u51b2\u533a\u3002</p> <p>\u6b64\u5916\uff0c\u4e3a\u4e86\u5728\u4fdd\u8bc1\u5b89\u5168\u6027\u4ee5\u53ca\u6b63\u786e\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u5141\u8bb8 RDMA \u64cd\u4f5c\uff0c\u5e94\u7528\u9700\u8981\u9996\u5148\u8fdb\u884c Memory Binding \u64cd\u4f5c\uff0c\u6807\u8bb0\u54ea\u4e9b\u5185\u5b58\u533a\u57df\u53ef\u4ee5\u901a\u8fc7 RDMA \u8bbf\u95ee\uff0c\u5e76\u4e14\u751f\u6210\u4e00\u4e2a <code>R_KEY</code> \u6765\u6807\u8bb0\u8fd9\u7247\u5185\u5b58\u533a\u57df\u3002\u4e4b\u540e\u7684 RDMA WRITE \u548c RDMA READ \u9700\u8981\u4f7f\u7528\u540c\u6837\u7684 <code>R_KEY</code> \u6765\u8fdb\u884c\u8bbf\u95ee\u3002</p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#transport-services","title":"Transport Services","text":"<p>IB \u652f\u6301\u56db\u79cd Transport Service\uff0c\u5f53 QP \u5728\u521b\u5efa\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4ece\u4ee5\u4e0b\u7684\u56db\u79cd\u4e2d\u9009\u62e9\uff1a</p> <ol> <li>Reliable Connection(RC)</li> <li>Reliable Datagram(RD)</li> <li>Unreliable Datagram(UD)</li> <li>Unreliable Connection(UC)</li> </ol> <p>\u5bf9\u4e8e IPoIB \u7b49\u4f20\u8f93\u5176\u4ed6\u534f\u8bae\u7684\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c01\u88c5\uff1a</p> <ol> <li>Raw IPv6 Datagram</li> <li>Raw Ethertype Datagram</li> </ol> <p>\u51e0\u79cd Transport Service \u7684\u5bf9\u6bd4\uff1a</p> <p></p> <p>\u5728\u7f16\u7a0b\u7684\u65f6\u5019\uff0c\u9700\u8981\u77e5\u9053\u5bf9\u7aef\u7684 LID\uff08Local ID\uff09\u3001QPN\uff08Queue Pair Number\uff09\u548c PSN\uff08Packet Sequence Number\uff09\uff0c\u624d\u80fd\u8fdb\u884c\u901a\u4fe1\u3002\u5982\u679c\u8981\u8fdb\u884c RDMA\uff0c\u8fd8\u9700\u8981\u77e5\u9053 <code>R_Key</code> \u548c\u5185\u5b58\u5730\u5740\u3002\u8fd9\u4e9b\u4fe1\u606f\u4e00\u822c\u662f\u901a\u8fc7 TCP \u6765\u4f20\u8f93\u7684\u3002</p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#switches","title":"Switches","text":"<p>\u5728 IB \u7f51\u7edc\u4e2d\uff0c\u4ea4\u6362\u673a\u7528\u6765\u8fde\u63a5\u540c\u4e00\u4e2a IB Subnet \u4e2d\u7684 End Node\u3002\u5728 Subnet \u4e2d\uff0c\u901a\u8fc7 Local ID \u6765\u8def\u7531\uff0c\u800c Local ID \u662f\u7531 Subnet Manager \u8d1f\u8d23\u5206\u914d\u7684\u3002Subnet Manager \u626b\u63cf\u7f51\u7edc\u4e2d\u7684\u4ea4\u6362\u673a\u548c\u8282\u70b9\uff0c\u52a8\u6001\u5206\u914d LID\uff0c\u5e76\u4e14\u6839\u636e\u7f51\u7edc\u62d3\u6251\uff0c\u8ba1\u7b97\u51fa\u4ea4\u6362\u673a\u7684\u8f6c\u53d1\u8868\u3002</p> <p>\u4ea4\u6362\u673a\u7684\u8f6c\u53d1\u8868\u5c31\u662f\u4e00\u4e2a LID \u5230\u7aef\u53e3\u53f7\u7684\u6620\u5c04\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e3a\u7ebf\u6027\u8868\uff08\u6570\u7ec4\uff0c\u4e0b\u6807\u662f LID\uff09\u6216\u968f\u673a\u8bbf\u95ee\u8868\uff08CAM\uff0c\u7528 LID \u67e5\u7aef\u53e3\u53f7\uff09\u3002</p> <p>\u7531\u4e8e LID \u552f\u4e00\u786e\u5b9a\u4e86\u8f6c\u53d1\u8def\u5f84\uff0c\u6240\u4ee5\u5982\u679c\u7f51\u7edc\u6709\u5197\u4f59\uff0c\u4ece\u4e00\u4e2a End Node \u5230\u53e6\u4e00\u4e2a End Node \u6709\u591a\u6761\u8def\u5f84\uff0c\u90a3\u4e48\u4e3a\u4e86\u5229\u7528\u4e0a\u4e0d\u540c\u8def\u5f84\u7684\u5e26\u5bbd\uff0c\u6bcf\u6761\u8def\u5f84\u90fd\u8981\u5206\u914d\u4e00\u4e2a LID\u3002\u4e3a\u4e86\u7b80\u5316\uff0c\u5728\u5206\u914d\u7684\u65f6\u5019\uff0cSubnet Manager \u4f1a\u5206\u914d\u4e00\u6bb5\u8fde\u7eed\u7684 LID\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u662f <code>2^{LMC}</code> \u4e2a\uff0cLMC \u662f LID Mask Control\uff0c\u8868\u793a\u4f4e\u591a\u5c11\u4f4d Mask \u6389\u5c5e\u4e8e\u540c\u4e00\u4e2a Endpoint\u3002\u4f8b\u5982 Base LID=4\uff0cLMC=2\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u5206\u914d\u7684 LID \u662f <code>{4,5,6,7}</code>\u3002</p> <p>opensm \u7684 LID \u5206\u914d\u7b97\u6cd5\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u627e\u5230\u3002</p> <p>LID \u662f\u4e00\u4e2a 16 \u4f4d\u7684\u6574\u6570\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a Subnet \u4e2d\u53ef\u4ee5\u8fde\u63a5\u7684\u8bbe\u5907\u6570\u91cf\u6709\u9650\u3002\u66f4\u591a\u7684\u8bdd\u5c31\u9700\u8981\u591a\u4e2a Subnet\u3002LID \u5b9a\u4e49\uff1a</p> <ul> <li>0x0000\uff1aReserved</li> <li>0xFFFF\uff1aPermissive\uff0c\u76ee\u6807 QP0</li> <li>0x0001-0xBFFF\uff1aUnicast</li> <li>0xC000-0xFFFE\uff1aMulticast</li> </ul> <p>\u5982\u679c\u60f3\u8981\u505a\u9694\u79bb\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a Partition\uff0c\u7c7b\u4f3c VLAN \u7684\u6982\u5ff5\uff0c\u901a\u8fc7 <code>P_Key</code> \u6765\u5224\u65ad\u662f\u5426\u5c5e\u4e8e\u540c\u4e00\u4e2a Partition\u3002</p>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#\u5e38\u7528\u547d\u4ee4","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u5e38\u7528\u7684\u53ef\u4ee5\u7528\u6765\u8c03\u8bd5 IB \u7684\u547d\u4ee4\uff1a</p> <ul> <li>ibstat</li> <li>ibhosts</li> <li>ibswitches</li> <li>iblinkinfo</li> <li>ibping</li> <li>ibdiagnet</li> <li>qperf</li> </ul> <p>\u4f7f\u7528 qperf/ib_send_lat \u53ef\u4ee5\u6d4b\u91cf\u5e26\u5bbd\u548c\u5ef6\u8fdf\u3002\u4e00\u4e2a\u6d4b\u8bd5\u4f8b\u5b50\uff1a</p> <ul> <li>\u4ee5\u592a\u7f51\uff08udp_lat\uff09\uff1a24.5 us</li> <li>IPoIB (udp_lat): 8.7 us</li> <li>IB (rc, ib_send_lat): 1.02 us</li> <li>IB (rc_lat): 3.6 ~ 4.6 us</li> <li>IB (uc_lat): 4.2 ~ 5.5 us</li> <li>IB (ud_lat): 5.5 ~ 6.4 us</li> </ul>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2022/12/06/infiniband-notes/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Infiniband Architecture Overview</li> <li>InfiniBand Architecture Specification Volume 1 Release 1.2.1</li> <li>InfiniBand Architecture Specification Volume 2 Release 1.4</li> <li>An Introduction to the InfiniBand Architecture</li> <li>InfiniBand Network Architecture - MindShare</li> <li>ArchWiki - InfiniBand</li> </ul>","tags":["infiniband","ib","notes","learn"]},{"location":"hardware/2023/01/11/intel-cpu/","title":"Intel \u5904\u7406\u5668","text":"","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#xeon-\u7cfb\u5217","title":"Xeon \u7cfb\u5217","text":"<p>\u547d\u540d\u65b9\u5f0f\uff1a</p> <ul> <li>\u7b2c\u4e00\u4f4d\u6570\u5b57\uff1a8-9 \u5bf9\u5e94 Platinum\uff0c5-6 \u5bf9\u5e94 Gold\uff0c4 \u5bf9\u5e94 Silver\uff0c3 \u5bf9\u5e94 Bronze</li> <li>\u7b2c\u4e8c\u4f4d\u6570\u5b57\uff1a\u5bf9\u5e94\u4ee3\u6b21\uff0c1 \u5bf9\u5e94 1st Generation\uff0c2 \u5bf9\u5e94 2nd Generation\uff0c\u4f9d\u6b64\u7c7b\u63a8</li> <li>\u7b2c\u4e09\u4f4d\u7b2c\u56db\u4f4d\u6570\u5b57\uff1a\u4e00\u822c\u8d8a\u5927\u6027\u80fd\u8d8a\u597d</li> <li>\u540e\u7f00\uff1aH/L/M/N/P/Q/S/T/U/V/Y/Y+/+</li> <li>L\uff1a\u5927\u5185\u5b58</li> <li>M\uff1a\u5a92\u4f53/\u5927\u5185\u5b58</li> <li>N\uff1a\u7f51\u7edc</li> <li>P\uff1a\u865a\u62df\u5316\uff0cIaaS</li> <li>Q: \u6c34\u51b7</li> <li>S\uff1a\u5b58\u50a8/\u641c\u7d22</li> <li>T\uff1a\u957f\u5bff\u547d</li> <li>U\uff1a\u5355\u63d2\u69fd</li> <li>V\uff1a\u865a\u62df\u5316\uff0cSaaS</li> <li>Y: Speed Select</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#4th-generation-intel-xeon-scalable-processorsxeon-cpu-max-series","title":"4th Generation Intel\u00ae Xeon\u00ae Scalable Processors/Xeon CPU Max Series","text":"<ul> <li>CPU \u578b\u53f7\u5217\u8868 Xeon CPU Max \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ1'23</li> <li>\u4ee3\u53f7\uff1aSapphire Rapids/Sapphire Rapids HBM</li> <li>\u7528\u9014\uff1aServer</li> <li>\u65d7\u8230\uff1aXeon CPU Max 9480(56C112T\uff0c112.5 MB L3\uff0cHBM)/Xeon Platinum 8490H(60C120T\uff0cGolden Cove\uff0c112.5 MB L3)/Xeon Platinum 8480+(56C112T\uff0c105 MB L3)</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#3rd-generation-intel-xeon-scalable-processors","title":"3rd Generation Intel\u00ae Xeon\u00ae Scalable Processors","text":"<ul> <li>CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ2'21(Ice Lake), Q2'20(Cooper Lake)</li> <li>\u4ee3\u53f7\uff1aCooper Lake/Ice Lake</li> <li>\u7528\u9014\uff1aServer</li> <li>\u65d7\u8230\uff1aXeon Platinum 8380(40C80T\uff0cSunny Cove\uff0c60 MB L3)</li> <li>\u76f8\u5173\u9605\u8bfb\uff1aIce Lake</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#2nd-generation-intel-xeon-scalable-processors","title":"2nd Generation Intel\u00ae Xeon\u00ae Scalable Processors","text":"<ul> <li>CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ1'20, Q2'19</li> <li>\u4ee3\u53f7\uff1aCascade Lake</li> <li>\u7528\u9014\uff1aServer</li> <li>\u65d7\u8230\uff1aXeon Platinum 9282(56C112T)\uff0cXeon Platinum 8280(28C56T\uff0c38.5 MB L3)</li> <li>\u76f8\u5173\u9605\u8bfb\uff1aCascade Lake</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#1st-generation-intel-xeon-scalable-processors","title":"1st Generation Intel\u00ae Xeon\u00ae Scalable Processors","text":"<ul> <li>CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ2'18, Q3'17</li> <li>\u4ee3\u53f7\uff1aSkylake</li> <li>\u7528\u9014\uff1aServer</li> <li>\u65d7\u8230\uff1aXeon Platinum 8180(28C56T)</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#core-\u7cfb\u5217","title":"Core \u7cfb\u5217","text":"<p>\u547d\u540d\u65b9\u5f0f</p> <ul> <li>i3/i5/i7/i9\uff1a\u6570\u5b57\u8d8a\u5927\u8d8a\u9ad8\u7aef</li> <li>\u4e07\u4f4d + \u5343\u4f4d\uff1a\u5bf9\u5e94\u4ee3\u6b21\uff0c13 \u5bf9\u5e94 13 \u4ee3</li> <li>\u767e\u4f4d + \u5341\u4f4d + \u5343\u4f4d\uff1a\u578b\u53f7\uff0c\u4e00\u822c\u8d8a\u5927\u8d8a\u9ad8\u7aef</li> <li>\u540e\u7f00\uff1aF/H/HK/HX/K/P/U/X/XE/Y</li> <li>F\uff1a\u684c\u9762\uff0c\u65e0\u6838\u663e</li> <li>H\uff1a\u7b14\u8bb0\u672c\uff0c\u9ad8\u6027\u80fd</li> <li>HK\uff1a\u7b14\u8bb0\u672c\uff0c\u9ad8\u6027\u80fd\uff0c\u53ef\u8d85\u9891</li> <li>HX\uff1a\u7b14\u8bb0\u672c\uff0c\u9ad8\u9ad8\u6027\u80fd\uff0c\u53ef\u8d85\u9891</li> <li>K\uff1a\u684c\u9762\uff0c\u9ad8\u6027\u80fd\uff0c\u53ef\u8d85\u9891</li> <li>P\uff1a\u7b14\u8bb0\u672c\uff0c\u8f7b\u8584\u672c</li> <li>S\uff1a\u684c\u9762\uff0c\u7279\u522b\u7248</li> <li>U\uff1a\u7b14\u8bb0\u672c\uff0c\u8282\u80fd</li> <li>X/XE\uff1a\u684c\u9762\uff0c\u9ad8\u9ad8\u6027\u80fd\uff0c\u53ef\u8d85\u9891</li> <li>Y\uff1a\u7279\u522b\u8282\u80fd</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#13th-generation-intel-core-processors","title":"13th Generation Intel\u00ae Core\u2122 Processors","text":"<ul> <li>i9 CPU \u578b\u53f7\u5217\u8868 i7 CPU \u578b\u53f7\u5217\u8868 i5 CPU \u578b\u53f7\u5217\u8868 i3 CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ1'23\uff0cQ4'22</li> <li>\u4ee3\u53f7\uff1aRaptor Lake\uff0c\u5927\u5c0f\u6838</li> <li>\u7528\u9014\uff1a\u684c\u9762\uff0c\u7b14\u8bb0\u672c</li> <li>\u65d7\u8230\uff1ai9-13900K\uff088+16C32T\uff09/i9-13900KF</li> <li>\u76f8\u5173\u9605\u8bfb\uff1aIntel Core i9-13900K and i5-13600K Review: Raptor Lake Brings More Bite</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#12th-generation-intel-core-processors","title":"12th Generation Intel\u00ae Core\u2122 Processors","text":"<ul> <li>i9 CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ1'22\uff0cQ4'21</li> <li>\u4ee3\u53f7\uff1aAlder Lake\uff0c\u5927\u5c0f\u6838</li> <li>\u65d7\u8230\uff1ai9-12900KS\uff088+8C24T\uff09</li> <li>\u76f8\u5173\u9605\u8bfb\uff1aThe Intel Core i9-12900KS Review: The Best of Intel's Alder Lake, and the Hottest</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#11th-generation-intel-core-processors","title":"11th Generation Intel\u00ae Core\u2122 Processors","text":"<ul> <li>i9 CPU \u578b\u53f7\u5217\u8868</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ2'21\uff0cQ1'21</li> <li>\u4ee3\u53f7\uff1aRocket Lake</li> <li>\u65d7\u8230\uff1ai9-11900K\uff088C16T\uff09</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/01/11/intel-cpu/#10th-generation-intel-core-processors","title":"10th Generation Intel\u00ae Core\u2122 Processors","text":"<ul> <li>i9 CPU \u578b\u53f7\u5217\u8868 Intel\u00ae Core\u2122 X-series Processors</li> <li>\u53d1\u5e03\u65f6\u95f4\uff1aQ3'20\uff0cQ2'20\uff0cQ4'19</li> <li>\u4ee3\u53f7\uff1aComet Lake</li> <li>\u65d7\u8230\uff1ai9-10900K\uff0810C20T\uff0cComet Lake\uff09\uff1b\u7279\u522b\u5730\uff0c\u5728 X-series \u7cfb\u5217\u4e2d\u8fd8\u6709 i9-10980XE\uff0818C36T\uff0cCascade Lake\uff09</li> </ul>","tags":["intel","cpu"]},{"location":"hardware/2023/05/08/jlink-spi-nor-flash/","title":"\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash","text":"","tags":["spi","nor","flash","jlink","jflash"]},{"location":"hardware/2023/05/08/jlink-spi-nor-flash/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u8bbe\u8ba1\u4e86\u4e00\u6b3e PMOD SPI NOR Flash \u6269\u5c55\u677f\uff0c\u642d\u8f7d\u4e86 W25Q128 SPI NOR Flash \u82af\u7247\u3002\u5728 jlc \u751f\u4ea7\u56de\u6765\u4ee5\u540e\uff0c\u901a\u8fc7 JLink \u8fde\u63a5\u5230\u7535\u8111\u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff0c\u770b\u770b\u662f\u5426\u53ef\u4ee5\u7528 JLink \u64cd\u4f5c SPI NOR Flash\u3002</p>","tags":["spi","nor","flash","jlink","jflash"]},{"location":"hardware/2023/05/08/jlink-spi-nor-flash/#\u8fde\u63a5\u5230-jlink","title":"\u8fde\u63a5\u5230 JLink","text":"<p>JLink \u63d0\u4f9b\u4e86 20 pin \u7684\u5f15\u811a\uff0c\u5982\u679c\u8981\u8fde\u63a5 SPI\uff0c\u90a3\u4e48\u5f15\u811a\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <p></p> <p>\u56fe\u6e90 JFlash SPI \u6587\u6863\u3002</p> <p>\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u81f3\u5c11\u9700\u8981\u8fde\u63a5\u4ee5\u4e0b\u7684\u5f15\u811a\uff1a</p> <ol> <li>JLink GND(pin 4/6/8/10) - SPI NOR Flash GND</li> <li>JLink VTref(pin 1) - 3.3V - SPI NOR Flash VCC</li> <li>JLink CLK(pin 9) - SPI NOR Flash CLK</li> <li>JLink DI(pin 5) - SPI NOR Flash D0/DI/MOSI</li> <li>JLink DO(pin 13) - SPI NOR Flash D1/DO/MISO</li> <li>JLink nCS(pin 7) - SPI NOR Flash CS#</li> </ol> <p>\u7531\u4e8e SPI NOR Flash \u65e0\u6cd5\u63a5\u53d7 5V \u7684\u7535\u538b\uff0c\u6240\u4ee5\u8981\u7528\u989d\u5916\u7684 3.3V \u4f5c\u4e3a\u7535\u6e90\uff0c\u540c\u65f6\u63a5\u5230 JLink \u7684 VTref \u5f15\u811a\u4e0a\u3002</p> <p>JFlash SPI \u8fd8\u652f\u6301 Quad SPI \u6a21\u5f0f\uff0c\u53ef\u4ee5\u5728\u5b83\u7684\u6587\u6863\u91cc\u627e\u5230\u8fde\u63a5\u65b9\u5f0f\u3002</p>","tags":["spi","nor","flash","jlink","jflash"]},{"location":"hardware/2023/05/08/jlink-spi-nor-flash/#jflash-spi","title":"JFlash SPI","text":"<p>\u8fde\u63a5\u4e86\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 JFlash SPI \u8f6f\u4ef6\u4e2d\u8bc6\u522b\u51fa SPI Flash \u4e86\uff1aFlash ID 0xEF 40 18\u3002\u6709\u610f\u601d\u7684\u662f\uff0cJFlash SPI \u8f6f\u4ef6\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u82af\u7247\u662f Infineon \u7684 S25FL128K\uff0c\u800c\u4e0d\u662f Winbond \u7684 W25Q128\u3002\u53d1\u90ae\u4ef6\u95ee\u4e86\u4e00\u4e0b SEGGER\uff0c\u5f97\u5230\u7684\u56de\u590d\u662f\u8fd9\u4e24\u4e2a\u82af\u7247\u7684 Flash ID \u90fd\u662f 0xEF4018\uff0c\u6240\u4ee5\u65e0\u6cd5\u533a\u5206\u3002</p>","tags":["spi","nor","flash","jlink","jflash"]},{"location":"hardware/2023/05/08/jlink-spi-nor-flash/#flashrom","title":"flashrom","text":"<p>\u5982\u679c\u60f3\u7528\u5f00\u6e90\u8f6f\u4ef6\uff0c\u53ef\u4ee5\u7528 flashrom\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u6253\u5f00 jlink \u652f\u6301\uff0c\u5c31\u53ef\u4ee5\u7528 flashrom \u6765\u901a\u8fc7 JLink \u8bfb\u5199 SPI NOR Flash\u3002</p> <p>\u4f46\u662f flashrom \u7684 cs \u4fe1\u53f7\u5e76\u4e0d\u662f\u4e0a\u9762\u7684 nCS(pin 7)\uff0c\u800c\u662f nRESET(pin 15\uff0c\u9ed8\u8ba4) \u6216\u8005 nTRST(pin 3\uff0c\u53ef\u4ee5\u6dfb\u52a0\u53c2\u6570 <code>cs=trst</code>)\u3002\u8fd9\u5c31\u5bfc\u81f4\u5982\u679c\u60f3\u7528 flashrom \u7684\u8bdd\uff0c\u5c31\u8981\u4fee\u6539\u5f15\u811a\u8fde\u63a5\u65b9\u5f0f\uff0c\u628a pin 15 \u8fde\u63a5\u5230 SPI NOR Flash \u7684 CS# \u4e0a\u3002\u4fee\u6539\u8fde\u63a5\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u68c0\u6d4b\u5230\u82af\u7247\u4e86\uff1a</p> <pre><code>$ flashrom --programmer jlink_spi\nflashrom v1.3.0 on Darwin 22.4.0 (arm64)\nflashrom is free software, get the source code at https://flashrom.org\n\nCalibrating delay loop... OK.\nFound Winbond flash chip \"W25Q128.V\" (16384 kB, SPI) on jlink_spi.\n===\nThis flash part has status UNTESTED for operations: WP\nThe test status of this chip may have been updated in the latest development\nversion of flashrom. If you are running the latest development version,\nplease email a report to flashrom@flashrom.org if any of the above operations\nwork correctly for you with this flash chip. Please include the flashrom log\nfile for all operations you tested (see the man page for details), and mention\nwhich mainboard or programmer you tested in the subject line.\nThanks for your help!\nNo operations were specified.\n</code></pre> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u7ed9 flashrom \u63d0\u4ea4\u4e86 patch\uff0c\u5982\u679c\u5408\u5e76\u4e86\uff0c\u5c31\u53ef\u4ee5\u652f\u6301 <code>--programmer jlink_spi:cs=tms</code> \u9009\u9879\uff0c\u6b64\u65f6\u5c31\u4e0d\u9700\u8981\u4fee\u6539\u8fde\u63a5\u65b9\u5f0f\u4e86\u3002</p>","tags":["spi","nor","flash","jlink","jflash"]},{"location":"hardware/2021/03/18/linksys-e8450-openwrt/","title":"Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax","text":"","tags":["openwrt","linksys","e8450","wifi","80211ax"]},{"location":"hardware/2021/03/18/linksys-e8450-openwrt/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u7528\u7684 newifi \u8def\u7531\u5668\uff08Lenovo y1s\uff09\u65e0\u7ebf\u7f51\u603b\u662f\u51fa\u95ee\u9898\uff0c\u4e8e\u662f\u6362\u4e86\u4e00\u4e2a\u65b0\u7684\u652f\u6301 802.11ax \u7684\u8def\u7531\u5668 Linksys E8450\uff0c\u76ee\u524d\u5728 openwrt snapshot \u652f\u6301\u3002Openwrt \u7684\u652f\u6301\u9875\u9762\uff1aLinksys E8450\u3002</p>","tags":["openwrt","linksys","e8450","wifi","80211ax"]},{"location":"hardware/2021/03/18/linksys-e8450-openwrt/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"<p>\u6309\u7167\u652f\u6301\u9875\u9762\uff0c\u4e0b\u8f7d\u56fa\u4ef6\uff1a</p> <pre><code>$ wget https://downloads.openwrt.org/snapshots/targets/mediatek/mt7622/openwrt-mediatek-mt7622-linksys_e8450-squashfs-sysupgrade.bin\n</code></pre> <p>\u66f4\u65b0\uff082023-02-27\uff09\uff1a\u56fa\u4ef6\u5df2\u7ecf\u4ece snapshot \u8fdb\u5165\u6b63\u5f0f\u7248\uff0c\u4e0b\u8f7d\u94fe\u63a5\u4e3a https://downloads.openwrt.org/releases/22.03.3/targets/mediatek/mt7622/openwrt-22.03.3-mediatek-mt7622-linksys_e8450-squashfs-sysupgrade.bin\u3002\u5982\u679c\u5df2\u7ecf\u66ff\u6362\u4e3a UBI\uff0c\u5219\u4f7f\u7528 https://downloads.openwrt.org/releases/22.03.3/targets/mediatek/mt7622/openwrt-22.03.3-mediatek-mt7622-linksys_e8450-ubi-squashfs-sysupgrade.itb \u56fa\u4ef6\u3002</p> <p>\u7136\u540e\u8bbf\u95ee\u56fa\u4ef6\u5347\u7ea7\u9875\u9762\uff1ahttp://192.168.1.1/config-admin-firmware.html#firmware\uff0c\u9009\u62e9\u4e0b\u8f7d\u7684 bin \u6587\u4ef6\u3002\u70b9\u51fb\u201c\u5f00\u59cb\u5347\u7ea7\u201d\uff0c\u7136\u540e\u7b49\u5f85\u3002\u4e00\u6bb5\u65f6\u95f4\u540e\uff0cssh \u5230\u8def\u7531\u5668\uff1a</p> <pre><code>$ ssh root@192.168.1.1\nThe authenticity of host '192.168.1.1 (192.168.1.1)' can't be established.\nED25519 key fingerprint is SHA256:REDACTED.\nNo matching host key fingerprint found in DNS.\nThis key is not known by any other names\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '192.168.1.1' (ED25519) to the list of known hosts.\n\n\nBusyBox v1.33.0 () built-in shell (ash)\n\n  _______                     ________        __\n |       |.-----.-----.-----.|  |  |  |.----.|  |_\n |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|\n |_______||   __|_____|__|__||________||__|  |____|\n          |__| W I R E L E S S   F R E E D O M\n -----------------------------------------------------\n OpenWrt SNAPSHOT, r16242-41af8735d4\n -----------------------------------------------------\n=== WARNING! =====================================\nThere is no root password defined on this device!\nUse the \"passwd\" command to set up a new password\nin order to prevent unauthorized SSH logins.\n--------------------------------------------------\nroot@OpenWrt:~# uname -a\nLinux OpenWrt 5.10.23 #0 SMP Wed Mar 17 19:55:38 2021 aarch64 GNU/Linux\n</code></pre> <p>\u914d\u7f6e luci:</p> <pre><code>$ opkg update\n$ opkg install luci\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u7f51\u9875\u8bbf\u95ee\u770b\u5230 luci \u4e86\uff1aPowered by LuCI Master (git-21.060.51374-cd06e70) / OpenWrt SNAPSHOT r16242-41af8735d4\u3002</p> <p>\u7531\u4e8e\u76ee\u524d luci \u4e0d\u652f\u6301 802.11ax \u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 uci \u914d\u7f6e\u6765\u8fbe\u5230\u6548\u679c\uff1a</p> <pre><code>root@OpenWrt:/# uci show wireless\nroot@OpenWrt:/# uci set wireless.radio1.htmode='HE80'\nroot@OpenWrt:/# /etc/init.d/network restart\n'radio0' is disabled\n</code></pre> <p>\u6ce8\uff1a\u5b9e\u9645\u4e0a\u8bbe\u7f6e\u4e3a HE \u5f00\u5934\u7684\u5b57\u7b26\u4e32\u5373\u53ef\uff0c\u89c1 mac80211.sh\u3002</p> <p>\u518d\u8fde\u63a5\u4e0a Wi-Fi \u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u770b\u5230\u662f 802.11ax \u6a21\u5f0f\u4e86\u3002\u4e5f\u5728 OpenWRT \u8bba\u575b \u4e0a\u5206\u4eab\u4e86\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u6848\u3002</p> <p>\u66f4\u65b0\uff082021-07-31\uff09\uff1a\u76ee\u524d\u6700\u65b0\u7684 luci \u7248\u672c\u5df2\u7ecf\u53ef\u4ee5\u5728\u7f51\u9875\u4e0a\u914d\u7f6e 802.11ax \u6a21\u5f0f\u4e86\u3002</p>","tags":["openwrt","linksys","e8450","wifi","80211ax"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/","title":"\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux","text":"<p>Arty A7 \u662f\u4e00\u6b3e Digilent \u51fa\u54c1\u7684 FPGA \u5f00\u53d1\u677f\uff0c\u4e3a\u4e86\u5728\u5b83\u4e0a\u9762\u8dd1 Linux\uff0c\u53ef\u4ee5\u7528 LiteX \u751f\u6210\u7531 VexRiscv \u4f5c\u4e3a RISC-V \u6838\u5fc3\u7684 SoC\uff0c\u6700\u540e\u53ef\u4ee5\u5728\u5f00\u53d1\u677f\u4e0a\u628a Linux \u8dd1\u8d77\u6765\u3002</p>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/#litex-\u5b89\u88c5","title":"litex \u5b89\u88c5","text":"<p>litex \u5b89\u88c5\u8fc7\u7a0b\u6309\u7167 https://github.com/enjoy-digital/litex/wiki/Installation \u8fdb\u884c\uff0c\u7531\u4e8e\u9700\u8981 pip install\uff0c\u5efa\u8bae\u7528 venv \u6765\u5f00\u4e00\u4e2a\u5e72\u51c0\u7684\u73af\u5883\uff1a</p> <pre><code>python3 -m venv venv\nsource venv/bin/activate\ncd litex\n./litex_setup.py --init --install\n</code></pre>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/#\u6784\u5efa-bitstream","title":"\u6784\u5efa bitstream","text":"<p>litex-boards \u5df2\u7ecf\u5185\u5efa\u4e86 Arty A7 \u7684\u652f\u6301\uff0c\u76f4\u63a5\u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230 bitstream\uff1a</p> <pre><code>python3 -m litex_boards.targets.digilent_arty --build --with-ethernet\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 build/digilent_arty/gateware \u76ee\u5f55\u4e0b\u627e\u5230 bitstream\u3002\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u53c2\u6570\u6765\u81ea\u5b9a\u4e49\u9700\u8981\u7684\u529f\u80fd\uff0c\u8be6\u89c1 https://github.com/litex-hub/litex-boards/blob/f5e51d72bca6ed0325c1213791a78362326002f8/litex_boards/targets/digilent_arty.py#L162-L180\u3002</p> <p>\u5982\u679c\u60f3\u5207\u6362 CPU \u4e3a Rocket Chip \u7684\u8bdd\uff0c\u514b\u9686\u5e76\u5b89\u88c5 https://github.com/litex-hub/pythondata-cpu-rocket\uff0c\u6dfb\u52a0 <code>--cpu-type rocket --cpu-variant small</code> \u53c2\u6570\u5373\u53ef\u3002</p>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/#\u4e0b\u8f7d-bitstream","title":"\u4e0b\u8f7d bitstream","text":"<p>\u6700\u540e\uff0c\u8fde\u63a5 microUSB \u548c\u7f51\u7ebf\u5230\u7535\u8111\uff0c\u7136\u540e\u4e0b\u8f7d bitstream\uff1a</p> <pre><code>openFPGALoader -b arty digilent_arty.bit\nscreen /dev/tty.usbserial-XXXXXXXXXXXXX 115200\n</code></pre> <p>\u5c31\u53ef\u4ee5\u770b\u5230 litex \u7684\u8f93\u51fa\uff1a</p> <pre><code>--=============== SoC ==================--\nCPU:            VexRiscv @ 100MHz\nBUS:            WISHBONE 32-bit @ 4GiB\nCSR:            32-bit data\nROM:            128.0KiB\nSRAM:           8.0KiB\nL2:             8.0KiB\nSDRAM:          256.0MiB 16-bit @ 800MT/s (CL-7 CWL-5)\nMAIN-RAM:       256.0MiB\n\n--========== Initialization ============--\nEthernet init...\nInitializing SDRAM @0x40000000...\nSwitching SDRAM to software control.\nRead leveling:\n  m0, b00: |00000000000000000000000000000000| delays: -\n  m0, b01: |00000000000000000000000000000000| delays: -\n  m0, b02: |11111111110000000000000000000000| delays: 04+-04\n  m0, b03: |00000000000000111111111111000000| delays: 19+-05\n  m0, b04: |00000000000000000000000000000011| delays: 30+-00\n  m0, b05: |00000000000000000000000000000000| delays: -\n  m0, b06: |00000000000000000000000000000000| delays: -\n  m0, b07: |00000000000000000000000000000000| delays: -\n  best: m0, b03 delays: 19+-05\n  m1, b00: |00000000000000000000000000000000| delays: -\n  m1, b01: |00000000000000000000000000000000| delays: -\n  m1, b02: |11111111110000000000000000000000| delays: 04+-04\n  m1, b03: |00000000000000111111111111000000| delays: 19+-05\n  m1, b04: |00000000000000000000000000000011| delays: 30+-00\n  m1, b05: |00000000000000000000000000000000| delays: -\n  m1, b06: |00000000000000000000000000000000| delays: -\n  m1, b07: |00000000000000000000000000000000| delays: -\n  best: m1, b03 delays: 19+-05\nSwitching SDRAM to hardware control.\nMemtest at 0x40000000 (2.0MiB)...\n  Write: 0x40000000-0x40200000 2.0MiB\n   Read: 0x40000000-0x40200000 2.0MiB\nMemtest OK\nMemspeed at 0x40000000 (Sequential, 2.0MiB)...\n  Write speed: 37.0MiB/s\n   Read speed: 48.7MiB/s\n\n--============== Boot ==================--\nBooting from serial...\nPress Q or ESC to abort boot completely.\nsL5DdSMmkekro\nTimeout\nBooting from network...\nLocal IP: 192.168.1.50\nRemote IP: 192.168.1.100\nBooting from boot.json...\nBooting from boot.bin...\nCopying boot.bin to 0x40000000...\nNetwork boot failed.\nNo boot medium found\n\n--============= Console ================--\n\nlitex&gt; \n</code></pre> <p>\u53ef\u89c1\u662f\u975e\u5e38\u65b9\u4fbf\u7684\u3002\u4e4b\u540e\u53ef\u4ee5\u7528 litex_term \u6765\u5f80\u91cc\u9762\u4f20\u7a0b\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 TFTP \u6765\u4f20\u3002</p>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/#\u542f\u52a8-linux","title":"\u542f\u52a8 Linux","text":"<p>\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u4f7f\u7528\u9879\u76ee https://github.com/litex-hub/linux-on-litex-vexriscv \u6765\u542f\u52a8 Linux\u3002\u53c2\u8003\u9879\u76ee README\uff0c\u7f16\u8bd1 Linux \u5e76\u542f\u52a8\u3002\u4e0d\u60f3\u6298\u817e\u7684\u8bdd\uff0c\u53ef\u4ee5\u4ece https://github.com/litex-hub/linux-on-litex-vexriscv/issues/164 \u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684\u7ed3\u679c\u3002</p> <p>\u9996\u5148\u514b\u9686\u9879\u76ee\u5230\u672c\u5730\uff0c\u7136\u540e\u8fd0\u884c\uff1a</p> <pre><code>git clone https://github.com/litex-hub/linux-on-litex-vexriscv.git\ncd linux-on-litex-vexriscv\n./make.py --board=arty\n</code></pre> <p>\u8fd9\u6837\u5c31\u751f\u6210\u4e86 bitstream\uff0c\u63a5\u4e0b\u6765\u6784\u5efa Linux \u548c rootfs\uff1a</p> <pre><code>git clone http://github.com/buildroot/buildroot\ncd buildroot\nmake BR2_EXTERNAL=../linux-on-litex-vexriscv/buildroot/ litex_vexriscv_defconfig\nmake\n</code></pre> <p>\u518d\u6784\u5efa OpenSBI\uff1a</p> <pre><code>git clone https://github.com/litex-hub/opensbi --branch 0.8-linux-on-litex-vexriscv\ncd opensbi\n# riscv32-unknown-elf toolchain is built by ct-ng\nmake CROSS_COMPILE=riscv32-unknown-elf- PLATFORM=litex/vexriscv\n</code></pre> <p>\u4f46\u662f\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u53d1\u73b0 ct-ng \u7f16\u8bd1\u7684\u662f hardfloat \u5de5\u5177\u94fe\uff0c\u800c\u9ed8\u8ba4\u914d\u7f6e\u4e0b vexriscv \u4e0d\u5e26 FPU\uff0c\u6240\u4ee5\u7f16\u8bd1\u65f6\u7528\u7684\u662f rv32ima \u4f5c\u4e3a target\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u62a5\u9519\uff0c\u6700\u540e\u5c31\u76f4\u63a5\u7528\u7f16\u8bd1\u597d\u7684\u7248\u672c\u3002</p> <p>\u6700\u540e\u5f97\u5230\u5982\u4e0b\u7684\u51e0\u4e2a\u6587\u4ef6\uff1a</p> <ul> <li>boot.json: linux-on-litex-vexriscv/images/boot.json</li> <li>rv32.dtb: linux-on-litex-vexriscv/images/rv32.dtb</li> <li>Image: buildroot/output/images/Image</li> <li>rootfs.cpio: buildroot/output/images/rootfs.cpio</li> <li>opensbi.bin</li> </ul> <p>\u628a\u8fd9\u4e9b\u6587\u4ef6\u590d\u5236\u5230 TFTP \u670d\u52a1\u7684\u76ee\u5f55\u4e0b\uff0c\u91cd\u65b0 Program linux-on-litex-vexriscv/build/arty/gateware/arty.bit\uff0c\u5373\u53ef\u542f\u52a8 Linux\uff1a</p> <pre><code>--============== Boot ==================--\nBooting from serial...\nPress Q or ESC to abort boot completely.\nsL5DdSMmkekro\nTimeout\nBooting from SDCard in SD-Mode...\nBooting from boot.json...\nBooting from boot.bin...\nSDCard boot failed.\nBooting from network...\nLocal IP: 192.168.1.50\nRemote IP: 192.168.1.100\nBooting from boot.json...\nCopying Image to 0x40000000... (7726264 bytes)\nCopying rv32.dtb to 0x40ef0000... (5294 bytes)\nCopying rootfs.cpio to 0x41000000... (3566592 bytes)\nCopying opensbi.bin to 0x40f00000... (53640 bytes)\nExecuting booted program at 0x40f00000\n\n--============= Liftoff! ===============--\n\nOpenSBI v0.8-1-gecf7701\n   ____                    _____ ____ _____\n  / __ \\                  / ____|  _ \\_   _|\n | |  | |_ __   ___ _ __ | (___ | |_) || |\n | |  | | '_ \\ / _ \\ '_ \\ \\___ \\|  _ &lt; | |\n | |__| | |_) |  __/ | | |____) | |_) || |_\n  \\____/| .__/ \\___|_| |_|_____/|____/_____|\n        | |\n        |_|\n\nPlatform Name       : LiteX / VexRiscv-SMP\nPlatform Features   : timer,mfdeleg\nPlatform HART Count : 8\nBoot HART ID        : 0\nBoot HART ISA       : rv32imas\nBOOT HART Features  : time\nBOOT HART PMP Count : 0\nFirmware Base       : 0x40f00000\nFirmware Size       : 124 KB\nRuntime SBI Version : 0.2\n\nMIDELEG : 0x00000222\nMEDELEG : 0x0000b101\n[    0.000000] Linux version 6.1.0-rc2 (jiegec@linux) (riscv32-buildroot-linux-gnu-gcc.br_real (Buildroot 2023.02-270-gb100440bff) 11.3.0, GNU ld (GNU Binutils) 2.38) #1 SMP Wed Apr 19 16:21:39 CST 2023\n[    0.000000] earlycon: liteuart0 at I/O port 0x0 (options '')\n[    0.000000] Malformed early option 'console'\n[    0.000000] earlycon: liteuart0 at MMIO 0xf0001000 (options '')\n[    0.000000] printk: bootconsole [liteuart0] enabled\n[    0.000000] Zone ranges:\n[    0.000000]   Normal   [mem 0x0000000040000000-0x000000004fffffff]\n[    0.000000] Movable zone start for each node\n[    0.000000] Early memory node ranges\n[    0.000000]   node   0: [mem 0x0000000040000000-0x000000004fffffff]\n[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000004fffffff]\n[    0.000000] SBI specification v0.2 detected\n[    0.000000] SBI implementation ID=0x1 Version=0x8\n[    0.000000] SBI TIME extension detected\n[    0.000000] SBI IPI extension detected\n[    0.000000] SBI RFENCE extension detected\n[    0.000000] SBI HSM extension detected\n[    0.000000] riscv: base ISA extensions aim\n[    0.000000] riscv: ELF capabilities aim\n[    0.000000] percpu: Embedded 8 pages/cpu s11732 r0 d21036 u32768\n[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 65024\n[    0.000000] Kernel command line: console=liteuart earlycon=liteuart,0xf0001000 rootwait root=/dev/ram0\n[    0.000000] Dentry cache hash table entries: 32768 (order: 5, 131072 bytes, linear)\n[    0.000000] Inode-cache hash table entries: 16384 (order: 4, 65536 bytes, linear)\n[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off\n[    0.000000] Memory: 243336K/262144K available (5848K kernel code, 571K rwdata, 906K rodata, 215K init, 254K bss, 18808K reserved, 0K cma-reserved)\n[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1\n[    0.000000] rcu: Hierarchical RCU implementation.\n[    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=32 to nr_cpu_ids=1.\n[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.\n[    0.000000] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=1\n[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0\n[    0.000000] riscv-intc: 32 local interrupts mapped\n[    0.000000] plic: interrupt-controller@f0c00000: mapped 32 interrupts with 1 handlers for 2 contexts.\n[    0.000000] rcu: srcu_init: Setting srcu_struct sizes based on contention.\n[    0.000000] riscv-timer: riscv_timer_init_dt: Registering clocksource cpuid [0] hartid [0]\n[    0.000000] clocksource: riscv_clocksource: mask: 0xffffffffffffffff max_cycles: 0x171024e7e0, max_idle_ns: 440795205315 ns\n[    0.000018] sched_clock: 64 bits at 100MHz, resolution 10ns, wraps every 4398046511100ns\n[    0.010246] Console: colour dummy device 80x25\n[    0.014169] Calibrating delay loop (skipped), value calculated using timer frequency.. 200.00 BogoMIPS (lpj=400000)\n[    0.024255] pid_max: default: 32768 minimum: 301\n[    0.033262] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[    0.039790] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[    0.080128] ASID allocator using 9 bits (512 entries)\n[    0.086947] rcu: Hierarchical SRCU implementation.\n[    0.090826] rcu:     Max phase no-delay instances is 1000.\n[    0.103556] smp: Bringing up secondary CPUs ...\n[    0.107186] smp: Brought up 1 node, 1 CPU\n[    0.118798] devtmpfs: initialized\n[    0.169571] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns\n[    0.178637] futex hash table entries: 256 (order: 2, 16384 bytes, linear)\n[    0.214981] NET: Registered PF_NETLINK/PF_ROUTE protocol family\n[    0.455944] pps_core: LinuxPPS API ver. 1 registered\n[    0.460007] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;\n[    0.469508] PTP clock support registered\n[    0.476324] FPGA manager framework\n[    0.493464] clocksource: Switched to clocksource riscv_clocksource\n[    0.722433] NET: Registered PF_INET protocol family\n[    0.731210] IP idents hash table entries: 4096 (order: 3, 32768 bytes, linear)\n[    0.752236] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 4096 bytes, linear)\n[    0.760269] Table-perturb hash table entries: 65536 (order: 6, 262144 bytes, linear)\n[    0.767834] TCP established hash table entries: 2048 (order: 1, 8192 bytes, linear)\n[    0.775654] TCP bind hash table entries: 2048 (order: 3, 32768 bytes, linear)\n[    0.783026] TCP: Hash tables configured (established 2048 bind 2048)\n[    0.789689] UDP hash table entries: 256 (order: 1, 8192 bytes, linear)\n[    0.795620] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes, linear)\n[    0.816406] Unpacking initramfs...\n[    0.926651] workingset: timestamp_bits=30 max_order=16 bucket_order=0\n[    1.186672] io scheduler mq-deadline registered\n[    1.190309] io scheduler kyber registered\n[    1.570624] No litex,nclkout entry in the dts file\n[    1.607895] LiteX SoC Controller driver initialized\n[    2.358518] Initramfs unpacking failed: invalid magic at start of compressed archive\n[    2.448554] Freeing initrd memory: 8192K\n[    3.423827] f0001000.serial: ttyLXU0 at MMIO 0x0 (irq = 0, base_baud = 0) is a liteuart\n[    3.431446] printk: console [liteuart0] enabled\n[    3.431446] printk: console [liteuart0] enabled\n[    3.440068] printk: bootconsole [liteuart0] disabled\n[    3.440068] printk: bootconsole [liteuart0] disabled\n[    3.499884] liteeth f0002000.mac eth0: irq 2 slots: tx 2 rx 2 size 2048\n[    3.510055] i2c_dev: i2c /dev entries driver\n[    3.520573] i2c i2c-0: Not I2C compliant: can't read SCL\n[    3.525314] i2c i2c-0: Bus may be unreliable\n[    3.577560] litex-mmc f0009000.mmc: LiteX MMC controller initialized.\n[    3.623272] NET: Registered PF_INET6 protocol family\n[    3.653652] Segment Routing with IPv6\n[    3.657870] In-situ OAM (IOAM) with IPv6\n[    3.662630] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver\n[    3.683817] NET: Registered PF_PACKET protocol family\n[    3.699016] Freeing unused kernel image (initmem) memory: 208K\n[    3.704055] Kernel memory protection not selected by kernel config.\n[    3.710506] Run /init as init process\nStarting syslogd: OK\nStarting klogd: OK\nRunning sysctl: OK\nSaving 256 bits of non-creditable seed for next boot\nStarting network: OK\n\nWelcome to Buildroot\nbuildroot login: root\n                   __   _\n                  / /  (_)__  __ ____ __\n                 / /__/ / _ \\/ // /\\ \\ /\n                /____/_/_//_/\\_,_//_\\_\\\n                      / _ \\/ _ \\\n   __   _ __      _  _\\___/_//_/         ___  _\n  / /  (_) /____ | |/_/__| | / /____ __ / _ \\(_)__ _____  __\n / /__/ / __/ -_)&gt;  &lt;/___/ |/ / -_) \\ // , _/ (_-&lt;/ __/ |/ /\n/____/_/\\__/\\__/_/|_|____|___/\\__/_\\_\\/_/|_/_/___/\\__/|___/\n                  / __/  |/  / _ \\\n                 _\\ \\/ /|_/ / ___/\n                /___/_/  /_/_/\n  32-bit RISC-V Linux running on LiteX / VexRiscv-SMP.\n\nlogin[70]: root login on 'console'\nroot@buildroot:~# \n</code></pre> <p>Linux \u4e2d\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u7f51\u7edc\uff08\u901a\u8fc7\u4e3b\u7ebf\u5185\u7684 liteeth \u9a71\u52a8\uff09\uff1a</p> <pre><code>$ dmesg | grep liteeth\n[    3.499861] liteeth f0002000.mac eth0: irq 2 slots: tx 2 rx 2 size 2048\n$ ip link set eth0 up\n$ ip a add 192.168.1.50/24 dev eth0\n$ ping 192.168.1.100\n</code></pre>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/19/litex-digilent-arty-a7/#\u5176\u4ed6\u5f00\u53d1\u677f","title":"\u5176\u4ed6\u5f00\u53d1\u677f","text":"<p>\u9664\u4e86 Digilent Arty A7\uff0c\u6211\u8fd8\u505a\u4e86\u4ee5\u4e0b\u5f00\u53d1\u677f\u7684 LiteX \u652f\u6301\uff1a</p> <ul> <li>VCU128\uff0c\u652f\u6301 UART\uff0cSDRAM \u548c HBM\uff1b\u4ee5\u592a\u7f51\u56e0\u4e3a\u662f SGMII \u6682\u65f6\u65e0\u6cd5\u89e3\u51b3</li> <li>MA703FA-35T\uff0c\u652f\u6301 UART\uff0cSDRAM\uff0cETH\u3001SD \u5361\u548c HDMI\uff1bMA703FA-35T \u7684\u6587\u6863\u4e2d TF_DAT3 \u5f15\u811a\u7ed1\u5b9a\u6709\u8bef\uff0cAB12 \u5e94\u8be5\u6539\u4e3a AB20</li> <li>Alinx AX7021\uff0c\u652f\u6301 UART over JTAG \u548c HDMI</li> <li>THU Digital Design\uff0c\u57fa\u4e8e @gaoyichuan \u7684\u5b9e\u73b0\uff0c\u652f\u6301 UART\uff0cSDRAM\uff0cETH\uff0cSD \u5361\u548c VGA</li> </ul>","tags":["digilent","arty","xilinx","fpga","litex"]},{"location":"hardware/2023/04/24/litex-uart-over-jtag/","title":"\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG","text":"","tags":["xilinx","fpga","litex","alinx","ax7021"]},{"location":"hardware/2023/04/24/litex-uart-over-jtag/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u7ed9 Alinx AX7021 \u9002\u914d LiteX \u7684\u65f6\u5019\uff0c\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff1aPL \u4e0a\u6ca1\u6709\u8fde\u63a5\u4e32\u53e3\uff0c\u53ea\u6709 PS \u8fde\u63a5\u4e86\u4e32\u53e3\uff0c\u5982\u679c\u7528 RISC-V \u8f6f\u6838\u7684\u8bdd\uff0c\u5c31\u4f1a\u9762\u4e34\u65e0\u4e32\u53e3\u53ef\u7528\u7684\u60c5\u51b5\uff0c\u9664\u975e\u5728\u6269\u5c55 IO \u4e0a\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u4e32\u53e3\u3002</p> <p>\u56e0\u6b64\u7814\u7a76\u4e86\u4e00\u4e0b LiteX \u81ea\u5e26\u7684 UART over JTAG \u529f\u80fd\uff0c\u5728 Alinx AX7021 \u4e2d\u8c03\u8bd5\u51fa\u6765\u4e86\u3002</p>","tags":["xilinx","fpga","litex","alinx","ax7021"]},{"location":"hardware/2023/04/24/litex-uart-over-jtag/#litex-\u914d\u7f6e","title":"LiteX \u914d\u7f6e","text":"<p>\u542f\u7528\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u5728\u547d\u4ee4\u91cc\u6dfb\u52a0 <code>--uart-name jtag_uart</code> \u5373\u53ef\uff1a</p> <pre><code>$ python3 -m litex_boards.targets.alinx_ax7021 --build --uart-name jtag_uart\n</code></pre> <p>\u5982\u679c\u8981\u8bbe\u7f6e\u6210\u9ed8\u8ba4\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>        if kwargs.get(\"uart_name\", \"serial\") == \"serial\":\n            # Defaults to JTAG-UART since UART is connected to PS instead of PL\n            kwargs[\"uart_name\"] = \"jtag_uart\"\n</code></pre> <p>\u90a3\u4e48 FPGA \u90e8\u5206\u7684\u51c6\u5907\u5c31\u5b8c\u6210\u4e86\uff0c\u628a bitstream \u4e0b\u8f7d\u5230 FPGA \u5373\u53ef\u8fdb\u5165\u4e0b\u4e00\u6b65\u3002</p>","tags":["xilinx","fpga","litex","alinx","ax7021"]},{"location":"hardware/2023/04/24/litex-uart-over-jtag/#openocd-\u914d\u7f6e","title":"OpenOCD \u914d\u7f6e","text":"<p>\u4e0b\u4e00\u6b65\u662f\u4f7f\u7528 litex_term \u6765\u8fde\u63a5 UART over JTAG\u3002\u5b83\u7684\u542f\u52a8\u65b9\u5f0f\u662f\uff1a</p> <pre><code>$ litex_term --jtag-config alinx_ax7021.cfg jtag\n</code></pre> <p>\u5b9e\u73b0\u7684\u539f\u7406\u662f\uff0clitex_term \u4f1a\u542f\u52a8\u4e00\u4e2a OpenOCD\uff0c\u8ba9 OpenOCD \u76d1\u542c 20000 \u7aef\u53e3\uff0c\u7136\u540e\u865a\u62df\u4e32\u53e3\u7684\u6536\u53d1\u90fd\u4f1a\u5728 TCP \u4e0a\u8fdb\u884c\u3002\u90a3\u4e48\uff0c\u9996\u5148\u7b2c\u4e00\u6b65\u662f\u8981\u8ba9 OpenOCD \u627e\u5230 Zynq \u4e2d\u7684 PL\u3002\u9996\u5148\u53ef\u4ee5\u627e\u5230 Zynq \u7684 OpenOCD \u914d\u7f6e\u6a21\u677f\uff1a</p> <pre><code>source [find interface/ftdi/digilent_jtag_smt2.cfg]\n\nreset_config srst_only srst_push_pull\n\nsource [find target/zynq_7000.cfg]\n</code></pre> <p>\u8fd9\u4e2a\u6a21\u677f\u53ef\u4ee5\u627e\u5230 ARM \u6838\u548c FPGA PL \u90e8\u5206\uff0c\u4f46\u662f\u56e0\u4e3a\u540d\u5b57\u548c litex_term \u671f\u671b\u7684\u4e0d\u540c\uff0c\u6240\u4ee5\u65e0\u6cd5\u5de5\u4f5c\u3002\u53bb\u6389\u90a3\u4e9b\u4e0d\u9700\u8981\u7684\uff0c\u53ea\u4fdd\u7559\u60f3\u8981\u7684 PL \u90e8\u5206\u7684 JTAG \u914d\u7f6e\uff1a</p> <pre><code>source [find interface/ftdi/digilent_jtag_smt2.cfg]\n\nreset_config srst_only srst_push_pull\n\nadapter speed 15000\njtag newtap zynq_pl bs -irlen 6 -ignore-version -ircapture 0x1 -irmask 0x03 \\\n    -expected-id 0x03723093 \\\n    -expected-id 0x03722093 \\\n    -expected-id 0x0373c093 \\\n    -expected-id 0x03728093 \\\n    -expected-id 0x0373B093 \\\n    -expected-id 0x03732093 \\\n    -expected-id 0x03727093 \\\n    -expected-id 0x0372C093 \\\n    -expected-id 0x03731093 \\\n    -expected-id 0x03736093\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u542f\u52a8 OpenOCD\uff1a</p> <pre><code>openocd -f alinx_ax7021.cfg -f stream.cfg -c \"init; irscan zynq_pl.bs 2; jtagstream_serve zynq_pl.bs 20000\"\n</code></pre> <p>\u8fd9\u91cc\u7684 stream.cfg \u662f litex_term \u751f\u6210\u7684\uff0c\u6ca1\u6709\u7528 litex_term \u542f\u52a8\u662f\u56e0\u4e3a\u5b83\u5199\u6b7b\u4e86 tap \u7684\u540d\u5b57\uff0c\u9700\u8981\u9002\u914d\uff0c\u4e0d\u5982\u76f4\u63a5\u7ed5\u8fc7\u5b83\u53bb\u542f\u52a8 OpenOCD\uff0c\u7136\u540e\u7528 nc \u8fde\u63a5\uff1a</p> <pre><code>$ nc localhost 20000\nlitex&gt;\n</code></pre> <p>\u5c31\u53ef\u4ee5\u770b\u5230\u719f\u6089\u7684\u4e32\u53e3\u4e86\u3002\u4f46\u662f\u8dd1\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u51fa\u73b0\u91cd\u590d\u5b57\u5e55\u7684\u8f93\u51fa\uff1a</p> <pre><code>LiteX BIOS, available commands:\n\nflush_cpu_dcache         -FFlush CPU data cache\ncrc                      - Compute CRC32 ff a part of the address space\nident                    - Identffier of the system\nhelp                     - Print this help\n\n\nserialboot               - Boot from Serial (SFL)\nreboot                   - Reboot\nboot                     - Boot from Meoory\n\nmem_cmp                  - Compare memory content\nmem_seeed                - Test memory speed\nmem_test                 - Test memory access\nmem_copy                 - Copy address ppace\nmem_write                - Write address space\nmem_read                 - Read address space\nmem_list                 -LList available memory regions\n</code></pre> <p>\u6000\u7591\u662f\u54ea\u91cc\u901f\u7387\u4e0d\u5339\u914d\uff0c\u5bfc\u81f4\u540c\u4e00\u4efd\u6570\u636e\u88ab\u8bfb\u51fa\u6765\u4e24\u6b21\u3002\u4e4b\u540e\u7528\u4e00\u4e2a\u66f4\u4f4e\u7684 CPU \u4e3b\u9891\u518d\u8bd5\u4e00\u6b21\u3002</p>","tags":["xilinx","fpga","litex","alinx","ax7021"]},{"location":"hardware/2023/08/10/loongarch-cpu/","title":"LoongArch \u5904\u7406\u5668","text":"<p>\u6574\u7406\u5e02\u9762\u4e0a\u7684 LoongArch \u5904\u7406\u5668\u4ee5\u53ca\u76f8\u5173\u4ea7\u54c1\u3002</p>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#3a5000","title":"3A5000","text":"<p>\u4e3b\u9875</p> <p>4 \u6838 LA464</p> <p>\u4e0d\u540c\u7684\u7248\u672c\uff1a</p> <ul> <li>3A5000-HV: High Voltage, 2.5GHz</li> <li>3A5000-LL: 2.3GHz</li> <li>3A5000M: Mobile, 2.0GHz</li> <li>3A5000-iHV: Industrial High Voltage, 1.5/2.0GHz</li> <li>3A5000-i: Industrial: 1.5GHz</li> <li>3B5000: Server, 2.3GHz</li> </ul> \u578b\u53f7 \u7c7b\u578b \u6865\u7247/\u663e\u5361 \u5185\u5b58 \u786c\u76d8 \u4ef7\u683c PN-L520A \u53f0\u5f0f\u673a 7A2000 16GB 512GB 2699 GPC-100 \u53f0\u5f0f\u673a 7A1000+\u72ec\u663e 8GB 256GB 3825 M540Z \u53f0\u5f0f\u673a \u72ec\u663e 8GB 256GB 4599 \u60a6\u777f \u53f0\u5f0f\u673a \u72ec\u663e 8GB 256GB 4608 EC-80G \u53f0\u5f0f\u673a AMD R5 230 8GB 256GB 7266 ML5A-D01 \u53f0\u5f0f\u673a 7A1000 N/A N/A N/A ML5C-D04 \u53f0\u5f0f\u673a 7A2000 N/A N/A N/A TR11A2 \u53f0\u5f0f\u673a + \u663e\u793a\u5668 \u72ec\u663e 8GB 256GB 5890 TL630-V001-2 \u53f0\u5f0f\u673a + \u663e\u793a\u5668 \u72ec\u663e 8GB 256GB 6200 JL630-V001 \u53f0\u5f0f\u673a + \u663e\u793a\u5668 \u72ec\u663e 16GB 512GB 6999 GDC-1401 \u7b14\u8bb0\u672c 7A1000+AMD R5 340 8GB 256GB 6375 L860-T2 \u7b14\u8bb0\u672c \u72ec\u663e 8GB 256GB 6999 L71 \u7b14\u8bb0\u672c \u72ec\u663e N/A N/A N/A L71S \u7b14\u8bb0\u672c 7A2000 N/A N/A N/A L71F \u7b14\u8bb0\u672c 7A1000+\u72ec\u663e N/A N/A N/A \u9f99\u82af\u5f00\u53d1\u677f \u4e3b\u677f+CPU 7A2000 N/A N/A 1700 \u667a\u82af\u5143 \u4e3b\u677f+CPU 7A2000 N/A N/A 1798 \u6211\u7231\u5f00\u53d1\u677f \u4e3b\u677f+CPU 7A2000 N/A N/A 1900 \u8fc5\u4e3a \u4e3b\u677f+CPU 7A2000 8GB 128GB 5910 ML5A \u4e3b\u677f+CPU 7A1000 N/A N/A N/A ML5C \u4e3b\u677f+CPU 7A2000 N/A N/A N/A","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#3c5000","title":"3C5000","text":"<p>\u4e3b\u9875</p> <p>16 \u6838 LA464</p> <p>\u4e0d\u540c\u7684\u7248\u672c\uff1a</p> <ul> <li>3C5000: 32MB L3 Cache, 2.2GHz</li> <li>3C5000-LL: 32MB L3 Cache, 2.0GHz</li> <li>3C5000L: 64MB L3 Cache, 2.2GHz</li> <li>3C5000L-LL: 64MB L3 Cache, 2.0GHz</li> </ul> <p>3C5000L \u662f\u7531\u56db\u4e2a 3A5000 \u82af\u7247\u96c6\u6210\uff0c\u800c 3C5000 \u4e0d\u662f\u3002</p> <ul> <li>https://item.jd.com/100053674064.html GDC-2000 \u4e24\u8def 3C5000</li> <li>https://item.jd.com/100054670954.html JL620-G3-00 \u4e24\u8def 3C5000L</li> <li>https://item.jd.com/100054668922.html JL620-G3-01 \u4e24\u8def 3C5000</li> <li>https://item.jd.com/10079447545921.html G4129-ET25 \u4e24\u8def 3C5000</li> <li>https://www.eaecis.com/chanpinleixingfenlei/334.html SL12R-S01 \u4e24\u8def 3C5000</li> <li>https://item.jd.com/100033473676.html GS6000L-4C5L \u56db\u8def 3C5000L</li> <li>https://item.jd.com/100041722164.html GDC-2000 \u56db\u8def 3C5000L</li> <li>https://item.jd.com/100060558727.html GS6000 LA240 \u56db\u8def 3C5000</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#3d5000","title":"3D5000","text":"<p>\u4e3b\u9875</p> <p>32 \u6838 LA464</p>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#3a6000","title":"3A6000","text":"<p>4 \u6838 8 \u7ebf\u7a0b LA664</p> <p></p> <p>\u6765\u6e90\uff1a\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u534a\u5e74\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</p> <p>\u6839\u636e http://basic.10jqka.com.cn/688047/interactive.html:</p> <ul> <li>ROB \u9879\u6570\u8fbe\u5230 256 \u9879</li> <li>\u56db\u5b9a\u70b9\u3001\u56db\u6d6e\u70b9\u3001\u56db\u8bbf\u5b58\u5171 12 \u4e2a\u529f\u80fd\u90e8\u4ef6</li> </ul> <p>\u5f00\u53d1\u677f https://bbs.loongarch.org/d/309-3a6000\uff1a</p> <ul> <li>XA612A0: 3A6000 + 7A2000</li> <li>XA61200: 3A6000 + 7A2000</li> </ul> <p>\u4e3b\u677f\uff1a</p> <ul> <li>DL37 \u5b98\u7f51</li> <li>\u9f99\u82af\u4ff1\u4e50\u90e8</li> </ul> <p>\u53f0\u5f0f\u673a\uff1a</p> <ul> <li>ZKL360-TF\uff1a16GB+1024GB\uff0c2699 \u5143</li> <li>PN-L530A \u5b98\u7f51: 16GB+512GB\uff0c2999 \u5143</li> <li>EC-80G: 8GB+256GB+\u72ec\u663e\uff0c4699 \u5143</li> <li>DL37-D05 \u5b98\u7f51</li> <li>\u9f99\u82af\u4ff1\u4e50\u90e8</li> <li>F918 \u5929\u732b</li> </ul> <p>\u7b14\u8bb0\u672c\uff1a</p> <ul> <li>NL38-N09 \u5b98\u7f51</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#3c6000","title":"3C6000","text":"<p>\u6765\u6e90\uff1a\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u7b2c\u4e09\u5b63\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</p>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#2k3000","title":"2K3000","text":"<p>\u6765\u6e90\uff1a\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u7b2c\u4e09\u5b63\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</p>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#2k2000","title":"2K2000","text":"<p>2K2000: 2 \u6838 LA364</p> <ul> <li>GM7-3002</li> <li>\u9f99\u82af 2K2000 \u5168\u56fd\u4ea7\u5316\u5de5\u63a7\u673a</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#2k1500","title":"2K1500","text":"<p>2K1500: 2 \u6838 LA264</p>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#2k1000la","title":"2K1000LA","text":"<p>2K1000LA: 2 \u6838 LA264</p> <ul> <li>\u5f00\u53d1\u677f</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#2k0500","title":"2K0500","text":"<p>2K0500: 1 \u6838 LA264</p> <ul> <li>\u5f00\u53d1\u677f</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#\u5176\u4ed6","title":"\u5176\u4ed6","text":"<ul> <li>1C103: 1 \u6838 LA132</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2023/08/10/loongarch-cpu/#\u56fa\u4ef6","title":"\u56fa\u4ef6","text":"<ul> <li>https://github.com/loongson/Firmware</li> <li>https://gitee.com/loongson/Firmware</li> <li>https://gitea.whlug.cn/3A6000/3A6000</li> </ul>","tags":["loongson","loongarch","cpu"]},{"location":"hardware/2021/12/06/manycore/","title":"Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790","text":"","tags":["cpu","manycore","intel","mic","a64fx"]},{"location":"hardware/2021/12/06/manycore/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Intel\u00ae Many Integrated Core Architecture (Intel\u00ae MIC Architecture) - Advanced</li> <li>Intel\u00ae Xeon Phi coprocessor (codename Knights Corner)</li> <li>https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=7453080</li> <li>Knights Landing (KNL): 2nd Generation Intel\u00ae Xeon Phi\u2122 Processor</li> <li>Fujitsu A64FX</li> <li>Fujitsu Presents Post-K CPU Specifications</li> <li>Fujitsu High Performance CPU for the Post-K Computer</li> <li>SUPERCOMPUTER FUGAKU - SUPERCOMPUTER FUGAKU, A64FX 48C 2.2GHZ, TOFU INTERCONNECT D</li> <li>Preliminary Performance Evaluation of the Fujitsu A64FX Using HPC Applications</li> <li>FUJITSU Processor A64FX</li> <li>NVIDIA A100 Tensor Core GPU Architecture</li> <li>NVIDIA TESLA V100 GPU ARCHITECTURE</li> <li>NVIDIA A100 TENSOR CORE GPU</li> </ul>","tags":["cpu","manycore","intel","mic","a64fx"]},{"location":"hardware/2021/12/06/manycore/#xeon-phi---intel-mic","title":"Xeon Phi - Intel MIC","text":"<p>MIC: Many Integrated Core Architecture</p> <p>Knights Corner:</p> <p>4 \u8def SMT\uff0cAVX512 \u6307\u4ee4\uff0c32 KB L1I\uff0c32 KB L1D\uff0c\u6bcf\u6838\u5fc3 512KB L2\uff0c\u4e71\u5e8f\u6267\u884c\uff0c\u4e00\u6761 512 \u4f4d\u8ba1\u7b97\u6d41\u6c34\u7ebf\uff0c\u6bcf\u4e2a\u5468\u671f\u53cc\u7cbe\u5ea6\u6027\u80fd <code>512 / 64 * 2 = 16 FLOP/cycle</code>\u300261 \u6838 1.053GHz \u53cc\u7cbe\u5ea6\u6027\u80fd\u662f <code>16 * 61 * 1.053 = 1028 GFLOPS</code>\u3002</p> <p>\u5411\u91cf\u5bc4\u5b58\u5668\u5206\u4e3a\u56db\u7ec4\uff0c\u6bcf\u7ec4 128 \u4f4d\uff0c\u4e24\u4e2a DP/\u56db\u4e2a SP\u3002SP \u548c DP \u8ba1\u7b97\u5171\u4eab\u4e58\u6cd5\u5668\uff0c\u6765\u4f18\u5316\u9762\u79ef\u3002</p> <p>Knights Landing:</p> <p>\u6838\u5fc3\uff1a4 \u8def SMT\uff0cAVX512 \u6307\u4ee4\uff0c\u4e71\u5e8f\u6267\u884c\uff0c\u4e24\u6761 512 \u4f4d\u8ba1\u7b97\u6d41\u6c34\u7ebf\uff0c\u6bcf\u4e2a\u5468\u671f\u53cc\u7cbe\u5ea6\u6027\u80fd <code>512 / 64 * 2 * 2 = 32 FLOP/cycle</code>\uff0c\u5982\u679c\u662f 64 \u6838 1.3 GHz\uff0c\u603b\u53cc\u7cbe\u5ea6\u6027\u80fd\u662f <code>32 * 64 * 1.3 = 2662 GFLOPS</code>\u3002\u4e00\u5171 36 \u4e2a Tile\uff0c\u6bcf\u4e2a Tile \u6709 2 Core + 2 VPU/core + 1MB 16-way L2\uff0c\u6700\u5927 72 \u4e2a\u6838\u5fc3\u3002</p> <p>\u5185\u5b58\uff1a6-channel 384GB DDR4 2400 RAM\uff08\u7406\u8bba <code>2400 * 6 * 8 = 115.2 GB/s</code>\uff09\uff0c8-16GB 3D MCDRAM\uff08400+ GB/s\uff09\u3002</p>","tags":["cpu","manycore","intel","mic","a64fx"]},{"location":"hardware/2021/12/06/manycore/#fujitsu-a64fx","title":"Fujitsu A64FX","text":"<p>\u5185\u5b58\uff1a4 \u7ec4\uff0c\u6bcf\u7ec4 8GB HBM2\uff0c\u5e26\u5bbd 256 GB/s\uff08<code>1024 bit * 2G</code>\uff09\uff0c\u603b\u5171 32GB HBM2\uff0c\u5e26\u5bbd 1TB/s\u3002Cache Line \u5927\u5c0f 256 B\u3002</p> <p>\u6838\u5fc3\uff1a4 \u4e2a NUMA Node\uff08Core Memory Group\uff09\uff0c\u6bcf\u4e2a NUMA Node \u5305\u62ec 12 \u8ba1\u7b97\u6838\uff0c\u6709 8MB 16 \u8def\u7684 L2 Cache\u3002\u603b\u5171 48 \u8ba1\u7b97\u6838\uff0c4 \u8f85\u52a9\u6838\u3002</p> <p>\u6307\u4ee4\u96c6\uff1aARMv8.2+SVE\uff0c512 \u4f4d\u5411\u91cf\u5bbd\u5ea6\uff0c\u4e71\u5e8f\u6267\u884c\uff0c\u4e24\u4e2a\u6d6e\u70b9\u6d41\u6c34\u7ebf\u548c\u4e24\u4e2a\u6574\u6570\u6d41\u6c34\u7ebf\uff0c\u6bcf\u4e2a\u5468\u671f\u53cc\u7cbe\u5ea6\u6027\u80fd <code>512 / 64 * 2 * 2 = 32 FLOP/cycle</code>\uff0c\u4e3b\u9891 2.2 GHz\uff0c\u6309\u4e3b\u9891\u7b97\u7406\u8bba\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6027\u80fd <code>32 * 2.2 * 48 = 3.4 TFLOPS</code>\u3002\u6587\u6863\u91cc\u5199\u7684\u662f\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6027\u80fd 2.7 TFLOPS\uff0c\u5355\u7cbe\u5ea6 5.4 TFLOPS\uff0c\u534a\u7cbe\u5ea6 10.8 TFLOPS\uff0c8 \u4f4d\u6574\u6570 21.6 TOPS\uff0c\u5e94\u8be5\u662f\u6309\u7167\u5b9e\u9645\u6d4b\u51fa\u6765\u7684\u7b97\u3002TOP 500 \u914d\u7f6e\u662f 7630848 \u6838\uff0c\u5bf9\u5e94 <code>7630848 / 48 = 158976</code> \u4e2a\u8282\u70b9\uff0cRpeak \u662f <code>537212 TFLOPS</code>\uff0c\u90a3\u4e48\u6bcf\u4e2a\u8282\u70b9\u662f <code>537212 / 158976 = 3.38 TFLOPS</code>\uff0c\u548c\u4e0a\u9762\u7684 3.4 \u63a5\u8fd1\u3002Linpack \u8dd1\u51fa\u6765\u7684 Rmax \u662f 442010 TFLOPS\uff0c\u6bcf\u4e2a\u8282\u70b9\u662f <code>442010 / 158976 = 2.78 TFLOPS</code>\uff0c\u548c\u6587\u6863\u91cc\u8bf4\u7684\u6bd4\u8f83\u63a5\u8fd1\u3002</p> <p>\u90e8\u5206\u4e3b\u8981\u7279\u6027\uff1a</p> <ul> <li>Four-operand FMA: ARM FMA \u6307\u4ee4\u53ea\u80fd\u662f <code>R0=R0+R1*R2</code>\uff0cA64FX \u53ef\u4ee5\u5408\u5e76 <code>R0=R3,R0=R0+R1*R2</code> \u4e24\u6761\u4e3a\u4e00\u6761 <code>R0=R3+R1*R2</code> \u6307\u4ee4</li> <li>Gather/Scatter: \u975e\u8fde\u7eed\u8bbf\u5b58\uff0c\u540c\u4e00\u4e2a 128B \u5185\u8fde\u7eed\u7684 lane \u53ef\u4ee5\u5408\u5e76\u8bbf\u95ee\uff0c\u5982\u679c\u6570\u636e\u6709\u5c40\u90e8\u6027\u7684\u8bdd\uff0c\u53ef\u4ee5\u5f97\u5230\u4e24\u500d\u5e26\u5bbd</li> </ul>","tags":["cpu","manycore","intel","mic","a64fx"]},{"location":"hardware/2021/12/06/manycore/#nvidia-gpu","title":"NVIDIA GPU","text":"\u578b\u53f7 \u5de5\u827a Peak DP(TFLOPS) \u529f\u8017 (W) \u6027\u80fd\u529f\u8017\u6bd4 (TFLOPS/W) P100 16 nm FinFET+ 4.7 250 0.019 V100 12 nm FFN 7 250-300 0.023-0.028 A100 7 nm N7 9.7 250-400 0.024-0.039 \u578b\u53f7 \u5185\u5b58\u5bb9\u91cf (GB) \u5185\u5b58\u5e26\u5bbd (GB/s) \u5185\u5b58\u7c7b\u578b L2 \u7f13\u5b58\u5927\u5c0f \u5bc4\u5b58\u5668\u5806\u5927\u5c0f P100 12-16 549-732 4096 bit HBM2 4096 KB 14336 KB V100 16-32 900 4096 bit HBM2 6144 KB 20480 KB A100 40-80 1555-2039 5120 bit HBM2 40960 KB 27648 KB \u578b\u53f7 SM \u6570\u91cf CUDA \u6838\u5fc3\u6570 FP64 \u6838\u5fc3\u6570 SM \u9891\u7387 (MHz) P100 56 3584 1792 1328 V100 80 5120 2560 1380 A100 108 6912 3456 1410 <ul> <li>CUDA \u6838\u5fc3\u6570 = SM \u6570\u91cf * 64</li> <li>FP64 \u6838\u5fc3\u6570 = SM \u6570\u91cf * 32</li> <li>Peak DP = FP64 \u6838\u5fc3\u6570 * SM \u9891\u7387 * 2</li> <li>\u5bc4\u5b58\u5668\u5806\u5927\u5c0f = SM \u6570\u91cf * 256 KB</li> </ul>","tags":["cpu","manycore","intel","mic","a64fx"]},{"location":"hardware/2022/05/10/memory-authentication/","title":"\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5","text":"","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d @\u677e \u7ed9\u6211\u8bb2\u8fc7\u4e00\u4e9b\u5185\u5b58\u8ba4\u8bc1\uff08Memory Authentication\uff09\u7b97\u6cd5\u7684\u5185\u5bb9\uff0c\u53d7\u76ca\u532a\u6d45\uff0c\u521a\u597d\u4eca\u5929\u67d0\u786c\u4ef6\u7fa4\u91cc\u53c8\u8ba8\u8bba\u5230\u4e86\u8fd9\u4e2a\u8bdd\u9898\uff0c\u4e8e\u662f\u8d81\u6b64\u673a\u4f1a\u518d\u5b66\u4e60\u548c\u6574\u7406\u4e00\u4e0b\u76f8\u5173\u7684\u77e5\u8bc6\u3002</p> <p>\u5185\u5b58\u8ba4\u8bc1\u8ba1\u7b97\u7684\u80cc\u666f\u662f\u53ef\u4fe1\u8ba1\u7b97\uff0c\u6bd4\u5982\u8981\u505a\u4e00\u4e9b\u6d89\u53ca\u91cd\u8981\u6570\u636e\u7684\u5904\u7406\uff0c\u4ece\u8f6f\u4ef6\u4e0a\uff0c\u5e0c\u671b\u5373\u4f7f\u7cfb\u7edf\u88ab\u653b\u51fb\u975e\u6cd5\u8fdb\u5165\u4e86\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u91cd\u8981\u4fe1\u606f\u4e0d\u4f1a\u6cc4\u6f0f\uff1b\u4ece\u786c\u4ef6\u4e0a\uff0c\u5e0c\u671b\u5373\u4f7f\u7cfb\u7edf\u53ef\u4ee5\u88ab\u653b\u51fb\u8005\u8fdb\u884c\u4e00\u4e9b\u7269\u7406\u7684\u64cd\u4f5c\uff08\u6bd4\u5982\u5bfc\u51fa\u6216\u8005\u4fee\u6539\u5185\u5b58\u7b49\u7b49\uff09\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u653b\u51fb\u8005\u65e0\u6cd5\u8bfb\u53d6\u6216\u8005\u7be1\u6539\u6570\u636e\u3002</p> <p>\u4e0b\u9762\u7684\u5185\u5bb9\u4e3b\u8981\u53c2\u8003\u4e86 Hardware Mechanisms for Memory Authentication: A Survey of Existing Techniques and Engines \u8fd9\u7bc7 2009 \u5e74\u7684\u6587\u7ae0\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#\u5a01\u80c1\u6a21\u578b","title":"\u5a01\u80c1\u6a21\u578b","text":"<p>\u4f5c\u4e3a\u4e00\u4e2a\u9632\u5fa1\u673a\u5236\uff0c\u9996\u5148\u8981\u786e\u5b9a\u653b\u51fb\u65b9\u7684\u80fd\u529b\u3002\u4e00\u4e2a\u5e38\u89c1\u7684\u5a01\u80c1\u6a21\u578b\u662f\u8ba4\u4e3a\uff0c\u653b\u51fb\u8005\u5177\u6709\u7269\u7406\u7684\u63a7\u5236\uff0c\u53ef\u4ee5\u4efb\u610f\u64cd\u63a7\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u4f46\u662f\u65e0\u6cd5\u8bfb\u53d6\u6216\u8005\u4fee\u6539 CPU \u5185\u90e8\u7684\u6570\u636e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u6709 CPU \u82af\u7247\u5185\u7684\u6570\u636e\u662f\u53ef\u4fe1\u7684\uff0c\u79bb\u5f00\u4e86\u82af\u7247\u90fd\u662f\u653b\u51fb\u8005\u638c\u63a7\u7684\u8303\u56f4\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u60f3\u6cd5\u662f\u8ba9\u5185\u5b58\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u662f\u52a0\u5bc6\u7684\uff0c\u90a3\u4e48\u600e\u6837\u653b\u51fb\u8005\u53ef\u4ee5\u5982\u4f55\u653b\u51fb\u52a0\u5bc6\u7684\u6570\u636e\uff1f\u4e0b\u9762\u662f\u51e0\u4e2a\u5178\u578b\u7684\u653b\u51fb\u65b9\u6cd5\uff1a</p> <ul> <li>Spoofing attack\uff1a\u628a\u5185\u5b58\u6570\u636e\u6539\u6210\u4efb\u610f\u653b\u51fb\u8005\u63a7\u5236\u7684\u6570\u636e\uff1b\u8fd9\u79cd\u653b\u51fb\u53ef\u4ee5\u901a\u8fc7\u7b7e\u540d\u6765\u89e3\u51b3</li> <li>Splicing or relocation attack\uff1a\u628a\u67d0\u4e00\u6bb5\u5185\u5b58\u6570\u636e\u632a\u5230\u53e6\u4e00\u90e8\u5206\uff0c\u8fd9\u6837\u6570\u636e\u7684\u7b7e\u540d\u4f9d\u7136\u662f\u6b63\u786e\u7684\uff1b\u6240\u4ee5\u8ba1\u7b97\u7b7e\u540d\u65f6\u9700\u8981\u628a\u5730\u5740\u8003\u8651\u8fdb\u6765\uff0c\u8fd9\u6837\u5730\u5740\u53d8\u4e86\uff0c\u9a8c\u8bc1\u7b7e\u540d\u5c31\u4f1a\u5931\u8d25</li> <li>Replay attack\uff1a\u5982\u679c\u540c\u4e00\u4e2a\u5730\u5740\u7684\u5185\u5b58\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u628a\u65e7\u7684\u5185\u5b58\u6570\u636e\u518d\u5199\u8fdb\u53bb\uff0c\u8fd9\u6837\u7b7e\u540d\u548c\u5730\u5740\u90fd\u662f\u6b63\u786e\u7684\uff1b\u4e3a\u4e86\u9632\u6b62\u91cd\u653e\u653b\u51fb\uff0c\u8fd8\u9700\u8981\u5f15\u5165\u8ba1\u6570\u5668\u6216\u8005\u968f\u673a nonce</li> </ul>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#authentication-primitives","title":"Authentication Primitives","text":"<p>\u4e3a\u4e86\u9632\u5fa1\u4e0a\u9762\u51e0\u79cd\u653b\u51fb\u65b9\u6cd5\uff0c\u4e0a\u9762\u63d0\u5230\u7684\u6587\u7ae0\u91cc\u63d0\u5230\u4e86\u5982\u4e0b\u7684\u601d\u8def\uff1a</p> <p>\u4e00\u662f Hash Function\uff0c\u628a\u5185\u5b58\u5206\u4e3a\u5f88\u591a\u4e2a\u5757\uff0c\u6bcf\u4e00\u5757\u8ba1\u7b97\u4e00\u4e2a\u5bc6\u7801\u5b66 Hash \u4fdd\u5b58\u5728\u7247\u5185\uff0c\u90a3\u4e48\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u628a\u6574\u5757\u6570\u636e\u8bfb\u53d6\u8fdb\u6765\uff0c\u8ba1\u7b97\u4e00\u6b21 Hash\uff0c\u548c\u7247\u5185\u4fdd\u5b58\u7684\u7ed3\u679c\u8fdb\u884c\u6bd4\u5bf9\uff1b\u5199\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u91cd\u65b0\u8ba1\u7b97\u4e00\u6b21\u4fee\u6539\u540e\u6570\u636e\u7684 Hash\uff0c\u66f4\u65b0\u5230\u7247\u5185\u7684\u5b58\u50a8\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u7f3a\u70b9\u662f\u6ca1\u6709\u52a0\u5bc6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u770b\u5230\u5185\u5bb9\uff0c\u53ea\u4e0d\u8fc7\u4e00\u4fee\u6539\u5c31\u4f1a\u88ab CPU \u53d1\u73b0\uff08\u9664\u975e Hash \u51b2\u7a81\uff09\uff0c\u5e76\u4e14\u5b58\u50a8\u4ee3\u4ef7\u5f88\u5927\uff1a\u6bd4\u5982 512-bit \u7684\u5757\uff0c\u6bcf\u4e00\u5757\u8ba1\u7b97\u4e00\u4e2a 128-bit \u7684 Hash\uff0c\u90a3\u5c31\u6d6a\u8d39\u4e86 25% \u7684\u7a7a\u95f4\uff0c\u800c\u7247\u5185\u7a7a\u95f4\u662f\u5341\u5206\u5b9d\u8d35\u7684\u3002</p> <p>\u4e8c\u662f MAC Function\uff0c\u4e5f\u5c31\u662f\u5bc6\u7801\u5b66\u7684\u6d88\u606f\u9a8c\u8bc1\u7801\uff0c\u5b83\u9700\u8981\u4e00\u4e2a Key\uff0c\u4fdd\u5b58\u5728\u7247\u5185\uff1b\u7531\u4e8e\u653b\u51fb\u8005\u4e0d\u77e5\u9053\u5bc6\u7801\uff0c\u6839\u636e MAC \u7684\u6027\u8d28\uff0c\u653b\u51fb\u8005\u65e0\u6cd5\u7be1\u6539\u6570\u636e\uff0c\u4e5f\u65e0\u6cd5\u4f2a\u9020 MAC\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u628a\u8ba1\u7b97\u51fa\u6765\u7684 MAC \u4e5f\u4fdd\u5b58\u5230\u5185\u5b58\u91cc\u3002\u4e3a\u4e86\u9632\u5fa1\u91cd\u653e\u653b\u51fb\uff0c\u9700\u8981\u5f15\u5165\u968f\u673a\u7684 nonce\uff0c\u5e76\u4e14\u628a nonce \u4fdd\u5b58\u5728\u7247\u5185\uff0c\u6bd4\u5982\u6bcf 512-bit \u7684\u6570\u636e\uff0c\u4fdd\u5b58 64-bit \u7684 nonce\uff0c\u8fd9\u6837\u7247\u5185\u9700\u8981\u4fdd\u5b58 12.5% \u7684\u7a7a\u95f4\uff0c\u4f9d\u7136\u4e0d\u5c11\u3002MAC \u672c\u8eab\u4e5f\u4e0d\u52a0\u5bc6\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5e0c\u671b\u653b\u51fb\u8005\u770b\u5230\u660e\u6587\uff0c\u8fd8\u9700\u8981\u8fdb\u884c\u52a0\u5bc6\u3002</p> <p>\u4e09\u662f Block-Level AREA\uff0c\u4e5f\u5c31\u662f\u5728\u628a\u660e\u6587\u548c\u968f\u673a\u7684 nonce \u62fc\u63a5\u8d77\u6765\uff0c\u91c7\u7528\u5757\u52a0\u5bc6\u7b97\u6cd5\uff0c\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff1b\u89e3\u5bc6\u7684\u65f6\u5019\uff0c\u9a8c\u8bc1\u6700\u540e\u7684 nonce \u548c\u7247\u5185\u4fdd\u5b58\u7684\u4e00\u81f4\u3002\u8fd9\u4e2a\u65b9\u6cd5\u548c MAC \u6bd4\u8f83\u7c7b\u4f3c\uff0c\u540c\u65f6\u505a\u4e86\u52a0\u5bc6\u7684\u4e8b\u60c5\uff0c\u4e5f\u9700\u8981\u5728\u7247\u5185\u4fdd\u5b58\u6bcf\u5757\u6570\u636e\u5bf9\u5e94\u7684\u968f\u673a nonce\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#integrity-tree","title":"Integrity Tree","text":"<p>\u4f46\u662f\u4e0a\u9762\u51e0\u79cd\u65b9\u6cd5\u5f00\u9500\u90fd\u6bd4\u8f83\u5927\uff0c\u6bd4\u5982\u8981\u4fdd\u62a4 1GB \u7684\u5185\u5b58\uff0c\u90a3\u4e48\u7247\u5185\u5c31\u8981\u4fdd\u5b58\u51e0\u767e MB \u7684\u6570\u636e\uff0c\u8fd9\u5bf9\u4e8e\u7247\u5185\u5b58\u50a8\u6765\u8bf4\u592a\u5927\u4e86\u3002\u8fd9\u65f6\u5019\uff0c\u53ef\u4ee5\u91c7\u7528\u533a\u5757\u94fe\u91cc\u5e38\u7528\u7684 Merkle Tree \u6216\u8005\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6765\u7528\u65f6\u95f4\u6362\u7a7a\u95f4\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u7684\u4e3b\u8981\u601d\u8def\u662f\uff0c\u9996\u5148\u628a\u5185\u5b58\u5212\u5206\u4e3a\u5f88\u591a\u4e2a\u5757\uff0c\u8fd9\u4e9b\u5757\u5bf9\u5e94\u4e00\u9897\u6811\u7684\u53f6\u5b50\u7ed3\u70b9\uff1b\u81ea\u5e95\u5411\u4e0a\u6784\u5efa\u4e00\u9897\u6811\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u53ef\u4ee5\u9a8c\u8bc1\u5b83\u7684\u5b50\u7ed3\u70b9\u7684\u5b8c\u6574\u6027\uff0c\u90a3\u4e48\u7ecf\u8fc7 log(n) \u5c42\u7684\u6811\uff0c\u6700\u540e\u53ea\u4f1a\u5f97\u5230\u4e00\u4e2a\u5f88\u5c0f\u7684\u6839\u7ed3\u70b9\uff0c\u53ea\u9700\u8981\u628a\u6839\u7ed3\u70b9\u4fdd\u5b58\u5728\u7247\u5185\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u67d0\u4e00\u4e2a\u5757\u7684\u5b8c\u6574\u6027\uff0c\u5c31\u4ece\u8fd9\u4e00\u5757\u5bf9\u5e94\u7684\u53f6\u5b50\u7ed3\u70b9\u5f00\u59cb\uff0c\u4e0d\u65ad\u8ba1\u7b97\u51fa\u4e00\u4e2a\u503c\uff0c\u548c\u7236\u4eb2\u7ed3\u70b9\u6bd4\u8f83\uff1b\u518d\u9012\u5f52\u5411\u4e0a\uff0c\u6700\u540e\u8ba1\u7b97\u51fa\u6839\u7ed3\u70b9\u7684\u503c\uff0c\u548c\u7247\u5185\u4fdd\u5b58\u7684\u503c\u8fdb\u884c\u5bf9\u6bd4\u3002\u8fd9\u6837\u9a8c\u8bc1\u7684\u590d\u6742\u5ea6\u662f O(logn)\uff0c\u4f46\u662f\u7247\u5185\u4fdd\u5b58\u7684\u6570\u636e\u53d8\u6210\u4e86 O(1)\uff0c\u6240\u4ee5\u662f\u4ee5\u65f6\u95f4\u6362\u7a7a\u95f4\u3002\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u7c7b\u4f3c\u5730\u4ece\u53f6\u5b50\u7ed3\u70b9\u4e00\u6b65\u4e00\u6b65\u8ba1\u7b97\uff0c\u6700\u540e\u66f4\u65b0\u6839\u7ed3\u70b9\u7684\u503c\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u6d6a\u8d39\u7684\u7a7a\u95f4\uff0c\u8003\u8651\u6240\u6709\u975e\u53f6\u5b50\u7ed3\u70b9\u4fdd\u5b58\u7684\u6570\u636e\uff0c\u5982\u679c\u662f\u4e8c\u53c9\u6811\uff0c\u603b\u7684\u5927\u5c0f\u5c31\u662f\u6570\u636e\u7684\u4e00\u534a\uff0c\u4f46\u662f\u597d\u5904\u662f\u5927\u90e8\u5206\u90fd\u53ef\u4ee5\u4fdd\u5b58\u5728\u5185\u5b58\u91cc\uff0c\u6240\u4ee5\u662f\u6bd4\u8f83\u5bb9\u6613\u5b9e\u73b0\u7684\u3002\u7f3a\u70b9\u662f\u6bcf\u6b21\u8bfb\u53d6\u548c\u5199\u5165\u90fd\u8981\u8fdb\u884c O(logn) \u6b21\u7684\u5185\u5b58\u8bbf\u95ee\u548c\u8ba1\u7b97\uff0c\u5f00\u9500\u6bd4\u8f83\u5927\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u7684\u7236\u7ed3\u70b9\u7684\u503c\u7684\u8ba1\u7b97\u65b9\u6cd5\uff0c\u5982\u679c\u91c7\u7528\u5bc6\u7801\u5b66 Hash \u51fd\u6570\uff0c\u8fd9\u68f5\u6811\u5c31\u662f Merkle Tree\u3002\u5b83\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u662f\u53ea\u8bfb\u7684\uff0c\u53ef\u4ee5\u5e76\u884c\u7684\uff0c\u4f46\u662f\u66f4\u65b0\u8fc7\u7a0b\u662f\u4e32\u884c\u7684\uff0c\u56e0\u4e3a\u8981\u4ece\u5b50\u7ed3\u70b9\u4e00\u6b65\u4e00\u6b65\u8ba1\u7b97 Hash\uff0c\u7236\u7ed3\u70b9\u4f9d\u8d56\u5b50\u7ed3\u70b9\u7684 Hash \u7ed3\u679c\u3002</p> <p>\u53e6\u4e00\u79cd\u8bbe\u8ba1\u662f Parallelizable Authentication Tree\uff08PAT\uff09\uff0c\u5b83\u91c7\u7528 MAC \u800c\u4e0d\u662f Hash\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u4fdd\u5b58\u4e86\u4e00\u4e2a\u968f\u673a\u7684 nonce \u548c\u8ba1\u7b97\u51fa\u6765\u7684 MAC \u503c\uff0c\u6700\u5e95\u5c42\u7684 MAC \u8f93\u5165\u662f\u5b9e\u9645\u7684\u6570\u636e\uff0c\u5176\u4ed6\u5c42\u7684 MAC \u8f93\u5165\u662f\u5b50\u7ed3\u70b9\u7684 nonce\uff0c\u6700\u540e\u5728\u7247\u5185\u4fdd\u5b58\u6700\u540e\u4e00\u6b21 MAC \u4f7f\u7528\u7684 nonce \u503c\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u5c42\u90fd\u53ef\u4ee5\u5e76\u884c\u7b97\uff0c\u56e0\u4e3a MAC \u7684\u8f93\u5165\u662f nonce \u503c\uff0c\u4e0d\u6d89\u53ca\u5230\u5b50\u7ed3\u70b9\u7684 MAC \u8ba1\u7b97\u7ed3\u679c\u3002\u7f3a\u70b9\u662f\u8981\u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff0c\u5373 MAC \u548c nonce\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u8bbe\u8ba1\u662f Tamper-Evident Counter Tree\uff08TEC-Tree\uff09\uff0c\u8ba1\u7b97\u7684\u65b9\u6cd5\u5219\u662f\u4e0a\u9762\u63d0\u5230\u7684 Block-level AREA\u3002\u7c7b\u4f3c\u5730\uff0c\u6700\u5e95\u5c42\u662f\u7528\u6570\u636e\u548c\u968f\u673a nonce \u62fc\u8d77\u6765\u505a\u52a0\u5bc6\uff0c\u800c\u5176\u4ed6\u5c42\u662f\u7528\u5b50\u8282\u70b9\u7684\u968f\u673a nonce \u62fc\u8d77\u6765\uff0c\u518d\u62fc\u63a5\u4e0a\u8fd9\u4e00\u5c42\u7684 nonce \u505a\u52a0\u5bc6\u3002\u9a8c\u8bc1\u7684\u65f6\u5019\uff0c\u9996\u5148\u5bf9\u6700\u5e95\u5c42\u8fdb\u884c\u89e3\u5bc6\uff0c\u7136\u540e\u5224\u65ad\u6570\u636e\u662f\u5426\u5339\u914d\uff0c\u7136\u540e\u518d\u89e3\u5bc6\u4e0a\u4e00\u5c42\uff0c\u5224\u65ad nonce \u662f\u5426\u5339\u914d\uff0c\u4e00\u76f4\u9012\u5f52\uff0c\u6700\u540e\u89e3\u5bc6\u5230\u6839\u7684 nonce\uff0c\u548c\u7247\u5185\u4fdd\u5b58\u7684\u8fdb\u884c\u5339\u914d\u3002\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u4e00\u6b21\u6027\u751f\u4ea7\u4e00\u7cfb\u5217\u7684 nonce\uff0c\u7136\u540e\u5e76\u884c\u5730\u52a0\u5bc6\u6bcf\u4e00\u5c42\u7684\u7ed3\u679c\u3002</p> <p>\u6700\u540e\u5f15\u7528\u6587\u7ae0\u91cc\u7684\u4e00\u4e2a\u5bf9\u6bd4\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u540e\u4e24\u79cd\u7b97\u6cd5\u53ef\u4ee5\u5e76\u884c\u5730\u66f4\u65b0\u6811\u7684\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#cached-trees","title":"Cached Trees","text":"<p>\u4ece\u4e0a\u9762\u7684 Integrity Tree \u7b97\u6cd5\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u6b21\u8bfb\u53d6\u6216\u8005\u5199\u5165\u90fd\u8981\u8bbf\u95ee\u5185\u5b58 O(logn) \u6b21\uff0c\u8fd9\u4e2a\u5bf9\u6027\u80fd\u5f71\u54cd\u662f\u5341\u5206\u5de8\u5927\u7684\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u601d\u8def\u662f\uff0c\u6211\u628a\u4e00\u4e9b\u7ecf\u5e38\u8bbf\u95ee\u7684\u6811\u7ed3\u70b9\u4fdd\u5b58\u5728\u7247\u5185\u7684\u7f13\u5b58\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u4e00\u4e9b\u5185\u5b58\u8bbf\u95ee\u6b21\u6570\uff1b\u8fdb\u4e00\u6b65\u5730\uff0c\u5982\u679c\u8ba4\u4e3a\u653b\u51fb\u8005\u65e0\u6cd5\u7be1\u6539\u7247\u5185\u7684\u7f13\u5b58\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f4\u63a5\u8ba4\u4e3a\u7247\u5185\u7684\u7ed3\u70b9\u90fd\u662f\u53ef\u4fe1\u7684\uff0c\u5728\u9a8c\u8bc1\u548c\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u4ece\u53f6\u5b50\u7ed3\u70b9\u904d\u5386\u5230\u7f13\u5b58\u5728\u7247\u5185\u7684\u7ed3\u70b9\u5373\u53ef\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#the-bonsai-merkle-tree","title":"The Bonsai Merkle Tree","text":"<p>\u4e3a\u4e86\u8fdb\u4e00\u6b65\u51cf\u5c11\u7a7a\u95f4\u7684\u5360\u7528\uff0cBonsai Merkle Tree\uff08BMT\uff09\u7684\u601d\u8def\u662f\uff0c\u65e2\u7136\u5bf9\u6bcf\u4e2a\u5185\u5b58\u5757\u90fd\u751f\u6210\u4e00\u4e2a\u6bd4\u8f83\u957f\u7684\uff08\u6bd4\u5982 64 \u4f4d\uff09\u7684 nonce \u6bd4\u8f83\u8017\u8d39\u7a7a\u95f4\uff0c\u90a3\u662f\u5426\u53ef\u4ee5\u51cf\u5c11\u4e00\u4e0b nonce \u7684\u4f4d\u6570\uff0c\u5f53 nonce \u51fa\u73b0\u91cd\u590d\u7684\u65f6\u5019\uff0c\u6362\u4e00\u4e2a\u5bc6\u94a5\u91cd\u65b0\u52a0\u5bc6\u5462\uff1f\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u6bcf\u4e2a\u5185\u5b58\u5757\u505a\u4e00\u6b21 MAC \u8ba1\u7b97\uff0c\u8f93\u5165\u662f\u6570\u636e\uff0c\u5730\u5740\u548c counter\uff1a<code>M=MAC(C, addr, ctr)</code>\u3002\u6b64\u65f6\uff0c\u5730\u5740\u548c <code>ctr</code> \u5145\u5f53\u4e86\u539f\u6765\u7684 nonce \u7684\u4f5c\u7528\uff0c\u6240\u4ee5\u7c7b\u4f3c\u5730\uff0c\u6b64\u65f6\u7684 Merkle Tree \u4fdd\u62a4\u7684\u662f\u8fd9\u4e9b counter\uff0c\u7531\u4e8e counter \u4f4d\u6570\u6bd4\u8f83\u5c11\uff0c\u5c31\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5730\u51cf\u5c11\u7a7a\u95f4\u7684\u5f00\u9500\uff0c\u800c\u4e14\u6811\u7684\u5c42\u6570\u4e5f\u66f4\u5c11\u4e86\u3002\u7f3a\u70b9\u662f\u65e2\u7136\u4f4d\u6570\u5c11\u4e86\uff0c\u5982\u679c counter \u51fa\u73b0\u4e86\u91cd\u590d\uff0c\u5c31\u9700\u8981\u66f4\u6362\u5bc6\u94a5\uff0c\u91cd\u65b0\u8fdb\u884c\u4e00\u6b21\u52a0\u5bc6\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u8017\u8d39\u65f6\u95f4\uff0c\u6240\u4ee5\u8fd8\u8981\u5c3d\u91cf\u51cf\u5c11\u91cd\u65b0\u52a0\u5bc6\u7684\u6b21\u6570\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u653e\u653b\u51fb\uff0c\u6bcf\u6b21\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u8ba9 counter \u52a0\u4e00\uff0c\u8fd9\u548c\u539f\u6765\u91c7\u7528\u4e00\u4e2a\u8db3\u591f\u957f\uff08\u6bd4\u5982 64-bit\uff09\u7684\u968f\u673a nonce \u662f\u7c7b\u4f3c\u7684\u3002\u91cd\u65b0\u52a0\u5bc6\u662f\u5f88\u8017\u8d39\u65f6\u95f4\u7684\uff0c\u56e0\u6b64\u4e3a\u4e86\u628a\u91cd\u65b0\u52a0\u5bc6\u7684\u8303\u56f4\u5c40\u9650\u5230\u4e00\u4e2a\u5c0f\u7684\u5c40\u90e8\uff0c\u53c8\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u4e24\u7ea7\u7684 counter\uff1a7-bit \u7684 local counter\uff0c\u6bcf\u6b21\u66f4\u65b0\u6570\u636e\u52a0\u4e00\uff1b64-bit \u7684 global counter\uff0c\u5f53\u67d0\u4e00\u4e2a local counter \u6ea2\u51fa\u7684\u65f6\u5019\u52a0\u4e00\u3002\u8fd9\u65f6\u5019\u5b9e\u9645\u4f20\u5165 MAC \u8ba1\u7b97\u7684 counter \u5219\u662f global counter \u62fc\u63a5\u4e0a local counter\u3002\u8fd9\u6837\u76f8\u5f53\u4e8e\u662f\u505a\u4e86\u4e00\u4e2a counter \u7684\u5171\u540c\u524d\u7f00\uff0c\u5728\u5185\u5b58\u8bbf\u95ee\u6bd4\u8f83\u5747\u5300\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u6bcf\u4e2a local counter \u8f6e\u6d41\u52a0\u4e00\uff0c\u90a3\u4e48\u6bcf\u6b21 local counter \u6ea2\u51fa\u53ea\u9700\u8981\u91cd\u65b0\u52a0\u5bc6\u4e00\u4e2a\u5c0f\u8303\u56f4\u7684\u5185\u5b58\uff0c\u51cf\u5c11\u4e86\u5f00\u9500\u3002</p> <p>\u6587\u7ae0\u540e\u7eed\u8fd8\u63d0\u5230\u4e86\u4e00\u4e9b\u76f8\u5173\u7684\u7b97\u6cd5\uff0c\u8fd9\u91cc\u5c31\u4e0d\u7ee7\u7eed\u7ffb\u8bd1\u548c\u603b\u7ed3\u4e86\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#mountable-merkle-tree","title":"Mountable Merkle Tree","text":"<p>\u518d\u6765\u770b\u4e00\u4e0b Scalable Memory Protection in the Penglai Enclave \u4e2d\u63d0\u5230\u7684 Mountable Merkle Tree \u8bbe\u8ba1\u3002\u5b83\u4e3b\u8981\u8003\u8651\u7684\u662f\u52a8\u6001\u53ef\u53d8\u7684\u4fdd\u62a4\u5185\u5b58\u533a\u57df\uff0c\u6bd4\u5982\u63d0\u5230\u7684\u5fae\u670d\u52a1\u573a\u666f\uff0c\u5e76\u4e14\u88ab\u4fdd\u62a4\u5185\u5b58\u533a\u57df\u7684\u8bbf\u95ee\u6709\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u56e0\u6b64\u5b83\u7684\u601d\u8def\u662f\uff0c\u4e0d\u53bb\u6784\u9020\u4e00\u4e2a\u5bf9\u5e94\u5b8c\u6574\u5185\u5b58\u7684 Merkle Tree\uff0c\u800c\u662f\u5141\u8bb8\u4e00\u4e9b\u5b50\u6811\u4e0d\u5b58\u5728\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5b83\u8bbe\u8ba1\u4e86\u4e00\u4e2a Sub-root nodes \u7684\u6982\u5ff5\uff0c\u5bf9\u5e94\u4e86 Merkle Tree \u4e2d\u95f4\u7684\u4e00\u5c42\u3002\u8fd9\u4e00\u5c42\u5f80\u4e0a\u662f\u9884\u5148\u5206\u914d\u597d\u7684\uff0c\u5e76\u4e14\u5927\u90e8\u5206\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u6839\u7ed3\u70b9\u4fdd\u5b58\u5728\u7247\u5185\uff0c\u8fd9\u4e00\u5c42\u5f80\u4e0b\u662f\u52a8\u6001\u5206\u914d\u7684\u3002\u6bd4\u5982\u5e94\u7528\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 enclave\uff0c\u9700\u8981\u65b0\u7684\u4e00\u4e2a\u88ab\u4fdd\u62a4\u7684\u5185\u5b58\u533a\u57df\uff0c\u518d\u52a8\u6001\u5206\u914d\u82e5\u5e72\u4e2a Merkle Tree\uff0c\u63a5\u5230 Sub-root nodes \u5c42\uff0c\u6210\u4e3a\u65b0\u7684\u5b50\u6811\u3002</p> <p></p> <p>\u7531\u4e8e\u7247\u5185\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u91c7\u53d6\u4e86\u7f13\u5b58\u7684\u65b9\u5f0f\uff0c\u53ea\u628a\u4e00\u90e8\u5206\u5e38\u7528\u7684\u6811\u7ed3\u70b9\u4fdd\u5b58\u5728\u7247\u5185\uff1b\u5982\u679c\u67d0\u4e00\u4e2a\u5b50\u6811\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u53ef\u4ee5\u6362\u51fa\u5230\u5185\u5b58\u91cc\u3002\u5982\u679c\u5220\u9664\u4e86\u4e00\u4e2a\u5df2\u6709\u7684 enclave\uff0c\u90a3\u4e48\u76f8\u5e94\u7684\u5b50\u6811\u5c31\u53ef\u4ee5\u5220\u6389\uff0c\u51cf\u5c11\u5185\u5b58\u7a7a\u95f4\u7684\u5360\u7528\u3002</p>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2022/05/10/memory-authentication/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Hardware Mechanisms for Memory Authentication: A Survey of Existing Techniques and Engines</li> <li>Scalable Memory Protection in the Penglai Enclave</li> </ul>","tags":["memory","bus","dram","auth","teaching"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/","title":"\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f","text":"","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f\u662f\u4e00\u4e2a\u8d2f\u7a7f\u8f6f\u786c\u4ef6\u5b9e\u73b0\u7684\u6982\u5ff5\uff0c\u4f60\u53ef\u4ee5\u5728 CPU \u5fae\u67b6\u6784\uff0c\u603b\u7ebf\uff0c\u5230\u6c47\u7f16\u6307\u4ee4\uff0c\u7f16\u8bd1\u5668\u548c\u7f16\u7a0b\u8bed\u8a00\u4e2d\u770b\u5230\u5b83\u4eec\u3002\u672c\u6587\u4e3b\u8981\u6765\u63a2\u8ba8\u8fd9\u4e9b\u95ee\u9898\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u5185\u5b58\u6a21\u578b","title":"\u5185\u5b58\u6a21\u578b","text":"<p>\u5bf9\u4e8e\u5904\u7406\u5668\u6838\u5fc3\u6765\u8bf4\uff0c\u5982\u4f55\u5b9e\u73b0\u8bbf\u5b58\u6307\u4ee4\uff0c\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u662f\u5341\u5206\u663e\u8457\u7684\u3002\u6700\u57fa\u7840\u7684\u786c\u4ef6\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5c31\u662f\u4e32\u884c\u5730\u5b8c\u6210\u6bcf\u4e00\u6761 Load \u548c Store \u6307\u4ee4\uff0c\u6bcf\u4e00\u6761\u8bbf\u5b58\u6307\u4ee4\u6267\u884c\u5b8c\uff0c\u624d\u80fd\u5f00\u59cb\u6267\u884c\u4e0b\u4e00\u6761\u8bbf\u5b58\u6307\u4ee4\u3002\u4f46\u5982\u679c\u6b63\u5728\u6267\u884c\u7684\u8bbf\u5b58\u6307\u4ee4 A \u9047\u5230\u4e86\u7f13\u5b58\u7f3a\u5931\uff0c\u9700\u8981\u7b49\u5f85\u7f13\u5b58\u7684\u56de\u586b\uff0c\u7531\u4e8e\u786c\u4ef6\u53ea\u5b9e\u73b0\u4e86\u4e32\u884c\u6267\u884c\uff0c\u5728 A \u4e4b\u540e\u672a\u6765\u8981\u6267\u884c\u7684\u8bbf\u5b58\u6307\u4ee4 B \u53c8\u5fc5\u987b\u7b49\u5f85 A \u7684\u5b8c\u6210\uff0c\u8017\u8d39\u7684\u65f6\u95f4\u5c31\u4f1a\u6bd4\u8f83\u957f\u3002</p> <p>\u4f46\u5f88\u591a\u65f6\u5019\uff0cB \u6307\u4ee4\u5e76\u4e0d\u4f9d\u8d56 A \u6307\u4ee4\uff0c\u53ef\u80fd\u8bbf\u95ee\u7684\u662f\u4e0d\u540c\u7684\u5185\u5b58\u5730\u5740\uff0c\u53ef\u80fd B \u8981\u8bbf\u95ee\u7684\u6570\u636e\u5c31\u5728\u7f13\u5b58\u4e2d\uff0c\u5982\u679c\u80fd\u591f\u5728 A \u7b49\u5f85\u7f13\u5b58\u56de\u586b\u7684\u65f6\u95f4\u540c\u65f6\u6267\u884c B\uff0c\u6027\u80fd\u53ef\u4ee5\u5f97\u5230\u63d0\u5347\u3002\u4f46\u5e76\u975e\u6240\u6709\u7684 B \u90fd\u53ef\u4ee5\u63d0\u524d\u6267\u884c\u7684\uff0c\u6bd4\u5982</p> <ul> <li>\u4ece\u6838\u5185\u7684\u89c6\u89d2\u6765\u770b\uff0cA \u548c B \u8bbf\u95ee\u7684\u5185\u5b58\u8303\u56f4\u6709\u91cd\u5408\uff0c\u90a3\u4e48\u5b83\u4eec\u7684\u6267\u884c\u987a\u5e8f\u5c31\u5f88\u91cd\u8981\uff1a<ul> <li>\u5982\u679c A \u662f Store \u6307\u4ee4\uff0cB \u662f Load \u6307\u4ee4\uff0cB \u5728 A \u4e4b\u524d\u6267\u884c\uff0cB \u63d0\u65e9\u4ece Cache \u8bfb\u53d6\u6570\u636e\uff0c\u5f97\u5230\u7684\u662f A \u5199\u5165\u4e4b\u524d\u7684\u7ed3\u679c\uff0c\u6570\u636e\u5c31\u9519\u4e86\u3002\u4e0d\u8fc7\u597d\u5728\u8fd9\u53ef\u4ee5\u901a\u8fc7 Store to Load Forwarding \u89e3\u51b3\uff0c\u628a A \u8981\u5199\u5165\u7684\u6570\u636e\u4ee5\u53ca Cache \u4e2d\u7684\u6570\u636e\u62fc\u63a5\u51fa\uff0c\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684 B \u8981\u8bfb\u53d6\u7684\u6570\u636e\u3002</li> <li>\u5982\u679c A \u662f Load \u6307\u4ee4\uff0cB \u662f Store \u6307\u4ee4\uff0cB \u5728 A \u4e4b\u524d\u6267\u884c\uff0c\u63d0\u65e9\u5411 Cache \u5199\u5165\u6570\u636e\uff0c\u90a3\u4e48 A \u90fd\u51fa\u6765\u7684\u5c31\u662f B \u5199\u5165\u4e4b\u540e\u7684\u7ed3\u679c\uff0c\u6570\u636e\u5c31\u9519\u4e86\u3002</li> <li>\u5982\u679c A \u548c B \u90fd\u662f Store \u6307\u4ee4\uff0cB \u5728 A \u4e4b\u524d\u6267\u884c\uff0c\u90a3\u4e48\u6700\u7ec8\u5185\u5b58\u4e2d\u7684\u503c\u662f A \u8986\u76d6\u4e86 B\uff0c\u800c\u4e0d\u662f\u9884\u671f\u7684 B \u8986\u76d6\u4e86 A</li> </ul> </li> <li>\u4ece\u6838\u5916\u7684\u89c6\u89d2\u6765\u770b\uff0c\u5047\u5982\u76ee\u524d\u6b63\u5728\u4e00\u4e2a\u88ab\u9501\u4fdd\u62a4\u7684\u4e34\u754c\u533a\uff0cA \u662f\u5bf9\u88ab\u4fdd\u62a4\u7684\u6570\u636e\u7684\u4fee\u6539\uff0cB \u662f\u91ca\u653e\u9501\uff0c\u5982\u679c B \u5728 A \u4e4b\u524d\u6267\u884c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u9501\u91ca\u653e\u4e86\uff0c\u4f46\u8fd8\u5728\u4fee\u6539\u88ab\u4fdd\u62a4\u7684\u6570\u636e\u7684\u60c5\u51b5\u3002</li> </ul> <p>\u53ef\u80fd\u8fd8\u6709\u5176\u4ed6\u7c7b\u4f3c\u7684\u573a\u666f\uff0c\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c\u51b3\u5b9a\u8bbf\u5b58\u7684\u662f\u5426\u4e71\u5e8f\uff0c\u5982\u4f55\u4e71\u5e8f\uff0c\u9700\u8981\u8003\u8651\uff1a</p> <ul> <li>\u4ece\u6838\u5185\u7684\u89c6\u89d2\u6765\u770b\uff0c\u4e71\u5e8f\u6267\u884c\u4e0d\u80fd\u4fee\u6539\u7a0b\u5e8f\u7684\u4e00\u6837\u3002\u5b9e\u73b0\u4e71\u5e8f\u7684\u6027\u80fd\uff0c\u53c8\u8981\u8868\u73b0\u51fa\u7c7b\u4f3c\u4e32\u884c\u7684\u884c\u4e3a</li> <li>\u4ece\u6838\u95f4\u7684\u89c6\u89d2\u6765\u770b\uff0c\u6709\u4e00\u4e9b\u6307\u4ee4\u4e0d\u80fd\u4e71\u5e8f\uff0c\u5426\u5219\u4f1a\u5f71\u54cd\u6838\u95f4\u540c\u6b65\u4e92\u65a5\u7684\u6b63\u786e\u6027</li> </ul> <p>\u9664\u4e86 CPU \u6838\u4e4b\u95f4\uff0c\u5982\u679c\u4e00\u4e9b\u5916\u8bbe\uff08\u4f8b\u5982\u663e\u5361\uff0c\u7f51\u5361\uff09\u4e5f\u8981\u8bbf\u95ee\u5185\u5b58\uff0c\u90a3\u4e48 CPU \u548c\u5916\u8bbe\u4e4b\u95f4\uff0c\u4e5f\u53ef\u80fd\u6709\u7c7b\u4f3c\u7684\u987a\u5e8f\u95ee\u9898\u3002</p> <p>\u56e0\u6b64\u5c31\u9700\u8981\u660e\u786e\u89c4\u5b9a\u786c\u4ef6\u4e71\u5e8f\u6267\u884c\u7684\u6a21\u5f0f\u548c\u8fb9\u754c\uff0c\u4f7f\u5f97\u8f6f\u4ef6\u5f00\u53d1\u8005\u4e00\u65b9\u9762\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5728\u8f6f\u4ef6\u4e2d\u63d2\u5165\u6307\u4ee4\u6765\u963b\u6b62\u4e0d\u671f\u671b\u53d1\u751f\u7684\u4e71\u5e8f\uff0c\u4ece\u800c\u4fdd\u8bc1\u6b63\u786e\u6027\uff1b\u53e6\u4e00\u65b9\u9762\u5728\u5927\u591a\u6570\u65f6\u95f4\uff0c\u786c\u4ef6\u63d0\u4f9b\u7684\u4e71\u5e8f\u53ef\u4ee5\u5728\u4fdd\u8bc1\u6b63\u786e\u6027\u7684\u60c5\u51b5\u4e0b\uff0c\u63d0\u4f9b\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>\u4f46\u8fd9\u4e2a\u6a21\u5f0f\u548c\u8fb9\u754c\u4e0d\u662f\u4e00\u5929\u5efa\u6210\u7684\u3002\u786c\u4ef6\u5382\u5546\u5e0c\u671b\u80fd\u591f\u4e0d\u65ad\u63a8\u51fa\u6027\u80fd\u66f4\u597d\u7684\u65b0\u5904\u7406\u5668\uff0c\u8fd9\u4e9b\u65b0\u5904\u7406\u5668\u53ef\u80fd\u4e3a\u4e86\u6027\u80fd\u53bb\u505a\u66f4\u591a\u7684\u4f18\u5316\uff0c\u8fd9\u4e9b\u4f18\u5316\u53ef\u80fd\u4f1a\u6d89\u53ca\u5230\u66f4\u591a\u7684\u4e71\u5e8f\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u517c\u5bb9\u6027\u5c31\u6210\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u65e7\u8f6f\u4ef6\u5047\u8bbe\u4e86\u786c\u4ef6\u4e0d\u4f1a\u505a\u67d0\u79cd\u4e71\u5e8f\uff0c\u7ed3\u679c\u65b0\u786c\u4ef6\u505a\u4e86\uff0c\u90a3\u65e7\u8f6f\u4ef6\u5728\u65b0\u786c\u4ef6\u4e0a\u5c31\u4f1a\u51fa\u73b0\u517c\u5bb9\u6027\u95ee\u9898\u3002\u4e8e\u662f\u8f6f\u4ef6\u5f00\u53d1\u8005\u5f88\u5e0c\u671b\u6709\u4e00\u4e2a\u6807\u51c6\u6216\u8005\u8bf4\u6a21\u578b\u51fa\u6765\uff0c\u786c\u4ef6\u4fdd\u8bc1\u6309\u7167\u8fd9\u4e2a\u6a21\u578b\u5b9e\u73b0\u4e71\u5e8f\uff0c\u8f6f\u4ef6\u6309\u7167\u8fd9\u4e2a\u6a21\u578b\u6765\u5f00\u53d1\uff0c\u8fd9\u6837\u8f6f\u4ef6\u786c\u4ef6\u5206\u522b\u53d1\u5c55\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u9519\u3002</p> <p>\u4f46\u786c\u4ef6\u5382\u5546\u5bf9\u8fd9\u4e2a\u4e8b\u60c5\u4e5f\u626d\u626d\u634f\u634f\uff0c\u751f\u6015\u4eca\u5929\u505a\u4e86\u4ec0\u4e48\u89c4\u5b9a\uff0c\u660e\u5929\u53d1\u73b0\u8fd9\u4e2a\u89c4\u5b9a\u4f1a\u6d6a\u8d39\u4e86\u4e00\u4e2a\u5de8\u5927\u7684\u6027\u80fd\u63d0\u5347\u673a\u4f1a\uff0c\u4f46\u7ade\u4e89\u5bf9\u624b\u6ca1\u6709\u505a\u8fd9\u4e2a\u627f\u8bfa\uff0c\u7ade\u4e89\u5bf9\u624b\u5c31\u5f97\u5230\u4e86\u4f18\u52bf\u3002\u4f46\u662f\u4e0d\u505a\u627f\u8bfa\u5462\uff0c\u8f6f\u4ef6\u751f\u6001\u53c8\u6210\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u5728\u4eca\u5e74\u7684\u5904\u7406\u5668\u4e0a\u5199\u4ee3\u7801\uff0c\u53ea\u80fd\u4fdd\u8bc1\u5728\u4eca\u5e74\u7684\u5904\u7406\u5668\u4e0a\u53ef\u4ee5\u6b63\u5e38\u8dd1\uff0c\u660e\u5e74\u51fa\u4e86\u65b0\u7684\u5904\u7406\u5668\uff0c\u51fa\u73b0\u4e86\u4e0d\u517c\u5bb9\u7684\u5730\u65b9\uff0c\u53c8\u8981\u91cd\u65b0\u6539\u4e00\u904d\uff0c\u8fd9\u4f1a\u628a\u8f6f\u4ef6\u5f00\u53d1\u8005\u7ed9\u8d76\u8dd1\u7684\u3002\u5728\u8fd9\u79cd\u522b\u626d\u7684\u5fc3\u6001\u4e0b\uff0c\u5f88\u957f\u65f6\u95f4\u4ee5\u6765\uff0c\u786c\u4ef6\u5382\u5546\u5bf9\u6b64\u90fd\u5199\u7684\u6709\u4e9b\u8bed\u7109\u4e0d\u8be6\uff0c\u76f8\u5173\u7684\u4e89\u8bba\u5728\u96f6\u51e0\u5e74\u90fd\u4e00\u76f4\u80fd\u770b\u5230\u3002</p> <p>\u4e0d\u8fc7\u597d\u5728\u73b0\u5728\u662f 2024 \u5e74\uff0c\u5927\u591a\u6570\u5904\u7406\u5668\u7684\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f\u90fd\u5df2\u7ecf\u6bd4\u8f83\u660e\u786e\uff0c\u867d\u7136\u5f88\u591a\u65f6\u5019\u786c\u4ef6\u5382\u5546\u505a\u7684\u662f\u6bd4\u8f83\u5bbd\u677e\u7684\u4fdd\u8bc1\uff0c\u5b9e\u9645\u5b9e\u73b0\u7684\u65f6\u5019\u4f1a\u66f4\u52a0\u4e25\u683c\uff0c\u4f8b\u5982\u58f0\u79f0 A \u548c B \u662f\u5141\u8bb8\u4e71\u5e8f\u6267\u884c\u7684\uff0c\u4f46\u5b9e\u9645\u4e0a\u76ee\u524d\u7684\u6240\u6709\u786c\u4ef6\u90fd\u6ca1\u6709\u8fd9\u4e48\u505a\uff0c\u8f6f\u4ef6\u4e5f\u53ea\u80fd\u6309\u7167\u6700\u4fdd\u5b88\u7684\u65b9\u5f0f\u6765\u505a\u5047\u8bbe\u3002\u4f46\u6709\u603b\u6bd4\u6ca1\u6709\u597d\uff0c\u53ef\u80fd\u4e5f\u662f\u786c\u4ef6\u5382\u5546\u7814\u7a76\u4e86\u5f88\u591a\u5e74\uff0c\u6ca1\u53d1\u73b0\u4ec0\u4e48\u53ef\u4ee5\u7ee7\u7eed\u4f18\u5316\u7684\u4f59\u5730\u4e86\uff0c\u4e0d\u5982\u6b7b\u4e86\u5fc3\u628a\u89c4\u77e9\u7ed9\u5b9a\u4e0b\u6765\uff0c\u628a\u8f6f\u4ef6\u751f\u6001\u7ed9\u6253\u597d\u3002</p> <p>\u73b0\u5728\u5f00\u59cb\u8bb2\u5b9e\u9645\u7684\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f\u3002\u4e3a\u4ec0\u4e48\u8fd9\u4e24\u4e2a\u6982\u5ff5\u603b\u662f\u653e\u5728\u4e00\u8d77\u8bb2\uff1f\u4ec0\u4e48\u662f\u6a21\u578b\uff1f\u4ec0\u4e48\u662f\u5e8f\uff1f</p> <p>CPU \u6838\u5fc3\u7684\u5b9e\u73b0\u662f\u5f88\u590d\u6742\u7684\uff0c\u4e0d\u540c\u4ee3\u7684 CPU \u67b6\u6784\u7684\u5b9e\u73b0\u4e5f\u6709\u5f88\u591a\u4e0d\u540c\uff0c\u5c4f\u853d\u8fd9\u4e9b\u5fae\u67b6\u6784\u7684\u7ec6\u8282\uff0c\u628a\u5b83\u4eec\u5bf9\u8f6f\u4ef6\u66b4\u9732\u51fa\u6765\u7684\u884c\u4e3a\uff0c\u62bd\u8c61\u51fa\u4e00\u4e2a\u7edf\u4e00\u7684\u786c\u4ef6\u6a21\u578b\uff0c\u8fd9\u4e2a\u6a21\u578b\u5c55\u73b0\u4e86\u786c\u4ef6\u9488\u5bf9\u5185\u5b58\u8bbf\u95ee\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u5c31\u662f\u5185\u5b58\u6a21\u578b\u3002\u6839\u636e\u5185\u5b58\u6a21\u578b\uff0c\u5b9a\u4e49\u54ea\u4e9b\u60c5\u51b5\u4e0b\uff0c\u54ea\u4e9b\u6307\u4ee4\u53ef\u4ee5\u548c\u54ea\u4e9b\u6307\u4ee4\u4e71\u5e8f\uff0c\u4e3a\u4e86\u907f\u514d\u4e71\u5e8f\uff0c\u53c8\u53ef\u4ee5\u6dfb\u52a0\u54ea\u4e9b\u6307\u4ee4\u6765\u907f\u514d\u4e71\u5e8f\uff0c\u8fd9\u5c31\u662f\u5185\u5b58\u5e8f\u3002\u901a\u8fc7\u5bf9\u786c\u4ef6\u7684\u5efa\u6a21\uff0c\u628a\u590d\u6742\u7684\u5fae\u67b6\u6784\u5b9e\u73b0\u5265\u79bb\u51fa\u6765\uff0c\u5f97\u5230\u4e00\u4e2a\u62bd\u8c61\u7684\u6a21\u578b\uff0c\u4ee5\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u7406\u8bba\u53bb\u7814\u7a76\u5b83\u7684\u884c\u4e3a\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#sc","title":"SC","text":"<p>\u4e0b\u9762\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u5185\u5b58\u6a21\u578b\u7684\u4f8b\u5b50\uff1a\u5047\u5982 CPU \u4e0d\u505a\u4efb\u4f55\u7684\u4e71\u5e8f\uff0c\u4e25\u683c\u6309\u7167\u6307\u4ee4\u7684\u987a\u5e8f\u8fdb\u884c\u8bbf\u5b58\uff1b\u4ece\u591a\u6838\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u6765\u81ea\u4e0d\u540c\u6838\u5fc3\u7684\u8bbf\u5b58\u90fd\u4f1a\u5230\u8fbe\u5185\u5b58\u5b50\u7cfb\u7edf\uff0c\u6bcf\u4e2a\u8bbf\u5b58\u90fd\u662f\u539f\u5b50\u7684\u3002\u90a3\u4e48\u6700\u540e\u5728\u5185\u5b58\u5b50\u7cfb\u7edf\u4e0a\u8fdb\u884c\u7684\u8bbf\u5b58\u5e8f\u5217\uff0c\u5c31\u662f\u5404\u4e2a\u6838\u5fc3\u7684\u7a0b\u5e8f\u7684\u8bbf\u5b58\u5e8f\u5217\u4ea4\u9519\u7684\u7ed3\u679c\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <p>A \u6838\u5fc3\u4e0a\u7684\u7a0b\u5e8f\u8981\u8fdb\u884c Read a\uff08\u8868\u793a\u8bfb\u53d6 a \u5730\u5740\u7684\u6570\u636e\uff0c\u4e0b\u9762\u7b80\u79f0 Ra\uff09\u548c Write a \u64cd\u4f5c\uff08\u8868\u793a\u628a\u6570\u636e\u5199\u5165 a \u5730\u5740\uff0c\u4e0b\u9762\u7b80\u79f0 Wa\uff09\uff1bB \u6838\u5fc3\u4e0a\u7684\u7a0b\u5e8f\u8981\u8fdb\u884c Read b \u548c Write b \u64cd\u4f5c\u3002\u7531\u4e8e\u6bcf\u4e2a\u6838\u5fc3\u5185\u90e8\u4e0d\u4f1a\u5bf9\u8bbf\u5b58\u8fdb\u884c\u91cd\u6392\uff0c\u6240\u4ee5\u8fd9\u4e9b\u8bbf\u5b58\u64cd\u4f5c\u5728\u5185\u5b58\u5b50\u7cfb\u7edf\u4e0a\u6267\u884c\u65f6\uff0c\u4f1a\u4fdd\u6301\u5b83\u5728\u7a0b\u5e8f\u91cc\u7684\u6267\u884c\u987a\u5e8f\uff0c\u8fd9\u4e2a\u53eb\u505a program order\u3002\u7531\u4e8e\u4e0d\u540c\u6838\u5fc3\u53d1\u8d77\u8bbf\u5b58\u7684\u65f6\u95f4\u4e0d\u540c\uff0c\u6700\u540e\u5728\u5185\u5b58\u5b50\u7cfb\u7edf\u4e0a\u6267\u884c\u7684\u8bbf\u5b58\u53ef\u80fd\u6709\u8fd9\u4e9b\u60c5\u51b5\uff1a</p> <ul> <li>Ra Wa Rb Wb</li> <li>Ra Rb Wa Wb</li> <li>Ra Rb Wb Wa</li> <li>Rb Ra Wa Wb</li> <li>Rb Ra Wb Wa</li> <li>Rb Wb Ra Wa</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u53ef\u80fd\u662f\u5148\u5b8c\u6210\u6240\u6709 A \u6838\u5fc3\u4e0a\u7684\u8bbf\u5b58\uff0c\u518d\u5b8c\u6210 B \u6838\u5fc3\u4e0a\u7684\u8bbf\u5b58\uff08Ra Wa Rb Wb\uff09\uff0c\u4e5f\u53ef\u80fd\u53cd\u8fc7\u6765\uff0c\u5148\u5b8c\u6210 B \u6838\u5fc3\u4e0a\u7684\u8bbf\u5b58\uff0c\u518d\u5b8c\u6210 A \u6838\u5fc3\u4e0a\u7684\u8bbf\u5b58\uff08Rb Wb Ra Wa\uff09\uff0c\u4e5f\u53ef\u80fd\u4e24\u4e2a\u6838\u5fc3\u7684\u8bbf\u5b58\u4ea4\u9519\u8fdb\u884c\uff08\u4f8b\u5982 Ra Rb Wa Wb\uff09\u3002\u5b83\u4eec\u90fd\u6ee1\u8db3\u4e00\u4e2a\u6761\u4ef6\uff1aRa \u4e00\u5b9a\u5728 Wa \u4e4b\u524d\uff0cRb \u4e00\u5b9a\u5728 Wb \u4e4b\u524d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cRa \u4e00\u5b9a\u5728 Wa \u4e4b\u524d\u7684\u8fd9\u79cd program order \u5728\u5185\u5b58\u5b50\u7cfb\u7edf\u4e0a\u7684\u6267\u884c\u987a\u5e8f memory order \u91cc\u4e5f\u4e00\u5b9a\u4f1a\u4fdd\u8bc1\u3002</p> <p>\u8fd9\u79cd\u5185\u5b58\u6a21\u578b\u5c31\u662f Sequential Consistency (\u7b80\u79f0 SC)\uff0c\u5b83\u7684\u6027\u8d28\u5c31\u662f\u9075\u5faa program order\uff0c\u4ece\u6bcf\u4e2a\u6838\u5fc3\u6765\u770b\uff0c\u4ee3\u7801\u600e\u4e48\u5199\u7684\u5c31\u600e\u4e48\u8dd1\uff0c\u4e0d\u505a\u91cd\u6392\uff0c\u800c\u6765\u81ea\u4e0d\u540c\u6838\u5fc3\u7684\u8bbf\u5b58\u4e4b\u95f4\u7684\u987a\u5e8f\u4e0d\u505a\u8981\u6c42\u3002\u4e0b\u9762\u662f SC \u6a21\u578b\u7684\u56fe\u793a\uff08\u56fe\u6e90 A Tutorial Introduction to the ARM and POWER Relaxed Memory Model\uff09\uff1a</p> <p></p> <p>\u6839\u636e\u8fd9\u4e2a\u6027\u8d28\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5206\u6790\u8f6f\u4ef6\u7684\u884c\u4e3a\uff0c\u5224\u65ad\u5b83\u662f\u5426\u53ef\u80fd\u51fa\u73b0\u7279\u5b9a\u7684\u7ed3\u679c\u3002\u4e0b\u9762\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p>\u5047\u5982\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff0cA \u7ebf\u7a0b\u8981\u7ed9 B \u7ebf\u7a0b\u4f20\u8f93\u6570\u636e\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u5206\u522b\u8dd1\u5728\u4e24\u4e2a\u6838\u5fc3\u4e0a\u3002\u4e3a\u4e86\u4f20\u8f93\u6570\u636e\uff0cA \u628a\u6570\u636e\u653e\u5728\u5185\u5b58\u5730\u5740 x \u91cc\uff0c\u4e3a\u4e86\u6807\u8bb0\u6570\u636e\u51c6\u5907\u5b8c\u6210\uff0c\u53e6\u5916\u5728\u5185\u5b58\u5730\u5740 y \u653e\u4e86\u4e00\u4e2a\u6807\u8bb0\uff0c0 \u8868\u793a\u6570\u636e\u8fd8\u6ca1\u51c6\u5907\u597d\uff0c1 \u8868\u793a\u6570\u636e\u51c6\u5907\u597d\u4e86\u3002\u90a3\u4e48 A \u8981\u4f20\u8f93\u6570\u636e\u7684\u65f6\u5019\uff0c\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u5f80 y \u5730\u5740\u5199\u5165 0</li> <li>\u8981\u4f20\u8f93\u6570\u636e\u65f6\uff0c\u5148\u5f80 x \u5730\u5740\u5199\u5165\u8981\u4f20\u8f93\u7684\u6570\u636e\uff0c\u518d\u5f80 y \u5730\u5740\u5199\u5165 1</li> </ol> <p>\u53e6\u4e00\u8fb9\uff0cB \u7ebf\u7a0b\u8981\u7b49\u5f85 A \u7ebf\u7a0b\u53d1\u9001\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5b83\u5e94\u8be5\uff1a</p> <ol> <li>\u8bfb\u53d6 y \u5730\u5740\u7684\u5185\u5bb9\uff0c\u68c0\u67e5\u662f\u5426\u4e3a 1</li> <li>\u5982\u679c\u662f 1\uff0c\u8bf4\u660e\u4f20\u8f93\u7684\u6570\u636e\u5df2\u7ecf\u5728 x \u5730\u5740\u4e2d\u4e86\uff0c\u518d\u4ece x \u5730\u5740\u8bfb\u53d6\u8981\u4f20\u8f93\u7684\u6570\u636e</li> </ol> <p>\u73b0\u5728\u95ee\u9898\u6765\u4e86\uff1a\u4ee5\u4e0a\u7684\u5199\u6cd5\uff0c\u5b83\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5417\uff1f\u6211\u5f53\u7136\u53ef\u4ee5\u53bb\u5404\u4e2a\u786c\u4ef6\u5e73\u53f0\u4e0a\u90fd\u6d4b\u8bd5\u6d4b\u8bd5\uff0c\u770b\u770b\u5230\u5e95\u80fd\u4e0d\u80fd\u5de5\u4f5c\u3002\u4f46\u662f\u65e2\u7136\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u786c\u4ef6\u662f\u6309\u7167\u4e00\u5b9a\u7684\u5185\u5b58\u6a21\u578b\u5b9e\u73b0\u7684\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\uff0c\u662f\u5426\u53ef\u4ee5\u4ece\u5185\u5b58\u6a21\u578b\u7684\u89d2\u5ea6\u6765\u5224\u65ad\u5b83\u5230\u5e95\u662f\u5426\u53ef\u884c\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u91c7\u7528\u53cd\u8bc1\u6cd5\uff1a\u5982\u679c\u4e0a\u9762\u7684\u4f20\u8f93\u6570\u636e\u65b9\u6cd5\u4e0d\u53ef\u884c\uff0c\u4f1a\u51fa\u73b0\u4ec0\u4e48\u6837\u7684\u7ed3\u679c\uff1f\u90a3\u5c31\u662f B \u8bfb\u53d6\u5230\u4e86\u9519\u8bef\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f B \u4ece x \u5730\u5740\u8bfb\u53d6\u6570\u636e\u65f6\uff0cA \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5f80 x \u5730\u5740\u5199\u5165\u6570\u636e\u3002\u8fd9\u53ef\u80fd\u5417\uff1f\u6211\u4eec\u6765\u8fdb\u884c\u63a8\u5bfc\uff1a</p> <p>\u9996\u5148\u7b80\u5316\u4e00\u4e0b A \u7ebf\u7a0b\u505a\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>\u5411 x \u5730\u5740\u5199\u5165\u6570\u636e\uff0c\u4e0d\u59a8\u8bbe\u8fd9\u4e2a\u6570\u636e\u662f 1\uff0c\u4e5f\u5c31\u662f <code>*x = 1</code>\uff0c\u8bb0\u4e3a Wx1\uff08W \u8868\u793a write\uff0c\u540e\u9762\u8ddf\u968f\u5730\u5740\u4ee5\u53ca\u5199\u5165\u7684\u6570\u636e\uff09</li> <li>\u5411 y \u5730\u5740\u5199\u5165 1\uff0c\u8868\u793a\u6570\u636e\u51c6\u5907\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f <code>*y = 1</code>\uff0c\u8bb0\u4e3a Wy1</li> </ol> <p>\u63a5\u7740\u662f B \u7ebf\u7a0b\u505a\u7684\u64cd\u4f5c\uff0c\u5047\u8bbe\u51fa\u73b0\u4e86\u9519\u8bef\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u5728 <code>y = 1</code> \u7684\u65f6\u5019\uff0c\u4ece x \u8bfb\u53d6\u4e86\u9519\u8bef\u7684\u6570\u636e\uff1a</p> <ol> <li>\u4ece y \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u5f97\u5230\u4e86 1\uff0c\u8868\u793a\u6570\u636e\u51c6\u5907\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f <code>r1 = *y</code>\uff0cr1 \u7b49\u4e8e 1\uff0c\u8bb0\u4e3a Ry1\uff08R \u8868\u793a read\uff0c\u540e\u9762\u8ddf\u968f\u5730\u5740\u4ee5\u53ca\u8bfb\u53d6\u5230\u7684\u6570\u636e\uff09</li> <li>\u4ece x \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u56e0\u4e3a\u524d\u9762\u5047\u8bbe\u4e86\u8bfb\u53d6\u4e86\u9519\u8bef\u7684\u6570\u636e\uff0c\u6b63\u786e\u7684\u6570\u636e\u662f 1\uff0c\u4e0d\u59a8\u8bbe\u9519\u8bef\u7684\u6570\u636e\u662f 0\uff0c\u4e5f\u5c31\u662f <code>r2 = *x</code>\uff0cr2 \u7b49\u4e8e 0\uff0c\u8bb0\u4e3a Rx0</li> </ol> <p>\u63a5\u4e0b\u6765\u8bc1\u660e\uff1a\u5728 SC \u5185\u5b58\u6a21\u578b\u4e0b\uff0c\u8fd9\u79cd\u53ef\u80fd\u6027\u4e0d\u5b58\u5728\uff1a</p> <ol> <li>\u5728 SC \u5185\u5b58\u6a21\u578b\u4e0b\uff0cprogram order \u5f97\u5230\u4fdd\u6301\uff0c\u4e5f\u5c31\u662f A \u548c B \u7ebf\u7a0b\u5404\u81ea\u7684\u6267\u884c\u987a\u5e8f\u662f\u4fdd\u8bc1\u7684\uff0c\u53ef\u77e5 Wx1 \u5fc5\u987b\u51fa\u73b0\u5728 Wy1 \u4e4b\u524d\uff0cRy1 \u5fc5\u987b\u51fa\u73b0\u5728 Rx0 \u4e4b\u524d\uff0c\u8bb0\u4f5c Wx1 -&gt; Wy1\uff0cRy1 -&gt; Rx0</li> <li>\u5bf9\u4e8e x \u5730\u5740\u6765\u8bf4\uff0cWx1 \u5199\u5165\u4e86 1\uff0cRx0 \u8bfb\u51fa\u4e86 0\uff0c\u8bf4\u660e Rx0 \u5fc5\u987b\u5728 Wx1 \u4e4b\u524d\u6267\u884c\uff0c\u624d\u53ef\u80fd\u8bfb\u5230 0\uff0c\u5373 Rx0 -&gt; Wx1\uff1b\u5bf9\u4e8e y \u5730\u5740\u6765\u8bf4\uff0cWy1 \u5199\u5165\u4e86 1\uff0cRy1 \u8bfb\u51fa\u4e86 1\uff0c\u7531\u4e8e y \u5730\u5740\u7684\u521d\u59cb\u503c\u662f 0\uff0c\u8bf4\u660e Ry1 \u5fc5\u987b\u5728 Wy1 \u4e4b\u540e\u6267\u884c\uff0c\u624d\u53ef\u80fd\u8bfb\u5230 0\uff0c\u5373 Wy1 -&gt; Ry1</li> </ol> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\uff1a</p> <ol> <li>Wx1 -&gt; Wy1</li> <li>Wy1 -&gt; Ry1</li> <li>Ry1 -&gt; Rx0</li> <li>Rx0 -&gt; Wx1</li> </ol> <p>\u4f60\u4f1a\u53d1\u73b0\u8fd9\u56db\u4e2a\u64cd\u4f5c\u7684\u987a\u5e8f\u5173\u7cfb\u51fa\u73b0\u4e86\u73af\uff0c\u8bf4\u660e\u4e0d\u5b58\u5728\u4e00\u4e2a\u6267\u884c\u5e8f\u5217\uff0c\u53ef\u4ee5\u540c\u65f6\u6ee1\u8db3\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\u3002\u4e5f\u5c31\u8bf4\u660e SC \u5185\u5b58\u6a21\u578b\u4e0b\uff0c\u4e0d\u53ef\u80fd\u5f97\u5230\u8fd9\u4e2a\u6267\u884c\u7ed3\u679c\u3002\u901a\u8fc7\u5185\u5b58\u6a21\u578b\uff0c\u6211\u53ef\u4ee5\u4ece\u7406\u8bba\u4e0a\u8bc1\u660e\u8fd9\u6bb5\u4ee3\u7801\u5728 SC \u5185\u5b58\u6a21\u578b\u4e0b\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u90a3\u4e48\u8fd9\u6bb5\u4ee3\u7801\u5728\u6240\u6709\u5b9e\u73b0\u4e86 SC \u5185\u5b58\u6a21\u578b\u7684\u5904\u7406\u5668\u4e0a\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#litmus","title":"Litmus","text":"<p>\u50cf\u4e0a\u9762\u8fd9\u79cd\u6765\u81ea\u591a\u7ebf\u7a0b\u7f16\u7a0b\u7684\u4e00\u4e2a\u5c0f\u7247\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u5185\u5b58\u6a21\u578b\u7684\u89d2\u5ea6\u5206\u6790\u5b83\u53ef\u80fd\u7684\u6267\u884c\u7ed3\u679c\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b9e\u9645\u7684\u5904\u7406\u5668\u4e0a\u8fd0\u884c\uff0c\u8fd9\u79cd\u5c0f\u7247\u6bb5\u5c31\u53eb\u505a Litmus test\uff0c\u4e0a\u9762\u770b\u5230\u7684\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u5176\u5b9e\u662f Litmus test \u5f53\u4e2d\u7684 Message Passing \u6d4b\u8bd5\uff08MP\uff09\u3002\u5229\u7528 herd/herdtools7 on GitHub \u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7535\u8111\u4e0a\u5b9e\u9645\u53bb\u8fd0\u884c Litmus test\uff0c\u89c2\u5bdf\u5b83\u7684\u5b9e\u9645\u8fd0\u884c\u7ed3\u679c\u3002herdtools7 \u7684\u5b89\u88c5\u6d41\u7a0b\uff1a</p> <ol> <li>\u5b89\u88c5 OCaml \u5de5\u5177\u94fe\uff08\u5305\u62ec opam\uff09\uff0c\u914d\u7f6e opam</li> <li>\u7528 opam \u5b89\u88c5 herdtools7: <code>opam install herdtools7</code></li> </ol> <p>\u6709\u4e86 herdtools7 \u4ee5\u540e\uff0c\u5982\u679c\u8981\u6267\u884c\u4e0a\u9762\u7684 Message Passing \u6d4b\u8bd5\uff0c\u53ea\u9700\u8981\u6309\u7167\u8fd0\u884c\u5982\u4e0b\u7684\u547d\u4ee4\uff08\u4ee5 x86 \u4e3a\u4f8b\uff09\uff1a</p> <pre><code>diycross7 -arch X86 -name MP-X86 PodWW Rfe PodRR Fre\nlitmus7 MP-X86.litmus\n</code></pre> <p>\u5b83\u5c31\u4f1a\u5728 x86 \u673a\u5668\u4e0a\u8fd0\u884c MP \u6d4b\u8bd5\uff0c\u8fd0\u884c 1000000 \u6b21\u540e\uff0c\u53d1\u73b0\u6ca1\u6709\u51fa\u73b0\u524d\u9762\u6240\u8ff0\u7684\u8bfb\u51fa\u6765 y \u7b49\u4e8e 1 \u4f46\u662f x \u7b49\u4e8e 0 \u7684\u60c5\u51b5\u3002\u90a3\u4e48\u4e0a\u9762\u51fa\u73b0\u7684 <code>PodWW Rfe PodRR Fre</code> \u662f\u4ec0\u4e48\u610f\u601d\uff1f\u6211\u4eec\u9996\u5148\u6765\u770b\u770b\u751f\u6210\u7684 <code>MP-X86.litmus</code> \u6587\u4ef6\u7684\u5185\u5bb9\uff1a</p> <pre><code>X86 MP-X86\n\"PodWW Rfe PodRR Fre\"\nCycle=Rfe PodRR Fre PodWW\nGenerator=diycross7 (version 7.56+03)\nPrefetch=0:x=F,0:y=W,1:y=F,1:x=T\nCom=Rf Fr\nOrig=PodWW Rfe PodRR Fre\n{\n}\n P0         | P1          ;\n MOV [x],$1 | MOV EAX,[y] ;\n MOV [y],$1 | MOV EBX,[x] ;\nexists (1:EAX=1 /\\ 1:EBX=0)\n</code></pre> <p>\u5ffd\u7565\u5f00\u5934\u7684\u90e8\u5206\uff0c\u76f4\u63a5\u4ece P0 P1 \u8fd9\u4e00\u884c\u5f00\u59cb\u770b\uff1aP0 \u548c P1 \u5bf9\u5e94\u4e24\u4e2a\u5904\u7406\u5668\u6838\u5fc3\uff0c\u4e0b\u9762\u662f\u5728\u8fd9\u4e24\u4e2a\u6838\u5fc3\u4e0a\u8981\u8fd0\u884c\u7684\u6c47\u7f16\u6307\u4ee4\uff1a</p> <ul> <li>P0 \u4e0a\u8fd0\u884c\uff1a<ul> <li>MOV [x], $1\uff1a\u5f80 x \u5730\u5740\u5199\u5165 1\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u8bf4\u7684 <code>*x = 1</code>, Wx1</li> <li>MOV [y], $1\uff1a\u5f80 y \u5730\u5740\u5199\u5165 1\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u8bf4\u7684 <code>*y = 1</code>, Wy1</li> </ul> </li> <li>P1 \u4e0a\u8fd0\u884c\uff1a<ul> <li>MOV EAX, [y]\uff1a\u4ece y \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u4fdd\u5b58\u5728 EAX \u5bc4\u5b58\u5668\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u8bf4\u7684 <code>r1 = *y</code></li> <li>MOV EBX, [x]\uff1a\u4ece x \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u4fdd\u5b58\u5728 EAX \u5bc4\u5b58\u5668\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u8bf4\u7684 <code>r2 = *x</code></li> </ul> </li> </ul> <p>\u6b63\u597d\u5c31\u662f Message Passing \u6d4b\u8bd5\u7684\u5185\u5bb9\uff0c\u53ea\u4e0d\u8fc7\u7528\u6c47\u7f16\u5b8c\u6210\u4e86\u5b9e\u73b0\u3002\u6700\u540e\uff0c\u5b83\u63d0\u95ee\uff1a<code>exists (1:EAX=1 /\\ 1:EBX=0)</code>\uff0c\u5373\u662f\u5426\u5b58\u5728\u4e00\u79cd\u53ef\u80fd\uff0cP1 \u7684 EAX \u5bc4\u5b58\u5668\uff08<code>1:EAX</code>\uff09\u7b49\u4e8e 1\uff0c\u540c\u65f6\uff08<code>/\\</code> \u8868\u793a\u903b\u8f91\u4e0e\uff09P1 \u7684 EBX \u5bc4\u5b58\u5668\uff08<code>1:EBX</code>\uff09\u7b49\u4e8e 0\uff1f\u8fd9\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u9519\u8bef\u60c5\u51b5\uff0cy \u7b49\u4e8e 1 \u4f46\u662f x \u7b49\u4e8e 0\u3002</p> <p>\u63a5\u4e0b\u6765\u7684 <code>litmus7 MP-X86.litmus</code> \u547d\u4ee4\u5c31\u4f1a\u5728\u4e24\u4e2a\u6838\u5fc3\u4e0a\u8fd0\u884c\u8fd9\u6bb5\u6c47\u7f16\uff0c\u5e76\u4e14\u7edf\u8ba1\u6700\u7ec8\u7684\u6267\u884c\u7ed3\u679c\uff0c\u53d1\u73b0\uff1a</p> <pre><code>Histogram (3 states)\n500087:&gt;1:EAX=0; 1:EBX=0;\n1281  :&gt;1:EAX=0; 1:EBX=1;\n498632:&gt;1:EAX=1; 1:EBX=1;\n</code></pre> <p>\u8fd0\u884c\u4e86 1000000 \u6b21\uff0c\u89c2\u5bdf\u5230 500087 \u6b21 y=1, x=0\uff1b1281 \u6b21 y=0, x=1\uff1b498632 \u6b21 y=1, x=1\uff1b\u6ca1\u6709\u89c2\u5bdf\u5230 y=1 &amp;&amp; x=0\u3002\u4e5f\u5c31\u662f\u6ca1\u6709\u627e\u5230\u53cd\u4f8b\u3002</p> <p>\u90a3\u4e48 diycross7 \u547d\u4ee4\u662f\u600e\u4e48\u751f\u6210\u8fd9\u6bb5\u6c47\u7f16\u7684\u5462\uff1f\u7b54\u6848\u5c31\u5728 <code>PodWW Rfe PodRR Fre</code> \u53c2\u6570\u5f53\u4e2d\u3002\u5b83\u63cf\u8ff0\u7684\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\uff1a</p> <ol> <li>Wx1 -&gt; Wy1: P0 \u4e0a\u7684 program order</li> <li>Wy1 -&gt; Ry1: memory \u4e0a\u7684\u5199\u540e\u8bfb</li> <li>Ry1 -&gt; Rx0: P1 \u4e0a\u7684 program order</li> <li>Rx0 -&gt; Wx1: memory \u4e0a\u7684\u8bfb\u540e\u5199</li> </ol> <p>\u5982\u679c\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\u90fd\u5f97\u5230\u4fdd\u8bc1\uff0c\u90a3\u4e48\u5c31\u4e0d\u5b58\u5728\u4e00\u4e2a\u6267\u884c\u5e8f\u5217\u53ef\u4ee5\u540c\u65f6\u6ee1\u8db3\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\u3002\u5728 diycross7 \u7684\u8bed\u8a00\u91cc\u9762\uff0c\u6211\u4eec\u628a\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\u63cf\u8ff0\u51fa\u6765\uff1a</p> <ol> <li>Wx1 -&gt; Wy1: P0 \u4e0a\u7684 program order\uff0c\u5e76\u4e14\u662f\u4e24\u4e2a Write \u4e4b\u95f4\u7684 program order\uff0c\u6240\u4ee5\u662f PodWW\uff08Pod = program order\uff0cWW = write to write\uff09</li> <li>Wy1 -&gt; Ry1: memory \u4e0a\u7684\u5199\u540e\u8bfb\uff0c\u5e76\u4e14\u5206\u522b\u5728 P0 \u548c P1 \u4e0a\u6267\u884c\uff0c\u6240\u4ee5\u662f Rfe\uff08Rf = read from\uff0c\u540e\u9762\u7684 read \u7684\u6570\u636e\u6765\u81ea\u524d\u9762\u7684 write\uff0c\u7bad\u5934\u4ece W \u6307\u5411 R\uff0ce = external\uff0c\u8868\u793a\u8bfb\u548c\u5199\u5728\u4e24\u4e2a\u6838\u4e0a\uff09</li> <li>Ry1 -&gt; Rx0: P1 \u4e0a\u7684 program order\uff0c\u5e76\u4e14\u662f\u4e24\u4e2a Read \u4e4b\u95f4\u7684 program order\uff0c\u6240\u4ee5\u662f PodRR\uff08Pod = program order\uff0cRR = read to read\uff09</li> <li>Rx0 -&gt; Wx1: memory \u4e0a\u7684\u8bfb\u540e\u5199\uff0c\u5e76\u4e14\u5206\u522b\u5728 P1 \u548c P0 \u4e0a\u6267\u884c\uff0c\u6240\u4ee5\u662f Fre\uff08Fr = from read\uff0c\u8bfb\u5728\u524d\uff0c\u5199\u5728\u540e\uff0c\u7bad\u5934\u4ece R \u6307\u5411 W\uff0ce = external\uff0c\u8868\u793a\u8bfb\u548c\u5199\u5728\u4e24\u4e2a\u6838\u4e0a\uff09</li> </ol> <p>\u4e8e\u662f\u6211\u4eec\u5c31\u7528 <code>PodWW Rfe PodRR Fre</code> \u63cf\u8ff0\u4e86\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\uff0cdiycross7 \u5de5\u5177\u5c31\u6839\u636e\u8fd9\u56db\u7ec4\u987a\u5e8f\u5173\u7cfb\uff0c\u751f\u6210\u4e86\u6c47\u7f16\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u6c47\u7f16\u7a0b\u5e8f\u4f1a\u7528\u5230\u8fd9\u4e9b\u987a\u5e8f\u5173\u7cfb\uff0c\u90a3\u4e48\u5728\u5904\u7406\u5668\u4e0a\u6267\u884c\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u5728\u5904\u7406\u5668\u7684\u5185\u5b58\u6a21\u578b\u4e0b\uff0c\u8fd9\u4e2a\u73af\u662f\u5426\u53ef\u80fd\u6253\u7834\uff0c\u53cd\u4f8b\u662f\u5426\u53ef\u80fd\u5b58\u5728\u3002\u901a\u8fc7\u8fd9\u79cd\u63cf\u8ff0\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1\u51fa\u5404\u79cd\u5404\u6837\u7684 Litmus test\uff0c\u6d4b\u8bd5\u548c\u5206\u6790\u4e0d\u540c\u7684\u4ee3\u7801\u5728\u5404\u79cd\u5904\u7406\u5668\u7684\u5185\u5b58\u6a21\u578b\u4e0b\uff0c\u4f1a\u6709\u600e\u6837\u7684\u8868\u73b0\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#store-buffer","title":"Store Buffer","text":"<p>\u6682\u65f6\u5148\u4e0d\u8bb2\u5185\u5b58\u6a21\u578b\uff0c\u5148\u8bb2\u8bb2\u5904\u7406\u5668\u5728\u8bbf\u5b58\u4e0a\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u4f18\u5316\uff1aStore Buffer\u3002\u5bf9\u4e8e\u4e71\u5e8f\u6267\u884c\u5904\u7406\u5668\u6765\u8bf4\uff0c\u9884\u6d4b\u6267\u884c\u662f\u6709\u9650\u5ea6\u7684\uff0c\u56e0\u4e3a\u5982\u679c\u9884\u6d4b\u9519\u8bef\u4e86\uff0c\u9700\u8981\u56de\u6eda\u5230\u6b63\u786e\u7684\u72b6\u6001\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u4e0d\u80fd\u7b80\u5355\u5730\u9884\u6d4b\u6267\u884c\uff1a\u4f8b\u5982\u5728\u4e00\u6bb5\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u4ee3\u7801\u91cc\uff0c\u9700\u8981\u6839\u636e\u7528\u6237\u7684\u8f93\u5165\u51b3\u5b9a\u7535\u8111\u8981\u5173\u673a\u8fd8\u662f\u91cd\u542f\uff1a</p> <pre><code>if (shutdown) {\n    do_shutdown();\n} else {\n    do_reboot();\n}\n</code></pre> <p>\u5047\u5982\u5904\u7406\u5668\u5b9e\u73b0\u4e86\u5206\u652f\u9884\u6d4b\uff0c\u9884\u6d4b <code>shutdown == true</code>\uff0c\u63a5\u7740\u9884\u6d4b\u6267\u884c\u4e86 <code>do_shutdown</code>\uff0c\u5982\u679c\u5904\u7406\u5668\u771f\u7684\u9884\u6d4b\u6267\u884c\u4e86\u5173\u673a\u64cd\u4f5c\uff0c\u90a3\u4e48\u7535\u8111\u5c31\u76f4\u63a5\u5173\u673a\u4e86\uff0c\u90fd\u6ca1\u6709\u6765\u5f97\u53ca\u786e\u8ba4\u662f\u4e0d\u662f\u8981\u5173\u673a\u3002\u4f8b\u5982\u5b9e\u9645\u4e0a\u53ef\u80fd <code>shutdown == false</code>\uff0c\u5e94\u8be5\u6267\u884c\u7684\u662f <code>do_reboot</code>\uff0c\u672c\u6765\u662f\u91cd\u542f\u7684\uff0c\u5374\u53d8\u6210\u4e86\u5173\u673a\u3002\u6240\u4ee5\u9884\u6d4b\u6267\u884c\u9047\u5230\u8fd9\u79cd\u5e26\u6709\u526f\u4f5c\u7528\uff08side effect\uff09\u7684\u6307\u4ee4\uff0c\u9700\u8981\u5355\u72ec\u5904\u7406\u3002</p> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u529e\u6cd5\u5c31\u662f\u8981\u6c42\u6240\u6709\u5e26\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u987a\u5e8f\u6267\u884c\uff0c\u53ea\u6709\u524d\u9762\u7684\u6240\u6709\u6307\u4ee4\u6267\u884c\u5b8c\u4e86\uff0c\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u624d\u53ef\u4ee5\u6267\u884c\uff0c\u56e0\u4e3a\u6b64\u65f6\u4e0d\u53ef\u80fd\u56de\u6eda\u5230\u66f4\u65e9\u7684\u6307\u4ee4\u4e86\u3002\u4f46\u662f\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u5f88\u591a\uff0c\u901a\u5e38\u8ba4\u4e3a Store \u6307\u4ee4\u90fd\u6709\u526f\u4f5c\u7528\uff0c\u5982\u679c\u8003\u8651\u5230\u4fa7\u4fe1\u9053\u653b\u51fb\u548c\u5b89\u5168\u6027\uff0c\u53ef\u80fd\u8fde Load \u6307\u4ee4\u90fd\u6709\u526f\u4f5c\u7528\uff0c\u56e0\u4e3a\u5b83\u4f1a\u6539\u53d8 Cache \u7684\u72b6\u6001\uff1b\u5982\u679c\u8981\u8bbf\u95ee\u5916\u8bbe\uff0c\u90a3\u4e48 Load \u548c Store \u90fd\u6709\u526f\u4f5c\u7528\u3002\u5728\u4e71\u5e8f\u5904\u7406\u5668\u4e0a\uff0c\u5c31\u662f\u53ea\u5141\u8bb8\u6709\u526f\u4f5c\u7528\u7684\u6307\u4ee4\u5728 Reorder Buffer\uff08ROB\uff09\u5934\u90e8\uff0c\u624d\u53ef\u4ee5\u6267\u884c\u3002\u4f46\u5982\u679c\u9047\u5230\u4e86\u7f13\u5b58\u7f3a\u5931\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5c31\u4f1a\u5f88\u957f\uff0c\u4e00\u76f4\u5835\u4f4f ROB\uff0c\u5f71\u54cd\u6027\u80fd\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9488\u5bf9\u5199\u5165\u5185\u5b58\u7684 Store \u6307\u4ee4\uff0c\u867d\u7136\u5b83\u6709\u526f\u4f5c\u7528\uff0c\u4f46\u901a\u5e38\u8ba4\u4e3a\u7f13\u5b58\u5199\u5165\u662f\u4e0d\u4f1a\u5931\u8d25\u7684\uff0c\u6240\u4ee5\u4e0d\u7528\u62c5\u5fc3\u5199\u5165\u5931\u8d25\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u8fd9\u4e9b Store \u6307\u4ee4\u653e\u5728\u4e00\u4e2a\u961f\u5217\u91cc\u9762\uff0c\u8fd9\u4e2a\u961f\u5217\u79f0\u4e3a Store Buffer\u3002\u4ece ROB \u63d0\u4ea4\u7684 Store \u6307\u4ee4\u4f1a\u653e\u5230 Store Buffer \u91cc\u9762\uff0c\u6b64\u65f6\u53ef\u4ee5\u8ba4\u4e3a Store \u6307\u4ee4\u5b8c\u6210\u4e86\u63d0\u4ea4\uff0cStore \u6307\u4ee4\u4ece ROB \u4e2d\u5220\u9664\uff0c\u4e0d\u518d\u5835\u585e\u540e\u9762\u7684\u5176\u4ed6\u6307\u4ee4\u3002Store Buffer \u961f\u5217\u91cc\u7684 Store \u6307\u4ee4\u4f1a\u6309\u987a\u5e8f\u628a\u6570\u636e\u5199\u5165\u7f13\u5b58\uff0c\u8fd9\u65f6\u5019\u518d\u9047\u5230\u7f13\u5b58\u7f3a\u5931\uff0c\u5f71\u54cd\u4e5f\u6bd4\u8f83\u5c0f\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u7531\u4e8e Store Buffer \u91cc\u7684\u6570\u636e\u8fd8\u6ca1\u5199\u5165\u7f13\u5b58\uff0c\u7f13\u5b58\u91cc\u7684\u6570\u636e\u4e0d\u4e00\u5b9a\u662f\u6700\u65b0\u7684\uff0c\u6240\u4ee5\u540e\u7eed Load \u6307\u4ee4\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4e0d\u4ec5\u8981\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\uff0c\u8fd8\u8981\u67e5\u8be2 Store Buffer\uff0c\u5982\u679c\u7f13\u5b58\u548c Store Buffer \u90fd\u6709\u6570\u636e\uff0c\u8981\u4ee5 Store Buffer \u4e3a\u51c6\u3002\u8fd9\u6837\u5b9e\u73b0\u4ee5\u540e\uff0c\u4ece\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u884c\u4e3a\u6ca1\u6709\u53d8\u5316\u3002\u4f46\u662f\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u5c31\u9047\u5230\u4e86\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a</p> <ul> <li>A \u6838\u5fc3\u5411 x \u5730\u5740\u5199\u5165 1\uff0c\u4ece y \u5730\u5740\u8bfb\u53d6\u6570\u636e</li> <li>B \u6838\u5fc3\u5411 y \u5730\u5740\u5199\u5165 1\uff0c\u4ece x \u5730\u5740\u8bfb\u53d6\u6570\u636e</li> <li>A \u6838\u5fc3\u4ece y \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u56e0\u4e3a A \u6ca1\u6709\u5199\u5165 y \u5730\u5740\uff0c\u6240\u4ee5 A \u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6 y \u5730\u5740\u7684\u6570\u636e\uff1b\u540c\u65f6 B \u6838\u5fc3\u4ece x \u5730\u5740\u8bfb\u53d6\u6570\u636e\uff0c\u540c\u7406 B \u4e5f\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6 x \u5730\u5740\u7684\u6570\u636e</li> <li>\u4e24\u4e2a\u6838\u5fc3\u5199\u5165\u6570\u636e\u7684\u6307\u4ee4\u8fdb\u5165\u4e86\u5404\u81ea\u6838\u5fc3\u7684 Store Buffer\uff0c\u4f46\u662f\u8fd8\u6ca1\u5199\u5165\u7f13\u5b58\uff1b\u56e0\u6b64 A \u548c B \u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u7684\u6570\u636e\u90fd\u662f 0</li> </ul> <p>\u7528\u7a0b\u5e8f\u6765\u8868\u8fbe\uff0c\u5c31\u662f\uff1a</p> <p>A \u6838\u5fc3\uff1a</p> <ul> <li>Wx1: *x = 1</li> <li>Ry0: r1 = *y</li> </ul> <p>B \u6838\u5fc3\uff1a</p> <ul> <li>Wy1: *y = 1</li> <li>Rx0: r2 = *x</li> </ul> <p>\u4f60\u53ef\u80fd\u4f1a\u60f3\uff0c\u8fd9\u600e\u4e48\u53ef\u80fd\uff1f\u660e\u660e\u4e24\u8fb9\u90fd\u662f\u5148\u5199\u540e\u8bfb\uff0c\u600e\u4e48\u7ed3\u679c\u5374\u597d\u50cf\u662f\u5148\u8bfb\u540e\u5199\uff1f\u5982\u679c\u6211\u4eec\u7ee7\u7eed\u6309\u7167 SC \u6a21\u578b\u7684\u89c4\u5b9a\u6765\u5bfb\u627e\u987a\u5e8f\u5173\u7cfb\uff1a</p> <ul> <li>program order: Wx1 -&gt; Ry0, Wy1 -&gt; Rx0</li> <li>coherence\uff1aRy0 -&gt; Wy1\uff0cRx0 -&gt; Wx1</li> </ul> <p>\u51fa\u73b0\u4e86\u73af\uff1aWx1 -&gt; Ry0 -&gt; Wy1 -&gt; Rx0 -&gt; Wx1\uff0c\u8bf4\u660e\u8fd9\u4e2a\u7ed3\u679c\u5728 SC \u6a21\u578b\u4e0b\u4e0d\u53ef\u80fd\u6210\u7acb\u3002\u4f46\u5982\u679c\u6211\u4eec\u5728 x86 \u673a\u5668\u4e0a\u771f\u7684\u8dd1\u4e00\u4e0b\u8fd9\u4e2a\u6d4b\u8bd5\uff1a</p> <pre><code>diycross7 -arch X86 -name SB-X86 PodWR Fre PodWR Fre\nlitmus7 SB-X86.litmus\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>PodWR Fre PodWR Fre</code> \u662f\u8fd9\u4e48\u6765\u7684\uff1a</p> <ul> <li>Wx1 -&gt; Ry0: PodWR, program order, write to read</li> <li>Ry0 -&gt; Wy1: Fre, from-read, external</li> <li>Wy1 -&gt; Rx0: PodWR, program order, write to read</li> <li>Rx0 -&gt; Wx1: Fre, from-read, external</li> </ul> <p>diycross7 \u547d\u4ee4\u751f\u6210\u4e86\u4e0b\u9762\u7684\u6c47\u7f16\uff1a</p> <pre><code> P0          | P1          ;\n MOV [x],$1  | MOV [y],$1  ;\n MOV EAX,[y] | MOV EAX,[x] ;\nexists (0:EAX=0 /\\ 1:EAX=0)\n</code></pre> <p>\u8fd0\u884c litmus7 \u5f97\u5230\u5982\u4e0b\u7684\u7ed3\u679c\uff1a</p> <pre><code>Histogram (4 states)\n540   *&gt;0:EAX=0; 1:EAX=0;\n499697:&gt;0:EAX=1; 1:EAX=0;\n499760:&gt;0:EAX=0; 1:EAX=1;\n3     :&gt;0:EAX=1; 1:EAX=1;\nOk\n</code></pre> <p>\u4f60\u4f1a\u53d1\u73b0\u5728 x86 \u673a\u5668\u4e0a\u771f\u7684\u51fa\u73b0\u4e86\u8fd9\u4e2a\u7ed3\u679c\uff1a\u4ece x \u548c y \u8bfb\u51fa\u6765\u7684\u6570\u636e\u90fd\u662f 0\u3002\u8fd9\u5c31\u8bf4\u660e x86 \u673a\u5668\u5b9e\u73b0\u7684\u5e76\u4e0d\u662f SC \u7684\u5185\u5b58\u6a21\u578b\u3002\u5728 SC \u6a21\u578b\u4e0b\uff0c\u8fd9\u6bb5\u4ee3\u7801\u7684\u56db\u4e2a\u987a\u5e8f\u5173\u7cfb\u6210\u73af\uff0c\u4f7f\u5f97\u4e0d\u5b58\u5728 x \u548c y \u8bfb\u51fa\u6765\u90fd\u4e3a 0 \u7684\u60c5\u51b5\uff1b\u73b0\u5728\u786e\u5b9e\u89c2\u5bdf\u5230\u4e86\u8bfb\u51fa\u6765 x \u548c y \u90fd\u4e3a 0 \u7684\u60c5\u51b5\uff0c\u8bf4\u660e\u8fd9\u4e2a\u73af\u88ab\u65ad\u5f00\u4e86\uff0c\u6709\u7684\u8fb9\u4e0d\u518d\u6210\u7acb\u3002</p> <p>\u56de\u60f3\u524d\u9762\u63d0\u5230\u7684 Store Buffer \u7684\u786c\u4ef6\u5b9e\u73b0\uff0c\u95ee\u9898\u51fa\u73b0\u5728\uff0cx \u548c y \u5904\u4e8e\u4e0d\u540c\u7684\u5730\u5740\uff0cA \u6838\u5fc3\u8bfb\u53d6 y \u65f6\uff0c\u76f4\u63a5\u901a\u8fc7\u7f13\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u6b64\u65f6\u4ece\u7f13\u5b58\u7684\u89c6\u89d2\u6765\u770b\uff0c\u5148\u770b\u5230\u4e86 A \u6838\u5fc3\u8bfb\u53d6 y\uff0c\u540e\u770b\u5230\u4e86 A \u6838\u5fc3\u5199\u5165\u4e86 x\uff0c\u8fd9\u548c\u6307\u4ee4\u7684\u987a\u5e8f\u4e0d\u540c\u3002\u4e5f\u5c31\u662f PodWR\uff08Program order write to read\uff09\u8fd9\u6761\u8fb9\u4e0d\u518d\u6210\u7acb\u4e86\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4ece\u6838\u5916\u7684\u89c6\u89d2\u770b\uff0c\u7a0b\u5e8f\u7684\u5148 Store \u540e Load\uff0c\u53ef\u80fd\u88ab\u91cd\u6392\u4e3a\u5148 Load \u540e Store\u3002\u8fd9\u4e5f\u8bf4\u660e x86 \u7684\u5904\u7406\u5668\u505a\u4e86 Store Buffer \u7684\u786c\u4ef6\u5b9e\u73b0\u3002\u5728\u4f18\u5316\u6027\u80fd\u7684\u540c\u65f6\uff0c\u4e5f\u5207\u5b9e\u6539\u53d8\u4e86\u5185\u5b58\u6a21\u578b\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#x86-tso","title":"X86-TSO","text":"<p>\u4f9d\u6258 Store Buffer\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u51fa\u4e00\u4e2a\u65b0\u7684\u5185\u5b58\u6a21\u578b\uff1a\u5728\u6bcf\u4e2a\u6838\u5fc3\u548c\u5185\u5b58\u5b50\u7cfb\u7edf\u4e4b\u95f4\uff0c\u591a\u4e86\u4e00\u4e2a Store Buffer\uff0cStore \u6307\u4ee4\u4f1a\u5148\u8fdb\u5165 Store Buffer\uff0c\u518d\u8fdb\u5165\u5185\u5b58\u5b50\u7cfb\u7edf\u3002\u5f53 Load \u6307\u4ee4\u548c Store Buffer \u4e2d\u7684 Store \u6307\u4ee4\u6709\u6570\u636e\u76f8\u5173\u65f6\uff0c\u4f1a\u4ece Store Buffer \u4e2d\u53d6\u6570\u636e\uff0c\u5982\u679c\u4e0d\u76f8\u5173\uff0c\u6216\u8005\u4e0d\u5b8c\u5168\u76f8\u5173\uff08\u4f8b\u5982\u53ea\u6709\u4e00\u90e8\u5206\u91cd\u5408\uff09\uff0c\u5219\u4f1a\u4ece\u5185\u5b58\u5b50\u7cfb\u7edf\u4e2d\u53d6\u6570\u636e\uff0c\u6b64\u65f6\u4ece\u5185\u5b58\u5b50\u7cfb\u7edf\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5c31\u53d1\u751f\u4e86 Load \u63d0\u524d\u4e8e Store \u6267\u884c\u7684\u91cd\u6392\u3002\u8fd9\u4e2a\u6a21\u578b\u88ab\u79f0\u4e3a X86-TSO\uff08\u56fe\u6e90 A Primer on Memory Consistency and Cache Coherence, Second Edition\uff09\uff1a</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cX86-TSO \u6a21\u578b\u662f\u5728 2010 \u5e74\u7684\u8bba\u6587 x86-TSO: a rigorous and usable programmer's model for x86 multiprocessors\u4e2d\u7531\u5b66\u672f\u754c\u5bf9\u73b0\u6709 x86 \u5904\u7406\u5668\u7684\u5185\u5b58\u6a21\u578b\u7684\u603b\u7ed3\uff0c\u4f46 Intel \u548c AMD \u5728\u4ed6\u4eec\u7684\u6587\u6863\u4e2d\u6ca1\u6709\u76f4\u63a5\u91c7\u7528\u8fd9\u4e2a\u6a21\u578b\uff0c\u800c\u662f\u7ed9\u51fa\u4e86\u5404\u79cd\u5404\u6837\u7684\u89c4\u5219\u3002\u4f46\u5b9e\u8df5\u4e2d\uff0c\u53ef\u4ee5\u8ba4\u4e3a x86 \u5904\u7406\u5668\u7528\u7684\u5c31\u662f\u8fd9\u4e2a\u6a21\u578b\uff0c\u4ece\u5404\u81ea litmus \u6d4b\u8bd5\u4e2d\uff0c\u4e5f\u6ca1\u6709\u53d1\u73b0\u7406\u8bba\u548c\u5b9e\u9645\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\u3002</p> <p>\u8fd9\u91cc\u7684 TSO \u7684\u5168\u79f0\u662f Total Store Order\uff0c\u610f\u601d\u662f\u9488\u5bf9 Store \u6307\u4ee4\uff08\u53ea\u6709\u79bb\u5f00 Store Buffer \u8fdb\u5165\u7f13\u5b58\u7684\u624d\u7b97\uff09\uff0c\u6709\u4e00\u4e2a\u5168\u5c40\u7684\u987a\u5e8f\u3002\u5185\u5b58\u5b50\u7cfb\u7edf\u4f1a\u5904\u7406\u6765\u81ea\u4e0d\u540c\u6838\u5fc3\u7684 Store\uff0c\u4f46\u4f1a\u4fdd\u8bc1 Store \u6709\u4e00\u4e2a\u5148\u540e\u987a\u5e8f\uff0c\u5e76\u4e14\u6240\u6709\u6838\u5fc3\u4f1a\u770b\u5230\u540c\u4e00\u4e2a\u987a\u5e8f\u3002\u8fd9\u4e2a\u6982\u5ff5\u6709\u4e9b\u65f6\u5019\u8fd8\u4f1a\u88ab\u79f0\u4e3a Multi-copy Atomic\uff0c\u5b57\u9762\u610f\u601d\u662f\u5f53\u4e00\u4e2a Store \u88ab\u5176\u4ed6\u6838\u5fc3\u770b\u5230\u65f6\uff0c\u6240\u6709\u6838\u5fc3\u90fd\u4f1a\u201c\u540c\u65f6\u201d\u770b\u5230\uff0c\u4e0d\u4f1a\u8bf4\u4e00\u90e8\u5206\u6838\u5148\u770b\u5230\uff0c\u53e6\u4e00\u90e8\u5206\u6838\u540e\u770b\u5230\u3002</p> <p>\u4ece TSO \u7684\u5b57\u9762\u610f\u601d\u6765\u8bf4\uff0c\u5e76\u6ca1\u6709\u63d0\u5230 Load \u53ef\u4ee5\u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d\uff0c\u662f X86 \u7684 TSO \u5b9e\u73b0\u4e86\u8fd9\u79cd\u91cd\u6392\u3002\u4e0d\u8fc7\u5e73\u5e38\u4e5f\u4e0d\u4f1a\u4e13\u95e8\u53bb\u533a\u5206\u8fd9\u4ef6\u4e8b\u60c5\uff0c\u63d0\u5230 TSO\uff0c\u5927\u5bb6\u60f3\u5230\u7684\u90fd\u662f X86 \u7684 TSO\uff0c\u4e5f\u5c31\u662f X86-TSO \u6a21\u578b\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0cX86-TSO \u6a21\u578b\u7684\u89c4\u5b9a\u5c31\u662f\u5982\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li>Total Store Order\uff1a\u6240\u6709\u6838\u5fc3\u4f1a\u89c2\u5bdf\u5230\u76f8\u540c\u7684\u5168\u5c40\u7684 Store \u987a\u5e8f</li> <li>Load \u53ef\u4ee5\u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d</li> <li>Load \u4f1a\u4ece Store Buffer \u548c\u7f13\u5b58\u4e24\u4e2a\u5730\u65b9\u53d6\u6570\u636e</li> </ul> <p>\u5bf9\u6bd4 SC \u548c X86-TSO \u6a21\u578b\uff1a</p> <ul> <li>X86-TSO \u6a21\u578b\u5141\u8bb8 Load \u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d</li> <li>Store Buffer \u6d4b\u8bd5\u4e0b\uff0cSC \u7981\u6b62\u91cd\u6392\uff0cX86-TSO \u5141\u8bb8\u91cd\u6392</li> <li>Message Passing \u6d4b\u8bd5\u4e0b\uff0cSC \u548c X86-TSO \u90fd\u7981\u6b62\u91cd\u6392</li> </ul>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#weakrelaxed-memory-model","title":"Weak/Relaxed Memory Model","text":"<p>\u5728 X86 \u4ee5\u5916\u7684\u6307\u4ee4\u96c6\u67b6\u6784\uff0c\u7ecf\u5e38\u53ef\u4ee5\u770b\u5230\u53e6\u5916\u4e00\u79cd\u5185\u5b58\u6a21\u578b\uff0c\u4e00\u822c\u79f0\u4e3a Weak Memory Model \u6216\u8005 Relaxed Memory Model\u3002\u600e\u4e48\u4e2a Weak \u6cd5\u5462\uff1f\u5c31\u662f\u786c\u4ef6\u60f3\u91cd\u6392\u5c31\u91cd\u6392\uff0c\u5f53\u7136\u4e86\uff0c\u662f\u5728\u4fdd\u8bc1\u6838\u5185\u89c6\u89d2\u6b63\u786e\u7684\u524d\u63d0\u4e0b\u3002\u56de\u60f3\u524d\u9762 SC \u6a21\u578b\u548c X86-TSO \u6a21\u578b\uff0c\u5b83\u4eec\u5bf9\u4e8e Load \u548c Store \u4e4b\u95f4\u91cd\u6392\u7684\u8981\u6c42\u662f\uff1a</p> <ul> <li>\u5148 Load \u540e Load\uff1aSC \u548c X86-TSO \u4e0d\u5141\u8bb8\u91cd\u6392</li> <li>\u5148 Load \u540e Store\uff1aSC \u548c X86-TSO \u4e0d\u5141\u8bb8\u91cd\u6392</li> <li>\u5148 Store \u540e Load\uff1aSC \u4e0d\u5141\u8bb8\u91cd\u6392\uff0cX86-TSO \u5141\u8bb8\u91cd\u6392</li> <li>\u5148 Store \u540e Store\uff1aSC \u548c X86-TSO \u4e0d\u5141\u8bb8\u91cd\u6392</li> </ul> <p>\u65e2\u7136 Weak \u4e86\uff0c\u90a3\u5c31\u81ea\u7531\u5230\u5e95\uff1a\u5168\u90fd\u5141\u8bb8\u91cd\u6392\u3002\u5982\u679c\u7528\u6237\u4e0d\u60f3\u91cd\u6392\uff0c\u90a3\u518d\u52a0\u5408\u9002\u7684 fence \u6216 barrier \u6307\u4ee4\uff0c\u963b\u6b62\u4e0d\u60f3\u8981\u7684\u91cd\u6392\u3002\u5728\u8fd9\u4e2a\u5185\u5b58\u6a21\u578b\u4e0b\uff0c\u6bcf\u4e2a\u6838\u5fc3\u53ef\u4ee5\u5728\u5411\u5185\u5b58\u5b50\u7cfb\u7edf\u8bfb\u5199\u524d\uff0c\u5bf9\u81ea\u5df1\u7684\u8bfb\u5199\u8fdb\u884c\u91cd\u6392\uff08\u56fe\u6e90 A Primer on Memory Consistency and Cache Coherence, Second Edition\uff09\uff1a</p> <p></p> <p>\u8fd9\u610f\u5473\u7740\u4ec0\u4e48\u5462\uff1f\u524d\u9762\u51fa\u73b0\u8fc7 Message Passing \u7684\u4f8b\u5b50\uff0c\u7ed3\u8bba\u662f MP \u6d4b\u8bd5\u7684\u60c5\u51b5\u5728 SC \u548c X86-TSO \u573a\u666f\u4e0b\u90fd\u88ab\u7981\u6b62\u3002\u4f46\u5982\u679c\u6211\u4eec\u5728\u4e00\u4e2a\u5177\u6709 Weak Memory Model \u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff1a</p> <pre><code># P0:\n# 1. Wx1\n# 2. Wy1\n# P1:\n# 1. Ry1\n# 2. Rx0\n# orders:\n# Wx1 -&gt; Wy1: PodWW\n# Wy1 -&gt; Ry1: Rfe\n# Ry1 -&gt; Rx0: PodRR\n# Rx0 -&gt; Wx1: Fre\ndiycross7 -arch AArch64 -name MP-AArch64 PodWW Rfe PodRR Fre\nlitmus7 MP-AArch64.litmus # MP = Message Passing\n</code></pre> <p>\u4f1a\u53d1\u73b0\u867d\u7136\u6982\u7387\u6bd4\u8f83\u4f4e\uff0c\u4f46\u786e\u5b9e\u4f1a\u51fa\u73b0 y=1\uff0cx=0 \u7684\u60c5\u51b5\uff1a</p> <pre><code>Histogram (4 states)\n500000:&gt;1:X1=0; 1:X3=0;\n1     *&gt;1:X1=1; 1:X3=0;\n1     :&gt;1:X1=0; 1:X3=1;\n499998:&gt;1:X1=1; 1:X3=1;\n</code></pre> <p>\u65e2\u7136\u5728\u5b9e\u9645\u7684 ARM \u673a\u5668\u4e0a\u6d4b\u51fa\u6765\u8fd9\u79cd\u60c5\u51b5\uff0c\u8bf4\u660e PodWW \u6216\u8005 PodRR \u81f3\u5c11\u6709\u4e00\u4e2a\u51fa\u73b0\u4e86\u91cd\u6392\uff0c\u6253\u7834\u4e86\u73af\u3002</p> <p>\u66f4\u8fdb\u4e00\u6b65\uff0cSC \u548c X86-TSO \u90fd\u8981\u6c42\u6709 Total Store Order\uff08Multi-copy Atomic\uff09\uff1a\u6240\u6709\u6838\u5fc3\u4f1a\u770b\u5230\u7edf\u4e00\u7684 Store \u987a\u5e8f\u3002\u6709\u8981\u6c42\uff0c\u5c31\u53ef\u4ee5\u820d\u5f03\uff0c\u90e8\u5206 Weak Memory Model \u4e5f\u4e0d\u8981\u6c42\u8fd9\u4e00\u70b9\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5185\u5b58\u6a21\u578b\u5c31\u597d\u50cf\u6bcf\u4e2a\u6838\u5fc3\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u4efd\u5185\u5b58\uff0c\u8fd9\u4e9b\u5185\u5b58\u4e4b\u95f4\u4f1a\u4e92\u76f8\u4f20\u64ad Store \u4ee5\u4fdd\u8bc1\u7f13\u5b58\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6709\u7684\u6838\u5fc3\u53ef\u80fd\u5148\u770b\u5230\uff0c\u6709\u7684\u6838\u5fc3\u53ef\u80fd\u540e\u770b\u5230\uff08\u56fe\u6e90 A Tutorial Introduction to the ARM and POWER Relaxed Memory Model\uff09\uff1a</p> <p></p> <p>\u8fd9\u4e00\u70b9\u53ef\u4ee5\u5728 IRIW\uff08\u5168\u79f0 Independent Read of Independent Write\uff1b\u51c6\u786e\u5730\u8bf4\uff0c\u4e3a\u4e86\u6392\u9664 PodRR \u91cd\u6392\u7684\u60c5\u51b5\uff0c\u8981\u7528 IRIW+addrs \u6216\u8005\u52a0 barrier\uff09Litmus \u6d4b\u8bd5\u4e2d\u770b\u5230\u3002\u7b80\u5355\u6765\u8bf4\uff0cIRIW \u6d4b\u8bd5\u4e2d\uff0c\u6709\u4e24\u4e2a\u6838\u5fc3\u8d1f\u8d23\u5199\u5165\uff0c\u53e6\u5916\u4e24\u4e2a\u6838\u5fc3\u8d1f\u8d23\u8bfb\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u8d1f\u8d23\u8bfb\u7684\u6838\u5fc3\u89c2\u5bdf\u5230\u4e86\u4e0d\u540c\u7684\u5199\u5165\u987a\u5e8f\uff0c\u8bf4\u660e\u6ca1\u6709 Total Store Order\uff08Multi-copy Atomic\uff09\uff1a\u5199\u5165\u4f20\u64ad\u5230\u4e0d\u540c\u6838\u5fc3\u7684\u987a\u5e8f\u53ef\u80fd\u6253\u4e71\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u5185\u5b58\u5e8f","title":"\u5185\u5b58\u5e8f","text":"","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u6307\u4ee4\u96c6","title":"\u6307\u4ee4\u96c6","text":"<p>\u65e2\u7136 X86-TSO \u5df2\u7ecf\u51fa\u73b0\u4e86\u4e00\u79cd\u53ef\u80fd\u7684\u91cd\u6392\u60c5\u51b5\uff1aLoad \u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d\uff0c\u5047\u5982\u6211\u4eec\u4e0d\u5e0c\u671b\u51fa\u73b0\u8fd9\u79cd\u91cd\u6392\uff0c\u600e\u4e48\u529e\uff1f\u5404\u4e2a\u6307\u4ee4\u96c6\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e9b fence \u6216\u8005 barrier \u6307\u4ee4\uff0c\u53ef\u4ee5\u963b\u6b62\u5404\u79cd\u7c7b\u578b\u7684\u91cd\u6392\u3002\u4ee5 x86 \u4e3a\u4f8b\uff1a</p> <ul> <li>sfence: store fence\uff0c\u4fdd\u8bc1 sfence \u4e4b\u524d\u7684 store \u90fd\u5b8c\u6210\uff08globally visible\uff0c\u5f97\u5199\u5230\u7f13\u5b58\u91cc\u624d\u7b97\uff09\u4e4b\u540e\uff0c\u624d\u5f00\u59cb sfence \u4e4b\u540e\u7684 store</li> <li>lfence: load fence\uff0c\u4fdd\u8bc1 lfence \u4e4b\u524d\u7684 load \u90fd\u5b8c\u6210\uff08globally visible\uff09\u4e4b\u540e\uff0c\u624d\u5f00\u59cb lfence \u4e4b\u540e\u7684 load</li> <li>mfence: memory fence, \u4fdd\u8bc1 mfence \u4e4b\u524d\u7684 load \u548c store \u90fd\u5b8c\u6210\uff08globally visible\uff09\u4e4b\u540e\uff0c\u624d\u5f00\u59cb mfence \u4e4b\u540e\u7684 load \u548c store</li> </ul> <p>\u8fd9\u5176\u4e2d\u5e38\u7528\u7684\u5176\u5b9e\u5c31\u662f mfence\uff1a\u524d\u9762\u63d0\u5230 X86-TSO \u5141\u8bb8 Load \u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d\uff0c\u4e3a\u4e86\u963b\u6b62\u8fd9\u4e00\u70b9\uff0clfence \u548c sfence \u90fd\u4e0d\u591f\uff0c\u56e0\u4e3a lfence \u7ba1\u7684\u662f Load \u88ab\u91cd\u6392\u5230 Load \u4e4b\u524d\uff0csfence \u7ba1\u7684\u662f Store \u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d\u3002mfence \u5219\u53ef\u4ee5\uff1a\u5728 Store \u540e\u9762\u7d27\u6328\u7740\u4e00\u6761 mfence \u6307\u4ee4\uff0c\u90a3\u4e48 mfence \u4e4b\u540e\u7684 Load \u6307\u4ee4\u5c31\u65e0\u6cd5\u88ab\u91cd\u6392\u5230 Store \u4e4b\u524d\uff1a</p> <ol> <li>store</li> <li>mfence</li> <li>load</li> </ol> <p>\u6240\u4ee5\u5982\u679c\u8981\u5728 x86 \u4e0a\u8fd0\u884c\u6309\u7167 SC \u5185\u5b58\u6a21\u578b\u7f16\u5199\u7684\u7a0b\u5e8f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6b63\u786e\u6027\uff0c\u9700\u8981\u5728\u6bcf\u4e2a Store \u540e\u9762\u52a0\u4e00\u6761 mfence \u6307\u4ee4\u3002</p> <p>\u518d\u6765\u770b\u770b\u5bf9\u4e8e ARMv8 \u8fd9\u79cd\u5177\u6709 Weak/Relaxed Memory Model \u7684\u67b6\u6784\uff0c\u6307\u4ee4\u96c6\u63d0\u4f9b\u4e86\u54ea\u4e9b\u6307\u4ee4\u6765\u907f\u514d\u91cd\u6392\uff1a</p> <ul> <li>DMB\uff1a\u76f8\u5f53\u4e8e x86 \u7684 mfence\uff0c\u4fdd\u8bc1 DMB \u540e\u7684 Load \u548c Store \u4e0d\u4f1a\u91cd\u6392\u5230 DMB \u4e4b\u524d\uff0cDMB \u524d\u7684 Load \u548c Store \u4e5f\u4e0d\u4f1a\u91cd\u6392\u5230 DMB \u4e4b\u540e</li> <li>Load Acquire\uff1a\u5bf9 Load \u6307\u4ee4\u6dfb\u52a0 Acquire \u8bed\u4e49\uff0c\u4fdd\u8bc1 Load Acquire \u4e4b\u540e\u7684 Load/Store \u4e0d\u4f1a\u88ab\u91cd\u6392\u5230 Load  Acquire \u4e4b\u524d</li> <li>Store Release\uff1a\u5bf9 Release \u6307\u4ee4\u6dfb\u52a0 Release \u8bed\u4e49\uff0c\u4fdd\u8bc1 Store Release \u4e4b\u524d\u7684 Load/Store \u4e0d\u4f1a\u88ab\u91cd\u6392\u5230 Store Release \u4e4b\u540e</li> </ul> <p>\u770b\u5230 Acquire \u548c Release\uff0c\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\u8fd9\u4e2a\u8bf4\u6cd5\u6709\u70b9\u719f\u6089\uff1a\u5728\u9501\u91cc\u9762\uff0c\u83b7\u5f97\u9501\u53ef\u4ee5\u8bf4 Lock \u6216\u8005\u8bf4 Acquire\uff1b\u91ca\u653e\u9501\u53ef\u4ee5\u8bf4 Unlock \u6216\u8005\u8bf4 Release\u3002\u4e8b\u5b9e\u4e0a\uff0cLoad Acquire \u548c Store Release \u6b63\u597d\u5c31\u53ef\u4ee5\u7528\u5728 Lock \u548c Unlock \u7684\u573a\u5408\uff1a</p> <pre><code>lock(); // Load Acquire\ny = x + 1;\nunlock(); // Store Release\n</code></pre> <p>\u5728\u4e34\u754c\u533a\u4e2d\u8bfb\u53d6 x\uff0c\u80af\u5b9a\u5e0c\u671b\u662f\u5728\u6301\u6709\u9501\u7684\u524d\u63d0\u4e0b\u8fdb\u884c Load\uff0c\u4e5f\u5c31\u662f\u8bf4 Load x \u4e0d\u80fd\u88ab\u91cd\u6392\u5230 <code>lock()</code> \u4e4b\u524d\uff0c\u4e5f\u4e0d\u80fd\u88ab\u91cd\u6392\u5230 <code>unlock()</code> \u4e4b\u540e\uff1b\u540c\u7406\u5728\u4e34\u754c\u533a\u4e2d\u5199\u5165 y\uff0c\u80af\u5b9a\u4e5f\u662f\u5e0c\u671b\u5728\u6301\u6709\u9501\u7684\u524d\u63d0\u4e0b\u8fdb\u884c Store\uff0c\u4e5f\u5c31\u662f\u8bf4 Store y \u4e0d\u80fd\u88ab\u91cd\u6392\u5230 <code>lock()</code> \u4e4b\u524d\u6216 <code>unlock()</code> \u4e4b\u540e\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u91cd\u6392\uff0c\u5728\u4e00\u5934\u4e00\u5c3e\u5206\u522b\u52a0\u4e0a Acquire \u548c Release \u6807\u8bb0\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4e34\u754c\u533a\u5185\u7684 Load/Store \u90fd\u662f\u5728\u6301\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u3002</p> <p>\u9664\u4e86\u9501\u4ee5\u5916\uff0c\u8fd9\u4e2a\u6a21\u5f0f\u4e5f\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6b63\u786e\u7684 Message Passing\uff0c\u539f\u6765\u7684 Message Passing \u5b9e\u73b0\u662f\uff1a</p> <p>P0:</p> <ol> <li>*x = 1</li> <li>*y = 1</li> </ol> <p>P1:</p> <ol> <li>r1 = *y</li> <li>r2 = *x</li> </ol> <p>\u8fd9\u91cc\u4f1a\u6709 Store-Store \u91cd\u6392\u4ee5\u53ca Load-Load \u91cd\u6392\u7684\u98ce\u9669\uff0c\u52a0\u4e0a Load Acquire \u548c Store Release \u4ee5\u540e\uff1a</p> <p>P0:</p> <ol> <li>*x = 1</li> <li>*y = 1 (Store Release)</li> </ol> <p>P1:</p> <ol> <li>r1 = *y (Load Acquire)</li> <li>r2 = *x</li> </ol> <p>\u8fd9\u6837\u5c31\u907f\u514d\u4e86\u91cd\u6392\uff0cP1 \u53ef\u4ee5\u89c2\u5bdf\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <p>\u6b64\u5916\uff0cAcquire \u548c Release \u6807\u8bb0\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u5230\u539f\u5b50\u6307\u4ee4\u4e0a\uff0c\u6bd5\u7adf\u539f\u5b50\u6307\u4ee4\u5176\u5b9e\u5c31\u662f Load + Store\u3002\u76f8\u6bd4 Fence\uff0cAcquire \u548c Release \u662f\u5355\u5411\u7684\uff0c\u53ea\u5f71\u54cd\u524d\u9762\u7684\u6307\u4ee4\uff0c\u6216\u8005\u53ea\u5f71\u54cd\u540e\u9762\u7684\u6307\u4ee4\uff0c\u800c Fence \u901a\u5e38\u662f\u4e24\u4e2a\u65b9\u5411\u90fd\u963b\u6b62\uff0c\u4e0d\u8bb8\u524d\u9762\u7684\u6392\u5230\u540e\u9762\uff0c\u4e5f\u4e0d\u8bb8\u540e\u9762\u7684\u6392\u5230\u524d\u9762\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u8f6f\u4ef6","title":"\u8f6f\u4ef6","text":"<p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u89c1\uff0c\u4e0d\u540c\u7684\u5904\u7406\u5668\u548c\u6307\u4ee4\u96c6\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u5185\u5b58\u6a21\u578b\uff0c\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u6307\u4ee4\u6765\u63a7\u5236\u4e71\u5e8f\u91cd\u6392\uff0c\u4f46\u662f\u5bf9\u4e8e\u8f6f\u4ef6\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u4f1a\u5e0c\u671b\u5c3d\u91cf\u7528\u4e00\u5957\u901a\u7528\u7684 API \u6765\u63a7\u5236\u4e71\u5e8f\u91cd\u6392\uff0c\u53ef\u4ee5\u517c\u5bb9\u5404\u79cd\u6307\u4ee4\u96c6\uff0c\u4e0d\u7528\u53bb\u8bb0\u5fc6\u6bcf\u4e2a\u5904\u7406\u5668\u7528\u7684\u662f\u4ec0\u4e48\u5185\u5b58\u6a21\u578b\uff0c\u4e0d\u7528\u53bb\u77e5\u9053\u54ea\u4e9b\u6307\u4ee4\u53ef\u4ee5\u7528\u6765\u89e3\u51b3\u54ea\u4e9b\u91cd\u6392\u3002</p> <p>\u8fd9\u4e2a API \u5728\u5f88\u591a\u7f16\u7a0b\u8bed\u8a00\u4e2d\u90fd\u6709\uff0cC \u7684 stdatomic.h\uff0cC++ \u7684 std::memory_order\uff0cRust \u7684 std::sync::atomic::Ordering \u7b49\u7b49\u3002\u5b83\u4eec\u5bf9\u5404\u79cd\u5904\u7406\u5668\u7684\u5185\u5b58\u5e8f\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u62bd\u8c61\uff0c\u5e76\u4e14\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u7531\u7f16\u8bd1\u5668\u6216\u6807\u51c6\u5e93\u628a\u8fd9\u4e9b\u62bd\u8c61\u7684\u5185\u5b58\u5e8f\u7ffb\u8bd1\u6210\u5b9e\u9645\u7684\u6307\u4ee4\u3002\u4ee5 C++ \u7684\u62bd\u8c61\u4e3a\u4f8b\uff0c\u6709\u5982\u4e0b\u51e0\u79cd\u5185\u5b58\u5e8f\uff08\u56fe\u6e90 cppreference\uff09\uff1a</p> <p></p> <p>\u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684 acquire \u548c release\uff0c\u5176\u5b9e\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684 Load Acquire \u548c Store Release\u3002\u6700\u540e\u7684 seq_cst\uff0c\u5c31\u5bf9\u5e94\u4e86 Sequential Consistency\uff08SC\uff09\u6a21\u578b\uff0c\u8981\u6a21\u62df SC \u6a21\u578b\u7684\u884c\u4e3a\u3002</p> <p>\u7531\u4e8e C++ \u53ef\u4ee5\u88ab\u7f16\u8bd1\u5230\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\u67b6\u6784\uff0c\u6240\u4ee5\u8fd9\u4e9b memory order \u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u4f1a\u53d8\u6210\u5bf9\u5e94\u7684\u6307\u4ee4\uff0c\u4e5f\u53ef\u80fd\u7531\u4e8e\u5185\u5b58\u6a21\u578b\u4fdd\u8bc1\u4e86\u4e0d\u51fa\u73b0\u5bf9\u5e94\u7684\u4e71\u5e8f\uff0c\u4e0d\u9700\u8981\u751f\u6210\u989d\u5916\u7684\u6307\u4ee4\u3002\u4ee5 X86 \u4e3a\u4f8b\u5b50\uff1a</p> <ul> <li>Load Acquire\uff1a\u9632\u6b62 Load \u4e4b\u540e\u7684 Load/Store \u6307\u4ee4\u88ab\u91cd\u6392\u5230 Load \u4e4b\u524d\uff0c\u56e0\u4e3a X86-TSO \u963b\u6b62\u4e86 Load-Load \u548c Load-Store\uff08\u5148 Load \u540e Store\uff09\u91cd\u6392\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u4ee4</li> <li>Store Release\uff1a\u9632\u6b62 Store \u4e4b\u524d\u7684 Load/Store \u6307\u4ee4\u88ab\u91cd\u6392\u5230 Store \u4e4b\u540e\uff0c\u56e0\u4e3a X86-TSO \u963b\u6b62\u4e86 Load-Store \u548c Store-Store \u91cd\u6392\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u4ee4</li> </ul> <p>\u5b8c\u6574\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u5efa\u8bae\u9605\u8bfb C/C++11 mappings to processors\u3002</p> <p>\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u53ef\u80fd\u4f1a\u5bf9\u5185\u5b58\u5e8f\u4ea7\u751f\u4e00\u4e9b\u610f\u6599\u4e4b\u5916\u7684\u5f71\u54cd\uff0c\u63a8\u8350\u9605\u8bfb Linux \u5185\u6838\u7684 LINUX KERNEL MEMORY BARRIERS \u6587\u6863\u3002</p>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2024/09/04/memory_model_and_memory_ordering/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>A Tutorial Introduction to the ARM and POWER Relaxed Memory Model</li> <li>A Better x86 Memory Model: x86-TSO</li> <li>Hardware Memory Models - Russ Cox</li> <li>herd/herdtools7 on GitHub</li> <li>A Primer on Memory Consistency and Cache Coherence, Second Edition</li> <li>How to generate litmus tests automatically with the diy7 tool</li> </ul>","tags":["cpu","ordering","acquire","release","lock","tso","mca","x86","arm64"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/","title":"MIFARE Classic \u4e0a\u914d\u7f6e NDEF","text":"","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u4e70\u4e86\u4e00\u5806 NFC \u7684\u667a\u80fd\u5361\u62ff\u6765\u6d4b\u8bd5\uff0c\u5176\u4e2d\u4e00\u5f20 MIFARE Classic \u7684\u603b\u662f\u5728 iOS \u4e0a\u8bfb\u4e0d\u51fa\u6765\uff0c\u65e0\u8bba\u662f\u4ee5 Tag \u6a21\u5f0f\u8fd8\u662f NDEF \u6a21\u5f0f\u3002\u4e8e\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u7814\u7a76\uff0c\u7ec8\u4e8e\u77e5\u9053\u4e0a\u600e\u4e48\u4e00\u56de\u4e8b\uff0c\u7136\u540e\u6210\u529f\u5730\u628a\u4e00\u4e2a MIFARE Classic \u5361\u914d\u7f6e\u6210\u4e86 NDEF\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#\u80cc\u666f\u77e5\u8bc6","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>NFC \u6709\u5f88\u591a\u534f\u8bae\uff0c\u5176\u4e2d MIFARE Classic \u57fa\u4e8e ISO 14443-3 Type A \u6807\u51c6\uff0c\u91cc\u9762\u6709\u4e00\u4e9b MIFARE \u7684\u547d\u4ee4\u3002\u901a\u8fc7\u8fd9\u4e9b\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u63a7\u5236 MIFARE Classic \u5361\u7684\u5185\u5bb9\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u4ee5\u6211\u4f7f\u7528\u7684 MIFARE Classic EV1 4K S70 \u4e3a\u4f8b\uff0c\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u6d89\u53ca\u5230\u5982\u4e0b\u7684\u80cc\u666f\u77e5\u8bc6\uff1a</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#mifare-classic-\u5185\u5b58\u5e03\u5c40","title":"MIFARE Classic \u5185\u5b58\u5e03\u5c40","text":"<p>\u5728 MIFARE Classic \u4e2d\uff0c\u6709 Sector \u548c Block \u7684\u6982\u5ff5\uff0c\u6bcf\u4e2a Sector \u6709\u82e5\u5e72\u4e2a Block\uff0c\u5176\u4e2d\u6700\u540e\u4e00\u4e2a Block \u662f\u7279\u6b8a\u7684\uff08\u79f0\u4e3a Sector Trailer\uff09\uff0c\u4fdd\u5b58\u4e86\u8fd9\u4e2a Sector \u7684\u4e00\u4e9b\u4fe1\u606f\uff1aKey A\u3001Access Bits\u3001GPB \u548c Key B\u3002\u5bf9\u4e8e Classic 4K\uff0c\u9996\u5148\u662f 32 \u4e2a\u6709 4 blocks \u7684 sector\uff0c\u7136\u540e\u662f 8 \u4e2a \u6709 16 blocks \u7684 sector\uff0c\u6574\u4f53\u7684\u5185\u5b58\u5e03\u5c40\u5927\u6982\u662f\uff1a</p> <pre><code>Sector 0:\n    Block 0\n    Block 1\n    Block 2\n    Block 3(Sector Trailer)\nSector 1:\n    Block 4\n    Block 5\n    Block 6\n    Block 7(Sector Trailer)\n...\nSector 32:\n    Block 128\n    Block 129\n    ...\n    Block 143(Sector Trailer)\n...\nSector 39:\n    ...\n</code></pre> <p>\u6bcf\u4e2a Block \u6709 16 \u5b57\u8282\uff0c\u4e00\u5171 256 \u4e2a block\uff0c\u6240\u4ee5\u662f 4K \u5927\u5c0f\u7684\u5b58\u50a8\u7a7a\u95f4\u3002Block 0 \u6bd4\u8f83\u7279\u6b8a\uff0c\u4fdd\u5b58\u7684\u662f\u751f\u4ea7\u5546\u5199\u5165\u7684\u4fe1\u606f\uff0c\u4e0d\u53ef\u66f4\u6539\u3002</p> <p>Sector Trailer \u7684\u5e03\u5c40\u5982\u4e0b\uff1a</p> Key A Access Bits GPB Key B 6 \u5b57\u8282 3 \u5b57\u8282 1 \u5b57\u8282 6 \u5b57\u8282 <p>\u5176\u4e2d Key A \u548c Key B \u4e0a\u7528\u4e8e\u5f53\u524d Sector \u8ba4\u8bc1\u7684\u4e24\u4e2a Key\uff0c\u7528\u76f8\u5e94\u7684 Key \u8ba4\u8bc1\u4ee5\u540e\u5c31\u53ef\u4ee5\u4fee\u6539 Sector \u91cc\u9762 Block \u7684\u5185\u5bb9\u3002\u65e2\u7136\u6709 Key\uff0c\u5c31\u4f1a\u6709\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236\uff0c\u5c31\u662f Access Bits\u3002\u5b83\u7684\u8ba1\u7b97\u65b9\u5f0f\u6bd4\u8f83\u590d\u6742\uff0c\u9996\u5148\u4e3e\u4e2a\u6587\u6863AN1305\u51fa\u73b0\u8fc7\u7684\u4f8b\u5b50 <code>0x7F 0x07 0x88</code>\uff1a</p> <ol> <li>\u6309\u5b57\u8282\u7ffb\u8f6c\uff1a0x88 0x07 0x7F</li> <li>\u6539\u5199\u6210\u4e8c\u8fdb\u5236\uff1a1000 1000 0000 0111 0111 1111</li> <li>\u62c6\u6210\u524d\u534a\u90e8\u5206\uff1a1000 1000 0000 \u548c\u540e\u534a\u90e8\u5206\uff1a0111 0111 1111</li> <li>\u5982\u679c\u524d\u540e\u90e8\u5206\u4e92\u8865\uff0c\u8bf4\u660e\u8fd9\u662f\u4e2a\u5408\u6cd5\u7684 Access Bits\uff08\u8fd9\u79cd\u53d6\u53cd\u62fc\u63a5\u505a\u6821\u9a8c\u7684\u65b9\u6cd5\u633a\u5e38\u89c1\u7684\uff09</li> <li>\u53d6\u51fa\u524d\u534a\u90e8\u5206\uff1a1000 1000 0000</li> <li>\u4ece\u540e\u5f80\u524d\u53d6\u4e09\u4e2a\u5b57\u8282\u7684\u6700\u9ad8\u4f4d\uff1a011</li> <li>\u4ece\u540e\u5f80\u524d\u53d6\u7b2c\u4e09\u4e2a\u5b57\u8282\u7684\u6b21\u9ad8\u4f4d\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff1a000 000 000</li> </ol> <p>\u8fd9\u91cc\u7684 011 \u8868\u793a\u7684\u662f Sector Trailer \u7684\u8bbf\u95ee\u6743\u9650\uff0c\u7279\u522b\u5730\uff0c\u5b83\u8868\u793a\uff0c\u4e0d\u80fd\u8bfb\u51fa Key A\uff0c\u53ea\u80fd\u7528 Key B \u8ba4\u8bc1\u540e\u4fee\u6539 Key A\uff1b\u7528 Key A \u6216\u8005 Key B \u8ba4\u8bc1\u540e\u90fd\u53ef\u4ee5\u8bfb Access Bits\uff0c\u4f46\u53ea\u80fd\u5728 Key B \u8ba4\u8bc1\u540e\u4fee\u6539 Access Bits\uff1b\u4e0d\u80fd\u8bfb\u51fa Key B\uff0c\u53ea\u80fd\u7528 Key B \u8ba4\u8bc1\u540e\u4fee\u6539 Key B\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cKey A \u8ba4\u8bc1\u53ea\u80fd\u8bfb Access Bits\uff0c\u800c Key B \u8ba4\u8bc1\u6709\u6743\u9650\u5199\u5165 Key A\u3001Access Bits \u548c Key B \u5b57\u6bb5\u3002\u5b8c\u6574\u8868\u683c\u89c1AN1305 Table 7 \u3002</p> <p>\u4e4b\u540e\u7684\u4e09\u4e2a 000 \u5206\u522b\u5bf9\u5e94\u524d\u4e09\u4e2a Blocks\uff08\u53c8\u79f0 Data Blocks\uff0c\u5148\u53ea\u8003\u8651\u5e26 4 Blocks \u7684 Sector\uff09\u7684\u8bbf\u95ee\u6743\u9650\u3002000 \u8868\u793a\u7684\u662f\uff0c\u7528 Key A \u548c Key B \u90fd\u6709\u5b8c\u6574\u7684\u8bfb\u5199\u6743\u9650\u3002\u5b8c\u6574\u7684\u8868\u683c\u89c1 AN 1305 Table 8 \u3002</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u7ed9\u8bfb\u8005\u7559\u4e00\u4e2a\u7ec3\u4e60\uff1a0x78 0x77 0x88 \u5bf9\u5e94\u7684\u6743\u9650\u4e0a\u4ec0\u4e48\uff1f</p> <p>\u7b54\u6848\uff1a\u5bf9 Sector Trailer\uff1a011\uff1b\u5bf9 Data Blocks\uff1a100\uff1b\u6b64\u65f6 Data Blocks \u53ef\u4ee5\u7528 Key A \u6216\u8005 Key B \u8ba4\u8bc1\u8bfb\u53d6\uff0c\u4f46\u53ea\u80fd\u7528 Key B \u8ba4\u8bc1\u5199\u5165\u3002</p> <p>\u5982\u679c\u67e5\u770b\u5b8c\u6574\u7684\u8868\u683c\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0cKey B \u7684\u6743\u9650\u4e00\u822c\u662f\u6bd4 Key A \u5927\u7684\uff0c\u6240\u4ee5 Key B \u4e00\u822c\u662f\u4fdd\u5bc6\u7684\uff0c\u800c Key A \u53ef\u4ee5\u662f\u516c\u5f00\u7684\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#mifare-\u547d\u4ee4","title":"MIFARE \u547d\u4ee4","text":"<p>\u4e3a\u4e86\u5411 MIFARE Classic \u5361\u53d1\u9001\u547d\u4ee4\uff0c\u9996\u5148\u9700\u8981\u4e00\u4e2a ISO 14443-3 Type A \u7684\u63a5\u53e3\uff0cAndroid \u7684 NfcA \u6216\u8005 libnfc \u90fd\u63d0\u4f9b\u4e86\u63a5\u53e3\u3002\u8fd9\u91cc\u53d1\u9001\u7684\u547d\u4ee4\u5b9e\u9645\u4e0a\u4f1a\u518d\u7ecf\u8fc7\u4e00\u5c42\u89e3\u6790\u3001\u7528 CRYPTO1 \u7b97\u6cd5\u52a0\u5bc6\uff08\u731c\u6d4b\u662f\u8bfb\u5361\u5668\u505a\u7684\uff1f\u4e0d\u662f\u5f88\u786e\u5b9a\uff09\uff0c\u4e0d\u8fc7\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u662f\u900f\u660e\u7684\u3002\u53ef\u4ee5\u53c2\u8003 MIFARE Classic EV1 1K \u548c A Practical Attack on the MIFARE Classic \u4e2d\u7684\u63cf\u8ff0\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#mifare-read","title":"MIFARE Read","text":"<p>\u8bfb\u51fa\u4e00\u4e2a Block \u7684\u5185\u5bb9\uff0c\u6bcf\u4e2a Block \u6709 16 \u5b57\u8282\u3002\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>30 XX\n</code></pre> <p>\u5982\u679c\u8981\u8bfb\u7b2c\u4e00\u4e2a Block\uff0c\u5c31\u662f <code>30 00</code>\uff0c\u5982\u679c\u8981\u8bfb\u7b2c\u4e8c\u4e2a Block\uff0c\u5c31\u662f <code>30 01</code> \u3002</p> <p>\u8fd4\u56de\u7684\u6570\u636e\u91cc\u521a\u597d\u662f 16 \u4e2a\u5b57\u8282\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#mifare-write","title":"MIFARE Write","text":"<p>\u5411\u4e00\u4e2a Block \u5199\u5165\u6570\u636e\uff0c\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>A0 XX YY YY YY YY YY YY YY YY YY YY YY YY YY YY YY YY\n</code></pre> <p>\u8fd9\u91cc\u7684 XX \u548c\u4e0a\u9762\u4e00\u6837\uff0c\u4e5f\u662f Block \u5730\u5740\uff1b\u4e4b\u540e\u662f\u5341\u516d\u5b57\u8282\u7684\u6570\u636e\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#mifare-authentiate-with-ab","title":"MIFARE Authentiate with A/B","text":"<p>\u6ce8\uff1a\u8fd9\u91cc\u548c S70 datasheet \u91cc\u5199\u7684\u4e0d\u5b8c\u5168\u4e00\u6837\u3002</p> <p>\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8fdb\u884c Key A \u6216\u8005 Key B \u7684\u8ba4\u8bc1\uff0c\u5982\u679c\u662f\u5bf9 Key A \u8ba4\u8bc1\uff1a</p> <pre><code>60 XX YY YY YY YY ZZ ZZ ZZ ZZ ZZ ZZ\n</code></pre> <p>\u8fd9\u91cc\u7684 XX \u4e5f\u662f Block \u5730\u5740\uff0c\u4f46\u5b9e\u9645\u4e0a\u8ba4\u8bc1\u7684\u7c92\u5ea6\u4e0a Sector\uff0c\u6240\u4ee5\u53ea\u8981\u8ba4\u8bc1\u4e86 Sector \u91cc\u9762\u7684\u4e00\u4e2a Block\uff0c\u5176\u4ed6 Block \u4e5f\u662f\u540c\u65f6\u8ba4\u8bc1\uff0c\u4e5f\u662f\u7528\u540c\u4e00\u4e2a Sector Trailer \u4e2d\u7684\u4fe1\u606f\u8fdb\u884c\u8ba4\u8bc1\u3002YY \u5219\u662f ISO 14443-3 Type A \u4e2d\u7684 UID\uff0c\u5982\u679c\u7528 Android \u7684 API \u8bfb\u53d6\uff0c\u5c31\u53ef\u4ee5\u5728 NfcA \u4e2d\u627e\u5230\u8fd9\u4e2a\u56db\u5b57\u8282\u7684\u4fe1\u606f\u3002ZZ \u5c31\u662f\u8981\u8ba4\u8bc1\u7684\u5bc6\u94a5\uff0c\u516d\u4e2a\u5b57\u8282\u3002</p> <p>\u5982\u679c\u662f\u5bf9 Key B \u8ba4\u8bc1\uff0c\u628a\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684 0x60 \u6539\u6210 0x61 \u5373\u53ef\u3002</p> <p>\u8ba4\u8bc1\u6210\u529f\u540e\uff0c\u8fd4\u56de\u4e00\u4e2a 0x00\uff1b\u5982\u679c\u8ba4\u8bc1\u5931\u8d25\uff0c\u5219\u4f1a\u65ad\u5f00 NFC\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#ndef-\u662f\u4ec0\u4e48","title":"NDEF \u662f\u4ec0\u4e48","text":"<p>NDEF \u5b9e\u9645\u4e0a\u662f\u6bd4\u8f83\u9ad8\u5c42\u6b21\u7684\u6570\u636e\uff0c\u5c31\u50cf HTML\uff0c\u8868\u793a\u4e86\u4e00\u4e2a\u683c\u5f0f\u5316\u7684\u6570\u7ec4\u6570\u636e\uff0c\u6570\u7ec4\u7684\u5143\u7d20\u53ef\u80fd\u662f\u6587\u672c\u3001URI \u7b49\u7b49\u3002\u5b83\u662f\u7531\u82e5\u5e72\u4e2a Record \u7ec4\u6210\u7684\u3002\u4e00\u4e2a Record \u5982\u4e0b\uff1a</p> <pre><code>03 0B 01 07 54 02 65 6E 61 62 63 64\n</code></pre> <p>\u9996\u5148\u662f\u4e00\u4e2a 03 \u8868\u793a\u7c7b\u578b\uff0c\u7136\u540e\u662f\u957f\u5ea6 0x0B\uff0811\uff0c\u4ece\u4e0b\u4e00\u4e2a\u5b57\u8282\u5f00\u59cb\u6570\uff09\uff0c\u63a5\u7740\u662f 0x01 0x07 \u8868\u793a\u8fd9\u4f3c\u4e4e\u4e00\u4e2a Well Known \u7c7b\u578b\u7684 Record\uff0c\u5185\u5bb9\u7684\u957f\u5ea6\u4e3a 7\uff0c0x54\uff08ASCII T\uff09\u8868\u793a\u8fd9\u662f\u6587\u672c\u683c\u5f0f\uff0c0x02 \u8868\u793a\u7f16\u7801\u662f UTF-8\uff0c0x65 0x6E (ASCII \"en\") \u8868\u793a\u8bed\u8a00\u662f\u82f1\u8bed\uff0c\u4e4b\u540e\u7684 0x61 0x62 0x63 0x64\uff08ASCII \"abcd\"\uff09\u5c31\u662f\u6587\u672c\u5185\u5bb9\u3002</p> <p>\u5f88\u591a\u4e2a record \u8fde\u8d77\u6765\uff0c\u6700\u7ec8\u4e00\u4e2a 0xFE \u8868\u793a\u7ed3\u675f\uff0c\u8fd9\u5c31\u662f\u5b8c\u6574\u7684 NDEF \u4fe1\u606f\u4e86\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#\u5728-mifare-classic-\u4e0a\u4f7f\u7528-ndef","title":"\u5728 MIFARE Classic \u4e0a\u4f7f\u7528 NDEF","text":"<p>NDEF \u53ea\u5b9a\u4e49\u4e86\u6570\u636e\u683c\u5f0f\uff0c\u4f46\u4e3a\u4e86\u5b9e\u9645\u4f7f\u7528\uff0c\u8fd8\u5f97\u770b\u5177\u4f53\u60c5\u51b5\u3002\u5c31\u597d\u50cf\u6587\u4ef6\u5185\u5bb9\u4fdd\u5b58\u5728\u786c\u76d8\u4e0a\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u4fdd\u5b58\uff0c\u800c\u662f\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\uff0c\u4eba\u4e3a\u5b9a\u4e49\u4e00\u4e2a\u8def\u5f84\uff0c\u8fd9\u6837\u5927\u5bb6\u624d\u77e5\u9053\u8981\u4ece /etc/shadow \u6587\u4ef6\u53bb\u8bfb Linux \u7684\u7528\u6237\u5bc6\u7801\u4fe1\u606f\uff0cNDEF \u4e5f\u9700\u8981\u4eba\u4e3a\u5b9a\u4e49\u4e00\u4e9b\u89c4\u5219\uff0c\u518d\u4f5c\u4e3a\u6570\u636e\u5b58\u653e\u5728\u667a\u80fd\u5361\u91cc\u7684\u67d0\u4e2a\u5730\u65b9\uff0c\u8fd9\u6837\u5927\u5bb6\u53bb\u8bfb\u53d6 metadata\uff0c\u53d1\u73b0\u4e0a NDEF Tag\uff0c\u7136\u540e\u624d\u4f1a\u53bb\u89e3\u6790 NDEF \u4fe1\u606f\u3002</p> <p>\u6709\u4e9b\u65f6\u5019\uff0c\u8fd9\u4e2a\u5b9a\u4e49\u5f88\u7b80\u5355\uff0c\u6bd4\u5982\u76f4\u63a5\u628a NDEF \u6570\u636e\u653e\u5728\u67d0\u4e2a block \u91cc\u9762\uff1b\u6709\u7684\u65f6\u5019\u53c8\u5f88\u590d\u6742\uff0c\u56e0\u4e3a\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u5f88\u591a\u5e94\u7528\uff0cNDEF \u53ea\u662f\u5176\u4e2d\u7684\u4e00\u79cd\uff0c\u6240\u4ee5\u8981\u6709\u4e00\u79cd\u7c7b\u4f3c\u76ee\u5f55\u7684\u4e1c\u897f\u53bb\u7d22\u5f15 NDEF\u201c\u6587\u4ef6\u201d\u3002</p> <p>MIFARE Classic \u4e0a\u91c7\u7528\u7684\u65b9\u6cd5\u4e0a\uff0c\u5728\u7279\u5b9a\u7684 Sector\uff08\u6bd4\u5982 Sector 0\uff09\u653e\u4e00\u4e9b\u5143\u6570\u636e\uff0c\u5143\u6570\u636e\u91cc\u6ce8\u660e\u4e86\u5176\u4ed6\u7684 Sector\uff08\u4ece 1 \u5f00\u59cb\u7684\u5176\u5b83 sector\uff09\u5206\u522b\u7528\u4e8e\u4ec0\u4e48\u7528\u9014\uff0c\u7136\u540e NDEF \u662f\u5176\u4e2d\u4e00\u79cd\u7528\u9014\u3002\u8fd9\u4e2a\u7ed3\u6784\u53eb\u505a MIFARE Application Directory\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5728 MIFARE Classic \u91cc\u9762\uff0c\u5b83\u89c4\u5b9a Block 1 \u548c Block 2 \u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> 0-1 2-3 4-5 6-7 8-9 10-11 12-13 14-15 Info &amp; CRC AID AID AID AID AID AID AID AID AID AID AID AID AID AID AID <p>\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f CRC 8\uff0c\u5b83\u7684\u5b9a\u4e49\u53ef\u4ee5\u5728\u8fd9\u91cc\u7684 CRC-8/MIFARE-MAD \u91cc\u627e\u5230\uff1a\u521d\u59cb\u503c 0xC7\uff0c\u591a\u9879\u5f0f\u4e0a 0x1D\u3002\u53c2\u4e0e CRC \u8ba1\u7b97\u7684\u662f\u6309\u987a\u5e8f\u4ece\u7b2c\u4e8c\u4e2a\u5b57\u8282\u5f00\u59cb\u7684 31 \u4e2a\u5b57\u8282\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u5b57\u8282\u662f Info Byte\uff0c\u7528\u5904\u4e0d\u5927\uff0c\u89c1 MAD \u7684\u6587\u6863\u3002</p> <p>\u4e4b\u540e\u6bcf\u4e24\u4e2a\u5b57\u8282\u5bf9\u5e94\u4e00\u4e2a Sector \u7684 AID\uff08Application ID\uff09\uff0c\u6bd4\u5982 Block 1 \u7684 2-3 \u5b57\u8282\u5bf9\u5e94 Sector 1 \u7684 AID\uff0cBlock 1 \u7684 4-5 \u5b57\u8282\u5bf9\u5e94 Sector 2 \u7684 AID\uff0c\u6700\u540e Block 2 \u7684 14-15 \u5b57\u8282\u5bf9\u5e94 Sector 15 \u7684 AID\u3002NDEF \u7684 AID \u5c31\u662f 0x03 0xE1\u3002\u5f53\u8f6f\u4ef6\u53d1\u73b0\u8fd9\u91cc\u7684 AID \u662f 0x03E1 \u7684\u65f6\u5019\uff0c\u5b83\u5c31\u4f1a\u53bb\u76f8\u5e94\u7684 Sector \u53bb\u8bfb\u53d6 NDEF \u4fe1\u606f\u3002</p> <p>\u4e00\u4e2a\u7528 TagInfo \u8bfb\u51fa\u6765\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>Sector 0 (0x00)\n[skipped]\n[01]  F3 01 03 E1 03 E1 00 00\n rW-  00 00 00 00 00 00 00 00\n[02]  00 00 00 00 00 00 00 00\n rW-  00 00 00 00 00 00 00 00\n[03]  A0:A1:A2:A3:A4:A5  MAD access key\n WXW  78:77:88 C1\n      XX:XX:XX:XX:XX:XX  (key unavailable)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u8868\u793a\u7684\u662f Sector 1 \u548c Sector 2 \u662f 03E1 NDEF\u3002\u4e0b\u9762 [03] \u884c\u8868\u793a\u7684\u662f Key A\uff0c\u4e0b\u4e00\u884c\u662f Access bits\u3001GPD\uff0c\u6700\u540e\u4e00\u884c\u662f Key B\u3002TagInfo \u4f1a\u5c1d\u8bd5\u4ece well known \u91cc\u7684 Key A \u548c Key B \u4e00\u4e2a\u4e2a\u8bd5\uff0c\u76f4\u5230\u8ba4\u8bc1\u6210\u529f\u4e3a\u6b62\u3002\u5e38\u89c1\u7684\u5982\u4e0b\uff1a</p> <ol> <li>A0 A1 A2 A3 A4 A5\uff1aMAD \u7684 Key A</li> <li>D3 F7 D3 F7 D3 F7\uff1aNDEF \u7684 Key A</li> <li>FF FF FF FF FF FF\uff1a\u51fa\u573a\u9ed8\u8ba4\u7684 Key A \u548c Key B</li> </ol>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#\u5982\u4f55\u5728-mifare-classic-\u4e0a\u914d\u7f6e-ndef","title":"\u5982\u4f55\u5728 MIFARE Classic \u4e0a\u914d\u7f6e NDEF","text":"<p>\u5982\u679c\u770b\u4e86\u8fd9\u4e48\u591a\u80cc\u666f\u77e5\u8bc6\uff0c\u4f60\u8fd8\u6709\u5fc3\u60c5\u770b\u5230\u8fd9\u91cc\uff0c\u90a3\u8981\u7ed9\u4e2a\u638c\u58f0\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u5728 MIFARE Classic \u4e0a\u914d\u7f6e NDEF \u5462\uff1f\u56e0\u4e3a\u76f4\u63a5\u4e70\u5230\u7684 MIFARE Classic\uff08\u6bd4\u5982\u6211\u7528\u7684 EV1 4K S70\uff09\u91cc\u9762\u90fd\u662f\u51fa\u5382\u72b6\u6001\uff0cKey A \u548c Key B \u90fd\u662f FF FF FF FF FF FF\uff0c\u9664\u4e86 Block 0 \u4ee5\u5916\u6570\u636e\u90fd\u662f 0\uff0c\u6240\u4ee5\u5b83\u5e76\u4e0d\u80fd\u7528\u4f5c NDEF\uff0cAndroid \u4e5f\u53ea\u662f\u8ba4\u4e3a\u5b83 NdefFormattable\u3002\u6240\u4ee5\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\uff0cFormat as NDEF\u3002\u4e3a\u5565\u8981\u81ea\u5df1\u641e\u5462\uff0c\u4e5f\u662f\u56e0\u4e3a\u8bd5\u4e86\u51e0\u4e2a\u73b0\u6210\u7684\u5de5\u5177 format \u90fd\u5931\u8d25\u4e86\u3002</p> <p>\u5176\u5b9e\u6574\u4e2a\u6d41\u7a0b\u5728 AN1305 \u7684 8.1 \u7ae0\u8282\u90fd\u5199\u4e86\uff0c\u4f46\u770b\u8d77\u6765\u7b80\u5355\uff0c\u5b9e\u73b0\u8d77\u6765\u8fd8\u662f\u6709\u5f88\u591a\u7ec6\u8282\uff0c\u5728\u641e\u7684\u65f6\u5019\u4e5f\u662f\u6765\u6765\u56de\u56de\u505a\u4e86\u5f88\u591a\u5c1d\u8bd5\uff0c\u540c\u65f6\u4e5f\u5229\u7528 TagInfo \u5f3a\u5927\u7684 Memory dump \u914d\u5408\u8c03\u8bd5\u3002</p> <p>\u9996\u5148\u590d\u4e60\u4e00\u4e0b\u6211\u4eec\u53ef\u4ee5\u7528\u54ea\u4e9b\u547d\u4ee4\uff1a</p> <ol> <li>MIFARE Authenticate\uff1a\u5bf9\u4e00\u4e2a sector \u8ba4\u8bc1\uff0c\u8ba4\u8bc1\u6210\u529f\u4e86\u624d\u80fd\u5199\u64cd\u4f5c</li> <li>MIFARE Read\uff1a\u8bfb\u53d6\u4e00\u4e2a Block</li> <li>MIFARE Write\uff1a\u5199\u5165\u4e00\u4e2a Block</li> </ol> <p>\u4ed4\u7ec6\u89c2\u5bdf AN1305 \u7684 Fig.10 \u548c\u4e0b\u9762\u7684\u6587\u672c\u63cf\u8ff0\uff0c\u5927\u6982\u9700\u8981\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a</p> <ol> <li>\u4fee\u6539 Block 1 \u548c Block 2 \u4e2d\u7684\u4fe1\u606f\uff0c\u7b26\u5408 MAD \u7684\u683c\u5f0f</li> <li>\u4fee\u6539 Sector 0 \u7684 Sector Trailer</li> <li>\u4fee\u6539 Block 4\uff0c\u586b\u5165\u4e00\u4e2a\u7a7a\u767d\u7684 NDEF\uff0c\u6216\u8005\u76f4\u63a5\u524d\u9762\u80cc\u666f\u77e5\u8bc6\u91cc\u7684\u4f8b\u5b50\u3002</li> <li>\u4fee\u6539 Sector 1 \u548c Sector 2 \u7684 Sector Trailer</li> </ol> <p>\u4f46\u6709\u4e00\u4e9b\u7ec6\u8282\uff1a</p> <ol> <li>\u4fee\u6539 Sector Trailer \u7684\u65f6\u5019\u8981\u8c28\u614e\uff0c\u56e0\u4e3a\u4f1a\u4fee\u6539 Key\uff0c\u5982\u679c\u6539\u5b8c\u53c8\u5fd8\u4e86\uff0c\u8fd9\u5361\u5c31\u5e9f\u4e86</li> <li>\u6ce8\u610f\u7528 Key A \u8fd8\u662f Key B \u8fdb\u884c\u8ba4\u8bc1\u3002\u4e0a\u9762\u8fd9\u4e9b\u6d41\u7a0b\u7ed3\u675f\u540e\uff0cSector 0 \u88ab\u4fdd\u62a4\u4e86\uff0c\u9700\u8981\u7528 Key B \u624d\u80fd\u4fee\u6539\u6570\u636e\uff1b\u800c Sector 1 \u548c Sector 2 \u662f\u5f00\u653e\u7684\uff1b\u5982\u679c\u6267\u884c\u5b8c\u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u4ee5\u540e\uff0c\u53d1\u73b0\u7b2c\u4e00\u6b65\u5199\u9519\u4e86\uff0c\u5c31\u8981\u6ce8\u610f\u6743\u9650\u7684\u95ee\u9898\uff0c\u5fc5\u8981\u65f6\u8fd8\u53ef\u4ee5\u5148\u4fee\u6539 Access bits \u518d\u4fee\u6539\u6570\u636e</li> <li>\u5728\u8fd9\u91cc\u4e3a\u4e86\u7b80\u5355\uff0cKey B \u90fd\u7528 FF FF FF FF FF FF \u4e86\uff0c\u5b9e\u9645\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7528\u522b\u7684\u81ea\u5df1\u7684\u5bc6\u94a5\uff0c\u53ea\u8981\u8bb0\u4f4f\u5c31\u884c</li> </ol> <p>\u90a3\u4e48\uff0c\u6309\u7167\u524d\u9762\u7684\u8fd9\u4e9b\u77e5\u8bc6\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u51fa\u6bcf\u4e00\u6b65\u7684 MIFARE \u547d\u4ee4\u4e86\uff1a</p> <p>\u6ce8\u610f\uff1a\u4e0b\u9762\u7684\u547d\u4ee4\u4e0d\u4e00\u5b9a\u80fd\u5de5\u4f5c\uff0c\u5728\u6267\u884c\u524d\u8bf7\u4ed4\u7ec6\u7406\u89e3\u6bcf\u6761\u547d\u4ee4\u7684\u7ed3\u679c\uff0c\u672c\u6587\u4f5c\u8005\u5bf9\u5361\u7684\u635f\u5931\u6982\u4e0d\u8d1f\u8d23</p> <p>\u7b2c\u4e00\u6b65\uff1a</p> <pre><code>60 00 YY YY YY YY FF FF FF FF FF FF\nA0 01 F3 01 03 E1 03 E1 00 00 00 00 00 00 00 00 00 00\nA0 02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n</code></pre> <p>\u6ce8\u610f YY \u8981\u586b\u5165 ID\u3002\u8fd9\u4e00\u6b65\u9996\u5148\u7528 FF FF FF FF FF FF \u8ba4\u8bc1\u4e86 Sector 0 \u7684 Key A\uff0c\u7136\u540e\u5199\u5165\u4e86 Block 1 \u548c Block 2\u3002Info Byte \u7528\u7684\u662f 0x01\uff0c\u7136\u540e\u7528\u5728\u7ebf\u5de5\u5177\u8ba1\u7b97\u4e86\u4e00\u4e0b CRC=F3\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff1a</p> <pre><code>A0 03 A0 A1 A2 A3 A4 A5 78 77 88 C1 FF FF FF FF FF FF\n</code></pre> <p>\u8fd9\u4e00\u6b65\u8bbe\u7f6e\u4e86 Key A \u4e3a MAD access key\uff0c\u6743\u9650\u662f 78 77 88\uff0cGPB \u662f C1\uff0cKey B \u4e3a FF FF FF FF FF FF</p> <p>\u7b2c\u4e09\u6b65\uff1a</p> <pre><code>60 04 YY YY YY YY FF FF FF FF FF FF\nA0 04 00 00 03 0B D1 01 07 54 02 65 6E 61 62 63 64 FE\n</code></pre> <p>\u8fd9\u4e00\u6b65\u8ba4\u8bc1\u4e86 Sector 1\uff0c\u7136\u540e\u5f80 Block 4 \u5199\u5165\u4e86\u4e00\u4e2a abcd \u7684 NDEF \u8bb0\u5f55\u3002</p> <p>\u7b2c\u56db\u6b65\uff1a</p> <pre><code>A0 07 D3 F7 D3 F7 D3 F7 7F 07 88 40 FF FF FF FF FF FF\n60 08 YY YY YY YY FF FF FF FF FF FF\nA0 0B D3 F7 D3 F7 D3 F7 7F 07 88 40 FF FF FF FF FF FF\n</code></pre> <p>\u5199\u5165\u4e86 Sector 1 \u7684 Sector Trailer\uff0c\u7136\u540e\u8ba4\u8bc1 Sector 2\uff0c\u518d\u5199\u5165 Sector 2 \u7684 Sector Trailer</p> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\uff0c\u518d\u7528 TagInfo \u7b49\u8f6f\u4ef6\uff0c\u5c31\u53ef\u4ee5\u8bfb\u53d6\u51fa\u6765 NDEF \u4fe1\u606f\u4e86\u3002\u6b64\u65f6 iOS \u4e5f\u53ef\u4ee5\u8bfb\u51fa\u6765\u3002</p> <p>\u4e0a\u9762\u8fd9\u4e9b\u8fc7\u7a0b\uff0c\u5728\u5b9e\u9645\u60c5\u51b5\u4e0b\u5728\u4e0d\u540c sector \u7684\u65f6\u5019\u9700\u8981\u6253\u65ad\uff0c\u6bcf\u6b21\u91cd\u65b0\u8ba4\u8bc1\u4e00\u4e0b\u3002\u8fd9\u91cc\u9ed8\u8ba4\u4e86\u4e00\u4e9b\u5361\u7684\u521d\u59cb\u5bc6\u94a5\uff0c\u5982\u679c\u521d\u59cb\u60c5\u51b5\u5e76\u4e0d\u4e00\u81f4\uff0c\u53ef\u80fd\u5e76\u4e0d\u4f1a\u5de5\u4f5c\u3002</p>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2020/05/10/mifare-classic-ndef/#\u8e29\u7684\u5751","title":"\u8e29\u7684\u5751","text":"<p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u8e29\u8fc7\u5f88\u591a\u7684\u5751\uff1a</p> <ol> <li>\u5728\u7a7a NDEF \u7684\u65f6\u5019\uff0cNFC Tools \u80fd\u8bfb\u51fa\u6765\u662f Ndef\uff0c\u5e76\u4e14\u5185\u5bb9\u662f\u7a7a\uff0c\u4f46\u5199\u5165\u7684\u65f6\u5019\u8868\u793a Write error\uff0c\u4e5f\u8bfb\u4e0d\u51fa\u6765\uff1b\u53bb TagInfo \u8bfb\u5185\u5b58\uff0c\u53d1\u73b0\u786e\u5b9e\u5199\u8fdb\u53bb\u4e86\uff0c\u4f46\u5185\u5bb9\u4e0d\u5bf9\uff0c\u6709\u4e00\u4e2a\u4f4d\u7f6e\u7684\u957f\u5ea6\u5199\u6210\u4e86 0\uff0c\u53ef\u80fd\u662f BUG</li> <li>\u4e0a\u9762\u4e5f\u63d0\u5230\u8fc7\u7684\uff0c\u5c31\u662f\u5728\u4fee\u6539\u4e3a\u53ea\u8bfb\u4ee5\u540e\uff0c\u53d1\u73b0\u6570\u636e\u5199\u9519\u4e86\uff0c\u53ea\u597d\u91cd\u65b0\u6539\u6210\u53ef\u5199\uff0c\u628a\u6570\u636e\u6539\u597d\u4e86\u4ee5\u540e\u518d\u8bbe\u4e3a\u53ea\u8bfb\u3002</li> <li>iOS \u4e0a\u7528 NFCNDEFReaderSession \u53ef\u4ee5\u8bfb\u51fa\u6765\u8fd9\u4e2a NDEF \u7684\u5185\u5bb9\uff0c\u4f46 NFCTagReaderSession \u5e76\u4e0d\u80fd poll \u51fa\u6765\u3002</li> </ol>","tags":["nfc","mifare","mifareclassic","iso14443","typea","ndef"]},{"location":"hardware/2018/10/07/my-first-fpga-experience-on-lichee-tang/","title":"\u5728\u8354\u679d\u7cd6\uff08Lichee Tang\uff09\u4e0a\u521d\u6b21\u4f53\u9a8c FPGA","text":"<p>\u4eca\u5929\u4ece\u5f20\u5b87\u7fd4\u5b66\u957f\u90a3\u62ff\u5230\u4e86 \u8354\u679d\u7cd6\uff08Lichee Tang\uff09 \u7684 FPGA \u677f\u5b50\uff0c\u4e8e\u662f\u7acb\u5373\u5f00\u59cb\u628a\u524d\u6bb5\u65f6\u95f4\u5b66\u5230\u7684 Verilog \u5e94\u7528\u4e0a\u6765\u3002\u4e0d\u8fc7\u60f3\u5230\u73b0\u5728\u6211\u624b\u4e0a\u6ca1\u6709\u591a\u5c11\u5916\u8bbe\uff0c\u7136\u540e\u53c8\u5fc5\u987b\u8fdc\u7a0b\u5230 Windows \u7535\u8111\u4e0a\u53bb\u64cd\u4f5c\uff0c\u4e8e\u662f\u5148\u5b9e\u73b0\u4e86\u4e00\u4e0b UART \u901a\u4fe1\u3002</p> <p>\u5728\u7f51\u4e0a\u627e\u5230\u4e86 ben-marshall/uart \u4e00\u4e2a\u7b80\u6613\u7684\u5b9e\u73b0\uff0c\u5f88\u5feb\u505a\u5230\u4e86\u4e00\u76f4\u5728\u4e32\u53e3\u4e0a\u6253\u5370 <code>A</code> \u5b57\u7b26\u3002\u63a5\u7740\u6211\u5f00\u59cb\u5c1d\u8bd5\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u4e32\u53e3\u56de\u663e\u3002\u4e00\u5f00\u59cb\uff0c\u6211\u76f4\u63a5\u628a UART \u8bfb\u5230\u7684\u6570\u636e\u76f4\u63a5\u8f93\u51fa\uff0c\u679c\u7136\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u4e00\u65e6\u4f20\u8f93\u901f\u7387\u8ddf\u4e0d\u4e0a\u4e86\uff0c\u5c31\u4f1a\u4e22\u5931\u6570\u636e\u3002\u4e8e\u662f\u6211\u6dfb\u52a0\u4e86 FIFO IP \u6838\uff0c\u7136\u540e\u628a\u8bfb\u5165\u7684\u6570\u636e\u5b58\u5165 FIFO\uff0c\u53c8\u4ece FIFO \u4e2d\u8bfb\u53d6\u6570\u636e\u5199\u5165\u5230 UART \u4e2d\u53bb\u3002\u4e0d\u8fc7\u53d1\u73b0\u4e86\u4e00\u4e2a\u5c0f BUG\uff1a\u6bcf\u6b21\u6253\u5370\u7684\u662f\u5012\u6570\u7b2c\u4e8c\u6b21\u8f93\u5165\u7684\u5b57\u7b26\uff0c\u5373\u4e22\u5931\u4e86\u7b2c\u4e00\u4e2a\u5b57\u7b26\u3002\u5728\u5f20\u5b87\u7fd4\u5b66\u957f\u7684\u5e2e\u52a9\u4e0b\u627e\u5230\u4e86\u95ee\u9898\uff1a\u5f53 FIFO \u7684\u8bfb\u4f7f\u80fd\u4fe1\u53f7\u4e3a\u9ad8\u65f6\uff0c\u5176\u6570\u636e\u5728\u4e0b\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u624d\u6765\uff0c\u4e8e\u662f\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u7b49\u5230\u6570\u636e\u6765\u7684\u65f6\u5019\u518d\u5411 UART \u4e2d\u5199\u6570\u636e\uff1a</p> <pre><code>always @ (posedge clk_in) begin\n    uart_tx_en &lt;= uart_fifo_re;\nend\n</code></pre> <p>\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u5b8c\u6574\u4ee3\u7801\u5728 jiegec/learn_licheetang \u4e2d\u3002</p>","tags":["verilog","licheetang","fpga","uart"]},{"location":"hardware/2023/02/26/netgear-a6210-linux-wifi-dongle/","title":"\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361","text":"","tags":["netgear","wifi","wireless","dongle","usb","linux"]},{"location":"hardware/2023/02/26/netgear-a6210-linux-wifi-dongle/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u8981\u8ba9\u4e00\u53f0 Linux \u673a\u5668\u8fde\u63a5\u65e0\u7ebf\u7f51\uff0c\u6240\u4ee5\u8981\u4e70\u4e00\u4e2a\u5bf9 Linux \u652f\u6301\u6bd4\u8f83\u597d\u7684 USB \u65e0\u7ebf\u7f51\u5361\u3002\u4ee5\u524d\u66fe\u7ecf\u7528\u8fc7\u4e00\u4e9b USB \u65e0\u7ebf\u7f51\u5361\uff0c\u4f46\u5bf9 Linux \u7684\u652f\u6301\u5927\u591a\u4e0d\u597d\uff0c\u8981\u4e48\u662f\u9700\u8981 out of tree module\uff0c\u8981\u4e48\u5c31\u5ffd\u7136\u4e0d\u80fd\u5de5\u4f5c\u3002\u56e0\u6b64\u524d\u671f\u7684\u8c03\u7814\u5341\u5206\u91cd\u8981\u3002</p>","tags":["netgear","wifi","wireless","dongle","usb","linux"]},{"location":"hardware/2023/02/26/netgear-a6210-linux-wifi-dongle/#\u6311\u9009-usb-\u65e0\u7ebf\u7f51\u5361","title":"\u6311\u9009 USB \u65e0\u7ebf\u7f51\u5361","text":"<p>\u5728\u8c03\u7814\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u4e86 morrownr/USB-WiFi \u4ed3\u5e93\uff0c\u91cc\u9762\u603b\u7ed3\u4e86\u4e00\u4e9b Linux \u652f\u6301\u6bd4\u8f83\u597d\u7684 USB \u65e0\u7ebf\u7f51\u5361\uff0c\u7531\u4e8e\u662f\u5916\u56fd\u4eba\u5199\u7684\uff0c\u6240\u4ee5\u91cc\u9762\u5f88\u591a\u578b\u53f7\u5728\u56fd\u5185\u90fd\u4e70\u4e0d\u5230\uff0c\u4f46\u5b9e\u9645\u4e0a USB \u65e0\u7ebf\u7f51\u5361\u7684\u82af\u7247\u7ec4\u4e00\u822c\u5c31\u662f\u90a3\u4e9b\uff0c\u6240\u4ee5\u9700\u8981\u5148\u786e\u5b9a\u82af\u7247\u7ec4\uff0c\u518d\u6839\u636e\u82af\u7247\u7ec4\u627e\u5bf9\u5e94\u7684 USB \u65e0\u7ebf\u7f51\u5361\u3002</p> <p>\u5f00\u53d1\u7528\u4e8e USB \u65e0\u7ebf\u7f51\u5361\u7684\u5382\u5546\u5e38\u89c1\u7684\u662f\uff1aMediatek\uff082011 \u5e74 MediaTek \u6536\u8d2d\u4e86 Ralink\uff09\u548c Realtek\u3002\u56fd\u5185\u76f4\u63a5\u4e70\u5230\u7684 USB \u65e0\u7ebf\u7f51\u5361\u5927\u90e8\u5206\u662f Realtek\uff0c\u4f46\u662f Realtek \u7684 Linux \u9a71\u52a8\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u90fd\u662f out of tree \u7684\u72b6\u6001\uff0c\u53ea\u6709\u6bd4\u8f83\u65b0\u7684\u4e00\u4e9b\u82af\u7247\u7ec4\u6709\u5185\u6838\u652f\u6301\uff0c\u800c Mediatek \u7cfb\u5217\u7684\u82af\u7247\u5185\u6838\u652f\u6301\u8f83\u597d\uff0c\u7f3a\u70b9\u662f\u6bd4\u8f83\u8d35\u3002\u4e0b\u9762\u4ece\u4e0a\u9762\u7684\u4ed3\u5e93\u91cc\u6458\u5f55\u4e86\u4e00\u4e9b\u82af\u7247\u7ec4\u7684 Linux \u5185\u6838\u652f\u6301\u60c5\u51b5\uff1a</p> Chipset Linux Commit 802.11 USB Bluetooth Package Links MT7601u 4.2+ mt7601u b/g/n 2.0 N/A Official MT7610u 4.19+ mt76x0u b/g/n/ac 2.0 N/A Official MT7612u 4.19+ mt76x2u b/g/n/ac 3.0 4.0 Official MT7662u b/g/n/ac 3.0 4.0 Official MT7921au MT7922u RTL8188eus 3.12+ rtl8188eu/r8188eu/rtl8xxxu LKDDB b/g/n 2.0 N/A QFN-46 Official RTL8188gu N/A 3rd party patch RTL8723bu 4.6+ rtl8xxxu LKDDB b/g/n 2.0 4.0 QFN-56 USB 0bda:b720\uff0cOfficial RTL8723du 6.2+ rtw88 LKDDB b/g/n 4.2 QFN-48 Official RTL8811au N/A 3rd party b/g/n/ac 2.0 N/A QFN-56 Official Datasheet RTL8821au N/A b/g/n/ac 2.0 4.0 QFN-56 Official RTL8811cu 6.2+ rtw88 LKDDB b/g/n/ac 2.0 N/A QFN-56 Official\uff0cDatasheet RTL8821cu 6.2+ rtw88 LKDDB b/g/n/ac 2.0 4.2 QFN-56 Official\uff0cDatasheet RTL8812au N/A 3rd party b/g/n/ac 3.0 N/A QFN-76 Official RTL8812bu 6.2+ rtw88 LKDDB b/g/n/ac 3.0 N/A TFBGA Official RTL8822bu 6.2+ rtw88 LKDDB b/g/n/ac 3.0 4.1 TFBGA Official\uff0cDatasheet RTL8822cu 6.2+ rtw88 LKDDB RTL8814au N/A 3rd party b/g/n/ac 3.0 N/A QFN-128 Official <p>\u53ef\u4ee5\u89c2\u5bdf\u5230\u89c4\u5f8b\uff1aRealtek \u7684\u4ea7\u54c1\u578b\u53f7\u4e2d\uff0c881x \u548c 882x \u6709\u5bf9\u5e94\u7684\u5173\u7cfb\uff0c\u524d\u8005\u4e0d\u5e26\u84dd\u7259\uff0c\u540e\u8005\u5e26\u3002\u6700\u540e\u4e00\u4f4d\u6570\u5b57\u8d8a\u5927\uff0c\u5219\u8d8a\u65b0\u3002</p> <p>\u5728\u5185\u6838\u6e90\u7801\u4e2d\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b\u4f7f\u7528\u8fd9\u4e2a\u82af\u7247\u7ec4\u7684 USB \u65e0\u7ebf\u7f51\u5361\u578b\u53f7\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6709\u65f6\u5019\u540c\u6837\u7684\u578b\u53f7\uff0c\u6709 v1v2v3 \u4e4b\u5206\uff0c\u53ef\u80fd\u7528\u7684\u662f\u4e0d\u540c\u7684\u82af\u7247\u7ec4\uff0c\u8d2d\u4e70\u524d\u9700\u8981\u95ee\u6e05\u695a\u3002</p> <p>\u8d2d\u4e70\u7684\u65f6\u5019\uff0c\u8003\u8651\u82af\u7247\u7ec4\u7684\u652f\u6301\u60c5\u51b5\uff0cLinux \u5185\u6838\u7248\u672c\u7b49\u7b49\u56e0\u7d20\uff0c\u6211\u6700\u540e\u8d2d\u4e70\u4e86 Netgeat A6210 \u8ba4\u8bc1\u7ffb\u65b0\u7248\uff0c\u4f7f\u7528\u82af\u7247\u7ec4 MT7612u\uff0c\u4ef7\u683c\u662f 138 \u4eba\u6c11\u5e01\u3002</p>","tags":["netgear","wifi","wireless","dongle","usb","linux"]},{"location":"hardware/2023/02/26/netgear-a6210-linux-wifi-dongle/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>\u4f7f\u7528\u7684 Linux \u5185\u6838\u7248\u672c\u662f 5.10\uff0c\u63d2\u4e0a USB \u65e0\u7ebf\u7f51\u5361\u5373\u53ef\u4f7f\u7528\uff1a</p> <pre><code>$ lsusb\nBus 002 Device 002: ID 0846:9053 NetGear, Inc. A6210\n</code></pre> <p>\u5728\u4f7f\u7528 iwd \u7684\u8fde\u63a5\u65e0\u7ebf\u7f51\u7684\u65f6\u5019\uff0c\u8fd8\u51fa\u73b0\u4e00\u4e2a\u5c0f\u63d2\u66f2\uff0c\u5c31\u662f iwd \u9047\u5230\u5f88\u957f\u7684\u4e2d\u6587 SSID \u65f6\u4f1a\u5d29\u6e83\uff0c\u4e8e\u662f\u6211\u8fdb\u884c\u4e86\u4fee\u590d\uff0c\u5e76\u4e14\u53d1\u9001\u7ed9 iwd mailing list\uff08link\uff09\uff0c\u5e76\u7b49\u5f85\u4fee\u590d\u3002\u539f\u7406\u5f88\u7b80\u5355\uff0c\u4e00\u662f\u6253\u5370\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u7684\u65f6\u5019\u6ca1\u6709\u8003\u8651\u7b26\u53f7\uff0c\u4e8c\u662f\u7f3a\u5c11\u4e86\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u68c0\u67e5\u3002</p>","tags":["netgear","wifi","wireless","dongle","usb","linux"]},{"location":"hardware/2023/02/26/netgear-a6210-linux-wifi-dongle/#realtek-\u4e0a\u6e38-linux-\u5185\u6838\u9a71\u52a8\u652f\u6301","title":"Realtek \u4e0a\u6e38 Linux \u5185\u6838\u9a71\u52a8\u652f\u6301","text":"<p>\u5f52\u529f\u4e8e Sascha Hauer s.hauer@pengutronix.de \u8001\u54e5\uff0c\u6700\u8fd1 Linux \u4e0a\u6e38\u589e\u52a0\u4e86\u4e0d\u5c11\u5bf9 realtek \u7f51\u5361\u7684\u652f\u6301\uff0c\u56e0\u6b64\u53ea\u8981\u7cfb\u7edf\u8db3\u591f\u65b0\uff0crealtek \u7684\u7f51\u5361\u4e5f\u503c\u5f97\u8003\u8651\uff0c\u5982\uff1a</p> <ul> <li>RTL8723du: Linux 6.2+</li> <li>RTL8811cu: Linux 6.2+</li> <li>RTL8821cu: Linux 6.2+</li> <li>RTL8812bu: Linux 6.2+</li> <li>RTL8822bu: Linux 6.2+</li> <li>RTL8822cu: Linux 6.2+</li> </ul> <p>RTL8188gu \u4e5f\u6709\u6b63\u5728 review \u7684 patch\u3002\u7ecf\u8fc7\u6211\u7684\u6d4b\u8bd5\u4e5f\u662f\u5de5\u4f5c\u7684\u3002</p>","tags":["netgear","wifi","wireless","dongle","usb","linux"]},{"location":"hardware/2021/03/08/pcb-notes/","title":"PCB \u7b14\u8bb0","text":"<p>\u8bb0\u5f55\u4e00\u4e0b\u5728\u5b66\u4e60\u753b\u677f\u5b50\u8fc7\u7a0b\u4e2d\u5b66\u5230\u7684\u5fc3\u5f97\u3002</p>","tags":["pcb","lceda","schematic","footprint","circuit"]},{"location":"hardware/2021/03/08/pcb-notes/#\u5de5\u5177","title":"\u5de5\u5177","text":"<p>\u76ee\u524d\u4f7f\u7528\u8fc7 KiCad \u548c lceda\uff1a</p> <ul> <li>KiCad: \u5f00\u6e90\u8f6f\u4ef6\uff0c\u8de8\u5e73\u53f0\u3002</li> <li>lceda\uff1a\u5728\u7ebf\u7f16\u8f91\uff0c\u4e0d\u9700\u8981\u5b89\u88c5\uff0c\u548c lcsc \u6709\u6df1\u5ea6\u96c6\u6210\u3002</li> </ul> <p>\u9879\u76ee jiegec/HT42B534USB2UART \u91c7\u7528\u7684\u662f KiCad 5 \u7f16\u5199\u7684\u3002\u76ee\u524d\u6b63\u5728\u505a\u7684\u53e6\u4e00\u4e2a\u9879\u76ee\u91c7\u7528 lceda</p>","tags":["pcb","lceda","schematic","footprint","circuit"]},{"location":"hardware/2021/03/08/pcb-notes/#\u6d41\u7a0b","title":"\u6d41\u7a0b","text":"<ol> <li>\u9009\u62e9\u6240\u9700\u8981\u4f7f\u7528\u7684\u82af\u7247\uff0c\u67e5\u627e\u82af\u7247\u7684 datasheet\u3002</li> <li>\u5bfb\u627e\u91c7\u7528\u4e86\u82af\u7247\u7684\u4e00\u4e9b\u8bbe\u8ba1\uff0c\u7279\u522b\u662f\u770b schematic\u3002</li> <li>\u6309\u7167 datasheet \u91cc\u9762\u63a8\u8350\u7684\u7535\u8def\uff0c\u6216\u8005\u662f\u5176\u4ed6\u4eba\u7684\u8bbe\u8ba1\uff0c\u753b\u81ea\u5df1\u9700\u8981\u7684 schematic\u3002</li> <li>\u8bbe\u7f6e\u597d\u5404\u4e2a\u5143\u4ef6\u7684 footprint\uff0c\u7136\u540e\u8f6c\u5230 PCB \u8bbe\u8ba1\u3002</li> <li>\u5728 PCB \u91cc\u9762\u5e03\u7ebf\uff0c\u751f\u6210 Gerber \u7b49\u6587\u4ef6\u3002</li> <li>\u628a Gerber \u7ed9\u5230\u751f\u4ea7\u5546\uff08\u6bd4\u5982 jlc\uff09\uff0c\u4ea4\u4ed8\u751f\u4ea7\u3002</li> <li>\u5982\u679c\u662f\u81ea\u5df1\u710a\u63a5\uff0c\u5219\u9700\u8981\u8d2d\u4e70\u5143\u4ef6\uff0c\u6bd4\u5982\u4ece lcsc \u8d2d\u4e70\u3002</li> <li>\u6536\u5230 PCB \u548c\u5143\u4ef6\u540e\uff0c\u81ea\u5df1\u6309\u7167 BOM \u548c schematic \u710a\u63a5\u5404\u4e2a\u5143\u4ef6\u3002</li> </ol>","tags":["pcb","lceda","schematic","footprint","circuit"]},{"location":"hardware/2021/03/08/pcb-notes/#\u7b14\u8bb0","title":"\u7b14\u8bb0","text":"<ol> <li>\u5bf9\u4e8e\u4e00\u4e9b\u8fde\u63a5\u5f88\u591a\u5143\u4ef6\u7684\u4fe1\u53f7\uff0c\u6bd4\u5982 GND\uff0c\u53ef\u4ee5\u7559\u4f5c\u94fa\u94dc\u89e3\u51b3\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5148\u4e0d\u7ba1 GND\uff0c\u628a\u5176\u4ed6\u6240\u6709\u7684\u4fe1\u53f7\u90fd\u63a5\u597d\u4ee5\u540e\uff0c\u518d\u5728\u9876\u5c42\u94fa\u94dc\uff1b\u5982\u679c\u8fd8\u662f\u6709\u6ca1\u6709\u8fde\u63a5\u4e0a\u7684 GND\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fc7\u5b54\uff08Via\uff09\u8d70\u5230\u5e95\u5c42\uff0c\u5728\u5e95\u5c42\u518d\u94fa\u4e00\u5c42\u94dc\u3002</li> <li>\u5bf9\u4e8e\u5916\u90e8\u4f9b\u7535\u7684 VCC \u548c GND\uff0c\u5728 KiCad \u4e2d\u9700\u8981\u7528 PWR_FLAG \u6807\u8bb0\u4e00\u4e0b\u3002</li> <li>\u5728 KiCad \u4e2d\u8bbe\u8ba1 PCB \u524d\uff0c\u8981\u628a\u751f\u4ea7\u5546\u7684\u5de5\u827a\u53c2\u6570\u8bbe\u7f6e\u597d\uff0c\u4e0d\u7136\u753b\u4e86\u4e5f\u8981\u91cd\u753b\u3002</li> <li>lceda \u5728\u9009\u62e9\u5143\u4ef6\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece lcsc \u91cc\u9009\u62e9\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u5c01\u88c5\u548c\u5546\u54c1\u53ef\u4ee5\u5bf9\u5f97\u4e0a\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u8fdb\u884c\u5339\u914d\u3002</li> <li>\u5982\u679c\u8981\u7528 jlc \u7684 SMT \u8d34\u7247\uff0c\u5148\u5728 SMT \u5143\u4ef6\u5217\u8868 \u91cc\u641c\u7d22\u6240\u9700\u8981\u7684\u5143\u4ef6\uff1b\u63a8\u8350\u7528\u57fa\u672c\u5e93\uff0c\u5982\u679c\u7528\u5176\u4ed6\u5e93\uff0c\u5219\u8981\u52a0\u94b1\uff1b\u9009\u597d\u5143\u4ef6\u4ee5\u540e\uff0c\u7528\u5143\u4ef6\u7f16\u53f7\u53bb lceda \u91cc\u641c\u7d22\u5e76\u6dfb\u52a0\u5230 schematic\u3002</li> <li>\u5bf9\u4e8e\u6d89\u53ca\u6a21\u62df\u4fe1\u53f7\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982\u97f3\u9891\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\u6a21\u62df\u4fe1\u53f7\u7684\u7535\u548c\u5730\u90fd\u662f\u5355\u72ec\u7684\uff1a<code>AVCC</code> \u548c <code>AGND</code>\u3002\u6240\u4ee5\u8981\u7279\u522b\u6ce8\u610f datasheet \u91cc\u9762\u4e0d\u540c\u7684\u5730\u7684\u8868\u793a\u65b9\u6cd5\u3002\u6700\u540e\uff0c\u518d\u7528\u78c1\u73e0\u628a <code>VCC</code> \u548c <code>AVCC</code>\u3001<code>GND</code> \u548c <code>AGND</code> \u5206\u522b\u8fde\u63a5\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86\u3002\u53ef\u4ee5\u53c2\u8003 DE2 \u677f\u5b50\u4e2d\u7b2c 19 \u9875\u7684\u97f3\u9891\u90e8\u5206\u8bbe\u8ba1 \u548c Staying well grounded\u3002</li> <li>\u5728 schematic \u91cc\u7ecf\u5e38\u4f1a\u51fa\u73b0\u5728\u7535\u6e90\u9644\u8fd1\u7684\u7535\u5bb9\uff0c\u90a3\u4e48\uff0c\u5728 PCB \u4e2d\uff0c\u4e5f\u5c3d\u91cf\u628a\u8fd9\u4e9b\u7535\u5bb9\u653e\u5728\u5bf9\u5e94\u7684\u7535\u6e90\u7684\u65c1\u8fb9\u3002</li> <li>\u8033\u673a\u63d2\u5ea7\u91cc\u9762\uff0c\u4e00\u822c\u5206\u4e09\u79cd\u7ec4\u6210\u90e8\u4ef6\uff1aTip\uff0cRing\uff0cSleeve\u3002\u53ea\u6709\u4e24\u6bb5\u7684\u662f TS\uff0c\u4e09\u6bb5\u7684\u662f TRS\uff0c\u56db\u6bb5\u7684\u662f TRRS\u3002TS \u662f\u5355\u58f0\u9053\uff0cT \u662f\u58f0\u97f3\uff0cS \u662f\u5730\u3002TRS \u662f\u53cc\u58f0\u9053\uff0cT \u662f\u5de6\u58f0\u9053\uff08\u6216\u8005\u5355\u58f0\u9053\uff09\uff0cR \u662f\u53f3\u58f0\u9053\uff0cS \u662f\u5730\u3002TRRS \u5219\u662f\u53cc\u58f0\u9053\u52a0\u5f55\u97f3\u3002\u4e00\u822c\u6765\u8bf4\uff0cLINE IN \u662f\u53cc\u58f0\u9053\uff0cMIC IN \u662f\u5355\u58f0\u9053\uff0c\u5b83\u4eec\u7684\u963b\u6297\u4e5f\u4e0d\u540c\uff1bLINE OUT \u548c HEADPHONE OUT \u90fd\u662f\u53cc\u58f0\u9053\uff0c\u4f46 HEADPHONE OUT \u7ecf\u8fc7\u4e86\u989d\u5916\u7684\u653e\u5927\u5668\u3002</li> <li>\u9047\u5230\u4e00\u4e2a SPI \u534f\u8bae\u6ca1\u6709 <code>SPI_MISO</code> \u5f15\u811a\u7684\u82af\u7247\uff0c\u53ef\u80fd\u8bf4\u660e\u5b83\u662f write-only \u7684\u3002</li> <li>\u624b\u710a\u7684\u57fa\u672c\u5143\u4ef6\uff0c\u4e00\u822c\u7528 0603 \u52a0\u4e00\u4e9b Padding \u7684\u5c01\u88c5\uff1bSMT \u7684\u8bdd\uff0c\u5219\u5efa\u8bae\u7528 0402 \u5c01\u88c5\u3002</li> <li>I2C \u7684\u4fe1\u53f7\u7ebf\u4e00\u822c\u9700\u8981\u52a0\u4e00\u4e2a\u51e0 K \u6b27\u59c6\u7684\u4e0a\u62c9\u7535\u963b\u5230 VCC\u3002</li> </ol> <p>JLC SMT \u7684\u57fa\u7840\u5e93\u4e0d\u9700\u8981\u6362\u6599\u8d39\uff0c\u5982\u4f55\u5bfb\u627e\u57fa\u7840\u5e93\u4e2d\u7684\u5143\u4ef6\uff1a</p> <ol> <li>\u7535\u963b\u54c1\u724c\u662f UNI-ROYAL\uff0c\u578b\u53f7\u547d\u540d\u89c4\u5219\u662f\uff1a<ol> <li>\u5c01\u88c5\uff1a0603/0402</li> <li>\u529f\u7387\uff1aWA/WG/W8</li> <li>\u8bef\u5dee\uff1aF(1%)</li> <li>\u963b\u503c\uff1a\u4e09\u4f4d\u6574\u6570 + \u4e00\u4f4d exp\uff08J \u8868\u793a -1\uff0cK \u8868\u793a -2\uff0cL \u8868\u793a -3\uff09\uff0c\u4f8b\u5982 2002 \u8868\u793a <code>200*10^2=20k</code>\uff0c1003 \u8868\u793a <code>100*10^3=100k</code>\uff0c3300 \u8868\u793a <code>330*10^0=330</code>\uff0c330J \u8868\u793a <code>330*10^-1=33</code>\uff0c330K \u8868\u793a <code>330*10^-2=3.3</code> \u4f8b\u5b50\uff1a\u8981\u627e 0402 \u5c01\u88c5\u7684 10k \u6b27\u7535\u963b\uff0c\u641c\u7d22 0402WGF1003\uff1b\u8981\u627e 0603 \u5c01\u88c5\u7684 33 \u6b27\u7535\u963b\uff0c\u641c\u7d22 0603WAF330\u3002</li> </ol> </li> <li>\u7535\u5bb9\u54c1\u724c\u6709\u98ce\u534e/\u4e09\u661f/\u56fd\u5de8\uff0c\u4e09\u661f\u7684\u7535\u5bb9\u578b\u53f7\u547d\u540d\u89c4\u5219\u662f\uff1a<ol> <li>\u5c01\u88c5\uff1a05(0402)/10(0603)</li> <li>\u5b57\u6bcd\uff1aA/B/C</li> <li>\u7535\u5bb9\uff1a\u4e24\u4f4d\u6574\u6570 + \u4e00\u4f4d exp\uff0c\u5355\u4f4d\u662f pF\uff0c\u4f8b\u5982 105 \u8868\u793a <code>10*10^5pF=10^6pF=1uF</code>\uff0c104 \u8868\u793a <code>10*10^4pF=10^5pF=0.1uF</code> \u4f8b\u5b50\uff1a\u8981\u627e 0402 \u5c01\u88c5\u7684 100nF \u7535\u5bb9\uff0c\u641c\u7d22 CL05B104\uff1b\u8981\u627e 0603 \u5c01\u88c5\u7684 1uF \u7535\u5bb9\uff0c\u641c\u7d22 CL10A105\u3002\u4e5f\u53ef\u4ee5\u53ea\u641c\u7535\u5bb9\u7684\u6570\u5b57\u90e8\u5206\uff0c\u53ef\u4ee5\u627e\u5230\u66f4\u591a\u54c1\u724c\u3002</li> </ol> </li> </ol>","tags":["pcb","lceda","schematic","footprint","circuit"]},{"location":"hardware/2021/03/08/pcb-notes/#\u963b\u6297\u5339\u914d","title":"\u963b\u6297\u5339\u914d","text":"<p>\u5728\u4f20\u8f93\u7ebf\u4e0a\uff0c\u5982\u679c\u51fa\u73b0\u963b\u6297\u53d8\u5316\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4fe1\u53f7\u51fa\u73b0\u53cd\u5c04\uff0c\u8d28\u91cf\u53d8\u5dee\u3002\u56e0\u6b64\uff0c\u9700\u8981\u4fdd\u8bc1\u4f20\u8f93\u7ebf\u7684\u4e24\u7aef\u548c\u4f20\u8f93\u7ebf\u6574\u4e2a\u8fc7\u7a0b\u7684\u963b\u6297\u4e00\u81f4\u3002</p> <p>\u963b\u6297\u8bbe\u7f6e\u4e3a\u591a\u5c11\uff0c\u4e00\u822c\u8981\u770b\u534f\u8bae\u7684\u89c4\u5b9a\u3002\u786e\u5b9a\u597d\u534f\u8bae\u5b9a\u4e49\u7684\u963b\u6297\u4ee5\u540e\uff0c\u9700\u8981\u67e5\u770b\u4fe1\u53f7\u4e24\u7aef\u7684\u82af\u7247\u5185\u90e8\u7684\u963b\u6297\uff0c\u5982\u679c\u548c\u534f\u8bae\u4e0d\u4e00\u81f4\uff0c\u9700\u8981\u989d\u5916\u6dfb\u52a0\u7535\u963b\uff0c\u5e76\u4e14\u7535\u963b\u8981\u5c3d\u91cf\u653e\u5728\u63a5\u8fd1\u82af\u7247\u7684\u4f4d\u7f6e\u4e0a\u3002\u7531\u4e8e\u4f20\u8f93\u7ebf\u5728 PCB \u4e0a\uff0c\u6240\u4ee5\u548c PCB \u5382\u5546\u7684\u5de5\u827a\u6709\u5173\uff0c\u9700\u8981\u53bb\u5382\u5546\u7684\u963b\u6297\u8ba1\u7b97\u5668\u4e0a\u8fdb\u884c\u8ba1\u7b97\uff0c\u4f8b\u5982 jlc \u963b\u6297\u8ba1\u7b97\u5668\u3002\u6d89\u53ca\u5230\u7684\u53c2\u6570\u6709\uff1a</p> <ol> <li>\u677f\u5b50\u5c42\u6570\uff1aPCB \u5c42\u6570\uff0c\u6700\u7b80\u5355\u7684\u6b63\u53cd\u9762\u5c31\u662f 2 \u5c42</li> <li>\u6210\u54c1\u539a\u5ea6\uff1a\u6574\u4e2a PCB \u52a0\u8d77\u6765\u7684\u539a\u5ea6\uff0c\u4f8b\u5982 1.6mm</li> <li>\u5185\u5c42\u94dc\u539a\uff1a\u5939\u5728\u5185\u90e8\u7684 PCB \u7684\u94dc\u7684\u539a\u5ea6\uff0c\u4f8b\u5982 0.5 oz\uff0c\u5c31\u662f 1.37/2=0.685 mil</li> <li>\u5916\u5c42\u94dc\u539a\uff1aPCB \u4e0a\u4e0b\u66b4\u9732\u5728\u5916\u9762\u7684\u4e24\u5c42\u7684\u94dc\u7684\u539a\u5ea6\uff0c\u5e38\u89c1 1 oz=1.37 mil</li> <li>\u9700\u6c42\u963b\u6297\uff1a\u534f\u8bae\u6240\u8981\u6c42\u7684\u963b\u6297\uff0c\u4f8b\u5982\u5355\u7aef 50 \u6b27\u59c6\uff08SDIO\uff09\uff0c\u5dee\u5206 90 \u6b27\u59c6\uff08USB\uff09</li> <li>\u963b\u6297\u6a21\u5f0f\uff1a\u4f20\u8f93\u7ebf\u7684\u8fde\u63a5\u65b9\u5f0f\uff0c\u89c1\u4e0b\uff08\u56fe\u6e90 KiCad\uff09<ol> <li>\u5355\u7aef\u963b\u6297\uff08Microstrip Line\uff09\uff1a\u4e00\u6839\u7ebf\u4f20\u8f93\u4fe1\u53f7\uff0c\u5730\u7ebf\u5728\u53e6\u4e00\u4e2a\u5e73\u9762\uff0c\u56fe\u4e2d\u4e0a\u9762\u7684\u957f\u65b9\u5f62\u5c31\u662f\u4f20\u8f93\u7ebf\uff0c\u5e95\u90e8\u5c31\u662f\u5730\u5e73\u9762 </li> <li>\u5dee\u5206\u963b\u6297\uff08Coupled Microstrip Line\uff09\uff1a\u5dee\u5206\u7ebf\u4f20\u8f93\u4fe1\u53f7\uff0c\u5730\u7ebf\u5728\u53e6\u4e00\u4e2a\u5e73\u9762\uff0c\u56fe\u4e2d\u4e0a\u65b9\u4e24\u4e2a\u957f\u65b9\u5f62\u5c31\u662f\u5dee\u5206\u4f20\u8f93\u7ebf\uff0c\u5e95\u90e8\u662f\u5730\u5e73\u9762 </li> <li>\u5171\u9762\u5355\u7aef\uff1a\u4e00\u6839\u7ebf\u4f20\u8f93\u4fe1\u53f7\uff0c\u5468\u56f4\u5c31\u662f\u5730\u5e73\u9762  </li> <li>\u5171\u9762\u5dee\u5206\uff1a\u5dee\u5206\u7ebf\u4f20\u8f93\u4fe1\u53f7\uff0c\u5468\u56f4\u5c31\u662f\u5730\u5e73\u9762</li> </ol> </li> <li>\u963b\u6297\u5c42\uff1a\u4f20\u8f93\u7ebf\u6240\u5728\u7684\u5c42</li> <li>\u53c2\u8003\u5c42\uff1a\u5730\u7ebf\u6240\u5728\u7684\u5c42</li> </ol> <p>\u7531\u4e8e\u53cc\u5c42 PCB \u7684\u4e24\u5c42\u94dc\u4e4b\u95f4\u8ddd\u79bb\u6bd4\u8f83\u8fdc\uff08\u4f8b\u5982 57.68 mil\uff09\uff0c\u5982\u679c\u91c7\u7528\u5355\u7aef\u963b\u6297\uff0c\u90a3\u4e48\u9700\u8981\u6bd4\u8f83\u5927\u7684\u7ebf\u5bbd\uff0c\u4f8b\u5982\u7528 jlc \u963b\u6297\u8ba1\u7b97\u5668\uff0c50 \u6b27\u59c6\u963b\u6297\u9700\u8981 106.68 mil \u7684\u7ebf\u5bbd\u3002\u5982\u679c\u91c7\u7528\u56db\u5c42 PCB\uff0c\u6700\u4e0a\u9762\u4e24\u5c42\u4e4b\u95f4\u8ddd\u79bb\u7f29\u5c0f\u4e86\u5f88\u591a\uff08\u4f8b\u5982 7.99 mil\uff09\uff0c\u6b64\u65f6\u5373\u4f7f\u7528\u5355\u7aef\u963b\u6297\uff0c\u7528 jlc \u8ba1\u7b97\u5f97\u51fa\u53ea\u9700\u8981 13.2 mil \u7684\u7ebf\u5bbd\u3002\u6240\u4ee5\u53cc\u5c42 PCB \u66f4\u9002\u5408\u4f7f\u7528\u5171\u9762\u5355\u7aef\u7684\u65b9\u5f0f\uff0c\u6b64\u65f6\u4f20\u8f93\u7ebf\u548c\u5730\u7ebf\u653e\u5728\u4e86\u540c\u4e00\u4e2a\u5e73\u9762\uff0c\u8ddd\u79bb\u6bd4\u8f83\u5c0f\uff0c\u5c31\u4e0d\u9700\u8981\u90a3\u4e48\u5927\u7684\u7ebf\u5bbd\u3002</p> <p>\u8fd9\u91cc\u7684\u5355\u4f4d\uff1a1 mil = 0.0254 mm\uff0c1 inch = 1000 mil = 0.0254 m\uff0c1 oz = 1.37 mil = 0.0348 mm</p>","tags":["pcb","lceda","schematic","footprint","circuit"]},{"location":"hardware/2023/01/05/pcie-bifurcation/","title":"PCIe Bifurcation","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u770b\u5230\u4e24\u7bc7\u5173\u4e8e PCIe Bifurcation \u7684\u6587\u7ae0\uff1a</p> <ul> <li>intel \u90e8\u5206\u684c\u9762\u7ea7 CPU \u7684 pcie \u901a\u9053\u62c6\u5206\u53e6\u7c7b\u4f4e\u6210\u672c\u5b9e\u73b0</li> <li>Intel Alder Lake 12 \u4ee3\u9177\u777f CPU PCIe \u62c6\u5206\u5b9e\u73b0\u65b9\u6cd5</li> </ul> <p>\u6587\u7ae0\u8bb2\u7684\u662f\u5982\u4f55\u5728 CPU \u4e0a\u8fdb\u884c\u8df3\u7ebf\uff0c\u4ece\u800c\u5b9e\u73b0 PCIe Bifurcation \u7684\u914d\u7f6e\u3002\u6b63\u597d\u501f\u6b64\u673a\u4f1a\u6765\u7814\u7a76\u4e00\u4e0b PCIe Bifurcation\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#pcie-bifurcation_1","title":"PCIe Bifurcation","text":"<p>PCIe Bifurcation \u7684\u76ee\u7684\u662f\u8ba9 PCIe \u6709\u66f4\u597d\u7684\u7075\u6d3b\u6027\u3002\u4ece CPU \u51fa\u6765\u7684\u51e0\u8def PCIe\uff0c\u5b83\u7684\u5bbd\u5ea6\u4e00\u822c\u662f\u786e\u5b9a\u7684\uff0c\u6bd4\u5982\u6709\u4e00\u4e2a x16\uff0c\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u60f3\u8981\u63a5\u591a\u4e2a\u8bbe\u5907\uff0c\u4f8b\u5982\u628a x16 \u5f53\u6210\u4e24\u4e2a x8 \u6765\u7528\uff0c\u8fd9\u5c31\u662f PCIe Bifurcation\u3002\u8fd9\u9700\u8981 PCIe \u4e24\u7aef\u7684\u652f\u6301\uff0cCPU \u7aef\u9700\u8981\u53ef\u914d\u7f6e PCIe Bifurcation\uff0c\u4e0d\u7136\u53ea\u80fd\u4ece\u4e00\u4e2a x16 \u964d\u7ea7\u5230\u4e00\u4e2a x8\uff0c\u5269\u4e0b\u7684 8x \u5c31\u6ca1\u6cd5\u5229\u7528\u4e86\uff1b\u8bbe\u5907\u7aef\u9700\u8981\u62c6\u5206\u5361\uff0c\u628a x16 \u7684\u4fe1\u53f7\u5206\u6210\u4e24\u8def\uff0c\u7136\u540e\u63d0\u4f9b\u4e24\u4e2a PCIe \u63d2\u69fd\u4ee5\u53ca\u4f7f\u7528 Clock Buffer \u6765\u63d0\u4f9b\u4e0b\u6e38\u8bbe\u5907\u7684\u65f6\u949f\uff0c\u6709\u65f6\u5219\u662f\u4e3b\u677f\u8bbe\u8ba1\u65f6\u5c31\u505a\u4e86\u62c6\u5206\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u62c6\u5206\u5361\u3002</p> <p>\u90a3\u4e48\u600e\u4e48\u914d\u7f6e CPU \u7aef\u7684 PCIe Bifurcation \u5462\uff1f\u5176\u5b9e\u5c31\u662f\u4e0a\u9762\u4e24\u7bc7\u6587\u7ae0\u63d0\u5230\u7684\u529e\u6cd5\uff1aCPU \u6839\u636e CFG \u4fe1\u53f7\u6765\u51b3\u5b9a PCIe Bifurcation \u914d\u7f6e\uff0c\u4f8b\u5982\u8981\u9009\u62e9 1x16\uff0c2x8 \u8fd8\u662f 1x8+2x4 \u7b49\u7b49\u3002\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u5b9e\u73b0\u601d\u8def\u90fd\u662f\uff1a</p> <ol> <li>\u6839\u636e CPU \u578b\u53f7\uff08\u5982 i7-12700K\uff09\u627e\u5230 datasheet\uff0c\u5982 12th Generation Intel Core Processors Datasheet Volume 1</li> <li>\u5bfb\u627e datasheet \u4e2d\u5173\u4e8e PCIe Bifurcation \u7684\u914d\u7f6e\uff0c\u627e\u5230 CFG \u4fe1\u53f7\u7684\u53d6\u503c</li> <li>\u627e\u5230 CPU \u7684\u5f15\u811a\u5b9a\u4e49\u56fe\uff08\u5982 LGA1700\uff09\uff0c\u627e\u5230 CFG \u5f15\u811a\uff0c\u7136\u540e\u627e\u5230\u9644\u8fd1\u7684\u5730\u6216\u8005\u7535\u6e90</li> <li>\u8fde\u63a5\u8df3\u7ebf</li> </ol> <p>\u5177\u4f53\u7ec6\u8282\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u53ef\u4ee5\u67e5\u770b\u4e0a\u9762\u7684\u4e24\u7bc7\u6587\u7ae0\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#\u53ef\u914d\u7f6e\u6027","title":"\u53ef\u914d\u7f6e\u6027","text":"<p>\u8fd9\u65f6\u5019\u5c31\u6709\u4e00\u4e2a\u7591\u95ee\u4e86\uff0c\u5982\u679c PCIe Bifurcation \u914d\u7f6e\u662f\u901a\u8fc7\u5f15\u811a\u8f93\u5165\u7684\uff0c\u4e00\u822c\u7535\u8def\u662f\u56fa\u5b9a\u7684\uff0c\u90a3\u662f\u4e0d\u662f\u5c31\u4e0d\u53ef\u4ee5\u52a8\u6001\u914d\u7f6e\u4e86\uff1f</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#\u684c\u9762\u5e73\u53f0","title":"\u684c\u9762\u5e73\u53f0","text":"<p>\u5b9e\u9645\u627e\u4e00\u4e2a\u4e3b\u677f\u6765\u7814\u7a76\u4e00\u4e0b\u3002\u578b\u53f7\u662f ASRock Fatal1ty Z97X Killer\uff0c\u4ece\u4e3b\u677f\u7684\u63cf\u8ff0\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff1a<code>3 x PCI Express 3.0 x16 Slots (PCIE2/PCIE4/PCIE6: single at x16 (PCIE2); dual at x8 (PCIE2) / x8 (PCIE4); triple at x8 (PCIE2) / x4 (PCIE4) / x4 (PCIE6)</code>\uff0c\u8bf4\u660e\u5b83\u662f\u652f\u6301 PCIe Bifurcation \u7684\uff0c\u6d89\u53ca\u5230\u4e09\u4e2a PCIe Slot\uff0c\u652f\u6301\u4e09\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li>PCIE2 Slot x16</li> <li>PCIE2 Slot x8, PCIE4 Slot x8</li> <li>PCIE2 Slot x8, PCIE4 Slot x4, PCIE6 Slot x4</li> </ul> <p>\u5728 \u7f51\u4e0a \u627e\u5230\u8be5\u4e3b\u677f\u7684 \u539f\u7406\u56fe\uff0c\u53ef\u4ee5\u7528 OpenBoardView \u8f6f\u4ef6\u6253\u5f00\u3002\u8fd9\u4e2a\u4e3b\u677f\u4e0a\u7684 CPU \u63d2\u69fd\u662f LGA1150\uff0c\u627e\u5230\u4e00\u4e2a\u517c\u5bb9\u7684 CPU \u7248\u672c i7-4771\uff0c\u4e0b\u8f7d Datasheet\uff0c\u53ef\u4ee5\u770b\u5230\u51b3\u5b9a PCIe Bifurcation \u7684\u5f15\u811a\u662f <code>CFG[6:5]</code>\uff1a</p> <ul> <li><code>CFG[6:5]=00</code>: 1x8, 2x4</li> <li><code>CFG[6:5]=10</code>: 2x8</li> <li><code>CFG[6:5]=11</code>: 1x16</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e09\u79cd\u914d\u7f6e\u548c\u4e3b\u677f\u7f51\u7ad9\u4e0a\u63cf\u8ff0\u7684\u662f\u4e00\u81f4\u7684\u3002\u65e2\u7136\u4e3b\u677f\u652f\u6301 Bifurcation\uff0c\u8bf4\u660e\u4e00\u5b9a\u6709\u529e\u6cd5\u8bbe\u7f6e <code>CFG[6:5]</code> \u4e3a\u4ee5\u4e0a\u4e09\u79cd\u53d6\u503c\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8981\u627e\u5230\u4e3b\u677f\u4e0a\u600e\u4e48\u8fde\u63a5 <code>CFG[6:5]</code>\u3002\u5728\u539f\u7406\u56fe\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230 LGA1150 \u7684 <code>U39 CPU_CFG5</code> \u548c <code>U40 V_CFG6</code>\uff0c\u7ee7\u7eed\u5f80\u4e0b\u627e\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u4eec\u901a\u8fc7\u7535\u963b\u8fde\u5230\u4e86\u540c\u4e00\u4e2a BAT54C \u82af\u7247\u4e0a\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u770b BAT54C \u7b2c\u4e09\u4e2a\u5f15\u811a N105955695 \u7684\u7535\u5e73\u3002N105955695 \u63a5\u5230\u4e86\u4e00\u4e2a 2N7002BKS \u82af\u7247\u4e0a\uff0c\u6839\u636e\u7535\u8def\u56fe\uff0c\u6700\u540e\u662f\u8981\u770b <code>X4_PRSNT1#</code> \u4fe1\u53f7\u3002</p> <p><code>X4_PRSTN1#</code> \u4fe1\u53f7\u8fde\u63a5\u5230\u4e86 PCIE6 \u4e0a\uff0c\u5982\u679c PCIE6 Slot \u63d2\u5165\u4e86\u8bbe\u5907\uff0c\u90a3\u4e48 <code>X4_PRSTN1#</code> \u4fe1\u53f7\u751f\u6548\uff0c\u6839\u636e\u5206\u6790\u51fa\u6765\u7684\u7535\u8def\uff0c\u5b83\u4f1a\u4f7f\u5f97 <code>CFG[6:0]</code> \u53d8\u4e3a 00\uff0c\u5bf9\u5e94 1x8+2x4 \u7684 Bifurcation \u6a21\u5f0f\u3002\u56de\u60f3\u4e00\u4e0b\uff0c\u5728\u4e3b\u677f\u652f\u6301\u7684\u4e09\u79cd PCIe Bifurcation \u6a21\u5f0f\u4e0b\uff0c\u53ea\u6709\u8fd9\u4e00\u79cd\u6d89\u53ca\u5230\u4e86 PCIE6 Slot\u3002\u6240\u4ee5\u5982\u679c\u7528\u6237\u5728 PCIE6 Slot \u63d2\u5165\u4e86\u8bbe\u5907\uff0c\u90a3\u8bf4\u660e\u7528\u6237\u9700\u8981\u7684\u662f 1x8+2x4 \u7684\u6a21\u5f0f\uff0c\u81ea\u52a8\u914d\u7f6e CPU \u7684 <code>CFG[6:5]</code> \u4fe1\u53f7\u4e3a\u9884\u671f\u503c\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u8bbe\u7f6e <code>CFG[6:5]</code> \u8fd8\u4e0d\u591f\uff0c\u4e0a\u9762\u63d0\u5230\u8fc7\uff0c\u4e3b\u677f\u9700\u8981\u8d1f\u8d23\u628a PCIE2/4/6 \u7684\u4fe1\u53f7\u8fde\u63a5\u5230\u539f\u6765\u7684\u5b8c\u6574\u7684 x16 \u4e0a\uff0c\u5e76\u4e14\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fde\u63a5\u4e0d\u540c\u7684\u7ebf\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u53ef\u4ee5\u5728\u539f\u7406\u56fe\u4e2d\u627e\u5230\uff1a\u4fe1\u53f7 <code>X4_PRSTN1#</code> \u8fde\u63a5\u5230\u4e86 CBTL04083BBS\uff0c\u8fd9\u662f\u4e00\u4e2a PCIe Mux/Demux \u82af\u7247\uff0c\u4e5f\u5c31\u662f\u628a\u540c\u6837\u4e00\u7ec4\u5dee\u5206\u7ebf\u8fde\u5230\u4e0d\u540c PCIe Slot \u4e0a\u6240\u9700\u8981\u7684\u82af\u7247\u3002</p> <p>\u4e8e\u662f\u76ee\u524d\u63a8\u65ad\u51fa\u4e86\u4e00\u90e8\u5206\u7684\u5de5\u4f5c\u539f\u7406\uff1a\u7528\u6237\u5728 PCIE6 Slot \u63d2\u5165\u8bbe\u5907\uff0c\u7535\u8def\u8ba1\u7b97\u51fa <code>CFG[6:5]=00</code>\uff0c\u540c\u65f6\u914d\u7f6e\u597d\u4e86 PCIe Mux/Demux \u82af\u7247\uff0c\u628a 1x16 \u5207\u5206\u4e3a 1x8+2x4\u3002</p> <p>\u7ee7\u7eed\u5f80\u4e0b\u770b\uff0c\u4e3b\u677f\u5982\u4f55\u5b9e\u73b0\u5269\u4e0b\u4e24\u79cd\u914d\u7f6e\uff1a<code>CFG[6:5]=10</code> \u5bf9\u5e94 2x8\uff0c<code>CFG[6:5]=11</code> \u5bf9\u5e94 1x16\u3002\u8fd9\u4e24\u79cd\u7f16\u7801\u91cc\uff0cCFG6 \u90fd\u4e3a 1\uff0c\u53ea\u9700\u8981\u8003\u8651\u5982\u4f55\u5904\u7406 CFG5\u3002CFG5 \u9664\u4e86\u8fde\u63a5\u4e0a\u9762\u63d0\u5230\u7684 BAT54C \u4ee5\u5916\uff0c\u8fd8\u901a\u8fc7\u53e6\u4e00\u4e2a 2N7002BKS \u82af\u7247\u8fde\u63a5\u5230\u4e86 <code>NB_X8_PRSENT#</code> \u4fe1\u53f7\u4e0a\u3002\u5982\u679c\u4f60\u60f3\u660e\u767d\u4e86\u524d\u9762\u7684\u8fc7\u7a0b\uff0c\u5e94\u8be5\u53ef\u4ee5\u63a8\u65ad\u51fa\u6765\uff0c\u8fd9\u91cc\u7684 <code>NB_X8_PRSENT#</code> \u8fde\u63a5\u5230\u4e86 PCIE4 Slot \u4e0a\u3002\u5f53 PCIE4 Slot \u63d2\u5165\u4e86\u8bbe\u5907\uff0c\u540c\u65f6 PCIE6 Slot \u6ca1\u6709\u63d2\u5165\u8bbe\u5907\uff0c\u90a3\u4e48\u6839\u636e\u76f8\u5e94\u7684 PRESENT \u4fe1\u53f7\uff0c\u53ef\u4ee5\u5f97\u5230 <code>CFG[6:5]=10</code>\u3002\u5982\u679c PCIE4 Slot \u548c PCIE6 Slot \u90fd\u6ca1\u6709\u63d2\u5165\u8bbe\u5907\uff0c\u90a3\u5c31 <code>CFG[6:5]=11</code>\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u52a8\u6001\u68c0\u6d4b\u5e76\u8ba1\u7b97\u51fa <code>CFG[6:5]</code> \u7684\u903b\u8f91\uff1a</p> <ol> <li>\u5982\u679c PCIE6 Slot \u63d2\u5165\u4e86\u8bbe\u5907\uff0c\u8bf4\u660e\u8981\u914d\u7f6e\u4e3a 1x8+2x4\uff0c\u8bbe\u7f6e <code>CFG[6:5]=00</code></li> <li>\u5426\u5219\uff0c\u5982\u679c PCIE4 Slot \u63d2\u5165\u4e86\u8bbe\u5907\uff0c\u8bf4\u660e\u8981\u914d\u7f6e\u4e3a 2x8\uff0c\u8bbe\u7f6e <code>CFG[6:5]=10</code></li> <li>\u5426\u5219\uff0c\u8bf4\u660e\u8981\u914d\u7f6e\u4e3a 1x16\uff0c\u8bbe\u7f6e <code>CFG[6:5]=11</code></li> </ol> <p>\u800c\u4e3b\u677f\u8bbe\u8ba1\u8005\u5c31\u662f\u8981\u628a\u8fd9\u4e2a\u903b\u8f91\u8f6c\u5316\u4e3a\u7535\u8def\uff0c\u7528 BAT54C \u548c CBTL04083BBS \u82af\u7247\u6765\u5b9e\u73b0\u903b\u8f91\u8fd0\u7b97\u3002</p> <p>\u987a\u4fbf\u4e00\u63d0\uff0c\u8fd9\u91cc\u7684 PCIE2/4/6 \u7269\u7406\u5c3a\u5bf8\u90fd\u662f x16\uff0c\u53ea\u4e0d\u8fc7\u5b9e\u9645\u5206\u914d\u5230\u7684\u5bbd\u5ea6\u4e0d\u4e00\u5b9a\u4e0e\u7269\u7406\u5c3a\u5bf8\u4e00\u81f4\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#\u670d\u52a1\u5668\u5e73\u53f0","title":"\u670d\u52a1\u5668\u5e73\u53f0","text":"<p>\u5728\u670d\u52a1\u5668\u5e73\u53f0\u4e0a\uff0cIntel CPU \u7684 Bifurcation \u53d8\u6210\u8fd0\u884c\u65f6\u53ef\u914d\u7f6e\u7684\uff0c\u4f8b\u5982\u5728 Xeon E5 v4 Datasheet Volume 2 \u4e2d\uff0c\u53ef\u4ee5\u627e\u5230\u5bc4\u5b58\u5668 <code>pcie_iou_bif_ctrl</code> \u5bc4\u5b58\u5668\u7684\u5b9a\u4e49\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u5bc4\u5b58\u5668\u5728 PCIe \u914d\u7f6e\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>setpci</code> \u547d\u4ee4\u6765\u8bfb\u53d6\u6216\u5199\u5165\uff1a</p> <pre><code>$ setpci -s 00:00.0 190.B\n00\n$ setpci -s 00:01.0 190.B\n01 # x8\n$ setpci -s 00:02.0 190.B\n04 # x16\n$ setpci -s 00:03.0 190.B\n03 # x8x8\n$ setpci -s 80:02.0 190.B\n04 # x16\n</code></pre> <p>\u901a\u8fc7 <code>lspci -bPP</code> \u547d\u4ee4\u4ee5\u53ca <code>lspci -vvv</code>\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u8fd9\u51e0\u4e2a PCIe Root Port \u4e0b\u7684\u8bbe\u5907\u4ee5\u53ca\u901f\u5ea6\uff1a</p> <ul> <li>00:01.0(x8)/02:00.0 RAID \u63a7\u5236\u5668 PCIe 3.0 x8</li> <li>00:02.0(x16)/03:00.0 NVIDIA \u663e\u5361 PCIe 3.0 x16</li> <li>00:03.0(x8x8)/01:00.0 BCM 2x10G+2x1G \u7f51\u5361 PCIe 2.0 x8</li> <li>80:02.0(x16)/82:00.0 NVIDIA \u663e\u5361 PCIe 3.0 x16</li> </ul> <p>\u5176\u4e2d\u524d\u4e09\u4e2a\u8bbe\u5907\u8fde\u63a5\u5230 CPU1\uff0c\u540e\u4e09\u4e2a\u8bbe\u5907\u8fde\u63a5\u5230 CPU2</p> <p>\u5728 BIOS \u8bbe\u7f6e\u4e2d\uff0c\u8fdb\u5165 Integrated Devices -&gt; Slot Bifurcation \u53ef\u4ee5\u770b\u5230\u8bbe\u7f6e\uff0c\u53ef\u9009\u9879\u6709\uff1a</p> <ul> <li>Slot 1/2/3/5: Default Bifurcation, x4+x4 Bifurcation</li> <li>Slot 4/6: Default Bifurcation, x4+x4+x4+x4 Bifurcation, x8+x8 Bifurcation</li> </ul> <p>\u9605\u8bfb R730 \u6587\u6863\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u6700\u591a\u53ef\u4ee5\u6709 7 \u4e2a Slot\uff0c\u5176\u4e2d Slot 1/2/3/5/7 \u662f PCIe 3.0x8\uff0cSlot 4 \u662f PCIe 3.0 x16\uff0cSlot 6 \u6839\u636e\u4e0d\u540c\u7684 Riser \u53ef\u4ee5\u63d0\u4f9b PCIe 3.0 x8 \u6216 x16\uff0c\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p> <ul> <li>PCIe Slot 1: x8, CPU2</li> <li>PCIe Slot 2: x8, CPU2</li> <li>PCIe Slot 3: x8, CPU2</li> <li>PCIe Slot 4: x16, CPU2</li> <li>PCIe Slot 5: x8, CPU1</li> <li>PCIe Slot 6: x8/x16, CPU1</li> <li>PCIe Slot 7: x8, CPU1</li> </ul> <p>\u9605\u8bfb E5 v4 CPU \u6587\u6863\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u6709\u4e09\u4e2a PCIe Port\uff0c\u4e00\u5171\u6709 40 PCIe lanes\uff08x8+x16+x16\uff09\u3002\u7531\u6b64\u53ef\u77e5\uff0c\u5176\u4e2d\u4e00\u4e2a x16 \u8fde\u63a5\u5230 Slot4/6 \u4e0a\uff0c\u53e6\u4e00\u4e2a x16 \u62c6\u5206\u6210 x8+x8\uff0c\u8fde\u63a5\u5230\u5176\u4f59\u7684 Slot\u3002\u6709\u4e9b\u5947\u602a\u7684\u662f CPU1 \u5c11\u4e86\u4e00\u4e2a x8 \u4e0d\u77e5\u53bb\u5411\uff0c\u6000\u7591\u662f\u8fde\u63a5\u5230\u4e86 RAID \u5361\u6216\u8005\u7f51\u5361\u4e0a\u3002\u7f3a\u5c11\u4e3b\u677f\u7684\u539f\u7406\u56fe\uff0c\u65e0\u6cd5\u7ee7\u7eed\u6df1\u5165\u7814\u7a76\u3002</p> <p>\u9057\u61be\u7684\u662f\uff0c\u8fd9\u4e2a\u5bc4\u5b58\u5668\u7684 <code>iou_start_bifurcation</code> \u5b57\u6bb5\u53ea\u80fd\u5199\u5165\u4e00\u6b21 1 \u6765\u521d\u59cb\u5316 Bifurcation\uff0c\u800c\u8fd9\u4e00\u822c\u662f\u7531 BIOS \u5b8c\u6210\u7684\u3002\u5982\u679c BIOS \u6ca1\u6709\u505a\uff0c\u6216\u8bb8\u53ef\u4ee5\u540e\u9762\u518d\u5199\u5165\u4e00\u6b21\uff1b\u5982\u679c BIOS \u5df2\u7ecf\u5199\u5165\u4e86\uff0c\u4f46\u662f\u6ca1\u6709\u63d0\u4f9b\u53ef\u9009\u9879\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u9006\u5411 BIOS\uff0c\u4f7f\u7528 UEFITool \u67e5\u770b\u662f\u5426\u6709\u9690\u85cf\u7684\u914d\u7f6e\uff0c\u5982\u679c\u6709\uff0c\u5219\u53ef\u4ee5\u5c1d\u8bd5\u7ed5\u8fc7 BIOS \u8bbe\u7f6e\u53bb\u4fee\u6539\u9690\u85cf\u7684\u914d\u7f6e\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u53ef\u4ee5\u8003\u8651\u4fee\u6539 BIOS \u7684\u6307\u4ee4\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2023/01/05/pcie-bifurcation/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0cPCIe Bifurcation \u7684\u76ee\u7684\u662f\u4fdd\u8bc1\u603b lane \u6570\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u8fde\u63a5\u66f4\u591a\u8bbe\u5907\u7684\u8f83\u4f4e\u6210\u672c\u7684\u65b9\u6cd5\u3002\u5b83\u9700\u8981 CPU \u4e00\u4fa7\u548c\u8bbe\u5907\u4e00\u4fa7\u7684\u652f\u6301\u3002\u684c\u9762\u7ea7\u522b\u7684 CPU \u901a\u8fc7 CFG \u4fe1\u53f7\u6765\u914d\u7f6e\uff0c\u670d\u52a1\u5668\u7aef\u7684 CPU \u901a\u8fc7 PCIe \u914d\u7f6e\u7a7a\u95f4\u6765\u914d\u7f6e\u3002\u8bbe\u5907\u4e00\u4fa7\uff0c\u53ef\u4ee5\u7531\u4e3b\u677f\u8fdb\u884c\u62c6\u5206\uff0c\u6b64\u65f6\u4e3b\u677f\u4e0a\u4f1a\u6709\u591a\u4f59\u7684 PCIe \u63a5\u53e3\uff0c\u6839\u636e\u63d2\u5728\u4e3b\u677f\u4e0a\u7684\u8bbe\u5907\u7684\u60c5\u51b5\uff0c\u4e3b\u677f\u81ea\u9002\u5e94\u51fa\u4e00\u4e2a PCIe Bifurcation \u914d\u7f6e\uff1b\u4e3b\u677f\u4e5f\u53ef\u4ee5\u4ec0\u4e48\u90fd\u4e0d\u505a\uff0c\u76f4\u63a5\u628a CPU \u7684 PCIe \u63a5\u5230 Slot \u4e0a\uff0c\u6b64\u65f6\u9700\u8981\u7528\u6237\u81ea\u5df1\u8d2d\u4e70 PCIe \u62c6\u5206\u5361\u3002\u6dd8\u5b9d\u4e0a\u53ef\u4ee5\u641c\u5230\u4e0d\u5c11 PCIe \u62c6\u5206\u5361\uff0c\u5176\u4e2d\u7528\u4e8e NVMe \u7684\u8f83\u591a\uff0c\u6bd5\u7adf M.2 \u63a5\u53e3\u9762\u79ef\u5c0f\uff0c\u800c\u4e14\u53ea\u9700\u8981 PCIe x4\u3002</p> <p>\u53e6\u4e00\u79cd\u65b9\u6848\u662f PCIe \u4ea4\u6362\u673a\uff08\u5982 PEX 8747\uff09\uff0c\u7f3a\u70b9\u662f\u6210\u672c\u8f83\u9ad8\uff0c\u589e\u52a0\u4e86\u5ef6\u8fdf\uff0c\u597d\u5904\u662f\u7075\u6d3b\u6027\u5f88\u5f3a\uff0c\u4e0d\u9700\u8981 CPU \u989d\u5916\u914d\u7f6e\uff0c\u53ef\u4ee5\u5916\u63a5\u66f4\u591a\u8bbe\u5907\uff0c\u5e76\u4e14\u8bbe\u5907\u7a7a\u95f2\u65f6\u53ef\u4ee5\u8ba9\u51fa\u5e26\u5bbd\u3002\u4f8b\u5982\u4e00\u4e2a x16 \u4f7f\u7528 Bifurcation \u65b9\u6cd5\u53ef\u4ee5\u62c6\u6210\u4e24\u4e2a x8\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 PCIe \u4ea4\u6362\u673a\u8fde\u63a5\u4e24\u4e2a x16\uff0c\u7c7b\u4f3c\u7f51\u7edc\uff0c\u8fd9\u4e24\u4e2a x16 \u5171\u4eab\u5e26\u5bbd\uff0c\u4e0b\u6e38\u7684\u4e24\u4e2a\u8bbe\u5907\u4e4b\u95f4\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u4fe1\uff0c\u8fd9\u4e2a\u5728 HPC \u573a\u666f\u4e0b\u4f1a\u6bd4\u8f83\u5e38\u89c1\uff0c\u4f8b\u5982\u4f7f\u7528 PCIe \u4ea4\u6362\u673a\u8fde\u63a5\u663e\u5361\u548c IB \u7f51\u5361\u3002</p>","tags":["pcie","bus","bifurcation"]},{"location":"hardware/2022/11/12/pcie-notes/","title":"PCIe \u5b66\u4e60\u7b14\u8bb0","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u77e5\u4e4e\u4e0a\u770b\u5230 LogicJitterGibbs \u7684 \u8d44\u6599\u6574\u7406\uff1a\u53ef\u4ee5\u5b66\u4e60 1W \u5c0f\u65f6\u7684 PCIe\uff0c\u6211\u8ddf\u7740\u8d44\u6599\u5b66\u4e60\u4e86\u4e00\u4e0b\uff0c\u7136\u540e\u5728\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e9b\u6211\u5b66\u4e60 PCIe \u7684\u7b14\u8bb0\u3002</p> <p>\u4e0b\u9762\u7684\u56fe\u7247\u4e3b\u8981\u6765\u81ea PCIe 3.0 \u6807\u51c6\u4ee5\u53ca MindShare \u7684 PCIe 3.0 \u4e66\u672c\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u5206\u5c42","title":"\u5206\u5c42","text":"<p>PCIe \u5b9a\u4e49\u4e86\u4e09\u4e2a\u5c42\uff1aTransaction Layer\uff0cData Link Layer\uff0cPhysical Layer\uff0c\u548c TCP/IP \u56db\u5c42\u6a21\u578b\u5f88\u50cf\u3002PCIe \u4e5f\u662f\u57fa\u4e8e Packet \u4f20\u8f93\u7684\u3002</p> <p></p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#transaction-layer","title":"Transaction Layer","text":"<p>Transaction Layer \u7684\u6838\u5fc3\u662f Transaction Layer Packet(TLP)\u3002TLP \u683c\u5f0f\uff1a</p> <p></p> <p>\u5373\u53ef\u9009\u7684\u82e5\u5e72\u4e2a Prefix\uff0c\u4e00\u4e2a Header\uff0c\u53ef\u9009\u7684 Data Payload\uff0c\u53ef\u9009\u7684 Digest\u3002</p> <p>Prefix \u548c Header \u5f00\u5934\u7684\u4e00\u4e2a\u5b57\u8282\u662f <code>Fmt[2:0]</code> \u548c <code>Type[4:0]</code> \u5b57\u6bb5\u3002Fmt \u51b3\u5b9a\u4e86 header \u7684\u957f\u5ea6\uff0c\u6709\u65e0\u6570\u636e\uff0c\u6216\u8005\u8fd9\u662f\u4e00\u4e2a Prefix\u3002</p> <p>\u5b83\u652f\u6301\u51e0\u7c7b Packet\uff1a</p> <ul> <li>Memory: MMIO<ul> <li>Read Request(MRd)/Completion(CplD)</li> <li>Write Request(MWr): \u6ce8\u610f\u53ea\u6709 Request\uff0c\u6ca1\u6709 Completion</li> <li>AtomicOp Request(FetchAdd/Swap/CAS)/Completion(CplD)</li> <li>Locked Memory Read(MRdLk)/Completion(CplDLk): Legacy</li> </ul> </li> <li>IO: Legacy<ul> <li>Read Request(IORd)/Completion(CplD)</li> <li>Write Request(IOWr)/Completion(Cpl)</li> </ul> </li> <li>Configuration: \u8bbf\u95ee\u914d\u7f6e\u7a7a\u95f4<ul> <li>Read Request(CfgRd0/CfgRd1)/Completion(CplD)</li> <li>Write Request(CfgWr0/CfgWr1)/Completion(Cpl)</li> </ul> </li> <li>Message: \u4f20\u8f93 event<ul> <li>Request(Msg/MsgD)</li> </ul> </li> </ul> <p>\u62ec\u53f7\u91cc\u7684\u662f TLP Type\uff0c\u5bf9\u5e94\u4e86\u5b83 Fmt \u548c Type \u5b57\u6bb5\u7684\u53d6\u503c\u3002\u5982\u679c Completion \u5931\u8d25\u4e86\uff0c\u539f\u6765\u5e94\u8be5\u662f CplD/CplDLk \u7684 Completion \u4f1a\u53d8\u6210\u4e0d\u5e26\u6570\u636e\u7684 Cpl/CplLk\u3002</p> <p>\u5728 PCIe 3.0 \u6807\u51c6\u7684\u8868 2-3 \u4e2d\u5217\u51fa\u4e86 TLP Type \u4ee5\u53ca\u5bf9\u5e94\u7684 Fmt \u548c Type \u7f16\u7801\u3002</p> <p>TLP \u8def\u7531\u6709\u4e09\u4e2a\u65b9\u6cd5\uff0c\u51b3\u5b9a\u4e86\u8fd9\u4e2a TLP \u76ee\u7684\u5730\u662f\u54ea\u91cc\uff1a</p> <ul> <li>Address-based: 32 \u4f4d\u6216 64 \u4f4d\u5730\u5740\uff0c\u7528\u4e8e Memory \u548c IO \u8bf7\u6c42</li> <li>ID-based\uff1alspci \u770b\u5230\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f Bus Device Function\uff0c\u7528\u4e8e Configuration \u8bf7\u6c42</li> <li>Implicit\uff1a\u7528\u4e8e Message \u8bf7\u6c42\uff0c\u8def\u7531\u65b9\u6cd5\uff1a<ul> <li>Routed to Root Complex</li> <li>Routed by Address: PCIe 3.0 \u6807\u51c6\u4e2d\u6ca1\u6709\u7528\u8fd9\u4e2a\u8def\u7531\u65b9\u6cd5\u7684 Message</li> <li>Routed by ID</li> <li>Broadcast from Root Complex</li> <li>Local - Terminate at Receiver</li> <li>Gathered and router to Root Complex</li> </ul> </li> </ul>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#data-link-layer","title":"Data Link Layer","text":"<p>Data Link Layer \u7684\u4e3b\u8981\u529f\u80fd\u662f\u8fdb\u884c TLP \u7684\u53ef\u9760\u4f20\u8f93\u3002\u5b83\u5728\u4f20\u8f93 TLP \u7684\u65f6\u5019\uff0c\u4f1a\u5728\u5f00\u5934\u52a0\u4e0a\u4e00\u4e2a\u4e24\u5b57\u8282\u7684 Sequence Number\uff0c\u6700\u540e\u52a0\u4e0a\u4e00\u4e2a\u56db\u5b57\u8282\u7684 LCRC\uff08Link CRC\uff09\u3002</p> <p></p> <p>\u9664\u4e86\u4f20\u8f93 TLP\uff0cData Link Layer \u8fd8\u4f1a\u4f20\u8f93 Data Link Layer Packet(DLLP)\uff0c\u7c7b\u578b\u5305\u62ec\uff1a</p> <ul> <li>Ack DLLP: \u544a\u8bc9\u5bf9\u65b9\u81ea\u5df1\u5df2\u7ecf\u6210\u529f\u6536\u5230\u4e86 TLP</li> <li>Nak DLLP\uff1a\u544a\u8bc9\u5bf9\u65b9\u81ea\u5df1\u63a5\u6536 TLP \u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5</li> <li>InitFC1/InitFC2/UpdateFC DLLPs\uff1a\u6d41\u91cf\u63a7\u5236</li> <li>PM_Enter_L1/PM_Enter_L23/PM_Active_State_Request_L1/PM_Request_Ack\uff1a\u7528\u4e8e\u7535\u6e90\u7ba1\u7406</li> </ul> <p>Data Link Layer \u6536\u5230\u4e0a\u5c42\u8981\u53d1\u9001 TLP \u65f6\u5019\uff0c\u9996\u5148\u62fc\u63a5 Sequence Number \u548c LCRC\uff0c\u7136\u540e\u4f1a\u4fdd\u5b58\u5728 retry buffer \u4e2d\uff0c\u901a\u8fc7 Physical Layer \u53d1\u9001\u3002\u4ece Physical Layer \u6536\u5230\u65b0\u7684 TLP/DLLP \u65f6\uff0c\u4f1a\u68c0\u67e5\u5b83\u7684\u5b8c\u6574\u6027\uff08CRC\uff09\uff0c\u5982\u679c\u6b63\u786e\uff0c\u5c31\u5411\u53d1\u9001\u65b9\u53d1\u9001\u4e00\u4e2a Ack DLLP\uff0c\u5e76\u628a TLP \u63d0\u4ea4\u7ed9 Transaction Layer\uff1b\u5982\u679c\u4e0d\u6b63\u786e\uff0c\u5c31\u5411\u53d1\u9001\u65b9\u53d1\u9001\u4e00\u4e2a Nak DLLP\u3002\u5982\u679c\u6536\u5230\u4e86 Ack DLLP\uff0c\u5c31\u53ef\u4ee5\u628a\u76f8\u5e94\u7684 TLP \u4ece retry buffer \u4e2d\u5220\u6389\uff1b\u5982\u679c\u6536\u5230\u4e86 Nak DLLP\uff0c\u5219\u8981\u91cd\u4f20\u3002\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86 TLP \u7684\u53ef\u9760\u4f20\u8f93\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cTLP \u548c DLLP \u7684\u533a\u522b\uff1aTLP \u5c31\u50cf IP\uff0c\u76ee\u7684\u5730\u5740\u53ef\u80fd\u4f1a\u8de8\u8d8a\u591a\u8df3\uff1b\u800c DLLP \u662f\u70b9\u5bf9\u70b9\u5730\u5de5\u4f5c\uff0c\u6240\u4ee5\u4e00\u4e2a TLP \u5728\u8f6c\u53d1\u7684\u6bcf\u4e00\u8df3\u4e2d\uff0c\u63a5\u53d7\u65b9\u90fd\u4f1a\u53d1\u9001\u4e00\u6b21 Ack DLLP\u3002</p> <p>Data Link Layer \u7684\u6d41\u91cf\u662f Credit-based \u7684\uff1a\u63a5\u53d7\u65b9\u4f1a\u544a\u8bc9\u53d1\u9001\u65b9\u81ea\u5df1\u7684 Buffer \u8fd8\u6709\u591a\u5c11\u7a7a\u95f4\uff08Credit\uff09\uff0c\u7136\u540e\u53d1\u9001\u65b9\u6839\u636e Credit \u6765\u63a7\u5236\u662f\u5426\u7ee7\u7eed\u53d1\u9001 TLP\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u63a5\u89e6 PCIe \u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u6709\u4e00\u4e2a\u7591\u60d1\uff0c\u5c31\u662f\u8fd9\u4e9b Bus Device Function \u90fd\u662f\u600e\u4e48\u5206\u914d\u7684\uff0c\u5206\u914d\u5b8c\u4e4b\u540e\uff0c\u8bbf\u95ee\u8bf7\u6c42\u53c8\u662f\u600e\u4e48\u8def\u7531\u7684\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u8def\u7531","title":"\u8def\u7531","text":"<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff0c\u4e0a\u9762\u63d0\u5230\u4e86 TLP \u7684 Memory \u548c IO \u662f\u6839\u636e\u5730\u5740\u8def\u7531\uff0cConfiguration \u662f\u6839\u636e Bus Device Function \u8def\u7531\uff0c\u800c PCIe \u5927\u6982\u662f\u4e00\u4e2a\u6811\u5f62\u7684\u7ed3\u6784\uff0c\u53f6\u5b50\u7ed3\u70b9\u5c31\u662f PCIe \u8bbe\u5907\uff0c\u975e\u53f6\u5b50\u7ed3\u70b9\u662f\u6865\u6216\u8005\u4ea4\u6362\u673a\u3002\u56de\u60f3\u4e00\u4e0b\uff0cIP \u7684\u8def\u7531\u662f\u6309\u7167\u6700\u957f\u524d\u7f00\u5339\u914d\uff0c\u5982\u679c\u5728 PCIe \u4e2d\u8fd8\u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u53c8\u592a\u8fc7\u4e8e\u590d\u6742\u4e86\uff0c\u6bd5\u7adf PCIe \u53ef\u4ee5\u4eba\u4e3a\u5730\u8bbe\u5b9a\u6bcf\u4e2a\u8bbe\u5907\u7684\u5730\u5740\uff0c\u8ba9\u5730\u5740\u6ee1\u8db3\u4e00\u5b9a\u7684\u8fde\u7eed\u6027\u548c\u5c40\u90e8\u6027\uff0c\u8fd9\u6837\u8def\u7531\u9009\u62e9\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002</p> <p>\u89c2\u5bdf PCIe \u6807\u51c6\u4e2d 7.3.3 Configuration Request Routing Rules\uff0c\u7ed3\u5408 MindShare \u7684\u4e66\uff0c\u770b Root Ports\uff0cSwitches \u548c Bridges \u7684\u8981\u6c42\uff0c\u5c31\u77e5\u9053 Configuration \u8bf7\u6c42\u662f\u5982\u4f55\u8def\u7531\u7684\uff1a</p> <ul> <li>Configuration \u8bf7\u6c42\u53ea\u80fd\u7531 Host Bridge \u53d1\u8d77</li> <li>\u5982\u679c Configuration \u8bf7\u6c42\u662f Type0\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8bf7\u6c42\u7684\u76ee\u7684\u8bbe\u5907\u5c31\u662f\u5f53\u524d\u8bbe\u5907</li> <li>\u5982\u679c Configuration \u8bf7\u6c42\u662f Type1\uff0c<ul> <li>\u5982\u679c\u8bf7\u6c42\u7684 Bus Number \u7b49\u4e8e\u67d0\u4e00\u4e2a Downstream Port \u7684 Secondary Bus Number\uff0c\u5219\u628a Configuration \u8bf7\u6c42\u8f6c\u6362\u4e3a Type0\uff0c\u7136\u540e\u53d1\u7ed9\u8be5 Downstream Port</li> <li>\u5982\u679c\u4e0d\u7b49\u4e8e\uff0c\u4f46\u662f Bus Number \u5c5e\u4e8e\u67d0\u4e00\u4e2a Downstream Port \u7684 Secondary Bus Number \u548c Subordinate Bus Number \u4e4b\u95f4\uff0c\u5219\u4e0d\u4fee\u6539 Configuration \u8bf7\u6c42\uff0c\u53d1\u9001\u7ed9\u8be5 Downstream Port\u3002</li> </ul> </li> </ul> <p>\u5982\u679c\u7c7b\u6bd4\u4e00\u4e0b IP\uff0c\u90a3\u4e48\u5206\u7ec4\u5728\u4e2d\u9014\u8def\u7531\u5668\u8f6c\u53d1\u7684\u65f6\u5019\u5c31\u662f Type1\uff0cType0 \u5c31\u662f\u6700\u540e\u4e00\u8df3\u3002\u8def\u7531\u5c31\u662f\u76f4\u63a5\u6309\u7167\u51e0\u4e2a\u4e0d\u91cd\u5408\u7684 Bus Number \u533a\u95f4\u8fdb\u884c\u5224\u65ad\uff0c\u6ca1\u6709\u590d\u6742\u7684\u6700\u957f\u524d\u7f00\u5339\u914d\u3002\u4f46\u662f\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u6309\u7167 Bus \u8def\u7531\uff0c\u90a3\u540c\u4e00\u4e2a Bus \u4e0b\u4e0d\u540c\u7684 Device \u548b\u529e\uff1f\u8fd9\u5c31\u50cf\u662f\u4ee5\u592a\u7f51\uff0c\u6700\u540e\u4e00\u8df3\u7684\u65f6\u5019\uff0c\u5982\u679c\u540c\u4e00\u4e2a\u94fe\u8def\u4e0a\u6709\u591a\u4e2a\u8bbe\u5907\uff0c\u90a3\u4e48\u591a\u4e2a\u8bbe\u5907\u90fd\u80fd\u6536\u5230\uff0c\u6bcf\u4e2a\u8bbe\u5907\u6839\u636e\u81ea\u5df1\u7684 Device \u53f7\u5224\u65ad\u662f\u5426\u662f\u53d1\u7ed9\u81ea\u5df1\u7684\u3002PCI\uff08\u6ce8\u610f\u4e0d\u662f PCIe\uff09\u603b\u7ebf\u4e5f\u7c7b\u4f3c\u3002\u968f\u7740\u901f\u5ea6\u8d8a\u6765\u8d8a\u9ad8\uff0c\u901a\u8fc7\u4ea4\u6362\u673a\uff0c\u4ee5\u592a\u7f51\u5df2\u7ecf\u53d8\u6210\u4e86\u70b9\u5bf9\u70b9\uff0c\u6240\u4ee5\u5f88\u5c11\u89c1\u5230\u4e00\u4e2a\u94fe\u8def\u4e0a\u540c\u65f6\u6709\u591a\u4e2a\u8bbe\u5907\u7684\u60c5\u51b5\u4e86\u3002PCIe \u4e5f\u4e00\u6837\uff0c\u6240\u4ee5\u6839\u636e Bus \u8def\u7531\u5c31\u8db3\u591f\u4e86\u3002\u81f3\u4e8e lspci \u770b\u5230\u7684\u90a3\u4e9b Device \u4e0d\u7b49\u4e8e 0 \u7684\u8bbe\u5907\uff0c\u8981\u4e48\u662f\u517c\u5bb9 PCI \u8bbe\u5907\u7684\uff0c\u8981\u4e48\u662f\u865a\u62df\u7684\uff0c\u5728\u8bbe\u5907\u5185\u90e8\u8fdb\u884c\u8def\u7531\u7684\uff0c\u5e76\u4e0d\u662f\u771f\u7684\u6709\u4e00\u4e2a PCIe link \u8fde\u4e86\u591a\u4e2a\u7269\u7406\u8bbe\u5907\u3002</p> <p>\u6240\u4ee5\u7b80\u5355\u7406\u89e3\u4e00\u4e0b\uff0cPCI \u603b\u7ebf\u786e\u5b9e\u662f\u4e00\u6761\u603b\u7ebf\uff0c\u4e00\u6761\u603b\u7ebf\u4e0a\u5f88\u591a\u8bbe\u5907\u3002\u800c PCIe \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u7f51\u7edc\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u5f88\u591a\u4e2a PCI \u603b\u7ebf\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u628a Root Complex \u6216\u8005 Switch \u5185\u90e8\u770b\u6210\u4e00\u4e2a\u865a\u62df\u7684\u6709\u5f88\u591a\u8bbe\u5907\u7684 PCI \u603b\u7ebf\uff0c\u800c PCIe Link \u53ef\u4ee5\u770b\u6210\u662f\u53ea\u6709\u4e00\u4e2a\u8bbe\u5907\u7684 PCI \u603b\u7ebf\u3002\u8fd9\u6837 PCIe \u4ea4\u6362\u673a\u53ef\u4ee5\u770b\u6210\u82e5\u5e72\u4e2a PCI-PCI Bridge\uff1a</p> <p></p> <p>\u8fd8\u6709 MindShare \u4e66\u4e2d\u7684\u56fe 3-5:</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u6bcf\u4e00\u4e2a Bus \u5c31\u662f\u4e00\u4e2a PCI \u603b\u7ebf\uff0c\u65e2\u6709\u5185\u90e8\u7684\u865a\u62df PCI \u603b\u7ebf\uff08Bus 0/2/6\uff09\uff0c\u4e5f\u6709 PCIe Link \u5145\u5f53\u7684 PCI \u603b\u7ebf\uff08Bus 1/3/4/5/7/8/9\uff09\u3002\u5728\u865a\u62df\u7684 PCI \u603b\u7ebf\u91cc\uff0c\u6bd4\u5982 PCIe Switch\uff0c\u4e00\u4e2a Device \u5bf9\u5e94\u4e00\u4e2a Downstream Port\uff1b\u800c PCIe Link \u5bf9\u5e94\u7684 PCI \u603b\u7ebf\u4e0a\u5c31\u53ea\u6709\u4e00\u4e2a Device\u3002\u7136\u540e PCIe Switch \u7684\u6bcf\u4e2a Upstream Port \u548c Downstream Port \u91cc\u4f1a\u8bb0\u5f55\u4e09\u4e2a Bus Number\uff1aPrimary(Pri)\uff0cSecondary(Sec) \u548c Subordinate(Sub)\u3002Primary \u6307\u7684\u5c31\u662f\u5b83\u4e0a\u6e38\u76f4\u63a5\u8fde\u63a5\u7684 PCI \u603b\u7ebf\u7f16\u53f7\uff0cSec \u6307\u7684\u662f\u4e0b\u6e38\u76f4\u63a5\u8fde\u63a5\u7684 PCI \u603b\u7ebf\u7f16\u53f7\uff0cSub \u6307\u7684\u662f\u5b83\u4e0b\u6e38\u7684\u6700\u5927 PCI \u603b\u7ebf\u7f16\u53f7\u3002</p> <p>\u8fd9\u6837\uff0c\u6536\u5230 Type1 \u7684\u65f6\u5019\uff0cSwitch \u6309\u7167\u5404\u4e2a Downstream Port \u7684 Sec \u548c Sub \u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u76ee\u6807 Bus Number \u7b49\u4e8e Sec\uff0c\u5c31\u8f6c\u6362\u4e3a Type0 \u53d1\u51fa\u53bb\uff1b\u5982\u679c\u5927\u4e8e Sec\uff0c\u4f46\u662f\u5c0f\u4e8e\u6216\u7b49\u4e8e Sub\uff0c\u5c31\u539f\u6837\u53d1\u51fa\u53bb\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u4ece Host Bridge \u5230\u6bcf\u4e2a\u8bbe\u5907\u90fd\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u4e00\u8def\u8f6c\u53d1\u3002</p> <p>\u65e2\u7136 BDF \u662f\u628a Bus \u5212\u5206\u4e3a\u591a\u4e2a\u533a\u95f4\u6765\u8def\u7531\u7684\uff0c\u90a3\u4e48 Memory \u548c IO \u8bf7\u6c42\u4e5f\u7c7b\u4f3c\u5730\u53ef\u4ee5\u5bf9\u5730\u5740\u8fdb\u884c\u5212\u5206\uff0c\u53d8\u6210\u591a\u4e2a\u533a\u95f4\uff0c\u7136\u540e\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u8fdb\u884c\u8def\u7531\u3002</p> <p>\u8fd9\u4e9b\u7528\u4e8e\u8def\u7531\u7684\u533a\u95f4\u4e0a\u4e0b\u754c\uff0c\u53ef\u4ee5\u5728\u5404\u4e2a\u7aef\u53e3\u7684 Type1 Configuration Space \u4e2d\u627e\u5230\uff1a</p> <p></p> <ul> <li>\u8def\u7531 Type1 Configuration Request\uff1aPrimary Bus Number, Secondary Bus Number, Subordinate Bus Number<ul> <li><code>Request Bus Number == Secondary Bus Number</code>: Type1 -&gt; Type0</li> <li><code>Secondary Bus Number &lt; Request Bus Number &lt;= Subordinate Bus Number</code>: Type1 -&gt; Type1</li> </ul> </li> <li>\u8def\u7531 IO Request\uff1a<code>I/O Base &lt;= IO Address &lt;= I/O Limit</code></li> <li>\u8def\u7531 Prefetchable Memory Request\uff1a<code>Prefetchable Memory Base &lt;= Memory Address &lt;= Prefetchable Memory Limit</code></li> <li>\u8def\u7531 Non-Prefetchable Memory Request\uff1a<code>Memory Base &lt;= Memory Address &lt;= Memory Limit</code></li> </ul> <p>\u800c\u5177\u4f53\u5230\u6bcf\u4e00\u4e2a\u8bbe\u5907\u4e0a\uff0c\u8bbe\u5907\u4f1a\u63d0\u4f9b\u82e5\u5e72\u4e2a BAR\uff08Base Address Register\uff09\uff0c\u5728\u679a\u4e3e\u8bbe\u5907\u7684\u65f6\u5019\uff0c\u4f1a\u7ed9 BAR \u5206\u914d\u5730\u5740\uff0c\u7136\u540e\u628a\u8bbe\u5907\u7684\u5730\u5740\u8fdb\u884c\u5408\u5e76\uff0c\u8bb0\u5f55\u5230 Switch \u4e0a\u7684 Base \u548c Limit\uff0c\u7136\u540e\u4e00\u76f4\u9012\u5f52\uff0c\u4e00\u8def\u66f4\u65b0\u5230 Root Complex\u3002\u8fd9\u6837\uff0c\u5c31\u5b8c\u6210\u4e86\u5730\u5740\u5206\u914d\uff0c\u4ee5\u53ca\u8bf7\u6c42\u7684\u8def\u7531\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u5206\u914d","title":"\u5206\u914d","text":"<p>\u65e2\u7136\u77e5\u9053\u4e86 BDF \u662f\u5982\u4f55\u8def\u7531\u7684\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662f\uff0c\u600e\u4e48\u679a\u4e3e\u8bbe\u5907\u548c\u4ea4\u6362\u673a\uff0c\u5206\u914d Bus Number\u3002\u8fd9\u4e2a\u4e8b\u60c5\u5728\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u505a\uff08\u4f8b\u5982 UEFI\uff09\uff0cLinux \u4e2d\u4e5f\u6709\u76f8\u5173\u7684\u4ee3\u7801\u3002\u4e0b\u9762\u5c31\u6765\u5bf9\u7740 edk2 \u7684\u6e90\u4ee3\u7801\u6765\u770b\u770b\u5b83\u662f\u600e\u4e48\u505a\u7684\u3002</p> <p>\u5728 edk2 \u4e2d\uff0c\u5206\u914d Bus Number \u7684\u6838\u5fc3\u4ee3\u7801\u662f <code>PciScanBus</code> \u51fd\u6570\uff1a</p> <pre><code>/**\n  Scan pci bus and assign bus number to the given PCI bus system.\n\n  @param  Bridge           Bridge device instance.\n  @param  StartBusNumber   start point.\n  @param  SubBusNumber     Point to sub bus number.\n  @param  PaddedBusRange   Customized bus number.\n\n  @retval EFI_SUCCESS      Successfully scanned and assigned bus number.\n  @retval other            Some error occurred when scanning pci bus.\n\n  @note   Feature flag PcdPciBusHotplugDeviceSupport determine whether need support hotplug.\n\n**/\nEFI_STATUS\nPciScanBus (\n  IN PCI_IO_DEVICE  *Bridge,\n  IN UINT8          StartBusNumber,\n  OUT UINT8         *SubBusNumber,\n  OUT UINT8         *PaddedBusRange\n  );\n</code></pre> <p>\u8f93\u5165\u4e00\u4e2a\u6865\u8bbe\u5907\u548c\u521d\u59cb\u7684 Bus Number\uff0c\u8f93\u51fa Subordinate Bus Number\uff0c\u4e5f\u5c31\u662f\u5206\u914d\u7684\u6700\u5927\u7684 Bus Number\uff0c\u4ee5\u53ca Padded Bus Range\uff0c\u4f8b\u5982\u5982\u679c\u8981\u8003\u8651\u70ed\u63d2\u62d4\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u9884\u7559\u4e00\u4e9b Bus Number\u3002\u5b83\u5728 <code>PciRootBridgeEnumerator</code> \u51fd\u6570\u4e2d\u88ab\u8c03\u7528\uff0c\u4f20\u5165\u7684\u662f RootBridgeDev\u3002\u4f60\u53ef\u80fd\u4e5f\u731c\u5230\u4e86\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u9012\u5f52\u8c03\u7528\uff0c\u4ece Root Bridge \u5f00\u59cb\u5f80\u4e0b\uff0c\u9047\u5230\u65b0\u7684\u6865\u8bbe\u5907\u7684\u65f6\u5019\uff0c\u5c31\u7ee7\u7eed\u9012\u5f52\uff0c\u7136\u540e\u6839\u636e\u4e0b\u4e00\u5c42\u5206\u914d\u7684 Bus Number \u6765\u8ba1\u7b97\u4e0a\u4e00\u5c42\u7684 Subordinate Bus Number\u3002</p> <p><code>PciScanBus</code> \u9996\u5148\u679a\u4e3e\u5f53\u524d\u6865\u8bbe\u5907\u4e0b\u7684\u6240\u6709 Device \u548c Function\uff0c\u56e0\u4e3a\u5f53\u524d\u7684\u6865\u8bbe\u5907\u5df2\u7ecf\u88ab\u5206\u914d\u4e86 Bus Number\uff0c\u6240\u4ee5\u662f\u53ef\u4ee5\u8bbf\u95ee\u5b83\u4e0b\u9762\u7684 Device \u548c Function \u7684\u3002</p> <pre><code>for (Device = 0; Device &lt;= PCI_MAX_DEVICE; Device++) {\n  TempReservedBusNum = 0;\n  for (Func = 0; Func &lt;= PCI_MAX_FUNC; Func++) {\n    //\n    // Check to see whether a pci device is present\n    //\n    Status =\n        PciDevicePresent(PciRootBridgeIo, &amp;Pci, StartBusNumber, Device, Func);\n\n    if (EFI_ERROR(Status) &amp;&amp; (Func == 0)) {\n      //\n      // go to next device if there is no Function 0\n      //\n      break;\n    }\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    //\n    // Get the PCI device information\n    //\n    Status =\n        PciSearchDevice(Bridge, &amp;Pci, StartBusNumber, Device, Func, &amp;PciDevice);\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    PciAddress = EFI_PCI_ADDRESS(StartBusNumber, Device, Func, 0);\n\n    if (IS_PCI_BRIDGE(&amp;Pci) || IS_CARDBUS_BRIDGE(&amp;Pci)) {\n      //\n      // For PPB\n      //\n\n      Status = PciAllocateBusNumber(Bridge, *SubBusNumber, 1, SubBusNumber);\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      SecondBus = *SubBusNumber;\n\n      Register = (UINT16)((SecondBus &lt;&lt; 8) | (UINT16)StartBusNumber);\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_PRIMARY_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint16,\n                                          Address, 1, &amp;Register);\n\n      //\n      // If it is PPB, recursively search down this bridge\n      //\n      if (IS_PCI_BRIDGE(&amp;Pci)) {\n        //\n        // Temporarily initialize SubBusNumber to maximum bus number to ensure\n        // the PCI configuration transaction to go through any PPB\n        //\n        Register = PciGetMaxBusNumber(Bridge);\n        Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                  PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n        Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                            Address, 1, &amp;Register);\n\n        Status = PciScanBus(PciDevice, SecondBus, SubBusNumber, PaddedBusRange);\n        if (EFI_ERROR(Status)) {\n          return Status;\n        }\n      }\n\n      //\n      // Set the current maximum bus number under the PPB\n      //\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                          Address, 1, SubBusNumber);\n    } else {\n      //\n      // It is device. Check PCI IOV for Bus reservation\n      // Go through each function, just reserve the MAX ReservedBusNum for one\n      // device\n      //\n\n      // OMITTED\n    }\n\n    if ((Func == 0) &amp;&amp; !IS_PCI_MULTI_FUNC(&amp;Pci)) {\n      //\n      // Skip sub functions, this is not a multi function device\n      //\n\n      Func = PCI_MAX_FUNC;\n    }\n  }\n}\n</code></pre> <p>\u4ece\u4ee3\u7801\u4e2d\u53bb\u6389\u4e86\u4e00\u4e9b\u70ed\u63d2\u62d4\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5b83\u7684\u601d\u8def\u5982\u4e0b\uff1a</p> <ol> <li>\u679a\u4e3e\u5f53\u524d\u8bbe\u5907\u4e0b\u7684 Device \u548c Function</li> <li>\u5982\u679c\u627e\u5230\u4e86\u4e00\u4e2a\u6865\u8bbe\u5907\uff0c\u4e3a\u5b83\u5206\u914d\u4e00\u4e2a\u65b0\u7684 Bus Number<ol> <li>\u8bbe\u7f6e\u8fd9\u4e2a\u65b0\u7684\u6865\u8bbe\u5907\u7684 Primary Bus Number \u4e3a Start Bus Number\uff08\u4e5f\u5c31\u662f\u4e0a\u4e00\u7ea7\u7684 Secondary Bus Number\uff09\uff0cSecondary Bus \u662f\u65b0\u5206\u914d\u7684 Bus Number\uff0cSubordinate Bus Number \u662f\u6700\u5927\u503c</li> <li>\u8fd9\u6837\u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u76f8\u5f53\u4e8e\u6240\u6709\u7684\u5728 <code>[Secondary Bus Number, Max Bus Number]</code> \u8303\u56f4\u4e2d\u7684 Bus \u8bf7\u6c42\u90fd\u4f1a\u8def\u7531\u5230\u65b0\u7684\u6865\u8bbe\u5907\u4e0a</li> <li>\u9012\u5f52\u8c03\u7528 PciScanBus\uff0c\u53c2\u6570\u662f\u65b0\u7684\u6865\u8bbe\u5907\uff0cStart Bus Number \u4e3a\u65b0\u7684 Secondary Bus Number</li> <li>\u9012\u5f52\u8c03\u7528\u8fd4\u56de\u4ee5\u540e\uff0c\u65b0\u7684\u6865\u8bbe\u5907\u4e0b\u9762\u6240\u6709\u7684\u8bbe\u5907\u90fd\u5206\u914d\u5230\u4e86\u81ea\u5df1\u7684 Bus Number\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u77e5\u9053\u51c6\u786e\u7684 Subordinate Bus Number \u4e86\uff0c\u4e0d\u518d\u662f\u521a\u624d\u4e34\u65f6\u8bbe\u7f6e\u7684 Max Bus Number\uff0c\u56e0\u6b64\u8fd9\u65f6\u5019\u518d\u628a\u51c6\u786e\u7684 Subordinate Bus Number \u5199\u5165\u6865\u8bbe\u5907\u7684 Subordinate Bus Number \u4e2d</li> </ol> </li> <li>\u679a\u4e3e\u5b8c\u6240\u6709\u8bbe\u5907\u4ee5\u540e\uff0c\u8fd4\u56de\u76ee\u524d\u9012\u5f52\u5206\u914d\u5f97\u5230\u7684\u6700\u5927\u7684 Bus Number</li> </ol> <p>\u8fd9\u6837\u6574\u7406\u51fa\u6765\u4e00\u770b\uff0c\u5176\u5b9e\u5f88\u6e05\u695a\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a DFS \u7b97\u6cd5\uff0c\u5728\u641c\u7d22\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5f53\u524d\u7684\u7ed3\u70b9\u53ef\u8fbe\uff0c\u4fdd\u8bc1\u4ece Root Bridge \u5230\u5f53\u524d\u7684\u7ed3\u70b9\u8def\u5f84\u4e0a\u7684 Bus Number \u8303\u56f4\u90fd\u662f <code>[Secondary Bus Number, Max Bus Number]</code>\uff1b\u5f53\u7ed3\u70b9\u641c\u7d22\u5b8c\u4ee5\u540e\uff0c\u518d\u56de\u6eaf\uff0c\u56de\u6eaf\u7684\u65f6\u5019\u5c31\u77e5\u9053\u4e86\u5b9e\u9645\u5206\u914d\u5230\u591a\u5927\u7684 Bus Number\uff0c\u8fd9\u65f6\u5019\u518d\u586b\u56de Subordinate Bus Number\uff0c\u6700\u540e\u4fdd\u8bc1\u8fd9\u4e2a\u6811\u4e0a\u6bcf\u4e00\u5c42\u7684 <code>[Secondary Bus Number, Subordinate Bus Number]</code> \u533a\u95f4\u4e0d\u91cd\u5408\uff0c\u4e14\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u7684\u533a\u95f4\u90fd\u5305\u542b\u4e8e\u7236\u7ed3\u70b9\u7684\u533a\u95f4\u3002</p> <p>\u6700\u540e\u7684\u7ed3\u679c\uff0c\u7c7b\u4f3c MindShare \u4e66\u4e2d\u7684\u8fd9\u4e2a\u56fe\uff1a</p> <p></p> <p>\u4e3a\u4e86\u652f\u6301 PCIe \u70ed\u63d2\u62d4\uff0c\u6216\u8005\u53ef\u80fd\u4f1a\u52a8\u6001\u4ea7\u751f\u65b0\u8bbe\u5907\u7684 SR-IOV\uff0c\u4ee3\u7801\u4e2d\u505a\u4e86\u76f8\u5e94\u7684\u9884\u7559\uff1a</p> <pre><code>if (FeaturePcdGet(PcdPciBusHotplugDeviceSupport)) {\n  //\n  // If Hot Plug is supported,\n  // Get the bridge information\n  //\n  BusPadding = FALSE;\n  if (gPciHotPlugInit != NULL) {\n    if (IsPciHotPlugBus(PciDevice)) {\n      //\n      // If it is initialized, get the padded bus range\n      //\n      Status = gPciHotPlugInit-&gt;GetResourcePadding(\n          gPciHotPlugInit, PciDevice-&gt;DevicePath, PciAddress, &amp;State,\n          (VOID **)&amp;Descriptors, &amp;Attributes);\n\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      BusRange = 0;\n      NextDescriptors = Descriptors;\n      Status = PciGetBusRange(&amp;NextDescriptors, NULL, NULL, &amp;BusRange);\n\n      FreePool(Descriptors);\n\n      if (!EFI_ERROR(Status)) {\n        BusPadding = TRUE;\n      } else if (Status != EFI_NOT_FOUND) {\n        //\n        // EFI_NOT_FOUND is not a real error. It indicates no bus number padding\n        // requested.\n        //\n        return Status;\n      }\n    }\n  }\n}\n\nif (FeaturePcdGet(PcdPciBusHotplugDeviceSupport) &amp;&amp; BusPadding) {\n  //\n  // Ensure the device is enabled and initialized\n  //\n  if ((Attributes == EfiPaddingPciRootBridge) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_ENABLED) != 0) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_INITIALIZED) != 0)) {\n    *PaddedBusRange = (UINT8)((UINT8)(BusRange) + *PaddedBusRange);\n  } else {\n    //\n    // Reserve the larger one between the actual occupied bus number and padded\n    // bus number\n    //\n    Status = PciAllocateBusNumber(PciDevice, SecondBus, (UINT8)(BusRange),\n                                  &amp;PaddedSubBus);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    *SubBusNumber = MAX(PaddedSubBus, *SubBusNumber);\n  }\n}\n</code></pre> <p>SR-IOV:</p> <pre><code>//\n// It is device. Check PCI IOV for Bus reservation\n// Go through each function, just reserve the MAX ReservedBusNum for one device\n//\nif (PcdGetBool(PcdSrIovSupport) &amp;&amp; (PciDevice-&gt;SrIovCapabilityOffset != 0)) {\n  if (TempReservedBusNum &lt; PciDevice-&gt;ReservedBusNum) {\n    Status = PciAllocateBusNumber(\n        PciDevice, *SubBusNumber,\n        (UINT8)(PciDevice-&gt;ReservedBusNum - TempReservedBusNum), SubBusNumber);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    TempReservedBusNum = PciDevice-&gt;ReservedBusNum;\n\n    if (Func == 0) {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x\\n\",\n             *SubBusNumber));\n    } else {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x (Update)\\n\",\n             *SubBusNumber));\n    }\n  }\n}\n</code></pre> <p>\u5206\u914d\u597d Bus \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5bf9\u6240\u6709\u8bbe\u5907\u8fdb\u884c Configuration Request \u4e86\uff0c\u540e\u7eed\u7684 Memory \u548c IO \u5730\u5740\u7684\u5206\u914d\u548c\u8def\u7531\uff0c\u4e5f\u662f\u7c7b\u4f3c\u5730\u9012\u5f52\u5730\u8fdb\u884c\u5206\u914d\uff0c\u7136\u540e\u56de\u6eaf\u7684\u65f6\u5019\u5408\u5e76\u5730\u5740\u533a\u95f4\u5373\u53ef\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#\u7269\u7406\u5c42","title":"\u7269\u7406\u5c42","text":"<p>\u7269\u7406\u5c42\u7f16\u7801\u4e0a\uff0cPCIe 1.0 \u548c 2.0 \u91c7\u7528\u7684\u662f NRZ 8b/10b\uff0cPCIe 3.0 \u5230 5.0 \u7528\u7684\u662f NRZ 128b/130b\uff0c\u6700\u65b0\u7684 PCIe 6.0 \u548c 7.0 \u5219\u6362\u6210\u4e86 PAM4 FLIT\u3002\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6bcf\u4e00\u4ee3 x16 Lane \u60c5\u51b5\u4e0b\u7684\u6700\u5927\u6570\u636e\u5e26\u5bbd\uff1a</p> <ul> <li>PCIe 1.0: <code>2.5 * 8 / 10 * 16 = 32 Gb/s</code></li> <li>PCIe 2.0: <code>5.0 * 8 / 10 * 16 = 64 Gb/s</code></li> <li>PCIe 3.0: <code>8.0 * 128 / 130 * 16 = 126 Gb/s</code></li> <li>PCIe 4.0: <code>16.0 * 128 / 130 * 16 = 252 Gb/s</code></li> <li>PCIe 5.0: <code>32.0 * 128 / 130 * 16 = 504 Gb/s</code></li> <li>PCIe 6.0: <code>64.0 * 16 = 1024 Gb/s</code>\uff0c\u5982\u679c\u8003\u8651 FLIT \u5f15\u5165\u7684\u5f00\u9500\uff0c\u5219\u662f <code>64.0 * 242 / 256 * 16 = 968 Gb/s</code></li> <li>PCIe 7.0: <code>128.0 * 16 = 2048 Gb/s</code>\uff0c\u5982\u679c\u8003\u8651 FLIT \u5f15\u5165\u7684\u5f00\u9500\uff0c\u5219\u662f <code>128.0 * 242 / 256 * 16 = 1936 Gb/s</code></li> </ul>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#pcie-60","title":"PCIe 6.0","text":"<p>PCIe 6.0 \u5f15\u5165\u4e86 PAM4 \u6765\u66ff\u4ee3\u539f\u6765\u7684 NRZ\uff0c\u5b9e\u73b0\u4e86\u6ce2\u7279\u7387\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\u901f\u5ea6\u7ffb\u500d\uff0c\u5e76\u4e14\u4e0d\u518d\u4f7f\u7528 128b/130b\uff0c\u4e3a\u4e86\u89e3\u51b3 PAM4 \u5e26\u6765\u7684\u66f4\u9ad8\u7684\u9519\u8bef\u7387\uff0c\u5f15\u5165\u4e86 FEC\uff0cCRC \u8fd8\u6709\u683c\u96f7\u7801\uff0c\u4ee5\u53ca\u65b0\u7684 FLIT\u3002</p> <p>\u7f51\u4e0a\u53ef\u4ee5\u641c\u5230\u5173\u4e8e PCIe \u7684 PPT\uff1ahttps://pcisig.com/sites/default/files/files/PCIe%206.0%20Webinar_Final_.pdf \u548c https://www.openfabrics.org/wp-content/uploads/2022-workshop/2022-workshop-presentations/206_DDasSharma.pdf\uff0c\u4ee5\u53ca\u5173\u4e8e FLIT \u7684\u535a\u5ba2\uff1ahttps://pcisig.com/blog/pcie%C2%AE-60-specification-webinar-qa-deeper-dive-flit-mode-pam4-and-forward-error-correction-fec</p> <p>\u603b\u7ed3 FLIT \u7684\u8981\u70b9\uff1a</p> <ol> <li>\u6bcf\u4e2a FLIT \u56fa\u5b9a\u957f\u5ea6 256 \u5b57\u8282\uff0c\u5176\u4e2d 236 \u5b57\u8282\u4f20\u8f93 TLP\uff0c6 \u5b57\u8282\u4f20\u8f93 DLLP\uff0c8 \u5b57\u8282\u4f20\u8f93 CRC\uff0c6 \u5b57\u8282\u4f20\u8f93 FEC\u3002</li> <li>\u63a5\u53d7\u65b9\u63a5\u53d7\u5230 FLIT \u540e\uff0c\u4f1a\u5c1d\u8bd5\u8fdb\u884c FEC \u89e3\u7801\uff0c\u5e76\u4e14\u5c1d\u8bd5\u4fee\u590d\u9519\u8bef\uff0c\u518d\u8fdb\u884c CRC \u6821\u9a8c\u3002\u5982\u679c\u4e2d\u9014\u51fa\u73b0\u4e86\u9519\u8bef\uff0c\u5219\u4f1a\u53d1\u9001\u4e00\u4e2a NAK \u7ed9\u53d1\u9001\u65b9\u3002</li> <li>\u4e00\u4e2a TLP \u53ef\u80fd\u8de8\u8d8a\u591a\u4e2a FLIT\uff0c\u4e00\u4e2a FLIT \u53ef\u80fd\u5305\u62ec\u591a\u4e2a TLP\uff0c\u6839\u636e TLP \u5927\u5c0f\u800c\u5b9a\u3002TLP \u4e0d\u9700\u8981\u5bf9\u9f50\u5230 FLIT \u7684\u5f00\u5934\u6216\u8005\u7ed3\u5c3e\u3002</li> </ol> <p>\u53ef\u4ee5\u53d1\u73b0\uff0cFLIT \u7684 CRC \u7528\u4e86 8 \u4e2a\u5b57\u8282\uff0c\u4e0d\u518d\u9700\u8981\u539f\u6765 TLP \u548c DLLP \u4e2d\u7684 ECRC \u548c LCRC\u3002\u5728\u4e4b\u524d\u7684 PCIe \u7248\u672c\uff0cTLP \u7684\u53ef\u9009 Digest \u662f 4 \u4e2a\u5b57\u8282\u7684 ECRC\uff0cTLP+DLLP \u7684 LCRC \u662f 4 \u5b57\u8282\u3002\u5177\u4f53\u91c7\u7528\u591a\u5c11\u5b57\u8282\u7684 CRC\uff0c\u548c\u76ee\u6807\u7684\u9519\u8bef\u7387\uff0c\u4ee5\u53ca\u4f20\u8f93\u7684\u5b57\u8282\u6570\u76f8\u5173\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2022/11/12/pcie-notes/#ats","title":"ATS","text":"<p>ATS\uff08Address Translation Service\uff09\u662f\u5728 PCIe \u4e0a\u7ed9\u5916\u8bbe\u63d0\u4f9b\u67e5\u8be2\u9875\u8868\u7684\u65b9\u5f0f\uff0c\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u5730\u5740\u3002\u6807\u51c6\u53ef\u4ee5\u5728 https://composter.com.ua/documents/ats_r1.1_26Jan09.pdf \u5904\u4e0b\u8f7d\uff0c\u4ee5\u53ca\u5173\u4e8e ATS \u7684 PPT\uff1ahttps://composter.com.ua/documents/Address_Translation_Services.pdf\u3002</p> <p>\u5b83\u7684\u6574\u4f53\u5de5\u4f5c\u65b9\u5f0f\u5982\u56fe\uff1a</p> <p></p> <p>\u5c31\u662f\u5728 Root Complex \u548c Memory \u4e4b\u95f4\u8bbe\u7f6e\u4e00\u4e2a Translation Agent\uff0c\u8d1f\u8d23\u67e5\u8868\uff0c\u4e5f\u5c31\u662f Page Table Walker\u3002\u5b83\u4f1a\u63a5\u6536\u6765\u81ea PCIe \u8bbe\u5907\u7684\u5730\u5740\u7ffb\u8bd1\u8bf7\u6c42\uff0c\u7136\u540e\u5b83\u83b7\u53d6\u5230\u9875\u8868\u5730\u5740\u540e\uff0c\u6839\u636e\u865a\u62df\u5730\u5740\u53bb\u67e5\u5185\u5b58\u4e2d\u7684\u9875\u8868\u3002TLB\uff08\u5728\u6807\u51c6\u4e2d\u53eb\u505a Address Translation Cache\uff0cATC\uff09\u662f\u5b9e\u73b0\u5728 PCIe \u8bbe\u5907\u4fa7\u7684\uff0c\u800c\u4e0d\u662f\u7edf\u4e00\u7684 TLB\uff0c\u4e5f\u4e0d\u662f CPU \u6838\u5fc3\u7684 TLB\u3002</p> <p>\u4e3a\u4e86\u652f\u6301 ATS\uff0c\u9700\u8981\u652f\u6301\u5982\u4e0b\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>PCIe Device \u5411 Translation Agent \u53d1\u9001 Translation Request\uff1bTranslation Agent \u5411 PCIe Device \u56de\u590d Translation Completion\uff1b</li> <li>\u5f53\u9875\u8868\u51fa\u73b0\u53d8\u5316\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u77e5 PCIe \u8bbe\u5907\u7aef\u7684 TLB\uff0c\u56e0\u6b64\u9700\u8981\u5411 PCIe \u8bbe\u5907\u53d1\u9001 Invalidate Request Message\uff1bPCIe \u8bbe\u5907\u5b8c\u6210 TLB \u5237\u65b0\u540e\uff0c\u56de\u590d\u4e00\u4e2a Invalidate Complete Message\u3002</li> </ol> <p>ATS \u6807\u51c6\u8fd8\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53ef\u9009\u529f\u80fd\uff0c\u5c31\u662f Page Request Interface\uff08PRI\uff09\uff0c\u5176\u5b9e\u5c31\u662f\u7f3a\u9875\u7684\u65f6\u5019\uff0c\u8bbe\u5907\u53ef\u4ee5\u53bb\u53d1\u9001 Page Request\uff0c\u8981\u6c42\u64cd\u4f5c\u7cfb\u7edf\u53bb\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u3002\u8fd9\u5c31\u50cf\u7528\u6237\u7a0b\u5e8f\u91cc mmap \u4e00\u4e2a\u533f\u540d\u7684\u9875\uff0c\u4e00\u5f00\u59cb\u662f\u6ca1\u6709\u5206\u914d\u7684\uff0c\u76f4\u5230\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u51fa\u73b0\u7f3a\u9875\u5f02\u5e38\uff0c\u7136\u540e OS \u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u518d\u66f4\u65b0\u9875\u8868\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\u7528\u4e8e DMA \u7684\u7269\u7406\u9875\u4e5f\u53ef\u4ee5 Swap \u6216\u8005\u5ef6\u8fdf\u5206\u914d\u3002</p>","tags":["pcie","bus","notes","learn"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/","title":"\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128","text":"","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u9700\u8981\u5728 VCU128 \u4e0a\u642d\u5efa\u4e00\u4e2a SOC\uff0c\u7136\u540e\u60f3\u5230\u53ef\u4ee5\u628a OpenSBI\u3001U-Boot \u548c Linux \u79fb\u690d\u5230\u8fd9\u4e2a\u5e73\u53f0\u4e0a\u65b9\u4fbf\u6d4b\u8bd5\uff0c\u4e8e\u662f\u53c8\u5f00\u59cb\u6298\u817e\u8fd9\u4e9b\u4e1c\u897f\u3002\u4ee3\u7801\u4ed3\u5e93\u90fd\u5df2\u7ecf\u5f00\u6e90\uff1a</p> <ul> <li>rocket-chip-vcu128</li> <li>opensbi</li> <li>u-boot</li> <li>linux</li> </ul>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#rocket-chip-on-vcu128","title":"Rocket Chip on VCU128","text":"<p>\u7b2c\u4e00\u90e8\u5206\u662f\u57fa\u4e8e\u4e4b\u524d rocket2thinpad \u5728 Thinpad \u4e0a\u79fb\u690d Rocket Chip \u7684\u7ecf\u9a8c\uff0c\u505a\u4e86\u4e00\u4e9b\u66f4\u65b0\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a VCU128 \u7684\u5916\u8bbe\u4e0d\u5927\u4e00\u6837\uff0c\u540c\u65f6\u6211\u4e5f\u8981\u8fd0\u884c\u66f4\u590d\u6742\u7684\u7a0b\u5e8f\uff0c\u4e3b\u8981\u505a\u4e86\u8fd9\u4e9b\u4e8b\u60c5\uff1a</p> <ol> <li>\u6dfb\u52a0\u4e86 VCU128 \u7684\u5185\u5b58\u548c\u5916\u8bbe\uff1aHBM\u3001SPI\u3001I2C\u3001UART\u3001ETH</li> <li>\u6253\u5f00\u4e86\u66f4\u591a\u6838\u5fc3\u9009\u9879\uff1aS-mode \u548c U-mode</li> </ol> <p>\u4e3b\u8981\u8e29\u8fc7\u7684\u5751\uff1a</p> <ol> <li>BSCAN \u4e0d\u5de5\u4f5c\uff0c\u4f30\u8ba1\u662f\u56e0\u4e3a\u4e00\u4e9b\u53c2\u6570\u4e0d\u5bf9\uff0c@jsteward \u4e4b\u524d\u5728 zcu \u5e73\u53f0\u4e0a\u505a\u4e86\u4e00\u4e9b\u6d4b\u8bd5\uff0c\u4f30\u8ba1\u8981\u7528\u7c7b\u4f3c\u7684\u529e\u6cd5\u8fdb\u884c\u4fee\u6539\uff1b\u6211\u6700\u540e\u76f4\u63a5\u53bb\u6389\u4e86\u8fd9\u90e8\u5206\u903b\u8f91</li> <li>\u8fd9\u4e2a\u677f\u5b50\u7684 PHY RESET \u4fe1\u53f7\u8981\u901a\u8fc7 I2C \u63a5\u53e3\u8bbf\u95ee TI \u7684 Port Expander\uff0c\u6240\u4ee5\u6ca1\u6cd5\u76f4\u63a5\u8fde\uff0c\u8981\u901a\u8fc7 gpio \u8f93\u51fa\u6765\u624b\u52a8 reset</li> <li>SPI Startup Flash \u7684\u65f6\u5e8f\u914d\u7f6e\uff0c\u89c1\u6211\u4e4b\u524d\u7684\u535a\u5ba2</li> <li>Xilinx PCS/PMA IP \u4e5f\u4f1a\u81ea\u5df1\u6302\u4e00\u4e2a\u8bbe\u5907\u5230 MDIO bus \u4e0a\uff0c\u5e94\u8be5\u6709\u81ea\u5df1\u7684 PHY \u5730\u5740\uff0c\u800c\u4e0d\u8981\u548c\u7269\u7406\u7684 PHY \u51b2\u7a81</li> </ol>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#u-boot","title":"U-Boot","text":"<p>\u5728 U-Boot \u4e0a\u82b1\u4e86\u6bd4\u8f83\u591a\u7684\u65f6\u95f4\uff0c\u7528\u5b83\u7684\u76ee\u7684\u4e3b\u8981\u662f\uff1a</p> <ol> <li>BootROM \u4e2d\u7684\u4ee3\u7801\u53ea\u652f\u6301\u4ece\u4e32\u53e3\u52a0\u8f7d\u7a0b\u5e8f\uff0c\u5982\u679c\u540e\u7eed\u8981\u52a0\u8f7d Linux \u5185\u6838\u7b49\u8f6f\u4ef6\uff0c\u6027\u80fd\u592a\u5dee\u3002</li> <li>U-Boot \u9a71\u52a8\u6bd4\u8f83\u5b8c\u5584\uff0c\u800c\u4e14 dts \u4e5f\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u8fc1\u79fb\u5230 Linux \u4e2d</li> <li>\u6709\u4e00\u4e9b\u53ef\u4ee5\u53c2\u8003\u7684\u8d44\u6599</li> </ol> <p>\u79fb\u690d\u7684\u65f6\u5019\uff0c\u9996\u5148\u65b0\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 board\uff0c\u7136\u540e\u81ea\u5df1\u5199 defconfig \u548c dts\uff0c\u5176\u4e2d dts \u53ef\u4ee5\u53c2\u8003 rocket chip \u751f\u6210\u7684 dts \u6587\u4ef6\u3002\u7136\u540e\uff0c\u6309\u7167\u5404\u4e2a\u5916\u8bbe\u7684 device tree binding \u53bb\u5199\uff0c\u7136\u540e\u6253\u5f00/\u5173\u95ed\u5404\u4e2a CONFIG \u5f00\u5173\u3002</p> <p>\u5bf9\u4ee3\u7801\u4e3b\u8981\u7684\u6539\u52a8\u662f\uff0c\u5b9e\u73b0\u4e86 DCache \u7684 flush \u529f\u80fd\uff0c\u56e0\u4e3a\u4ee5\u592a\u7f51\u90e8\u5206\u7528\u4e86 DMA\uff0c\u6240\u4ee5\u8981\u8ba9\u5916\u8bbe\u770b\u5230\u5185\u5b58\u7684\u66f4\u6539\uff0c\u8fd9\u91cc\u91c7\u7528\u7684\u662f SiFive \u7684\u6269\u5c55\u6307\u4ee4 <code>cflush.d.l1</code>\u3002\u7531\u4e8e\u7f16\u8bd1\u5668\u8fd8\u4e0d\u652f\u6301\u8fd9\u4e2a\u6307\u4ee4\uff0c\u5c31\u6309\u7167\u7f51\u4e0a\u7684\u65b9\u5f0f\u53bb\u6784\u9020\u4e86\u6c47\u7f16\u6307\u4ee4\u3002\u5b9e\u73b0\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u7528\u7f51\u7edc\u4e86\u3002</p> <p>\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u76f4\u63a5\u5728 M-mode \u4e2d\u8fd0\u884c U-Boot\uff0c\u8fd9\u6837\u4e0d\u9700\u8981 OpenSBI\uff0c\u540c\u65f6 DTB \u4e5f\u662f\u5185\u7f6e\u7684\u3002\u4f46\u540e\u7eed\u4e3a\u4e86\u8fd0\u884c Linux\uff0c\u8fd8\u662f\u9700\u8981\u4e00\u4e2a SBI \u5b9e\u73b0\uff1aOpenSBI\uff0c\u7136\u540e\u5728 S-mode \u4e2d\u8fd0\u884c U-Boot\uff0c\u518d\u5f15\u5bfc\u5230 Linux\u3002</p> <p>\u6b64\u5916\u8fd8\u82b1\u4e86\u5f88\u591a\u52aa\u529b\u6765\u7f29\u5c0f binary \u5927\u5c0f\uff0c\u9996\u5148\u53ef\u4ee5\u7528 <code>nm --size -r u-boot | head -20</code> \u6765\u627e\u5230\u6bd4\u8f83\u5927\u7684\u4e00\u4e9b\u7b26\u53f7\uff0c\u4e0d\u8003\u8651\u5176\u4e2d BSS \u7684\u90e8\u5206\uff08type=b\uff09\uff0c\u4e3b\u8981\u770b\u54ea\u4e9b\u4ee3\u7801/\u6570\u636e\u6bd4\u8f83\u5360\u7a7a\u95f4\u3002</p> <p>UPDATE: U-Boot \u5728 v2022.01 \u7248\u672c\u4fee\u590d\u4e86\u4e00\u4e2a BUG\uff0c\u4e4b\u524d\u7684\u7248\u672c\u5728 riscv \u67b6\u6784\u4e0b\u6ca1\u6709 reserve lmb region\uff0c\u4f7f\u5f97\u52a0\u8f7d initrd \u7684\u65f6\u5019\uff0c\u4f1a\u8986\u76d6\u6389\u81ea\u5df1\u7684\u6808\u7a7a\u95f4\uff0c\u8fd9\u89e3\u91ca\u4e86\u4e4b\u524d\u7684\u8bf8\u591a\u7384\u5b66\u5185\u5b58\u95ee\u9898\uff0c\u5347\u7ea7\u5230 v2022.01 \u540e\u5c31\u597d\u4e86\u3002</p>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#opensbi","title":"OpenSBI","text":"<p>OpenSBI \u79fb\u690d\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u53c2\u8003 template \u4fee\u6539\u5373\u53ef\uff0c\u4e3b\u8981\u5c31\u662f\u4e32\u53e3\u7684\u914d\u7f6e\uff0c\u5176\u4ed6\u57fa\u672c\u4e0d\u7528\u6539\u3002\u7136\u540e\uff0c\u6211\u628a U-Boot \u4f5c\u4e3a OpenSBI \u7684 Payload \u653e\u5230 OpenSBI \u7684\u540e\u9762\uff0c\u6b64\u65f6\u8981\u628a U-Boot \u914d\u7f6e\u4e3a S-mode \u6a21\u5f0f\u3002\u63a5\u7740\uff0c\u9047\u5230\u4e86\u65b0\u7684\u95ee\u9898\uff1a<code>cflush.d.l1</code> \u6307\u4ee4\u53ea\u80fd\u5728 M-mode \u7528\uff0c\u56e0\u6b64\u6211\u5728 OpenSBI \u4ee3\u7801\u4e2d\u5904\u7406\u4e86 trap\uff0c\u8f6c\u800c\u5728 M-mode \u91cc\u9762\u8fd0\u884c\u8fd9\u6761\u6307\u4ee4\u3002\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u5728 S-mode \u91cc\u5237\u65b0 Cache \u4e86\u3002</p>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#linux","title":"Linux","text":"<p>Linux \u76ee\u524d\u53ef\u4ee5 boot \u5230\u5bfb\u627e init\uff0c\u8fd8\u6ca1\u6709\u78b0\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e4b\u540e\u8ba1\u5212\u7528 buildroot \u6253\u4e00\u4e2a initramfs \u51fa\u6765\u3002\u4e3a\u4e86\u5728 U-Boot \u4e2d\u542f\u52a8 Linux\uff0c\u7528 U-Boot \u7684 mkimage \u5de5\u5177\u751f\u6210\u4e86 FIT \u683c\u5f0f\u7684 uImage\uff0c\u91cc\u9762\u6253\u5305\u4e86 kernel image \u548c dtb\uff0c\u5c31\u53ef\u4ee5\u7528 bootm \u547d\u4ee4\u542f\u52a8\u4e86\uff0c\u6ce8\u610f\u5730\u5740\u4e0d\u8981\u548c\u52a0\u8f7d\u5730\u5740\u91cd\u590d\u3002</p> <p>\u6b64\u5916\u8fd8\u9047\u5230\u4e00\u4e2a\u5751\uff1aRV64 \u91cc\u9762 Linux dts \u7684 address cell \u5f97\u662f 2\uff08\u5bf9\u5e94 64 \u4f4d\uff09\uff0c\u5426\u5219\u4f1a\u6709\u9519\u8bef\u3002\u4f46 U-Boot \u5bf9\u8fd9\u4e2a\u6ca1\u6709\u505a\u8981\u6c42\u3002</p>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2021/10/18/port-system-to-rocket-chip-on-vcu128/#\u7f13\u5b58\u4e00\u81f4\u6027","title":"\u7f13\u5b58\u4e00\u81f4\u6027","text":"<p>\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0cAXI DMA \u76f4\u63a5\u63a5\u5230\u5185\u5b58\u4e0a\uff0c\u6240\u4ee5\u4e0e CPU \u7f13\u5b58\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u7f51\u5361\u9a71\u52a8\u9700\u8981\u7ecf\u5e38\u5730\u5237\u7f13\u5b58\u3002\u5728 Rocket Chip \u4e0a\uff0c\u53ef\u4ee5\u7528 sifive \u81ea\u5df1\u7684 cflush \u6307\u4ee4\u6765\u5237\u7f13\u5b58\uff0c\u4f46\u662f\u5b83\u53ea\u80fd\u5728 M \u6001\u6267\u884c\uff0c\u540c\u65f6\u53c8\u652f\u6301\u865a\u62df\u5730\u5740\uff0c\u8fd9\u79cd\u5947\u602a\u7684\u8bbe\u8ba1\u5c31\u4f7f\u5f97\u8981\u5728 OpenSBI\uff0cU-Boot \u548c Linux \u4e09\u5904\u90fd\u6dfb\u52a0\u903b\u8f91\uff1aOpenSBI \u5904\u7406 illegal instruction\uff0c\u5982\u679c\u53d1\u73b0\u662f cflush \u6307\u4ee4\uff0c\u5c31\u518d\u6b21 cflush\uff1bU-Boot \u548c Linux \u4fee\u6539\u9a71\u52a8\uff0c\u5728\u5408\u9002\u7684\u5730\u65b9\u6dfb\u52a0 cflush \u6307\u4ee4\u3002U-Boot \u9a71\u52a8\u6bd4\u8f83\u7b80\u5355\uff0c\u5de5\u4f5c\u5f97\u6bd4\u8f83\u597d\uff0c\u4f46\u662f Linux \u7684\u7f51\u5361\u9a71\u52a8\u600e\u4e48\u90fd\u6539\u4e0d\u597d\u3002</p> <p>\u6700\u540e\u51b3\u5b9a\uff0c\u6253\u5f00 Rocket Chip \u7684 Frontend Bus\uff0c\u6dfb\u52a0\u4e00\u4e2a AXI Slave \u63a5\u53e3\uff0c\u7136\u540e\u8ba9 AXI DMA \u901a\u8fc7 AXI Slave \u63a5\u5165\u5230 Rocket Chip \u4e2d\uff0c\u7136\u540e\u901a\u8fc7 TLBroadcast \u5b9e\u73b0\u7f13\u5b58\u4e00\u81f4\u6027\u3002\u8fd9\u6837\u8f6f\u4ef6\u5b9e\u73b0\u4f1a\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u786c\u4ef6\u5c31\u66f4\u590d\u6742\u4e86\u3002</p>","tags":["uboot","linux","riscv","rocketchip","vcu128","fpga","serial"]},{"location":"hardware/2020/02/09/program-artix7-on-macos/","title":"\u5728 macOS \u70e7\u5199 Artix7 FPGA","text":"<p>\u9996\u5148\u5b89\u88c5\u597d openocd\uff1a</p> <p><code>brew install openocd --HEAD</code></p> <p>\u6d4b\u8bd5\u6240\u7528\u7248\u672c\u4e3a <code>0.10.0+dev-01052-g09580964 (2020-02-08-15:09)</code>\u3002</p> <p>\u7136\u540e\u7f16\u5199\u5982\u4e0b\u7684 openocd.cfg\uff1a</p> <pre><code>adapter driver ftdi\nadapter speed 10000\nftdi_vid_pid 0x0403 0x6014\nftdi_layout_init 0x0008 0x004b\n\nsource [find cpld/xilinx-xc7.cfg]\ninit\nxc7_program xc7.tap\npld load 0 /path/to/bitstream.bit\nshutdown\n</code></pre> <p>\u4e0a\u9762\u7684 ftdi \u5f00\u5934\u7684\u4e24\u884c\u6309\u7167\u5b9e\u9645\u7684 JTAG Adapter \u4fee\u6539\u3002\u53ef\u4ee5\u53c2\u8003 openocd \u81ea\u5e26\u7684\u4e00\u4e9b cfg\u3002</p> <p>\u7136\u540e\u5728 openocd.cfg \u7684\u76ee\u5f55\u8fd0\u884c <code>openocd</code> \u5373\u53ef\uff1a</p> <pre><code>$ openocd\nOpen On-Chip Debugger 0.10.0+dev-01052-g09580964 (2020-02-08-15:09)\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : auto-selecting first available session transport \"jtag\". To override use 'transport select &lt;transport&gt;'.\nInfo : ftdi: if you experience problems at higher adapter clocks, try the command \"ftdi_tdo_sample_edge falling\"\nInfo : clock speed 10000 kHz\nInfo : JTAG tap: xc7.tap tap/device found: 0x0362d093 (mfg: 0x049 (Xilinx), part: 0x362d, ver: 0x0)\nWarn : gdb services need one or more targets defined\nshutdown command invoked\nInfo : Listening on port 6666 for tcl connections\nInfo : Listening on port 4444 for telnet connections\n</code></pre> <p>\u8fd9\u65f6 FPGA \u5df2\u7ecf\u70e7\u5199\u6210\u529f\u3002</p> <p>\u53c2\u8003\uff1a</p> <ol> <li>https://pansila.github.io/posts/7db4884d</li> <li>https://numato.com/kb/programming-mimas-a7-using-openocd-and-xc3sprog/</li> </ol> <p>\u66f4\u65b0\uff1aOpenOCD \u5df2\u7ecf\u66f4\u65b0\u5230 0.11.0\uff0c\u5bf9\u4e8e Arty A7\uff0c\u91c7\u7528\u4e0b\u9762\u7684\u811a\u672c\u8fdb\u884c\u70e7\u5199\uff1a</p> <pre><code># OpenOCD 0.11.0\n# Adapted from: interface/ftdi/digilent-hs1.cfg\n# See also: board/arty_s7.cfg\nadapter driver ftdi\nadapter speed 25000\nftdi_vid_pid 0x0403 0x6010\nftdi_channel 0\nftdi_layout_init 0x0088 0x008b\nreset_config none\n\nsource [find cpld/xilinx-xc7.cfg]\ninit\npld load 0 ./bitstream.bit\nshutdown\n</code></pre> <p>\u6210\u529f\u8f93\u51fa\uff1a</p> <pre><code>$ openocd\nOpen On-Chip Debugger 0.11.0\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : auto-selecting first available session transport \"jtag\". To override use 'transport select &lt;transport&gt;'.\nInfo : ftdi: if you experience problems at higher adapter clocks, try the command \"ftdi_tdo_sample_edge falling\"\nInfo : clock speed 25000 kHz\nInfo : JTAG tap: xc7.tap tap/device found: 0x0362d093 (mfg: 0x049 (Xilinx), part: 0x362d, ver: 0x0)\nWarn : gdb services need one or more targets defined\nshutdown command invoked\nInfo : Listening on port 6666 for tcl connections\nInfo : Listening on port 4444 for telnet connections\n</code></pre>","tags":["openocd","fpga","artix7","macos"]},{"location":"hardware/2019/08/02/pulseview-dslogic/","title":"\u7528 PulseView \u914d\u5408 DSLogic \u8c03\u8bd5 SPI Flash","text":"<p>\u6700\u8fd1\u9700\u8981\u7528\u5230\u903b\u8f91\u5206\u6790\u4eea\u6765\u8c03\u8bd5 SPI Flash\uff0c\u8bbe\u5907\u662f DreamSourceLab \u7684 DSLogic\uff0c\u6700\u5f00\u59cb\u7528\u7684\u662f\u5b98\u65b9\u7684 DSView\uff0c\u786e\u5b9e\u80fd\u591f\u6293\u5230 SPI \u7684\u4fe1\u53f7\uff0c\u4e5f\u53ef\u4ee5\u89e3\u6790\u51fa\u4e00\u4e9b SPI Flash \u7684\u6570\u636e\uff0c\u4f46\u662f\u5f88\u591a\u662f\u4e0d\u5b8c\u6574\u7684\u3002</p> <p>\u540e\u6765\u628a\u6e90\u7801\u4e0b\u8f7d\u4e0b\u6765\uff0c\u53d1\u73b0\u662f\u57fa\u4e8e sigrok \u548c PulseView \u505a\u7684\u4e00\u4e2a\u9b54\u6539\u7248\uff0c\u7136\u540e sigrok \u5b98\u7f51\u4e0a\u6700\u65b0\u7684\u7248\u672c\u5df2\u7ecf\u652f\u6301\u4e86 DSLogic\uff0c\u4e8e\u662f\u5c31\u7528 PulseView \u66ff\u4ee3 DSView\u3002\u4e00\u5f00\u59cb\u9047\u5230\u7684\u95ee\u9898\u662f\u6ca1\u6709 firmware\uff0c\u4e00\u756a\u641c\u7d22\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\uff0c\u6309\u7167\u811a\u672c\u4e0b\u8f7d\u597d\u6587\u4ef6\u5373\u53ef\u3002</p> <p>\u8fdb\u5230 PulseView \u4ee5\u540e\uff0c\u628a SPI \u7684\u56db\u8def\u4fe1\u53f7\u63a5\u4e0a\uff0c\u7136\u540e\u6293\u4e86\u4e00\u6bb5\u4fe1\u53f7\uff0c\u89e3\u6790\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5b83\u6b63\u786e\u5730\u89e3\u6790\u51fa\u6765\u4e86 Fast Read \u547d\u4ee4\u3002\u7531\u4e8e DSView \u5b83 fork \u81ea\u4e00\u4e2a\u6bd4\u8f83\u8001\u7684\u7248\u672c\uff0c\u6240\u4ee5\u5b83\u5e76\u4e0d\u80fd\u6b63\u786e\u89e3\u6790\u51fa\u6765\u3002</p> <p>P.S. Linux \u4e0b\u5b83\u754c\u9762\u663e\u793a\u6bd4 macOS \u4e0b\u597d\u770b\u4e00\u4e9b\uff0c\u4f30\u8ba1\u662f\u6ca1\u6709\u9002\u914d\u597d\u3002</p>","tags":["la","logicanalyzer","sigrok","pulseview"]},{"location":"hardware/2024/09/01/qualcomm_oryon/","title":"Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b","text":"","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u501f\u5230\u4e00\u53f0 Surface Laptop 7 \u53ef\u4ee5\u62ff\u6765\u6298\u817e\uff0c\u5b83\u7528\u7684\u662f\u9ad8\u901a Snapdragon X Elite \u5904\u7406\u5668\uff0c\u501f\u6b64\u673a\u4f1a\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u5fae\u67b6\u6784\u5728\u5404\u4e2a\u65b9\u9762\u7684\u8868\u73b0\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u5b98\u65b9\u4fe1\u606f","title":"\u5b98\u65b9\u4fe1\u606f","text":"<p>\u9ad8\u901a\u5173\u4e8e Oryon \u5fae\u67b6\u6784\u6709\u4e24\u4e2a slides\uff0c\u5185\u5bb9\u53ef\u4ee5\u5728\u4ee5\u4e0b\u7684\u94fe\u63a5\u4e2d\u770b\u5230\uff1a</p> <ul> <li>The Qualcomm Snapdragon X Architecture Deep Dive: Getting To Know Oryon and Adreno X1 - Anandtech</li> <li>Hot Chips 2024: Qualcomm\u2019s Oryon Core - Chips and Cheese</li> </ul> <p>\u4e24\u6b21\u5185\u5bb9\u5927\u4f53\u4e00\u81f4\uff0cHot Chips 2024 \u7684\u5185\u5bb9\u66f4\u52a0\u8be6\u7ec6\uff0c\u4f46\u4e5f\u51fa\u73b0\u4e86\u4e00\u4e9b\u524d\u540e\u77db\u76fe\u7684\u5730\u65b9\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u73b0\u6709\u8bc4\u6d4b","title":"\u73b0\u6709\u8bc4\u6d4b","text":"<p>\u7f51\u4e0a\u5df2\u7ecf\u6709\u8f83\u591a\u9488\u5bf9 Oryon \u5fae\u67b6\u6784\u7684\u8bc4\u6d4b\u548c\u5206\u6790\uff0c\u5efa\u8bae\u9605\u8bfb\uff1a</p> <ul> <li>\u9ad8\u901a X Elite Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b\uff1a\u8d70\u8d70\u505c\u505c</li> <li>Qualcomm\u2019s Oryon Core: A Long Time in the Making</li> <li>Qualcomm\u2019s Oryon LLVM Patches</li> <li>\u9ad8\u901a\u81ea\u7814 PC \u82af\u7247 X Elite \u5b9e\u6d4b\uff1a\u771f\u80fd\u5e72\u7ffb\u82f9\u679c\u82f1\u7279\u5c14\uff1f</li> <li>\u592a\u8d35\u4e86\uff0c\u5b83\u6ca1\u4f60\u60f3\u7684\u90a3\u4e48\u7f8e\u597d\uff01\u9ad8\u901a\u9a81\u9f99 X Elite 78-100 \u7b14\u8bb0\u672c\u8be6\u7ec6\u8bc4\u6d4b</li> <li>Snapdragon X Elite</li> <li>Qualcomm Oryon CPU</li> </ul> <p>\u4e0b\u9762\u5206\u5404\u4e2a\u6a21\u5757\u5206\u522b\u8bb0\u5f55\u5b98\u65b9\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5b9e\u6d4b\u7684\u7ed3\u679c\u3002\u8bfb\u8005\u53ef\u4ee5\u5bf9\u7167\u5df2\u6709\u7684\u7b2c\u4e09\u65b9\u8bc4\u6d4b\u7406\u89e3\u3002\u5b98\u65b9\u4fe1\u606f\u4e0e\u5b9e\u6d4b\u7ed3\u679c\u4e00\u81f4\u7684\u6570\u636e\u4f1a\u52a0\u7c97\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#benchmark","title":"Benchmark","text":"<p>Qualcomm Oryon \u7684\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\u89c1 SPEC\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u524d\u7aef","title":"\u524d\u7aef","text":"","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u53d6\u6307","title":"\u53d6\u6307","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a\u53d6\u6307\u53ef\u4ee5\u8fbe\u5230\u6bcf\u5468\u671f\u6700\u591a 16 \u6307\u4ee4</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u5b9e\u9645\u7684 Fetch \u5bbd\u5ea6\uff0c\u53c2\u8003 \u5982\u4f55\u6d4b\u91cf\u771f\u6b63\u7684\u53d6\u6307\u5e26\u5bbd\uff08I-fetch width\uff09 - JamesAslan \u6784\u9020\u4e86\u6d4b\u8bd5\u3002</p> <p>\u5176\u539f\u7406\u662f\u5f53 Fetch \u8981\u8de8\u9875\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4e24\u4e2a\u76f8\u90bb\u9875\u53ef\u80fd\u6620\u5c04\u5230\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u5982\u679c\u8981\u652f\u6301\u5355\u5468\u671f\u8de8\u9875\u53d6\u6307\uff0c\u9700\u8981\u67e5\u8be2\u4e24\u6b21 ITLB\uff0c\u6216\u8005 ITLB \u9700\u8981\u628a\u76f8\u90bb\u4e24\u4e2a\u9875\u7684\u6620\u5c04\u5b58\u5728\u4e00\u8d77\u3002\u8fd9\u4e2a\u573a\u666f\u4e00\u822c\u6bd4\u8f83\u5c11\uff0c\u5904\u7406\u5668\u5f88\u5c11\u4f1a\u9488\u5bf9\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u505a\u4f18\u5316\uff0c\u4f46\u4e5f\u4e0d\u662f\u6ca1\u6709\u3002\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u628a\u5faa\u73af\u653e\u5728\u4e24\u4e2a\u9875\u7684\u8fb9\u754c\u4e0a\uff0c\u53d1\u73b0 Oryon \u5fae\u67b6\u6784\u9047\u5230\u8de8\u9875\u7684\u53d6\u6307\u65f6\u786e\u5b9e\u4f1a\u62c6\u6210\u4e24\u4e2a\u5468\u671f\u6765\u8fdb\u884c\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u6784\u9020\u4e00\u4e2a\u5faa\u73af\uff0c\u5faa\u73af\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u653e\u5728\u7b2c\u4e00\u4e2a\u9875\u7684\u6700\u540e\u56db\u4e2a\u5b57\u8282\uff0c\u5176\u4f59\u6307\u4ee4\u653e\u7b2c\u4e8c\u4e2a\u9875\u4e0a\uff0c\u90a3\u4e48\u6bcf\u6b21\u5faa\u73af\u7684\u53d6\u6307\u65f6\u95f4\uff0c\u5c31\u662f\u4e00\u4e2a\u5468\u671f\uff08\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u9875\u5185\u7684\u6307\u4ee4\uff09\u52a0\u4e0a\u7b2c\u4e8c\u4e2a\u9875\u5185\u6307\u4ee4\u9700\u8981 Fetch \u7684\u5468\u671f\u6570\uff0c\u591a\u7684\u8fd9\u4e00\u4e2a\u5468\u671f\u5c31\u8db3\u4ee5\u628a Fetch \u5bbd\u5ea6\u4ece\u540e\u7aef\u9650\u5236\u4e2d\u533a\u5206\u5f00\uff0c\u5b9e\u9a8c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u56fe\u4e2d\u84dd\u7ebf\uff08cross-page\uff09\u8868\u793a\u7684\u5c31\u662f\u4e0a\u9762\u6240\u8ff0\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u653e\u4e00\u4e2a\u9875\uff0c\u5176\u4f59\u6307\u4ee4\u653e\u7b2c\u4e8c\u4e2a\u9875\u7684\u60c5\u51b5\uff0c\u6a2a\u5750\u6807\u662f\u7b2c\u4e8c\u4e2a\u9875\u5185\u7684\u6307\u4ee4\u6570\uff0c\u90a3\u4e48\u4e00\u6b21\u5faa\u73af\u7684\u6307\u4ee4\u6570\u7b49\u4e8e\u6a2a\u5750\u6807 +1\u3002\u7eb5\u5750\u6807\u662f\u8fd0\u884c\u5f88\u591a\u6b21\u5faa\u73af\u7684\u603b cycle \u6570\u9664\u4ee5\u5faa\u73af\u6b21\u6570\uff0c\u4e5f\u5c31\u662f\u5e73\u5747\u6bcf\u6b21\u5faa\u73af\u8017\u8d39\u7684\u5468\u671f\u6570\u3002\u53ef\u4ee5\u770b\u5230\u6bcf 16 \u6761\u6307\u4ee4\u4f1a\u591a\u4e00\u4e2a\u5468\u671f\uff0c\u56e0\u6b64 Oryon \u7684\u524d\u7aef\u53d6\u6307\u5bbd\u5ea6\u786e\u5b9e\u662f 16 \u6761\u6307\u4ee4\u3002</p> <p>\u4e3a\u4e86\u786e\u8ba4\u8fd9\u4e2a\u74f6\u9888\u662f\u7531\u53d6\u6307\u9020\u6210\u7684\uff0c\u53c8\u6784\u9020\u4e86\u4e00\u7ec4\u5b9e\u9a8c\uff0c\u628a\u5faa\u73af\u7684\u6240\u6709\u6307\u4ee4\u90fd\u653e\u5230\u4e00\u4e2a\u9875\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019 Fetch \u4e0d\u518d\u6210\u4e3a\u74f6\u9888\uff08\u56fe\u4e2d aligned\uff09\uff0c\u4e24\u4e2a\u66f2\u7ebf\u7684\u5bf9\u6bd4\u53ef\u4ee5\u660e\u786e\u5730\u5f97\u51fa\u4e0a\u8ff0\u7ed3\u8bba\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l1-icache","title":"L1 ICache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a192KB 6-way L1 ICache</p> <p>\u4e3a\u4e86\u6d4b\u8bd5 L1 ICache \u5bb9\u91cf\uff0c\u6784\u9020\u4e00\u4e2a\u5177\u6709\u5de8\u5927\u6307\u4ee4 footprint \u7684\u5faa\u73af\uff0c\u7531\u5927\u91cf\u7684 nop \u548c\u6700\u540e\u7684\u5206\u652f\u6307\u4ee4\u7ec4\u6210\u3002\u89c2\u5bdf\u5728\u4e0d\u540c footprint \u5927\u5c0f\u4e0b\u7684 IPC\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 footprint \u5728 192 KB \u4e4b\u524d\u65f6\u53ef\u4ee5\u8fbe\u5230 8 IPC\uff0c\u4e4b\u540e\u5219\u5feb\u901f\u964d\u5230 2 IPC\uff0c\u8fd9\u91cc\u7684 192 KB \u5c31\u5bf9\u5e94\u4e86 L1 ICache \u7684\u5bb9\u91cf\u3002\u867d\u7136 Fetch \u53ef\u4ee5\u6bcf\u5468\u671f 16 \u6761\u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u4e00\u6761 64B \u7684\u7f13\u5b58\u884c\uff0c\u7531\u4e8e\u540e\u7aef\u7684\u9650\u5236\uff0c\u53ea\u80fd\u89c2\u5bdf\u5230 8 \u7684 IPC\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l1-itlb","title":"L1 ITLB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a256-entry 8-way L1 ITLB\uff0c\u652f\u6301 4KB \u548c 64KB \u7684\u9875\u8868\u5927\u5c0f</p> <p>\u6784\u9020\u4e00\u7cfb\u5217\u7684 B \u6307\u4ee4\uff0c\u4f7f\u5f97 B \u6307\u4ee4\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 ITLB \u6210\u4e3a\u74f6\u9888\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 256 Page \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 256 \u7684 L1 ITLB \u5bb9\u91cf\u3002\u6ce8\u610f\u8981\u907f\u514d ICache \u548c BTB \u7684\u5bb9\u91cf\u6210\u4e3a\u74f6\u9888\uff0c\u628a B \u6307\u4ee4\u5206\u5e03\u5728\u4e0d\u540c\u7684 Cache Line \u548c BTB entry \u4e0a\u3002</p> <p>\u5982\u679c\u6bcf\u4e24\u4e2a page \u653e\u4e00\u6761 B \u6307\u4ee4\uff0c\u5bb9\u91cf\u51cf\u5c0f\u5230 128 Page\uff1b\u8fdb\u4e00\u6b65\u628a B \u6307\u4ee4\u653e\u5f97\u66f4\u52a0\u7a00\u758f\uff0c\u6700\u7ec8\u5728\u6bcf 32 \u4e2a page \u653e\u4e00\u6761 B \u6307\u4ee4\u65f6\uff0c\u5bb9\u91cf\u51cf\u5230 8 Page\uff0c\u4e4b\u540e\u4e0d\u518d\u51cf\u5c0f\u3002\u8bf4\u660e L1 ITLB \u662f 32 Set 8 Way\uff0cIndex \u662f PC[16:12]\u3002\u8fd9\u662f\u9875\u8868\u5927\u5c0f\u4e3a 4KB \u7684\u60c5\u51b5\uff0c64KB \u6ca1\u6709\u6d4b\u8bd5\uff0c\u9884\u8ba1\u662f\u7c7b\u4f3c\u7684\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#decode","title":"Decode","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a8 inst/cycle decoded</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#return-stack","title":"Return Stack","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a50-entry return stack</p> <p>\u6784\u9020\u4e0d\u540c\u6df1\u5ea6\u7684\u8c03\u7528\u94fe\uff0c\u6d4b\u8bd5\u6bcf\u6b21\u8c03\u7528\u82b1\u8d39\u7684\u5e73\u5747\u65f6\u95f4\uff0c\u5f97\u5230\u4e0b\u9762\u7684\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8c03\u7528\u94fe\u6df1\u5ea6\u4e3a 50 \u65f6\u6027\u80fd\u7a81\u7136\u53d8\u5dee\uff0c\u56e0\u6b64 Return Stack \u6df1\u5ea6\u4e3a 50\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#branch-predictor","title":"Branch Predictor","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a80KB Conditional Predictor, 40KB Indirect Predictor</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#btb","title":"BTB","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a2K+ entry BTB</p> <p>\u6784\u9020\u5927\u91cf\u7684\u65e0\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff08B \u6307\u4ee4\uff09\uff0cBTB \u9700\u8981\u8bb0\u5f55\u8fd9\u4e9b\u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\uff0c\u90a3\u4e48\u5982\u679c\u5206\u652f\u6570\u91cf\u8d85\u8fc7\u4e86 BTB \u7684\u5bb9\u91cf\uff0c\u6027\u80fd\u4f1a\u51fa\u73b0\u660e\u663e\u4e0b\u964d\u3002\u5f53\u628a\u5927\u91cf B \u6307\u4ee4\u7d27\u5bc6\u653e\u7f6e\uff0c\u4e5f\u5c31\u662f\u6bcf 4 \u5b57\u8282\u4e00\u6761 B \u6307\u4ee4\u65f6\uff1a</p> <p></p> <p>\u53ef\u89c1\u5728 2048 \u4e2a\u5206\u652f\u4e4b\u5185\u53ef\u4ee5\u8fbe\u5230 1 \u7684 CPI\uff0c\u8d85\u8fc7 2048 \u4e2a\u5206\u652f\uff0c\u51fa\u73b0\u4e86 3 CPI \u7684\u5e73\u53f0\uff0c\u4e00\u76f4\u5ef6\u7eed\u5230 32768 \u4e2a\u5206\u652f\u6216\u66f4\u591a\u3002\u8d85\u51fa BTB \u5bb9\u91cf\u4ee5\u540e\uff0c\u5206\u652f\u9884\u6d4b\u65f6\uff0c\u65e0\u6cd5\u4ece BTB \u4e2d\u5f97\u5230\u54ea\u4e9b\u6307\u4ee4\u662f\u5206\u652f\u6307\u4ee4\u7684\u4fe1\u606f\uff0c\u53ea\u80fd\u7b49\u5230\u53d6\u6307\u751a\u81f3\u8bd1\u7801\u540e\u624d\u80fd\u540e\u77e5\u540e\u89c9\u5730\u53d1\u73b0\u8fd9\u662f\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u6027\u80fd\u635f\u5931\uff0c\u51fa\u73b0\u4e86 3 CPI \u7684\u60c5\u51b5\u3002</p> <p>\u964d\u4f4e\u5206\u652f\u6307\u4ee4\u7684\u5bc6\u5ea6\uff0c\u5728 B \u6307\u4ee4\u4e4b\u95f4\u63d2\u5165 NOP \u6307\u4ee4\uff0c\u4f7f\u5f97\u6bcf 8 \u4e2a\u5b57\u8282\u6709\u4e00\u6761 B \u6307\u4ee4\uff0c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 CPI=1 \u7684\u62d0\u70b9\u524d\u79fb\u5230 1024 \u4e2a\u5206\u652f\uff0c\u540c\u65f6 CPI=3 \u7684\u5e73\u53f0\u4e5f\u51fa\u73b0\u4e86\u65b0\u7684\u62d0\u70b9\uff0c\u5728 16384 \u548c 32768 \u4e4b\u95f4\u3002\u62d0\u70b9\u7684\u524d\u79fb\uff0c\u610f\u5473\u7740 BTB \u91c7\u7528\u4e86\u7ec4\u76f8\u8fde\u7684\u7ed3\u6784\uff0c\u5f53 B \u6307\u4ee4\u7684 PC \u7684\u90e8\u5206\u4f4e\u4f4d\u603b\u662f\u4e3a 0 \u65f6\uff0c\u7ec4\u76f8\u8fde\u7684 Index \u53ef\u80fd\u65e0\u6cd5\u53d6\u5230\u6240\u6709\u7684 Set\uff0c\u5bfc\u81f4\u8868\u73b0\u51fa\u6765\u7684 BTB \u5bb9\u91cf\u53ea\u6709\u90e8\u5206 Set\uff0c\u4f8b\u5982\u6b64\u5904\u5bb9\u91cf\u51cf\u534a\uff0c\u8bf4\u660e\u53ea\u6709\u4e00\u534a\u7684 Set \u88ab\u7528\u5230\u4e86\u3002</p> <p>\u51fa\u73b0\u65b0\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u662f\u6307\u4ee4 footprint \u8d85\u51fa L1 ICache \u7684\u60c5\u51b5\uff1aL1 ICache \u662f 192KB\uff0c\u6309\u7167\u6bcf 8 \u5b57\u8282\u4e00\u4e2a B \u6307\u4ee4\u8ba1\u7b97\uff0c\u6700\u591a\u53ef\u4ee5\u5b58\u653e 24576 \u6761 B \u6307\u4ee4\uff0c\u8fd9\u4e2a\u503c\u6b63\u597d\u5904\u5728 16384 \u548c 32768 \u4e4b\u95f4\uff0c\u548c\u62d0\u70b9\u543b\u5408\u3002</p> <p>\u5982\u679c\u8fdb\u4e00\u6b65\u964d\u4f4e B \u6307\u4ee4\u7684\u5bc6\u5ea6\uff0c\u4f7f\u5f97\u5b83\u7684\u4f4e\u82e5\u5e72\u4f4d\u90fd\u7b49\u4e8e 0\uff0c\u6700\u7ec8 CPI=1 \u7684\u62d0\u70b9\u5b9a\u683c\u5728 2 \u6761\u5206\u652f\uff0cCPI=3/3.5 \u7684\u62d0\u70b9\u5b9a\u683c\u5728 6 \u6761\u5206\u652f\u3002\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\uff0c\u8ba4\u4e3a BTB \u662f 1024 Set 2 Way \u7684\u7ed3\u6784\uff0cIndex \u662f PC[11:2]\uff1b\u540c\u65f6\u4e5f\u4fa7\u9762\u4f50\u8bc1\u4e86 192KB L1 ICache \u662f 512 Set 6 Way\uff0cIndex \u662f PC[14:6]\u3002\u4e0d\u8fc7\u8003\u8651\u5230 Oryon \u652f\u6301\u8de8 64B \u8fb9\u754c\u8bbf\u5b58\uff0c\u5b9e\u9645\u7684 L1 ICache \u5927\u6982\u7387\u662f\u5206 bank \u7684\uff0c\u8fd9\u6837\u624d\u80fd\u5728\u4fdd\u6301\u5355\u8bfb\u53e3\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u5468\u671f\u4ece\u8fde\u7eed\u7684\u4e24\u4e2a Cache Line \u4e2d\u53d6\u6307\u4ee4\u3002</p> <p>\u5c0f\u7ed3\uff1aBTB \u5bb9\u91cf\u4e3a 2048 \u9879\uff0c\u91c7\u7528 2 \u8def\u7ec4\u76f8\u8fde\u65b9\u5f0f\uff0c\u5f53\u6240\u6709\u5206\u652f\u547d\u4e2d BTB \u65f6\uff0c\u53ef\u4ee5\u8fbe\u5230 1 CPI\uff1b\u5982\u679c\u8d85\u51fa\u4e86 BTB \u5bb9\u91cf\uff0c\u4f46\u6ca1\u6709\u8d85\u51fa L1 ICache \u5bb9\u91cf\uff0c\u53ef\u4ee5\u8fbe\u5230 3 CPI\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#branch-mispredict-latency","title":"Branch Mispredict Latency","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a13 cycle Branch Mispredict Latency</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u540e\u7aef","title":"\u540e\u7aef","text":"","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u7269\u7406\u5bc4\u5b58\u5668\u5806","title":"\u7269\u7406\u5bc4\u5b58\u5668\u5806","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a400+ registers Integer pool, 400+ registers Vector pool</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u7269\u7406\u5bc4\u5b58\u5668\u5806\u7684\u5927\u5c0f\uff0c\u4e00\u822c\u4f1a\u7528\u4e24\u4e2a\u4f9d\u8d56\u94fe\u5f88\u957f\u7684\u64cd\u4f5c\u653e\u5728\u5f00\u5934\u548c\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u586b\u5165\u82e5\u5e72\u4e2a\u65e0\u5173\u7684\u6307\u4ee4\uff0c\u5e76\u4e14\u7528\u8fd9\u4e9b\u6307\u4ee4\u6765\u8017\u8d39\u7269\u7406\u5bc4\u5b58\u5668\u5806\u3002\u6d4b\u8bd5\u7ed3\u679c\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <ul> <li>32b/64b int\uff1a\u6d4b\u8bd5 32/64 \u4f4d\u6574\u6570\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 362-374</li> <li>fp\uff1a\u6d4b\u8bd5\u6d6e\u70b9\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 362-372</li> <li>flags\uff1a\u6d4b\u8bd5 NZCV \u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u62d0\u70b9\u5728 119-126</li> </ul> <p>\u53ef\u89c1\u6574\u6570\u548c\u6d6e\u70b9\u6570\u90fd\u80fd\u63d0\u4f9b\u5927\u7ea6 360+ \u4e2a\u5bc4\u5b58\u5668\u7528\u4e8e\u4e71\u5e8f\u6267\u884c\uff0c\u52a0\u4e0a\u7528\u4e8e\u4fdd\u5b58\u67b6\u6784\u5bc4\u5b58\u5668\u7684\u81f3\u5c11 32 \u4e2a\u5bc4\u5b58\u5668\uff0c\u52a0\u8d77\u6765\u548c\u9ad8\u901a\u5ba3\u79f0\u7684 400+ \u662f\u6bd4\u8f83\u4e00\u81f4\u7684\u3002\u6574\u6570\u548c\u6d6e\u70b9\u4e2a\u6570\u6d4b\u51fa\u6765\u4e00\u6837\uff0c\u53ef\u80fd\u662f\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u5806\u5927\u5c0f\u4e00\u6837\uff0c\u4e5f\u53ef\u80fd\u662f\u6574\u6570\u548c\u6d6e\u70b9\u653e\u540c\u4e00\u4e2a\u5bc4\u5b58\u5668\u5806\u4e2d\u3002\u7ecf\u8fc7\u6df7\u5408\u6574\u6570\u548c\u6d6e\u70b9\u6307\u4ee4\u6d4b\u8bd5\uff0c\u8ba4\u4e3a\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u5806\u5e76\u4e0d\u5171\u4eab\uff0c\u53ea\u662f\u6570\u91cf\u5dee\u4e0d\u591a\u3002</p> <p>NZCV \u91cd\u547d\u540d\u5219\u6bd4\u6574\u6570\u5bc4\u5b58\u5668\u5c11\u5f97\u591a\uff0c\u53ea\u6709 120+\uff0c\u4e5f\u662f\u8003\u8651\u5230 ARMv8 \u6307\u4ee4\u96c6\u5927\u90e8\u5206\u6307\u4ee4\u4e0d\u50cf X86 \u90a3\u6837\u4f1a\u4fee\u6539 NZCV\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#reservation-stations","title":"Reservation Stations","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>IXU 6-wide 64-bit, each with 20 entry queue</li> <li>VXU 4-wide 128-bit, each with 48 entry queue</li> <li>LSU 4-wide 128-bit, each with 16 entry queue (\u6ce8\uff1aHot Chips \u4e0a\u7684 Slides \u5199\u7684\u662f\u56db\u4e2a 64-entry\uff0c\u51fa\u73b0\u4e86\u4e0d\u4e00\u81f4)</li> </ul>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#\u6267\u884c\u5355\u5143","title":"\u6267\u884c\u5355\u5143","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>Up to 6 ALU/cycle</li> <li>Up to 2 Branch/cycle</li> <li>Up to 2 multiply/MLA per cycle</li> </ul> <p>\u5728\u5faa\u73af\u4e2d\u91cd\u590d\u4e0b\u5217\u6307\u4ee4\u591a\u6b21\uff0c\u6d4b\u91cf CPI\uff0c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <ul> <li><code>add x0, x0, 1</code>\uff1aCPI = 6.0\uff0c\u8bf4\u660e\u53ef\u4ee5 6 ALU/cycle</li> <li><code>cbnz xzr, target;target:</code>\uff1aCPI = 2.0\uff0c\u8bf4\u660e\u53ef\u4ee5 2 Branch/cycle\uff0c\u6ce8\u610f\u8fd9\u91cc\u662f not taken \u5206\u652f</li> <li><code>mul x0, x1, x2</code>\uff1aCPI = 2.0\uff0c\u8bf4\u660e\u53ef\u4ee5 2 Multiply/cycle</li> </ul>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#reorder-buffer","title":"Reorder Buffer","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>Retirement 8 uOps/cycle</li> <li>Reorder Buffer is 650+ uOps</li> </ul> <p>\u4e3a\u4e86\u6d4b\u8bd5 ROB \u7684\u5927\u5c0f\uff0c\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u5faa\u73af\uff0c\u5faa\u73af\u5f00\u59cb\u662f 8 \u6761\u4e32\u884c\u7684 fsqrt \u6307\u4ee4\uff0c\u6bcf\u6761\u6307\u4ee4\u9700\u8981 13 \u4e2a\u5468\u671f\uff0c\u7531\u4e8e\u6570\u636e\u4f9d\u8d56\uff0c\u4e00\u5171\u9700\u8981 8*13=104 \u4e2a\u5468\u671f\u5b8c\u6210\u3002\u4e4b\u540e\u662f\u82e5\u5e72\u6761 NOP \u6307\u4ee4\uff0c\u5f53 NOP \u6307\u4ee4\u6bd4\u8f83\u5c11\u65f6\uff0c\u5faa\u73af\u7684\u65f6\u5019\u53d6\u51b3\u4e8e fsqrt \u6307\u4ee4\u7684\u65f6\u95f4\uff0c\u4e00\u6b21\u5faa\u73af\u5927\u7ea6\u9700\u8981 104 \u4e2a\u5468\u671f\uff1b\u5f53 NOP \u6307\u4ee4\u6570\u91cf\u8fc7\u591a\uff0c\u586b\u6ee1\u4e86 ROB \u4ee5\u540e\uff0c\u5c31\u4f1a\u5bfc\u81f4 ROB \u65e0\u6cd5\u4fdd\u5b58\u4e0b\u4e00\u6b21\u5faa\u73af\u7684 fsqrt \u6307\u4ee4\uff0c\u6027\u80fd\u51fa\u73b0\u4e0b\u964d\u3002\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5f53 NOP \u6570\u91cf\u8fbe\u5230 676 \u65f6\uff0c\u6027\u80fd\u5f00\u59cb\u6025\u5267\u4e0b\u6ed1\uff0c\u800c\u6267\u884c 676 \u6761 NOP \u53ea\u9700\u8981 676/8=84.5 \u4e2a\u5468\u671f\uff0c\u5c0f\u4e8e 104 \u4e2a\u5468\u671f\uff0c\u8bf4\u660e\u74f6\u9888\u4e0d\u5728\u6267\u884c NOP \u4e0a\uff0c\u800c\u662f\u56e0\u4e3a ROB \u88ab\u586b\u6ee1\uff0c\u5bfc\u81f4\u540e\u7eed\u7684 fsqrt \u6307\u4ee4\u65e0\u6cd5\u53ca\u65f6\u6267\u884c\u3002\u56e0\u6b64\u8ba4\u4e3a Oryon \u7684 ROB \u5927\u5c0f\u5728 680+\u3002</p> <p>\u6ca1\u6709\u89c2\u5bdf\u5230\u7c7b\u4f3c Firestorm \u7684 Coalesced ROB \u7684\u8bbe\u8ba1\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#load-store-unit--l1-dcache","title":"Load Store Unit + L1 DCache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>96KB 6-way L1 DCache</li> <li>224-entry 7-way L1 DTLB, supports 4KB and 64KB translation granules</li> <li>Up to 4 Load-Store operations per cycle</li> <li>192 entry Load Queue, 56 entry Store Queue</li> <li>Full 64B/cycle for both fills and evictions to L2 cache</li> </ul>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l1-dcache-\u5bb9\u91cf","title":"L1 DCache \u5bb9\u91cf","text":"<p>\u6784\u9020\u4e0d\u540c\u5927\u5c0f footprint \u7684 pointer chasing \u94fe\uff0c\u6d4b\u8bd5\u4e0d\u540c footprint \u4e0b\u6bcf\u6761 load \u6307\u4ee4\u8017\u8d39\u7684\u65f6\u95f4\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 96KB \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 96KB \u7684 L1 DCache \u5bb9\u91cf\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l1-dtlb-\u5bb9\u91cf","title":"L1 DTLB \u5bb9\u91cf","text":"<p>\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6d4b\u8bd5 L1 DTLB \u5bb9\u91cf\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21 pointer chasing \u94fe\u7684\u6307\u9488\u5206\u5e03\u5728\u4e0d\u540c\u7684 page \u4e0a\uff0c\u4f7f\u5f97 DTLB \u6210\u4e3a\u74f6\u9888\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 224 Page \u51fa\u73b0\u4e86\u660e\u663e\u7684\u62d0\u70b9\uff0c\u5bf9\u5e94\u7684\u5c31\u662f 224 \u7684 L1 DTLB \u5bb9\u91cf\u3002\u4ece\u6bcf\u4e2a page \u4e00\u4e2a\u6307\u9488\u6539\u6210\u6bcf 32 page \u4e00\u4e2a\u6307\u9488\u5e76\u6ce8\u610f\u5bf9\u9f50\u5c3d\u91cf\u4fdd\u8bc1 Index \u4e3a 0\uff0c\u6b64\u65f6 L1 DTLB \u5bb9\u91cf\u964d\u4e3a 7\uff0c\u8bf4\u660e L1 DTLB \u662f 7 \u8def\u7ec4\u76f8\u8fde\u7ed3\u6784\uff0c32 \u4e2a Set\uff0cIndex \u4f4d\u662f VA[16:12]\uff0c\u8fd9\u4e9b\u9875\u88ab\u6620\u5c04\u5230\u4e86\u76f8\u540c\u7684 Set \u5f53\u4e2d\uff1a</p> <p></p> <p>\u6a2a\u5ea7\u6807\u4e3a 8\uff0c\u4e5f\u5c31\u662f\u6709 8 \u4e2a\u9875\u65f6\uff0c\u6b64\u65f6\u8fd9 8 \u4e2a\u9875\u90fd\u6620\u5c04\u5230\u540c\u4e00\u4e2a set \u5f53\u4e2d\uff0c\u6709\u56db\u5206\u4e4b\u4e00\u7684\u6982\u7387\u4f1a\u51fa\u73b0 L1 DTLB miss\uff0c\u6b64\u65f6 load latency \u662f 11 cycle\uff0c\u5269\u4e0b\u56db\u5206\u4e4b\u4e09\u7684\u6982\u7387 L1 DTLB hit\uff0cload latency \u662f 3 cycle\uff0c\u52a0\u6743\u5e73\u5747\u4e0b\u6765\u5f97\u5230 <code>11*1/4+3*3/4=5</code>\uff0c\u7b26\u5408\u9884\u671f\u3002\u8fd9\u4e2a\u56db\u5206\u4e4b\u4e00\u5bf9\u5e94\u4e86\u67d0\u79cd\u66ff\u6362\u7b56\u7565\u3002\u4ece\u6a2a\u5ea7\u6807\u4e3a 9 \u5f00\u59cb\uff0c\u5219\u6240\u6709\u8bbf\u95ee\u90fd\u51fa\u73b0 L1 DTLB miss\uff0c\u5ef6\u8fdf\u964d\u4f4e\u5230 11 cycle\uff0c\u8fd9\u4ee3\u8868\u4e86 L1 DTLB miss\uff0cL2 Unified TLB hit \u7684\u5ef6\u8fdf\u3002</p> <p>\u547d\u4e2d L1 DTLB \u65f6\u6bcf\u6761 Load \u6307\u4ee4\u662f 3 cycle\uff0c\u610f\u5473\u7740\u9ad8\u901a\u5b9e\u73b0\u4e86 3 cycle \u7684 pointer chasing load to use latency\uff0c\u8fd9\u4e2a\u7279\u6027\u5728\u82f9\u679c\uff0cExynos M-series \u548c Intel \u7684 E-core \u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u9488\u5bf9\u8fd9\u4e2a\u4f18\u5316\u7684\u8ba8\u8bba\uff0c\u8be6\u89c1 \u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09 \u7684 Load Pipeline \u5c0f\u8282\u3002\u5728\u5176\u4ed6\u573a\u666f\u4e0b\uff0c\u4f9d\u7136\u662f 4 cycle \u7684 load to use latency\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#loadstore-\u5e26\u5bbd","title":"Load/Store \u5e26\u5bbd","text":"<p>\u9488\u5bf9 Load Store \u5e26\u5bbd\uff0c\u5b9e\u6d4b\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u5b8c\u6210\uff1a</p> <ul> <li>4x 128b Load</li> <li>3x 128b Load + 1x 128b Store</li> <li>2x 128b Load + 2x 128b Store</li> <li>1x 128b Load + 2x 128b Store</li> <li>2x 128b Store</li> </ul> <p>\u5982\u679c\u628a\u6bcf\u6761\u6307\u4ee4\u7684\u8bbf\u5b58\u4f4d\u5bbd\u4ece 128b \u6539\u6210 256b\uff0c\u8bfb\u5199\u5e26\u5bbd\u4e0d\u53d8\uff0c\u6307\u4ee4\u541e\u5410\u51cf\u534a\u3002\u4e5f\u5c31\u662f\u8bf4\u6700\u5927\u7684\u8bfb\u5e26\u5bbd\u662f 64B/cyc\uff0c\u6700\u5927\u7684\u5199\u5e26\u5bbd\u662f 32B/cyc\uff0c\u4e8c\u8005\u4e0d\u80fd\u540c\u65f6\u8fbe\u5230\u3002</p> <p>\u4e0d\u592a\u786e\u5b9a\u7684\u662f\u9ad8\u901a\u5b98\u65b9\u7684\u8868\u8ff0\u91cc <code>Up to 4 Load-Store operations per cycle</code> \u5bf9\u4e8e 4 Store ops per cycle \u4ee5\u4ec0\u4e48\u65b9\u5f0f\u6210\u7acb\uff0c\u56e0\u4e3a\u4ece IPC \u6765\u770b\uff0c\u53ea\u80fd\u8fbe\u5230 2 Store Per Cycle\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l1-dcache-\u5206-bank","title":"L1 DCache \u5206 Bank","text":"<p>\u8003\u8651\u5230 L1 DCache \u9700\u8981\u5355\u5468\u671f\u652f\u6301 4 \u6761 Load \u6307\u4ee4\uff0c\u5982\u679c\u8981\u7528\u5355\u8bfb\u53e3\u7684 SRAM\uff0c\u4e00\u822c\u7684\u505a\u6cd5\u662f\u8bbe\u8ba1 4 \u4e2a Bank\uff0c\u6bcf\u4e2a Bank \u5bf9\u5e94\u4e00\u7ec4 SRAM\u3002\u4e3a\u4e86\u6d4b\u8bd5 Bank \u7684\u7c92\u5ea6\uff0c\u4f7f\u7528\u4e0d\u540c\u8de8\u6b65\uff08Stride\uff09\u7684 Load\uff0c\u89c2\u5bdf IPC\uff1a</p> <ul> <li>Stride=1B/2B/4B/8B/16B/32B/64B \u65f6 IPC=4</li> <li>Stride=128B \u65f6 IPC=2</li> <li>Stride=256B \u65f6 IPC=1</li> </ul> <p>\u5f53\u591a\u4e2a Load \u8bbf\u95ee\u540c\u4e00\u4e2a Cache Line \u65f6\uff0c\u8fd9\u4e9b Load \u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\uff0c\u6781\u9650\u60c5\u51b5\u4e0b\u7528 4 \u6761 128b Load \u53ef\u4ee5\u505a\u5230\u4e00\u4e2a\u5468\u671f\u628a\u6574\u4e2a 64B Cache Line \u90fd\u8bfb\u51fa\u6765\uff1bStride=128B \u65f6\uff0cIPC \u780d\u534a\uff0c\u8bf4\u660e\u53ea\u6709\u4e00\u534a\u7684 Bank \u5f97\u5230\u4e86\u5229\u7528\uff0c\u8fdb\u4e00\u6b65 Stride=256B \u65f6\uff0cIPC=1\uff0c\u8bf4\u660e\u53ea\u6709\u4e00\u4e2a Bank \u88ab\u7528\u4e0a\u3002\u90a3\u4e48 L1 DCache \u7684\u7ec4\u7ec7\u65b9\u5f0f\u5e94\u8be5\u662f 4 \u4e2a Bank\uff0cBank Index \u5bf9\u5e94 PA[7:6]\uff0c\u4e5f\u5c31\u662f\u8fde\u7eed\u7684\u56db\u4e2a 64B Cache Line \u4f1a\u88ab\u6620\u5c04\u5230\u56db\u4e2a Bank \u4e0a\u3002\u5f53\u591a\u4e2a Load \u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a Bank \u4e14\u8bbf\u95ee\u7684\u4e0d\u662f\u540c\u4e00\u4e2a Cache Line \u65f6\uff0c\u4f1a\u51fa\u73b0\u6027\u80fd\u635f\u5931\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#vipt","title":"VIPT","text":"<p>\u5728 4KB page \u7684\u60c5\u51b5\u4e0b\uff0c96KB 6-way \u7684 L1 DCache \u4e0d\u6ee1\u8db3 VIPT \u7684 Index \u5168\u5728\u9875\u5185\u504f\u79fb\u7684\u6761\u4ef6\uff08\u8be6\u89c1 VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb\uff09\uff0c\u6b64\u65f6\u8981\u4e48\u6539\u7528 PIPT\uff0c\u8981\u4e48\u5728 VIPT \u7684\u57fa\u7840\u4e0a\u5904\u7406 alias \u7684\u95ee\u9898\u3002\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e00\u70b9\uff0c\u53c2\u8003 \u6d45\u8c08\u73b0\u4ee3\u5904\u7406\u5668\u5b9e\u73b0\u8d85\u5927 L1 Cache \u7684\u65b9\u5f0f \u7684\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u7528 shm \u6784\u9020\u51fa\u4e24\u4e2a 4KB \u865a\u62df\u9875\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\u7684\u60c5\u51b5\uff0c\u7136\u540e\u5728\u4e24\u4e2a\u865a\u62df\u9875\u4e4b\u95f4 copy\uff0c\u53d1\u73b0\u76f8\u6bd4\u5728\u540c\u4e00\u4e2a\u865a\u62df\u9875\u5185 copy \u6709\u663e\u8457\u7684\u6027\u80fd\u4e0b\u964d\uff0c\u5e76\u4e14\u4ea7\u751f\u4e86\u5927\u91cf\u7684 L1 DCache Refill\uff1a</p> <pre><code>copy from aliased page = 8407465601 cycles, 321782134 refills\nbaseline = 1239053083 cycles, 20 refills\nslowdown = 6.79x\n</code></pre> <p>\u56e0\u6b64\u731c\u6d4b L1 DCache \u91c7\u7528\u7684\u662f VIPT\uff0c\u5e76\u505a\u4e86\u9488\u5bf9 alias \u7684\u6b63\u786e\u6027\u5904\u7406\u3002\u5982\u679c\u662f PIPT\uff0c\u90a3\u4e48 L1 DCache \u4f1a\u53d1\u73b0\u8fd9\u4e24\u4e2a\u9875\u5bf9\u5e94\u7684\u662f\u76f8\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u6027\u80fd\u4e0d\u4f1a\u4e0b\u964d\uff0c\u4e5f\u4e0d\u9700\u8981\u9891\u7e41\u7684 refill\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#memory-dependency-predictor","title":"Memory Dependency Predictor","text":"<p>\u4e3a\u4e86\u9884\u6d4b\u6267\u884c Load\uff0c\u9700\u8981\u4fdd\u8bc1 Load \u548c\u4e4b\u524d\u7684 Store \u8bbf\u95ee\u7684\u5185\u5b58\u6ca1\u6709 Overlap\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u9884\u6d4b\u5668\u6765\u9884\u6d4b Load \u548c Store \u4e4b\u524d\u5728\u5185\u5b58\u4e0a\u7684\u4f9d\u8d56\u3002\u53c2\u8003 Store-to-Load Forwarding and Memory Disambiguation in x86 Processors \u7684\u65b9\u6cd5\uff0c\u6784\u9020\u4e24\u4e2a\u6307\u4ee4\u6a21\u5f0f\uff0c\u5206\u522b\u5728\u5730\u5740\u548c\u6570\u636e\u4e0a\u6709\u4f9d\u8d56\uff1a</p> <ul> <li>\u6570\u636e\u4f9d\u8d56\uff0c\u5730\u5740\u65e0\u4f9d\u8d56\uff1a<code>str x3, [x1]</code> \u548c <code>ldr x3, [x2]</code></li> <li>\u5730\u5740\u4f9d\u8d56\uff0c\u6570\u636e\u65e0\u4f9d\u8d56\uff1a<code>str x2, [x1]</code> \u548c <code>ldr x1, [x2]</code></li> </ul> <p>\u521d\u59cb\u5316\u65f6\uff0c<code>x1</code> \u548c <code>x2</code> \u6307\u5411\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u91cd\u590d\u5982\u4e0a\u7684\u6307\u4ee4\u6a21\u5f0f\uff0c\u89c2\u5bdf\u5230\u591a\u5c11\u6761 <code>ldr</code> \u6307\u4ee4\u65f6\u4f1a\u51fa\u73b0\u6027\u80fd\u4e0b\u964d\uff1a</p> <p></p> <p>\u6709\u610f\u601d\u7684\u662f\uff0c\u4e24\u79cd\u6a21\u5f0f\u51fa\u73b0\u4e86\u4e0d\u540c\u7684\u9608\u503c\uff0c\u5730\u5740\u4f9d\u8d56\u7684\u9608\u503c\u662f 64\uff0c\u800c\u6570\u636e\u4f9d\u8d56\u7684\u9608\u503c\u662f 96\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#store-to-load-forwarding","title":"Store to Load Forwarding","text":"<p>\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\uff0c\u5982\u4e0b\u7684\u60c5\u51b5\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff1a</p> <p>\u5bf9\u5730\u5740 x \u7684 Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 Load \u6210\u529f\u65f6 y-x \u7684\u53d6\u503c\u8303\u56f4\uff1a</p> Store\\Load 8b Load 16b Load 32b Load 64b Load 8b Store {0} [-1,0] [-3,0] [-7,0] 16b Store [0,1] [-1,1] [-3,1] [-7,1] 32b Store [0,3] [-1,3] [-3,3] [-7,3] 64b Store [0,7] [-1,7] [-3,7] [-7,7] <p>\u4ece\u4e0a\u8868\u53ef\u4ee5\u770b\u5230\uff0c\u6240\u6709 Store \u548c Load Overlap \u7684\u60c5\u51b5\uff0c\u65e0\u8bba\u5730\u5740\u504f\u79fb\uff0c\u90fd\u80fd\u6210\u529f\u8f6c\u53d1\uff0c\u4e0d\u8fc7\u4ee3\u4ef7\u662f\u5982\u679c Load \u6216 Store \u8de8\u8d8a 64B \u7f13\u5b58\u884c\u7684\u8fb9\u754c\u65f6\u5c31\u4f1a\u8f6c\u53d1\u5931\u8d25\uff0c\u6bd5\u7adf\u5728\u53ea\u6709\u90e8\u5206\u8986\u76d6\u7684\u60c5\u51b5\u4e0b\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u9700\u8981\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u3002Apple Firestorm \u548c Qualcomm Oryon \u6bd4\u8f83\u7c7b\u4f3c\uff0c\u6240\u6709 Overlap \u60c5\u51b5\u4e0b\u90fd\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff0c\u4f46\u5373\u4f7f\u662f\u8de8\u8d8a 64B \u7f13\u5b58\u884c\u4e5f\u53ef\u4ee5\u6210\u529f\u8f6c\u53d1\uff0c\u53ea\u9700\u8981\u591a\u82b1\u8d39\u4e00\u4e2a\u5468\u671f\u3002</p> <p>\u4e00\u4e2a Load \u9700\u8981\u8f6c\u53d1\u4e24\u4e2a Store \u7684\u6570\u636e\u7684\u60c5\u51b5\u6bd4\u8f83\u5947\u602a\uff1a\u5bf9\u5730\u5740 x \u7684 32b Store \u548c\u5bf9\u5730\u5740 x+4 \u7684 32b Store \u8f6c\u53d1\u5230\u5bf9\u5730\u5740 y \u7684 64b Load\uff0c\u8981\u6c42 x%4==0\uff0c\u4e0d\u8de8\u8d8a 64B \u7f13\u5b58\u884c\uff0c\u5bf9 y-x \u9664\u4e86 Overlap \u4ee5\u5916\u6ca1\u6709\u989d\u5916\u7684\u8981\u6c42\u3002Apple Firestorm \u5219\u6ca1\u6709 x%4==0 \u8fd9\u4e2a\u5c40\u9650\u6027\uff0c\u4f46\u5728\u8de8\u8d8a 64B \u7f13\u5b58\u884c\u65f6\u4e5f\u4e0d\u80fd\u8f6c\u53d1\u3002</p> <p>\u4f46 64b Load \u5c31\u4e0d\u652f\u6301\u4ece 4 \u4e2a 16b Store \u8f6c\u53d1\u4e86\uff0c8 \u4e2a 8b Store \u4e5f\u4e0d\u652f\u6301\u3002Apple Firestorm \u5219\u90fd\u652f\u6301\uff0c\u76f8\u6bd4\u4ece\u5355\u4e2a Store \u8f6c\u53d1\u591a 1-4 \u4e2a\u5468\u671f\u3002</p> <p>\u7531\u6b64\u770b\u51fa Oryon \u548c Zen 5 \u4ee5\u53ca Neoverse V2 \u5728\u8bbe\u8ba1\u601d\u8def\u4e0a\u7684\u4e0d\u540c\uff1aOryon \u8ffd\u6c42 Load \u548c Store \u7684\u81ea\u7531\u7ec4\u5408\uff0c\u5141\u8bb8\u53ea\u6709\u4e00\u90e8\u5206\u8986\u76d6\uff0c\u4e5f\u65e0\u6240\u8c13\u5730\u5740\u504f\u79fb\u662f\u591a\u5c11\uff0c\u4f46\u4e5f\u727a\u7272\u4e86\u8de8 64B \u7f13\u5b58\u884c\u65f6\u7684\u6027\u80fd\u3002\u6b64\u5916\uff0cOryon \u9488\u5bf9\u4e00\u4e2a Load \u8f6c\u53d1\u4e24\u4e2a Store \u7684\u60c5\u51b5\u7684\u652f\u6301\u6bd4\u8f83\u7279\u522b\uff0c\u8981\u6c42 Store \u5730\u5740\u5bf9\u9f50\u5230 4B\u3002</p> <p>\u6210\u529f\u8f6c\u53d1\u65f6 9 cycle\uff0c\u6709 Overlap \u4f46\u8f6c\u53d1\u5931\u8d25\u65f6 17-23 cycle\uff0c\u8de8\u7f13\u5b58\u884c\u65f6\u8981 40+ cycle\u3002</p> <p>\u5c0f\u7ed3\uff1aQualcomm Oryon \u7684 Store to Load Forwarding\uff1a</p> <ul> <li>1 ld + 1 st: \u8981\u6c42\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>1 ld + 2 st: \u8981\u6c42 ld \u5bf9\u9f50\u5230 4B \u8fb9\u754c\u4e14\u4e0d\u8de8\u8d8a 64B \u8fb9\u754c</li> <li>1 ld + 4 st: \u4e0d\u652f\u6301</li> </ul>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#load-to-use-latency","title":"Load to use latency","text":"<p>Oryon \u7684 Load to use latency \u9488\u5bf9 pointer chasing \u573a\u666f\u505a\u4e86\u4f18\u5316\uff0c\u5728\u4e0b\u5217\u7684\u573a\u666f\u4e0b\u53ef\u4ee5\u8fbe\u5230 3 cycle:</p> <ul> <li><code>ldr x0, [x0]</code>: load \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> <li><code>ldr x0, [x0, 8]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u7acb\u5373\u6570\u504f\u79fb</li> <li><code>ldr x0, [x0, x1]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u6709\u5bc4\u5b58\u5668\u504f\u79fb</li> <li><code>ldp x0, x1, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e00\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul> <p>\u5728\u4e0b\u5217\u573a\u666f\u4e0b Load to use latency \u5219\u662f 4 cycle\uff1a</p> <ul> <li>load \u7684\u76ee\u7684\u5bc4\u5b58\u5668\u4f5c\u4e3a alu \u7684\u6e90\u5bc4\u5b58\u5668\uff08\u4e0b\u79f0 load to alu latency\uff09</li> <li><code>ldr x0, [sp, x0, lsl #3]</code>\uff1aload \u7ed3\u679c\u8f6c\u53d1\u5230 index</li> </ul> <p>\u5728\u4e0b\u5217\u573a\u666f\u4e0b Load to use latency \u5219\u662f 5 cycle\uff1a</p> <ul> <li><code>ldp x1, x0, [x0]</code>\uff1aload pair \u7684\u7b2c\u4e8c\u4e2a\u76ee\u7684\u5bc4\u5b58\u5668\u8f6c\u53d1\u5230\u57fa\u5730\u5740\uff0c\u65e0\u504f\u79fb</li> </ul> <p>\u6bd4\u8f83\u5947\u602a\u7684\u662f <code>ldr x0, [x0]</code> \u5728\u8de8\u8d8a 8B \u8fb9\u754c\u65f6\u7684\u884c\u4e3a\uff0cload to load latency \u9000\u5316\u4e3a 6 cycle\uff0cload to alu latency \u5219\u662f 4 cycle\u3002Apple Firestorm \u5219\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u8de8\u8d8a 8B \u8fb9\u754c\u751a\u81f3 64B \u8fb9\u754c\u65f6\uff0c\u5b9e\u73b0\u4e86 4 cycle load to load latency \u548c 4 cycle load to alu latency\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#mmu","title":"MMU","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>4KB and 64KB translation granules</li> <li>1 cycle access for L1 ITLB &amp; L1 DTLB</li> <li>Unified L2 TLB, 8-way &gt;8K entry</li> </ul>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#l2-cache","title":"L2 Cache","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>\u6bcf 4 \u4e2a\u6838\u5fc3\u7ec4\u6210\u4e00\u4e2a Cluster\uff0cCluster \u5185\u7684\u6838\u5fc3\u5171\u4eab\u4e00\u4e2a 12MB 12-way L2 Cache</li> <li>MOESI</li> <li>17 cycle latency for L1 miss to L2 hit</li> </ul> <p>\u6784\u9020\u4e0d\u540c\u5927\u5c0f footprint \u7684 pointer chasing \u94fe\uff0c\u6d4b\u8bd5\u4e0d\u540c footprint \u4e0b\u6bcf\u6761 load \u6307\u4ee4\u8017\u8d39\u7684\u65f6\u95f4\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u62d0\u70b9\u5728 96KB\uff0c\u5bf9\u5e94 L1 DCache \u7684\u5bb9\u91cf\uff0c\u4e4b\u540e\u5ef6\u8fdf\u5728 18-22 \u5468\u671f\u4e4b\u95f4\u6ce2\u52a8\uff0c\u8d85\u8fc7 6MB \u4ee5\u540e\u5ef6\u8fdf\u5feb\u901f\u4e0a\u5347\uff0c\u5bf9\u6b64\u6709\u4e24\u79cd\u731c\u6d4b\uff1a</p> <ol> <li>L2 Cache \u5e76\u975e\u6240\u6709\u5bb9\u91cf\u90fd\u53ef\u4ee5\u5728\u5dee\u4e0d\u591a\u7684\u65f6\u95f4\u5185\u8bbf\u95ee\uff0c\u79bb\u6838\u5fc3\u8fd1\u7684\u66f4\u5feb\uff0c\u79bb\u6838\u5fc3\u8fdc\u7684\u8f83\u6162</li> <li>\u4e3a\u4e86\u9632\u6b62\u67d0\u4e2a\u6838\u5fc3\u5bf9 L2 Cache \u7684\u5360\u7528\u592a\u5927\uff0c\u5bfc\u81f4\u540c\u4e00\u4e2a Cluster \u5185\u5176\u4ed6\u6838\u5fc3\u5206\u4e0d\u5230 L2 \u7f13\u5b58\uff0c\u8fdb\u884c QoS\uff0c\u9650\u5236\u6bcf\u4e2a\u6838\u5fc3\u80fd\u591f\u5360\u7528\u7684 L2 Cache \u5bb9\u91cf</li> </ol> <p>\u4e3a\u4e86\u8fdb\u4e00\u6b65\u9a8c\u8bc1\u4ee5\u4e0a\u7684\u731c\u6d4b\uff0c\u9664\u4e86\u5468\u671f\u6570\u4ee5\u5916\uff0c\u4e5f\u6d4b\u8bd5\u4e86\u4e0d\u540c footprint \u4e0b L2D_CACHE_REFILL \u4e8b\u4ef6\u7684\u6b21\u6570\uff0c\u53d1\u73b0\uff1a</p> <ol> <li>footprint \u5728 8MB \u8303\u56f4\u5185\u65f6\uff0cL2D_CACHE_REFILL \u7ea6\u7b49\u4e8e 0\uff0c\u610f\u5473\u7740\u6b64\u65f6\u6570\u636e\u90fd\u547d\u4e2d\u4e86 L2 Cache\uff0c\u4f46\u5f53 footprint \u8fbe\u5230 8MB \u65f6\uff0c\u8bbf\u95ee\u5ef6\u8fdf\u5df2\u7ecf\u589e\u52a0\u5230 45 \u4e2a\u5468\u671f\uff0c\u8fd9\u7b26\u5408\u7b2c\u4e00\u70b9\u731c\u6d4b\uff0c\u5373\u4f7f\u90fd\u547d\u4e2d L2 Cache\uff0c\u4e5f\u6709\u5feb\u6162\u4e4b\u5206</li> <li>footprint \u8fbe\u5230 12 MB \u65f6\uff0c\u6bcf\u6b21\u8bbf\u5b58\u7684\u5e73\u5747 L2D_CACHE_REFILL \u7ea6\u7b49\u4e8e 0.23\uff0c\u5047\u5982\u4e00\u4e2a\u6838\u5fc3\u53ef\u4ee5\u7528\u6ee1\u6574\u4e2a L2 Cache\uff0c\u6b64\u65f6\u5e94\u5f53\u6ca1\u6709\u8fd9\u4e48\u9ad8\u7684\u7f3a\u5931\u7387\uff0c\u8fd9\u7b26\u5408\u7b2c\u4e8c\u70b9\u731c\u6d4b</li> </ol> <p>\u56e0\u6b64\u53ef\u80fd\u4e0a\u8ff0\u4e24\u4e2a\u731c\u6d4b\u90fd\u662f\u5bf9\u7684\uff0c\u5f53\u7136\u4e86\uff0c\u4e5f\u4e0d\u6392\u9664\u8fd8\u6709\u522b\u7684\u89e3\u91ca\u3002</p>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2024/09/01/qualcomm_oryon/#memory","title":"Memory","text":"<p>\u5b98\u65b9\u4fe1\u606f\uff1a</p> <ul> <li>6MB System Level Cache, 26-29ns latency, 135GB/s bandwidth in each direction</li> <li>LPDDR5x DRAM, 8448 MT/s, 8 channel of 16 bits, 135GB/s bandwidth, 102-104ns latency</li> </ul> <p>\u901a\u8fc7 dmidecode\uff0c\u53ef\u4ee5\u770b\u5230 Surface Laptop 7 \u7684\u5185\u5b58\u578b\u53f7\uff1a</p> <pre><code>Handle 0x0004, DMI type 17, 92 bytes\nMemory Device\n        Total Width: 16 bits\n        Data Width: 16 bits\n        Size: 32 GB\n        Form Factor: TSOP\n        Locator: Top - on board\n        Bank Locator: Bank 0\n        Type: LPDDR5\n        Speed: 8448 MT/s\n        Manufacturer: Hynix\n        Part Number: H58G66BK8BX067\n        Configured Memory Speed: 8448 MT/s\n        Minimum Voltage: 0.348 V\n        Maximum Voltage: 0.856 V\n        Configured Voltage: 0.8 V\n</code></pre>","tags":["cpu","oryon","qualcomm","xelite","performance","uarch-review"]},{"location":"hardware/2023/04/07/ram-read-write-collision/","title":"RAM \u8bfb\u5199\u51b2\u7a81","text":"","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728 FPGA \u6216\u8005 ASIC \u4e2d\uff0c\u901a\u5e38\u90fd\u9700\u8981\u4f7f\u7528 RAM\uff0c\u901a\u8fc7\u8bfb\u53e3\u3001\u5199\u53e3\u6216\u8005\u8bfb\u5199\u53e3\u6765\u8fdb\u884c\u8bbf\u95ee\u3002\u5e38\u89c1\u7684\u914d\u7f6e\u6709\u5355\u8bfb\u5199\u53e3\uff081RW\uff09\uff0c\u4e00\u8bfb\u4e00\u5199\uff081R1W\uff09\u7b49\u7b49\uff0c\u8bfb\u53e3\u901a\u5e38\u6709 1 \u4e2a\u5468\u671f\u7684\u5ef6\u65f6\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5728\u540c\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u8bfb\u53e3\u548c\u5199\u53e3\u8bbf\u95ee\u4e86\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f\u53ef\u80fd\u4f1a\u60f3\u5230\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ol> <li>\u8bfb\u548c\u5199\u90fd\u5931\u8d25\uff0c\u8bfb\u51fa\u7684\u6570\u636e\u672a\u5b9a\u4e49\uff0c\u6570\u636e\u6ca1\u5199\u8fdb\u53bb</li> <li>\u6570\u636e\u5199\u8fdb\u53bb\u4e86\uff0c\u8bfb\u51fa\u7684\u6570\u636e\u672a\u5b9a\u4e49</li> <li>\u6570\u636e\u5199\u8fdb\u53bb\u4e86\uff0c\u8bfb\u51fa\u4e86\u5199\u4e4b\u524d\u7684\u65e7\u6570\u636e</li> <li>\u6570\u636e\u5199\u8fdb\u53bb\u4e86\uff0c\u8bfb\u51fa\u4e86\u540c\u4e00\u4e2a\u5468\u671f\u5199\u5165\u7684\u65b0\u6570\u636e</li> </ol> <p>\u4e0b\u9762\u4ee5\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u770b\u770b\uff0c\u5b9e\u9645\u60c5\u51b5\u662f\u4ec0\u4e48\u6837\u5b50\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#xilinx-fpga","title":"Xilinx FPGA","text":"<p>\u9996\u5148\u6d4b\u8bd5\u7684\u662f Xilinx FPGA \u4e0a\u7684 RAM\uff0c\u6d4b\u8bd5\u7684\u5bf9\u8c61\u662f XPM\uff0c\u7edf\u4e00\u8bbe\u7f6e\u8bfb\u5ef6\u8fdf\u4e3a\u4e00\u4e2a\u5468\u671f\uff0c\u4f7f\u7528 Vivado \u4eff\u771f\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#\u4e00\u8bfb\u4e00\u5199","title":"\u4e00\u8bfb\u4e00\u5199","text":"<p>\u9996\u5148\u6d4b\u8bd5\u4e00\u8bfb\u4e00\u5199\uff0c\u4e5f\u5c31\u662f xpm_memory_sdpram \u6a21\u5757\u3002\u6a21\u5757\u652f\u6301\u4e09\u79cd\u6a21\u5f0f\uff1aNO_CHANGE\uff08\u9ed8\u8ba4\u503c\uff09\u3001READ_FIRST \u548c WRITE_FIRST\uff0c\u56e0\u6b64\u6211\u4f8b\u5316\u4e86\u4e09\u4efd\uff0c\u8f93\u5165\u4e00\u6837\u7684\u4fe1\u53f7\uff0c\u8bbe\u7f6e\u4e3a\u4e09\u79cd\u4e0d\u540c\u7684\u6a21\u5f0f\uff0c\u7136\u540e\u6bd4\u8f83\u8f93\u51fa\u7ed3\u679c\u3002\u4e3a\u4e86\u7b80\u5316\uff0c\u8bfb\u5199\u4f7f\u7528\u4e00\u4e2a\u65f6\u949f\u3002\u4e0b\u9762\u662f\u6d4b\u8bd5\u7684\u6ce2\u5f62\uff1a</p> <p>\u56fe\u4e2d\u7b2c\u4e00\u4e2a\u5468\u671f\u5411\u5730\u5740 0 \u5199\u5165\u4e86 1111\uff0c\u7136\u540e\u7b2c\u4e09\u4e2a\u5468\u671f\u540c\u65f6\u8bfb\u5199\u5730\u5740 0 \u7684\u6570\u636e\uff0c\u6b64\u65f6 NO_CHANGE \u548c WRITE_FIRST \u4e24\u79cd\u6a21\u5f0f\u4e2d\uff0c\u5199\u5165\u6210\u529f\uff0c\u8bfb\u53d6\u5931\u8d25\uff1bREAD_FIRST \u6a21\u5f0f\u8bfb\u53d6\u6210\u529f\uff0c\u5e76\u4e14\u8bfb\u53d6\u7684\u662f\u5199\u5165\u4e4b\u524d\u7684\u6570\u636e\u3002\u7b2c\u56db\u4e2a\u5468\u671f\u65f6\uff0c\u8bfb\u5199\u6ca1\u6709\u51fa\u73b0\u51b2\u7a81\uff0c\u4e09\u79cd\u6a21\u5f0f\u90fd\u53ef\u4ee5\u8bfb\u51fa\u5199\u5165\u7684\u65b0\u6570\u636e\u3002</p> <p>\u8fd9\u6709\u4e9b\u51fa\u4e4e\u6211\u7684\u610f\u6599\uff1a\u4e4b\u524d\u5728\u5f88\u591a\u5730\u65b9\u7528\u8fc7 XPM\uff0c\u4f46\u662f\u90fd\u6ca1\u8003\u8651\u8fc7\u8bfb\u5199\u5730\u5740\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u800c\u4e14\u9ed8\u8ba4\u8bbe\u7f6e\uff08NO_CHANGE\uff09\u4e0b\uff0c\u8f93\u51fa\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u7684\u3002\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u884c\u4e3a\u5728 PG058 Block Memory Generator \u91cc\u9762\u63d0\u5230\u4e86\uff1a</p> <ul> <li>Synchronous Write-Read Collisions: A synchronous Write-Read collision might occur if a port attempts to Write a memory location and the other port reads the same location. While memory contents are not corrupted in Write-Read collisions, the validity of the output data depends on the Write port operating mode.</li> <li>If the Write port is in READ_FIRST mode, the other port can reliably read the old memory contents.</li> <li>If the Write port is in WRITE_FIRST or NO_CHANGE mode, data on the output of the Read port is invalid.</li> <li>In the case of byte-writes, only updated bytes are invalid on the Read port output.</li> </ul> <p>\u4e0e\u4e0a\u9762\u89c2\u5bdf\u5230\u7684\u7ed3\u679c\u57fa\u672c\u543b\u5408\uff0c\u53e6\u5916\u8fd9\u91cc\u63d0\u5230\u4e86\u5e26 Mask \u7684\u60c5\u51b5\uff1a\u5373\u4f7f\u662f WRITE_FIRST \u6216\u8005 NO_CHANGE\uff0c\u4e5f\u53ef\u4ee5\u8bfb\u51fa\u6ca1\u5199\u5165\u7684\u90a3\u90e8\u5206\uff08\u5373 WEA[i] = 0\uff09\u65e7\u7684\u6570\u636e\u3002</p> <p>\u5bf9\u6b64\uff0cXilinx \u7684\u5efa\u8bae\u662f\uff1a</p> <pre><code>For Synchronous Clocking and during a collision, the Write mode of port A\ncan be configured so that a Read operation on port B either produces data\n(acting like READ_FIRST), or produces undefined data (Xs). For this reason,\nit is always advised to use READ_FIRST when configured as a Simple Dual-port\nRAM. For asynchronous clocking, Xilinx recommends setting the Write mode of\nPort A to WRITE_FIRST for collision safety.\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\u540c\u6b65\u65f6\u949f\u7528 READ_FIRST\uff0c\u5f02\u6b65\u65f6\u949f\u7528 WRITE_FIRST\u3002\u751a\u81f3 Vivado \u8fd8\u53ef\u4ee5\u8d34\u5fc3\u5730\u5e2e\u4f60\u8bbe\u7f6e\uff1a</p> <pre><code>For 7 series devices, the selected operating mode is passed to the block RAM\nwhen the RAM_MODE is set to TDP. For the primitives with RAM_MODE set to\nSDP, the write mode is READ_FIRST for synchronous clocking and WRITE_FIRST\nfor asynchronous clocking.\n</code></pre> <p>\u4f46\u662f XPM \u4f3c\u4e4e\u5c31\u6ca1\u6709\u8fd9\u4e2a\u8bbe\u5b9a\u4e86\uff0c\u800c\u662f\u7531\u7528\u6237\u6765\u4f20\u5165\u3002</p> <p>\u800c\u5bf9\u4e8e\u5f02\u6b65\u65f6\u949f\uff0c\u6587\u6863\u76f4\u63a5\u8bf4\u4e0d\u8981\u8ba9\u51b2\u7a81\u53d1\u751f\uff1a</p> <pre><code>Using asynchronous clocks, when one port writes data to a memory location,\nthe other port must not Read or Write that location for a specified amount\nof time.\n</code></pre> <p>\u8fd9\u70b9\u4f3c\u4e4e\u7ecf\u5e38\u88ab\u6211\u4eec\u5ffd\u7565\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u5728 Verilog \u4e2d\u5b9e\u73b0\u4e00\u4e2a\u8bed\u4e49\u4e0a WRITE_FIRST \u7684 RAM\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1a</p> <pre><code>`timescale 1ns/1ps\nmodule mem_1r1w (\n  input clk,\n  input [5:0] R0_addr,\n  input R0_en,\n  output [63:0] R0_data,\n  input [5:0] W0_addr,\n  input W0_en,\n  input [63:0] W0_data\n);\n\n  reg [5:0] reg_R0_addr;\n  reg [63:0] mem [63:0];\n\n  always @(posedge clk) begin\n    if (W0_en) begin\n      mem[W0_addr] &lt;= W0_data;\n    end\n  end\n\n  always @(posedge clk) begin\n    if (R0_en) begin\n      reg_R0_addr &lt;= R0_addr;\n    end\n  end\n\n  assign R0_data = mem[reg_R0_addr];\n\nendmodule\n</code></pre> <p>\u5947\u602a\u7684\u662f\uff0c\u7efc\u5408\u51fa\u6765\u4f1a\u4f7f\u7528 BRAM \u5b9e\u73b0\uff0c\u5e76\u4e14\u91c7\u7528 READ_FIRST \u4f5c\u4e3a RAMB36E1 \u7684 WRITE_MODE_A \u548c WRITE_MODE_B\u3002\u5982\u679c\u5199\u6210\u8bed\u4e49 READ_FIRST\uff1a</p> <pre><code>`timescale 1ns/1ps\nmodule mem_1r1w (\n  input clk,\n  input [5:0] R0_addr,\n  input R0_en,\n  output [63:0] R0_data,\n  input [5:0] W0_addr,\n  input W0_en,\n  input [63:0] W0_data\n);\n\n  reg [63:0] reg_R0_data;\n  reg [63:0] mem [63:0];\n\n  always @(posedge clk) begin\n    if (W0_en) begin\n      mem[W0_addr] &lt;= W0_data;\n    end\n  end\n\n  always @(posedge clk) begin\n    if (R0_en) begin\n      reg_R0_data &lt;= mem[R0_addr];\n    end\n  end\n\n  assign R0_data = reg_R0_data;\n\nendmodule\n</code></pre> <p>\u4f1a\u53d1\u73b0\u751f\u6210\u7684 RAMB36E1 \u539f\u8bed\u7684 WRITE_MODE \u4f9d\u7136\u662f READ_FIRST\u3002\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\uff0c\u5982\u679c\u7efc\u5408\u7684\u65f6\u5019\u7528\u4e24\u4e2a\u65f6\u949f\u4fe1\u53f7\uff0c\u5c31\u4f1a\u7528 WRITE_FIRST\uff1b\u5982\u679c\u7528\u4e86\u4e00\u4e2a\uff0c\u5c31\u4f1a\u7528 READ_FIRST\uff0c\u4e0e\u8bed\u4e49\u65e0\u5173\u3002\u6240\u4ee5\u5982\u679c\u4f9d\u8d56 Vivado \u7684 infer RAM\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u548c\u9884\u671f\u53ef\u80fd\u4e0d\u4e00\u81f4\uff0c\u548c\u524d\u9762\u7684\u6587\u6863\u4e00\u81f4\uff1a<code>For the primitives with RAM_MODE set to SDP, the write mode is READ_FIRST for synchronous clocking and WRITE_FIRST for asynchronous clocking.</code>\u3002</p> <p>\u53c8\u989d\u5916\u6d4b\u8bd5\u4e86\u4e00\u4e0b yosys\uff1a<code>yosys mem_1r1w.v -p \"synth_xilinx\"</code>\uff0c\u7ed3\u679c\u53d1\u73b0 yosys \u4f1a\u5fe0\u5b9e\u5730\u6309\u7167\u8bed\u4e49\u4e3a WRITE_FIRST \u751f\u6210 bypass \u903b\u8f91\u3002\u867d\u7136 yosys \u53ef\u4ee5\u505a\u7684\u66f4\u597d\uff1a\u628a\u8bc6\u522b\u51fa\u6765\u7684 READ_FIRST \u6216 WRITE_FIRST \u4f20\u7ed9 RAMB36E1\uff0c\u4f46 yosys \u81f3\u5c11\u5c0a\u91cd\u4e86\u4ee3\u7801\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#\u4e00\u8bfb\u5199","title":"\u4e00\u8bfb\u5199","text":"<p>\u63a5\u4e0b\u6765\u6d4b\u8bd5\u5355\u8bfb\u5199\u53e3\u7684\u573a\u666f\u3002\u5355\u8bfb\u5199\u53e3\u548c\u4e0a\u9762\u4e0d\u540c\uff0c\u5b83\u7684\u51b2\u7a81\u70b9\u5728\u4e8e\uff0c\u5199\u5165\u7684\u65f6\u5019\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u5982\u4f55\u53d8\u5316\u3002\u4e0b\u9762\u7528\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u6d4b\u8bd5\u4e09\u79cd\u6a21\u5f0f\u4e0b xpm_memory_spram \u7684\u884c\u4e3a\uff0c\u5f97\u5230\u5982\u4e0b\u6ce2\u5f62\uff1a</p> <p>\u8fd9\u4e2a\u7ed3\u679c\u5c31\u6bd4\u8f83\u6709\u610f\u601d\u4e86\uff0c\u4e09\u79cd\u6a21\u5f0f\u5f97\u5230\u4e86\u4e09\u79cd\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u7b2c\u4e00\u4e2a\u5468\u671f\u4f9d\u7136\u662f\u5199\u5165 1111 \u5230\u5730\u5740 0\uff0c\u7136\u540e WRITE_FIRST \u6a21\u5f0f\u7684\u8f93\u51fa\u7ed3\u679c\u7b2c\u4e8c\u4e2a\u5468\u671f\u8ddf\u7740\u53d8\uff0c\u5c31\u597d\u50cf\u5728\u5199\u7684\u65f6\u5019\u540c\u65f6\u4e5f\u5728\u8bfb\uff0c\u53ea\u4e0d\u8fc7\u8bfb\u53d6\u7684\u7ed3\u679c\u5c31\u662f\u6700\u540e\u4e00\u6b21\u5199\u5165\u7684\u7ed3\u679c\u3002\u7b2c\u4e09\u4e2a\u5468\u671f\u8bfb\u53d6\u5730\u5740 0 \u7684\u6570\u636e\uff0c\u7136\u540e\u7b2c\u56db\u4e2a\u5468\u671f\u5199\u5165 2222 \u5230\u5730\u5740 0\uff0c\u6b64\u65f6\u4e09\u79cd\u60c5\u51b5\u7684\u8bfb\u53d6\u90fd\u5f97\u5230\u4e86\u5199\u5165\u524d\u7684\u503c\uff08\u4e5f\u5c31\u662f 1111\uff09\u3002\u7b2c\u4e94\u4e2a\u5468\u671f WRITE_FIRST \u6a21\u5f0f\u7684\u8f93\u51fa\u8ddf\u7740\u53d8\u6210\u4e86 2222\uff0c\u548c\u9884\u671f\u4e00\u81f4\u3002\u540c\u65f6\u7b2c\u4e94\u4e2a\u5468\u671f\u5199\u5165 3333 \u5230\u5730\u5740 1\uff0c\u63a5\u7740\u7b2c\u516d\u4e2a\u5468\u671f\u7684\u65f6\u5019\uff0cREAD_FIRST \u51fa\u73b0\u4e86 0000\uff0c\u5b9e\u9645\u4e0a\u662f\u8bfb\u53d6\u4e86\u5730\u5740 1 \u7684\u65e7\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5199\u5165\u524d\u7684\u6570\u636e\uff0c\u800c WRITE_FIRST \u66f4\u65b0\u4e3a\u4e86 3333\uff0c\u4e5f\u5c31\u662f\u65b0\u5199\u5165\u7684\u6570\u636e\uff1bNO_CHANGE \u5219\u662f\u4fdd\u6301\u4e86\u6700\u540e\u4e00\u6b21\u8bfb\u53d6\u7684\u7ed3\u679c\u3002</p> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u4e0a\u9762\u7684\u73b0\u8c61\uff0c\u5c31\u662f\uff1a</p> <ul> <li>NO_CHANGE\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5199\u7684\u65f6\u5019 rdata \u4e0d\u53d8\uff0c\u53ea\u6709\u5728\u8bfb\u7684\u4e0b\u4e00\u4e2a\u5468\u671f\u624d\u4f1a\u53d8</li> <li>WRITE_FIRST\uff1a\u5199\u7684\u540c\u65f6\u4e5f\u5728\u8bfb\uff0c\u53ea\u4e0d\u8fc7\u8bfb\u53d6\u7684\u662f\u5199\u5165\u7684\u65b0\u6570\u636e</li> <li>READ_FIRST\uff1a\u5199\u7684\u540c\u65f6\u4e5f\u5728\u8bfb\uff0c\u53ea\u4e0d\u8fc7\u8bfb\u53d6\u7684\u662f\u5199\u5165\u524d\u7684\u65e7\u6570\u636e</li> </ul> <p>\u5173\u4e8e\u8fd9\u4e2a\u884c\u4e3a\uff0c\u5728 RAM IP Core \u4e2d Write First Read First \u548c No Change \u7684\u533a\u522b \u5904\u53ef\u4ee5\u770b\u5230\u6bd4\u8f83\u6e05\u6670\u7684\u89e3\u91ca\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#sram-ip","title":"SRAM IP","text":"<p>\u63a5\u4e0b\u6765\u5728\u4eff\u771f\u4e2d\u770b\u770b SRAM IP \u7684\u884c\u4e3a\u662f\u4ec0\u4e48\u6837\u5b50\u3002SRAM IP \u6709\u4e00\u4e2a\u5f15\u811a COLLDISN\uff0c\u5176\u8bed\u4e49\u4e3a\uff1a</p> <ul> <li>\u5982\u679c COLLDISN \u4e3a 1\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0\u8bfb\u5199\u51b2\u7a81\uff0c\u90a3\u4e48\u5199\u5165\u662f\u88ab\u4fdd\u8bc1\u7684\uff0c\u4f46\u662f\u8bfb\u53d6\u4f1a\u5931\u8d25</li> <li>\u5982\u679c COLLDISN \u4e3a 0\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0\u8bfb\u5199\u51b2\u7a81\uff0c\u8bfb\u5199\u90fd\u4f1a\u5931\u8d25</li> </ul> <p>\u4eff\u771f\u5f97\u5230\u5982\u4e0b\u6ce2\u5f62\uff1a</p> <p>\u7b2c\u4e00\u4e2a\u5468\u671f\u6ca1\u6709\u8bfb\u5199\u51b2\u7a81\uff0c\u6240\u4ee5\u6210\u529f\u5199\u5165\uff0c\u7b2c\u4e09\u4e2a\u5468\u671f\u4e5f\u53ef\u4ee5\u6b63\u786e\u5730\u90fd\u51fa\u6765\u3002\u7b2c\u516d\u4e2a\u5468\u671f\u8bfb\u5199\u51b2\u7a81\uff0c\u6b64\u65f6\u5982\u679c COLLDISN \u7b49\u4e8e 0\uff0c\u90a3\u4e48\u8bfb\u5199\u90fd\u5931\u8d25\uff0c\u4e0b\u4e00\u4e2a\u5468\u671f\u8bfb\u53d6\u7ed3\u679c\u662f xxxx\uff0c\u5e76\u4e14\u4e4b\u540e\u7ee7\u7eed\u8bfb\u53d6\u4f9d\u7136\u662f xxxx\uff0c\u56e0\u4e3a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u88ab\u7834\u574f\u4e86\uff1b\u800c\u5982\u679c COLLDISN \u7b49\u4e8e 1\uff0c\u90a3\u4e48\u5199\u5165\u6210\u529f\uff0c\u5185\u5b58\u4e2d\u7684\u503c\u53d8\u4e3a 2222\uff0c\u4f46\u8bfb\u53d6\u5931\u8d25\uff0c\u4e0b\u4e00\u4e2a\u5468\u671f\u8bfb\u53d6\u7ed3\u679c\u662f xxxx\uff0c\u4f46\u662f\u518d\u4e0b\u4e00\u4e2a\u5468\u671f\u5c31\u53ef\u4ee5\u6b63\u5e38\u8bfb\u53d6\uff0c\u5f97\u5230 2222\u3002</p> <p>\u8fd9\u5c31\u4e0e Xilinx FPGA \u4e0d\u4e00\u6837\uff1a\u8fd9\u91cc\u5982\u679c COLLDISN \u7b49\u4e8e 0\uff0c\u8bfb\u5199\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u5199\u5165\u4f1a\u5931\u6548\uff0c\u5185\u5b58\u4e2d\u7684\u503c\u53d8\u4e3a\u4e0d\u786e\u5b9a\u7684\u5185\u5bb9\u3002\u6240\u4ee5\u4e3a\u4e86\u4fdd\u8bc1\u6b63\u786e\u6027\uff0c\u8981\u4e48\u5728 SRAM IP \u5916\u90e8\u8fdb\u884c\u8bfb\u5199\u51b2\u7a81\u68c0\u67e5\uff0c\u5982\u679c\u8981\u51b2\u7a81\u4e86\uff0c\u5c31\u5173\u6389\u8bfb\u53e3\uff0c\u7136\u540e\u4ece\u5199\u53e3 bypass \u6570\u636e\u5230\u8bfb\u53e3\uff1b\u8981\u4e48\u5728 SRAM IP \u5185\u90e8\u8fdb\u884c\u8bfb\u5199\u51b2\u7a81\u68c0\u67e5\uff08\u8bbe\u7f6e COLLDISN \u7b49\u4e8e 1\uff09\uff0c\u7136\u540e\u4e0d\u8981\u4f7f\u7528\u51b2\u7a81\u65f6\u8bfb\u53d6\u7684\u6570\u636e\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2023/04/07/ram-read-write-collision/#chisel","title":"Chisel","text":"<p>Chisel \u4e2d RAM \u5bf9\u5e94\u7684\u662f SyncReadMem\uff0c\u5b83\u53ef\u4ee5\u6307\u5b9a Read under Write behavior\uff1a</p> <ul> <li><code>SyncReadMem()</code>: unspecified in FIRRTL, <code>WriteFirst</code> in behavior model</li> <li><code>SyncReadMem(Undefined)</code>: unspecified in FIRRTL, <code>WriteFirst</code> in behavior model</li> <li><code>SyncReadMem(ReadFirst)</code>: <code>old</code> in FIRRTL, <code>ReadFirst</code> in behavior model</li> <li><code>SyncReadMem(WriteFirst)</code>: <code>new</code> in FIRRTL, <code>WriteFirst</code> in behavior model</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u884c\u4e3a\u7ea7\u6a21\u578b\u4e2d\uff0c\u53ea\u6709 WriteFirst \u548c ReadFirst \u4e24\u79cd\u884c\u4e3a\uff0c\u5e76\u4e14\u9ed8\u8ba4\u662f <code>WriteFirst</code>\u3002\u4f46\u662f\uff0c\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u5b9e\u9645\u4e0a XPM \u53ea\u652f\u6301 <code>Undefined</code>\uff08\u751f\u6210 <code>x</code>\uff09\u548c <code>ReadFirst</code>\uff08READ_FIRST\uff09\u4e24\u79cd\uff1b\u4e0a\u9762\u7684 SRAM IP \u66f4\u662f\u53ea\u652f\u6301 <code>Undefined</code>\uff08\u751f\u6210 <code>x</code>\uff09\u3002</p> <p>\u8fd9\u5c31\u5bfc\u81f4\u5199 Chisel \u4ee3\u7801\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u5c0f\u5fc3\u7528\u4e86 1R1W\uff0c\u5e76\u4e14\u4ee3\u7801\u4f9d\u8d56\u4e86 Read Under Write \u5728\u884c\u4e3a\u7ea7\u6a21\u578b\u4e0b\u7684\u884c\u4e3a\uff0c\u90a3\u4e48\u5728\u4f7f\u7528 XPM \u6216\u8005 SRAM IP \u8fdb\u884c\u66ff\u6362\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u989d\u5916\u7684\u903b\u8f91\u6765\u5904\u7406\u8fd9\u4e2a\u4e0d\u540c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8981\u6a21\u62df <code>WriteFirst</code>\uff0c\u5c31\u6bd4\u8f83\u5730\u5740\uff0c\u7136\u540e\u8fdb\u884c bypass\uff1b\u4f46\u662f <code>ReadFirst</code> \u5c31\u6ca1\u529e\u6cd5\u6a21\u62df\u4e86\u3002\u6700\u597d\u7684\u89e3\u51b3\u65b9\u6cd5\u8fd8\u662f\uff0c\u4e0d\u8981\u51fa\u73b0\u51b2\u7a81\uff0c\u5373\u4f7f\u8981\u51b2\u7a81\uff0c\u4e5f\u8981\u5728\u4e0a\u5c42\u8fdb\u884c\u5904\u7406\u3002</p>","tags":["sram","collision","readunderwrite","xpm","xilinx","bram"]},{"location":"hardware/2018/09/07/reading-smart-info-of-external-drives-under-macOS/","title":"\u5728 macOS \u4e0a\u8bfb\u53d6\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T. \u4fe1\u606f","text":"<p>\u4e4b\u524d\u60f3\u770b\u770b\u81ea\u5df1\u5404\u4e2a\u76d8\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u53d1\u73b0\u53ea\u80fd\u770b\u7535\u8111\u5185\u7f6e\u7684 SSD \u7684 S.M.A.R.T \u4fe1\u606f\uff0c\u800c\u79fb\u52a8\u786c\u76d8\u7684\u90fd\u663e\u793a\uff1a</p> <pre><code>$ smartctl -a /dev/disk2\nsmartctl 6.6 2017-11-05 r4594 [Darwin 17.7.0 x86_64] (local build)\nCopyright (C) 2002-17, Bruce Allen, Christian Franke, www.smartmontools.org\n\n/dev/disk2: Unable to detect device type\nPlease specify device type with the -d option.\n\nUse smartctl -h to get a usage summary\n</code></pre> <p>\u4e00\u5f00\u59cb\u6211\u6000\u7591\u662f\u4e2a\u522b\u76d8\u4e0d\u652f\u6301\uff0c\u4f46\u6362\u4e86\u51e0\u4e2a\u76d8\u90fd\u4e0d\u80fd\u5de5\u4f5c\uff0c\u95ee\u9898\u5e94\u8be5\u51fa\u73b0\u5728\u4e86 USB \u4e0a\u3002\u67e5\u4e86\u4e0b\u8d44\u6599\uff0c\u679c\u7136\u5982\u6b64\u3002\u6839\u636e USB devices and smartmontools \uff0c\u83b7\u53d6 S.M.A.R.T \u4fe1\u606f\u9700\u8981\u76f4\u63a5\u53d1\u9001 ATA \u547d\u4ee4\uff0c\u4f46\u662f\u7531\u4e8e\u7ecf\u8fc7\u4e86 USB\uff0c\u4e8e\u662f\u9700\u8981\u8fdb\u884c\u4e00\u4e2a\u8f6c\u6362\uff0c\u5bfc\u81f4\u65e0\u6cd5\u76f4\u63a5\u53d1\u9001 ATA \u547d\u4ee4\u3002\u8fd9\u4e2a\u95ee\u9898\u81ea\u7136\u662f\u6709\u89e3\u51b3\u65b9\u6848\uff0c\u5927\u6982\u5c31\u662f\u76f4\u63a5\u628a ATA \u547d\u4ee4\u53d1\u9001\u8fc7\u53bb\uff08pass-through\uff09\u3002\u4e0a\u9762\u8fd9\u4e2a\u5730\u5740\u91cc\u5199\u5230\uff0c\u5982\u679c\u9700\u8981\u5728 macOS \u4e0a\u4f7f\u7528\uff0c\u9700\u8981\u5b89\u88c5\u4e00\u4e2a\u5185\u6838\u9a71\u52a8\u3002\u53ef\u4ee5\u627e\u5230\uff0c\u6e90\u7801\u5728 kasbert/OS-X-SAT-SMART-Driver \u5e76\u4e14\u6709\u4e00\u4e2a\u5e26\u7b7e\u540d\u7684\u5b89\u88c5\u5305\u5728 External USB / FireWire drive diagnostics support \u4e2d\u53ef\u4ee5\u4e0b\u8f7d\u3002\u4e22\u5230 VirusTotal \u4e0a\u6ca1\u67e5\u51fa\u95ee\u9898\uff0c\u7528 v0.8 \u7248\u672c\u5b89\u88c5\u597d\u540e\u5c31\u6210\u529f\u5730\u8bfb\u53d6\u5230\u4e86\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T \u4fe1\u606f\u4e86\u3002</p> <p>\u7136\u540e\u6211\u53c8\u7b80\u5355\u7814\u7a76\u4e86\u4e00\u4e0b\u5404\u4e2a S.M.A.R.T \u5404\u4e2a\u503c\u7684\u542b\u4e49\u662f\u4ec0\u4e48\u3002 <code>VALUE</code> \u4ee3\u8868\u5f53\u524d\u7684\u503c\uff0c <code>WORST</code> \u4ee3\u8868\u76ee\u524d\u68c0\u6d4b\u5230\u7684\u6700\u5dee\u7684\u503c\uff0c <code>THRESH</code> \u4ee3\u8868\u635f\u574f\u9608\u503c\u3002\u8fd9\u4e9b\u503c\u90fd\u662f\u4ece <code>RAW_VALUE</code> \u8fdb\u884c\u8ba1\u7b97\u540e\u5f52\u4e00\u5316\u800c\u6765\u3002\u7136\u540e <code>TYPE</code> \u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u662f <code>Pre-fail</code> \uff0c\u4ee3\u8868\u5982\u679c\u8fd9\u4e00\u9879\u7684\u503c\u5c0f\u4e8e\u9608\u503c\uff0c\u4ee3\u8868\u8fd9\u4e2a\u673a\u5668\u5f88\u5371\u9669\u4e86\uff0c\u8d76\u7d27\u62f7\u6570\u636e\u4e22\u6389\u5427\u3002\u4e8c\u662f <code>Old_age</code> \uff0c\u4ee3\u8868\u5982\u679c\u8fd9\u4e00\u9879\u5c0f\u4e8e\u9608\u503c\uff0c\u4ee3\u8868\u8fd9\u4e2a\u673a\u5668\u6bd4\u8f83\u8001\u4e86\uff0c\u4f46\u8fd8\u6ca1\u574f\u3002\u771f\u6b63\u8981\u770b\u662f\u5426\u574f\u4e86\uff0c\u53ef\u4ee5\u770b <code>When_Failed</code> \u4e00\u680f\u3002</p>","tags":["smart","macos","smartmontools","kext"]},{"location":"hardware/2021/12/12/riscv-debug/","title":"\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae","text":"","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u7528\u8fc7\u4e00\u4e9b RISC-V \u6838\u5fc3\uff0c\u4f46\u662f\u9047\u5230\u8c03\u8bd5\u76f8\u5173\u7684\u5185\u5bb9\u7684\u65f6\u5019\u5c31\u4e24\u773c\u4e00\u62b9\u9ed1\uff0c\u4e0d\u77e5\u9053\u539f\u7406\uff0c\u51fa\u4e86\u95ee\u9898\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u6392\u67e5\uff0c\u8d81\u6b64\u673a\u4f1a\u7814\u7a76\u4e00\u4e0b\u5de5\u4f5c\u539f\u7406\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#\u67b6\u6784","title":"\u67b6\u6784","text":"<p>\u4e3a\u4e86\u8c03\u8bd5 RISC-V \u6838\u5fc3\uff0c\u9700\u8981\u5f88\u591a\u90e8\u4ef6\u4e00\u8d77\u5de5\u4f5c\u3002\u6309 RISC-V Debug Spec \u6240\u8ff0\uff0c\u6709\u8fd9\u4e48\u51e0\u90e8\u5206\uff1a</p> <ol> <li>Debugger: GDB\uff0c\u8fde\u63a5\u5230 OpenOCD \u542f\u52a8\u7684 GDB Server</li> <li>Debug Translator: OpenOCD\uff0c\u5411 GDB \u63d0\u4f9b Server \u5b9e\u73b0\uff0c\u540c\u65f6\u4f1a\u901a\u8fc7 FTDI \u7b49\u82af\u7247\u63a7\u5236 JTAG</li> <li>Debug Transport Hardware: \u6bd4\u5982 FTDI \u7684\u82af\u7247\uff0c\u53ef\u4ee5\u63d0\u4f9b USB \u63a5\u53e3\uff0c\u8ba9 OpenOCD \u63a7\u5236 JTAG \u4fe1\u53f7 TMS/TDI/TCK \u7684\u53d8\u5316\uff0c\u5e76\u8bfb\u53d6 TDO</li> <li>Debug Transport Module: \u5728\u82af\u7247\u5185\u90e8\u7684 JTAG \u63a7\u5236\u5668\uff08TAP\uff09\uff0c\u7b26\u5408 JTAG \u6807\u51c6</li> <li>Debug Module Interface\uff1aRISC-V \u81ea\u5b9a\u4e49\u7684\u4e00\u7cfb\u5217\u5bc4\u5b58\u5668\uff0c\u901a\u8fc7\u8fd9\u4e9b\u5bc4\u5b58\u5668\u6765\u63a7\u5236 Debug Module \u7684\u884c\u4e3a</li> <li>Debug Module\uff1a\u8c03\u8bd5\u5668\uff0c\u63a7\u5236 RISC-V \u6838\u5fc3\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u76f4\u63a5\u8bbf\u95ee\u603b\u7ebf\uff0c\u4e5f\u6709\u5185\u90e8\u7684 Program Buffer</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0cDMI \u662f\u5b9e\u9645\u7684\u8c03\u8bd5\u63a5\u53e3\uff0c\u800c JTAG \u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u4f20\u8f93\u534f\u8bae\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#jtag","title":"JTAG","text":"<p>\u9996\u5148\u4ec0\u4e48\u662f JTAG\uff1f\u7b80\u5355\u6765\u8bf4\uff0c\u5b83\u5de5\u4f5c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ol> <li>JTAG TAP \u7ef4\u62a4\u4e86\u4e00\u4e2a\u72b6\u6001\u673a\uff0c\u7531 TMS \u4fe1\u53f7\u63a7\u5236</li> <li>\u5f53\u72b6\u6001\u673a\u8fdb\u5165 CaptureDR/CaptureIR \u72b6\u6001\u7684\u65f6\u5019\uff0c\u52a0\u8f7d\u6570\u636e\u5230 DR/IR \u4e2d</li> <li>\u5728 ShiftDR/ShiftIR \u72b6\u6001\u4e0b\uff0c\u5bc4\u5b58\u5668\u4ece TDI \u79fb\u5165\uff0c\u4ece TDO \u79fb\u51fa</li> <li>\u5f53\u8fdb\u5165 UpdateDR/UpdateIR \u72b6\u6001\u7684\u65f6\u5019\uff0c\u628a DR/IR \u7684\u7ed3\u679c\u8f93\u51fa\u5230\u5176\u4ed6\u5355\u5143</li> </ol> <p>\u5177\u4f53\u6765\u8bf4\uff0cJTAG \u5b9a\u4e49\u4e86\u4e24\u7c7b\u5bc4\u5b58\u5668\uff1aIR \u548c DR\u3002\u53ef\u4ee5\u628a JTAG \u7406\u89e3\u6210\u4e00\u4e2a\u5c0f\u7684\u603b\u7ebf\uff0c\u6211\u901a\u8fc7 IR \u9009\u62e9\u603b\u7ebf\u4e0a\u7684\u8bbe\u5907\uff0c\u901a\u8fc7 DR \u5411\u6307\u5b9a\u7684\u8bbe\u5907\u4e0a\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\u6bd4\u5982\u5728 RISC-V Debug Spec \u91cc\u9762\uff0c\u89c4\u5b9a\u4e86\u4ee5\u4e0b\u7684 5 \u4f4d IR \u5730\u5740\u5b9a\u4e49\uff1a</p> <ol> <li>0x00/0x1f: BYPASS</li> <li>0x01: IDCODE</li> <li>0x10: dtmcs</li> <li>0x11: dmi</li> </ol> <p>\u53ef\u4ee5\u7c7b\u6bd4\u4e3a\u6709\u56db\u4e2a\u8bbe\u5907\uff1aBYPASS\uff0cIDCODE\uff0cdtmcs\uff0cdmi\uff0c\u5bf9\u5e94\u4e86\u4e00\u4e9b\u5730\u5740\u3002\u5982\u679c\u8981\u9009\u62e9 dtmcs \u8fd9\u4e2a\u8bbe\u5907\uff0c\u5c31\u5728 ShiftIR \u9636\u6bb5\u5411 TDI \u8f93\u5165\u4e8c\u8fdb\u5236\u7684 00001 \u5373\u53ef\u3002\u9009\u62e9\u5730\u5740\u4ee5\u540e\uff0c\u518d\u5411 DR \u5199\u5165\u65f6\uff0c\u64cd\u4f5c\u7684\u5c31\u662f dtmcs \u8bbe\u5907\u3002</p> <p>\u90a3\u4e48\uff0c\u6bcf\u4e2a\u8bbe\u5907\u662f\u600e\u4e48\u64cd\u4f5c\u7684\u5462\uff1f\u5047\u5982\u6211\u5df2\u7ecf\u901a\u8fc7 IR \u8bbe\u7f6e\u4e86\u5f53\u524d\u8bbe\u5907\u662f dtmcs\uff0c\u7136\u540e\u8fdb\u5165 ShiftDR \u6a21\u5f0f\u65f6\uff0cJTAG \u4f1a\u540c\u65f6\u8f93\u5165\u548c\u8f93\u51fa\u3002\u8f93\u5165\u7684\u5c31\u662f\u5f53\u524d\u8981\u8f93\u5165\u7684\u6570\u636e\uff0c\u8f93\u51fa\u7684\u5c31\u662f\u539f\u6765\u5bc4\u5b58\u5668\u91cc\u7684\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u53ef\u80fd\u662f\u56fa\u5b9a\u7684\uff0c\u4e5f\u53ef\u80fd\u662f\u8868\u793a\u4e0a\u4e00\u6b21\u8f93\u5165\u5bf9\u5e94\u7684\u7ed3\u679c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1aIDCODE \u8bbe\u5907\uff0c\u5728 CaptureDR \u9636\u6bb5\u7684\u65f6\u5019\uff0cDR \u603b\u4f1a\u88ab\u8bbe\u4e3a\u4e00\u4e2a\u56fa\u5b9a\u7684 IDCODE\uff0c\u8868\u793a\u8bbe\u5907\u7684 ID\uff1b\u5728 Shift \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a IDCODE \u5c31\u4f1a\u4e00\u4f4d\u4e00\u4f4d\u4ece TDO \u4e2d\u8f93\u51fa\uff0c\u800c TDI \u8f93\u5165\u7684\u6570\u636e\u90fd\u4f1a\u88ab\u5ffd\u7565\u6389\u3002BYPASS \u8bbe\u5907\u5219\u662f\u4e00\u4e2a 1 \u4f4d\u7684\u5bc4\u5b58\u5668\uff0c\u76f4\u63a5\u4ece TDI \u5230\u5bc4\u5b58\u5668\uff0c\u5bc4\u5b58\u5668\u5230 TDO\uff0c\u6570\u636e\u5c31\u8fd9\u4e48\u6d41\u8fc7\u53bb\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u5728 RISC-V Debug \u91cc\u9762\uff0cJTAG \u662f\u600e\u4e48\u7528\u7684\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u7c7b\u6bd4\u4e00\u4e0b\uff1aCaptureDR \u76f8\u5f53\u4e8e\u8bfb\u53d6\u5bc4\u5b58\u5668\u5230\u7f13\u51b2\u533a\uff0c\u7136\u540e ShiftDR \u5728\u8bfb\u53d6\u7f13\u51b2\u533a\u7684\u540c\u65f6\u5199\u5165\u7f13\u51b2\u533a\uff0c\u6700\u540e UpdateDR \u5219\u662f\u628a\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u5199\u5165\u5230\u5bc4\u5b58\u5668\u4e2d\u3002\u8fd9\u548c MMIO \u6709\u70b9\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u6b21\u64cd\u4f5c\u4e0d\u662f\u5355\u72ec\u7684\u5199\u548c\u8bfb\uff0c\u800c\u662f\u4e00\u6b21\u64cd\u4f5c\u7b49\u4e8e\u5148\u8bfb\u540e\u5199\u3002</p> <p>\u8fd8\u662f\u6765\u770b\u4f8b\u5b50\u3002dtmcs \u8fd9\u4e2a\u8bbe\u5907\u8868\u793a\u7684\u662f DTM \u5f53\u524d\u7684\u72b6\u6001\uff0c\u5b83\u6709 32 \u4f4d\uff0c\u8bfb\u53d6\u7684\u65f6\u5019\u53ef\u4ee5\u5f97\u5230 DMI \u7684\u72b6\u6001\u548c\u914d\u7f6e\uff0c\u5199\u5165\u7684\u65f6\u5019\u53ef\u4ee5 reset DMI\u3002\u4ee5 OpenOCD \u4ee3\u7801 <code>dtmcontrol_scan</code> \u4e3a\u4f8b\u5b50\uff0c\u5b83\u505a\u4e86\u8fd9\u4e48\u51e0\u4e2a\u4e8b\u60c5\uff1a</p> <ol> <li>\u9996\u5148\u8bbe\u7f6e IR \u4e3a 0x10\uff0c\u5bf9\u5e94 dtmcs\u3002</li> <li>\u5411 DR \u4e2d\u5199\u5165\u6570\u636e\uff0c\u540c\u65f6\u8bfb\u53d6\u6570\u636e\u3002</li> <li>\u8bbe\u7f6e IR \u4e3a 0x11\uff0c\u5bf9\u5e94 dmi\uff0c\u56e0\u4e3a dmi \u64cd\u4f5c\u662f\u6bd4\u8f83\u591a\u7684\uff0c\u6240\u4ee5\u5b83\u9ed8\u8ba4\u6062\u590d\u5230 dmi\u3002</li> </ol> <p>\u5982\u679c\u6211\u53ea\u60f3\u8bfb\u53d6 dtmcs \u5bc4\u5b58\u5668\uff0c\u90a3\u4e48\u53ea\u8981\u8bbe\u7f6e\u5199\u5165\u6570\u636e\u4e3a 0 \u5373\u53ef\uff0c\u56e0\u4e3a\u5bc4\u5b58\u5668\u7684\u8bbe\u8ba1\u91cc\u8003\u8651\u5230\uff0c\u5982\u679c\u5199\u5165\u5168 0 \u662f\u6ca1\u6709\u526f\u4f5c\u7528\u7684\u3002\u540c\u7406\uff0c\u5982\u679c\u53ea\u60f3\u5199\u5165 dtmcs \u5bc4\u5b58\u5668\uff0c\u76f4\u63a5\u5199\u5165\u5373\u53ef\uff0c\u56e0\u4e3a\u8bbe\u8ba1\u7684\u65f6\u5019\u4e5f\u4fdd\u8bc1\u8bfb\u5165\u5bc4\u5b58\u5668\u7684\u503c\u662f\u6ca1\u6709\u526f\u4f5c\u7528\u7684\u3002\u8fd9\u6837\uff0c\u5c31\u5728\u4e00\u4e2a\u4e00\u8bfb\u4e00\u5199\u7684\u64cd\u4f5c\u4e2d\uff0c\u5b9e\u73b0\u4e86\u8bfb\u6216\u8005\u5199\u7684\u529f\u80fd\u3002</p> <p>\u90a3\u4e48\uff0cdmi \u5bc4\u5b58\u5668\u7684\u7528\u9014\u662f\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u524d\u9762\u63d0\u5230\u8fc7\uff0cJTAG \u5176\u5b9e\u662f\u4e00\u4e2a\u4f20\u8f93\u5c42\uff0c\u800c DMI \u53c8\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u7684\u5bc4\u5b58\u5668\uff0c\u8fd9\u4f1a\u8ba9\u4eba\u6709\u70b9\u6df7\u4e71\uff0c\u4e3a\u5565\u5230\u5904\u90fd\u662f\u5bc4\u5b58\u5668\uff1f\u53c8\u662f JTAG \u7684 IR/DR\uff0c\u53c8\u662f dmi\uff0cdmi \u53c8\u6709\u4e00\u5806\u5bc4\u5b58\u5668\uff0c\u8fd9\u662f\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <p>\u9996\u5148\u6211\u4eec\u6765\u770b dmi \u5bc4\u5b58\u5668\u7684\u5b9a\u4e49\u3002\u5b83\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a\u5730\u5740\u3001\u6570\u636e\u548c\u64cd\u4f5c\u3002\u7531\u4e8e JTAG \u6bcf\u6b21\u64cd\u4f5c\u662f\u4e00\u8bfb\u4e00\u5199\uff0c\u867d\u7136\u5bc4\u5b58\u5668\u5b9a\u4e49\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u8bfb\u548c\u5199\u7684\u542b\u4e49\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u6bd4\u5982\u8bfb\u7684\u65f6\u5019\uff0c\u5b83\u8868\u793a\u7684\u662f\u4e0a\u4e00\u6b21 dmi \u8bf7\u6c42\u7684\u7ed3\u679c\u3002\u5730\u5740\u8fd8\u662f\u4e0a\u4e00\u6b21\u8bf7\u6c42\u7684\u5730\u5740\uff0c\u6570\u636e\u5219\u662f\u4e0a\u4e00\u6b21\u8bf7\u6c42\u7684\u7ed3\u679c\uff0c\u64cd\u4f5c\u5b57\u6bb5 0 \u8868\u793a\u6210\u529f\uff0c2 \u8868\u793a\u5931\u8d25\uff0c3 \u8868\u793a\u8fd8\u6ca1\u6267\u884c\u5b8c\u3002\u800c\u5199\u7684\u65f6\u5019\uff0c\u5730\u5740\u548c\u6570\u636e\u8868\u793a\u4e86\u5bf9\u54ea\u4e2a\u5bc4\u5b58\u5668\u5199\u5165\u4ec0\u4e48\u6570\u636e\uff0c\u64cd\u4f5c\u5b57\u6bb5 0 \u8868\u793a\u65e0\u64cd\u4f5c\uff0c1 \u8868\u793a\u8bfb\uff0c2 \u8868\u793a\u5199\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u60f3\u64cd\u4f5c dmi \u5b9a\u4e49\u7684\u5bc4\u5b58\u5668\uff0c\u9700\u8981\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff0c\u8fd9\u4e5f\u662f OpenOCD <code>dmi_op_timeout</code> \u8981\u505a\u7684\u4e8b\u60c5\uff1a</p> <ol> <li>\u8bbe\u7f6e IR \u4e3a 0x11\uff0c\u5bf9\u5e94 DMI\u3002</li> <li>\u5411 DR \u5199\u5165\u8bf7\u6c42\u7684\u5730\u5740 + \u6570\u636e + \u64cd\u4f5c\uff0c\u4e22\u5f03\u8bfb\u53d6\u7684\u7ed3\u679c\u3002</li> <li>\u7b49\u5f85\u82e5\u5e72\u4e2a\u5468\u671f\u3002</li> <li>\u5411 DR \u5199\u5165\u5168 0\uff0c\u5bf9\u5e94\u65e0\u64cd\u4f5c\uff0c\u540c\u65f6\u8bfb\u53d6\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5c31\u5bf9\u5e94\u4e0a\u9762\u7684\u8bf7\u6c42\u3002</li> </ol> <p>\u53ef\u4ee5\u9884\u671f\uff0c\u5982\u679c\u9996\u5148\u5199\u5165\u4e86\u4e00\u4e2a\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21 DR scan \u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u662f\u5426\u6210\u529f\u5199\u5165\uff1b\u5982\u679c\u9996\u5148\u5199\u5165\u4e86\u4e00\u4e2a\u8bfb\u64cd\u4f5c\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21 DR scan \u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u503c\u3002</p> <p>\u53ef\u80fd\u770b\u8d77\u6765\u8fd8\u662f\u5f88\u7ed5\uff0c\u786e\u5b9e\u5f88\u7ed5\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6709\u4e00\u4e2a\u5c01\u88c5\u7684\u8fc7\u7a0b\u3002\u9996\u5148\uff0cDMI \u672c\u8eab\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5bc4\u5b58\u5668\uff0c\u8fd9\u4e9b\u5bc4\u5b58\u5668\u8bfb/\u5199\u90fd\u6709\u4e00\u5b9a\u7684\u542b\u4e49\uff0c\u6bd4\u5982\u63a7\u5236\u67d0\u4e00\u4e2a RISC-V \u6838\u5fc3\u6682\u505c\u7b49\u7b49\u3002\u63a5\u7740\uff0cJTAG \u9700\u8981\u4f20\u8f93 DMI \u7684\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\uff0c\u540c\u65f6\u8fd8\u8981\u8003\u8651\u8bfb\u5199\u5c1a\u672a\u5b8c\u6210\u7684\u60c5\u51b5\uff0c\u600e\u4e48\u529e\uff1f\u7ed3\u8bba\u5c31\u662f\u901a\u8fc7 DR \u6765\u5b9e\u73b0\uff0c\u5199\u5165 DR \u65f6\uff0c\u6309\u7167 DR \u4e2d\u7684\u64cd\u4f5c\u6570\uff0c\u5bf9\u5e94\u5230 DMI \u7684\u5199\u5165/\u8bfb\u53d6\uff1b\u7136\u540e\u8bfb\u53d6 DR \u7684\u65f6\u5019\uff0c\u6309\u7167 DMI \u7684\u72b6\u6001\uff0c\u544a\u8bc9 OpenOCD \u76ee\u524d\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\u4e86\u4e0a\u4e00\u6b21 DMI \u64cd\u4f5c\uff0c\u548c\u64cd\u4f5c\u7684\u7ed3\u679c\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#dmi","title":"DMI","text":"<p>\u8bb2\u5b8c JTAG \u4ee5\u540e\uff0c\u7ec8\u4e8e\u6765\u5230\u4e86 DMI\u3002\u5176\u5b9e DMI \u5c31\u662f\u4e00\u7cfb\u5217\u7684\u5bc4\u5b58\u5668\uff0c\u7c7b\u4f3c\u4e8e MMIO \u8bbe\u5907\uff0c\u53ea\u4e0d\u8fc7\u8bbf\u95ee\u65b9\u5f0f\u4e0d\u662f\u6211\u4eec\u901a\u5e38\u7684\u5185\u5b58\u8bfb\u5199\uff0c\u800c\u662f\u901a\u8fc7 JTAG \u7684\u65b9\u5f0f\u8fdb\u884c\u3002\u5b83\u6709\u5f88\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u6458\u5f55\u5982\u4e0b\uff1a</p> <ol> <li>dmcontrol 0x10: Debug Module Control</li> <li>dmstatus 0x11: Debug Module Status</li> <li>hartinfo 0x12: Hart Info</li> <li>hartsum 0x13: Hart Summary</li> <li>command 0x16: Abstract Control and Status</li> <li>data0 0x04: Abstract Data 0</li> <li>progbuf0 0x20: Program Buffer 0</li> <li>sbcs 0x38: System Bus Access Control and Status</li> <li>sbaddress0 0x39: System Bus Address 31:0</li> <li>sbdata0 0x3c: System Bus Data 31:0</li> </ol> <p>OpenOCD \u7684 <code>examine</code> \u51fd\u6570\u5bf9 DMI \u521d\u59cb\u5316\u5e76\u8fdb\u884c\u4e00\u4e9b\u53c2\u6570\u7684\u83b7\u53d6\u3002\u5b83\u7684\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <ol> <li>\u8c03\u7528 dtmcontrol_scan\uff0c\u8bfb\u53d6 JTAG \u91cc\u7684 dtmcs\uff0c\u53ef\u4ee5\u5f97\u5230 JTAG-DMI \u7684\u914d\u7f6e\u4fe1\u606f</li> <li>\u5411 dmcontrol \u5199\u5165\uff0c\u8fdb\u884c\u590d\u4f4d</li> <li>\u5411 dmcontrol \u5199\u5165\uff0c\u542f\u7528\u8c03\u8bd5\u6a21\u5757</li> <li>\u4ece hartinfo \u8bfb\u53d6 hart \u4fe1\u606f</li> <li>\u68c0\u67e5\u5404\u4e2a hart \u7684\u72b6\u6001</li> </ol> <p>\u7c7b\u4f3c\u5730\uff0c\u5176\u4ed6\u5404\u79cd\u8c03\u8bd5\u64cd\u4f5c\u90fd\u662f\u5bf9\u8fd9\u4e9b DMI \u5bc4\u5b58\u5668\u7684\u8bfb\u548c\u5199\u8fdb\u884c\u3002RISC-V Debug Spec \u9644\u5f55\u91cc\u8fd8\u63d0\u5230\u4e86\u5982\u4f55\u5b9e\u73b0\u8c03\u8bd5\u5668\u7684\u4e00\u4e9b\u529f\u80fd\u3002</p> <p>\u6bd4\u5982\u8981\u8bfb\u53d6 CPU \u7684\u5bc4\u5b58\u5668\uff08\u6bd4\u5982\u901a\u7528\u5bc4\u5b58\u5668\uff0cCSR \u7b49\u7b49\uff09\u7684\u8bdd\uff0c\u6709\u5982\u4e0b\u7684\u65b9\u5f0f\uff1a</p> <p>\u7b2c\u4e00\u79cd\u662f Abstract Command\uff0c\u76f4\u63a5\u5411 DMI \u5199\u5165\u8981\u5bc4\u5b58\u5668\u7f16\u53f7\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u8bfb/\u5199\u3002</p> <p>\u7b2c\u4e8c\u79cd\u662f Program Buffer\u3002\u5b83\u662f\u4e00\u5757\u5c0f\u7684\u4ee3\u7801\u5b58\u50a8\uff0c\u53ef\u4ee5\u901a\u8fc7 DMI \u5411\u5176\u4e2d\u5199\u5165\u6307\u4ee4\uff0c\u6bd4\u5982 <code>csrw s0, mstatus; ebreak</code>\uff0c\u7136\u540e\u8bbe\u7f6e s0 \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u518d\u6267\u884c Program Buffer \u91cc\u7684\u4ee3\u7801\u3002</p> <p>\u4ee5 OpenOCD \u4ee3\u7801\u4e3a\u4f8b\uff0c<code>register_read_abstract</code> \u505a\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u627e\u5230\u8981\u8bfb\u53d6\u7684\u5bc4\u5b58\u5668\u5bf9\u5e94\u7684 Abstract Register Number</li> <li>\u8fdb\u884c transfer \u547d\u4ee4\uff0cDM \u4f1a\u8bfb\u53d6\u5bf9\u5e94\u5bc4\u5b58\u5668\u5230 data0 \u4e2d</li> <li>\u4ece data0 \u4e2d\u8bfb\u53d6\u5bc4\u5b58\u5668\u5185\u5bb9</li> </ol> <p>\u5982\u679c\u8981\u8bfb\u53d6\u5185\u5b58\u7684\u8bdd\uff0c\u4e5f\u6709\u4e24\u79cd\u65b9\u6cd5\u3002\u4e00\u79cd\u662f\u76f4\u63a5\u5411 DMI \u5199\u5165\u8981\u8bfb\u53d6\u7684\u603b\u7ebf\u5730\u5740\uff0c\u7136\u540e\u518d\u5411\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u7b2c\u4e8c\u79cd\u8fd8\u662f\u5229\u7528 Program Buffer\uff0c\u5199\u5165\u4e00\u6761 <code>lw s0, 0(s0)</code> \u6307\u4ee4\uff0c\u7136\u540e\u5148\u5411 s0 \u5199\u5165\u5730\u5740\uff0c\u6267\u884c Program Buffer \u540e\uff0c\u518d\u628a s0 \u5bc4\u5b58\u5668\u7684\u503c\u8bfb\u51fa\u6765\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#abstract-command-\u5b9e\u73b0","title":"Abstract Command \u5b9e\u73b0","text":"<p>\u90a3\u4e48\uff0c\u5982\u4f55\u5b9e\u73b0\u4e0a\u9762\u63d0\u5230\u7684 Abstract Command\uff08\u6bd4\u5982\u8bfb\u5199\u5bc4\u5b58\u5668\uff0c\u8bfb\u5199\u5185\u5b58\u7b49\uff09\u5462\uff1fDebug Spec \u91cc\u9762\u63d0\u5230\u4e00\u79cd Execution-Based \u7684\u65b9\u5f0f\uff0c\u5373\u5728 Debug mode \u4e0b\uff0c\u6838\u5fc3\u4f9d\u7136\u5728\u6267\u884c\u4ee3\u7801\uff0c\u53ea\u4e0d\u8fc7\u6267\u884c\u7684\u662f\u8c03\u8bd5\u7528\u7684\u7279\u6b8a\u4ee3\u7801\u3002\u5b83\u505a\u7684\u5c31\u662f\u8f6e\u8be2 Debug Module \u7b49\u5f85\u547d\u4ee4\uff0c\u63a5\u53d7\u5230\u547d\u4ee4\u4ee5\u540e\uff0c\u5c31\u53bb\u8bfb\u5199\u5bc4\u5b58\u5668/\u5185\u5b58\uff0c\u7136\u540e\u901a\u8fc7 data0-12 \u6765\u4f20\u8f93\u6570\u636e\u3002</p> <p>\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u7279\u522b\u7684\u70b9\uff0c\u5c31\u662f\u8bfb\u53d6\u5bc4\u5b58\u5668\u7684\u65f6\u5019\uff0c\u5bc4\u5b58\u5668\u7684\u7f16\u53f7\u662f\u76f4\u63a5\u8bb0\u5f55\u5728\u6307\u4ee4\u4e2d\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u8ba9 Debug Module \u52a8\u6001\u751f\u6210\u6307\u4ee4\uff0c\u7136\u540e\u8ba9\u6838\u5fc3\u5237\u65b0 ICache \u7136\u540e\u8df3\u8f6c\u8fc7\u53bb\u3002\u53e6\u5916\uff0c\u8fd8\u53ef\u4ee5\u5229\u7528 dscratch0/dscratch1 \u5bc4\u5b58\u5668\u6765\u4fdd\u5b58 gpr\uff0c\u7136\u540e\u7528 dret \u9000\u51fa\u7684\u65f6\u5019\u518d\u6062\u590d\uff0c\u8fd9\u6837\u5c31\u6709\u4e24\u4e2a gpr \u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u529f\u80fd\u4e86\uff0c\u5b9e\u9645\u4e0a\u8fd9\u5df2\u7ecf\u591f\u7528\u4e86\uff08\u4e00\u4e2a\u6280\u5de7\u662f\uff0c\u628a\u5730\u5740\u8bbe\u4e3a 0 \u9644\u8fd1\uff0c\u7136\u540e\u76f4\u63a5\u7528 zero \u5bc4\u5b58\u5668\u52a0\u504f\u79fb\u6765\u5bfb\u5740\uff09\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#\u5355\u6b65\u8c03\u8bd5\u5b9e\u73b0","title":"\u5355\u6b65\u8c03\u8bd5\u5b9e\u73b0","text":"<p>\u5728 dcsr \u4e2d\uff0c\u6709\u4e00\u4e2a\u503c step \u8868\u793a\u662f\u5426\u5728\u5355\u6b65\u8c03\u8bd5\u72b6\u6001\u3002\u8bbe step \u4e3a 1 \u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u5728 debug mode \u4e2d\uff0c\u53ea\u9700\u8981\u8bb0\u5f55\u4ee5\u53ca\u6267\u884c\u7684\u6307\u4ee4\u6570\uff0c\u5f53\u6267\u884c\u4e86\u4e00\u6761\u6307\u4ee4\u540e\uff0c\u89c6\u4e3a\u4e0b\u4e00\u4e2a\u6307\u4ee4\u53d1\u751f\u4e86\u8fdb\u5165 debug mode \u7684\u5f02\u5e38\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u5355\u6b65\u8c03\u8bd5\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#\u8f6f\u4ef6\u65ad\u70b9\u5b9e\u73b0","title":"\u8f6f\u4ef6\u65ad\u70b9\u5b9e\u73b0","text":"<p>\u8c03\u8bd5\u5668\u4e3a\u4e86\u6253\u65ad\u70b9\uff0c\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u662f\uff0c\u5f80\u65ad\u70b9\u5904\u5199\u5165 ebreak \u6307\u4ee4\uff0c\u7136\u540e\u8bbe\u7f6e dcsr \u7684 ebreakm/s/u\uff0c\u8868\u793a\u5728\u8fd9\u4e9b\u7279\u6743\u96c6\u91cc\uff0cebreak \u662f\u8fdb\u5165 debug mode\uff0c\u800c\u4e0d\u662f\u539f\u6765\u7684\u5904\u7406\u8fc7\u7a0b\u3002\u7136\u540e\uff0c\u7a0b\u5e8f\u8fd0\u884c\u5230 ebreak \u6307\u4ee4\u7684\u65f6\u5019\uff0c\u8fdb\u5165 debug mode\uff0copenocd \u53d1\u73b0\u6838\u5fc3\u8fdb\u5165 halted \u72b6\u6001\u540e\uff0c\u8ba9 gdb \u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u3002</p> <p>\u786c\u4ef6\u65b9\u9762\u7684\u5b9e\u73b0\u65b9\u6cd5\u5c31\u662f\uff0c\u5728\u9047\u5230 ebreak \u7684\u65f6\u5019\uff0c\u5224\u65ad\u4e00\u4e0b\u5f53\u524d\u7684\u7279\u6743\u96c6\uff0c\u7ed3\u5408 ebreakm/s/u \u5224\u65ad\u8df3\u8f6c\u5230\u4ec0\u4e48\u72b6\u6001\u3002\u6b64\u5916\uff0c\u7531\u4e8e\u5b83\u4f1a\u5199\u5165\u6307\u4ee4\u5230\u5185\u5b58\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u6267\u884c fence.i \u6307\u4ee4\uff0c\u800c OpenOCD \u9700\u8981\u4f9d\u8d56 progbuf \u6765\u6267\u884c fence.i \u6307\u4ee4\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u8fd9\u4e2a\u65b9\u6848\u5de5\u4f5c\uff0c\u8fd8\u5f97\u5b9e\u73b0 Program Buffer\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u8f6f\u4ef6\u65ad\u70b9\u4e5f\u6709\u5c40\u9650\u6027\uff0c\u6bd4\u5982\u5185\u5b58\u4e0d\u53ef\u5199\uff0c\u6bd4\u5982 ROM\uff0c\u4e0d\u80fd\u8986\u76d6\u91cc\u9762\u7684\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u6709\u53ef\u80fd\u51fa\u95ee\u9898\u3002\u800c\u4e14\u786c\u4ef6\u65ad\u70b9\u6027\u80fd\u4e5f\u66f4\u597d\uff0c\u4e0d\u9700\u8981\u6765\u56de\u8fd9\u6837\u5199\u6307\u4ee4\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#semihosting","title":"Semihosting","text":"<p>ARM \u6709\u4e00\u79cd semihosting \u673a\u5236\uff0c\u5c31\u662f\u5904\u7406\u5668\u6267\u884c\u4e00\u79cd\u7279\u5b9a\u7684\u6307\u4ee4\u5e8f\u5217\uff0c\u7136\u540e\u8c03\u8bd5\u5668\u770b\u5230\u6574\u4e2a\u5e8f\u5217\u7684\u65f6\u5019\uff0c\u4e0d\u662f\u8fdb\u5165 GDB \u8c03\u8bd5\u72b6\u6001\uff0c\u800c\u662f\u53bb\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u6bd4\u5982\u8f93\u51fa\u4fe1\u606f\uff0c\u8bfb\u5199\u6587\u4ef6\u7b49\u7b49\uff0c\u7136\u540e\u7ed3\u679c\u901a\u8fc7 JTAG \u5199\u56de\u53bb\u3002OpenOCD \u7ed9 RISC-V \u4e5f\u505a\u4e86\u7c7b\u4f3c\u7684 semihosting \u673a\u5236\uff0c\u53ea\u4e0d\u8fc7\u89e6\u53d1\u7684\u6307\u4ee4\u5e8f\u5217\u4e0d\u5927\u4e00\u6837\uff0c\u4f46\u662f\u673a\u5236\u662f\u7c7b\u4f3c\u7684\u3002</p> <p>\u5982\u679c\u7528\u8fc7 Rocket Chip \u4eff\u771f\u7684\u6216\u8005\u4ee5\u524d\u7684 ucb-bar/fpga-zynq \u9879\u76ee\u7684\u8bdd\uff0c\u4f1a\u77e5\u9053\u8fd8\u6709\u4e00\u4e2a\u76ee\u7684\u6709\u4e9b\u7c7b\u4f3c\u7684\u4e1c\u897f\uff1aHTIF + fesvr\uff0c\u5b83\u662f\u901a\u8fc7 fromhost/tohost \u4e24\u7ec4\u5730\u5740\u6765\u8fdb\u884c\u901a\u4fe1\uff0c\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u7f3a\u70b9\u662f\u9700\u8981 poll tohost/fromhost \u5730\u5740\u7684\u5185\u5bb9\uff0c\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u9ebb\u70e6\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#program-buffer","title":"Program Buffer","text":"<p>\u6b64\u5916\uff0cdebug spec \u8fd8\u6709\u4e00\u4e2a\u53ef\u9009\u7684\u529f\u80fd\uff0c\u5c31\u662f Program Buffer\uff0c\u8c03\u8bd5\u5668\u53ef\u4ee5\u5f80\u91cc\u9762\u63d2\u5165\u81ea\u5b9a\u4e49\u7684\u6307\u4ee4\uff0c\u7136\u540e\u7ed3\u5408 abstract command \u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u4e00\u4e9b\u6bd4\u8f83\u9ad8\u6548\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 OpenOCD \u5b9e\u73b0\u7684\u6279\u91cf\u5199\u5165\u5185\u5b58\uff1a</p> <pre><code>sw s1, 0(a0)\naddi a0, a0, 4\nebreak\n</code></pre> <p>\u5e76\u4e14\u8bbe\u7f6e abstractauto\uff0c\u7136\u540e\u91cd\u590d\u7684\u64cd\u4f5c\u662f\u5f80 s1 \u91cc\u9762\u5199\u5165\u65b0\u7684\u6570\u636e\uff0c\u7136\u540e\u8df3\u8f6c\u5230 program buffer\uff0c\u8fdb\u884c\u4e0a\u9762\u7684 sw \u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e00\u6b21 dmi \u8bf7\u6c42\u5b8c\u6210\u4e00\u6b21\u5185\u5b58\u7684\u5199\u5165\uff0c\u6bd4\u8f83\u9ad8\u6548\u3002</p>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2021/12/12/riscv-debug/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ol> <li>RISC-V Debug Spec 0.13</li> <li>IEEE Standard for JTAG 1149.1-2013</li> <li>OpenOCD \u76f8\u5173\u4ee3\u7801</li> </ol>","tags":["riscv","cpu","debug","jtag","teaching"]},{"location":"hardware/2020/02/09/rocket-chip-bscan-analysis/","title":"\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406","text":"","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/09/rocket-chip-bscan-analysis/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u6700\u8fd1 @jsteward \u5728\u7814\u7a76\u5982\u4f55\u901a\u8fc7 JTAG \u5bf9 FPGA \u91cc\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5\u3002\u4e4b\u524d @sequencer \u5df2\u7ecf\u505a\u4e86\u4e00\u4e9b\u5b9e\u8df5\uff0c\u6211\u4eec\u5728\u91cd\u590d\u4ed6\u7684\u5de5\u4f5c\uff0c\u540c\u65f6\u4e5f\u7814\u7a76\u4e86\u4e00\u4e0b\u8fd9\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002</p>","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/09/rocket-chip-bscan-analysis/#\u539f\u7406","title":"\u539f\u7406","text":"<p>\u6211\u4eec\u4ece @sequencer \u5f97\u5230\u4e86\u4e00\u4efd\u53ef\u7528\u7684 Scala \u4ee3\u7801 \u548c OpenOCD \u914d\u7f6e\uff0c\u5e76\u4e14\u4e86\u89e3\u5230\uff1a</p> <ol> <li>\u53ef\u4ee5\u901a\u8fc7 openocd \u627e\u5230\u5e76\u8c03\u8bd5 Rocket Chip</li> <li>openocd \u662f\u901a\u8fc7 JTAG \u5411 FPGA \u7684 TAP \u7684 IR \u5199\u5165 USER4\uff0c\u7136\u540e\u5f80 DR \u5199\u5165\u7279\u5b9a\u683c\u5f0f\u7684\u6570\u636e\uff0c\u7136\u540e\u63a7\u5236 Rocket Chip \u7684 JTAG\u3002</li> </ol> <p>\u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u201c\u5c01\u88c5\u201d\u7684\u8fc7\u7a0b\uff0c\u5728\u4e00\u4e2a\u4ec5\u53ef\u4ee5\u63a7\u5236 DR \u7684 JTAG \u4e2d\u63a7\u5236\u53e6\u4e00\u4e2a JTAG\u3002\u9996\u5148\u53ef\u4ee5\u627e\u5230 OpenOCD \u7aef\u7684\u64cd\u4f5c\u4ee3\u7801\uff1a</p> <pre><code>tunneled_ir[3].num_bits = 3;\ntunneled_ir[3].out_value = bscan_zero;\ntunneled_ir[3].in_value = NULL;\ntunneled_ir[2].num_bits = bscan_tunnel_ir_width;\ntunneled_ir[2].out_value = ir_dtmcontrol;\ntunneled_ir[1].in_value = NULL;\ntunneled_ir[1].num_bits = 7;\ntunneled_ir[1].out_value = tunneled_ir_width;\ntunneled_ir[2].in_value = NULL;\ntunneled_ir[0].num_bits = 1;\ntunneled_ir[0].out_value = bscan_zero;\ntunneled_ir[0].in_value = NULL;\n</code></pre> <p>\u5982\u679c\u753b\u6210\u56fe\uff0c\u5927\u6982\u662f\u8fd9\u4e2a\u6837\u5b50\uff08IR\uff09\uff1a</p> 3 bits IR Width bits 7 bits 1 bit TDI Data Register TDO 0 Payload Tunneled IR Width 0 -&gt; Rocket Chip TAP -&gt; <p>DR\uff1a</p> 3 bits DR Width bits 7 bits 1 bit TDI Data Register TDO 0 Payload Tunneled DR Width 1 -&gt; Rocket Chip TAP -&gt; <p>\u8fd9\u91cc TDI \u548c TDO \u662f\u76f4\u63a5\u63a5\u5230 Rocket Chip \u7684 JTAG \u4e2d\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u671f\u671b\uff0c\u5f53 Rocket Chip TAP \u5728 Shift-IR/Shift-DR \u9636\u6bb5\u7684\u65f6\u5019\uff0c\u521a\u597d\u901a\u8fc7\u7684\u662f Payload \u90e8\u5206\u3002\u800c\u63a7\u5236 TAP \u72b6\u6001\u673a\uff0c\u9700\u8981\u63a7\u5236 TMS\uff0c\u8fd9\u4e2a\u5219\u662f\u901a\u8fc7\u4e00\u6bb5 HDL \u6765\u5b8c\u6210\u7684\uff1a</p> <pre><code>always@(*) begin \n        if (counter_neg == 8'h04) begin \n                jtag_tms = TDI_REG; \n        end else if (counter_neg == 8'h05) begin \n                jtag_tms = 1'b1; \n        end else if ((counter_neg == (8'h08 + shiftreg_cnt)) || (counter_neg == (8'h08 + shiftreg_cnt - 8'h01))) begin \n                jtag_tms = 1'b1; \n        end else begin \n                jtag_tms = 1'b0; \n        end \nend\n</code></pre> <p>\u8fd9\u91cc <code>TDI_REG</code> \u53d6\u7684\u662f\u7b2c\u4e00\u4e2a bit \u7684\u53cd\uff08\u4e5f\u5c31\u662f\u4e0a\u9762 IR \u5bf9\u5e94 0\uff0cDR \u5bf9\u5e94 1 \u7684\u90a3\u4e00\u4f4d\uff09\uff0c<code>shiftreg_cnf</code> \u5219\u662f\u4e4b\u540e 7 \u4e2a bit\uff0c\u5bf9\u5e94\u4e0a\u9762\u7684 Tunneled IR/DR Width\u3002\u90a3\u4e48\uff0c\u5728\u9009\u62e9 IR \u65f6 TMS \u7684\u5e8f\u5217\u4e3a\uff1a</p> 4 cycles 1 cycle 1 cycle 2 cycles shiftreg_cnt-1 cycles 2 cycles rest cycles 0 1 1 0 0 1 0 Run-Test/Idle Select-DR-Scan Select-IR-Scan Capture-IR, Shift-IR Shift-IR Exit1-IR, Update-IR Run-Test/Idle <p>\u7c7b\u4f3c\u5730\uff0c\u5982\u679c\u662f\u9009\u62e9 DR\uff1a</p> 4 cycles 1 cycle 1 cycle 2 cycles shiftreg_cnt-1 cycles 2 cycles rest cycles 0 0 1 0 0 1 0 Run-Test/Idle Run-Test/Idle Select-DR-Scan Capture-DR, Shift-DR Shift-DR Exit1-DR, Update-DR Run-Test/Idle <p>\u8fd9\u6837\uff0c\u521a\u597d\u5728 Shift-IR/DR \u72b6\u6001\u4e0b\uff0cPayload \u4f1a\u88ab\u5199\u5165 IR/DR\uff0c\u4ece\u800c\u5b8c\u6210\u4e86\u671f\u671b\u7684\u64cd\u4f5c\u3002\u901a\u8fc7\u89c4\u5b9a\u4e00\u4e2a\u7279\u5b9a\u683c\u5f0f\u7684 Data Register\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5d4c\u5957\u7684 TAP \u7684 IR \u548c DR \u7684\u64cd\u4f5c\u3002</p>","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/09/rocket-chip-bscan-analysis/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ol> <li>JTAG Standard</li> <li>sequencer/rocket-playground</li> <li>SiFive's JTAG Tunnel: https://github.com/sifive/fpga-shells/blob/c099bd9b4f916bc0ba88030939a9614d0b0daf2d/src/main/scala/ip/xilinx/Xilinx.scala#L13</li> <li>https://github.com/watz0n/arty_xjtag</li> <li>https://github.com/riscv/riscv-openocd/blob/7cb8843794a258380b7c37509e5c693977675b2a/src/target/riscv/riscv.c#L361</li> <li>UG740: 7 Series FPGAs Configuration</li> </ol>","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/10/rocket-chip-bscan-debug/","title":"\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5","text":"","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/10/rocket-chip-bscan-debug/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u5728\u4e0a\u4e00\u4e2a post \u91cc\u7814\u7a76\u4e86\u539f\u7406\uff0c\u4eca\u5929\u4e5f\u662f\u6210\u529f\u5728 Artix 7 \u4e0a\u5b9e\u73b0\u4e86\u8c03\u8bd5\u3002\u6548\u679c\u5982\u4e0b\uff1a</p> <p>OpenOCD \u8f93\u51fa\uff1a</p> <pre><code>Info : JTAG tap: riscv.cpu tap/device found: 0x0362d093 (mfg: 0x049 (Xilinx), part: 0x362d, ver: 0x0)\nInfo : datacount=1 progbufsize=16\nInfo : Disabling abstract command reads from CSRs.\nInfo : Examined RISC-V core; found 1 harts\nInfo :  hart 0: XLEN=32, misa=0x40801105\nInfo : Listening on port 3333 for gdb connections\n</code></pre> <p>GDB \u8f93\u51fa\uff1a</p> <pre><code>Remote debugging using localhost:3333\n0x0001018c in getc () at bootloader.c:36\n36        while (!(*UART_LSR &amp; 0x1))\n(gdb) \n</code></pre> <p>\u8fd9\u91cc\u7528\u7684 OpenOCD \u548c GDB \u90fd\u662f riscv \u7248\u672c\uff0c\u4e0a\u6e38\u7684\u652f\u6301\u5c1a\u4e0d\u5b8c\u5584\u3002\u5bf9\u4e8e Homebrew \u7528\u6237\uff0c\u6211\u5728 jiegec/homebrew-formulas \u7ef4\u62a4\u4e86\u9700\u8981\u7684 Formula\u3002</p>","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2020/02/10/rocket-chip-bscan-debug/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"<p>\u4ee3\u7801\u57fa\u672c\u501f\u9274\u4e86 sequencer/rocket-playground \u548c KireinaHoro/rocket-zcu102 \u800c\u6765\uff0c\u4ee3\u7801\u65b9\u9762\u4e3b\u8981\u662f\u6dfb\u52a0\u4e86 BscanJTAG.scala\uff0c\u7136\u540e\u5728 Top \u6a21\u5757\u4e0b\u628a\u5b83\u8fde\u63a5\u5230\u5185\u90e8\u7684 JTAG \u4e2d\uff1a</p> <pre><code>val boardJTAG = Module(new BscanJTAG)\nval jtagBundle = target.debug.head.systemjtag.head\n\n// set JTAG parameters\njtagBundle.reset := reset\njtagBundle.mfr_id := 0x233.U(11.W)\njtagBundle.part_number := 0.U(16.W)\njtagBundle.version := 0.U(4.W)\n// connect to BSCAN\njtagBundle.jtag.TCK := boardJTAG.tck\njtagBundle.jtag.TMS := boardJTAG.tms\njtagBundle.jtag.TDI := boardJTAG.tdi\nboardJTAG.tdo := jtagBundle.jtag.TDO.data\nboardJTAG.tdoEnable := jtagBundle.jtag.TDO.driven\n</code></pre> <p>\u4ee3\u7801\u65b9\u9762\u5c31\u8db3\u591f\u4e86\u3002\u7136\u540e\uff0c\u9700\u8981\u4e00\u4e2a riscv-openocd \u548c riscv-gdb\uff0c\u5206\u522b\u4ece\u4e0a\u6e38 repo \u7f16\u8bd1\u5f97\u6765\u3002\u7136\u540e\u91c7\u7528\u4ee5\u4e0b\u7684 openocd.cfg\uff1a</p> <pre><code>adapter_khz 20000\ninterface ftdi\nftdi_vid_pid 0x0403 0x6014\nftdi_layout_init 0x00e8 0x60eb\nftdi_tdo_sample_edge falling\nreset_config none\n\nset _CHIPNAME riscv\njtag newtap $_CHIPNAME cpu -irlen 6\n\nset _TARGETNAME $_CHIPNAME.cpu\n\ntarget create $_TARGETNAME.0 riscv -chain-position $_TARGETNAME\n$_TARGETNAME.0 configure -work-area-phys 0x80000000 -work-area-size 10000 -work-area-backup 1\nriscv use_bscan_tunnel 5\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u7528 GDB \u8c03\u8bd5\u4e86\u3002</p>","tags":["fpga","riscv","rocketchip","bscan","jtag","openocd"]},{"location":"hardware/2022/05/13/rocket-chip-custom-debug/","title":"\u5411 Rocket Chip \u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7","text":"","tags":["rocketchip","riscv","debug"]},{"location":"hardware/2022/05/13/rocket-chip-custom-debug/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5c1d\u8bd5\u628a\u6838\u5fc3\u4f5c\u4e3a\u4e00\u4e2a Tile \u52a0\u5230 Rocket System \u4e2d\uff0c\u6240\u4ee5\u60f3\u8981\u628a\u6838\u5fc3\u4e4b\u524d\u81ea\u5b9a\u4e49\u7684\u8c03\u8bd5\u4fe1\u53f7\u63a5\u5230\u9876\u5c42\u4e0a\u53bb\u3002Rocket System \u81ea\u5e26\u7684\u652f\u6301\u662f trace\uff0c\u4e5f\u5c31\u662f\u8f93\u51fa\u6bcf\u4e2a\u5468\u671f retire \u7684\u6307\u4ee4\u4fe1\u606f\uff0c\u4f46\u548c\u81ea\u5b9a\u4e49\u7684\u4e0d\u5927\u4e00\u6837\uff0c\u6240\u4ee5\u7814\u7a76\u4e86\u4e00\u4e0b\u600e\u4e48\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u8c03\u8bd5\u4fe1\u53f7\uff0c\u5e76\u4e14\u8fde\u63a5\u5230\u9876\u5c42\u3002</p>","tags":["rocketchip","riscv","debug"]},{"location":"hardware/2022/05/13/rocket-chip-custom-debug/#\u5206\u6790-trace-\u4fe1\u53f7\u8fde\u63a5\u65b9\u5f0f","title":"\u5206\u6790 Trace \u4fe1\u53f7\u8fde\u63a5\u65b9\u5f0f","text":"<p>\u9996\u5148\uff0c\u89c2\u5bdf Rocket Chip \u81ea\u5df1\u4f7f\u7528\u7684 Trace \u4fe1\u53f7\u662f\u5982\u4f55\u8fde\u63a5\u5230\u9876\u5c42\u7684\u3002\u5728\u9876\u5c42\u4e0a\uff0c\u53ef\u4ee5\u627e\u5230\u4f7f\u7528\u7684\u662f <code>testchipip.CanHaveTraceIO</code>:</p> <pre><code>trait CanHaveTraceIO { this: HasTiles =&gt;\n  val module: CanHaveTraceIOModuleImp\n\n  // Bind all the trace nodes to a BB; we'll use this to generate the IO in the imp\n  val traceNexus = BundleBridgeNexusNode[Vec[TracedInstruction]]()\n  val tileTraceNodes = tiles.flatMap {\n    case ext_tile: WithExtendedTraceport =&gt; None\n    case tile =&gt; Some(tile)\n  }.map { _.traceNode }\n\n  tileTraceNodes.foreach { traceNexus := _ }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u91c7\u7528\u4e86 diplomacy \u7684 BundleBridgeNexusNode\uff0c\u628a\u6bcf\u4e2a tile \u53d6\u51fa\u6765\uff0c\u628a\u5b83\u7684 traceNode \u63a5\u5230 traceNexus \u4e0a\u3002\u518d\u770b\u4e00\u4e0b\u6a21\u5757 <code>CanHaveTraceIOModuleImp</code> \u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1a</p> <pre><code>trait CanHaveTraceIOModuleImp { this: LazyModuleImpLike =&gt;\n  val outer: CanHaveTraceIO with HasTiles\n  implicit val p: Parameters\n\n  val traceIO = p(TracePortKey) map ( traceParams =&gt; {\n    val extTraceSeqVec = (outer.traceNexus.in.map(_._1)).map(ExtendedTracedInstruction.fromVec(_))\n    val tio = IO(Output(TraceOutputTop(extTraceSeqVec)))\n\n    val tileInsts = ((outer.traceNexus.in) .map { case (tileTrace, _) =&gt; DeclockedTracedInstruction.fromVec(tileTrace) }\n\n    // Since clock &amp; reset are not included with the traced instruction, plumb that out manually\n    (tio.traces zip (outer.tile_prci_domains zip tileInsts)).foreach { case (port, (prci, insts)) =&gt;\n      port.clock := prci.module.clock\n      port.reset := prci.module.reset.asBool\n      port.insns := insts\n    }\n\n    tio\n  })\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4ece traceNexus \u4e0a\u63a5\u4e86\u82e5\u5e72\u7684 trace \u4fe1\u53f7\uff0c\u7136\u540e\u901a\u8fc7 <code>IO(TraceOutputTop())</code> \u63a5\u5230\u4e86\u9876\u5c42\u7684\u8f93\u51fa\u4fe1\u53f7\u3002</p> <p>\u518d\u6765\u770b\u770b Rocket \u662f\u5982\u4f55\u8fde\u63a5\u7684\uff0c\u9996\u5148\u662f <code>traceNode</code> \u7684\u5b9a\u4e49\uff1a</p> <pre><code>/** Node for the core to drive legacy \"raw\" instruction trace. */\nval traceSourceNode = BundleBridgeSource(() =&gt; Vec(traceRetireWidth, new TracedInstruction()))\n/** Node for external consumers to source a legacy instruction trace from the core. */\nval traceNode: BundleBridgeOutwardNode[Vec[TracedInstruction]] = traceNexus := traceSourceNode\n</code></pre> <p>\u7136\u540e Rocket Tile \u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u628a\u81ea\u5df1\u7684 trace \u63a5\u5230 traceSourceNode \u4e0a\uff1a</p> <pre><code>outer.traceSourceNode.bundle &lt;&gt; core.io.trace\n</code></pre>","tags":["rocketchip","riscv","debug"]},{"location":"hardware/2022/05/13/rocket-chip-custom-debug/#\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7","title":"\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7","text":"<p>\u5230\u8fd9\u91cc\uff0c\u6574\u4e2a\u601d\u8def\u5df2\u7ecf\u6bd4\u8f83\u6e05\u6670\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7167\u732b\u753b\u864e\u5730\u505a\u4e00\u4e2a\u5c31\u884c\u3002\u6bd4\u5982\u8981\u628a\u81ea\u5df1\u7684 Custom Debug \u63a5\u53e3\u66b4\u9732\u51fa\u53bb\uff0c\u9996\u5148\u4e5f\u662f\u5728 Tile \u91cc\u9762\u521b\u5efa\u4e00\u4e2a SourceNode\uff1a</p> <pre><code>// expose debug\nval customDebugSourceNode =\nBundleBridgeSource(() =&gt; new CustomDebug())\nval customDebugNode: BundleBridgeOutwardNode[CustomDebug] =\ncustomDebugSourceNode\n</code></pre> <p>\u5728 BaseTileModuleImp \u91cc\uff0c\u8fdb\u884c\u4fe1\u53f7\u7684\u8fde\u63a5\uff1a</p> <pre><code>// expose debug\nouter.customDebugSourceNode.bundle := core.io.debug\n</code></pre> <p>\u4e3a\u4e86\u66b4\u9732\u5230\u9876\u5c42\uff0c\u6211\u4eec\u53ef\u4ee5\u7c7b\u4f3c\u5730\u505a\u3002\u5728 Subsystem \u4e2d\uff1a</p> <pre><code>// expose debug\nval customDebugNexus = BundleBridgeNexusNode[CustomDebug]()\nval tileCustomDebugNodes = tiles\n  .flatMap { case tile: MeowV64Tile =&gt;\n    Some(tile)\n  }\n  .map { _.customDebugNode }\n\ntileCustomDebugNodes.foreach { customDebugNexus := _ }\n</code></pre> <p>\u6700\u540e\u5728 SubsystemModule Imp \u4e2d\u8fde\u63a5\u5230 IO\uff1a</p> <pre><code>// wire custom debug signals\nval customDebugIO = outer.customDebugNexus.in.map(_._1)\nval customDebug = IO(\n  Output(\n    Vec(customDebugIO.length, customDebugIO(0).cloneType)\n  )\n)\nfor (i &lt;- 0 until customDebug.length) {\n  customDebug(i) := customDebugIO(i)\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u641e\u5b9a\u4e86\u3002</p>","tags":["rocketchip","riscv","debug"]},{"location":"hardware/2022/05/13/rocket-chip-custom-debug/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u627e\u5230\u8fd9\u4e2a\u5b9e\u73b0\u65b9\u6cd5\uff0c\u57fa\u672c\u662f\u5bf9\u7740\u81ea\u5e26\u7684 trace \u63a5\u53e3\u505a\u7684\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u662f\u7406\u89e3 diplomacy \u91cc\u9762\u7684\u4e24\u5c42\uff0c\u7b2c\u4e00\u5c42\u662f\u628a\u4e0d\u540c\u7684\u6a21\u5757\u8fdb\u884c\u4e00\u4e9b\u8fde\u63a5\uff0c\u7136\u540e\u7b2c\u4e8c\u5c42\u5728 ModuleImp \u4e2d\u5904\u7406\u5b9e\u9645\u7684\u4fe1\u53f7\u548c\u903b\u8f91\u3002</p>","tags":["rocketchip","riscv","debug"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/","title":"\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5","text":"","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u4e24\u5e74\u524d\uff0c\u6211\u5c1d\u8bd5\u8fc7\u7528 BSCAN JTAG \u6765\u914d\u7f6e Rocket Chip \u7684\u8c03\u8bd5\uff0c\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u662f\u5f88\u597d\u7528\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c\u6709\u72ec\u7acb\u7684\u4e00\u7ec4 JTAG \u4fe1\u53f7\uff0c\u914d\u7f6e\u8d77\u6765\u4f1a\u66f4\u65b9\u4fbf\uff0c\u800c\u4e14\u4e0d\u7528\u548c Vivado \u53bb\u62a2\uff0cOpenOCD \u53ef\u4ee5\u548c Vivado hw_server \u540c\u65f6\u8fd0\u884c\u548c\u5de5\u4f5c\u3002\u4f46\u662f\uff0c\u82e6\u4e8e VCU128 \u4e0a\u6ca1\u6709 PMOD \u63a5\u53e3\uff0c\u4e4b\u524d\u4e00\u76f4\u6ca1\u8003\u8651\u8fc7\u5728 VCU128 \u4e0a\u914d\u7f6e\u72ec\u7acb\u7684 JTAG\u3002\u7136\u540e\u6700\u8fd1\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u7ec8\u4e8e\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002</p>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u5bfb\u627e-jtag-\u63a5\u53e3","title":"\u5bfb\u627e JTAG \u63a5\u53e3","text":"<p>\u524d\u51e0\u5929\u5728\u7814\u7a76\u522b\u7684\u95ee\u9898\u7684\u65f6\u5019\uff0c\u770b\u5230 VCU128 \u6587\u6863\u4e2d\u7684\u8fd9\u6bb5\u8bdd\uff1a</p> <pre><code>The FT4232HL U8 multi-function USB-UART on the VCU128 board provides three level-shifted\nUART connections through the single micro-AB USB connector J2.\n\u2022 Channel A is configured in JTAG mode to support the JTAG chain\n\u2022 Channel B implements 4-wire UART0 (level-shifted) FPGA U1 bank 67 connections\n\u2022 Channel C implements 4-wire UART1 (level-shifted) FPGA U1 bank 67 connections\n\u2022 Channel D implements 2-wire (level-shifted) SYSCTLR U42 bank 501 connections\n</code></pre> <p>\u5176\u4e2d Channel A \u662f\u5230 FPGA \u672c\u8eab\u7684 JTAG \u63a5\u53e3\uff0c\u662f\u7ed9 Vivado \u7528\u7684\uff0c\u5982\u679c\u662f\u901a\u8fc7 BSCAN \u7684\u65b9\u5f0f\uff0c\u4e5f\u662f\u5728\u8fd9\u4e2a Channel \u4e0a\uff0c\u4f46\u662f\u9700\u8981\u7ecf\u8fc7 FPGA \u81ea\u5df1\u7684 TAP \u518d\u96a7\u9053\u5230 BSCAN \u4e0a\uff0c\u6bd4\u8f83\u9ebb\u70e6\u3002Channel B \u548c C \u662f\u4e32\u53e3\uff0cChannel D \u662f\u8fde\u63a5 VCU128 \u4e0a\u7684 System Controller \u7684\u3002\u4e4b\u524d\u7684\u65f6\u5019\uff0c\u90fd\u662f\u76f4\u63a5\u7528 Channel B \u505a\u4e32\u53e3\uff0c\u7136\u540e\u7a81\u53d1\u5947\u60f3\uff1a\u6ce8\u610f\u5230\u8fd9\u91cc\u662f 4-wire UART\uff0c\u8bf4\u660e\u8fde\u63a5\u5230 FPGA \u662f\u56db\u6761\u7ebf\uff0c\u90a3\u662f\u4e0d\u662f\u4e5f\u53ef\u4ee5\u62ff\u6765\u5f53 JTAG \u7528\uff1f</p> <p>\u67e5\u8be2\u4e86\u4e00\u4e0b FT4232H \u7684\u6587\u6863\uff0c\u53d1\u73b0\u5b83\u7684 Channel A \u548c Channel B \u662f\u652f\u6301 MPSSE \u6a21\u5f0f\u7684\uff0c\u5728 MPSSE \u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u5f53\u6210 JTAG \u4f7f\u7528\uff1a</p> Signal Channel A Channel B TCK 12 22 TDI 13 23 TDO 14 24 TMS 15 25 <p>\u5bf9\u7167 VCU128 \u7684 Schematic \u770b\uff0c\u867d\u7136\u5f15\u811a\u7684\u7f16\u53f7\u4e0d\u5927\u4e00\u6837\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0cChannel A \u548c B \u5206\u522b\u5bf9\u5e94\u4e86 ADBUS0-4 \u548c BDBUS 0-4\uff0c\u5bf9\u5e94\u5230 schematic \u4e0a\u7684\u540d\u5b57\u662f\uff1a</p> <ul> <li>ADBUS0 - FT4232_TCK</li> <li>ADBUS1 - FT4232_TDI</li> <li>ADBUS2 - FMCP_HSPC_TDO</li> <li>ADBUS3 - FT4232_TMS</li> </ul> <p>\u8fd9\u4e00\u7ec4\u662f\u76f4\u63a5\u8fde\u5230 FPGA \u4e0a\u4e13\u7528\u7684 JTAG \u5f15\u811a\uff0c\u5176\u4e2d TDO \u662f\u8fde\u63a5\u4e86\u989d\u5916\u7684\u903b\u8f91\uff0c\u53ef\u4ee5\u628a FMC \u63a5\u53e3\u4e0a\u7684 JTAG \u8fde\u63a5\u6210 daisy chain\u3002</p> <ul> <li>ADBUS0 - FTDI_UART0_TXD_LS - UART0_RXD - BP26 -&gt; TCK</li> <li>ADBUS1 - FTDI_UART0_RXD_LS - UART0_TXD - BN26 -&gt; TDI</li> <li>ADBUS2 - FTDI_UART0_RTS_B_LS - UART0_RTS_B - BP22 -&gt; TDO</li> <li>ADBUS3 - FTDI_UART0_CTS_B_LS - UART0_CTS_B - BP23 -&gt; TMS</li> </ul> <p>\u8fd9\u91cc\u7684 RXD/TXD \u540d\u5b57\u4ea4\u6362\u4e5f\u662f\u5f88\u5bb9\u6613\u770b\u9519\uff0c\u8981\u5c0f\u5fc3\uff0c\u53ea\u8981\u8bb0\u4f4f FT4232H \u8981\u6c42\u7684\u987a\u5e8f\u4e00\u5b9a\u662f TCK-TDI-TDO-TMS \u5373\u53ef\u3002\u5bf9\u5e94\u5230 vivado \u5185\u7684 xdc \u5c31\u662f\u8fd9\u4e48\u5199\uff1a</p> <pre><code>set_property -dict {PACKAGE_PIN BP26 IOSTANDARD LVCMOS18} [get_ports jtag_TCK]\nset_property -dict {PACKAGE_PIN BN26 IOSTANDARD LVCMOS18} [get_ports jtag_TDI]\nset_property -dict {PACKAGE_PIN BP22 IOSTANDARD LVCMOS18} [get_ports jtag_TDO]\nset_property -dict {PACKAGE_PIN BP23 IOSTANDARD LVCMOS18} [get_ports jtag_TMS]\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u628a Rocket Chip \u7684 JTAG \u4fe1\u53f7\u63a5\u51fa\u6765\u3002</p>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u914d\u7f6e-rocket-chip-\u7684-jtag","title":"\u914d\u7f6e Rocket Chip \u7684 JTAG","text":"<p>\u914d\u7f6e Rocket Chip \u7684 JTAG\uff0c\u5927\u6982\u9700\u8981\u5982\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u7ed9 Config \u52a0\u4e0a WithJtagDTM\uff0c\u4ee5 JTAG \u4f5c\u4e3a DTM \u6a21\u5757</li> <li>\u7ed9 Subsystem \u52a0\u4e0a HasPeripheryDebug</li> <li>\u7ed9 SubsystemModuleImp \u52a0\u4e0a HasPeripheryDebugModuleImp</li> <li>\u628a JTAG \u4fe1\u53f7\u8fde\u5230\u81ea\u5df1\u7684\u9876\u5c42\u6a21\u5757\u4e0a</li> </ol> <p>\u6700\u540e\u4e00\u6b65\u7684\u76f8\u5173\u4ee3\u7801\uff0c\u9996\u5148\uff0c\u6309\u7167 spec \u8981\u6c42\uff0c\u628a DM \u8f93\u51fa\u7684 ndreset \u4fe1\u53f7\u8fde\u5230\u6574\u4e2a Rocket \u7684 reset \u4e0a\uff1a</p> <pre><code>// ndreset can reset all harts\nval childReset = reset.asBool | target.debug.map(_.ndreset).getOrElse(false.B)\ntarget.reset := childReset\n</code></pre> <p>\u63a5\u7740\uff0c\u628a JTAG \u7684\u4fe1\u53f7\u8fde\u5230\u9876\u5c42\uff1a</p> <pre><code>val systemJtag = target.debug.get.systemjtag.get\nsystemJtag.jtag.TCK := io.jtag.TCK\nsystemJtag.jtag.TMS := io.jtag.TMS\nsystemJtag.jtag.TDI := io.jtag.TDI\nio.jtag.TDO := systemJtag.jtag.TDO\n</code></pre> <p>\u9664\u4e86 JTAG \u4fe1\u53f7\u4ee5\u5916\uff0c\u8fd8\u9700\u8981\u914d\u7f6e IDCODE \u76f8\u5173\u7684\u53d8\u91cf\uff1a</p> <pre><code>systemJtag.mfr_id := p(JtagDTMKey).idcodeManufId.U(11.W)\nsystemJtag.part_number := p(JtagDTMKey).idcodePartNum.U(16.W)\nsystemJtag.version := p(JtagDTMKey).idcodeVersion.U(4.W)\n</code></pre> <p>\u6700\u540e\u8fd9\u4e00\u90e8\u5206\u6bd4\u8f83\u5173\u952e\uff1a\u9996\u5148\uff0cJTAG \u90e8\u5206\u7684 reset \u662f\u72ec\u7acb\u4e8e\u5176\u4f59\u90e8\u5206\u7684\uff0c\u8fd9\u91cc\u7b80\u5355\u671f\u95f4\u5c31\u8fde\u5230\u4e86\u5916\u90e8\u7684 reset\uff0c\u5176\u5b9e\u53ef\u4ee5\u6539\u6210 FPGA program \u7684\u65f6\u5019\u8fdb\u884c reset\uff0c\u7136\u540e\u7b49\u65f6\u949f\u6765\u4e86\u5c31\u91ca\u653e\uff0c\u5b9e\u73b0\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003\u6587\u672b\u7684\u94fe\u63a5\u3002resetctrl \u662f\u7ed9 DM \u77e5\u9053\u54ea\u4e9b\u6838\u5fc3\u88ab reset \u4e86\uff0c\u6700\u540e\u662f\u8c03\u7528 rocket chip \u81ea\u5e26\u7684\u51fd\u6570\u3002\u8fd9\u91cc\u8e29\u7684\u4e00\u4e2a\u5751\u662f\uff0c\u4f20\u7ed9 systemJtag.reset \u4e00\u5b9a\u5f97\u662f\u5f02\u6b65\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65f6\u949f\u57df\u7684\u65f6\u949f\u90fd\u662f jtag \u7684 TCK \u4fe1\u53f7\uff0c\u6240\u4ee5\u5f88\u53ef\u80fd\u9519\u8fc7\u4e00\u5f00\u59cb\u7684 reset \u4fe1\u53f7\uff0c\u6240\u4ee5\u8fd9\u91cc\u8981\u7528\u5f02\u6b65\u7684 reset\u3002</p> <pre><code>// MUST use async reset here\n// otherwise the internal logic(e.g. TLXbar) might not function\n// if reset deasserted before TCK rises\nsystemJtag.reset := reset.asAsyncReset\ntarget.resetctrl.foreach { rc =&gt;\n  rc.hartIsInReset.foreach { _ := childReset }\n}\nDebug.connectDebugClockAndReset(target.debug, clock)\n</code></pre>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u914d\u7f6e-jtag-\u76f8\u5173\u7684\u7ea6\u675f","title":"\u914d\u7f6e JTAG \u76f8\u5173\u7684\u7ea6\u675f","text":"<p>\u8fd9\u90e8\u5206\u662f\u53c2\u8003\u4e86 pulp \u7684 VCU118 \u4e2d jtag \u4fe1\u53f7\u7684\u7ea6\u675f\u6587\u4ef6\u3002\u7167\u7740\u6284\u5c31\u884c\uff1a</p> <pre><code>create_clock -period 100.000 -name jtag_TCK [get_ports jtag_TCK]\nset_input_jitter jtag_TCK 1.000\nset_property CLOCK_DEDICATED_ROUTE FALSE [get_nets jtag_TCK_IBUF_inst/O]\nset_input_delay -clock jtag_TCK -clock_fall 5.000 [get_ports jtag_TDI]\nset_input_delay -clock jtag_TCK -clock_fall 5.000 [get_ports jtag_TMS]\nset_output_delay -clock jtag_TCK 5.000 [get_ports jtag_TDO]\nset_max_delay -to [get_ports jtag_TDO] 20.000\nset_max_delay -from [get_ports jtag_TMS] 20.000\nset_max_delay -from [get_ports jtag_TDI] 20.000\nset_clock_groups -asynchronous -group [get_clocks jtag_TCK] -group [get_clocks -of_objects [get_pins system_i/clk_wiz_0/inst/mmcme4_adv_inst/CLKOUT1]]\nset_property ASYNC_REG TRUE [get_cells -hier -regexp \"system_i/rocketchip_wrapper_0/.*/cdc_reg_reg.*\"]\n</code></pre> <p>\u548c\u539f\u7248\u672c\u7a0d\u5fae\u6539\u4e86\u4e00\u4e0b\uff0c\u4e00\u4e2a\u533a\u522b\u662f <code>set_clock_groups</code> \u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u4e2a\u65f6\u949f\u53c2\u6570\u7528\u7684\u662f Clocking Wizard \u7684\u8f93\u51fa\uff0c\u540c\u65f6\u4e5f\u662f Rocket Chip \u81ea\u5df1\u7684\u65f6\u949f\u8f93\u5165\uff1b\u53e6\u4e00\u4e2a\u533a\u522b\u662f\u7528\u7684 ASYNC_REG \u67e5\u8be2\u8bed\u53e5\u4e0d\u5927\u4e00\u6837\u3002\u6211\u6ca1\u6709\u5177\u4f53\u5206\u6790\u8fc7\u8fd9\u4e9b\u7ea6\u675f\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5199\uff0c\u4e0d\u786e\u5b9a\u8fd9\u4e9b\u7ea6\u675f\u662f\u5426\u90fd\u5408\u7406\uff0c\u662f\u5426\u90fd\u662f\u9700\u8981\u7684\uff0c\u6ca1\u6709\u6d4b\u8bd5\u8fc7\u4e0d\u5e26\u8fd9\u4e9b\u7ea6\u675f\u4f1a\u4e0d\u4f1a\u51fa\u95ee\u9898\u3002</p>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u8fd0\u884c-openocd-\u548c-gdb","title":"\u8fd0\u884c OpenOCD \u548c GDB","text":"<p>\u6700\u540e\uff0c\u91c7\u7528\u5982\u4e0b\u7684 OpenOCD \u914d\u7f6e\u6765\u8fde\u63a5\uff1a</p> <pre><code># openocd config\n# use ftdi channel 1\n# vcu128 uart0 as jtag\nadapter speed 10000\nadapter driver ftdi\nftdi_vid_pid 0x0403 0x6011 # FT4232H\nftdi_layout_init 0x0008 0x000b # Output: TCK TDI TMS\nftdi_tdo_sample_edge falling\nftdi_channel 1 # channel B\nreset_config none\n\nset _CHIPNAME riscv\njtag newtap $_CHIPNAME cpu -irlen 5\n\nset _TARGETNAME $_CHIPNAME.cpu\n\ntarget create $_TARGETNAME.0 riscv -chain-position $_TARGETNAME\n$_TARGETNAME.0 configure -work-area-phys 0x80000000 -work-area-size 10000 -work-area-backup 1\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u8fde\u63a5\u5230 Rocket Chip \u4e0a\uff1a</p> <pre><code>&gt; openocd -f openocd.cfg\nOpen On-Chip Debugger 0.11.0-rc2\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : auto-selecting first available session transport \"jtag\". To override use 'transport select &lt;transport&gt;'.\nInfo : Listening on port 6666 for tcl connections\nInfo : Listening on port 4444 for telnet connections\nInfo : clock speed 10000 kHz\nInfo : JTAG tap: riscv.cpu tap/device found: 0x10000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x1)\nInfo : datacount=2 progbufsize=16\nInfo : Disabling abstract command reads from CSRs.\nInfo : Examined RISC-V core; found 1 harts\nInfo :  hart 0: XLEN=64, misa=0x800000000094112d\nInfo : starting gdb server for riscv.cpu.0 on 3333\nInfo : Listening on port 3333 for gdb connections\n&gt; riscv64-unknown-elf-gdb\n(gdb) target remote localhost:3333\nRemote debugging using localhost:3333\n0x00000000800001a4 in ?? ()\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8c03\u8bd5\u529f\u80fd\u90fd\u6b63\u5e38\u4e86\u3002</p>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u8c03\u8bd5\u8fd9\u4e2a\u529f\u80fd\u5927\u6982\u82b1\u4e86\u4e00\u5929\u7684\u65f6\u95f4\uff0c\u4e3b\u8981\u9047\u5230\u4e86\u4e0b\u9762\u8fd9\u4e9b\u95ee\u9898\uff1a</p> <ol> <li>\u8c03\u8bd5\u6a21\u5757\u7684 reset \u4fe1\u53f7\u9700\u8981\u662f\u5f02\u6b65\u7684\uff0c\u8fd9\u4e2a\u662f\u901a\u8fc7\u4eff\u771f\uff08Remote Bitbang \u8fde\u63a5 OpenOCD\uff09\u8c03\u8bd5\u51fa\u6765\u7684</li> <li>\u770b schematic \u7684\u65f6\u5019 rxd/txd \u641e\u53cd\u4e86\uff0c\u540e\u6765\u4ed4\u7ec6\u5bf9\u6bd4\u624d\u627e\u5230\u4e86\u6b63\u786e\u7684\u5bf9\u5e94\u5173\u7cfb</li> <li>OpenOCD \u914d\u7f6e\u7684 irlen \u4e00\u5f00\u59cb\u5199\u7684\u4e0d\u5bf9\uff0cdmcontrol \u8bfb\u51fa\u6765\u662f 0\uff0c\u4e00\u76f4\u4ee5\u4e3a\u662f\u6709\u522b\u7684\u95ee\u9898\uff0c\u7ed3\u679c\u6539\u4e86 irlen \u540e\u7acb\u9a6c\u5c31\u6210\u529f\u4e86\uff0c\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u8ba9 OpenOCD \u81ea\u52a8\u63a8\u65ad irlen \u6765\u53d1\u73b0</li> </ol>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2022/03/09/rocket-chip-jtag-debug/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>VCU128 User Guide</li> <li>FT4232H</li> <li>DesignKeyWrapper from \u4e2d\u56fd Chisel \u4e4b\u7236 @sequencer</li> <li>pulp VCU118 constraints</li> </ul>","tags":["fpga","riscv","rocketchip","jtag","openocd","vcu128","ft4232"]},{"location":"hardware/2020/03/17/rocket-chip-tlram-load/","title":"\u5728 Rocket Chip \u4e0a\u6302\u63a5 TLRAM","text":"<p>\u6700\u8fd1\u9047\u5230\u4e00\u4e2a\u9700\u6c42\uff0c\u9700\u8981\u5728 Rocket Chip \u91cc\u9762\u5f00\u8f9f\u4e00\u5757\u7a7a\u95f4\uff0c\u901a\u8fc7 verilog \u7684 $readmemh \u6765\u8fdb\u884c\u521d\u59cb\u5316\u800c\u4e0d\u662f\u7528 BootROM\uff0c\u8fd9\u6837\u6bcf\u6b21\u4fee\u6539\u5185\u5bb9\u4e0d\u9700\u8981\u91cd\u65b0\u8dd1\u4e00\u6b21 Chisel -&gt; Verilog \u7684\u6d41\u7a0b\u3002\u7136\u540e\u5230\u5904\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86\u89e3\u51b3\u7684\u65b9\u6848\uff1a</p> <p>\u9996\u5148\u662f\u65b0\u5efa\u4e00\u4e2a TLRAM \u7136\u540e\u6302\u63a5\u5230 cbus \u4e0a\uff1a</p> <pre><code>import freechips.rocketchip.tilelink.TLRAM\nimport freechips.rocketchip.tilelink.TLFragmenter\nimport freechips.rocketchip.diplomacy.LazyModule\nimport freechips.rocketchip.diplomacy.AddressSet\n\ntrait HasTestRAM { this: BaseSubsystem =&gt;\n  val testRAM = LazyModule(\n    new TLRAM(AddressSet(0x40000000, 0x1FFF), beatBytes = cbus.beatBytes)\n  )\n\n  testRAM.node := cbus.coupleTo(\"bootrom\") { TLFragmenter(cbus) := _ }\n}\n</code></pre> <p>\u8fd9\u91cc\u7684\u5730\u5740\u548c\u5927\u5c0f\u90fd\u53ef\u4ee5\u81ea\u7531\u5b9a\u4e49\u3002\u7136\u540e\u6dfb\u52a0\u5230\u81ea\u5df1\u7684 Top Module \u4e2d\uff1a</p> <pre><code>class TestTop(implicit p:Parameters)\n    extends RocketSystem\n    // ...\n    with HasTestRAM\n    //...\n    {\n    override lazy ...    \n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\u8fd9\u65f6\u5019 TLRAM \u5c31\u5df2\u7ecf\u52a0\u5165\u5230\u4e86 TileLink \u603b\u7ebf\u4e2d\u3002\u63a5\u7740\uff0c\u4e3a\u4e86\u8ba9 firrtl \u751f\u6210 $readmemh \u7684\u4ee3\u7801\uff0c\u9700\u8981\u4e24\u4e2a\u6b65\u9aa4\uff1a</p> <p>\u9996\u5148\u662f\u7528 <code>chisel3.util.experimental.loadMemoryFromFile</code> \u51fd\u6570\uff08\u6587\u6863\u5728 https://github.com/freechipsproject/chisel3/wiki/Chisel-Memories\uff09\uff1a</p> <p>UPDATE\uff1a\u73b0\u5728\u7684\u6587\u6863\u5728 Loading Memories for simulation or FPGA initialization \u5904\uff0c\u5e76\u4e14\u53ef\u4ee5\u7528 loadMemoryFromFileInline\u3002</p> <pre><code>class TestTopImp(outer: TestTop)\n    extends RocketSubsystemModuleImp(outer)\n    // ...\n    {\n    loadMemoryFromFile(outer.testRAM.module.mem, \"test.hex\")    \n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u4f1a\u751f\u6210\u4e00\u4e2a FIRRTL Annotation\uff0c\u8bb0\u5f55\u4e86\u5728\u8fd9\u91cc\u9700\u8981\u5bf9\u8fd9\u4e2a mem \u751f\u6210\u5bf9\u5e94\u7684 readmemh \u8c03\u7528\u3002\u7136\u540e\u5728 firrtl \u7684\u8c03\u7528\u91cc\u4f20\u5165 .anno.json \u548c transform\uff1a</p> <pre><code>$ runMain firrtl.stage.Main -i xxx -o xxx -X verilog -faf /path/to/xxx.anno.json -fct chisel3.util.experimental.LoadMemoryTransform\n</code></pre> <p>UPDATE: \u73b0\u5728\u4e0d\u9700\u8981 <code>-fct chisel3.util.experimental.LoadMemoryTransform</code> \u53c2\u6570\u3002\u76ee\u524d\u8fd9\u4e2a\u529f\u80fd\u548c\u751f\u6210 blackbox memory \u6709\u51b2\u7a81\uff0c\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\uff0c\u9700\u8981\u7b49 chisel3 \u540e\u7eed\u4fee\u590d\u3002</p> <p>\u8fd9\u91cc\u7684 chisel3.util.experimental.LoadMemoryTransform \u4f1a\u627e\u5230 anno.json \u91cc\u9762\u5bf9\u5e94\u7684 Annotation\uff0c\u7136\u540e\u751f\u6210\u7c7b\u4f3c\u4e0b\u9762\u8fd9\u6837\u7684 verilog \u4ee3\u7801\uff1a</p> <pre><code>module xxx(\n    // ...\n);\n  // ...\n    $readmemh(path, mem_xxx);\nendmodule\n\nbind TLRAM xxx xxx(.*);\n</code></pre> <p>\u8fd9\u91cc\u91c7\u7528\u4e86 Verilog \u7684 bind \u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u6a21\u5757\u4ee3\u7801\u7684\u65f6\u5019\u6ce8\u5165\uff0c\u6bd4\u5982\u4e0a\u9762\uff0c\u5c31\u662f\u6ce8\u5165\u4e86\u4e00\u4e2a\u8bed\u53e5 $readmemh\uff0c\u4ece\u800c\u8fbe\u5230\u76ee\u7684\u3002</p>","tags":["chisel","rocketchip","riscv"]},{"location":"hardware/2019/05/15/router-on-fpga-2/","title":"\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff082\uff09","text":"","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/05/15/router-on-fpga-2/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u6708\u521d\u7684\u65f6\u5019\uff0c\u6709\u4e86\u4e00\u4e2a\u5b8c\u6574\u53ef\u7528\u7684\u8def\u7531\u5668\uff08\u4e0a\u4e00\u7bc7\u7cfb\u5217\u535a\u6587\uff09\uff0c\u4f46\u5f53\u65f6\u6d4b\u4e86\u4e00\u4e0b\u901f\u5ea6\uff0c\u53ea\u6709\u51e0\u5341 Mb/s\uff0c\u53ea\u8981\u5f80\u4e0a\u63d0\u5c31\u4f1a\u5931\u6548\uff0c\u5f97 reset \u624d\u80fd\u7ee7\u7eed\u3002\u5f53\u65f6\u4e5f\u5148\u6ca1\u7ba1\u6027\u80fd\u7684\u4e8b\u60c5\uff0c\u5148\u628a\u548c OS \u4ea4\u4e92\u7684\u90e8\u5206\u505a\u4e86\u3002\u73b0\u5728\u53c8\u56de\u5934\u6765\u505a\u6027\u80fd\u8c03\u4f18\u3002</p> <p>\u4e4b\u524d\uff0c\u903b\u8f91\u90e8\u5206\u7684\u4e3b\u9891\u53ea\u6709 10 MHz\uff0c\u8fd9\u81ea\u7136\u4e0d\u884c\uff0c\u4e0d\u63d0\u9ad8\u80af\u5b9a\u505a\u4e0d\u5230\u5343\u5146\u3002\u4e8e\u662f\u8bd5\u7740\u628a\u4e3b\u9891\u62c9\u9ad8\uff0cFIFO \u52a0\u5927\uff0c\u7136\u540e\u9047\u5230\u4e86\u5f88\u591a\u95ee\u9898\uff0c\u6162\u6162\u4fee\u590d\u4e86\uff0c\u5b66\u5230\u4e86\u5f88\u591a\u65b0\u77e5\u8bc6\uff0c\u76ee\u524d\u4e5f\u63a5\u8fd1\u5343\u5146\u7684\u6c34\u5e73\u4e86\u5427\uff0c\u8d34\u56fe\uff1a</p> <p>TCP \u6d4b\u901f\uff1a</p> <p></p> <p>UDP \u6d4b\u901f\uff1a</p> <p></p> <p>\u6d4b\u8bd5\u73af\u5883\u662f macOS \u865a\u62df\u673a\u5916\u6253\u865a\u62df\u673a\u5185\uff0c\u8d70\u7f51\u6865\u628a\u865a\u62df\u673a\u548c\u4e00\u4e2a USB \u7f51\u5361\u63a5\u8d77\u6765\uff0c\u7136\u540e\u4ece\u53e6\u4e00\u4e2a USB \u7f51\u5361\u6253\u5230\u8def\u7531\u5668\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/05/15/router-on-fpga-2/#\u5c1d\u8bd5-700mbs","title":"\u5c1d\u8bd5 700Mb/s","text":"<p>\u63a5\u4e0b\u6765\u8bb2\u8bb2\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u600e\u4e48\u89e3\u51b3\u7684\u3002\u7b2c\u4e00\u4e2a\u662f\u901f\u5ea6\u8fc7\u5feb\u5c31\u4f1a\u6302\uff0c\u8fd9\u80af\u5b9a\u662f\u4e22\u5305\u903b\u8f91\u6ca1\u5199\u5bf9\uff0c\u540e\u6765\u5728\u4eff\u771f\u91cc\u5f00\u591f\u4e86\u65f6\u95f4\uff0c\u4e8e\u662f\u5c31\u627e\u5230\u4e86\u4e00\u4e2a BUG\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u884c\u7684\u4fee\u590d\u3002\u63a5\u7740\u5c31\u662f\u63d0\u9ad8\u4e3b\u9891\uff0c\u4f46\u5927\u5bb6\u4e5f\u77e5\u9053\uff0cCPU \u4e0d\u80fd\u968f\u4fbf\u8d85\u9891\uff0c\u7531\u4e8e\u5404\u79cd\u5ef6\u8fdf\u7684\u539f\u56e0\uff0c\u6bd4\u5982 Setup \u65f6\u95f4\uff0c\u5982\u679c\u8d85\u4e86\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u7684\u65f6\u95f4\uff0c\u672c\u6765\u5e94\u8be5\u4e0b\u4e2a\u5468\u671f\u5c31\u5f97\u5230\u65b0\u6570\u636e\u7684\uff0c\u7ed3\u679c\u5230\u4e86\u4e0b\u4e0b\u5468\u671f\u624d\u6709\uff0c\u90a3\u6709\u7684\u72b6\u6001\u53ef\u80fd\u5c31\u4e71\u4e86\uff0c\u6211\u76ee\u524d\u9047\u5230\u7684\u4e5f\u4e3b\u8981\u5c31\u662f\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4e8e\u662f\u5c31\u5bf9\u7740 Timing \u91cc\u6c47\u62a5\u7684\u5404\u79cd\u95ee\u9898\u4fee\u554a\u4fee\uff0c\u53d1\u73b0\u4e86\u5f88\u591a\u4ee5\u524d\u6ca1\u6709\u6ce8\u610f\u5230\u7684\u95ee\u9898\uff0c\u5b83\u4eec\u4e0d\u5f71\u54cd\u529f\u80fd\uff0c\u4f46\u662f\u4f1a\u8ba9\u903b\u8f91\u53d8\u6162\u3002\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f High Fanout\uff0c\u4ee5\u4e0a\u5c31\u662f\u8bf4\u4e00\u4e2a\u8f93\u51fa\u63a5\u5230\u4e86\u5f88\u591a\u8f93\u5165\uff0c\u8fd9\u770b\u8d77\u6765\u6ca1\u5565\u95ee\u9898\uff0c\u4f46\u6570\u8bbe\u8bfe\u4e0a\u4e5f\u8bb2\u8fc7\uff0c\u6bcf\u4e2a\u95e8\u7684\u8f93\u5165\u8f93\u51fa\u7535\u6d41\u662f\u6709\u9650\u5236\u7684\uff0c\u4f8b\u5982\u6309\u4e66\u4e0a\u7684\u6570\u636e\uff0c\u4e00\u4e2a\u95e8\u8f93\u51fa\u53ea\u80fd\u5e26\u5341\u4e2a\u95e8\uff0c\u66f4\u591a\u53ea\u80fd\u7ea7\u8054\u4e00\u5c42\u3002\u7ea7\u8054\u7684\u8bdd\uff0c\u5ef6\u8fdf\u81ea\u7136\u5c31\u9ad8\u4e86\u3002\u540e\u6765\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684\u539f\u56e0\u662f\uff0c\u5f00\u4e86\u4e00\u4e2a\u5927\u7684\u6570\u7ec4\uff0c\u4f46\u662f\u6ca1\u6709\u53d8\u6210 RAM\uff0c\u7efc\u5408\u51fa\u4e86\u51e0\u5343\u4e2a\u903b\u8f91\u5355\u5143\uff0c\u81ea\u7136\u662f\u51fa\u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u7528 xpm_memory_tpdram \u5373\u53ef\u3002\u8fd9\u6837\u4e00\u641e\uff0c\u4e3b\u9891\u5c31\u80fd\u4e0a 200MHz \u4e86\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u6d4b\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0 UDP \u80fd\u6253\u5230 700Mb/s \u4e86\uff0cTCP \u7531\u4e8e\u4e22\u5305\u7387\u6bd4\u8f83\u9ad8\uff0c\u53ea\u6709 400Mb/s\uff0c\u8ddd\u79bb\u9884\u671f\u8fd8\u6709\u4e00\u6bb5\u8ddd\u79bb\u3002\u4e8e\u662f\u7ee7\u7eed\u8fdb\u884c\u4f18\u5316\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/05/15/router-on-fpga-2/#\u5411-900mbs-\u8fdb\u53d1","title":"\u5411 900Mb/s \u8fdb\u53d1","text":"<p>\u8981\u7ee7\u7eed\u63d0\u901f\uff0c\u81ea\u7136\u8981\u63d0\u9ad8\u4e3b\u9891\u3002\u4e0b\u4e00\u4e2a\u4e3b\u9891\u76ee\u6807\u5c31\u662f 250MHz\u3002\u968f\u7740\u63d0\u9ad8\u4e3b\u9891\uff0c\u65f6\u5e8f\u7684\u8981\u6c42\u4e5f\u4f1a\u66f4\u9ad8\uff0c\u81ea\u7136\u4e5f\u51fa\u73b0\u4e86\u65b0\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u6b21\u7684\u95ee\u9898\u4e3b\u8981\u5728\u4e8e\uff0c\u4e00\u4e2a\u8def\u5f84\u4e0a\u903b\u8f91\u95e8\u6570\u8fc7\u591a\uff0c\u591a\u7684\u6709 7 \u5230 10 \u4e2a\uff0c\u6bcf\u4e00\u6b65\u96f6\u70b9\u51e0\u5230\u4e00\u70b9\u51e0\u7eb3\u79d2\uff0c\u53e0\u8d77\u6765 4 \u7eb3\u79d2\u54ea\u91cc\u591f\u7528\u3002\u4e8e\u662f\u628a\u4e00\u4e9b\u4e0d\u9700\u8981\u4f9d\u8d56\u6761\u4ef6\u7684\u903b\u8f91\u632a\u5230\u6761\u4ef6\u5916\u9762\uff0c\u8fd9\u6837\u5c31\u51cf\u5c11\u4e86\u4e00\u4e9b\u8def\u5f84\u7684\u4f9d\u8d56\u3002</p> <p>\u89e3\u51b3\u4e86\u8fd9\u4e2a\u4ee5\u540e\uff0c\u73b0\u5728\u7684 WNS\uff08Worst Negative Slack\uff09\u53ea\u5269\u4e0b 0.6 ns \u4e86\u3002\u8fd9\u65f6\u5019\u7684\u95ee\u9898\u4e00\u90e8\u5206\u8fd8\u662f\u6765\u81ea\u4e8e\u903b\u8f91\u95e8\u8fc7\u591a\uff0c\u4f46\u8fd9\u4e2a\u65f6\u5019\u5c31\u6ca1\u8fd9\u4e48\u7b80\u5355\u4e86\uff0c\u53ea\u80fd\u7ee7\u7eed\u7ec6\u5316\u6d41\u6c34\u7ebf\uff0c\u6253\u4e00\u62cd\uff0c\u8fd9\u6837\u624d\u80fd\u628a\u5ef6\u8fdf\u964d\u4e0b\u6765\u3002</p> <p>\u867d\u7136 Timing \u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\uff0c\u4f46\u8fd8\u662f\u5199\u8fdb\u4e86 FPGA \u4e2d\u3002\u5e78\u597d\u5de5\u4f5c\u4e00\u5207\u6b63\u5e38\uff0c\u5c31\u5f97\u5230\u4e86\u4e0a\u9762\u90a3\u4e2a\u56fe\u7247\u7684\u7ed3\u679c\uff0c\u63a5\u8fd1\u5343\u5146\u7684\u901f\u5ea6\u4e86\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/05/15/router-on-fpga-2/#\u540e\u7eed\u4f18\u5316\u9014\u5f84","title":"\u540e\u7eed\u4f18\u5316\u9014\u5f84","text":"<p>\u540e\u7eed\u4f18\u5316\u9014\u5f84\u7684\u8bdd\uff0c\u4e00\u65b9\u9762\u662f\u7ee7\u7eed\u5bf9\u903b\u8f91\u8fdb\u884c\u7ec6\u5316\u548c\u62c6\u5206\uff0c\u53e6\u4e00\u65b9\u9762\u662f\u5bf9\u67b6\u6784\u8fdb\u884c\u4f18\u5316\u3002\u5f53\u521d\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6ca1\u6709\u8003\u8651\u5730\u90a3\u4e48\u5468\u5168\uff0c\u4f8b\u5982\u73b0\u5728\u53d1\u73b0\uff0c\u5176\u5b9e ARP Cache \u53ef\u4ee5\u653e\u5230\u6bcf\u4e2a\u7f51\u53e3\u4e00\u4efd\uff0c\u8fd9\u6837\u4f1a\u964d\u4f4e\u82b1\u5728\u4ef2\u88c1\u4e0a\u7684\u65f6\u95f4\u3002\u53e6\u5916\uff0c\u8def\u7531\u8868\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5206\u591a\u4efd\u5b58\uff0c\u53ea\u8981\u6539\u7684\u65f6\u5019\u540c\u4e00\u6539\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6837\u5e94\u8be5\u4f1a\u66f4\u5feb\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/06/02/router-on-fpga-3/","title":"\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff083\uff09","text":"","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/06/02/router-on-fpga-3/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u53c8\u534a\u4e2a\u6708\u8fc7\u53bb\u4e86\uff0c\u5728\u5199\u4e86\u4e0a\u7bc7\u7cfb\u5217\u535a\u6587\u4e4b\u540e\u4e5f\u662f\u505a\u4e86\u5f88\u591a\u65b0\u7684\u66f4\u6539\u3002\u4e0a\u6b21\u505a\u7684\u4e3b\u8981\u662f\u5173\u4e8e\u6027\u80fd\u65b9\u9762\u7684\u63d0\u5347\uff0c\u600e\u4e48\u63d0\u9ad8\u9891\u7387\uff0c\u4ece\u800c\u8fbe\u5230\u6bd4\u8f83\u5927\u7684\u6d41\u91cf\uff0c\u800c\u8fd9\u6bb5\u65f6\u95f4\u505a\u7684\u5219\u662f\u529f\u80fd\uff0c\u505a\u5b9e\u73b0 RIP \u534f\u8bae\u548c\u8f6c\u53d1\u8868\u7684\u52a8\u6001\u66f4\u65b0\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/06/02/router-on-fpga-3/#\u8f6f\u4ef6\u90e8\u5206","title":"\u8f6f\u4ef6\u90e8\u5206","text":"<p>\u8f6f\u4ef6\u90e8\u5206\u76ee\u524d\u662f\u7528 C \u4ee3\u7801\u5199\u7684\uff0c\u7528 Xilinx SDK \u63d0\u4f9b\u7684\u5404\u4e2a AXI \u5916\u8bbe\u7684\u9a71\u52a8\u548c PS \u81ea\u5df1\u7684\u9a71\u52a8\uff0c\u5b9e\u73b0\u4e86\u6240\u9700\u8981\u7684\uff0cRIP \u534f\u8bae\u7684\u5904\u7406\uff0c\u8f6c\u53d1\u8868\u7684\u66f4\u65b0\u548c\u7edf\u8ba1\u4fe1\u606f\u7684\u8bfb\u53d6\u3002</p> <p>\u5b9e\u9645\u4e0a\u505a\u7684\u65f6\u5019\u6bd4\u8f83\u7c97\u66b4\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u4e09\u79cd AXI \u5916\u8bbe\u4e0e\u786c\u4ef6\u90e8\u5206\u8fdb\u884c\u4ea4\u4e92\uff1aAXI Stream FIFO\uff0cAXI GPIO \u548c AXI BRAM Controller\u3002\u5176\u4e2d AXI Stream FIFO \u662f\u7528\u6765\u63a5\u6536\u548c\u53d1\u9001\u9700\u8981 CPU \u5904\u7406\u7684\u4ee5\u592a\u7f51\u5e27\u7684\uff0cAXI GPIO \u5219\u662f\u7528\u6765\u8bfb\u53d6\u7edf\u8ba1\u7684\u4fe1\u606f\uff0cAXI BRAM Controller \u662f\u7528\u6765\u8bfb\u5199\u8f6c\u53d1\u8868\u7684\u3002\u6700\u540e\u5728\u9876\u5c42\u8bbe\u8ba1\u4e2d\u628a\u8fd9\u4e9b\u5916\u8bbe\u8fde\u63a5\u8d77\u6765\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/06/02/router-on-fpga-3/#\u786c\u4ef6\u90e8\u5206","title":"\u786c\u4ef6\u90e8\u5206","text":"<p>\u786c\u4ef6\u90e8\u5206\u8fd8\u662f\u7ee7\u7eed\u4e4b\u524d\u7684\u90e8\u5206\u5f80\u4e0b\u5199\uff0c\u6dfb\u52a0\u4e86\u7edf\u8ba1\u4fe1\u606f\uff0c\u76f4\u63a5\u66b4\u9732\u51fa\u53bb\uff0c\u8ba9 CPU \u8d70 AXI GPIO \u8bfb\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u5f88\u9ad8\u7684\u7cbe\u786e\u5ea6\uff1b\u8f6c\u53d1\u8868\u672c\u8eab\uff0c\u4e00\u5f00\u59cb\u60f3\u7684\u662f\u81ea\u5df1\u5199\u4e00\u4e9b\u63a5\u53e3\u8f6c\u6362\uff0c\u540e\u6765\u53d1\u73b0\uff0c\u76f4\u63a5\u7528 True Dual Port RAM \u7136\u540e\u628a\u4e00\u4e2a port \u66b4\u9732\u7ed9 AXI BRAM Controller \u5373\u53ef\uff0c\u514d\u53bb\u4e86\u5404\u79cd\u9ebb\u70e6\uff0cPS \u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u4fee\u6539\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/06/02/router-on-fpga-3/#\u6700\u7ec8\u6548\u679c","title":"\u6700\u7ec8\u6548\u679c","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u5957\u4e1c\u897f\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u5c31\u5f00\u4e86\u4e24\u4e2a Arch Linux \u7684\u865a\u62df\u673a\uff0c\u5206\u522b Bridge \u5230\u4e24\u4e2a\u5343\u5146\u7684 USB \u7f51\u5361\u4e0a\uff0c\u90fd\u8fde\u5230 FPGA \u4e0a\u3002\u7136\u540e\u5728\u4e24\u8fb9\u90fd\u914d\u4e0a\u4e86 BIRD\uff0c\u914d\u7f6e RIP \u548c\u4e00\u4e9b\u8def\u7531\uff0c\u786e\u5b9e\u80fd\u66f4\u65b0\u786c\u4ef6\u7684\u8f6c\u53d1\u8868\uff0c\u5e76\u4e24\u8fb9\u7684 RIP \u53ef\u4ee5\u5b66\u4e60\u5230\u5bf9\u65b9\u7684\u8def\u7531\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2019/04/24/router-on-fpga/","title":"\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668","text":"<p>\u6700\u8fd1\u5728\u505a FPGA \u4e0a\u786c\u4ef6\u7684\u8def\u7531\u5668\uff0c\u611f\u89c9\u63a5\u8fd1\u4e00\u4e2a\u57fa\u672c\u53ef\u7528\u7684\u9636\u6bb5\u4e86\u5427\uff0c\u5927\u6982\u8c08\u4e00\u8c08\u505a\u8fd9\u4e2a\u7684\u601d\u8def\u3001\u8fc7\u7a0b\u548c\u8e29\u8fc7\u7684\u5751\u3002</p> <p>\u9996\u5148\uff0c\u505a\u5b9e\u9a8c\u7528\u7684\u677f\u5b50\u662f Alinx AX7021\uff0cFPGA \u662f Xilinx xc7z020clg484-2\uff0c\u6269\u5c55\u677f\u4e0a\u6709 4PL+1PS \u4e2a\u7f51\u53e3\u548c\u5343\u5146 KSZ9031RNX PHY\uff0c\u91c7\u7528\u7684\u63a5\u53e3\u662f RGMII\u3002\u4e00\u5f00\u59cb\u505a\u7684\u81ea\u7136\u662f\u505a RGMII\uff0c\u4f46\u662f\u9047\u5230\u4e86\u56f0\u96be\uff0cRGMII \u5728\u5343\u5146\u6a21\u5f0f\u4e0b\u4f20\u8f93\u7684\u662f DDR \u4fe1\u53f7\uff0c\u800c\u65f6\u5e8f\u548c\u5ef6\u8fdf\u5c31\u662f\u4e2a\u6bd4\u8f83\u9ebb\u70e6\u7684\u4e8b\u60c5\u3002\u4e00\u5f00\u59cb\u5148\u76f4\u63a5\u62ff Xilinx \u7684 AXI Ethernet IP \u6765\u7528\uff0c\u7136\u540e\u4e0a ILA \u770b\u5230\u4e86 IDDR \u540e\u7684\u4fe1\u53f7\uff0c\u7b2c\u4e00\u6b21\u770b\u5230\u4e86\u5b8c\u6574\u7684\u4ee5\u592a\u7f51\u5e27\uff0c\u4ece Preamble \u548c SFD \u5230\u6700\u540e\u7684 FCS\u3002\u4e8e\u662f\u5c31\u7279\u522b\u632f\u594b\uff0c\u60f3\u7740\u624b\u5199 RGMII\uff0c\u5148\u505a\u6536\uff0c\u518d\u505a\u53d1\u3002\u786e\u5b9e\uff0c\u6536\u5f88\u5bb9\u6613\uff0c\u5f88\u5feb\u5c31\u505a\u51fa\u6765\u4e86\uff0c\u4f46\u662f\u5199\u603b\u662f\u51fa\u95ee\u9898\uff0c\u5f53\u65f6\u4e5f\u4e0d\u61c2\u8de8\u65f6\u949f\u57df\u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u603b\u4e4b\u5404\u79cd\u6ca1\u8c03\u51fa\u6765\u3002\u4e8e\u662f\u5c31\u9000\u800c\u6c42\u5176\u6b21\uff0c\u9009\u62e9\u4e86 Xilinx \u7684 Tri Mode Ethernet IP \u4e86\u3002</p> <p>Tri Mode Ethernet IP \u6709\u5f88\u591a\u9009\u9879\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u76f4\u63a5\u91c7\u7528\u4e86 AXI-Stream \u7684\u63a5\u53e3\uff0c\u4e0d\u8981 AXI4-Lite \u4ec0\u4e48\u7684\uff0c\u90fd\u4e0d\u8981\uff0c\u56e0\u4e3a\u6211\u9700\u8981\u76f4\u63a5\u5199\u5269\u4f59\u7684\u903b\u8f91\u3002\u5176\u4ed6\u4e1c\u897f\u80fd\u7701\u4e5f\u90fd\u7701\u6389\u4e86\u3002\u8fd9\u4e2a IP \u786e\u5b9e\u5f88\u7ed9\u529b\uff0c\u5f88\u5feb\u5c31\u53ef\u4ee5\u5b8c\u6210\u6536\u548c\u53d1\u7684\u64cd\u4f5c\u4e86\uff0c\u8fd9\u6b21\u7ec8\u4e8e\u77e5\u9053\u4e86\u600e\u4e48\u5904\u7406\u8de8\u65f6\u949f\u57df\u7684\u95ee\u9898 \u2014 XPM FIFO ASYNC\uff0c\u4e00\u4e0b\u63a8\u8fdb\u4e86\u5f88\u5927\u7684\u8fdb\u5ea6\u3002</p> <p>\u65e2\u7136\u53ef\u4ee5\u6536\uff0c\u4e5f\u53ef\u4ee5\u53d1\u4e86\uff0c\u5c31\u6269\u5c55\u5230\u591a\u4e2a\u7f51\u53e3\u3002\u8fd9\u4e2a IP \u4e2d\u53ef\u4ee5\u9009\u62e9 Shared Logic \u5728\u5185\u90e8\uff0c\u4e5f\u53ef\u4ee5\u5728\u5916\u90e8\uff0c\u7814\u7a76\u4e86\u4e00\u4e0b\u53d1\u73b0\uff0c\u5e94\u8be5\u662f\u4e00\u4e2a\u653e\u5185\u90e8\uff0c\u5176\u4f59\u9009\u5916\u90e8\uff0c\u7136\u540e\u63a5\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86\u3002\u4e0d\u8fc7\u76ee\u524d\u4e3a\u4e86\u7b80\u5355\uff0c\u8fd8\u662f\u53ea\u7528\u4e86\u4fe9\u7aef\u53e3\u3002\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\uff0c\u5c31\u5f00\u59cb\u89e3\u6790\u6536\u8fdb\u6765\u7684\u4ee5\u592a\u7f51\u5e27\u4e86\u3002</p> <p>\u7b2c\u4e00\u6b65\u81ea\u7136\u662f\u586b ARP \u8868\uff0c\u81ea\u7136\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u591a\u4e2a\u7f51\u53e3\u540c\u65f6\u8fdb\u6765\u6570\u636e\uff0c\u600e\u4e48\u4fdd\u8bc1 ARP \u8868\u8bfb\u5199\u7684\u6b63\u786e\u6027\uff1f\u81ea\u7136\u5c31\u60f3\u5230\u603b\u7ebf\u4e0a\u9700\u8981\u505a\u4ef2\u88c1\uff0c\u4e8e\u662f\u5199\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u603b\u7ebf\u4ef2\u88c1\uff0c\u987a\u5e26\u5b66\u4e60\u5230\u4e86 <code>unique case(z)</code> \u548c <code>priority case(z)</code> \u7684\u8bed\u6cd5\u3002\u7136\u540e ARP \u8868\u600e\u4e48\u5b9e\u73b0\u5462\uff0c\u5927\u6982\u5c31\u662f\u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c\u7136\u540e\u8868\u91cc\u7ef4\u62a4\u4e86\uff08IP\uff0cMAC\uff0cPORT\uff09\u4e09\u5143\u7ec4\uff0c\u7136\u540e\u5b9e\u73b0\u4e86\u4e00\u4e9b\u51b2\u7a81\u548c\u8986\u76d6\u7684\u5904\u7406\u903b\u8f91\uff0c\u505a\u8fd9\u4e9b\u7684\u540c\u65f6\u4e5f\u5bf9\u5404\u4e2a\u6a21\u5757\u7f16\u5199\u76f8\u5e94\u7684\u6d4b\u8bd5\u3002\u6709\u4e86 ARP \u8868\uff0c\u5c31\u53ef\u4ee5\u5728\u89e3\u6790\u4ee5\u592a\u7f51\u5e27\u7684\u65f6\u5019\uff0c\u62c6\u89e3\u51fa\u91cc\u9762\u7684\u4fe1\u606f\uff0c\u7136\u540e\u8bf7\u6c42 ARP \u8868\u603b\u7ebf\uff0c\u7136\u540e\u5199\u5165\u3002</p> <p>\u7b2c\u4e8c\u6b65\u5219\u662f\u76f8\u5e94 ARP \u8bf7\u6c42\uff0c\u8fd9\u5c31\u9700\u8981\u53d1\u51fa\u4ee5\u592a\u7f51\u5e27\u3002\u7531\u4e8e 4 \u4e2a\u7aef\u53e3\u90fd\u53ef\u80fd\u5411 4 \u4e2a\u7aef\u53e3\u53d1\u51fa\u4ee5\u592a\u7f51\u5e27\uff0c\u8fd9\u5c31\u9700\u8981\u4e00\u4e2a 4x4 matrix + \u4ef2\u88c1\u3002\u4e0d\u8fc7\u76ee\u524d\u4e3a\u4e86\u7b80\u5355\uff0c\u5c31\u8fd8\u6ca1\u6709\u4e0a FIFO\uff0c\u76f4\u63a5\u4ef2\u88c1\u8fdb\u5230\u76ee\u7684\u7aef\u53e3\u7684 TX FIFO \u4e2d\u4e86\u3002\u8fd9\u4e00\u6b65\u5e76\u4e0d\u96be\uff0c\u4e0d\u8fc7\u5728\u6700\u540e AXI-Stream \u7684\u4e00\u6b65\u9047\u5230\u4e86\u4e00\u4e9b\u56f0\u96be\u3002\u7531\u4e8e Tri Mode Ethernet IP \u5bf9 tready \u548c tvalid \u6709\u7279\u5b9a\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u80fd\u7528 FWFT FIFO \u8fdb\u884c\uff0c\u7136\u540e\u8fdb\u884c\u4e86\u4e00\u6ce2\u795e\u5947\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u641e\u5b9a\u4e86\u8fd9\u4e2a\u4e8b\u60c5\u3002\u6210\u679c\u5c31\u662f\u53ef\u4ee5\u4ece\u7535\u8111\u4e0a <code>arping</code> \u901a\u6307\u5b9a\u7684\u5730\u5740\u4e86\u3002</p> <p>\u7b2c\u4e09\u6b65\uff0c\u4e5f\u662f\u6b63\u5728\u505a\u7684\u4e00\u6b65\uff0c\u5c31\u662f\u771f\u6b63\u5b9e\u73b0 IP \u5305\u7684\u8f6c\u53d1\uff0c\u8fd9\u9700\u8981\u4e09\u4e2a\u6b65\u9aa4\uff1a\u89e3\u6790\u76ee\u7684\u5730\u5740\uff0c\u67e5\u8be2\u8def\u7531\u8868\uff0c\u67e5\u8be2 ARP \u8868\u3002\u4e8e\u662f\u9700\u8981\u7167\u7740 ARP \u8868\u7684\u65b9\u6848\u540c\u6837\u505a\u4e86\u8def\u7531\u8868\u7684\u4ef2\u88c1\uff0c\u76ee\u524d\u4e3a\u4e86\u7b80\u5355\u4e5f\u8fd8\u662f\u628a\u8def\u7531\u8868\u8bbe\u7f6e\u4e3a\u9759\u6001\u7684\u3002\u8fd9\u91cc\u5c31\u9700\u8981\u505a\u4e00\u4e9b\u7279\u6b8a\u7684\u8003\u8651\uff0c\u4f8b\u5982\u4e0a\u9762\u4e09\u6b65\u662f\u4e32\u884c\u7684\uff0c\u4f46\u662f\u6211\u9700\u8981\u540c\u65f6\u628a IP \u5305\u5b58\u4e00\u4efd\uff0c\u6700\u540e\u8f6c\u53d1\u7684\u65f6\u5019\u4fee\u6539\u4e00\u70b9\u5c31\u53d1\u51fa\u53bb\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u7b49\u4e24\u6b65\u90fd\u505a\u5b8c\uff0c\u624d\u80fd\u7ee7\u7eed\u4e0b\u4e00\u4e2a\u5305\u7684\u5904\u7406\u3002\u76ee\u524d\u505a\u5230\u4e86\u7b2c\u4e8c\u5c0f\u6b65\uff0c\u6b63\u5728\u5411\u6700\u540e\u4e00\u6b65\u67e5\u8be2 ARP \u8868\u8fdb\u53d1\u3002</p> <p>UPDATE\uff1a\u73b0\u5728\u6700\u540e\u4e00\u6b65\u4e5f\u505a\u597d\u4e86\uff0c\u4f46\u662f\u9047\u5230\u4e86\u5c0f\u95ee\u9898\uff0c\u8fd8\u662f\u4e0d\u80fd\u5077\u61d2\uff0c\u9700\u8981\u5199\u4e00\u4e2a XPM_MEMORY_SPRAM\uff0c\u76f4\u63a5\u5199\u4e00\u4e2a\u5927\u7684\u6570\u7ec4\u592a\u6d6a\u8d39 LUT \u4e86\u3002</p> <p>UPDATE-2019-04-27\uff1aIt WORKS now. \u4e0d\u8fc7\u4e5f\u53d1\u73b0\u4e86\u4e4b\u524d\u5199\u7684 ARP \u8868\u6709\u70b9\u95ee\u9898\u3002</p>","tags":["router","fpga","router-on-fpga"]},{"location":"hardware/2018/11/05/salted-fish-pi/","title":"\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e","text":"<p>\u6700\u8fd1\u521a\u62ff\u5230\u4e86\u4e00\u4e2a\u54b8\u9c7c\u6d3e\u7684\u6d4b\u8bd5\u677f\u5b50\uff0c\u51c6\u5907\u81ea\u5df1\u628a U-Boot \u548c Linux \u5185\u6838\u8fd9\u4e00\u5957\u4e1c\u897f\u8dd1\u901a\uff0c\u90fd\u7528\u4e3b\u7ebf\u7684\u4e1c\u897f\uff0c\u5c3d\u91cf\u51cf\u5c11\u9b54\u6539\u7684\u90e8\u5206\u3002\u9996\u5148\u662f\u7f16\u8bd1 u-boot\uff0c\u6211\u7528\u7684\u662f\u73b0\u5728\u7684 master \u5206\u652f\u7684\u6700\u65b0\u7248 99431c1c\uff1a</p> <pre><code>$ # Archlinux\n$ sudo pacman -Sy arm-none-eabi-gcc\n$ make LicheePi_Zero_defconfig\n$ make ARCH=arm CROSS_COMPILE=arm-none-eabi- -j24\n</code></pre> <p>\u8fd9\u65f6\u5019\u4f1a\u5f97\u5230\u4e00\u4e2a u-boot-sunxi-with-spl.bin \u7684\u6587\u4ef6\u3002\u6211\u4eec\u53ea\u8981\u628a\u5b83\u5199\u5230 SD \u5361\u7684 8192 \u504f\u79fb\u5904\uff0c\u5c31\u53ef\u4ee5\u628a U-Boot \u8dd1\u8d77\u6765\u4e86\uff1a</p> <pre><code>$ diskutil unmountDisk /dev/disk4\n$ sudo dd if=u-boot-sunxi-with-spl.bin of=/dev/disk4 bs=1024 seek=8\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u505a\u4e00\u4e0b\u5206\u533a\u3002\u6211\u91c7\u7528\u7684\u662f MBR \u5206\u533a\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e0d\u4f1a\u548c U-Boot \u51b2\u7a81\u3002\u4f7f\u7528 fdisk \u8fdb\u884c\u5206\u533a\uff0c\u6211\u4ece 1M \u5904\u5f00\u59cb\u5206\u4e86\u4e00\u4e2a 10M \u7684 FAT-32 \u5206\u533a\u4f5c\u4e3a\u542f\u52a8\u5206\u533a\uff0c\u7136\u540e\u4e4b\u540e\u90fd\u662f EXT4 \u7684\u7cfb\u7edf\u76d8\u5206\u533a\u3002\u63a5\u7740\u5c31\u662f\u7f16\u8bd1\u5185\u6838\u3002</p> <p>\u6211\u7528\u7684\u662f\u516b\u6708\u4efd\u65f6\u5019\u7684 4.18.2 \u5185\u6838\uff0c\u867d\u7136\u4e0d\u662f\u5f88\u65b0\u4f46\u4e5f\u8db3\u591f\u65b0\u4e86\u3002\u4e00\u756a\u8c03\u6574\u5185\u6838\u53c2\u6570\u540e\uff0c\u5f97\u5230\u4e86\u4e00\u4e2a\u53ef\u7528\u7684\u5185\u6838\uff0c\u7136\u540e\u628a zImage \u548c sun8i-v3s-licheepi-zero.dtb \u90fd\u590d\u5236\u5230\u521a\u624d\u521b\u5efa\u7684 FAT-32 \u542f\u52a8\u5206\u533a\uff0c\u7136\u540e\u8fdb\u5165 U-Boot \u8fdb\u884c\u542f\u52a8\uff1a</p> <pre><code>$ setenv bootcmd 'fatload mmc 0 0x41000000 zImage; fatload mmc 0 0x41800000 sun8i-v3s-licheepi-zero.dtb; setenv bootargs console=ttyS0,115200 root=/dev/mmcblk0p2 rw rootwait; bootz 0x41000000 - 0x41800000'\n$ saveenv # optional\n$ boot\n</code></pre> <p>\u8fd9\u91cc\u4e00\u5f00\u59cb\u9047\u5230\u4e86\u5f88\u591a\u5751\uff0c\u6bd4\u5982\u4e00\u76f4\u770b\u4e0d\u5230 console\uff0c\u8fd9\u4e2a\u662f\u627e\u4e86 @gaoyichuan \u62ff\u5230\u7684\u4e00\u4efd Kernel Config \u8fdb\u884c\u4fee\u6539\u4fee\u597d\u7684\u3002\u53e6\u4e00\u4e2a\u662f\u8fdb\u53bb\u4ee5\u540e\u627e\u4e0d\u5230 root\uff0c\u6211\u5148\u662f\u641e\u4e86\u4e00\u4e2a\u6709 busybox \u7684 initrd\uff0c\u8fdb\u53bb\u770b\u53d1\u73b0\u662f\u80fd\u627e\u5230 mmc \u7684\uff0c\u4f46\u662f\u6709\u5ef6\u8fdf\uff0c\u90a3\u4e48\u6dfb\u52a0\u4e0a rootwait \u5c31\u597d\u4e86\u3002\u8fdb\u53bb\u4ee5\u540e\u5c31\u5dee rootfs\u3002\u7531\u4e8e\u6211\u7f3a\u5c11\u4e00\u4e2a\u5199 ext4 \u7684\u5de5\u5177\uff0c\u53c8\u53d1\u73b0\u624b\u4e0a\u6709\u4e00\u4e2a Raspbian \u7684\u955c\u50cf\uff0c\u5b83\u91cc\u9762\u4e5f\u6b63\u597d\u662f\u4e24\u4e2a\u5206\u533a\uff0c\u800c\u4e14\u67b6\u6784\u4e5f\u540c\u6837\u662f armv7l\uff0c\u6211\u5c31\u76f4\u63a5\u628a\u5b83\u70e7\u5230 SD \u5361\u4e2d\uff0c\u628a U-Boot \u5199\u8fdb\u53bb\uff0c\u7136\u540e\u5f80 boot \u5206\u533a\u91cc\u5199\u5185\u6838\u548c dtb\uff0c\u7136\u540e\u5c31\u6210\u529f\u8fdb\u53bb\uff0c\u5e76\u4e14\u8dd1\u8d77\u6765\u4e86\u3002\u6700\u559c\u611f\u7684\u5c31\u662f\uff0c\u8fdb\u53bb\u4ee5\u540e\u662f\u4e2a pi@raspberrypi\uff0c\u5b9e\u9645\u4e0a\u786e\u662f\u53e6\u4e00\u4e2a\u4e1c\u897f\u3002\u4e0d\u8fc7\uff0c\u53ea\u6709\u5f53\u6211 <code>apt update</code> \u53d1\u73b0\u7528\u4e86\u534a\u5c0f\u65f6\u7684\u65f6\u5019\uff0c\u6211\u624d\u60f3\u8d77\u6765\u8fd9\u5176\u5b9e\u662f\u662f\u4e00\u4e2a\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3002\u3002</p> <p>\u8fdb\u53bb\u4ee5\u540e\u53d1\u73b0\uff0c\u6ca1\u6709\u8bc6\u522b\u5230\u7f51\u5361\u9a71\u52a8\u3002\u7f51\u4e0a\u627e\u4e86 LicheePi Zero \u7684\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u7528\uff0c\u8fd8\u51fa\u73b0\u4e86\u795e\u5947\u7684 Kernel Oops\uff0c\u6000\u7591\u662f\u5185\u6838\u7248\u672c\u592a\u65b0\u7684\u95ee\u9898\u3002\u6211\u53c8\u627e\u5230 @icenowy \u7684\u4e00\u4e2a Patch \uff0c\u5b83\u7ec8\u4e8e\u662f\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u6210\u529f\u5730\u627e\u5230\u4e86\u7f51\u5361\uff0c\u5e76\u4e14\u6109\u5feb\u5730 <code>ssh pi@raspberrypi.local</code> \u3002\u4e4b\u540e\u4f1a\u5728\u54b8\u9c7c\u6d3e\u90a3\u8fb9\u516c\u5e03\u4e00\u4e0b\u6211\u4eec\u505a\u7684\u4fee\u6539\u3002</p> <p>\u73b0\u5728\u7684\u60f3\u6cd5\u662f\uff0c\u628a HomeBridge \u642d\u5efa\u5230\u5b83\u4e0a\u9762\uff0c\u4e0d\u8fc7\u76ee\u524d\u6765\u770b\u786c\u4ef6\u8d44\u6e90\u6709\u70b9\u7d27\u5f20\uff0c\u653e\u7740\u4f1a\u6709\u70b9\u6162\u3002\u53ef\u80fd\u8fd8\u662f\u7528\u6811\u8393\u6d3e\u505a\u8fd9\u4e2a\u4e8b\u60c5\u6bd4\u8f83\u5408\u9002\u3002</p>","tags":["sfpi","saltedfishpi","uboot","linux","kernel","dts","devicetree"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/","title":"\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0","text":"","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>ISCA 2020 \u7684\u4e00\u7bc7\u6587\u7ae0 Evolution of the Samsung Exynos CPU Microarchitecture \u975e\u5e38\u8be6\u7ec6\u5730\u89e3\u6790\u4e86\u4e09\u661f Exynos \u81ea\u7814 CPU \u5fae\u67b6\u6784\u7684\u6f14\u8fdb\u5386\u53f2\u3002\u672c\u6587\u662f\u5bf9\u8fd9\u7bc7\u8bba\u6587\u7684\u5b66\u4e60\u548c\u6574\u7406\u7684\u7b14\u8bb0\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#\u5206\u652f\u9884\u6d4b\u5668","title":"\u5206\u652f\u9884\u6d4b\u5668","text":"<p>\u6587\u7ae0 Chapter IV \u8bb2\u8ff0\u4e86 Exynos \u7cfb\u5217\u5fae\u67b6\u6784\u7684\u5206\u652f\u9884\u6d4b\u5668\u5b9e\u73b0\u3002Exynos \u5fae\u67b6\u6784\u7528\u7684\u662f Scaled Hashed Perceptron \u5206\u652f\u65b9\u5411\u9884\u6d4b\u5668\uff0c\u8fd9\u4e2a\u5206\u652f\u9884\u6d4b\u5668\u7684\u63d0\u51fa\u8005 Daniel A. Jim\u00e9nez \u4e5f\u5728\u8fd9\u7bc7\u8bba\u6587\u7684\u4f5c\u8005\u5217\u8868\u4e2d\u3002\u73b0\u5728\u91c7\u7528\u57fa\u4e8e Perceptron \u7684\u5206\u652f\u9884\u6d4b\u5668\u7684\u5904\u7406\u5668\u4e0d\u591a\uff0cAMD \u7684 Zen 1 \u7528\u4e86\uff0cZen 2 \u662f Perceptron \u52a0 TAGE\uff0cZen 3 \u4ee5\u540e\u5c31\u53ea\u6709 TAGE \u4e86\u3002</p> <p>\u9664\u4e86\u65b9\u5411\u9884\u6d4b\u5668\uff0c\u8fd8\u9700\u8981\u6709 BTB \u6765\u8bc6\u522b\u5206\u652f\u4ee5\u53ca\u8bb0\u5f55\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\u3002\u4e3a\u4e86\u6027\u80fd\uff0c\u6bcf\u4e2a\u5468\u671f\u90fd\u8981\u9884\u6d4b\u81f3\u5c11\u4e00\u4e2a\u5206\u652f\uff0c\u6240\u4ee5\u4e00\u822c\u4f1a\u6709\u4e00\u4e2a 0-bubble \u7684 BTB\uff0c\u5728\u8fd9\u91cc\u53eb uBTB\uff08microBTB\uff0c\u7528 u \u4ee3\u66ff\u5e0c\u814a\u5b57\u6bcd \u03bc\uff09\u3002\u4f46\u4e5f\u56e0\u4e3a\u65f6\u5e8f\u7684\u9650\u5236\uff0c\u4e0d\u4f1a\u505a\u7684\u592a\u5927\u3002\u4e3a\u4e86\u652f\u6301\u6709\u66f4\u5927\u7684\u5bb9\u91cf\uff0c\u901a\u5e38\u8fd8\u4f1a\u6709\u66f4\u5927\u7684\uff0c\u5ef6\u8fdf\u4e5f\u66f4\u957f\u7684 BTB\uff0c\u5728\u8fd9\u91cc\u53eb mBTB\uff08Main BTB\uff09\uff0c\u6700\u5927\u7684\u662f L2 BTB\uff0c\u8fd8\u6709\u540e\u9762\u4f1a\u8bb2\u5230\u5904\u7406\u8fb9\u754c\u60c5\u51b5\u7684 vBTB\u3002\u540c\u7406\uff0c\u5206\u652f\u9884\u6d4b\u5668\u4e5f\u6709\u5bb9\u91cf\u548c\u5ef6\u8fdf\u7684\u53cc\u91cd\u8003\u8651\uff0c\u8bbe\u7f6e\u4e0d\u540c\u5927\u5c0f\u548c\u5bb9\u91cf\u7684\u5206\u652f\u9884\u6d4b\u5668\uff0c\u4e5f\u53ef\u80fd\u4f1a\u5206\u591a\u7ea7\uff0c\u548c 0-bubble uBTB \u914d\u5bf9\u7684 LHP\uff08Local History Perception\uff09\u4ee5\u53ca 1-2 bubble mBTB \u914d\u5bf9\u7684\u5b8c\u6574\u7684 SHP\uff08Scaled Hashed Perception\uff09\u3002\u6b64\u5916\u8fd8\u6709 RAS\uff08Return Address Stack\uff09\u8d1f\u8d23\u51fd\u6570\u8fd4\u56de\u5730\u5740\u7684\u9884\u6d4b\u3002</p> <p>\u9996\u5148\u4ece Exynos \u6700\u65e9\u7684\u5206\u652f\u9884\u6d4b\u5668\u8bbe\u8ba1\u5f00\u59cb\u3002\u4e00\u5f00\u59cb\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5c31\u8003\u8651\u5230\u8981\u652f\u6301 2 prediction/clock \u7684\u573a\u666f\uff0c\u524d\u63d0\u662f\u7b2c\u4e00\u4e2a\u5206\u652f\u662f not taken \u7684\u3002\u4f8b\u5982\u6709\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u7b2c\u4e00\u6761\u662f\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff0c\u5982\u679c\u7b2c\u4e00\u6761\u5206\u652f taken\uff0c\u90a3\u5c31\u4ee5\u7b2c\u4e00\u6761\u5206\u652f\u7684\u7ed3\u679c\u4e3a\u51c6\uff1b\u5982\u679c\u7b2c\u4e00\u6761\u5206\u652f not taken\uff0c\u90a3\u5c31\u5e94\u8be5\u4ee5\u7b2c\u4e8c\u6761\u5206\u652f\u7684\u7ed3\u679c\u4e3a\u51c6\u3002\u8fd9\u6837\u53ef\u4ee5\u5728\u6bd4\u8f83\u4f4e\u7684\u5f00\u9500\u7684\u524d\u63d0\u4e0b\uff0c\u4e00\u4e2a\u5468\u671f\u9884\u6d4b\u4e24\u6761\u5206\u652f\u6307\u4ee4\uff0c\u63d0\u9ad8\u5206\u652f\u9884\u6d4b\u7684\u6027\u80fd\uff0c\u5982\u679c\u4e0d\u505a\u8fd9\u4e2a\u4f18\u5316\u7684\u8bdd\uff0c\u9700\u8981\u5148\u9884\u6d4b\u7b2c\u4e00\u6761\u5206\u652f\uff0c\u9884\u6d4b\u5b8c\uff0c\u518d\u53bb\u9884\u6d4b\u7b2c\u4e8c\u6761\u5206\u652f\u3002\u8bba\u6587\u4e2d\u6307\u51fa\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u9700\u8981\u9884\u6d4b 2 \u4e2a\u5206\u652f\u7684\u573a\u666f\uff0c\u6709 60% \u7684\u60c5\u51b5\u662f\u7b2c\u4e00\u6761\u5206\u652f taken\uff0c24% \u60c5\u51b5\u662f\u7b2c\u4e00\u6761\u5206\u652f not taken \u5e76\u4e14\u7b2c\u4e8c\u6761\u5206\u652f taken\uff0c\u4e24\u4e2a\u90fd not taken \u7684\u60c5\u51b5\u5360 16%\u3002\u90a3\u4e48\u540e 40% \u7684\u60c5\u51b5\u5c31\u53ef\u4ee5\u5f97\u5230\u6027\u80fd\u63d0\u5347\u3002\u8fd9\u4e2a\u4f18\u5316\u8fd8\u662f\u633a\u5e38\u89c1\u7684\uff0c\u4f8b\u5982\u9999\u5c71\u5357\u6e56\u67b6\u6784\u505a\u4e86\u8fd9\u4e2a\u4f18\u5316\uff0c\u800c\u4e14\u867d\u7136\u53ef\u4ee5 2 predictions/cycle\uff0c\u4f46\u5b9e\u9645\u4e0a\u53ea\u6709\u4e00\u4e2a Fetch Packet\uff0c\u4e5f\u6700\u591a 1 taken prediction/cycle\u3002</p> <p>SHP\uff0c\u4e5f\u5c31\u662f\u90a3\u4e2a\u6700\u5927\u7684 Perceptron \u9884\u6d4b\u5668\uff0c\u5305\u542b\u4e86 8 \u4e2a\u8868\uff0c\u6bcf\u4e2a\u8868\u6709 1024 \u4e2a\u6743\u91cd\uff0c\u6bcf\u4e2a BTB \u8868\u9879\u8fd8\u7ed9\u6bcf\u4e2a\u5206\u652f\u8bb0\u5f55\u4e86\u4e00\u4e2a bias\u3002\u9884\u6d4b\u7684\u65f6\u5019\uff0c\u6839\u636e GHR\uff08\u6839\u636e\u5206\u652f taken/not taken \u5386\u53f2\uff09\u548c PHR\uff08\u6839\u636e taken branch \u5730\u5740\uff09\u4ee5\u53ca\u5206\u652f\u7684 PC \u7ecf\u8fc7\u54c8\u5e0c\uff0c\u5f97\u5230 table \u7684 index\uff0c\u6839\u636e index \u53bb\u8bbf\u95ee\u6743\u91cd\u3002\u628a\u4ece 8 \u4e2a\u8868\u91cc\u8bfb\u51fa\u6765\u7684\u6743\u91cd\u52a0\u8d77\u6765\uff0c\u518d\u52a0\u4e0a bias \u7684\u4e24\u500d\uff0c\u5f97\u5230\u6700\u65e9\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u5982\u679c\u662f\u975e\u8d1f\u6570\uff0c\u5219\u9884\u6d4b\u4e3a taken\uff1b\u8d1f\u6570\u5219\u9884\u6d4b\u4e3a not taken\u3002</p> <p>\u77e5\u9053\u5206\u652f\u7684\u5b9e\u9645\u8df3\u8f6c\u65b9\u5411\u540e\uff0c\u5982\u679c\u9884\u6d4b\u9519\u8bef\u4e86\uff0c\u6216\u8005\u9884\u6d4b\u5bf9\u4e86\uff0c\u4f46\u662f\u8ba1\u7b97\u7ed3\u679c\u592a\u63a5\u8fd1 0\uff0c\u5c31\u9700\u8981\u66f4\u65b0 weight\u3002\u66f4\u65b0\u65f6\uff0c\u4f1a\u66f4\u65b0\u53c2\u4e0e\u5230\u8ba1\u7b97\u7684\u6765\u81ea\u5404\u4e2a\u8868\u7684 weight\uff0c\u5982\u679c\u662f taken\uff0c\u90a3\u5c31\u589e\u52a0 weight\uff1b\u5982\u679c\u662f not taken\uff0c\u5c31\u51cf\u5c11 weight\u3002Exynos M1 \u91c7\u7528\u4e86 165 \u4f4d\u7684 GHR\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1 165 \u6761\u6761\u4ef6\u5206\u652f\u7684\u8df3\u8f6c\u65b9\u5411\uff0c\u4ee5\u53ca 80 \u4f4d\u7684 PHR\uff0c\u6bcf\u4e2a taken branch \u4f1a\u5411 PHR \u8d21\u732e 3 \u4e2a bit\uff08B[4:2]\uff09\uff0c\u4f46\u662f\u6ca1\u8bf4\u79fb\u4f4d\u591a\u5c11\u3002\u8fd9\u6837\u5c31\u6784\u6210\u4e86\u4e00\u4e2a Perceptron \u9884\u6d4b\u5668\u3002</p> <p>\u7279\u522b\u5730\uff0c\u9488\u5bf9\u603b\u662f\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u4f8b\u5982\u65e0\u6761\u4ef6\u8df3\u8f6c\u5206\u652f\uff0c\u6216\u8005\u603b\u662f\u8df3\u8f6c\u7684\u6761\u4ef6\u5206\u652f\uff0c\u5c31\u4e0d\u7528\u66f4\u65b0 SHP \u4e86\uff0c\u4ed6\u4eec\u53ea\u9700\u8981\u5728 BTB \u4e2d\u6807\u8bb0\u4e00\u4e0b\u5373\u53ef\uff0c\u907f\u514d\u6c61\u67d3 SHP\uff0c\u5e72\u6270\u5176\u4ed6\u5206\u652f\u7684\u9884\u6d4b\u3002\u7c7b\u4f3c\u7684\u601d\u8def\u4e5f\u633a\u5e38\u89c1\u7684\uff0cAMD \u7684\u505a\u6cd5\u662f\uff0c\u5bf9\u4e8e\u4ece\u6765\u6ca1\u6709\u8df3\u8f6c\u8fc7\u7684\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff0c\u4e0d\u5206\u914d BTB \u8868\u9879\uff0c\u5e76\u4e14\u9884\u6d4b\u4e3a\u4e0d\u8df3\u8f6c\uff1b\u5f53\u6761\u4ef6\u5206\u652f\u4e86\u8df3\u8f6c\u7b2c\u4e00\u6b21\uff0c\u90a3\u5c31\u4f1a\u5728 BTB \u4e2d\u5206\u914d\u8868\u9879\uff0c\u6807\u8bb0\u4e3a always taken\uff0c\u8868\u793a\u9884\u6d4b\u4e3a\u603b\u662f\u8df3\u8f6c\uff1b\u5f53\u6761\u4ef6\u5206\u652f\u8df3\u8f6c\u548c\u4e0d\u8df3\u8f6c\u5404\u81f3\u5c11\u4e00\u6b21\uff0c\u624d\u542f\u7528\u5206\u652f\u65b9\u5411\u9884\u6d4b\u5668\u3002</p> <p>\u63a5\u4e0b\u6765\u662f BTB\u3002mBTB\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u6709 1-2 bubble \u7684\u7565\u5fae\u5927\u4e00\u4e9b\u7684 BTB\uff0c\u53ef\u4ee5\u7ed9 128B \u5927\u5c0f\u7684 cacheline \u4fdd\u5b58 8 \u6761\u5206\u652f\u6307\u4ee4\u3002\u7edf\u8ba1\u6570\u636e\u8868\u793a\uff0c\u5e73\u5747\u6bcf 5 \u6761\u6307\u4ee4\u6709\u4e00\u6761\u662f\u5206\u652f\u6307\u4ee4\uff0c\u90a3\u4e48 128B \u5728 4 \u5b57\u8282\u5b9a\u957f\u6307\u4ee4\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5b58 32 \u6761\u6307\u4ee4\uff0c\u4f30\u7b97\u5f97\u5230\u5927\u7ea6\u6709 6-7 \u6761\u5206\u652f\u6307\u4ee4\uff0c\u6240\u4ee5\u8bbe\u8ba1\u4e86\u53ef\u4ee5\u5b58 8 \u6761\u3002\u4f46\u4e5f\u6709\u53ef\u80fd\u5206\u652f\u5bc6\u5ea6\u5f88\u9ad8\uff0c128B \u5168\u662f\u5206\u652f\u6307\u4ee4\uff0c\u90a3\u5c31\u4f1a\u6709 32 \u6761\u5206\u652f\u6307\u4ee4\u4e86\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8bbe\u8ba1\u4e86 vBTB\uff08virtual indexed BTB\uff09\uff0c\u53ef\u4ee5\u628a 128B \u7684 cacheline \u91cc\u8d85\u8fc7 8 \u4e2a branch \u7684\u591a\u4f59\u90e8\u5206\u4fdd\u5b58\u4e0b\u6765\uff0c\u5f53\u7136\u4e86\uff0c\u4f1a\u6709\u989d\u5916\u7684\u5f00\u9500\u3002</p> <p>\u6bd4\u8f83\u7279\u522b\u7684\u662f\uff0c\u6ca1\u6709\u8bbe\u8ba1\u5355\u72ec\u7684\u4f8b\u5982 ITTAGE \u90a3\u6837\u7684 Indirect Predictor\uff0c\u800c\u662f\u91c7\u7528\u4e86\u53eb\u505a VPC\uff08Virtual PC\uff09\u7684\u65b9\u6848\uff0c\u5b83\u7684\u601d\u8def\u662f\uff0c\u590d\u7528\u65b9\u5411\u9884\u6d4b\u5668\u548c BTB \u7684\u80fd\u529b\uff0c\u628a\u4e00\u6761 Indirect Branch \u6620\u5c04\u4e3a\u591a\u6761 Conditional Branch\uff0c\u6bcf\u4e2a Conditional Branch \u7684 Target \u5bf9\u5e94\u4e00\u4e2a\u53ef\u80fd\u7684 Indirect Branch Target\uff0c\u8fd9\u4e2a Target \u5c31\u5b58\u5728 BTB \u5f53\u4e2d\u3002\u9884\u6d4b\u7684\u65f6\u5019\uff0c\u6309\u7167\u987a\u5e8f\u904d\u5386\u6bcf\u4e2a\u865a\u62df\u7684 Conditional Branch\uff0c\u5982\u679c\u9884\u6d4b\u4e3a taken\uff0c\u90a3\u5c31\u8df3\u8f6c\u5230\u8fd9\u4e2a\u865a\u62df\u7684\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\uff1b\u5982\u679c\u9884\u6d4b\u4e3a not taken\uff0c\u90a3\u5c31\u904d\u5386\u5230\u4e0b\u4e00\u4e2a\u865a\u62df\u7684\u5206\u652f\u3002\u5982\u679c\u6240\u6709\u7684\u865a\u62df\u6761\u4ef6\u5206\u652f\u90fd\u88ab\u9884\u6d4b\u4e3a\u4e0d\u8df3\u8f6c\uff0c\u90a3\u5c31\u9700\u8981\u7b49\u5230\u540e\u7aef\u8ba1\u7b97\u51fa\u5b9e\u9645\u7684\u76ee\u7684\u5730\u5740\uff0c\u518d\u8df3\u8f6c\u3002\u5bf9\u4e8e\u6bcf\u4e2a Indirect Branch\uff0c\u8fd9\u6837\u7684\u865a\u62df\u6761\u4ef6\u5206\u652f\u6700\u591a\u751f\u6210 16 \u4e2a\u3002</p> <p>\u8fd9\u4e9b\u865a\u62df\u7684\u6761\u4ef6\u5206\u652f\u65e2\u7136\u8981\u5229\u7528 BTB \u7684\u7a7a\u95f4\uff0c\u81ea\u7136\u4e5f\u4f1a\u62a2\u5360 128B cacheline \u6700\u591a 8 \u6761\u5206\u652f\u7684\u9650\u5236\uff0c\u591a\u4f59\u7684\u5206\u652f\u6216\u8005 Indirect Branch \u751f\u6210\u7684\u865a\u62df\u6761\u4ef6\u5206\u652f\u4e5f\u4f1a\u6ea2\u51fa\u5230 vBTB \u5185\u3002\u8fd9\u79cd\u8bbe\u8ba1\u8fd8\u662f\u7b2c\u4e00\u6b21\u89c1\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e2a\u521d\u59cb\u7684\u5206\u652f\u9884\u6d4b\u5668\u8bbe\u8ba1\u53ea\u6709\u4e00\u4e2a main BTB\uff0c\u9700\u8981 2 bubble \u624d\u80fd\u51fa\u4e00\u4e2a taken branch\uff0c\u5728 taken branch \u5f88\u5bc6\u96c6\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4e09\u4e2a\u5468\u671f\u4e00\u4e2a taken branch \u4e86\uff0c\u8fd9\u6027\u80fd\u80af\u5b9a\u4e0d\u591f\u597d\u3002\u6240\u4ee5 Exynos M1 \u5f15\u5165\u4e86 0-bubble \u7684 uBTB\uff0c\u5bb9\u91cf\u6bd4\u8f83\u5c0f\uff0c\u597d\u5904\u662f\u5feb\uff0c\u4e00\u822c\u8fd9\u79cd 0-bubble BTB \u4e5f\u53ef\u4ee5\u53eb\u505a Next Line Predictor\uff0c\u9884\u6d4b\u4e0b\u4e00\u4e2a\u5468\u671f\u7684 Fetch \u5730\u5740\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0 0-bubble \u7684 uBTB\uff0cExynos M1 \u7528\u4e86\u4e00\u4e2a\u57fa\u4e8e\u56fe\u7684\u7ed3\u6784\u6765\u8bb0\u5f55\u5206\u652f\u4e4b\u95f4\u7684\u8df3\u8f6c\u5173\u7cfb\uff0c\u914d\u5408\u4e00\u4e2a\u8bb0\u5f55\u5206\u652f\u5c40\u90e8\u5386\u53f2\u7684 Hashed Perceptron \u7b97\u6cd5\u6765\u9884\u6d4b\u65b9\u5411\u3002\u8fd9\u4e2a\u9884\u6d4b\u7b97\u6cd5\u4e5f\u662f\u7b2c\u4e00\u6b21\u89c1\uff0c\u5728\u4e09\u661f\u7684\u4e13\u5229 High performance zero bubble conditional branch prediction using micro branch target buffer  \u4e2d\u63d0\u51fa\uff0c\u5927\u9898\u601d\u8def\u5176\u5b9e\u5c31\u662f\u628a\u57fa\u672c\u5757\u5b66\u4e60\u51fa\u6765\uff0c\u627e\u5230\u5206\u652f\u4e4b\u95f4 taken \u548c not taken \u7684\u5173\u7cfb\uff0c\u4ee5\u6bcf\u4e2a\u5206\u652f\u4e3a\u4e00\u4e2a\u7ed3\u70b9\uff0c\u5982\u679c\u4e00\u4e2a\u5206\u652f taken \u4ee5\u540e\u4f1a\u5230\u53e6\u4e00\u4e2a\u5206\u652f\uff0c\u90a3\u5c31\u5728\u8fd9\u4e24\u4e2a\u5206\u652f\u5bf9\u5e94\u7684\u7ed3\u70b9\u4e4b\u95f4\u8fde\u4e00\u6761 taken \u7684\u6709\u5411\u8fb9\uff0c\u7c7b\u4f3c\u5730\uff0cnot taken \u4e5f\u4f1a\u8fde not taken \u7684\u6709\u5411\u8fb9\u3002</p> <p>\u6709\u4e86\u56fe\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u56fe\u4e2d\u77e5\u9053\u4e0b\u4e00\u4e2a\u4f1a\u5230\u8fbe\u7684\u5206\u652f\u5728\u54ea\u91cc\uff0c\u5373\u4f7f\u8fd9\u4e2a\u5206\u652f\u53ef\u80fd\u8ddd\u79bb\u5f88\u8fdc\uff1b\u800c\u5e38\u89c4\u7684 BTB \u8bbe\u8ba1\u91cc\uff0c\u5219\u662f\u62ff\u5230\u5730\u5740\u4ee5\u540e\uff0c\u7528\u5730\u5740\u53bb\u5bfb\u627e\u5339\u914d\u7684 BTB entry\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u626b\u63cf\u5230\u4e00\u4e9b\u4e0d\u5b58\u5728\u5206\u652f\u6307\u4ee4\u7684\u4ee3\u7801\u5757\u3002\u8fd9\u91cc\u4e5f\u652f\u6301\u524d\u9762\u8bf4\u7684\u8fde\u7eed\u4e24\u4e2a\u5206\u652f\u540c\u65f6\u9884\u6d4b\u7684\u60c5\u51b5\uff0c\u5728\u540c\u4e00\u4e2a\u5468\u671f\u5185\u9884\u6d4b\u4e24\u4e2a\u5206\u652f\uff0c\u5982\u679c\u7b2c\u4e00\u4e2a\u5206\u652f\u4e0d\u8df3\uff0c\u5c31\u7528\u7b2c\u4e8c\u4e2a\u5206\u652f\u7684\u7ed3\u679c\uff0c\u5728\u6811\u4e0a\u8f6c\u79fb\u3002\u4e3a\u4e86\u7701\u7535\uff0c\u5f53 uBTB \u9884\u6d4b\u51c6\u786e\u7387\u8f83\u9ad8\uff0c\u56fe\u8bb0\u5f55\u4e86\u6700\u8fd1\u6267\u884c\u7684\u6240\u6709\u5206\u652f\uff0c\u90a3\u4e48 uBTB \u5c31\u53ef\u4ee5\u706b\u529b\u5168\u5f00\uff0c\u4fdd\u6301 0-bubble \u7684\u9884\u6d4b\uff0c\u8fd9\u4e2a\u9884\u6d4b\u5728\u540e\u9762\u7684\u6d41\u6c34\u7ebf\u4e2d\u4f1a\u88ab mBTB \u548c SHP \u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u786e\u8ba4\u3002\u5982\u679c\u51c6\u786e\u7387\u7279\u522b\u9ad8\uff0c\u8ba4\u4e3a mBTB \u548c SHP \u5927\u6982\u7387\u4e5f\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u9884\u6d4b\u7ed3\u679c\uff0c\u5c31\u4f1a\u8fdb\u4e00\u6b65\u505c\u6b62 mBTB \u548c SHP \u7684\u4f7f\u7528\uff0c\u964d\u4f4e\u529f\u8017\uff0c\u8fd9\u65f6\u5019\u5c31\u8981\u9760\u540e\u7aef\u7684 Branch Unit \u6765\u68c0\u67e5\u9884\u6d4b\u662f\u5426\u6b63\u786e\u3002</p> <p>\u8fd9\u5c31\u662f Exynos M1 \u548c M2 \u7684\u5206\u652f\u9884\u6d4b\u5668\u8bbe\u8ba1\u3002\u4e0a\u9762\u7684\u4e13\u5229High performance zero bubble conditional branch prediction using micro branch target buffer\u8fd8\u7ed9\u51fa\u4e86\u524d\u7aef\u7684\u6d41\u6c34\u7ebf\u5404\u7ea7\u7684\u529f\u80fd\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u56fe\u4e2d\u6ca1\u6709\u7ed8\u5236 uBTB \u5185\u90e8\u7684\u7ed3\u6784\uff0cuBTB \u8d1f\u8d23\u7ed9\u51fa\u521d\u59cb\u7684\u9884\u6d4b\uff0c\u5230 B1 \u9636\u6bb5\uff0c\u4ece B1 \u5f00\u59cb\uff0c\u4f1a\u7ecf\u8fc7\u4e24\u6761\u6d41\u6c34\u7ebf\uff0c\u4e0a\u9762\u7684\u6d41\u6c34\u7ebf\u662f mBTB + SHP \u8d1f\u8d23\u66f4\u7cbe\u786e\u7684\u9884\u6d4b\uff0c\u4e0b\u9762\u7684\u6d41\u6c34\u7ebf\u662f\u67e5\u8be2 ITLB + \u8bfb\u53d6 ICache\u3002\u4e0a\u9762\u8bf4 2-bubble \u7684 mBTB\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u4ece B1 \u5f97\u5230 Fetch Window\uff0cB2 \u8bfb\u53d6 mBTB \u548c SHP \u7684\u6743\u91cd\uff0c\u7b49\u5230 B3 \u5b8c\u6210\u4e4b\u540e\u624d\u53ef\u4ee5\u8ba1\u7b97\u51fa\u7ed3\u679c\uff0c\u5224\u65ad\u662f taken \u8fd8\u662f not taken\uff0c\u5982\u679c\u9884\u6d4b\u7684\u7ed3\u679c\u548c uBTB \u9884\u6d4b\u4e0d\u4e00\u81f4\uff0c\u5c31\u9700\u8981\u5237\u6d41\u6c34\uff0c\u4ece B1 \u91cd\u65b0\u5f00\u59cb\uff1aB1 B2 B3 B1 B2 B3\uff0c\u4e09\u4e2a\u5468\u671f\u4e00\u4e2a taken branch\u3002</p> <p>\u56fe\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230 vBTB \u5728 B4\uff0c\u6240\u4ee5\u5982\u679c\u4e00\u4e2a cacheline \u6709\u8d85\u8fc7 8 \u4e2a branch\uff0c\u90a3\u4e48\u5728\u9884\u6d4b\u8fd9\u4e9b\u6ea2\u51fa\u5230 vBTB \u4e2d\u7684\u5206\u652f\u65f6\uff0c\u9700\u8981\u989d\u5916\u7684\u4e24\u4e2a\u5468\u671f\uff1aB1 B2 B3 B4 B3\uff0c\u4e94\u4e2a\u5468\u671f\u4e00\u4e2a taken branch\u3002</p> <p>Exynos M3 \u7ee7\u7eed\u6539\u8fdb\u4e86\u5206\u652f\u9884\u6d4b\u5668\u3002\u9996\u5148\u662f uBTB \u7684\u56fe\u7684\u5bb9\u91cf\u7ffb\u500d\uff0c\u6dfb\u52a0\u4e86\u9488\u5bf9\u65e0\u6761\u4ef6\u5206\u652f\u7684\u5bb9\u91cf\u3002\u4e3a\u4e86\u52a0\u901f\u603b\u662f\u8df3\u8f6c\u7684\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff0c\u5f53 mBTB \u68c0\u6d4b\u5230\u603b\u662f\u8df3\u8f6c\u7684\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u65f6\uff0c\u63d0\u524d\u4e00\u4e2a\u5468\u671f\u5f97\u5230\u7ed3\u679c\uff0c\u4e5f\u5c31\u662f\u4e0a\u56fe\u4e2d B3 \u5230 B1 \u7684\u8fde\u7ebf\uff0c\u6ca1\u6709\u7ecf\u8fc7\u6743\u91cd\u8ba1\u7b97\uff0c\u76f4\u63a5\u5237 B1\uff1aB1 B2 B1 B2\uff0c\u4e24\u4e2a\u5468\u671f\u4e00\u4e2a taken branch\uff0c1-bubble\uff0c\u5728\u8bba\u6587\u91cc\u53eb\u505a 1AT\uff081-bubble Always Taken\uff09\u3002Exynos M3 \u8fd8\u7ffb\u500d\u4e86 SHP \u7684\u884c\u7684\u4e2a\u6570\uff0c\u4e5f\u7ffb\u500d\u4e86 L2 BTB \u5bb9\u91cf\u3002</p> <p>Exynos M4 \u7ee7\u7eed\u7ffb\u500d\u4e86 L2 BTB \u5bb9\u91cf\uff0c\u51cf\u5c11\u4e86 L2 BTB refill \u5230 mBTB \u7684\u5ef6\u8fdf\uff0c\u5e26\u5bbd\u7ffb\u500d\u3002\u8fd9\u4e2a\u4f18\u5316\u4e3b\u8981\u662f\u9488\u5bf9\u5206\u652f\u6bd4\u8f83\u591a\uff0cmBTB \u5b58\u4e0d\u4e0b\u7684\u7a0b\u5e8f\u3002</p> <p>Exynos M5 \u589e\u52a0\u4e86 Empty Line Optimization \u4f18\u5316\uff1a\u68c0\u6d4b\u6ca1\u6709\u5206\u652f\u7684\u7f13\u5b58\u884c\uff0c\u5982\u679c\u786e\u8ba4\u7f13\u5b58\u884c\u6ca1\u6709\u5206\u652f\uff0c\u90a3\u5c31\u4e0d\u7528\u9884\u6d4b\u91cc\u9762\u7684\u5206\u652f\u4e86\uff0c\u53ef\u4ee5\u8282\u7701\u529f\u8017\u3002</p> <p>\u4e3a\u4e86\u8fdb\u4e00\u6b65\u4f18\u5316 taken branch \u7684\u541e\u5410\uff0c\u5728 mBTB \u4e2d\u8bb0\u5f55\u5206\u652f\u7684\u76ee\u7684\u5730\u5740\u65f6\uff0c\u4e0d\u4ec5\u8bb0\u5f55\u5728\u5206\u652f\u672c\u8eab\u6240\u5728\u7684 mBTB entry \u4e2d\uff0c\u8fd8\u8981\u8bb0\u5f55\u5728\u8fd9\u6761\u5206\u652f\u7684\u524d\u5e8f\u5206\u652f\u7684 mBTB entry \u4e2d\uff1a\u4f8b\u5982 A \u8df3\u8f6c\u5230 B\uff0cB \u8df3\u8f6c\u5230 C\uff0c\u7ecf\u5178\u7684\u5b9e\u73b0\u662f\u7528 A \u7684\u5730\u5740\u627e\u5230 A \u7684 BTB entry\uff0centry \u4e2d\u8bb0\u5f55\u4e86 A \u76ee\u7684\u5730\u5740\u662f B\uff0c\u63a5\u7740\u7528 B \u7684\u5730\u5740\u627e\u5230 B \u7684 BTB entry\uff0centry \u4e2d\u8bb0\u5f55\u4e86 B \u7684\u76ee\u7684\u5730\u5740\u662f C\uff1b\u800c Exynos M5 \u7684\u8bbe\u8ba1\u662f\uff0cC \u7684\u76ee\u7684\u5730\u5740\uff0c\u4e0d\u4ec5\u8981\u8bb0\u5f55\u5728 B \u7684 BTB entry \u4e2d\uff0c\u8fd8\u8981\u8bb0\u5f55\u5728 A \u7684 BTB entry \u4e2d\u3002\u4e0d\u8fc7\u8fd9\u91cc\u8981\u6c42 B \u7684\u8df3\u8f6c\u662f always-taken \u6216\u8005 often-taken\uff0c\u56e0\u4e3a\u5e76\u6ca1\u6709\u5bf9\u7b2c\u4e8c\u6761\u5206\u652f\u505a\u9884\u6d4b\uff0c\u800c\u662f\u9884\u6d4b\u5b83\u4e00\u5b9a\u4f1a\u8df3\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5728 2-bubble \u7684\u9884\u6d4b\u5668\u7684\u5b9e\u73b0\u4e0b\uff0c\u5b9e\u73b0 1 taken branch/cycle \u7684\u541e\u5410\uff0c\u7b49\u6548\u4e8e\u4e00\u4e2a 0-bubble \u7684\u9884\u6d4b\u5668\u3002\u4e0b\u9762\u662f\u8bba\u6587\u4e2d\u5bf9 mBTB \u4ece 2-bubble \u5230 1-bubble \u6700\u7ec8\u5230 0-bubble \u7684\u53d8\u5316\u7684\u5bf9\u6bd4\u56fe\uff1a</p> <p></p> <p>\u6700\u5de6\u8fb9\u7684 SHP 2-bubble \u5c31\u662f\u6700\u521d\u7684\u5b9e\u73b0\uff0c\u5b83\u9700\u8981\u5728 B3 \u5f97\u5230\u5206\u652f\u662f taken \u8fd8\u662f not taken \u7684\u4fe1\u606f\uff0c\u5982\u679c\u548c\u4e4b\u524d\u9884\u6d4b\u7684\u4e0d\u4e00\u6837\uff0c\u90a3\u5c31\u9700\u8981 flush \u6389\u6d41\u6c34\u7ebf\uff0cB1 \u91cd\u65b0\u4ece\u6b63\u786e\u7684\u5730\u5740\u5f00\u59cb\uff0c\u7136\u540e\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u7531\u4e8e\u6bcf\u6b21\u90fd\u9700\u8981\u5230 B3 \u624d\u80fd\u5f97\u5230\u6b63\u786e\u7684\u5730\u5740\uff0c\u6240\u4ee5\u4e09\u4e2a\u5468\u671f\u4e00\u4e2a taken branch\u3002</p> <p>\u4e2d\u95f4\u662f\u6539\u8fdb\u7684 1AT 1-bubble \u5b9e\u73b0\uff0c\u5b83\u5728 mBTB \u4e2d\u8bb0\u5f55\u4e86\u8fd9\u4e2a\u5206\u652f\u662f\u5426\u662f Always Taken\u3002\u56e0\u4e3a mBTB \u5728 B2 \u4e2d\u8bfb\u53d6\uff0c\u6240\u4ee5\u8fd9\u4e2a\u4fe1\u606f\u5728 B2 \u5c31\u53ef\u4ee5\u5f97\u77e5\uff0c\u4f8b\u5982\u56fe\u4e2d A \u5206\u652f\u5230\u8fbe B2 \u65f6\uff0c\u68c0\u6d4b\u5230\u5b83\u662f Always Taken\uff0c\u4e0b\u4e2a\u5468\u671f\u7684 B1 \u76f4\u63a5\u5c31\u4ece\u6b63\u786e\u7684\u5730\u5740 B \u5f00\u59cb\uff0c\u540c\u7406 B \u5230\u8fbe B2 \u65f6\uff0c\u53c8\u53d1\u73b0\u5b83\u662f Always Taken\uff0c\u4e0b\u4e00\u4e2a\u5468\u671f\u7684 B1 \u53c8\u4ece C \u5f00\u59cb\uff0c\u6240\u4ee5\u4e24\u5468\u671f\u4e00\u4e2a taken branch\uff0c\u524d\u63d0\u662f\u5206\u652f\u662f Always Taken\uff0c\u901a\u8fc7\u907f\u514d\u5206\u652f\u9884\u6d4b\u6765\u51cf\u5c11\u4e00\u4e2a\u5468\u671f\u7684 bubble\u3002</p> <p>\u53f3\u8fb9\u662f\u6700\u540e\u7684 ZAT/ZOT 0-bubble \u5b9e\u73b0\uff0c\u5b83\u5728 mBTB \u4e2d\u8bb0\u5f55\u4e86\u540e\u7eed\u4e24\u4e2a\u5206\u652f\u7684\u5730\u5740\uff0c\u4f8b\u5982 X \u5728 mBTB \u4e2d\u8bb0\u5f55\u4e86 A \u548c B \u7684\u5730\u5740\u3002\u5f53 B3 \u53d1\u73b0 X \u8981\u8df3\u8f6c\u7684\u65f6\u5019\uff0c\u5237\u6d41\u6c34\u7ebf\uff0c\u5728\u63a5\u4e0b\u6765\u7684\u4e24\u4e2a\u5468\u671f\u91cc\u5206\u522b\u7ed9 B1 \u63d0\u4f9b\u4e86 A \u548c B \u7684\u5730\u5740\u3002\u5f53 A \u5230\u8fbe B2 \u65f6\uff0cA \u5728 mBTB \u91cc\u8bb0\u5f55\u4e86 B \u548c C \u7684\u5730\u5740\uff0c\u4e8e\u662f\u628a C \u7684\u5730\u5740\u8f6c\u53d1\u5230\u4e0b\u4e00\u4e2a\u5468\u671f\u7684 B1\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0cB2 \u7684 B \u5f97\u5230\u4e86 D \u7684\u5730\u5740\uff0cB2 \u7684 C \u5f97\u5230\u4e86 E \u7684\u5730\u5740\uff0c\u8fd9\u6837\u5b9e\u73b0\u4e86\u6bcf\u4e2a\u5468\u671f\u4e00\u4e2a taken branch\u3002\u901a\u8fc7\u8bb0\u5f55\u4e24\u8df3\u7684\u5730\u5740\u548c\u907f\u514d\u5206\u652f\u9884\u6d4b\uff08\u628a Always Taken \u548c Often Taken \u90fd\u9884\u6d4b\u4e3a Taken\uff09\uff0c\u4e24\u4e2a\u5468\u671f\u7ed9\u51fa\u4e24\u4e2a\u5730\u5740\uff0c\u51cf\u5c11\u4e24\u4e2a\u5468\u671f\u7684 bubble\u3002</p> <p>\u8fd9\u65f6\u5019\u5c31\u76f8\u5f53\u4e8e\u6709\u4e24\u4e2a 0-bubble \u9884\u6d4b\u5668\u4e86\uff0cmBTB \u6709 0-bubble \u80fd\u529b\uff0cuBTB \u4e5f\u6709\uff0c\u6240\u4ee5 Exynos M5 \u51cf\u5c11\u4e86 uBTB \u7684\u5bb9\u91cf\uff0c\u6362\u53d6\u66f4\u5927\u7684 mBTB \u7684\u9884\u6d4b\u5668\u5bb9\u91cf\uff1aSHP \u7684\u8868\u6570\u91cf\u7ffb\u500d\uff0cGHR \u5386\u53f2\u957f\u5ea6\u589e\u52a0\u3002</p> <p>\u867d\u7136 mBTB \u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\u53ef\u4ee5\u505a\u5230 0-bubble\uff0c\u4f46\u662f\u5982\u679c\u603b\u662f\u9700\u8981\u7ea0\u6b63\u9884\u6d4b\u9519\u8bef\uff0c\u5c31\u4f1a\u56de\u9000\u5230\u4e09\u4e2a\u5468\u671f\u4e00\u6761\u5206\u652f\u7684\u6027\u80fd\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cExynos M5 \u5f15\u5165\u4e86 Mispredict Recovery Buffer\uff08MRB\uff09\uff1a\u9488\u5bf9\u6bd4\u8f83\u96be\u9884\u6d4b\u7684\u5206\u652f\uff0c\u8bb0\u5f55\u5b83\u540e\u7eed\u6700\u53ef\u80fd\u6267\u884c\u7684\u4e09\u6b21 fetch \u7684\u5730\u5740\uff0c\u5982\u679c\u547d\u4e2d\u4e86 MRB\uff0c\u90a3\u5c31\u76f4\u63a5\u4ece MRB \u4e2d\u6309\u987a\u5e8f\u7528\u4e09\u4e2a\u5468\u671f\u628a\u8fd9\u4e09\u6b21 fetch \u7684\u5730\u5740\u653e\u5230 B1\uff0c\u7136\u540e\u6d41\u6c34\u7ebf\u53bb\u9a8c\u8bc1\u8fd9\u4e09\u4e2a fetch \u5730\u5740\u662f\u5426\u6b63\u786e\uff0c\u8282\u7701\u4e86\u91cd\u590d\u7684 B3 \u5230 B1 \u7684\u91cd\u5b9a\u5411\u65f6\u95f4\u3002\u8fd9\u4e2a\u601d\u8def\u6709\u70b9\u50cf\u5927\u6a21\u578b\u7684\u63a8\u6d4b\u751f\u6210\uff1a\u7528\u6bd4\u8f83\u77ed\u7684\u65f6\u95f4\u9884\u6d4b\uff08\u5728\u8fd9\u91cc\u662f\u76f4\u63a5\u7528 MRB \u8bb0\u4e0b\u6765\u4e86\uff09\u51fa\u4e00\u4e2a\u672c\u6765\u662f\u4e32\u884c\u7684\u8fc7\u7a0b\u7684\u7ed3\u679c\uff0c\u7136\u540e\u518d\u7528\u6d41\u6c34\u7ebf\u6216\u8005\u5e76\u884c\u7684\u65b9\u5f0f\u53bb\u9a8c\u8bc1\u7ed3\u679c\u662f\u5426\u6b63\u786e\u3002\u5229\u7528\u7684\u6027\u8d28\u90fd\u662f\uff0c\u4e32\u884c\u751f\u6210\u6162\uff0c\u4f46\u662f\u9a8c\u8bc1\u7ed3\u679c\u5374\u6bd4\u8f83\u5feb\u3002</p> <p>Exynos M6 \u6269\u5927\u4e86 mBTB \u5bb9\u91cf\uff0c\u9488\u5bf9\u95f4\u63a5\u8df3\u8f6c\u6307\u4ee4\u505a\u4e86\u66f4\u591a\u7684\u4f18\u5316\uff0c\u4e3b\u8981\u662f\u8003\u8651\u5e94\u7528\u7a0b\u5e8f\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95f4\u63a5\u8df3\u8f6c\u4f1a\u8df3\u8f6c\u5230\u4e0a\u767e\u4e2a\u4e0d\u540c\u7684\u76ee\u7684\u5730\u5740\u8fd9\u79cd\u6a21\u5f0f\uff0c\u4e4b\u524d\u7684 VPC \u65b9\u6cd5\u662f O(n) \u7684\uff0cn \u662f\u53ef\u80fd\u7684\u76ee\u7684\u5730\u5740\u7684\u4e2a\u6570\uff0cn \u5c0f\u7684\u65f6\u5019\u6bd4\u8f83\u597d\uff0cn \u5927\u4e86\u5c31\u5f88\u6162\u4e86\u3002</p> <p>Exynos M6 \u7684\u529e\u6cd5\u662f\uff0c\u9488\u5bf9\u8fd9\u4e9b\u76ee\u7684\u5730\u5740\u7279\u522b\u591a\u7684\u95f4\u63a5\u8df3\u8f6c\u6307\u4ee4\uff0c\u8bbe\u8ba1\u5355\u72ec\u7684\u5b58\u50a8\uff0c\u4e0d\u53bb\u5360\u7528 vBTB \u7684\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u7a7a\u95f4\u662f Indirect target storage\uff0c\u91c7\u7528 4 \u8def\u7ec4\u76f8\u8fde\uff0c\u4e00\u5171 256 \u4e2a set\u3002\u7ecf\u5e38\u51fa\u73b0\u7684\u76ee\u7684\u5730\u5740\u8fd8\u662f\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u653e\u5728 mBTB \u4e2d\uff0c\u4f46\u662f\u5bf9\u4e8e\u5269\u4e0b\u7684\u76ee\u7684\u5730\u5740\uff0c\u5219\u662f\u653e\u5230 Indirect target storage \u4e2d\uff0c\u6839\u636e\u6700\u8fd1\u7684 indirect branch target \u8ba1\u7b97\u51fa Index \u548c Tag\uff0c\u53bb Indirect target storage \u4e2d\u5bfb\u627e\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5c31\u548c ITTAGE \u91cc\u7684\u4e00\u4e2a table \u6709\u70b9\u7c7b\u4f3c\u4e86\u3002</p> <p>\u6700\u540e\u8bba\u6587\u603b\u7ed3\u4e86 Exynos \u4ece M1 \u5230 M6 \u7684\u5404\u7ea7\u5206\u652f\u9884\u6d4b\u5668\u7684\u5b58\u50a8\u9762\u79ef\u5f00\u9500\uff0c\u57fa\u672c\u6bcf\u4e00\u4ee3\u90fd\u6709\u6240\u589e\u52a0\uff0c\u65e2\u6709 MPKI \u7684\u51cf\u5c11\uff08M6 \u76f8\u6bd4 M1 \u5728 SPECint2006 \u4e0a MPKI \u51cf\u5c11 25.6%\uff09\uff0c\u53c8\u6709\u9884\u6d4b\u6027\u80fd\u7684\u63d0\u5347\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#\u5206\u652f\u9884\u6d4b\u5b89\u5168","title":"\u5206\u652f\u9884\u6d4b\u5b89\u5168","text":"<p>\u6709\u610f\u601d\u7684\uff0c\u8bba\u6587\u4e5f\u63d0\u5230\u4e86\u5206\u652f\u9884\u6d4b\u7684\u5b89\u5168\u95ee\u9898\uff0c\u4e3b\u8981\u662f\u907f\u514d\u8de8\u4e0a\u4e0b\u6587\u7684\u5206\u652f\u9884\u6d4b\u5668\u6ce8\u5165\u653b\u51fb\u3002\u6838\u5fc3\u601d\u8def\u662f\uff0c\u7ed9\u6bcf\u4e2a\u4e0a\u4e0b\u6587\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\uff08<code>CONTEXT_HASH</code>\uff09\uff0c\u7136\u540e\u628a\u968f\u673a\u6570\u5f02\u6216\u5230 BTB \u4fdd\u5b58\u7684\u76ee\u7684\u5730\u5740\u91cc\u9762\u53bb\uff0c\u5728\u4ece BTB \u8bfb\u51fa\u6765\u76ee\u7684\u5730\u5740\u4f7f\u7528\u4e4b\u524d\uff0c\u8981\u518d\u6b21\u5f02\u6216\u540c\u4e00\u4e2a\u968f\u673a\u6570\u3002\u90a3\u4e48\u5982\u679c\u662f\u8bfb\u53d6\u4e86\u6765\u81ea\u540c\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7684 BTB entry\uff0c\u901a\u8fc7\u4e24\u6b21\u5f02\u6216\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u539f\u59cb\u6570\u636e\uff1b\u5982\u679c\u662f\u8bfb\u53d6\u4e86\u6765\u81ea\u4e0d\u540c\u4e0a\u4e0b\u6587\u7684 BTB entry\uff0c\u7531\u4e8e\u968f\u673a\u6570\u4e0d\u540c\uff0c\u6700\u540e\u4f1a\u5f97\u5230\u968f\u673a\u7684\u6570\u636e\u3002\u5f53\u7136\u4e86\uff0c\u524d\u63d0\u662f\u8fd9\u4e9b\u968f\u673a\u6570\u4e0d\u80fd\u88ab\u653b\u51fb\u8005\u5f97\u5230\uff0c\u5bf9\u8f6f\u4ef6\u662f\u4e0d\u53ef\u89c1\u7684\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#uop-cache","title":"uOP Cache","text":"<p>Exynos M1 \u5230 M4 \u6ca1\u6709 uOP Cache\uff0c\u6240\u6709\u6307\u4ee4\u90fd\u9700\u8981\u7ecf\u8fc7\u53d6\u6307\u548c\u8bd1\u7801\uff0c\u5f97\u5230 uOP\u3002\u4ece Exynos M5 \u5f00\u59cb\u5f15\u5165\u4e86 uOP Cache\uff0c\u4f1a\u7f13\u5b58\u8bd1\u7801\u540e\u7684 uOP\u3002Exynos M5 \u7684 uOP Cache \u6700\u591a\u53ef\u4ee5\u4fdd\u5b58 384 \u4e2a uOP\uff0c\u6bcf\u4e2a entry \u53ef\u4ee5\u4fdd\u5b58 6 \u4e2a uOP\uff0c\u4e00\u4e2a\u5468\u671f\u63d0\u4f9b\u4e00\u4e2a entry\u3002\u4e00\u4e2a uOP Cache Entry \u4e2d\u7684 uOP \u6765\u81ea\u8fde\u7eed\u7684\u6307\u4ee4\uff0c\u4ee5\u5206\u652f\u6307\u4ee4\u4f5c\u4e3a\u7ed3\u5c3e\u3002\u4e0b\u9762\u662f\u8bba\u6587\u7ed9\u51fa\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u8fd9\u6bb5\u6307\u4ee4\u7684\u5165\u53e3\u5728\u7b2c\u4e00\u4e2a\u7f13\u5b58\u884c\u7684\u6700\u540e\uff0c\u4ece I0 \u5f00\u59cb\uff0c\u6267\u884c I0 I1 I2 I3\uff0cI3 \u662f\u4e00\u6761\u5206\u652f\u6307\u4ee4\uff0c\u56e0\u6b64 uOP \u7684 entry \u5230\u6b64\u7ed3\u675f\uff0c\u8bb0\u5f55\u4e86 I0-I3 \u8bd1\u7801\u540e\u7684 uOP\uff0c\u8fd9\u91cc I2 \u6307\u4ee4\u88ab\u8bd1\u7801\u6210\u4e86\u4e24\u6761 uOP\uff0c\u4e8e\u662f\u8fd9\u4e2a entry \u5c31\u662f U0 U1 U2A U2B U3 \u8fd9\u4e94\u4e2a uOP\u3002I3 \u8df3\u8f6c\u5230\u4e86 I4\uff0cI4 \u7d27\u63a5\u7740\u53c8\u662f\u4e00\u6761\u5206\u652f\u6307\u4ee4 I5\uff0c\u6240\u4ee5 uOP \u7684 entry \u5230\u8fd9\u91cc\u7ed3\u675f\uff0c\u8bb0\u5f55 I4 \u548c I5 \u8bd1\u7801\u540e\u7684 uOP\uff1aU4 \u548c U5\u3002\u540e\u9762\u4f9d\u6b64\u7c7b\u63a8\u3002</p> <p>\u90a3\u4e48\u4ec0\u4e48\u65f6\u5019 uOP Cache \u542f\u7528\u5462\uff1f\u8bba\u6587\u4e2d\u63d0\u5230\u4e86\u4e00\u4e2a\u72b6\u6001\u673a\uff1a</p> <ol> <li>FilterMode\uff1a\u5f53 uBTB \u5728\u5b66\u4e60\u5206\u652f\u4e4b\u95f4\u7684\u5173\u7cfb\u65f6\uff0c\u4e5f\u5728\u68c0\u67e5\u8fd9\u6bb5\u4ee3\u7801\u80fd\u5426\u653e\u5230 uOP Cache \u91cc\uff0c\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8f6c\u79fb\u5230 BuildMode</li> <li>BuildMode\uff1a\u5f00\u59cb\u628a\u8bd1\u7801\u5f97\u5230\u7684 uOP \u4fdd\u5b58\u5230 uOP Cache \u5185\u90e8\uff0c\u540c\u65f6\u548c uBTB \u5b66\u4e60\u5230\u7684\u56fe\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5f53\u56fe\u4e2d\u5927\u90e8\u5206\u7684\u8fb9\u5bf9\u5e94\u7684\u6307\u4ee4\u90fd\u5df2\u7ecf\u88ab uOP Cache \u5b66\u4e60\u5230\uff0c\u8bf4\u660e uOP Cache \u5df2\u7ecf\u6355\u6349\u4e86\u5927\u90e8\u5206\u9700\u8981\u7684\u6307\u4ee4\uff0c\u8fdb\u5165 FetchMode</li> <li>FetchMode\uff1a\u6307\u4ee4\u7f13\u5b58\u548c\u8bd1\u7801\u90e8\u4ef6\u88ab\u5173\u95ed\uff0c\u8282\u7701\u529f\u8017\uff0c\u6240\u6709\u6307\u4ee4\u90fd\u4ece uOP Cache \u63d0\u4f9b\uff1b\u6b64\u65f6\u5982\u679c uBTB \u7684\u51c6\u786e\u7387\u5f88\u9ad8\uff0cmBTB \u4e5f\u53ef\u4ee5\u5173\u6389\uff0c\u8fdb\u4e00\u6b65\u8282\u7701\u529f\u8017\u3002\u5f53 uOP Cache \u547d\u4e2d\u7387\u964d\u4f4e\uff0c\u5207\u6362\u56de FilterMode</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u8fd8\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\uff0cuOP Cache \u548c Decoder \u4e0d\u4f1a\u540c\u65f6\u5de5\u4f5c\uff0c\u800c\u662f\u4e8c\u9009\u4e00\uff0c\u6839\u636e uOP Cache \u7684\u547d\u4e2d\u7387\u6765\u51b3\u5b9a\u8c01\u6765\u5de5\u4f5c\u3002\u7136\u540e\u8fdb\u4e00\u6b65\u4e3a\u4e86\u907f\u514d uOP Cache \u586b\u5145\u7684\u529f\u8017\uff0c\u5982\u679c uBTB \u53d1\u73b0\u8fd9\u4e9b\u4ee3\u7801\u653e\u4e0d\u4e0b uOP Cache \u4e2d\uff0c\u5c31\u4e0d\u586b\u5145 uOP Cache \u4e86\uff0c\u8fd9\u5c31\u662f FilterMode \u7684\u8bbe\u8ba1\u7684\u610f\u4e49\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#l1-\u6570\u636e\u9884\u53d6","title":"L1 \u6570\u636e\u9884\u53d6","text":"<p>L1 \u6570\u636e\u9884\u53d6\u5668\u4f1a\u68c0\u6d4b\u4e0d\u540c\u7684 stride\uff0c\u5728\u865a\u62df\u5730\u5740\u4e0a\uff0c\u8ddf\u8e2a\u8bbf\u5b58\u7684\u5386\u53f2\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8bc6\u522b\u8bbf\u5b58\u7684\u5e8f\u5217\uff0c\u7531\u4e8e\u8bbf\u5b58\u662f\u53ef\u4ee5\u4e71\u5e8f\u6267\u884c\u7684\uff0c\u5b83\u4f1a\u8fdb\u884c\u91cd\u6392\uff0c\u4f7f\u5f97\u8bbf\u5b58\u6a21\u5f0f\u7684\u8bc6\u522b\u770b\u5230\u5c31\u662f\u7a0b\u5e8f\u7684\u987a\u5e8f\u3002\u4e3a\u4e86\u9a8c\u8bc1\u9884\u53d6\u662f\u5426\u6b63\u786e\uff0c\u5728\u9884\u53d6\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u628a\u8fd9\u4e9b\u9884\u53d6\u7684\u5730\u5740\u8bb0\u5f55\u4e0b\u6765\uff0c\u653e\u5728 Confirmation Queue \u4e2d\uff0c\u548c\u672a\u6765\u7684 load \u5730\u5740\u505a\u6bd4\u5bf9\u3002\u5982\u679c\u9884\u53d6\u5668\u548c\u672a\u6765\u7684 load \u5339\u914d\u7684\u6bd4\u4f8b\u5f88\u9ad8\uff0c\u8bf4\u660e\u9884\u53d6\u5668\u5f88\u51c6\u786e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8ba9\u4ed6\u9884\u53d6\u3002\u5982\u679c\u51c6\u786e\u7387\u8f83\u4f4e\uff0c\u4e3a\u4e86\u907f\u514d\u6d6a\u8d39\u5185\u5b58\u5e26\u5bbd\uff0c\u5c31\u4f1a\u505c\u6b62\u9884\u53d6\u3002</p> <p>\u9664\u4e86 strided \u8bbf\u5b58\u6a21\u5f0f\uff0cExynos M3 \u8fd8\u5f15\u5165\u4e86 Spatial Memory Stream \u9884\u53d6\u5668\uff0c\u5b83\u4f1a\u8ddf\u8e2a\u4e00\u4e2a\u533a\u95f4\u7684\u7b2c\u4e00\u6b21 cache miss \u548c\u540e\u7eed\u7684 miss\uff0c\u5f53\u518d\u6b21\u9047\u5230\u7b2c\u4e00\u6b21 cache miss \u7684\u5730\u5740\u65f6\uff0c\u9884\u53d6\u540e\u7eed\u53ef\u80fd\u4f1a\u51fa\u73b0 miss \u7684\u5730\u5740\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#l2l3-\u7f13\u5b58","title":"L2/L3 \u7f13\u5b58","text":"<p>\u4e3a\u4e86\u51cf\u5c11\u6570\u636e\u7684\u91cd\u590d\uff0cL3 \u7f13\u5b58\u548c L1/L2 \u662f exclusive \u7684\u5173\u7cfb\uff0c\u6570\u636e\u662f\u4e92\u65a5\u7684\uff0c\u8981\u4e48\u5b58\u5728 L3 \u91cc\uff0c\u8981\u4e48\u5b58\u5728 L1/L2 \u91cc\uff0c\u8981\u4e48\u90fd\u4e0d\u5b58\u3002</p> <p>Exynos M4 \u9488\u5bf9 L2 \u7f13\u5b58\u5f15\u5165\u4e86 Buddy Prefetcher\uff1a\u5982\u679c\u4e00\u4e2a\u7f13\u5b58\u884c\u7f3a\u5931\u4e86\uff0c\u90a3\u5c31\u628a\u5b83\u76f8\u90bb\u7684\u4e0b\u4e00\u4e2a\u7f13\u5b58\u884c\u4e5f\u9884\u53d6\u8fdb\u6765\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#\u8bbf\u5b58\u5ef6\u8fdf","title":"\u8bbf\u5b58\u5ef6\u8fdf","text":"<p>Exynos \u7cfb\u5217\u7684 load to use latency \u901a\u5e38\u60c5\u51b5\u4e0b\u662f 4 cycle\uff0c\u4f46\u9488\u5bf9 load to load \u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u524d\u4e00\u4e2a load \u7684\u7ed3\u679c\uff0c\u4f5c\u4e3a\u540e\u4e00\u4e2a load \u7684\u57fa\u5730\u5740\u7684\u60c5\u51b5\uff0c\u4ece Exynos M4 \u5f00\u59cb\u53ef\u4ee5\u505a\u5230 3 cycle \u7684 load to use latency\uff0c\u8fd9\u5728\u8bba\u6587\u4e2d\u53eb\u505a cascading load\u3002\u8fd9\u4e2a 4 cycle \u51cf\u5230 3 cycle \u7684\u7279\u6027\u5728\u82f9\u679c\uff0c\u9ad8\u901a\u548c Intel\uff08E-core\uff09\u7684 CPU \u4e2d\u90fd\u6709\u770b\u5230\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2024/09/10/samsung-exynos-cpu/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u867d\u7136 Exynos \u7cfb\u5217\u5fae\u67b6\u6784\u7684\u82af\u7247\u6ca1\u6709\u65b0\u7684\u6f14\u8fdb\u4e86\uff0c\u4f46\u662f\u4e5f\u975e\u5e38\u611f\u8c22\u8fd9\u4e9b\u4f5c\u8005\u6177\u6168\u5730\u4ecb\u7ecd\u4e86\u4ed6\u4eec\u8fd9\u4e9b\u5e74\u4f18\u5316\u5fae\u67b6\u6784\u7684\u52aa\u529b\uff0c\u63d0\u4f9b\u4e86\u5f88\u591a\u6709\u4ef7\u503c\u7684\u4fe1\u606f\u3002\u4ece\u4f5c\u8005\u4fe1\u606f\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u65f6\u5f00\u53d1 Exynos \u7684\u56e2\u961f\u6210\u5458\uff0c\u5728\u56e2\u961f\u89e3\u6563\u4ee5\u540e\uff0c\u53bb\u7684\u57fa\u672c\u4e5f\u662f\u6709\u81ea\u7814\u6838\u7684\u516c\u53f8\uff1aSifive\uff0cCentaur\uff0cARM\uff0cAMD\uff0cNuvia\u3002</p> <p>\u7531\u4e8e\u672c\u4eba\u5bf9 DCache \u4ee5\u53ca Prefetch \u90e8\u5206\u7f3a\u4e4f\u6df1\u5165\u4e86\u89e3\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u4ecb\u7ecd\u6bd4\u8f83\u5c11\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u5efa\u8bae\u53c2\u8003\u539f\u6587\u3002</p>","tags":["cpu","microarchitecture","samsung","exynos","arm"]},{"location":"hardware/2020/02/10/simulate-chisel3-on-vivado/","title":"\u5728 Vivado \u4e2d\u5bf9 chisel3 \u4ea7\u751f\u7684 verilog \u4ee3\u7801\u4eff\u771f","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cchisel3 \u751f\u6210\u7684 verilog \u4ee3\u7801\u5728 Vivado \u4e2d\u4eff\u771f\u4f1a\u51fa\u73b0\u5f88\u591a\u4fe1\u53f7\u5927\u9762\u79ef\u53d8\u6210 X\u3002\u89e3\u51b3\u65b9\u6cd5\u5728\u4e00\u4e2a\u4e0d\u8d77\u773c\u7684 Wiki \u9875\u9762\uff1aRandomization flags\uff1a</p> <pre><code>`define RANDOMIZE_REG_INIT\n`define RANDOMIZE_MEM_INIT\n`define RANDOMIZE_GARBAGE_ASSIGN\n`define RANDOMIZE_INVALID_ASSIGN\n</code></pre> <p>\u5728\u751f\u6210\u7684 verilog \u524d\u9762\u52a0\u4e0a\u8fd9\u56db\u53e5\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u4eff\u771f\u4e86\u3002</p>","tags":["vivado","chisel","verilog"]},{"location":"hardware/2021/01/26/skid-buffer/","title":"Skid Buffer","text":"","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#skid-buffer_1","title":"Skid buffer","text":"<p>Skid buffer \u6307\u7684\u5c31\u662f\uff0c\u5bf9\u4e8e valid + ready \u7684\u63e1\u624b\u4fe1\u53f7\uff0c\u7528\u7a7a\u95f4\uff08\u66f4\u591a\u7684\u903b\u8f91\uff09\u6765\u6362\u53d6\u65f6\u95f4\uff08\u66f4\u597d\u7684\u65f6\u5e8f\uff09\u7684\u4e00\u4e2a\u786c\u4ef6\u6a21\u5757\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u80cc\u666f\u5c31\u662f\uff0c\u4e3a\u4e86\u89e3\u51b3 valid \u548c ready \u4fe1\u53f7\u5728\u6570\u636e\u6d41\u6c34\u7ebf\u4e0a\u4e00\u8def\u7ecf\u8fc7\u7ec4\u5408\u903b\u8f91\u5bfc\u81f4\u7684\u65f6\u5e8f\u95ee\u9898\uff0c\u5728\u4e2d\u9014\u52a0\u4e0a\u4e00\u4e9b\u5bc4\u5b58\u5668\u6765\u963b\u9694\u3002\u5f53\u7136\u4e86\uff0c\u4ee3\u4ef7\u5c31\u662f\u5ef6\u8fdf\u548c\u9762\u79ef\uff0c\u4e0d\u8fc7\u541e\u5410\u91cf\u8fd8\u662f\u9700\u8981\u4fdd\u6301\u7684\u3002</p> <p>\u7531\u4e8e\u9700\u6c42\u7684\u4e0d\u540c\uff0cSkid buffer \u4e5f\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\u3002\u76ee\u524d\uff0c\u627e\u5230\u4e86\u56db\u4e2a\u5b9e\u73b0\uff0c\u5b9e\u73b0\u4e0a\u6709\u6240\u4e0d\u540c\uff0c\u7279\u6027\u4e5f\u4e0d\u5927\u4e00\u6837\u3002</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#\u7edf\u4e00\u7ea6\u5b9a","title":"\u7edf\u4e00\u7ea6\u5b9a","text":"<p>\u7531\u4e8e\u6211\u5728 SpinalHDL \u8bed\u8a00\u4e2d\u91cd\u65b0\u5b9e\u73b0\u4e86\u4e0b\u9762\u7684\u8fd9\u4e9b Skid buffer\uff0c\u6240\u4ee5\u6309\u7167 SpinalHDL \u7684 Stream \u5b9a\u4e49\u63a5\u53e3\uff1a</p> <pre><code>class SkidBufferCommon[T &lt;: Data](\n    gen: =&gt; T\n) extends Component {\n  val io = new Bundle {\n    val s = slave(Stream(gen))\n    val m = master(Stream(gen))\n  }\n}\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c<code>io.s</code> \u8868\u793a\u4ece\u4e0a\u6e38\u53d6\u7684\u6570\u636e\uff0c<code>io.m</code> \u8868\u793a\u4f20\u9012\u7ed9\u4e0b\u6e38\u7684\u6570\u636e\u3002</p> <p>\u8f93\u51fa\u4fe1\u53f7\u5171\u6709\uff1a<code>io.s.ready</code>\u3001<code>io.m.valid</code> \u548c <code>io.m.payload</code>\u3002</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#zipcpu-\u7248\u672c","title":"ZipCPU \u7248\u672c","text":"<p>\u7b2c\u4e00\u4e2a\u7248\u672c\u6765\u81ea ZipCPU\uff1a</p> <p>\u535a\u5ba2\u5730\u5740\uff1aBuilding a Skid Buffer for AXI processing \u4ee3\u7801\u5730\u5740\uff1askidbuffer.v</p> <p>\u5b83\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u8868\u793a\u662f\u5426\u6709\u989d\u5916\u7684\u8f93\u51fa\u5bc4\u5b58\u5668\uff08outputReg\uff09\uff0c\u4e00\u4e2a\u8868\u793a\u662f\u5426\u4f4e\u529f\u8017\uff08lowPower\uff09\u3002</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#fpgacpu-\u7248\u672c","title":"FPGACPU \u7248\u672c","text":"<p>\u7b2c\u4e8c\u4e2a\u7248\u672c\u6765\u81ea FPGACPU\uff1a</p> <p>\u6587\u7ae0\u5730\u5740\uff1aPipeline Skid Buffer</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#spinalhdl-s2m-\u7248\u672c","title":"SpinalHDL S2M \u7248\u672c","text":"<p>\u7b2c\u4e09\u4e2a\u7248\u672c\u6765\u81ea SpinalHDL Library \u7684 s2mPipe\uff1a</p> <p>\u4ee3\u7801\u5730\u5740\uff1aStream.scala L348</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#spinalhdl-m2s-\u7248\u672c","title":"SpinalHDL M2S \u7248\u672c","text":"<p>\u7b2c\u56db\u4e2a\u7248\u672c\u6765\u81ea SpinalHDL Library \u7684 m2sPipe\uff1a</p> <p>\u4ee3\u7801\u5730\u5740\uff1aStream.scala L327</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#\u56db\u4e2a\u7248\u672c\u7684\u5bf9\u6bd4","title":"\u56db\u4e2a\u7248\u672c\u7684\u5bf9\u6bd4","text":"<p>\u5728\u7814\u7a76\u4e86\u4ee3\u7801\u4ee5\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u56db\u4e2a\u7248\u672c\u7684\u533a\u522b\uff1a</p> \u7248\u672c ZipCPU w/ outputReg ZipCPU w/o outputReg FPGACPU S2M M2S io.s.ready Reg Reg Reg Reg Comb io.m.valid Reg Comb Reg Comb Reg io.m.payload Reg Comb Reg Comb Reg latency 1 0 1 0 1 buffer \u6570\u91cf 1 1 2 1 1 <p>\u6ce8\uff1a</p> <ol> <li>Reg \u8868\u793a\u4ece\u5bc4\u5b58\u5668\u8f93\u51fa\uff0cComb \u8868\u793a\u4ece\u7ec4\u5408\u903b\u8f91\u8f93\u51fa</li> <li>Latency \u8868\u793a\u4ece <code>io.s.fire</code> \u5230 <code>io.m.fire</code> \u7684\u5ef6\u8fdf</li> <li>Buffer \u8868\u793a\u7f13\u51b2\u7684 payload \u4e2a\u6570</li> <li>ZipCPU w/o outputReg \u548c S2M \u5b9e\u73b0\u7684\u903b\u8f91\u662f\u4e00\u6837\u7684</li> </ol>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2021/01/26/skid-buffer/#\u5f62\u5f0f\u5316\u9a8c\u8bc1","title":"\u5f62\u5f0f\u5316\u9a8c\u8bc1","text":"<p>\u4e3a\u4e86\u786e\u8ba4\u4e0a\u9762\u8fd9\u4e9b\u7c7b\u578b\u7684 Skid Buffer \u90fd\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u6309\u7167 ZipCPU Skid Buffer \u7684\u6587\u7ae0\uff0c\u4e5f\u7167\u7740\u5199\u4e86\u51e0\u4e2a property\uff1a</p> <p>1: \u5728 valid &amp;&amp; ~ready \u7684\u65f6\u5019\uff0cvalid \u9700\u8981\u7ee7\u7eed\u4fdd\u6301\u4e3a\u9ad8\uff0c\u5e76\u4e14 payload \u4e0d\u53d8\uff1a</p> <pre><code>// When valid goes high, data is stable and valid stays high before ready\nwhen(past(stream.valid &amp;&amp; ~stream.ready &amp;&amp; ~outerReset)) {\n    slaveAssume(stream.valid);\n    if (dataStable) {\n        slaveAssume(stable(stream.payload.asBits));\n    }\n}\n</code></pre> <p>2: \u5728 reset \u91ca\u653e\u7684\u7b2c\u4e00\u4e2a\u5468\u671f\u91cc\uff0cvalid \u4e0d\u80fd\u4e3a\u9ad8\uff1a</p> <p>\u53c2\u8003 AXI \u6807\u51c6 (IHI0022E Page 38 A3.1.2) \u539f\u6587\uff1a</p> <pre><code>The earliest point after reset that a master is permitted to begin driving ARVALID, AWVALID, or WVALID HIGH is at a rising ACLK edge after ARESETn is HIGH.\n</code></pre> <pre><code>// Valid is low in the first cycle after reset falls\nwhen(pastValid &amp;&amp; past(outerReset) &amp;&amp; ~outerReset) {\n    slaveAssume(~stream.valid);\n}\n</code></pre> <p>3: \u6dfb\u52a0 cover property\uff0c\u8981\u6c42 <code>io.s</code> \u548c <code>io.m</code> \u53ef\u4ee5\u8fde\u7eed\u82e5\u5e72\u4e2a\u5468\u671f valid &amp;&amp; ready\uff0c\u4fdd\u8bc1\u541e\u5410\u7387\uff1a</p> <pre><code>cover(\n    pastValid &amp;&amp; genPast(pastValid, null, cycles) &amp;&amp; genPast(\n        ~outerReset,\n        null,\n        cycles\n    ) &amp;&amp; genPast(stream.fire, payload, cycles)\n)\n</code></pre> <p>\u91c7\u7528 <code>yosys-smtbmc</code> \u5de5\u5177\u9a8c\u8bc1\u4e86\u4ee5\u4e0a\u56db\u79cd Skid buffer \u90fd\u6ee1\u8db3\u8fd9\u4e9b\u5c5e\u6027\u3002</p>","tags":["hdl","pipeline","spinalhdl","skid","buffer","register"]},{"location":"hardware/2023/04/26/spi/","title":"SPI \u534f\u8bae","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u6570\u8bbe\u8bfe\u4e0a\uff0c\u540c\u5b66\u4eec\u5f00\u59cb\u8d2d\u4e70\u5916\u8bbe\uff0c\u5176\u4e2d\u5c31\u6d89\u53ca\u5230 SPI \u534f\u8bae\uff0c\u56e0\u6b64\u987a\u5e26\u5199\u4e00\u4e0b SPI \u534f\u8bae\u7684\u6559\u7a0b\uff0c\u5e2e\u52a9\u540c\u5b66\u4eec\u8fdb\u884c\u7406\u89e3\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#\u63a5\u53e3","title":"\u63a5\u53e3","text":"<p>SPI \u534f\u8bae\u6d89\u53ca\u5230\u56db\u4e2a\u4fe1\u53f7\uff1a</p> <ul> <li>SCLK: \u65f6\u949f\u4fe1\u53f7\uff0cMaster -&gt; Slave</li> <li>MOSI\uff1a\u6570\u636e\u4fe1\u53f7\uff0cMaster -&gt; Slave</li> <li>MISO\uff1a\u6570\u636e\u4fe1\u53f7\uff0cSlave -&gt; Master</li> <li>CS\uff1a\u82af\u7247\u4f7f\u80fd\uff0c\u4e00\u822c\u662f\u4f4e\u6709\u6548</li> </ul> <p>\u8981\u901a\u8fc7 SPI \u534f\u8bae\u53d1\u9001\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u901a\u5e38\u9700\u8981\u5148\u62c9\u4f4e CS\uff0c\u7136\u540e\u542f\u52a8 SCLK \u65f6\u949f\uff0c\u540c\u65f6\u6536\u53d1\u6570\u636e\u3002\u6ce8\u610f SPI \u662f\u5168\u53cc\u5de5\u7684\uff0c\u4e5f\u5c31\u662f\u53d1\u9001\u7684\u540c\u65f6\u4e5f\u5728\u63a5\u6536\uff0c\u53ea\u4e0d\u8fc7\u901a\u5e38\u6765\u8bf4\uff0c\u5916\u8bbe\u7b49\u5230\u4e3b\u673a\u53d1\u9001\u4e86\u547d\u4ee4\u672c\u8eab\uff0c\u624d\u77e5\u9053\u8981\u56de\u590d\u4ec0\u4e48\uff0c\u6240\u4ee5\u5f88\u591a\u65f6\u5019\u547d\u4ee4\u8bbe\u8ba1\u6210\u4e86\u4e8b\u5b9e\u4e0a\u7684\u534a\u53cc\u5de5\uff1a\u524d\u534a\u90e8\u5206\u4e3b\u673a\u5728\u53d1\u547d\u4ee4\uff0c\u5916\u8bbe\u53d1\u9001\u65e0\u7528\u7684\u6570\u636e\uff1b\u540e\u534a\u90e8\u5206\u5916\u8bbe\u5728\u53d1\u9001\u54cd\u5e94\uff0c\u4e3b\u673a\u53d1\u9001\u65e0\u7528\u7684\u6570\u636e\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#\u6ce2\u5f62","title":"\u6ce2\u5f62","text":"<p>SPI \u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u4e0b\u9762\u8bb2\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u914d\u7f6e\uff08\u5373 CPOL=0\uff0cCPHA=0\uff09\uff0c\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0cMaster \u548c Slave \u90fd\u662f\u5728\u65f6\u949f\u7684\u4e0b\u964d\u6cbf\u4fee\u6539\u8f93\u51fa\u7684\u6570\u636e\uff0c\u7136\u540e\u5728\u65f6\u949f\uff08<code>sclk</code>\uff09\u7684\u4e0a\u5347\u6cbf\u5bf9\u63a5\u6536\u5230\u7684\u6570\u636e\u8fdb\u884c\u91c7\u6837\uff1a</p> <p>\u6ce2\u5f62\u56fe\u4e2d\uff0c\u65f6\u949f\uff08<code>sclk</code>\uff09\u4e0a\u5347\u6cbf\u65f6\uff0c\u6570\u636e\u5904\u4e8e\u7a33\u5b9a\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u6b64\u65f6 Master \u5bf9 MISO \u91c7\u6837\uff0cSlave \u5bf9 MOSI \u91c7\u6837\uff0c\u53ef\u4ee5\u5f97\u5230\u7a33\u5b9a\u7684\u6570\u636e\uff1b\u65f6\u949f\u4e0b\u964d\u6cbf\u65f6\uff0cMaster \u548c Slave \u4fee\u6539\u8f93\u51fa\u7684\u6570\u636e\u3002</p> <p>\u5b9e\u9645\u5728 RTL \u4e2d\u5b9e\u73b0\u7684\u65f6\u5019\uff0cMaster \u53ef\u4ee5\u4e0d\u5199 negedge \u903b\u8f91\uff0c\u800c\u662f\u5199\u4e00\u4e2a\u5206\u9891\u5668\uff0c\u5728\u5206\u9891\u51fa\u6765\u7684\u8d1f\u534a\u5468\u671f\u91cc\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u4fee\u6539\uff0c\u5982\u4e0a\u56fe\u4e2d\u7684 <code>clk</code> \u5206\u9891\u5230 <code>sclk</code>\u3002\u4e00\u822c\u4f7f\u7528\u4e00\u4e2a\u72b6\u6001\u673a\u6765\u5b9e\u73b0 SPI Master\uff0c\u8bb0\u5f55\u5f53\u524d\u4f20\u8f93\u5230\u54ea\u4e00\u4e2a bit\uff0c\u4ee5\u53ca\u8bb0\u5f55\u5f53\u524d\u662f <code>sclk</code> \u7684\u6b63\u534a\u5468\u671f\u8fd8\u662f\u8d1f\u534a\u5468\u671f\u3002</p> <p>SPI \u672c\u8eab\u5f88\u7b80\u5355\uff0c\u6240\u4ee5\u6838\u5fc3\u4e0d\u5728 SPI\uff0c\u800c\u662f\u5728 SPI \u4e4b\u4e0a\u5b9a\u4e49\u7684\u5404\u79cd\u534f\u8bae\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-flash","title":"SPI Flash","text":"<p>SPI Flash \u662f\u4e00\u79cd\u5f88\u5e38\u89c1\u7684 SPI \u5916\u8bbe\uff0c\u53ef\u4ee5\u7528\u6765\u8bbf\u95ee NAND/NOR Flash\u3002</p> <p>\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\uff0c\u5f88\u591a SPI Flash \u8fd8\u4f1a\u63d0\u4f9b Dual SPI \u548c Quad SPI \u6a21\u5f0f\u3002\u6807\u51c6\u7684 SPI \u4e2d\uff0cMaster \u5230 Slave \u548c Slave \u5230 Master \u5206\u522b\u662f\u4e00\u6839\u4fe1\u53f7\u7ebf\uff0c\u5982\u679c\u8981\u7ee7\u7eed\u63d0\u9ad8\u6027\u80fd\uff0c\u90a3\u5c31\u8981\u5f15\u5165\u66f4\u591a\u7684\u4fe1\u53f7\u7ebf\u6765\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u6240\u4ee5 Dual SPI \u5c31\u662f\u8ba9\u539f\u6765\u7684 MISO \u548c MOSI \u90fd\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u6570\u636e\uff1bQuad SPI \u5219\u662f\u53c8\u989d\u5916\u6dfb\u52a0\u4e86\u4e24\u4e2a\u4fe1\u53f7\u7ebf\u6765\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002</p> <p>\u5e38\u89c1\u7684 SPI Flash \u5382\u5bb6\uff1a</p> <ul> <li>Spansion -&gt; Cypress -&gt; Infineon</li> <li>Numonyx -&gt; Micron</li> <li>Winbond</li> <li>GigaDevice</li> <li>Macronix</li> </ul>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-nand-flash","title":"SPI NAND Flash","text":"<p>\u4e0b\u9762\u4ee5 Alliance Memory SPI NAND Flash Datasheet \u4e3a\u4f8b\u5b50\uff0c\u770b\u770b\u901a\u5e38 SPI Flash \u90fd\u652f\u6301\u54ea\u4e9b\u547d\u4ee4\uff0c\u90fd\u662f\u5982\u4f55\u4f20\u8f93\u6570\u636e\u7684\u3002</p> <p>\u8fd9\u6b3e SPI NAND Flash \u7684\u5185\u90e8\u5b58\u50a8\u5206\u4e3a\u4e09\u5c42\uff1a</p> <ol> <li>Block\uff1a\u6570\u91cf\u4e0d\u5b9a</li> <li>Page\uff1a\u6bcf\u4e2a Block \u5305\u62ec 64 \u4e2a Page</li> <li>Byte\uff1a\u6bcf\u4e2a Page \u5305\u62ec\u4e00\u5b9a\u6570\u91cf\u7684 Byte\uff0c\u5e38\u89c1\u7684\u6709 2112(2048+64)\u30012176(2048+128)\u30014352(4096+256)</li> </ol> <p>NAND Flash \u7684\u8bfb\u53d6\u7c92\u5ea6\u662f Page\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 NAND Flash \u66f4\u50cf\u5757\u8bbe\u5907\u3002\u4e00\u6b21\u8bfb\u53d6\u8fc7\u7a0b\u5206\u4e3a\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u53d1\u9001 13H(Page Read to Cache) \u547d\u4ee4\uff0c\u628a\u4e00\u4e2a Page \u7684\u6570\u636e\u8bfb\u53d6\u5230 NAND Flash \u5185\u90e8\u7684 Cache \u4e2d</li> <li>\u4e0d\u65ad\u53d1\u9001 0FH(Get Feature) \u547d\u4ee4\uff0c\u76f4\u5230 NAND Flash \u8868\u793a Page Read to Cache \u547d\u4ee4\u5b8c\u6210</li> <li>\u53d1\u9001 Read from Cache \u547d\u4ee4\uff0c\u8003\u8651\u5230\u4f20\u8f93\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a<ol> <li>Read from Cache x1 IO(03H/0BH): Master \u7ed9\u51fa 1 \u5b57\u8282\u547d\u4ee4\uff0c2 \u5b57\u8282\u5730\u5740\u548c 1 \u5b57\u8282 dummy \u6570\u636e\uff0c\u5171 8(COMMAND)+16(ADDR)+8(DUMMY) \u4e2a\u5468\u671f\uff0c\u4e4b\u540e Slave \u4ece MISO \u7ed9\u51fa\u6570\u636e</li> <li>Read from Cache x2 IO(3BH): Slave \u540c\u65f6\u901a\u8fc7 MISO \u548c MOSI \u7ed9\u51fa\u6570\u636e</li> <li>Read from Cache x4 IO(6BH): Slave \u540c\u65f6\u901a\u8fc7 MISO\u3001MOSI\u3001WP# \u548c HOLD# \u7ed9\u51fa\u6570\u636e</li> <li>Read from Cache Dual IO(BBH): \u5728 3BH \u7684\u57fa\u7840\u4e0a\uff0cMaster \u4e5f\u540c\u65f6\u901a\u8fc7 MISO \u548c MOSI \u7ed9\u51fa\u5730\u5740\u548c dummy \u5b57\u8282\uff0c\u6240\u4ee5 Master \u53ea\u5360\u7528 8(COMMAND)+8(ADDR)+4(DUMMY) \u4e2a\u5468\u671f\u7684\u65f6\u95f4\u53d1\u9001</li> <li>Read from Cache Quad IO(EBH): \u5728 6BH \u7684\u57fa\u7840\u4e0a\uff0cMaster \u4e5f\u540c\u65f6\u901a\u8fc7\u56db\u4e2a\u6570\u636e\u4fe1\u53f7\u7ed9\u51fa\u5730\u5740\u548c dummy \u5b57\u8282\uff0c\u6240\u4ee5 Master \u53ea\u5360\u7528 8(COMMAND)+4(ADDR)+2(DUMMY) \u4e2a\u5468\u671f\u7684\u65f6\u95f4\u53d1\u9001</li> </ol> </li> </ol> <p>\u5199\u5165\u7684\u65f6\u5019\uff0c\u7531\u4e8e NAND Flash \u7684\u7279\u6027\uff0c\u9996\u5148\u9700\u8981\u64e6\u9664\uff0c\u628a\u4e00\u4e2a Block \u7684\u5185\u5bb9\u5168\u90e8\u64e6\u9664\uff0c\u9700\u8981\u6ce8\u610f\u6bcf\u4e2a Block \u5305\u62ec\u591a\u4e2a Page\uff0c\u6240\u4ee5\u64e6\u9664\u7684\u7c92\u5ea6\u662f\u5f88\u7c97\u7684\u3002\u64e6\u9664\u8fc7\u7684 Page \u624d\u53ef\u4ee5\u8fdb\u884c\u5199\u5165\uff0c\u5177\u4f53\u6b65\u9aa4\u662f\uff1a</p> <ol> <li>\u53d1\u9001 06H(Write Enable) \u5141\u8bb8\u5199\u5165</li> <li>\u53d1\u9001 02H(Program Load) \u6216 32H(Program Load x4) \u628a\u8981\u5199\u5165\u7684\u6570\u636e\u4f20\u8f93\u7ed9 NAND Flash \u4e2d\u7684 Cache\uff1b02H \u548c 32H \u7684\u533a\u522b\u5c31\u662f\u540e\u8005\u540c\u65f6\u5728\u56db\u4e2a\u4fe1\u53f7\u7ebf\u4e0a\u4f20\u8f93\u6570\u636e</li> <li>\u53d1\u9001 10H(Program Execute) \u8fdb\u884c\u5b9e\u9645\u7684\u5199\u5165\u64cd\u4f5c\uff0c\u4ece Cache \u5230 Flash \u5b58\u50a8</li> <li>\u4e0d\u65ad\u53d1\u9001 0FH(Get Feature) \u547d\u4ee4\uff0c\u76f4\u5230 Program Execute \u64cd\u4f5c\u5b8c\u6210</li> </ol>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-nor-flash","title":"SPI NOR Flash","text":"<p>NOR Flash \u548c NAND Flash \u7684\u533a\u522b\u5728\u4e8e\uff0cNOR Flash \u53ef\u4ee5\u968f\u673a\u8bbf\u95ee\uff0c\u53ef\u4ee5\u63d0\u4f9b XIP \u652f\u6301\u3002\u4e0b\u9762\u4ee5 128Mb, 3V, Multiple I/O Serial Flash Memory \u4e3a\u4f8b\u5b50\u770b\u770b\u5b83\u662f\u5982\u4f55\u8bfb\u5199\u7684\u3002</p> <p>SPI NOR Flash \u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u4e00\u6761\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86\uff1aREAD/FAST READ\u3002\u5176\u4e2d READ \u547d\u4ee4\u6bd4\u8f83\u7b80\u5355\uff1a\u53d1\u9001 Command\uff0c\u53d1\u9001\u5730\u5740\uff0c\u7136\u540e Slave \u7d27\u63a5\u7740\u5c31\u4f1a\u53d1\u9001\u6570\u636e\uff1bFAST READ \u53ef\u4ee5\u8fbe\u5230\u66f4\u9ad8\u7684\u9891\u7387\uff0c\u4f46\u662f\u4e3a\u4e86\u8ba9 NOR Flash \u6709\u65f6\u95f4\u8bfb\u53d6\u6570\u636e\uff0c\u5728 Master \u53d1\u9001 Command \u548c\u5730\u5740\u540e\uff0c\u8fd8\u9700\u8981\u53d1\u9001 Dummy cycles\uff0c\u7136\u540e Slave \u624d\u4f1a\u53d1\u9001\u6570\u636e\u3002\u548c\u524d\u9762\u4e00\u6837\uff0cFAST READ \u4e5f\u652f\u6301\u4e0d\u540c\u7684 IO \u7c7b\u578b\uff0c\u4f8b\u5982 Dual Output\uff0cDual Input/Output\uff0cQuad Output\uff0cQuad Input/Output\u3002\u4e00\u4e9b\u6bd4\u8f83\u9ad8\u7aef\u7684 SPI NOR Flash \u8fd8\u652f\u6301 DTR\uff08Double Transfer Rate\uff09\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f DDR\uff0c\u5728\u65f6\u949f\u4e0a\u5347\u6cbf\u548c\u4e0b\u964d\u6cbf\u90fd\u91c7\u6837\u6570\u636e\u3002</p> <p>\u5199\u5165\u7684\u65f6\u5019\uff0c\u548c NAND Flash \u4e00\u6837\uff0c\u4e5f\u9700\u8981\u5148\u64e6\u9664\uff0c\u518d\u5199\u5165\u3002SPI Flash \u7684\u5b58\u50a8\u5c42\u7ea7\u662f\uff1a</p> <ol> <li>Sector</li> <li>Subsector</li> <li>Page</li> <li>Byte</li> </ol> <p>\u64e6\u9664\u7684\u7c92\u5ea6\u662f Sector \u6216\u8005 Subsector\uff0c\u5199\u5165\u7684\u7c92\u5ea6\u662f Page\u3002\u5199\u5165\u7684\u65f6\u5019\uff0c\u4e5f\u9700\u8981\u9996\u5148\u53d1\u9001 WRITE ENABLE \u547d\u4ee4\uff0c\u518d\u53d1\u9001 PAGE PROGRAM \u547d\u4ee4\u3002NOR Flash \u5728 Program \u4e0a\u4e5f\u6bd4\u8f83\u7b80\u5316\uff0c\u76f4\u63a5 Program \u5373\u53ef\uff0c\u4e0d\u9700\u8981\u5148\u5199\u5165\u5230 Cache\uff0c\u518d\u8fdb\u884c Program\u3002</p> <p>NOR Flash \u8fd8\u63d0\u4f9b\u4e86 XIP Mode \u6765\u52a0\u5feb\u968f\u673a\u8bbf\u95ee\uff1a\u542f\u7528 XIP \u6a21\u5f0f\u540e\uff0c\u7ed9\u51fa\u4e00\u4e2a\u5730\u5740\uff0c\u7b49\u5f85 Dummy cycles \u540e\uff0c\u5c31\u53ef\u4ee5\u8bfb\u51fa\u6570\u636e\uff0c\u4e0d\u9700\u8981\u50cf\u524d\u9762\u90a3\u6837\u53d1\u9001 COMMAND\uff0c\u51cf\u5c11\u4e86\u5ef6\u8fdf\u3002\u5f53\u7136\u4e86\uff0c\u5373\u4f7f\u4e0d\u6253\u5f00 NOR Flash \u7684 XIP Mode\uff0c\u4e5f\u53ef\u4ee5\u5728 SPI \u63a7\u5236\u5668\u91cc\u5b9e\u73b0 XIP\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u6b21\u8bfb\u53d6\u90fd\u8981\u53d1\u4e00\u6b21 READ \u547d\u4ee4\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-eeprom","title":"SPI EEPROM","text":"<p>SPI EEPROM \u548c SPI NOR Flash \u6bd4\u8f83\u7c7b\u4f3c\uff0c\u4f46\u662f EEPROM \u66f4\u5c0f\uff0c\u4e5f\u66f4\u52a0\u7b80\u5355\uff0c\u4f8b\u5982\u5199\u5165\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u64e6\u9664\u3002\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u5728 SPI \u4e32\u884c EEPROM \u7cfb\u5217\u6570\u636e\u624b\u518c \u4e2d\u67e5\u770b\u547d\u4ee4\u5217\u8868\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#sd-\u5361","title":"SD \u5361","text":"<p>SD \u5361\u9664\u4e86 SD Bus \u4ee5\u5916\uff0c\u8fd8\u652f\u6301 SPI \u6a21\u5f0f\uff08\u6700\u65b0\u7684 SDUC \u4e0d\u652f\u6301 SPI \u6a21\u5f0f\uff09\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u7528 SPI \u6765\u8bfb\u5199 SD \u5361\u3002</p> <p>SD \u5361\u6bd4\u8f83\u7279\u522b\u7684\u4e00\u70b9\u662f\uff0c\u5b83\u9700\u8981\u6bd4\u8f83\u590d\u6742\u7684\u521d\u59cb\u5316\u6d41\u7a0b\uff1a</p> <ol> <li>\u9996\u5148\u8981\u53d1\u9001 CMD0 \u547d\u4ee4\uff0c\u540c\u65f6 CS \u62c9\u4f4e\uff0c\u4f7f\u5f97 SD \u5361\u8fdb\u5165 SPI \u6a21\u5f0f</li> <li>\u5bf9\u4e8e SDHC SD \u5361\uff0c\u9700\u8981\u53d1\u9001 CMD8 \u6765\u534f\u5546\u5de5\u4f5c\u7535\u538b\u8303\u56f4</li> <li>\u91cd\u590d\u53d1\u9001 ACMD41 \u547d\u4ee4\uff08CMD55 + CMD41 = ACMD41\uff09\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u76f4\u5230 SD \u5361\u56de\u590d\u521d\u59cb\u5316\u5b8c\u6210</li> <li>\u53d1\u9001 CMD58 \u547d\u4ee4\u4ee5\u8bfb\u53d6 OCR \u5bc4\u5b58\u5668\u7684\u503c</li> </ol> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\u547d\u4ee4\u7684\u4f20\u8f93\u65b9\u5f0f\u3002\u6bcf\u4e2a\u547d\u4ee4\u6709\u4e00\u4e2a 6 \u4f4d\u7684\u547d\u4ee4\u7f16\u53f7\uff0c\u4f8b\u5982 CMD0 \u7684\u7f16\u53f7\u5c31\u662f 0\uff0cCMD55 \u7684\u7f16\u53f7\u5c31\u662f 55\uff1b\u8fd8\u5e26\u6709\u56db\u5b57\u8282\u7684\u53c2\u6570\u3002\u6bcf\u4e2a\u547d\u4ee4\u4f1a\u7ec4\u88c5\u6210\u4e00\u4e2a 48 \u4f4d\u7684\u5206\u7ec4\uff1a</p> <ol> <li>bit[47]=0: Start Bit</li> <li>bit[46]=1: Transmission Bit</li> <li>bit[45:40]: Command Index</li> <li>bit[39:8]: Argument</li> <li>bit[7:1]: CRC7</li> <li>bit[0]=1: End Bit</li> </ol> <p>\u53ef\u89c1\u989d\u5916\u591a\u4e86\u4e00\u4e2a CRC7 \u7684\u6821\u9a8c\u548c\u3002</p> <p>SD \u5361\u89c4\u5b9a\uff0cSPI \u6a21\u5f0f\u4e0b\uff0c\u6240\u6709\u7684\u6570\u636e\u4f20\u8f93\u90fd\u662f\u5bf9\u9f50\u5230 8 \u4f4d\uff0c\u4e5f\u5c31\u662f\u4ece CS \u62c9\u4f4e\u5f00\u59cb\u7b97\uff0c\u6bcf 8 \u4e2a\u65f6\u949f\u4e0a\u5347\u6cbf\u662f\u4e00\u4e2a\u5b57\u8282\uff0c\u65e0\u8bba\u547d\u4ee4\u8fd8\u662f\u54cd\u5e94\uff0c\u90fd\u5728 8 \u4f4d\u7684\u8fb9\u754c\u4e0a\u4f20\u8f93\u3002</p> <p>\u60f3\u8981\u8bfb\u53d6\u6570\u636e\u7684\u8bdd\uff0c\u5c31\u8981\u53d1\u9001 READ_SINGLE_BLOCK \u547d\u4ee4\uff0c\u53c2\u6570\u5c31\u662f\u8981\u8bfb\u53d6\u7684 Block \u5730\u5740\u3002SD \u5361\u56de\u5148\u56de\u590d\u4e00\u4e2a\u5b57\u8282\u7684\u54cd\u5e94\uff0c\u7136\u540e\u5f00\u59cb\u53d1\u6570\u636e\uff0c\u6570\u636e\u4ece Start Block Token \u5f00\u59cb\uff0c\u7136\u540e\u662f\u4e00\u4e2a Block \u7684\u6570\u636e\uff08\u901a\u5e38\u662f 512 \u5b57\u8282\uff09\uff0c\u6700\u540e\u518d\u4e24\u4e2a\u5b57\u8282\u7684 CRC16\u3002</p> <p>\u5199\u6570\u636e\u5219\u662f\u53d1\u9001 WRITE_BLOCK \u547d\u4ee4\uff0cSD \u5361\u56de\u590d\u4e00\u4e2a\u5b57\u8282\u7684\u54cd\u5e94\uff0c\u7136\u540e\u63a7\u5236\u5668\u5f00\u59cb\u4f20\u8f93\u6570\u636e\uff0c\u6570\u636e\u4ece Start Block Token \u5f00\u59cb\uff0c\u63a5\u7740\u662f\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u6700\u540e\u662f\u4e24\u4e2a\u5b57\u8282\u7684 CRC16\uff0c\u7136\u540e SD \u5361\u56de\u590d\u4e00\u4e2a\u5b57\u8282\u7684\u54cd\u5e94\uff0c\u6807\u5fd7\u7740\u5199\u5165\u6210\u529f\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-\u4ee5\u592a\u7f51\u63a7\u5236\u5668","title":"SPI \u4ee5\u592a\u7f51\u63a7\u5236\u5668","text":"<p>\u6709\u4e00\u4e9b\u4ee5\u592a\u7f51\u4ea7\u54c1\u63d0\u4f9b\u4e86 SPI \u63a5\u53e3\uff0c\u4f8b\u5982 KSZ8851SNL/SNLI\uff0c\u96c6\u6210\u4e86 MAC \u548c PHY\uff0c\u76f4\u63a5\u8fde\u63a5 MDI/MDI-X \u63a5\u53e3\uff0c\u867d\u7136\u6700\u9ad8\u53ea\u652f\u6301\u767e\u5146\u7f51\uff0c\u4f46\u662f\u63a5\u53e3\u4e0a\u786e\u5b9e\u975e\u5e38\u7b80\u5355\u3002</p> <p>SPI \u4e0a\u53d1\u9001\u7684\u547d\u4ee4\u5c31\u4e24\u7c7b\uff1a\u4e00\u7c7b\u662f\u8bfb\u5199\u5bc4\u5b58\u5668\uff0c\u4e00\u7c7b\u662f\u8bfb\u5199 RX/TX FIFO\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#\u952e\u76d8\u548c\u89e6\u6478\u677f","title":"\u952e\u76d8\u548c\u89e6\u6478\u677f","text":"<p>\u4e00\u4e9b\u578b\u53f7\u7684\u82f9\u679c\u7535\u8111\u7684\u952e\u76d8\u548c\u89e6\u6478\u677f\u662f\u901a\u8fc7 SPI \u63a5\u53e3\u8bbf\u95ee\u7684\uff0c\u5728 Linux \u4e2d\u6709\u76f8\u5e94\u7684 applespi \u9a71\u52a8\u3002</p>","tags":["spi"]},{"location":"hardware/2023/04/26/spi/#spi-vs-i2c","title":"SPI vs I2C","text":"<p>SPI \u548c I2C \u7684\u533a\u522b\u5728\u4e8e\uff0c\u524d\u8005\u4fe1\u53f7\u66f4\u591a\uff0c\u5168\u53cc\u5de5\u4f20\u8f93\uff1b\u540e\u8005\u4fe1\u53f7\u66f4\u5c11\uff0c\u534a\u53cc\u5de5\u4f20\u8f93\u3002SPI \u901a\u8fc7 CS \u4fe1\u53f7\u9009\u62e9 Slave \u82af\u7247\uff0cI2C \u901a\u8fc7\u5730\u5740\u8fdb\u884c\u533a\u5206\u3002\u6b64\u5916 I2C \u8fd8\u9700\u8981 Pull up resistor\uff0c\u8fd9\u6837\u5982\u679c\u6ca1\u6709\u8bbe\u5907\u54cd\u5e94\uff0c\u5c31\u4f1a NACK\u3002</p> <p>\u4e00\u4e9b\u82af\u7247\u63d0\u4f9b\u4e86 SPI \u6216 I2C \u7684\u9009\u9879\uff1a\u5171\u7528\u4e24\u4e2a\u4fe1\u53f7\uff0c\u5141\u8bb8\u7528\u6237\u9009\u62e9\u7528 I2C \u8fd8\u662f SPI\u3002\u4f8b\u5982 WM8731\uff0c\u65e2\u652f\u6301 I2C\uff08\u8bb0\u4e3a 2-wire mode\uff09\uff0c\u53c8\u652f\u6301 SPI\uff08\u8bb0\u4e3a 3-wire mode\uff09\u3002\u4e00\u822c\u8fd9\u79cd\u65f6\u5019\uff0cSPI \u548c I2C \u5c31\u662f\u7528\u6765\u914d\u7f6e\u4e00\u4e9b\u5bc4\u5b58\u5668\u7684\uff0c\u53e6\u5916\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b\u63a5\u53e3\uff0c\u4f8b\u5982 WM8731 \u8d1f\u8d23\u58f0\u97f3\u6570\u636e\u4f20\u8f93\u7684\u5b9e\u9645\u4e0a\u662f I2S\u3002</p>","tags":["spi"]},{"location":"hardware/2021/12/04/sunway/","title":"Sunway \u5904\u7406\u5668\u67b6\u6784\u5206\u6790","text":"","tags":["sunway","sw26010","cpu"]},{"location":"hardware/2021/12/04/sunway/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>\u9ad8\u6027\u80fd\u4f17\u6838\u5904\u7406\u5668\u7533\u5a01 26010</li> <li>\u7a00\u758f\u77e9\u9635\u5411\u91cf\u4e58\u6cd5\u5728\u7533\u5a01\u4f17\u6838\u67b6\u6784\u4e0a\u7684\u6027\u80fd\u4f18\u5316</li> <li>Sunway SW26010</li> <li>The Sunway TaihuLight supercomputer: system and applications</li> <li>Report on the Sunway TaihuLight System</li> <li>Closing the \u201cQuantum Supremacy\u201d Gap: Achieving Real-Time Simulation of a Random Quantum Circuit Using a New Sunway Supercomputer</li> <li>SW_Qsim: A Minimize-Memory Quantum Simulator with High-Performance on a New Sunway Supercomputer</li> <li>18.9-Pflops Nonlinear Earthquake Simulation on Sunway TaihuLight: Enabling Depiction of 18-Hz and 8-Meter Scenarios</li> <li>A FIRST PEEK AT CHINA\u2019S SUNWAY EXASCALE SUPERCOMPUTER</li> <li>THE NITTY GRITTY OF THE SUNWAY EXASCALE SYSTEM NETWORK AND STORAGE</li> <li>Sunway supercomputer architecture towards exascale computing: analysis and practice</li> <li>China\u2019s New(ish</li> <li>5 ExaFlop/s HPL-MxP Benchmark with Linear Scalability on the 40-Million-Core Sunway Supercomputer</li> </ul>","tags":["sunway","sw26010","cpu"]},{"location":"hardware/2021/12/04/sunway/#sw26010","title":"SW26010","text":"<p>Sunway TaihuLight \u7684\u5c42\u6b21\uff1a</p> <ol> <li>1 Sunway TaihuLight = 40 Cabinet</li> <li>1 Cabinet = 4 Super nodes</li> <li>1 Super node = 256 nodes</li> <li>1 node = 4 core groups</li> <li>1 core group = 1 MPE(management processing element) + 8*8 CPE(computer processing element)</li> </ol> <p>MPE \u53cc\u7cbe\u5ea6\u6027\u80fd\uff1a<code>16 FLOP/cycle * 1.45 GHz = 23.2 GFlops</code> CPE \u53cc\u7cbe\u5ea6\u6027\u80fd\uff1a<code>8 FLOP/cycle * 1.45 GHz = 11.6 GFlops</code> CPE \u5355\u7cbe\u5ea6\u6027\u80fd\uff1a<code>8 FLOP/cycle * 1.45 GHz = 11.6 GFlops</code> \u5355\u8282\u70b9\u53cc\u7cbe\u5ea6\u6027\u80fd\uff1a<code>4 * 8 * 8 * 11.6 + 4 * 23.2 = 3.0624 TFlops</code> Sunway TaihuLight \u53cc\u7cbe\u5ea6\u6027\u80fd\uff1a<code>40 * 4 * 256 * 3.0624 = 125.435904 PFlops</code></p> <p>MPE: 32KB L1I, 32 KB L1D, 256 KB L2(\u4e2d\u6587\u6587\u732e\u91cc\u5199\u7684\u662f 512 KB)\u3002\u4e71\u5e8f\u6267\u884c\uff0c4 \u8bd1\u7801\uff0c7 \u53d1\u5c04\uff085 \u6574\u6570 2 \u6d6e\u70b9\uff09\u3002\u6307\u4ee4\u9884\u53d6\uff0c\u5206\u652f\u9884\u6d4b\uff0c\u5bc4\u5b58\u5668\u91cd\u547d\u540d\uff0c\u9884\u6d4b\u6267\u884c\u30025 \u6761\u6574\u6570\u6d41\u6c34\u7ebf\uff0c2 \u6761 256 \u4f4d SIMD \u6d6e\u70b9\u6d41\u6c34\u7ebf\u3002</p> <p>CPE\uff1a16KB L1I\uff0c\u65e0 DCache\uff0c\u6709 64KB \u53ef\u91cd\u6784\u5c40\u90e8\u6570\u636e\u5b58\u50a8\u5668\uff08SPM scratch pad memory/LDM local data memory\uff09\u30022 \u8bd1\u7801 2 \u53d1\u5c04\uff0c\u4e71\u5e8f\u6267\u884c\uff0c1 \u6761 256 \u4f4d SIMD \u6d41\u6c34\u7ebf\uff0c1 \u6761\u6574\u6570\u6d41\u6c34\u7ebf\u3002\u4e0d\u540c\u7cbe\u5ea6\u7684 SIMD \u5bbd\u5ea6\u4e0d\u540c\uff0c\u5355\u7cbe\u5ea6\u6d6e\u70b9\u8fd0\u7b97 128 \u4f4d\uff084 \u4e2a\u5355\u7cbe\u5ea6\uff09\uff0c\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u8fd0\u7b97 256 \u4f4d\uff084 \u4e2a\u53cc\u7cbe\u5ea6\uff09\u3002\u4ece SPM \u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u8bfb\u53d6 32 \u5b57\u8282\u7684\u6570\u636e\uff08\u6b63\u597d\u4e00\u4e2a SIMD \u5bc4\u5b58\u5668\uff09\u3002</p> <p>\u6bcf\u4e2a core group \u4e2d\u8fd8\u6709\u4e00\u4e2a MC\uff08Memory Controller\uff09\uff0c\u8fde\u63a5 8GB DDR3 memory\uff0c\u6bcf\u4e2a MC \u5185\u5b58\u5e26\u5bbd <code>128 bit * 2133 MT/s = 34.128 GB/s</code>\uff0c\u5355\u8282\u70b9\u5185\u5b58\u5e26\u5bbd <code>4 * 34.128 = 136.512 GB/s</code>\u3002\u5728 Stream Triad \u6d4b\u8bd5\uff0c\u6bcf\u4e2a core group \u7528 DMA \u4ece\u5185\u5b58\u5230 SPM \u4f20\u8f93\u6570\u636e\u5e26\u5bbd\u4e3a 22.6 GB/s\uff0c\u800c\u5168\u5c40\u8bfb\u5199 gload/gstore \u5e26\u5bbd\u53ea\u6709 1.5 GB/s\u3002\u8bbf\u95ee\u5168\u5c40\u5185\u5b58\u9700\u8981 120+ \u4e2a\u5468\u671f\u3002</p> <p>8x8 \u77e9\u9635\u4e2d\u7684\u4ece\u6838\u53ef\u4ee5\u5728\u540c\u884c\u548c\u540c\u5217\u65b9\u5411\u4e0a\u8fdb\u884c\u4f4e\u5ef6\u8fdf\u548c\u9ad8\u5e26\u5bbd\u7684\u6570\u636e\u4f20\u9012\uff1a2 \u4e2a\u4ece\u6838\u70b9\u5bf9\u70b9\u901a\u4fe1\u5ef6\u8fdf\u4e0d\u8d85\u8fc7 11 \u4e2a\u5468\u671f\uff0c\u5355\u4e2a core group \u5bc4\u5b58\u5668\u901a\u4fe1\u96c6\u5408\u5e26\u5bbd\u8fbe\u5230 637 GB/s\u3002</p> <p>28nm \u5de5\u827a\u6d41\u7247\uff0c\u82af\u7247 die \u9762\u79ef\u8d85\u8fc7 500 mm^2\uff0c\u5cf0\u503c\u529f\u8017 292.7W\uff0c\u5cf0\u503c\u80fd\u6548\u6bd4\u8fbe 10.559 GFLOPS\u2215W\uff08HPL 6.05 GFLOPS/W\uff09\u3002</p>","tags":["sunway","sw26010","cpu"]},{"location":"hardware/2021/12/04/sunway/#sw26010-pro","title":"SW26010-Pro","text":"<p>SW26010-Pro \u662f\u5347\u7ea7\u7248 SW26010\uff0c\u5347\u7ea7\u7684\u5185\u5bb9\u5728\u4e8e\uff1a</p> <ol> <li>\u6bcf\u4e2a node \u4ece 4 \u4e2a core group \u5347\u7ea7\u5230 6 \u4e2a\uff0c\u4e00\u5171\u6709 <code>6 * (8 * 8 + 1) = 390</code> \u4e2a\u6838\u5fc3\u3002\u9891\u7387\u4e5f\u63d0\u9ad8\u4e86\uff0cMPE \u9891\u7387 2.1GHz\uff0cCPE \u9891\u7387 2.25 GHz\u3002SIMD \u5bbd\u5ea6\u6269\u5c55\u5230 512 \u4f4d\u3002</li> <li>\u6bcf\u4e2a MC \u8fde\u63a5\u4e86 16 GB DDR4 \u5185\u5b58\uff0c\u5e26\u5bbd\u662f <code>128 bit * 3200 MT/s = 51.2 GB/s</code>\uff1b\u5355\u8282\u70b9\u603b\u5185\u5b58 96 GB\uff0c\u603b\u5185\u5b58\u5e26\u5bbd <code>51.2 * 6 = 307.2 GB/s</code>\u3002</li> <li>\u6bcf\u4e2a CPE \u7684\u5c40\u90e8\u5b58\u50a8\uff08LDM\uff09\u4ece 64KB \u5347\u7ea7\u5230 256KB\u3002</li> <li>CPE \u4e4b\u95f4\u7684\u901a\u4fe1\u53ef\u4ee5\u901a\u8fc7 RMA \u8fdb\u884c\uff0c\u800c\u4e4b\u524d\u7684 SW26010 \u53ea\u80fd\u5728\u540c\u4e00\u884c/\u5217\u4e4b\u95f4\u8fdb\u884c\u5bc4\u5b58\u5668\u901a\u4fe1\u3002</li> </ol>","tags":["sunway","sw26010","cpu"]},{"location":"hardware/2021/12/04/sunway/#sw52020","title":"SW52020","text":"<p>\u5728\u65b0\u95fb\u7a3f\u548c Sunway supercomputer architecture towards exascale computing: analysis and practice \u6587\u7ae0\u4e2d\u51fa\u73b0\uff0c\u6ca1\u6709\u5728\u4eca\u5e74\u53d1\u51fa\u6765\u7684\u8bba\u6587\u91cc\u5b9e\u9645\u91c7\u7528\uff0c\u540d\u79f0\u53ef\u80fd\u662f\u65b0\u95fb\u7a3f\u81ea\u5df1\u7f16\u7684\uff0c\u6211\u731c\u53ef\u80fd\u6ca1\u6709\u5b9e\u9645\u91c7\u7528\uff0c\u800c\u662f\u505a\u4e86 SW26010P\u3002\u548c SW26010 \u533a\u522b\uff1a</p> <ol> <li>Core Group \u4ece 4 \u4e2a\u63d0\u5347\u5230\u4e86 8 \u4e2a\uff0c\u6240\u4ee5\u6bcf\u4e2a node \u6709 <code>8 * (8 * 8 + 1) = 520</code> \u4e2a\u6838\u5fc3\u3002</li> <li>MPE \u548c CPE \u5411\u91cf\u5bbd\u5ea6\u4ece 256 \u4f4d\u6269\u5c55\u5230\u4e86 512 \u4f4d\u3002\u6dfb\u52a0\u4e86 16 \u4f4d\u534a\u7cbe\u5ea6\u6d6e\u70b9\u652f\u6301\u3002</li> <li>\u6bcf\u4e2a node \u63d0\u4f9b\u8d85\u8fc7 12 TFlops \u7684\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6027\u80fd\u3002\u5e94\u8be5\u662f\u9760\u4e24\u500d\u7684 Core Group\uff0c\u4e58\u4e0a\u4e24\u500d\u7684\u5411\u91cf\u8ba1\u7b97\u5bbd\u5ea6\uff0c\u8fbe\u5230\u56db\u500d\u7684\u6027\u80fd\u3002</li> </ol>","tags":["sunway","sw26010","cpu"]},{"location":"hardware/2022/03/30/sv2v-fpnew/","title":"\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868","text":"","tags":["hdl","yosys","sv2v","fpnew","fpu"]},{"location":"hardware/2022/03/30/sv2v-fpnew/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>FPnew \u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7528\u7684\u6d6e\u70b9\u8ba1\u7b97\u5355\u5143\uff0c\u4f46\u5b83\u662f SystemVerilog \u7f16\u5199\u7684\uff0c\u5e76\u4e14\u7528\u4e86\u5f88\u591a\u9ad8\u7ea7\u7279\u6027\uff0c\u867d\u7136\u95ed\u6e90\u8f6f\u4ef6\u662f\u652f\u6301\u7684\uff0c\u4f46\u662f\u5f00\u6e90\u62d6\u62c9\u673a\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u90a3\u6837\u7684\u95ee\u9898\u3002\u6240\u4ee5\u4e00\u76f4\u60f3\u7528 sv2v \u628a\u5b83\u7ffb\u8bd1\u6210 Verilog\uff0c\u4f46\u6b64\u65f6\u7684 Verilog \u8fd8\u6709\u5f88\u591a\u590d\u6742\u7684\u7ed3\u6784\uff0c\u518d\u7528 yosys \u8f6c\u6362\u4e3a\u4e00\u4e2a\u901a\u7528\u53ef\u7efc\u5408\u7684\u7f51\u8868\u3002</p>","tags":["hdl","yosys","sv2v","fpnew","fpu"]},{"location":"hardware/2022/03/30/sv2v-fpnew/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>\u7ecf\u8fc7\u4e00\u7cfb\u5217\u8e29\u5751\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u70b9\u662f\u8981\u7528\u6700\u65b0\u7684 sv2v(v0.0.9-24-gf868f06) \u548c yosys(0.15+70)\u3002Debian \u6253\u5305\u7684 yosys \u7248\u672c\u6bd4\u8f83\u8001\uff0c\u4e0d\u80fd\u6ee1\u8db3\u9700\u6c42\u3002</p> <p>\u9996\u5148\uff0c\u7528 verilator \u8fdb\u884c\u9884\u5904\u7406\uff0c\u628a\u4e00\u5806 sv \u6587\u4ef6\u5408\u6210\u4e00\u4e2a\uff1a</p> <pre><code>$ cat a.sv b.sv c.sv &gt; test.sv\n$ verilator -E test.sv &gt; merged.sv\n$ sed -i '/^`line/d' merged.sv\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u7528 sed \u53bb\u6389\u4e86\u65e0\u7528\u7684\u884c\u53f7\u4fe1\u606f\u3002\u7136\u540e\uff0c\u7528 sv2v \u8fdb\u884c\u8f6c\u6362\uff1a</p> <pre><code>$ sv2v merged.sv &gt; merge.v\n$ sed -i '/\\$$fatal/d' merge.v\n</code></pre> <p>\u8fd9\u91cc\u53c8\u7528 sed \u628a\u4e0d\u652f\u6301\u7684 $fatal \u53bb\u6389\u3002\u6700\u540e\uff0c\u7528 yosys \u8fdb\u884c\u5904\u7406\uff1a</p> <pre><code>$ yosys -p 'read_verilog -defer merge.v' -p 'hierarchy -p fpnew_top' -p 'proc' -p 'opt' -p 'write_verilog -noattr output.v'\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u8981\u7528 <code>read_verilog -defer</code>\uff0c\u5426\u5219 yosys \u4f1a\u9047\u5230 TAG_WIDTH=0 \u9ed8\u8ba4\u53c2\u6570\u5c31\u76f4\u63a5\u4f8b\u5316\uff0c\u7136\u540e\u5c31\u51fa\u73b0 <code>[0:-1]</code> \u8fd9\u6837\u7684\u4e0b\u6807\u3002<code>read_verilog</code> \u7684\u6587\u6863\u544a\u8bc9\u4e86\u6211\u4eec\u53ef\u4ee5\u5206\u4e24\u6b65\u505a\uff1a</p> <pre><code>-defer\n    only read the abstract syntax tree and defer actual compilation\n    to a later 'hierarchy' command. Useful in cases where the default\n    parameters of modules yield invalid or not synthesizable code.\n</code></pre> <p>\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u7b80\u5316\u540e\u7684 verilog \u4ee3\u7801\uff1a</p> <pre><code>module \\$paramod$011e4d7ee08c34f246a38322dc9967d23ecc8081\\fpnew_opgroup_block_A94B6_B7406 (clk_i, rst_ni, operands_i, is_boxed_i, rnd_mode_i, op_i, op_mod_i, src_fmt_i, dst_fmt_i, int_fmt_i, vectorial_op_i, tag_i, in_valid_i, in_ready_o, flush_i, result_o, status_o, extension_bit_o, tag_o, out_valid_o, out_ready_i\n, busy_o);\n  wire _0_;\n  wire _1_;\n  wire [71:0] arbiter_output;\n  output busy_o;\n  wire busy_o;\n  input clk_i;\n  wire clk_i;\n  input [2:0] dst_fmt_i;\n  wire [2:0] dst_fmt_i;\n  output extension_bit_o;\n  wire extension_bit_o;\n  input flush_i;\n  // ...\nendmodule\n</code></pre> <p>\u8fd9\u6837\u867d\u7136\u6bd4\u8f83\u4e11\u964b\uff0c\u4f46\u662f\u89e3\u51b3\u4e86 SystemVerilog \u7684\u95ee\u9898\u3002\u8bda\u7136\uff0c\u8fd9\u6837\u4e5f\u5931\u53bb\u4e86\u4fee\u6539\u53c2\u6570\u7684\u80fd\u529b\uff0c\u56e0\u4e3a\u53c2\u6570\u5df2\u7ecf\u5728 yosys \u7efc\u5408\u9014\u4e2d\u786e\u5b9a\u4e0b\u6765\u4e86\u3002</p>","tags":["hdl","yosys","sv2v","fpnew","fpu"]},{"location":"hardware/2022/05/09/tilelink/","title":"TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u4e00\u4e9b\u652f\u6301\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u7f13\u5b58\u7684\u5b9e\u73b0\uff0c\u6bd4\u5982 rocket-chip \u7684\u5b9e\u73b0\u548c sifive \u7684\u5b9e\u73b0\uff0c\u56e0\u6b64\u9700\u8981\u7814\u7a76\u4e00\u4e9b TileLink \u534f\u8bae\u3002\u672c\u6587\u8ba8\u8bba\u7684\u65f6\u5019\u9ed8\u8ba4\u8bfb\u8005\u5177\u6709\u4e00\u5b9a\u7684 AXI \u77e5\u8bc6\uff0c\u56e0\u6b64\u5f88\u591a\u5185\u5bb9\u4f1a\u76f4\u63a5\u53c2\u8003 AXI\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#\u4fe1\u53f7","title":"\u4fe1\u53f7","text":"<p>\u6839\u636e TileLink Spec 1.8.0\uff0cTileLink \u5206\u4e3a\u4ee5\u4e0b\u4e09\u79cd\uff1a</p> <ul> <li>TL-UL: \u53ea\u652f\u6301\u8bfb\u5199\uff0c\u4e0d\u652f\u6301 burst\uff0c\u7c7b\u6bd4 AXI-Lite</li> <li>TL-UH\uff1a\u652f\u6301\u8bfb\u5199\uff0c\u539f\u5b50\u6307\u4ee4\uff0c\u9884\u53d6\uff0c\u652f\u6301 burst\uff0c\u7c7b\u6bd4 AXI+ATOP\uff08AXI5 \u5f15\u5165\u7684\u539f\u5b50\u64cd\u4f5c\uff09</li> <li>TL-C\uff1a\u5728 TL-UH \u57fa\u7840\u4e0a\u652f\u6301\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u7c7b\u6bd4 AXI+ACE/CHI</li> </ul>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#tilelink-uncached","title":"TileLink Uncached","text":"<p>TileLink Uncached(TL-UL \u548c TL-UH) \u5305\u62ec\u4e86\u4e24\u4e2a channel\uff1a</p> <ul> <li>A channel: M-&gt;S \u53d1\u9001\u8bf7\u6c42\uff0c\u7c7b\u6bd4 AXI \u7684 AR/AW/W</li> <li>D channel: S-&gt;M \u53d1\u9001\u54cd\u5e94\uff0c\u7c7b\u6bd4 AXI \u7684 R/W</li> </ul> <p>\u56e0\u6b64 TileLink \u6bcf\u4e2a\u5468\u671f\u53ea\u80fd\u53d1\u9001\u8bfb\u6216\u8005\u5199\u7684\u8bf7\u6c42\uff0c\u800c AXI \u53ef\u4ee5\u540c\u65f6\u5728 AR \u548c AW channel \u4e0a\u53d1\u9001\u8bf7\u6c42\u3002</p> <p>\u4e00\u4e9b\u8bf7\u6c42\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>\u8bfb\uff1aM-&gt;S \u5728 A channel \u4e0a\u53d1\u9001 Get\uff0cS-&gt;M \u5728 D channel \u4e0a\u53d1\u9001 AccessAckData</li> <li>\u5199\uff1aM-&gt;S \u5728 A channel \u4e0a\u53d1\u9001 PutFullData/PutPartialData\uff0cS-&gt;M \u5728 D channel \u662f\u53d1\u9001 AccessAck</li> <li>\u539f\u5b50\u64cd\u4f5c\uff1aM-&gt;S \u5728 A channel \u4e0a\u53d1\u9001 ArithmeticData/LogicalData\uff0cS-&gt;M \u5728 D channel \u4e0a\u53d1\u9001 AccessAckData</li> <li>\u9884\u53d6\u64cd\u4f5c\uff1aM-&gt;S \u5728 A channel \u4e0a\u53d1\u9001 Intent\uff0cS-&gt;M \u5728 D channel \u4e0a\u53d1\u9001 AccessAck</li> </ul>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#axi4totl","title":"AXI4ToTL","text":"<p>\u9488\u5bf9 AXI4ToTL \u6a21\u5757\u7684\u4f8b\u5b50\uff0c\u6765\u5206\u6790\u4e00\u4e0b\u5982\u4f55\u628a\u4e00\u4e2a AXI4 Master \u8f6c\u6362\u4e3a TileLink\u3002</p> <p>\u9996\u5148\u8003\u8651\u4e00\u4e0b AXI4 \u548c TileLink \u7684\u533a\u522b\uff1a\u4e00\u4e2a\u662f\u8bfb\u5199 channel \u5408\u5e76\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u9700\u8981\u4e00\u4e2a Arbiter\uff1b\u5176\u6b21 AXI4 \u4e2d AW \u548c W \u662f\u5206\u5f00\u7684\uff0c\u8fd9\u91cc\u4e5f\u9700\u8981\u8fdb\u884c\u5408\u5e76\u3002\u8fd9\u4e2a\u6a21\u5757\u5e76\u4e0d\u8003\u8651 Burst \u7684\u60c5\u51b5\uff0c\u800c\u662f\u7531 AXI4Fragmenter \u6765\u8fdb\u884c\u62c6\u5206\uff0c\u5373\u6dfb\u52a0\u82e5\u5e72\u4e2a AW beat\uff0c\u548c W \u8fdb\u884c\u914d\u5bf9\u3002</p> <p>\u5177\u4f53\u5230\u4ee3\u7801\u5b9e\u73b0\u4e0a\uff0c\u9996\u5148\u628a AR channel \u5bf9\u5e94\u5230 \u5230 A channel \u4e0a\uff1a</p> <pre><code>val r_out = Wire(out.a)\nr_out.valid := in.ar.valid\nr_out.bits :&lt;= edgeOut.Get(r_id, r_addr, r_size)._2\n</code></pre> <p>\u7136\u540e AW+W channel \u4e5f\u8fde\u63a5 \u5230 A channel\uff0c\u7531\u4e8e\u4e0d\u7528\u8003\u8651 burst \u7684\u60c5\u51b5\uff0c\u8fd9\u91cc\u5728 aw \u548c w \u540c\u65f6 valid \u7684\u65f6\u5019\u624d\u8ba4\u4e3a\u6709\u8bf7\u6c42\u3002</p> <pre><code>val w_out = Wire(out.a)\nin.aw.ready := w_out.ready &amp;&amp; in.w.valid &amp;&amp; in.w.bits.last\nin.w.ready  := w_out.ready &amp;&amp; in.aw.valid\nw_out.valid := in.aw.valid &amp;&amp; in.w.valid\nw_out.bits :&lt;= edgeOut.Put(w_id, w_addr, w_size, in.w.bits.data, in.w.bits.strb)._2\n</code></pre> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\u8bfb\u5199\u7684 id \u589e\u52a0\u4e86\u82e5\u5e72\u4f4d\uff0c\u6700\u4f4e\u4f4d 0 \u8868\u793a\u8bfb\uff0c1 \u8868\u793a\u5199\uff0c\u5269\u4e0b\u51e0\u4f4d\u662f\u8bf7\u6c42\u7f16\u53f7\uff0c\u8fd9\u6837\u53d1\u51fa\u53bb\u7684\u662f\u4e0d\u540c id \u7684\u591a\u4e2a\u8bf7\u6c42\u3002</p> <p>\u7136\u540e\uff0c\u628a\u8bfb\u548c\u5199\u7684 A channel \u8fde\u63a5\u5230 Arbiter \u4e0a\uff1a</p> <pre><code>TLArbiter(TLArbiter.roundRobin)(out.a, (UInt(0), r_out), (in.aw.bits.len, w_out))\n</code></pre> <p>\u5176\u4f59\u7684\u90e8\u5206\u5219\u662f\u5bf9 D channel \u8fdb\u884c\u5224\u65ad\uff0c\u6709\u6570\u636e\u7684\u8f6c\u7ed9 R channel\uff0c\u6ca1\u6709\u6570\u636e\u7684\u8f6c\u7ed9 B channel\uff1a</p> <pre><code>out.d.ready := Mux(d_hasData, ok_r.ready, ok_b.ready)\nok_r.valid := out.d.valid &amp;&amp; d_hasData\nok_b.valid := out.d.valid &amp;&amp; !d_hasData\n</code></pre> <p>\u6700\u540e\u5904\u7406\u4e86\u4e00\u4e0b TileLink \u548c AXI4 \u5bf9\u5199\u8bf7\u6c42\u8fd4\u56de\u786e\u8ba4\u7684\u533a\u522b\uff1aTileLink \u4e2d\uff0c\u53ef\u4ee5\u5728\u7b2c\u4e00\u4e2a burst beat \u5c31\u8fd4\u56de\u786e\u8ba4\uff0c\u800c AXI4 \u9700\u8981\u5728\u6700\u540e\u4e00\u4e2a burst beat \u4e4b\u540e\u8fd4\u56de\u786e\u8ba4\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#tltoaxi4","title":"TLToAXI4","text":"<p>\u518d\u6765\u770b\u4e00\u4e0b\u53cd\u8fc7\u6765\u7684\u8f6c\u6362\uff0c\u4ece TileLink Master \u5230 AXI\u3002\u7531\u4e8e TileLink \u540c\u65f6\u53ea\u80fd\u8fdb\u884c\u8bfb\u6216\u8005\u5199\uff0c\u6240\u4ee5\u5b83\u9996\u5148\u505a\u4e86\u4e00\u4e2a\u865a\u6784\u7684 arw channel\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5408\u5e76\u4e86 ar \u548c aw channel \u7684 AXI4\uff0c\u8fd9\u4e2a\u8bbe\u8ba1\u5728 SpinalHDL \u7684\u4ee3\u7801\u4e2d\u4e5f\u80fd\u770b\u5230\u3002\u7136\u540e\u518d\u6839\u636e\u662f\u5426\u662f\u5199\u5165\uff0c\u5206\u522b\u8fde\u63a5\u5230 ar \u548c aw channel\uff1a</p> <pre><code>val queue_arw = Queue.irrevocable(out_arw, entries=depth, flow=combinational)\nout.ar.bits := queue_arw.bits\nout.aw.bits := queue_arw.bits\nout.ar.valid := queue_arw.valid &amp;&amp; !queue_arw.bits.wen\nout.aw.valid := queue_arw.valid &amp;&amp;  queue_arw.bits.wen\nqueue_arw.ready := Mux(queue_arw.bits.wen, out.aw.ready, out.ar.ready)\n</code></pre> <p>\u8fd9\u91cc\u5904\u7406\u4e86 aw \u548c w \u7684 valid \u4fe1\u53f7\uff1a</p> <pre><code>in.a.ready := !stall &amp;&amp; Mux(a_isPut, (doneAW || out_arw.ready) &amp;&amp; out_w.ready, out_arw.ready)\nout_arw.valid := !stall &amp;&amp; in.a.valid &amp;&amp; Mux(a_isPut, !doneAW &amp;&amp; out_w.ready, Bool(true))\nout_w.valid := !stall &amp;&amp; in.a.valid &amp;&amp; a_isPut &amp;&amp; (doneAW || out_arw.ready)\n</code></pre> <p>\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\uff0c\u5728 TileLink \u4e2d\uff0c\u6bcf\u4e2a burst \u90fd\u662f\u4e00\u4e2a a channel \u4e0a\u7684\u8bf7\u6c42\uff0c\u800c AXI4 \u4e2d\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a burst \u6709 aw \u8bf7\u6c42\uff0c\u6240\u6709 burst \u90fd\u6709 w \u8bf7\u6c42\uff0c\u56e0\u6b64\u8fd9\u91cc\u7528 doneAW \u4fe1\u53f7\u6765\u8fdb\u884c\u533a\u5206\u3002</p> <p>\u63a5\u7740\uff0c\u8981\u628a b \u548c r channel \u4e0a\u7684\u7ed3\u679c\u8fde\u63a5\u5230 d channel\uff0c\u6839\u636e\u4e0a\u9762\u7684\u7ecf\u9a8c\uff0c\u8fd9\u91cc \u53c8\u662f\u4e00\u4e2a arbitration\uff1a</p> <pre><code>val r_wins = (out.r.valid &amp;&amp; b_delay =/= UInt(7)) || r_holds_d\nout.r.ready := in.d.ready &amp;&amp; r_wins\nout.b.ready := in.d.ready &amp;&amp; !r_wins\nin.d.valid := Mux(r_wins, out.r.valid, out.b.valid)\n</code></pre> <p>\u6700\u540e\u8fd8\u5904\u7406\u4e86\u4e00\u4e0b\u8bf7\u6c42\u548c\u7ed3\u679c\u987a\u5e8f\u7684\u95ee\u9898\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#tilelink-cached","title":"TileLink Cached","text":"<p>\u4e0a\u9762\u8bf4\u7684\u4e24\u4e2a\u6a21\u5757\u90fd\u662f TileLink Uncached\uff0c\u90a3\u4e48\u5b83\u5982\u4f55\u652f\u6301\u7f13\u5b58\u4e00\u81f4\u6027\u5462\uff1f\u9996\u5148\uff0c\u5b83\u5f15\u5165\u4e86\u4e09\u4e2a channel\uff1aB\u3001C \u548c E\uff0c\u652f\u6301\u4e09\u79cd\u64cd\u4f5c\uff1a</p> <ul> <li>Acquire\uff1aM-&gt;S \u5728 A channel \u4e0a\u53d1\u9001 Acquire\uff0cS-&gt;M \u5728 D channel \u4e0a\u53d1\u9001 Grant\uff0c\u7136\u540e M-&gt;S \u5728 E channel \u4e0a\u53d1\u9001 GrantAck\uff1b\u529f\u80fd\u662f\u83b7\u53d6\u4e00\u4e2a copy\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u548c Get \u662f\u7c7b\u4f3c\u7684\uff0c\u90fd\u662f\u5728 A channel \u4e0a\u53d1\u9001\u8bf7\u6c42\uff0c\u5728 D channel \u4e0a\u63a5\u53d7\u54cd\u5e94\uff0c\u53ea\u4e0d\u8fc7\u989d\u5916\u9700\u8981\u5728 E channel \u4e0a\u53d1\u9001 GrantAck\u3002</li> <li>Release\uff1aM-&gt;S \u5728 C channel \u4e0a\u53d1\u9001 Release/ReleaseData\uff0cS-&gt;M \u5728 D channel \u4e0a\u53d1\u9001 ReleaseAck\uff1b\u529f\u80fd\u662f\u5220\u9664\u81ea\u5df1\u7684 copy\uff0c\u4e00\u822c\u662f\u7f13\u5b58\u884c\u8981\u88ab\u6362\u51fa\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u5199\u56de Dirty \u6570\u636e\uff0c\u5c31\u7528 ReleaseData\uff0c\u5426\u5219\u7528 Release</li> <li>Probe\uff1aS-&gt;M \u5728 B channel \u4e0a\u53d1\u9001 Probe\uff0cM-&gt;S \u5728 C channel \u4e0a\u53d1\u9001 ProbeAck\uff1b\u529f\u80fd\u662f\u8981\u6c42 M \u5220\u9664\u81ea\u5df1\u7684 copy\uff0c\u901a\u5e38\u662f\u6709\u67d0\u4e00\u4e2a\u7f13\u5b58\u53d1\u9001\u4e86 Acquire\uff0c\u5bfc\u81f4\u5176\u4ed6\u7f13\u5b58\u9700\u8981\u964d\u4f4e\u6743\u9650</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cA C E \u4e09\u4e2a channel \u662f M-&gt;S\uff0cB D \u4e24\u4e2a channel \u662f S-&gt;M\u3002</p> <p>\u5047\u5982\u4e00\u4e2a\u7f13\u5b58\uff08Master A\uff09\u8981\u5199\u5165\u4e00\u5757\u53ea\u8bfb\u6570\u636e\uff0c\u6216\u8005\u8bfb\u53d6\u4e00\u5757 miss \u7684\u7f13\u5b58\u884c\uff0c\u5982\u679c\u662f\u5e7f\u64ad\u5f0f\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u90a3\u4e48\u9700\u8981\u7ecf\u5386\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u9996\u5148 Master A \u53d1\u51fa Acquire \u8bf7\u6c42\uff0c\u7136\u540e Slave \u5411\u5176\u4ed6 Master \u5e7f\u64ad Probe\uff0c\u7b49\u5230\u5176\u4ed6 Master \u8fd4\u56de ProbeAck \u540e\uff0c\u518d\u5411 Master A \u8fd4\u56de Grant\uff0c\u6700\u540e Master A \u53d1\u9001 GrantAck \u7ed9 Slave\u3002\u8fd9\u6837 Master A \u5c31\u83b7\u5f97\u4e86\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684\u4e00\u4efd\u62f7\u8d1d\uff0c\u5e76\u4e14\u8ba9 Master B \u7684\u7f13\u5b58\u884c\u5931\u6548\u6216\u8005\u72b6\u6001\u53d8\u6210\u53ea\u8bfb\u3002</p> <p>TileLink \u7684\u7f13\u5b58\u884c\u6709\u4e09\u4e2a\u72b6\u6001\uff1aNone\uff0cBranch \u548c Trunk(Tip)\u3002\u57fa\u672c\u5bf9\u5e94 MSI \u6a21\u578b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared \u548c Trunk-&gt;Modified\u3002Rocket Chip \u4ee3\u7801\u4e2d ClientStates \u8fd8\u5b9a\u4e49\u4e86 Dirty \u72b6\u6001\uff0c\u5927\u81f4\u5bf9\u5e94 MESI \u6a21\u578b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared\uff0cTrunk-&gt;Exclusive\uff0cDirty-&gt;Modified\u3002</p> <p>\u6b64\u5916\uff0c\u6807\u51c6\u8fd8\u8bf4\u53ef\u4ee5\u5728 B \u548c C channel \u4e0a\u8fdb\u884c TL-UH \u7684\u64cd\u4f5c\u3002\u6807\u51c6\u8fd9\u4e48\u8bbe\u8ba1\u7684\u610f\u56fe\u662f\u53ef\u4ee5\u8ba9 Slave \u8f6c\u53d1\u64cd\u4f5c\u5230\u62e5\u6709\u7f13\u5b58\u6570\u636e\u7684 Master \u4e0a\u3002\u6bd4\u5982 Master A \u5728 A channel \u4e0a\u53d1\u9001 Put \u8bf7\u6c42\uff0c\u90a3\u4e48 Slave \u5411 Master B \u7684 B channel \u4e0a\u53d1\u9001 Put \u8bf7\u6c42\uff0cMaster B \u5728 C channel \u4e0a\u53d1\u9001 AccessAck \u54cd\u5e94\uff0cSlave \u518d\u628a\u54cd\u5e94\u8f6c\u56de Master A \u7684 D channel\u3002\u8fd9\u5c31\u50cf\u662f\u4e00\u4e2a\u7247\u4e0a\u7684\u7f51\u7edc\uff0cSlave \u8d1f\u8d23\u5728 Master \u4e4b\u95f4\u8def\u7531\u8bf7\u6c42\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#broadcast","title":"Broadcast","text":"<p>\u63a5\u4e0b\u6765\u770b\u770b Rocket Chip \u81ea\u5e26\u7684\u57fa\u4e8e\u5e7f\u64ad\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5b9e\u73b0\u3002\u6838\u5fc3\u5b9e\u73b0\u662f TLBroadcast\uff0c\u6838\u5fc3\u7684\u903b\u8f91\u5c31\u662f\uff0c\u5982\u679c\u4e00\u4e2a Master A \u53d1\u9001\u4e86 Acquire\uff0c\u90a3\u4e48 TLBroadcast \u9700\u8981\u53d1\u9001 Probe \u5230\u5176\u4ed6\u7684 Master\uff0c\u5f53\u5176\u4ed6\u7684 Master \u90fd\u54cd\u5e94\u4e86 ProbeAck \u540e\uff0c\u518d\u8fd4\u56de Grant \u5230 Master A\u3002</p> <p>\u9996\u5148\u6765\u770b B channel \u4e0a\u7684 Probe \u903b\u8f91\u3002\u5b83\u8bb0\u5f55\u4e86\u4e00\u4e2a todo bitmask\uff0c\u8868\u793a\u54ea\u4e9b Master \u9700\u8981\u53d1\u9001 Probe\uff0c\u8fd9\u91cc\u91c7\u7528\u4e86 Probe Filter \u6765\u51cf\u5c11\u53d1\u9001 Probe \u7684\u6b21\u6570\uff0c\u56e0\u4e3a\u53ea\u9700\u8981\u5411\u62e5\u6709\u8fd9\u4e2a\u7f13\u5b58\u884c\u7684 Master \u53d1\u9001 Probe\uff1a</p> <pre><code>val probe_todo = RegInit(0.U(max(1, caches.size).W))\nval probe_line = Reg(UInt())\nval probe_perms = Reg(UInt(2.W))\nval probe_next = probe_todo &amp; ~(leftOR(probe_todo) &lt;&lt; 1)\nval probe_busy = probe_todo.orR()\nval probe_target = if (caches.size == 0) 0.U else Mux1H(probe_next, cache_targets)\n\n// Probe whatever the FSM wants to do next\nin.b.valid := probe_busy\nif (caches.size != 0) {\n    in.b.bits := edgeIn.Probe(probe_line &lt;&lt; lineShift, probe_target, lineShift.U, probe_perms)._2\n}\nwhen (in.b.fire()) { probe_todo := probe_todo &amp; ~probe_next }\n</code></pre> <p>\u8fd9\u91cc <code>probe_next</code> \u5c31\u662f\u88ab probe \u7684\u90a3\u4e2a Master \u5bf9\u5e94\u7684 bitmask\uff0c<code>probe_target</code> \u5c31\u662f Master \u7684 Id\u3002\u8fd9\u4e2a Probe FSM \u7684\u8f93\u5165\u5c31\u662f Probe Filter\uff0c\u5b83\u4f1a\u7ed9\u51fa\u54ea\u4e9b Cache \u62e5\u6709\u5f53\u524d\u7684\u7f13\u5b58\u884c\u7684\u4fe1\u606f\uff1a</p> <pre><code>val leaveB = !filter.io.response.bits.needT &amp;&amp; !filter.io.response.bits.gaveT\nval others = filter.io.response.bits.cacheOH &amp; ~filter.io.response.bits.allocOH\nval todo = Mux(leaveB, 0.U, others)\nfilter.io.response.ready := !probe_busy\nwhen (filter.io.response.fire()) {\n    probe_todo  := todo\n    probe_line  := filter.io.response.bits.address &gt;&gt; lineShift\n    probe_perms := Mux(filter.io.response.bits.needT, TLPermissions.toN, TLPermissions.toB)\n}\n</code></pre> <p>\u8fd9\u91cc\u53c8\u533a\u5206\u4e24\u79cd\u60c5\u51b5\uff1a\u5982\u679c Acquire \u9700\u8981\u8fdb\u5165 Trunk \u72b6\u6001\uff08\u6bd4\u5982\u662f\u4e2a\u5199\u5165\u64cd\u4f5c\uff09\uff0c\u610f\u5473\u7740\u5176\u4ed6 Master \u9700\u8981\u8fdb\u5165 None \u72b6\u6001\uff0c\u6240\u4ee5\u8fd9\u91cc\u8981\u53d1\u9001 toN\uff1b\u5982\u679c Acquire \u4e0d\u9700\u8981\u8fdb\u5165 Trunk \u72b6\u6001\uff08\u6bd4\u5982\u662f\u4e2a\u8bfb\u53d6\u64cd\u4f5c\uff09\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5176\u4ed6 Master \u8fdb\u5165 Branch \u72b6\u6001\uff0c\u6240\u4ee5\u8fd9\u91cc\u8981\u53d1\u9001 toB\u3002</p> <p>\u5728 B channel \u53d1\u9001 Probe \u7684\u540c\u65f6\uff0c\u4e5f\u8981\u5904\u7406 C channel \u4e0a\u7684 ProbeAck \u548c ProbeAckData\uff1a</p> <pre><code>// Incoming C can be:\n// ProbeAck     =&gt; decrement tracker, drop \n// ProbeAckData =&gt; decrement tracker, send out A as PutFull(DROP)\n// ReleaseData  =&gt;                    send out A as PutFull(TRANSFORM)\n// Release      =&gt; send out D as ReleaseAck\n</code></pre> <p>\u7531\u4e8e\u8fd9\u91cc\u91c7\u7528\u7684\u662f invalidation based\uff0c\u6240\u4ee5\u5982\u679c\u67d0\u4e2a Master \u4e4b\u524d\u5904\u4e8e Dirty \u72b6\u6001\uff0c\u90a3\u4e48\u5b83\u4f1a\u53d1\u9001 ProbeAckData\uff0c\u6b64\u65f6\u9700\u8981\u628a\u6570\u636e\u5199\u56de\uff0c\u6240\u4ee5\u9700\u8981\u7528 PutFull \u628a\u6570\u636e\u5199\u51fa\u53bb\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#serialization","title":"Serialization","text":"<p>\u4e0b\u9762\u6765\u8ba8\u8bba\u4e00\u4e0b TileLink \u5bf9\u5404\u7ec4\u4fe1\u53f7\u7684\u4e00\u4e9b\u8981\u6c42\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#flow-control-rules","title":"Flow Control Rules","text":"<p>\u9996\u5148\u662f Flow Control Rules\uff0c\u8ba8\u8bba\u7684\u662f ready \u548c valid \u4fe1\u53f7\u7684\u5173\u7cfb\uff0c\u76ee\u7684\u662f\u9632\u6b62\u6b7b\u9501\u3002\u9996\u5148\u662f\u4e24\u4e2a\u6bd4\u8f83\u5e38\u89c4\u7684\u8981\u6c42\uff1a</p> <ul> <li>If ready is LOW, the receiver must not process the beat and the sender must not consider the beat processed.</li> <li>If valid is LOW, the receiver must not expect the control or data signals to be a syntactically correct TileLink beat.</li> </ul> <p>\u7b2c\u4e00\u4e2a\u8bf4\u7684\u5c31\u662f valid &amp; ready \u7684\u65f6\u5019\u624d\u8ba4\u4e3a\u662f\u4e00\u4e2a beat \u5904\u7406\u4e86\uff0c\u7b2c\u4e8c\u4e2a\u5c31\u662f\u5982\u679c valid=LOW\uff0c\u90a3\u4e48\u4fe1\u53f7\u53ef\u80fd\u662f\u968f\u673a\u7684\u3001\u4e0d\u5408\u6cd5\u7684\u3002</p> <ul> <li>valid must never depend on ready. If a sender wishes to send a beat, it must assert valid independently of whether the receiver signals that it is ready.</li> <li>As a consequence, there must be no combinational path from ready to valid or any of the control and data signals.</li> </ul> <p>\u8fd9\u91cc\u662f\u4e3a\u4e86\u9632\u6b62\u7ec4\u5408\u903b\u8f91\u51fa\u73b0\u73af\u8def\uff0c\u5982\u679c valid \u4f9d\u8d56 ready\uff0cready \u4f9d\u8d56 valid\uff0c\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u6240\u4ee5\u8fd9\u91cc\u89c4\u5b9a\uff0cvalid \u4e0d\u80fd\u4f9d\u8d56 ready\uff0c\u53cd\u8fc7\u6765\u53ea\u80fd ready \u4f9d\u8d56 valid\u3002\u7c7b\u4f3c\u5730\uff0c\u5176\u4ed6\u7684\u6570\u636e\u548c\u63a7\u5236\u4fe1\u53f7\u4e5f\u4e0d\u53ef\u4ee5\u4f9d\u8d56 ready\u3002\u7b80\u5355\u7406\u89e3\u5c31\u662f sender \u8981\u4e3b\u52a8\u63d0\u4f9b\u6570\u636e\uff0c\u800c receiver \u51b3\u5b9a\u4e86\u662f\u5426\u63a5\u53d7\u3002</p> <ul> <li>A low priority valid may not combinationally depend on a high priority valid. In other words, the decision to send a request may not be based on receiving a response in the same cycle.</li> <li>A high priority ready may not combinationally depend on a low priority ready. In other words, acceptance of a response may not be made contingent upon a request being accepted the same cycle.</li> </ul> <p>\u8fd9\u4e24\u6761\u7684\u610f\u601d\u662f\uff0c\u540c\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u6211\u8bbe\u7f6e\u53d1\u9001\u7684\u8bf7\u6c42\u7684 valid\uff0c\u4e0d\u80fd\u4f9d\u8d56\u4e8e\u540c\u4e00\u4e2a\u5468\u671f\u5185\u63a5\u53d7\u5230\u7684\u54cd\u5e94\u7684 valid\uff0c\u6bd4\u5982 A \u7684 valid \u4e0d\u80fd\u7ec4\u5408\u4f9d\u8d56\u4e8e D \u7684 valid\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u6211\u8bbe\u7f6e\u7684\u54cd\u5e94\u7684 ready \u4e0d\u80fd\u4f9d\u8d56\u4e8e\u540c\u4e00\u4e2a\u5468\u671f\u5185\u7684\u8bf7\u6c42\uff0c\u6bd4\u5982 D \u7684 ready \u4e0d\u80fd\u7ec4\u548c\u4f9d\u8d56\u4e8e A \u7684 ready\u3002</p> <p>\u90a3\u4e48\uff0c\u6709\u8fd9\u4e48\u51e0\u79cd\u7528\u6cd5\u662f\u53ef\u4ee5\u7684\uff1a</p> <ul> <li>It is acceptable for a receiver to drive ready in response to valid or any of the control and data signals. For example, an arbiter may lower ready if a valid request is made for an address which is busy. However, whenever possible, it is recommended that ready be driven independently so as to reduce the handshaking circuit depth. \u63a5\u6536\u65b9\u53ef\u4ee5\u8ba9 ready \u4f9d\u8d56\u4e8e valid \u6216\u8005\u5176\u4ed6\u7684\u63a7\u5236\u548c\u6570\u636e\u4fe1\u53f7\uff0c\u4e0d\u8fc7\u8fd9\u6837\u4f1a\u8ba9\u7ec4\u5408\u903b\u8f91\u6bd4\u8f83\u957f\u3002</li> <li>A channel may change valid and all control and data signals based on the value of ready in the prior cycle. For example, after a request has been accepted (ready HIGH), a new request may be presented. Only a same-cycle dependency of valid on ready is forbidden. \u53ef\u4ee5\u8ba9\u5f53\u524d\u5468\u671f\u7684 valid \u4f9d\u8d56\u4e8e\u4e0a\u4e00\u4e2a\u5468\u671f\u7684 ready \u4fe1\u53f7\uff0c\u53ea\u662f\u4e0d\u80fd\u6709\u540c\u5468\u671f\u7684 valid \u5bf9 ready \u7684\u4f9d\u8d56\u3002</li> <li>A device may legally drive valid for a response based on valid of a request in the same cycle. For example, a combinational ROM which answers immediately. In this case, presumably ready for the request will likewise be driven by ready for the response. The converse relationship is forbidden. \u8bbe\u5907\u53ef\u4ee5\u8ba9\u54cd\u5e94\u7684 valid \u4f9d\u8d56\u8bf7\u6c42\u7684 valid\uff0c\u6bd4\u5982\u4e00\u4e2a\u7ec4\u5408\u7684 ROM\uff0c\u5b83\u7684 D channel \u7684 valid \u53ef\u4ee5\u7ec4\u5408\u4f9d\u8d56\u4e8e A channel \u7684 valid\uff0c\u540c\u65f6 A channel \u7684 ready \u7ec4\u5408\u4f9d\u8d56\u4e8e D channel \u7684 ready\u3002\u8fd9\u6837\u5c31\u7b80\u5316\u4e86\u8bbe\u5907\u7684\u8bbe\u8ba1\uff0c\u5e76\u4e14\u53ef\u4ee5\u65e0\u5ef6\u8fdf\u5730\u8fdb\u884c\u8bbf\u95ee\u3002</li> </ul> <p>\u548c AXI \u4e0d\u540c\u7684\u4e00\u70b9\u5728\u4e8e\uff0cTileLink \u4e0d\u8981\u6c42 irrevocable\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u4e00\u4e2a\u5468\u671f\u5185 valid=HIGH \u4f46\u662f ready=LOW\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u5468\u671f Master \u53ef\u4ee5\u4fee\u6539\u63a7\u5236\u548c\u6570\u636e\u4fe1\u53f7\uff0c\u4e5f\u53ef\u4ee5\u8ba9 valid=LOW\u3002</p> <pre><code>Note that a sender may raise valid and then lower it on the following\ncycle, even if the message was not accepted on the previous cycle. For example,\nthe sender might have some other higher priority task to perform on the\nfollowing cycle, instead of trying to send the rejected message again.\nFurthermore, the sender may change the contents of the control and data signals\nwhen a message was not accepted.\n</code></pre> <p>TileLink \u7684 burst \u8bf7\u6c42\u662f\u901a\u8fc7\u6bd4 bus \u66f4\u5bbd\u7684 size \u7684\u591a\u4e2a beat \u7ec4\u6210\u7684\u3002\u4e00\u65e6\u7b2c\u4e00\u4e2a beat fire \u4e86\uff0c\u540e\u7eed\u53ea\u80fd\u53d1\u9001\u540c\u4e00\u4e2a burst \u7684\u6570\u636e\uff0c\u4e0d\u53ef\u4ee5\u4ea4\u9519\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#request-response-message-ordering","title":"Request-Response Message Ordering","text":"<p>\u8fd9\u91cc\u8ba8\u8bba\u7684\u662f\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u987a\u5e8f\u5173\u7cfb\u3002TileLink \u89c4\u5b9a\uff0c\u54cd\u5e94\u7684\u7b2c\u4e00\u4e2a beat \u4e0d\u65e9\u4e8e\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u7684 beat\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5bf9\u4e8e Get \u8bf7\u6c42\uff0c\u5982\u679c\u54cd\u5e94\u9700\u8981\u591a\u4e2a beat\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a beat \u4e0d\u65e9\u4e8e\u8bf7\u6c42\u7684\u90a3\u4e00\u4e2a\u5468\u671f\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u5e38\u89c4\uff0c\u610f\u601d\u662f\u53ef\u4ee5\u7ec4\u5408\u8fd4\u56de\u54cd\u5e94\u3002</li> <li>\u5bf9\u4e8e Put \u8bf7\u6c42\uff0c\u5982\u679c\u8bf7\u6c42\u9700\u8981\u591a\u4e2a beat\uff0c\u90a3\u4e48\u54cd\u5e94\u53ef\u4ee5\u5728\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u7684 beat \u7684\u5468\u671f\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u7279\u522b\uff0c\u610f\u601d\u662f\u5bf9\u4e8e\u591a\u4e2a beat \u7684\u8bf7\u6c42\uff0c\u53ef\u4ee5\u7acb\u5373\u8fd4\u56de\u54cd\u5e94\uff0c\u4e0d\u9700\u8981\u7b49\u5230\u6240\u6709\u8bf7\u6c42\u7684 beat \u5b8c\u6210\u3002</li> <li>\u5bf9\u4e8e ArithmeticData \u8bf7\u6c42\uff0c\u54cd\u5e94\u548c\u8bf7\u6c42\u90fd\u53ef\u80fd\u6709\u591a\u4e2a beat\uff0c\u90a3\u4e48\u54cd\u5e94\u7684\u7b2c\u4e00\u4e2a beat \u4e0d\u65e9\u4e8e\u8bf7\u6c42\u7684\u7b2c\u4e00\u4e2a beat \u5373\u53ef\uff0c\u5176\u4ed6\u6ca1\u6709\u987a\u5e8f\u8981\u6c42\u3002</li> </ul>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#deadlock-freedom","title":"Deadlock Freedom","text":"<p>\u90a3\u4e48\u591a\u89c4\u5219\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u76ee\u7684\u662f\u8981\u9632\u6b62\u6b7b\u9501\u3002\u4e3a\u4e86\u9632\u6b62\u6b7b\u9501\uff0c\u6709\u8fd9\u6837\u4e09\u6761\uff1a</p> <ol> <li>The agent graph (Section 5.3) contains no cycles</li> <li>Agents must eventually present all beats of a received message</li> <li>Unless they have a higher priority message in flight or unanswered<ol> <li>Agents must eventually accept a presented beat</li> <li>Agents must eventually answer a received request message</li> </ol> </li> </ol> <p>\u5927\u6982\u610f\u601d\u662f\uff0cbeat \u4e0d\u80fd\u65e0\u9650\u63a8\u8fdf\uff0c\u65e0\u8bba\u662f\u53d1\u9001\u65b9\u8fd8\u662f\u63a5\u53d7\u65b9\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u5b83\u7684\u54cd\u5e94\u4e0d\u80fd\u65e0\u9650\u63a8\u8fdf\u3002</p> <p>TileLink \u5b9a\u4e49\u4e86\u5404\u4e2a channel \u7684\u4f18\u5148\u7ea7\uff0c\u4ece\u4f4e\u5230\u9ad8\u662f <code>A&lt;B&lt;C&lt;D&lt;E</code>\u3002\u5bf9\u4e8e\u540c\u4e00\u4e2a channel\uff0cA C E \u4e0a\u662f master/sender \u4f18\u5148\u7ea7\u66f4\u9ad8\uff0cB D \u4e0a\u662f slave/receiver \u4f18\u5148\u7ea7\u66f4\u9ad8\u3002</p> <p>TileLink \u7684\u8bbe\u8ba1\u91cc\u4fdd\u8bc1\u4e86\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u7684\u54cd\u5e94\u90fd\u6bd4\u8bf7\u6c42\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002\u6bd4\u5982 A channel \u7684\u8bf7\u6c42\uff08Get/Put/AcquireBlock\uff09\u7684\u54cd\u5e94\u5728 D channel\uff08AccessAckData/AccessAck/Grant\uff09\uff0cB channel \u7684\u8bf7\u6c42\uff08Probe\uff09\u7684\u54cd\u5e94\u5728 C channel\uff08ProbeAck\uff09\uff0cC channel \u7684\u8bf7\u6c42\uff08Release\uff09\u7684\u54cd\u5e94\u5728 D channel\uff08ReleaseAck\uff09\uff0cD channel \u7684\u8bf7\u6c42\uff08Grant\uff09\u7684\u54cd\u5e94\u5728 E channel\uff08GrantAck\uff09\u3002</p>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2022/05/09/tilelink/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>TileLink spec</li> <li>rocket-chip</li> </ul>","tags":["tilelink","bus","cache","coherence"]},{"location":"hardware/2023/06/12/try-loongarch/","title":"LoongArch \u521d\u5c1d\u8bd5","text":"","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5e94\u9f99\u82af\u8981\u6c42\u628a\u76d1\u63a7\u7a0b\u5e8f\u79fb\u690d\u5230\u4e86 LoongArch 32 Reduced \u67b6\u6784\u4e0a\uff0c\u8d81\u6b64\u673a\u4f1a\u4f53\u9a8c\u4e86\u4e00\u4e0b LoongArch \u76f8\u5173\u7684\u8f6f\u4ef6\u548c\u7cfb\u7edf\u3002</p>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u5728-qemu-\u4e2d\u8fd0\u884c-loongarch-arch-linux","title":"\u5728 QEMU \u4e2d\u8fd0\u884c LoongArch Arch Linux","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/loongarchlinux</p> <p>\u73af\u5883\uff1aDebian Bookworm</p> <p>QEMU \u542f\u52a8\u6d41\u7a0b\uff0c\u53c2\u8003\u5b98\u65b9\u6587\u6863\uff1a</p> <pre><code>wget https://mirrors.wsyu.edu.cn/loongarch/archlinux/images/archlinux-xfce4-2023.05.10-loong64.qcow2.zst\nzstd -d archlinux-xfce4-2023.05.10-loong64.qcow2.zst\nwget https://mirrors.wsyu.edu.cn/loongarch/archlinux/images/QEMU_EFI_7.2.fd\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u542f\u52a8 QEMU 7.2.2 \u4e86\uff1a</p> <pre><code>qemu-system-loongarch64 \\\n    -m 4G \\\n    -cpu la464-loongarch-cpu \\\n    -machine virt \\\n    -smp 4 \\\n    -bios ./QEMU_EFI_7.2.fd \\\n    -serial stdio \\\n    -device virtio-gpu-pci \\\n    -net nic -net user \\\n    -device nec-usb-xhci,id=xhci,addr=0x1b \\\n    -device usb-tablet,id=tablet,bus=xhci.0,port=1 \\\n    -device usb-kbd,id=keyboard,bus=xhci.0,port=2 \\\n    -hda archlinux-xfce4-2023.05.10-loong64.qcow2\n</code></pre> <p>\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u6b63\u5e38\u770b\u5230 Xfce4 \u7684\u754c\u9762\uff0c\u7528 loongarch:loongarch \u767b\u5f55\uff1a</p> <p></p> <p>\u5982\u679c\u4e0d\u60f3\u7528 UI\uff0c\u53ef\u4ee5\u5148\u5728\u865a\u62df\u673a\u91cc\u542f\u52a8 SSHD\uff0c\u518d\u6253\u5f00 SSH \u8f6c\u53d1\uff1a</p> <pre><code># in vm\nsudo systemctl enable --now sshd\n# in host\nqemu-system-loongarch64 \\\n    -m 4G \\\n    -cpu la464-loongarch-cpu \\\n    -machine virt \\\n    -smp 4 \\\n    -bios ./QEMU_EFI_7.2.fd \\\n    -nographic \\\n    -device virtio-net,netdev=net0 \\\n    -netdev user,id=net0,hostfwd=tcp::4444-:22 \\\n    -hda archlinux-xfce4-2023.05.10-loong64.qcow2\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7 SSH \u8bbf\u95ee LoongArch \u865a\u62df\u673a\u4e86\uff1a</p> <pre><code>$ ssh loongarch@localhost -p 4444\nloongarch@localhost's password:\n[loongarch@archlinux ~]$ uname -a\nLinux archlinux 6.3.0-12 #1 SMP Thu, 27 Apr 2023 12:24:56 +0000 loongarch64 GNU/Linux\n</code></pre>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#loongarch-\u67b6\u6784","title":"LoongArch \u67b6\u6784","text":"<p>LoongArch \u5206\u4e3a\u4e09\u4e2a\u7248\u672c\uff1a</p> <ol> <li>LoongArch 32 Reduced\uff1a\u7cbe\u7b80\u7248\u672c\uff0c\u7cfb\u7edf\u548c\u7528\u6237\u6001\u90fd\u662f 32 \u4f4d</li> <li>LoongArch 32\uff1a\u7cfb\u7edf\u548c\u7528\u6237\u6001\u90fd\u662f 32 \u4f4d</li> <li>LoongArch 64\uff1a\u7cfb\u7edf\u662f 64 \u4f4d\uff0c\u7528\u6237\u6001\u53ef\u4ee5\u662f 32 \u4f4d\uff0c\u4e5f\u53ef\u4ee5\u662f 64 \u4f4d</li> </ol> <p>\u76ee\u524d\u4e0a\u6e38\u5de5\u5177\u94fe\u652f\u6301\u7684\u662f LoongArch 64\u3002</p> <p>\u9f99\u82af\u676f\u91c7\u7528\u7684\u662f LoongArch 32 Reduced \u7248\u672c\uff0c\u76f8\u6bd4 LoongArch 32 \u7684\u533a\u522b\u6709\uff1a</p> <ol> <li>\u5220\u6389\u4e86\u90e8\u5206\u7b97\u672f\u6307\u4ee4</li> <li>\u5220\u6389\u4e86\u4f4d\u64cd\u4f5c\u6307\u4ee4</li> <li>\u5220\u9664\u4e86\u8fb9\u754c\u68c0\u67e5\u8bbf\u5b58\u6307\u4ee4</li> <li>\u5220\u9664\u4e86 Atomic \u539f\u5b50\u6307\u4ee4\uff0c\u53ea\u4fdd\u7559\u4e86 LL+SC</li> <li>\u5220\u9664\u4e86\u90e8\u5206\u6d6e\u70b9\u8fd0\u7b97\u6307\u4ee4</li> <li>\u5220\u9664\u4e86 IOCSR \u8bbf\u95ee\u6307\u4ee4</li> <li>\u5220\u9664\u4e86\u8f6f\u4ef6\u9875\u8868\u904d\u5386\u6307\u4ee4</li> <li>TLB Refill \u5f02\u5e38\u7684\u76f8\u5173 CSR\uff08ERA/BADV/PRMD/EHI/ELO0/ELO1/SAVE\uff09\u4e0d\u518d\u5355\u72ec\u63d0\u4f9b\u4e00\u4efd\uff0c\u800c\u662f\u548c\u5176\u4ed6\u5f02\u5e38\u5171\u7528</li> <li>\u53bb\u6389\u4e86 STLB\uff0c\u53ea\u4fdd\u7559\u4e86 MTLB</li> <li>\u53bb\u6389\u4e86\u90e8\u5206 CSR</li> <li>\u76f4\u63a5\u6620\u5c04\u914d\u7f6e\u7a97\u53e3\u6570\u91cf\u780d\u5230\u4e86\u4e24\u4e2a</li> <li>\u5220\u9664\u4e86 RAS\uff0cPMU\uff0cWatchpoint \u548c\u786c\u4ef6\u8c03\u8bd5\u529f\u80fd</li> </ol> <p>\u4ece\u7528\u6237\u6001\u6765\u770b\uff0c\u4e3b\u8981\u662f\u5dee\u4e86\u4e00\u4e9b\u8fd0\u7b97\u6307\u4ee4\uff0c\u9700\u8981\u7f16\u8bd1\u5668\u6ce8\u610f\u751f\u6210\u7684\u6307\u4ee4\u8303\u56f4\u3002\u5185\u6838\u6001\u4e0a\u5220\u51cf\u7684\u6bd4\u8f83\u591a\u3002</p>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#loongarch-32-reduced","title":"LoongArch 32 Reduced","text":"<p>\u9f99\u82af\u63d0\u4f9b\u4e86\u4e00\u4e9b LoongArch 32 Reduced \u7684\u5de5\u5177\u94fe\uff1a</p> <ol> <li>GCC + Binutils\uff1aloongarch32r-linux-gnusf-2022-05-20-x86.tar.gz \uff0c\u6709\u6e90\u7801\u3002</li> <li>GDB\uff1aloongarch32r-linux-gnusf-gdb-x86\uff0c\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\u8f83\u591a\uff0c\u5efa\u8bae\u8d77\u4e00\u4e2a CentOS Docker\u3002\u6ca1\u6709\u627e\u5230\u6e90\u7801\u3002</li> <li>QEMU\uff1aqemu-system-loongarch32_centos_x86_64\uff0c\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\u8f83\u591a\uff0c\u5efa\u8bae\u514b\u9686\u4e0b\u6765\u81ea\u5df1\u7f16\u8bd1\uff1a<code>mkdir build; cd build; ../configure --target-list=loongarch32-softmmu --disable-werror --enable-debug</code></li> </ol> <p>\u5728 la32r-QEMU \u4e2d\u8fd0\u884c la32r-Linux\uff1a</p> <pre><code>wget https://gitee.com/loongson-edu/la32r-Linux/releases/download/v0.2/vmlinux\nqemu-system-loongarch32 -m 4G -kernel vmlinux -M ls3a5k32 -nographic\nloongson32_init: num_nodes 1\nloongson32_init: node 0 mem 0x100000000\n[    0.000000] Linux version 5.14.0-rc2-g32a8c74db8fc-dirty (mengfanrui@5.5) (loongarch32r-linux-gnusf-gcc (GCC) 8.3.0, GNU ld (GNU Binutils) 2.31.1.20190122) #26 PREEMPT Tue May 31 13:46:54 CST 2022\n[    0.000000] Standard 32-bit Loongson Processor probed\n[    0.000000] the link is empty!\n[    0.000000] Scan bootparam failed\n[    0.000000] printk: bootconsole [early0] enabled\n[    0.000000] Can't find EFI system table.\n[    0.000000] start_pfn=0x0, end_pfn=0x8000, num_physpages:0x8000\n[    0.000000] The BIOS Version: (null)\n[    0.000000] Initrd not found or empty - disabling initrd\n[    0.000000] CPU0 revision is: 00004200 (Loongson-32bit)\n[    0.000000] Primary instruction cache 8kB, 2-way, VIPT, linesize 16 bytes.\n[    0.000000] Primary data cache 8kB, 2-way, VIPT, no aliases, linesize 16 bytes\n[    0.000000] Zone ranges:\n[    0.000000]   DMA32    [mem 0x0000000000000000-0x00000000ffffffff]\n[    0.000000]   Normal   empty\n[    0.000000] Movable zone start for each node\n[    0.000000] Early memory node ranges\n[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000007ffffff]\n[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000007ffffff]\n[    0.000000] eentry = 0xa0210000,tlbrentry = 0xa0201000\n[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 32480\n[    0.000000] Kernel command line: earlycon\n[    0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes, linear)\n[    0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes, linear)\n[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off\n[    0.000000] Memory: 117732K/131072K available (4926K kernel code, 1114K rwdata, 944K rodata, 2480K init, 473K bss, 13340K reserved, 0K cma-reserved)\n[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1\n[    0.000000] rcu: Preemptible hierarchical RCU implementation.\n[    0.000000] rcu:     RCU event tracing is enabled.\n[    0.000000]  Trampoline variant of Tasks RCU enabled.\n[    0.000000]  Tracing variant of Tasks RCU enabled.\n[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.\n[    0.000000] NR_IRQS: 320\n[    0.000000] ------------[ cut here ]------------\n[    0.000000] WARNING: CPU: 0 PID: 0 at kernel/time/clockevents.c:38 cev_delta2ns.isra.15+0x17c/0x1c8\n[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 5.14.0-rc2-g32a8c74db8fc-dirty #26\n[    0.000000] Stack :\n[    0.000000] Call Trace:\n[    0.000000]\n[    0.000000]\n[    0.000000] random: get_random_bytes called from print_oops_end_marker+0x30/0x68 with crng_init=0\n[    0.000000] ---[ end trace a8581308883ff14d ]---\n[    0.000000] Constant clock event device register\n[    0.000000] clocksource: Constant: mask: 0xffffffffffffffff max_cycles: 0xffffffffffffffff, max_idle_ns: 9007199254740991 ns\n[    0.000000] Constant clock source device register\n[    0.752000] Console: colour dummy device 80x25\n[    0.816000] printk: console [tty0] enabled\n[    0.856000] printk: bootconsole [early0] disabled\n[    0.000000] Linux version 5.14.0-rc2-g32a8c74db8fc-dirty (mengfanrui@5.5) (loongarch32r-linux-gnusf-gcc (GCC) 8.3.0, GNU ld (GNU Binutils) 2.31.1.20190122) #26 PREEMPT Tue May 31 13:46:54 CST 2022\n[    0.000000] Standard 32-bit Loongson Processor probed\n[    0.000000] the link is empty!\n[    0.000000] Scan bootparam failed\n[    0.000000] printk: bootconsole [early0] enabled\n[    0.000000] Can't find EFI system table.\n[    0.000000] start_pfn=0x0, end_pfn=0x8000, num_physpages:0x8000\n[    0.000000] The BIOS Version: (null)\n[    0.000000] Initrd not found or empty - disabling initrd\n[    0.000000] CPU0 revision is: 00004200 (Loongson-32bit)\n[    0.000000] Primary instruction cache 8kB, 2-way, VIPT, linesize 16 bytes.\n[    0.000000] Primary data cache 8kB, 2-way, VIPT, no aliases, linesize 16 bytes\n[    0.000000] Zone ranges:\n[    0.000000]   DMA32    [mem 0x0000000000000000-0x00000000ffffffff]\n[    0.000000]   Normal   empty\n[    0.000000] Movable zone start for each node\n[    0.000000] Early memory node ranges\n[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000007ffffff]\n[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000007ffffff]\n[    0.000000] eentry = 0xa0210000,tlbrentry = 0xa0201000\n[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 32480\n[    0.000000] Kernel command line: earlycon\n[    0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes, linear)\n[    0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes, linear)\n[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off\n[    0.000000] Memory: 117732K/131072K available (4926K kernel code, 1114K rwdata, 944K rodata, 2480K init, 473K bss, 13340K reserved, 0K cma-reserved)\n[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1\n[    0.000000] rcu: Preemptible hierarchical RCU implementation.\n[    0.000000] rcu:     RCU event tracing is enabled.\n[    0.000000]  Trampoline variant of Tasks RCU enabled.\n[    0.000000]  Tracing variant of Tasks RCU enabled.\n[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.\n[    0.000000] NR_IRQS: 320\n[    0.000000] ------------[ cut here ]------------\n[    0.000000] WARNING: CPU: 0 PID: 0 at kernel/time/clockevents.c:38 cev_delta2ns.isra.15+0x17c/0x1c8\n[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 5.14.0-rc2-g32a8c74db8fc-dirty #26\n[    0.000000] Stack :\n[    0.000000] Call Trace:\n[    0.000000]\n[    0.000000]\n[    0.000000] random: get_random_bytes called from print_oops_end_marker+0x30/0x68 with crng_init=0\n[    0.000000] ---[ end trace a8581308883ff14d ]---\n[    0.000000] Constant clock event device register\n[    0.000000] clocksource: Constant: mask: 0xffffffffffffffff max_cycles: 0xffffffffffffffff, max_idle_ns: 9007199254740991 ns\n[    0.000000] Constant clock source device register\n[    0.752000] Console: colour dummy device 80x25\n[    0.816000] printk: console [tty0] enabled\n[    0.856000] printk: bootconsole [early0] disabled\n[    1.024000] random: fast init done\n[    1.240000] Calibrating delay loop... 0.65 BogoMIPS (lpj=1312)\n[    1.444000] pid_max: default: 32768 minimum: 301\n[    1.860000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[    1.868000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[   10.740000] rcu: Hierarchical SRCU implementation.\n[   13.408000] devtmpfs: initialized\n[   15.948000] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns\n[   15.980000] futex hash table entries: 256 (order: -1, 3072 bytes, linear)\n[   16.948000] NET: Registered PF_NETLINK/PF_ROUTE protocol family\n[   28.832000] pps_core: LinuxPPS API ver. 1 registered\n[   28.840000] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;\n[   32.492000] clocksource: Switched to clocksource Constant\n[   32.492000] FS-Cache: Loaded\n[   32.492000] NET: Registered PF_INET protocol family\n[   32.492000] IP idents hash table entries: 2048 (order: 2, 16384 bytes, linear)\n[   32.492000] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 4096 bytes, linear)\n[   32.492000] TCP established hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[   32.492000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes, linear)\n[   32.492000] TCP: Hash tables configured (established 1024 bind 1024)\n[   32.492000] UDP hash table entries: 256 (order: 0, 4096 bytes, linear)\n[   32.492000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes, linear)\n[   32.492000] NET: Registered PF_UNIX/PF_LOCAL protocol family\n[   32.492000] workingset: timestamp_bits=14 max_order=15 bucket_order=1\n[   32.492000] IPMI message handler: version 39.2\n[   32.492000] ipmi device interface\n[   32.492000] ipmi_si: IPMI System Interface driver\n[   32.492000] ipmi_si: Unable to find any System Interface(s)\n[   32.492000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled\n[   32.492000] 1fe001e0.serial: ttyS0 at MMIO 0x1fe001e0 (irq = 18, base_baud = 2062500) is a 16550A\n[   32.492000] printk: console [ttyS0] enabled\n[   32.492000] ls1a-nand driver initializing\n[   32.492000] ls1a_nand : mtd struct base address is a102b800\n[   32.492000] info-&gt;data_buff===================0x81130000\n[   32.492000] nand: No NAND device found\n[   32.492000] ls1a-nand 1fe78000.nand: failed to scan nand\n[   32.492000] ITC MAC 10/100M Fast Ethernet Adapter driver 1.0 init\n[   32.492000] libphy: Fixed MDIO Bus: probed\n[   32.492000] mousedev: PS/2 mouse device common for all mice\n[   32.492000] IR MCE Keyboard/mouse protocol handler initialized\n[   32.492000] hid: raw HID events driver (C) Jiri Kosina\n[   32.492000] NET: Registered PF_INET6 protocol family\n[   32.492000] random: crng init done\n[   32.492000] Segment Routing with IPv6\n[   32.492000] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver\n[   32.492000] Warning: unable to open an initial console.\n[   32.492000] Freeing unused kernel image (initmem) memory: 2480K\n[   32.492000] This architecture does not have kernel memory protection.\n[   32.492000] Run /init as init process\n\nProcessing /etc/profile... Done\n\n/ #\n</code></pre> <p>\u6211\u5728 la32r-QEMU \u7684\u57fa\u7840\u4e0a\uff0c\u628a LoongArch 32 Reduced \u7684\u652f\u6301\u90e8\u5206\u79fb\u690d\u5230\u4e86 QEMU 8.0.0 \u4e0a\uff1ahttps://github.com/jiegec/qemu/commits/la32r-8.0.0\u3002</p>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u7528-crosstool-ng-\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e2a-loongarch-32-reduced-\u5de5\u5177\u94fe","title":"\u7528 crosstool-ng \u81ea\u5df1\u7f16\u8bd1\u4e00\u4e2a LoongArch 32 Reduced \u5de5\u5177\u94fe","text":"<p>\u867d\u7136\u9f99\u82af\u7ed9\u4e86\u7f16\u8bd1\u597d\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u4f46\u8fd8\u662f\u60f3\u81ea\u5df1\u7528 crosstool-ng \u7f16\u8bd1\u4e00\u4e2a\u3002\u5b8c\u6210\u7684 crosstool-ng \u914d\u7f6e\u89c1 jiegec/crosstool-ng loongarch32r\uff0c\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u6298\u817e\u7684\u8fc7\u7a0b\u3002</p> <p>\u7b2c\u4e00\u6b65\u662f\u8bbe\u7f6e\u9f99\u82af\u63d0\u4f9b\u7684\u6e90\u7801\uff0c\u7136\u540e\u628a target \u8bbe\u7f6e\u4e3a loongarch32r-unknown-linux-gnu\uff1a</p> <pre><code>CT_ARCH_ARCH=\"loongarch32r\"\nCT_ARCH_SUFFIX=\"r\"\n\n# vendor sources\nCT_LINUX_SRC_DEVEL=y\nCT_LINUX_DEVEL_URL=\"https://gitee.com/loongson-edu/la32r-Linux.git\"\nCT_BINUTILS_SRC_DEVEL=y\nCT_BINUTILS_DEVEL_URL=\"https://gitee.com/loongson-edu/la32r_binutils.git\"\nCT_GLIBC_SRC_DEVEL=y\nCT_GLIBC_DEVEL_URL=\"https://gitee.com/loongson-edu/la32r_glibc-2.28\"\nCT_GCC_SRC_DEVEL=y\nCT_GCC_DEVEL_URL=\"https://gitee.com/loongson-edu/la32r_gcc-8.3.0.git\"\n\n# no gdb available\nCT_DEBUG_GDB=n\n</code></pre> <p>\u4e0d\u77e5\u9053\u4e3a\u5565\uff0c\u9f99\u82af\u6ca1\u6709\u63d0\u4f9b LoongArch 32 Reduced \u7684 gdb \u6e90\u7801\uff0c\u5f00\u6e90\u7684 binutils \u4e0d\u5305\u62ec gdb \u7684\u90e8\u5206\u3002</p> <pre><code># Compute LoongArch-specific values\n\nCT_DoArchTupleValues() {\n    CT_TARGET_ARCH=\"loongarch${CT_ARCH_BITNESS}${CT_ARCH_SUFFIX}\"\n}\n</code></pre> <p>\u8fd9\u6837\u914d\u7f6e\u4ee5\u540e\u5f00\u59cb\u7f16\u8bd1\uff0c\u4f1a\u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\uff1a</p> <pre><code>[ERROR]      ../sysdeps/unix/sysv/linux/loongarch/init-first.c:57: error: visibility attribute not supported in this configuration; ignored [-Werror=attributes]\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a crosstool-ng \u5f00\u542f\u4e86 <code>-Werror</code>\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u8bbe\u7f6e\u5173\u95ed\u5b83\uff1a</p> <pre><code># disable -Werror\nCT_GLIBC_ENABLE_WERROR=n\n</code></pre> <p>\u8fd9\u65f6\u5019\u51fa\u73b0\u4e86\u65b0\u7684\u9519\u8bef\uff1a</p> <pre><code>[ALL  ]      dl-fxstatat64.c:(.text+0x4f5c): undefined reference to `rtld_errno'\n[ALL  ]      /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/buildtools/lib/gcc/loongarch32r-unknown-linux-gnu/8.3.0/../.\n./../../loongarch32r-unknown-linux-gnu/bin/ld: dl-fxstatat64.c:(.text+0x4f60): undefined reference to `rtld_errno'\n[ALL  ]      /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/buildtools/lib/gcc/loongarch32r-unknown-linux-gnu/8.3.0/../../../../loongarch32r-unknown-linux-gnu/bin/ld: /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/librtld.os:dl-fxstatat64.c:(.text+0x4f60): more undefined references to `rtld_errno' follow\n[ERROR]      collect2: error: ld returned 1 exit status\n</code></pre> <p>\u9605\u8bfb\u4ee3\u7801\uff0c\u53ef\u4ee5\u53d1\u73b0 <code>rtld_errno</code> \u5b9a\u4e49\u5728 <code>csu/errno.c</code> \u4e2d\uff1a</p> <pre><code>#if RTLD_PRIVATE_ERRNO\n\n/* Code compiled for rtld refers only to this name.  */\nint rtld_errno attribute_hidden;\n\n#endif\n</code></pre> <p>\u5bfb\u627e <code>RTLD_PRIVATE_ERRNO</code> \u7684\u5b9a\u4e49\uff1a</p> <pre><code>#if IS_IN (rtld)\n# define RTLD_PRIVATE_ERRNO 1\n#else\n# define RTLD_PRIVATE_ERRNO 0\n#endif\n</code></pre> <p>\u800c <code>IS_IN (rtld)</code> \u7684\u5b9a\u4e49\u662f\uff1a</p> <pre><code>/* Use `#if IS_IN (module)` to detect what component is being compiled.  */\n#define PASTE_NAME1(a,b) a##b\n#define PASTE_NAME(a,b)  PASTE_NAME1 (a,b)\n#define IN_MODULE        PASTE_NAME (MODULE_, MODULE_NAME)\n#define IS_IN(lib)       (IN_MODULE == MODULE_##lib)\n</code></pre> <p>\u7b80\u5355\u6765\u8bf4\uff0c<code>IS_IN (rtld)</code> \u5c31\u662f\u5224\u65ad <code>MODULE_NAME == rtld</code>\uff0c\u800c\u8fd9\u4e2a\u662f\u901a\u8fc7\u7f16\u8bd1\u9009\u9879\u4f20\u5165\u7684\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[ALL  ]      loongarch32r-unknown-linux-gnu-gcc  -g -O2 -U_FORTIFY_SOURCE   -march=loongarch32r         errno.c -c -std=gnu11 -fgnu89-inline  -Wall -Wundef -Wwrite-strings -fmerge-all-constants -fno-stack-protector -frounding-math -Wstrict-prototypes -Wold-style-definition -fmath-errno    -fno-stack-protector -DSTACK_PROTECTOR_LEVEL=0   -ftls-model=initial-exec      -I../include -I/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/csu  -I/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib  -I../sysdeps/unix/sysv/linux/loongarch/ilp32  -I../sysdeps/unix/sysv/linux/loongarch  -I../sysdeps/loongarch/nptl  -I../sysdeps/unix/sysv/linux/generic/wordsize-32  -I../sysdeps/unix/sysv/linux/generic  -I../sysdeps/unix/sysv/linux/include -I../sysdeps/unix/sysv/linux  -I../sysdeps/nptl  -I../sysdeps/pthread  -I../sysdeps/gnu  -I../sysdeps/unix/inet  -I../sysdeps/unix/sysv  -I../sysdeps/unix  -I../sysdeps/posix  -I../sysdeps/loongarch/ilp32  -I../sysdeps/loongarch  -I../sysdeps/init_array  -I../sysdeps/ieee754/ldbl-128  -I../sysdeps/ieee754/dbl-64  -I../sysdeps/ieee754/flt-32  -I../sysdeps/wordsize-32  -I../sysdeps/ieee754  -I../sysdeps/generic  -I.. -I../libio -I. -nostdinc -isystem /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/buildtools/lib/gcc/loongarch32r-unknown-linux-gnu/8.3.0/include -isystem /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/buildtools/lib/gcc/loongarch32r-unknown-linux-gnu/8.3.0/include-fixed -isystem /home/jiegec/x-tools/loongarch32r-unknown-linux-gnu/loongarch32r-unknown-linux-gnu/sysroot/usr/include -D_LIBC_REENTRANT -include /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/libc-modules.h -DMODULE_NAME=libc -include ../include/libc-symbols.h       -DTOP_NAMESPACE=glibc -o /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/csu/errno.o -MD -MP -MF /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/csu/errno.o.dt -MT /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/csu/errno.o\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e2d\u95f4\u662f <code>-DMODULE_NAME=libc</code>\uff0c\u800c\u4e0d\u662f <code>-DMODULE_NAME=rtld</code>\uff0c\u6240\u4ee5\u6ca1\u6709\u8fd9\u4e2a\u7b26\u53f7\u3002</p> <p>\u90a3\u4e48\u63a5\u4e0b\u6765\u8981\u627e\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u7f16\u8bd1 <code>-DMODULE_NAME=rtld</code> \u7684 <code>csu/errno.c</code>\u3002\u6b63\u597d\u4e4b\u524d\u6709\u4ea4\u53c9\u7f16\u8bd1\u5230\u5176\u4ed6 target \u7684\u4ea4\u53c9\u5de5\u5177\u94fe\uff0c\u56e0\u6b64\u53bb\u770b\u4e86\u4e00\u4e0b\uff0c\u5bf9\u5e94 <code>-DMODULE_NAME=rtld</code> \u7684\u5e94\u8be5\u662f <code>csu/rtld-errno.os</code>\uff0c\u5b83\u5e94\u8be5\u51fa\u73b0\u5728 <code>rtld-modules</code> \u4e2d\uff1a</p> <pre><code>[ALL  ]      make subdir=csu -C ../csu ..=../ objdir=/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib -f Makefile -f ../elf/rtld-Rules rtld-all rtld-modules='rtld-check_fds.os rtld-sysdep.os'\n</code></pre> <p>\u4f46\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\uff0c\u6240\u4ee5\u7ee7\u7eed\u770b <code>rtld-modules</code> \u4ece\u54ea\u91cc\u6765\uff0c\u7ee7\u7eed\u7ffb\u65e5\u5fd7\uff1a</p> <pre><code>[ALL  ]      LC_ALL=C sed -n 's@^/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/([^(]*)(([^)]*.os)) *.*$@1 2@p'     /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/librtld.map | while read lib file; do   case $lib in   libc_pic.a)     LC_ALL=C fgrep -l /$file    /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/stamp.os /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/*/stamp.os |     LC_ALL=C     sed 's@^/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/([^/]*)/stamp.os$@rtld-1'\" +=$file@\"    ;;   */*.a)     echo rtld-${lib%%/*} += $file ;;   *) echo \"Wasn't expecting $lib($file)\" &gt;&amp;2; exit 1 ;;   esac; done &gt; /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/librtld.mkT                  [ALL  ]      echo rtld-subdirs = `LC_ALL=C sed 's/^rtld-([^ ]*).*$/1/' /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/bu\nild/build-libc/multilib/elf/librtld.mkT                    | LC_ALL=C sort -u` &gt;&gt; /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/librtld.mkT \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5b83\u662f\u4ece <code>librtld.map</code> \u4e2d\u89e3\u6790\u4f9d\u8d56\u5173\u7cfb\uff0c\u7136\u540e\u751f\u6210 <code>rtld-modules</code>\u3002\u67e5\u770b <code>librtld.map</code>\uff1a</p> <pre><code>Archive member included to satisfy reference by file (symbol)\n\n/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(check_fds.os)\n                              /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/dl-allobjs.os (__libc_check_standard_fds)\n/home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(setjmp.os)\n                              /home/jiegec/ct-ng/.build/loongarch32r-unknown-linux-gnu/build/build-libc/multilib/elf/dl-allobjs.os (__sigsetjmp)\n</code></pre> <p>\u786e\u5b9e\u6ca1\u6709\u51fa\u73b0 errno.os\u3002\u627e\u4e00\u4efd\u6b63\u5e38\u7684\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5e94\u8be5\u662f\u8fd9\u6837\u7684\u8f93\u51fa\uff1a</p> <pre><code>Archive member included to satisfy reference by file (symbol)\n\n/home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(check_fds.os)\n                              /home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/elf/dl-allobjs.os (__libc_check_standard_fds)\n/home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(errno.os)\n                              /home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(check_fds.os) (__libc_errno)\n/home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/libc_pic.a(setjmp.os)\n                              /home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/build/build-libc/multilib/elf/dl-allobjs.os (__sigsetjmp)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u5c31\u6709\u4e86 <code>errno.os</code>\uff0c\u5e76\u4e14\u7b26\u53f7\u662f <code>__libc_errno</code>\u3002\u6b64\u65f6\u53bb\u770b <code>errno.os</code> \u7684\u7b26\u53f7\u8868\uff1a</p> <pre><code>SYMBOL TABLE:\n00000000 g     O .data  00000010 __emutls_v.errno\n</code></pre> <p>\u800c\u5f15\u7528 errno \u7684\u5176\u4ed6 object \u7684\u7b26\u53f7\u8868\uff1a</p> <pre><code>SYMBOL TABLE:\n00000000         *UND*  00000000 __emutls_v.__libc_errno\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5dee\u4e86\u4e00\u4e2a <code>__libc_</code> \u524d\u7f00\u3002\u5bf9\u5e94\u7684 <code>errno.c</code> \u6e90\u7801\uff1a</p> <pre><code>__thread int errno;\nextern __thread int __libc_errno __attribute__ ((alias (\"errno\")))\n  attribute_hidden;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6309\u7406\u8bf4\u5e94\u8be5\u662f\u4e24\u4e2a\u7b26\u53f7\uff0c\u540e\u8005\u662f\u4e00\u4e2a alias\u3002\u4f46\u5b9e\u9645\u751f\u6210\u7b26\u53f7\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u4e86\u540e\u8005\u3002\u6b64\u65f6\u5bf9\u6bd4\u4e00\u4e0b\u53e6\u4e00\u4e2a\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u6e90\u7801\uff0c\u53d1\u73b0\u5b83\u6ca1\u6709 __emutls_v \u7684\u524d\u7f00\uff0c\u7b26\u53f7\u4e5f\u662f\u6b63\u786e\u7684\uff0c\u56e0\u6b64\u5728 crosstool-ng \u4e2d\u6253\u5f00 TLS\uff1a</p> <pre><code># target supports tls\n# fix glibc undefined rtld_errno\nCT_CC_GCC_CONFIG_TLS=y\n</code></pre> <p>\u91cd\u65b0\u7f16\u8bd1\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\uff0c\u8981\u4e48\u662f\u9f99\u82af\u63d0\u4f9b\u7684\u5b9e\u73b0\u6709\u95ee\u9898\uff0c\u8981\u4e48\u5c31\u662f alias \u548c TLS \u51b2\u7a81\uff0c\u8fd9\u91cc\u6ca1\u6709\u6df1\u7a76\uff0c\u4e0d\u786e\u5b9a\u662f\u4ec0\u4e48\u95ee\u9898\u3002</p> <p>\u9047\u5230\u7684\u4e0b\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u627e\u4e0d\u5230 <code>crti.o</code>\uff1a</p> <pre><code>[ALL  ]    /home/jiegec/x-tools/loongarch32r-unknown-linux-gnu/loongarch32r-unknown-linux-gnu/bin/ld: cannot find crti.o: No such file or directory\n[ERROR]    collect2: error: ld returned 1 exit status                                                                             [E\n</code></pre> <p>\u628a\u547d\u4ee4\u6284\u4e0b\u6765\uff0c\u6dfb\u52a0 --verbose \u53c2\u6570\uff0c\u4f1a\u53d1\u73b0\u662f\u56e0\u4e3a LIBRARY_ROOT \u7f3a\u5c11 sysroot \u4e0b\u9762\u7684 usr/lib \u8def\u5f84\uff0c\u800c\u5b83\u671f\u671b\u7684\u8def\u5f84\u662f sysrooot \u4e0b\u9762\u7684 lib32/sf \u8def\u5f84\uff0c\u6240\u4ee5\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u6253\u5f00 MULTILIB \u6a21\u5f0f\uff1a</p> <pre><code># fix gcc crt1.o not found\nCT_MULTILIB=y\n</code></pre> <p>\u5230\u8fd9\u91cc\u5c31\u89e3\u51b3\u4e86\u6240\u6709\u5de5\u5177\u94fe\u65b9\u9762\u7684\u95ee\u9898\u4e86\uff0c\u5269\u4e0b\u662f\u4e00\u4e24\u4e2a crosstool-ng \u7684\u5c0f\u95ee\u9898\uff0c\u5728\u547d\u4ee4\u540e\u9762\u6dfb\u52a0 <code>|| true</code> \u4ee5\u540e\u7ed5\u8fc7\u4e86\u3002</p>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u865a\u5b9e\u5730\u5740\u6620\u5c04","title":"\u865a\u5b9e\u5730\u5740\u6620\u5c04","text":"<p>LoongArch \u6709\u4e24\u79cd\u865a\u5b9e\u5730\u5740\u6620\u5c04\u65b9\u6cd5\uff1a</p> <ol> <li>\u76f4\u63a5\u5730\u5740\u7ffb\u8bd1\u6a21\u5f0f\uff08CSR.CRMD.DA=1\uff0cCSR.CRMD.PG=0\uff09\uff0c\u6b64\u65f6\u7269\u7406\u5730\u5740\u7b49\u4e8e\u865a\u62df\u5730\u5740\uff0c\u5982\u679c\u865a\u62df\u5730\u5740\u4f4d\u6570\u66f4\u591a\uff0c\u5219\u622a\u65ad\u9ad8\u4f4d\u3002</li> <li>\u6620\u5c04\u5730\u5740\u7ffb\u8bd1\u6a21\u5f0f\uff08CSR.CRMD.DA=0\uff0cCSR.CRMD.PG=1\uff09\uff0c\u6b64\u65f6\u6309\u7167\u987a\u5e8f\u8fdb\u884c\u4e0b\u9762\u7684\u7ffb\u8bd1\uff1a<ol> <li>\u76f4\u63a5\u6620\u5c04\u6a21\u5f0f\uff1aCSR.DMW \u5b9a\u4e49\u4e86\u56db\u4e2a\uff08LA32R \u53ea\u6709\u4e24\u4e2a\uff09\u7a97\u53e3\uff0c\u8fd9\u4e9b\u7a97\u53e3\u5185\u7684\u865a\u62df\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u662f\u5e73\u79fb\u7684\u5173\u7cfb\u3002</li> <li>\u9875\u8868\u6620\u5c04\u6a21\u5f0f\uff1a\u5982\u679c\u6ca1\u6709\u5339\u914d\u4e0a\u76f4\u63a5\u6620\u5c04\u6a21\u5f0f\uff0c\u5219\u4f1a\u67e5\u8be2 TLB\u3002\u867d\u8bf4\u662f\u9875\u8868\u6620\u5c04\u6a21\u5f0f\uff0c\u4f46\u4f9d\u7136\u662f MIPS \u4f20\u7edf\u7684 TLB \u505a\u6cd5\u3002</li> </ol> </li> </ol> <p>\u76f8\u6bd4 MIPS \u6765\u8bb2\uff0cLoongArch \u7684\u5730\u5740\u6620\u5c04\u8fd8\u662f\u5bb9\u6613\u7406\u89e3\u4e00\u4e9b\u3002</p> <p>\u4ece\u590d\u4f4d\u4e2d\u51fa\u6765\u7684\u65f6\u5019\uff0cCSR.CRMD.DA=1\uff0cCSR.CRMD.PG=0\uff0c\u610f\u5473\u7740\u662f\u76f4\u63a5\u5730\u5740\u7ffb\u8bd1\u6a21\u5f0f\u3002PC \u662f 0x1C000000\uff0c\u7531\u4e8e\u662f\u76f4\u63a5\u5730\u5740\u7ffb\u8bd1\u6a21\u5f0f\uff0c\u6240\u4ee5\u7269\u7406\u5730\u5740\u4e5f\u662f 0x1C000000\u3002</p> <p>\u5728\u9047\u5230 TLB Refill \u5f02\u5e38\u7684\u65f6\u5019\uff0c\u5904\u7406\u5668\u4f1a\u8df3\u5230 CSR.TLBRENTRY \u7684\u5730\u5740\uff0c\u540c\u65f6\u8fdb\u5165\u76f4\u63a5\u5730\u5740\u7ffb\u8bd1\u6a21\u5f0f\uff08CSR.CRMD.DA=1\uff0cCSR.CRMD.PG=0\uff09\uff0c\u610f\u5473\u7740\u865a\u62df\u5730\u5740\u76f4\u63a5\u5bf9\u5e94\u7269\u7406\u5730\u5740\uff0c\u6240\u4ee5\u6b64\u65f6\u9700\u8981\u505a\u597d\u76f8\u5e94\u7684\u51c6\u5907\u3002LoongArch \u63d0\u4f9b\u4e86 lddir \u548c ldpte \u6307\u4ee4\u6765\u52a0\u5feb\u9875\u8868\u5230 TLB \u9879\u76ee\u7684\u67e5\u8be2\u6027\u80fd\uff0c\u4f8b\u5982\u4e0b\u9762\u662f EDK2 \u7684 TLB Refill \u5f02\u5e38\u5904\u7406\u51fd\u6570\uff1a</p> <pre><code>ASM_PFX(HandleTlbRefill):\n  csrwr T0, LOONGARCH_CSR_TLBRSAVE\n  csrrd T0, LOONGARCH_CSR_PGD\n  lddir T0, T0, 3   #Put pud BaseAddress into T0\n  lddir T0, T0, 2   #Put pmd BaseAddress into T0\n  lddir T0, T0, 1   #Put pte BaseAddress into T0\n  ldpte T0, 0\n  ldpte T0, 1\n  tlbfill\n  csrrd T0, LOONGARCH_CSR_TLBRSAVE\n  ertn\n</code></pre> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0ccsrwr \u6307\u4ee4\u4f1a\u628a\u65e7\u7684 CSR \u503c\u5199\u56de\u5230\u901a\u7528\u5bc4\u5b58\u5668\u91cc\uff0c\u6240\u4ee5\u770b\u8d77\u6765\u540d\u5b57\u662f write\uff0c\u5176\u5b9e\u662f swap\u3002\u4e3a\u4e86\u65b9\u4fbf\u67e5\u8868\uff0c\u8fd8\u7ed9\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u5206\u522b\u4e00\u4e2a\u9875\u8868\u57fa\u5730\u5740\uff1aCSR.PGDL\uff0cCSR.PGDH\uff0c\u6839\u636e\u5f02\u5e38\u7684\u9ad8\u4f4d\u5224\u65ad\u8981\u9009\u62e9\u54ea\u4e00\u4e2a\u9875\u8868\u57fa\u5730\u5740\u3002</p>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u5185\u6838\u652f\u6301","title":"\u5185\u6838\u652f\u6301","text":"<p>CPU\uff1a</p> <ul> <li>SMT: 6.5</li> <li>LSX/LASX: 6.5</li> <li>CRC32 \u52a0\u901f\uff1a6.4</li> </ul> \u529f\u80fd 3A5000 3A6000 SMT N/A 6.5 LSX/LASX 6.5 6.5 LBT WIP WIP <p>\u6865\u7247\uff1a</p> <ul> <li>RTC(LOON0001): RTC_DRV_LOONGSON 6.5</li> <li>GPIO(LOON0002): GPIO_LOONGSON_64BIT 6.4</li> <li>I2C(LOON0004): I2C_LS2X 6.3</li> <li>GMAC(0014:7a03): 5.14</li> <li>GNET(0014:7a13): WIP</li> <li>EHCI(0014:7a14): ok</li> <li>OHCI(0014:7a24): ok</li> <li>XHCI(0014:7a34): ok</li> <li>GPU1(0014:7a15): ?</li> <li>GPU2(0014:7a25): ?</li> <li>Display Controller 1(0014:7a06): WIP</li> <li>Display Controller 2(0014:7a36): WIP</li> <li>HD-Audio(0014:7a07): 6.5</li> <li>AC97(0014:7a17): ?</li> <li>I2S(0014:7a27): ?</li> <li>SATA(0014:7a[01]8): ok</li> <li>PCIE(0014:7a[0-6]9): ok</li> <li>SPI1(0014:7a0b): WIP</li> <li>SPI2(0014:7a1b): WIP</li> <li>LPC(0014:7a0c): ?</li> </ul> \u529f\u80fd 7A1000 7A2000 RTC(LOON0001) 6.5 6.5 GPIO(LOON0002) 6.4 6.4 I2C(LOON0004) 6.3 6.3 GMAC(0014:7a03) 5.14 N/A GNET(0014:7a13) N/A WIP EHCI(0014:7a14) OK OK OHCI(0014:7a24) OK OK XHCI(0014:7a34) N/A OK GPU1(0014:7a15) ? N/A GPU2(0014:7a25) N/A ? DC1(0014:7a06) WIP N/A DC2(0014:7a36) N/A WIP HDA(0014:7a07) 6.5 6.5 AC97(0014:7a17) ? N/A I2S(0014:7a27) N/A ? SATA(0014:7a[01]8) OK OK PCIE(0014:7a[0-6]9) OK OK SPI1(0014:7a0b) WIP N/A SPI2(0014:7a1b) N/A WIP LPC(0014:7a0c) ? ? <p>PCIe device id:</p> <ul> <li>CONF: 7a10, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>APB: 7a02, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>GMAC: 7a03, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>GNET: 7a13, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>DWC2: 7a04, <code>linux/drivers/usb/dwc2/params.c</code></li> <li>EHCI: 7a14</li> <li>OHCI: 7a24</li> <li>XHCI: 7a34</li> <li>GPU1: 7a15</li> <li>GPU2: 7a25</li> <li>DC1: 7a06, <code>linux/arch/loongarch/pci/pci.c</code>, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>DC2: 7a36, <code>linux/arch/loongarch/pci/pci.c</code>, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>HDA: 7a07, <code>linux/include/linux/pci_ids.h</code></li> <li>AC97: 7a17</li> <li>I2S: 7a27, <code>linux/sound/soc/loongson/loongson_i2s_pci.c</code></li> <li>HDMI: 7a37, <code>linux/include/linux/pci_ids.h</code>, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>AHCI: 7a[01]8, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>SPI: 7a[01]b, <code>linux/drivers/spi/spi-loongson-pci.c</code></li> <li>LPC: 7a0c, <code>linux/drivers/pci/controller/pci-loongson.c</code></li> <li>RIO: 7a1d</li> <li>DMA: 7a0f</li> <li>IOMMU: 7a1f</li> </ul>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#lsxlasx-\u76f8\u5173\u8fdb\u5c55","title":"LSX/LASX \u76f8\u5173\u8fdb\u5c55","text":"<ul> <li>GCC\uff1aWIP Add Loongson SX/ASX instruction support to LoongArch target.</li> <li>LLVM:<ul> <li>18 [LoongArch] Add LASX intrinsic support</li> <li>18 [LoongArch] Add LSX intrinsic support</li> <li>17 [LoongArch] Support InlineAsm for LSX and LASX</li> <li>17 [LoongArch] Add definition for LASX instructions</li> <li>17 [LoongArch] Add definition for LSX instructions</li> </ul> </li> <li>Binutils:<ul> <li>2.41 LoongArch: Add LSX and LASX instructions support</li> </ul> </li> <li>Glibc:<ul> <li>2.39 String acceleration</li> </ul> </li> <li>Linux:<ul> <li>6.5 LoongArch: Add vector extensions support</li> <li>6.6 LoongArch: Add SIMD-optimized XOR routines</li> </ul> </li> <li>OpenBLAS:<ul> <li>0.3.24 LoongArch64: Add sgemm_kernel</li> <li>0.3.24 LoongArch64: Update dgemm kernel</li> <li>0.3.24 LoongArch64: Add dgemv_t_8_lasx.S and dgemv_n_8_lasx.S</li> <li>0.3.20 loongarch64: Optimize dgemm_kernel</li> </ul> </li> <li>OpenJPEG:<ul> <li>WIP Add loongarch 256-bit LASX SIMD optimization</li> </ul> </li> <li>x264:<ul> <li>WIP loongarch: support LoongArch LSX and LASX optimization</li> </ul> </li> <li>OpenH264:<ul> <li>add simd optimizations and fix for loongarch</li> <li>Add LoongArch SIMD.</li> </ul> </li> <li>OpenSSL:<ul> <li>3.1.0 Add vpaes-loongarch64.pl module.</li> </ul> </li> <li>PCRE2:<ul> <li>WIP jit: Add LoongArch SX 128 bit SIMD Support.</li> </ul> </li> <li>libjpeg-turbo:<ul> <li>WIP LoongArch64 LSX and LASX SIMD implementation.</li> </ul> </li> </ul>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2023/06/12/try-loongarch/#\u672a\u6765\u4ea7\u54c1","title":"\u672a\u6765\u4ea7\u54c1","text":"<p>\u6765\u6e90\uff1ahttp://roadshow.sseinfo.com/roadshowIndex.do?id=14977</p> <ul> <li>3B7000 \u662f 8 \u4e2a\u5927\u6838\uff0c\u662f\u5bf9 3B6000 \u7684\u5de5\u827a\u5347\u7ea7\u3002</li> <li>3C6000 \u9884\u8ba1\u8fd8\u6709 2-3 \u4e2a\u6708\u8bbe\u8ba1\u5b8c\u6210\uff0c2023 \u5e74\u6d41\u7247\u3002</li> <li>3B6000 \u9884\u8ba1 2024 H2 \u6d41\u7247\uff0c3B6000 \u5904\u7406\u5668\u6838\u51c6\u5907\u5728 3A6000 \u7684 LA664 \u57fa\u7840\u4e0a\u518d\u4f18\u5316\u4e00\u8f6e\uff0c8 \u6838\uff0c\u5185\u5b58\u63a5\u53e3\u51c6\u5907\u5347\u7ea7\u5230 DDR5\u30023B6000 \u662f 8 \u6838 16 \u7ebf\u7a0b\u3002</li> <li>2K3000 \u9884\u8ba1 2024 H1 \u6d41\u7247\uff0c\u96c6\u6210 8 \u4e2a LA364 \u5904\u7406\u5668\u6838\uff0c\u5185\u7f6e\u81ea\u7814 GPGPU\uff0c\u662f\u5355\u7247 SOC \u89e3\u51b3\u65b9\u6848\u3002</li> <li>3A6000 \u5904\u7406\u5668\u56db\u5b63\u5ea6\u5f00\u53d1\u5e03\u4f1a\uff0c\u6574\u673a\u4f01\u4e1a\u540c\u6b65\u53d1\u5e03\u6574\u673a\u4ea7\u54c1\u3002</li> <li>2P0500 \u6253\u5370\u673a\u82af\u7247\u5df2\u7ecf\u7814\u5236\u6210\u529f\uff0c\u8be5\u82af\u7247\u53ca\u6253\u5370\u673a\u4ea7\u54c1\u5c06\u5728\u4eca\u5e74\u56db\u5b63\u5ea6\u4e0e 3A6000 \u540c\u6b65\u53d1\u5e03\u3002</li> <li>\u6539\u8fdb\u578b 7A2000 \u4e0e\u539f 7A2000 \u517c\u5bb9\uff0c\u9884\u8ba1\u6bd4 3A6000 \u665a 3-6 \u6708\u4e0a\u5e02\u3002</li> <li>\u72ec\u7acb\u663e\u5361 2025 \u5e74\u4e0a\u5e02\uff0c\u652f\u6301\u901a\u7528\u8ba1\u7b97\u548c AI \u8ba1\u7b97\u7684\u52a0\u901f\u529f\u80fd\u3002</li> <li>\u65b0 ABI\uff08\u65b0\u4e16\u754c\uff09\u5185\u6838\u7684 Loongnix \u7684\u64cd\u4f5c\u7cfb\u7edf\u968f\u5f00\u6e90 Debian \u4e00\u8d77\u4e0a\u7ebf\uff0c\u6700\u8fd1\u82b1\u4e86\u5f88\u591a\u529f\u592b\u5b9e\u73b0\u8001 ABI\uff08\u8001\u4e16\u754c\uff09\u7cfb\u7edf\u7684\u5e94\u7528\u5728\u65b0 ABI \u7cfb\u7edf\u4e0a\u517c\u5bb9\u3002</li> </ul>","tags":["loongarch","la64","la32","la32r","qemu"]},{"location":"hardware/2022/03/12/try-openroad-flow/","title":"OpenROAD Flow \u521d\u5c1d\u8bd5","text":"","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5c1d\u8bd5\u63a5\u89e6\u4e00\u4e9b\u82af\u7247\u524d\u540e\u7aef\u7684\u77e5\u8bc6\u3002\u6b63\u597d\u6709\u73b0\u6210\u7684\u5f00\u6e90\u5de5\u5177\u94fe OpenROAD \u6765\u505a\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u501f\u6b64\u673a\u4f1a\u6765\u5b66\u4e60\u4e00\u4e0b\u6574\u4e2a\u6d41\u7a0b\u3002</p>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#\u5c1d\u8bd5\u8fc7\u7a0b","title":"\u5c1d\u8bd5\u8fc7\u7a0b","text":"<p>\u9996\u5148 clone \u4ed3\u5e93 OpenROAD-flow-scripts\uff0c\u7136\u540e\u8fd0\u884c\uff1a<code>./build_openroad.sh</code>\uff0c\u811a\u672c\u4f1a\u514b\u9686\u4e00\u4e9b\u4ed3\u5e93\uff0c\u81ea\u52a8\u8fdb\u884c\u7f16\u8bd1\u3002</p> <p>\u7f16\u8bd1\u4e2d\u4f1a\u627e\u4e0d\u5230\u4e00\u4e9b\u5e93\uff0c\u6bd4\u5982\u53ef\u80fd\u9700\u8981\u5b89\u88c5\u8fd9\u4e9b\u4f9d\u8d56\uff1a<code>liblemon-dev libeigen3-dev libreadline-dev swig</code>\uff0c\u6b64\u5916\u8fd0\u884c\u7684\u65f6\u5019\u8fd8\u9700\u8981 <code>klayout</code> \u4f9d\u8d56\u3002</p> <p>\u5982\u679c\u9047\u5230\u89e3\u51b3 cmake \u627e\u4e0d\u5230 LEMON \u7684\u95ee\u9898\uff0c\u8fd9\u662f\u4e00\u4e2a BUG\uff0c\u53ef\u4ee5\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u89e3\u51b3\uff1a</p> <pre><code>cd /usr/lib/x86_64-linux-gnu/cmake/lemon\ncp lemonConfig.cmake LEMONConfig.cmake\n</code></pre> <p>\u7f16\u8bd1\u540e\u6574\u4e2a\u76ee\u5f55\u5927\u6982\u6709 4.8G\uff0c\u8f93\u51fa\u7684\u4e8c\u8fdb\u5236\u76ee\u5f55\u662f 133M\u3002</p> <p>\u5982\u679c\u8981\u8dd1\u4e00\u4e0b\u6837\u4f8b\u91cc\u7684 nangate45 \u5de5\u827a\u7684 gcd \u4f8b\u5b50\uff0c\u8fd0\u884c\uff1a</p> <pre><code>cd flow\nmake DESIGN_CONFIG=./designs/nangate45/gcd/config.mk\n</code></pre>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#\u5206\u6790-gcd-\u6d4b\u4f8b","title":"\u5206\u6790 GCD \u6d4b\u4f8b","text":"<p>\u8fd9\u4e2a\u6d4b\u4f8b\u7684\u4ee3\u7801\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u4e2a\u63a5\u53e3\uff1a</p> <pre><code>module gcd\n(\n  input  wire clk,\n  input  wire [  31:0] req_msg,\n  output wire req_rdy,\n  input  wire req_val,\n  input  wire reset,\n  output wire [  15:0] resp_msg,\n  input  wire resp_rdy,\n  output wire resp_val\n);\nendmodule\n</code></pre> <p>\u4ece\u540d\u5b57\u53ef\u4ee5\u63a8\u65ad\u51fa\uff0c\u5916\u90e8\u901a\u8fc7 req \u53d1\u9001\u8bf7\u6c42\u5230 GCD \u6a21\u5757\uff0c\u7136\u540e\u6a21\u5757\u8ba1\u7b97\u51fa GCD \u540e\u518d\u8fd4\u56de\u7ed3\u679c\u3002</p> <p>\u6839\u636e\u65e5\u5fd7\u53ef\u4ee5\u770b\u5230\uff0c\u4ece verilog \u5230\u6700\u7ec8\u7684 gds \u6587\u4ef6\uff0c\u7ecf\u8fc7\u4e86\u8fd9\u4e9b\u6b65\u9aa4\uff1a</p> <ol> <li>\u7b2c\u4e00\u6b65\u7528 yosys \u7efc\u5408\uff081_1_yosys\uff09\uff0c\u628a verilog \u4ee3\u7801\u8f6c\u5316\u4e3a\u7f51\u8868\uff0c\u7f51\u8868\u4e2d\u7684\u5355\u5143\u5c31\u662f\u5f62\u5982 <code>NAND2_X1</code> <code>DFF_X1</code> \u7b49\u8fd9\u6837\u7531\u5de5\u827a\u5e93\u5b9a\u4e49\u7684\u4e00\u4e9b\u5355\u5143\u3002</li> <li>\u7b2c\u4e8c\u6b65\u8fdb\u884c floorplan\uff082_1_floorplan\uff09\uff0c\u89c4\u5212\u51fa\u82af\u7247\u7684\u5927\u5c0f\uff0c\u903b\u8f91\u653e\u5728\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u8f93\u5165\u8f93\u51fa\u5f15\u811a\u653e\u5728\u4ec0\u4e48\u4f4d\u7f6e\uff082_2_floorplan_io\uff09\uff0c\u8fd8\u8981\u8003\u8651 SRAM \u7b49\u5b8f\u6216\u8005 IP\uff082_4_mplace\uff09\uff0c\u7535\u6e90\u7f51\u7edc PDN\uff082_6_floorplan_pdn\uff09</li> <li>\u7b2c\u4e09\u6b65\u662f Placement\uff0c\u5c31\u662f\u628a\u524d\u9762\u5f97\u5230\u7684\u4e00\u4e9b cell \u653e\u5230\u82af\u7247\u4e0a\u7684 (x,y) \u5750\u6807\u4e0a</li> <li>\u7b2c\u56db\u6b65\u662f Clock Tree Synthesis\uff084_1_cts\uff09\uff0c\u7b80\u79f0 CTS\uff0c\u751f\u6210\u65f6\u949f\u6811</li> <li>\u7b2c\u4e94\u6b65\u662f\u8fdb\u884c\u8def\u7531\u8fde\u7ebf\uff0cOpenROAD \u6709\u4e24\u4e2a\u8def\u7531\uff1aFastRoute\uff085_1_fastroute\uff09\u548c TritonRoute\uff085_2_TritonRoute\uff09</li> <li>\u7b2c\u516d\u6b65\u8f93\u51fa\u7ed3\u679c\u5230 gds \u6587\u4ef6\uff086_1_merge\uff09\u3002</li> </ol> <p>\u8fd9\u4e9b\u6b65\u9aa4\u53ef\u4ee5\u5728\u4ed3\u5e93\u7684 <code>flow/Makefile</code> \u91cc\u9762\u770b\u5f97\u6bd4\u8f83\u6e05\u6670\uff0c\u82f1\u6587\u7248\u6458\u6284\u5982\u4e0b\uff1a</p> <ol> <li>SYNTHESIS<ol> <li>Run Synthesis using yosys</li> </ol> </li> <li>FLOORPLAN<ol> <li>Translate verilog to def</li> <li>IO Placement (random)</li> <li>Timing Driven Mixed Size Placement (tdms)</li> <li>Macro Placement</li> <li>Tapcell and Welltie insertion</li> <li>PDN generation</li> </ol> </li> <li>PLACE<ol> <li>Global placement without placed IOs, timing-driven, and routability-driven</li> <li>IO placement (non-random)</li> <li>Global placement with placed IOs, timing-driven, and routability-driven</li> <li>Resizing &amp; Buffering</li> <li>Detail placement</li> </ol> </li> <li>CTS(Clock Tree Synthesis)<ol> <li>Run TritonCTS</li> <li>Filler cell insertion</li> </ol> </li> <li>ROUTING<ol> <li>Run global route (FastRoute)</li> <li>Run detailed route (TritonRoute)</li> </ol> </li> </ol> <p>\u6700\u540e\u751f\u6210\u7684 gds\uff0c\u7528 KLayout \u6253\u5f00\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u6837\u5b50\uff1a</p> <p></p> <p>\u65e5\u5fd7\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u9884\u6d4b\u7684\u603b\u529f\u8017\u662f 1.71 mW\uff0c\u9762\u79ef\u5360\u7528\u662f 703 um^2\u3002</p> <p>\u8fd8\u8dd1\u4e86\u4e00\u4e0b\u5176\u4ed6\u6837\u4f8b\u8bbe\u8ba1\u7684 gds\uff0c\u6bd4\u5982 ibex\uff1a</p> <p></p> <p>\u65e5\u5fd7\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u9884\u6d4b\u7684\u603b\u529f\u8017\u662f 10.1 mW\uff0c\u9762\u79ef\u5360\u7528\u662f 32176 um^2\u3002</p> <p>\u8fd8\u6709 tiny rocket\uff1a</p> <p></p> <p>\u65e5\u5fd7\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u9884\u6d4b\u7684\u603b\u529f\u8017\u662f 36.8 mW\uff0c\u9762\u79ef\u5360\u7528\u662f 52786 um^2\u3002</p>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#\u5de5\u827a\u5e93\u5e38\u89c1\u672f\u8bed","title":"\u5de5\u827a\u5e93\u5e38\u89c1\u672f\u8bed","text":"<ul> <li>slvt/lvt/rvt/hvt: super-low/low/regular/high V threshold \u524d\u8005\u901f\u5ea6\u5feb\uff1a\u9608\u503c\u7535\u538b\u4f4e\uff0c\u540c\u65f6\u6f0f\u7535\u6d41\u5927</li> <li>ss/tt/ff: slow-slow/typical-typical/fast-fast \u540e\u8005\u901f\u5ea6\u5feb\uff1a\u7535\u538b\u9ad8\uff0c\u6e29\u5ea6\u4f4e\uff0c\u6bd4\u5982 SS\uff080.99V 125C\uff09TT\uff081.10V 25C\uff09FF\uff081.21V -40C\uff09\uff1b\u6709\u65f6\u5019\u8fd8\u4f1a\u770b\u5230 ssg\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a ss \u7684\u6bd4\u8f83\u7cbe\u786e\u7684\u7248\u672c\uff0c\u56e0\u6b64\u6ca1\u6709\u90a3\u4e48\u60b2\u89c2\uff0c\u5ef6\u8fdf\u6bd4 SS \u4f4e\u4e00\u4e9b\uff0c\u8be6\u89c1 STA | ssg \u8ddf ss corner \u7684\u533a\u522b\u2014\u2014\u8c2c\u8bef\u66f4\u6b63\u7248</li> <li>c+\u6570\u5b57\uff1a\u8868\u793a\u7684\u662f channel length\uff0cc40 \u8868\u793a 40nm\uff0c\u6570\u5b57\u8d8a\u5927\u901f\u5ea6\u8d8a\u6162\uff0c\u80fd\u8017\u8d8a\u4f4e</li> <li>\u6570\u5b57+track\uff1a\u8868\u793a\u7684\u662f track height\uff0csc12 \u8868\u793a 12-track\uff0c\u6570\u5b57\u8d8a\u5927\u901f\u5ea6\u8d8a\u5feb</li> </ul> <p>ARM \u7684\u6587\u6863 Choosing the physical IP libraries \u63cf\u8ff0\u4e86 Channel length, Track height, Voltage threshold \u7b49\u4e0d\u540c\u7684\u9009\u62e9\u3002</p> <p>\u7efc\u5408\u6765\u8bf4\uff0c\u5982\u679c\u8981\u66f4\u4f4e\u7684\u5ef6\u8fdf\uff0c\u9009\u62e9\u4f4e vt\uff0c\u5c0f c \u548c\u5927 track\uff0c\u53cd\u4e4b\u5982\u679c\u8981\u66f4\u4f4e\u7684\u80fd\u8017\uff0c\u9009\u62e9\u9ad8 vt\uff0c\u5927 c \u548c \u5c0f track\u3002</p>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#ccs-vs-nldm","title":"CCS v.s. NLDM","text":"<p>\u7531\u4e8e\u7269\u7406\u7684\u7279\u6027\u6bd4\u8f83\u590d\u6742\uff0c\u5de5\u827a\u5e93\u91cc\u63cf\u8ff0\u7684\u4e5f\u53ea\u662f\u4e00\u4e2a\u5927\u81f4\u7684\u6a21\u578b\uff0c\u523b\u753b\u4e86\u8fd9\u4e9b cell \u7684\u7279\u6027\uff0c\u90a3\u4e48\u81ea\u7136\u53ef\u4ee5\u9009\u53d6\u4e0d\u540c\u7684\u6a21\u578b\u3002NLDM\uff08\u4e0a\u9762\u4e3e\u7684\u4f8b\u5b50\u5c31\u662f NLDM\uff09\uff0cCCS \u5c31\u662f\u5e38\u89c1\u7684\u4e24\u4e2a\u6a21\u578b\uff0c\u76f8\u6bd4\u4e4b\u4e0b\uff0cCCS \u66f4\u7cbe\u786e\uff0c\u540c\u65f6\u53c2\u6570\u66f4\u591a\u3002\u66f4\u7cbe\u786e\u7684\u8fd8\u6709\u76f4\u63a5\u7528 SPICE \u63cf\u8ff0\u7684\u7535\u8def\u3002\u8be6\u7ec6\u7684\u5bf9\u6bd4\u53ef\u4ee5\u770b\u4e0b\u9762\u7684\u53c2\u8003\u6587\u6863\u3002</p>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/03/12/try-openroad-flow/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>GETTING STARTED WITH OPENROAD APP \u2013 PART 1</li> <li>Advanced ASIC Chip Synthesis Using Synopsys\u00ae Design Compiler\u2122 Physical Compiler\u2122 and PrimeTime\u00ae</li> <li>Comparing NLDM And CCS delay models</li> <li>Introduction to Liberty : CCS, ECSM and NDLM</li> <li>STA \u6982\u5ff5\uff1a\u4e00\u6587\u4e86\u89e3 NLDM \u4e0e CCS</li> </ul>","tags":["openroad","synthesis","yosys"]},{"location":"hardware/2022/11/23/upgrade-mlnx-firmware/","title":"\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6","text":"","tags":["mellanox","mlnx","nvidia","infiniband","firmware"]},{"location":"hardware/2022/11/23/upgrade-mlnx-firmware/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u53d1\u73b0\u6709\u4e00\u53f0\u673a\u5668\uff0c\u63d2\u4e0a ConnectX-4 IB \u7f51\u5361\u540e\uff0c\u5185\u6838\u6a21\u5757\u53ef\u4ee5\u8bc6\u522b\u5230\u8bbe\u5907\uff0c\u4f46\u662f\u65e0\u6cd5\u4f7f\u7528\uff0c\u73b0\u8c61\u662f <code>ibstat</code> \u7b49\u547d\u4ee4\u90fd\u770b\u4e0d\u5230\u8bbe\u5907\u3002\u964d\u7ea7 OFED \u4ece 5.8 \u5230 5.4 \u4ee5\u540e\u95ee\u9898\u6d88\u5931\uff0c\u6240\u4ee5\u8ba4\u4e3a\u53ef\u80fd\u662f\u65b0\u7684 OFED \u4e0e\u6bd4\u8f83\u65e7\u7684\u56fa\u4ef6\u7248\u672c\u6709\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u6240\u4ee5\u5c1d\u8bd5\u5347\u7ea7\u7f51\u5361\u56fa\u4ef6\u3002\u5347\u7ea7\u4ee5\u540e\uff0c\u95ee\u9898\u5c31\u6d88\u5931\u4e86\u3002</p>","tags":["mellanox","mlnx","nvidia","infiniband","firmware"]},{"location":"hardware/2022/11/23/upgrade-mlnx-firmware/#\u5b89\u88c5-mft","title":"\u5b89\u88c5 MFT","text":"<p>\u9996\u5148\uff0c\u5728 https://network.nvidia.com/products/adapter-software/firmware-tools/ \u4e0b\u8f7d MFT\uff0c\u6309\u7167\u6307\u793a\u89e3\u538b\uff0c\u5b89\u88c5\u540e\uff0c\u542f\u52a8 mst \u670d\u52a1\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>mlxfwmanager</code> \u5f97\u5230\u7f51\u5361\u7684\u578b\u53f7\u4ee5\u53ca\u56fa\u4ef6\u7248\u672c\uff1a</p> <pre><code>Device Type: ConnectX4\nDescription: Mellanox ConnectX-4 Single Port EDR PCIE Adapter LP\nPSID:        DEL2180110032\nVersions:    Current\n  FW         12.20.1820\n</code></pre>","tags":["mellanox","mlnx","nvidia","infiniband","firmware"]},{"location":"hardware/2022/11/23/upgrade-mlnx-firmware/#\u5347\u7ea7\u56fa\u4ef6","title":"\u5347\u7ea7\u56fa\u4ef6","text":"<p>\u4ece PSID \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u662f DELL OEM \u7248\u672c\u7684\u7f51\u5361\uff0c\u53ef\u4ee5\u5728 https://network.nvidia.com/support/firmware/dell/ \u5904\u5bfb\u627e\u6700\u65b0\u56fa\u4ef6\uff0c\u6ce8\u610f\u9700\u8981\u4fdd\u8bc1 PSID \u4e00\u81f4\uff0c\u53ef\u4ee5\u627e\u5230\u8fd9\u4e2a PSID \u7684 DELL \u56fa\u4ef6\u5730\u5740\uff1ahttps://www.mellanox.com/downloads/firmware/fw-ConnectX4-rel-12_28_4512-06W1HY_0JJN39_Ax-FlexBoot-3.6.203.bin.zip\u3002</p> <p>\u4e0b\u8f7d\u4ee5\u540e\uff0c\u89e3\u538b\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5347\u7ea7\u56fa\u4ef6\uff1a</p> <pre><code>mlxfwmanager -u -i fw-ConnectX4-rel-12_28_4512-06W1HY_0JJN39_Ax-FlexBoot-3.6.203.bin\n</code></pre> <p>\u5347\u7ea7\u4ee5\u540e\u91cd\u542f\u5c31\u5de5\u4f5c\u4e86\u3002</p> <p>\u8003\u8651\u5230\u7c7b\u4f3c\u7684\u60c5\u51b5\u4e4b\u540e\u8fd8\u53ef\u80fd\u53d1\u751f\uff0c\u987a\u4fbf\u8fd8\u5347\u7ea7\u4e86\u5176\u4ed6\u51e0\u53f0\u673a\u5668\u7684\u7f51\u5361\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>Device Type: ConnectX4\nDescription: ConnectX-4 VPI adapter card; FDR IB (56Gb/s) and 40GbE; dual-port QSFP28; PCIe3.0 x8; ROHS R6\nPSID:        MT_2170110021\nVersions:    Current\n  FW         12.25.1020\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u7684 PSID \u662f MT_ \u5f00\u5934\uff0c\u8bf4\u660e\u662f\u5b98\u65b9\u7248\u672c\u3002\u8fd9\u4e2a\u578b\u53f7\u53ef\u4ee5\u5728 https://network.nvidia.com/support/firmware/connectx4ib/ \u627e\u5230\u6700\u65b0\u7684\u56fa\u4ef6\uff0c\u6ce8\u610f PSID \u8981\u6b63\u786e\uff0c\u53ef\u4ee5\u627e\u5230\u56fa\u4ef6\u4e0b\u8f7d\u5730\u5740 https://www.mellanox.com/downloads/firmware/fw-ConnectX4-rel-12_28_2006-MCX454A-FCA_Ax-UEFI-14.21.17-FlexBoot-3.6.102.bin.zip\u3002\u7528\u540c\u6837\u7684\u65b9\u6cd5\u66f4\u65b0\u5373\u53ef\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a ConnectX-3 \u7684\u4f8b\u5b50\uff1a</p> <pre><code>Device Type: ConnectX3\nDescription: ConnectX-3 VPI adapter card; single-port QSFP; FDR IB (56Gb/s) and 40GigE; PCIe3.0 x8 8GT/s; RoHS R6\nPSID:        MT_1100120019\nVersions:    Current\n  FW         2.36.5150\n</code></pre> <p>ConnectX-3 \u7cfb\u5217\u7684\u7f51\u5361\u56fa\u4ef6\u53ef\u4ee5\u5728 https://network.nvidia.com/support/firmware/connectx3ib/ \u627e\uff0c\u6839\u636e PSID\uff0c\u53ef\u4ee5\u627e\u5230\u56fa\u4ef6\u4e0b\u8f7d\u5730\u5740\u662f http://www.mellanox.com/downloads/firmware/fw-ConnectX3-rel-2_42_5000-MCX353A-FCB_A2-A5-FlexBoot-3.4.752.bin.zip\u3002</p>","tags":["mellanox","mlnx","nvidia","infiniband","firmware"]},{"location":"hardware/2022/11/23/upgrade-mlnx-firmware/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u5982\u679c\u9047\u5230 Mellanox \u7f51\u5361\u80fd\u8bc6\u522b PCIe\uff0c\u4f46\u662f\u4e0d\u80fd\u4f7f\u7528\uff0c\u53ef\u4ee5\u8003\u8651\u964d\u7ea7 OFED \u6216\u8005\u5347\u7ea7\u7f51\u5361\u56fa\u4ef6\u3002</p> <p>\u53ef\u4ee5\u7528 mlxfwmanager \u67e5\u770b PSID \u548c\u66f4\u65b0\u56fa\u4ef6\u3002\u6839\u636e PSID\uff0c\u5224\u65ad\u662f OEM\uff08DELL\uff09\u7248\u672c\u8fd8\u662f\u5b98\u65b9\u7248\u672c\u3002\u5982\u679c\u662f OEM \u7248\u672c\uff0c\u8981\u5230\u5bf9\u5e94 OEM \u7684\u56fa\u4ef6\u4e0b\u8f7d\u5730\u5740\u627e\uff0c\u4f8b\u5982 https://network.nvidia.com/support/firmware/dell/\uff1b\u5982\u679c\u662f\u5b98\u65b9\u7248\uff0c\u5728 https://network.nvidia.com/support/firmware/firmware-downloads/ \u627e\u3002</p>","tags":["mellanox","mlnx","nvidia","infiniband","firmware"]},{"location":"hardware/2023/12/08/vipt-l1-cache-page-size/","title":"VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb","text":"<p>VIPT\uff08Virtual Index Physical Tag\uff09\u662f L1 \u6570\u636e\u7f13\u5b58\u5e38\u7528\u7684\u6280\u672f\uff0c\u5229\u7528\u4e86\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684 Index \u76f8\u540c\u7684\u7279\u6027\uff0c\u5f97\u4ee5\u4f18\u5316 L1 \u6570\u636e\u7f13\u5b58\u7684\u8bfb\u53d6\u3002\u4f46\u662f VIPT \u7684\u4f7f\u7528\uff0c\u4e0e\u9875\u8868\u5927\u5c0f\u548c L1 \u6570\u636e\u7f13\u5b58\u5927\u5c0f\u90fd\u6709\u5173\u7cfb\u3002\u8fd9\u7bc7\u535a\u5ba2\u63a2\u8ba8\u4e00\u4e0b\uff0cVIPT \u6280\u672f\u80cc\u540e\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p>","tags":["cpu","paging","vipt","cache"]},{"location":"hardware/2023/12/08/vipt-l1-cache-page-size/#vipt-\u662f\u4ec0\u4e48","title":"VIPT \u662f\u4ec0\u4e48","text":"<p>\u4ee5\u9632\u8bfb\u8005\u4e0d\u8bb0\u5f97 VIPT \u662f\u4ec0\u4e48\uff0c\u8fd9\u91cc\u518d\u590d\u4e60\u4e00\u4e0b\u7f13\u5b58\u7684\u539f\u7406\u3002\u9996\u5148\uff0c\u628a\u6570\u636e\u7684\u7269\u7406\u5730\u5740\u5212\u5206\u4e3a\u4e09\u6bb5\uff1a</p> <ol> <li>Tag</li> <li>Index</li> <li>Offset</li> </ol> <p>\u7f13\u5b58\u7ec4\u7ec7\u6210\u591a\u8def\uff0c\u6bcf\u4e00\u8def\u6709\u82e5\u5e72\u4e2a\u9879\uff0c\u6bcf\u9879\u91cc\u9762\u662f\u4e00\u4e2a\u7f13\u5b58\u884c\u3002\u67e5\u8be2\u65f6\uff0c\u9996\u5148\u6839\u636e Index \u4f5c\u4e3a\u4e0b\u6807\uff0c\u53bb\u7d22\u5f15\u7f13\u5b58\uff0c\u5f97\u5230\u591a\u8def\u7684\u7f13\u5b58\u884c\uff1b\u7136\u540e\u518d\u7528 Tag \u548c\u591a\u8def\u7f13\u5b58\u884c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u6709\u5339\u914d\uff0c\u5219\u8bf4\u660e\u662f\u547d\u4e2d\uff1b\u5426\u5219\u5c31\u662f\u7f13\u5b58\u7f3a\u5931\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5148\u7528 Index\uff0c\u540e\u7528 Tag\uff0c\u56e0\u6b64\u5982\u679c\u53ef\u4ee5\u5148\u5f97\u5230 Index\uff0c\u5c31\u53ef\u4ee5\u63d0\u524d\u5b8c\u6210\u7b2c\u4e00\u6b65\u3002\u56de\u987e\u4e00\u4e0b\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684\u8f6c\u6362\uff1a\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684\u9875\u5185\u504f\u79fb\u662f\u76f8\u540c\u7684\uff0c\u53ea\u4f1a\u4fee\u6539\u9875\u53f7\u3002\u90a3\u4e48\uff0c\u5982\u679c\u628a Index \u653e\u5728\u9875\u5185\u504f\u79fb\u7684\u90e8\u5206\uff0c\u90a3\u5c31\u53ef\u4ee5\u5728\u865a\u5b9e\u5730\u5740\u8f6c\u6362\u4e4b\u524d\uff0c\u76f4\u63a5\u4ece\u865a\u62df\u5730\u5740\u83b7\u53d6\u5230 Index\uff0c\u5e76\u4e14\u8fd9\u4e2a Index \u4e00\u5b9a\u662f\u7269\u7406\u5730\u5740\u7684 Index\uff0c\u6bd5\u7adf\u865a\u5b9e\u5730\u5740\u8f6c\u6362\u4e0d\u4f1a\u4fee\u6539 Index\u3002\u8fd9\u5c31\u662f VIPT\u3002</p> <p>\u6240\u4ee5\u5f88\u660e\u663e\uff0cVIPT \u662f\u4e00\u79cd\u4f18\u5316\u65b9\u6cd5\uff0c\u5229\u7528\u865a\u5b9e\u8f6c\u6362\u4e2d\u9875\u5185\u504f\u79fb\u4e0d\u53d8\u7684\u7279\u6027\uff0c\u5b9e\u73b0\u66f4\u5feb\u7684\u6570\u636e\u7f13\u5b58\u8bfb\u53d6\u3002</p>","tags":["cpu","paging","vipt","cache"]},{"location":"hardware/2023/12/08/vipt-l1-cache-page-size/#vipt-\u7684\u5c40\u9650\u6027","title":"VIPT \u7684\u5c40\u9650\u6027","text":"<p>\u4f46\u540c\u65f6\uff0cVIPT \u4e5f\u7ed9 L1 \u6570\u636e\u7f13\u5b58\u5e26\u6765\u4e86\u5c40\u9650\u6027\u3002\u524d\u9762\u63d0\u5230\uff0cVIPT \u8981\u6c42 Index \u88ab\u5305\u542b\u5728\u9875\u5185\u504f\u79fb\u4e2d\uff0c\u90a3\u4e48\u53ef\u4ee5\u6765\u7b97\u4e00\u7b97\uff0cIndex \u6700\u5927\u662f\u591a\u5c11\uff1a</p> <p>\u5047\u5982\u9875\u5927\u5c0f\u662f \\(P\\)\uff0c\u6bcf\u4e2a\u7f13\u5b58\u884c\u5927\u5c0f\u662f \\(C\\)\uff0c\u4e3a\u4e86\u8ba9 Index \u5305\u542b\u5728\u9875\u5185\u504f\u79fb\u4e2d\uff0cIndex \u7684\u4e2a\u6570\uff08\u4e5f\u53eb\u505a Sets\uff09\\(I\\) \u9700\u8981\u6ee1\u8db3 \\(I * C \\le P\\)\u3002</p> <p>\u6b64\u65f6\u8003\u8651\u4e00\u4e0b\u6570\u636e\u7f13\u5b58\u7684\u603b\u5927\u5c0f\uff1a\u6bcf\u4e2a Index \u6709 Way \u8def\u7f13\u5b58\u884c\uff0c\u6240\u4ee5\u603b\u5927\u5c0f\u662f \\(I * C * W\\)\uff0c\u5176\u4e2d \\(W\\) \u6307\u7684\u662f\u8def\u6570\u3002\u6b64\u65f6\u4f60\u4f1a\u53d1\u73b0\uff0c\u6570\u636e\u7f13\u5b58\u7684\u603b\u5927\u5c0f\u4e0d\u5927\u4e8e \\(W * P\\)\uff0c\u4e5f\u5c31\u662f\u8def\u6570\u4e58\u4ee5\u9875\u7684\u5927\u5c0f\u3002</p> <p>\u6362\u53e5\u8bdd\u8bf4\uff0cL1 \u6570\u636e\u7f13\u5b58\u5927\u5c0f\uff0c\u53d7\u9650\u4e8e\u8def\u6570\u4e58\u4ee5\u9875\u7684\u5927\u5c0f\u3002\u5982\u679c\u4f60\u53bb\u67e5\u770b\u4e00\u4e9b\u5904\u7406\u5668\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u4eec\u90fd\u53d6\u5230\u4e86\u8fd9\u4e2a\u6700\u5927\u503c\uff1a</p> <ol> <li>i9-13900K: L1 \u6570\u636e\u7f13\u5b58 48KB\uff0c\\(W=12, P=4096\\)</li> <li>i9-10980XE: L1 \u6570\u636e\u7f13\u5b58 32KB\uff0c\\(W=8, P=4096\\)</li> <li>EPYC 7551: L1 \u6570\u636e\u7f13\u5b58 32KB\uff0c\\(W=8, P=4096\\)</li> <li>3A6000: L1 \u6570\u636e\u7f13\u5b58 64KB\uff0c\\(W=4, P=16384\\)</li> </ol> <p>\u6bd5\u7adf\u6bd4\u8f83\u5927\u7684 L1 \u6570\u636e\u7f13\u5b58\u5bf9\u6027\u80fd\u662f\u6709\u5e2e\u52a9\u7684\uff0c\u5f53\u7136\u4e86\uff0c\u592a\u5927\u4e86\u4e5f\u4f1a\u5bfc\u81f4 Load To Use \u5ef6\u8fdf\u589e\u52a0\uff0c\u53ef\u80fd\u5f97\u4e0d\u507f\u5931\u3002</p> <p>\u5f53\u7136\u4e86\uff0cL2 L3 \u7b49\u7f13\u5b58\u5c31\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236\u4e86\uff0c\u6bd5\u7adf\u901a\u5e38\u662f\u91c7\u7528\u7269\u7406\u5730\u5740\uff0c\u4e0d\u6d89\u53ca VIPT\u3002</p> <p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u8981\u8bf4\u4e86\uff0c\u7b49\u7b49\uff01\u4e3a\u5565\u6709\u4e00\u4e9b\u5904\u7406\u5668\u4e0d\u7b26\u5408\u8fd9\u4e2a\u89c4\u5219\uff1a</p> <ol> <li>Kunpeng-920: L1 \u6570\u636e\u7f13\u5b58 64KB\uff0c\\(W=4, P=4096\\)</li> </ol> <p>\u6b64\u65f6 \\(W * P\\) \u53ea\u6709 16KB\uff0c\u4e3a\u4ec0\u4e48\u80fd\u591f\u5b9e\u73b0 64KB \u7684\u6570\u636e\u7f13\u5b58\uff1f\u5b9e\u9645\u4e0a\uff0c\u524d\u9762\u7684\u8ba8\u8bba\u90fd\u57fa\u4e8e\u4e00\u4e2a\u5047\u8bbe\uff1a\u9875\u8868\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\u3002\u8981\u662f\u9875\u8868\u5927\u5c0f\u4e0d\u552f\u4e00\u5462\uff1f</p>","tags":["cpu","paging","vipt","cache"]},{"location":"hardware/2023/12/08/vipt-l1-cache-page-size/#\u591a\u53d8\u7684\u9875\u8868\u5927\u5c0f","title":"\u591a\u53d8\u7684\u9875\u8868\u5927\u5c0f","text":"<p>\u73b0\u5728\u4e00\u4e9b\u5904\u7406\u5668\uff0c\u7279\u522b\u662f\u975e x86 \u7684\u5904\u7406\u5668\uff0c\u901a\u5e38\u4f1a\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff1a4KB\u300116KB \u548c 64KB\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u79cd\u3002\u4f8b\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cKunpeng-920 \u5c31\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff0c\u5982\u679c\u4f60\u7528\u6570\u636e\u7f13\u5b58\u5927\u5c0f\u5012\u63a8\uff0c\u4f1a\u5f97\u5230\u9875\u8868\u662f 16KB \u7684\u7ed3\u8bba\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u8981\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff0cVIPT \u8fd8\u80fd\u6b63\u5e38\u5de5\u4f5c\u5417\uff1f</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a CPU\uff0c\u6570\u636e\u7f13\u5b58\u5927\u5c0f\u662f 64KB\uff0c4 \u8def\uff0c\u7f13\u5b58\u884c\u5927\u5c0f\u662f 64 \u5b57\u8282\u3002\u90a3\u4e48\uff0c\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\uff0c\u53ef\u4ee5\u8ba1\u7b97\u51fa\u7f13\u5b58\u6709 256 \u4e2a Set\uff0c\u4e5f\u5c31\u662f Index \u53ef\u4ee5\u53d6 0 \u5230 255\uff0c\u5360\u7528\u5730\u5740\u7684 8 \u4e2a\u4f4d\u3002\u7f13\u5b58\u884c\u5927\u5c0f\u662f 64 \u5b57\u8282\uff0c\u884c\u5185\u4fbf\u5b9c\u5360\u7528\u5730\u5740\u7684 6 \u4f4d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cIndex \u5bf9\u5e94\u7684\u662f\u5730\u5740\u7684 <code>[13:6]</code> \u4f4d\u3002\u63a5\u4e0b\u6765\u5bf9\u9875\u8868\u5927\u5c0f\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff1a</p> <p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 64 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[15:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[15:0]</code> \u4f4d\u76f8\u7b49\uff0c\u81ea\u7136 Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u4e5f\u76f8\u7b49\uff0cVIPT \u4e0d\u4f1a\u9047\u5230\u95ee\u9898\u3002</p> <p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 16 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[13:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[13:0]</code> \u4f4d\u76f8\u7b49\uff0c\u81ea\u7136 Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u4e5f\u76f8\u7b49\uff0cVIPT \u4e0d\u4f1a\u9047\u5230\u95ee\u9898\u3002</p> <p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 4 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[11:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[11:0]</code> \u4f4d\u76f8\u7b49\uff0c\u4f46\u662f Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u5c31\u4e0d\u4e00\u5b9a\u76f8\u7b49\u4e86\u3002\u8fd9\u65f6\u5019\u4f1a\u51fa\u73b0\u4ec0\u4e48\u95ee\u9898\u5462\uff1f</p> <p>\u5982\u679c\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u90fd\u662f\u4e00\u4e00\u5bf9\u5e94\uff0c\u90a3\u4e48\u5373\u4f7f\u6620\u5c04\u65f6\u4fee\u6539\u4e86 <code>[13:12]</code> \u4f4d\uff0cIndex \u53d8\u4e86\uff0c\u4e5f\u6ca1\u95ee\u9898\uff0c\u53ea\u8981\u4fdd\u5b58\u7684 Tag \u662f\u5b8c\u6574\u7684 <code>[VALEN-1:12]</code> \u4f4d\uff0c\u6570\u636e\u4f9d\u7136\u53ef\u4ee5\u7cbe\u786e\u5730\u627e\u5230\uff0c\u4e0d\u4f1a\u8bbf\u95ee\u5230\u9519\u8bef\u7684\u6570\u636e\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u591a\u4e2a\u865a\u62df\u5730\u5740\u5bf9\u5e94\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\uff0c\u4f8b\u5982\u5171\u4eab\u5185\u5b58\u7b49\u7b49\u3002\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <ol> <li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li> <li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80001000 -&gt; 0x00000000</li> </ol> <p>\u8fd9\u4e24\u4e2a\u865a\u62df\u9875\u5bf9\u5e94\u540c\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u865a\u62df\u9875\u7684 Index \u5374\u4e0d\u76f8\u540c\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u7b2c <code>[13:12]</code> \u4f4d\u4e0d\u76f8\u7b49\u3002\u56de\u987e L1 \u6570\u636e\u7f13\u5b58\u8bbf\u95ee\u7684\u6d41\u7a0b\uff0c\u7b2c\u4e00\u6b65\u5c31\u662f\u7528 Index \u4f5c\u4e3a\u4e0b\u6807\u53bb\u8bbf\u95ee\uff0c\u65e2\u7136\u4e24\u4e2a\u865a\u62df\u9875\u7684\u8bbf\u95ee\u65f6\u4e0b\u6807\u5c31\u4e0d\u4e00\u6837\uff0c\u81ea\u7136\u4e5f\u6ca1\u6cd5\u8bbf\u95ee\u5230\u540c\u6837\u7684\u6570\u636e\uff0c\u5f80\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5199\u6570\u636e\uff0c\u4ece\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5374\u8bfb\u4e0d\u51fa\u6765\uff0c\u8fd9\u5c31\u574f\u4e8b\u4e86\u3002\u8fd9\u4e2a\u73b0\u8c61\u53eb\u505a virtual aliasing\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u9605\u8bfb Cache and TLB Flushing Under Linux\uff0c\u91cc\u9762\u6709\u4e00\u6bb5\u8bdd\uff1a</p> <pre><code>Is your port susceptible to virtual aliasing in its D-cache?\nWell, if your D-cache is virtually indexed, is larger in size than\nPAGE_SIZE, and does not prevent multiple cache lines for the same\nphysical address from existing at once, you have this problem.\n\nIf your D-cache has this problem, first define asm/shmparam.h SHMLBA\nproperly, it should essentially be the size of your virtually\naddressed D-cache (or if the size is variable, the largest possible\nsize).  This setting will force the SYSv IPC layer to only allow user\nprocesses to mmap shared memory at address which are a multiple of\nthis value.\n</code></pre> <p>\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u610f\u601d\u5c31\u662f\uff0c\u5047\u5982\u6570\u636e\u7f13\u5b58\u7684 VIPT \u662f\u57fa\u4e8e\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u9875\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\u662f 16KB\uff09\uff0c\u6bd4\u5b9e\u9645\u7684\u9875\u8868\u5927\u5c0f\u66f4\u5927\uff084KB\uff09\uff0c\u5e76\u4e14\u6ca1\u6709\u9632\u6b62\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\u7684\u7f13\u5b58\u884c\u51fa\u73b0\u591a\u6b21\uff0c\u5c31\u4f1a\u9047\u5230\u95ee\u9898\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5728 Linux \u91cc\u8bbe\u7f6e <code>SHMLBA</code> \u53c2\u6570\uff0c\u5b83\u7684\u5927\u5c0f\u5e94\u8be5\u662f VIPT \u5bf9\u5e94\u7684\u9875\u5927\u5c0f\uff0816KB\uff09\u3002\u5b83\u4f1a\u8981\u6c42\u5171\u4eab\u5185\u5b58\u7684\u57fa\u5730\u5740\u4e00\u5b9a\u662f <code>SHMLBA</code> \u7684\u500d\u6570\u3002</p> <p>\u8fd9\u5c31\u89e3\u51b3\u4e86\u524d\u9762\u7684\u95ee\u9898\uff1a\u51fa\u73b0\u591a\u4e2a\u865a\u62df\u5730\u5740\u6620\u5c04\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\u65f6\uff0c\u65e2\u7136 Index \u4e0d\u4e00\u81f4\u4f1a\u6709\u95ee\u9898\uff0c\u90a3\u5c31\u8f6f\u4ef6\u4e0a\u53bb\u4fdd\u8bc1 Index \u4e00\u81f4\uff0c\u800c\u4fdd\u8bc1 Index \u4e00\u81f4\uff0c\u5176\u5b9e\u5c31\u662f\u5bf9\u9f50\u5230 <code>SHMLBA</code> \u7684\u500d\u6570\u3002\u56de\u987e\u4e0a\u9762\u7684\u4f8b\u5b50\uff1a</p> <ol> <li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li> <li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80001000 -&gt; 0x00000000</li> </ol> <p>\u7b2c\u4e8c\u4e2a\u9875\u5c31\u6ca1\u6709\u5bf9\u9f50\u5230 <code>SHMLBA</code>\uff0c\u4e5f\u5c31\u662f 16KB \u7684\u8fb9\u754c\u4e0a\u3002\u5047\u5982\u6620\u5c04\u7684\u65f6\u5019\uff0c\u5c31\u4fdd\u8bc1\u7b2c\u4e8c\u4e2a\u9875\u5bf9\u9f50\u5230 16KB \u7684\u8fb9\u754c\u4e0a\uff0c\u5c31\u53d8\u6210\u4e86\uff1a</p> <ol> <li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li> <li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80004000 -&gt; 0x00000000</li> </ol> <p>\u6b64\u65f6\u8fd9\u4e24\u4e2a\u9875\u7684\u865a\u62df\u5730\u5740\u7684 <code>[13:12]</code> \u4f4d\u5c31\u76f8\u540c\u4e86\uff0c\u4e0d\u4f1a\u51fa\u73b0 virtual aliasing \u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u53eb Page Coloring\uff08\u7684\u4e00\u79cd\uff09\uff0c\u989d\u5916\u8981\u6c42\u5171\u4eab\u5185\u5b58\u4e2d\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684\u7b2c <code>[13:12]</code> \u4f4d\u76f8\u540c\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u5fd8\u8bb0\u4e86\u5bf9\u9f50\u5230 <code>SHMLBA</code>\uff0c\u5b83\u4e0d\u4e00\u5b9a\u662f\u9875\u8868\u7684\u5927\u5c0f\u3002</p> <p>\u8fd9\u662f\u8f6f\u4ef6\u505a\u6cd5\uff0c\u6709\u6ca1\u6709\u786c\u4ef6\u505a\u6cd5\u5462\uff1f\u7b54\u6848\u662f\uff0c\u6709\uff0c\u53ef\u4ee5\u53c2\u8003 What problem does cache coloring solve? \u548c Designing a Virtual Memory System for the SHMAC Research Infrastructure \u7b2c 3.7 \u8282\u3002\u8fd9\u91cc\u5217\u51fa\u6765\u51e0\u79cd\u6bd4\u8f83\u597d\u7406\u89e3\u7684\u65b9\u6cd5\uff1a</p> <ol> <li>\u7f13\u5b58\u7f3a\u5931\u7684\u65f6\u5019\uff0c\u53bb\u5176\u4ed6 set \u91cc\u5bfb\u627e\u5339\u914d\uff0c\u5982\u679c\u53d1\u73b0\u4e86\uff0c\u5c31\u628a\u6570\u636e\u632a\u5230\u5f53\u524d\u7684 virtual index \u5bf9\u5e94\u7684\u4f4d\u7f6e\u3002\u8fd9\u4e2a\u65b9\u6cd5\u590d\u6742\u70b9\u5728\u4e8e\u9700\u8981\u53bb\u5176\u4ed6 set \u91cc\u5bfb\u627e\u53ef\u80fd\u7684\u5339\u914d\u3002</li> <li>\u5728 L2 \u7f13\u5b58\u4e2d\u8bb0\u5f55\u7f13\u5b58\u884c\u5bf9\u5e94\u7684 virtual index\uff0c\u7f13\u5b58\u7f3a\u5931\u7684\u65f6\u5019\uff0c\u53bb\u8be2\u95ee L2\uff0cL2 \u53d1\u73b0\u6709 alias \u7684\u60c5\u51b5\uff0c\u544a\u8bc9 L1 \u7f13\u5b58\uff0c\u8ba9\u4ed6\u53bb\u6307\u5b9a\u7684 set \u91cc\u5bfb\u627e\u6570\u636e\uff0c\u5e76\u4e14\u8fc1\u79fb\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u597d\u5904\u662f\u4e0d\u9700\u8981\u50cf\u7b2c\u4e00\u79cd\u65b9\u6cd5\u90a3\u6837\u53bb\u5bfb\u627e\u53ef\u80fd\u7684\u5339\u914d\uff0c\u800c\u662f\u8ba9 L2 \u53bb\u8bb0\u5f55\u4fe1\u606f\u3002\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u8bb0\u5f55\u66f4\u591a\u4fe1\u606f\uff0c\u53e6\u5916\u8981\u6c42 L2 \u7f13\u5b58\u9700\u8981\u662f inclusive \u7684\u3002\u89c1 XiangShan Cache \u522b\u540d\u95ee\u9898</li> </ol> <p>\u6b64\u5916\u8fd8\u6709\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u65b9\u6cd5\uff0c\u5efa\u8bae\u9605\u8bfb\u4e0a\u9762\u7684\u53c2\u8003\u8bba\u6587\u3002</p> <p>\u56e0\u6b64 VIPT \u4e5f\u53ef\u4ee5\u4e0d\u53d7\u5b9e\u9645\u7684\u9875\u5927\u5c0f\u7684\u9650\u5236\uff0c\u4f46\u662f\u4e3a\u4e86\u89e3\u51b3 aliasing \u7684\u95ee\u9898\uff0c\u9700\u8981\u5728\u8f6f\u4ef6\u4e0a\u6216\u8005\u786c\u4ef6\u4e0a\u627e\u8865\u3002</p>","tags":["cpu","paging","vipt","cache"]},{"location":"hardware/2023/12/08/vipt-l1-cache-page-size/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>Page Colouring on ARMv6 (and a bit on ARMv7)</li> <li>\u63a8\u8350\u9605\u8bfb\uff1a\u6d45\u8c08\u73b0\u4ee3\u5904\u7406\u5668\u5b9e\u73b0\u8d85\u5927 L1 Cache \u7684\u65b9\u5f0f</li> </ul>","tags":["cpu","paging","vipt","cache"]},{"location":"hardware/2022/04/10/vivado-program-bitstream-svf/","title":"\u5bfc\u51fa Vivado \u4e0b\u8f7d Bitstream \u7684 SVF \u6587\u4ef6","text":"","tags":["vivado","svf","jtag","bitstream"]},{"location":"hardware/2022/04/10/vivado-program-bitstream-svf/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u8fdc\u7a0b JTAG \u7684\u529f\u80fd\uff0c\u76ee\u524d\u5b9e\u73b0\u5728 jiegec/jtag-remote-server\uff0c\u5b9e\u73b0\u4e86\u7b80\u5355\u7684 XVC \u534f\u8bae\uff0c\u5e95\u5c42\u7528\u7684\u662f libftdi \u7684 MPSSE \u534f\u8bae\u6765\u64cd\u4f5c JTAG\u3002\u4f46\u662f\uff0c\u5728\u7528 Vivado \u5c1d\u8bd5\u7684\u65f6\u5019\uff0cSysMon \u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\uff0c\u4f46\u662f\u4e0b\u8f7d Bitstream \u4f1a\u5931\u8d25\uff0c\u6240\u4ee5\u8981\u7814\u7a76\u4e00\u4e0b Vivado \u90fd\u505a\u4e86\u4ec0\u4e48\uff08\u76ee\u524d\u5df2\u7ecf\u4fee\u597d\uff0c\u662f\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u7684\u90e8\u5206\u4f4d\u8bfb\u53d6\u7684\u5904\u7406\u95ee\u9898\uff09\u3002</p>","tags":["vivado","svf","jtag","bitstream"]},{"location":"hardware/2022/04/10/vivado-program-bitstream-svf/#svf","title":"SVF","text":"<p>SVF \u683c\u5f0f\u5176\u5b9e\u662f\u4e00\u7cfb\u5217\u7684 JTAG \u4e0a\u7684\u64cd\u4f5c\u3002\u60f3\u5230\u8fd9\u4e2a\uff0c\u4e5f\u662f\u56e0\u4e3a\u5728\u7f51\u4e0a\u641c\u5230\u4e86\u4e00\u4e2a dcfeb_v45.svf\uff0c\u91cc\u9762\u63cf\u8ff0\u7684\u5c31\u662f\u4e00\u6bb5 JTAG \u64cd\u4f5c\uff1a</p> <pre><code>// Created using Xilinx Cse Software [ISE - 12.4]\n// Date: Mon May 09 11:00:32 2011\n\nTRST OFF;\nENDIR IDLE;\nENDDR IDLE;\nSTATE RESET;\nSTATE IDLE;\nFREQUENCY 1E6 HZ;\n//Operation: Program -p 0 -dataWidth 16 -rs1 NONE -rs0 NONE -bpionly -e -loadfpga \nTIR 0 ;\nHIR 0 ;\nTDR 0 ;\nHDR 0 ;\nTIR 0 ;\nHIR 0 ;\nHDR 0 ;\nTDR 0 ;\n//Loading device with 'idcode' instruction.\nSIR 10 TDI (03c9) SMASK (03ff) ;\nSDR 32 TDI (00000000) SMASK (ffffffff) TDO (f424a093) MASK (0fffffff) ;\n//Boundary Scan Chain Contents\n//Position 1: xc6vlx130t\nTIR 0 ;\nHIR 0 ;\nTDR 0 ;\nHDR 0 ;\nTIR 0 ;\nHIR 0 ;\nTDR 0 ;\nHDR 0 ;\nTIR 0 ;\nHIR 0 ;\nHDR 0 ;\nTDR 0 ;\n//Loading device with 'idcode' instruction.\nSIR 10 TDI (03c9) ;\nSDR 32 TDI (00000000) TDO (f424a093) ;\n//Loading device with 'bypass' instruction.\nSIR 10 TDI (03ff) ;\n//Loading device with 'idcode' instruction.\nSIR 10 TDI (03c9) ;\nSDR 32 TDI (00000000) TDO (f424a093) ;\n// Loading device with a `jprogram` instruction. \nSIR 10 TDI (03cb) ;\n// Loading device with a `isc_noop` instruction. \nSIR 10 TDI (03d4) ;\nRUNTEST 100000 TCK;\n// Check init_complete in ircapture.\n//IR Capture using specified instruction.\nSIR 10 TDI (03d4) TDO (0010) MASK (0010) ;\n// Loading device with a `isc_enable` instruction. \nSIR 10 TDI (03d0) ;\nSDR 5 TDI (00) SMASK (1f) ;\nRUNTEST 100 TCK;\n// Loading device with a `isc_program` instruction. \nSIR 10 TDI (03d1) ;\nSDR 32 TDI (ffffffff) SMASK (ffffffff) ;\nSDR 32 TDI (ffffffff) ;\nSDR 32 TDI (ffffffff) ;\n</code></pre> <p>\u5b83\u7684\u8bed\u6cd5\u6bd4\u8f83\u7b80\u5355\uff0c\u5927\u6982\u5c31\u662f <code>SIR</code> \u5c31\u662f\u5411 IR \u8f93\u5165\uff0c<code>SDR</code> \u5c31\u662f\u5411 DR \u8f93\u5165\uff0c\u540e\u9762\u8ddf\u7740\u7684 TDO \u548c MASK \u8868\u793a\u5bf9\u8f93\u51fa\u6570\u636e\u8fdb\u884c\u5224\u65ad\u3002\u6bd4\u8f83\u6838\u5fc3\u7684\u662f\u4e0b\u9762\u8fd9\u51e0\u6b65\uff1a</p> <pre><code>SIR JPROGRAM\nSIR ISC_NOOP\nRUNTEST 10000 TCK\nSIR ISC_NOOP UNTIL ISC_DONE\nSIR ISC_ENABLE\nSIR ISC_PROGRAM\n</code></pre> <p>\u4e4b\u540e\u5c31\u662f bitstream \u7684\u5185\u5bb9\u4e86\u3002</p>","tags":["vivado","svf","jtag","bitstream"]},{"location":"hardware/2022/04/10/vivado-program-bitstream-svf/#openocd-\u70e7\u5199-svf","title":"OpenOCD \u70e7\u5199 SVF","text":"<p>\u6709\u4e86 SVF \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u7528\u5176\u4ed6\u7684\u4e00\u4e9b\u652f\u6301 SVF \u8bed\u6cd5\u7684\u5de5\u5177\u6765\u70e7\u5199 FPGA\uff0c\u800c\u4e0d\u9700\u8981 Vivado\u3002\u6bd4\u5982\u91c7\u7528\u5982\u4e0b\u7684 OpenOCD \u914d\u7f6e\uff1a</p> <pre><code># openocd config\n# use ftdi channel 0\nadapter speed 100000\nadapter driver ftdi\ntransport select jtag\nftdi_vid_pid 0x0403 0x6011\nftdi_layout_init 0x0008 0x000b\nftdi_tdo_sample_edge falling\nftdi_channel 0\nreset_config none\n\njtag newtap xcvu37p tap -irlen 18 -expected-id 0x14b79093\n\ninit\n\nsvf -tap xcvu37p.tap /path/to/program.svf progress\n\nexit\n</code></pre>","tags":["vivado","svf","jtag","bitstream"]},{"location":"hardware/2022/04/10/vivado-program-bitstream-svf/#\u4ece-vivado-\u4e2d\u5bfc\u51fa-svf","title":"\u4ece Vivado \u4e2d\u5bfc\u51fa SVF","text":"<p>\u4ece\u6587\u4ef6\u5934\u53ef\u4ee5\u63a8\u6d4b\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f Xilinx \u5b98\u65b9\u63d0\u4f9b\u7684\uff0c\u4e00\u756a\u641c\u7d22\uff0c\u679c\u7136\u627e\u5230\u4e86\u547d\u4ee4\uff1aCreating SVF files using Xilinx Vivado</p> <pre><code>program_hw_devices -force -svf_file {program.svf} [get_hw_devices xxx]\n</code></pre> <p>\u6dfb\u52a0\u4e00\u4e2a <code>-svf_file</code> \u53c2\u6570\u540e\uff0c\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a svf \u6587\u4ef6\u3002\u4e0b\u9762\u6458\u5f55\u4e00\u6bb5\uff1a</p> <pre><code>// config/idcode\nSIR 18 TDI (009249) ;\nSDR 32 TDI (00000000) TDO (04b79093) MASK (0fffffff) ;\n// config/jprog\nSTATE RESET;\nSTATE IDLE;\nSIR 18 TDI (00b2cb) ;\nSIR 18 TDI (014514) ;\n// Modify the below delay for config_init operation (0.100000 sec typical, 0.100000 sec maximum)\nRUNTEST 0.100000 SEC;\n// config/jprog/poll\nRUNTEST 15000 TCK;\nSIR 18 TDI (014514) TDO (011000) MASK (031000) ;\n// config/slr\nSIR 18 TDI (005924) ;\nSDR 226633216 TDI (0000000400000004e00000008001000c00000004d00000008001000c0000000466aa99550000000400000004000000040000000400000004000000040000\n</code></pre> <p>\u7ed3\u5408 Xilinx \u5b98\u7f51\u53ef\u4ee5\u4e0b\u8f7d\u7684 BSDL \u6587\u4ef6\uff0c\u53ef\u4ee5\u627e\u5230\u6bcf\u4e2a IR \u5bf9\u5e94\u7684\u662f\u4ec0\u4e48\uff1a</p> <pre><code>// config/idcode\nSIR 18 TDI (009249) ;\nSDR 32 TDI (00000000) TDO (04b79093) MASK (0fffffff) ;\n// BSDL:\n\"IDCODE           (001001001001001001),\" &amp; --   DEVICE_ID reg\nattribute IDCODE_REGISTER of XCVU37P_FSVH2892 : entity is\n        \"XXXX\" &amp;        -- version\n        \"0100101\" &amp;     -- family\n        \"101111001\" &amp;   -- array size\n        \"00001001001\" &amp; -- manufacturer\n        \"1\";            -- required by 1149.1\n</code></pre> <p>\u8fd9\u4e00\u6bb5\u662f\u68c0\u67e5 IDCODE \u662f\u5426\u662f\u76ee\u6807 FPGA \u578b\u53f7\u3002</p> <pre><code>// config/jprog\nSTATE RESET;\nSTATE IDLE;\nSIR 18 TDI (00b2cb) ;\nSIR 18 TDI (014514) ;\n// BSDL\n\"JPROGRAM         (001011001011001011),\" &amp; --   PRIVATE\n\"ISC_NOOP         (010100010100010100),\" &amp; --   PRIVATE, ISC_DEFAULT\n// Modify the below delay for config_init operation (0.100000 sec typical, 0.100000 sec maximum)\nRUNTEST 0.100000 SEC;\n</code></pre> <p>\u8fd9\u4e00\u6bb5\u53d1\u9001\u4e86 JPROGRAM \u548c ISC_NOOP \u7684 IR\uff0c\u7136\u540e\u8fdb\u5165 RUNTEST \u72b6\u6001\u4e00\u6bb5\u65f6\u95f4\u3002</p> <p><pre><code>// config/jprog/poll\nRUNTEST 15000 TCK;\nSIR 18 TDI (014514) TDO (011000) MASK (031000) ;\n// BSDL\n\"ISC_NOOP         (010100010100010100),\" &amp; --   PRIVATE, ISC_DEFAULT\n</code></pre> \u8fd9\u91cc\u518d\u6b21\u8bbe\u7f6e ISC_NOOP\uff0c\u68c0\u67e5\u4e86 TDO \u4e2d\u7684\u6570\u636e\uff0c\u610f\u4e49\u4e0d\u660e\u3002</p> <pre><code>// config/slr\nSIR 18 TDI (005924) ;\nSDR 226633216 TDI (0000000400000004e00000008001000c00000004d00000008001000c0000000466aa99550000000400000004000000040000000400000004000000040000\n// BSDL\n\"CFG_IN_SLR0      (000101100100100100),\" &amp; --   PRIVATE\n</code></pre> <p>\u4ece\u8fd9\u91cc\u5c31\u662f\u5f00\u59cb\u5f80\u91cc\u9762\u5199\u5165 bitstream\uff0c\u53ef\u4ee5\u770b\u5230\u719f\u6089\u7684 66aa9955 \u7684\u540c\u6b65\u5b57\u7b26\uff0c\u5bf9\u6bd4 Bitstream \u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code>000000c0: ffff ffff ffff ffff aa99 5566 2000 0000  ..........Uf ...\n000000d0: 2000 0000 3002 2001 0000 0000 3002 0001   ...0. .....0...\n000000e0: 0000 0000 3000 8001 0000 0000 2000 0000  ....0....... ...\n000000f0: 3000 8001 0000 0007 2000 0000 2000 0000  0....... ... ...\n00000100: 3000 2001 0000 0000 3002 6001 0000 0000  0. .....0.`.....\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u662f\u6bcf 32 \u5b57\u8282\u6309\u4f4d\u98a0\u5012\uff1a<code>aa995566(10101010 10011001 01010101 01100110) -&gt; 66aa9955(01100110 10101010 10011001 01010101)</code>\uff0c\u540e\u9762\u7684 <code>20000000 -&gt; 00000004</code> \u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p> <p>Xilinx UG570 \u7684 Table 6-5 \u4e5f\u5370\u8bc1\u4e86\u4e0a\u9762\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>Start loading the JPROGRAM instruction, LSB first:</li> <li>Load the MSB of the JPROGRAM instruction when exiting SHIFT-IR, as defined in the IEEE standard.</li> <li>Start loading the CFG_IN instruction, LSB first:</li> <li>Load the MSB of the CFG_IN instruction when exiting SHIFT-IR.</li> <li>Shift in the FPGA bitstream. Bit n (MSB) is the first bit in the bitstream.(3)(4)</li> <li>Shift in the last bit of the bitstream. Bit 0 (LSB) shifts on the transition to EXIT1-DR.</li> </ul> <p>\u5b8c\u6210 CFG_IN \u4e4b\u540e\uff0c\u518d\u8fdb\u884c JSTART:</p> <pre><code>// config/start\nSTATE IDLE;\nRUNTEST 100000 TCK;\nSIR 18 TDI (00c30c) ;\nHIR 0 ;\nTIR 0 ;\nHDR 0 ;\nTDR 0 ;\nSTATE IDLE;\nRUNTEST 2000 TCK;\nSIR 18 TDI (009249) TDO (031000) MASK (011000) ;\nHIR 0 ;\nTIR 0 ;\nHDR 0 ;\nTDR 0 ;\n// BSDL\n\"JSTART           (001100001100001100),\" &amp; --   PRIVATE\n\"IDCODE           (001001001001001001),\" &amp; --   DEVICE_ID reg\n</code></pre> <p>\u7136\u540e\u518d\u6b21\u8fdb\u884c CFG_IN_SLR0, CFG_OUT_SLR0\uff0c\u9a8c\u8bc1\u662f\u5426\u771f\u7684\u5199\u8fdb\u53bb\u4e86\uff1a</p> <pre><code>// config/status\nSTATE RESET;\nRUNTEST 5 TCK;\nSIR 18 TDI (005924) ;\nSDR 160 TDI (0000000400000004800700140000000466aa9955) ;\nSIR 18 TDI (004924) ;\nSDR 32 TDI (00000000) TDO (3f5e0d40) MASK (08000000) ;\nSTATE RESET;\nRUNTEST 5 TCK;\n// BSDL\n\"CFG_IN_SLR0      (000101100100100100),\" &amp; --   PRIVATE\n\"CFG_OUT_SLR0     (000100100100100100),\" &amp; --   PRIVATE\n// config/status\nSTATE RESET;\nRUNTEST 5 TCK;\nSIR 18 TDI (005924) ;\nSDR 160 TDI (0000000400000004800700140000000466aa9955) ;\nSIR 18 TDI (004924) ;\nSDR 32 TDI (00000000) TDO (3f5e0d40) MASK (08000000) ;\nSTATE RESET;\nRUNTEST 5 TCK;\n</code></pre> <p>\u8fd9\u6bb5\u64cd\u4f5c\u662f\u8fdb\u884c Status Register Readback\uff0c\u89c1 UG570 \u7684 Table 10-4\u3002MASK \u8bbe\u4e3a <code>08000000</code> \u5e94\u8be5\u662f\u5224\u65ad\u5b83\u7684\u7b2c 4 \u4f4d\uff1aEND_OF_STARTUP_STATUS\uff08Table 9-25\uff09\u3002</p> <p>\u5982\u679c\u662f Quartus \u7528\u6237\uff0c\u4e5f\u53ef\u4ee5 \u751f\u6210 SVF\uff0c\u5177\u4f53\u64cd\u4f5c\u662f\uff1a\u5728 Programmer \u4e2d\uff0c\u70b9\u51fb <code>File-&gt;Create JAM, JBC, SVF or ISC file</code>\uff0c\u7136\u540e\u5728\u5f39\u51fa\u7684\u7a97\u53e3\u4e2d\u9009\u62e9 svf \u683c\u5f0f\uff0c\u5bfc\u51fa\u5373\u53ef\u3002\u5f97\u5230\u7684 svf \u6587\u4ef6\u4e00\u6837\u53ef\u4ee5\u7528 openocd \u6765\u4e0b\u8f7d\u3002</p> <p>\u4e5f\u53ef\u4ee5\u7528 <code>quartus_cpf</code> \u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c\u8f6c\u6362\uff1a</p> <pre><code>quartus_cpf -q 18MHz -g 3.3 -c -n p input.sof/pof output.svf\n</code></pre>","tags":["vivado","svf","jtag","bitstream"]},{"location":"hardware/2020/04/04/vivado-simulation-command/","title":"\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c Vivado \u4eff\u771f","text":"","tags":["vivado","simulation","verilog","tcl"]},{"location":"hardware/2020/04/04/vivado-simulation-command/#\u5df2\u6709-vivado-\u9879\u76ee","title":"\u5df2\u6709 Vivado \u9879\u76ee","text":"<p>\u60f3\u8981\u5728\u547d\u4ee4\u884c\u91cc\u8fdb\u884c Vivado \u4eff\u771f\uff0c\u6240\u4ee5\u67e5\u4e86\u4e0b Xilinx \u7684 UG900 \u6587\u6863\uff0c\u627e\u5230\u4e86\u547d\u4ee4\u884c\u4eff\u771f\u7684\u65b9\u6cd5\u3002\u9996\u5148\u662f\u751f\u6210\u4eff\u771f\u6240\u9700\u7684\u6587\u4ef6\uff1a</p> <pre><code># assuming batch mode\nopen_project xxx.xpr\nset_property top YOUR_SIM_TOP [current_fileset -simset]\nexport_ip_user_files -no_script -force\nexport_simulation -simulator xsim -force\n</code></pre> <p>\u53ef\u4ee5\u628a\u8fd9\u4e9b\u8bed\u53e5\u653e\u5230 tcl \u6587\u4ef6\u91cc\u7136\u540e\u7528 batch mode \u6267\u884c\u3002\u6267\u884c\u6210\u529f\u4ee5\u540e\uff0c\u4f1a\u5728 <code>export_sim/xsim</code> \u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e9b\u6587\u4ef6\u3002\u91cc\u9762\u4f1a\u6709\u751f\u6210\u7684\u811a\u672c\u4ee5\u4f9b\u4eff\u771f\uff1a</p> <pre><code>cd export_sim/xsim &amp;&amp; ./YOUR_SIM_TOP.sh\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u4f1a\u6267\u884c export_sim/xsim/cmd.tcl \u91cc\u9762\u7684\u547d\u4ee4\u3002\u5982\u679c\u60f3\u8981\u8bb0\u5f55 vcd \u6587\u4ef6\uff0c\u4fee\u6539\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>open_vcd\nlog_vcd\nrun 20us\nclose_vcd\nquit\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4eff\u771f\u7684\u6ce2\u5f62\u8f93\u51fa\u5230 dump.vcd \u6587\u4ef6\uff0c\u62d6\u5230\u672c\u5730\u7136\u540e\u7528 GTKWave \u770b\u3002\u66f4\u591a\u652f\u6301\u7684\u547d\u4ee4\u53ef\u4ee5\u5230 UG900 \u91cc\u627e\u3002</p>","tags":["vivado","simulation","verilog","tcl"]},{"location":"hardware/2020/04/04/vivado-simulation-command/#\u65e0\u9879\u76ee\u6a21\u5f0f","title":"\u65e0\u9879\u76ee\u6a21\u5f0f","text":"<p>\u5982\u679c\u6ca1\u6709\u521b\u5efa Vivado \u9879\u76ee\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u8fdb\u884c\u4eff\u771f\uff0c\u5177\u4f53\u5206\u4e3a\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u7b2c\u4e00\u6b65\uff0c\u5bf9\u6bcf\u4e2a\u6e90 Verilog \u6587\u4ef6\uff0c\u8fd0\u884c <code>xvlog module.v</code> \u547d\u4ee4</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u751f\u6210 snapshot\uff0c\u8fd0\u884c <code>xelab -debug all --snapshot snapshot_name top_module_name</code></li> <li>\u7b2c\u4e09\u6b65\uff0c\u4eff\u771f\uff0c\u8fd0\u884c <code>xsim snapshot_name</code></li> </ol> <p>\u5982\u679c\u60f3\u8981\u751f\u6210\u6ce2\u5f62\u6587\u4ef6\uff0c\u7f16\u8f91 <code>xsim.tcl</code> \u4e3a\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>open_vcd\nlog_vcd *\nrun -all\nclose_vcd\nquit\n</code></pre> <p>\u628a\u7b2c\u4e09\u6b65\u8fd0\u884c\u7684\u547d\u4ee4\u6539\u4e3a\uff1a<code>xsim snapshot_name -tclbatch xsim.tcl</code> \u5373\u53ef\u3002</p>","tags":["vivado","simulation","verilog","tcl"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/","title":"\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f","text":"","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u6709\u4e00\u5929\u770b\u5230\u670b\u53cb\u5728\u6363\u9f13 CH32V307\uff0c\u56e0\u6b64\u81ea\u5df1\u4e5f\u840c\u751f\u4e86\u8bd5\u7528 CH32V307 \u8bc4\u4f30\u677f\u7684\u5174\u8da3\uff0c\u4e8e\u662f\u5728\u6c81\u6052\u5b98\u7f51\u7533\u8bf7\u6837\u54c1\uff0c\u5f88\u5feb\u5c31\u63a5\u5230\u7535\u8bdd\u4e86\u89e3\u60c5\u51b5\uff0c\u51e0\u5929\u540e\u5c31\u987a\u4e30\u9001\u5230\u4e86\uff0c\u4e0d\u8fc7\u56e0\u4e3a\u75ab\u60c5\u539f\u56e0\u76f4\u5230\u73b0\u5728\u624d\u62ff\u5230\u624b\u4e0a\uff0c\u53ea\u80fd\u8bf4\u75ab\u60c5\u671f\u95f4\u8bf4\u4e0d\u5b9a\u8d27\u6bd4\u4eba\u8fd8\u5feb\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#\u5f00\u7bb1","title":"\u5f00\u7bb1","text":"<p>\u6536\u5230\u7684\u76d2\u5b50\u91cc\u6709\u4e00\u4e2a CH32V307 \u8bc4\u4f30\u677f\uff0c\u548c\u4e00\u4e2a WCH-Link\uff0c\u76f8\u5173\u8d44\u6599\u53ef\u4ee5\u5728 \u5b98\u7f51 \u6216\u8005 openwch/ch32v307 \u4e0b\u8f7d\u3002\u5728\u8bf4\u660e\u4e66\u4e2d\u6709\u5982\u4e0b\u7684\u56fe\u793a\uff1a</p> <p></p> <p>\u677f\u5b50\u81ea\u5e26\u7684\u8df3\u7ebf\u5e3d\u4e0d\u662f\u5f88\u591a\uff0c\u5efa\u8bae\u81ea\u5907\u4e00\u4e9b\uff0c\u6216\u8005\u7528\u675c\u90a6\u7ebf\u66ff\u4ee3\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u662f WCH-Link \u5b50\u677f\u4e0a CH549 \u548c CH2V307 \u8fde\u63a5\u7684\u51e0\u4e2a\u4fe1\u53f7\uff0c\u548c\u4e0b\u9762 BOOT0/1 \u7684\u9009\u62e9\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#wch-link","title":"WCH-Link","text":"<p>\u53ef\u4ee5\u770b\u5230\u8bc4\u4f30\u677f\u81ea\u5e26\u4e86\u4e00\u4e2a WCH-Link\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u9644\u8d60\u7684\u90a3\u4e00\u4e2a\uff0c\u76f4\u63a5\u628a 11 \u53f7 Type-C \u8fde\u63a5\u5230\u7535\u8111\u4e0a\u5373\u53ef\u3002\u8fd9\u91cc\u8fd8\u9047\u5230\u4e00\u4e2a\u5c0f\u63d2\u66f2\uff0c\u7528 Type-C to Type-C \u7684\u7ebf\u8fde\u7535\u8111\u4e0a\u4e0d\u5de5\u4f5c\uff0c\u8fde PWR LED \u90fd\u70b9\u4e0d\u4eae\uff0c\u6362\u4e00\u6839 Type-A to Type-C \u7684\u5c31\u53ef\u4ee5\uff0c\u6ca1\u6709\u7ee7\u7eed\u7814\u7a76\u662f\u4ec0\u4e48\u539f\u56e0\u3002\u7535\u8111\u4e0a\u53ef\u4ee5\u770b\u5230 WCH-Link \u7684\u8bbe\u5907\uff1aVID=1a86, PID=8010\u3002\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0c\u5728 RISC-V \u6a21\u5f0f\uff08CON \u706f\u4e0d\u4eae\uff09\u7684\u65f6\u5019 PID \u662f 8010\uff0cARM \u6a21\u5f0f\uff08CON \u706f\u4eae\uff09\u7684\u65f6\u5019 PID \u662f 8011\uff0c\u4ece RISC-V \u6a21\u5f0f\u5207\u6362\u5230 ARM \u6a21\u5f0f\u7684\u65b9\u6cd5\u662f\u8fde\u63a5 TX \u548c GND \u540e\u4e0a\u7535\uff0c\u53cd\u8fc7\u6765\u8981\u7528 MounRiver\uff0c\u8be6\u89c1 WCH-Link \u4f7f\u7528\u8bf4\u660e V1.0 V1.3 \u548c\u539f\u7406\u56fe V1.1\u3002</p> <p>\u7ed9\u6c81\u6052\u5f00\u6e90 WCH-Link \u539f\u7406\u56fe\u5e76\u5f00\u653e\u56fa\u4ef6\u70b9\u4e2a\u8d5e\uff0c\u5728\u6dd8\u5b9d\u4e0a\u4e5f\u53ef\u4ee5\u770b\u5230\u4e0d\u5c11 WCH-Link \u7684\u4eff\u771f\u5668\uff0c\u633a\u6709\u610f\u601d\u7684\u3002</p> <p>\u5728 ARM \u6a21\u5f0f\u4e0b\uff0c\u5b83\u5b9e\u73b0\u4e86\u7c7b\u4f3c CMSIS-DAP \u7684\u534f\u8bae\uff0c\u53ef\u4ee5\u7528 OpenOCD \u8c03\u8bd5\uff1a</p> <pre><code>source [find interface/cmsis-dap.cfg]\nadapter speed 1000\ncmsis_dap_vid_pid 0x1a86 0x8011\ntransport select swd\ninit\n</code></pre> <pre><code>$ openocd -f openocd.cfg\nOpen On-Chip Debugger 0.11.0\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : CMSIS-DAP: SWD  Supported\nInfo : CMSIS-DAP: FW Version = 2.0.0\nInfo : CMSIS-DAP: Interface Initialised (SWD)\nInfo : SWCLK/TCK = 1 SWDIO/TMS = 1 TDI = 0 TDO = 0 nTRST = 0 nRESET = 1\nInfo : CMSIS-DAP: Interface ready\nInfo : clock speed 1000 kHz\nWarn : gdb services need one or more targets defined\nInfo : Listening on port 6666 for tcl connections\nInfo : Listening on port 4444 for telnet connections\n</code></pre> <p>\u4e0d\u8fc7\u8fd9\u91cc\u6211\u4eec\u8981\u7528\u7684\u662f RISC-V \u5904\u7406\u5668 CH32V307\uff0c\u4e0a\u9762\u7684\u5c31\u5f53\u662f WCH-LINK \u4f7f\u7528\u7684\u5c0f\u8d34\u58eb\u3002</p> <p>\u7ed9\u8bc4\u4f30\u677f\u63d2\u4e0a USB Type-C \u4ee5\u540e\uff0c\u9996\u5148\u4e0a\u9762\u7684 WCH-Link \u90e8\u5206\u4e2d\u7ea2\u8272\u7684 PWR \u548c\u7eff\u8272\u7684 RUN \u4eae\uff0cCON \u4e0d\u4eae\uff0c\u8bf4\u660e WCH-LINK \u7684 CH549 \u5df2\u7ecf\u542f\u52a8\uff0c\u5e76\u4e14\u5904\u5728 RISC-V \u6a21\u5f0f\uff08CON \u4e0d\u4eae\uff09\u3002CH549 \u662f\u4e00\u4e2a 8051 \u6307\u4ee4\u96c6\u7684\u5904\u7406\u5668\uff0c\u4e0a\u9762\u7684\u8dd1\u7684 WCH-LINK \u56fa\u4ef6\u5728\u7f51\u4e0a\u53ef\u4ee5\u627e\u5230\uff0c\u5728\u4e0b\u9762\u63d0\u5230\u7684 MounRiver Studio \u76ee\u5f55\u4e2d\u4e5f\u6709\u4e00\u4efd\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#openocd","title":"OpenOCD","text":"<p>\u76ee\u524d\u5f00\u6e90\u5de5\u5177\u4e0a\u6e38\u8fd8\u4e0d\u652f\u6301 CH32V307 \u7684\u5f00\u53d1\uff0c\u9700\u8981\u7528 MounRiver\uff0c\u652f\u6301 Windows \u548c Linux\uff0c\u6709\u4e24\u90e8\u5206\uff1a</p> <ul> <li>MRS_Toolchain_Linux_x64_V1.40.tar.xz: RISC-V GNU Toolchain \u548c OpenOCD</li> <li>MounRiver_Studio_Community_Linux_V110\uff1a\u57fa\u4e8e Eclipse \u505a\u7684 IDE</li> </ul> <p>\u89e3\u538b\u7f29\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u7684 OpenOCD \u914d\u7f6e\uff1a</p> <pre><code>## wch-arm.cfg\nadapter driver cmsis-dap\ntransport select swd\nsource [find ../share/openocd/scripts/target/ch32f1x.cfg]\n## wch-riscv.cfg\n#interface wlink\nadapter driver wlink\nwlink_set\nset _CHIPNAME riscv\njtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x00001\n\nset _TARGETNAME $_CHIPNAME.cpu\n\ntarget create $_TARGETNAME.0 riscv -chain-position $_TARGETNAME\n$_TARGETNAME.0 configure  -work-area-phys 0x80000000 -work-area-size 10000 -work-area-backup 1\nset _FLASHNAME $_CHIPNAME.flash\n\nflash bank $_FLASHNAME wch_riscv 0x00000000 0 0 0 $_TARGETNAME.0\n\necho \"Ready for Remote Connections\"\n</code></pre> <p>\u5176\u4e2d ch32f1x.cfg \u5c31\u662f stm32f1x.cfg \u6539\u4e86\u4e00\u4e0b\u540d\u5b57\uff0c\u53ef\u4ee5\u770b\u5230 WCH OpenOCD \u628a\u5b83\u7684 RISC-V \u8c03\u8bd5\u534f\u8bae\u79f0\u4e3a wlink\uff0c\u4f30\u8ba1\u662f\u53d6 wch-link \u7684\u7b80\u79f0\u5427\u3002\u9664\u4e86 wlink \u90e8\u5206\uff0c\u5176\u4ed6\u5c31\u662f\u6b63\u5e38\u7684 RISC-V CPU \u8c03\u8bd5\u7684 OpenOCD \u914d\u7f6e\uff0c\u6bd4\u8f83\u6709\u610f\u601d\u7684\u5c31\u662f IDCODE \u8bbe\u4e3a\u4e86 0x00001\uff0c\u6bd4\u8f83\u6709\u4e2a\u6027\u3002</p> <p>\u5728\u7f51\u4e0a\u4e00\u756a\u641c\u7d22\uff0c\u627e\u5230\u4e86 WCH OpenOCD \u7684\u6e90\u7801 Embedded_Projects/riscv-openocd-wch\uff0c\u662f\u7f51\u53cb\u5411\u6c81\u6052\u83b7\u53d6\u7684\u6e90\u4ee3\u7801\uff0c\u6bd5\u7adf OpenOCD \u662f GPL \u8f6f\u4ef6\u3002\u7b80\u5355\u770b\u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u662f\u76f4\u63a5\u628a RISC-V Debug \u4e2d\u7684 DMI \u64cd\u4f5c\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u7136\u540e\u901a\u8fc7 USB Bulk \u548c WCH-Link \u901a\u4fe1\u3002\u6211\u4ece riscv-openocd \u627e\u5230\u4e86\u4e00\u4e2a\u6bd4\u8f83\u63a5\u8fd1\u7684 commit\uff0c\u7136\u540e\u628a WCH \u7684\u4ee3\u7801\u63d0\u4ea4\u4e0a\u53bb\uff0c\u5f97\u5230\u4e86 diff\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u770b\u770b\u5177\u4f53\u5b9e\u73b0\uff0c\u751a\u81f3\u628a\u8fd9\u4e2a\u652f\u6301\u63d0\u4ea4\u5230\u4e0a\u6e38\u3002</p> <p>\u6709\u6e90\u7801\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 macOS \u4e0a\u7f16\u8bd1\u4e86\uff08\u9700\u8981\u4fee\u590d\u4e09\u5904 clang \u62a5\u544a\u7684\u7f16\u8bd1\u9519\u8bef\uff0c\u6700\u7ec8\u4ee3\u7801\uff09\uff1a</p> <pre><code>$ ./bootstrap\n$ ./configure --prefix=/path/to/prefix/openocd --enable-wlink --disable-werror CAPSTONE_CFLAGS=-I/opt/homebrew/opt/capstone/include/\n$ make -j4 install\n</code></pre> <p>\u5982\u679c\u9047\u5230 makeinfo \u62a5\u9519\uff0c\u628a homebrew \u7684 texinfo \u52a0\u5230 PATH \u5373\u53ef\u3002</p> <p>\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u7528\u524d\u9762\u63d0\u5230\u7684 wch-riscv.cfg \u8fdb\u884c\u8c03\u8bd5\u4e86\uff1a</p> <pre><code>$ /path/to/prefix/openocd -f wch-riscv.cfg\nOpen On-Chip Debugger 0.11.0+dev-01623-gbfa3bc7f9 (2022-04-20-09:55)\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : only one transport option; autoselect 'jtag'\nReady for Remote Connections\nInfo : Listening on port 6666 for tcl connections\nInfo : Listening on port 4444 for telnet connections\nInfo : WCH-Link version 2.3 \nInfo : wlink_init ok\nInfo : This adapter doesn't support configurable speed\nInfo : JTAG tap: riscv.cpu tap/device found: 0x00000001 (mfg: 0x000 (&lt;invalid&gt;), part: 0x0000, ver: 0x0)\nWarn : Bypassing JTAG setup events due to errors\nInfo : [riscv.cpu.0] datacount=2 progbufsize=8\nInfo : Examined RISC-V core; found 1 harts\nInfo :  hart 0: XLEN=32, misa=0x40901125\n[riscv.cpu.0] Target successfully examined.\nInfo : starting gdb server for riscv.cpu.0 on 3333\nInfo : Listening on port 3333 for gdb connections\n</code></pre> <p>\u8fd9\u4e5f\u9a8c\u8bc1\u4e86\u4e0a\u9762\u7684\u53d1\u73b0\uff1a\u56e0\u4e3a\u7ed5\u8fc7\u4e86 jtag\uff0c\u76f4\u63a5\u53d1\u9001 dmi\uff0c\u6240\u4ee5 idcode \u662f\u5047\u7684\uff1a</p> <pre><code>if(wchwlink){\n        buf_set_u32(idcode_buffer, 0, 32, 0x00001);  //Default value,for reuse risc-v jtag debug\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u7528 GDB \u8c03\u8bd5\u4e86\u3002\u91cc\u9762\u8dd1\u4e86\u4e00\u4e2a\u6837\u4f8b\u7684\u7a0b\u5e8f\uff0c\u5c31\u662f\u5411\u4e32\u53e3\u6253\u5370\uff1a</p> <pre><code>$ screen /dev/tty.usbmodem* 115200\nSystemClk:72000000\n111\n   111\n      111\n         111\n            111\n</code></pre> <p>\u4e4b\u540e\u5219\u662f\u9488\u5bf9\u5404\u4e2a\u5916\u8bbe\uff0c\u57fa\u4e8e\u6c81\u6052\u63d0\u4f9b\u7684\u793a\u4f8b\u4ee3\u7801\u8fdb\u884c\u76f8\u5e94\u7684\u5f00\u53d1\u4e86\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#baremetal-\u4ee3\u7801","title":"Baremetal \u4ee3\u7801","text":"<p>\u63a5\u4e0b\u6765\u770b\u770b\u6c81\u6052\u63d0\u4f9b\u7684\u4ee3\u7801\u662f\u5982\u4f55\u914d\u7f6e\u7684\u3002\u5728 EVT/EXAM/SRC/Startup/startup_ch32v30x_D8C.S \u53ef\u4ee5\u770b\u5230\u521d\u59cb\u5316\u7684\u6c47\u7f16\u4ee3\u7801\u3002\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0c\u8fd9\u4e2a\u6838\u5fc3\u6269\u5c55\u4e86 mtvec\uff0c\u652f\u6301 ARM \u7684 vector table \u6a21\u5f0f\uff0c\u5373\u653e\u4e00\u4e2a\u6307\u9488\u6570\u7ec4\uff0c\u800c\u4e0d\u662f\u6307\u4ee4\uff1a</p> <pre><code>    .section    .vector,\"ax\",@progbits\n    .align  1\n_vector_base:\n    .option norvc;\n    .word   _start\n    .word   0\n    .word   NMI_Handler                /* NMI */\n    .word   HardFault_Handler          /* Hard Fault */\n</code></pre> <p>\u8fd9\u4e9b\u540d\u5b57\u5982\u6b64\u719f\u6089\uff0c\u53ea\u80fd\u8bf4\u8fd9\u662f ARVM \u4e86\uff08ARM + RV\uff09\u3002\u540e\u9762\u7684\u90e8\u5206\u6bd4\u8f83\u5e38\u89c4\uff0c\u628a data \u6bb5\u590d\u5236\u5230 sram\uff0c\u7136\u540e\u6e05\u7a7a bss\uff1a</p> <pre><code>handle_reset:\n.option push \n.option norelax \n        la gp, __global_pointer$\n.option pop \n1:\n        la sp, _eusrstack \n2:\n        /* Load data section from flash to RAM */\n        la a0, _data_lma\n        la a1, _data_vma\n        la a2, _edata\n        bgeu a1, a2, 2f\n1:\n        lw t0, (a0)\n        sw t0, (a1)\n        addi a0, a0, 4\n        addi a1, a1, 4\n        bltu a1, a2, 1b\n2:\n        /* Clear bss section */\n        la a0, _sbss\n        la a1, _ebss\n        bgeu a0, a1, 2f\n1:\n        sw zero, (a0)\n        addi a0, a0, 4\n        bltu a0, a1, 1b\n2:\n</code></pre> <p>\u6700\u540e\u662f\u8fdb\u884c\u4e00\u4e9b csr \u7684\u914d\u7f6e\uff0c\u7136\u540e\u8fdb\u5165 C \u4ee3\u7801\uff1a</p> <pre><code>    li t0, 0x1f\n    csrw 0xbc0, t0\n\n    /* Enable nested and hardware stack */\n    li t0, 0x1f\n    csrw 0x804, t0\n\n    /* Enable floating point and interrupt */\n    li t0, 0x6088           \n    csrs mstatus, t0\n\n    la t0, _vector_base\n    ori t0, t0, 3           \n    csrw mtvec, t0\n\n    lui a0, 0x1ffff\n    li a1, 0x300\n    sh a1, 0x1b0(a0)\n1:  lui s2, 0x40022\n    lw a0, 0xc(s2)\n    andi a0, a0, 1\n    bnez a0, 1b\n\n    jal  SystemInit\n    la t0, main\n    csrw mepc, t0\n    mret\n</code></pre> <p>\u8fd9\u91cc\u6709\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684 csr\uff0c\u6bd4\u5982 corecfgr(0xbc0)\uff0cintsyscr(0x804\uff0c\u8bbe\u7f6e\u4e86 HWSTKEN=1, INESTEN=1, PMTCFG=0b11, HWSTKOVEN=1)\uff0c\u5177\u4f53\u53c2\u8003 QingKeV4_Processor_Manual\u3002\u63a5\u7740\u4ee3\u7801\u5f80 0x1ffff1b0 \u5199\u5165 0x300\uff0c\u7136\u540e\u4e0d\u65ad\u8bfb\u53d6 FLASH Interface (0x40022000) \u7684 STATR \u5b57\u6bb5\uff0c\u6ca1\u6709\u627e\u5230\u4ee3\u7801\u4e2d\u76f8\u5173\u7684\u5b9a\u4e49\uff0c\u7b80\u5355\u731c\u6d4b\u4e0e Flash \u7684\u96f6\u7b49\u5f85/\u975e\u96f6\u7b49\u5f85\u533a\u6709\u5173\uff0c\u56e0\u4e3a\u540e\u7eed\u4ee3\u7801\u8981\u63d0\u9ad8\u9891\u7387\uff0c\u56e0\u6b64 Flash \u63a7\u5236\u5668\u9700\u8981\u589e\u52a0 wait state\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#\u7f16\u8bd1","title":"\u7f16\u8bd1","text":"<p>\u53ef\u4ee5\u7528 MounRiver \u7f16\u8bd1\uff0c\u4e5f\u53ef\u4ee5\u7528 SiFive \u7684 riscv64-unknown-elf \u5de5\u5177\u94fe\u8fdb\u884c\u7f16\u8bd1\uff0c\u53c2\u8003 Embedded_Projects/CH32V307_Template \u9879\u76ee\u4e2d\u7684\u7f16\u8bd1\u65b9\u5f0f\uff0c\u4fee\u6539 <code>riscv64-elf.cmake</code> \u4e3a\uff1a</p> <pre><code>set(CMAKE_SYSTEM_NAME Generic)\nset(CMAKE_C_COMPILER riscv64-unknown-elf-gcc)\nset(CMAKE_CXX_COMPILER riscv64-unknown-elf-g++)\n# Make CMake happy about those compilers\nset(CMAKE_TRY_COMPILE_TARGET_TYPE \"STATIC_LIBRARY\")\n</code></pre> <p>\u7136\u540e\u4ea4\u53c9\u7f16\u8bd1\u5c31\u53ef\u4ee5\u4e86\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5bf9 libnosys \u7684\u5904\u7406\uff0c\u5982\u679c\u6ca1\u6709\u6b63\u786e\u94fe\u63a5\uff0c\u5c31\u4f1a\u51fa\u73b0 syscall\uff0c\u7136\u540e\u5728 ecall handler \u91cc\u9762\u6b7b\u5faa\u73af\u3002</p> <p>\u5982\u679c\u4e0d\u60f3\u7528 CMake\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u7cbe\u7b80\u7248 Makefile\uff1a</p> <pre><code>USER := User/main.c User/ch32v30x_it.c User/system_ch32v30x.c\nLIBRARY := ../../SRC/Peripheral/src/ch32v30x_misc.c \\\n    ../../SRC/Peripheral/src/ch32v30x_usart.c \\\n    ../../SRC/Peripheral/src/ch32v30x_gpio.c \\\n    ../../SRC/Peripheral/src/ch32v30x_rcc.c \\\n    ../../SRC/Debug/debug.c \\\n    ../../SRC/Startup/startup_ch32v30x_D8C.S\nLDSCRIPT = ../../SRC/Ld/Link.ld\n# disable libc first\nCFLAGS := -march=rv32imafc -mabi=ilp32f \\\n    -flto -ffunction-sections -fdata-sections \\\n    -nostartfiles -nostdlib \\\n    -T $(LDSCRIPT) \\\n    -I../../SRC/Debug \\\n    -I../../SRC/Core \\\n    -I../../SRC/Peripheral/inc \\\n    -I./User \\\n    -O2 \\\n    -Wl,--print-memory-usage\n# link libc &amp; libnosys in the end\nCFLAGS_END := \\\n    -lc -lgcc -lnosys\nPREFIX := riscv64-unknown-elf-\n\nall: obj/build.bin\n\nobj/build.bin: obj/build.elf\n    $(PREFIX)objcopy -O binary $^ $@\n\nobj/build.elf: $(USER) $(LIBRARY)\n    $(PREFIX)gcc $(CFLAGS) $^ $(CFLAGS_END) -o $@\n\nclean:\n    rm -rf obj/*\n</code></pre>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#\u70e7\u5199-flash","title":"\u70e7\u5199 Flash","text":"<p>\u7f16\u8bd1\u597d\u4ee5\u540e\uff0c\u6839\u636e WCH OpenOCD \u7684\u6587\u6863\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u914d\u7f6e\u6765\u8fdb\u884c\u70e7\u5199\uff1a</p> <pre><code>#interface wlink\nadapter driver wlink\nwlink_set\nset _CHIPNAME riscv\njtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x00001\n\nset _TARGETNAME $_CHIPNAME.cpu\n\ntarget create $_TARGETNAME.0 riscv -chain-position $_TARGETNAME\n$_TARGETNAME.0 configure  -work-area-phys 0x80000000 -work-area-size 10000 -work-area-backup 1\nset _FLASHNAME $_CHIPNAME.flash\n\nflash bank $_FLASHNAME wch_riscv 0x00000000 0 0 0 $_TARGETNAME.0\n\ninit\nhalt\n\nflash erase_sector wch_riscv 0 last\nprogram /path/to/firmware\nverify_image /path/to/firmware\nwlink_reset_resume\nexit\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>$ openocd -f program.cfg\nOpen On-Chip Debugger 0.11.0+dev-01623-gbfa3bc7f9 (2022-04-20-09:55)\nLicensed under GNU GPL v2\nFor bug reports, read\n        http://openocd.org/doc/doxygen/bugs.html\nInfo : only one transport option; autoselect 'jtag'\nReady for Remote Connections\nInfo : WCH-Link version 2.3\nInfo : wlink_init ok\nInfo : This adapter doesn't support configurable speed\nInfo : JTAG tap: riscv.cpu tap/device found: 0x00000001 (mfg: 0x000 (&lt;invalid&gt;), part: 0x0000, ver: 0x0)\nWarn : Bypassing JTAG setup events due to errors\nInfo : [riscv.cpu.0] datacount=2 progbufsize=8\nInfo : Examined RISC-V core; found 1 harts\nInfo :  hart 0: XLEN=32, misa=0x40901125\n[riscv.cpu.0] Target successfully examined.\nInfo : starting gdb server for riscv.cpu.0 on 3333\nInfo : Listening on port 3333 for gdb connections\nInfo : device id = REDACTED\nInfo : flash size = 256kbytes\nInfo : JTAG tap: riscv.cpu tap/device found: 0x00000001 (mfg: 0x000 (&lt;invalid&gt;), part: 0x0000, ver: 0x0)\nWarn : Bypassing JTAG setup events due to errors\n** Programming Started **\n** Programming Finished **\nInfo : Verify Success\n</code></pre> <p>\u8bbf\u95ee\u4e32\u53e3 <code>screen /dev/tty.usbmodem* 115200</code>\uff0c\u53ef\u4ee5\u770b\u5230\u6b63\u786e\u5730\u8f93\u51fa\u4e86\u5185\u5bb9\u3002</p>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2022/04/19/wch-ch32v307-eval/#\u8f6c\u53d1","title":"\u8f6c\u53d1","text":"<p>\u672c\u6587\u5df2\u6388\u6743\u8f6c\u53d1\u5230\u4ee5\u4e0b\u7684\u5730\u5740\uff1a</p> <ul> <li>\u516c\u4f17\u53f7 \u7269\u8054\u7f51\u5c0f\u751f \u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> <li>\u8bed\u96c0 \u786c\u4ef6\u77e5\u8bc6\u5e93 \u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> </ul>","tags":["wch","ch32","ch32v307","riscv","eval"]},{"location":"hardware/2023/03/20/wireless-network/","title":"802.11 \u5b66\u4e60","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5b66\u4e60 802.11\uff0c\u5728\u535a\u5ba2\u4e0a\u8bb0\u5f55\u4e00\u4e0b\u6211\u7684\u5b66\u4e60\u8fc7\u7a0b\u3002</p> <p>\u672c\u6587\u53c2\u8003\u4e86 802.11-1997 \u5e76\u4f7f\u7528\u4e86\u6807\u51c6\u4e2d\u7684\u56fe\u7247\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#mac-\u5c42\u5e27\u683c\u5f0f","title":"MAC \u5c42\u5e27\u683c\u5f0f","text":"<p>802.11 MAC \u5c42\u7684\u5e27\u683c\u5f0f\uff0c\u5982 802.11-1997 Figure 12\uff1a</p> <p></p> <p>\u524d\u4e24\u4e2a\u5b57\u8282 Frame Control \u7684\u5b9a\u4e49\u5982 802.11-1997 Figure 13\uff1a</p> <p></p> <p>\u6839\u636e Type \u548c Subtype \u5b57\u6bb5\u51b3\u5b9a\u4e86\u5e27\u7684\u7c7b\u578b\uff0c\u5982\u7ba1\u7406\uff08Management\uff09\u5e27\uff0c\u63a7\u5236\uff08Control\uff09\u5e27\u548c\u6570\u636e\uff08Data\uff09\u5e27\u3002</p> <p>\u65e0\u7ebf\u8def\u7531\u5668\u5b9a\u671f\u53d1\u9001 Beacon frame\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u81ea\u5df1\u5e7f\u64ad\u4e86\u54ea\u4e9b SSID\u3002\u5ba2\u6237\u7aef\u4e5f\u53ef\u4ee5\u4e3b\u52a8\u53d1\u9001 Probe Request frame \u6765\u8be2\u95ee\u6709\u6ca1\u6709\u8def\u7531\u5668\u6709\u5bf9\u5e94\u7684 SSID\uff0c\u5982\u679c\u6709\uff0c\u8def\u7531\u5668\u56de\u590d\u4e00\u4e2a Probe Response frame\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#phy","title":"PHY","text":"<p>802.11 \u652f\u6301\u5f88\u591a\u79cd PHY\uff0c\u5e38\u89c1\u7684\u6709 802.11 b/g/n/ac/ax\u3002\u8d77\u540d\u4e5f\u5f88\u6709\u610f\u601d\uff1a</p> <ul> <li>802.11b: High Rate\uff0c\u6700\u9ad8 11 Mbps</li> <li>802.11g: Extended Rate\uff0c\u6700\u9ad8 54 Mbps</li> <li>802.11n: High Throughput\uff0c\u6700\u9ad8 600 Mbps</li> <li>802.11ac: Very High Throughput\uff0c\u6700\u9ad8 6933 Mbps</li> <li>802.11ax: High Efficiency\uff0c\u6700\u9ad8 9608 Mbps</li> </ul>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#80211b","title":"802.11b","text":"<p>\u9996\u5148\u770b 802.11b\uff0c802.11b \u662f\u5bf9 802.11 \u7684\u8865\u5145\uff0c\u4e3b\u8981\u5b9a\u4e49\u4e86\u7b2c 18 \u7ae0 <code>High Rate, direct sequence spread spectrum PHY specification</code>\uff0c\u7f29\u5199 HR-DSSS\u3002</p> <p>HR-DSSS \u5de5\u4f5c\u5728 2.4 GHz \u9891\u6bb5\u4e0a\uff0c\u5e38\u7528\u7684\u662f 13 \u4e2a channel\uff0c\u4e2d\u5fc3\u9891\u7387\u4ece 2412 MHz \u5230 2472 MHz \u4e0d\u7b49\uff0c\u5448\u7b49\u5dee\u6570\u5217\uff0c\u516c\u5dee\u662f 5 MHz\u3002HR-DSSS \u4f1a\u5360\u7528 22MHz \u7684\u9891\u8c31\uff0c\u4ece\u4e2d\u5fc3\u9891\u7387\u51cf 11 MHz \u5230\u4e2d\u5fc3\u9891\u7387\u52a0 11 MHz\uff0c\u6240\u4ee5\u76f8\u90bb channel \u4f1a\u6709\u5e72\u6270\uff0c\u89c1\u4e0b\u56fe\uff08\u53d6\u81ea Wikipedia\uff09</p> <p></p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u901a\u5e38\u4f1a\u628a 2.4GHz \u65e0\u7ebf\u8def\u7531\u5668\u7684 channel \u56fa\u5b9a\u4e3a 1\u30016 \u6216 11\u3002</p> <p>\u90a3\u4e48\uff0cHR-DSSS \u5982\u4f55\u628a\u6570\u636e\u8c03\u5236\u4e3a 2.4GHz \u4e0a\u7684\u4fe1\u53f7\u5462\uff1fHR-DSSS \u652f\u6301\u4e0d\u540c\u7684\u901f\u7387\uff0c\u4f8b\u5982 1\u30012\u30015.5 \u548c 11 Mbps\uff0c\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u7684\u6570\u636e\u9700\u8981\u6309\u7167\u4e00\u5b9a\u7684\u65b9\u6cd5\u8c03\u5236\u5230 2.4 GHz \u7684\u8f7d\u6ce2\u4e0a\u3002</p> <p>\u9996\u5148\u662f\u6700\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\u5728 channel 1 \u4e0a\u4f20\u8f93 1 Mbps \u7684\u6570\u636e\uff0c802.11 \u91c7\u7528\u7684\u662f DSSS \u7684\u65b9\u6cd5\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5bf9\u4e8e\u8f93\u5165\u7684\u6bcf\u4e2a\u4f4d\uff0c\u6269\u5c55\u6210 11 \u4e2a bit\uff0c\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a 11 MHz \u7684\u57fa\u5e26\u4fe1\u53f7\uff0c\u7136\u540e\u518d\u628a\u57fa\u5e26\u4fe1\u53f7\u901a\u8fc7 DBPSK \u8c03\u5236\u5230 2412 MHz \u7684\u8f7d\u6ce2\u4fe1\u53f7\u4e0a\u3002</p> <p>\u8fd9\u4e2a\u6269\u5c55\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a\u5982\u679c\u6570\u636e\u4f4d\u662f 0\uff0c\u90a3\u5c31\u8f93\u51fa 10110111000\uff08Barker \u7801\uff09\uff1b\u5982\u679c\u6570\u636e\u4f4d\u662f 1\uff0c\u90a3\u5c31\u8f93\u51fa 01001000111\u3002\u5b9e\u9645\u4e0a\u5c31\u662f\u628a 1 \u4f4d\u7684\u4fe1\u606f\u91cd\u590d\u4e86 11 \u6b21\u518d\u53d1\u51fa\u53bb\uff0c\u770b\u8d77\u6765\u5f88\u6d6a\u8d39\uff0c\u4f46\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u5e72\u6270\u7684\u95ee\u9898\uff0c\u5373\u4f7f\u4f20\u8f93\u4e2d\u51fa\u73b0\u4e86\u9519\u8bef\uff0c\u63a5\u53d7\u65b9\u4e5f\u5f88\u5bb9\u6613\u4ece 11 \u4f4d\u7684\u6570\u636e\u4e2d\u6062\u590d\u51fa\u539f\u6765\u7684\u6570\u636e\u3002</p> <p>2 Mbps \u7684\u4f20\u8f93\u65b9\u5f0f\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u4e2a symbol \u4f20\u8f93\u4e24\u4f4d\u7684\u6570\u636e\uff0c\u6240\u4ee5\u91c7\u7528 DQPSK \u7684\u8c03\u5236\u65b9\u6cd5\uff0c\u9891\u7387\u4fdd\u6301\u4e0d\u53d8\uff0c\u5b9e\u73b0\u4e86\u4e24\u500d\u7684\u6570\u636e\u4f20\u8f93\u901f\u7387\u3002</p> <p>5.5 Mbps \u548c 11 Mbps \u5219\u91c7\u7528\u4e86\u5176\u4ed6\u65b9\u6cd5\u3002\u7531\u4e8e\u4e0a\u9762\u7684 1 \u6bd4 11 \u7684\u8f6c\u6362\u6bd4\u4f8b\u592a\u6d6a\u8d39\u4e86\uff0c\u6240\u4ee5\u4e3a\u4e86\u63d0\u5347\u901f\u5ea6\uff0c5.5 Mbps \u548c 11 Mbps \u65f6\u91c7\u7528\u7684\u662f CCK \u7f16\u7801\u65b9\u5f0f\uff0c\u5177\u4f53\u6765\u8bf4\uff0c5.5 Mbps \u7684\u65f6\u5019\uff0c\u8f93\u5165\u7684 4 \u4e2a bit \u4f1a\u6620\u5c04\u4e3a 8 \u4e2a chip\uff0c\u7c7b\u4f3c\u5730 11 Mbps \u7684\u65f6\u5019\uff0c\u8f93\u5165\u7684 8 \u4e2a bit \u4e5f\u6620\u5c04\u5230 8 \u4e2a chip\u3002\u6bcf\u4e2a chip \u90fd\u662f\u590d\u6570\uff0c\u91c7\u7528 DQPSK \u8fdb\u884c\u8c03\u5236\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u8fc7\u7a0b\u90fd\u662f\u5728\u5197\u4f59\uff1a\u901f\u7387\u4f4e\u7684\u65f6\u5019\uff0c\u5c31\u5197\u4f59\u5f88\u591a\u4efd\uff1b\u901f\u7387\u9ad8\u7684\u65f6\u5019\uff0c\u5197\u4f59\u5c31\u6bd4\u8f83\u5c11\u3002\u5b9e\u9645\u4e0a\uff0c5.5 Mbps \u548c 11 Mbps \u8fd8\u53ef\u4ee5\u91c7\u7528\u53ef\u9009\u7684 PBCC \u8fdb\u884c\u7f16\u7801\uff0c\u4e0b\u9762\u6458\u6284\u4e86 About Data Modulation Format (802.11b/g DSSS/CCK/PBCC) \u4e2d 802.11b \u4e0d\u540c\u901f\u7387\u548c\u7f16\u7801\u65b9\u5f0f\u7684\u8868\u683c\uff1a</p> Data Modulation Formats Spread Sequence Code scheme Data Rate(Mbps) Symbol Rate(Msps) Chip Rate (Mcps) Bits per Symbol Modulation Barker 1 11 Chip Barker 1 1 11 1 DBPSK Barker 2 11 Chip Barker 2 1 11 2 DQPSK CCK 5.5 8 chip CCK 5.5 1.375 11 4 DQPSK CCK 11 8 chip CCK 11 1.375 11 8 DQPSK PBCC 5.5 PBCC 5.5 11 N/A 0.5 QPSK PBCC 11 PBCC 11 11 N/A 1 QPSK","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#80211g","title":"802.11g","text":"<p>802.11g \u5b9a\u4e49\u4e86\u7b2c 19 \u7ae0 <code>Extended Rate PHY specification</code>\uff0c\u4e5f\u5c31\u662f ERP(Extended Rate PHY)\uff0c\u5176\u4e3b\u8981\u91c7\u7528\u7684\u6280\u672f\u662f OFDM\uff0c\u8fde\u8d77\u6765\u5c31\u662f ERP-OFDM\uff0c\u989d\u5916\u652f\u6301\u66f4\u591a\u901f\u7387\uff1a6\u30019\u300112\u300118\u300124\u300136\u300148 \u548c 54 Mbps\u3002\u5404\u79cd\u8c03\u5236\u6280\u672f\u7684\u901f\u7387\u5bf9\u6bd4\uff1a</p> <ul> <li>DSSS: 802.11 1/2 Mbps</li> <li>CCK: 802.11b 5.5/11 Mbps</li> <li>OFDM: 802.11g 6/9/12/18/24/36/48/54 Mbps</li> <li>PBCC: 802.11b 5.5/11 Mbps, 802.11g 22/33 Mbps</li> </ul> <p>OFDM \u7684\u6838\u5fc3\u601d\u60f3\u5c31\u662f\u91c7\u7528\u591a\u4e2a\u8f7d\u6ce2\u4fe1\u53f7\uff0c\u8fd9\u4e9b\u8f7d\u6ce2\u4fe1\u53f7\u7684\u9891\u7387\u5448\u7b49\u5dee\u6570\u5217\uff0c\u540c\u65f6\u4fdd\u8bc1\u5404\u8f7d\u6ce2\u76f8\u4e92\u6b63\u4ea4\uff0c\u8fd9\u6837\u5c31\u63d0\u9ad8\u4e86\u6570\u636e\u4f20\u8f93\u901f\u7387\u3002\u4e3a\u4e86\u4fdd\u8bc1\u6b63\u4ea4\uff0c\u76f8\u90bb\u8f7d\u6ce2\u4fe1\u53f7\u7684\u9891\u7387\u7684\u5dee\u8981\u6ee1\u8db3 \\(\\Delta{f} = k / T_U\\)\uff0c\u5176\u4e2d k \u662f\u6b63\u6574\u6570\uff0c\\(T_U\\) \u662f\u6bcf\u4e2a symbol \u7684\u65f6\u95f4\uff08\u5f15\u7528 wikipedia\uff09\u3002\u4e0b\u9762\u662f 802.11 \u6807\u51c6\u4e2d\u7684 OFDM PHY \u7684\u7ec4\u6210\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684\u7f29\u5199\uff1a</p> <ul> <li>FEC: Forward Error Correction</li> <li>IFFT/FFT: Inverse Fast Fourier Transform/Fast Fourier Transform</li> <li>GI: Guard Interval</li> <li>I/Q: In-phase/Quadrature</li> <li>HPA: High Power Amplifier</li> <li>LNA: Low Noise Amplifier</li> <li>AGC: Automatic Gain Control</li> <li>AFC: Automatic Frequency Control</li> </ul> <p>802.11g \u7684\u4fe1\u53f7\u5e26\u5bbd\u662f 20MHz\uff0c\u5206\u6210 52 \u4e2a\u5b50\u8f7d\u6ce2\uff0c\u5b50\u8f7d\u6ce2\u7684\u95f4\u8ddd\u662f 0.3125 MHz\uff0820 MHz / 64\uff0c\\(T_{FFT}=3.2 \\mu s, \\Delta{f} = 1 / T_{FFT}\\)\uff09\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u53ea\u5360\u4e86 \\(0.3125 \\textit{MHz} * 52 = 16.25 \\textit{MHz}\\) \u7684\u9891\u8c31\u3002\u5176\u4e2d 48 \u4e2a\u7528\u4e8e\u4f20\u8f93\u6570\u636e\uff0c\u6bcf\u4e2a\u8f7d\u6ce2\u4e0a\u53ef\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u8c03\u5236\u65b9\u6cd5\u300254 Mbps \u662f\u600e\u4e48\u7b97\u7684\u5462\uff1f802.11g \u7684 Symbol rate \u662f 250000 \u6bcf\u79d2\uff08\u56e0\u4e3a \\(T_{SYM} = 3.2 + 0.8 = 4 \\mu s\\)\uff09\uff0c\u5982\u679c\u4f7f\u7528 64-QAM \u8c03\u5236\uff0c\u90a3\u4e48\u6bcf\u4e2a symbol \u5bf9\u5e94 6 \u4e2a bit\uff0c\u7136\u540e\u4f7f\u7528\u7ea0\u9519\u7801\uff0c\u7ea0\u9519\u7684\u65f6\u5019\u6d6a\u8d39\u4e86 1/4 \u7684\u4f4d\uff0c\u5b9e\u9645\u6570\u636e\u5360 3/4\uff0c\u4e00\u5171 48 \u4e2a\u8f7d\u6ce2\uff0c\u90a3\u4e48\u6570\u636e\u901f\u7387\u5c31\u662f $ 48 * 250000 * 6 * 3/4 = 54 \\textit{Mbps}$\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#80211n","title":"802.11n","text":"<p>802.11n \u5728 802.11g \u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e86 MIMO\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u7528\u591a\u4e2a\u5929\u7ebf\u540c\u65f6\u4f20\u8f93\u3002</p> <p>\u9996\u5148\u8fd8\u662f\u8003\u8651\u5355\u5929\u7ebf\u7684\u60c5\u51b5\uff0c\u57fa\u672c\u548c 802.11g \u76f8\u540c\uff0c\u533a\u522b\u662f\u91c7\u7528\u4e86 52\uff08\\(N_{SD}\\)\uff09\u4e2a OFDM \u5b50\u8f7d\u6ce2\u7528\u4e8e\u4f20\u8f93\u6570\u636e\uff0c\u540c\u65f6\u7ea0\u9519\u7801\u5e26\u6765\u7684\u6d6a\u8d39\u6bd4\u4f8b\u4ece 1/4 \u964d\u5230\u4e86 1/6\uff0c\u6240\u4ee5\u6570\u636e\u901f\u7387\u662f \\(52 * 250000 * 6 * 5/6 = 65 \\textit{Mbps}\\)\u3002802.11n \u8fd8\u63d0\u4f9b\u4e86 Short GI\uff08Guard Interval\uff09\u9009\u9879\uff0c\u628a GI \u4ece 800 ns \u964d\u4f4e\u5230 400ns\uff0c\u4f7f\u5f97\u6bcf\u4e2a symbol \u7684\u65f6\u95f4\u53ef\u4ee5\u4ece \\(3.2 + 0.8 = 4 \\mu s\\) \u964d\u4f4e\u5230 \\(3.2 + 0.4 = 3.6 \\mu s\\)\uff0c\u6b64\u65f6\u7684\u6570\u636e\u901f\u7387\u8fbe\u5230 \\(52 * 1000000 / 3.6 * 6 * 5/6 = 72.2 \\textit{Mbps}\\)\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c802.11n \u8fd8\u5f15\u5165\u4e86 40 MHz \u9891\u5bbd\u7684\u9009\u9879\uff0c\u4ee5\u5360\u7528\u66f4\u591a\u9891\u8c31\u4e3a\u4ee3\u4ef7\uff0c\u6362\u6765\u53ef\u4ee5\u7528 108 \u4e2a\u5b50\u8f7d\u6ce2\u6765\u4f20\u8f93\u6570\u636e\uff0c\u6b64\u65f6\u6570\u636e\u901f\u7387\u53ef\u4ee5\u8fbe\u5230 \\(108 * 1000000 / 3.6 * 6 * 5 / 6 = 150 \\textit{Mbps}\\)\u3002</p> <p>\u8003\u8651\u591a\u5929\u7ebf\uff0c\u5982\u679c\u540c\u65f6\u4e24\u6839\u5929\u7ebf\u4f20\u8f93\u6570\u636e\uff0c\u90a3\u4e48\u6570\u636e\u901f\u7387\u5c31\u662f\u4e24\u500d\uff0c\u8fbe\u5230 \\(300 \\textit{Mbps}\\)\uff1b\u6700\u9ad8\u53ef\u4ee5\u540c\u65f6\u56db\u6839\u5929\u7ebf\u4f20\u8f93\u6570\u636e\uff0c\u6240\u4ee5\u6570\u636e\u901f\u7387\u6700\u9ad8\u7406\u8bba\u503c\u662f \\(600 \\textit{Mbps}\\)\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#80211ac","title":"802.11ac","text":"<p>802.11ac \u6dfb\u52a0\u4e86 160 MHz \u9891\u5bbd\u7684\u9009\u9879\uff0c\u53ef\u4ee5\u63d0\u4f9b 468 \u4e2a\u5b50\u8f7d\u6ce2\uff0c\u8c03\u5236\u65b9\u5f0f\u4ece 64-QAM \u63d0\u5347\u5230 256-QAM\uff0c\u540c\u65f6\u6700\u5927\u53ef\u4ee5\u6709 8 \u6839\u5929\u7ebf\u540c\u65f6\u4f20\u8f93\u6570\u636e\uff0c\u6700\u5927\u6570\u636e\u901f\u7387\u662f \\(468 * 1000000 / 3.6 * 8 * 5 / 6 * 8 = 6933.3 \\textit{Mbps}\\)\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\uff0c\u63d0\u9ad8\u65e0\u7ebf\u7f51\u7edc\u7684\u901f\u7387\u7684\u65b9\u6cd5\u5c31\u662f\u63d0\u9ad8\u4e0a\u5f0f\u7684\u5404\u4e2a\u7cfb\u6570\uff1a</p> <ul> <li>\u5b50\u8f7d\u6ce2\u6570\u91cf\uff1a\u589e\u52a0\u9891\u5bbd\uff0c\u6216\u8005\u5728\u9891\u5bbd\u4e00\u5b9a\u7684\u65f6\u5019\uff0c\u7559\u51fa\u66f4\u591a\u7684\u5b50\u8f7d\u6ce2\u7528\u4e8e\u6570\u636e\uff0c\u63d0\u5347\u8f83\u5927\uff0c\u4f46\u9891\u7387\u4e0d\u80fd\u592a\u5bbd</li> <li>Symbol \u65f6\u95f4\uff1a\u51cf\u5c11 Guard Interval\uff0c\u63d0\u5347\u4e0d\u5927</li> <li>QAM \u4f4d\u6570\uff1a\u4ece PSK \u5230 4-QAM \u5230 64-QAM \u5230 256-QAM\uff0c\u63d0\u5347\u96be\u5ea6\u8f83\u5927</li> <li>\u7ea0\u9519\u7801\u5f00\u9500\uff1a\u4e0d\u4f1a\u8d85\u8fc7 1\uff0c\u96be\u4ee5\u63d0\u5347</li> <li>\u66f4\u591a\u5929\u7ebf\uff1a\u4ece 1 \u5230 4 \u5230 8\uff0c\u672a\u6765\u5230 16\uff0c\u9010\u6b65\u63d0\u5347</li> </ul> <p>\u6240\u4ee5\u8981\u8fdb\u4e00\u6b65\u63d0\u5347\u6027\u80fd\uff0c\u4e3b\u8981\u4ece\u5b50\u8f7d\u6ce2\u6570\u91cf\u3001QAM \u4f4d\u6570\u548c MIMO \u6570\u91cf\u4e0a\u505a\u6587\u7ae0\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#80211ax","title":"802.11ax","text":"<p>802.11ax \u53ef\u4ee5\u63d0\u4f9b 1960 \u4e2a\u5b50\u8f7d\u6ce2\uff08\u95f4\u8ddd\u4ece 312.5 kHz \u7f29\u5c0f\u5230 78.125 kHz\uff0c\\(\\Delta{f} = 78.125 kHz, T_{FFT} = 1 / \\Delta{f} = 12.8 \\mu s\\)\uff09\uff0c\u8c03\u5236\u65b9\u5f0f\u4ece 256-QAM \u63d0\u5347\u5230 1024-QAM\uff0c\u4f46\u662f \\(T_{SYM}\\) \u4e5f\u63d0\u9ad8\u5230\u4e86 \\(12.8 + 0.8 = 13.6 \\mu s\\)\uff0c\u6700\u5927\u6570\u636e\u901f\u7387\u662f \\(1960 * 1000000 / 13.6 * 10 * 5 / 6 * 8 = 9607.8 \\textit{Mbps}\\)\u3002</p>","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2023/03/20/wireless-network/#ofdm-\u5bf9\u6bd4","title":"OFDM \u5bf9\u6bd4","text":"<p>\u4e0b\u9762\u603b\u7ed3\u4e86\u4f7f\u7528 OFDM \u7684 PHY \u7684\u5404\u9879\u53c2\u6570\uff0c\u5176\u4e2d Data rate \u7684\u8ba1\u7b97\u516c\u5f0f\uff1a<code>Subcarrier * 1000000 / T_{SYM} * Coding Rate * MIMO streams</code>\u3002</p> Standard Subcarrier T_{SYM} QAM bits Coding Rate MIMO streams Data rate 802.11g 48 4 us 6 3/4 1 54 Mbps 802.11n 108 3.6 us 6 5/6 4 600 Mbps 802.11ac 468 3.6 us 8 5/6 8 6933.3 Mbps 802.11ax 1960 13.6 us 10 5/6 8 9607.8 Mbps","tags":["wireless","wifi","wlan","ieee802.11"]},{"location":"hardware/2022/06/19/wishbone/","title":"\u300c\u6559\u5b66\u300dWishbone \u603b\u7ebf\u534f\u8bae","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2022/06/19/wishbone/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u5982\u4f55\u628a Wishbone \u603b\u7ebf\u534f\u8bae\u5f15\u5165\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u8bfe\u7a0b\uff0c\u56e0\u6b64\u8d81\u6b64\u673a\u4f1a\u5b66\u4e60\u4e86\u4e00\u4e0b Wishbone \u7684\u534f\u8bae\u3002</p>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2022/06/19/wishbone/#\u603b\u7ebf","title":"\u603b\u7ebf","text":"<p>\u603b\u7ebf\u662f\u4ec0\u4e48\uff1f\u603b\u7ebf\u901a\u5e38\u7528\u4e8e\u8fde\u63a5 CPU \u548c\u5916\u8bbe\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u517c\u5bb9\u6027\u548c\u53ef\u590d\u7528\u6027\uff0c\u4f1a\u60f3\u5230\u80fd\u5426\u8bbe\u8ba1\u4e00\u4e2a\u7edf\u4e00\u7684\u534f\u8bae\uff0c\u5176\u4e2d CPU \u5b9e\u73b0\u7684\u662f\u53d1\u8d77\u8bf7\u6c42\u7684\u4e00\u65b9\uff08\u53c8\u79f0\u4e3a master\uff09\uff0c\u5916\u8bbe\u5b9e\u73b0\u7684\u662f\u63a5\u6536\u8bf7\u6c42\u7684\u4e00\u65b9\uff08\u53c8\u79f0\u4e3a slave\uff09\uff0c\u90a3\u4e48\u5982\u679c\u8981\u6dfb\u52a0\u5916\u8bbe\u3001\u6216\u8005\u66ff\u6362 CPU \u5b9e\u73b0\uff0c\u90fd\u4f1a\u53d8\u5f97\u6bd4\u8f83\u7b80\u5355\uff0c\u51cf\u5c11\u4e86\u8bb8\u591a\u9002\u914d\u7684\u5de5\u4f5c\u91cf\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u601d\u8003\u4e00\u4e0b\uff0c\u4e00\u4e2a\u603b\u7ebf\u534f\u8bae\u9700\u8981\u5305\u62ec\u54ea\u4e9b\u5185\u5bb9\uff1f\u5bf9\u4e8e CPU \u6765\u8bf4\uff0c\u7a0b\u5e8f\u4f1a\u8bfb\u5199\u5185\u5b58\uff0c\u8bfb\u5199\u5185\u5b58\u5c31\u9700\u8981\u4ee5\u4e0b\u51e0\u4e2a\u4fe1\u53f7\u4f20\u8f93\u5230\u5185\u5b58\uff1a</p> <ol> <li>\u5730\u5740\uff08<code>addr</code>\uff09\uff1a\u4f8b\u5982 32 \u4f4d\u5904\u7406\u5668\u5c31\u662f 32 \u4f4d\u5730\u5740\uff0c\u6216\u8005\u6309\u7167\u5185\u5b58\u7684\u5927\u5c0f\u8ba1\u7b97\u5730\u5740\u7ebf\u7684\u5bbd\u5ea6</li> <li>\u6570\u636e\uff08<code>w_data</code> \u548c <code>r_data</code>\uff09\uff1a\u5206\u522b\u662f\u5199\u6570\u636e\u548c\u8bfb\u6570\u636e\uff0c\u5bbd\u5ea6\u901a\u5e38\u4e3a 32 \u4f4d \u6216 64 \u4f4d\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u53ef\u4ee5\u4f20\u8f93\u7684\u6570\u636e\u91cf</li> <li>\u8bfb\u8fd8\u662f\u5199\uff08<code>we</code>\uff09\uff1a\u9ad8\u8868\u793a\u5199\uff0c\u4f4e\u8868\u793a\u8bfb</li> <li>\u5b57\u8282\u6709\u6548\uff08<code>be</code>\uff09\uff1a\u4f8b\u5982\u4e3a\u4e86\u5b9e\u73b0\u5355\u5b57\u8282\u5199\uff0c\u867d\u7136 <code>w_data</code> \u53ef\u80fd\u662f 32 \u4f4d\u5bbd\uff0c\u4f46\u662f\u5b9e\u9645\u5199\u5165\u7684\u662f\u5176\u4e2d\u7684\u4e00\u4e2a\u5b57\u8282</li> </ol> <p>\u9664\u4e86\u8bf7\u6c42\u7684\u5185\u5bb9\u4ee5\u5916\uff0c\u4e3a\u4e86\u8868\u793a CPU \u60f3\u8981\u53d1\u9001\u8bf7\u6c42\uff0c\u8fd8\u9700\u8981\u6dfb\u52a0 <code>valid</code> \u4fe1\u53f7\uff1a\u9ad8\u8868\u793a\u53d1\u9001\u8bf7\u6c42\uff0c\u4f4e\u8868\u793a\u4e0d\u53d1\u9001\u8bf7\u6c42\u3002\u5f88\u591a\u65f6\u5019\uff0c\u5916\u8bbe\u7684\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u53ef\u80fd\u65e0\u6cd5\u4fdd\u8bc1\u6bcf\u4e2a\u5468\u671f\u90fd\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42\uff0c\u56e0\u6b64\u5916\u8bbe\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a <code>ready</code> \u4fe1\u53f7\uff1a\u5f53 <code>valid=1 &amp;&amp; ready=1</code> \u7684\u65f6\u5019\uff0c\u53d1\u9001\u5e76\u5904\u7406\u8bf7\u6c42\uff1b\u5f53 <code>valid=1 &amp;&amp; ready=0</code> \u7684\u65f6\u5019\uff0c\u8868\u793a\u5916\u8bbe\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u6b64\u65f6 CPU \u9700\u8981\u4e00\u76f4\u4fdd\u6301 <code>valid=1</code> \u4e0d\u53d8\uff0c\u7b49\u5230\u5916\u8bbe\u51c6\u5907\u597d\u540e\uff0c<code>valid=1 &amp;&amp; ready=1</code> \u8bf7\u6c42\u751f\u6548\u3002</p> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u4e0a\u9762\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u5f97\u5230 master \u548c slave \u7aef\u5206\u522b\u7684\u4fe1\u53f7\u5217\u8868\u3002\u8fd9\u6b21\uff0c\u6211\u4eec\u5728\u547d\u540d\u7684\u65f6\u5019\u7528 <code>_o</code> \u8868\u793a\u8f93\u51fa\u3001<code>_i</code> \u8868\u793a\u8f93\u5165\uff0c\u53ef\u4ee5\u5f97\u5230 master \u7aef\uff08CPU \u7aef\uff09\u7684\u4fe1\u53f7\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u65f6\u949f\u8f93\u5165</li> <li><code>valid_o</code>\uff1a\u9ad8\u8868\u793a master \u60f3\u8981\u53d1\u9001\u8bf7\u6c42</li> <li><code>ready_i</code>\uff1a\u9ad8\u8868\u793a slave \u51c6\u5907\u597d\u5904\u7406\u8bf7\u6c42</li> <li><code>addr_o</code>\uff1amaster \u60f3\u8981\u8bfb\u5199\u7684\u5730\u5740</li> <li><code>we_o</code>\uff1amaster \u60f3\u8981\u8bfb\u8fd8\u662f\u5199</li> <li><code>data_o</code>\uff1amaster \u60f3\u8981\u5199\u5165\u7684\u6570\u636e</li> <li><code>be_o</code>\uff1amaster \u8bfb\u5199\u7684\u5b57\u8282\u4f7f\u80fd\uff0c\u7528\u4e8e\u5b9e\u73b0\u5355\u5b57\u8282\u5199\u7b49</li> <li><code>data_i</code>\uff1aslave \u63d0\u4f9b\u7ed9 master \u7684\u8bfb\u53d6\u7684\u6570\u636e</li> </ol> <p>\u9664\u4e86\u65f6\u949f\u90fd\u662f\u8f93\u5165\u4ee5\u5916\uff0c\u628a\u4e0a\u9762\u5176\u4f59\u7684\u4fe1\u53f7\u8f93\u5165\u3001\u8f93\u51fa\u5bf9\u79f0\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230 slave \u7aef\uff08\u5916\u8bbe\u7aef\uff09\u7684\u4fe1\u53f7\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u65f6\u949f\u8f93\u5165</li> <li><code>valid_i</code>\uff1a\u9ad8\u8868\u793a master \u60f3\u8981\u53d1\u9001\u8bf7\u6c42</li> <li><code>ready_o</code>\uff1a\u9ad8\u8868\u793a slave \u51c6\u5907\u597d\u5904\u7406\u8bf7\u6c42</li> <li><code>addr_i</code>\uff1amaster \u60f3\u8981\u8bfb\u5199\u7684\u5730\u5740</li> <li><code>we_i</code>\uff1amaster \u60f3\u8981\u8bfb\u8fd8\u662f\u5199</li> <li><code>data_i</code>\uff1amaster \u60f3\u8981\u5199\u5165\u7684\u6570\u636e</li> <li><code>be_i</code>\uff1amaster \u8bfb\u5199\u7684\u5b57\u8282\u4f7f\u80fd\uff0c\u7528\u4e8e\u5b9e\u73b0\u5355\u5b57\u8282\u5199\u7b49</li> <li><code>data_o</code>\uff1aslave \u63d0\u4f9b\u7ed9 master \u7684\u8bfb\u53d6\u7684\u6570\u636e</li> </ol> <p>\u6839\u636e\u6211\u4eec\u4e0a\u9762\u8bbe\u8ba1\u7684\u81ea\u7814\u603b\u7ebf\uff0c\u53ef\u4ee5\u7ed8\u5236\u51fa\u4e0b\u9762\u7684\u6ce2\u5f62\u56fe\uff08\u4ee5 master \u7684\u4fe1\u53f7\u4e3a\u4f8b\uff09\uff1a</p> <ul> <li><code>a</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8bf4\u660e\u6709\u8bf7\u6c42\u53d1\u751f\uff0c\u6b64\u65f6 <code>we_o=1</code> \u8bf4\u660e\u662f\u4e00\u4e2a\u5199\u64cd\u4f5c\uff0c\u5e76\u4e14\u5199\u5165\u5730\u5740\u662f <code>addr_o=0x01</code>\uff0c\u5199\u5165\u7684\u6570\u636e\u662f <code>data_o=0x12</code></li> <li><code>b</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=0 &amp;&amp; ready_i=0</code> \u8bf4\u660e\u65e0\u4e8b\u53d1\u751f</li> <li><code>c</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=0</code> \u8bf4\u660e master \u60f3\u8981\u4ece\u5730\u5740 0x02\uff08<code>addr_o=0x02</code>\uff09\u8bfb\u53d6\u6570\u636e\uff08<code>we_o=0</code>\uff09\uff0c\u4f46\u662f slave \u6ca1\u6709\u63a5\u53d7\uff08<code>ready_i=0</code>\uff09</li> <li><code>d</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8bf4\u660e\u6709\u8bf7\u6c42\u53d1\u751f\uff0cmaster \u4ece\u5730\u5740 0x02\uff08<code>addr_o=0x02</code>\uff09\u8bfb\u53d6\u6570\u636e\uff08<code>we_o=0</code>\uff09\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u4e3a 0x34\uff08<code>data_i=0x34</code>\uff09</li> <li><code>e</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=0 &amp;&amp; ready_i=0</code> \u8bf4\u660e\u65e0\u4e8b\u53d1\u751f</li> <li><code>f</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8bf4\u660e\u6709\u8bf7\u6c42\u53d1\u751f\uff0cmaster \u5411\u5730\u5740 0x03\uff08<code>addr_o=0x03</code>\uff09\u5199\u5165\u6570\u636e\uff08<code>we_o=1</code>\uff09\uff0c\u5199\u5165\u7684\u6570\u636e\u4e3a 0x56\uff08<code>data_i=0x56</code>\uff09</li> <li><code>g</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8bf4\u660e\u6709\u8bf7\u6c42\u53d1\u751f\uff0cmaster \u4ece\u5730\u5740 0x01\uff08<code>addr_o=0x01</code>\uff09\u8bfb\u53d6\u6570\u636e\uff08<code>we_o=0</code>\uff09\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u4e3a 0x12\uff08<code>data_i=0x12</code>\uff09</li> <li><code>h</code> \u5468\u671f\uff1a\u6b64\u65f6 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8bf4\u660e\u6709\u8bf7\u6c42\u53d1\u751f\uff0cmaster \u5411\u5730\u5740 0x02\uff08<code>addr_o=0x02</code>\uff09\u5199\u5165\u6570\u636e\uff08<code>we_o=1</code>\uff09\uff0c\u5199\u5165\u7684\u6570\u636e\u4e3a 0x9a\uff08<code>data_i=0x9a</code>\uff09</li> </ul> <p>\u4ece\u4e0a\u9762\u7684\u6ce2\u5f62\u4e2d\uff0c\u53ef\u4ee5\u6709\u51e0\u70b9\u89c2\u5bdf\uff1a</p> <ol> <li>master \u60f3\u8981\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5c31\u8bbe\u7f6e <code>valid_o=1</code>\uff1b\u5f53 slave \u53ef\u4ee5\u63a5\u53d7\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5c31\u8bbe\u7f6e <code>ready_i=1</code>\uff1b\u5728 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u65f6\u89c6\u4e3a\u4e00\u6b21\u8bf7\u6c42</li> <li>\u5982\u679c master \u53d1\u8d77\u8bf7\u6c42\uff0c\u540c\u65f6 slave \u4e0d\u80fd\u63a5\u6536\u8bf7\u6c42\uff0c\u5373 <code>valid_o=1 &amp;&amp; ready_i=0</code>\uff0c\u6b64\u65f6 master \u8981\u4fdd\u6301 <code>addr_o</code> <code>we_o</code> <code>data_o</code> \u548c <code>be_o</code> \u4e0d\u53d8\uff0c\u76f4\u5230\u8bf7\u6c42\u7ed3\u675f</li> <li>\u5f53 master \u4e0d\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5373 <code>valid_o=0</code>\uff0c\u6b64\u65f6\u603b\u7ebf\u4e0a\u7684\u4fe1\u53f7\u90fd\u89c6\u4e3a\u65e0\u6548\u6570\u636e\uff0c\u4e0d\u5e94\u8be5\u8fdb\u884c\u5904\u7406\uff1b\u5bf9\u4e8e\u8bfb\u64cd\u4f5c\uff0c\u53ea\u6709\u5728 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u65f6 <code>data_i</code> \u4e0a\u7684\u6570\u636e\u662f\u6709\u6548\u7684</li> <li>\u53ef\u4ee5\u8fde\u7eed\u591a\u4e2a\u5468\u671f\u53d1\u751f\u8bf7\u6c42\uff0c\u5373 <code>valid_o=1 &amp;&amp; ready_i=1</code> \u8fde\u7eed\u591a\u4e2a\u5468\u671f\u7b49\u4e8e\u4e00\uff0c\u6b64\u65f6\u662f\u7406\u60f3\u60c5\u51b5\uff0c\u53ef\u4ee5\u8fbe\u5230\u603b\u7ebf\u6700\u9ad8\u7684\u4f20\u8f93\u901f\u5ea6</li> </ol>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2022/06/19/wishbone/#wishbone-classic-standard","title":"Wishbone Classic Standard","text":"<p>\u9996\u5148\u6211\u4eec\u6765\u770b\u6700\u7b80\u5355\u7684 Wishbone \u7248\u672c Wishbone Classic Standard\u3002\u5176\u8bbe\u8ba1\u601d\u8def\u548c\u4e0a\u9762\u7684\u81ea\u7814\u603b\u7ebf\u975e\u5e38\u76f8\u4f3c\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u770b\u5b83\u7684\u4fe1\u53f7\uff0c\u4f8b\u5982 master \u7aef\uff08CPU \u7aef\uff09\u7684\u4fe1\u53f7\uff1a</p> <ol> <li><code>CLK_I</code>: \u65f6\u949f\u8f93\u5165\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>clock_i</code></li> <li><code>STB_O</code>\uff1a\u9ad8\u8868\u793a master \u8981\u53d1\u9001\u8bf7\u6c42\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>valid_o</code></li> <li><code>ACK_I</code>\uff1a\u9ad8\u8868\u793a slave \u5904\u7406\u8bf7\u6c42\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>ready_i</code></li> <li><code>ADR_O</code>\uff1amaster \u60f3\u8981\u8bfb\u5199\u7684\u5730\u5740\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>addr_o</code></li> <li><code>WE_O</code>\uff1amaster \u60f3\u8981\u8bfb\u8fd8\u662f\u5199\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>we_o</code></li> <li><code>DAT_O</code>\uff1amaster \u60f3\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>data_o</code></li> <li><code>SEL_O</code>\uff1amaster \u8bfb\u5199\u7684\u5b57\u8282\u4f7f\u80fd\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>be_o</code></li> <li><code>DAT_I</code>\uff1amaster \u4ece slave \u8bfb\u53d6\u7684\u6570\u636e\uff0c\u5373\u81ea\u7814\u603b\u7ebf\u4e2d\u7684 <code>data_i</code></li> <li><code>CYC_O</code>\uff1a\u603b\u7ebf\u7684\u4f7f\u80fd\u4fe1\u53f7\uff0c\u65e0\u5bf9\u5e94\u7684\u81ea\u7814\u603b\u7ebf\u4fe1\u53f7</li> </ol> <p>\u8fd8\u6709\u4e00\u4e9b\u53ef\u9009\u4fe1\u53f7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86\u6700\u540e\u4e00\u4e2a <code>CYC_O</code>\uff0c\u5176\u4ed6\u7684\u4fe1\u53f7\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u521a\u521a\u8bbe\u8ba1\u7684\u81ea\u7814\u603b\u7ebf\u3002<code>CYC_O</code> \u7684\u53ef\u4ee5\u8ba4\u4e3a\u662f master \u60f3\u8981\u5360\u7528 slave \u7684\u603b\u7ebf\u63a5\u53e3\uff0c\u5728\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\u4e0b\uff0c\u76f4\u63a5\u8ba4\u4e3a <code>CYC_O=STB_O</code>\u3002\u5b83\u7684\u7528\u9014\u662f\uff1a</p> <ol> <li>\u5360\u7528 slave \u7684\u603b\u7ebf\u63a5\u53e3\uff0c\u4e0d\u5141\u8bb8\u5176\u4ed6 master \u8bbf\u95ee</li> <li>\u7b80\u5316 interconnect \u7684\u5b9e\u73b0</li> </ol> <p>\u628a\u4e0a\u9762\u81ea\u7814\u603b\u7ebf\u7684\u6ce2\u5f62\u56fe\u6539\u6210 Wishbone Classic Standard\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a</p>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2022/06/19/wishbone/#wishbone-classic-pipelined","title":"Wishbone Classic Pipelined","text":"<p>\u4e0a\u9762\u7684 Wishbone Classic Standard \u534f\u8bae\u975e\u5e38\u7b80\u5355\uff0c\u4f46\u662f\u4f1a\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff1a\u5047\u8bbe\u5b9e\u73b0\u7684\u662f\u4e00\u4e2a SRAM \u63a7\u5236\u5668\uff0c\u5b83\u7684\u8bfb\u64cd\u4f5c\u6709\u4e00\u4e2a\u5468\u671f\u7684\u5ef6\u8fdf\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u8fd9\u4e2a\u5468\u671f\u7ed9\u51fa\u5730\u5740\uff0c\u9700\u8981\u5728\u4e0b\u4e00\u4e2a\u5468\u671f\u624d\u53ef\u4ee5\u5f97\u5230\u7ed3\u679c\u3002\u5728 Wishbone Classic Standard \u4e2d\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u7684\u6ce2\u5f62\uff1a</p> <ul> <li><code>a</code> \u5468\u671f\uff1amaster \u7ed9\u51fa\u8bfb\u5730\u5740 0x01\uff0c\u6b64\u65f6 SRAM \u63a7\u5236\u5668\u5f00\u59cb\u8bfb\u53d6\uff0c\u4f46\u662f\u6b64\u65f6\u6570\u636e\u8fd8\u6ca1\u6709\u8bfb\u53d6\u56de\u6765\uff0c\u6240\u4ee5 <code>ACK_I=0</code></li> <li><code>b</code> \u5468\u671f\uff1a\u6b64\u65f6 SRAM \u5b8c\u6210\u4e86\u8bfb\u53d6\uff0c\u628a\u8bfb\u53d6\u7684\u6570\u636e 0x12 \u653e\u5728 <code>DAT_I</code> \u5e76\u8bbe\u7f6e <code>ACK_I=1</code></li> <li><code>c</code> \u5468\u671f\uff1amaster \u7ed9\u51fa\u4e0b\u4e00\u4e2a\u8bfb\u5730\u5740 0x02\uff0cSRAM \u8981\u91cd\u65b0\u5f00\u59cb\u8bfb\u53d6</li> <li><code>d</code> \u5468\u671f\uff1a\u6b64\u65f6 SRAM \u5b8c\u6210\u4e86\u7b2c\u4e8c\u6b21\u8bfb\u53d6\uff0c\u628a\u8bfb\u53d6\u7684\u6570\u636e 0x34 \u653e\u5728 <code>DAT_I</code> \u5e76\u8bbe\u7f6e <code>ACK_I=1</code></li> </ul> <p>\u4ece\u6ce2\u5f62\u6765\u770b\uff0c\u529f\u80fd\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u662f\u6bcf\u4e24\u4e2a\u5468\u671f\u624d\u80fd\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\uff0c\u53d1\u6325\u4e0d\u4e86\u6700\u9ad8\u7684\u6027\u80fd\u3002\u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u6211\u4eec\u5728 <code>a</code> \u5468\u671f\u7ed9\u51fa\u7b2c\u4e00\u4e2a\u5730\u5740\uff0c\u5728 <code>b</code> \u5468\u671f\u5f97\u5230\u7b2c\u4e00\u4e2a\u6570\u636e\uff0c\u90a3\u4e48\u5982\u679c\u80fd\u5728 <code>b</code> \u5468\u671f\u7684\u65f6\u5019\u7ed9\u51fa\u7b2c\u4e8c\u4e2a\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u5728 <code>c</code> \u5468\u671f\u5f97\u5230\u7b2c\u4e8c\u4e2a\u6570\u636e\u3002\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6d41\u6c34\u7ebf\u5f0f\u7684\u6bcf\u4e2a\u5468\u671f\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\u3002\u4f46\u662f\uff0cWishbone Classic Standard \u8981\u6c42 <code>b</code> \u5468\u671f\u65f6\u7b2c\u4e00\u6b21\u8bf7\u6c42\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u4fee\u6539\u534f\u8bae\uff0c\u6765\u5b9e\u73b0\u6d41\u6c34\u7ebf\u5f0f\u7684\u8bf7\u6c42\u3002</p> <p>\u5b9e\u73b0\u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff1a\u65e2\u7136 Wishbone Classic Standard \u8ba4\u4e3a <code>b</code> \u5468\u671f\u65f6\uff0c\u7b2c\u4e00\u6b21\u8bf7\u6c42\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u90a3\u5c31\u8ba9\u7b2c\u4e00\u6b21\u8bf7\u6c42\u63d0\u524d\u5728 <code>a</code> \u5468\u671f\u5b8c\u6210\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684\u6570\u636e\u8981\u7b49\u5230 <code>b</code> \u5468\u671f\u624d\u80fd\u7ed9\u51fa\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u65f6\u5019\u7684\u4e00\u6b21\u8bfb\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u5206\u6210\u4e86\u4e24\u90e8\u5206\uff1a\u9996\u5148\u662f master \u5411 slave \u53d1\u9001\u8bfb\u8bf7\u6c42\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u5728 <code>a</code> \u5468\u671f\u5b8c\u6210\uff1b\u7136\u540e\u662f slave \u5411 master \u53d1\u9001\u8bfb\u7684\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5728 <code>b</code> \u5468\u671f\u5b8c\u6210\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u4fee\u6539\uff1a</p> <ul> <li>\u6dfb\u52a0 <code>STALL_I</code> \u4fe1\u53f7\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; STALL_I=0</code> \u8868\u793a\u8fdb\u884c\u4e00\u6b21\u8bfb\u8bf7\u6c42</li> <li>\u4fee\u6539 <code>ACK_I</code> \u4fe1\u53f7\u542b\u4e49\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; ACK_I=1</code> \u8868\u793a\u4e00\u6b21\u8bfb\u54cd\u5e94</li> </ul> <p>\u8fdb\u884c\u5982\u4e0a\u4fee\u6539\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86 Wishbone Classic Pipelined \u603b\u7ebf\u534f\u8bae\u3002\u4e0a\u9762\u7684\u4e24\u6b21\u8fde\u7eed\u8bfb\u64cd\u4f5c\u6ce2\u5f62\u5982\u4e0b\uff1a</p> <ul> <li><code>a</code> \u5468\u671f\uff1amaster \u8bf7\u6c42\u8bfb\u5730\u5740 0x01\uff0cslave \u63a5\u6536\u8bfb\u8bf7\u6c42\uff08<code>STALL_O=0</code>\uff09</li> <li><code>b</code> \u5468\u671f\uff1aslave \u8fd4\u56de\u8bfb\u8bf7\u6c42\u7ed3\u679c 0x12\uff0c\u5e76\u8bbe\u7f6e <code>ACK_I=1</code>\uff1b\u540c\u65f6 master \u8bf7\u6c42\u8bfb\u5730\u5740 0x02\uff0cslave \u63a5\u6536\u8bfb\u8bf7\u6c42\uff08<code>STALL_O=0</code>\uff09</li> <li><code>c</code> \u5468\u671f\uff1aslave \u8fd4\u56de\u8bfb\u8bf7\u6c42\u7ed3\u679c 0x34\uff0c\u5e76\u8bbe\u7f6e <code>ACK_I=1</code>\uff1bmaster \u4e0d\u518d\u53d1\u8d77\u8bf7\u6c42\uff0c\u8bbe\u7f6e <code>STB_O=0</code></li> <li><code>d</code> \u5468\u671f\uff1a\u6240\u6709\u8bf7\u6c42\u5b8c\u6210\uff0cmaster \u8bbe\u7f6e <code>CYC_O=0</code></li> </ul> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6bcf\u5468\u671f\u8fdb\u884c\u4e00\u6b21\u8bfb\u64cd\u4f5c\u7684 slave\u3002</p>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2022/06/19/wishbone/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>Wishbone Spec B4</li> </ul>","tags":["wishbone","bus","teaching"]},{"location":"hardware/2021/09/27/xilinx-axi-quad-spi-timing/","title":"\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["xilinx","vivado","fpga","spi","timing","teaching"]},{"location":"hardware/2021/09/27/xilinx-axi-quad-spi-timing/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u4e00\u76f4\u6ca1\u641e\u61c2 Vivado \u4e2d xdc \u9700\u8981\u600e\u4e48\u7f16\u5199\uff0c\u9047\u5230\u4e00\u4e9b\u5fc5\u987b\u8981\u5199 xdc \u7684\u65f6\u5019\u5c31\u5f88\u5934\u75bc\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u5199\u624d\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002\u4eca\u5929\u5206\u6790\u4e86\u4e00\u4e0b AXI Quad SPI \u7684\u65f6\u5e8f xdc\uff0c\u7ec8\u4e8e\u7406\u89e3\u4e86\u5176\u4e2d\u7684\u542b\u4e49\u3002</p>","tags":["xilinx","vivado","fpga","spi","timing","teaching"]},{"location":"hardware/2021/09/27/xilinx-axi-quad-spi-timing/#axi-quad-spi","title":"AXI Quad SPI","text":"<p>AXI Quad SPI \u662f\u4e00\u4e2a SPI \u7684\u63a7\u5236\u5668\uff0c\u5b83\u652f\u6301 XIP\uff08eXecute In Place\uff09\u6a21\u5f0f\uff0c\u5373\u53ef\u4ee5\u66b4\u9732\u4e00\u4e2a\u53ea\u8bfb AXI Slave \u63a5\u53e3\uff0c\u5f53\u63a5\u6536\u5230\u8bfb\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5c31\u6309\u7167\u6807\u51c6\u7684 SPI Flash \u547d\u4ee4\u53bb\u5bf9\u5e94\u7684\u5730\u5740\u8fdb\u884c\u8bfb\u53d6\uff0c\u7136\u540e\u8fd4\u56de\u7ed3\u679c\u3002\u7531\u4e8e\u4e0d\u540c\u5382\u5bb6\u7684 SPI Flash \u652f\u6301\u6709\u6240\u4e0d\u540c\uff0c\u6240\u4ee5 IP \u4e0a\u7684\u8bbe\u7f6e\u53ef\u4ee5\u770b\u5230\u5382\u5bb6\u7684\u9009\u62e9\u3002</p> <p>\u7279\u522b\u5730\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u9700\u6c42\u662f\u5e0c\u671b\u8bbf\u95ee Cfg\uff08Configuration\uff09Flash\uff0c\u4ea6\u5373\u7528\u6765\u4fdd\u5b58 Bitstream \u7684 Flash\u3002\u5f53 FPGA \u4e0a\u7535\u7684\u65f6\u5019\uff0c\u5982\u679c\u542f\u52a8\u6a21\u5f0f\u8bbe\u7f6e\u4e3a SPI Flash\uff0cFPGA \u5c31\u4f1a\u5411 Cfg Flash \u8bfb\u53d6 Bitstream\uff0cCfg Flash \u9700\u8981\u8fde\u63a5\u5230 FPGA \u7684\u6307\u5b9a\u5f15\u811a\u4e0a\uff0c\u5f53 FPGA \u521d\u59cb\u5316\u7684\u65f6\u5019\u7531\u5185\u90e8\u903b\u8f91\u9a71\u52a8\uff0c\u521d\u59cb\u5316\u5b8c\u6210\u540e\u53c8\u8981\u8f6c\u4ea4\u7ed9\u7528\u6237\u903b\u8f91\u3002\u8f6c\u4ea4\u7684\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7 STARTUP \u7cfb\u5217\u7684 primitive\u3002</p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8981\u8fde\u63a5\u5916\u90e8\u7684 SPI Flash\uff0c\u9700\u8981\u8fde\u63a5\u51e0\u6761\u4fe1\u53f7\u7ebf\u5230\u9876\u5c42\uff0c\u7136\u540e\u901a\u8fc7 xdc \u628a\u4fe1\u53f7\u7ed1\u5b9a\u5230\u5f15\u811a\u4e0a\uff0c\u7136\u540e\u5f15\u811a\u8fde\u63a5\u4e86\u4e00\u4e2a\u5916\u90e8\u7684 SPI Flash\u3002\u4f46\u7531\u4e8e Cfg Flash \u6bd4\u8f83\u7279\u6b8a\uff0c\u6240\u4ee5\u4fe1\u53f7\u4ece AXI Quad SPI \u76f4\u63a5\u8fde\u5230 STARTUP \u7cfb\u5217\u7684 primitive \u4e0a\u3002\u5982\u679c\u662f\u91c7\u7528 STARTUPE2 \u539f\u8bed\u7684 7 \u7cfb\u5217\u7684 FPGA\uff0c\u90a3\u4e48\u53ea\u6709\u65f6\u949f\u4f1a\u901a\u8fc7 STARTUPE2 pritimive \u8fde\u63a5\u5230 SPI Flash \u4e0a\uff0c\u5176\u4ed6\u6570\u636e\u4fe1\u53f7\u8fd8\u662f\u6b63\u5e38\u901a\u8fc7\u9876\u5c42\u7ed1\u5b9a\uff1b\u5982\u679c\u662f\u91c7\u7528 STARTUPE3 \u539f\u8bed\u7684 UltraScale \u7cfb\u5217\u7684 FPGA\uff0c\u90a3\u4e48\u65f6\u949f\u548c\u6570\u636e\u90fd\u901a\u8fc7 STARTUPE3 primitive \u8fde\u63a5\u5230 SPI Flash\u3002</p>","tags":["xilinx","vivado","fpga","spi","timing","teaching"]},{"location":"hardware/2021/09/27/xilinx-axi-quad-spi-timing/#virtex-ultrascale-\u65f6\u5e8f","title":"Virtex UltraScale+ \u65f6\u5e8f","text":"<p>\u628a\u4fe1\u53f7\u8fde\u597d\u4e86\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u56e0\u4e3a\u5916\u8bbe\u5bf9\u65f6\u5e8f\u8981\u6c42\u6bd4\u8f83\u590d\u6742\uff0c\u5982\u679c\u7528\u4e00\u4e2a\u6bd4\u8f83\u9ad8\u76f4\u63a5\u8dd1\uff0c\u5f88\u5927\u53ef\u80fd\u5c31\u8bfb\u53d6\u5230\u9519\u8bef\u7684\u6570\u636e\u4e86\u3002\u5f88\u8d34\u5fc3\u7684\u662f\uff0cAXI Quad SPI \u5df2\u7ecf\u5728\u751f\u6210\u7684\u6587\u4ef6\u91cc\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6837\u4f8b\u7684 xdc\uff0c\u5728\u6587\u6863\u91cc\u4e5f\u6709\u4f53\u73b0\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4f7f\u7528\u7684\u8bbe\u5907\u662f Virtex Ultrascale+ \u7684 FPGA\uff0c\u5176\u4ed6\u7cfb\u5217\u7684 FPGA \u4f1a\u6709\u6240\u4e0d\u4e00\u6837\u3002\u5b83\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>#### All the delay numbers have to be provided by the user\n\n#### Following are the SPI device parameters\n#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n#####################################################################################################\n# STARTUPE3 primitive included inside IP for US+                                                             #\n#####################################################################################################\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\n</code></pre> <p>\u6211\u4eec\u5206\u6bb5\u6765\u770b\u8fd9\u4e2a xdc \u90fd\u505a\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>create_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\n</code></pre> <p>\u9996\u5148\uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u65f6\u949f <code>clk_sck</code>\u3002CCLK \u662f STARTUP \u8f93\u51fa\u7684\u5b9e\u9645\u65f6\u949f\uff0c\u4f1a\u8fde\u63a5\u5230 Cfg Flash \u7684\u65f6\u949f\u4fe1\u53f7\u4e0a\u3002\u800c AXI Quad SPI \u7684 ext_spi_clk \u4f1a\u8f93\u51fa\u5230 CCLK \u4e0a\uff0c\u56e0\u6b64\u8fd9\u91cc\u662f\u4e00\u4e2a\u751f\u6210\u7684\u65f6\u949f\uff0c\u5e76\u4e14\u6307\u5b9a\u4e0a\u4e0b\u8fb9\u6cbf\u7684\u4f4d\u7f6e\u3002<code>edges</code> \u53c2\u6570\u6709\u4e09\u4e2a\uff0c\u5206\u522b\u8868\u793a\u4e0a\u5347\u3001\u4e0b\u964d\u548c\u4e0a\u5347\u6cbf\u5206\u522b\u7684\u4f4d\u7f6e\u30021 \u8868\u793a\u6e90\u65f6\u949f\u7684\u7b2c\u4e00\u4e2a\u4e0a\u5347\u6cbf\uff0c2 \u8868\u793a\u6e90\u65f6\u949f\u7684\u7b2c\u4e00\u4e2a\u4e0b\u964d\u6cbf\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6240\u4ee5 {3, 5, 7} \u7684\u610f\u601d\u5c31\u662f\u9891\u7387\u51cf\u534a\uff0c\u76f8\u4f4d\u5dee\u534a\u4e2a\u5468\u671f\u3002</p> <p>\u63a5\u7740\uff0c\u6700\u4e3b\u8981\u7684\u5c31\u662f\uff0c\u600e\u4e48\u8bbe\u7f6e\u5ef6\u8fdf\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u4ee3\u7801\u4e2d\u9996\u5148\u5b9a\u4e49\u4e86\u4e00\u4e9b\u53c2\u6570\uff1a</p> <pre><code>#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n\n#### Trace delay\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n</code></pre> <p>\u9996\u5148\u662f \\(t_{co}\\)\uff0c\u5e94\u8be5\u8868\u793a\u7684\u662f SPI Flash \u7684\u65f6\u949f\u5230\u8f93\u51fa\u7684\u5ef6\u8fdf\u3002\u672c\u6587\u7528\u7684 SPI Flash \u578b\u53f7\u662f Micron MT25QU02GCBB8E12-0SIT\uff0c\u53ef\u4ee5\u4ece\u5b83\u7684 Datasheet \u770b\u5230\uff0c\u65f6\u949f\u5230\u8f93\u51fa\u7684\u5ef6\u8fdf\u5e94\u8be5\u662f Max 7ns\uff1a</p> <pre><code>Clock LOW to output valid under 30pF Max 7ns\nClock LOW to output valid under 10pF Max 6ns\n</code></pre> <p>\u56e0\u6b64 <code>tco_max</code> \u8bbe\u4e3a 7\uff0c<code>tco_min</code> \u9ed8\u8ba4\u5373\u53ef\uff0c\u56e0\u4e3a Datasheet \u4e2d\u6ca1\u6709\u505a\u8981\u6c42\u3002</p> <p>\u7136\u540e \\(t_{su}\\) \u548c \\(t_h\\) \u5219\u662f\u8f93\u5165\u7684 setup \u548c hold time\u3002\u7c7b\u4f3c\u7684\uff0c\u53ef\u4ee5\u67e5\u5230 SPI Flash \u7684\u53c2\u6570\uff1a</p> <pre><code>Data in setup time Min 2.5ns\nData in hold time Min 2ns\n</code></pre> <p>\u6240\u4ee5 <code>tsu</code> \u8bbe\u4e3a 2.5\uff0c<code>th</code> \u8bbe\u4e3a 2\u3002</p> <p>\u63a5\u4e0b\u6765\u5219\u662f tdata \u548c tclk \u7684 trace delay\u3002\u8fd9\u6307\u7684\u662f\u4ece FPGA \u5f15\u811a\u5230 SPI Flash \u5f15\u811a\u7684\u4fe1\u53f7\u4f20\u8f93\u5ef6\u8fdf\u3002\u4ece\u4e25\u8c28\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u53ef\u4ee5\u4ece\u677f\u5b50\u7684\u5e03\u7ebf\u4e0a\u6d4b\u91cf\u957f\u5ea6\u6765\u8ba1\u7b97\u51fa\u6765\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u5c31\u5148\u7528\u9ed8\u8ba4\u503c\u4e86\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u4f30\u7b97\u65b9\u6cd5\uff1a\u5149\u901f \\(3*10^8 \\text{m/s}\\)\uff0c\u8003\u8651\u7535\u4fe1\u53f7\u4f20\u64ad\u901f\u5ea6\u662f\u5149\u901f\u7684\u4e00\u534a\uff0c\u53ef\u4ee5\u5f97\u5230\u5ef6\u8fdf\u548c\u957f\u5ea6\u7684\u6bd4\u503c\uff1a \\(0.06 \\text{ns/cm} = 0.15 \\text{ns/inch}\\)\u3002</p> <p>\u90a3\u4e48\uff0c\u8fd9\u4e9b\u53d8\u91cf\u600e\u4e48\u53c2\u4e0e\u5230 input/output delay \u7684\u8ba1\u7b97\u5462\uff1f</p> <p>\u9996\u5148\u8003\u8651 input delay\u3002\u5b83\u6307\u7684\u662f\uff0c\u4ece SPI Flash \u5230 FPGA \u7684\u6570\u636e\uff0c\u76f8\u5bf9\u4e8e\u65f6\u949f\u7684\u5ef6\u8fdf\u3002\u8fd9\u4e2a\u5ef6\u8fdf\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a</p> <ol> <li>\u4ece FPGA \u8f93\u51fa\u7684\u65f6\u949f CCLK \u5230 SPI Flash \u7684\u65f6\u949f\u6709\u5ef6\u8fdf \\(t_{clk}\\)\uff0c\u4e0b\u56fe <code>a -&gt; b</code></li> <li>\u4ece SPI Flash \u7684\u65f6\u949f\u5230\u6570\u636e\u8f93\u51fa\u6709\u5ef6\u8fdf \\(t_{co}\\)\uff0c\u4e0b\u56fe <code>b -&gt; c</code></li> <li>\u4ece SPI Flash \u7684\u6570\u636e\u5230 FPGA \u7684\u6570\u636e\u8f93\u5165\u6709\u5ef6\u8fdf \\(t_{data}\\)\uff0c\u4e0b\u56fe <code>c -&gt; d</code></li> </ol> <p>\u56e0\u6b64\u603b\u5ef6\u8fdf\u5c31\u662f \\(t_{clk}+t_{co}+t_{data}\\)\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5bf9\u5e94\u7684\u8bbe\u7f6e\uff1a</p> <pre><code>set_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\n</code></pre> <p>\u63a5\u4e0b\u6765\u8981\u8003\u8651 output delay\u3002\u867d\u7136 output delay \u4e5f\u6709 min \u548c max\uff0c\u4f46\u5176\u542b\u4e49\u6709\u6240\u533a\u522b\uff0c\u9700\u8981\u5206\u522b\u8003\u8651\u3002</p> <p>\u9996\u5148\u662f max\uff0c\u5b83\u5bf9\u5e94\u7684\u662f setup time\u3002\u5982\u679c\u5b9a\u4e49\u65f6\u95f4 0 \u4e3a\u65f6\u949f\u7684\u4e0a\u5347\u6cbf\uff0c\u6cbf\u66f4\u65e9\u7684\u65f6\u95f4\u4e3a\u6b63\u7684\u65f6\u95f4\u8f74\uff0c\u6cbf\u66f4\u665a\u7684\u65f6\u95f4\u4e3a\u8d1f\u7684\u65f6\u95f4\u8f74\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5e0c\u671b\u7684\u662f\uff0c\u6570\u636e\u5230\u8fbe\u5bc4\u5b58\u5668\u8f93\u5165\u7684\u65f6\u95f4\u5927\u4e8e setup time\uff0c\u6b64\u65f6\u53ef\u4ee5\u6ee1\u8db3 setup \u6761\u4ef6\u3002\u90a3\u4e48\uff0c\u5177\u4f53\u600e\u4e48\u7b97\u5462\uff1f\u6ce8\u610f\uff0c\u6211\u4eec\u8981\u8003\u8651\u7684\u662f\u4ece FPGA \u6570\u636e\u8f93\u51fa\u5230 SPI Flash \u4e0a\u65f6\u949f\u7684\u5ef6\u8fdf\u3002</p> <p>\u5047\u8bbe FPGA CCLK \u65f6\u949f\u4e0a\u5347\u6cbf\u5728 \\(0\\) \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>a</code>\uff09\uff0c\u90a3\u4e48 SPI Flash \u65f6\u949f\u4e0a\u5347\u6cbf\u5728 \\(-t_{clk}\\) \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>b</code>\uff09\u3002\u5047\u8bbe FPGA \u6570\u636e\u8f93\u51fa\u65f6\u523b\u4e3a \\(t_0\\)\uff08\u901a\u5e38\u4e3a\u6b63\uff0c\u4e0b\u56fe\u7684 <code>c</code>\uff09\uff0c\u90a3\u4e48 FPGA \u6570\u636e\u8f93\u51fa\u5230\u8fbe SPI Flash \u5728 \\(t_0-t_{data}\\) \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>d</code>\uff09\uff0c\u6211\u4eec\u671f\u671b \\(t_0-t_{data}\\) \u5728 \\(-t_{clk}\\) \u65f6\u523b\u4e4b\u524d\uff08\u4e0b\u56fe\u7684 <code>d -&gt; b</code>\uff09\u81f3\u5c11 \\(t_{su}\\) \u65f6\u95f4\u5230\u8fbe\uff0c\u53ef\u4ee5\u5f97\u5230\u8868\u8fbe\u5f0f\uff1a</p> \\[ t_0 - t_{data} &gt; -t_{clk} + t_{su} \\] <p>\u5316\u7b80\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230 \\(t_0 &gt; t_{data} + t_{su} - t_{clk}\\)\uff0c\u5982\u679c\u8003\u8651\u6781\u7aef\u60c5\u51b5\uff0c\u53f3\u4fa7 \\(t_{data}\\) \u53d6\u6700\u5927\u503c\uff0c\\(t_{clk}\\) \u53d6\u6700\u5c0f\u503c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u7ea6\u675f\uff1a</p> <pre><code>set_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u63a5\u4e0b\u6765\u8003\u8651 output delay \u7684 min\uff0c\u8fd9\u5bf9\u5e94\u7684\u662f hold time\u3002\u6211\u4eec\u5e0c\u671b\u6570\u636e\u5230\u8fbe SPI Flash \u5bc4\u5b58\u5668\u7684\u65f6\u5019\uff0c\u8ddd\u79bb\u4e0a\u5347\u6cbf\u65f6\u95f4\u8d85\u8fc7\u4e86 \\(t_h\\)\u3002\u8fd8\u662f\u4e00\u6837\u7684\u5047\u8bbe\uff0c\u5982\u679c FPGA CCLK \u65f6\u949f\u4e0a\u5347\u6cbf\u5728 0 \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>a</code>\uff09\uff0c\u90a3\u4e48 SPI Flash \u65f6\u949f\u4e0a\u5347\u6cbf\u5728 \\(-t_{clk}\\) \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>b</code>\uff09\u3002\u5047\u8bbe FPGA \u6570\u636e\u8f93\u51fa\u65f6\u523b\u4e3a \\(t_0\\)\uff08\u4e0b\u56fe\u7684 <code>c</code>\uff09\uff0c\u90a3\u4e48 FPGA \u6570\u636e\u8f93\u51fa\u5230\u8fbe SPI Flash \u5728 \\(t_0-t_{data}\\) \u65f6\u523b\uff08\u4e0b\u56fe\u7684 <code>d</code>\uff09\uff0c\u8981\u6c42\u6ee1\u8db3 hold \u6761\u4ef6\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a</p> \\[ t_0 - t_{data} &lt; -t_{clk} - t_h \\] <p>\u5316\u7b80\u4ee5\u540e\uff0c\u53ef\u4ee5\u5f97\u5230 \\(t_0 &lt; t_{data} - t_{clk} - t_h\\)\uff0c\u6309\u7167\u6781\u9650\u6765\u53d6\uff0c\\(t_{data}\\) \u53d6\u6700\u5c0f\u503c\uff0c\\(t_{clk}\\) \u53d6\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u5f97\u5230\u6700\u7ec8\u7684\u65f6\u5e8f\u7ea6\u675f\uff1a</p> <pre><code>set_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0 FPGA \u548c SPI Flash \u4e4b\u95f4\u7684\u6b63\u5e38\u901a\u8baf\u4e86\u3002\u6211\u89c9\u5f97\uff0c\u8fd9\u91cc\u6bd4\u8f83\u7ed5\u7684\u5c31\u662f\u65f6\u95f4\u8f74\u7684\u5b9a\u4e49\uff0c\u548c\u6211\u4eec\u5e73\u5e38\u601d\u8003\u7684\u662f\u53cd\u8fc7\u6765\u7684\u3002\u800c\u4e14\uff0c\u8fd9\u91cc\u7684 min \u548c max \u5e76\u4e0d\u662f\u6307 \\([\\min, \\max]\\)\uff0c\u800c\u662f \\((-\\inf, \\min] \\cup [\\max, \\inf)\\)\u3002\u4ee3\u5165\u4e0a\u9762\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5f97\u5230 \\(\\max=2.05, \\min=-2.95, t_0 \\in (\\inf, -2.95] \\cup [2.05, \\inf)\\)\u3002\u5982\u679c\u53d8\u5316\u7684\u65f6\u523b\u8ddd\u79bb\u65f6\u949f\u4e0a\u5347\u6cbf\u592a\u63a5\u8fd1\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5728 SPI Flash \u4fa7\u51fa\u73b0\u4e0d\u6ee1\u8db3 setup \u6216\u8005 hold \u7ea6\u675f\u7684\u60c5\u51b5\u3002</p> <p>\u4e5f\u53ef\u4ee5\u6362\u4e2a\u89d2\u5ea6\u6765\u7406\u89e3 min \u548c max\uff1a\u5bf9\u4e8e\u540c\u4e00\u4e2a\u5468\u671f\u7684\u65f6\u949f\u548c\u6570\u636e\u6765\u8bf4\uff0c\u6570\u636e\u76f8\u5bf9\u65f6\u949f\u6709\u4e00\u4e2a\u5ef6\u8fdf\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u4e0d\u80fd\u592a\u5c0f\uff0c\u81f3\u5c11\u8981\u6ee1\u8db3 hold\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u4e2a\u6700\u5c0f\u7684\u5ef6\u8fdf\uff1b\u540c\u65f6\u8fd9\u4e2a\u5ef6\u8fdf\u4e0d\u80fd\u592a\u5927\uff0c\u6700\u591a\u9700\u8981\u6ee1\u8db3\u4e0b\u4e00\u4e2a\u65f6\u949f\u4e0a\u5347\u6cbf\u7684 setup\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u4e2a\u6700\u5927\u7684\u5ef6\u8fdf\u3002\u5982\u679c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u770b\uff0c\u90a3\u5c31\u662f\u5ef6\u8fdf\u5728\u4e00\u4e2a \\([\\min, \\max]\\) \u7684\u8303\u56f4\u5185\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u5728\u8ba1\u7b97\u7684\u65f6\u5019\u5c31\u9700\u8981\u628a\u65f6\u949f\u5468\u671f\u7eb3\u5165\u5230 \\(\\max\\) \u7684\u8ba1\u7b97\u4e2d\uff0c\u6bd4\u5982 \\(\\max=t_c-t_{su}\\)\u3002\u5982\u679c\u6211\u4eec\u628a\u5750\u6807\u8f74\u4fee\u6539\u4e00\u4e0b\uff0c\u539f\u70b9\u53d8\u6210\u539f\u6765\u7684\u4e0b\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u7684\u4e0a\u5347\u6cbf\uff0cx \u7684\u6b63\u65b9\u5411\u53d8\u6210\u53cd\u5411\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e0a\u9762\u7684\u5f62\u5f0f\u4e86\u3002</p>","tags":["xilinx","vivado","fpga","spi","timing","teaching"]},{"location":"hardware/2021/09/27/xilinx-axi-quad-spi-timing/#artix-7-\u65f6\u5e8f","title":"Artix 7 \u65f6\u5e8f","text":"<p>\u90a3\u4e48\uff0c\u66f4\u5e38\u89c1\u7684 FPGA \u662f 7 \u7cfb\u5217\u7684\uff0c\u6bd4\u5982 Artix 7\uff0c\u5b83\u91c7\u7528\u7684\u662f STARTUPE2 \u539f\u8bed\uff0c\u53ea\u6709\u65f6\u949f\u662f\u901a\u8fc7 STARTUPE2 \u539f\u8bed\u7684 USRCCLKO \u4fe1\u53f7\u4f20\u9012\u5230 CCLK \u5f15\u811a\u4e0a\u7684\uff0c\u5176\u4ed6\u6570\u636e\u4fe1\u53f7\u90fd\u662f\u9700\u8981\u5728\u9876\u5c42\u4fe1\u53f7\u7ed1\u5b9a\u5bf9\u5e94\u7684\u5f15\u811a\u3002\u5728 AXI Quad SPI \u6587\u6863\u4e2d\uff0c\u63cf\u8ff0\u4e86 STARTUPE2 \u6240\u9700\u8981\u7684\u65f6\u5e8f\u7ea6\u675f\uff0c\u6211\u4eec\u5206\u6bb5\u6765\u5206\u6790\u4e00\u4e0b\u3002</p> <pre><code># You must provide all the delay numbers\n# CCLK delay is 0.5, 6.7 ns min/max for K7-2; refer Data sheet\n# Consider the max delay for worst case analysis\nset cclk_delay 6.7\n# Following are the SPI device parameters\n# Max Tco\nset tco_max 7\n# Min Tco\nset tco_min 1\n# Setup time requirement\nset tsu 2\n# Hold time requirement\nset th 3\n# Following are the board/trace delay numbers\n# Assumption is that all Data lines are matched\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n### End of user provided delay numbers\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e00\u90e8\u5206\u548c\u4e0a\u9762 UltraScale+ \u90e8\u5206\u5dee\u4e0d\u591a\uff0c\u53ea\u662f\u591a\u4e00\u4e2a <code>cclk_delay</code> \u53d8\u91cf\uff0c\u8fd9\u662f\u56e0\u4e3a Artix 7 \u4e2d\uff0c\u65f6\u949f\u53ea\u80fd\u521b\u5efa\u5230 USRCCLKO \u5f15\u811a\u4e0a\uff0c\u4f46\u662f\u5b9e\u9645 SPI Flash \u63a5\u6536\u5230\u7684\u65f6\u949f\u7b49\u4e8e USRCCLKO \u5230 CCLK \u5f15\u811a\uff0c\u7136\u540e\u518d\u901a\u8fc7 PCB \u4e0a\u7684\u7ebf\u4f20\u64ad\u5230 SPI Flash\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u4e00\u4e2a\u504f\u79fb\uff0c\u8fd9\u4e2a\u504f\u79fb\u5c31\u662f USRCCLKO \u5230 CCLK \u7684\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u5728 Artix 7 Data Sheet \u91cc\u9762\u770b\u5230\uff1a\u5bf9\u4e8e 1.0V\uff0c-2 \u901f\u5ea6\u7684 FPGA\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u6700\u5c0f\u503c\u4e3a 0.50ns\uff0c\u6700\u5927\u503c\u4e3a 6.70ns\uff0c\u8fd9\u91cc\u91c7\u7528\u4e86\u6700\u5927\u503c\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0b\u9762\u7684\u7ea6\u675f\uff0c\u9664\u4e86\u65f6\u949f\u90e8\u5206\u4ee5\u5916\uff0c\u548c\u4e0a\u9762\u5206\u6790\u7684 UltraScale+ \u65f6\u5e8f\u7ea6\u675f\u8ba1\u7b97\u65b9\u6cd5\u662f\u76f8\u540c\u7684\u3002\u4e0d\u540c\u70b9\u5728\u4e8e\uff0c\u9996\u5148\u7ea6\u675f\u4e86\u4ece AXI Quad SPI \u5230 STARTUPE2 \u7684\u8def\u7531\u65f6\u5ef6\uff0c\u4ece 0.1ns \u5230 1.5ns\uff0c\u7136\u540e\u53c8\u4ece USRCCLKO \u521b\u5efa\u4e86\u4e00\u4e2a\u5206\u9891 + \u5ef6\u8fdf <code>cclk_delay</code> \u7eb3\u79d2\u7684\u65f6\u949f\uff0c\u4f5c\u4e3a SPI Flash \u4e0a SCK \u5f15\u811a\u7684\u65f6\u949f\u3002</p> <pre><code># this is to ensure min routing delay from SCK generation to STARTUP input\n# User should change this value based on the results\n# having more delay on this net reduces the Fmax\nset_max_delay 1.5 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO] -datapath_only\nset_min_delay 0.1 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO]\n# Following command creates a divide by 2 clock\n# It also takes into account the delay added by STARTUP block to route the CCLK\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical\n*axi_quad_spi_1/ext_spi_clk] [get_pins -hierarchical *USRCCLKO] -edges {3 5 7}\n-edge_shift [list $cclk_delay $cclk_delay $cclk_delay]\n# Data is captured into FPGA on the second rising edge of ext_spi_clk after the SCK\nfalling edge\n\n# Data is driven by the FPGA on every alternate rising_edge of ext_spi_clk\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max +\n$tclk_trace_delay_max] [get_ports IO*_IO] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min +\n$tclk_trace_delay_min] [get_ports IO*_IO] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\n# Data is captured into SPI on the following rising edge of SCK\n# Data is driven by the IP on alternate rising_edge of the ext_spi_clk\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max -\n$tclk_trace_delay_min] [get_ports IO*_IO];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th -\n$tclk_trace_delay_max] [get_ports IO*_IO];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */\next_spi_clk]] -to clk_sck\n</code></pre> <p>\u4e00\u4e2a Artix 7 \u4e0a\u914d\u7f6e STARTUP SPI Flash \u7684\u4f8b\u5b50 io_timings.xdc \u53ef\u4f9b\u53c2\u8003\u3002</p>","tags":["xilinx","vivado","fpga","spi","timing","teaching"]},{"location":"life/2016/07/07/the-end-of-senior-two/","title":"The end of senior two","text":"<p>Finally the end of Senior 2 arrives. I'm on the way to Senior 3. The summer vacation is rather short which is really common in China. These days I have been diving into Emacs by subscribing both emacs and emacs-devel mailing list. It contributes to my English as well. I can learn a lot of new words and expression thanks to the nice and convenient feature of looking up a word in iOS.</p>","tags":["coding","study"]},{"location":"logo/2016/03/13/logo-is-a-lisp-dialect/","title":"Logo is a lisp dialect","text":"<p>Most of us have learnt how to use PCLogo to draw some graphics. Logo is a dialect of Lisp in fact, so most of us used a Lisp dialect at a early time! For some people, it is earlier than C++. Cool.</p>","tags":["lisp","logo"]},{"location":"meta/2019/01/11/blog-host-migration/","title":"\u57df\u540d\u5df2\u7ecf\u8fc1\u79fb\u5230 jiege.ch","text":"<p>\u4ece\u4e70\u65b0\u57df\u540d\u5230\u8fc1\u79fb\u5927\u6982\u7528\u4e86\u4e00\u4e2a\u591a\u5c0f\u65f6\uff0c\u73b0\u5728\u5df2\u7ecf\u6062\u590d\u8bbf\u95ee\u3002\u539f\u6709\u7684\u5730\u5740\u4e5f\u4f1a\u76f4\u63a5 301 \u5230\u65b0\u7684\u57df\u540d\u4e0a\u6765\u3002</p> <p>\u4ecd\u7136 Host \u5728 Github Pages \u4e0a\u3002\u8fd8\u4f1a\u7ee7\u7eed\u66f4\u65b0\uff0c\u4e0d\u4f1a\u8dd1\u8def\u7684\uff08\u9003</p>","tags":["site"]},{"location":"meta/2024/11/10/migrate-from-disqus-to-giscus/","title":"\u628a\u8bc4\u8bba\u7cfb\u7edf\u4ece Disqus \u8fc1\u79fb\u5230 Giscus","text":"<p>Disqus \u8981\u52a0\u5e7f\u544a\u4e86\uff0c\u4e8e\u662f\u672c\u535a\u5ba2\u7684\u8bc4\u8bba\u7cfb\u7edf\u8fc1\u79fb\u5230\u4e86 Giscus\u3002</p>","tags":["site"]},{"location":"meta/2023/07/15/migrate-from-hugo-to-mkdocs/","title":"\u628a\u535a\u5ba2\u751f\u6210\u5668\u4ece Hugo \u8fc1\u79fb\u5230 Mkdocs","text":"<p>\u8ddd\u79bb\u4e0a\u4e00\u6b21 Jekyll \u8fc1\u79fb\u5230 Hugo \u5df2\u7ecf\u8fc7\u53bb\u4e86\u56db\u5e74\uff0c\u8fd9\u6b21\u6b63\u597d mkdocs-material \u53d1\u4e86\u65b0\u7684 beta \u7248\u672c\uff0c\u52a0\u5165\u4e86\u5bf9\u535a\u5ba2\u7684\u652f\u6301\uff0c\u6240\u4ee5\u5c31\u5f53\u5c0f\u767d\u9f20\uff0c\u628a\u535a\u5ba2\u8fc1\u79fb\u5230\u4e86 Mkdocs + Mkdocs-Material\u3002</p> <p>\u8fd9\u6b21\u8fc1\u79fb\u6bd4\u8f83\u987a\u5229\uff0c\u9664\u4e86 tag \u548c category \u5c11\u4e86\u4e00\u4e9b\u9875\u9762\u4ee5\u5916\uff0c\u539f\u6765\u7684\u6587\u7ae0\u7684\u94fe\u63a5\u90fd\u662f\u6b63\u5e38\u7684\u3002\u4e3a\u4ec0\u4e48\u8981\u8fc1\u79fb\u5462\uff0c\u4e3b\u8981\u662f\u6700\u8fd1\u5199\u5404\u79cd\u6587\u6863\uff0cMkdocs \u7528\u7684\u6bd4\u8f83\u591a\uff0c\u4f46\u662f Mkdocs \u7684 Markdown \u5f88\u591a\u5730\u65b9\u548c Hugo \u4e0d\u592a\u4e00\u6837\uff0c\u4e0b\u9762\u5217\u4e00\u4e9b\u6700\u96be\u4ee5\u5fcd\u53d7\u7684 Hugo \u7684\u95ee\u9898\uff1a</p> <ol> <li>\u6570\u5b66\u516c\u5f0f\uff1aHugo \u7684 <code>\\</code> \u9700\u8981\u8f6c\u4e49\uff0c\u5bfc\u81f4\u5f88\u591a\u5730\u65b9\u5199\u6570\u5b66\u516c\u5f0f\u90fd\u5f88\u9ebb\u70e6\uff0c\u7136\u540e\u56e0\u4e3a\u6211\u7ecf\u5e38\u8981\u5728 Hugo \u548c Mkdocs \u4e4b\u95f4\u590d\u5236 Markdown\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u5f88\u591a\u624b\u52a8\u5de5\u4f5c\u3002</li> <li>\u8d44\u6e90\u8def\u5f84\uff1aHugo \u7684\u8d44\u6e90\u8def\u5f84\u9ed8\u8ba4\u90fd\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u8981\u5f15\u7528\u5176\u4ed6\u6587\u7ae0\u7684\u8bdd\uff0c\u8981\u4e48\u7528\u5570\u55e6\u7684 relref\uff0c\u8981\u4e48\u5c31\u5199\u7edd\u5bf9\u8def\u5f84\uff0c\u6bd4\u8f83\u5934\u75bc\u3002Mkdocs \u5c31\u5f88\u597d\uff0c\u81ea\u52a8\u68c0\u6d4b\uff0c\u5e2e\u6211\u8ba1\u7b97\u51fa\u5b9e\u9645\u7684\u5730\u5740\u3002</li> </ol> <p>\u8fc1\u79fb\u7684\u65f6\u5019\u6709\u5f88\u591a\u7ec6\u8282\u4e0a\u7684\u4e0d\u540c\uff0c\u4e0d\u8fc7\u57fa\u672c\u9760 VSCode \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u89e3\u51b3\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0cMkdocs \u53c8\u51fa\u73b0\u4e86 Jekyll \u7684\u8001\u95ee\u9898\uff0c\u5c31\u662f\u6027\u80fd\u6bd4\u8f83\u5dee\u3002\u5f53\u7136\u4e86\uff0c\u4e0d\u4e00\u5b9a\u662f Mkdocs \u672c\u8eab\u7684\u95ee\u9898\uff0c\u4e5f\u53ef\u80fd\u662f Mkdocs-Material \u52a0\u5404\u79cd\u63d2\u4ef6\u7684\u95ee\u9898\uff0c\u76ee\u524d\u8fd8\u6709\u5f85\u89c2\u5bdf\u3002\u65e0\u8bba\u5982\u4f55\uff0cPython \u8c03\u8d77\u6765\u603b\u5f52\u662f\u6bd4 Ruby \u8981\u5bb9\u6613\u3002\u5e0c\u671b\u4e0d\u8981\u5728\u672a\u6765\u7684\u67d0\u4e00\u5929\uff0c\u7531\u4ece Mkdocs \u8fc1\u79fb\u56de Hugo\u3002</p>","tags":["site"]},{"location":"meta/2023/07/15/migrate-from-hugo-to-mkdocs/#\u4f18\u5316\u6027\u80fd","title":"\u4f18\u5316\u6027\u80fd","text":"<p>\u65e2\u7136\u9047\u5230\u4e86\u6027\u80fd\u95ee\u9898\uff0c\u90a3\u4e48\u5c31\u5c1d\u8bd5\u89e3\u51b3\u4e00\u4e0b\u5b83\uff1a\u9996\u5148\uff0c\u5f00\u53d1\u7684\u65f6\u5019\u4e00\u4e9b\u63d2\u4ef6\u53ef\u4ee5\u5173\u95ed\uff0c\u8fd9\u4e2a\u5728 mkdocs-material \u7684\u6587\u6863\u91cc\u4e5f\u6709\u63d0\u5230\u65b9\u6cd5\uff1a</p> <pre><code>plugins:\n  - tags:\n      enabled: !ENV [DEPLOY, false]\n  - rss:\n      enabled: !ENV [DEPLOY, false]\n  - git-revision-date-localized:\n      enabled: !ENV [DEPLOY, false]\n</code></pre> <p>\u53ea\u6709\u5728\u6700\u7ec8\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u628a DEPLOY \u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u4e0a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u9ad8 <code>mkdocs serve</code> \u7684\u54cd\u5e94\u901f\u5ea6\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u5229\u7528 Python \u81ea\u5e26\u7684 profiler\uff0c\u4ee5\u53ca flameprof \u8f6f\u4ef6\u6765\u751f\u6210 flamegraph\uff1a</p> <pre><code>python3 -m cProfile -o mkdocs.prof /path/to/mkdocs build\npython3 -m flameprof mkdocs.prof &gt; output.svg\n</code></pre> <p>\u5728\u6d4f\u89c8\u5668\u6253\u5f00 output.svg\uff0c\u53ef\u4ee5\u770b\u5230\u70ed\u70b9\u662f\u5728\u6211 fork \u81ea\u522b\u4eba\u7684 mkdocs-wavedrom-plugin \u63d2\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u63d2\u4ef6\u5728 <code>on_post_page</code> \u91cc\u9762\u7528 bs4 \u89e3\u6790\u4e86\u8f93\u51fa\u7684 HTML\uff0c\u7136\u540e\u505a\u4e00\u4e9b\u6539\u52a8\u3002\u7531\u4e8e\u5728\u6211\u7684\u573a\u666f\u4e0b\uff0cwavedrom \u4ee3\u7801\u5230 <code>&lt;script&gt;</code> \u8fd9\u4e00\u6b65\u7684\u8f6c\u6362\u5df2\u7ecf\u7531 pymdownx \u5b8c\u6210\u4e86\uff0c\u5269\u4e0b\u53ea\u9700\u8981\u63d2\u5165\u4e00\u6bb5\u7528\u4e8e\u6fc0\u6d3b WaveDrom \u6e32\u67d3\u7684\u4ee3\u7801\uff0c\u56e0\u6b64\u628a\u590d\u6742\u7684 bs4 HTML \u89e3\u6790\u66ff\u6362\u6210\u4e86\u7b80\u5355\u7684\u6587\u672c\u64cd\u4f5c\uff0c\u8fd9\u65f6\u5019\u8fd9\u4e2a\u63d2\u4ef6\u5c31\u4e0d\u662f\u74f6\u9888\u4e86\u3002Deploy \u65f6\u95f4\u4ece 44 \u79d2\u964d\u5230\u4e86 31 \u79d2\uff0c\u6548\u679c\u8fd8\u662f\u5f88\u663e\u8457\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u7ee7\u7eed profile\uff0c\u53d1\u73b0 <code>mkdocs serve</code> \u4e3b\u8981\u7684\u70ed\u70b9\u5728 blog plugin \u548c rss plugin \u4e2d\uff0c\u91cc\u9762\u5927\u90e8\u5206\u65f6\u95f4\u5728 render markdown\uff0c\u6bd4\u8f83\u96be\u4f18\u5316\u3002\u5176\u4e2d\u4e3b\u8981\u5f71\u54cd\u6027\u80fd\u7684\u662f\u4ece\u6b63\u6587\u4e2d\u62bd\u53d6\u6458\u8981\uff0c\u5b83\u8981\u6e32\u67d3\u591a\u4e00\u6b21 markdown\uff0c\u628a excerpt \u90e8\u5206\u53d6\u51fa\u6765\uff0c\u626b\u63cf\u4e00\u904d\u94fe\u63a5\uff0c\u628a\u94fe\u63a5\u6307\u5411\u5b9e\u9645 post\u3002\u6b64\u5916\uff0cpygments \u7ed9\u4ee3\u7801\u5757\u4e0a\u8272\u5360\u7684\u65f6\u95f4\u4e5f\u6bd4\u8f83\u957f\u3002</p> <p>\u800c Deploy \u7684\u65f6\u95f4\u4e3b\u8981\u82b1\u5728 git-revision-date-localized \u63d2\u4ef6\u4e2d\uff0c\u8fd9\u4e5f\u7b97\u6b63\u5e38\uff0c\u6bd5\u7adf\u5b83\u8981\u6267\u884c\u5f88\u591a\u6b21 git \u547d\u4ee4\u6765\u83b7\u53d6\u65f6\u95f4\u3002\u8fd9\u4e2a\u76ee\u524d\u6ca1\u4ec0\u4e48\u529e\u6cd5\uff0c\u9664\u975e\u63d2\u4ef6\u6539\u6210\u66f4\u52a0\u9ad8\u6548\u7684\u83b7\u53d6\u624b\u6bb5\uff0c\u4f8b\u5982\u76f4\u63a5\u7528 Git \u7684 binding \u53bb\u8bfb\u53d6 .git \u76ee\u5f55\u4e0b\u7684\u4fe1\u606f\uff0c\u800c\u4e0d\u662f\u8dd1\u4e00\u4e2a git \u8fdb\u7a0b\u7136\u540e\u8bfb\u53d6\u8f93\u51fa\u3002</p> <p>\u63a5\u4e0b\u6765\u8981\u7ee7\u7eed\u4f18\u5316\u7684\u8bdd\uff0c\u53ef\u80fd\u5c31\u8981\u627e\u5230\u54ea\u4e9b markdown \u6587\u4ef6\u5bf9\u6027\u80fd\u5f71\u54cd\u6bd4\u8f83\u5927\u3002</p>","tags":["site"]},{"location":"meta/2019/05/02/migrate-from-jekyll-to-hugo/","title":"\u628a\u535a\u5ba2\u751f\u6210\u5668\u4ece Jekyll \u8fc1\u79fb\u5230 Hugo","text":"<p>Jekyll \u751f\u6210\u4e00\u6b21\u5b9e\u5728\u592a\u6162\uff0c\u5fcd\u53d7\u4e0d\u4e86\uff0c\u4e8e\u662f\u6362\u6210\u4e86 Hugo\u3002\u4e3a\u4e86\u4fdd\u6301\u94fe\u63a5\u4e0d\u53d8\uff0c\u82b1\u4e86\u4e0d\u5c11\u7684\u65f6\u95f4\u5728\u91cd\u547d\u540d\u4e0a\uff0c\u4e0d\u8fc7\u76ee\u524d\u4f3c\u4e4e\u90fd\u5b8c\u6210\u4e86\uff0c\u5e0c\u671b\u6ca1\u6709\u5bfc\u81f4 404 \u7684\u95ee\u9898\u3002</p> <p>\u65b0\u7684\u4e3b\u9898\u8fd8\u662f\u597d\u770b\u5f88\u591a\u7684\u3002Enjoy\uff01</p>","tags":["site"]},{"location":"meta/2018/11/17/more-than-100-posts/","title":"\u8d85\u8fc7 100 \u7bc7\u535a\u6587\u4e86\uff01","text":"<p>\u4eca\u5929\u770b\u4e86\u4e0b\uff0c\u53d1\u73b0\u7b97\u4e0a\u8fd9\u4e00\u7bc7\uff0c\u8fd9\u4e2a\u535a\u5ba2\u5df2\u7ecf\u6709 103 \u7bc7\u6587\u7ae0\u4e86\uff0c\u8fd9\u4e2a\u6570\u91cf\u8fd8\u662f\u86ee\u591a\u7684\uff0c\u7279\u6b64\u5e86\u795d\u4e00\u4e0b\u3002\u6211\u4e5f\u987a\u5e26\u505a\u4e86\u4e00\u4e0b\u7b80\u5355\u7684\u6570\u636e\u5904\u7406\uff0c\u5f97\u5230\u8fd9\u4e48\u4e00\u5f20\u56fe\uff1a</p> <p></p> <p>\u76ee\u6d4b\u6570\u91cf\u4e0e\u5e72\u6d3b\u7684\u9891\u7387\u76f8\u5173\u6027\u5f88\u9ad8\u554a\u3002</p>","tags":["blog"]},{"location":"meta/2016/02/12/the-beginning-of-my-blog/","title":"The beginning of my blog","text":"<p>This is the first blog here.</p> <p>I am talkative deep inside, but i do not have enough opportunities to express myself. Most of the listeners can't understand me. So i would like to write something on my blog. Kinda outdated media, though. Whatever, the first step is always the hardest.</p> <p>That's all. Thanks Emacs, Github Pages, Jekyll and Ruby to support this blog.</p>","tags":["meta"]},{"location":"misc/2022/01/12/deprecating-jiege-ch/","title":"jiege.ch \u505c\u7528","text":"<p>jiege.ch \u57df\u540d\u4e0d\u518d\u7eed\u8d39\uff0c\u4e4b\u540e\u4e00\u76f4\u7ee7\u7eed\u7528 jia.je \u8fd9\u4e2a\u57df\u540d\u3002</p>","tags":["website"]},{"location":"misc/2021/12/09/education/","title":"\u6559\u5b66\u968f\u60f3","text":"","tags":["dcst","education"]},{"location":"misc/2021/12/09/education/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5173\u4e8e\u8bfe\u7a0b\u6539\u9769\u7684\u8ba8\u8bba\u6bd4\u8f83\u591a\uff0c\u6211\u4e5f\u6765\u8c08\u8c08\u6211\u7684\u770b\u6cd5\u3002</p>","tags":["dcst","education"]},{"location":"misc/2021/12/09/education/#\u52a8\u673a","title":"\u52a8\u673a","text":"<p>\u4e00\u4f4d\u9ad8\u4e2d\u6bd5\u4e1a\u7684\u540c\u5b66\uff0c\u9009\u62e9\u8ba1\u7b97\u673a\u7cfb\u7684\u52a8\u673a\u662f\u4ec0\u4e48\uff1f\u6211\u60f3\u4e86\u60f3\uff0c\u53ef\u80fd\u6709\u4e0b\u9762\u51e0\u79cd\uff1a</p> <ol> <li>\u8ba1\u7b97\u673a\u884c\u4e1a\u5c31\u4e1a\u597d\uff0c\u6211\u9009\u4e86\u8ba1\u7b97\u673a\u7cfb\uff0c\u6bd5\u4e1a\u4ee5\u540e\u53ef\u4ee5\u8d5a\u5230\u5f88\u591a\u94b1</li> <li>\u559c\u6b22\u8ba1\u7b97\u673a\uff0c\u5e0c\u671b\u4ece\u4e8b\u8ba1\u7b97\u673a\u65b9\u9762\u7684\u5de5\u4f5c</li> <li>\u8ba1\u7b97\u673a\u7cfb\u5206\u9ad8\uff0c\u5927\u5bb6\u90fd\u8bf4\u597d\uff0c\u90a3\u6211\u5c31\u9009\u62e9\u53bb\u8fd9\u91cc\u5427</li> <li>\u6211\u662f\u7ade\u8d5b\u4fdd\u9001\u7684\uff0c\u6240\u4ee5\u6765\u5230\u4e86\u8fd9\u91cc</li> </ol> <p>\u5b66\u6821\u5e0c\u671b\u8ba1\u7b97\u673a\u7cfb\u57f9\u517b\u51fa\u6765\u7684\u5b66\u751f\uff1a</p> <ol> <li>\u6709\u5f88\u597d\u7684\u80fd\u529b</li> <li>\u6709\u5f88\u597d\u7684\u6bd5\u4e1a\u53bb\u5411\uff08\u4fdd\u7814/\u5de5\u4f5c/\u7559\u6821\u7b49\u7b49\uff09</li> </ol> <p>\u5b66\u6821\u4e3a\u5e0c\u671b\u8ba1\u7b97\u673a\u7cfb\uff1a</p> <ol> <li>\u6709\u66f4\u591a\u91cd\u5927\u79d1\u7814\u6210\u679c</li> <li>\u80fd\u591f\u57f9\u517b\u591a\u4e14\u7cbe\u7684\u8ba1\u7b97\u673a\u4eba\u624d</li> </ol> <p>\u8ba1\u7b97\u673a\u7cfb\u4e3a\u4e86\u5b9e\u73b0\u4e0a\u9762\u7684\u76ee\u6807\uff1a</p> <ol> <li>\u6559\u5b66\u7684\u4e13\u4e1a\u8bfe\u7a0b\u8981\u5168\u9762\uff0c\u5e76\u4e14\u80fd\u591f\u652f\u6491\u540e\u7eed\u7684\u79d1\u7814</li> <li>\u5438\u5f15\u66f4\u591a\u5b66\u751f\u8fdb\u5165\u5b9e\u9a8c\u5ba4\u79d1\u7814</li> </ol> <p>\u540c\u65f6\u8fd8\u8981\u4e0e\u5176\u4ed6\u9662\u7cfb\uff08\u8f6f\u4ef6\u5b66\u9662\uff0c\u4ea4\u53c9\u4fe1\u606f\u5b66\u9662\uff0c\u96c6\u6210\u7535\u8def\u5b66\u9662\u7b49\uff09\u6709\u533a\u5206\uff08\u5206\u5de5\uff09\u3002</p>","tags":["dcst","education"]},{"location":"misc/2021/12/09/education/#\u8def\u5f84","title":"\u8def\u5f84","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u7684\u8fd9\u4e00\u7cfb\u5217\u8bc9\u6c42\u662f\u6709\u77db\u76fe\u7684\uff0c\u53ef\u4ee5\u5047\u60f3\u8fd9\u4e48\u51e0\u6761\u8def\u5f84\uff1a</p> <ol> <li>\u60f3\u8d5a\u94b1-&gt;\u8bfb\u7814\u6bd5\u4e1a\u85aa\u8d44\u66f4\u9ad8-&gt;\u8bfb\u7814\u9700\u8981\u9ad8 GPA-&gt;\u6bcf\u95e8\u8bfe\u90fd\u8981 4.0-&gt;\u6bcf\u4e2a\u8bfe\u7a0b\u7684\u53ef\u9009\u90e8\u5206\u90fd\u8981\u505a-&gt;\u5de5\u4f5c\u91cf\u592a\u5927</li> <li>\u60f3\u79d1\u7814-&gt;\u627e\u597d\u8001\u5e08-&gt;\u9700\u8981\u9ad8 GPA \u548c\u6216\u8bba\u6587-&gt;\u6bcf\u95e8\u8bfe\u90fd\u8981 4.0 \u540c\u65f6\u8fd8\u8981\u5728\u5b9e\u9a8c\u5ba4\u79d1\u7814-&gt;\u5de5\u4f5c\u91cf\u7279\u522b\u5927</li> <li>\u4e0d\u60f3\u79d1\u7814\u76f4\u63a5\u5de5\u4f5c-&gt;\u5de5\u4f5c\u4e0d\u9700\u8981\u9ad8\u7684 GPA-&gt;\u653e\u5f03\u4e00\u4e9b\u8bfe\u7a0b\u7684\u53ef\u9009\u90e8\u5206-&gt;\u7a7a\u4f59\u65f6\u95f4\u5b66\u4e60\u5b9e\u7528\u6280\u672f-&gt;\u9762\u8bd5\u8f7b\u677e\u8fc7\u5173</li> <li>\u5bf9\u672a\u6765\u6ca1\u6709\u60f3\u6cd5-&gt;\u4ece\u4f17\u5fc3\u7406\u5377 GPA-&gt;\u6bcf\u4e2a\u8bfe\u7a0b\u90fd\u505a\u53ef\u9009\u90e8\u5206-&gt;\u82b1\u8d39\u5f88\u591a\u65f6\u95f4-&gt;\u6ca1\u6709\u65f6\u95f4\u505a\u81ea\u5df1\u559c\u6b22\u7684\u4e8b\u60c5</li> </ol> <p>\u8fd9\u5bf9\u4e8e\u4e03\u5b57\u73ed\uff082017\uff09\u6216\u8005\u66f4\u65e9\u540c\u5b66\u6765\u8bf4\uff0c\u8fd9\u53ef\u80fd\u662f\u96be\u4ee5\u7406\u89e3\u7684\u3002\u5f53\u65f6\uff0c\u4fdd\u7814\u4e0d\u9700\u8981\u5f88\u9ad8\u7684 GPA\uff0c\u8001\u5e08\u4f1a\u770b\u91cd\u79d1\u7814\u6f5c\u529b\uff0c\u60f3\u79d1\u7814\u7684\u540c\u5b66\u53ef\u80fd\u9009\u62e9\u5728\u5b9e\u9a8c\u5ba4\u79d1\u7814\u7684\u540c\u65f6\uff0c\u653e\u5f03\u4e00\u4e9b\u8bfe\u7a0b\u3002</p> <p>\u4f46\u662f\u4ece\u516b\u5b57\u73ed\uff082018\uff09\u5f00\u59cb\uff0c\u591a\u91cd\u56e0\u7d20\u4e0b\uff0c\u95ee\u9898\u5c31\u51f8\u663e\u4e86\u3002\u4e00\u662f\u603b\u4eba\u6570\u66f4\u591a\uff0c\u4fdd\u7814\u96be\u5ea6\u672c\u8eab\u5c31\u66f4\u5927\uff0c\u7ade\u4e89\u6fc0\u70c8\uff1b\u4e8c\u662f\u4fdd\u7814\u540d\u989d\u4e25\u683c\u6309\u7167 GPA \u6392\u5e8f\uff0c\u5bfc\u81f4\u4fdd\u7814\u7684\u540c\u5b66\u5fc5\u987b\u79d1\u7814\u5b66\u4e60\u4e24\u624b\u6293\uff1b\u4e09\u662f GPA \u6539\u9769\u4ee5\u540e\uff0c4.0 \u96be\u5ea6\u53d8\u4f4e\uff0c\u4ee5\u524d\u4f1a\u60f3 A B C \u8bfe\u7a0b\u6bd4\u8f83\u96be\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u62ff\u4e0d\u5230 4.0\uff0c\u6211 A \u8bfe\u7a0b 3.7\uff0cB \u8bfe\u7a0b 3.3 \u548c\u4f60 A \u8bfe\u7a0b 3.3\uff0cB \u8bfe\u7a0b 3.7 \u662f\u4e00\u6837\u7684\uff0c\u7cbe\u529b\u6709\u9650\uff0c\u53ea\u505a\u4e09\u4e2a\u91cc\u9762\u6700\u7b80\u5355\u7684\u4e00\u4e2a\uff0c\u4f46\u73b0\u5728\u4f1a\u53d1\u73b0\uff0c\u6bd4 GPA \u5b9e\u9645\u4e0a\u5c31\u662f\u6bd4\u8c01 4.0 \u66f4\u591a\uff0c\u867d\u7136 A B C \u8bfe\u7a0b\u4e5f\u6bd4\u8f83\u96be\uff0c\u4f46\u662f\u6b64\u65f6\u53ea\u80fd\u628a\u4e09\u4e2a\u90fd\u505a\u4e86\uff0c\u4e0d\u7136\u5c31\u4f1a\u6392\u540d\u4e0b\u964d\u660e\u663e\u3002</p> <p>\u8fd9\u8fd8\u4f1a\u5e26\u6765\u5176\u4ed6\u7684\u95ee\u9898\uff1a\u4e3a\u4e86\u62ff\u5230\u66f4\u591a 4.0\uff0c\u4f46\u7cbe\u529b\u6709\u9650\uff0c\u6309\u7167\u81ea\u5df1\u7684\u65f6\u95f4\uff0c\u4e09\u4e2a\u8bfe\u91cc\u53ea\u80fd\u62ff\u5230\u4e00\u4e2a 4.0\uff0c\u6bd4\u4e0d\u8fc7\u62ff\u5230\u4e09\u4e2a 4.0 \u7684\u540c\u5b66\uff0c\u548b\u529e\uff1f\u6284\u88ad\u3002\u8ba9\u8001\u5e08\u653e\u6c34\uff0c\u4eba\u4eba 4.0\u3002</p>","tags":["dcst","education"]},{"location":"misc/2021/12/09/education/#\u89e3\u51b3","title":"\u89e3\u51b3","text":"<p>\u90a3\u4e48\uff0c\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f</p> <p>\u4ece\u4e2a\u4eba\u7684\u89d2\u5ea6\u51fa\u53d1\uff1a\u5c3d\u65e9\u60f3\u597d\u81ea\u5df1\u8981\u4ec0\u4e48\u3002\u6211\u8981\u505a\u4ec0\u4e48\uff0c\u5c31\u5728\u6211\u8981\u505a\u7684\u65b9\u5411\u4e0a\u505a\u597d\uff0c\u5176\u4ed6\u65b9\u5411\u53ef\u4ee5\u9009\u62e9\u6027\u653e\u5f03\uff0c\u4e0d\u8981\u968f\u5927\u6d41\u3002</p> <p>\u4ece\u9662\u7cfb\u7684\u89d2\u5ea6\u51fa\u53d1\uff1a\u96be\u3002</p>","tags":["dcst","education"]},{"location":"misc/2021/08/06/intel-intrinsics-guide/","title":"\u8f76\u4e8b\u4e00\u5219","text":"<p>7.31 \u53f7\u5468\u516d\u7684\u65f6\u5019\uff0c\u53d1\u73b0 Intel Intrinsics Guide(https://software.intel.com/sites/landingpage/IntrinsicsGuide/) \u51fa\u73b0\u9519\u8bef\uff0c\u52a0\u8f7d\u6570\u636e\u5931\u8d25\uff0c\u4e8e\u662f\u5728 Intel \u7684\u7f51\u7ad9\u4e0a\u63d0\u4ea4\u4e86\u4e00\u4e2a bug\u3002</p> <p>8.2 \u53f7\u7684\u65f6\u5019\uff0cIntel \u53d1\u90ae\u4ef6\u8fc7\u6765\uff0c\u8bf4\u5df2\u7ecf\u590d\u73b0\u4e86\u95ee\u9898\uff0c\u5df2\u7ecf\u6c47\u62a5\u7ed9\u4e86\u540e\u7aef\u56e2\u961f\u3002\u90ae\u4ef6\u539f\u6587\uff1a</p> <pre><code>Thank you for bringing this to our attention. We have verified and\nencountered the same issue. Please know that we have escalated this\nissue to our backend technical team.\n\nWe will get back to you as soon as we have an update. Have a nice day\nahead!\n</code></pre> <p>8.4 \u53f7\u7684\u65f6\u5019\uff0cIntel \u518d\u6b21\u53d1\u90ae\u4ef6\u8fc7\u6765\uff0c\u8bf4\u540e\u7aef\u56e2\u961f\u6b63\u5728\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f1a\u5c3d\u5feb\u5b8c\u6210\u4fee\u590d\uff0c\u8bf7\u6211\u8010\u5fc3\u7b49\u5f85\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u53bb\u7f51\u7ad9\u4e0a\u770b\uff0c\u8fd8\u662f\u6709\u95ee\u9898\u3002\u90ae\u4ef6\u539f\u6587\uff1a</p> <pre><code>Our backend team is still working on this issue. We are trying our level\nbest to get back to you with an update soon.\n\nHave a nice day ahead!\n</code></pre> <p>8.6 \u53f7 19:27 \u7684\u65f6\u5019\uff0cIntel \u53c8\u53d1\u4e86\u4e00\u6b21\u90ae\u4ef6\uff0c\u8bf4\u540e\u7aef\u56e2\u961f\u4f9d\u7136\u5728\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e76\u4e14\u6b63\u5728\u8fdb\u884c\u4e00\u4e2a\u6c38\u4e45\u6027\u7684\u4fee\u590d\uff08\u8a00\u4e0b\u4e4b\u610f\u662f\u73b0\u5728\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e34\u65f6\u6027\u7684\u4fee\u590d\uff09\u3002\u8fd9\u4e2a\u65f6\u5019\u53bb\u7f51\u7ad9\u4e0a\u770b\uff0c\u7ec8\u4e8e\u662f\u4fee\u597d\u4e86\u3002\u90ae\u4ef6\u539f\u6587\uff1a</p> <pre><code>We have received an update from our backend team is that they are\nworking on this issue and, a more permanent fix is in the works.\nHopefully, it will resolve soon.\n\nWe appreciate your patience and understanding on this matter. Have a\nnice day!\n</code></pre> <p>\u6211\u56de\u590d\u4e86\u4e00\u4e0b\u90ae\u4ef6\uff0c\u544a\u8bc9 Intel \u6211\u8fd9\u8fb9\u770b\u5230\u5df2\u7ecf\u662f\u4fee\u590d\u597d\u7684\u7248\u672c\uff0c\u7d27\u63a5\u7740\u53c8\u6536\u5230\u4e86\u4e00\u5c01\u90ae\u4ef6\uff0c\u544a\u8bc9\u6211\u53ef\u4ee5\u4ece\u7f51\u7ad9\u4e0a\u4e0b\u8f7d\u79bb\u7ebf\u7248\u7684 Intrinsics Guide\uff1a</p> <pre><code>Thank you for your prompt response. We are glad that your issue has been\nresolved and we would like to thank you for your co operation.  Please\nbe informed that the offline version of the Intrinsic Guide is now\navailable for download from the site. The offline version of the guide\nhas the same content as the site, but is viewable offline by the user. A\nlink to the download is now added in the left column of the site:\nhttps://software.intel.com/sites/landingpage/IntrinsicsGuide/\n\nThat said, we are closing this ticket and if you have further issues\nplease open another ticket and we will be happy to help you.\n\nAfter case closure, you will receive a survey email. We appreciate it if\nyou can complete this survey regarding the support you received.  Your\nfeedback will help us improve our support.\n\nFor any concerns related to Intel\u00ae Developer Zone account, login or\nwebsite, please feel free to open a new ticket:\nhttps://software.intel.com/en-us/support\n</code></pre> <p>\u8fd9\u6b21 Intel Support \u7684\u53cd\u5e94\u633a\u5feb\u7684\uff0c\u7ed9\u4e2a\u597d\u8bc4\u3002\u5c31\u662f\u5e0c\u671b Intel \u80fd\u591f\u4e0d\u6324\u7259\u818f\uff0c\u80fd\u62ff\u51fa\u548c AMD \u76f8\u5f53\u6c34\u5e73\u7684 CPU\u3002</p>","tags":["intel","intrinsics"]},{"location":"misc/2019/04/22/jiegec-xyz-down/","title":"jiegec.xyz \u57df\u540d\u5373\u5c06\u505c\u7528","text":"<p>\u6700\u65e9\u4e70\u57df\u540d\u7684\u65f6\u5019\uff0c\u4e70\u7684\u662f jiegec.xyz\uff0c\u540e\u6765\u53d1\u73b0\u4e86\u66f4\u597d\u7684\u57df\u540d\uff0c\u4e8e\u662f\u8fd9\u4e2a\u8001\u57df\u540d\u4e00\u76f4\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7f51\u9875\u8f6c\u5740\u3002\u5f88\u5feb\uff0c\u5b83\u5c31\u8981\u8fc7\u671f\u4e86\uff0c\u6211\u4e5f\u4e0d\u6253\u7b97\u7eed\u8d39\u4e86\uff0c\u5927\u5bb6\u7ee7\u7eed\u7528\u6211\u7684\u65b0\u57df\u540d\u5427\u3002</p> <p>P.S. \u5ffd\u7136\u53d1\u73b0\u6211\u4e4b\u524d\u914d\u7684 acme.sh \u6ca1\u6709\u914d\u81ea\u52a8 <code>nginx -s reload</code> \uff0c\u6240\u4ee5\u4e4b\u524d ssl \u8bc1\u4e66\u65f6\u95f4\u51c9\u4e86\u3002</p>","tags":["jiegecxyz","domain"]},{"location":"misc/2019/02/17/learn-project-preview/","title":"\u9884\u544a Learn-Project 4.0 \u7248","text":"<p>\u4e0d\u77e5\u9053\u5927\u5bb6\u542c\u6ca1\u542c\u8bf4\u8fc7 Google Chrome \u6709\u4e2a\u63d2\u4ef6\uff0c\u53eb\u505a Learn Project\uff0c\u662f\u4e00\u4e2a\u7f51\u7edc\u5b66\u5802\u7684\u6539\u826f\u524d\u7aef\u3002\u4e0d\u8fc7\uff0c\u968f\u7740\u7f51\u7edc\u5b66\u5802\u7684\u4e0d\u65ad\u66f4\uff08xia\uff09\u65b0\uff08gao\uff09\uff0c\u5b83\u5df2\u7ecf\u4e0d\u518d\u9002\u7528\u4e8e\u73b0\u5728\u7684\u7248\u672c\u3002\u4e8e\u662f\uff0c\u54c8\u5229\u6a59\uff08@Harry-Chen\uff09\u51b3\u5b9a\u5229\u7528\u5bd2\u5047\u65f6\u95f4\uff0c\u5728\u4eca\u5929\uff082.17\uff09\u4e4b\u524d\u5b8c\u6210 Learn Project 4.0 \u7684\u5f00\u53d1\u3002\u4e3a\u4ec0\u4e48\u53eb 4.0 \u5462\uff0c\u56e0\u4e3a\u54c8\u5229\u6a59\u8bfe\u7a0b\u7684 GPA \u4f17\u6570\u662f 4.0\u3002\u8fd9\u4e2a\u7248\u672c\u91c7\u7528\u5148\u8fdb\u7684 React \u6846\u67b6\u7f16\u5199\uff08Vue \u585e\u9ad8\uff09\uff0c\u4f7f\u7528\u4e86 Material Ui \u4f5c\u4e3a\u754c\u9762\u6846\u67b6\uff08\u8fd9\u6211\u89c9\u5f97\u53ef\u4ee5\uff09\uff0c\u76ee\u524d\u7684\u4e00\u4e2a\u53c2\u8003\u56fe\uff08\u56fe\u6e90\u54c8\u5229\u6a59\uff09\uff1a</p> <p></p> <p>\u770b\u90a3\u6ee1\u773c\u7684\u9ad8\u5206\u6570\uff0c\u5e0c\u671b Learn Project 4.0 \u80fd\u5728 flag \u5012\u4e0b\u4e4b\u524d\u5b8c\u6210\u3002</p>","tags":["learnproject","preview"]},{"location":"misc/2021/07/19/sigs/","title":"\u8f76\u4e8b\u4e00\u5219","text":"<p>7.17 \u53f7\u5468\u516d\u7684\u65f6\u5019\uff0c\u4e00\u4f4d\u670b\u53cb @elenacliu \u53d1\u73b0\u6df1\u7814\u9662\u7f51\u7ad9\u7684\u4e00\u4e2a\u6587\u6863\u94fe\u63a5\uff0c\u6587\u6863\u4e2d\u6807\u9898\u5199\u7684\u662f 2021\uff0c\u4f46\u662f\u7f51\u9875\u7684\u6807\u9898\u663e\u793a\u7684\u662f 2006 \u5e74\u3002\u4e8e\u662f\u6211\u53d1\u90ae\u4ef6\u7ed9\u6df1\u7814\u9662\u7684\u62db\u751f\u529e\uff0c\u6284\u9001\u672c\u90e8\u7684\u7814\u62db\u529e\uff0c\u63d0\u4ea4\u4e86\u8fd9\u4e2a issue\u3002</p> <p>7.19 \u53f7\u5468\u4e00\u4e0a\u5348\u7684\u65f6\u5019\uff0c\u672c\u90e8\u7684\u7814\u62db\u529e\u56de\u590d\u4e86\u4e00\u5c01\u90ae\u4ef6\uff0c\u6ca1\u6709\u7406\u89e3\u6211\u60f3\u8868\u8fbe\u7684\u610f\u601d\uff0c\u53ef\u80fd\u4ee5\u4e3a\u6211\u662f\u8981\u62a5\u8003\u7684\u5b66\u751f\uff0c\u8ba9\u6211\u5173\u6ce8\u660e\u5e74\u53d1\u5e03\u7684\u6587\u6863\u3002</p> <p>7.19 \u53f7\u5468\u4e00\u4e0b\u5348\u7684\u65f6\u5019\uff0c\u6df1\u7814\u9662\u62db\u751f\u529e\u56de\u590d\u4e86\u90ae\u4ef6\uff0c\u8bf4\u201c\u8c22\u8c22\u4f60\u7684\u53cd\u9988\u201d\uff0c\u4e0d\u8fc7\u6ca1\u6709\u63d0\u5230\u662f\u5426\u8fdb\u884c\u4e86\u4fee\u590d\u3002\u6211\u665a\u4e0a\u518d\u67e5\u770b\u9875\u9762\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u65b0\u7684\u6587\u6863\u94fe\u63a5\u5df2\u7ecf\u4fee\u590d\u4e86\u95ee\u9898\u3002</p>","tags":["sigs","tsinghua","email"]},{"location":"misc/2019/01/25/thuwc-2019/","title":"THUWC 2019 \u5c0f\u8bb0","text":"<p>\u524d\u6bb5\u65f6\u95f4\uff0c\u4ee5\u5de5\u4f5c\u4eba\u5458\u7684\u8eab\u4efd\u53c2\u52a0\u4e86\u5728\u5e7f\u5dde\u4e8c\u4e2d\u4e3e\u529e\u7684 THUWC 2019\u3002\u4f5c\u4e3a\u4e00\u53ea\u83dc\u9e21 OI \u9009\u624b\uff0c\u6211\u6ca1\u60f3\u5230\u8fc7\u6211\u4f1a\u4ee5\u53e6\u4e00\u79cd\u8eab\u4efd\u53c2\u4e0e\u4e00\u4e2a\u6211\u672c\u6765\u6ca1\u80fd\u53c2\u4e0e\u7684\u6d3b\u52a8\uff0c\u5c31\u597d\u50cf\u4ee5\u6691\u6821\u8f85\u5bfc\u5458\u7684\u8eab\u4efd\u53c2\u4e0e\u6e05\u534e\u6691\u6821\u4e00\u6837\u3002</p> <p>\u63d0\u65e9\u6765\u5230\u4e86\u8d5b\u573a\uff0c\u5e03\u7f6e\u573a\u5730\uff0c\u7136\u540e\u628a\u673a\u8003\u7684\u5404\u4e2a\u6d41\u7a0b\u90fd\u8fc7\u4e00\u904d\uff0c\u8bb0\u4f4f\u5404\u4e2a\u7ec6\u8282\uff0c\u5404\u65b9\u9762\u90fd\u6709\u6761\u4e0d\u7d0a\u5730\u8fdb\u884c\uff0c\u770b\u7740\u7b2c\u4e00\u573a\u524d\u540c\u5b66\u4eec\u7279\u522b\u6fc0\u52a8\u5730\u51b2\u5165\u8003\u573a\uff0c\u5230\u6700\u540e\u4e00\u573a\u540c\u5b66\u4eec\u8003\u5b8c\u540e\u7684\u91ca\u653e\uff0c\u5728\u540c\u5b66\u4eec\u8eab\u4e0a\u770b\u5230\u4e86\u5f88\u591a\u4e0d\u6210\u719f\u7684\u6837\u5b50\uff0c\u770b\u5230\u4e86\u5174\u594b\u60f3\u8981\u548c\u540c\u4f34\u5206\u4eab\u7684\u559c\u60a6\uff0c\u4e5f\u770b\u5230\u4e86\u4e0d\u7518\u7684\u773c\u6cea\u3002</p> <p>\u5e0c\u671b\u5404\u4f4d\u5f3a\u5927\u7684\u9009\u624b\u4eec\u53ef\u4ee5\u6765\u5230\u4e5d\u5b57\u73ed\u3001\u96f6\u5b57\u73ed\u4e43\u81f3\u4e00\u5b57\u73ed\uff0c\u4eab\u53d7\u8bfe\u6539\u7684\u4e50\u8da3\u5427\u563f\u563f\u563f</p>","tags":["thuwc","oi","wc"]},{"location":"misc/2018/10/13/unicode-en-dash-mistake/","title":"Unicode En Dash \u5c0f\u5751","text":"<p>\u4eca\u5929\u6709\u540c\u5b66\u95ee\u5230\u6211\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <pre><code>$ gcc -o ph ph.c \u2013lpthread\n</code></pre> <p>\u4e3a\u5565\u4e0d\u5de5\u4f5c\u3002\u6211\u600e\u4e48\u770b\u90fd\u89c9\u5f97\u6ca1\u5565\u95ee\u9898\uff0c\u4e00\u5f00\u59cb\u4ee5\u4e3a\u662f\u627e\u4e0d\u5230 pthread\uff0c\u4f46\u9a6c\u4e0a\u53c8\u6392\u9664\u4e86\u3002\u60f3\u4e86\u4e0b\u4f1a\u4e0d\u4f1a\u662f\u6709\u9690\u85cf\u7684\u5b57\u7b26\uff0c\u4e8e\u662f\u8ba9\u540c\u5b66 <code>pbpaste | xxd</code> \u4e00\u4e0b\uff0c\u679c\u7136\u53d1\u73b0\u8fd9\u91cc\u7684 <code>\u2013</code> \u662f <code>\\xe2\\x80\\x93</code> \uff0c\u67e5\u4e86\u4e0b\u662f Unicode \u91cc\u7684 En Dash\u3002\u7531\u4e8e\u8fd9\u662f\u4ece PDF \u91cc\u76f4\u63a5\u62f7\u8d1d\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u51c9\u4e86\u3002\u6539\u6210\u6b63\u5e38\u7684\u77ed\u6a2a\u6760\u5373\u53ef\u3002</p>","tags":["unicode","pdf"]},{"location":"misc/2018/07/12/using-fcitx-fbterm/","title":"\u914d\u7f6e fcitx-fbterm \u5b9e\u73b0\u5728\u7ec8\u7aef\u4e0b\u663e\u793a\u548c\u8f93\u5165\u4e2d\u6587","text":"<p>\u53c2\u8003\u7f51\u7ad9\uff1a</p> <p>Ubuntu \u4f7f\u7528 fbterm \u65e0\u6cd5\u6253\u5f00 fb \u8bbe\u5907\u7684\u89e3\u51b3\u53ca fcitx-fbterm \u5b89\u88c5 Fcitx - ArchWiki \u5b8c\u7f8e\u4e2d\u6587 tty, fbterm+yong(\u5c0f\u5c0f\u8f93\u5165\u6cd5) \u8ba9 linux console \u652f\u6301\u4e2d\u6587\u663e\u793a\u548c fcitx \u8f93\u5165\u6cd5</p> <p>\u8003\u8651\u5230 lemote yeeloong \u673a\u5668\u7684 cpu \u8fd0\u7b97\u6027\u80fd\uff0c\u8dd1\u4e00\u4e2a\u56fe\u5f62\u754c\u9762\u4f1a\u975e\u5e38\u5361\uff0c\u4e8e\u662f\u9009\u62e9\u76f4\u63a5\u7528 framebuffer\u3002\u4f46\u662f\uff0c\u663e\u793a\u4e2d\u6587\u53c8\u6210\u4e86\u95ee\u9898\u3002\u4e8e\u662f\uff0c\u91c7\u7528\u4e86 fbterm \u548c fcitx \u914d\u5408\uff0c\u52a0\u4e0a gdm \u7684\u65b9\u6cd5\uff0c\u5b8c\u6210\u4e86\u7ec8\u7aef\u4e0b\u7684\u4e2d\u6587\u8f93\u5165\u3002</p> <p>\u9996\u5148\uff0c\u5b89\u88c5\u76f8\u5173\u7684\u5305\uff1a <pre><code>$ sudo apt install gpm fcitx-fronend-fbterm dbus-x11 fbterm fonts-wqy-zenhei\n</code></pre></p> <p>\u63a5\u7740\uff0c\u57fa\u4e8e\u4ee5\u4e0a\u53c2\u8003\u7f51\u7ad9\u7b2c\u4e00\u4e2a\uff0c\u7f16\u5199 zhterm \u6587\u4ef6\uff1a <pre><code>$ echo zhterm\n#!/bin/bash\neval `dbus-launch --auto-syntax`\nfcitx &gt;/dev/null 2&gt;&amp;1\nfbterm -i fcitx-fbterm\nkill $DBUS_SESSION_BUS_PID\nfcitx-remote -e\n$ chmod +x zhterm\n$ zhterm\n# Use C-SPC to switch input source\n</code></pre></p> <p>\u53e6\uff1a\u627e\u5230\u4e00\u4e2a\u6620\u5c04 Caps Lock \u5230 Escape \u7684\u65b9\u6848\uff1a <pre><code>$ sudo bash -c \"dumpkeys | sed 's/CtrlL_Lock/Escape/' | loadkeys\"\n</code></pre></p>","tags":["debian","fcitx","googlepinyin","fbterm"]},{"location":"misc/2019/02/08/weekly-sharing-10/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 10 \u671f","text":"<p>\u65b0\u5e74\u5feb\u4e50\uff01</p> <ol> <li>Haskell to WASM compiler https://github.com/tweag/asterius</li> <li>A ssh tarpit that sends endless banner https://github.com/skeeto/endlessh</li> <li>Use rust to write UEFI app https://github.com/rust-osdev/uefi-rs</li> <li>\u795e\u5947\u7684\u5c0f\u6e38\u620f https://yeahpython.github.io/game/game.html</li> <li>\u53c8\u4e00\u4e2a\u540e\u7aef rust web \u6846\u67b6 https://github.com/seanmonstar/warp</li> <li>\u633a\u9177\u7684\u4e00\u4e2a\u7f51\u7ad9 https://github.com/pomber/github-history</li> <li>ws \u8c03\u8bd5\u5de5\u5177 https://github.com/vi/websocat</li> <li>React Hooks \u8fdb\u5165\u6b63\u5f0f\u7248 https://reactjs.org/blog/2019/02/06/react-v16.8.0.html</li> <li>\u53c8\u4e00\u4e2a\u5173\u4e8e\u786c\u4ef6\u7684 wiki https://wikidevi.com/wiki/Main_Page</li> <li>virtio-fs \u9879\u76ee \u65e8\u5728\u66ff\u4ee3 virtio-9p https://virtio-fs.gitlab.io/</li> <li>SergioBenitez \u955c\u50cf\u4e86\u4e00\u4efd\u53bb\u5e74\u7684 CS140e https://cs140e.sergio.bz/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/02/16/weekly-sharing-11/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 11 \u671f","text":"<p>\u5bf9\u4e0d\u8d77\u8fdf\u5230\u4e86\uff08</p> <ol> <li>Google \u7684 fuzzing \u5bb6\u65cf\u53c8\u6765\u4e86\u4e2a\u65b0\u6210\u5458 \u592a\u559c\u6b22\u9020\u8f6e\u5b50\u4e86 https://github.com/google/clusterfuzz</li> <li>\u6709\u8da3\u7684\u6587\u672c\u751f\u6210\u5de5\u5177 https://github.com/TheBerkin/rant</li> <li>\u53c8\u4e00\u4e2a side channel attack https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2019/february/downgrade-attack-on-tls-1.3-and-vulnerabilities-in-major-tls-libraries/</li> <li>\u6765\u81ea Prof Fan \u7684\u4e00\u4e2a cf dns \u6743\u9650\u9650\u5236\u5206\u53d1\u7684\u5de5\u5177 https://github.com/ProfFan/cloudflare-proxy-rs</li> <li>\u90e8\u7f72\u5230\u4e86\u6211\u7684\u535a\u5ba2\u7684\u5c0f\u5de5\u5177 \u5927\u5bb6\u4f53\u4f1a\u5230\u4e86\u5417 https://instant.page/</li> <li>\u6559\u80b2\u6027\u8d28\u7684 C on web https://vasyop.github.io/miniC-hosting/</li> <li>\u6fc0\u6d3b\u6e05\u534e\u6559\u80b2\u7248 win10? --&gt; dig +short TXT win10.harrychen.xyz</li> <li>windows95 v2.0 \u53d1\u5e03\uff08\u8bef https://github.com/felixrieseberg/windows95/releases/tag/v2.0.0</li> <li>\u5df2\u7ecf\u90e8\u7f72\u5230 tuna \u7684 rustup-mirror crate https://github.com/jiegec/rustup-mirror</li> <li>Forth \u4e5f\u80fd\u6709 http \u670d\u52a1\u7aef\u6846\u67b6 http://www.1-9-9-1.com/</li> <li>bartender \u7684\u5f00\u6e90\u66ff\u4ee3 \u5b9e\u6d4b\u53ef\u7528 https://github.com/Mortennn/Dozer</li> <li>\u7ed9\u4e0d\u652f\u6301 pac \u7684\u5ba2\u6237\u7aef\u5728 http proxy \u4e0a\u5957\u4e00\u5c42 https://github.com/williambailey/pacproxy</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/02/23/weekly-sharing-12/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 12 \u671f","text":"<p>\u770b\u8111\u738b\u8fdf\u5230\u4e86\uff08</p> <ol> <li>Rust Embedded Graphics \u5e93 https://github.com/jamwaffles/embedded-graphics</li> <li>Wireguard for macOS https://lists.zx2c4.com/pipermail/wireguard/2019-February/003853.html</li> <li>Wireguard-go UI https://github.com/aequitas/macos-menubar-wireguard</li> <li>T2 \u9006\u5411 https://duo.com/labs/research/apple-t2-xpc</li> <li>\u8111\u738b\u526a\u8f91 https://www.bilibili.com/video/av43972717</li> <li>dram \u63a8\u8350\u7684\u5de5\u5177 notion.so</li> <li>\u5e26\u6388\u6743\u548c\u5ba1\u8ba1\u7684 sudo https://github.com/square/sudo_pair</li> <li>rust \u7684 manpage \u751f\u6210\u5668 https://github.com/rust-cli/man</li> <li>\u624d\u53d1\u73b0 Github \u6709 Project \u529f\u80fd https://help.github.com/en/articles/about-project-boards</li> <li>rust \u7684 elf/macho \u751f\u6210 https://github.com/m4b/faerie</li> <li>rust \u7684 elf/macho/pe \u8bfb\u53d6 https://github.com/m4b/goblin</li> <li>rust \u7684 glob \u5b9e\u73b0 https://github.com/rust-lang-nursery/glob</li> <li>\u57fa\u4e8e BoringSSL \u7684 rust \u52a0\u5bc6\u5e93 https://mundane.googlesource.com/mundane</li> <li>\u4ece linux \u4ea4\u53c9\u7f16\u8bd1\u5230 macOS \u7684\u65b9\u6cd5 https://github.com/tpoechtrager/osxcross</li> <li>cargo-deb \u540e\u53c8\u6709\u4e86 cargo-rpm https://github.com/RustRPM/cargo-rpm</li> <li>\u81ea\u5e26 diff \u7684 assert_eq \u5b8f https://github.com/colin-kiegel/rust-pretty-assertions</li> <li>Learn Helper 4.0 \u54c8\u5229\u7248\u53d1\u5e03 https://chrome.google.com/webstore/detail/learn-helper/mdehapphdlihjjgkhmoiknmnhcjpjall</li> <li>\u68c0\u67e5\u4f9d\u8d56\u4e2d\u5b58\u5728\u7684 unsafe https://github.com/anderejd/cargo-geiger</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/03/01/weekly-sharing-13/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 13 \u671f","text":"<p>\u4eca\u5929\u8fd8\u662f\u65e9\u70b9\u53d1\u5427</p> <ol> <li>Rust concurrent work-stealing queue \u53ef\u80fd\u53ef\u4ee5\u653e\u5230\u8c03\u5ea6\u5668\u91cc\u7528 https://github.com/kinghajj/deque</li> <li>\u652f\u6301\u4fe1\u7528\u5361/\u65f6\u95f4\u7b49\u683c\u5f0f\u4fe1\u606f\u7684\u8f93\u5165\u63a7\u4ef6 https://github.com/nosir/cleave.js</li> <li>Rust \u7684\u7b80\u5355 http server https://github.com/svenstaro/miniserve</li> <li>Coroutines &amp; Modules Added For C++20 http://www.phoronix.com/scan.php?page=news_item&amp;px=Coroutines-Modules-CPP20</li> <li>Implementing TCP in Rust (part 1) https://www.youtube.com/watch?v=bzja9fQWzdA</li> <li>\u4e00\u4e2a\u7c7b\u4f3c Vuetify \u7684\u6846\u67b6 https://buefy.org/</li> <li>systemd tmpfiles.d \u7528\u4e8e\u7ba1\u7406\u7279\u5b9a\u7684\u4e34\u65f6\u6587\u4ef6\u5939 https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html</li> <li>\u83b7\u53d6 ASN \u4fe1\u606f\u7684 API https://bgpview.docs.apiary.io/#reference/0/asn-prefixes/view-asn-prefixes</li> <li>Rust getter/setter generation https://github.com/Hoverbear/getset</li> <li>Golang 1.12 \u53d1\u5e03\uff1aTLS 1.3 http://www.phoronix.com/scan.php?page=news_item&amp;px=Golang-1.12-Released</li> <li>\u4e00\u4e2a\u7b11\u8bdd https://redd.it/aux77g</li> <li>Rust \u7684 STM https://github.com/mtak-/swym</li> <li>\u81ea\u52a8\u540c\u6b65\u89c6\u9891\u548c\u5b57\u5e55 https://github.com/smacke/subsync</li> <li>\u7528\u4e8e\u5feb\u901f\u5f00\u53d1\u7684 http server https://zeroserver.io/</li> <li>\u4e00\u4e2a\u81ea\u52a8\u52a0\u8f7d\u7684 http server https://github.com/tapio/live-server</li> <li>\u7528 markdown \u5199 presentation \u5728\u7ebf\u7248 https://github.com/gnab/remark</li> <li>\u89e3\u51b3 excel \u8bfb\u53d6 nodejs \u751f\u6210\u7684 csv \u7684\u4e71\u7801\u95ee\u9898 https://github.com/f2e-journey/xueqianban/issues/34</li> <li>\u6e05\u534e\u7684 Rust OS https://github.com/oscourse-tsinghua/rcore_plus</li> <li>GPU \u52a0\u901f\u7684 JS http://gpu.rocks/</li> <li>\u5c0f\u578b\u7684 k8s \u5b9e\u73b0\uff1ak3s https://k3s.io/</li> <li>\u7c97\u66b4\u7684\u96a7\u9053\uff0c\u6781\u4f4e\u7684\u5e26\u5bbd\uff0c\u6709\u5565\u7528 https://0day.work/performance-of-iodine-over-dns-over-https/</li> <li>Caddy \u4e58\u7740 Go \u5b98\u65b9\u652f\u6301\u7684\u8f66\u8f7b\u677e\u52a0\u5165 TLS1.3 \u5bb6\u65cf https://github.com/mholt/caddy/pull/2399/files</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/03/08/weekly-sharing-14/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 14 \u671f","text":"<p>\u6700\u8fd1\u6c89\u8ff7\u5199 OS\uff0c\u6ca1\u600e\u4e48\u641c\u7f57\u65b0\u7684\u4e1c\u897f\uff08</p> <ol> <li>\u7528 Docker \u505a\u4ea4\u53c9\u7f16\u8bd1 https://github.com/dockcross/dockcross#dockcross</li> <li>tar inplace extraction \u6709\u610f\u601d\u7684\u601d\u8def https://gitlab.com/antonok/taro</li> <li>los 16.0 \u53d1\u5e03 \u57fa\u4e8e Android Pie https://lineageos.org/Changelog-22/</li> <li>Rust 1.33.0 Pin \u8fdb\u5165 stable https://blog.rust-lang.org/2019/02/28/Rust-1.33.0.html</li> <li>Rust \u7528\u4e8e\u7f16\u5199 cli \u8f6f\u4ef6\u7684\u5de5\u5177\u5e93 https://rust-lang-nursery.github.io/cli-wg/index.html</li> <li>\u81ea\u52a8\u4f7f\u7528 CI \u53d1\u5e03\u4e8c\u8fdb\u5236 prebuilt \u7684\u6a21\u677f https://github.com/japaric/trust</li> <li>\u8f6c\u6362 gif \u5230 xlsx \u5f88\u795e\u5947 https://github.com/pugwonk/gif2xlsx/blob/master/README.md</li> <li>Go REPL https://github.com/cosmos72/gomacro</li> <li>\u57fa\u4e8e\u533a\u5757\u94fe\u7684\u8bba\u575b\u6d77\u661f \u5176\u5b9e\u662f\u533a\u5757\u94fe\u6570\u636e\u5e93 https://github.com/CovenantSQL/CovenantForum</li> <li>Rime emoji \u5d4c\u5165\u8f93\u5165\u6cd5 https://github.com/rime/rime-emoji</li> <li>\u4e00\u4e2a\u795e\u5947\u7684\u6570\u636e\u5e93 https://github.com/mit-pdos/noria</li> <li>\u4e00\u4e2a\u8bb2\u5185\u6838\u7684 gitbook https://richardweiyang.gitbooks.io/kernel-exploring/</li> <li>\u7528 React \u5199\u684c\u9762\u63a7\u4ef6 http://tracesof.net/uebersicht/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/03/16/weekly-sharing-15/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 15 \u671f","text":"<p>\u7ee7\u7eed\u6c89\u8ff7\u5199 OS </p> <ol> <li>\u5d4c\u5165 graphics for rust \u53ef\u4ee5\u7ed8\u5236 bmp \u4e86 https://wapl.es/rust/2019/03/04/embedded-graphics-0.4.7-bmp-support.html</li> <li>rustup component history \u65b9\u4fbf nightly \u65e5\u671f\u9009\u62e9 https://rust-lang.github.io/rustup-components-history/index.html</li> <li>grpcurl \u7528\u4e8e grpc \u8c03\u8bd5 https://github.com/fullstorydev/grpcurl</li> <li>grafana 6.0 is out http://docs.grafana.org/guides/whats-new-in-v6-0/</li> <li>\u5eb7\u54e5\u63a8\u8350\u7684\u5199\u8bba\u6587\u5de5\u5177\uff1ahttps://github.com/stsewd/ieee-pandoc-template</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/03/22/weekly-sharing-16/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 16 \u671f","text":"<p>\u7ee7\u7eed\u6c89\u8ff7\u5199 OS +1</p> <ol> <li>C++ \u7684\u4e00\u4e2a\u6bd4\u8f83 fancy \u7684 format \u5e93 https://github.com/fmtlib/fmt</li> <li>Rust \u7684 rsync \u66ff\u4ee3\u54c1 https://github.com/wchang22/lumins</li> <li>VirtIO 1.1 \u8981\u53d1\u5e03\u4e86 https://github.com/oasis-tcs/virtio-docs/commit/3b4130f3a8910dad89b8166e06e58806b9c60943</li> <li>\u5411\u4e8c\u7ef4\u7801\u5d4c\u5165\u56fe\u7247\u7684\u5de5\u5177 http://cgv.cs.nthu.edu.tw/Projects/Recreational_Graphics/Halftone_QRCodes/</li> <li>Google Chrome \u53d1\u51fa\u5947\u602a\u7684 DNS \u8bf7\u6c42\u7684\u539f\u56e0 https://unix.stackexchange.com/questions/363512/chrome-dns-requests-with-random-dns-names-malware</li> <li>\u8f6c\u6362 .HEIC \u5230 .jpg \u7684\u6279\u91cf\u65b9\u6848\uff1a<code>alias heic=\"magick mogrify -monitor -format jpg *.HEIC\"</code> ref: Apple SE</li> <li>\u4ee5\u6253\u4ee3\u7801\u6765\u7ec3\u6253\u5b57\u7684\u7f51\u7ad9  https://typing.io/</li> <li>VSCode \u7f51\u9875 server https://github.com/codercom/code-server</li> <li>\u5947\u7279\u7684 Rust \u7f51\u9875\u6808\u5b9e\u73b0 https://japaric.github.io/jnet/jnet/index.html</li> <li>H265 \u89e3\u6790 gui https://github.com/virinext/hevcesbrowser \u4e4b\u524d\u4ecb\u7ecd\u8fc7 H264 \u7684</li> <li>Awesome Rust Embedded https://github.com/rust-embedded/awesome-embedded-rust</li> <li>\u65b0\u7684 SiFive \u4ea7\u54c1 https://www.crowdsupply.com/sifive/hifive1-rev-b</li> <li>Wireshark 3.0.0 \u53d1\u5e03  https://www.wireshark.org/docs/relnotes/wireshark-3.0.0.html</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/03/31/weekly-sharing-17/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 17 \u671f","text":"<p>\u5bf9\u4e0d\u8d77\u5495\u5495\u4e86\u4e24\u5929\u3002\u3002</p> <ol> <li>\u5173\u4e8e rel=\"noopener\" \u7684\u4e00\u4e9b\u7ec6\u8282 https://mathiasbynens.github.io/rel-noopener</li> <li>Microsft Defender \u63a8\u51fa macOS \u7248 https://arstechnica.com/gadgets/2019/03/microsoft-ships-anti-virus-for-macos-as-windows-defender-becomes-microsoft-defender/</li> <li>\u57fa\u4e8e Docker \u7684\u5feb\u901f\u542f\u52a8\u5728\u7ebf Linux box https://github.com/instantbox/instantbox</li> <li>rust \u5728\u7a97\u53e3\u4e2d\u663e\u793a fb \u7684\u5e93 https://github.com/emoon/rust_minifb</li> <li>Vue \u5217\u8868\u7a7a\u95f4\uff0c\u4e3a\u5927\u91cf\u6570\u636e\u8bbe\u8ba1 https://github.com/tangbc/vue-virtual-scroll-list</li> <li>musl \u5404\u5e73\u53f0\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe https://musl.cc/</li> <li>\u5728\u7ebf\u7684 markdown \u8f6c pdf https://md2pdf.netlify.com/</li> <li>\u4e00\u672c\u5173\u4e8e C64 \u7684\u4e66 http://10print.org/</li> <li>\u8f6c\u81ea dram \"haskutil tql\uff0c\u81ea\u52a8\u66f4\u65b0 import\uff0c\u81ea\u52a8 {-# LANGUAGE #-} \uff0c\u81ea\u52a8\u586b hole\" https://github.com/EduardSergeev/vscode-haskutil</li> <li>ZFS on Linux \u52a0\u5165 TRIM \u652f\u6301 http://www.phoronix.com/scan.php?page=news_item&amp;px=ZFS-On-Linux-TRIM-Lands</li> <li>\u53c8\u4e00\u4e2a\u4f53\u73b0 JS \u7384\u5b66\u4e4b\u5904\u7684\u7f51\u7ad9 https://getify.github.io/coercions-grid/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/04/05/weekly-sharing-18/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 18 \u671f","text":"<p>\u4e0d\u5495\u4e0d\u5495</p> <ol> <li>Alfred pwgen workflow https://github.com/deanishe/alfred-pwgen</li> <li>\u9b54\u6539\u4e3b\u677f\uff0c\u5728\u8001\u4e3b\u677f\u4e0a\u653e 16GB \u5185\u5b58 https://readhacker.news/s/3Zty4</li> <li>Mesalink TLS \u5e93\u7684 Rust \u5b9e\u73b0 https://github.com/mesalock-linux/mesalink</li> <li>\u5b9e\u6d4b\u53ef\u7528 Rust \u5199\u7684 STM32 \u5e94\u7528 https://github.com/lupyuen/stm32-blue-pill-rust</li> <li>\u5f00\u6e90 PCIe \u6838 https://github.com/enjoy-digital/litepcie</li> </ol> <p>\u6b22\u8fce\u6295\u7a3f\u3002</p>","tags":["weeklysharing"]},{"location":"misc/2019/04/15/weekly-sharing-19/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 19 \u671f","text":"<p>\u5ffd\u7136\u60f3\u8d77\u6765\u5fd8\u4e86\u8fd9\u4ef6\u4e8b\u60c5\u4e24\u5929\u3002\u3002</p> <ol> <li>Pock \u5728 Touchbar \u4e2d\u663e\u793a\u5e76\u63a7\u5236 Dock https://pock.pigigaldi.com/</li> <li>MacBook touchbar+keyboard+touchpad Linux \u9a71\u52a8 https://github.com/roadrunner2/macbook12-spi-driver</li> <li>Kendryte K210 \u4e0a\u7684 GBA \u6a21\u62df\u5668 https://github.com/44670/mgba-k210</li> <li>Rust \u751f\u6210 PDF \u6587\u4ef6\u7684\u5e93 https://github.com/J-F-Liu/lopdf </li> <li>\u4e2d\u79d1\u5927\u7528 Rust \u7f16\u5199 FreeRTOS \u7684\u5b9e\u9a8c https://github.com/OSH-2019/x-rust-freertos</li> <li>Google \u53d1\u5e03 Cloud Code \u63d2\u4ef6\uff0c\u76f4\u63a5\u5728 k8s \u4e0a\u8c03\u8bd5\u8fd0\u884c https://cloud.google.com/blog/products/devops-sre/announcing-cloud-code-accelerating-cloud-native-application-development</li> <li>\u901a\u8fc7 libusb \u8de8\u5e73\u53f0\u7684 usbip server https://github.com/jwise/pyusbip</li> <li>Linux \u4e0b BCM43602 Firmware \u95ee\u9898\u7684\u4e0d\u5b8c\u7f8e\u89e3\u51b3\u65b9\u6cd5 https://bugzilla.kernel.org/show_bug.cgi?id=193121</li> <li>\u7ed9\u6811\u8393\u6d3e\u4e0a\u7535\u7684\u65b0\u65b9\u6cd5 https://youtu.be/X2vF9KAEJx8</li> <li>Docker \u91cc\u8dd1 Deepin Wechat \u7684\u955c\u50cf https://github.com/bestwu/docker-wechat.git</li> <li>NS Switch \u7684\u5305\u7ba1\u7406\u5668 https://switchbrew.org/wiki/Main_Page</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2018/12/14/weekly-sharing-2/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 2 \u671f","text":"<p>\u7ee7\u7eed\uff0c\u7ee7\u7eed\u3002</p> <ol> <li>\u7528\u4ee3\u7801\u5448\u73b0\u786c\u4ef6\u5b9e\u73b0\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u503c\u5f97\u4e00\u8bfb \u94fe\u63a5</li> <li>\u53d1\u73b0\u4e86\u4e00\u4e2a\u86ee\u5c11\u89c1\u7684\u7f16\u7801\u6807\u51c6 AVS2\uff0c\u624d\u53d1\u73b0\u662f\u4e2d\u56fd\u4e3b\u5bfc\u7684 \u7f16\u7801\u5668</li> <li>linux.org \u7684 DNS \u88ab\u7be1\u6539\u4e86\uff0c\u8ba4\u51c6 kernel.org \u5373\u53ef</li> <li>\u4e00\u4e2a\u5904\u7406\u5668\u7684\u7535\u8def\u7684\u5728\u7ebf\u53ef\u89c6\u5316 ARM1 visualized</li> <li>WASM \u5bb6\u5ead\u73b0\u5df2\u52a0\u5165 Nginx \u94fe\u63a5</li> <li>\u7528 .bat \u7f16\u5199\u6c47\u7f16\u8bed\u8a00 mnnip/BOOTSTRA</li> <li>Gitlab \u633a\u9999\u7684\uff0c\u5179\u74f7 git-lfs\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5df1\u7ed9\u81ea\u5df1\u7684\u9879\u76ee\u914d\u4e00\u4e2a ci runner</li> <li>LaTeX \u7684 subfigure \u4e4b\u95f4\u5982\u679c\u6709\u7a7a\u884c\uff0c\u5c31\u771f\u7684\u6362\u4e86\u4e00\u884c\uff0c\u6240\u4ee5\u540c\u4e00\u884c\u7684 subfigure \u4e0d\u8981\u6362\u884c</li> <li>Rocket 4.0 \u51fa\u4e86\uff0c\u770b\u8d77\u6765\u4e0d\u9519\uff0c\u8981\u662f\u4f5c\u8005\u66f4\u65b0\u4e00\u4e0b CS140e \u5c31\u597d\u4e86 \u94fe\u63a5</li> <li>\u88c5\u673a\u5fc5\u5907\uff0c\u67e5\u8be2 Arch Wiki arch-wiki-man</li> <li>LaTeX \u91cc \\newcommand \u65f6\uff0c\u5982\u679c\u6587\u4ef6\u540d\u6709\u591a\u4e2a '.' \uff0c\u8981\u7279\u6b8a\u5904\u7406 \u94fe\u63a5</li> <li>RunAsDate for *nix wolfcw/libfaketime</li> <li>\u7528\u6570\u636e\u5e93\u505a\u6570\u636e\u5206\u6790\u4f3c\u4e4e\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9</li> <li>Canvas \u914d\u5408 globalCompositionOperation \u80fd\u505a\u5230\u4e0d\u5c11\u4e1c\u897f</li> <li>\u624d\u77e5\u9053\u6709 Time Machine over SMB \u8fd9\u79cd\u64cd\u4f5c \u94fe\u63a5</li> <li>mDNS repeater \u628a\u4e24\u4e2a\u5b50\u7f51\u7684 mDNS \u6253\u901a kennylevinsen/mdns-repeater</li> <li>Office 2019 for Mac \u7684 December 2018 release \u6dfb\u52a0\u4e86 Dark Mode\uff0c\u5e76\u4e14\u4e5f\u652f\u6301\u4e86 Continuity Camera\uff0c\u76f4\u63a5\u4ece\u624b\u673a\u62cd\u7167\u5bfc\u5165</li> <li>Gitlab serverless \u53d1\u5e03\uff0c\u671f\u5f85 \u94fe\u63a5</li> <li>\u7528 NAS \u4f5c\u4e3a Time Machine \u5907\u4efd\u76d8\u7684\u65b9\u6cd5 \u94fe\u63a5</li> <li>\u7814\u7a76\u4e86\u4e00\u4e0b\uff0cTime Machine over SMB \u5728 macOS \u91cc\u7684\u8868\u73b0\u5f62\u5f0f\u662f apfs \u91cc\u5199\u4e86\u4e00\u4e2a sparse bundle\uff0cbundle \u91cc\u9762\u662f HFS+ \u3002</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/04/20/weekly-sharing-20/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 20 \u671f","text":"<p>\u5199\u5230\u4e86\u7b2c 20 \u671f\u4e86\uff01\u6700\u8fd1\u51e0\u671f\u603b\u662f\u5728\u5495\u5495\u3002</p> <ol> <li>Rust \u7684\u79d1\u5b66\u8ba1\u7b97\u5e93 https://github.com/rust-ndarray/ndarray https://github.com/jturner314/ndarray-stats</li> <li>Rust Crate \u751f\u6001\u53ef\u89c6\u5316 https://rfdonnelly.github.io/crate-galaxy/</li> <li>\u5728\u5730\u5740\u680f\u91cc\u505a\u52a8\u753b http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/#%F0%9F%8C%92</li> <li>Ruby 3 \u4e5f\u8981\u52a0\u7c7b\u578b\u4e86 https://twitter.com/darkdimius/status/1119115657776209920</li> <li>verilog \u7684 MAC + \u7b80\u6613\u7f51\u7edc\u6808 https://github.com/alexforencich/verilog-ethernet</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/04/27/weekly-sharing-21/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 21 \u671f","text":"<p>\u6765\u4e86\u6765\u4e86</p> <ol> <li>Rust stackful generator \u5e93 https://github.com/Xudong-Huang/generator-rs</li> <li>wireshark tui https://termshark.io/</li> <li>Pythonm \u52a0 annotation \u7684\u8c03\u8bd5 https://github.com/cool-RR/PySnooper</li> <li>Haskell \u53c8\u4e00\u4e2a\u6559\u7a0b https://github.com/alpacaaa/zero-bullshit-haskell</li> <li>\u76f4\u63a5\u5728 Rust \u4e2d\u5199 Python https://docs.rs/inline-python/0.2.0/inline_python/</li> <li>\u76f4\u63a5\u628a regex \u6355\u6349\u5230\u7684 group \u4e22\u5230 struct \u91cc https://crates.io/crates/recap</li> <li>XDP \u5c42\u7684\u6293\u5305 https://github.com/cloudflare/xdpcap</li> <li>AWS \u5f00\u59cb\u63d0\u4f9b\u9999\u6e2f\u7684\u4e91\u670d\u52a1 https://www.allthingsdistributed.com/2019/04/aws-region-asia-pacific-hong-kong.html</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/05/03/weekly-sharing-22/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 22 \u671f","text":"<ol> <li>AXI-Stream Components https://github.com/alexforencich/verilog-axis</li> <li>go self update \u5e93 https://github.com/rhysd/go-github-selfupdate</li> <li>Atomic Pi https://www.cnx-software.com/2019/04/26/buy-atomic-pi-cherry-trail-sbc/</li> <li>\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668 Hugo https://github.com/gohugoio/hugo</li> <li>C++ enum \u7684\u53cd\u5c04 https://github.com/Neargye/magic_enum</li> <li>\u53c8\u4e00\u4e2a\u5f00\u6e90\u7684\u53cd\u7f16\u8bd1\u5668 https://github.com/BoomerangDecompiler/boomerang</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/05/11/weekly-sharing-23/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 23 \u671f","text":"<ol> <li>VS Code Remote https://code.visualstudio.com/blogs/2019/05/02/remote-development</li> <li>Rust \u547d\u4ee4\u884c\u770b\u56fe\u7247 https://github.com/atanunq/viu</li> <li>GCC 9.1 \u53d1\u5e03 https://readhacker.news/s/42Ruk</li> <li>Rust \u7684 Unikernel https://github.com/hermitcore/libhermit-rs</li> <li>Rust \u7684 QRCode \u5e93 https://www.reddit.com/r/rust/comments/bk7z2x/announcing_bardecoder_a_qr_detector_and_decoder/</li> <li>\u9c81\u8fc5\u8bf4\u8fc7\u641c\u7d22\u5f15\u64ce http://cx.luxunmuseum.com.cn/</li> <li>JIT \u7684 golang REPL https://github.com/gijit/gi</li> <li>Github \u79c1\u6709 Package Repo https://github.com/features/package-registry</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/05/17/weekly-sharing-24/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 24 \u671f","text":"<ol> <li>\u5728\u7ebf\u6ce2\u5f62\u7ed8\u5236 https://wavedrom.com/editor.html</li> <li>Python \u6ce2\u5f62\u7ed8\u5236 https://github.com/wallento/wavedrompy</li> <li>GDB 8.3 \u53d1\u5e03 http://www.phoronix.com/scan.php?page=news_item&amp;px=GDB-8.3-Debugger-Released</li> <li>\u547d\u4ee4\u884c\u81ea\u52a8\u641c\u7d22 StackOverflow https://github.com/WindSoilder/hors</li> <li>\u4ece C \u5230 Rust \u7684\u7ffb\u8bd1 https://github.com/immunant/c2rust</li> <li>SHA-1 \u78b0\u649e\u653b\u51fb\u65b0\u8fdb\u5c55 https://www.zdnet.com/article/sha-1-collision-attacks-are-now-actually-practical-and-a-looming-danger/</li> <li>macOS \u914d\u7f6e AD \u7ba1\u7406\u5458\u7ec4 https://derflounder.wordpress.com/2011/02/17/adding-groups-from-your-directory-service-to-your-macs-admin-group/</li> <li>ssh \u540e\u81ea\u52a8\u5b89\u88c5\u5e76\u6253\u5f00 code-server \u540c\u6b65\u914d\u7f6e https://github.com/cdr/sshcode</li> <li>HTTP Sunset \u5934 https://tools.ietf.org/html/rfc8594</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/05/24/weekly-sharing-25/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 25 \u671f","text":"<ol> <li>\u5173\u6389\u5404\u79cd Intel BUG \u7684 mitigation https://t.me/one_real_world/1517</li> <li>GCC 10 \u652f\u6301\u7528 MMX \u6a21\u62df SSE http://www.phoronix.com/scan.php?page=news_item&amp;px=GCC-10-Emulating-MMX-With-SSE</li> <li>Minecraft Earth \u53d1\u5e03 https://www.minecraft.net/en-us/article/new-game--minecraft-earth#</li> <li>Python \u5b98\u65b9 format \u5de5\u5177 https://github.com/python/black</li> <li>JS Binary AST Proposal https://github.com/tc39/proposal-binary-ast</li> <li>\u7528 Rust \u5b9e\u73b0\u7684 ld https://github.com/aep/elfkit</li> <li>Verilog -&gt; Minecraft https://github.com/itsFrank/MinecraftHDL</li> <li>Rust \u5b9e\u73b0\u7684 \u5149\u6805\u5316\u8f93\u51fa https://github.com/ecumene/rust-sloth/</li> <li>Nokia \u7684 Rust \u5185\u5b58 profiler https://github.com/nokia/memory-profiler</li> <li>Linux 5.2 \u66f4\u65b0\u7684 Logitech Wireless Device \u9a71\u52a8 \u6b63\u597d\u80fd\u7528\u4e0a http://www.phoronix.com/scan.php?page=news_item&amp;px=Better-Logitech-Linux-5.2</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/05/31/weekly-sharing-26/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 26 \u671f","text":"<ol> <li>Grafana 6.2 \u53d1\u5e03 https://grafana.com/blog/2019/05/22/grafana-v6.2-released/</li> <li>Program Synthesis Talk by Paul Zhu https://paulz.me/talk/program-synthesis/</li> <li>VSCode \u6478\u9c7c\u63d2\u4ef6 https://github.com/cteams/Thief-Book</li> <li>\u7f16\u8bd1\u671f C++ \u8ba1\u7b97\u5668 https://www.zhihu.com/question/28582706/answer/691444859</li> <li>\u4e00\u4e2a\u5728\u7ebf\u7684 tomasulo \u7b97\u6cd5\u5b9e\u73b0 https://tomasulo.harrychen.xyz/</li> <li>Safari Technology Preview 83 \u53d1\u5e03\uff0c\u542b WebAuthN \u652f\u6301 https://webkit.org/blog/8967/release-notes-for-safari-technology-preview-83/</li> <li>Markdown -&gt; \u5fae\u4fe1 https://github.com/lyricat/wechat-format</li> <li>Rust \u7684 Code Coverage \u5e93 https://github.com/xd009642/tarpaulin</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/06/07/weekly-sharing-27/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 27 \u671f","text":"<p>\u9ad8\u8003\u52a0\u6cb9\uff01</p> <ol> <li>Fallout \u6f0f\u6d1e https://arxiv.org/abs/1905.12701</li> <li>PageRank \u4e13\u5229\u5230\u671f https://patents.google.com/patent/US6285999B1/en</li> <li>\u7ec8\u7aef\u7535\u91cf\u53ef\u89c6\u5316 https://github.com/svartalf/rust-battop</li> <li>\u67e5\u627e DB \u7684 DB https://dbdb.io</li> <li>\u5728 Rust \u91cc\u5199 GPU \u7a0b\u5e8f https://github.com/calebwin/emu</li> <li>WWDC 2019 \u633a\u4e0d\u9519\u7684</li> <li>Alfred 4 \u53d1\u5e03 https://www.alfredapp.com/blog/announcements/alfred-4-is-here/</li> <li>Mac Pro AR https://www.apple.com/105/media/us/mac-pro/2019/36178e80-30fd-441c-9a5b-349c6365bb36/quick-look/case-on.usdz</li> <li>VSCode \u7a33\u5b9a\u7248\u4e5f\u53ef\u4ee5 Remote \u4e86 https://code.visualstudio.com/docs/remote/ssh</li> <li>2019 \u9ad8\u8003\u8bed\u6587\u4f5c\u6587 https://mp.weixin.qq.com/s/2NwkbbMlAUJpOKKuln1T4g</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/06/15/weekly-sharing-28/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 28 \u671f","text":"<ol> <li>Rust Sec https://github.com/RustSec/advisory-db</li> <li>opendrop \u5f00\u6e90\u7684 AirDrop \u5b9e\u73b0 https://github.com/seemoo-lab/opendrop</li> <li>\u4ee3\u7801\u5185\u5d4c\u56fe\u7247 https://javl.github.io/image2cpp/</li> <li>RAMBleed \u653b\u51fb https://readhacker.news/s/44MHD</li> <li>WSL2 \u53ef\u4ee5\u4f53\u9a8c\u4e86 https://devblogs.microsoft.com/commandline/wsl-2-is-now-available-in-windows-insiders/</li> <li>Rust 2019 \u751f\u6001\u62a5\u544a https://www.jetbrains.com/lp/devecosystem-2019/rust/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/06/21/weekly-sharing-29/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 29 \u671f","text":"<ol> <li>ZFS on Linux \u53d1\u5e03 0.8.1 https://github.com/zfsonlinux/zfs/releases/tag/zfs-0.8.1</li> <li>slim: Dockerfile to VM image https://github.com/ottomatica/slim</li> <li>Rust \u91cd\u5199\u7684 du \u66ff\u4ee3\u7269 \u786e\u5b9e\u5f88\u5feb https://github.com/Byron/dua-cli</li> <li>iOS 13/macOS Catalina beta 2 \u51fa\u4e86 \u5e76\u4e14\u53ef\u4ee5 OTA \u76f8\u5173\u4fe1\u606f https://9to5mac.com/2019/06/17/ios-13-beta-2-features/ https://developer.apple.com/documentation/macos_release_notes/macos_catalina_10_15_beta_2_release_notes https://mp.weixin.qq.com/s/Ae1SIcK9ho4Mh0g_UsbAyA</li> <li>Steam \u5df2\u7ecf\u89e3\u51b3\u4e86 Catalina \u4e0a 32 \u4f4d\u7a0b\u5e8f\u4e0d\u80fd\u8fd0\u884c\u7684\u95ee\u9898 https://www.reddit.com/r/MacOS/comments/c17lh8/steam_and_macos_catalina</li> <li>\u5728\u4e00\u4e9b\u8001\u7684 Mac \u4e0a Sidecar \u662f\u9ed8\u8ba4\u5173\u95ed\u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u5f00\u542f https://github.com/pookjw/SidecarPatcher/blob/master/README.md \u867d\u7136\u6548\u679c\u4e0d\u4f1a\u5f88\u597d</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2018/12/22/weekly-sharing-3/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 3 \u671f","text":"<p>\u56e0\u4e3a DDL\uff0c\u5495\u4e86\u4e00\u5c0f\u4f1a\u3002</p> <ol> <li>\u88ab Windows \u4fdd\u5b58\u4e3a Unicode \u6587\u4ef6\u5751\u4e86 BOM \u914d\u4e0a UTF-16 \u592a\u96be\u53d7\u4e86</li> <li>Github \u6700\u8fd1\u6dfb\u52a0\u4e86\u5f88\u591a Issue \u65b9\u9762\u7684\u66f4\u65b0\uff0c\u5982 Pin \u548c Delete</li> <li>Grafana \u771f\u7684\u5f88\u597d\u770b\u5f88\u597d\u7528 \u63a8\u8350\u5927\u5bb6\u81ea\u5df1\u914d\u4e00\u5957\u76d1\u63a7\u7cfb\u7edf</li> <li>Microsoft Remote Desktop Beta \u65b0\u589e\u4e86 AVC Codec \u6709\u610f\u601d \u4e0d\u77e5\u9053\u5565\u65f6\u5019\u4e0a HEVC</li> <li>\u53d1\u73b0\u4e00\u4e2a\u5f88\u597d\u73a9\u7684\u7528 Rust \u5199\u7684\u7f51\u9875\u6e38\u620f https://sandspiel.club/#</li> <li>Python Pattern Matching https://github.com/santinic/pampy</li> <li>\u5927\u65b0\u95fb\uff1aMIPS Open Source \u4e86 https://www.eetimes.com/document.asp?doc_id=1334087</li> <li>GRPC \u8c03\u8bd5\u7684 GUI https://github.com/uw-labs/bloomrpc \u5bf9\u6807 Postman</li> <li>\u9177\u70ab\u7684\u5c4f\u5e55\u4fdd\u62a4 for Mac https://github.com/JohnCoates/Aerial</li> <li>WPF \u5f00\u6e90\u4e86 \u4e0d\u77e5\u9053\u5565\u65f6\u5019\u652f\u6301 *nix https://github.com/dotnet/wpf</li> <li>\u5206\u4eab\u6b22\u4e50 https://github.com/dotnet/wpf</li> <li>\u5206\u4eab\u6b22\u4e50 x2 https://lore.kernel.org/patchwork/patch/628142/</li> <li>\u8c37\u6b4c\u8fd1\u65e5\u5230\u5904\u4e0a\u7ebf\u4e86 Material Design 2.0 \u611f\u89c9\u98ce\u683c\u4e0d\u5927\u4e60\u60ef</li> <li>veonim/veonim \u7684 Tag \u91cc\u6709 #meme-driven-development \u592a\u597d\u7b11\u4e86</li> <li>\u5de8\u786c\u5f00\u6e90\u4e86\u81ea\u5df1\u7684 UEFI \u548c TianoCore EDK \u7ade\u4e89 https://blogs.windows.com/buildingapps/2018/12/19/%e2%80%afintroducing-project-mu/</li> <li>Github \u7684 GDPR \u5b8c\u5168\u4f53\u4e0a\u7ebf https://blog.github.com/2018-12-19-download-your-data/</li> <li>ZFSonLinux \u8981\u7edf\u6cbb ZFS \u4e16\u754c\u7684\u8282\u594f https://lists.freebsd.org/pipermail/freebsd-current/2018-December/072422.html</li> <li>VBScript \u771f\u7684\u662f\u592a\u591a\u6f0f\u6d1e\u4e86 \u6ee1\u76ee\u75ae\u75cd https://googleprojectzero.blogspot.com/2018/12/on-vbscript.html</li> <li>\u539f\u6765\u53d6\u540d\u771f\u7684\u8fd9\u4e48\u8349\u7387\u7684\u5417 \u6211\u4e5f\u60f3\u4e70\u4e00\u4e2a\u4e86 https://www.solidot.org/story?sid=59028</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/06/28/weekly-sharing-30/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 30 \u671f","text":"<ol> <li> <p>\u4e00\u4e2a\u53ef\u53c2\u8003\u7684\u9632\u6b62 side channel attack \u7684\u65b9\u6cd5 https://www.undeadly.org/cgi?action=article;sid=20190621081455</p> </li> <li> <p>\u7269\u7406\u4e0a\u955c\u50cf\u767e\u5146\u7684\u65b9\u6cd5 \u5b9e\u6d4b\u53ef\u7528 https://greatscottgadgets.com/throwingstar/</p> </li> <li> <p>\u5fae\u8f6f\u5458\u5de5\u5199\u7684 malloc https://github.com/microsoft/mimalloc</p> </li> <li> <p>\u8d85\u6807\u91cf\u4e71\u5e8f\u6267\u884c\u7684 x86 \u8f6f\u6838 https://tspace.library.utoronto.ca/bitstream/1807/80713/1/Wong_Henry_T_201711_PhD_thesis.pdf</p> </li> <li> <p>Rust \u7684 wireshark \u66ff\u4ee3 https://github.com/kpcyrd/sniffglue</p> </li> <li> <p>Rpi 4 \u53d1\u5e03 https://readhacker.news/s/45nK9</p> </li> <li> <p>iOS/macOS Catalina PB1 \u53d1\u5e03\uff08= DB2\uff09</p> </li> <li> <p>dbg! \u79fb\u690d\u5230\u4e86 C++ https://github.com/sharkdp/dbg-macro</p> </li> <li> <p>\u7c7b\u4f3c\u4e8e Elm \u7684 Rust \u524d\u7aef\u6846\u67b6 https://github.com/David-OConnor/seed</p> </li> <li> <p>\u8bbf\u95ee VMware \u865a\u62df\u673a\u4e32\u53e3\u7684\u65b9\u6cd5 https://thewayeye.net/2009/december/4/connecting-virtual-machines-serial-console-os-x-and-vmware-fusion/</p> </li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/07/05/weekly-sharing-31/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 31 \u671f","text":"<ol> <li>\u4e00\u4e2a Docker \u7684 TUI https://github.com/jesseduffield/lazydocker</li> <li>\u5728\u7ebf Git cheatsheet http://ndpsoftware.com/git-cheatsheet.html</li> <li>\u5e26\u5386\u53f2\u5408\u5e76\u4e24\u4e2a Git \u4ed3\u5e93 https://stackoverflow.com/a/10548919</li> <li>iOS 13 Dev Beta 3 https://mp.weixin.qq.com/s/6cxLXOYgeP6QkDpa9kdoug</li> <li>iOS 13 FaceTime Attention Correction https://readhacker.news/s/45QX2</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/07/12/weekly-sharing-32/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 32 \u671f","text":"<ol> <li>Rpi4 \u7684 Type-C \u8bbe\u8ba1\u6709\u95ee\u9898  https://readhacker.news/s/45WYc</li> <li>Debian buster released</li> <li>USB Type-C Serial adapter with WCH/FTDI https://github.com/z4yx/USB-C-Serial</li> <li>Linux 5.2 Kernel released http://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-5.2-Released</li> <li>iOS/iPadOS PB2 \u53d1\u5e03\uff0c\u4e0e DB3 \u5dee\u4e86\u4e00\u4e2a\u5c0f\u7248\u672c\u53f7</li> <li>Pacman in 512 bytes of x86 boot sector machine code https://readhacker.news/s/466Zm</li> <li>clang \u7684 use after move checker \u4f7f\u7528 https://awesomekling.github.io/Catching-use-after-move-bugs-with-Clang-consumed-annotations/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/07/19/weekly-sharing-33/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 33 \u671f","text":"<ol> <li>\u4e00\u4e2a\u8bb2 Rust \u6bd4\u8f83\u786c\u6838\u7684\u535a\u5ba2 http://system.joekain.com/</li> <li>\u5229\u7528 fzf \u5b9e\u73b0 shell \u7684 REPL https://github.com/pawelduda/fzf-live-repl</li> <li>\u7c7b\u4f3c Vue \u7684\u524d\u7aef Go \u6846\u67b6 https://www.vugu.org/doc/start</li> <li>iOS 13 beta 4 \u53d1\u5e03 14A5534f</li> <li>\u9488\u5bf9 T2 NVMe \u7684 patch http://www.phoronix.com/scan.php?page=news_item&amp;px=NVMe-Patches-LKML-Apple-Mac</li> <li>\u4e00\u4e2a\u524d\u7aef\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u95ee\u5377\u7f51\u7ad9 https://blog.fugoes.xyz/crypto-q/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/07/27/weekly-sharing-34/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 34 \u671f","text":"<ol> <li>macOS Mojave 10.14.6 iOS 12.4 \u6b63\u5f0f\u7248\u66f4\u65b0\u53d1\u5e03\uff0c\u8fd8\u6709\u8001\u7248\u672c\u7684\u66f4\u65b0 https://www.macrumors.com/2019/07/22/apple-releases-gps-bug-fix-older-iphones-ipads/</li> <li>CLion 2019.2 \u6dfb\u52a0\u4e86 GDB Server \u7684\u8c03\u8bd5\u652f\u6301\uff0c\u53ef\u4ee5\u7528 OpenOCD\u3002</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/08/02/weekly-sharing-35/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 35 \u671f","text":"<ol> <li>Apple Touch Bar \u7684 Windows \u7b2c\u4e09\u65b9\u652f\u6301 https://github.com/imbushuo/DFRDisplayKm</li> <li>WSL2 \u65b0\u7684\u8fdb\u5c55 http://www.phoronix.com/scan.php?page=news_item&amp;px=Windows-WSL2-Localhost-Plus</li> <li>Lightning \u8f6c\u63a5\u5934\u91cc\u9762\u5c45\u7136\u8dd1 iBoot \u548c Darwin https://readhacker.news/s/46Zde</li> <li>iOS 13 beta 5 \u53d1\u5e03</li> <li>ES2019 \u524d\u77bb https://blog.tildeloop.com/posts/javascript-what%E2%80%99s-new-in-es2019</li> <li>Rust \u53ef\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784 https://github.com/orium/rpds</li> <li>Rust \u4e0d\u53ef\u53d8\u6570\u636e\u7ed3\u6784 https://github.com/bodil/im-rs</li> <li>macOS Catalina 10.15 beta 5 \u53d1\u5e03</li> <li>Algebraic Effect https://overreacted.io/algebraic-effects-for-the-rest-of-us/</li> <li>Donald Knuth \u5bf9\u4e8e Sensitivity Proof \u8bc1\u660e\u7684\u7b80\u5316 https://readhacker.news/s/47fsA \u771f\u662f\u8001\u5f53\u76ca\u58ee</li> <li>TLS1.3 \u6807\u51c6\u7684\u7b80\u5316\u7248 https://readhacker.news/s/47eG9</li> <li>iTerm 3.3 \u53d1\u5e03 https://iterm2.com/downloads/stable/iTerm2-3_3_0.changelog</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/08/10/weekly-sharing-36/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 36 \u671f","text":"<ol> <li>QuickJS + libuv https://github.com/saghul/qjsuv</li> <li>Rust \u5b9e\u73b0\u7684 Ruby https://github.com/artichoke/artichoke</li> <li>\u7c7b\u4f3c JSON \u7684\u6570\u636e\u683c\u5f0f https://cbor.io/</li> <li>rls \u4e8c\u4ee3\u76ee https://github.com/rust-analyzer/rust-analyzer</li> <li>\u7ed9 MacBook \u6dfb\u52a0\u89e6\u5c4f\u652f\u6301 https://github.com/bijection/sistine</li> <li>\u7528\u4e8e MBP with T2 \u7684 Linux patch https://github.com/aunali1/linux-mbp-arch</li> <li>\u5728 tmux \u4e2d\u4f7f\u7528 Touch ID \u8ba4\u8bc1 sudo https://blog.birkhoff.me/make-sudo-authenticate-with-touch-id-in-a-tmux/</li> <li>iOS 13 beta 6 \u53d1\u5e03</li> <li>Linux Journal \u7ed3\u675f\u4e86\u5b83\u7684\u4f7f\u547d</li> <li>ssh 8.0 Add support for ECDSA keys in PKCS#11 tokens</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/08/16/weekly-sharing-37/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 37 \u671f","text":"<ol> <li>Rust netlink \u5e93 https://github.com/jbaublitz/neli</li> <li>Rust \u5904\u7406 signal \u8fdb\u884c\u914d\u7f6e\u7684 reload https://vorner.github.io/2019/08/11/runtime-configuration-reloading.html</li> <li>macOS \u6dfb\u52a0\u4e86 VirtIO \u9a71\u52a8\u652f\u6301 https://passthroughpo.st/mac-os-adds-early-support-for-virtio-qemu/</li> <li>\u4e00\u4e2a GNU readline \u66ff\u4ee3\u54c1 https://github.com/AmokHuginnsson/replxx</li> <li>Rust 1.37.0 \u53d1\u5e03 https://blog.rust-lang.org/2019/08/15/Rust-1.37.0.html</li> <li>iOS 13 DB7 (17A5565b) \u53d1\u5e03</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/08/23/weekly-sharing-38/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 38 \u671f","text":"<ol> <li>\u9488\u5bf9\u90e8\u5206 HTTP/2 \u5b9e\u73b0\u7684\u65b0\u6f0f\u6d1e https://github.com/Netflix/security-bulletins/blob/master/advisories/third-party/2019-002.md</li> <li>\u53ea\u8bfb tmux \u52a0\u9b54\u6539 https://brianmckenna.org/blog/guest_tmux</li> <li>Rust \u7f16\u8bd1\u671f\u65ad\u8a00 https://github.com/nvzqz/static-assertions-rs</li> <li>Rust \u8fd0\u884c\u65f6\u89e3\u538b\u7248\u7684 include_bytes https://github.com/SOF3/include-flate</li> <li>\u628a Rust \u6807\u51c6\u5e93\u8fdb\u884c async \u5316\u7684\u5c1d\u8bd5 https://async.rs/blog/announcing-async-std/#</li> <li>git \u6dfb\u52a0 switch/restore \u547d\u4ee4 https://github.blog/2019-08-16-highlights-from-git-2-23/</li> <li>Flash Player in Rust https://github.com/ruffle-rs/ruffle</li> <li>Matplotlib Cheatsheet https://github.com/rougier/matplotlib-cheatsheet</li> <li>macOS Catalina 10.15 beta 6 \u53d1\u5e03</li> <li>Flash Decompiler https://github.com/jindrapetrik/jpexs-decompiler</li> <li>Yubikey \u53d1\u5e03 5Ci https://readhacker.news/s/489yu</li> <li>IBM \u5f00\u653e Power \u6307\u4ee4\u96c6 https://readhacker.news/s/48aiH</li> <li>iOS 13 beta 8 \u53d1\u5e03</li> <li>GitHub \u652f\u6301 WebAuthn https://readhacker.news/s/48dXM</li> <li>\u7f16\u8bd1\u5668\u4f18\u5316\u5e26\u6765\u7684\u5b89\u5168\u6f0f\u6d1e https://readhacker.news/s/48dke</li> <li>obscure C features https://multun.net/obscure-c-features.html</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/08/30/weekly-sharing-39/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 39 \u671f","text":"<ol> <li>\u53e6\u4e00\u4e2a Pattern Matching in C++ \u5e93 https://github.com/mpark/patterns</li> <li>Rust \u7f16\u5199\u7684\u4e00\u4e2a shell http://www.jonathanturner.org/2019/08/introducing-nushell.html</li> <li>Vim \u7684\u6e38\u620f\u6559\u7a0b https://readhacker.news/s/48nbJ</li> <li>\u5728 throw \u7684\u65f6\u5019\u540c\u65f6\u6293\u53d6 SO \u4fe1\u606f https://github.com/shobrook/rebound/</li> <li>\u989c\u8272\u751f\u6210\u5de5\u5177 https://github.com/sharkdp/pastel</li> <li>\u8f6c\u6362 Escape Code \u5230 HTML https://github.com/theZiz/aha</li> <li>iOS 13.1 beta \u53d1\u5e03</li> <li>\u82f9\u679c\u7279\u522b\u6d3b\u52a8\u5b9a\u4e8e 9.11 \u65e5</li> <li>exFAT \u89c4\u8303\u53d1\u5e03 http://www.phoronix.com/scan.php?page=news_item&amp;px=Microsoft-exFAT-Specification</li> <li>\u53ef\u89c6\u5316\u7684 5 \u9636\u6bb5\u6d41\u6c34\u7ebf RISC-V \u6a21\u62df\u5668 https://github.com/mortbopet/Ripes</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2018/12/29/weekly-sharing-4/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 4 \u671f","text":"<p>\u5495\u4e86\u66f4\u957f\u7684\u65f6\u95f4\u3002</p> <ol> <li>Header only JIT assembler https://github.com/herumi/xbyak \u60f3\u627e\u4e2a\u65f6\u95f4\u73a9\u73a9 JIT</li> <li>Rust \u5b9e\u73b0\u7684 Babel \u8f6c\u8bd1 https://github.com/swc-project/swc</li> <li>\u53c8\u4e00\u4e2a\u7011\u5e03\u6d41\u5b9e\u73b0 https://github.com/e-oj/Magic-Grid</li> <li>\u9a6c\u4e0a\u53ef\u4ee5\u4f53\u9a8c HTTP/3 \u7684\u5e93 https://github.com/djc/quinn</li> <li>Logitech Spotlight Presentation \u633a\u597d\u7528\u7684 \u914d\u5957\u8f6f\u4ef6\u7684\u5b89\u88c5\u8fc7\u7a0b\u548c\u4f7f\u7528\u90fd\u633a\u597d\u7684</li> <li>Server side canvas https://github.com/Automattic/node-canvas</li> <li>\u8fb9\u770b youtube tutorial \u8fb9\u5199\u4ee3\u7801 https://yourepl.tumblr.com/post/180936303347/announcing-yourepl</li> <li>\u53c8\u4e00\u4e2a PostgreSQL \u7f51\u9875\u7248\u5ba2\u6237\u7aef https://github.com/sosedoff/pgweb</li> <li>\u6709\u8da3\u7684 CSS Layout \u5b66\u4e60\u65b9\u6cd5 http://cssgridgarden.com/#en http://flexboxfroggy.com/</li> <li>pipenv \u4e5f\u6709\u8fc7 easter egg https://github.com/pypa/pipenv/issues/786 \u4e0d\u8fc7\u5f71\u6bd4 antd \u8fd9\u4e2a\u4e8b\u60c5\u597d\u591a\u4e86</li> <li>Web \u592a\u5f3a\u4e86 \u5565\u90fd\u80fd\u505a https://whatwebcando.today/</li> <li>\u6765\u81ea\u5a04\u6668\u8000\u7684\u6e05\u771f DNS \u89e3\u51b3\u65b9\u6848 https://github.com/Chenyao2333/freedns-go</li> <li>\u5feb\u901f\u7684 tldr \u5b9e\u73b0 https://github.com/dbrgn/tealdeer</li> <li>MongoDB Data Source for Grafana \u53ef\u4ee5\u7528 \u5c31\u662f aggregation \u4e0d\u5927\u5bb9\u6613\u5199\u5bf9 https://github.com/JamesOsgood/mongodb-grafana</li> <li>Fish 3.0 \u53d1\u5e03\u201cfish now supports &amp;&amp; (like and), || (like or), and ! (like not), for better migration from POSIX-compliant shells (#4620).\u201d</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/09/06/weekly-sharing-40/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 40 \u671f","text":"<ol> <li>TeX Typesetting Game https://texnique.xyz/</li> <li>Writing Linux Kernel Module in Rust https://github.com/fishinabarrel/linux-kernel-module-rust</li> <li>Sipeed Longan Nano RISC-V \u5f00\u53d1\u677f https://readhacker.news/s/48EBG</li> <li>Systemd \u52a0\u8f7d BPF \u9632\u706b\u5899 https://kailueke.gitlab.io/systemd-bpf-firewall-loader/</li> <li>\u65b9\u821f\u7f16\u8bd1\u5668 https://code.opensource.huaweicloud.com/HarmonyOS/OpenArkCompiler.git</li> <li>XLOOKUP \u51fd\u6570 https://techcommunity.microsoft.com/t5/Excel-Blog/Announcing-XLOOKUP/ba-p/811376</li> <li>SystemVerilog to Verilog \u8f6c\u8bd1 https://github.com/zachjs/sv2v</li> <li>USB 4.0 \u53d1\u5e03 http://www.phoronix.com/scan.php?page=news_item&amp;px=USB-4.0-Specification-Published</li> <li>Android 10 \u53d1\u5e03 http://www.phoronix.com/scan.php?page=news_item&amp;px=Android-10-Released</li> <li>iOS 13.1 beta 2 \u53d1\u5e03</li> <li>\u5bf9 iOS \u8bbe\u5907\u6293\u5305 http://blog.imaou.com/opensource/2014/12/14/pcapd_diagnostic_packet_capture.html</li> <li>Google \u7684\u5dee\u5206\u9690\u79c1\u5e93 https://developers.googleblog.com/2019/09/enabling-developers-and-organizations.html</li> <li>Apple Music \u7b2c\u4e09\u65b9 App https://github.com/Musish/Musish</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/09/14/weekly-sharing-41/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 41 \u671f","text":"<ol> <li>Wget2 1.99.2 beta \u53d1\u5e03 https://lists.gnu.org/archive/html/info-gnu/2019-09/msg00001.html</li> <li>\u72ec\u7acb\u7684 printf \u5b9e\u73b0 https://github.com/mpaland/printf</li> <li>Unicode \u5b57\u7b26\u4e32\u957f\u5ea6\u7edf\u8ba1 https://hsivonen.fi/string-length/</li> <li>C \u7c7b\u578b\u63a8\u65ad https://github.com/ltcmelo/psychec#generic-programming</li> <li>Clang 9.0 \u652f\u6301 Linux \u5185\u6838\u7f16\u8bd1 The New Features Of LLVM 9.0 &amp; Clang 9.0 - Includes Building The Linux x86_64 Kernel</li> <li>\u53ef\u63a7\u5236\u7684 USB \u8bbe\u5907 https://github.com/usb-tools/Facedancer</li> <li>USB \u76d1\u542c\u5668 https://github.com/openvizsla/ov_ftdi</li> <li>\u4fee\u590d\u4e00\u4e2a\u622a\u65ad\u7684\u89c6\u9891 https://github.com/ponchio/untrunc</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/09/21/weekly-sharing-42/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 42 \u671f","text":"<ol> <li>Dart 2.5 \u53d1\u5e03</li> <li>Rust USB device \u5e93 https://github.com/mvirkkunen/usb-device</li> <li>\u540c\u6b65\u89c6\u9891\u7684 timecode https://github.com/cnbeining/autotimecode</li> <li>xv6 \u4eca\u5e74\u6362\u5230\u4e86 riscv https://github.com/mit-pdos/xv6-riscv-fall19</li> <li>pdf \u6587\u672c\u641c\u7d22 https://pdfgrep.org/</li> <li>iOS 13 \u6b63\u5f0f\u7248\u53d1\u5e03</li> <li>exFAT \u9a71\u52a8\u8fdb\u5165 Linux 5.4 Microsoft exFAT File-System Mailed In For Linux 5.4 Along With Promoted EROFS &amp; Greybus</li> <li>Bash \u8be6\u7ec6\u6559\u7a0b https://github.com/dylanaraps/pure-bash-bible</li> <li>Rust \u7f16\u8bd1\u5230 iOS bitcode https://github.com/getditto/rust-bitcode</li> <li>JS \u8fd0\u884c\u65f6\u95f4 in V8 https://v8.dev/blog/cost-of-javascript-2019#json</li> <li>USB3.0 PIPE \u63a5\u53e3\u5b9e\u73b0 https://github.com/enjoy-digital/usb3_pipe</li> <li>LLVM 9.0 \u53d1\u5e03 https://lists.llvm.org/pipermail/llvm-dev/2019-September/135304.html</li> <li>Safari 13.0 \u53d1\u5e03</li> <li>Rust \u6a21\u677f\u5f15\u64ce https://github.com/botika/yarte</li> <li>systemd \u5f00\u59cb\u638c\u63e1 home \u76ee\u5f55 https://www.phoronix.com/scan.php?page=news_item&amp;px=systemd-homed</li> <li>\u547d\u4ee4\u884c\u7684 cheatsheet \u5de5\u5177 https://github.com/denisidoro/navi</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/09/28/weekly-sharing-43/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 43 \u671f","text":"<ol> <li>Async in C https://github.com/naasking/async.h</li> <li>Mozilla \u7684 QUIC \u5b9e\u73b0 https://github.com/mozilla/neqo/</li> <li>\u5728 PCI \u4e0a\u505a\u7684\u653b\u51fb https://github.com/ufrisk/pcileech</li> <li>\u5bf9 X \u7684\u539f\u7406\u4ecb\u7ecd https://magcius.github.io/xplain/article/index.html</li> <li>Ethernet \u7269\u7406\u5c42\u7684\u4ecb\u7ecd https://www.analog.com/media/en/technical-documentation/application-notes/EE-269.pdf</li> <li>Overleaf \u66f4\u65b0\u4e86 TeX Live \u7248\u672c https://www.overleaf.com/blog/tex-live-upgrade-september-2019</li> <li>\u4e0b\u4e00\u4ee3 proc macro\uff1fhttps://github.com/alexcrichton/proc-macro2</li> <li>iOS 13 API \u53d8\u5316 https://nshipster.com/ios-13/</li> <li>iOS 13.1.1 \u53d1\u5e03</li> <li>Rust \u7f16\u8bd1\u671f HashMap https://github.com/sfackler/rust-phf</li> <li>V8 \u52a0\u5165\u9876\u5c42 Await \u652f\u6301 https://chromium.googlesource.com/v8/v8.git/+/0ceee9ad28c21bc4971fb237cf87eb742fc787b8%5E%21/</li> <li>ASCII \u7801\u8868\u7684\u4e00\u79cd\u7406\u89e3 https://garbagecollected.org/2017/01/31/four-column-ascii/</li> <li>Cloudflare \u542f\u7528 HTTP/3 https://blog.cloudflare.com/http3-the-past-present-and-future/</li> <li>ZFS \u53d1\u5e03 0.8.2 https://github.com/zfsonlinux/zfs/releases/tag/zfs-0.8.2</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/10/04/weekly-sharing-44/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 44 \u671f","text":"<ol> <li> <p>Modern Script Loading https://jasonformat.com/modern-script-loading/</p> </li> <li> <p>\u5982\u4f55\u5b9e\u73b0 closure http://craftinginterpreters.com/closures.html</p> </li> <li> <p>\u52a0\u901f uniform_int_distribution \u5b9e\u73b0 https://lemire.me/blog/2019/09/28/doubling-the-speed-of-stduniform_int_distribution-in-the-gnu-c-library/</p> </li> <li> <p>\u5728 FPGA \u4e0a\u8fd0\u884c Rocket Chip \u6559\u7a0b https://github.com/cnrv/fpga-rocket-chip</p> </li> <li> <p>Xilinx Bitstream \u9006\u5411 https://prjxray.readthedocs.io/en/latest/</p> </li> <li> <p>JVM \u5229\u7528 SIGSEGV \u8fdb\u884c null \u68c0\u6d4b https://jcdav.is/2015/10/06/SIGSEGV-as-control-flow/</p> </li> <li> <p>Async/Await \u8fdb\u5165 Rust Beta https://blog.rust-lang.org/2019/09/30/Async-await-hits-beta.html</p> </li> <li> <p>\u5728 Rust \u91cc\u5b9e\u73b0 Plugin http://adventures.michaelfbryan.com/posts/plugins-in-rust/</p> </li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/10/11/weekly-sharing-45/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 45 \u671f","text":"<ol> <li>Android ARM32/64 \u73af\u5883\u6a21\u62df https://github.com/zhkl0228/unidbg</li> <li>Calibre 4.0 https://readhacker.news/s/4aukk</li> <li>Rust \u7684 gRPC \u5b9e\u73b0 https://github.com/hyperium/tonic</li> <li>JAVA API \u5386\u53f2 https://github.com/marchof/java-almanac</li> <li>Elm \u5f00\u53d1 dev server https://github.com/wking-io/elm-live</li> <li>\u53e6\u4e00\u4e2a\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668 https://github.com/getzola/zola</li> <li>Catalina \u53d1\u5e03</li> <li>Notarization \u7684\u76f8\u5173\u60c5\u51b5 https://eclecticlight.co/2019/06/07/notarization-in-mojave-and-catalina/ https://eclecticlight.co/2019/05/31/can-you-tell-whether-code-has-been-notarized/</li> <li>\u692d\u5706\u66f2\u7ebf\u52a0\u5bc6\u7b97\u6cd5 https://fangpenlin.com/posts/2019/10/07/elliptic-curve-cryptography-explained/</li> <li>Travis CI \u6dfb\u52a0 ARM \u652f\u6301 https://blog.travis-ci.com/2019-10-07-multi-cpu-architecture-support</li> <li>CD \u4e0a\u7684\u7ed3\u6784 https://readhacker.news/s/4aDHB</li> <li>\u5728\u7ebf TAC \u7684\u865a\u62df\u673a https://jia.je/online_tac_vm/</li> <li>\u5728\u7ebf Decaf \u7f16\u8bd1\u548c\u8fd0\u884c https://jia.je/online_decaf/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/10/19/weekly-sharing-46/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 46 \u671f","text":"<ol> <li>LibC++ \u6b63\u5f0f\u652f\u6301 WASI https://releases.llvm.org/9.0.0/projects/libcxx/docs/ReleaseNotes.html</li> <li>\u4ece\u6587\u672c\u53cd\u63a8 regex https://github.com/pemistahl/grex</li> <li>KDE 5.17 \u53d1\u5e03 https://www.omgubuntu.co.uk/2019/10/kde-plasma-5-17-features</li> <li>IDA 7.4 \u53d1\u5e03 \u652f\u6301 Py3 https://www.hex-rays.com/products/ida/7.4/index.shtml</li> <li>\u65b0\u7684 CPU Bug https://www.phoronix.com/scan.php?page=news_item&amp;px=Chrome-Geminilake-Bug</li> <li>WAST -&gt; WASM in Rust https://docs.rs/wast/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/10/26/weekly-sharing-47/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 47 \u671f","text":"<ol> <li>CLion \u5b8c\u5584\u4e86 Rust \u8c03\u8bd5\u652f\u6301 https://blog.jetbrains.com/clion/2019/10/debugging-rust-code-in-clion/</li> <li>Nginx HTTP3 \u7684 docker \u955c\u50cf https://github.com/RanadeepPolavarapu/docker-nginx-http3</li> <li>\u624b\u7b97 Ed25519 https://dang.fan/zh-Hans/posts/25519</li> <li>Rust \u7684 QuickCheck https://github.com/BurntSushi/quickcheck</li> <li>Rust \u53e6\u4e00\u4e2a\u7c7b\u4f3c QuickCheck \u7684\u6d4b\u8bd5\u6846\u67b6 https://github.com/AltSysrq/proptest</li> <li>Cookie \u7b56\u7565\u8981\u6539\u4e86 https://readhacker.news/s/4bvGG</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/11/03/weekly-sharing-48/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 48 \u671f","text":"<ol> <li>\u4e00\u4e2a\u7279\u6b8a\u7684\u7528\u4e8e\u663e\u793a\u6570\u5b57\u7684\u5b57\u4f53 https://blog.janestreet.com/commas-in-big-numbers-everywhere/</li> <li>Intel \u7684 SPMD \u7f16\u8bd1\u5668 https://ispc.github.io/</li> <li>\u57fa\u4e8e Scala \u7684 notebook https://polynote.org/</li> <li>\u89e3\u6790\u767b\u673a\u724c\u4fe1\u606f https://github.com/georgesmith46/bcbp</li> <li>\u5e38\u7528\u7684 React Hooks \u5e93 https://github.com/streamich/react-use</li> <li>jwt \u5de5\u5177 https://github.com/mike-engel/jwt-cli</li> <li>\u7528\u8fc7\u7a0b\u5b8f\u5b9e\u73b0\u7684 delegation in Rust https://github.com/chancancode/rust-delegate</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/11/11/weekly-sharing-49/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 49 \u671f","text":"<ol> <li> <p>libuv wrapper in C++ https://github.com/skypjack/uvw</p> </li> <li> <p>Visual Studio Online https://visualstudio.microsoft.com/zh-hans/services/visual-studio-online/</p> </li> <li> <p>OpenSSH \u7684 U2F \u652f\u6301 https://readhacker.news/s/4carE</p> </li> <li> <p>Rust 1.39 Rust 1.39 Released With Async-Await Support, Attributes On Function Parameters</p> </li> <li> <p>Windows \u4e5f\u5728\u7528 Rust https://msrc-blog.microsoft.com/2019/11/07/using-rust-in-windows/</p> </li> <li> <p>\u7528 Chrome Dev Tools \u8c03\u8bd5 Rust https://twitter.com/ChromeDevTools/status/1192803818024710145</p> </li> <li> <p>C++20 \u7684\u65b0 Thread \u7c7b\u578b https://medium.com/@vgasparyan1995/a-new-thread-in-c-20-jthread-ebd121ae8906</p> </li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/01/04/weekly-sharing-5/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 5 \u671f","text":"<p>2019 \u5e74\u7b2c\u4e00\u7bc7\u535a\u6587\uff0c\u795d\u5927\u5bb6\u65b0\u5e74\u5feb\u4e50\u3002\u6700\u8fd1\u5fd9\u4e8e\u671f\u672b\uff0c\u6ca1\u600e\u4e48\u641e\u4e8b\u60c5\uff0c\u6240\u4ee5\u6682\u65f6\u6ca1\u6709\u5173\u4e8e\u522b\u7684\u5185\u5bb9\u7684\u535a\u6587\u3002</p> <ol> <li>\u53d1\u73b0\u4e00\u4e2a\u5f88\u597d\u770b\u7684 http web server index \u5c31\u662f\u4e0d\u518d\u66f4\u65b0\u4e86 h5ai</li> <li>\u5f55\u5236 DOM \u53d8\u5316\u5e76\u4e14\u91cd\u653e rrweb</li> <li>C++ \u4e2d\u7684 Lazy Sequence \u5b9e\u73b0 lazyCode</li> <li>\u6765\u81ea Berrysoft \u7684 Windows UWP \u6821\u56ed\u7f51\u8ba4\u8bc1\u89e3\u51b3\u65b9\u6848 TsinghuaNetUWP</li> <li>\u4e2d\u79d1\u5927\u8001\u8fd0\u7ef4\u7684\u7b14\u8bb0 ITTS</li> <li>Go \u6e90\u7801\u7814\u7a76\u7535\u5b50\u4e66 \u76ee\u6d4b\u8fd8\u5728\u7f16\u5199\uff0c\u4e0d\u8fc7\u8bfb\u6765\u633a\u6709\u6536\u83b7\u7684 go-under-the-hood</li> <li>\u7b2c\u4e00\u6b21\u4e86\u89e3\u5230 ELF Aux Vectors auxv</li> <li>\u53d1\u73b0\u4e86 C99 \u7684\u53c2\u6570\u5217\u8868\u91cc static \u6570\u7ec4\u5927\u5c0f\u8bed\u6cd5 static array indicies</li> <li>\u53d1\u73b0\u4e00\u4e2a\u6709\u8da3\u7684\u5305\u88c5\u4e86 socket \u7684\u6d88\u606f\u5e93 \u652f\u6301\u4e00\u4e9b\u6d88\u606f\u5206\u53d1\u65b9\u6cd5 nanomsg</li> <li>\u627e\u5230\u4e00\u4e2a\u53ef\u89c6\u5316 YUV \u548c\u89c6\u9891\u89e3\u7801\u7684\u4e00\u4e9b\u5185\u90e8\u4fe1\u606f\u7684\u5de5\u5177 YUVView</li> <li>\u901a\u8fc7\u52a8\u6001 QRCode \u4f20\u8f93\u6570\u636e txqr qr-transfer</li> <li>\u53d1\u73b0\u4e00\u4e9b\u5f88\u597d\u770b\u7684 CSS \u52a8\u753b 10-stunning-css-3d-effect-must-see \u5176\u4e2d\u6700\u795e\u5947\u4e5f\u6700\u590d\u6742\u7684\u662f \u8fd9\u4e2a</li> <li>Android runtime \u4e2d\u52a8\u6001\u83b7\u53d6\u6743\u9650\u7684\u5e93 Dexter</li> <li>\u6765\u81ea Berrysoft \u7684 Stream operators in C++ CppLinq</li> <li>Squirrel (Rime for macOS) \u5728\u4e24\u5e74\u4ee5\u540e\u7ec8\u4e8e\u51fa\u4e86 0.10.0 \u65b0\u7248\u672c \u6709\u4e86\u597d\u770b\u7684\u65b0\u76ae\u80a4</li> <li>\u795e\u5947\u7684 v8 \u6f0f\u6d1e\u5229\u7528 \u5b9e\u5728\u662f\u592a\u590d\u6742\u4e86 exploting math expm1 in v8</li> <li>JWT How-to \u53d1\u73b0 Koa \u548c Flask \u7684 session \u9ed8\u8ba4\u5b9e\u73b0\u4e5f\u662f\u540c\u6837\u7684\u539f\u7406 learn-json-web-tokens</li> <li>\u914d\u7f6e DNS CAA \u7684\u5728\u7ebf\u5de5\u5177 \u9650\u5236 CA \u7b7e\u8bc1\u4e66\u7684\u65b9\u6848 sslmate caa</li> <li>\u53c8\u4e00\u4e2a Python \u7684 Parser \u5e93 \u914d\u5408\u6709\u8da3\u7684 decorator \u8bed\u6cd5 sly</li> <li>\u81ea\u52a8\u914d\u7f6e webpack \u7684\u5e93 Jetpack jetpack</li> <li>eBPF tutorial learn ebpf tracing</li> <li>\u56fe\u7247 xkcd-ify \u592a\u6709\u8da3\u4e86 xkcd-style plots</li> <li>\u53c8\u4e00\u4e2a Vue \u7684 rich text \u63a7\u4ef6 tiptap</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/11/17/weekly-sharing-50/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 50 \u671f","text":"<p>\u65f6\u95f4\u8fc7\u5f97\u771f\u5feb\uff0c\u5ffd\u7136\u5c31 50 \u671f\u4e86\u3002\u3002</p> <ol> <li>CLion \u7684 C++20 Concept \u652f\u6301 https://blog.jetbrains.com/clion/2019/11/cpp20-concepts-in-clion/</li> <li>TypeScript \u4e00\u4e9b\u5de5\u5177 https://github.com/pirix-gh/ts-toolbelt</li> <li>Rust \u7f16\u5199\u7684 SystemVerilog Parser https://github.com/dalance/sv-parser</li> <li>MacBookPro 16 \u82f1\u5bf8 \u53d1\u5e03</li> <li>\u7528 Rust \u5199 eBPF \u7a0b\u5e8f https://blog.redsift.com/labs/putting-rust-in-the-kernel-with-ebpf/</li> <li>\u7ec8\u7aef\u91cc\u73a9\u8718\u86db\u7eb8\u724c https://github.com/chrisbouchard/klondike-rs</li> <li>Rust \u7684 coverage \u5de5\u5177 https://github.com/mozilla/grcov</li> <li>\u5728 Menu Bar \u6216\u8005 Touch Bar \u63a7\u5236 AirPods Pro \u6a21\u5f0f https://github.com/insidegui/NoiseBuddy</li> <li>Demangle Rust \u7b26\u53f7\u7684\u5de5\u5177 https://github.com/luser/rustfilt</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/11/24/weekly-sharing-51/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 51 \u671f","text":"<ol> <li> <p>\u4e00\u4e2a LaTeX \u7684 LSP https://github.com/latex-lsp/texlab</p> </li> <li> <p>Rope \u6570\u636e\u7ed3\u6784 https://github.com/cessen/ropey</p> </li> <li> <p>\u4e00\u4e2a\u628a Vivado \u5de5\u7a0b\u653e git \u4e2d\u7ba1\u7406\u7684\u65b9\u6cd5 https://github.com/jhallen/vivado_setup</p> </li> <li> <p>https://github.com/athre0z/color-backtrace</p> </li> <li> <p>\u62ff Arch \u5f53\u8def\u7531\u5668 https://github.com/archwrt</p> </li> <li> <p>Sourcetrail \u5f00\u6e90\u4e86 https://www.sourcetrail.com/blog/open_source/</p> </li> <li> <p>NodeJS \u6b63\u5f0f\u652f\u6301 ES Module https://medium.com/@nodejs/announcing-core-node-js-support-for-ecmascript-modules-c5d6dc29b663</p> </li> <li> <p>Rust \u7684\u9519\u8bef\u5904\u7406 https://blog.yoshuawuyts.com/error-handling-survey/</p> </li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/12/01/weekly-sharing-52/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 52 \u671f","text":"<ol> <li> <p>\u4f20\u9012 Rust \u95ed\u5305\u5230 C https://readhacker.news/s/4dbWL</p> </li> <li> <p>SystemVerilog Online http://sv-lang.com/</p> </li> <li> <p>Java 14 \u65b0\u7279\u6027 https://www.javaworld.com/article/3437797/work-begins-on-java-14.html</p> </li> <li> <p>\u5728\u7ebf or1k \u7684\u6a21\u62df\u5668 https://readhacker.news/s/4dfqc</p> </li> <li> <p>\u5728 macOS \u4e0a\u8fd0\u884c virt-manager https://github.com/jeffreywildman/homebrew-virt-manager</p> </li> <li> <p>\u5173\u4e8e SystemVerilog \u7684\u535a\u5ba2 http://systemverilog.io/</p> </li> <li> <p>\u7ed3\u5408 VSCode \u548c Docker \u7684\u5f00\u53d1\u73af\u5883 https://github.com/cdr/sail</p> </li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/12/08/weekly-sharing-53/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 53 \u671f","text":"<ol> <li>GDB Enhanced Features https://github.com/hugsy/gef</li> <li>Lisp on Lua https://fennel-lang.org/</li> <li>Django 3.0 https://docs.djangoproject.com/en/3.0/releases/3.0/</li> <li>Rust Constant Propagation https://blog.rust-lang.org/inside-rust/2019/12/02/const-prop-on-by-default.html</li> <li>ES2019 features https://javascript.christmas/2019/7</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/12/27/weekly-sharing-54/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 54 \u671f","text":"<p>\u5495\u4e86\u4e24\u5468</p> <ol> <li>ES2019 https://javascript.christmas/2019/7</li> <li>CSS \u6280\u5de7 https://github.com/chokcoco/iCSS</li> <li>Rust \u7f16\u8bd1\u5668\u52a0\u901f https://blog.mozilla.org/nnethercote/2019/12/11/how-to-speed-up-the-rust-compiler-one-last-time-in-2019/</li> <li>OSXFuse \u4e0d\u5f00\u6e90 https://colatkinson.site/macos/fuse/2019/09/29/osxfuse/</li> <li>\u5d4c\u5165\u5f0f Rust \u7684 fmt \u4f18\u5316 https://jamesmunns.com/blog/fmt-unreasonably-expensive/</li> <li>Docker base image \u66f4\u65b0\u5de5\u5177 https://github.com/containrrr/watchtower</li> <li>\u8fd0\u884c Linux \u7684\u540d\u7247 https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2020/01/31/weekly-sharing-55/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 55 \u671f","text":"<p>\u4e00\u4e2a\u6708\u540e\u7ec8\u4e8e\u590d\u66f4</p> <ol> <li>\u9000\u51fa vim \u6559\u7a0b https://github.com/hakluke/how-to-exit-vim</li> <li>SHA-1 \u653b\u51fb\u65b0\u8fdb\u5c55 https://sha-mbles.github.io/</li> <li>gmane \u8fd1\u51b5 https://lars.ingebrigtsen.no/2020/01/06/whatever-happened-to-news-gmane-org/</li> <li>\u6d4f\u89c8\u5668\u80fd\u505a\u7684\u4e8b\u60c5 https://github.com/luruke/browser-2020</li> <li>\u4e00\u4e2a ext2 \u548c FAT \u4e3a\u4e00\u4f53\u7684 fs https://github.com/NieDzejkob/cursedfs</li> <li>iptables \u89c4\u5219\u8c03\u8bd5\u5de5\u5177 https://github.com/x-way/iptables-tracer</li> <li>Qt 2020 \u7684\u53d8\u5316 https://www.qt.io/blog/qt-offering-changes-2020</li> <li>\u540e\u7f00\u81ea\u52a8\u673a\u53ef\u89c6\u5316 https://yeah.moe/p/a8e74947/</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2020/02/28/weekly-sharing-56/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 56 \u671f","text":"<p>\u5495\u5495\u5495</p> <ol> <li>SystemVerilog linter https://github.com/dalance/svlint</li> <li>\u4e1c\u5317\u65b9\u8a00\u7f16\u7a0b\u8bed\u8a00 https://github.com/zhanyong-wan/dongbei</li> <li>JS LaTeX \u6e32\u67d3\u5230 HTML https://github.com/michael-brade/LaTeX.js</li> <li>\u4e00\u79cd\u5bf9\u8bed\u97f3\u52a9\u624b\u7684\u653b\u51fb https://surfingattack.github.io/</li> <li>\u5728\u7ebf\u6253\u94c3\u7f51\u7ad9 http://thulpwan.net/timer/</li> <li>\u7f51\u7edc\u5b66\u5802 PC \u7aef App https://github.com/jiegec/learn_tsinghua_app/releases</li> <li>Rust 2020 roadmap https://github.com/rust-lang/rfcs/pull/2857/files</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/01/11/weekly-sharing-6/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 6 \u671f","text":"<p>\u4eca\u5929\u521a\u8fc1\u79fb\u4e86\u57df\u540d\u5230 jiege.ch\uff0c\u539f\u6765\u7684 jiegec.me \u4f1a\u81ea\u52a8\u8df3\u8f6c\u8fc7\u6765\uff0c\u94fe\u63a5\u4ec0\u4e48\u7684\u90fd\u4e0d\u7528\u53d8\u3002</p> <ol> <li>Rust \u7684 cfg! \u5b8f\u53ea\u662f\u8fd4\u56de bool \u800c\u4e0d\u4f1a\u5f71\u54cd\u5185\u90e8\u662f\u5426\u88ab\u7f16\u8bd1 \u5982\u679c\u9700\u8981 if constexpr \u7684\u6548\u679c\u9700\u8981\u7528 cfg-if</li> <li>\u57fa\u4e8e HTML5 canvas \u7684\u56fe\u8868\u5e93 Chart.js</li> <li>Endianness MATTERS! -- Harry Chen</li> <li>\u5404\u6570\u636e\u5e93\u7684\u5e26\u8865\u5168\u7684 CLI https://www.dbcli.com/</li> <li>\u8fb9\u5f00\u53d1\u8fb9\u6d4b\u8bd5 k8s \u90e8\u7f72 tilt</li> <li>Github unlimited free private repos \u4e8e\u662f\u79f0\u4e3a\u4e86 PRO \u7528\u6237 https://blog.github.com/2019-01-07-new-year-new-github/</li> <li>Github \u7f8e\u98df\u535a\u4e3b\u8fd8\u884c https://github.com/hendricius/pizza-dough</li> <li>\u4e00\u4e2a\u7528\u4e8e\u672c\u5730\u5316\u7684\u5e93 https://github.com/dustin/go-humanize</li> <li>Vim Verilog \u8865\u5168 https://github.com/vhda/verilog_systemverilog.vim</li> <li>homebridge \u7f51\u9875\u524d\u7aef https://github.com/oznu/homebridge-config-ui-x</li> <li>Zigbee 2 MQTT Bridge \u9700\u8981\u989d\u5916\u7684\u8bbe\u5907 https://github.com/Koenkk/zigbee2mqtt</li> <li>gdb \u7684\u7f51\u9875 gui https://github.com/cs01/gdbgui</li> <li>Rust \u4e00\u952e par iter https://github.com/rayon-rs/rayon</li> <li>\u633a\u597d\u770b\u7684 hex viewer https://github.com/sharkdp/hexyl \u53ef\u4ee5\u914d\u5408 bat \u6eda\u5c4f</li> <li>gitalk \u57fa\u4e8e Github issues \u7684\u8bc4\u8bba\u7cfb\u7edf \u7c7b\u4f3c Disqus https://github.com/gitalk/gitalk</li> <li>\u6839\u636e\u84dd\u7259\u8fde\u63a5\u952e\u76d8\u4e0e\u5426\u6539\u53d8\u952e\u76d8\u5e03\u5c40 https://github.com/jwilm/alacritty/wiki/Automatic-MacOS-Keyboard-layout-change-for-Bluetooth</li> <li>8.8.8.8 \u52a0\u5165 DoT \u5bb6\u5ead https://security.googleblog.com/2019/01/google-public-dns-now-supports-dns-over.html</li> <li>\u6062\u590d\u635f\u574f\u7684 QRCode \u5de5\u5177\u7bb1 https://merricx.github.io/qrazybox/</li> <li>\u901a\u8fc7\u540c\u65f6\u4fee\u6539\u4e24\u4e2a\u82af\u7247\u7684 PLL \u8fbe\u6210\u4e86\u975e\u6807\u51c6\u7684 Wi-Fi \u901a\u4fe1\u8fd8\u884c https://hackaday.com/2019/01/04/underclocking-the-esp8266-leads-to-wifi-weirdness/</li> <li>inline x86 asm in go https://github.com/mmcloughlin/avo#readme</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/01/18/weekly-sharing-7/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 7 \u671f","text":"<p>\u8fd9\u5468\u6bd4\u8f83\u5fd9\uff0c\u6240\u4ee5\u5185\u5bb9\u4e0d\u591a\u3002</p> <ol> <li>\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u91cc\u8dd1 Lisp \u53ef\u4ee5\u5728\u4e32\u53e3\u5f00\u4e2a repl \u5728\u7ebf\u8c03\u8bd5 http://www.ulisp.com/show?3J</li> <li>Pattern matching for C++ https://github.com/solodon4/Mach7</li> <li>\u4e00\u4e2a\u5546\u4e1a\u7248\u7684\u7c7b\u4f3c ASan \u7684\u4ea7\u54c1 \u4e0d\u77e5\u9053\u6548\u679c\u5982\u4f55 https://stensal.com/</li> <li>\u7528 Python \u5199 Cocoa \u754c\u9762\u8fd8\u884c https://dawes.wordpress.com/2017/08/17/python-with-a-cocoa-gui-on-macos/</li> <li>Rust \u5b9e\u73b0\u7684\u6743\u5a01\u641c\u7d22\u5f15\u64ce https://github.com/toshi-search/Toshi</li> <li>Rust Embedonomicon \u8bb2\u8ff0 Rust \u5728 bare metal \u4e0b\u7684\u4e00\u4e9b\u795e\u5947\u64cd\u4f5c https://docs.rust-embedded.org/embedonomicon/preface.html</li> <li>\u53d1\u73b0\u53e6\u4e00\u4e2a\u57fa\u4e8e Github \u7684 Disqus \u66ff\u4ee3\u54c1 https://utteranc.es/</li> <li>\u633a\u597d\u7684\u4e00\u90e8\u8bb2 Rust \u751f\u547d\u5468\u671f\u7684\u5c0f\u4e66 http://cglab.ca/~abeinges/blah/too-many-lists/book/README.html</li> <li>\u8de8\u5e73\u53f0\u7684 Ctrl-C \u5904\u7406 for Rust https://github.com/Detegr/rust-ctrlc</li> <li>\u7528 Rust \u5199 stm32 \u4e0a\u7a0b\u5e8f\u6240\u9700\u8981\u7684\u5e93 https://github.com/stm32-rs/stm32-rs</li> <li>go \u8bed\u8a00\u7f16\u5199\u7684\u57fa\u4e8e fuse \u7684\u52a0\u5bc6\u6587\u4ef6\u7cfb\u7edf https://github.com/rfjakob/gocryptfs</li> <li>Rust \u7684\u56fe\u7247\u89e3\u6790\u5e93 https://github.com/PistonDevelopers/image</li> <li>\u7528 BPF \u505a API \u89e3\u6790\u548c\u8fc7\u6ee4 https://github.com/cilium/cilium</li> <li>\u5b66\u5230\u4e86 x86 \u53c8\u4e00\u4e2a\u6307\u4ee4\u96c6 bmi2 https://github.com/jordanbray/chess</li> <li>FoundationDB \u63a8\u51fa Record Layer \u540d\u5b57\u5341\u5206\u8d34\u5207 https://github.com/foundationdb/fdb-record-layer/</li> <li>\u4e00\u4e2a\u5f00\u6e90\u7684\u6559\u5ba4\u7535\u8111\u76d1\u63a7\u7cfb\u7edf https://github.com/veyon/veyon</li> <li>DNS flag day https://dnsflagday.net/</li> <li>Rust stable 1.32.0 \u53d1\u5e03 https://blog.rust-lang.org/2019/01/17/Rust-1.32.0.html dbg \u5b8f\u597d\u8bc4</li> <li>\u5404 MacBook \u7684 Linux \u652f\u6301\u60c5\u51b5\u4e00\u89c8 https://github.com/Dunedan/mbp-2016-linux</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/01/25/weekly-sharing-8/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 8 \u671f","text":"<p>\u8fd9\u5468\u66f4\u52a0\u5fd9\u4e86\uff0c\u6240\u4ee5\u5185\u5bb9\u4e0d\u591a\u3002</p> <ol> <li>Rust 1.32.0 is out \u5176\u4e2d dbg macro \u633a\u6709\u610f\u601d https://blog.rust-lang.org/2019/01/17/Rust-1.32.0.html</li> <li>\u5728\u7ebf\u7684 hex packet decoder https://hpd.gasmi.net/</li> <li>Rust Cheatsheet https://www.breakdown-notes.com/make/load/rust_cs_canvas/true</li> <li>Rust tcp/ip stack https://github.com/m-labs/smoltcp</li> <li>\u9006\u5411 CAJ \u7684\u8f6c\u6362\u5668 https://github.com/JeziL/caj2pdf</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2019/02/01/weekly-sharing-9/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 9 \u671f","text":"<ol> <li>IDA Loader plugin for some Nintendo rom https://github.com/w4kfu/IDA_loader</li> <li>websocket daemon http://websocketd.com/</li> <li>\u5b9e\u65f6\u7684\u6e38\u620f\u5f00\u53d1\u5668 https://script-8.github.io/</li> <li>\u786c\u6838\u9006\u5411 Leica \u76f8\u673a\u7684\u56fa\u4ef6 https://alexhude.github.io/2019/01/24/hacking-leica-m240.html</li> <li>\u505a CTF \u65f6\u9047\u5230\u7684\u6574\u6570\u6ea2\u51fa\u7684 CVE https://www.anquanke.com/post/id/104182</li> <li>\u53d1\u73b0\u4e00\u4e2a speedtest \u7684\u8f6e\u5b50 https://github.com/adolfintel/speedtest</li> <li>\u897f\u6570\u7684 RISCV \u6838\u5b9e\u73b0 https://github.com/westerndigitalcorporation/swerv_eh1</li> <li>iOS 12.2 \u4f1a\u6709\u66f4\u591a\u7684 PWA \u5179\u74f7 https://twitter.com/mhartington/status/1089292031548145666</li> <li>\u4ee3\u66ff\u6b7b\u53bb\u7684 git-up: git config --global alias.up 'pull --rebase --autostash'</li> <li>\u5229\u7528\u5df2\u77e5\u660e\u6587\u7834\u89e3\u65e7\u7248\u52a0\u5bc6 zip \u7684\u5de5\u5177 https://github.com/kimci86/bkcrack</li> <li>\u5728\u7ebf\u770b jwt \u5185\u5bb9 https://jwt.io/</li> <li>JS \u7684 Lua VM  https://github.com/fengari-lua/fengari</li> <li>\u9c81\u68d2\u4f46\u4e0d\u4f18\u96c5\u7684\u524d\u7aef KV https://github.com/gruns/ImmortalDB</li> <li>Emacs Modules doc https://phst.eu/emacs-modules</li> <li>\u7528 IPv6 \u7684 Flow Label \u5b9e\u73b0\u7c7b\u4f3c MPLS \u7684\u6548\u679c https://github.com/wenxin-wang/flowlabel-switching</li> <li>\u53c8\u4e00\u4e2a JS \u5b9e\u73b0\u7684\u8868\u683c https://github.com/myliang/x-spreadsheet \u7c7b\u4f3c\u4ee5\u524d\u7528\u8fc7\u7684 handsontable</li> <li>@shankerwangmiao \u63a8\u8350\u7684\u5149\u7ea4\u6559\u7a0b http://www.kepu.net.cn/gb/technology/telecom/fiber/fbr215.html</li> <li>\u7528 Rust \u5199 iOS App https://medium.com/visly/rust-on-ios-39f799b3c1dd</li> <li>Build Once, Run Anywhere \u8fd8\u884c https://wasmer.io/</li> <li>\u633a\u79d1\u5b66\u7684 DNS proxy https://github.com/AdguardTeam/dnsproxy</li> </ol>","tags":["weeklysharing"]},{"location":"misc/2018/12/07/weekly-sharing/","title":"\u6bcf\u5468\u5206\u4eab\u7b2c 1 \u671f","text":"<p>\u5411\u962e\u4e00\u5cf0\u5b66\u4e60\uff0c\u628a\u81ea\u5df1\u5728\u4e00\u5468\u91cc\u770b\u5230\u7684\u6709\u8da3\u7684\u4e8b\u60c5\u5206\u4eab\u4e00\u4e0b\u3002\u4e0d\u8fc7\u5f62\u5f0f\u5c31\u6bd4\u8f83\u968f\u610f\u4e86\u3002</p> <ol> <li>\u6700\u8fd1\u5199 MongoDB + NodeJS \u5b66\u5230\u7684\u65b0\u64cd\u4f5c\uff1a$addToSet $nin $ne Mongoose \u7684 setDefaultsOnInsert</li> <li>Promise \u771f\u9999\uff0c\u771f\u597d\u7528</li> <li>\u51e0\u5929\u524d\u60e0\u8001\u5e08\u8fd8\u5728\u8bf4 \"IE, The best Chrome Downloader Downloader, ever\" \u4eca\u5929 EdgeHTML \u5c31\u5ba3\u544a\u6b7b\u4ea1\u4e86</li> <li>WPF, Windows Forms \u548c WinUI \u5f00\u6e90\u4e86\uff0cmono \u8fd9\u662f\u8981\u51c9\uff1f \u94fe\u63a5</li> <li>\u6709\u4eba\u9006\u5411\u4e86 FPGA \u7684 bitstream \u683c\u5f0f\uff0c\u5e0c\u671b FPGA \u6709\u671d\u4e00\u65e5\u53ef\u4ee5\u8fdb\u5165 \u5f00\u6e90\u65f6\u4ee3\uff1f \u94fe\u63a5</li> <li>\u9020\u673a\u7684 baseline \u5c31\u51b3\u5b9a\u662f \u5b83 \u4e86</li> <li>\u6839\u636e AST \u70bc\u4e39\u5224\u76f8\u4f3c\u5ea6\u8fd8\u884c\uff0c\u597d\u5947\u5b83\u8de8\u8bed\u8a00\u7684\u9884\u6d4b\u6c34\u51c6 \u94fe\u63a5</li> <li>\u53ef\u89c6\u5316 h264 nalu \u7684\u8f6f\u4ef6 H264Naked \uff08\u505a\u7684\u597d\u7cd9\u554a\uff0c\u60f3\u4ea4 pr\uff09</li> <li>ffprobe -show_packets \u548c ffprobe -show_frame \u771f\u597d\u7528</li> <li>\u53d1\u73b0\u4e00\u4e2a\u89e3\u51b3 ArchLinux \u6eda\u5185\u6838\u540e\u65e0\u6cd5 modprobe \u7684\u65b9\u6848</li> <li>010 Editor \u548c Hex Fiend \u662f\u4e8c\u8fdb\u5236\u5206\u6790\u7684\u795e\u5668\u554a... Kaitai \u8fd8\u6709\u5f85\u52a0\u6cb9</li> <li>CSS-in-JS for ClojureScript \u771f\u9999 \u6709\u7a7a\u53ef\u4ee5\u8bd5\u8bd5\u7528 ClojureScript \u5199\u524d\u7aef</li> <li>Safari Technology Preview 71 \u52a0\u5165\u4e86 Web Authentication \u8fd9\u662f\u8981\u652f\u6301 U2F \u7684\u8282\u594f\uff1f</li> <li>Grafana+InfluxDB+Telegraf \u771f\u79d1\u5b66\uff0c\u968f\u624b\u5199\u4e86\u4e00\u4e9b\u7b80\u5355\u7684 Telegraf \u7684 input plugin</li> <li>\u7ed9 010 Editor \u5199\u4e86\u4fe9 .bt \u6587\u4ef6\uff0c\u89c1\u6211\u4e0a\u4e00\u7bc7\u535a\u5ba2</li> <li>\u6d77\u601d cc \u5c45\u7136\u652f\u6301 ASan : /opt/hisi-linux/x86-arm/arm-hisiv600-linux/arm-hisiv600-linux-gnueabi/lib/a7/libasan.so</li> <li>\u9047\u5230\u4e86 \u8bbe\u5907\u540d\u6709\u7a7a\u683c\u5bfc\u81f4 telegraf \u8bfb\u53d6 S.M.A.R.T. \u4fe1\u606f\u5931\u8d25 \u7684\u9505\uff0c\u4e0d\u8fc7\u4f3c\u4e4e\u6ca1\u4eba\u4fee</li> <li>\u770b\u5230\u4e86\u4e00\u4e2a\u5f88\u6709\u610f\u601d\u7684 Interview Pass Rate \u5173\u4e8e\u4f7f\u7528\u7684\u7f16\u8f91\u5668\u7684\u8c03\u67e5\uff0c\u5f88\u6709\u610f\u601d \u94fe\u63a5</li> <li>\u53d1\u73b0\u4e00\u4e2a JSX \u7684\u66ff\u4ee3\u54c1\uff0c\u7528\u4e86 Template literal syntax\uff0c\u633a\u597d\u7684 \u94fe\u63a5</li> </ol> <p>\u4e5f\u4e0d\u77e5\u9053\u80fd\u4e0d\u80fd\u575a\u6301\u4e0b\u6765\uff0c\u5c31\u8fd9\u6837\u4e86\uff0c\u53d1\u5e03\uff08\u9003</p>","tags":["weeklysharing"]},{"location":"networking/2018/10/22/ddns-openwrt-router/","title":"OpenWRT \u4e0a\u914d\u7f6e Gandi DDNS","text":"<p>\u4e00\u76f4\u60f3\u7ed9\u81ea\u5df1\u7684 OpenWRT \u8def\u7531\u5668\u6dfb\u52a0 DDNS \u529f\u80fd\uff0c\u4f46 Gandi \u4e0d\u5728\u5b98\u65b9\u7684 ddns-scripts \u5217\u8868\u4e2d\uff0c\u81ea\u5df1\u5728\u7f51\u4e0a\u627e\u4e86\u4e00\u4e9b\u811a\u672c\uff0c\u53d1\u73b0\u662f Python \u5199\u7684\uff0c\u5c1d\u8bd5\u628a Python \u5b89\u88c5\u5230\u8def\u7531\u5668\u4e0a\u53c8\u53d1\u73b0\u7a7a\u95f4\u4e0d\u591f\uff0c\u867d\u7136\u53ef\u4ee5\u5b89\u88c5\u5230 USB \u4e0a\uff0c\u4f46\u603b\u5f52\u662f\u9ebb\u70e6\u3002</p> <p>\u6700\u540e\u627e\u5230\u4e86\u5b98\u65b9\u7684\u4e00\u4e2a\u811a\u672c\uff0c\u975e\u5e38\u9002\u5408\u6211\u7684\u9700\u6c42\u3002\u7b80\u5355\u4fee\u6539\u4e00\u4e0b\uff0c\u7136\u540e\u5b89\u88c5\u4e00\u4e0b\u652f\u6301 HTTPS \u7684 cURL\uff1a</p> <pre><code>$ opkg update\n$ opkg install ca-bundle\n$ opkg install curl\n</code></pre> <p>\u7136\u540e\u628a\u811a\u672c\u6dfb\u52a0\u5230 crontab \u5373\u53ef\u3002</p>","tags":["ddns","gandi","openwrt","cron"]},{"location":"networking/2018/08/25/enable-ipv6-autoconfiguration-on-tap-interfaces-in-macos/","title":"\u5728 macOS \u4e0a TAP Interface \u4e0a\u542f\u7528 IPv6 \u81ea\u52a8\u914d\u7f6e","text":"<p>\u7531\u4e8e macOS \u5bf9 TAP Interface \u4e0d\u4f1a\u81ea\u52a8\u51fa\u73b0\u4e00\u4e2a\u8bbe\u7f6e\u4e2d\u5bf9\u5e94\u7684\u670d\u52a1\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u8fdb\u884c\u914d\u7f6e\u3002\u4e00\u756a\u6d4b\u8bd5\u540e\uff0c\u53d1\u73b0\u53ef\u4ee5\u901a\u8fc7\uff1a</p> <pre><code>$ sudo ipconfig set [tap_if] automatic-v6\n$ sudo ipconfig set [tap_if] dhcp\n</code></pre> <p>\u542f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 dhcp \u548c ra \u529f\u80fd\u3002\u4e5f\u8bb8\u6709\u65b9\u6cd5\u53ef\u4ee5\u628a\u8fd9\u4e9b tap \u642c\u5230\u7cfb\u7edf\u7684\u8bbe\u7f6e\u4e2d\u53bb\u3002</p> <p>UPDATE:</p> <p>\u53ef\u4ee5\u628a TAP Interface \u52a0\u5230\u7cfb\u7edf\u7684\u8bbe\u7f6e\u4e2d\u53bb\u3002\u65b9\u6cd5\u53c2\u8003Virtual network interface in Mac OS X\u3002\u5b8c\u6210\u4ee5\u540e\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u7cfb\u7edf\u8bbe\u7f6e\u754c\u9762\u8fdb\u884c\u914d\u7f6e\u3002</p>","tags":["slacc","ipv6","tuntaposx","tap"]},{"location":"networking/2018/10/04/enable-lte-ipv6-on-android/","title":"\u5728 Android \u4e0a\u6253\u5f00 LTE \u7684 IPv6","text":"<p>\u542c\u95fb\u5317\u4eac\u79fb\u52a8\u7ed9 LTE \u914d\u7f6e\u4e86 SLAAC\uff0c\u4f46\u73b0\u5728\u9700\u8981\u624b\u52a8\u6253\u5f00\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p>Settings -&gt; Network &amp; Internet -&gt; Mobile Network -&gt; Advanced -&gt; Access Point Names -&gt; \u4e2d\u56fd\u79fb\u52a8 GPRS (China Mobile) -&gt; \u628a APN procotol \u548c APN roaming protocol \u4e24\u9879\u90fd\u6539\u6210 IPv4/IPv6 </p> <p>\u7136\u540e\u5728 test-ipv6.com \u4e0a\u53ef\u4ee5\u770b\u5230\u786e\u5b9e\u5206\u914d\u4e86 IPv6 \u5730\u5740\uff0c\u4e0d\u8fc7\u76ee\u524d\u8bc4\u5206\u53ea\u6709 1/10\u3002\u4e5f\u5c31\u662f\u8bf4\u53ef\u7528\u6027\u8fd8\u4e0d\u4f73\u3002</p> <p>\u800c\u5728 iOS \u4e0a\uff0c\u901a\u8fc7 HE \u7684 Network Tools \u80fd\u770b\u5230\uff0c\u786e\u5b9e\u62ff\u5230\u4e86 IPv6 \u7684\u5730\u5740\uff0c\u4f46\u662f\u51fa\u4e0d\u53bb\uff0c\u6000\u7591\u662f\u8fd0\u8425\u5546\u6ca1\u6709\u4e0b\u53d1\u76f8\u5173\u914d\u7f6e\uff0c\u6240\u4ee5\u8fd8\u4e0d\u80fd\u4f7f\u7528\uff0c\u53ea\u80fd\u7ee7\u7eed\u7b49\u3002</p> <p>2018-11-06 \u66f4\u65b0\uff1a\u73b0\u5728 iOS \u7528\u6237\u4e5f\u6709 LTE \u7684 v6 \u4e86\u3002\u8bc4\u5206\u662f 9/10\u3002\u76ee\u524d\u53ef\u7528\u6027\u5df2\u7ecf\u53ef\u4ee5\u4e86\uff0c\u5c31\u662f\u56fd\u5185\u4e92\u8054\u8fd8\u4e0d\u5927\u597d\u3002</p>","tags":["android","apn","ipv6"]},{"location":"networking/2018/09/11/enable-wpad-on-lede/","title":"\u5728 LEDE\uff08OpenWrt\uff09\u4e0a\u542f\u7528 wpad","text":"<p>WPAD\uff08Web Proxy Auto-Discovery Protocol\uff09\u662f\u4e00\u4e2a\u53ef\u4ee5\u5229\u7528 dhcp \u5206\u53d1 pac \u914d\u7f6e\u7684\u534f\u8bae\u3002\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ # ssh to router first\n$ vim /etc/dnsmasq.conf\ndhcp-option=252,\"http://router_ip/wpad.dat\"\n$ vim /www/wpad.dat # put pac here\n$ service dnsmasq restart\n$ # ensure proxy is available to lan\n$ # enable wpad on devices\n</code></pre> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>Web Proxy Auto-Discovery Protocol</li> <li>Automatic Proxy Configuration with WPAD</li> <li>Deployment Options</li> <li>Example PAC File</li> </ol>","tags":["lede","openwrt","wpad","pac"]},{"location":"networking/2021/03/27/esxi-network-config/","title":"ESXi \u7f51\u7edc\u914d\u7f6e","text":"<p>\u7528\u8fc7 ESXi \u7684\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u5b83\u7f51\u9875\u7248\u5bf9\u7f51\u7edc\u7684\u914d\u7f6e\u529f\u80fd\u6709\u9650\uff0c\u7279\u522b\u662f IPv6 \u7684\u90e8\u5206\uff0c\u6709\u7684\u4e8b\u60c5\u65e0\u6cd5\u5b9e\u73b0\u3002\u66f4\u597d\u7684\u529e\u6cd5\u662f SSH \u5230 ESXi \u4e0a\u76f4\u63a5\u7528\u547d\u4ee4\u884c\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u4e00\u4e9b\u547d\u4ee4\uff1a</p> <ol> <li>esxcfg-vmknic: \u7528\u6765\u7ed9 vmkernel \u914d\u7f6e\u5730\u5740</li> <li>esxcfg-route: \u8bbe\u7f6e\u7cfb\u7edf\u8def\u7531\u8868</li> <li>esxcli: \u5927\u6742\u70e9\uff0c\u5f88\u591a\u529f\u80fd\u90fd\u5728\u91cc\u9762</li> <li>tcpdump-uw\uff1a\u9b54\u6539\u7248 tcpdump</li> </ol> <p>\u4e00\u4e9b\u4f8b\u5b50\uff1a</p> <p>\u8bbe\u7f6e IPv6 \u9ed8\u8ba4\u8def\u7531\uff1a</p> <pre><code>[root@esxi:~]esxcfg-route -f V6 -a default $IPV6\n</code></pre> <p>\u5220\u9664 vmkernel \u7684 IPv6 \u5730\u5740\uff1a</p> <pre><code>[root@esxi:~]esxcli network ip interface ipv6 address remove -i $VMKERNEL -I $IPV6/$PREFIX\n</code></pre> <p>\u53c2\u8003\uff1ahttps://kb.vmware.com/s/article/1002662</p>","tags":["esxi","esxcli","ipv6"]},{"location":"networking/2018/10/20/etc-wireless-network/","title":"ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0","text":"<p>\u6b63\u597d\u4e0a\u7740\u674e\u8d3a\u6b66\u8001\u5e08\u7684\u300a\u65e0\u7ebf\u79fb\u52a8\u7f51\u7edc\u6280\u672f\u300b\u8bfe\uff0c\u7136\u540e\u4eca\u5929\u53c8\u7ed9 ETC \u6bd4\u8d5b\u642d\u5efa\u65e0\u7ebf\u7f51\u7edc\uff0c\u4e8e\u662f\u5468\u4e8c\u7684\u65f6\u5019\u627e\u8001\u5e08\u54a8\u8be2\u4e86\u4e00\u4e0b\u610f\u89c1\u3002\u6211\u4eec\u5927\u6982\u7ed9\u8001\u5e08\u8bb2\u4e86\u4e00\u4e0b\u573a\u5730\u7684\u6837\u5b50\u548c\u5c3a\u5bf8\uff08\u5f53\u65f6\u4f30\u8ba1\u7684\u5927\u4e86\uff09\uff0c\u7136\u540e\u8001\u5e08\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u4f9b\u53c2\u8003\u7684\u90e8\u7f72\u65b9\u6848\uff0c\u5305\u62ec\u51e0\u4e2a AP \u5206\u522b\u653e\u5728\u54ea\uff0c\u8fd9\u4e9b AP \u7684 2.4GHz \u90fd\u7528\u54ea\u4e2a channel\uff0c\u7136\u540e\u90fd\u7528\u591a\u5c11\u529f\u7387\u3002\u5e76\u4e14\u5f88\u53cb\u5584\u5730\u5728\u5468\u4e94\u7684\u65f6\u5019\u8ba9\u52a9\u6559\u6765\u573a\u5730\u5e2e\u6211\u4eec survey \u4e00\u4e0b\u65e0\u7ebf\u7f51\u7edc\u7684\u72b6\u51b5\u3002\u6211\u4eec\u7528 Fluke Networks \u7684 AirCheck Wi-Fi Tester \u770b\u4e86\u4e00\u4e0b\u573a\u5730\u7684\u5404\u4e2a\u9891\u9053\u7684 AP \u6570\u91cf\u548c\u4fe1\u53f7\u5f3a\u5ea6\uff0c\u53d1\u73b0\u867d\u7136 AP \u633a\u591a\u7684\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u4fe1\u53f7\u90fd\u6bd4\u6211\u4eec\u7684\u5c0f\u4e0d\u5c11\uff0c\u800c\u4e14\u6211\u4eec\u4e5f\u90fd\u5f00\u5230\u4e86 50mW\uff0c\u6240\u4ee5\u5e72\u6270\u4e0d\u5927\u3002</p> <p>\u7136\u540e\u6628\u5929\u4e0b\u5348\u4e00\u70b9\u534a\u949f\u6765\u5230\u573a\u5730\uff0c\u7528\u677f\u8f66\u628a\u8bbe\u5907\u90fd\u8fd0\u5230\u8ba1\u7b97\u673a\u5f00\u653e\u5b9e\u9a8c\u5ba4\uff0c\u7136\u540e\u5f00\u59cb\u90e8\u7f72\u65e0\u7ebf\u7f51\u7edc\u3002\u6211\u4eec\u63d0\u524d\u6765\u8e29\u8fc7\u51e0\u6b21\u70b9\uff0c\u8fd9\u8fb9\u7684\u7f51\u7edc\u662f\u6ca1\u6709 DHCP \u670d\u52a1\u5668\u7684\uff0c\u901a\u8fc7\u4e00\u4e2a\u6307\u5b9a\u7684\u7f51\u5173\u51fa\u53bb\u3002\u6211\u4eec\u53d1\u73b0\u53ef\u4ee5\u5229\u7528\u5df2\u6709\u7684\u8fd9\u4e9b\u4ea4\u6362\u673a\u4ece\u5730\u4e0b\u8fde\u5230\u5404\u4e2a\u7535\u8111\u4e0a\u7684\u7f51\u7ebf\uff0c\u6765\u8fde\u63a5\u6211\u4eec\u7684 AP \u548c\u4ea4\u6362\u673a\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u514d\u53bb\u4e86\u8d70\u7ebf\u7684\u9ebb\u70e6\u3002\u4e8e\u662f\u6211\u4eec\u5148\u5b9a\u4e0b\u653e AP \u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u7528\u5bfb\u7ebf\u5668\u627e\u5230\u7f51\u7ebf\u63d2\u5230\u4e86\u4ea4\u6362\u673a\u7684\u54ea\u4e00\u4e2a\u7aef\u53e3\u4e0a\uff0c\u6807\u8bb0\u597d\u540e\u6362\u6210\u8fde\u63a5\u5230\u6211\u4eec\u81ea\u5df1\u7684\u4ea4\u6362\u673a\u7684\u7f51\u7ebf\u4e0a\uff0c\u4ece\u800c\u53ef\u4ee5\u901a\u8fc7 PoE \u628a\u6211\u4eec\u7684 AP \u7ed9\u542f\u52a8\u8d77\u6765\u3002\u7136\u540e\u7528\u6211\u81ea\u5df1\u7684\u8def\u7531\u5668\uff0c\u628a LAN \u53e3\u63d2\u5230\u4ea4\u6362\u673a\u4e0a\uff0c\u7ed9 AP \u5206\u53d1 DHCP \u5730\u5740\uff0c\u7136\u540e\u628a\u4e0b\u53d1\u7684\u9ed8\u8ba4\u7f51\u5173\u914d\u7f6e\u4e3a\u771f\u5b9e\u7684\u7f51\u5173\uff08DHCP Option 3\uff09 \uff0c\u6ca1\u505a\u4f46\u662f\u4e5f\u53ef\u4ee5\u987a\u5e26\u505a\u7684\u662f\u628a WLC \u7684\u5730\u5740\u5206\u53d1\u4e0b\u53bb\uff08DHCP Option 43 Type 241\uff09\u3002</p> <p>\u5f53\u7136\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u9047\u5230\u4e86\u4e00\u70b9\u5c0f\u5751\uff0c\u5c31\u662f\u4ea4\u6362\u673a\u8fd8\u4fdd\u7559\u4e86\u4e4b\u524d\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u8fd9\u6b21\u628a\u65b0\u7684\u51e0\u4e2a\u7aef\u53e3\u5212\u5230\u4e86\u4e00\u4e2a VLAN \u4e0b\uff0c\u547d\u4ee4\u81ea\u7136\u662f\u8bb0\u4e0d\u4f4f\u7684\u8981\u73b0\u67e5\u3002\u7136\u540e\u8d77\u6765\u4ee5\u540e\u8fd8\u633a\u7a33\u5b9a\u7684\uff0c\u4e5f\u6ca1\u51fa\u73b0\u4ec0\u4e48\u95ee\u9898\uff0c\u7f51\u7edc\u5e26\u5bbd\u4e5f\u8db3\u591f\u7528\uff0c\u79bb\u5343\u5146\u8fd8\u6709\u86ee\u591a\u8ddd\u79bb\uff0c\u4e00\u5929\u4e5f\u624d\u8dd1\u4e86\u63a5\u8fd1\u4fe9 TB \u7684\u6d41\u91cf\u3002</p>","tags":["etc","janestreet","cisco","wifi","flukenetworks"]},{"location":"networking/2018/01/02/first-trail-of-NAT64/","title":"NAT64 \u521d\u5c1d\u8bd5","text":"<p>\u6700\u8fd1\u5bbf\u820d\u91cc\u6709\u7ebf\u7f51\u7edc\u7684 IPv4 \u603b\u662f\u62ff\u4e0d\u5230\u5730\u5740\uff0c\u53ea\u80fd\u8fde\u65e0\u7ebf\u7f51\uff0c\u4e0d\u7981\u5bf9\u8ba1\u7b97\u673a\u7cfb\u5b66\u751f\u7684\u53ef\u6015\u7684\u8bbe\u5907\u6570\u91cf\u6709\u4e86\u6df1\u523b\u7684\u8ba4\u8bc6\u3002\u4e0d\u8fc7\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6709\u9053\u5fb7\uff08\u8bef\uff09\u7684\u826f\u597d\u9752\u5e74\uff0c\u8fd8\u662f\u4e0d\u8981\u7ed9\u5df2\u7ecf\u67af\u7aed\u7684 IPv4 \u5730\u5740\u586b\u5835\u4e86\uff0c\u8fd8\u662f\u8d76\u7d27\u73a9\u73a9 IPv6 \u7684\u7f51\u7edc\u5427\u3002\u7136\u540e\u5728 TUNA \u7fa4\u91cc\u53d7\u9752\u5e74\u5343\u4eba\u7eed\u672c\u8fbe (@heroxbd) \u7684\u5b89\u5229\uff0c\u672c\u5730\u642d\u5efa\u4e00\u4e0b NAT64+DNS64 \u7684\u73af\u5883\u3002\u4e0d\u8fc7\u8003\u8651\u5230\u5bbf\u820d\u8fd8\u662f\u62ff\u4e0d\u5230\u6709\u7ebf\u7684 IPv4 \u5730\u5740\uff0c\u6211\u5c31\u5148\u5229\u7528\u82f9\u679c\u5148\u524d\u5728\u5f3a\u5236 iOS \u7684\u5e94\u7528\u652f\u6301 NAT64 \u7f51\u7edc\u7684\u540c\u65f6\uff0c\u5728 macOS \u4e0a\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u8bd5\uff0c\u63d0\u4f9b\u7684\u4fbf\u6377\u7684\u5efa\u7acb NAT64 \u7f51\u7edc\u7684\u80fd\u529b\u3002</p> <p>\u9996\u5148\u5728\u8bbe\u7f6e\u4e2d\u6309\u4f4f Option \u952e\u6253\u5f00 Sharing\uff0c\u70b9\u51fb Internet Sharing\uff0c\u52fe\u4e0a Create NAT64 Network \u7136\u540e\u628a\u7f51\u7edc\u5171\u4eab\u7ed9\u8bbe\u5907\u3002\u7136\u540e\u5728\u624b\u673a\u4e0a\u5173\u6389 Wi-Fi \u548c Cellular\uff0c\u53d1\u73b0\u8fd8\u80fd\u6b63\u5e38\u4e0a\u7f51\u3002\u6b64\u65f6\u53ef\u4ee5\u6253\u5f00 Wireshark \u9a8c\u8bc1\u6211\u4eec\u7684\u6210\u679c\u4e86\uff1a</p> <p>\u5728\u624b\u673a\u4e0a\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u6d4f\u89c8\u5343\u5ea6\uff0c\u5f97\u5230\u5982\u4e0b\u7684 Wireshark \u622a\u56fe\uff1a </p> <p>\u8fd9\u91cc\uff0c<code>2001:2:0:aab1::1</code> \u662f\u672c\u673a\u5728\u8fd9\u4e2a\u5b50\u7f51\u4e2d\u7684\u5730\u5740\uff0c<code>2001:2::aab1:cda2:5de:87f6:fd78</code> \u662f\u6211\u7684 iOS \u8bbe\u5907\u7684\u5730\u5740\uff0c\u7136\u540e iOS \u5411 macOS \u53d1\u51fa\u4e86 DNS \u8bf7\u6c42\uff0cmacOS \u53d1\u9001 DNS \u8bf7\u6c42\u540e\u5f97\u5230 <code>baidu.com</code> \u7684 IPv4 \u5730\u5740\u4e4b\u4e00\u4e3a <code>111.13.101.208</code> \uff1a </p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c <code>baidu.com</code> \u7684 <code>AAAA</code> \u8bb0\u5f55\u662f <code>2001:2:0:1baa::6f0d:65d0</code> \uff0c\u8fd9\u4e2a\u5c31\u662f DNS64 \u8f6c\u8bd1\u7684\u5730\u5740\uff0c\u524d\u9762\u4e3a\u7f51\u5173\u7684 <code>prefix</code> \uff0c\u540e\u9762\u5c31\u662f\u5bf9\u5e94\u7684 IPv4 \u5730\u5740\uff1a <code>0x6f=111, 0x0d=13, 0x65=101, 0xd0=208</code> \uff0c\u5f53\u5ba2\u6237\u7aef\u5411\u8fd9\u4e2a\u5730\u5740\u53d1\u5305\u7684\u65f6\u5019\uff0c\u7f51\u5173\u53d1\u73b0\u524d\u7f00\u7b26\u5408\u6761\u4ef6\uff0c\u628a\u6700\u540e\u7684\u8fd9\u90e8\u5206 IPv4 \u5730\u5740\u53d6\u51fa\u6765\uff0c\u81ea\u5df1\u628a\u5305\u53d1\u9001\u5230\u771f\u5b9e\u7684\u5730\u5740\u4e0a\u53bb\uff0c\u518d\u628a\u8fd4\u56de\u6765\u7684\u5305\u518d\u8f6c\u4e3a IPv6 \u7684\u5730\u5740\u8fd4\u8fd8\u7ed9\u5ba2\u6237\u7aef\u3002\u53ef\u4ee5\u9a8c\u8bc1\uff0c\u5269\u4e0b\u7684\u51e0\u4e2a\u5730\u5740\u4e5f\u7b26\u5408\u8fd9\u4e2a\u8f6c\u8bd1\u89c4\u5219\u3002</p> <p>\u8fd9\u5c31\u5b9e\u73b0\u4e86\uff1a\u5229\u7528\u4e00\u53f0\u8fde\u63a5\u7740 IPv6 \u548c IPv4 \u4e24\u79cd\u7f51\u7edc\u7684\u7f51\u5173\uff0c\u53ef\u4ee5\u4f7f\u5f97 IPv6 \u8fd9\u4e2a\u7f51\u7edc\u901a\u8fc7\u7f51\u5173\u8bbf\u95ee IPv4\u3002\u901a\u8fc7\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u5f97 IPv4 \u8bbf\u95ee IPv6 \u4e2d\u7684\u5730\u5740\uff08\u5373 Stateful \u548c Stateless \u7684\u533a\u5206\uff0c\u9700\u8981\u624b\u52a8\u914d\u7f6e\u6620\u5c04\uff09\u3002</p> <p>\u597d\u5904\uff1a\u4f5c\u4e3a\u6bd4\u8f83\u6210\u719f\u7684 IPv4 \u5230 IPv6 \u8fc7\u6e21\u65b9\u6848\u4e4b\u4e00\uff0c\u53ef\u4ee5\u8ba9\u81ea\u5df1\u7ec4\u5efa\u7684 IPv6 \u7f51\u7edc\u8bbf\u95ee\u4e00\u4e9b\u4ec5 IPv4 \u7684\u7f51\u7ad9\u3002 \u574f\u5904\uff1a\u4f9d\u8d56\u4e8e DNS64\uff0c\u5fc5\u987b\u8981\u7ecf\u8fc7\u4e00\u5c42\u7ffb\u8bd1\uff0c\u4e00\u4e9b\u5e94\u7528\u6216\u534f\u8bae\u53ef\u80fd\u5199\u6b7b\u4e86 IPv4 \u7684\u5730\u5740\uff0c\u8be5\u65b9\u6cd5\u53ef\u80fd\u4f1a\u5931\u6548\u3002</p>","tags":["networking","nat","ipv6","nat64","dns","dns64"]},{"location":"networking/2018/07/26/flashing-lenovo-y1s-and-bridge-ipv6/","title":"\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c","text":"<p>\u9996\u5148\u53c2\u7167OpenWRT Wiki - Lenovo Y1 v1\u627e\u5230\u5237\u56fa\u4ef6\u6559\u7a0b\uff1a</p> <ol> <li>\u4e0b\u8f7dLenovo y1s \u7684\u56fa\u4ef6\u5907\u7528</li> <li>\u65ad\u5f00\u7535\u6e90\uff0c\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u63d2\u5165\u7535\u6e90\u540c\u65f6\u5feb\u901f\u6309\u4e0b\u91cd\u7f6e\u6309\u94ae\uff0c\u5982\u679c\u9762\u677f\u53cc\u95ea\uff0c\u5219\u8bf4\u660e\u8fdb\u5165\u4e86\u6062\u590d\u6a21\u5f0f</li> <li>\u7535\u8111\u8fde\u63a5\u5230\u56db\u4e2a LAN \u53e3\u4e2d\u4efb\u610f\u4e00\u4e2a\uff0c\u914d\u7f6e\u9759\u6001\u5730\u5740\u5728 192.168.1.0/24 \u7f51\u6bb5</li> <li>\u6253\u5f00 192.168.1.1 \u53ef\u4ee5\u770b\u5230\u5237\u56fa\u4ef6\u7684\u9875\u9762</li> <li>\u4e0a\u4f20\u56fa\u4ef6\uff0c\u7b49\u5f85\u8def\u7531\u5668\u91cd\u542f</li> <li>\u914d\u7f6e IP \u5730\u5740\u4e3a DHCP \u6a21\u5f0f\uff0c\u6253\u5f00 192.168.1.1 \u8fdb\u884c\u914d\u7f6e</li> </ol> <p>\u7136\u540e\u5c31\u662f\u5e38\u89c4\u7684\u5bc6\u7801\u8bbe\u7f6e\uff0copkg \u6e90\u8bbe\u7f6e\u4e3a tuna \u7684\u6e90\uff0c\u914d\u7f6e ssh \u548c \u516c\u94a5\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4e3a\u4e86\u4f7f\u7528\u5b66\u6821\u7684 SLAAC\uff0c\u91c7\u7528 ebtables \u76f4\u63a5\u628a\u5b66\u6821\u7684 IPv6 bridge \u8fdb\u6765\uff0c\u800c IPv4 \u7531\u4e8e\u51c6\u5165\u7cfb\u7edf\uff0c\u9700\u8981 NAT\u3002</p> <p>\u53c2\u8003 Bridge IPv6 connections to WAN\uff0c\u4e0b\u8f7d v6brouter_openwrt.sh \u5230\u67d0\u4e2a\u5730\u65b9\uff0c\u7136\u540e\u4fee\u6539\u4e00\u4e0b\u91cc\u9762\u7684\u4e00\u4e9b\u53c2\u6570\uff1a</p> <pre><code># For Lenovo y1s\nWAN_DEV=eth0.2\nBRIDGE=br-lan\n# the rest remain unchanged\n</code></pre> <p>\u7136\u540e\u8dd1\u8d77\u6765\u4e4b\u540e\uff0c\u81ea\u5df1\u7684\u7535\u8111\u53ef\u4ee5\u6210\u529f\u62ff\u5230\u539f\u751f\u7684 IPv6 \u5730\u5740\u4e86\uff0c\u4e0d\u9700\u8981\u7528\u96be\u7528\u7684 NAT66 \u6280\u672f\u3002</p> <p>\u4e0b\u4e00\u6b65\u662f\u91c7\u7528z4yx/GoAuthing\u3002</p> <pre><code>$ go get -u -v github.com/z4yx/GoAuthing\n$ cd $GOPATH/src/github.com/z4yx/GoAuthing/cli\n$ env GOOS=linux GOARCH=mipsle GOMIPS=softfloat go build main.go\n$ mipsel-linux-gnu-strip main\n$ scp main root@192.168.1.1:~/GoAuthing\n$ ssh root@192.168.1.1\n$ opkg install ca-certificates\n$ ./GoAuthing\n</code></pre> <p>\u8fd9\u91cc\u53c2\u8003\u4e86\u89e3\u51b3 GO \u8bed\u8a00\u7f16\u8bd1\u7a0b\u5e8f\u5728 openwrt(mipsle \u67b6\u6784) \u4e0a\u8fd0\u884c\u63d0\u793a Illegal instruction \u95ee\u9898\uff0c\u914d\u7f6e\u4e86 GOMIPS \u73af\u5883\u53d8\u91cf\u3002\u4e3a\u4e86\u8bbf\u95ee HTTPS \u7f51\u7ad9\uff0c\u53c2\u8003\u4e86OpenWRT Wiki - SSL and Certificates in wget\u3002\u6709\u6bd2\u7684\u662f\uff0c\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u5728 macOS \u4e0a\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u800c\u5728 Linux \u673a\u5b50\u4e0a\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u6210\u529f\u5730\u8dd1\u8d77\u6765 GoAuthing\uff0c\u89e3\u51b3\u4e86\u4e0a\u6821\u56ed\u7f51\u8ba4\u8bc1\u7684\u95ee\u9898\u3002</p> <p>\u611f\u8c22\u5b87\u7fd4\u7f16\u5199\u7684 GoAuthing \u5c0f\u5de5\u5177\u3002</p> <p>\u66f4\u65b0\uff1a\u7b80\u5316\u4e86\u4e00\u4e0b v6brouter \u811a\u672c\uff1a</p> <pre><code>#!/bin/sh\nBRIDGE=br-lan\nWAN_DEV=$(/sbin/uci get network.wan.ifname)\nWHITELIST1=\"00:11:22:33:44:55\"\nWHITELIST2=\"55:44:33:22:11:00\"\n\nbrctl addbr $BRIDGE 2&gt; /dev/null\nbrctl addif $BRIDGE $WAN_DEV\nip link set $BRIDGE down\nip link set $BRIDGE up\nbrctl show\n\nebtables -F\nebtables -P FORWARD ACCEPT\nebtables -L\n\nuci set dhcp.lan.ra='disabled'\nuci set dhcp.lan.dhcpv6='disabled'\nuci commit\n/etc/init.d/odhcpd restart\n\necho 2 &gt; /proc/sys/net/ipv6/conf/$BRIDGE/accept_ra\nebtables -t broute -F\nebtables -t broute -A BROUTING -i $WAN_DEV -p ! ipv6 -j DROP\nebtables -t broute -A BROUTING -s $WHITELIST1 -p ipv6 -j ACCEPT\nebtables -t broute -A BROUTING -d $WHITELIST1 -p ipv6 -j ACCEPT\nebtables -t broute -A BROUTING -s $WHITELIST2 -p ipv6 -j ACCEPT\nebtables -t broute -A BROUTING -d $WHITELIST2 -p ipv6 -j ACCEPT\nebtables -t broute -A BROUTING -p ipv6 -j DROP\nebtables -t broute -L\n</code></pre> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u6dfb\u52a0\u4e86\u4e24\u4e2a WHITELIST \u7684 MAC \u5730\u5740\uff0c\u8868\u793a\u53ea\u8ba9\u8fd9\u4e24\u4e2a MAC \u5730\u5740\u7684\u8bbe\u5907\u8bbf\u95ee v6\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5916\u9762\u7f51\u5173\u7684 MAC \u5730\u5740\u4e5f\u8981\u653e\u8fdb\u6765\uff0c\u4e0d\u7136\u53ef\u80fd\u63a5\u6536\u4e0d\u5230 RA\u3002\u5982\u679c\u4e0d\u9700\u8981\u767d\u540d\u5355\u7684\u8bdd\uff0c\u53ef\u4ee5\u53bb\u6389 ebtables \u7684\u540e\u51e0\u884c\u89c4\u5219\u3002</p>","tags":["lenovo","newifi","uboot","lede","openwrt","go","ebtables","bridge","ipv6","goauthing","z4yx"]},{"location":"networking/2018/05/08/ftp-behind-nat/","title":"\u642d\u5efa FTP server behind NAT","text":"<p>\u6211\u4eec\u51fa\u73b0\u65b0\u7684\u9700\u6c42\uff0c\u8981\u628a\u4ee5\u524d\u7684 FTP \u670d\u52a1\u5668\u8fc1\u79fb\u5230 NAT \u4e4b\u540e\u7684\u4e00\u53f0\u673a\u5668\u4e0a\u3002\u4f46\u662f\uff0cFTP \u4e0d\u4ec5\u7528\u5230 20 21 \u7aef\u53e3\uff0cPASV \u8fd8\u4f1a\u7528\u5230\u9ad8\u7aef\u53e3\uff0c\u8fd9\u7ed9\u7aef\u53e3\u8f6c\u53d1\u5e26\u6765\u4e86\u4e00\u4e9b\u9ebb\u70e6\u3002\u6211\u4eec\u4e00\u5f00\u59cb\u6d4b\u8bd5\uff0c\u76f4\u63a5\u5728 Router \u4e0a\u8f6c\u53d1 20 \u548c 21 \u7aef\u53e3\u5230 Server \u4e0a\u3002\u4f46\u662f\u5f88\u5feb\u53d1\u73b0\uff0cFilezilla \u901a\u8fc7 PASV \u83b7\u53d6\u5230\u5730\u5740\u4e3a\uff08\u5185\u7f51\u5730\u5740\uff0c\u7aef\u53e3\u9ad8 8 \u4f4d\uff0c\u7aef\u53e3\u4f4e 8 \u4f4d\uff09\uff0c\u7136\u540e\uff0cFilezilla \u68c0\u6d4b\u51fa\u8fd9\u4e2a\u5730\u5740\u662f\u5185\u7f51\u5730\u5740\uff0c\u4e8e\u662f\u8f6c\u800c\u5411 router_ip:port \u53d1\u5305\uff0c\u8fd9\u81ea\u7136\u662f\u4e0d\u4f1a\u5f97\u5230\u7ed3\u679c\u7684\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u53bb\u7f51\u4e0a\u627e\u4e86\u627e\u8d44\u6599\uff0c\u627e\u5230\u4e86\u4e00\u4e2a\u5f88\u7c97\u66b4\u7684\u65b9\u6cd5\uff1a <pre><code>iptables -A PREROUTING -i external_interface -p tcp -m tcp --dport 20 -j DNAT --to-destination internal_ip:20\niptables -A PREROUTING -i external_interface -p tcp -m tcp --dport 21 -j DNAT --to-destination internal_ip:21\niptables -A PREROUTING -i external_interface -p tcp -m tcp --dport 1024:65535 -j DNAT --to-destination internal_ip:1024-65535\n</code></pre></p> <p>\u6709\u8da3\u5730\u662f\uff0cmacOS \u81ea\u5e26\u7684 ftp \u547d\u4ee4\uff08High Sierra \u4f3c\u4e4e\u5df2\u7ecf\u5220\u53bb\uff09\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u3002\u7814\u7a76\u53d1\u73b0\uff0c\u5b83\u7528 EPSV\uff08Extended Passive Mode\uff09\u4ee3\u66ff PASV\uff0c\u8fd9\u91cc\u5e76\u6ca1\u6709\u5199\u5185\u7f51\u5730\u5740\uff0c\u56e0\u800c\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>\u8fd9\u4e48\u505a\uff0cFilezilla \u53ef\u4ee5\u6210\u529f\u8bbf\u95ee\u4e86\u3002\u4f46\u662f\uff0c\u7528\u5176\u5b83\u5ba2\u6237\u7aef\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u76f4\u8fde\u90a3\u4e2a\u5185\u7f51\u5730\u5740\u800c\u4e0d\u662f Router \u7684\u5730\u5740\uff0c\u4e8e\u662f\u8fd8\u662f\u8fde\u4e0d\u4e0a\u3002\u800c\u4e14\uff0c\u4f7f\u7528\u4e86 1024-65535 \u7684\u6240\u6709\u7aef\u53e3\uff0c\u8fd9\u4e2a\u592a\u6d6a\u8d39\u800c\u4e14\u4f1a\u5f71\u54cd\u6211\u4eec\u5176\u5b83\u7684\u670d\u52a1\u3002</p> <p>\u6211\u4eec\u5f00\u59cb\u7814\u7a76\u6211\u4eec FTP \u670d\u52a1\u5668 (pyftpdlib) \u7684\u914d\u7f6e\u3002\u679c\u7136\uff0c\u627e\u5230\u4e86\u9002\u7528\u4e8e FTP behind NAT \u7684\u76f8\u5173\u914d\u7f6e\uff1a <pre><code>     - (str) masquerade_address:\n        the \"masqueraded\" IP address to provide along PASV reply when\n        pyftpdlib is running behind a NAT or other types of gateways.\n        When configured pyftpdlib will hide its local address and\n        instead use the public address of your NAT (default None).\n     - (dict) masquerade_address_map:\n        in case the server has multiple IP addresses which are all\n        behind a NAT router, you may wish to specify individual\n        masquerade_addresses for each of them. The map expects a\n        dictionary containing private IP addresses as keys, and their\n        corresponding public (masquerade) addresses as values.\n     - (list) passive_ports:\n        what ports the ftpd will use for its passive data transfers.\n        Value expected is a list of integers (e.g. range(60000, 65535)).\n        When configured pyftpdlib will no longer use kernel-assigned\n        random ports (default None).\n</code></pre></p> <p>\u4e8e\u662f\uff0c\u6211\u4eec\u914d\u7f6e\u4e86 <code>masquerade_address</code> \u4f7f\u5f97 FTP \u670d\u52a1\u5668\u4f1a\u5728 PASV \u4e2d\u8fd4\u56de Router \u7684\u5730\u5740\uff0c\u5e76\u4e14\u5728 <code>passive_ports</code> \u4e2d\u7f29\u5c0f\u4e86 <code>pyftpdlib</code> \u4f7f\u7528\u7684\u7aef\u53e3\u8303\u56f4\u3002</p> <p>\u8fdb\u884c\u914d\u7f6e\u4ee5\u540e\uff0c\u6211\u4eec\u5728\u524d\u8ff0\u7684 iptables \u547d\u4ee4\u4e2d\u76f8\u5e94\u4fee\u6539\u4e86\u7aef\u53e3\u8303\u56f4\uff0c\u73b0\u5728\u5de5\u4f5c\u4e00\u5207\u6b63\u5e38\u3002</p>","tags":["linux","nat","forwarding","ftp"]},{"location":"networking/2023/03/22/hardware-queue-interface/","title":"\u8f6f\u786c\u4ef6\u961f\u5217\u63a5\u53e3","text":"","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u7f51\u5361\u7b49\u573a\u666f\u4e0b\uff0c\u7ecf\u5e38\u4f1a\u9700\u8981\u5728\u8f6f\u786c\u4ef6\u4e4b\u95f4\u4f20\u8f93\u5927\u91cf\u7684\u6570\u636e\uff0c\u901a\u5e38\u7684\u65b9\u6cd5\u662f\u5efa\u7acb\u5faa\u73af\u961f\u5217\uff0c\u4f8b\u5982 H2C\uff08Host to Chip\uff09\u65b9\u5411\uff0c\u662f Host \u4f5c\u4e3a Producer \u589e\u52a0\u6570\u636e\u5230\u961f\u5c3e\uff0cChip \u4f5c\u4e3a Consumer \u4ece\u961f\u5934\u8bfb\u53d6\u6570\u636e\u3002\u7531\u4e8e\u6bcf\u6b21\u4f20\u8f93\u7684\u6570\u636e\u4e0d\u5b9a\u957f\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u961f\u5217\u7684\u9879\u662f\u4e00\u4e2a\u5b9a\u957f\u7684 Descriptor\uff0cDescriptor \u6307\u5411\u4e86\u6570\u636e\u7684\u5730\u5740\u3002\u4f46\u5177\u4f53\u7684\u7ec6\u8282\uff0c\u4e0d\u540c\u7684\u5b9e\u73b0\u8fd8\u4e0d\u592a\u4e00\u6837\u3002\u4e0b\u9762\u9010\u4e2a\u6848\u4f8b\u8fdb\u884c\u5206\u6790\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#axi-dma","title":"AXI DMA","text":"<p>\u6587\u6863\uff1ahttps://docs.xilinx.com/r/en-US/pg021_axi_dma</p> <p>\u5982\u679c\u5728 Xilinx FPGA \u4e0a\u4f7f\u7528\u8fc7\u4ee5\u592a\u7f51\uff0c\u90a3\u5927\u6982\u7387\u4f1a\u63a5\u89e6\u5230 AXI DMA \u8fd9\u4e2a IP\uff0c\u5b83\u8d1f\u8d23\u628a\u4ee5\u592a\u7f51 MAC \u7684 AXI Stream \u6570\u636e\u7528 DMA \u7684\u5f62\u5f0f\u901a\u8fc7\u5185\u5b58\u6765\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4ea4\u4e92\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u53d1\u9001\u961f\u5217","title":"\u53d1\u9001\u961f\u5217","text":"<p>\u5b83\u7684\u6536\u548c\u53d1\u5404\u662f\u4e00\u4e2a\u961f\u5217\uff0c\u9996\u5148\u6765\u770b\u53d1\u9001\u961f\u5217\uff1a</p> <p>\u53d1\u9001\u961f\u5217\u7531\u4e00\u4e2a\u5934\u6307\u9488\uff08MM2S_CURDESC\uff09\u548c\u4e00\u4e2a\u5c3e\u6307\u9488\u5b9a\u4e49\uff08MM2S_TAILDESC\uff09\uff0c\u6307\u9488\u6307\u5411\u7684\u662f\u4e00\u4e2a Scatter Gather Descriptor\uff0cDescriptor \u7684\u5185\u5bb9\u5305\u62ec\uff1a</p> <ul> <li>NXTDESC\uff1a\u961f\u5217\u4e0b\u4e00\u9879\u7684\u5730\u5740</li> <li>BUFFER_ADDRESS\uff1a\u8981\u4f20\u8f93\u7684\u6570\u636e\u7684\u5730\u5740</li> <li>CONTROL\uff1a\u63a7\u5236\u4fe1\u606f</li> <li>STATUS\uff1a\u72b6\u6001\u4fe1\u606f</li> <li>APP0 to APP4\uff1a\u9644\u5e26\u7684\u4fe1\u606f</li> </ul> <p>\u53ef\u89c1\u8fd9\u4e2a\u53d1\u9001\u961f\u5217\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u94fe\u8868\uff1a</p> <pre><code>struct axi_dma_desc {\n  struct axi_dma_desc *nxtdesc;\n  void *buffer_address;\n  // omitted\n};\n</code></pre> <p>\u5f53 MM2S_TAILDESC \u88ab\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u786c\u4ef6\u4f1a\u4ece CURDESC \u5f00\u59cb\u9010\u4e2a Descriptor \u5904\u7406\uff0c\u76f4\u5230\u9047\u5230 TAILDESC \u4e3a\u6b62\uff1a</p> <pre><code>// when taildesc is changed\nvoid taildesc_changed() {\n  do {\n    dma_send(curdesc);\n    if (curdesc != taildesc) {\n      curdesc = curdesc-&gt;nxtdesc;\n    }\n  } while (curdesc != taildesc);\n}\n</code></pre> <p>\u6240\u4ee5\uff0c\u5b9e\u9645\u4e0a\u662f\u9a71\u52a8\u4e0d\u65ad\u5730\u63d0\u4f9b\u4e00\u4e2a\u94fe\u8868\u7ed9 AXI DMA \u53bb\u53d1\u9001\uff0c\u81f3\u4e8e\u8fd9\u4e2a\u94fe\u8868\u662f\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u8fd8\u662f\u7528\u4e00\u4e2a\u5faa\u73af\u961f\u5217\u53bb\u5b9e\u73b0\uff0c\u90fd\u662f\u53ef\u80fd\u7684\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#u-boot","title":"U-Boot","text":"<p>\u4e0b\u9762\u6765\u770b U-Boot \u7684\u4f8b\u5b50\uff0c\u9a71\u52a8\u662f xilinx_axi_emac.c\u3002\u8fd9\u4e2a\u9a71\u52a8\u7684\u5b9e\u73b0\u5f88\u7b80\u5355\uff1a\u6bcf\u6b21\u9700\u8981\u53d1\u9001\u7684\u65f6\u5019\uff0c\u53ea\u51c6\u5907\u4e00\u4e2a Descriptor\uff0c\u53d1\u5b8c\u5c31\u8f6e\u8be2\u76f4\u5230\u53d1\u9001\u6210\u529f\u3002\u663e\u7136\u8fd9\u4e2a\u5199\u6cd5\u6ca1\u6709\u5f88\u597d\u5730\u5229\u7528 DMA \u7684\u5f02\u6b65\u7279\u6027\uff0c\u4f46\u80dc\u5728\u7b80\u5355\u3002\u4e0b\u9762\u662f <code>axiemac_send</code> \u7684\u90e8\u5206\u6e90\u7801\uff1a</p> <pre><code>static int axiemac_send(struct udevice *dev, void *ptr, int len) {\n  /* Setup Tx BD */\n  memset(&amp;tx_bd, 0, sizeof(tx_bd));\n  /* At the end of the ring, link the last BD back to the top */\n  tx_bd.next_desc = lower_32_bits((unsigned long)&amp;tx_bd);\n  tx_bd.next_desc_msb = upper_32_bits((unsigned long)&amp;tx_bd);\n  tx_bd.buf_addr = lower_32_bits((unsigned long)ptr);\n  tx_bd.buf_addr_msb = upper_32_bits((unsigned long)ptr);\n  /* Save len */\n  tx_bd.cntrl = len | XAXIDMA_BD_CTRL_TXSOF_MASK |\n            XAXIDMA_BD_CTRL_TXEOF_MASK;\n\n  axienet_dma_write(&amp;tx_bd, &amp;priv-&gt;dmatx-&gt;current);\n\n  u32 temp;\n  /* Start the hardware */\n  temp = readl(&amp;priv-&gt;dmatx-&gt;control);\n  temp |= XAXIDMA_CR_RUNSTOP_MASK;\n  writel(temp, &amp;priv-&gt;dmatx-&gt;control);\n\n  /* Start transfer */\n  axienet_dma_write(&amp;tx_bd, &amp;priv-&gt;dmatx-&gt;tail);\n\n  /* Wait for transmission to complete */\n  debug(\"axiemac: Waiting for tx to be done\\n\");\n  timeout = 200;\n  while (timeout &amp;&amp; (!(readl(&amp;priv-&gt;dmatx-&gt;status) &amp;\n      (XAXIDMA_IRQ_DELAY_MASK | XAXIDMA_IRQ_IOC_MASK)))) {\n    timeout--;\n    udelay(1);\n  }\n}\n</code></pre>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#linux","title":"Linux","text":"<p>\u518d\u6765\u770b Linux \u7684 \u9a71\u52a8\uff1axilinx_axienet_main.c\u3002\u5b83\u91c7\u53d6\u7684\u65b9\u6cd5\u662f\u5206\u914d\u4e00\u4e2a Descriptor \u6570\u7ec4\uff0c\u7136\u540e\u628a\u6570\u7ec4\u7684\u6bcf\u4e00\u9879\u90fd\u6307\u5411\u4e0b\u4e00\u9879\uff08\u6700\u540e\u4e00\u9879\u6307\u5411\u7b2c\u4e00\u9879\uff09\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u5faa\u73af\u961f\u5217\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5c3e\u6307\u9488\u3002\u4e0b\u9762\u662f\u521d\u59cb\u5316\u4ee3\u7801\uff1a</p> <pre><code>static int axienet_dma_bd_init(struct net_device *ndev) {\n  /* Allocate the Tx and Rx buffer descriptors. */\n  lp-&gt;tx_bd_v = dma_alloc_coherent(lp-&gt;dev,\n           sizeof(*lp-&gt;tx_bd_v) * lp-&gt;tx_bd_num,\n           &amp;lp-&gt;tx_bd_p, GFP_KERNEL);\n\n  for (i = 0; i &lt; lp-&gt;tx_bd_num; i++) {\n    dma_addr_t addr = lp-&gt;tx_bd_p +\n          sizeof(*lp-&gt;tx_bd_v) *\n          ((i + 1) % lp-&gt;tx_bd_num);\n\n    lp-&gt;tx_bd_v[i].next = lower_32_bits(addr);\n    lp-&gt;tx_bd_v[i].next_msb = upper_32_bits(addr);\n  }\n\n  /* Write to the RS (Run-stop) bit in the Tx channel control register.\n   * Tx channel is now ready to run. But only after we write to the\n   * tail pointer register that the Tx channel will start transmitting.\n   */\n  axienet_dma_out_addr(lp, XAXIDMA_TX_CDESC_OFFSET, lp-&gt;tx_bd_p);\n  lp-&gt;tx_dma_cr |= XAXIDMA_CR_RUNSTOP_MASK;\n  axienet_dma_out32(lp, XAXIDMA_TX_CR_OFFSET, lp-&gt;tx_dma_cr);\n}\n</code></pre> <p>\u521d\u59cb\u5316\u597d\u4e86\u4ee5\u540e\uff0c\u6bcf\u5f53\u8981\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u5199\u5165 tail \u6307\u9488\u6307\u5411\u7684 Descriptor\uff0c\u7136\u540e\u589e\u52a0 tail \u6307\u9488\uff0c\u540c\u65f6\u544a\u8bc9\u786c\u4ef6\u5f00\u59cb DMA\uff1a</p> <pre><code>static netdev_tx_t\naxienet_start_xmit(struct sk_buff *skb, struct net_device *ndev) {\n  u32 num_frag = skb_shinfo(skb)-&gt;nr_frags;\n  if (axienet_check_tx_bd_space(lp, num_frag + 1)) {\n    return NETDEV_TX_BUSY;\n  }\n\n  phys = dma_map_single(lp-&gt;dev, skb-&gt;data,\n            skb_headlen(skb), DMA_TO_DEVICE);\n  desc_set_phys_addr(lp, phys, cur_p);\n  cur_p-&gt;cntrl = skb_headlen(skb) | XAXIDMA_BD_CTRL_TXSOF_MASK;\n\n  for (ii = 0; ii &lt; num_frag; ii++) {\n    if (++new_tail_ptr &gt;= lp-&gt;tx_bd_num)\n      new_tail_ptr = 0;\n    cur_p = &amp;lp-&gt;tx_bd_v[new_tail_ptr];\n    frag = &amp;skb_shinfo(skb)-&gt;frags[ii];\n    phys = dma_map_single(lp-&gt;dev,\n              skb_frag_address(frag),\n              skb_frag_size(frag),\n              DMA_TO_DEVICE);\n    desc_set_phys_addr(lp, phys, cur_p);\n    cur_p-&gt;cntrl = skb_frag_size(frag);\n  }\n\n  cur_p-&gt;cntrl |= XAXIDMA_BD_CTRL_TXEOF_MASK;\n  cur_p-&gt;skb = skb;\n\n  tail_p = lp-&gt;tx_bd_p + sizeof(*lp-&gt;tx_bd_v) * new_tail_ptr;\n  if (++new_tail_ptr &gt;= lp-&gt;tx_bd_num)\n    new_tail_ptr = 0;\n  WRITE_ONCE(lp-&gt;tx_bd_tail, new_tail_ptr);\n\n  /* Start the transfer */\n  axienet_dma_out_addr(lp, XAXIDMA_TX_TDESC_OFFSET, tail_p);\n}\n</code></pre> <p>\u5b9e\u73b0\u601d\u8def\uff1a</p> <ol> <li>\u68c0\u67e5\u662f\u5426\u6709\u8db3\u591f\u7684\u7a7a\u95f2 Descriptor</li> <li>\u5bf9\u4e8e\u8981\u53d1\u9001\u7684\u6570\u636e\u7684\u6bcf\u4e00\u6bb5\uff0c\u90fd\u586b\u5165\u4e00\u4e2a Descriptor</li> <li>\u5199\u5165\u65b0\u7684 tail \u6307\u9488\uff0c\u542f\u52a8 DMA</li> </ol> <p>\u90a3\u4e48\uff0c\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u77e5\u9053\u786c\u4ef6\u5b8c\u6210\u4e86 DMA \u4f20\u8f93\uff0c\u91ca\u653e\u4e86 Descriptor \u5462\uff1f\u7b54\u6848\u662f\uff0cAXI DMA \u4f20\u8f93\u5b8c\u6210\u65f6\uff0c\u4f1a\u901a\u8fc7\u4e2d\u65ad\u901a\u77e5 CPU\uff0cLinux \u6700\u7ec8\u4f1a\u8c03\u7528 <code>axienet_free_tx_chain</code> \u51fd\u6570\uff1a</p> <pre><code>static int axienet_free_tx_chain(struct axienet_local *lp, u32 first_bd,\n         int nr_bds, bool force, u32 *sizep, int budget) {\n\n  struct axidma_bd *cur_p;\n  unsigned int status;\n  dma_addr_t phys;\n  int i;\n\n  for (i = 0; i &lt; nr_bds; i++) {\n    cur_p = &amp;lp-&gt;tx_bd_v[(first_bd + i) % lp-&gt;tx_bd_num];\n    status = cur_p-&gt;status;\n\n    /* If force is not specified, clean up only descriptors\n     * that have been completed by the MAC.\n     */\n    if (!force &amp;&amp; !(status &amp; XAXIDMA_BD_STS_COMPLETE_MASK))\n      break;\n\n    /* Ensure we see complete descriptor update */\n    dma_rmb();\n    phys = desc_get_phys_addr(lp, cur_p);\n    dma_unmap_single(lp-&gt;dev, phys,\n         (cur_p-&gt;cntrl &amp; XAXIDMA_BD_CTRL_LENGTH_MASK),\n         DMA_TO_DEVICE);\n\n    if (cur_p-&gt;skb &amp;&amp; (status &amp; XAXIDMA_BD_STS_COMPLETE_MASK))\n      napi_consume_skb(cur_p-&gt;skb, budget);\n\n    cur_p-&gt;app0 = 0;\n    cur_p-&gt;app1 = 0;\n    cur_p-&gt;app2 = 0;\n    cur_p-&gt;app4 = 0;\n    cur_p-&gt;skb = NULL;\n    /* ensure our transmit path and device don't prematurely see status cleared */\n    wmb();\n    cur_p-&gt;cntrl = 0;\n    cur_p-&gt;status = 0;\n  }\n\n  return i;\n}\n</code></pre> <p>\u4ece\u4ee3\u7801\u6765\u770b\uff0c\u5176\u5b9e\u4e5f\u5f88\u7b80\u5355\uff1aAXI DMA \u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u4f1a\u8bbe\u7f6e status \u7684\u5185\u5bb9\uff0c\u6807\u8bb0\u5df2\u7ecf\u4f20\u8f93\u5b8c\u6210\u3002\u8fd9\u65f6\u5019\u53ea\u8981\u4ece\u6700\u540e\u4e00\u6b21\u5b8c\u6210\u4f20\u8f93\u7684 Descriptor \u5f00\u59cb\u626b\u63cf\uff0c\u628a\u6240\u6709\u5b8c\u6210\u4f20\u8f93\u7684 Descriptor \u56de\u6536\u5373\u53ef\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u63a5\u6536\u961f\u5217","title":"\u63a5\u6536\u961f\u5217","text":"<p>\u63a5\u6536\u961f\u5217\u7ed3\u6784\u4e0e\u53d1\u9001\u961f\u5217\u76f8\u4f3c\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u89d2\u8272\u5bf9\u8c03\uff0c\u9a71\u52a8\u4e3a\u4e86\u4fdd\u8bc1\u968f\u65f6\u53ef\u4ee5\u63a5\u6536\u6570\u636e\uff0c\u9700\u8981\u9884\u5148\u51c6\u5907\u597d Descriptor\uff0c\u5f53 AXI DMA \u4ece\u4ee5\u592a\u7f51 MAC \u6536\u5230\u6570\u636e\u7684\u65f6\u5019\uff0c\u968f\u65f6\u6709 Descriptor \u53ef\u4ee5\u4f7f\u7528\uff0c\u5199\u5165\u6570\u636e\u540e\uff0c\u518d\u901a\u77e5 CPU\u3002\u548c\u53d1\u9001\u961f\u5217\u4e00\u6837\uff0c\u63a5\u6536\u961f\u5217\u7531\u4e00\u4e2a\u5934\u6307\u9488\uff08S2MM_CURDESC\uff09\u548c\u4e00\u4e2a\u5c3e\u6307\u9488\u5b9a\u4e49\uff08S2MM_TAILDESC\uff09\uff0c\u6307\u9488\u6307\u5411\u7684 Descriptor \u7ed3\u6784\u4e0e\u53d1\u9001\u961f\u5217\u4e00\u81f4\u3002\u786c\u4ef6\u7684\u63a5\u6536\u903b\u8f91\u548c\u53d1\u9001\u903b\u8f91\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u65b9\u5411\u76f8\u53cd\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#u-boot_1","title":"U-Boot","text":"<p>\u9996\u5148\u8fd8\u662f\u6765\u770b U-Boot \u7684\u5b9e\u73b0\u3002\u524d\u9762\u63d0\u5230\uff0c\u4e3a\u4e86\u7b80\u5316\uff0cU-Boot \u7684\u7f51\u5361\u9a71\u52a8\u6bcf\u6b21\u540c\u65f6\u53ea\u4f1a\u53d1\u9001\u4e00\u4e2a\u5e27\uff0c\u63a5\u6536\u7684\u65f6\u5019\u5176\u5b9e\u4e5f\u4e00\u6837\uff1a</p> <pre><code>(some net operation (ping / tftp / whatever...))\neth_init()\n  ops-&gt;start()\neth_send()\n  ops-&gt;send()\neth_rx()\n  ops-&gt;recv()\n  (process packet)\n  if (ops-&gt;free_pkt)\n    ops-&gt;free_pkt()\neth_halt()\n  ops-&gt;stop()\n</code></pre> <p>\u9996\u5148\u770b AXI EMAC \u9a71\u52a8\u5982\u4f55\u521d\u59cb\u5316\u63a5\u6536\u961f\u5217\uff1a</p> <pre><code>static u8 rxframe[PKTSIZE_ALIGN] __attribute((aligned(DMAALIGN)));\n\nstatic int axiemac_start(struct udevice *dev) {\n  /* Start DMA RX channel. Now it's ready to receive data.*/\n  axienet_dma_write(&amp;rx_bd, &amp;priv-&gt;dmarx-&gt;current);\n\n  /* Setup the BD. */\n  memset(&amp;rx_bd, 0, sizeof(rx_bd));\n  rx_bd.next_desc = lower_32_bits((unsigned long)&amp;rx_bd);\n  rx_bd.next_desc_msb = upper_32_bits((unsigned long)&amp;rx_bd);\n  rx_bd.buf_addr = lower_32_bits((unsigned long)&amp;rxframe);\n  rx_bd.buf_addr_msb = upper_32_bits((unsigned long)&amp;rxframe);\n  rx_bd.cntrl = sizeof(rxframe);\n  /* Flush the last BD so DMA core could see the updates */\n  flush_cache((phys_addr_t)&amp;rx_bd, sizeof(rx_bd));\n\n  /* It is necessary to flush rxframe because if you don't do it\n   * then cache can contain uninitialized data */\n  flush_cache((phys_addr_t)&amp;rxframe, sizeof(rxframe));\n\n  /* Start the hardware */\n  temp = readl(&amp;priv-&gt;dmarx-&gt;control);\n  temp |= XAXIDMA_CR_RUNSTOP_MASK;\n  writel(temp, &amp;priv-&gt;dmarx-&gt;control);\n\n  /* Rx BD is ready - start */\n  axienet_dma_write(&amp;rx_bd, &amp;priv-&gt;dmarx-&gt;tail);\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5b83\u53ea\u521d\u59cb\u5316\u4e86\u4e00\u4e2a Descriptor\uff0c\u5e76\u4e14\u628a CURDESC \u548c TAILDESC \u90fd\u6307\u5411\u5b83\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7f13\u51b2\u533a <code>rxframe</code>\u3002\u5f53 AXI DMA \u63a5\u6536\u5230\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u628a\u6570\u636e\u5199\u5165 <code>rxframe</code>\uff0c\u66f4\u65b0 <code>rx_bd</code> \u5e76\u53d1\u9001\u4e2d\u65ad\u3002U-Boot \u5904\u7406\u4e2d\u65ad\u7684\u65b9\u6cd5\u4e5f\u5f88\u7b80\u5355\uff1a</p> <pre><code>static int axiemac_recv(struct udevice *dev, int flags, uchar **packetp) {\n  /* Disable IRQ for a moment till packet is handled */\n  temp = readl(&amp;priv-&gt;dmarx-&gt;control);\n  temp &amp;= ~XAXIDMA_IRQ_ALL_MASK;\n  writel(temp, &amp;priv-&gt;dmarx-&gt;control);\n\n  length = rx_bd.status &amp; XAXIDMA_BD_STS_ACTUAL_LEN_MASK;\n  *packetp = rxframe;\n  return length;\n}\n</code></pre> <p>\u5b83\u5173\u95ed\u4e86 AXI DMA \u7684\u4e2d\u65ad\uff0c\u7136\u540e\u76f4\u63a5\u8bfb\u53d6\u957f\u5ea6\uff0c\u628a <code>rxframe</code> \u4f5c\u4e3a\u6570\u636e\u6307\u9488\u4f20\u7ed9\u7f51\u7edc\u6808\u5904\u7406\u7684\u51fd\u6570\u3002\u7f51\u7edc\u6808\u5904\u7406\u5b8c\u4ee5\u540e\uff0c\u5c31\u4f1a\u8c03\u7528 <code>free_pkt</code> \u8fdb\u884c\u6536\u5c3e\uff1a</p> <pre><code>static int axiemac_free_pkt(struct udevice *dev, uchar *packet, int length) {\n#ifdef DEBUG\n  /* It is useful to clear buffer to be sure that it is consistent */\n  memset(rxframe, 0, sizeof(rxframe));\n#endif\n  /* Setup RxBD */\n  /* Clear the whole buffer and setup it again - all flags are cleared */\n  memset(&amp;rx_bd, 0, sizeof(rx_bd));\n  rx_bd.next_desc = lower_32_bits((unsigned long)&amp;rx_bd);\n  rx_bd.next_desc_msb = upper_32_bits((unsigned long)&amp;rx_bd);\n  rx_bd.buf_addr = lower_32_bits((unsigned long)&amp;rxframe);\n  rx_bd.buf_addr_msb = upper_32_bits((unsigned long)&amp;rxframe);\n  rx_bd.cntrl = sizeof(rxframe);\n\n  /* Write bd to HW */\n  flush_cache((phys_addr_t)&amp;rx_bd, sizeof(rx_bd));\n\n  /* It is necessary to flush rxframe because if you don't do it\n   * then cache will contain previous packet */\n  flush_cache((phys_addr_t)&amp;rxframe, sizeof(rxframe));\n\n  /* Rx BD is ready - start again */\n  axienet_dma_write(&amp;rx_bd, &amp;priv-&gt;dmarx-&gt;tail);\n}\n</code></pre> <p>\u6536\u5c3e\u5de5\u4f5c\u4e5f\u5f88\u7b80\u5355\uff0c\u628a\u63a5\u6536\u961f\u5217\u6062\u590d\u5230\u53ef\u4ee5\u63a5\u6536\u6570\u636e\u7684\u72b6\u6001\u5373\u53ef\uff0c\u56e0\u4e3a <code>rxframe</code> \u662f\u5168\u5c40\u53d8\u91cf\uff0c\u4e5f\u4e0d\u9700\u8981\u8fdb\u884c <code>free</code>\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#linux_1","title":"Linux","text":"<p>Linux \u7684\u9a71\u52a8\u5b9e\u73b0\u91cc\uff0c\u63a5\u6536\u961f\u5217\u548c\u53d1\u9001\u961f\u5217\u7c7b\u4f3c\uff0c\u4e5f\u662f\u7528\u4e00\u4e2a\u6570\u7ec4\u6765\u5b9e\u73b0\u5faa\u73af\u94fe\u8868\uff0c\u53ea\u4e0d\u8fc7\u63a5\u6536\u961f\u5217\u8fd8\u9700\u8981\u63d0\u524d\u51c6\u5907\u597d\u7f13\u51b2\u533a\uff0c\u4f9b AXI DMA \u5199\u5165\uff1a</p> <pre><code>static int axienet_dma_bd_init(struct net_device *ndev) {\n  lp-&gt;rx_bd_v = dma_alloc_coherent(lp-&gt;dev,\n           sizeof(*lp-&gt;rx_bd_v) * lp-&gt;rx_bd_num,\n           &amp;lp-&gt;rx_bd_p, GFP_KERNEL);\n  for (i = 0; i &lt; lp-&gt;rx_bd_num; i++) {\n    dma_addr_t addr;\n\n    addr = lp-&gt;rx_bd_p + sizeof(*lp-&gt;rx_bd_v) *\n      ((i + 1) % lp-&gt;rx_bd_num);\n    lp-&gt;rx_bd_v[i].next = lower_32_bits(addr);\n    lp-&gt;rx_bd_v[i].next_msb = upper_32_bits(addr);\n\n    skb = netdev_alloc_skb_ip_align(ndev, lp-&gt;max_frm_size);\n\n    lp-&gt;rx_bd_v[i].skb = skb;\n    addr = dma_map_single(lp-&gt;dev, skb-&gt;data,\n              lp-&gt;max_frm_size, DMA_FROM_DEVICE);\n    desc_set_phys_addr(lp, addr, &amp;lp-&gt;rx_bd_v[i]);\n\n    lp-&gt;rx_bd_v[i].cntrl = lp-&gt;max_frm_size;\n  }\n\n  /* Populate the tail pointer and bring the Rx Axi DMA engine out of\n   * halted state. This will make the Rx side ready for reception.\n   */\n  axienet_dma_out_addr(lp, XAXIDMA_RX_CDESC_OFFSET, lp-&gt;rx_bd_p);\n  lp-&gt;rx_dma_cr |= XAXIDMA_CR_RUNSTOP_MASK;\n  axienet_dma_out32(lp, XAXIDMA_RX_CR_OFFSET, lp-&gt;rx_dma_cr);\n  axienet_dma_out_addr(lp, XAXIDMA_RX_TDESC_OFFSET, lp-&gt;rx_bd_p +\n           (sizeof(*lp-&gt;rx_bd_v) * (lp-&gt;rx_bd_num - 1)));\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6570\u7ec4\u7684\u6bcf\u4e00\u9879\u7684\u6307\u9488\u6307\u5411\u4e0b\u4e00\u9879\uff0c\u7136\u540e\u628a\u5934\u5730\u5740\u5199\u5165 CURDESC\uff0c\u5c3e\u5730\u5740\u5199\u5165 TAILDESC\uff0c\u8fd9\u6837\u786c\u4ef6\u5c31\u53ef\u4ee5\u5f00\u59cb\u63a5\u6536\u6570\u636e\u3002AXI DMA \u6536\u5230\u6570\u636e\u4ee5\u540e\uff0c\u4f1a\u628a\u6570\u636e\u5199\u5165 Descriptor \u6307\u5411\u7684\u7f13\u51b2\u533a\u5730\u5740\uff0c\u7136\u540e\u53d1\u9001\u4e2d\u65ad\uff0cLinux \u6267\u884c\u4e0b\u5217\u4ee3\u7801\u5904\u7406\u4e2d\u65ad\uff1a</p> <pre><code>static int axienet_rx_poll(struct napi_struct *napi, int budget) {\n  cur_p = &amp;lp-&gt;rx_bd_v[lp-&gt;rx_bd_ci];\n\n  while (packets &lt; budget &amp;&amp; (cur_p-&gt;status &amp; XAXIDMA_BD_STS_COMPLETE_MASK)) {\n    dma_addr_t phys;\n\n    /* Ensure we see complete descriptor update */\n    dma_rmb();\n\n    skb = cur_p-&gt;skb;\n    cur_p-&gt;skb = NULL;\n\n    /* skb could be NULL if a previous pass already received the\n     * packet for this slot in the ring, but failed to refill it\n     * with a newly allocated buffer. In this case, don't try to\n     * receive it again.\n     */\n    if (likely(skb)) {\n      length = cur_p-&gt;app4 &amp; 0x0000FFFF;\n\n      phys = desc_get_phys_addr(lp, cur_p);\n      dma_unmap_single(lp-&gt;dev, phys, lp-&gt;max_frm_size,\n           DMA_FROM_DEVICE);\n\n      skb_put(skb, length);\n      skb-&gt;protocol = eth_type_trans(skb, lp-&gt;ndev);\n\n      napi_gro_receive(napi, skb);\n\n      size += length;\n      packets++;\n    }\n\n    new_skb = napi_alloc_skb(napi, lp-&gt;max_frm_size);\n\n    phys = dma_map_single(lp-&gt;dev, new_skb-&gt;data,\n              lp-&gt;max_frm_size,\n              DMA_FROM_DEVICE);\n    desc_set_phys_addr(lp, phys, cur_p);\n\n    cur_p-&gt;cntrl = lp-&gt;max_frm_size;\n    cur_p-&gt;status = 0;\n    cur_p-&gt;skb = new_skb;\n\n    /* Only update tail_p to mark this slot as usable after it has\n     * been successfully refilled.\n     */\n    tail_p = lp-&gt;rx_bd_p + sizeof(*lp-&gt;rx_bd_v) * lp-&gt;rx_bd_ci;\n\n    if (++lp-&gt;rx_bd_ci &gt;= lp-&gt;rx_bd_num)\n      lp-&gt;rx_bd_ci = 0;\n    cur_p = &amp;lp-&gt;rx_bd_v[lp-&gt;rx_bd_ci];\n  }\n\n  if (tail_p)\n    axienet_dma_out_addr(lp, XAXIDMA_RX_TDESC_OFFSET, tail_p);\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u63a5\u6536\u903b\u8f91\u987a\u5e8f\u626b\u63cf\u4e86 Descriptor\uff0c\u627e\u5230\u90a3\u4e9b\u4f20\u8f93\u5b8c\u6210\u7684\uff0c\u628a\u5176\u4e2d\u7684\u6570\u636e\u4ea4\u7ed9\u7f51\u7edc\u6808\u5904\u7406\uff0c\u7136\u540e\u5206\u914d\u4e00\u4e2a\u65b0\u7684 skb\uff0c\u7ed1\u5b9a\u5230 Descriptor \u4e0a\uff0c\u628a\u5b83\u6062\u590d\u5230\u53ef\u4ee5\u63a5\u6536\u6570\u636e\u7684\u72b6\u6001\uff0c\u6700\u540e\u66f4\u65b0 TAILDESC\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>AXI DMA \u63d0\u4f9b\u4e86\u4e00\u4e2a Descriptor \u94fe\u6765\u5f02\u6b65\u5730\u4f20\u8f93\u6570\u636e\uff0cU-Boot \u4e3a\u4e86\u7b80\u5316\uff0c\u628a\u94fe\u8868\u9000\u5316\u6210\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\uff0c\u4e32\u884c\u5730\u6536\u548c\u53d1\uff1bLinux \u4f7f\u7528\u6570\u7ec4\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5faa\u73af\u7684\u94fe\u8868\uff0c\u901a\u8fc7 TAILDESC \u63d0\u4f9b\u65b0\u7684 Descriptor\uff0c\u7136\u540e\u4ece CURDESC \u56de\u6536 Descriptor\u3002Descriptor \u4e0d\u65ad\u5728\u786c\u4ef6\u548c\u8f6f\u4ef6\u4e4b\u95f4\u4ea4\u66ff\uff0cCURDESC \u5230 TAILDESC \u7684\u90e8\u5206\u5f52\u786c\u4ef6\uff0c\u5176\u4f59\u7684\u5f52\u8f6f\u4ef6\u3002\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u5728\u5176\u4ed6\u5f88\u591a\u5730\u65b9\u4e5f\u53ef\u4ee5\u770b\u5230\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#intel-82599","title":"Intel 82599","text":"<p>Intel 82599 \u662f\u4e00\u4e2a\u6709\u7ebf\u7f51\u5361\uff0cLinux \u7684\u9a71\u52a8\u662f ixgbe\u3002Intel 82599 \u4e3a\u6536\u548c\u53d1\u90fd\u63d0\u4f9b\u4e86\u591a\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a\u961f\u5217\u90fd\u5bf9\u5e94\u4e86\u4e00\u4e2a Descriptor \u6570\u7ec4\uff0c\u5728\u5185\u5b58\u4e2d\u8fde\u7eed\u5b58\u653e\u3002Linux \u9a71\u52a8\u4f7f\u7528\u4e86 64 \u4e2a\u63a5\u6536\u961f\u5217\u548c\u53d1\u9001\u961f\u5217\u3002</p> <p>\u6587\u6863\u94fe\u63a5\uff1ahttps://cdrdv2-public.intel.com/331520/82599-datasheet-v3-4.pdf</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u63a5\u6536\u961f\u5217_1","title":"\u63a5\u6536\u961f\u5217","text":"<p>\u548c AXI DMA \u7684\u94fe\u8868\u5f62\u5f0f\u4e0d\u540c\u3002\u6bcf\u4e2a\u63a5\u6536\u961f\u5217\u90fd\u7531\u5982\u4e0b\u7684\u5bc4\u5b58\u5668\u5b9a\u4e49\uff1a</p> <ul> <li>RDBAL/RDBAH[n]: Receive Descriptor Base Address Low/High</li> <li>RDLEN[n]: Receive Descriptor Length</li> <li>RDH[n]: Receive Descriptor Head</li> <li>RDT[n]: Receive Descriptor Tail</li> </ul> <p>\u7531\u57fa\u5730\u5740 + \u957f\u5ea6\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5faa\u73af\u961f\u5217\uff0c\u7136\u540e\u4ece Head \u5230 Tail \u7684\u90e8\u5206\u662f\u5f53\u524d\u6709\u6548\u7684\u961f\u5217\uff0c\u8f6f\u4ef6\u4ece Tail \u63d2\u5165\u65b0\u7684 Descriptor\uff0c\u786c\u4ef6\u4ece Head \u53d6 Descriptor\u3002\u5f53 Head \u7b49\u4e8e Tail \u7684\u65f6\u5019\uff0c\u961f\u5217\u662f\u7a7a\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 Tail \u8868\u793a\u7684\u662f\u5408\u6cd5\u7684\u4e0b\u4e00\u4e2a\uff0c\u8fd9\u6837\u961f\u5217\u6ee1\u7684\u65f6\u5019 Tail + 1 == Head\u3002</p> <p>ixgbe \u7684\u5b9e\u73b0\u4ee3\u7801\u5728 <code>ixgbe_main.c</code> \u4e2d\uff0c\u9996\u5148\u770b\u5982\u4f55\u521d\u59cb\u5316\u63a5\u6536\u961f\u5217\uff1a</p> <pre><code>static void ixgbe_configure_rx(struct ixgbe_adapter *adapter) {\n  /*\n   * Setup the HW Rx Head and Tail Descriptor Pointers and\n   * the Base and Length of the Rx Descriptor Ring\n   */\n  for (i = 0; i &lt; adapter-&gt;num_rx_queues; i++)\n    ixgbe_configure_rx_ring(adapter, adapter-&gt;rx_ring[i]);\n}\n\nvoid ixgbe_configure_rx_ring(struct ixgbe_adapter *adapter,\n           struct ixgbe_ring *ring) {\n  u64 rdba = ring-&gt;dma;\n  IXGBE_WRITE_REG(hw, IXGBE_RDBAL(reg_idx), (rdba &amp; DMA_BIT_MASK(32)));\n  IXGBE_WRITE_REG(hw, IXGBE_RDBAH(reg_idx), (rdba &gt;&gt; 32));\n  IXGBE_WRITE_REG(hw, IXGBE_RDLEN(reg_idx),\n      ring-&gt;count * sizeof(union ixgbe_adv_rx_desc));\n\n  IXGBE_WRITE_REG(hw, IXGBE_RDH(reg_idx), 0);\n  IXGBE_WRITE_REG(hw, IXGBE_RDT(reg_idx), 0);\n  ring-&gt;tail = adapter-&gt;io_addr + IXGBE_RDT(reg_idx);\n\n  /* enable receive descriptor ring */\n  rxdctl |= IXGBE_RXDCTL_ENABLE;\n  IXGBE_WRITE_REG(hw, IXGBE_RXDCTL(reg_idx), rxdctl);\n\n  /* in ixgbe_alloc_rx_buffers */\n  bufsz = ixgbe_rx_bufsz(rx_ring);\n\n  do {\n    if (!ixgbe_alloc_mapped_page(rx_ring, bi))\n      break;\n\n    /* sync the buffer for use by the device */\n    dma_sync_single_range_for_device(rx_ring-&gt;dev, bi-&gt;dma,\n             bi-&gt;page_offset, bufsz,\n             DMA_FROM_DEVICE);\n\n    /*\n     * Refresh the desc even if buffer_addrs didn't change\n     * because each write-back erases this info.\n     */\n    rx_desc-&gt;read.pkt_addr = cpu_to_le64(bi-&gt;dma + bi-&gt;page_offset);\n\n    rx_desc++;\n    /* clear the length for the next_to_use descriptor */\n    rx_desc-&gt;wb.upper.length = 0;\n\n    cleaned_count--;\n  } while (cleaned_count);\n\n  writel(i, rx_ring-&gt;tail);\n}\n</code></pre> <p>\u5177\u4f53\u5230\u5b9e\u73b0\u4e0a\uff0c\u53ef\u4ee5\u770b\u5230\u548c AXI DMA \u9a71\u52a8\u57fa\u672c\u662f\u4e00\u6837\u7684\uff1a\u5206\u914d Descriptor \u6570\u7ec4\u7a7a\u95f4\uff0c\u7136\u540e\u7ed9\u6bcf\u4e2a Descriptor \u5206\u914d\u4e00\u4e2a Buffer\uff0c\u7136\u540e\u66f4\u65b0 tail \u6307\u9488\uff0c\u8ba9\u786c\u4ef6\u53ef\u4ee5\u5f00\u59cb\u8fdb\u884c\u63a5\u6536\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u53d1\u9001\u961f\u5217_1","title":"\u53d1\u9001\u961f\u5217","text":"<p>\u53d1\u9001\u961f\u5217\u548c\u63a5\u6536\u961f\u5217\u7c7b\u4f3c\uff0c\u4e5f\u662f\u5148\u5206\u914d\u597d Descriptor \u6570\u7ec4\uff0c\u53ea\u4e0d\u8fc7\u5148\u4e0d\u586b\u5185\u5bb9\uff0c\u7b49\u5230\u8981\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u518d\u4ece tail \u53d6\u51fa\u4e00\u4e2a Descriptor\uff0c\u5199\u5165 buffer \u5730\u5740\uff0c\u7136\u540e\u66f4\u65b0 tail \u6307\u9488\u8ba9\u786c\u4ef6\u53d1\u9001\u3002\u4ee3\u7801\uff1a</p> <pre><code>netdev_tx_t ixgbe_xmit_frame_ring(struct sk_buff *skb,\n        struct ixgbe_adapter *adapter,\n        struct ixgbe_ring *tx_ring) {\n  /* record the location of the first descriptor for this packet */\n  first = &amp;tx_ring-&gt;tx_buffer_info[tx_ring-&gt;next_to_use];\n  first-&gt;skb = skb;\n  first-&gt;bytecount = skb-&gt;len;\n\n  /* in ixgbe_tx_map */\n  dma = dma_map_single(tx_ring-&gt;dev, skb-&gt;data, size, DMA_TO_DEVICE);\n\n  for (frag = &amp;skb_shinfo(skb)-&gt;frags[0];; frag++) {\n    if (dma_mapping_error(tx_ring-&gt;dev, dma))\n      goto dma_error;\n\n    /* record length, and DMA address */\n    dma_unmap_len_set(tx_buffer, len, size);\n    dma_unmap_addr_set(tx_buffer, dma, dma);\n\n    tx_desc-&gt;read.buffer_addr = cpu_to_le64(dma);\n\n    while (unlikely(size &gt; IXGBE_MAX_DATA_PER_TXD)) {\n      tx_desc-&gt;read.cmd_type_len =\n        cpu_to_le32(cmd_type ^ IXGBE_MAX_DATA_PER_TXD);\n\n      i++;\n      tx_desc++;\n      if (i == tx_ring-&gt;count) {\n        tx_desc = IXGBE_TX_DESC(tx_ring, 0);\n        i = 0;\n      }\n      tx_desc-&gt;read.olinfo_status = 0;\n\n      dma += IXGBE_MAX_DATA_PER_TXD;\n      size -= IXGBE_MAX_DATA_PER_TXD;\n\n      tx_desc-&gt;read.buffer_addr = cpu_to_le64(dma);\n    }\n\n    tx_desc-&gt;read.cmd_type_len = cpu_to_le32(cmd_type ^ size);\n\n    i++;\n    tx_desc++;\n    if (i == tx_ring-&gt;count) {\n      tx_desc = IXGBE_TX_DESC(tx_ring, 0);\n      i = 0;\n    }\n    tx_desc-&gt;read.olinfo_status = 0;\n\n    size = skb_frag_size(frag);\n    data_len -= size;\n\n    dma = skb_frag_dma_map(tx_ring-&gt;dev, frag, 0, size,\n               DMA_TO_DEVICE);\n\n    tx_buffer = &amp;tx_ring-&gt;tx_buffer_info[i];\n  }\n\n  i++;\n  if (i == tx_ring-&gt;count)\n    i = 0;\n\n  tx_ring-&gt;next_to_use = i;\n\n  ixgbe_maybe_stop_tx(tx_ring, DESC_NEEDED);\n\n  if (netif_xmit_stopped(txring_txq(tx_ring)) || !netdev_xmit_more()) {\n    writel(i, tx_ring-&gt;tail);\n  }\n}\n</code></pre> <p>\u8fd9\u4e00\u6bb5\u4ee3\u7801\u7684\u601d\u8def\u662f\uff0c\u5bf9\u4e8e skb \u7684\u6bcf\u4e2a frag\uff0c\u5c1d\u8bd5\u586b\u5165 Descriptor\uff0c\u5982\u679c\u53d1\u73b0\u586b\u4e0d\u4e0b\uff0c\u5c31\u586b\u591a\u4e2a\uff0c\u76f4\u5230\u586b\u5b8c\u4f4d\u7f6e\uff0c\u6700\u540e\u66f4\u65b0 tail \u6307\u9488\uff0c\u8ba9\u786c\u4ef6\u5f00\u59cb\u53d1\u9001\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#\u5c0f\u7ed3_1","title":"\u5c0f\u7ed3","text":"<p>\u5728\u4e86\u89e3 AXI DMA \u7684\u5de5\u4f5c\u539f\u7406\u7684\u57fa\u7840\u4e0a\uff0cIntel 82599 \u7684\u961f\u5217\u5176\u5b9e\u4e5f\u4e0d\u590d\u6742\uff0c\u53ea\u4e0d\u8fc7\u76f4\u63a5\u91c7\u53d6\u4e86\u4ee5 Descriptor \u6570\u7ec4\u4f5c\u4e3a\u5faa\u73af\u961f\u5217\u7684\u65b9\u5f0f\uff0c\u5e76\u4e14\u8fd9\u91cc\u5f52\u5c5e\u4e8e\u786c\u4ef6\u7684 Descriptor \u7a7a\u95f4\u5176\u5b9e\u662f [Head, Tail) \u5de6\u95ed\u53f3\u5f00\u533a\u95f4\u7684\u5f62\u5f0f\uff08AXI DMA \u662f\u94fe\u8868\u7684\u5934\u548c\u5c3e\uff0c\u90fd\u5c5e\u4e8e\u786c\u4ef6\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528 Head == Tail \u6765\u8868\u793a\u7a7a\u961f\u5217\uff0c\u5f53\u7136\u4e86\uff0c\u961f\u5217\u4e5f\u6c38\u8fdc\u4f1a\u5dee\u4e00\u9879\u624d\u80fd\u6ee1\uff08\u9664\u975e\u989d\u5916\u8bb0\u5f55\u961f\u5217\u4e2d\u5408\u6cd5\u5143\u7d20\u4e2a\u6570\uff09\u3002\u6700\u540e\u8d34\u4e00\u5f20 Intel 82599 Datasheet \u4e2d\u7684\u56fe\u7247\u6765\u5e2e\u52a9\u7406\u89e3\uff1a</p> <p></p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#connectx-4","title":"ConnectX-4","text":"<p>\u63a5\u4e0b\u6765\u770b\u770b ConnectX-4 \u662f\u5982\u4f55\u8bbe\u8ba1\u5b83\u7684\u5404\u4e2a\u961f\u5217\u7684\u3002\u9996\u5148\uff0c\u5b83\u6709 Work Queue\uff0c\u7528\u4e8e\u53d1\u9001\u6570\u636e\uff08Send Queue\uff09\u548c\u51c6\u5907\u63a5\u6536\u6570\u636e\u7684\u7f13\u51b2\u533a\uff08Receive Queue\uff09\uff0c\u7136\u540e\u786c\u4ef6\u5904\u7406 Work Queue \u4e2d\u7684 Entry \u540e\uff0c\u5c31\u4f1a\u628a\u7ed3\u679c\u5199\u5165\u5230 Completion Queue\uff0c\u5e76\u4e14\u901a\u8fc7 Event Queue \u901a\u77e5 CPU\u3002</p> <p>\u6587\u6863\uff1ahttps://network.nvidia.com/files/doc-2020/ethernet-adapters-programming-manual.pdf</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#work-queue","title":"Work Queue","text":"<p>Work Queue \u548c\u524d\u9762 Intel 82599 \u7684\u8bbe\u8ba1\u5f88\u50cf\uff0c\u4e5f\u662f\u4e00\u4e2a Descriptor \u7684\u6570\u7ec4\u7684\u5f62\u5f0f\uff0c\u53ea\u4e0d\u8fc7 Work Queue Entry \u662f\u4e0d\u5b9a\u957f\u7684\uff0c\u652f\u6301\u4e0d\u540c\u7684 Entry Format\uff0c\u4f8b\u5982 Send WQE\u3001Receive WQE \u548c Shared Receive WQE\u3002</p> <p>\u9a71\u52a8\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u521b\u5efa\u597d Work Queue\uff1a</p> <pre><code>static int mlx5e_open_queues(struct mlx5e_channel *c,\n           struct mlx5e_params *params,\n           struct mlx5e_channel_param *cparam) {\n  err = mlx5e_open_sqs(c, params, cparam);\n\n  err = mlx5e_open_rxq_rq(c, params, &amp;cparam-&gt;rq);\n}\n</code></pre> <p>\u4e4b\u540e\uff0c\u548c Intel 82599 \u7c7b\u4f3c\uff0c\u53d1\u9001\u7684\u65f6\u5019\u5c31\u5411 Send Queue \u63d2\u5165 Entry\uff0c\u7136\u540e\u66f4\u65b0 Doorbell \u8ba9\u786c\u4ef6\u5f00\u59cb\u53d1\u9001\uff1b\u4e3a\u4e86\u63a5\u6536\uff0c\u5148\u5206\u914d\u597d\u7f13\u51b2\u533a\uff0c\u521d\u59cb\u5316 Receive Queue\uff0c\u66f4\u65b0 Doorbell \u8ba9\u786c\u4ef6\u5f00\u59cb\u63a5\u6536\u6570\u636e\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#completion-queue","title":"Completion Queue","text":"<p>\u548c Intel 82599 \u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u91cc\u8868\u793a\u9879\u76ee\u5b8c\u6210\u662f\u901a\u8fc7 Completion Queue \u5b8c\u6210\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u786c\u4ef6\u4f1a\u5411 Completion Queue \u63d2\u5165\u4e00\u9879\uff0c\u6765\u8868\u793a\u5bf9\u5e94\u7684 Work Queue Entry \u5b8c\u6210\u60c5\u51b5\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u4e0b\uff0cWork Queue \u5b8c\u5168\u7531\u8f6f\u4ef6\u5199\u5165\uff0cCompletion Queue \u5b8c\u5168\u7531\u786c\u4ef6\u5199\u5165\uff0c\u4e0d\u50cf\u524d\u9762 AXI DMA \u548c Intel 82599 \u90a3\u6837\u786c\u4ef6\u4f1a\u66f4\u65b0 Descriptor \u91cc\u9762\u7684\u72b6\u6001\u4f4d\u3002Completion Queue \u4e5f\u6709\u4e24\u4e2a Counter\uff0c\u76f8\u5f53\u4e8e\u961f\u5217\u7684\u5934\u548c\u5c3e\u6307\u9488\uff1aProducer Counter \u8bb0\u5f55\u4e86\u786c\u4ef6\u5199\u5165\u7684 Completion Queue Entry\uff08CQE\uff09\u6570\u91cf\uff0cConsumer Counter \u8bb0\u5f55\u4e86\u8f6f\u4ef6\u5df2\u7ecf\u5904\u7406\u4e86\u7684 CQE \u6570\u91cf\u3002\u5728\u8fd9\u91cc\u6709\u4e00\u4e2a\u6bd4\u8f83\u6709\u610f\u601d\u7684\u8bbe\u8ba1\uff1a</p> <pre><code>ownership cqe_ownership(cqe) {\n  if (cqe.owner == ((consumer_counter &gt;&gt; log2_cq_size) &amp; 1)) {\n    return SW ownership\n  } else {\n    return HW ownership\n  }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6839\u636e consumer_counter \u7684\u5f53\u524d\u503c\u7684\u9ad8\u4f4d\uff08mask \u6389 CQ \u5927\u5c0f\u5bf9\u5e94\u7684 bits\uff09\u4e0e CQE \u7684 owner \u5b57\u6bb5\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5c31\u8ba4\u4e3a\u662f\u5c5e\u4e8e\u8f6f\u4ef6\uff1b\u5426\u5219\u5219\u662f\u5c5e\u4e8e\u786c\u4ef6\u3002\u8f6f\u4ef6\u5728\u8f6e\u8be2\u7684\u65f6\u5019\uff0c\u53ea\u6709\u9047\u5230 SW ownership \u7684 CQE \u624d\u4f1a\u5904\u7406\uff0c\u5426\u5219\u5c31\u5ffd\u7565\u3002\u4e4d\u4e00\u770b\uff0c\u8fd9\u4e2a\u8bbe\u8ba1\u633a\u5947\u602a\u7684\uff0c\u56e0\u4e3a\u6ea2\u51fa\u7684\u95ee\u9898\uff0c<code>((consumer_counter &gt;&gt; log2_cq_size) &amp; 1)</code> \u6bcf\u6b21\u6ea2\u51fa\u5c31\u4f1a\u53d6\u53cd\uff0c\u6240\u4ee5\u76f8\u5e94\u7684 ownership \u7684\u5bf9\u5e94\u5173\u7cfb\u4e5f\u4f1a\u53d6\u53cd\u3002\u56de\u60f3\u4e00\u4e0b\uff0c\u4e4b\u524d AXI DMA \u7684\u505a\u6cd5\uff0c\u63a5\u6536\u7684\u65f6\u5019\uff0c\u8f6f\u4ef6\u8bbe\u7f6e\u4e00\u4e2a\u72b6\u6001\u4f4d\uff0c\u786c\u4ef6\u5b8c\u6210\u63a5\u6536\u4ee5\u540e\uff0c\u4e5f\u8bbe\u7f6e\u4e00\u4e2a\u72b6\u6001\u4f4d\uff0c\u8f6f\u4ef6\u5b8c\u6210\u5904\u7406\u4ee5\u540e\uff0c\u518d\u6062\u590d\u72b6\u6001\u4f4d\u4e3a\u53ef\u4ee5\u63a5\u6536\u7684\u72b6\u6001\uff0c\u8fd9\u6837\u6765\u56de\u64cd\u4f5c\u6bd4\u8f83\u9ebb\u70e6\u3002\u5728 ConnectX-4 \u7684\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0c\u786c\u4ef6\u53ea\u9700\u8981\u5728\u586b CQE \u7684\u65f6\u5019\uff0ctoggle \u4e00\u4e0b owner \u4f4d\u5373\u53ef\uff0c\u8f6f\u4ef6\u4e0d\u9700\u8981\u4fee\u6539\u5185\u5bb9\uff0c\u53ea\u9700\u8981\u4fee\u6539 consumer_counter\u3002</p> <p>\u8fd9\u6837\u770b\u53ef\u80fd\u6bd4\u8f83\u8ff7\u7cca\uff0c\u6765\u62c6\u89e3\u4e00\u4e0b\u6574\u4e2a\u8fc7\u7a0b\u3002\u9996\u5148\u662f AXI DMA \u7684\u63a5\u6536\u961f\u5217\u7684 Descriptor \u7684\u5904\u7406\uff1a</p> <ol> <li>\u8f6f\u4ef6\u8bbe\u7f6e status = 0 \u8868\u793a\u8fd9\u4e2a Descriptor \u53ef\u4ee5\u63a5\u6536</li> <li>\u786c\u4ef6\u8bbe\u7f6e status |= COMPLETED</li> <li>\u8f6f\u4ef6\u8bfb\u53d6 status \u53d1\u73b0 COMPLETED\uff0c\u5904\u7406\u6570\u636e\uff0c\u7136\u540e\u91cd\u65b0\u8bbe\u7f6e status = 0</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0cDescriptor \u7684\u5185\u5bb9\u662f\u8f6f\u4ef6\u548c\u786c\u4ef6\u6765\u56de\u4fee\u6539\u3002ConnectX-4 \u7684\u8bbe\u8ba1\u4e0b\uff0c\u8f6f\u4ef6\u4e0d\u9700\u8981\u5bf9 CQE \u505a\u4efb\u4f55\u4fee\u6539\uff1a</p> <ol> <li>\u521d\u59cb\u60c5\u51b5\u4e0b\uff0cowner = 1 \u548c consumer_counter = 0\uff0c\u5bf9\u5e94 HW owner\uff0c\u6240\u4ee5\u8f6f\u4ef6\u4e0d\u4f1a\u8ba4\u4e3a\u662f\u5408\u6cd5\u7684 CQE</li> <li>\u786c\u4ef6\u5f00\u59cb\u5411 CQ \u63d2\u5165 CQE\uff0c\u6b64\u65f6 owner ^=1 \u53d8\u4e3a 0\uff0c\u5bf9\u5e94 SW owner\uff0c\u6240\u4ee5\u8f6f\u4ef6\u53ef\u4ee5\u5f00\u59cb\u8bfb\u53d6\u5e76\u5904\u7406 CQE</li> <li>\u786c\u4ef6\u4e0d\u65ad\u63d2\u5165\uff0c\u51fa\u73b0\u4e86\u7b2c\u4e00\u6b21\u6ea2\u51fa\uff0c\u8f6f\u4ef6\u8ddf\u7740\u5904\u7406\uff0c\u4e5f\u7b2c\u4e00\u6b21\u6ea2\u51fa\u4e86\uff0c\u6b64\u65f6 <code>((consumer_counter &gt;&gt; log2_cq_size) &amp; 1) = 1</code>\uff0c\u6b64\u65f6 1 \u5bf9\u5e94 SW owner\uff0c0 \u5bf9\u5e94 HW owner\u3002\u5f53\u786c\u4ef6\u63d2\u5165 CQE \u4ee5\u540e\uff0cowner \u624d\u4ece 0\uff08HW owner\uff09\u53c8\u53d8\u56de 1\uff08SW owner\uff09\uff0c\u8f6f\u4ef6\u5c31\u77e5\u9053\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8bfb\u53d6\u5e76\u5904\u7406 CQE</li> <li>\u8fd9\u4e2a\u8fc7\u7a0b\u7ee7\u7eed\u4e0b\u53bb\uff0cowner \u7684\u542b\u4e49\u4e0d\u65ad\u7ffb\u8f6c</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u8fc7\u7a0b\u8f6f\u4ef6\u4e0d\u9700\u8981\u5199\u5165 CQE \u7684\u5185\u5bb9\uff0c\u53ea\u9700\u8981\u4e0d\u65ad\u8f6e\u8be2\u5e76\u66f4\u65b0 consumer_counter\u3002\u786c\u4ef6\u5b9e\u73b0\u4e5f\u5f88\u7b80\u5355\uff0c\u4e0d\u65ad\u5730\u5bf9 owner \u8fdb\u884c\u5f02\u6216\uff0c\u5c31\u5b9e\u73b0\u4e86\u901a\u77e5\u8f6f\u4ef6\u7684\u529f\u80fd\u3002\u8fd9\u5c31\u7c7b\u4f3c\u4e8e\uff0c\u6bcf\u5f53 counter \u6ea2\u51fa\u7684\u65f6\u5019\uff0c\u5c31\u81ea\u52a8\u201c\u6e05\u7a7a\u201d\u6240\u6709 CQE \u7684\u201cvalid\u201d\u4f4d\uff0c\u7136\u540e\u786c\u4ef6\u518d\u8bbe\u7f6e\u201cvalid = 1\u201d\u3002\u786c\u4ef6\u53ea\u9700\u8981\u4fdd\u8bc1 producer_counter \u4e0d\u4f1a\u8ffd\u4e0a consumer_counter \u5c31\u53ef\u4ee5\u4e86\uff0c\u786c\u4ef6\u4e5f\u4e0d\u9700\u8981\u53bb\u8bfb\u53d6 CQE \u7684\u5185\u5bb9\u6765\u5224\u65ad\u8f6f\u4ef6\u662f\u5426\u5904\u7406\u5b8c\u6210\u3002\u8fd9\u4e2a\u65b9\u5f0f\u8fd8\u662f\u6bd4\u8f83\u6709\u610f\u601d\u7684\u3002</p> <pre><code>static void *get_sw_cqe(struct mlx5_ib_cq *cq, int n)\n{\n  void *cqe = get_cqe(cq, n &amp; cq-&gt;ibcq.cqe);\n  struct mlx5_cqe64 *cqe64;\n\n  cqe64 = (cq-&gt;mcq.cqe_sz == 64) ? cqe : cqe + 64;\n\n  if (likely(get_cqe_opcode(cqe64) != MLX5_CQE_INVALID) &amp;&amp;\n      !((cqe64-&gt;op_own &amp; MLX5_CQE_OWNER_MASK) ^ !!(n &amp; (cq-&gt;ibcq.cqe + 1)))) {\n    return cqe;\n  } else {\n    return NULL;\n  }\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u5199\u8fd9\u7bc7\u535a\u5ba2\u5c31\u662f\u56e0\u4e3a\u6709\u540c\u5b66\u770b\u5230\u4e86 CQE \u7684 owner \u7684\u5947\u602a\u8bbe\u5b9a\uff0c\u6211\u624d\u6765\u7814\u7a76\u7684\u8fd9\u4e2a\u95ee\u9898\u3002\u6211\u5c31\u662f\u4e3a\u4e86\u8fd9\u70b9\u918b\uff0c\u624d\u5305\u7684\u8fd9\u987f\u997a\u5b50\uff0c\u524d\u9762\u505a\u4e86\u4e00\u5927\u5806\u7684\u5f15\u5165\u3002</p>","tags":["network","nic","descriptor"]},{"location":"networking/2023/03/22/hardware-queue-interface/#chatgpt-\u65f6\u95f4","title":"ChatGPT \u65f6\u95f4","text":"<p>\u95ee\uff1aWhat does network driver do to send/receive network packets to/from NIC?</p> <p>\u7b54\uff1aA network driver is a software component that allows the operating system to communicate with the network interface card (NIC) and send and receive network packets. The NIC is a hardware device that connects a computer to a network and enables it to communicate with other devices on that network.</p> <p>When the computer wants to send a network packet, the operating system hands the packet off to the network driver, which then converts it into a format that the NIC can understand. The network driver also sets the appropriate control bits and headers in the packet to ensure that it is correctly transmitted over the network.</p> <p>When a network packet is received by the NIC, the network driver intercepts it and passes it on to the operating system. The network driver then verifies the packet's integrity, checks if it is destined for the local machine, and if so, hands it over to the appropriate application.</p> <p>In summary, the network driver acts as a bridge between the operating system and the NIC, enabling the computer to send and receive network packets over the network.</p> <p>\u95ee\uff1aCan you give me a detailed description? e.g. the ring buffer and notification mechanism</p> <p>\u7b54\uff1aSure, I can provide a more detailed description of how network drivers use ring buffers and notification mechanisms to send and receive network packets.</p> <p>A ring buffer is a circular buffer that is used by the network driver to store incoming and outgoing network packets. The buffer is divided into multiple sections or \"rings,\" each of which can hold one or more packets. The ring buffer is used to manage the flow of data between the network driver and the NIC.</p> <p>When a packet is received by the NIC, it is stored in the receive ring buffer. The network driver then reads the packet from the ring buffer, processes it, and hands it over to the appropriate application.</p> <p>When the computer wants to send a packet, the network driver first checks if there is space available in the transmit ring buffer. If there is, it writes the packet to the next available slot in the buffer and sets the appropriate control bits and headers.</p> <p>The network driver then uses a notification mechanism to inform the NIC that there is data available in the transmit ring buffer. This notification mechanism can take different forms, depending on the specific hardware and driver implementation. For example, it might involve writing to a specific memory location or sending an interrupt signal to the NIC.</p> <p>\u6ce8\uff1a\u6ca1\u542c\u8bf4\u8fc7\u7ed9 NIC \u53d1\u9001\u4e2d\u65ad\u3002</p> <p>When the NIC receives the notification, it reads the packet from the transmit ring buffer and sends it over the network.</p> <p>The ring buffer and notification mechanisms are critical components of network drivers because they enable efficient communication between the operating system and the NIC. By using a circular buffer, the driver can handle multiple packets at once and avoid the need for expensive memory allocations or deallocations. The notification mechanism allows the driver to inform the NIC of data availability without constantly polling the buffer, which would waste CPU cycles and reduce system performance.</p> <p>\u6ce8\uff1a\u8fd9\u91cc\u8bf4\u53cd\u4e86\uff0c\u5e94\u8be5\u662f\u544a\u8bc9\u7f51\u5361\u9a71\u52a8\u6709\u6570\u636e\u53ef\u7528\u3002</p> <p>\u95ee\uff1aCan you take Xilinx AXI DMA for example?</p> <p>\u7b54\uff1aSure, let me provide an example of how the Xilinx AXI DMA uses a ring buffer and notification mechanism to send and receive network packets.</p> <p>The Xilinx AXI DMA is a DMA controller that is commonly used in embedded systems to handle data transfers between a host processor and peripherals, including network interfaces. The AXI DMA uses a scatter-gather DMA engine, which means it can transfer data between non-contiguous memory regions.</p> <p>In the context of network communication, the AXI DMA is typically used to transfer packets between the network interface card and the host memory. The AXI DMA driver sets up a ring buffer in host memory that is used to store incoming and outgoing packets.</p> <p>When a packet is received by the NIC, it is stored in a receive ring buffer that is allocated in the host memory. The AXI DMA driver sets up the receive ring buffer and configures the AXI DMA to use it as the destination for incoming packets.</p> <p>To enable the notification mechanism, the AXI DMA driver configures the AXI DMA to generate an interrupt when a packet is received and stored in the receive ring buffer. The interrupt is sent to the host processor, which then reads the packet from the receive ring buffer and processes it.</p> <p>When the host processor wants to send a packet, it writes the packet data to a transmit ring buffer that is also allocated in host memory. The AXI DMA driver sets up the transmit ring buffer and configures the AXI DMA to use it as the source for outgoing packets.</p> <p>To enable the notification mechanism for outgoing packets, the AXI DMA driver configures the AXI DMA to generate an interrupt when the transmit ring buffer is empty and ready to accept a new packet. This interrupt is sent to the host processor, which then writes the next packet to the transmit ring buffer.</p> <p>The AXI DMA driver manages the ring buffers and interrupt handling to ensure that incoming and outgoing packets are processed efficiently and without data loss.</p> <p>In summary, the Xilinx AXI DMA uses a ring buffer and notification mechanism to enable efficient transfer of network packets between the NIC and the host memory. The ring buffer is used to manage the flow of incoming and outgoing packets, while the notification mechanism enables the DMA engine to inform the host processor when new data is available or when the buffer is ready to accept new data.</p> <p>\u95ee\uff1aHow about Intel 82599? What's the difference between Intel 82599 and AXI DMA?</p> <p>\u7b54\uff1aThe Intel 82599 is a high-performance Ethernet controller that is commonly used in data center and cloud computing environments. Like the AXI DMA, the Intel 82599 also uses a ring buffer and notification mechanism to send and receive network packets.</p> <p>However, there are some key differences between the Intel 82599 and the AXI DMA. The most significant difference is that the Intel 82599 is a hardware-based Ethernet controller, while the AXI DMA is a DMA controller that is typically used in embedded systems.</p> <p>As a hardware-based Ethernet controller, the Intel 82599 is optimized for high-speed data transfer and advanced networking features. It includes hardware offloading capabilities that can offload tasks such as TCP/IP checksum calculation, packet segmentation, and packet filtering from the host CPU. This offloading reduces the CPU load and improves overall system performance.</p> <p>The Intel 82599 uses multiple receive and transmit ring buffers to support parallel data processing and enable high-speed data transfer. The receive ring buffers are used to store incoming packets, while the transmit ring buffers are used to store outgoing packets.</p> <p>The notification mechanism used by the Intel 82599 is called Interrupt Moderation. This mechanism is used to reduce the number of interrupts generated by the Ethernet controller and improve system efficiency. Interrupt Moderation groups multiple network packets together and generates a single interrupt to notify the host CPU that the packets are ready to be processed.</p> <p>In summary, the Intel 82599 and the AXI DMA both use ring buffers and notification mechanisms to transfer network packets, but they differ in their design and application. The Intel 82599 is a high-performance Ethernet controller that is optimized for data center and cloud computing environments, while the AXI DMA is a DMA controller that is typically used in embedded systems. The Intel 82599 includes advanced networking features such as hardware offloading and Interrupt Moderation, which improve system performance and efficiency.</p>","tags":["network","nic","descriptor"]},{"location":"networking/2018/08/21/implementing-gretap-in-macos/","title":"\u5728 macOS \u4e0b\u5b9e\u73b0 GRETAP","text":"<p>\u7531\u4e8e\u6ca1\u6709\u627e\u5230 macOS \u4e0b\u73b0\u6210\u7684 GRETAP \u5b9e\u73b0\uff0c\u6211\u5c31\u60f3\u5230\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u3002\u7531\u4e8etuntaposx\u63d0\u4f9b\u4e86\u4e00\u4e2a\u548c Linux \u4e0b\u57fa\u672c\u4e00\u6837\u7684 TAP Interface\uff0c\u4e8e\u662f\u81ea\u5df1\u5229\u7528 raw socket \u548c TAP Interface \u5b9e\u73b0\u4e86\u4e00\u4e0b\uff0c\u4e3b\u8981\u65b9\u6cd5\uff1a</p> <ol> <li>\u6253\u5f00 raw socket\uff0c\u8bfb\u53d6\u6536\u5230\u7684 proto 47 \u7684\u5305\uff0c\u5224\u65ad\u662f\u5426\u4e3a GRETAP \u5305\uff0c\u662f\uff0c\u5219\u5199\u5165\u5185\u5c42\u5305\u5230\u6253\u5f00\u7684 TAP Interface \u4e2d\u3002</li> <li>\u4ece TAP Interface \u4e2d\u8bfb\u5165\u5305\uff0c\u81ea\u5df1\u52a0\u4e0a GRE \u5934\u548c IP \u5934\uff0c\u7136\u540e\u53d1\u9001\u3002</li> </ol> <p>\u4e3b\u8981\u7684\u96be\u5ea6\u662f\u5728 raw socket \u90e8\u5206\uff0cmacOS \u7ee7\u627f\u4e86 BSD\uff0c\u4e0e Linux \u4e0d\u5927\u4e00\u6837\u3002\u4e8e\u662f\u53c2\u8003\u4e86SOCK_RAW Demystified\uff0c\u6210\u529f\u5730\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>\u4ee3\u7801\u653e\u5728jiegec/gretapmac\u3002\u5199\u5f97\u5e76\u4e0d\u9ad8\u6548\uff0c\u4ec5\u4ec5\u53ef\u7528\uff0c\u7528\u4e86\u4e00\u767e\u591a\u884c\u3002</p> <p>UPDATE: \u4e4b\u540e\u53c8\u968f\u624b\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7c7b\u4f3c\u7684\u534f\u8bae\uff0cL2TPv3 over UDP\u3002\u4ee3\u7801\u5728jiegc/l2tpv3udptap\u3002</p>","tags":["tuntaposx","tap","gre","gretap"]},{"location":"networking/2018/08/31/implementing-rfc8367-as-iptables-extension/","title":"\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367","text":"<p>\u524d\u51e0\u5929\u65e0\u804a\u95f2\u901b\u770b\u5230\u4e86\u4e00\u4e2a\u5f88\u6709\u8da3\u7684 RFC8367 - Wrongful Termination of Internet Protocol (IP) Packets \uff0c\u770b\u5230\u65e5\u671f\u5927\u5bb6\u5e94\u8be5\u90fd\u61c2\u4e86\uff0c\u8fd9\u662f\u4e2a\u7ca5\u5ba2\uff0c\u4e0d\u8fc7\u91cc\u9762\u8fd8\u662f\u53cd\u6620\u4e86\u4e00\u4e9b\u4e8b\u60c5\uff0c\u54b3\u3002</p> <p>\u4e4b\u524d\u770b\u5230\u95ea\u5ba2\u5b9e\u73b0\u4e86 shankerwangmiao/xt_PROTO \uff0c\u60f3\u5230\u81ea\u5df1\u4e5f\u53ef\u4ee5\u505a\u4e00\u4e2a iptables \u6269\u5c55\uff0c\u4e8e\u662f\u5c31\u5199\u4e86 jiegec/xt_EQUALIZE \u3002\u5b83\u662f\u8fd9\u6837\u4f7f\u7528\u7684\uff1a</p> <pre><code>$ git clone git@github.com:jiegec/xt_EQUALIZE.git\n$ make\n$ sudo make install\n$ sudo iptables -t filter -A INPUT -j EQUALIZE\n$ sudo dmesg -w &amp;\n$ # Make some random network requests to see the effect!\n$ ping 1.1.1.1\n$ ping 8.8.8.8\n$ ping ::1\n</code></pre> <p>\u76ee\u524d\u8fd8\u6ca1\u6709\u628a\u53c2\u6570\u90fd\u53d8\u6210\u53ef\u4ee5\u914d\u7f6e\u7684\u3002\u5982\u679c\u771f\u7684\u6709\u4eba\u9700\u8981\u8fd9\u4e2a\u6a21\u5757\u7684\u8bdd\uff0c\u6211\u518d\u6539\u5427\uff08\u9003</p>","tags":["rfc","rfc8367","aprilfool","iptables","kernel","mod","xtables"]},{"location":"networking/2019/05/30/ip-and-udp-checksum-incremental-update/","title":"IP \u548c UDP Checksum \u7684\u589e\u91cf\u66f4\u65b0\u95ee\u9898","text":"<p>\u4e4b\u524d\u5728\u5199 IP Checksum \u7684\u589e\u91cf\u66f4\u65b0\uff0c\u5c31\u662f\u5f53 TTL -= 1 \u7684\u65f6\u5019\uff0cChecksum \u5e94\u8be5\u589e\u52a0 0x0100\uff0c\u4f46\u662f\u8fd9\u6837\u4f1a\u6709\u95ee\u9898\uff0c\u5728\u4e8e\uff0c\u5982\u679c\u6309\u7167\u539f\u6765\u7684 IP Checksum \u8ba1\u7b97\u65b9\u6cd5\uff0c\u662f\u4e0d\u4f1a\u51fa\u73b0 0xFFFF \u7684\uff08\u6c42\u548c\uff0c\u8fdb\u4f4d\uff0c\u7136\u540e\u53d6\u53cd\u5199\u5165\uff09\uff0c\u8fd9\u79cd\u52a0\u6cd5\u5c31\u6709\u53ef\u80fd\u51fa\u73b0 0xFFFF\u3002\u4e8e\u662f\u7ffb\u9605\u4e86\u76f8\u5173\u7684 RFC\uff1a</p> <p>\u9996\u5148\u662f RFC 1141 \u76f8\u5173\u90e8\u5206\uff1a</p> <pre><code>unsigned long sum;\nipptr-&gt;ttl--;                  /* decrement ttl */\nsum = ipptr-&gt;Checksum + 0x100;  /* increment checksum high byte*/\nipptr-&gt;Checksum = (sum + (sum&gt;&gt;16)) /* add carry */\n</code></pre> <p>\u8fd9\u4e5f\u662f\u6bd4\u8f83\u76f4\u63a5\u80fd\u60f3\u5230\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u4f46\u662f\u4f1a\u51fa\u73b0\u521a\u624d\u63d0\u5230\u7684\u95ee\u9898\u3002\u4e8e\u662f RFC 1624 \u7ea0\u6b63\u4e86\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <pre><code>  Although this equation appears to work, there are boundary conditions\n   under which it produces a result which differs from the one obtained\n   by checksum computation from scratch.  This is due to the way zero is\n   handled in one's complement arithmetic.\n\n   In one's complement, there are two representations of zero: the all\n   zero and the all one bit values, often referred to as +0 and -0.\n   One's complement addition of non-zero inputs can produce -0 as a\n   result, but never +0.  Since there is guaranteed to be at least one\n\n\n\nRijsinghani                                                     [Page 2]\n\nRFC 1624             Incremental Internet Checksum              May 1994\n\n\n   non-zero field in the IP header, and the checksum field in the\n   protocol header is the complement of the sum, the checksum field can\n   never contain ~(+0), which is -0 (0xFFFF).  It can, however, contain\n   ~(-0), which is +0 (0x0000).\n\n   RFC 1141 yields an updated header checksum of -0 when it should be\n   +0.  This is because it assumed that one's complement has a\n   distributive property, which does not hold when the result is 0 (see\n   derivation of [Eqn. 2]).\n\n   The problem is avoided by not assuming this property.  The correct\n   equation is given below:\n\n          HC' = ~(C + (-m) + m')    --    [Eqn. 3]\n              = ~(~HC + ~m + m')\n</code></pre> <p>\u53ea\u8981\u628a\u4ee3\u7801\u7b80\u5355\u4fee\u6539\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\uff0c\u6216\u8005\u9047\u5230 0xFFFF \u65f6\u8bbe\u4e3a 0\uff0c\u8fd9\u65f6\u5019\u5c31\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4f46\u662f\uff0c\u4ed4\u7ec6\u7814\u7a76\u4e86\u4e00\u4e0b\u53d1\u73b0\uff0cUDP Checksum \u53c8\u662f\u8fd9\u4e48\u5b9a\u4e49\u7684\uff08RFC 768\uff09:</p> <pre><code>If the computed  checksum  is zero,  it is transmitted  as all ones (the\nequivalent  in one's complement  arithmetic).   An all zero  transmitted\nchecksum  value means that the transmitter  generated  no checksum  (for\ndebugging or for higher level protocols that don't care).\n</code></pre> <p>\u521a\u597d\u548c IP Checksum \u76f8\u53cd\uff0c\u8fd9\u5c31\u5f88\u6709\u610f\u601d\u4e86\u3002</p>","tags":["ip","udp","checksum"]},{"location":"networking/2018/05/05/mosh-behind-nat-with-upnp/","title":"\u5229\u7528 UPnP \u534f\u8bae\u8fdb\u884c mosh NAT \u7a7f\u900f\u7684\u7814\u7a76","text":"<p>\u7531\u4e8e\u7ecf\u5e38\u8981\u4ece\u5bbf\u820d\u3001\u6559\u5ba4\u7b49\u4e0d\u540c\u7684 Wi-Fi \u4e4b\u95f4\u5207\u6362\uff0c\u4f46\u662f ssh \u8fde\u63a5\u53c8\u603b\u662f\u65ad\uff0c\u6240\u4ee5\u60f3\u7528 mosh \u4ee3\u66ff ssh\u3002\u4f46\u662f mosh \u4e5f\u6709\u5b83\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u4e0d\u80fd\u6eda\u52a8\u3002\u8fd9\u4e2a\u53ef\u4ee5\u5728 mosh \u4e2d\u5d4c\u5957\u4e00\u5c42 tmux \u89e3\u51b3\u3002\u6211\u76ee\u524d\u5199\u4e86\u4e00\u4e9b\u81ea\u52a8 mosh \u540e\u6253\u5f00 tmux \u5e76\u4e14\u5f00\u542f\u9f20\u6807\u652f\u6301\u7684\u811a\u672c\uff0c\u4f46\u8fd8\u662f\u6709\u7f3a\u9677\u3002</li> <li>\u5728\u9ad8\u7aef\u53e3 60000+ \u76d1\u542c UDP\uff0c\u8fd9\u4f7f\u5f97 NAT \u540e\u7684\u670d\u52a1\u5668\u96be\u4ee5\u76f4\u63a5\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u3002\u5982\u679c\u76f4\u63a5\u8f6c\u53d1\u5230 NAT \u540e\u7684\u673a\u5668\uff0c\u90a3\u4e48 NAT \u540e\u9762\u5982\u679c\u6709\u591a\u53f0\u673a\u5668\uff0c\u8fd9\u53c8\u5931\u6548\u4e86\u3002</li> </ol> <p>\u4e8e\u662f\u627e\u4e86\u627e\u7f51\u4e0a\u7684 NAT \u7a7f\u900f\u7684\u4e00\u4e9b\u6587\u7ae0\uff0c\u770b\u5230\u4e86 UPnP \u7684\u65b9\u6cd5\u3002\u5927\u81f4\u5c31\u662f\uff0c\u7528\u6237\u53ef\u4ee5\u5411\u8def\u7531\u5668\u6ce8\u518c\u4e00\u4e2a\u4e34\u65f6\u7684\u8f6c\u53d1\u89c4\u5219\uff0c\u8def\u7531\u4f1a\u81ea\u52a8\u5728 iptables \u4e0a\u914d\u7f6e\u8f6c\u53d1\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u4e5f\u4f1a\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff1a\u8def\u7531\u4e0a\u7684 mosh-server \u4e0d\u77e5\u9053\u8fd9\u4e2a\u8f6c\u53d1\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u5b83\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u76d1\u542c\u540c\u6837\u7684\u7aef\u53e3\u3002\u89e3\u51b3\u65b9\u6848\u4e0b\u9762\u4f1a\u63d0\u5230\u3002</p> <p>\u9700\u6c42\uff1a</p> <pre><code>Server &lt;---&gt; NAT Router &lt;---&gt; My Laptop\nOn NAT Router, port 8022 is forwarded to Server:22\n1. mosh router # works\n2. mosh --ssh=\"ssh -p 8022\" router # works\n</code></pre> <p>\u9996\u5148\u5728 NAT Router \u4e0a\u914d\u7f6e miniupnpd\uff08\u4ee5 Debian \u4e3a\u4f8b\uff09</p> <pre><code>sudo apt install miniupnpd\n# you will get a dialog upon installation\n# input your wan interface and listening ip accordingly\nsudo vim /etc/default/miniupnpd\n# edit START_DAEMON=0 to START_DAEMON=1\nsudo vim /etc/miniupnpd/miniupnpd.conf\n# edit ext_ifname, listening_ip accordingly\n# set secure_mode=yes\n# add 'allow 60000-60023 internal_ip/prefix 60000-60023'\n# before the last line 'deny 0-65535 0.0.0.0/0 0-65535'\nsudo systemctl enable --now miniupnpd\n</code></pre> <p>\u73b0\u5728\uff0c\u590d\u5236 \u6211\u4fee\u6539\u7684 mosh-wrapper.js \u5230\u7528\u6237\u7684 home \u76ee\u5f55\u4e0b\uff0c\u5728 Server \u5b89\u88c5 <code>miniupnpc</code> \u7136\u540e\u901a\u8fc7\uff1a</p> <pre><code>mosh --ssh=\"ssh -p 8022\" --server=~/mosh-wrapper.js user@router\n</code></pre> <p>\u8fd9\u6837\uff0cmosh \u9996\u5148\u4f1a\u901a\u8fc7 ssh \u548c Server \u534f\u5546\u4e00\u4e2a AES \u7684\u5bc6\u94a5\u548c UDP \u7aef\u53e3\uff08\u5982 60001\uff09\uff0c\u4e4b\u540e\u7684\u901a\u4fe1\u90fd\u901a\u8fc7 UDP \u7aef\u53e3\u8d70\u52a0\u5bc6\u540e\u7684\u6d41\u91cf\u3002\u6211\u7684 <code>mosh-wrapper.js</code> \u901a\u8fc7 <code>miniupnpc</code> \u5411\u8def\u7531\u5668\u8bf7\u6c42\u628a\u8be5 UDP \u7aef\u53e3\u8f6c\u53d1\u5230 Server \u4e0a\uff0c\u8fd9\u6837\uff0c <code>mosh-server</code> \u5c31\u80fd\u901a\u8fc7 NAT \u8def\u7531\u7a7f\u900f\u5230\u540e\u9762\u7684 Server \u4e0a\u3002</p> <p>\u7b49\u4f1a\uff01\u95ee\u9898\u6765\u4e86\uff1a</p> <p><code>mosh</code> \u9ed8\u8ba4\u7684 IP \u8303\u56f4\u662f <code>60000-61000</code> \uff0c\u6839\u636e\u6211\u7684\u89c2\u5bdf\uff0c\u5b83\u4f1a\u4ece 60001 \u5f00\u59cb\u5c1d\u8bd5\u76d1\u542c\u672c\u673a\u5730\u5740\uff0c\u5982\u679c\u5df2\u7ecf\u88ab\u5360\u7528\uff0c\u5219 60002, 60003, ... \u4f46\u662f\uff01Router \u548c Server \u5b9e\u9645\u4e0a\u5360\u7528\u4e86\u76f8\u540c\u7684\u7aef\u53e3\u7a7a\u95f4\uff0c\u5e76\u4e14 <code>mosh</code> \u53ea\u77e5\u9053\u672c\u673a\u54ea\u4e9b\u7aef\u53e3\u88ab\u5360\u7528\u4e86\uff0c\u800c\u4e0d\u77e5\u9053 Router \u548c Server \u5171\u540c\u5360\u7528\u4e86\u591a\u5c11\u7aef\u53e3\u3002</p> <p>\u6211\u60f3\u5230\u4e86\u4e00\u4e9b\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u5728 Router \u4e0a\u8ba9 miniupnpd \u76d1\u542c\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u5360\u4f4f\u8fd9\u4e2a\u5751\u3002\u8fd9\u6837\uff0cRouter \u4e0a\u7684 <code>mosh-server</code> \u5c31\u4e0d\u4f1a\u7528\u548c Server \u76f8\u540c\u7684\u7aef\u53e3</li> <li>\u5982\u679c\u6709\u591a\u4e2a Server\uff0c\u5219\u4f1a\u51fa\u73b0\u62a2\u593a\u76f8\u540c\u7aef\u53e3\u7684\u60c5\u51b5\u3002\u6211\u76ee\u524d\u7684\u60f3\u6cd5\u662f\uff0c\u8ba9 <code>upnpc</code> \u53bb\u8be2\u95ee Router \u627e\u7a7a\u95f2\u7684\u7aef\u53e3\uff0c\u7136\u540e\u518d\u4f20\u7ed9 <code>mosh-server</code> \u4f7f\u7528\u3002\u53e6\u4e00\u79cd\u65b9\u6cd5\u5219\u662f\uff0c\u7ed9\u4e0d\u540c\u7684 Server \u5212\u5206\u4e0d\u540c\u7684\u7aef\u53e3\u8303\u56f4\uff0c\u6bd4\u5982 Router \u7528 60001-60005, \u7136\u540e Server1 \u7528 60006-60010, Server2 \u7528 60011-60015 \u5982\u6b64\u4e0b\u53bb\u3002</li> </ol> <p>\u7136\u540e\uff0c\u65b0\u7684\u95ee\u9898\u53c8\u53d1\u73b0\u4e86\uff1a</p> <p>\u5f53\u6211\u5728\u548c Server \u540c\u4e00\u4e2a\u5b50\u7f51\u7684\u65f6\u5019\uff0c\u7531\u4e8e <code>miniupnpd</code> \u914d\u7f6e\u7684 <code>iptables</code> \u89c4\u5219\u4e2d\u6765\u6e90\u53ea\u6709 WAN interface\uff0c\u6240\u4ee5\u6211\u5728\u5185\u7f51\u53d1\u7684\u5305\u662f\u4e0d\u4f1a\u88ab\u8f6c\u53d1\u7684\u3002\u5f53\u7136\uff0c\u65e2\u7136\u5728\u5185\u7f51\u4e86\uff0c\u4e3a\u5565\u4e0d\u76f4\u63a5\u7528\u5185\u7f51 IP \u5462\uff0c\u4e0d\u77e5\u9053 <code>mosh</code> \u6709\u6ca1\u6709\u63d0\u4f9b\u8bbe\u7f6e\u5907\u7528 IP \u7684\u529f\u80fd\u3002</p>","tags":["nat","mosh","upnp","miniupnpd"]},{"location":"networking/2018/05/06/nat-forwarding-with-src-address/","title":"\u4f7f\u7528 iptables \u548c\u7b56\u7565\u8def\u7531\u8fdb\u884c\u5e26\u6e90\u5730\u5740\u7684 forwarding","text":"<p>\u9648\u8001\u5e08\u6253\u5f00\u4ed6\u7684\u670d\u52a1\u5668\uff0c\u7a81\u7136\u53d1\u73b0 CPU \u83ab\u540d\u9ad8\u8d1f\u8f7d\uff0c\u7136\u540e\u53d1\u73b0\u662f\u6709\u4e00\u4e2a\u7528\u6237\u88ab\u8fdc\u7a0b\u767b\u5f55\u62ff\u6765\u6316\u77ff\u4e86\u3002\u4f46\u662f\u8fd9\u53f0\u673a\u5668\u5728 NAT \u540e\uff0c\u6240\u4ee5\u767b\u5f55\u7684\u6e90\u5730\u5740\u5168\u662f NAT \u8def\u7531\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u5bf9\u65b9\u7684\u5730\u5740\u662f\u4ec0\u4e48\u3002\u6211\u4eec\u4e3a\u4e86\u80fd\u4f7f\u7528 fail2ban \u6765\u7981\u7528\u591a\u6b21\u5c1d\u8bd5\u5931\u8d25\u7684 IP\uff0c\u4f46\u53c8\u4e0d\u60f3\u56e0\u4e3a\u522b\u4eba\u628a NAT \u8def\u7531\u7684\u5730\u5740\u7ed9\u7981\u4e86\uff0c\u8fd9\u6837\u6211\u4eec\u81ea\u5df1\u4e5f\u7528\u4e0d\u4e86\u4e86\u3002\u6240\u4ee5\u5fc5\u987b\u8981\u8ba9\u8fd9\u53f0\u673a\u5668\u80fd\u591f\u77e5\u9053 ssh \u7684\u6e90\u5730\u5740\uff0c\u6211\u4eec\u73b0\u5728\u7b80\u5355\u7684 socat \u65b9\u6848\u4e0d\u80fd\u6ee1\u8db3\u8fd9\u4e2a\u9700\u6c42\u3002</p> <p>\u9700\u6c42\uff1a</p> <ol> <li>\u53ef\u4ee5\u5728\u5916\u7f51\u8fde NAT \u8def\u7531\u7684\u9ad8\u7aef\u53e3\uff08\u5982 2222\uff09\u6765\u8bbf\u95ee\u8fd9\u53f0\u673a\u5668\u3002</li> <li>\u5728\u5185\u7f51\u4e2d\uff0c\u65e2\u53ef\u4ee5\u76f4\u63a5\u8fde\u5b83\u7684\u5185\u7f51\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u8fde NAT \u8def\u7531\u7684\u9ad8\u7aef\u53e3\u6765\u8bbf\u95ee\u8fd9\u53f0\u670d\u52a1\u5668\u3002\u6b64\u65f6\uff0c\u7531\u4e8e\u8fde ssh \u7684\u673a\u5668\u5c31\u5728\u540c\u4e00\u4e2a\u5b50\u7f51\u4e2d\uff0c\u5982\u679c\u4fdd\u7559\u4e86\u6e90\u5730\u5740\uff0c\u670d\u52a1\u5668\u53d1\u7684\u5305\u4f1a\u76f4\u63a5\u56de\u6765\u4e0d\u7ecf\u8fc7 NAT\u3002\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u4fdd\u7559\u4e86 socat \u7684\u65b9\u6848\u3002</li> </ol> <p>\u5b9e\u73b0\u65b9\u6cd5\uff1a</p> <p>\u5728 NAT Router \u4e0a\u914d\u7f6e DNAT\uff0c\u8fd9\u6837\u53d1\u5230 NAT Router \u4e0a\u7684\u5305\u5c31\u53ef\u4ee5\u8f6c\u53d1\u5230\u670d\u52a1\u5668\u4e0a\uff1a</p> <pre><code>iptables -t nat -A PREROUTING -i external_interface -p tcp -m tcp --dport 2222 -j DNAT --to-destination internal_server_ip:22\n</code></pre> <p>\u4f46\u662f\uff0c\u4ece\u670d\u52a1\u5668\u56de\u6765\u7684\u5305\u5230\u4e86 NAT Router \u4e0a\u540e\uff0c\u7531\u4e8e\u8def\u7531\u8868\u7684\u914d\u7f6e\u95ee\u9898\uff0c\u9ed8\u8ba4\u7684\u8def\u7531\u5e76\u4e0d\u80fd\u628a\u5305\u9001\u8fbe\u5bf9\u65b9\u3002</p> <p>\u65b9\u6cd5 1: \u6211\u4eec\u9996\u5148\u7ed9\u5305\u6253\u4e0a mark\uff1a</p> <pre><code>iptables -t mangle -A PREROUTING -i internal_interface -p tcp -m tcp --sport 22 -j MARK --set-mark 0x2222\n</code></pre> <p>\u7136\u540e\u914d\u7f6e\u7b56\u7565\u8def\u7531\uff1a</p> <pre><code>ip rule add fwmark 0x2222 table 2222\nip route add table 2222 default via gateway_address\n</code></pre> <p>\u65b9\u6cd5 2: (UPD 2018-07-07) \u5229\u7528 <code>ip rule</code> \u76f4\u63a5\u8fbe\u6210\u540c\u6837\u7684\u6548\u679c</p> <pre><code>ip rule add from internal_ip/prefix table 2222\n# or\nip rule add iif internal_interface table 2222\nip route add table 2222 default via gateway_address\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 ssh \u7684\u56de\u5305\u53ef\u4ee5\u539f\u8def\u8fd4\u56de\u4e86\u3002</p> <p>\u7531\u4e8e\u524d\u9762\u63d0\u5230\u7684\u539f\u56e0\uff0c\u4e0a\u9762\u6211\u4eec\u914d\u7f6e\u7684 DNAT \u89c4\u5219\u53ea\u5bf9\u5916\u7f51\u8fc7\u6765\u7684\u5305\u6709\u6548\u3002\u4e3a\u4e86\u5185\u7f51\u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u4ecd\u7136\u91c7\u7528\u4e86 socat \u7684\u65b9\u5f0f\uff1a</p> <pre><code>socat TCP-LISTEN:2222,reuseaddr,fork TCP:internal_server_ip:22\n</code></pre> <p>\u4ece\u4e0d\u540c\u7684\u673a\u5668\u6d4b\u8bd5\uff0c\u90fd\u53ef\u4ee5\u5728 <code>who</code> \u770b\u5230\uff0c\u5730\u5740\u786e\u5b9e\u662f\u6211\u4eec\u60f3\u770b\u5230\u7684\u6e90\u5730\u5740\u3002\u63a5\u4e0b\u6765\u914d\u7f6e <code>fail2ban</code>\u5373\u53ef\u3002</p>","tags":["linux","nat","forwarding"]},{"location":"networking/2018/05/08/nginx-proxy-vmware-esxi/","title":"\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi","text":"<p>\u6211\u4eec\u7684 VMware ESXi \u5728\u4e00\u53f0 NAT Router \u4e4b\u540e\uff0c\u4f46\u662f\u6211\u4eec\u5e0c\u671b\u901a\u8fc7\u57df\u540d\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee VMware ESXi\u3002\u6211\u4eec\u9996\u5148\u7684\u5c1d\u8bd5\u662f\uff0c\u628a 8443 \u8f6c\u53d1\u5230\u5b83\u7684 443 \u7aef\u53e3\uff0c\u6bd4\u5982\uff1a</p> <pre><code>socat TCP-LISTEN:8443,reuseaddr,fork TCP:esxi_addr:443\n</code></pre> <p>\u5b83\u80fd\u5de5\u4f5c\u5730\u5f88\u597d\uff08\u5047\u7684\uff0c\u5982\u679c\u4f60\u628a 8443 \u6362\u6210 9443 \u5b83\u5c31\u4e0d\u5de5\u4f5c\u4e86\uff09\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u60f3\u8981\u7684\u662f\uff0c\u76f4\u63a5\u901a\u8fc7 esxi.example.org \u5c31\u53ef\u4ee5\u8bbf\u95ee\u5b83\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u9700\u8981 Nginx \u5728\u5176\u4e2d\u505a\u4e00\u4e2a\u8f6c\u53d1\u7684\u529f\u80fd\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u5f88\u591a\u7684\u5751\uff0c\u6700\u540e\u7ec8\u4e8e\u662f\u505a\u597d\u4e86\uff08VMware Remote Console \u7b49\u529f\u80fd\u8fd8\u4e0d\u884c\uff0c\u9700\u8981\u7ee7\u7eed\u7814\u7a76\uff09\u3002</p> <p>\u9996\u5148\u8bb2\u8bb2\u4e3a\u5565\u628a 8443 \u6362\u6210 9443 \u4e0d\u80fd\u5de5\u4f5c\u5427 -- \u5f88\u7b80\u5355\uff0cESXi \u7684\u7f51\u9875\u754c\u9762\u4f1a\u8bf7\u6c42 8443 \u7aef\u53e3\u3002\u53ea\u662f\u6070\u597d\u6211\u7528 8443 \u8f6c\u53d1\u5230 443\uff0c\u6240\u4ee5\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002\u8fd9\u4e2a\u5f88\u8ff7\uff0c\u4f46\u662f\u6d4b\u8bd5\u7684\u7ed3\u679c\u786e\u5b9e\u5982\u6b64\u3002VMware Remote Console \u8fd8\u7528\u5230\u4e86\u522b\u7684\u7aef\u53e3\uff0c\u6211\u8fd8\u5728\u7814\u7a76\u4e4b\u4e2d\u3002</p> <p>\u6765\u8c08\u8c08\u600e\u4e48\u914d\u7f6e\u8fd9\u4e2a Nginx \u8f6c\u53d1\u5427\u3002\u9996\u5148\u662f 80 \u8df3\u8f6c 443: <pre><code>server {\n        listen 80;\n        listen 8080;\n        server_name esxi.example.org;\n\n        return 301 https://$host$request_uri;\n}\n</code></pre></p> <p>\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u63a5\u4e0b\u6765\u662f\u8f6c\u53d1 443 \u7aef\u53e3\uff1a <pre><code>server {\n        listen 443 ssl;\n        server_name esxi.example.org;\n        ssl_certificate /path/to/ssl/cert.pem;\n        ssl_certificate_key /path/to/ssl/key.pem;\n\n        location / {\n                proxy_pass https://esxi_addr;\n                proxy_ssl_verify off;\n                proxy_ssl_session_reuse on;\n                proxy_set_header Host $http_host;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header X-Forwarded-Proto $scheme;\n        }\n}\n</code></pre></p> <p>\u6b64\u65f6\uff0c\u6253\u5f00 https://esxi.example.org \u5c31\u80fd\u770b\u5230\u767b\u5f55\u754c\u9762\u4e86\u3002\u4f46\u662f\u4ecd\u7136\u65e0\u6cd5\u767b\u5f55\u3002\u4ece DevTools \u770b\u9519\u8bef\uff0c\u53d1\u73b0\u5b83\u8bf7\u6c42\u4e86 8443 \u7aef\u53e3\u3002\u4e8e\u662f\u8fdb\u884c\u8f6c\u53d1\uff1a <pre><code>server {\n        listen 8443 ssl;\n        server_name esxi.example.org;\n        ssl_certificate /path/to/ssl/cert.pem;\n        ssl_certificate_key /path/to/ssl/key.pem;\n\n\n        location / {\n                if ($request_method = 'OPTIONS') {\n                        add_header 'Access-Control-Allow-Origin' 'https://esxi.example.org';\n                        add_header 'Access-Control-Allow-Credentials' 'true';\n                        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n                        add_header 'Access-Control-Max-Age' 1728000;\n                        add_header 'Access-Control-Allow-Headers' 'VMware-CSRF-Token,DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Cookie,SOAPAction';\n                        add_header 'Content-Type' 'text/plain; charset=utf-8';\n                        add_header 'Content-Length' 0;\n                        return 204;\n                }\n\n                add_header 'Access-Control-Allow-Origin' 'https://esxi.example.org';\n                add_header 'Access-Control-Allow-Credentials' 'true';\n                proxy_pass https://esxi_addr:443;\n                proxy_ssl_verify off;\n                proxy_ssl_session_reuse on;\n                proxy_set_header Host $http_host;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header X-Forwarded-Proto $scheme;\n        }\n}\n</code></pre></p> <p>\u4e3b\u8981\u9ebb\u70e6\u7684\u662f\u914d\u7f6e CORS \u7684\u76f8\u5173\u7b56\u7565\u3002\u6211\u4e5f\u662f\u770b\u4e86 DevTools \u7684\u9519\u8bef\u63d0\u793a\u534a\u5929\u624d\u6162\u6162\u5199\u51fa\u6765\u7684\u3002\u8fd9\u6837\u914d\u7f6e\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u767b\u5f55 VMware ESXi \u4e86\u3002</p> <p>20:02 \u66f4\u65b0\uff1a\u73b0\u5728\u505a\u4e86 WebSocket \u8f6c\u53d1\uff0c\u76ee\u524d\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 Web Console \u4e86\u3002\u4f46\u662f\uff0c\u5728\u8bbf\u95ee https://esxi.example.org/ \u7684\u65f6\u5019\u8fd8\u662f\u4f1a\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u7136\u800c https://esxi.example.org:8443/ \u662f\u597d\u7684\u3002</p> <p>\u8f6c\u53d1 WebSocket\uff1a <pre><code>map $http_upgrade $connection_upgrade {\n        default upgrade;\n        ''      close;\n}\n\nserver {\n        listen 8443 ssl;\n        server_name esxi.example.org;\n        ssl_certificate /path/to/ssl/cert.pem;\n        ssl_certificate_key /path/to/ssl/key.pem;\n\n\n        location / {\n\n                if ($request_method = 'OPTIONS') {\n                        add_header 'Access-Control-Allow-Origin' 'https://esxi.example.org';\n                        add_header 'Access-Control-Allow-Credentials' 'true';\n                        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n                        add_header 'Access-Control-Max-Age' 1728000;\n                        add_header 'Access-Control-Allow-Headers' 'VMware-CSRF-Token,DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Cookie,SOAPAction';\n                        add_header 'Content-Type' 'text/plain; charset=utf-8';\n                        add_header 'Content-Length' 0;\n                        return 204;\n                }\n\n                add_header 'Access-Control-Allow-Origin' 'https://esxi.example.org' always;\n                add_header 'Access-Control-Allow-Credentials' 'true' always;\n\n                proxy_pass https://esxi_addr:443;\n                proxy_ssl_verify off;\n                proxy_ssl_session_reuse on;\n                proxy_set_header Host $http_host;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header X-Forwarded-Proto $scheme;\n                proxy_set_header Upgrade $http_upgrade;\n                proxy_set_header Connection $connection_upgrade;\n        }\n}\n</code></pre></p> <p>20:29 \u66f4\u65b0\uff1a\u627e\u5230\u4e86 VMware Remote Console \u7684\u7aef\u53e3\uff1a902\uff0c\u7528 iptables \u8fdb\u884c DNAT \u5373\u53ef\uff1a <pre><code>iptables -A PREROUTING -i wan_interface -p tcp -m tcp --dport 902 -j DNAT --to-destination esxi_addr:902\n</code></pre></p> <p>2018-05-09 08:07 \u66f4\u65b0\uff1a\u6700\u540e\u53d1\u73b0\uff0c\u8fd8\u662f\u76f4\u63a5\u96a7\u9053\u5230\u5185\u7f51\u8bbf\u95ee ESXi \u6700\u79d1\u5b66\u3002\u6216\u8005\uff0c\u8ba9 443 \u91cd\u5b9a\u5411\u5230 8443\uff1a <pre><code>server {\n        listen 443 ssl;\n        server_name esxi.example.org;\n        ssl_certificate /path/to/ssl/cert.pem;\n        ssl_certificate_key /path/to/ssl/key.pem;\n\n        return 301 https://$host:8443$request_uri;\n}\n</code></pre> \u8fd9\u6837\uff0c\u524d\u9762\u4e5f\u4e0d\u7528\u5199\u90a3\u4e48\u591a CORS \u7684\u4e1c\u897f\u4e86\u3002</p>","tags":["linux","nat","forwarding","vmware","esxi","nginx","proxy"]},{"location":"networking/2023/06/20/spanning-tree-protocol/","title":"\u751f\u6210\u6811\u534f\u8bae","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#spanning-tree-protocol","title":"Spanning Tree Protocol","text":"<p>STP\uff08Spanning Tree Protocol\uff09\u53ef\u4ee5\u5728 802.1D-1998 \u7b2c 8 \u7ae0\u4e2d\u627e\u5230\u3002STP \u534f\u8bae\u5de5\u4f5c\u5728\u4ea4\u6362\u673a\u4e0a\uff0c\u9700\u8981\u6839\u636e\u4ea4\u6362\u673a\u8fde\u63a5\u7684\u62d3\u6251\uff0c\u81ea\u52a8\u8ba1\u7b97\u51fa\u4e00\u4e2a\u751f\u6210\u6811\uff0c\u5e76\u4e14\u628a\u4e0d\u5728\u751f\u6210\u6811\u4e0a\u7684\u8fb9\u7981\u7528\uff0c\u8fd9\u6837\u5373\u4f7f\u8fde\u63a5\u7684\u62d3\u6251\u6709\u73af\u8def\uff0c\u7981\u7528\u4ee5\u540e\u5c31\u6ca1\u6709\u73af\u4e86\u3002\u6709\u4e86 STP \u4ee5\u540e\uff0c\u8fde\u63a5\u4ea4\u6362\u673a\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u523b\u610f\u8fde\u6210\u73af\uff0c\u4ece\u800c\u63d0\u4f9b\u5197\u4f59\u3002</p> <p>\u5728 STP \u534f\u8bae\u63d0\u51fa\u7684\u65f6\u5019\uff0c\u7f51\u7edc\u8fd8\u4e0d\u50cf\u73b0\u5728\u8fd9\u6837\u4ee5\u70b9\u5bf9\u70b9\u4e3a\u4e3b\uff0c\u56e0\u6b64\u9700\u8981\u8003\u8651\u5171\u4eab\u4ecb\u8d28\u7684\u573a\u666f\uff0c\u4e5f\u5c31\u662f\u591a\u4e2a\u4ea4\u6362\u673a\u8fde\u5230\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5c40\u57df\u7f51\u901a\u8fc7 Hub \u6765\u5171\u4eab\u4ecb\u8d28\u3002\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u5c40\u57df\u7f51\u4e5f\u5c5e\u4e8e\u62d3\u6251\u7684\u4e00\u90e8\u5206\uff0c\u5bf9\u5e94\u751f\u6210\u6811\u7684\u4e00\u4e2a\u7ed3\u70b9\u3002\u4e3a\u4e86\u7edf\u4e00\u70b9\u5bf9\u70b9\u548c\u5171\u4eab\u4ecb\u8d28\uff0c\u4e0d\u59a8\u8ba4\u4e3a\u70b9\u5bf9\u70b9\u8fde\u63a5\u4e2d\uff0c\u4e5f\u8fde\u63a5\u4e86\u4e00\u4e2a\u5171\u4eab\u4ecb\u8d28\u7684\u5c40\u57df\u7f51\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u5c40\u57df\u7f51\u6ca1\u6709\u5176\u4ed6\u7f51\u7edc\u8bbe\u5907\u3002\u8fd9\u6837\u8bbe\u5b9a\u4ee5\u540e\uff0c\u4ece\u7f51\u7edc\u62d3\u6251\u4e0a\u6765\u770b\uff0c\u5c31\u662f\u5f88\u591a\u4e2a\u72ec\u7acb\u7684\u5c40\u57df\u7f51\uff0c\u7528\u4ea4\u6362\u673a\u8fde\u63a5\u8d77\u6765\u3002</p> <p>STP \u534f\u8bae\u5de5\u4f5c\u7684\u7b2c\u4e00\u6b65\u662f\u9009\u4e3e\u51fa\u4e00\u4e2a Root Bridge\uff0c\u4e5f\u5c31\u662f\u751f\u6210\u6811\u7684\u6839\u7ed3\u70b9\u3002\u4e3a\u4e86\u4fdd\u8bc1\u9009\u4e3e\u51fa\u552f\u4e00\u7684 Root Bridge\uff0c\u9009\u62e9\u7684\u6807\u51c6\u662f\uff0c\u627e\u5230\u6700\u5c0f\u7684 Bridge ID\uff0cID \u7531\u4eba\u4e3a\u8bbe\u5b9a\u7684\u4f18\u5148\u7ea7\u4ee5\u53ca MAC \u5730\u5740\u7ec4\u6210\u3002\u7531\u4e8e MAC \u5730\u5740\u662f\u552f\u4e00\u7684\uff0c\u6240\u4ee5 Bridge ID \u4e5f\u662f\u552f\u4e00\u7684\uff0c\u56e0\u6b64\u4e00\u5b9a\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u6700\u5c0f\u7684 ID\uff0c\u90a3\u4e48\u5b83\u5c31\u662f Root Bridge\u3002</p> <p>\u5b9e\u9645\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u4ea4\u6362\u673a\u4f1a\u6536\u53d1 BPDU\uff0c\u5e76\u4e14\u628a\u5176\u4ed6\u4ea4\u6362\u673a\u53d1\u7ed9\u81ea\u5df1\u7684 Root ID \u548c\u81ea\u5df1\u7684 ID \u8fdb\u884c\u6bd4\u8f83\uff1a\u5982\u679c\u81ea\u5df1\u7684 ID \u6bd4\u522b\u4eba\u53d1\u7684 Root ID \u90fd\u5c0f\uff0c\u90a3\u4e48\u81ea\u5df1\u662f Root\uff1b\u5982\u679c\u522b\u4eba\u53d1\u7684 Root ID \u6bd4\u81ea\u5df1\u5c0f\uff0c\u90a3\u81ea\u5df1\u80af\u5b9a\u4e0d\u662f Root\u3002\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\uff0c\u62e5\u6709\u6700\u5c0f ID \u7684 Bridge \u4fe1\u606f\u4f1a\u9010\u6e10\u4f20\u64ad\u5230\u6574\u4e2a\u7f51\u7edc\uff0c\u6700\u540e\u6240\u6709\u4ea4\u6362\u673a\u90fd\u4f1a\u5bf9 Root Bridge \u8fbe\u6210\u5171\u8bc6\u3002</p> <p>\u786e\u5b9a\u597d Root Bridge \u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5f97\u5230\u751f\u6210\u6811\u3002\u6bcf\u4e2a\u4ea4\u6362\u673a\u4f1a\u63a5\u6536\u76f8\u90bb\u4ea4\u6362\u673a\u53d1\u9001\u7684 BPDU\uff0c\u5f97\u77e5\u76f8\u90bb\u4ea4\u6362\u673a\u5230 Root Bridge \u7684\u8ddd\u79bb\uff0c\u7136\u540e\u50cf\u8def\u7531\u534f\u8bae\u90a3\u6837\uff0c\u8ba1\u7b97\u51fa\u8d70\u4ece\u54ea\u4e2a Port \u8d70\u5230\u8fbe Root Bridge \u7684\u8ddd\u79bb\u6700\u77ed\uff0c\u5c31\u628a\u8fd9\u4e2a Port \u6807\u8bb0\u4e3a Root Port\uff0c\u610f\u601d\u662f\u6cbf\u7740\u8fd9\u4e2a\u65b9\u5411\u8d70\uff0c\u5c31\u4f1a\u4e00\u8df3\u4e00\u8df3\u5730\u5230\u8fbe Root Bridge\u3002\u540c\u65f6\u4e5f\u4f1a\u66f4\u65b0\u81ea\u5df1\u5230 Root Bridge \u7684\u8ddd\u79bb\uff0c\u53d1\u7ed9\u76f8\u90bb\u7684\u4ea4\u6362\u673a\u3002\u8fd9\u4e9b Root Port \u7684\u65b9\u5411\u5c31\u5bf9\u5e94\u4e86\u751f\u6210\u6811\u91cc\u9762\u7684\u7236\u4eb2\u8282\u70b9\u3002</p> <p>\u5f97\u5230\u751f\u6210\u6811\u4ee5\u540e\uff0c\u5c31\u77e5\u9053\u5982\u4f55\u7981\u7528\u4e0d\u5728\u751f\u6210\u6811\u7684\u8fb9\u4e86\uff1a\u5982\u679c\u5728\u67d0\u4e2a\u975e Root \u7aef\u53e3\u4e0a\u76d1\u542c\u5230\u4e86\u5176\u4ed6\u4ea4\u6362\u673a\u53d1\u9001\u7684 BPDU\uff0c\u90a3\u5c31\u8bf4\u660e\u4ea4\u6362\u673a\u5728\u8fd9\u4e2a\u7aef\u53e3\u65b9\u5411\u4e0a\u5b58\u5728\u4e00\u6761\u4e0d\u5728\u751f\u6210\u6811\u4e0a\u7684\u8fb9\u3002\u4f46\u662f\uff0c\u8fd9\u6761\u8fb9\u4e0a\u6709\u4e00\u4e2a\u5c40\u57df\u7f51\uff08\u524d\u9762\u63d0\u5230\uff0c\u5373\u4f7f\u662f\u4ea4\u6362\u673a\u4e4b\u95f4\u70b9\u5bf9\u70b9\u8fde\u63a5\uff0c\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u6709\u4e00\u4e2a\u6ca1\u6709\u7f51\u7edc\u8bbe\u5907\u7684\u5c40\u57df\u7f51\u5728\u4e2d\u95f4\uff09\uff0c\u8fd9\u4e2a\u5c40\u57df\u7f51\u4f9d\u7136\u9700\u8981\u80fd\u591f\u8bbf\u95ee\u5176\u4ed6\u5c40\u57df\u7f51\u3002\u56e0\u6b64\uff0c\u8fde\u63a5\u5230\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u7684\u591a\u4e2a\u4ea4\u6362\u673a\uff0c\u9700\u8981\u9009\u62e9\u51fa\u4e00\u4e2a\u4ea4\u6362\u673a\uff0c\u8d1f\u8d23\u8fd9\u4e2a\u5c40\u57df\u7f51\u7684\u6240\u6709\u6d41\u91cf\uff0c\u4e5f\u5c31\u662f Designated Bridge\u3002Designated Bridge \u8fde\u5411\u5c40\u57df\u7f51\u7684 Port \u5c31\u662f Designated Port\u3002\u800c\u8fde\u63a5\u5230\u5c40\u57df\u7f51\u7684\u975e Designated Bridge\uff0c\u5c31\u9700\u8981\u7981\u7528\u7aef\u53e3\uff0c\u4e0d\u6536\u4e0d\u53d1\u6570\u636e\uff0c\u53ea\u5904\u7406 BPDU\uff0c\u6b64\u65f6\u5c31\u662f Block Port\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u4ea4\u6362\u673a\u7684\u89c6\u89d2\uff0c\u5982\u679c\u662f Root Bridge\uff0c\u770b\u5230\u7684\u5c31\u662f\u82e5\u5e72\u4e2a Designated Port\uff1b\u5982\u679c\u4e0d\u662f Root Bridge\uff0c\u90a3\u4e48\u4f1a\u770b\u5230\u4e00\u4e2a Root Port\uff0c\u82e5\u5e72\u4e2a Designated Port\uff0c\u53ef\u80fd\u8fd8\u6709 Blocked Port\u3002</p> <p>\u9700\u8981\u533a\u5206\u4e24\u4e2a\u6982\u5ff5\uff1aRole \u548c State\u3002\u6bcf\u4e2a\u4ea4\u6362\u673a\u5728\u6bcf\u4e2a Port \u4e0a\uff0c\u90fd\u6709\u4e00\u4e2a Role \u548c\u4e00\u4e2a State\uff1a</p> <ul> <li>Role\uff1aRoot\uff0cDesignated\uff0cBlocked</li> <li>State\uff1aDisabled\uff0cBlocking\uff0cListening\uff0cLearning\uff0cForwarding</li> </ul> <p>Role \u6307\u7684\u662f\u7aef\u53e3\u7684\u5c5e\u6027\uff0c\u7528\u4e8e STP \u5185\u90e8\uff1a</p> <ul> <li>Root\uff1a\u8fde\u5411 Root \u7684\u6700\u77ed\u8def\u5f84\u7684\u65b9\u5411</li> <li>Designated\uff1a\u8d1f\u8d23\u8f6c\u53d1\u5c40\u57df\u7f51\u6d41\u91cf</li> <li>Blocked\uff1a\u51fa\u73b0\u4e86\u73af\u5bfc\u81f4\u4e0d\u80fd\u8f6c\u53d1</li> </ul> <p>State \u6307\u7684\u662f\u7aef\u53e3\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f STP \u7684\u8f93\u51fa\uff0c\u628a\u7aef\u53e3\u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u72b6\u6001\uff1a</p> <ul> <li>Blocking\uff1a\u4e0d\u8f6c\u53d1\u4ee5\u592a\u7f51\u5e27</li> <li>Listening\uff1a\u4e0d\u8f6c\u53d1\u4ee5\u592a\u7f51\u5e27\uff0c\u4f46\u662f\u6536\u53d1 BPDU</li> <li>Learning\uff1a\u5728 Listening \u7684\u57fa\u7840\u4e0a\uff0c\u76d1\u542c\u6d41\u91cf\uff0c\u5b66\u4e60 MAC \u5730\u5740\uff0c\u6dfb\u52a0\u5230\u8f6c\u53d1\u8868</li> <li>Forwarding\uff1a\u6b63\u5e38\u5de5\u4f5c</li> <li>Disabled\uff1a\u88ab\u7ba1\u7406\u5458\u7981\u7528</li> </ul> <p>\u5c0f\u7ed3\u4e00\u4e0b STP \u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ol> <li>\u9009\u4e3e\u51fa Root Bridge</li> <li>\u5bf9\u4e8e\u6bcf\u4e2a LAN Segment\uff0c\u9009\u4e3e\u51fa Designated Switch</li> <li>\u628a\u4e0d\u5728\u751f\u6210\u6811\u4e0a\u7684\u7aef\u53e3\u8bbe\u7f6e\u4e3a Blocking</li> </ol>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#rapid-spanning-tree-protocol","title":"Rapid Spanning Tree Protocol","text":"<p>RSTP\uff08Rapid Spanning Tree Protocol\uff09\u662f STP \u534f\u8bae\u7684\u5347\u7ea7\uff0c\u5728 802.1D-2004 \u6807\u51c6\u4e2d\u5b9a\u4e49\u3002</p> <p>\u548c STP \u4e0d\u540c\uff0cRSTP \u5b9a\u4e49\u4e86\u4e94\u4e2a Role\uff1a</p> <ul> <li>Root\uff1a\u8fde\u5411 Root \u7684\u6700\u77ed\u8def\u5f84\u7684\u65b9\u5411</li> <li>Designated\uff1a\u8d1f\u8d23\u8f6c\u53d1\u5c40\u57df\u7f51\u6d41\u91cf</li> <li>Alternate\uff1a\u8fde\u5411 Root \u7684\u53e6\u4e00\u6761\u8def\u5f84\u7684\u65b9\u5411</li> <li>Backup\uff1a\u5df2\u7ecf\u6709\u53e6\u4e00\u4e2a\u4ea4\u6362\u673a\u8fde\u63a5\u7684\u5c40\u57df\u7f51\u65b9\u5411</li> <li>Disabled\uff1a\u88ab\u7ba1\u7406\u5458\u7981\u7528</li> </ul> <p>\u9664\u4e86 Disabled \u4ee5\u5916\uff0cRSTP \u548c STP \u7684\u533a\u522b\u5728\u4e8e\uff0cRSTP \u628a Blocked \u6539\u6210\u4e86 Alternate \u548c Backup\uff1a</p> <ul> <li>Alternate \u4f5c\u4e3a Root \u7684\u5907\u4efd\uff1a\u8bb0\u5f55\u4ea4\u6362\u673a\u5230 Root \u7684\u7b2c\u4e8c\u6761\u8def\u5f84\uff0c\u5f53 Root Port \u51fa\u95ee\u9898\u4e86\uff0c\u90a3\u4e48 Alternate Port \u53ef\u4ee5\u6210\u4e3a\u65b0\u7684 Root Port</li> <li>Backup \u4f5c\u4e3a Designated \u7684\u5907\u4efd\uff1a\u8fde\u63a5\u7684\u5c40\u57df\u7f51\u6709\u522b\u7684 Designated Bridge\uff0c\u5982\u679c Designated Bridge \u51fa\u95ee\u9898\u4e86\uff0c\u81ea\u5df1\u53ef\u4ee5\u6210\u4e3a\u65b0\u7684 Designated Bridge</li> </ul> <p>\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u5982\u679c Root Port \u51fa\u95ee\u9898\u4e86\uff0c\u53ef\u4ee5\u53ca\u65f6\u5207\u6362\u5230\u522b\u7684\u8def\u5f84\u4e0a\uff0c\u63d0\u9ad8\u6536\u655b\u901f\u5ea6\u3002</p> <p>\u76f8\u6bd4 STP\uff0cRSTP \u628a State \u7b80\u5316\u6210\u4e86\u4e09\u4e2a\uff1a</p> <ul> <li>Discarding\uff1a\u4e0d\u8f6c\u53d1\u4ee5\u592a\u7f51\u5e27\uff0c\u5bf9\u5e94 STP \u7684 Blocking \u548c Listening</li> <li>Learning\uff1a\u4e0d\u8f6c\u53d1\u4ee5\u592a\u7f51\u5e27\uff0c\u5b66\u4e60 MAC \u5730\u5740</li> <li>Forwarding\uff1a\u6b63\u5e38\u5de5\u4f5c</li> </ul>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#vlan","title":"VLAN","text":"<p>STP \u548c RSTP \u90fd\u6ca1\u6709\u8003\u8651 VLAN\uff0c\u53ea\u8003\u8651\u4e86\u4ea4\u6362\u673a\u7684\u62d3\u6251\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u6bcf\u4e2a VLAN \u53ef\u80fd\u662f\u4e0d\u540c\u7684\u4e00\u4e2a\u62d3\u6251\uff0c\u53ef\u80fd\u53ea\u6709\u90e8\u5206\u4ea4\u6362\u673a\u53c2\u4e0e\u5230\u7279\u5b9a\u7684 VLAN \u4e2d\uff0c\u8fd9\u65f6\u5019\u5c31\u5e0c\u671b\u53ef\u4ee5\u505a\u4e00\u4e2a Per VLAN \u7684 STP\u3002</p> <p>Per VLAN \u7684 STP \u76f8\u5173\u534f\u8bae\u6709\uff1a</p> <ul> <li>STP + VLAN: Per-VLAN Spanning Tree(PVST/PVST+) by Cisco</li> <li>RSTP + VLAN: Rapid Per-VLAN Spanning Tree(Rapid PVST/Rapid PVST+) by Cisco</li> <li>RSTP + VLAN: Vlan-based Spanning Tree(VBST) by Huawei</li> </ul> <p>\u6839\u636e\u6587\u6863\uff0cVBST \u548c Rapid PVST \u662f\u517c\u5bb9\u7684\uff0c\u867d\u7136\u540d\u5b57\u4e0d\u540c\uff0c\u4f46\u5927\u6982\u7387\u662f\u4e00\u6837\u7684\u534f\u8bae\u3002</p> <p>\u6b64\u5916\u8fd8\u6709 Multiple Spanning Tree Protocol(MSTP)\uff0c\u5b9a\u4e49\u5728 IEEE 802.1s-2002 \u6807\u51c6\u4e2d\uff0c\u5b83\u5e76\u4e0d\u662f Per-VLAN Spanning Tree\uff0c\u800c\u652f\u6301\u8de8 VLAN \u7684\u751f\u6210\u6811\u8ba1\u7b97\u3002</p> <p>\u4e0b\u9762\u662f\u5728\u4e0d\u540c\u578b\u53f7\u7684\u4ea4\u6362\u673a\u4e0a\u89c2\u5bdf\u5230\u652f\u6301\u7684\u534f\u8bae\uff1a</p> <ul> <li>Dell: stp pvst rstp rapid-pvst mstp</li> <li>Huawei: stp rstp mstp vbst</li> <li>Mellanox: rst mst rpvst</li> <li>Cisco: mst rapid-pvst</li> </ul> <p>\u5b9e\u8df5\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 rapid-pvst/vbst/rpvst \u7684\u914d\u7f6e\u3002</p>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#stp-port-type","title":"STP Port Type","text":"<p>\u5728\u4ea4\u6362\u673a\u8bbe\u7f6e\u4e2d\uff0c\u7ecf\u5e38\u53ef\u4ee5\u770b\u5230\u5bf9 STP Port Type \u7684\u652f\u6301\uff1a</p> <ul> <li>Edge\uff1a\u4ec5\u4e3b\u673a</li> <li>Network\uff1a\u4ec5\u4ea4\u6362\u673a</li> <li>Normal\uff1a\u81ea\u9002\u5e94</li> </ul> <p>STP \u534f\u8bae\u5728\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u9632\u6b62\u534f\u8bae\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u5f15\u5165\u4e86\u4e0d\u5fc5\u8981\u7684\u73af\u8def\uff0c\u521d\u59cb\u5316\u65f6\u662f\u4e0d\u8f6c\u53d1\u6d41\u91cf\u7684\u3002\u90a3\u4e48\uff0c\u5982\u679c\u4e8b\u5148\u77e5\u9053\u7aef\u53e3\u8fde\u63a5\u7684\u53ea\u6709\u4e3b\u673a\uff0c\u6ca1\u6709\u4ea4\u6362\u673a\uff0c\u5c31\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u76f4\u63a5\u5f00\u59cb\u8fdb\u5165 Forwarding \u72b6\u6001\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u4e3a Edge \u6a21\u5f0f\u3002\u5728 Edge \u6a21\u5f0f\u4e0b\uff0c\u4ea4\u6362\u673a\u4e0d\u4f1a\u53d1\u9001 BPDU\u3002</p> <p>\u5982\u679c\u4e8b\u5148\u77e5\u9053\u8fde\u63a5\u7684\u662f\u4ea4\u6362\u673a\uff0c\u53ef\u4ee5\u9009\u62e9 Network\uff0c\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cCisco \u5b9e\u73b0\u4e86 Bridge Assurance\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a Network \u6a21\u5f0f\uff0c\u5fc5\u987b\u8981\u6c42\u5bf9\u65b9\u4e5f\u8bbe\u7f6e\u4e3a Network \u6a21\u5f0f\uff0c\u5426\u5219\u5c31\u4e0d\u4f1a\u5de5\u4f5c\u3002</p> <p>\u666e\u9002\u7684\u65b9\u6cd5\u662f\u8bbe\u7f6e\u4e3a Normal\uff0c\u6b64\u65f6\u5c31\u4f1a\u6309\u7167\u6b63\u5e38\u7684\u65b9\u6cd5\u6765\u521d\u59cb\u5316\u3002</p>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#bpdu-filter","title":"BPDU Filter","text":"<p>BPDU Filter \u987e\u540d\u601d\u4e49\uff0c\u5728\u7279\u5b9a\u7aef\u53e3\u4e0a\u7981\u7528 STP \u534f\u8bae\uff1a\u4e0d\u53d1\u9001 BPDU\uff0c\u6536\u5230\u7684 BPDU \u90fd\u5ffd\u7565\uff0c\u53ef\u4ee5\u7528\u6765\u9650\u5236 STP \u5de5\u4f5c\u7684\u8303\u56f4\u3002</p>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2023/06/20/spanning-tree-protocol/#virtual-port-channel-vpc","title":"Virtual Port Channel (vPC)","text":"<p>STP \u89e3\u51b3\u4e86\u73af\u8def\u7684\u95ee\u9898\uff0c\u4f7f\u5f97\u7f51\u7edc\u7ba1\u7406\u5458\u5728\u8bbe\u8ba1\u62d3\u6251\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a\u8fb9\u6765\u63d0\u4f9b\u5197\u4f59\u3002\u4f46\u662f\uff0cSTP \u7684\u5de5\u4f5c\u539f\u7406\u51b3\u5b9a\u4e86\uff0c\u5197\u4f59\u94fe\u8def\u5e73\u65f6\u662f\u88ab\u7981\u7528\u7684\uff0c\u4e0d\u4f1a\u8d70\u6d41\u91cf\u3002\u662f\u5426\u6709\u529e\u6cd5\uff0c\u5728\u63d0\u4f9b\u5197\u4f59\u7684\u540c\u65f6\uff0c\u53c8\u80fd\u591f\u5229\u7528\u4e0a\u5197\u4f59\u94fe\u8def\u7684\u5e26\u5bbd\uff1f</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u573a\u666f\uff0c\u5382\u5546\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u8fd9\u91cc\u4ee5 Cisco \u7684 vPC \u4f5c\u4e3a\u4e00\u4e2a\u4f8b\u5b50\u6765\u4ecb\u7ecd\u3002vPC \u5c31\u662f\u865a\u62df\u7684 Port Channel \u7684\u610f\u601d\uff0cPort Channel \u5c31\u662f\u94fe\u8def\u805a\u5408\uff0c\u628a\u4e24\u4e2a\u4ea4\u6362\u673a\u4e4b\u95f4\u7684\u591a\u6761\u94fe\u8def\u5f53\u6210\u4e00\u4e2a\u7528\uff1bVirtual Port Channel(vPC) \u5219\u662f\u628a Port Channel \u6269\u5c55\u5230\u4e86\u8de8\u4ea4\u6362\u673a\uff0c\u4e8c\u5bf9\u4e00\uff0c\u4e00\u90e8\u5206\u94fe\u8def\u8fde\u5230 Switch 1\uff0c\u5269\u4e0b\u7684\u94fe\u8def\u8fde\u5230 Switch 2\uff0c\u4f46\u662f\u4ece\u5916\u9762\u770b\u8fc7\u6765\uff0c\u7b49\u4ef7\u4e8e\u53ea\u6709\u4e00\u4e2a\u4ea4\u6362\u673a\uff1a</p> <p></p> <p>\u6765\u6e90\uff1aPort Channels and vPCs</p> <p>\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u5bf9\u5197\u4f59\u94fe\u8def\u7684\u5229\u7528\u3002</p> <p>\u5728 vPC \u7684 Peer Switch \u6a21\u5f0f\u4e0b\uff0c\u4e3a\u4e86\u8ba9 Switch 3 \u770b\u5230\u7684\u53ea\u662f\u4e00\u4e2a\u4ea4\u6362\u673a\uff0c\u5b83\u628a Switch 1 \u548c Switch 2 \u4f2a\u88c5\u6210\u540c\u4e00\u4e2a\u4ea4\u6362\u673a\uff1aSTP \u7684 Bridge ID \u76f8\u540c\uff0c\u5728 STP \u534f\u8bae\u4e2d\u770b\u8d77\u6765\u5230\u5c31\u662f\u4e00\u4e2a Root Bridge\u3002</p> <p>\u5728 Dell \u548c Mellanox \u4ea4\u6362\u673a\u4e2d\uff0c\u7c7b\u4f3c\u7684\u529f\u80fd\u53eb\u505a MLAG(Multi-switch LAG/Multi-chassis LAG)\u3002</p>","tags":["stp","rstp","mstp","pvst","vbst"]},{"location":"networking/2018/05/09/tinc-between-macos-and-linux/","title":"\u5728 macOS \u548c Linux \u4e4b\u95f4\u642d\u5efa tinc \u7f51\u7edc","text":"<p>\u4e00\u76f4\u542c\u8bf4 tinc \u6bd4\u8f83\u79d1\u5b66\uff0c\u6240\u4ee5\u5c1d\u8bd5\u81ea\u5df1\u7528 tinc \u642d\u5efa\u4e00\u4e2a\u7f51\u7edc\u3002\u8fd9\u91cc\uff0cmacOS \u8fd9\u6bb5\u6ca1\u6709\u56fa\u5b9a IP \u5730\u5740\uff0cLinux \u673a\u5668\u6709\u56fa\u5b9a IP \u5730\u5740 linux_ip\u3002\u5047\u8bbe\u7f51\u7edc\u540d\u79f0\u4e3a example , macOS \u7aef\u540d\u4e3a macos \u5730\u5740\u4e3a 192.168.0.2, linux \u7aef\u540d\u4e3a linux \u5730\u5740\u4e3a 192.168.0.1\u3002</p> <p>2018-11-11 \u6ce8\uff1a\u672c\u6587\u7528\u7684 tinc \u7248\u672c\u4e3a 1.0.x\uff0c\u800c\u4e0d\u662f 1.1-pre\uff0c\u4e24\u4e2a\u5206\u652f\u547d\u4ee4\u4e0d\u540c\uff0c\u4f46\u534f\u8bae\u53ef\u4ee5\u517c\u5bb9\u3002</p> <p>\u5728 macOS \u4e0a\u914d\u7f6e\uff1a <pre><code>brew install tinc\nmkdir -p /usr/local/etc/tinc/example\n</code></pre></p> <p>\u65b0\u5efa /usr/local/etc/tinc/example/tinc.conf: <pre><code>Name = macos\nDevice = utun0 # use an unused number\nConnectTo = linux\n</code></pre></p> <p>\u7f16\u8f91 /usr/local/etc/tinc/example/tinc-up: <pre><code>#!/bin/sh\nifconfig $INTERFACE 192.168.0.2 192.168.0.1 mtu 1500 netmask 255.255.255.255\n</code></pre></p> <p>\u548c /usr/local/etc/tinc/example/tinc-down: <pre><code>#!/bin/sh\nifconfig $INTERFACE down\n</code></pre></p> <p>\u8fd8\u6709 /usr/local/etc/tinc/example/subnet-up: <pre><code>#!/bin/sh\n[ \"$NAME\" = \"$NODE\" ] &amp;&amp; exit 0\n/usr/local/opt/iproute2mac/bin/ip route add $SUBNET dev $INTERFACE\n</code></pre></p> <p>\u4ee5\u53ca /usr/local/etc/tinc/example/subnet-down: <pre><code>#!/bin/sh\n[ \"$NAME\" = \"$NODE\" ] &amp;&amp; exit 0\n/usr/local/opt/iproute2mac/bin/ip route del $SUBNET dev $INTERFACE\n</code></pre></p> <p>\u7136\u540e\u5c06\u5b83\u4eec\u90fd\u8bbe\u4e3a\u53ef\u6267\u884c\u7684\uff1a <pre><code>chmod +x tinc-up\nchmod +x tinc-down\nchmod +x subnet-down\nchmod +x subnet-down\n</code></pre></p> <p>\u7f16\u8f91 /usr/local/etc/tinc/example/macos: <pre><code>Port = 655\nSubnet = 192.168.0.1/24\n</code></pre></p> <p>\u6267\u884c <code>tincd -n example -K</code> \u751f\u6210\u5bc6\u94a5\u3002</p> <p>\u5230 Linux \u673a\u5668\u4e0a\uff1a \u7f16\u8f91\u4ee5\u4e0b\u6587\u4ef6\uff1a <pre><code>$ mkdir -p /etc/tinc/example/hosts\n$ cat /etc/tinc/example/tinc.conf\nName = linux\n$ cat /etc/tinc/example/tinc-up\n$!/bin/sh\nip link set $INTERFACE up\nip addr add 192.168.0.1/24 dev $INTERFACE\n$ cat /etc/tinc/example/tinc-down\n$!/bin/sh\nip addr del 192.168.0.1/24 dev $INTERFACE\nip link set $INTERFACE down\n$ cat /etc/tinc/example/hosts/linux\nAddress = linux_ip\nPort = 655\nSubnet = 192.168.0.1/24\n$ tincd -n example -K\n</code></pre></p> <p>\u63a5\u7740\uff0c\u628a linux \u4e0a /etc/tinc/example/hosts/linux \u62f7\u8d1d\u5230 macos \u7684 /usr/local/etc/tinc/example/hosts/linux\uff0c\u7136\u540e\u628a macos \u4e0a /usr/local/etc/tinc/example/hosts/macos \u62f7\u8d1d\u5230 /etc/tinc/example/hosts/macos\u3002\u5728\u4e24\u53f0\u673a\u5668\u4e0a\u90fd <code>tinc -n example -D -d3</code> \u5373\u53ef\u770b\u5230\u8fde\u63a5\u7684\u5efa\u7acb\uff0c\u901a\u8fc7 ping \u5373\u53ef\u9a8c\u8bc1\u7f51\u7edc\u5efa\u7acb\u6210\u529f\u3002</p> <p>2018-05-29 Update: Android \u4e0a\uff0c\u5229\u7528 Tinc GUI \u4e5f\u53ef\u4ee5\u628a Tinc \u8fd0\u884c\u8d77\u6765\uff0c\u53ea\u662f\u914d\u7f6e\u4e0d\u5927\u4e00\u6837\uff1a</p> <pre><code>$ cat tinc.conf\nName = example\nDevice = /dev/tun\nMode = switch\nConnectTo = remote\nScriptsInterpreter = /system/bin/sh\n$ cat tinc-up\n#!/bin/sh\nip link set $INTERFACE up\nip addr add local_ip/24 dev $INTERFACE\n$ cat tinc-down\n#!/bin/sh\nip addr del local_ip/24 dev $INTERFACE\nip link set $INTERFACE down\n$ cat subnet-up\n$!/bin/bash\n[ \"$NAME\" = \"$NODE\" ] &amp;&amp; exit 0\nip route add $SUBNET dev $INTERFACE metric $WEIGHT table local\n$ cat subnet-down\n#!/bin/bash\n[ \"$NAME\" = \"$NODE\" ] &amp;&amp; exit 0\nip route del $SUBNET dev $INTERFACE table local\n</code></pre> <p>\u6ce8\u610f table local \u7684\u4f7f\u7528\u3002\u9700\u8981 Root\u3002</p>","tags":["linux","macos","tinc"]},{"location":"networking/2023/02/12/transport-layer-interface/","title":"Transport Layer Interface \u8003\u53e4","text":"","tags":["solaris","tli","xti","sysv","unix"]},{"location":"networking/2023/02/12/transport-layer-interface/#transport-layer-interface","title":"Transport Layer Interface","text":"<p>\u73b0\u5728\u7f51\u7edc\u7f16\u7a0b\u4e3b\u8981\u91c7\u7528\u7684\u662f BSD Sockets API\uff0c\u4f46\u5b9e\u9645\u4e0a\u5f53\u5e74\u8fd8\u6709\u53e6\u4e00\u5957 API\uff0c\u5c31\u662f TLI\uff08Transport Layer Interface\uff09\uff0c\u540e\u6765 BSD Sockets \u80dc\u51fa\uff0c\u8fdb\u5165\u4e86 POSIX \u6807\u51c6\uff0cTLI \u540e\u9762\u4e5f\u6807\u51c6\u5316\u4e3a\u4e86 XTI\uff0c\u73b0\u5728\u53ef\u4ee5\u5728\u90e8\u5206 Unix \u7cfb\u7edf\u4e2d\u627e\u5230\u3002TLI/XTI \u7684\u4f7f\u7528\u65b9\u6cd5\u548c Sockets API \u6709\u4e9b\u7c7b\u4f3c\uff0c\u4f46\u662f\u6bd4\u8f83\u7279\u522b\u7684\u4e00\u70b9\u5728\u4e8e\uff0cSockets API \u7b2c\u4e00\u6b65\u662f <code>socket</code> \u8c03\u7528\uff0c\u4f20\u7684\u53c2\u6570\u5c31\u51b3\u5b9a\u4e86\u8fd9\u662f TCP \u8fd8\u662f UDP \u8fd8\u662f\u5176\u4ed6\u4ec0\u4e48\u534f\u8bae\uff0c\u800c TLI \u662f\u901a\u8fc7\u6253\u5f00\u4e0d\u540c\u7684\u8bbe\u5907\u6587\u4ef6\u6765\u8fdb\u884c\u533a\u5206\uff1a</p> <pre><code>int fd = t_open(\"/dev/udp\", O_RDWR, NULL);\n</code></pre> <p>\u6bd4\u5982 TCP \u5c31\u662f <code>/dev/tcp</code>\uff0cUDP \u5c31\u662f <code>/dev/udp</code>\uff0c\u540c\u7406\u8fd8\u6709 <code>/dev/icmp</code> \u7b49\u7b49\u3002\u8fd9\u9887\u6709 Unix \u7684\u54f2\u5b66\uff1aeverything is a file\u3002\u800c BSD Sockets API \u5219\u662f\u6709\u5bf9\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\uff0clibc \u57fa\u672c\u4e0d\u9700\u8981\u505a\u4ec0\u4e48\u4e8b\u60c5\u3002</p> <p>\u6cbf\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u65e2\u7136 TLI \u7b2c\u4e00\u6b65\u662f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\uff0c\u96be\u9053\u540e\u9762\u7684\u4e00\u7cfb\u5217\u7684 bind\u3001connect\u3001send\u3001recv \u7b49\u64cd\u4f5c\u4e5f\u662f\u5bf9\u6587\u4ef6\u8bfb\u5199\u5417\uff1f\u662f\u7684\uff01\u5982\u679c\u6211\u4eec\u67e5\u770b illumos \u7684\u6e90\u7801\uff0c\u4f1a\u53d1\u73b0 <code>t_connect</code> \u51fd\u6570\u7684\u6838\u5fc3\u5b9e\u73b0\u662f\uff1a</p> <pre><code>    creq = (struct T_conn_req *)ctlbufp-&gt;buf;\n    creq-&gt;PRIM_type = T_CONN_REQ;\n    creq-&gt;DEST_length = call-&gt;addr.len;\n    creq-&gt;DEST_offset = 0;\n    creq-&gt;OPT_length = call-&gt;opt.len;\n    creq-&gt;OPT_offset = 0;\n\n    if (putmsg(fd, ctlbufp,\n        (struct strbuf *)(call-&gt;udata.len? &amp;call-&gt;udata: NULL), 0) &lt; 0) {\n        t_errno = TSYSERR;\n        return (-1);\n    }\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6bb5\u5728 libnsl \u4e2d\u7684\u4ee3\u7801\u6784\u9020\u4e86\u4e00\u4e2a\u7ed3\u6784\u4f53 <code>struct T_conn_req</code>\uff0c\u7136\u540e\u901a\u8fc7 <code>putmsg</code> \u7cfb\u7edf\u8c03\u7528\u53d1\u9001\u51fa\u53bb\u3002\u53ef\u4ee5\u9884\u60f3\uff0c\u5185\u6838\u90a3\u8fb9\u865a\u62df\u4e86\u4e00\u4e2a <code>/dev/tcp</code> \u8bbe\u5907\uff0c\u8fd9\u4e2a\u8bbe\u5907\u6ce8\u518c\u4e86 putmsg \u7684\u56de\u8c03\u51fd\u6570\u3002\u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u89e3\u6790\u7ed3\u6784\u4f53\u7684\u5b57\u6bb5\uff0c\u7136\u540e\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002\u7528\u6237\u8c03\u7528 TLI \u51fd\u6570\uff0c\u7136\u540e libnsl \u8d1f\u8d23\u628a\u51fd\u6570\u7684\u53c2\u6570\u5c01\u88c5\u6210\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u7136\u540e\u5411 <code>t_open</code> \u6253\u5f00\u7684\u8bbe\u5907\u6587\u4ef6\u53d1\u9001\u7ed3\u6784\u4f53\u7684\u5185\u5bb9\u3002\u5185\u6838\u548c libnsl \u7ea6\u5b9a\u597d\u4e86\u7ed3\u6784\u4f53\uff0c\u7136\u540e\u4e0d\u540c\u7684\u64cd\u4f5c\u6839\u636e\u7ed3\u6784\u4f53\u7684 <code>PRIM_type</code> \u5b57\u6bb5\u6765\u533a\u5206\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u7ea6\u5b9a\u4e5f\u662f\u4e00\u4e2a\u6807\u51c6\uff0c\u53eb\u505a TPI(Transport Provider Interface)\u3002</p>","tags":["solaris","tli","xti","sysv","unix"]},{"location":"networking/2023/02/12/transport-layer-interface/#transport-provider-interface","title":"Transport Provider Interface","text":"<p>TPI(Transport Provider Interface) \u7ea6\u5b9a\u4e86\u5185\u6838\u548c libnsl \u4e4b\u95f4\u7684\u63a5\u53e3\u3002\u5185\u6838\u548c\u7528\u6237\u6001\u4e4b\u95f4\u4e92\u76f8\u53d1\u9001\u6d88\u606f\uff0c\u6709\u70b9\u50cf HTTP\uff0c\u4e00\u4e2a\u8bf7\u6c42\u8fc7\u53bb\uff0c\u4e00\u4e2a\u54cd\u5e94\u56de\u6765\u3002\u53ea\u4e0d\u8fc7\u8bf7\u6c42\u662f\u201cconnect\u201d\u6216\u8005\u201caccept\u201d\u7b49\u7b49\u3002\u76f8\u6bd4 Sockets API\uff0c\u786e\u5b9e\u7ed5\u4e86\u5f88\u591a\uff0c\u9996\u5148\u8981\u5c01\u88c5\u5230 struct \u91cc\u9762\uff0c\u7136\u540e\u901a\u8fc7\u7edf\u4e00\u7684\u8bfb\u5199 syscall \u8fdb\u5165\u5230\u5185\u6838\uff0c\u518d\u89e3\u6790\u4e00\u904d struct\uff0c\u518d\u505a\u5b9e\u9645\u7684\u64cd\u4f5c\u3002\u5982\u679c\u76f4\u63a5 syscall \u7684\u8bdd\uff0c\u5185\u6838\u5b9e\u73b0\u4f1a\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u201cUnix\u201d\u4e86\u3002\u5b9e\u9645\u4e0a\uff0c\u5982\u8fc7\u4f60\u9605\u8bfb Illumos \u6e90\u7801\uff0c\u5b83\u5728\u89e3\u6790 struct \u4ee5\u540e\uff0c\u4e5f\u4f1a\u8f6c\u800c\u6267\u884c\u76f8\u5e94\u7684 Sockets \u5904\u7406\u51fd\u6570\uff0c\u7136\u540e\u628a\u8fd4\u56de\u503c\u518d\u5c01\u88c5\u6210 TLI \u7684\u54cd\u5e94\uff0c\u53d1\u9001\u7ed9\u7528\u6237\u7a0b\u5e8f\u3002</p> <p>\u6bd4\u8f83\u6709\u610f\u601d\u7684\u662f\uff0cTPI \u672c\u8eab\u4e5f\u662f\u6709\u72b6\u6001\u7684\uff1aIdle\uff0cUnbound\uff0cData Transfer\uff0c\u7b49\u5f85 ACK \u7b49\u7b49\u3002\u6240\u4ee5\u5982\u679c\u4f60\u5728 Solaris \u4e0a\u8dd1 netstat\uff0c\u4f1a\u53d1\u73b0 UDP \u4e5f\u6709\u72b6\u6001\uff08Idle/Unbound\uff09\uff0c\u90a3\u5b9e\u9645\u4e0a\u4e0d\u662f UDP \u7684\u72b6\u6001\uff0c\u800c\u662f TPI \u7684\u72b6\u6001\u3002\u6b63\u56e0\u6b64\uff0c\u6211\u5728\u7ef4\u62a4 lsof \u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u770b\u5230 TCP/TPI state\uff0c\u4e0d\u660e\u6240\u4ee5\uff0c\u624d\u4f1a\u7814\u7a76 TPI \u7684\u5386\u53f2\uff0c\u7136\u540e\u627e\u5230 TLI\uff0c\u624d\u77e5\u9053\u9664\u4e86 Sockets \u4ee5\u5916\uff0c\u8fd8\u6709\u4e00\u5957 Unix \u4e0a\u7684\u7f51\u7edc API\u3002\u6709\u8da3\u7684\u662f\uff0cTLI \u662f System V \u63d0\u4f9b\u7684\uff0c\u4ee5\u524d\u7ecf\u5e38\u542c\u5230 System V ABI \u7684\u8bf4\u6cd5\uff0c\u5374\u4e0d\u77e5\u9053 System V \u662f\u4e00\u4e2a Unix \u64cd\u4f5c\u7cfb\u7edf\uff0c\u73b0\u5728\u4f9d\u7136\u8fd8\u53ef\u4ee5\u5728\u5f88\u591a\u5730\u65b9\u770b\u5230\u5b83\u7684\u8eab\u5f71\u3002</p>","tags":["solaris","tli","xti","sysv","unix"]},{"location":"networking/2023/02/12/transport-layer-interface/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Networking Services (XNS)</li> <li>Transport Provider Interface</li> </ul>","tags":["solaris","tli","xti","sysv","unix"]},{"location":"networking/2023/02/12/transport-layer-interface/#chatgpt","title":"ChatGPT","text":"<p>\u95ee\uff1aWhat is Transport Layer Interface?</p> <p>\u7b54\uff1aThe Transport Layer Interface (TLI) is an application programming interface (API) that provides a standard interface for communication between an application program and the transport layer protocols of a network. It was originally developed by AT&amp;T for the Unix operating system and is now used in many other operating systems.</p> <p>The TLI provides a set of functions that allow applications to communicate with the transport layer protocols, such as TCP and UDP, in a network-independent manner. Applications can use TLI to establish connections, send and receive data, and manage network resources.</p> <p>One of the advantages of TLI is that it provides a layer of abstraction between the application and the transport layer protocols, which allows the application to be independent of the underlying network. This means that an application can be developed using TLI on one operating system and run on another operating system with different transport layer protocols.</p> <p>However, TLI is an older interface and has largely been replaced by newer interfaces such as the sockets API, which is now the de facto standard for network programming.</p> <p>\u95ee\uff1aWhat's the relationship between Transport Layer Interface and Transport Provider Interface?</p> <p>\u7b54\uff1aThe Transport Layer Interface (TLI) and Transport Provider Interface (TPI) are both application programming interfaces (APIs) that provide a standard way for applications to communicate with the transport layer protocols of a network. However, they are different interfaces that serve different purposes.</p> <p>TLI is an API that was developed by AT&amp;T for the Unix operating system to provide a network-independent interface for applications to communicate with transport layer protocols such as TCP and UDP. It provides a set of functions that allow applications to establish connections, send and receive data, and manage network resources.</p> <p>On the other hand, TPI is an API that was developed by the X/Open consortium to provide a standard interface for communication between the transport layer protocols and network drivers or hardware. It provides a set of functions that allow transport providers to interact with network drivers or hardware and handle network-specific issues such as congestion control, flow control, and error handling.</p> <p>In other words, TLI is an interface for applications to communicate with the transport layer protocols, while TPI is an interface for transport providers to communicate with network drivers or hardware. The two interfaces are related in that TLI can be implemented using TPI, but they are distinct and serve different purposes in the network architecture.</p> <p>\u95ee\uff1aPlease write a UDP echo server in Transport Layer Interface</p> <p>\u7b54\uff1aSure, here is an example of a UDP echo server using the Transport Layer Interface (TLI) in C language:</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;netdb.h&gt;\n#include &lt;tiuser.h&gt;\n\n#define BUFSIZE 1024\n#define SERVICE_NAME \"echo\"\n\nint main(int argc, char *argv[])\n{\n    int sockfd, len, n;\n    struct t_call call;\n    struct t_unitdata ud;\n    struct t_uderr uderr;\n    struct netbuf *recvbuf;\n    char buf[BUFSIZE];\n    struct sockaddr_in servaddr, cliaddr;\n    struct hostent *server;\n    int portno = 5001; // can be any available port number\n\n    // create socket\n    if ((sockfd = t_open(\"/dev/udp\", O_RDWR, NULL)) &lt; 0) {\n        perror(\"t_open\");\n        exit(1);\n    }\n\n    // bind socket to port\n    memset((char *)&amp;servaddr, 0, sizeof(servaddr));\n    servaddr.sin_family = AF_INET;\n    servaddr.sin_addr.s_addr = INADDR_ANY;\n    servaddr.sin_port = htons(portno);\n    if (t_bind(sockfd, NULL, NULL) &lt; 0) {\n        perror(\"t_bind\");\n        exit(1);\n    }\n\n    // listen for incoming requests\n    while (1) {\n        memset((char *)&amp;call, 0, sizeof(call));\n        memset((char *)&amp;cliaddr, 0, sizeof(cliaddr));\n        memset((char *)&amp;ud, 0, sizeof(ud));\n        call.addr.buf = (char *)&amp;cliaddr;\n        call.addr.maxlen = sizeof(cliaddr);\n        call.addr.len = 0;\n        call.opt.len = 0;\n        call.udata.len = 0;\n\n        // receive message\n        recvbuf = (struct netbuf *)t_alloc(sockfd, T_UNITDATA, T_ALL);\n        if (t_rcvudata(sockfd, recvbuf, &amp;ud, &amp;uderr) &lt; 0) {\n            perror(\"t_rcvudata\");\n            exit(1);\n        }\n        memcpy(buf, recvbuf-&gt;buf, recvbuf-&gt;len);\n        buf[recvbuf-&gt;len] = '\\0';\n        printf(\"Received: %s\\n\", buf);\n\n        // send message back to client\n        ud.udata.buf = buf;\n        ud.udata.len = recvbuf-&gt;len;\n        ud.addr.buf = (char *)&amp;cliaddr;\n        ud.addr.len = sizeof(cliaddr);\n        ud.addr.maxlen = sizeof(cliaddr);\n        if (t_sndudata(sockfd, &amp;ud) &lt; 0) {\n            perror(\"t_sndudata\");\n            exit(1);\n        }\n    }\n    return 0;\n}\n</code></pre> <p>This UDP echo server listens on a specific port and waits for incoming messages from clients. When it receives a message, it sends the same message back to the client as a response. Note that this example assumes that the TLI library is already installed on your system, and the program is compiled with the appropriate TLI library flags.</p>","tags":["solaris","tli","xti","sysv","unix"]},{"location":"networking/2022/01/03/upgrade-e8450-openwrt-ubi/","title":"\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI","text":"","tags":["openwrt","linksys","e8450","ubi","flash","router"]},{"location":"networking/2022/01/03/upgrade-e8450-openwrt-ubi/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728 OpenWRT Linksys E8450 \u9875\u9762 \u4e2d\uff0c\u5982\u679c\u8981\u7528\u65b0\u7248\u7684\u56fa\u4ef6\uff0c\u9700\u8981\u8f6c\u6362\u5230 UBI \u683c\u5f0f\u7684\u6587\u4ef6\u7cfb\u7edf\u3002\u4e4b\u524d\u7528\u7684\u662f non-UBI \u683c\u5f0f\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u76f4\u63a5\u5728\u5b98\u65b9\u7684\u5206\u533a\u4e0b\uff0c\u8986\u76d6\u6389\u5176\u4e2d\u4e00\u4e2a\u542f\u52a8\u5206\u533a\u3002\u4f46\u662f\u7ecf\u5e38\u4f1a\u62a5\u544a flash \u51fa\u9519\uff0c\u7136\u540e\u7cfb\u7edf\u4e5f\u4e0d\u7a33\u5b9a\uff0c\u51b3\u5b9a\u8981\u6309\u7167\u6587\u6863\u66f4\u65b0\u5230 UBI\u3002</p>","tags":["openwrt","linksys","e8450","ubi","flash","router"]},{"location":"networking/2022/01/03/upgrade-e8450-openwrt-ubi/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>\u8bf7\u6ce8\u610f\uff1a\u66f4\u6362\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u6bd4\u8f83\u5371\u9669\uff0c\u8bf7\u5148\u5907\u4efd\u597d\u6570\u636e\uff0c\u5e76\u505a\u597d\u53d8\u7816\u7684\u5fc3\u7406\u51c6\u5907\u3002\u672c\u6587\u4ec5\u8bb0\u5f55\u4e86\u4f5c\u8005\u7f16\u5199\u65f6\u53ef\u884c\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4e0d\u4ee3\u8868\u8bfb\u8005\u5728\u9605\u8bfb\u65f6\uff0c\u4f9d\u7136\u53ef\u4ee5\u6309\u7167\u8fd9\u4e2a\u987a\u5e8f\u8fdb\u884c\uff0c\u8bf7\u6309\u7167 https://github.com/dangowrt/owrt-ubi-installer \u7684\u6587\u6863\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u57fa\u672c\u6309\u7167\u6587\u6863\u4e00\u6b65\u4e00\u6b65\u8d70\u3002\u521d\u59cb\u72b6\u6001\u662f\u4e00\u4e2a non-UBI \u7248\u672c\u7684 OpenWRT \u56fa\u4ef6\uff1a</p> <ol> <li>\u4e0b\u8f7d\u5b98\u65b9\u7684 1.0 \u56fa\u4ef6\uff1ahttps://downloads.linksys.com/support/assets/firmware/FW_E8450_1.0.01.101415_prod.img</li> <li>\u5728 luci \u4e2d\uff0c\u5237\u5165\u5b98\u65b9 1.0 \u56fa\u4ef6\uff0c\u8fd9\u65f6\u5019\u8fdb\u5165\u4e86\u5b98\u65b9\u56fa\u4ef6\u7684\u7cfb\u7edf</li> <li>\u767b\u5f55\u5b98\u65b9\u56fa\u4ef6\u7f51\u9875\uff0c\u6062\u590d\u51fa\u5382\u8bbe\u7f6e</li> <li>\u4e0b\u8f7d openwrt ubi recovery \u56fa\u4ef6 \u7136\u540e\u5728\u5b98\u65b9\u56fa\u4ef6\u91cc\u5237\u5165</li> <li>\u8fd9\u65f6\u5019\u8fdb\u5165\u4e86 recovery \u56fa\u4ef6\uff0c\u4e0b\u8f7d ubi \u56fa\u4ef6\uff0c\u7ee7\u7eed\u5728\u7f51\u9875\u91cc\u5237\u5165</li> <li>\u8fd9\u65f6\u5019\u56fa\u4ef6\u5c31\u66f4\u65b0\u5b8c\u6210\u4e86\u3002ssh root@192.168.1.1\uff0c\u7136\u540e\u8fdb\u53bb\u5b89\u88c5 luci \u7b49\u8f6f\u4ef6\uff0c\u6062\u590d\u914d\u7f6e\u5373\u53ef\u3002</li> </ol>","tags":["openwrt","linksys","e8450","ubi","flash","router"]},{"location":"networking/2018/08/10/use-babel-in-overlay-network-with-wireguard/","title":"\u5728 WireGuard \u6784\u5efa\u7684 Overlay Network \u4e0a\u8dd1 babel \u8def\u7531\u534f\u8bae","text":"<p>\u53d7 Run Babeld over Wireguard - Fugoes's Blog \u548c Route-based VPN on Linux with WireGuard \u542f\u53d1\uff0c\u81ea\u5df1\u4e5f\u60f3\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u5728\u4e00\u4e2a\u6709\u591a\u4e2a\u7ed3\u70b9\u7684\u7f51\u7edc\u4e2d\uff0c\u5982\u4f55\u901a\u8fc7 WireGuard \u6784\u5efa\u4e00\u4e2a overlay network\uff0c\u5e76\u901a\u8fc7 babel \u81ea\u52a8\u8fdb\u884c\u7ed3\u70b9\u53d1\u73b0\u548c\u8def\u5f84\u9009\u62e9\u3002</p> <p>\u9996\u5148\u5efa\u7acb\u70b9\u5bf9\u70b9\u7684 WireGuard Tunnel\u3002\u7531\u4e8e\u6211\u4eec\u7528 babel \u8fdb\u884c\u8def\u7531\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u91c7\u7528 Wiregurad \u672c\u8eab\u57fa\u4e8e\u76ee\u7684\u5730\u5740\u7684\u7aef\u53e3\u590d\u7528\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a WireGuard interface \u90fd\u53ea\u6709\u4e00\u4e2a Peer\u3002</p> <p>\u914d\u7f6e\u4e00\u4e2a\u70b9\u5bf9\u70b9\u7684 WireGuard Tunnel\uff1a</p> <pre><code>$ # for wg-quick\n$ cat wg0.conf\n[Interface]\nAddress = IPV4/32, fe80::ID/64\nPrivateKey = REDACTED\nListenPort = PORT1\nTable = off # ask wg-quick not to insert peer address into routing table\n\n[Peer]\nPublicKey = REDACTED\nAllowedIPs = 0.0.0.0/0, ::/0\nEndpoint = REDACTED:PORT2\n</code></pre> <p>\u8fd9\u91cc\u7684 IPV4 \u548c ID \u5728\u540c\u4e00\u8bbe\u5907\u4e0a\u7684\u4e0d\u540c WireGuard Tunnel \u4e0a\u76f8\u540c\u3002\u53ea\u662f\u901a\u8fc7 wg interface \u7f16\u53f7\u6765\u533a\u5206\u3002</p> <p>\u63a5\u7740\u914d\u7f6e babeld\uff1a</p> <pre><code>$ cat babeld.conf\n\nrouter-id ID\nlocal-port 33123 # for babelweb2\n\n# one line for each wg interface\ninterface wg0 type tunnel rtt-max 512\n\nredistribute ip PREFIX/LEN ge LEN le 32 local allow # tunnel neighbors\nredistribute proto 42 # routes installed by babeld\nredistribute local deny\n# consult babeld man page for more\n</code></pre> <p>\u7136\u540e\u901a\u8fc7 BabelWeb2\uff08\u5f88\u96be\u7528\uff09\u8fdb\u884c\u53ef\u89c6\u5316\uff0c\u7136\u540e\u901a\u8fc7\u624b\u52a8\u89e6\u53d1\u4e00\u4e9b\u7f51\u7edc\u6ce2\u52a8\u5373\u53ef\u8fbe\u5230\u6548\u679c\u3002</p>","tags":["wireguard","babel","routing","go"]},{"location":"networking/2018/07/06/use-iptables-to-serve-different-services-on-one-port/","title":"\u901a\u8fc7 iptables \u5728\u540c\u4e00\u4e2a\u7aef\u53e3\u6839\u636e\u6e90\u5730\u5740\u89e3\u590d\u7528\uff08demux\uff09","text":"<p>\u73b0\u5728\u9047\u5230\u4e00\u4e2a\u573a\u666f\uff0c\u539f\u6765\u7684\u4e00\u4e2a\u670d\u52a1\u53ea\u7ed9\u4e00\u4e2a\u5ba2\u6237\u7aef\u7528\uff0c\u4f46\u73b0\u5728\u589e\u52a0\u4e86\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u914d\u7f6e\u76f8\u540c\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u9700\u8981\u533a\u522b\u5bf9\u5f85\u4e24\u4e2a\u5ba2\u6237\u7aef\u7684\u670d\u52a1\u7aef\u914d\u7f6e\uff0c\u6240\u4ee5\u5229\u7528 iptables \u6839\u636e\u6e90\u5730\u5740\u505a\u4e86\u4e00\u4e2a\u7aef\u53e3\u8f6c\u53d1\uff0c\u5b9e\u73b0\u4e86 demux\u3002</p> <p>\u5047\u8bbe\uff1a\u670d\u52a1\u5668\u5728 192.168.0.1\uff0c\u5ba2\u6237\u7aef\u5206\u522b\u5728 192.168.0.2 \u548c 192.168.0.3\u3002\u5ba2\u6237\u7aef\u914d\u7f6e\u7684\u670d\u52a1\u7aef\u5730\u5740\u662f 192.168.0.1:8000\u3002\u4e4b\u524d\uff0c\u5728\u670d\u52a1\u5668\u4e0a\u53ea\u8dd1\u4e86\u4e00\u4e2a\u670d\u52a1\uff0c\u76d1\u542c\u7740 8000 \u7aef\u53e3\u3002</p> <p>\u73b0\u5728\uff0c\u5728\u670d\u52a1\u5668\u4e0a\u518d\u8dd1\u4e00\u4e2a\u670d\u52a1\uff0c\u76d1\u542c 8001 \u7aef\u53e3\uff0c\u540c\u65f6\u6839\u636e\u9700\u6c42\u8fdb\u884c\u76f8\u5e94\u7684\u914d\u7f6e\u3002\u7136\u540e\uff0c\u52a0\u4e0a\u5982\u4e0b iptables \u89c4\u5219\uff1a</p> <pre><code>$ sudo iptables -t nat -A PREROUTING -s 192.168.0.3 -d 192.168.0.1 -p tcp -m tcp --dport 8000 -j REDIRECT --to-ports 8001\n</code></pre> <p>\u8fd9\u6837\uff0c\u5728\u4e0d\u9700\u8981\u66f4\u6539\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u5b8c\u6210\u4e86\u9700\u8981\u7684\u6548\u679c\u3002</p>","tags":["iptables","ip"]},{"location":"networking/2018/07/15/use-multicast-address-to-find-neighbours/","title":"\u7528 multicast \u5730\u5740\u627e\u5230\u540c\u4e00\u7f51\u6bb5\u7684\u4e3b\u673a","text":"<p>IPv4 :</p> <pre><code>$ ping -t1 224.0.0.1\n</code></pre> <p>IPv6:</p> <pre><code>$ ping -t1 ff02::1%iface\n</code></pre>","tags":["icmp","ping","multicast"]},{"location":"networking/2018/10/07/use-veth-for-ipv6-brouter/","title":"\u4f7f\u7528 veth \u5b9e\u73b0 IPv6-only \u7684 Brouter \u529f\u80fd","text":"<p>\u6700\u8fd1\u4ece @shankerwangmiao \u5b66\u5230\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff1a\u901a\u8fc7 veth \u628a\u4e24\u4e2a bridge \u7684 IPv6 \u6865\u63a5\u8d77\u6765\u3002\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ ip link add veth-v6-in type veth peer name veth-v6-out\n$ brctl addif br-in veth-v6-in\n$ brctl addif br-out veth-v6-out\n$ ebtables -t filter -A FORWARD -p ! IPv6 -o veth-v6-in -j DROP\n$ ebtables -t filter -A FORWARD -p ! IPv6 -o veth-v6-out -j DROP\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u770b\u5230 veth \u4e0a\u4ec5\u6709 IPv6 \u7684\u6d41\u91cf\u4e86\u3002</p>","tags":["brouter","ebtables","ipv6"]},{"location":"networking/2018/04/28/wifi-with-cisco-ac-and-ap/","title":"\u4f7f\u7528 Cisco AC + AP \u7ec4\u5408\u642d\u5efa\u7f51\u7edc\u5b9e\u8df5","text":"<p>\u6709\u4e00\u53f0\u5df2\u914d\u7f6e\u597d\u76f4\u63a5\u53ef\u7528\u7684 AC \u5728\u5730\u5740 ac-address\u3002\u6211\u4eec\u9700\u8981\u642d\u5efa\u4ea4\u6362\u673a + AP \u7684\u7f51\u7edc\uff0c\u5e76\u4e14\u7528\u4e00\u53f0 Linux \u670d\u52a1\u5668\u8fdb\u884c DHCP \u4ece\u800c\u7ed9 AP \u5206\u53d1 AC \u7684\u5730\u5740\u3002\u8fd9\u91cc\u4ee5 systemd-networkd \u4e3a\u4f8b\u3002</p> <p>\u6211\u4eec\u7ea6\u5b9a\uff0cvlan 2 \u4e0a\u8054\u5916\u7f51\uff0cvlan 3 \u4e3a Linux \u670d\u52a1\u5668\u548c AP \u7684\u5185\u90e8\u7f51\u7edc\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u914d\u7f6e\u4ea4\u6362\u673a\u7ed9 Linux \u670d\u52a1\u5668\u7684\u7aef\u53e3\u4e3a trunk \u53e3\uff0c\u7136\u540e\u5c06\u4e0b\u8054 Cisco AP \u7684\u7aef\u53e3\u90fd\u8bbe\u4e3a access vlan 3 \u6a21\u5f0f\u3002\u63a5\u4e0b\u6765\u5728 Linux \u670d\u52a1\u5668\u4e0a\u914d\u7f6e DHCP \u670d\u52a1\u5668\u548c NAT\u3002</p> <p>\u5982\u679c Linux \u670d\u52a1\u5668\u7684 interface \u540d\u79f0\u4e3a eno1 :</p> <p>\u914d\u7f6e\u4e24\u4e2a VLAN interface: <pre><code>$ cat /etc/systemd/network/eno1.network\n[Match]\nName=eno1\n\n[Network]\nVLAN=eno1.2\nVLAN=eno1.3\n</code></pre></p> <p>\u76f8\u5e94\u6dfb\u52a0 VLAN \u914d\u7f6e\uff1a <pre><code>$ cat /etc/systemd/network/eno1.2.network\n[NetDev]\nName=eno1.2\n\n[VLAN]\nId=2\n$ cat /etc/systemd/network/eno1.3.network\n[NetDev]\nName=eno1.3\n\n[VLAN]\nId=3\n</code></pre></p> <p>\u914d\u7f6e\u4e0a\u884c\u7684 eno1.2 interface \u7684\u9759\u6001\u5730\u5740\uff1a <pre><code>$ cat /etc/systemd/network/eno1.2.network\n[Match]\nName=eno1.2\n\n[Network]\nAddress=123.123.123.123/24\nGateway=123.123.123.1\nDNS=1.2.4.8\n</code></pre></p> <p>\u914d\u7f6e\u5185\u90e8\u7f51\u7edc eno1.3 interface: <pre><code>$ cat /etc/systemd/network/eno1.3.network\n[Match]\nName=eno1.3\n\n[Network]\nAddress=192.168.1.1/24\n</code></pre></p> <p>\u914d\u7f6e dhcpd (isc-dhcp-server): <pre><code>$ cat /etc/default/isc-dhcp-server\nINTERFACESv4=\"eno1.3\"\n$ cat /etc/dhcpd.conf\noption space Cisco_LWAPP_AP;\noption Cisco_LWAPP_AP.server-address code 241 = array of ip-address;\n\nsubnet 192.168.1.0 netmask 255.255.255.0 {\n  range 192.168.1.100 192.168.1.200;\n  option routers 192.168.1.1;\n  vendor-option-space Cisco_LWAPP_AP;\n  option Cisco_LWAPP_AP.server-address $ac-address;\n}\n</code></pre></p> <p>\u914d\u7f6e iptables \u505a NAT: <pre><code>iptables -t nat -A POSTROUTING -o eno1.2 -j MASQUERADE\niptables-save &gt; /etc/iptables/iptables.rules\n</code></pre></p> <p>\u6253\u5f00 ipv4 forwarding: <pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\necho 'net.ipv4.conf.all.forwarding=1' &gt;&gt; /etc/sysctl.d/99-ipv4-forwarding.conf\n</code></pre></p>","tags":["cisco","wifi","vlan"]},{"location":"networking/2018/06/29/wireguard-tunnel/","title":"Wireguard \u96a7\u9053\u642d\u5efa","text":"<p>\u968f\u7740 Wireguard Go \u7248\u672c\u7684\u5f00\u53d1\uff0c\u5728 macOS \u4e0a\u8d77 WireGuard Tunnel \u6210\u4e3a\u73b0\u5b9e\u3002\u4e8e\u662f\uff0c\u642d\u5efa\u4e86\u4e00\u4e2a macOS \u548c Linux \u4e4b\u95f4\u7684 WireGuard Tunnel\u3002\u5047\u8bbe Linux \u7aef\u4e3a\u670d\u52a1\u7aef\uff0cmacOS \u7aef\u4e3a\u5ba2\u6237\u7aef\u3002</p> <p>macOS \u7aef\uff1a</p> <pre><code>$ brew install wireguard-tools\n$ cd /usr/local/etc/wireguard\n$ wg genkey &gt; privatekey\n$ wg pubkey &lt; privatekey &gt; publickey\n$ vim tunnel.conf\n[Interface]\nPrivateKey = MACOS_PRIVATE_KEY\n\n[Peer]\nPublicKey = LINUX_PUBLIC_KEY # Generated below\nAllowedIPs = 192.168.0.0/24\nEndpoint = LINUX_PUBLIC_IP:12345\n$ vim up.sh\n#!/bin/bash\n# change interface name when necessary\nsudo wireguard-go utun0\nsudo wg setconf utun0 tunnel.conf\nsudo ifconfig utun0 192.168.0.2 192.168.0.1\n$ chmod +x up.sh\n$ ./up.sh\n</code></pre> <p>\u914d\u7f6e Linux \u7aef\uff1a <pre><code>$ git clone https://git.zx2c4.com/WireGuard\n$ make\n$ sudo make install\n$ sudo fish\n$ cd /etc/wireguard\n$ wg genkey &gt; privatekey\n$ wg pubkey &lt; privatekey &gt; publickey\n$ vim wg0.conf\n[Interface]\nAddress = 192.168.0.1/24\nPrivateKey = LINUX_PRIVATE_KEY\nListenPort = 12345\n\n[Peer]\nPublicKey = MACOS_PUBLIC_KEY\nAllowedIPs = 192.168.0.2/24\n$ wg-quick up wg0\n</code></pre></p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u4e24\u8fb9\u53ef\u4ee5\u4e92\u76f8 ping \u901a\u3002</p> <p>\u540e\u7eed\u5c1d\u8bd5\u5728 Android \u4e0a\u8dd1\u901a WireGuard\u3002</p> <p>UPDATE 2018-07-11: </p> <p>\u6210\u529f\u5728 Android \u4e0a\u8dd1\u901a WireGuard\u3002\u5728 Google Play \u4e0a\u4e0b\u8f7d\u5b98\u65b9\u7684 App \u5373\u53ef\u3002\u9ebb\u70e6\u5728\u4e8e\uff0c\u5c06 Android \u4e0a\u751f\u6210\u7684 Public Key \u548c\u670d\u52a1\u5668\u7684 Public Key \u8fdb\u884c\u4ea4\u6362\u3002</p> <p>\u7136\u540e\u53c8\u770b\u5230WireGuard \u5728 systemd-networkd\u4e0a\u7684\u914d\u7f6e\u65b9\u6848\uff0c\u81ea\u5df1\u4e5f\u5b9e\u8df5\u4e86\u4e00\u4e0b\u3002\u9996\u5148\uff0c\u5982\u679c\u7528\u7684\u662f stretch\uff0c\u8bf7\u9996\u5148\u6253\u5f00 stretch-backports \u6e90\u5e76\u628a systemd \u5347\u7ea7\u5230 237 \u7248\u672c\u3002</p> <p>\u7136\u540e\uff0c\u6839\u636e\u4e0a\u9762\u8fd9\u4e2a\u8fde\u63a5\u8fdb\u884c\u914d\u7f6e\uff0c\u7531\u4e8e\u90fd\u662f ini \u683c\u5f0f\uff0c\u57fa\u672c\u5c31\u662f\u590d\u5236\u7c98\u8d34\u5c31\u53ef\u4ee5\u914d\u7f6e\u4e86\u3002\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u5c31\u662f\uff0c\u8981\u4fdd\u62a4 PrivateKey \u7684\u5b89\u5168\uff0c\u6ce8\u610f\u914d\u7f6e .netdev \u6587\u4ef6\u7684\u6743\u9650\u3002</p>","tags":["tun","wireguard","systemd-networkd"]},{"location":"news/2017/07/26/farewell-flash/","title":"Farewell, Flash","text":"<p>It's time to say goodbye to Flash. HN #1 HN #2</p>","tags":["flash","adobe"]},{"location":"os/2019/05/08/axi-uart-interrupt/","title":"\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe","text":"","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u6700\u8fd1\u5728\u7ed9 rCore \u6dfb\u52a0 Rocket Chip \u652f\u6301\u3002\u4e0b\u9762\u8bb2\u8bb2\u6700\u8fd1\u505a\u4e86\u54ea\u4e9b\u5de5\u4f5c\uff0c\u9047\u5230\u4e86\u54ea\u4e9b\u5751\uff0c\u90fd\u662f\u600e\u4e48\u89e3\u51b3\u7684\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#\u8e29\u5751\u8fc7\u7a0b","title":"\u8e29\u5751\u8fc7\u7a0b","text":"","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#rocket-chip-\u8fd0\u884c\u4ee3\u7801","title":"Rocket Chip \u8fd0\u884c\u4ee3\u7801","text":"<p>\u9996\u5148\u5206\u6790\u4e86\u4e00\u4e0b\u5df2\u6709\u7684\u4ee3\u7801\u548c\u5de5\u4f5c\u65b9\u5f0f\uff0c\u8fd9\u4e2a Rocket Chip\uff08ucb-bar/fpga-zynq\uff09\u7684\u8bbe\u8ba1\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a\u5728 PS \u4e0a\u901a\u8fc7 fesvr \u5411 Rocket Chip \u5199\u5165\u7a0b\u5e8f\u3002Rocket Chip \u672c\u8eab\u66b4\u9732\u51fa\u4e00\u4e2a TSI\uff0c\u4e00\u4e2a\u4e32\u53e3\u7684\u8c03\u8bd5\u63a5\u53e3\uff0c\u901a\u8fc7 Zynq Adapter \u6302\u5230\u4e86 PS \u4e0b\u7684 AXI \u603b\u7ebf\uff0c\u66b4\u9732\u51fa\u82e5\u5e72\u4e2a\u5bc4\u5b58\u5668\uff0c\u5927\u6982\u5982\u4e0b\uff1a</p> <pre><code>  /**\n   * Address Map\n   * 0x00 - serial out FIFO data\n   * 0x04 - serial out FIFO data available (words)\n   * 0x08 - serial in  FIFO data\n   * 0x0C - serial in  FIFO space available (words)\n   * 0x10 - system reset\n   * 0x20 - req FIFO data\n   * 0x24 - req FIFO data available (words)\n   * 0x28 - data FIFO data\n   * 0x2C - data FIFO data available (words)\n   * 0x30 - resp FIFO data\n   * 0x34 - resp FIFO space available (words)\n   * 0x38 - nsectors\n   * 0x3C - max request length\n   */\n</code></pre> <p>\u524d\u9762\u7684\u662f\u8c03\u8bd5\u63a5\u53e3\uff0c\u540e\u9762\u7684\u662f block device \u548c network\uff0c\u6211\u4eec\u6682\u65f6\u8fd8\u6ca1\u6709\u7528\u5230\u8fd9\u4e9b UCB BAR \u505a\u7684\u79c1\u8d27\u3002\u5728 Vivado \u4e2d\uff0c\u5730\u5740 Offset \u662f 0x43C00000\uff0c\u6240\u4ee5\u4ee3\u7801\u4e2d\u5c31\u8fd9\u6837\u8bbf\u95ee\u5bf9\u5e94\u7684\u7269\u7406\u5730\u5740\uff1a</p> <pre><code>#define ZYNQ_BASE_PADDR 0x43C00000L\n\nfd = open(\"/dev/mem\", O_RDWR|O_SYNC);\nassert(fd != -1);\ndev = (uint8_t *) mmap(\n  0, sysconf(_SC_PAGESIZE),\n  PROT_READ|PROT_WRITE, MAP_SHARED, fd, ZYNQ_BASE_PADDR);\nassert(dev != MAP_FAILED);\n</code></pre> <p>\u8fd9\u5757\u5730\u5740\u5728 Device Tree \u91cc\u4e5f\u6709\u5bf9\u5e94\u7684\u9879\uff0c\u4e8e\u662f PS \u5728\u8bbf\u95ee\u7684\u65f6\u5019\u5c31\u4f1a\u627e\u5230\u603b\u7ebf\u4e0a\u7684 Rocket Chip \u7684 Slave\uff0c\u4e5f\u5c31\u5bf9\u5e94\u5230\u4e86\u4e0a\u9762\u7684\u90a3\u4e2a\u5bc4\u5b58\u5668\u7684 Map\u3002\u63a5\u7740\u5c31\u662f\u7531 fesvr \u5411 Rocket Chip \u91cc\u5199\u7a0b\u5e8f\uff0c\u7136\u540e\u8dd1\u8d77\u6765\u4e86\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#opensbi-\u8f93\u51fa","title":"OpenSBI \u8f93\u51fa","text":"<p>\u63a5\u7740\u5c31\u9700\u8981\u5148\u628a\u8f93\u5165\u8f93\u51fa\u505a\u8d77\u6765\uff0c\u9700\u8981\u79fb\u690d\u4e00\u4e2a bootloader\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cOpenSBI \u660e\u663e\u6bd4 bbl \u66f4\u9002\u5408\u4e8e\u8fd9\u4e2a\u7528\u9014\uff0c\u4e8e\u662f\u62ff\u7740 OpenSBI \u5c31\u62ff\u6765\u6539\u4e86\u3002\u8003\u8651\u5230 fesvr \u91c7\u7528\u7684\u662f htif \u8fdb\u884c\u8f93\u5165\u8f93\u51fa\uff0c\u4e8e\u662f\u4ece bbl \u91cc\u6284\u4e86\u76f8\u5173\u4ee3\u7801\u8fc7\u6765\uff0c\u5f97\u5230\u4e86\u6b63\u786e\u7684\u8f93\u51fa\uff1a</p> <p></p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#rcore\u542f\u52a8","title":"rCore\uff0c\u542f\u52a8\uff01","text":"<p>\u63a5\u4e0b\u6765\uff0c\u5c31\u60f3\u7740\u600e\u4e48\u628a rCore \u4e22\u8fdb\u53bb\u8dd1\u3002\u628a payload \u66ff\u6362\u6389\uff0c\u4e22\u8fdb\u53bb\uff0cgg \u4e86\u3002\u4e00\u76f4\u51fa\u73b0\u4e00\u4e2a\u7384\u5b66\u7684\u95ee\u9898\uff0c\u53ea\u8981\u6211\u4fee\u6539\u9875\u8868\uff0c\u5c31\u51fa\u73b0 instruction access fault\u3002\u4e5f\u4e00\u76f4\u6ca1\u6709\u627e\u5230\u771f\u5b9e\u7684\u539f\u56e0\uff0c\u6700\u540e\u628a PMP \u4fdd\u62a4\u5173\u4e86\u5c31\u597d\u4e86\u3002\u3002\u6000\u7591\u662f Rocket Chip \u5b9e\u73b0\u6709\u8bef\u3002</p> <p>\u53c8\u505a\u4e86\u4e00\u4e9b\u5c0f\u7684\u4fee\u6539\u548c\u9002\u914d\uff0c\u7528\u6237\u6001\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8dd1\u8d77\u6765\u4e86\u3002\u4f46\u662f\uff0c\u73b0\u5728\u4e32\u53e3\u53ea\u80fd\u8f6e\u8be2\u8bfb\u53d6\uff0c\u800c htif \u662f\u901a\u8fc7\u8bfb\u5199\u5185\u5b58\u8fdb\u884c\u7684\uff0c\u4e5f\u6ca1\u6709\u7c7b\u4f3c MSI \u7684\u673a\u5236\uff08\u73b0\u5728\u60f3\u4e86\u60f3\uff0c\u5176\u5b9e\u53ef\u4ee5\uff0c\u7ed9 PS \u6302\u4e00\u4e2a AXI Interrupt Controller\uff0c\u91c7\u7528\u8f6f\u4ef6\u4ea7\u751f\u4e2d\u65ad\u6a21\u5f0f\uff0c\u7136\u540e\u63a5\u5230 Rocket Chip \u4e0a\uff0c\u5176\u5b9e\u4e5f\u662f\u53ef\u4ee5\u7684\uff09\uff0c\u53e6\u5916 Rocket Chip \u539f\u6765\u7684 Config \u8fd8\u6ca1\u6709\u5411\u5916\u66b4\u9732\u4e2d\u65ad\uff0c\u6211\u60f3\u6302\u4e00\u4e2a\u4e32\u53e3\u4e5f\u5f97\u8ba9 Rocket Chip \u8bbf\u95ee\u5f97\u5230\u3002\u4e8e\u662f\u5c31\u5f00\u59cb\u4e86\u9605\u8bfb Chisel \u4ee3\u7801\u7136\u540e\u9b54\u6539\u7684\u8fc7\u7a0b\u4e86\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#\u9b54\u6539-rocket-chip","title":"\u9b54\u6539 Rocket Chip","text":"<p>\u5176\u5b9e\u7b97\u4e0d\u4e0a\u9b54\u6539\uff0c\u514b\u670d\u4e86\u5bf9 Rocket Chip \u7684\u6050\u60e7\uff0c\u4ed4\u7ec6\u9605\u8bfb\u4ee3\u7801\u4ee5\u540e\uff0c\u53d1\u73b0\u8fd8\u662f\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\u7684\u3002\u8b6c\u5982\uff0c\u6211\u8981\u6dfb\u52a0\u4e00\u4e2a\u5916\u90e8\u603b\u7ebf\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u53e5\uff1a</p> <pre><code>  case ExtBus =&gt; up(ExtBus, site).copy(idBits = 6)\n</code></pre> <p>\u90a3\u4e48\u5bf9\u5e94\u5730\uff0c\u5c31\u591a\u4e86\u4e00\u7247\u5730\u5740\u6620\u5c04\uff1a</p> <pre><code>60000000 - 80000000  RWX  mmio-port-axi4@60000000\n</code></pre> <p>\u610f\u5473\u7740\uff0c\u53ea\u8981\u6211\u5728 Rocket Chip \u91cc\u8bbf\u95ee\u8fd9\u7247\u5730\u5740\uff0c\u90a3\u4e48\u5c31\u4f1a\u8bbf\u95ee\u8fd9\u4e2a AXI \u603b\u7ebf\u4e0a\u7684\u5916\u8bbe\u4e86\u3002\u4f46\u662f\u4e8b\u60c5\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355\uff0c\u5728\u8e29\u4e86\u5f88\u4e45\u7684\u5751\u4ee5\u540e\u624d\u6700\u7ec8\u89e3\u51b3\u3002\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#axi-\u603b\u7ebf\u5730\u5740\u7684\u8ba1\u7b97\u65b9\u5f0f","title":"AXI \u603b\u7ebf\u5730\u5740\u7684\u8ba1\u7b97\u65b9\u5f0f","text":"<p>\u9996\u5148\u8c08\u8c08 AXI \u603b\u7ebf\u4e0a\u5730\u5740\u662f\u600e\u4e48\u8ba1\u7b97\u7684\u3002AXI \u603b\u7ebf\u662f\u4e00\u4e2a\u661f\u5f62\u7ed3\u6784\uff0c\u4e00\u4e2a Master \u591a\u4e2a Slave\uff0c\u5728\u8fd9\u91cc\u51fa\u73b0\u7684\u4f8b\u5b50\u662f\uff1a</p> <ol> <li>PS \u662f Master\uff0cRocket Chip \u662f Slave \u2014 \u521a\u624d\u8c08\u5230\u8fc7\u7684\u90a3\u7247 register space</li> <li>Rocket Chip \u662f Master\uff0cPS \u662f Slave \u2014 \u8ba9 Rocket Chip \u8bbf\u95ee DDR \u63a7\u5236\u5668</li> <li>Rocket Chip \u662f Master\uff0c\u5916\u8bbe \u662f Slave \u2014 \u8fd9\u5c31\u662f\u73b0\u5728\u8981\u505a\u7684\u4e8b\u60c5</li> </ol> <p>\u4e4b\u524d\u7701\u7565\u6ca1\u8bf4\u7684\u662f\u4e0a\u9762\u7684\u7b2c\u4e8c\u70b9\uff0c\u5c31\u662f\u8ba9 Rocket Chip \u4e5f\u53ef\u4ee5\u62ff\u5230\u5185\u5b58\u7528\u3002\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u600e\u4e48\u8ba9 Rocket Chip \u548c ARM \u4e0a\u7684 Linux \u4e0d\u8981\u6253\u67b6\uff1f\u628a\u5730\u5740\u7a7a\u95f4\u5206\u6210\u4e24\u5757\u5c31\u597d\u4e86\uff1a</p> <pre><code>wire [31:0] mem_araddr;\nwire [31:0] mem_awaddr;\n\n// Memory given to Rocket is the upper 256 MB of the 512 MB DRAM\nassign S_AXI_araddr = {4'd1, mem_araddr[27:0]};\nassign S_AXI_awaddr = {4'd1, mem_awaddr[27:0]};\n</code></pre> <p>\u8fd9\u6837\u505a\uff0c\u5c31\u900f\u660e\u5730\u628a Rocket Chip \u770b\u5230\u7684\u5185\u5b58\u7a7a\u95f4\u90fd\u6620\u5c04\u5230\u4e86\u5b9e\u9645\u5185\u5b58\u7684 [256MB, 512MB) \u8fd9\u7247\u7a7a\u95f4\u4e0a\u4e86\u3002</p> <p>\u6ce8\uff1a\u6211\u5b9e\u9a8c\u7528\u7684\u677f\u5b50\u5b9e\u9645\u4e0a\u6709 1GB \u7684 DRAM\uff0c\u4f46\u5b9e\u9645\u4e0a\u5df2\u7ecf\u8db3\u591f\u7528\u4e86\uff0c\u6240\u4ee5\u5c31\u6ca1\u6709\u6539\u539f\u6765 zedboard \u7684\u914d\u7f6e\u3002</p> <p>\u6211\u5728\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u5728 PS \u4e0a\u8bbf\u95ee 0x43C00000 \u5c31\u662f\u5bf9\u5e94\u4e86 Zynq Adapter \u7684 0x0 \u5730\u5740\u3002\u8fd9\u91cc\u4e5f\u662f\uff0c\u5728 Rocket Chip \u4e0a\u8bbf\u95ee 0x0 \u7684\u5730\u5740\uff0c\u6211\u5f3a\u884c\u6539\u6210\u4e86 0x10000000\uff0c\u7136\u540e Offset \u662f 0\uff0c\u6240\u4ee5\u6700\u540e\u5230\u5185\u5b58\u5c31\u662f 0x10000000 \u7684\u5730\u5740\u4e86\u3002</p> <p>\u6240\u4ee5 AXI \u603b\u7ebf\u4e0a Slave Register \u7684\u5730\u5740 = Master \u5730\u5740 - \u5339\u914d\u5230\u7684 Slave \u7684 Offset \u5730\u5740\u3002\u4f46\u662f\uff0c\u5982\u679c\u53ea\u6709\u5355\u4e2a Slave \u7684\u65f6\u5019\uff0cAXI Interconnect \u53ef\u80fd\u4e0d\u68c0\u67e5\u5730\u5740\u8303\u56f4\uff0c\u800c\u662f\u76f4\u63a5\u622a\u65ad\uff0c\u4f46\u5728\u6709\u591a\u4e2a Slave \u7684\u65f6\u5019\uff0c\u4f1a\u5148\u68c0\u67e5\u5730\u5740\u8303\u56f4\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5c31\u8fd4\u56de\u9519\u8bef\u3002\u8fd9\u4e2a\u95ee\u9898\u8ba9\u6211\u56f0\u60d1\u4e86\u8bb8\u4e45\uff0c\u76f4\u5230\u6211\u6302\u4e0a\u4e86 <code>System ILA</code> \u770b\u3002\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#axi-uartlite","title":"AXI Uartlite","text":"<p>\u65e2\u7136\u6709\u4e86\u5916\u8bbe\u603b\u7ebf\uff0c\u7b2c\u4e00\u4e2a\u60f3\u5230\u7684\u5916\u8bbe\u5c31\u662f UART \u54af\uff0c\u4e8e\u662f\u52a0\u4e86\u4e00\u4e2a AXI Uartlite\uff0c\u7528 AXI Interconnect \u8fde\u5230\u5916\u8bbe\u603b\u7ebf\u4e0a\u3002\u5199\u4e86\u7a0b\u5e8f\u7b80\u5355\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u8bfb\u53d6\u5230\u4e86\u6570\u636e\uff0c\u7136\u540e\u4e5f\u5f88\u5feb\u5c31\u53ef\u4ee5\u6210\u529f\u5730\u4ece\u4e32\u53e3\u8bfb\u6570\u636e\uff0c\u5199\u6570\u636e\u3002\u4e8e\u662f\u6211\u53c8\u52a0\u4e86\u4e00\u4e2a\u4e32\u53e3\uff0c\u62c9\u5230 AXI Interconnect \u7b2c\u4e8c\u4e2a\u63a5\u53e3\u4e0a\uff0c\u7ed3\u679c\u5c31\u4e0d\u5de5\u4f5c\u4e86\u3002</p> <p>\u7ec6\u5fc3\u7684\u8bfb\u8005\u53ef\u80fd\u5df2\u7ecf\u4ece\u6211\u4e0a\u9762\u8bb2\u5230\u7684\u4e00\u4e9b\u5185\u5bb9\u4e0a\u731c\u5230\u4e86\u95ee\u9898\u6240\u5728\u3002\u3002\u4f46\u8fd9\u4e00\u70b9\u76f4\u5230\u540e\u9762\u6211\u624d\u660e\u767d\u53d1\u751f\u4e86\u4ec0\u4e48\uff0c\u540e\u9762\u4f1a\u518d\u8bb2\u5230\u8fd9\u91cc\u7684\u95ee\u9898\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#axi-interrupt-controller","title":"AXI Interrupt Controller","text":"<p>\u63a5\u7740\uff0c\u56de\u5230\u6211\u4eec\u6700\u521d\u7684\u76ee\u6807\uff0c\u65e2\u7136\u53ef\u4ee5\u8f93\u5165\u8f93\u51fa\u4e86\uff0c\u8fd8\u8981\u771f\u7684\u4e32\u53e3\u5e72\u5565\uff1f\u6dfb\u52a0\u4e2d\u65ad\u6216\u8005\u62c9\u4e00\u8def JTAG \u51fa\u6765\uff0c\u8131\u79bb PS \u6765\u8fdb\u884c\u8c03\u8bd5\u3002\u6240\u4ee5\u63a5\u4e0b\u6765\u9700\u8981\u4ece Rocket Chip \u4e2d\u66b4\u9732\u5916\u90e8\u4e2d\u65ad\u3002\u5728\u539f\u6765\u7684\u4ee3\u7801\u4e2d\uff0c\u662f\u76f4\u63a5\u5173\u6389\u4e86\u7684\uff1a</p> <pre><code>target.tieOffInterrupts()\n</code></pre> <p>\u5b83\u7684\u529f\u80fd\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u628a\u4e2d\u65ad\u7f6e 0\u3002\u4f46\u6211\u8981\u7684\u662f\u62c9\u5230\u5916\u9762\uff0c\u7ecf\u8fc7\u4e86\u4e00\u756a\u6323\u624e\uff1a</p> <pre><code>val io = IO(new Bundle {\n    val ps_axi_slave = Flipped(adapter.axi.cloneType)\n    val mem_axi = target.mem_axi4.head.cloneType\n    val mmio_axi = target.mmio_axi4.head.cloneType\n    val interrupts = Input(UInt(2.W))\n})\n\nio.mem_axi &lt;&gt; target.mem_axi4.head\nio.mmio_axi &lt;&gt; target.mmio_axi4.head\ntarget.interrupts := io.interrupts\n</code></pre> <p>\u7ec8\u4e8e\u627e\u5230\u4e86\u6b63\u786e\u7684\u65b9\u6cd5\uff0c\u62c9\u51fa\u6765\u4e24\u8def\u4e2d\u65ad\u4fe1\u53f7\u3002\u4e8e\u662f\u5f88\u5f00\u5fc3\u5730\u76f4\u63a5\u63a5\u5230\u4e86 Uartlite \u4e0a\uff0c\u4f46\u662f\u4e8b\u60c5\u80af\u5b9a\u4e0d\u4f1a\u8fd9\u4e48\u7b80\u5355\uff1a</p> <p>Uartlite \u662f\u6b63\u8fb9\u6cbf\u89e6\u53d1\u7684\u4e2d\u65ad\uff0c\u4f46\u662f Rocket Chip \u671f\u671b\u7684\u662f\u9ad8\u7535\u5e73\u89e6\u53d1\u7684\u4e2d\u65ad\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4e2d\u65ad\u63a7\u5236\u5668\u6765\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u52a0\u4e86\u4e00\u4e2a AXI Interrupt  Controller\u3002\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u8fd8\u6ca1\u89e3\u51b3\u90a3\u4e2a\u53ea\u8981\u52a0\u4fe9 Slave \u5c31\u90fd\u8bbf\u95ee\u4e0d\u5230\u7684\u95ee\u9898\u5462\uff01\u4e8e\u662f\u5230\u5904\u6302 System ILA \u8c03\u8bd5\uff0c\u53d1\u73b0\u4e86\u95ee\u9898\u6240\u5728\uff1a</p> <p>\u6211\u4eec\u4e4b\u524d\u63d0\u5230\uff0c0x60000000 - 0x80000000 \u5730\u5740\u6bb5\u662f\u5bf9\u5e94\u5230\u4e86\u5916\u90e8 AXI \u603b\u7ebf\u7684\uff0c\u8fd9\u6ca1\u9519\uff0c\u4f46\u662f\uff0c\u5982\u679c\u5728 Rocket Chip \u4e0a\u8bfb 0x60000000 \u7684\u5730\u5740\uff0c\u5230\u603b\u7ebf\u4e0a\u8fd8\u662f 0x60000000 \u7684\u5730\u5740\u800c\u4e0d\u662f 0x0\uff0c\u800c\u4e4b\u524d\u53ea\u6709\u4e00\u4e2a Slave \u7684\u65f6\u5019\uff0c\u6ca1\u6709\u771f\u7684\u53bb\u68c0\u67e5\u8fd9\u4e2a\u5730\u5740\u8303\u56f4\uff0c\u6240\u4ee5\u627e\u5230\u4e86\u6b63\u786e\u7684\u5bc4\u5b58\u5668\uff0c\u73b0\u5728\u4e0d\u884c\u4e86\uff0c\u4e8e\u662f\u51fa\u9519\u4e86\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u4e56\u4e56\u5730\u628a Offset \u8c03\u6210 0x60000000 \u548c 0x61200000\uff0c\u7136\u540e\u518d\u6620\u5c04\u5230 rCore \u7684\u5185\u6838\u6001\u91cc\u3002\u4e00\u756a\u6323\u624e\uff0c\u53c8\u53c2\u7167\u4e86 Linux \u7684 Uartlite \u9a71\u52a8\uff08\u53d1\u73b0\u4e86\u9057\u5fd8\u8bbe\u7f6e\u7684 MER \u5bc4\u5b58\u5668\uff0c\u4e0d\u8ba4\u771f\u9605\u8bfb\u6587\u6863\u7684\u540e\u679c\uff09\uff0c\u7ec8\u4e8e\u5728 ILA \u4e0a\u770b\u5230 uartlite \u7684\u8f93\u51fa\u4e0a\u6709\u4e00\u4e2a\u8109\u51b2\uff0c\u7d27\u63a5\u7740\u770b\u5230\u4e2d\u65ad\u63a7\u5236\u5668\u8f93\u51fa\u4e86\u4e00\u4e2a irq\uff0c\u7136\u540e Rocket Chip \u6536\u5230\u4e86 external interrupt\u3002Cheers\uff01</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#\u4e2d\u65ad\u5904\u7406","title":"\u4e2d\u65ad\u5904\u7406","text":"<p>\u4e8b\u60c5\u867d\u7136\u5dee\u4e0d\u591a\u89e3\u51b3\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u7ed3\u675f\u3002\u6536\u5230\u4e86\u4e00\u4e2a interrupt \u4ee5\u540e\uff0c\u6253\u5370\u4e86\u4e00\u4e0b\u5bc4\u5b58\u5668\u72b6\u6001\uff0c\u9a6c\u4e0a\u53c8\u6765\u4e0b\u4e00\u4e2a interrupt \u4e86\u3002\u73b0\u5728\u4e0d\u4ec5\u8981\u5728 Rocket Chip \u7684 PLIC \u4e0a\u628a\u4e2d\u65ad\u7ed9\u786e\u8ba4\u4e86\uff08\u5410\u69fd\u4e00\u4e0b\uff0cRocket \u7684 PLIC \u6587\u6863\u4e5f\u6bd4\u8f83\u6b20\u7f3a\uff0c\u6211\u662f\u7167\u7740 U54 \u6838\u7684\u5730\u5740\u627e\u5230\uff0c\u4f46\u662f U54 \u5462\u662f\u4e00\u4e2a 4+1 \u7684\u7ec4\u5408\uff0chart0 \u6ca1\u6709 M \u6001\uff0c\u6240\u4ee5\u6211\u4e3a\u4e86\u6253\u5f00 hart0 \u7684 S \u6001\u4e2d\u65ad\uff0c\u8981\u627e hart1 \u7684 M \u6001\u5730\u5740\uff0c\u8be6\u89c1 SiFive \u6587\u6863\uff09\uff0c\u5728 AXI Interrupt Controller \u4e0a\u4e5f\u5f97\u628a\u4e2d\u65ad\u7ed9\u786e\u8ba4\u4e86\u3002\u4f46\u8fd8\u662f\u4e0d\u884c\uff0c\u6bcf\u6b21 interrupt controller \u8f93\u51fa\u7684 irq \u62c9\u4f4e\u4e0d\u4e45\uff0cuartlite \u53c8\u51fa\u73b0\u4e86\u65b0\u7684\u4e00\u6b21\u4e2d\u65ad\u3002</p> <p>\u8fd9\u6b21\u7684\u95ee\u9898\u5f88\u6709\u620f\u5267\u6027\uff1a\u5904\u7406\u4e2d\u65ad\u7684\u65f6\u5019\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\uff0c\u8c03\u8bd5\u4fe1\u606f\u628a tx fifo \u5199\u6ee1\u4e86\uff0cuartlite \u4e5f\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\u3002\u3002\u4e8e\u662f\u6ca1\u5b8c\u4e86\u3002\u89e3\u51b3\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u727a\u7272\u4e00\u4e9b\u6027\u80fd\uff0c\u6bcf\u6b21\u8f93\u51fa\u7684\u65f6\u5019\u90fd\u7b49\u5230 tx fifo \u7a7a\u4e86\u624d\u5199\uff0c\u7136\u540e\u5728\u5904\u7406\u4e32\u53e3\u4e2d\u65ad\u7684\u65f6\u5019\u4e0d\u8981\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u3002</p> <p>\u8fd9\u4e0b\u6ca1\u6709\u65b0\u7684\u95ee\u9898\u4e86\uff0c\u4e32\u53e3\u4e2d\u65ad\u7ec8\u4e8e\u662f\u5de5\u4f5c\u4e86\u3002</p>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2019/05/08/axi-uart-interrupt/#\u603b\u7ed3\u548c\u81f4\u8c22","title":"\u603b\u7ed3\u548c\u81f4\u8c22","text":"<p>\u8fd9\u4e48\u4e00\u756a\u641e\u4e0b\u6765\uff0c\u5bf9 Vivado \u548c AXI \u7684\u76f8\u5173\u77e5\u8bc6\u90fd\u6bd4\u8f83\u719f\u6089\u4e86\u5427\uff0c\u4e5f\u8e29\u4e86\u5f88\u591a\u7684\u5751\u3002\u9700\u8981\u7279\u522b\u611f\u8c22 @cq_z4yx \u63d0\u4f9b\u7684\u6280\u672f\u652f\u6301\u3002</p> <p>\u76f8\u5173\u6587\u6863\u548c\u94fe\u63a5\uff1a</p> <ol> <li>PG099 AXI Interrupt Controller</li> <li>PG142 AXI Uartlite</li> <li>OpenSBI \u9002\u914d</li> <li>rCore \u9002\u914d</li> </ol>","tags":["rcore","axi","uart","uartlite","interrupt","intc","xilinx","vivado"]},{"location":"os/2018/07/16/build-custom-initramfs/","title":"\u6784\u5efa\u7b80\u6613\u7684 initramfs","text":"<p>\u4e00\u76f4\u5bf9 Linux \u7684\u542f\u52a8\u5f88\u611f\u5174\u8da3\uff0c\u4f46\u5bf9 initrd \u548c initramfs \u7b49\u6982\u5ff5\u4e0d\u5927\u4e86\u89e3\uff0c\u4e8e\u662f\u4e0a\u7f51\u627e\u4e86\u8d44\u6599\uff0c\u81ea\u5df1\u6210\u529f\u5730\u770b\u5230\u4e86\u73b0\u8c61\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>Build and boot a minimal Linux system with qemu</li> <li>Custom Initramfs</li> <li>initramfs vs initrd</li> <li>ramfs, rootfs and initramfs</li> <li>The Kernel Newbie Corner: \"initrd\" and \"initramfs\"-- What's Up With That?</li> </ul> <p>\u5177\u4f53\u6b65\u9aa4\uff1a <pre><code>$ cat hello.c\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nint main() {\n    for (;;) {\n        printf(\"Hello, world!\\n\");\n    }\n}\n$ gcc -static hello.c -o init\n$ echo init | cpio -o -H newc | gzip &gt; initrd\n$ qemu-system-x86_64 -kernel /boot/vmlinuz-linux -initrd initrd -nographic -append 'console=ttyS0'\n# Use C-a c q u i t &lt;Enter&gt; to exit\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\u8fc7\u4e00\u4f1a\uff08\u4e09\u56db\u79d2\uff1f\uff09\uff0c\u53ef\u4ee5\u770b\u5230\u6ee1\u5c4f\u7684 Hello world \u5728\u8f93\u51fa\u3002</p>","tags":["linux","initrd","initramfs"]},{"location":"os/2018/08/05/changing-screen-brightness-key/","title":"\u66f4\u6539 macOS \u5c4f\u5e55\u4eae\u5ea6\u7684\u6309\u952e","text":"<p>\u7531\u4e8e\u6211\u6253\u5f00\u4e86\u300cInvert Fn\u300d\u529f\u80fd\uff0c\u6240\u4ee5\u9700\u8981\u8c03\u4eae\u5ea6\u7684\u65f6\u5019\uff0c\u662f\u91c7\u7528 Fn+F1/F2 \u7684\u65b9\u6cd5\u3002\u4f46\u662f\uff0c\u6211\u7684\u673a\u68b0\u952e\u76d8\u5219\u662f\uff0c\u4e0d\u6309 Fn \u65f6\u4e3a 1-9\uff0c\u6309\u7740 Fn \u65f6\u4e3a\u5bf9\u5e94\u7684 F1-F9\uff0c\u4f46\u662f\u5c31\u65e0\u6cd5\u8c03\u6574\u4eae\u5ea6\u548c\u58f0\u97f3\u4e86\u3002</p> <p>\u7136\u540e\u6363\u817e\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u53ef\u4ee5\u7528 ScLk \u548c Pa/Br\uff08\u540d\u79f0\u5728\u5404\u4e2a\u952e\u76d8\u4e0a\u4e0d\u5927\u4e00\u6837\uff09\u8c03\u6574\u4eae\u5ea6\u3002\u4e0d\u8fc7\uff0c\u8fd8\u6ca1\u53d1\u73b0\u5982\u4f55\u66f4\u6539\u97f3\u91cf\u3002\u3002\u3002</p>","tags":["keyboard"]},{"location":"os/2018/05/29/flashing-lineageos-in-nexus6p/","title":"\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5","text":"<p>Nexus 6P \u81ea\u5e26\u7684\u7cfb\u7edf\u6ca1\u6709\u5141\u8bb8 Root\uff0c\u6240\u4ee5\u9700\u8981\u81ea\u5df1\u89e3\u9501 bootloader \u5e76\u4e14\u5237\u4e0a\u522b\u7684\u7cfb\u7edf\u3002\u6211\u9009\u62e9\u4e86 LineageOS\u3002Nexus 6P \u7684\u4ee3\u53f7\u4e3a angler\uff0c\u9996\u5148\u53ef\u4ee5\u627e\u5230\u5b98\u65b9\u7684\u5b89\u88c5\u6559\u7a0b\u3002</p> <p>\u6211\u4eec\u9700\u8981\u4e0b\u8f7d\u7684\u4e1c\u897f\uff1a</p> <pre><code>$ wget https://mirrorbits.lineageos.org/full/angler/20180521/lineage-15.1-20180521-nightly-angler-signed.zip\n$ wget https://mirrorbits.lineageos.org/full/angler/20180521/lineage-15.1-20180521-nightly-angler-signed.zip?sha256 -O lineage-15.1-20180521-nightly-angler-signed.zip.sha256\n$ wget https://mirrorbits.lineageos.org/su/addonsu-15.1-arm64-signed.zip\n$ wget https://mirrorbits.lineageos.org/su/addonsu-15.1-arm64-signed.zip?sha256 -O addonsu-15.1-arm64-signed.zip\n$ wget https://github.com/opengapps/arm64/releases/download/20180527/open_gapps-arm64-8.1-full-20180527.zip\n$ wget https://github.com/opengapps/arm64/releases/download/20180527/open_gapps-arm64-8.1-full-20180527.zip.md5\n$ wget https://dl.twrp.me/angler/twrp-3.2.1-0-angler.img\n$ wget https://dl.twrp.me/angler/twrp-3.2.1-0-angler.img.asc\n$ wget https://dl.twrp.me/angler/twrp-3.2.1-0-angler.img.md5\n$ gpg --verify *.asc\n$ md5sum -c *.md5\n$ sha256sum -c *.sha256\n</code></pre> <p>\u5176\u4e2d Open GApps \u53ef\u4ee5\u81ea\u5df1\u8003\u8651\u9009\u62e9 full \u8fd8\u662f\u5176\u5b83\u7684\u9009\u62e9\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6309\u7167\u6559\u7a0b\uff0c\u5148\u89e3\u9501 bootloader\u3002\u8fde\u63a5\u624b\u673a\uff0c\u8fdb\u5165 USB Debugging Mode\uff0c\u91cd\u542f\u8fdb\u5165 bootloader \u5e76\u4e14\u89e3\u9501\uff1a</p> <pre><code>$ adb reboot bootloader\n$ fastboot flashing unlock\n# Confirm unlocking, and then the data should be wiped\n</code></pre> <p>\u63a5\u4e0b\u6765\u5237\u5165 TWRP\u3002\u8fd8\u662f\u8fdb\u5165 bootloader\uff0c\u7136\u540e\u5237\u5165\u3002</p> <pre><code>$ fastboot flash recovery twrp-3.2.1-0-angler.img\n# Select recovery, and enter it\n</code></pre> <p>\u8fdb\u5165 TWRP \u540e\uff0c\u628a\u6211\u4eec\u521a\u521a\u4e0b\u8f7d\u7684 zip \u6587\u4ef6\u90fd push \u5230\u624b\u673a\u4e0a\uff0c\u5e76\u7528 TWRP \u5b89\u88c5\uff1a</p> <pre><code># Select Wipe -&gt; Advanced Wipe, Select Cache, System and Data and wipe then\n# Install lineageos, opengapps, addonsu and follow on-screen instructions\n# Reboot into system\n</code></pre> <p>\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u7b49\u5f85\uff0cLineageOS \u5c31\u5b89\u88c5\u6210\u529f\u4e86\u3002\u4f46\u662f\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ol> <li>\u5f00\u673a\u65f6\u63d0\u793a vendor image \u7248\u672c\u4e0e\u6253\u5305 LineagesOS \u65f6\u91c7\u7528\u7684\u7248\u672c\u4e0d\u540c\u3002     \u4e8e\u662f\u6211\u4e0b\u8f7d\u4e86\u5b98\u65b9\u7684 factory image\uff0c\u627e\u5230\u5176\u4e2d\u7684 vendor.img\uff0c\u7528 TWRP \u5237\u5230\u4e86 vendor \u5206\u533a\u4e2d\u3002\u5e76\u4e14\u6267\u884c\u4e86 flash-bash.sh \u66f4\u65b0 bootloader \u548c radio\u3002\u91cd\u542f\u7684\u65f6\u5019\u8fd9\u4e2a\u9519\u8bef\u5c31\u89e3\u51b3\u4e86\u30022018-06-12 \u66f4\u65b0 \u6ce8\u610f\uff1a\u4e0d\u8981\u4e0b\u8f7d Driver Binaries \u91cc\u9762\u7684 vendor, \u5237\u4e0a\u53bb\u7cfb\u7edf\u8fd8\u662f\u63d0\u793a\u7248\u672c mismatch\uff0c\u5efa\u8bae\u8fd8\u662f\u4e0b\u8f7d\u5b8c\u6574\u7684 factory \u955c\u50cf\u3002</li> <li>\u68c0\u6d4b\u4e0d\u5230 SIM \u5361\u3002     \u56de\u5230 bootloader \u770b Barcode, \u662f\u6709 IMEI \u7b49\u4fe1\u606f\u7684\uff0c\u8bf4\u660e\u5206\u533a\u6ca1\u6709\u88ab\u5199\u574f\u3002\u5728\u7f51\u4e0a\u641c\u7d22\u4e00\u6bb5\u65f6\u95f4\u4ee5\u540e\uff0c\u53d1\u73b0\u7981\u7528\u767b\u5f55\u5bc6\u7801\u91cd\u542f\u4e00\u6b21\u540e\u5373\u53ef\u4f7f\u7528\uff0c\u4e4b\u540e\u628a\u5bc6\u7801\u52a0\u56de\u6765\u5373\u53ef\u3002</li> </ol>","tags":["android","nexus6p","huawei","angler","lineageos"]},{"location":"os/2023/10/01/linux-boot-protocol/","title":"Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae","text":"","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u5728\u5404\u79cd\u573a\u5408\u9047\u5230\u8fc7\u5404\u79cd Linux \u5185\u6838\u7684\u6587\u4ef6\u540d\u6216\u683c\u5f0f\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>vmlinux</li> <li>vmlinuz</li> <li>uImage</li> <li>bzImage</li> <li>uImage</li> </ul> <p>\u5373\u4f7f\u662f\u540c\u6837\u7684\u6587\u4ef6\u540d\uff0c\u683c\u5f0f\u53ef\u80fd\u4e5f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u76f8\u5e94\u7684\u542f\u52a8\u534f\u8bae\u4e5f\u53ef\u80fd\u4e0d\u4e00\u6837\u3002\u8fd9\u7bc7\u535a\u5ba2\u5c1d\u8bd5\u7ed3\u5408 Linux\uff0c\u5404\u79cd Bootloader\uff08QEMU\uff0cEDK-II\uff0cU-Boot\uff0cOpenSBI\uff09\u7684\u4ee3\u7801\u6765\u7814\u7a76\u4e0d\u540c\u7684 Linux \u4e8c\u8fdb\u5236\u683c\u5f0f\u4ee5\u53ca\u542f\u52a8\u534f\u8bae\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#amd64x86_64","title":"amd64/x86_64","text":"<p>\u9996\u5148\u662f\u5e38\u7528\u7684 amd64 \u67b6\u6784\uff0c\u627e\u51e0\u4e2a\u7cfb\u7edf\uff0c\u67e5\u770b <code>/boot</code> \u76ee\u5f55\u4e0b\u7684 kernel \u6587\u4ef6\u7684\u7c7b\u578b\uff1a</p> <pre><code>/boot/vmlinuz-6.1.0-12-amd64: Linux kernel x86 boot executable bzImage, version 6.1.0-12-amd64 (debian-kernel@lists.debian.org) #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07), RO-rootFS, swap_dev 0X7, Normal VGA\n/boot/vmlinuz-6.2.16-14-pve: Linux kernel x86 boot executable bzImage, version 6.2.16-14-pve (build@proxmox) #1 SMP PREEMPT_DYNAMIC PMX 6.2.16-14 (2023-09-19T08:17Z), RO-rootFS, swap_dev 0XC, Normal VGA\n</code></pre> <p>\u770b\u4e86\u51e0\u4e2a\u7cfb\u7edf\uff0c\u53d1\u73b0\u6587\u4ef6\u540d\u90fd\u662f <code>vmlinuz</code> \u5f00\u5934\uff0c\u6587\u4ef6\u7c7b\u578b\u90fd\u662f <code>Linux kernel x86 boot executable bzImage</code>\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#linuxx86-boot-protocol","title":"Linux/x86 Boot Protocol","text":"<p>Linux \u5728 x86 \u4e0b\u5b9a\u4e49\u4e86\u4e00\u5957 Linux/x86 Boot Protocol\uff0c\u5b83\u89c4\u5b9a\u4e86 bootloader \u5728\u542f\u52a8 Linux \u7684\u65f6\u5019\uff0c\u9700\u8981\u505a\u54ea\u4e9b\u4e8b\u60c5\uff0c\u4f20\u9012\u54ea\u4e9b\u53c2\u6570\uff0c\u4ee5\u4ec0\u4e48\u5f62\u5f0f\u4f20\u9012\u53c2\u6570\uff0c\u90a3\u4e48 Linux \u5c31\u53ef\u4ee5\u5728\u8fd9\u7ed9\u57fa\u7840\u4e0a\u542f\u52a8\u8d77\u6765\u3002</p> <p>\u9996\u5148\uff0cBoot Protocol \u5b9a\u4e49\u4e86 Linux \u5185\u6838\u7684\u683c\u5f0f\uff0c\u4f7f\u5f97 Bootloader \u53ef\u4ee5\u5f97\u5230\u5173\u4e8e Linux \u5185\u6838\u7684\u4e00\u4e9b\u4fe1\u606f\u3002\u8fd9\u4e2a\u683c\u5f0f\u5b9a\u4e49\u5728 The Real-Mode Kernel Header\uff0c\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u7ed3\u6784\u4f53\uff0c\u5bf9\u5e94\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    .section \".header\", \"a\"\n    .globl  sentinel\nsentinel:   .byte 0xff, 0xff        /* Used to detect broken loaders */\n\n    .globl  hdr\nhdr:\nsetup_sects:    .byte 0         /* Filled in by build.c */\nroot_flags: .word ROOT_RDONLY\nsyssize:    .long 0         /* Filled in by build.c */\nram_size:   .word 0         /* Obsolete */\nvid_mode:   .word SVGA_MODE\nroot_dev:   .word 0         /* Filled in by build.c */\nboot_flag:  .word 0xAA55\n</code></pre> <p>\u540e\u9762\u8fd8\u6709\u5f88\u957f\uff0c\u90fd\u662f\u8fd9\u4e2a\u7ed3\u6784\u4f53\u91cc\u7684\u5b57\u6bb5\u3002\u5176\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u719f\u6089\u7684 <code>0xAA55</code>\uff0c\u719f\u6089\u7684\u542f\u52a8\u5206\u533a\u7ed3\u5c3e\u3002\u8fd9\u7247\u6570\u636e\u901a\u8fc7 linker script \u6765\u653e\u7f6e\u5230\u4ece\u6587\u4ef6\u5f00\u59cb\u504f\u79fb 0x1f1 \u5904\uff1a</p> <pre><code>    . = 495;\n    .header     : { *(.header) }\n    .entrytext  : { *(.entrytext) }\n    .inittext   : { *(.inittext) }\n    .initdata   : { *(.initdata) }\n    __end_init = .;\n</code></pre> <p>\u8fd9\u91cc <code>495=0x1ef</code>\uff0c\u518d\u52a0\u4e0a\u4e24\u4e2a <code>sentinel</code> \u5b57\u8282\uff0c\u6700\u7ec8 <code>hdr</code> \u5c31\u4f1a\u843d\u5728 0x1f1 \u5730\u5740\u5904\u3002\u524d\u9762\u770b\u5230\u7684 <code>file</code> \u547d\u4ee4\u8f93\u51fa\u91cc\u7684\u5404\u4e2a\u5b57\u6bb5\uff0c\u5176\u5b9e\u4e5f\u662f\u4ece\u8fd9\u91cc\u8bfb\u6765\u7684\uff1a</p> <pre><code>/boot/vmlinuz-6.1.0-12-amd64: Linux kernel x86 boot executable bzImage, version 6.1.0-12-amd64 (debian-kernel@lists.debian.org) #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07), RO-rootFS, swap_dev 0X7, Normal VGA\n</code></pre> <pre><code># Linux kernel boot images, from Albert Cahalan &lt;acahalan@cs.uml.edu&gt;\n# and others such as Axel Kohlmeyer &lt;akohlmey@rincewind.chemie.uni-ulm.de&gt;\n# and Nicolas Lichtmaier &lt;nick@debian.org&gt;\n# All known start with: b8 c0 07 8e d8 b8 00 90 8e c0 b9 00 01 29 f6 29\n# Linux kernel boot images (i386 arch) (Wolfram Kleff)\n# URL: https://www.kernel.org/doc/Documentation/x86/boot.txt\n514 string      HdrS        Linux kernel\n!:strength + 55\n# often no extension like in linux, vmlinuz, bzimage or memdisk but sometimes\n# Acronis Recovery kernel64.dat and Plop Boot Manager plpbtrom.bin\n# DamnSmallLinux 1.5 damnsmll.lnx \n!:ext   /dat/bin/lnx\n&gt;510    leshort     0xAA55      x86 boot executable\n&gt;&gt;518   leshort     &gt;0x1ff\n&gt;&gt;&gt;529  byte        0       zImage,\n&gt;&gt;&gt;529  byte        1       bzImage,\n&gt;&gt;&gt;526  lelong      &gt;0\n&gt;&gt;&gt;&gt;(526.s+0x200) string    &gt;\\0 version %s,\n&gt;&gt;498   leshort     1       RO-rootFS,\n&gt;&gt;498   leshort     0       RW-rootFS,\n&gt;&gt;508   leshort     &gt;0      root_dev %#X,\n&gt;&gt;502   leshort     &gt;0      swap_dev %#X,\n&gt;&gt;504   leshort     &gt;0      RAMdisksize %u KB,\n&gt;&gt;506   leshort     0xFFFF      Normal VGA\n&gt;&gt;506   leshort     0xFFFE      Extended VGA\n&gt;&gt;506   leshort     0xFFFD      Prompt for Videomode\n&gt;&gt;506   leshort     &gt;0      Video mode %d\n</code></pre> <p>\u8fd9\u91cc\u7684\u5224\u65ad\u548c Linux \u6e90\u7801\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p> <pre><code>514 string      HdrS        Linux kernel\n        .ascii  \"HdrS\"      # header signature\n\n&gt;510    leshort     0xAA55      x86 boot executable\nboot_flag:  .word 0xAA55\n\n&gt;&gt;&gt;529  byte        0       zImage,\n&gt;&gt;&gt;529  byte        1       bzImage,\nloadflags:\n        .byte   LOADED_HIGH # The kernel is to be loaded high\n\n&gt;&gt;&gt;&gt;(526.s+0x200) string    &gt;\\0 version %s,\n        .word   kernel_version-512 # pointing to kernel version string\n                    # above section of header is compatible\n                    # with loadlin-1.5 (header v1.5). Don't\n                    # change it.\n\n&gt;&gt;498   leshort     1       RO-rootFS,\n&gt;&gt;498   leshort     0       RW-rootFS,\nroot_flags: .word ROOT_RDONLY\n\n&gt;&gt;508   leshort     &gt;0      root_dev %#X,\nroot_dev:   .word 0         /* Filled in by build.c */\n\n&gt;&gt;502   leshort     &gt;0      swap_dev %#X,\nsyssize:    .long 0         /* Filled in by build.c */\n\n&gt;&gt;504   leshort     &gt;0      RAMdisksize %u KB,\nram_size:   .word 0         /* Obsolete */\n\n&gt;&gt;506   leshort     0xFFFF      Normal VGA\n&gt;&gt;506   leshort     0xFFFE      Extended VGA\n&gt;&gt;506   leshort     0xFFFD      Prompt for Videomode\n&gt;&gt;506   leshort     &gt;0      Video mode %d\nvid_mode:   .word SVGA_MODE\n</code></pre> <p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0cBootloader \u521d\u59cb\u5316 <code>struct boot_params</code> \u5e76\u4f20\u7ed9 Linux \u5185\u6838\uff1a</p> <pre><code>/* The so-called \"zeropage\" */\nstruct boot_params {\n    struct screen_info screen_info;         /* 0x000 */\n    struct apm_bios_info apm_bios_info;     /* 0x040 */\n    __u8  _pad2[4];                 /* 0x054 */\n    __u64  tboot_addr;              /* 0x058 */\n    struct ist_info ist_info;           /* 0x060 */\n    __u64 acpi_rsdp_addr;               /* 0x070 */\n    /* omitted */\n\n    /*\n     * The sentinel is set to a nonzero value (0xff) in header.S.\n     *\n     * A bootloader is supposed to only take setup_header and put\n     * it into a clean boot_params buffer. If it turns out that\n     * it is clumsy or too generous with the buffer, it most\n     * probably will pick up the sentinel variable too. The fact\n     * that this variable then is still 0xff will let kernel\n     * know that some variables in boot_params are invalid and\n     * kernel should zero out certain portions of boot_params.\n     */\n    __u8  sentinel;                 /* 0x1ef */\n    __u8  _pad6[1];                 /* 0x1f0 */\n    struct setup_header hdr;    /* setup header */  /* 0x1f1 */\n    __u8  _pad7[0x290-0x1f1-sizeof(struct setup_header)];\n    __u32 edd_mbr_sig_buffer[EDD_MBR_SIG_MAX];  /* 0x290 */\n    struct boot_e820_entry e820_table[E820_MAX_ENTRIES_ZEROPAGE]; /* 0x2d0 */\n    /* omitted */\n}\n</code></pre> <p>\u63a5\u7740 Kernel \u5c31\u4f1a\u542f\u52a8\uff0c\u6839\u636e <code>struct boot_params</code> \u7684\u5404\u4e2a\u5b57\u6bb5\u8fdb\u884c\u521d\u59cb\u5316\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#efi-boot-stub","title":"EFI boot stub","text":"<p>\u5982\u679c\u7528 <code>xxd</code> \u67e5\u770b\u6587\u4ef6\u5f00\u5934\uff0c\u4f1a\u53d1\u73b0\u5b83\u5177\u6709 PE \u548c COFF \u5934\u90e8\uff1a</p> <pre><code>00000000: 4d5a ea07 00c0 078c c88e d88e c08e d031  MZ.............1\n00000010: e4fb fcbe 4000 ac20 c074 09b4 0ebb 0700  ....@.. .t......\n00000020: cd10 ebf2 31c0 cd16 cd19 eaf0 ff00 f000  ....1...........\n00000030: 0000 0000 0000 0000 cd23 8281 8200 0000  .........#......\n00000040: 5573 6520 6120 626f 6f74 206c 6f61 6465  Use a boot loade\n00000050: 722e 0d0a 0a52 656d 6f76 6520 6469 736b  r....Remove disk\n00000060: 2061 6e64 2070 7265 7373 2061 6e79 206b   and press any k\n00000070: 6579 2074 6f20 7265 626f 6f74 2e2e 2e0d  ey to reboot....\n00000080: 0a00 5045 0000 6486 0400 0000 0000 0000  ..PE..d.........\n00000090: 0000 0100 0000 a000 0602 0b02 0214 00fe  ................\n000000a0: a504 0000 0000 0000 0000 9c07 cf00 0002  ................\n</code></pre> <p>\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u8ba9 UEFI \u8ba4\u4e3a vmlinux \u4e5f\u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UEFI \u7a0b\u5e8f\uff0c\u800c UEFI \u7684\u7a0b\u5e8f\u683c\u5f0f\u6b63\u662f PE\uff0c\u8fd9\u79cd\u505a\u6cd5\u5c31\u662f EFI boot stub\uff0c\u751f\u6210\u4e00\u4e2a\u6ee1\u8db3 UEFI \u8981\u6c42\u7684\u5934\u90e8\u3002\u5728 Linux \u6e90\u7801 arch/x86/boot/header.S\u4e2d\uff0c\u4f7f\u7528\u6c47\u7f16\u6765\u6784\u9020\u51fa\u4e00\u4e2a MS-DOS Stub\uff1a</p> <pre><code>    .section \".bstext\", \"ax\"\n\n    .global bootsect_start\nbootsect_start:\n#ifdef CONFIG_EFI_STUB\n    # \"MZ\", MS-DOS header\n    .word   MZ_MAGIC\n#endif\n</code></pre> <p>\u9996\u5148\u662f\u7ecf\u5178\u7684 <code>MZ</code>\uff0c\u4e5f\u5c31\u662f MS-DOS Stub \u7684 magic\u3002MS-DOS Stub \u5728\u504f\u79fb <code>0x3c</code> \u7684\u5730\u65b9\uff0c\u8bb0\u5f55\u4e86\u5230 PE \u5934\u90e8\u7684\u504f\u79fb\uff1a</p> <pre><code>#ifdef CONFIG_EFI_STUB\n    .org    0x38\n    #\n    # Offset to the PE header.\n    #\n    .long   LINUX_PE_MAGIC\n    .long   pe_header\n#endif /* CONFIG_EFI_STUB */\n</code></pre> <p>\u540e\u9762\u624d\u662f\u5b9e\u9645\u7684 COFF \u5934\u90e8\uff0c\u5728\u6c47\u7f16\u4e2d\u586b\u5199 COFF \u5934\u90e8\u7684\u5404\u4e2a\u5b57\u6bb5\uff1a</p> <pre><code>#ifdef CONFIG_EFI_STUB\npe_header:\n    .long   PE_MAGIC\n\ncoff_header:\n#ifdef CONFIG_X86_32\n    .set    image_file_add_flags, IMAGE_FILE_32BIT_MACHINE\n    .set    pe_opt_magic, PE_OPT_MAGIC_PE32\n    .word   IMAGE_FILE_MACHINE_I386\n#else\n    .set    image_file_add_flags, 0\n    .set    pe_opt_magic, PE_OPT_MAGIC_PE32PLUS\n    .word   IMAGE_FILE_MACHINE_AMD64\n#endif\n    .word   section_count           # nr_sections\n    .long   0               # TimeDateStamp\n    .long   0               # PointerToSymbolTable\n    .long   1               # NumberOfSymbols\n    .word   section_table - optional_header # SizeOfOptionalHeader\n    .word   IMAGE_FILE_EXECUTABLE_IMAGE | \\\n        image_file_add_flags        | \\\n        IMAGE_FILE_DEBUG_STRIPPED   | \\\n        IMAGE_FILE_LINE_NUMS_STRIPPED   # Characteristics\n</code></pre> <p>\u540e\u9762\u8fd8\u6709\u5f88\u591a\u5185\u5bb9\uff0c\u8fd9\u91cc\u6ca1\u6709\u5b8c\u6574\u8d34\u51fa\u6765\u3002\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u662f AddressOfEntryPoint\uff0c\u4e5f\u5c31\u662f PE \u7a0b\u5e8f\u7684\u5165\u53e3\u3002UEFI \u5728\u6267\u884c PE \u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u6309\u7167\u4e0b\u9762\u7684\u51fd\u6570\u7b7e\u540d\u8c03\u7528\uff1a</p> <pre><code>typedef\nEFI_STATUS\n(EFIAPI *EFI_IMAGE_ENTRY_POINT) (\n   IN EFI_HANDLE                             ImageHandle,\n   IN EFI_SYSTEM_TABLE                       *SystemTable\n   );\n</code></pre> <p>\u6240\u4ee5 Linux \u4e5f\u6309\u7167\u8fd9\u4e2a\u7b7e\u540d\u5b9e\u73b0\u4e86\u4e00\u4e2a\u51fd\u6570\uff1a</p> <pre><code>/*\n * Because the x86 boot code expects to be passed a boot_params we\n * need to create one ourselves (usually the bootloader would create\n * one for us).\n */\nefi_status_t __efiapi efi_pe_entry(efi_handle_t handle,\n                   efi_system_table_t *sys_table_arg);\n</code></pre> <p>\u90a3\u4e48\u5f53\u4ece UEFI \u6267\u884c vmlinuz \u7684\u65f6\u5019\uff0cUEFI \u5c31\u4f1a\u4ece COFF \u5934\u90e8\u627e\u5230 <code>efi_pe_entry</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u4f20\u5165\u4e24\u4e2a\u53c2\u6570\uff0c\u7136\u540e\u8c03\u7528\u5b83\u3002\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u7684\u662f\uff0c\u6a21\u4eff Bootloader \u7684\u884c\u4e3a\uff0c\u586b\u5199 <code>struct boot_param</code>\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u771f\u6b63\u7684\u5185\u6838 entrypoint\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#\u5185\u6838\u538b\u7f29","title":"\u5185\u6838\u538b\u7f29","text":"<p>Linux \u5185\u6838\u8fd8\u7ecf\u5e38\u4f1a\u4ee5\u538b\u7f29\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u538b\u7f29\u7684\u7b97\u6cd5\u53ef\u80fd\u91c7\u7528 gzip \u7b49\u7b49\u3002\u538b\u7f29\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u653e\u4e00\u4efd\u6ca1\u6709\u88ab\u538b\u7f29\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u7528\u6765\u89e3\u538b\u3002\u4e3a\u4e86\u533a\u5206\u5185\u6838\u662f\u5426\u7ecf\u8fc7\u538b\u7f29\uff0c\u901a\u5e38\u7ea6\u5b9a <code>vmlinux</code> \u8868\u793a\u6ca1\u6709\u7ecf\u8fc7\u538b\u7f29\uff0c<code>vmlinuz</code> \u8868\u793a\u7ecf\u8fc7\u538b\u7f29\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#imagezimagebzimageuimage","title":"Image/zImage/bzImage/uImage","text":"<p>\u6709\u65f6\u5019\u8fd8\u4f1a\u770b\u5230\u53e6\u4e00\u79cd\u672f\u8bed\uff1aImage \u6dfb\u52a0\u4e00\u4e2a\u524d\u7f00\uff0c\u5982\uff1a</p> <ul> <li>Image\uff1a\u672a\u7ecf\u8fc7\u538b\u7f29\u7684 Linux \u5185\u6838</li> <li>zImage\uff1a\u7ecf\u8fc7\u538b\u7f29\u7684 Linux \u5185\u6838</li> <li>bzImage\uff1abig zImage\uff0c\u800c\u4e0d\u662f bzip Image\uff0c\u662f zImage \u7684\u540e\u7eed\u683c\u5f0f</li> </ul> <p>bzImage \u548c zImage \u4ece Boot Protocol \u6765\u770b\uff0c\u52a0\u8f7d\u7684\u5730\u5740\u4e0d\u540c\uff1a</p> <pre><code>is_bzImage = (protocol &gt;= 0x0200) &amp;&amp; (loadflags &amp; 0x01);\nload_address = is_bzImage ? 0x100000 : 0x10000;\n</code></pre> <p>\u8fd9\u6837\u89e3\u51b3\u4e86 Image/zImage \u7684\u5927\u5c0f\u4e0a\u9650\u95ee\u9898\uff08\u5730\u5740\u8303\u56f4 0x10000-0x90000\uff0c512KB\uff09\uff0c\u6240\u4ee5\u57fa\u672c\u53ea\u80fd\u89c1\u5230 bzImage \u4e86\u3002</p> <p>\u800c uImage \u5176\u5b9e\u662f U-Boot \u7684\u542f\u52a8\u955c\u50cf\u683c\u5f0f\uff0c\u5728 Linux \u5185\u6838\u5916\u9762\u5957\u4e86\u4e00\u5c42\u81ea\u5df1\u7684\u683c\u5f0f\u3002\u4f46\u73b0\u5728 U-Boot \u8bbe\u8ba1\u4e86\u65b0\u7684\u683c\u5f0f\uff1aU-Boot FIT Image\u3002\u7531\u4e8e x86 \u4e0a\u4e00\u822c\u4e0d\u4f1a\u7528 U-Boot\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6d89\u53ca\u4e86\u3002</p> <p>\u5728\u7f16\u8bd1\u5185\u6838\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5173\u7cfb\u662f\uff1a</p> <ul> <li>vmlinux: \u9996\u5148\u94fe\u63a5\u51fa\u6765\u7684 ELF</li> <li>arch/x86/boot/compressed/vmlinux.bin: \u4ece vmlinux objcopy \u5f97\u5230\u7684 ELF \u6587\u4ef6\uff0c\u53bb\u6389\u4e86 .comment section</li> <li>arch/x86/boot/compressed/vmlinux.bin.gz: \u5bf9 arch/x86/boot/compressed/vmlinux.bin \u8fdb\u884c\u538b\u7f29</li> <li>arch/x86/boot/compressed/vmlinux: \u628a arch/x86/boot/compressed/vmlinux.bin.gz\uff08\u901a\u8fc7 arch/x86/boot/compressed/piggy.S \u4f7f\u7528 .incbin \u5f15\u5165\uff09\u548c\u89e3\u538b\u7f29\u7a0b\u5e8f\u6253\u5305\u5728\u4e00\u8d77\uff0c\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684 vmlinux</li> <li>arch/x86/boot/vmlinux.bin: \u4ece arch/x86/boot/compressed/vmlinux objcopy \u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u53bb\u6389\u4e86 .note \u548c .comment section</li> <li>arch/x86/boot/bzImage: \u628a arch/x86/boot/vmlinux.bin \u7ec4\u88c5\u6210\u6700\u7ec8\u7684\u683c\u5f0f</li> </ul> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u4ece\u76ee\u5f55\u4e0b\u5bf9\u5e94\u7684 <code>.cmd</code> \u6587\u4ef6\u91cc\u627e\u5230\uff1a</p> <pre><code>$ cat arch/x86/boot/compressed/.vmlinux.bin.cmd\ncmd_arch/x86/boot/compressed/vmlinux.bin := objcopy  -R .comment -S vmlinux arch/x86/boot/compressed/vmlinux.bin\n$ cat arch/x86/boot/compressed/.vmlinux.bin.gz.cmd\ncmd_arch/x86/boot/compressed/vmlinux.bin.gz := cat arch/x86/boot/compressed/vmlinux.bin arch/x86/boot/compressed/vmlinux.relocs | gzip -n -f -9 &gt; arch/x86/boot/compressed/vmlinux.bin.gz\n$ cat arch/x86/boot/compressed/.vmlinux.cmd\ncmd_arch/x86/boot/compressed/vmlinux := ld -m elf_x86_64 --no-ld-generated-unwind-info  -pie  --no-dynamic-linker --orphan-handling=warn -z noexecstack --no-warn-rwx-segments -T arch/x86/boot/compressed/vmlinux.lds arch/x86/boot/compressed/kernel_info.o arch/x86/boot/compressed/head_64.o arch/x86/boot/compressed/misc.o arch/x86/boot/compressed/string.o arch/x86/boot/compressed/cmdline.o arch/x86/boot/compressed/error.o arch/x86/boot/compressed/piggy.o arch/x86/boot/compressed/cpuflags.o arch/x86/boot/compressed/early_serial_console.o arch/x86/boot/compressed/kaslr.o arch/x86/boot/compressed/ident_map_64.o arch/x86/boot/compressed/idt_64.o arch/x86/boot/compressed/idt_handlers_64.o arch/x86/boot/compressed/mem_encrypt.o arch/x86/boot/compressed/pgtable_64.o arch/x86/boot/compressed/sev.o arch/x86/boot/compressed/acpi.o arch/x86/boot/compressed/tdx.o arch/x86/boot/compressed/tdcall.o arch/x86/boot/compressed/efi_thunk_64.o arch/x86/boot/compressed/efi.o drivers/firmware/efi/libstub/lib.a -o arch/x86/boot/compressed/vmlinux\n$ cat arch/x86/boot/.vmlinux.bin.cmd\ncmd_arch/x86/boot/vmlinux.bin := objcopy  -O binary -R .note -R .comment -S arch/x86/boot/compressed/vmlinux arch/x86/boot/vmlinux.bin\n$ cat arch/x86/boot/.bzImage.cmd\ncmd_arch/x86/boot/bzImage := arch/x86/boot/tools/build arch/x86/boot/setup.bin arch/x86/boot/vmlinux.bin arch/x86/boot/zoffset.h arch/x86/boot/bzImage\n</code></pre> <p>\u6700\u540e\u5c31\u7531 <code>installkernel</code> \u547d\u4ee4\u628a <code>bzImage</code> \u590d\u5236\u5230 <code>/boot</code> \u4e0b\uff0c\u5e76\u6539\u540d\u4e3a <code>vmlinuz</code>\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e00\u8fc7\u7a0b\u7684\u5b8c\u6574\u63cf\u8ff0\uff0c\u63a8\u8350\u9605\u8bfb \u8001\u53f8\u673a\u5e26\u4f60\u63a2\u7d22\u5185\u6838\u7f16\u8bd1\u7cfb\u7edf\uff0c\u5199\u7684\u6bd4\u8f83\u8be6\u7ec6\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#unified-kernel-image","title":"Unified Kernel Image","text":"<p>Unified Kernel Image \u4e5f\u662f\u4e00\u79cd\u6bd4\u8f83\u65b0\u7684\u683c\u5f0f\uff0c\u5b83\u628a\u542f\u52a8\u65f6\u5019\u9700\u8981\u7684\u4e00\u4e9b\u6587\u4ef6\uff08Linux \u5185\u6838\uff0c\u5fae\u7801\uff0cinitramfs \u7b49\u7b49\uff09\uff0c\u90fd\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u8fd9\u6837\u65b9\u4fbf Secure Boot\uff0c\u53ea\u9700\u8981\u5bf9\u4e00\u4e2a\u5927\u6587\u4ef6\u8fdb\u884c\u7b7e\u540d\u5373\u53ef\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#riscv64","title":"riscv64","text":"<p>RISC-V \u73b0\u5728\u901a\u5e38\u6709\u4e24\u5957\u56fa\u4ef6\u6807\u51c6\uff0c\u4e00\u5957\u662f SBI\uff08Supervisor Binary Interface\uff09\uff0c\u53e6\u4e00\u5957\u662f UEFI\u3002</p>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#sbi","title":"SBI","text":"<p>SBI \u662f M \u6001\u7a0b\u5e8f\u63d0\u4f9b\u7ed9 S \u6001\u7a0b\u5e8f\u7684\u4e00\u5957\u63a5\u53e3\u3002SBI \u4e00\u4e2a\u7684\u5e38\u89c1\u5b9e\u73b0\u5c31\u662f OpenSBI\uff0c\u5f53 OpenSBI \u52a0\u8f7d Linux \u7684\u65f6\u5019\uff0c\u505a\u4e86\u5982\u4e0b\u7ea6\u5b9a\uff1a</p> <ul> <li>a0: hart id</li> <li>a1: dtb \u5730\u5740</li> </ul> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>void __noreturn sbi_hsm_hart_start_finish(struct sbi_scratch *scratch,\n                      u32 hartid)\n{\n    unsigned long next_arg1;\n    unsigned long next_addr;\n    unsigned long next_mode;\n    struct sbi_hsm_data *hdata = sbi_scratch_offset_ptr(scratch,\n                                hart_data_offset);\n\n    if (!__sbi_hsm_hart_change_state(hdata, SBI_HSM_STATE_START_PENDING,\n                     SBI_HSM_STATE_STARTED))\n        sbi_hart_hang();\n\n    next_arg1 = scratch-&gt;next_arg1;\n    next_addr = scratch-&gt;next_addr;\n    next_mode = scratch-&gt;next_mode;\n    hsm_start_ticket_release(hdata);\n\n    sbi_hart_switch_mode(hartid, next_arg1, next_addr, next_mode, false);\n}\n</code></pre> <p>\u8fd9\u91cc <code>sbi_hart_switch_mode</code> \u524d\u4e24\u4e2a\u53c2\u6570\u5c31\u662f\u6700\u7ec8\u8981\u4f20\u7ed9 Linux \u7684\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>hartid</code> \u901a\u8fc7 <code>a0</code> \u5bc4\u5b58\u5668\u4f20\u9012\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>next_arg1</code> \u901a\u8fc7 <code>a1</code> \u5bc4\u5b58\u5668\u4f20\u9012\u3002</p> <p>\u5f53 Linux \u542f\u52a8\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4ece dtb \u4e2d\u83b7\u53d6\u7cfb\u7edf\u7684\u5404\u9879\u4fe1\u606f\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u63a5\u53e3\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f20\u4e24\u4e2a\u5bc4\u5b58\u5668\uff0c\u4f46\u662f\u5f88\u591a\u4e1c\u897f\u5c31\u8981\u653e\u5230 dtb \u91cc\u9762\u53bb\u4f20\u4e86\uff0c\u4f8b\u5982 initrd \u7684\u5730\u5740\uff0ccmdline \u7b49\u7b49\u3002\u65e0\u8bba\u662f bootloader \u8fd8\u662f Linux\uff0c\u90fd\u9700\u8981\u9644\u5e26 dtb \u89e3\u6790\u548c\u4fee\u6539\u7684\u4ee3\u7801\uff0c\u4e0d\u50cf x86 \u90a3\u6837\uff0c\u53ea\u9700\u8981\u4f20\u4e00\u4e2a\u56fa\u5b9a\u7ed3\u6784\u7684\u7ed3\u6784\u4f53\u5373\u53ef\u3002</p> <p>QEMU \u652f\u6301\u76f4\u63a5\u52a0\u8f7d Kernel\uff0c\u4e5f\u5c31\u662f\u8bf4 QEMU \u4e5f\u8981\u8d1f\u8d23\u5b9e\u73b0\u4e0a\u9762\u7684 Boot Protocol\uff1a</p> <pre><code>void kvm_riscv_reset_vcpu(RISCVCPU *cpu)\n{\n    CPURISCVState *env = &amp;cpu-&gt;env;\n\n    if (!kvm_enabled()) {\n        return;\n    }\n    env-&gt;pc = cpu-&gt;env.kernel_addr;\n    env-&gt;gpr[10] = kvm_arch_vcpu_id(CPU(cpu)); /* a0 */\n    env-&gt;gpr[11] = cpu-&gt;env.fdt_addr;          /* a1 */\n    env-&gt;satp = 0;\n}\n</code></pre>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2023/10/01/linux-boot-protocol/#uefi","title":"UEFI","text":"<p>RISC-V \u4e5f\u652f\u6301\u7528 UEFI \u542f\u52a8\uff0c\u5b83\u7684\u505a\u6cd5\u548c x86 \u7c7b\u4f3c\uff0c\u4e5f\u662f\u505a\u4e00\u4e2a EFI Boot Stub\u3002\u7a0d\u5fae\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u901a\u8fc7\u6784\u9020\uff0cEFI boot stub \u53ef\u4ee5\u4fdd\u8bc1\u5b83\u5728\u76f4\u63a5\u5f53\u6210 RISC-V \u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff1a</p> <pre><code>__HEAD\nENTRY(_start)\n    /*\n     * Image header expected by Linux boot-loaders. The image header data\n     * structure is described in asm/image.h.\n     * Do not modify it without modifying the structure and all bootloaders\n     * that expects this header format!!\n     */\n#ifdef CONFIG_EFI\n    /*\n     * This instruction decodes to \"MZ\" ASCII required by UEFI.\n     */\n    c.li s4,-13\n    j _start_kernel\n#else\n    /* jump to start kernel */\n    j _start_kernel\n    /* reserved */\n    .word 0\n#endif\n</code></pre> <p>\u5728 RISC-V \u4e0b\uff0cPE \u5934\u90e8\u7684 <code>MZ</code> \u53ef\u4ee5\u88ab\u89e3\u6790\u6210\u5408\u6cd5\u7684\u6307\u4ee4\uff0c\u5728\u5b83\u540e\u9762\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 Kernel \u5165\u53e3\uff0c\u8fd9\u6837\u5373\u4f7f Bootloader \u6ca1\u6709\u5b9e\u73b0 UEFI\uff0c\u4f8b\u5982 OpenSBI\uff0c\u8df3\u8f6c\u5230 Kernel \u7b2c\u4e00\u6761\u6307\u4ee4\u5f00\u59cb\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fdb\u5165\u5230 <code>_start_kernel</code> \u5f53\u4e2d\u3002</p> <p>\u548c x86 \u7c7b\u4f3c\uff0cEFI boot stub \u7684\u5b9e\u9645 entry point \u662f\u4e00\u4e2a\u5355\u72ec\u7684\u51fd\u6570\uff0c\u800c\u4e0d\u662f\u539f\u6765\u7684 <code>_start_kernel</code>\uff1a</p> <pre><code>/*\n * EFI entry point for the generic EFI stub used by ARM, arm64, RISC-V and\n * LoongArch. This is the entrypoint that is described in the PE/COFF header\n * of the core kernel.\n */\nefi_status_t __efiapi efi_pe_entry(efi_handle_t handle,\n                   efi_system_table_t *systab);\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u7684\u63a5\u53e3\u548c\u524d\u9762 amd64 UEFI \u662f\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u662f UEFI \u6807\u51c6\u89c4\u5b9a\u7684\u3002\u5b83\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u4ece UEFI \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\uff0c\u6784\u9020\u51fa\u4e00\u4e2a dtb\uff0c\u7136\u540e\u4ece UEFI \u4e2d\u83b7\u53d6 hart id\uff08\u89c1\u540e\uff09\uff0c\u7136\u540e\u518d\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 <code>_start_kernel</code>\uff0c\u4f20\u9012\u7684\u53c2\u6570\u548c\u524d\u9762 SBI \u65f6\u662f\u4e00\u6837\u7684\uff1a</p> <pre><code>void __noreturn efi_enter_kernel(unsigned long entrypoint, unsigned long fdt,\n                 unsigned long fdt_size)\n{\n    unsigned long kernel_entry = entrypoint + stext_offset();\n    jump_kernel_func jump_kernel = (jump_kernel_func)kernel_entry;\n\n    /*\n     * Jump to real kernel here with following constraints.\n     * 1. MMU should be disabled.\n     * 2. a0 should contain hartid\n     * 3. a1 should DT address\n     */\n    csr_write(CSR_SATP, 0);\n    jump_kernel(hartid, fdt);\n}\n</code></pre> <p>\u4e3a\u4e86\u8ba9 EFI boot stub \u53ef\u4ee5\u83b7\u53d6\u5230 boot hart id\uff0c\u8fd8\u8bbe\u8ba1\u4e86 <code>RISCV_EFI_BOOT_PROTOCOL</code>\uff0c\u4f7f\u5f97 EFI boot stub \u53ef\u4ee5\u83b7\u53d6 boot hart id\uff1a</p> <pre><code>static efi_status_t get_boot_hartid_from_efi(void)\n{\n    efi_guid_t boot_protocol_guid = RISCV_EFI_BOOT_PROTOCOL_GUID;\n    struct riscv_efi_boot_protocol *boot_protocol;\n    efi_status_t status;\n\n    status = efi_bs_call(locate_protocol, &amp;boot_protocol_guid, NULL,\n                 (void **)&amp;boot_protocol);\n    if (status != EFI_SUCCESS)\n        return status;\n    return efi_call_proto(boot_protocol, get_boot_hartid, &amp;hartid);\n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u5c31\u4f1a\u5728 UEFI \u56fa\u4ef6\u4e2d\u5b9e\u73b0\uff0c\u4f8b\u5982 edk2\uff1a</p> <pre><code>/**\n  Get the boot hartid\n\n  @param  This                   Protocol instance structure\n  @param  BootHartId             Pointer to the Boot Hart ID variable\n\n  @retval EFI_SUCCESS            If BootHartId is returned\n  @retval EFI_INVALID_PARAMETER  Either \"BootHartId\" is NULL or \"This\" is not\n                                 a valid RISCV_EFI_BOOT_PROTOCOL instance.\n\n**/\nEFI_STATUS\nEFIAPI\nRiscvGetBootHartId (\n  IN RISCV_EFI_BOOT_PROTOCOL  *This,\n  OUT UINTN                   *BootHartId\n  )\n{\n  if ((This != &amp;gRiscvBootProtocol) || (BootHartId == NULL)) {\n    return EFI_INVALID_PARAMETER;\n  }\n\n  *BootHartId = mBootHartId;\n  return EFI_SUCCESS;\n}\n</code></pre> <p>\u4ee5\u53ca U-Boot\uff1a</p> <pre><code>/**\n * efi_riscv_get_boot_hartid() - return boot hart ID\n * @this:       RISCV_EFI_BOOT_PROTOCOL instance\n * @boot_hartid:    caller allocated memory to return boot hart id\n * Return:      status code\n */\nstatic efi_status_t EFIAPI\nefi_riscv_get_boot_hartid(struct riscv_efi_boot_protocol *this,\n              efi_uintn_t *boot_hartid)\n{\n    EFI_ENTRY(\"%p, %p\",  this, boot_hartid);\n\n    if (this != &amp;riscv_efi_boot_prot || !boot_hartid)\n        return EFI_EXIT(EFI_INVALID_PARAMETER);\n\n    *boot_hartid = gd-&gt;arch.boot_hart;\n\n    return EFI_EXIT(EFI_SUCCESS);\n}\n\nstruct riscv_efi_boot_protocol riscv_efi_boot_prot = {\n    .revision = RISCV_EFI_BOOT_PROTOCOL_REVISION,\n    .get_boot_hartid = efi_riscv_get_boot_hartid\n};\n</code></pre>","tags":["linux","uefi","boot","uboot","riscv"]},{"location":"os/2018/05/25/opening-tty-terminal-in-wsl/","title":"\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u4e00\u4e2a\u786c\u4ef6\u7684 terminal\uff0c\u60f3\u5728 Windows \u4e0a\u5411\u4e32\u53e3\u5f00\u4e00\u4e2a tty\uff0c\u8dd1\u5404\u79cd\u8f6f\u4ef6\u6765\u6d4b\u8bd5\u3002\u8fd9\u4ef6\u4e8b\u60c5\u5728 Linux \u4e0a\u548c macOS \u4e0a\u90fd\u6709\u5b9e\u8df5\uff0c\u4f46\u4e00\u76f4\u4e0d\u77e5\u9053 Windows \u4e0a\u600e\u4e48\u641e\u3002\u7ecf\u8fc7\u4e86\u4e00\u756a\u641c\u7d22\uff0c\u627e\u5230\u4e86 https://blogs.msdn.microsoft.com/wsl/2017/04/14/serial-support-on-the-windows-subsystem-for-linux/ \u548c https://unix.stackexchange.com/a/123559 \u7684\u65b9\u6848\u3002</p> <p>\u4ee5 COM5 \u4e3a\u4f8b\uff1a</p> <pre><code>$ sudo chmod 666 /dev/ttyS5\n$ sudo agetty -s 115200 ttyS5 linux\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u767b\u5f55\u7684\u754c\u9762\u4e86\u3002</p> <p>\u5728 macOS \u4e0a (https://superuser.com/questions/1059744/serial-console-login-on-osx)\uff1a</p> <pre><code>$ screen /dev/tty.SLAB_USBtoUART 115200\n# type C-b : exec ::: /usr/libexec/getty std.115200\n</code></pre>","tags":["windows","wsl","getty","agetty","terminal","cu"]},{"location":"os/2018/05/24/trying-fedora-on-riscv/","title":"\u4f53\u9a8c Fedora on RISCV","text":"<p>\u770b\u5230 RISCV \u5f88\u4e45\u4e86\uff0c\u4f46\u4e00\u76f4\u6ca1\u80fd\u4f53\u9a8c\u3002\u6700\u8fd1\u5de5\u5177\u94fe\u4e0d\u65ad\u66f4\u65b0\uff0cQEMU \u5728 2.12.0 \u4e5f\u6b63\u5f0f\u52a0\u5165\u4e86 riscv \u7684\u6a21\u62df\u3002\u4f46\u662f\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e2a\u5185\u6838\u53c8\u592a\u9ebb\u70e6\uff0c\u5c31\u627e\u5230\u4e86 Fedora \u505a\u7684 RISCV port\uff0c\u4e0b\u8f7d\u4e0b\u6765\u8bd5\u7528\u4e86\u4e00\u4e0b\u3002\u4e4b\u524d\u8bd5\u8fc7\u4e00\u6b21\uff0c\u4f46\u662f\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u521a\u624d\u603b\u7b97\u662f\u6210\u529f\u5730\u641e\u51fa\u6765\u4e86\u3002</p> <p>\u5b98\u65b9\u6587\u6863\u5730\u5740\uff1ahttps://fedorapeople.org/groups/risc-v/disk-images/readme.txt \u9996\u5148\u4e0b\u8f7d https://fedorapeople.org/groups/risc-v/disk-images/ \u4e0b\u7684 bbl vmlinux \u548c stage4-disk.img.xz \u4e09\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u89e3\u538b stage4-disk.img.xz\uff0c\u5927\u7ea6\u6709 5G \u7684\u6837\u5b50\u3002\u4e4b\u524d\u4f5c\u8005\u5728\u811a\u672c\u91cc\u4f5c\u6b7b\u5f00\u5f97\u7279\u522b\u5927\uff0c\u5bfc\u81f4\u6211\u4ee5\u524d\u5149\u662f\u89e3\u538b\u8fd9\u4e00\u6b65\u5c31\u6210\u529f\u4e0d\u4e86\u3002\u73b0\u5728\u7ec8\u4e8e\u89e3\u51b3\u4e86\u3002</p> <p>\u7136\u540e\u542f\u52a8 qemu \u547d\u4ee4\u6253\u5f00\u865a\u62df\u673a\uff1a <pre><code>qemu-system-riscv64 \\\n  -nographic \\\n  -machine virt \\\n  -m 2G \\\n  -kernel bbl \\\n  -object rng-random,filename=/dev/urandom,id=rng0 \\\n  -device virtio-rng-device,rng=rng0 \\\n  -append \"console=ttyS0 ro root=/dev/vda\" \\\n  -device virtio-blk-device,drive=hd0 \\\n  -drive file=stage4-disk.img,format=raw,id=hd0 \\\n  -device virtio-net-device,netdev=usernet \\\n  -netdev user,id=usernet,hostfwd=tcp::10000-:22\n</code></pre></p> <p>\u8fd9\u6bb5\u547d\u4ee4\u6458\u81ea readme.txt\uff0c\u533a\u522b\u53ea\u5728\u4e8e\u628a -smp 4 \u53bb\u6389\u4e86\u3002\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u53ef\u80fd\u548c\u4f5c\u8005\u63d0\u5230\u7684 FPU patch \u6709\u5173\u3002\u7136\u540e\u7cfb\u7edf\u5c31\u53ef\u4ee5\u6b63\u5e38\u8d77\u6765\u4e86\uff08firewalld \u548c systemd-logind \u4e0d\u6b62\u4e3a\u5565\u8d77\u4e0d\u6765\uff0c\u4f46\u662f\u4e0d\u7528\u7ba1\uff09\u3002</p> <p>\u53ef\u4ee5\u9a8c\u8bc1\u4e00\u4e0b\u6211\u4eec\u7684\u7cfb\u7edf\uff1a <pre><code>$ uname -a\nLinux stage4.fedoraproject.org 4.15.0-00046-g48fb45691946 #27 SMP Mon May 14 08:25:14 UTC 2018 riscv64 riscv64 riscv64 GNU/Linux\n</code></pre></p>","tags":["fedora","riscv","qemu"]},{"location":"os/2018/09/14/virtualbox-booting-from-usb-on-mac/","title":"\u5728 macOS \u7684 VirtualBox \u4e0a\u4ece USB \u542f\u52a8","text":"<p>\u505a\u4e86\u4e00\u4e2a Windows 10 \u5b89\u88c5 U \u76d8\uff0c\u60f3\u6d4b\u8bd5\u4e00\u4e0b\u80fd\u4e0d\u80fd\u542f\u52a8\uff0c\u4e8e\u662f\u60f3\u7528 VirtualBox \u8d77\u4e00\u4e2a\u865a\u62df\u673a\u3002\u4f46\u662f\u53d1\u73b0\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u8981\u4ece ISO \u6216\u8005\u628a U \u76d8\u514b\u9686\u6210\u4e00\u4e2a vdi/vmdk etc \u518d\u542f\u52a8\u3002\u4e0d\u8fc7\u627e\u5230\u4e86 Cem Arslan \u7684 VirtualBox - Booting From USB (MAC) \u5b9e\u9a8c\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u53ef\u4ee5\u7528\uff0c\u4ee5 <code>/dev/disk2</code> \u4e3a\u4f8b\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ diskutil unmountDisk /dev/disk2\n$ sudo chown $(whoami) /dev/disk2\n$ VBoxManage internalcommands createrawvmdk -filename PATH_TO_VMDK -rawdisk /dev/disk2\n$ # Now boot from VirtualBox\n</code></pre> <p>\u5bf9\u4e8e\u5176\u5b83\u5e73\u53f0\uff0c\u53ef\u4ee5\u53c2\u8003 Tu Nguyen \u7684 How to boot from USB in VirtualBox \u3002</p> <p>\u7814\u7a76\u4e86\u4e00\u4e0b\u751f\u6210\u7684 vmdk \u6587\u4ef6\uff0c\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code># Disk DescriptorFile\nversion=1\nCID=12345678\nparentCID=ffffffff\ncreateType=\"fullDevice\"\n\n# Extent description\nRW 12345678 FLAT \"/dev/disk2\" 0\n\n# The disk Data Base \n#DDB\n\nddb.virtualHWVersion = \"4\"\nddb.adapterType=\"ide\"\nddb.geometry.cylinders=\"1234\"\nddb.geometry.heads=\"1234\"\nddb.geometry.sectors=\"1234\"\nddb.uuid.image=\"12341234-1234-1234-1234-123412341234\"\nddb.uuid.parent=\"00000000-0000-0000-0000-000000000000\"\nddb.uuid.modification=\"00000000-0000-0000-0000-000000000000\"\nddb.uuid.parentmodification=\"00000000-0000-0000-0000-000000000000\"\nddb.geometry.biosCylinders=\"1234\"\nddb.geometry.biosHeads=\"1234\"\nddb.geometry.biosSectors=\"1234\"\n</code></pre>","tags":["virtualbox","macos"]},{"location":"os/2022/01/30/windows-on-arm-on-m1/","title":"\u5728 M1 \u4e0a\u8fd0\u884c Windows ARM \u865a\u62df\u673a","text":"<p>\u76ee\u524d Windows ARM \u51fa\u4e86\u9884\u89c8\u7248\uff0c\u53ef\u4ee5\u4ece Windows Insider Preview Downloads \u4e0b\u8f7d\uff0c\u5f97\u5230\u4e00\u4e2a 9.5GB \u7684 vhdx \u6587\u4ef6\u3002</p> <p>\u63a5\u7740\uff0c\u7528 qemu-img \u8f6c\u6362\u4e3a vmdk \u683c\u5f0f\uff1a</p> <pre><code>$ qemu-img convert Windows11_InsiderPreview_Client_ARM64_en-us_22533.vhdx -O vmdk -o adapter_type=lsilogic Windows11_InsiderPreview_Client_ARM64_en-us_22533.vmdk\n</code></pre> <p>\u8f6c\u6362\u540e\uff0c\u5728 VMWare Fusion for Apple Silicon Tech Preview \u4e2d\uff0c\u9009\u62e9\u4ece\u5df2\u6709\u7684 vmdk \u4e2d\u521b\u5efa\u865a\u62df\u673a\uff0c\u542f\u52a8\u524d\u4fee\u6539\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u7279\u522b\u662f\u5185\u5b58\uff0c\u9ed8\u8ba4 256MB \u80af\u5b9a\u4e0d\u591f\uff0c\u9ed8\u8ba4\u5355\u6838 CPU \u4e5f\u592a\u5c11\u4e86\u4e00\u4e9b\u3002\u5185\u5b58\u4e0d\u8db3\u53ef\u80fd\u5bfc\u81f4\u5b89\u88c5\u5931\u8d25\uff0c\u8bb0\u4f4f\u8981\u7b2c\u4e00\u6b21\u542f\u52a8\u524d\u8bbe\u7f6e\u3002</p> <p>\u542f\u52a8\u4ee5\u540e\u4f1a\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc\uff0c\u6309\u7167\u4e0b\u9762\u7f51\u9875\u91cc\u7684\u65b9\u6cd5\u8bbe\u7f6e\u7f51\u7edc\uff1a</p> <p>https://www.gerjon.com/vmware/vmware-fusion-on-apple-silicion-m1/</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cbcdedit \u9009\u9879\u586b\u7684 IP \u5730\u5740\u4e00\u822c\u662f bridge \u4e0a\u7684\u5730\u5740\uff0c\u6bd4\u5982 bridge101 \u7684\u5730\u5740\u3002</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u4e86\uff01</p> <p>\u5728 VMWare \u8bba\u575b\u91cc\uff0c\u8fd8\u8c08\u5230\u4e86\u4e0b\u9762\u51e0\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <p>\u4e3a\u4e86\u8ba9\u58f0\u97f3\u5de5\u4f5c\uff0c\u53ef\u4ee5\u4fee\u6539 vmx \u6587\u4ef6\uff0c\u8bbe\u7f6e guestOS\uff1a</p> <pre><code>guestOS = \"arm-windows11-64\"\n</code></pre> <p>\u8fd9\u6837\u58f0\u97f3\u5c31\u53ef\u4ee5\u6b63\u5e38\u64ad\u653e\u4e86\u3002</p> <p>\u5206\u8fa8\u7387\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u7528 RDP \u6765\u89e3\u51b3\uff1a\u9996\u5148\u5728\u865a\u62df\u673a\u91cc\u6253\u5f00 Remote Desktop\uff0c\u7136\u540e\u7528 macOS \u7684 Microsoft Remote Desktop Beta \u8bbf\u95ee\u5373\u53ef\u3002</p> <p>\u7cfb\u7edf\u91cc\u6ca1\u6709 Microsoft Store\uff0c\u8981\u5b89\u88c5\u7684\u8bdd\uff0c\u7528\u547d\u4ee4\u884c\u7684 Powershell \u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a</p> <pre><code>wsreset.exe -i\n</code></pre> <p>\u8fd9\u4e2a\u65b9\u6cd5\u89c1 Parallels Desktop KB128520\u3002</p> <p>UPDATE:</p> <p>VMware Fusion \u53d1\u5e03\u4e86\u65b0\u7248\u672c 22H2\uff0c\u6709\u5b98\u65b9\u7684 Windows 11 on ARM \u652f\u6301\u4e86\uff1a</p> <ul> <li>Windows 11 on Intel and Apple Silicon with 2D GFX and Networking</li> <li>VMtools installation for Windows 11 GOS on M1</li> <li>Improved Linux support on M1</li> <li>3D Graphics HW Acceleration and OpenGL 4.3 in Linux VMs* (Requires Linux 5.19+ &amp; Mesa 22.1.3+)</li> <li>Virtual TPM Device</li> <li>Fast Encryption</li> <li>Universal Binary</li> </ul> <p>\u5e76\u4e14\u4e0d\u9700\u8981\u4e0a\u9762\u5199\u7684\u7f51\u5361\u7684 workaround \u4e86\uff1a</p> <pre><code>vmxnet3 Networking Drivers for Windows on ARM\n\nWhile Windows does not yet ship with our vmxnet3 networking driver for\nWindows on ARM as it now does for Intel, the VMware Tools ISO on ARM\ncontains the 2 currently supported drivers for graphics and networking.\n</code></pre> <p>\u5b9e\u6d4b\u5b89\u88c5 VMware Tools \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u7528 vmxnet3 \u7f51\u5361\u4e0a\u7f51\u4e86\uff0c\u4e0d\u9700\u8981\u4e4b\u524d\u7684 bcdedit \u65b9\u6848\u3002</p> <p>\u4f46\u662f\u76ee\u524d\u6d4b\u8bd5 Linux \u865a\u62df\u673a\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u4e00\u4e9b\u5185\u6838\u7248\u672c\u5728\u542f\u52a8\u7684\u65f6\u5019 vmwgfx \u9a71\u52a8\u4f1a\u62a5\u9519\uff0c\u4e0d\u80fd\u6b63\u5e38\u663e\u793a\uff0c\u4f46\u662f\u7cfb\u7edf\u662f\u6b63\u5e38\u542f\u52a8\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 SSH \u8bbf\u95ee\u3002\u6211\u6d4b\u8bd5\u7684\u60c5\u51b5\u89c1\u4e0b\uff1a</p> <p>Linux 5.19.6(5.19.0-1-arm64): \u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u548c\u663e\u793a\uff0c\u4f46\u662f\u6ca1\u6709 3D \u52a0\u901f\uff08\u6309\u7167 VMware \u7684\u8bf4\u6cd5\u662f\u9700\u8981 5.19 \u5185\u6838 + Mesa 22.1.1 \u4ee5\u4e0a\uff0c\u4f46\u662f\u6211\u7684\u73af\u5883\u7248\u672c\u5df2\u7ecf\u7b26\u5408\u4e86\u8fd9\u4e2a\u8981\u6c42\uff0c\u53ef\u80fd\u662f Debian \u6253\u5305\u7f3a\u4e86\u4ec0\u4e48\u4e1c\u897f\uff09\uff1b</p> <p>UPDATE\uff082022-09-27\uff09\uff1a\u66f4\u65b0\u4e86\u4e00\u4e0b\u7cfb\u7edf\uff0c\u73b0\u5728 <code>glxinfo</code> \u53ef\u4ee5\u770b\u5230 SVGA \u4e86\uff1a</p> <pre><code>Device: SVGA3D; build: RELEASE; LLVM; (0x406)\nVersion: 22.2.0\nAccelerated: no\n</code></pre> <p>\u4f46\u662f\u663e\u793a\u6709\u4e00\u4e9b BUG\uff0c\u5237\u65b0\u4e0d\u6b63\u5e38\u3002</p> <p>Linux 5.18(5.18.0-0.bpo.1-arm64): <code>VMware Fusion has encountered an error and has shut down the virtual machine</code></p> <p>Linux 5.16(5.16.0-0.bpo.4-arm64): SSH \u4e5f\u6ca1\u542f\u52a8\uff0c\u770b\u4e0d\u5230\u5185\u6838\u65e5\u5fd7</p> <p>Linux 5.15.15(5.15.0-0.bpo.3-arm64):</p> <p>\u56fe\u5f62\u754c\u9762\u8d77\u4e0d\u6765\uff0c\u53ef\u4ee5\u901a\u8fc7 SSH \u8bbf\u95ee\u3002</p> <pre><code>[   10.765945] kernel BUG at drivers/gpu/drm/vmwgfx/vmwgfx_drv.h:1627!\n[   10.766206] Call trace:\n[   10.766207]  vmw_event_fence_action_queue+0x328/0x330 [vmwgfx]\n[   10.766210]  vmw_stdu_primary_plane_atomic_update+0xd8/0x220 [vmwgfx]\n[   10.766214]  drm_atomic_helper_commit_planes+0xf8/0x21c [drm_kms_helper]\n[   10.766222]  drm_atomic_helper_commit_tail+0x5c/0xb0 [drm_kms_helper]\n[   10.766225]  commit_tail+0x160/0x190 [drm_kms_helper]\n[   10.766227]  drm_atomic_helper_commit+0x16c/0x400 [drm_kms_helper]\n[   10.766230]  drm_atomic_commit+0x58/0x6c [drm]\n[   10.766242]  drm_atomic_helper_set_config+0xe0/0x120 [drm_kms_helper]\n[   10.766245]  drm_mode_setcrtc+0x1ac/0x680 [drm]\n[   10.766249]  drm_ioctl_kernel+0xd0/0x120 [drm]\n[   10.766253]  drm_ioctl+0x250/0x460 [drm]\n[   10.766257]  vmw_generic_ioctl+0xbc/0x160 [vmwgfx]\n[   10.766261]  vmw_unlocked_ioctl+0x24/0x30 [vmwgfx]\n[   10.766264]  __arm64_sys_ioctl+0xb4/0x100\n[   10.766287]  invoke_syscall+0x50/0x120\n[   10.766300]  el0_svc_common.constprop.0+0x4c/0xf4\n[   10.766302]  do_el0_svc+0x30/0x9c\n[   10.766303]  el0_svc+0x28/0xb0\n[   10.766327]  el0t_64_sync_handler+0x1a4/0x1b0\n[   10.766328]  el0t_64_sync+0x1a0/0x1a4\n</code></pre> <p>\u56de\u6536\u786c\u76d8\u7a7a\u95f4\uff1a</p> <pre><code>sudo vmware-toolbox-cmd disk shrink /\n</code></pre>","tags":["windows","vmware","m1","vm"]},{"location":"os/2023/10/03/wsl2-internals/","title":"WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76","text":"","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u770b\u5230 Windows Subsystem for Linux September 2023 update \u58f0\u79f0 WSL2 \u6700\u65b0\u7684\u9884\u89c8\u7248\u672c\u652f\u6301\u8ba9 Linux \u548c Windows \u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5171\u4eab\u7f51\u7edc\u5730\u5740\u7a7a\u95f4\uff0c\u5c31\u50cf WSL1 \u90a3\u6837\uff1a</p> <ul> <li>IPv6 support</li> <li>Connect to Windows servers from within Linux using the localhost address 127.0.0.1</li> <li>Connect to WSL directly from your local area network (LAN)</li> <li>Improved networking compatibility for VPNs</li> <li>Multicast support</li> </ul> <p>\u56e0\u6b64\u6bd4\u8f83\u60f3\u77e5\u9053\u8fd9\u662f\u600e\u4e48\u505a\u5230\u7684\uff0c\u4f46\u76ee\u524d\u6211\u624b\u4e0a\u8fd8\u6ca1\u6709\u9884\u89c8\u7248\u672c\u7684 windows\uff0c\u56e0\u6b64\u76ee\u524d\u5148\u7814\u7a76 WSL2 \u5df2\u6709\u7684\u529f\u80fd\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u672a\u6765\u518d\u56de\u6765\u66f4\u65b0\u8fd9\u4e00\u90e8\u5206\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#wsl2","title":"WSL2","text":"<p>WSL1 \u5b9e\u73b0\u7684\u662f proxy kernel \u6a21\u5f0f\uff0c\u867d\u7136\u8dd1\u7684\u662f linux \u7a0b\u5e8f\uff0c\u4f46\u5176\u5b9e\u8fd8\u662f windows \u5185\u6838\uff0c\u4e2d\u95f4\u5305\u4e86\u4e00\u5c42 syscall \u7684\u8f6c\u6362\uff0c\u6ca1\u6709\u5f00\u4e00\u4e2a\u865a\u62df\u673a\u3002\u8fd9\u4e2a\u5957\u8def\u548c MinGW/Cygwin \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u5728\u4e0d\u540c\u5c42\u6b21\u4e0a\u505a\u7684 syscall \u8f6c\u6362\u3002</p> <p>WSL2 \u5219\u662f\u56de\u5f52\u4f20\u7edf\u7684\u865a\u62df\u673a\u6a21\u5f0f\uff0c\u57fa\u4e8e Hyper-V \u5f00\u4e86\u865a\u62df\u673a\uff0c\u7136\u540e\u505a\u4e86\u6bd4\u8f83\u591a\u7684\u96c6\u6210\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u548c\u539f\u6765 WSL1 \u7684\u529f\u80fd\u4e00\u81f4\u3002\u4f46\u6b64\u65f6\u5c31\u662f\u4e24\u4e2a\u5206\u7acb\u7684\u7cfb\u7edf\u4e86\uff0c\u5728\u865a\u62df\u673a\u91cc\u8dd1\u4e00\u4efd Linux \u5185\u6838\uff0c\u8fd9\u4e2a\u5185\u6838\u6709\u5fae\u8f6f\u81ea\u5df1\u7684\u4e00\u4e9b\u4fee\u6539\uff0c\u53ef\u4ee5\u5728 microsoft/WSL2-Linux-Kernel \u91cc\u770b\u5230\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u770b\u4e0d\u5230 bootloader\uff0c\u865a\u62df\u673a\u542f\u52a8\u7684\u6d41\u7a0b\u90fd\u88ab\u9690\u85cf\u8d77\u6765\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u6709\u5f88\u591a\u53ef\u4ee5\u505a\u9a9a\u64cd\u4f5c\u7684\u5730\u65b9\u4e86\uff0c\u4f8b\u5982\u690d\u5165\u4e00\u4e9b\u7a0b\u5e8f\uff0c\u63d0\u524d\u505a\u4e00\u4e9b\u914d\u7f6e\u7b49\u7b49\u3002</p> <p>\u4e0b\u9762\u5c1d\u8bd5\u63a2\u7a76 WSL2 \u7684\u4e00\u4e9b\u529f\u80fd\u80cc\u540e\u7684\u539f\u7406\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#drvfs","title":"drvfs","text":"<p>drvfs \u6307\u7684\u662f\u4ece WSL \u91cc\u9762\u8bbf\u95ee Windows \u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f8b\u5982 C \u76d8\u4f1a\u88ab\u6620\u5c04\u5230 <code>/mnt/c</code> \u4e0b\u9762\u3002\u5728 WSL2 \u4e0b\u9762\uff0c\u7528 <code>mount</code> \u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a 9pfs\uff1a</p> <pre><code>drvfs on /mnt/c type 9p (rw,noatime,dirsync,aname=drvfs;path=C:\\;uid=1000;gid=1000;symlinkroot=/mnt/,mmap,access=client,msize=262144,trans=virtio)\n</code></pre> <p>9pfs \u7c7b\u4f3c NFS\uff0c\u662f\u4e00\u4e2a\u8fdc\u7a0b\u7684\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u534f\u8bae\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u8d70\u7f51\u7edc\uff0c\u800c\u662f\u8d70\u7684 virtio\uff08<code>trans=virtio</code>\uff09\uff0c\u4ece PCIe \u603b\u7ebf\u4e0a\u4e5f\u80fd\u770b\u5230\u4e00\u5806 virtio \u8bbe\u5907\uff1a</p> <pre><code>2a99:00:00.0 System peripheral: Red Hat, Inc. Virtio file system (rev 01)\n        Subsystem: Red Hat, Inc. Virtio file system\n        Kernel driver in use: virtio-pci\nlspci: Unable to load libkmod resources: error -2\n47ee:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)\n        Subsystem: Red Hat, Inc. Virtio 1.0 filesystem\n        Kernel driver in use: virtio-pci\n7cd4:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)\n        Subsystem: Red Hat, Inc. Virtio 1.0 filesystem\n        Kernel driver in use: virtio-pci\nb9dc:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 console (rev 01)\n        Subsystem: Red Hat, Inc. Virtio 1.0 console\n        Kernel driver in use: virtio-pci\ne7ba:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)\n        Subsystem: Red Hat, Inc. Virtio 1.0 filesystem\n        Kernel driver in use: virtio-pci\n</code></pre>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#\u8fd0\u884c-windows-\u7a0b\u5e8f","title":"\u8fd0\u884c Windows \u7a0b\u5e8f","text":"<p>\u5728 WSL2 \u91cc\uff0c\u53ef\u4ee5\u8fd0\u884c Windows \u4e0a\u7684\u7a0b\u5e8f\uff0c\u8fd9\u662f\u901a\u8fc7 <code>binfmt_misc</code> \u5b9e\u73b0\u7684\uff1a</p> <pre><code>$ cat /proc/sys/fs/binfmt_misc/WSLInterop\nenabled\ninterpreter /init\nflags: PF\noffset 0\nmagic 4d5a\n</code></pre> <p>\u5f53 Linux \u5c1d\u8bd5\u6267\u884c PE \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5339\u914d\u4e0a <code>magic 4d5a</code>\uff08<code>MZ</code>\uff09\uff0c\u5c31\u4f1a\u7528 <code>/init</code> \u53bb\u6267\u884c\u5b83\u3002\u4e4b\u540e\u5c31\u7531 <code>/init</code> \u548c Windows \u8fdb\u884c\u901a\u4fe1\uff0c\u628a\u547d\u4ee4\u548c\u53c2\u6570\u4f20\u8fc7\u53bb\uff0c\u6700\u540e\u5728 Windows \u4e0a\u6267\u884c\u3002</p> <p><code>/init</code> \u5219\u662f\u4e00\u4e2a WSL2 \u81ea\u5e26\u7684\u7a0b\u5e8f\uff1a\u5b83\u4f1a\u4f5c\u4e3a WSL2 \u5185\u90e8\u7684 init \u7a0b\u5e8f\uff0c\u4e5f\u5c31\u662f PID 1\u3002\u540c\u65f6\u5b83\u4f1a\u8dd1\u591a\u4e2a\u8fdb\u7a0b\uff0c\u867d\u7136\u90fd\u662f\u7528\u540c\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff1a</p> <pre><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot         1  0.0  0.0   2324  1512 ?        Sl   23:20   0:00 /init\nroot         4  0.0  0.0   2324     4 ?        Sl   23:20   0:00 plan9 --control-socket 5 --log-level 4 --server-fd 6 --pipe-fd 8 --log-truncate\nroot         7  0.0  0.0   2332   112 ?        Ss   23:20   0:00 /init\nroot         8  0.0  0.0   2348   116 ?        S    23:20   0:00 /init\n</code></pre> <p>WSL2 \u53ef\u4ee5\u6253\u5f00 systemd\uff0c\u89c1 Advanced settings configuration in WS\uff0c\u6b64\u65f6 PID 1 \u662f systemd\uff0c\u800c PID 2 \u8fd8\u6709\u5176\u4ed6\u51e0\u4e2a\u8fdb\u7a0b\u5c31\u662f <code>/init</code>\uff1a\u53ef\u4ee5\u731c\u6d4b\uff0c\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148\u542f\u52a8\u8fd8\u662f\u7684 <code>/init</code>\uff0c\u7136\u540e PID 1 \u7684 <code>/init</code> \u8c03\u7528 <code>exec</code> \u5207\u6362\u5230 systemd PID 1\uff0c\u5176\u4f59\u8fdb\u7a0b\u7ee7\u7eed\u6267\u884c\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#kernel-\u548c-initramfs","title":"kernel \u548c initramfs","text":"<p>\u5982\u679c\u67e5\u770b dmesg\uff0c\u4f1a\u53d1\u73b0 Linux \u7684\u542f\u52a8 cmdline \u662f\uff1a</p> <pre><code>initrd=\\initrd.img WSL_ROOT_INIT=1 panic=-1 nr_cpus=8 bonding.max_bonds=0 dummy.numdummies=0 fb_tunnels=none swiotlb=force console=hvc0 debug pty.legacy_count=0\n</code></pre> <p>\u8fd9\u4e2a <code>initrd.img</code> \u53ef\u4ee5\u5728 <code>C:\\Windows\\System32\\lxss\\tools</code> \u4e0b\u9762\u627e\u5230\uff0c\u4e5f\u53ef\u4ee5\u4ece WSL \u5b89\u88c5\u5305 \u4e2d\u89e3\u5305\u51fa\u6765\u3002\u8fdb\u4e00\u6b65\u53ef\u4ee5\u53d1\u73b0 <code>initrd.img</code> \u5185\u90e8\u53ea\u6709\u4e00\u4e2a <code>/init</code> \u6587\u4ef6\uff1a</p> <pre><code>$ cpio -itv &lt; initrd.img\n-rwxrwxrwx   0 root     root      1978872 Apr 20 06:55 init\n3866 blocks\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u542f\u52a8\u4ee5\u540e\u7684\u51c6\u5907\u5de5\u4f5c\u90fd\u5728\u8fd9\u4e2a init \u7a0b\u5e8f\u91cc\u505a\u5b8c\u4e86\u3002</p> <p>kernel \u7684\u683c\u5f0f\u5728\u4e0d\u540c\u7248\u672c\u4e5f\u4e0d\u4e00\u6837\uff1a</p> <pre><code># WSL 1.2.5\nkernel: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, BuildID[sha1]=e87c738e1e340eaf67d8d0c99369d458cdb5e6a0, stripped\n# WSL 2.0.0\nkernel: Linux kernel x86 boot executable bzImage, version 5.15.123.1-microsoft-standard-WSL2 (root@5a891d5fa777) #1 SMP Mon Aug 7 19:01:48 UTC 2023, RO-rootFS, swap_dev 0XD, Normal VGA\n</code></pre> <p>\u6216\u8bb8\u9690\u542b\u4e86\u4ec0\u4e48\u542f\u52a8\u6d41\u7a0b\u4e0a\u7684\u53d8\u5316\uff0c\u8fd9\u91cc\u5e76\u4e0d\u786e\u5b9a\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#init","title":"/init","text":"<p>\u5728 WSL2 \u6587\u4ef6\u7cfb\u7edf\u5185\uff0c\u6709\u591a\u4e2a\u5230 <code>/init</code> \u7684\u7b26\u53f7\u94fe\u63a5\uff1a</p> <pre><code>/usr/bin/wslpath -&gt; /init\n/usr/sbin/mount.drvfs -&gt; /init\n</code></pre> <p>\u540c\u65f6\u8fd8\u6709\u4e0a\u9762\u51fa\u73b0\u8fc7\u7684 <code>plan9</code>\uff0c\u5176\u5b9e\u4e5f\u662f <code>/init</code> \u53bb\u6267\u884c\u7684\uff0c\u8bf4\u660e <code>/init</code> \u5185\u90e8\u4f1a\u6709\u903b\u8f91\uff0c\u53bb\u5224\u65ad <code>argv[0]</code> \u662f\u4ec0\u4e48\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002\u53ef\u4ee5\u627e\u5230\u5982\u4e0b\u51e0\u4e2a usage \u6587\u672c\uff1a</p> <pre><code># wslpath\nUsage:\n    -a    force result to absolute path format\n    -u    translate from a Windows path to a WSL path (default)\n    -w    translate from a WSL path to a Windows path\n    -m    translate from a WSL path to a Windows path, with '/' instead of '\\'\n\nEX: wslpath 'c:\\users'\n# mount.drvfs: no usage?\n# localhost\nUsage: localhost --port-tracker-fd fd [--bpf-fd fd] [--netlink-fd fd] [--localhost-relay fd]\n# plan9\nUsage: plan9 --control-socket fd --socket-path path --server-fd fd --log-file log-file --log-level level pipe-fd fd [--log-truncate]\n# gns\nUsage: gns [--socket fd] [--dns_socket fd] [--adapter guid] [--msg_type int]\n# telagent: no usage?\n</code></pre> <p>\u5176\u4e2d <code>localhost</code> \u547d\u4ee4\u548c <code>gns</code> \u547d\u4ee4\u5e94\u8be5\u5c31\u662f WSL 2.0.0 \u5f15\u5165\u7684 mirrored networking mode \u6240\u7528\u5230\u7684\u5b50\u7a0b\u5e8f\u4e86\u3002<code>telagent</code> \u4ece\u540d\u5b57\u6765\u770b\u5e94\u8be5\u662f telemetry agent\u3002<code>plan9</code> \u548c <code>mount.drvfs</code> \u5e94\u8be5\u662f\u914d\u5408 9pfs \u4f7f\u7528\u7684\u8fdb\u7a0b\u4e86\u3002\u4f7f\u7528 <code>strings</code> \u53ef\u4ee5\u770b\u5230\u4e00\u4e9b mirrored networking mode \u76f8\u5173\u7684\u6587\u5b57\uff1a</p> <pre><code>GnsPortTracker: Failed to deallocate port\nGnsPortTracker: Requested the host for port allocation on port (family %d, port %u, protocol %d) - returned %d\nGnsPortTracker: Tracking bind call: family (%d) port (%u) protocol (%d)\nGnsPortTracker: No longer tracking bind call: family (%d) port (%u) protocol (%d)\nGnsPortTracker: Fetch to read bind() call info with ID %llu for pid %d, %s\nGnsPortTracker: Request for a port that's already reserved (family %d, port %u, protocol %d)\nGnsPortTracker: Failed to complete bind request, %s\nGnsPortTracker: Failed to read bind request, %s\n</code></pre> <p>\u53ef\u4ee5\u53ef\u4ee5\u5927\u6982\u9884\u6d4b\u4e00\u4e0b\u5b83\u7684\u5de5\u4f5c\u6a21\u5f0f\uff1a\u89c2\u6d4b Linux \u4e0a\u7684 bind \u7cfb\u7edf\u8c03\u7528\uff0c\u5982\u679c\u53d1\u73b0\u6709\u8fdb\u7a0b\u8981 bind \u7aef\u53e3\uff0c\u5c31\u53bb Windows \u4e0a\u4e5f\u5206\u914d\u540c\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u542f\u52a8\u4e00\u4e2a\u7aef\u53e3\u8f6c\u53d1\u7a0b\u5e8f\uff0c\u8ba9 Windows \u4e0a\u7684\u7a0b\u5e8f\u53ef\u4ee5\u8bbf\u95ee\u5230 Linux \u91cc\u9762\u7684\u670d\u52a1\u3002</p> <p>\u6b64\u5916 mirrored networking mode \u8fd8\u6709\u4e00\u4e2a\u7279\u6027\u662f\uff0c\u540c\u6b65 Windows \u548c Linux \u7684 IP \u5730\u5740\u7b49\u914d\u7f6e\uff0c\u8fd9\u4e2a\u529f\u80fd\u770b\u8d77\u6765\u4e5f\u662f\u7531 <code>gns</code> \u6765\u5b8c\u6210\u7684\uff1a</p> <pre><code>SetAdapterConfiguration setting the IPv4 address on endpointID (%s) to %s on interfaceName %s\nModifyAddress: Restoring route %s after address change, on interfaceName %s\nProcessRouteChange: Reset routes on interfaceName %s\nProcessRouteChange: Remove route %s on interfaceName %s\nProcessRouteChange: Update route %s on interfaceName %s\n</code></pre> <p>\u65b0\u7684 DNS tunneling \u529f\u80fd\u4e5f\u80fd\u627e\u5230\u76f8\u5e94\u7684\u6587\u672c\uff1a</p> <pre><code>DnsTunnelingManager::DnsTunnelingManager - using DNS server IP %s\n</code></pre>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#kernel","title":"kernel","text":"<p>\u5728\u5185\u6838\u65b9\u9762\uff0cWSL2 \u6253\u4e86\u4e00\u4e9b\u81ea\u5df1\u7684 patch\uff0c\u6db5\u76d6\u7684\u8303\u56f4\u6709\uff1a</p> <ul> <li>\u5185\u5b58\u76f8\u5173\uff1amemory-reclaim\uff0cpage-reporting</li> <li>WSLg \u76f8\u5173\uff1aHyper-V vGPU</li> <li>ARM64 \u76f8\u5173\uff1aHyper-V \u652f\u6301</li> </ul> <p>\u5176\u4e2d\u4fee\u6539\u91cf\u6700\u5927\u7684\u90e8\u5206\u5c31\u662f WSLg \u7684 vGPU\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#wslg","title":"WSLg","text":"<p>WSLg \u662f\u5141\u8bb8 WSL2 \u7684\u7a0b\u5e8f\u5728 Windows \u4e0a\u663e\u793a UI \u7684\u529f\u80fd\u3002\u9996\u5148\u80fd\u770b\u5230\u7684\u662f\uff0c\u5b83\u8bbe\u7f6e\u4e86\u4e00\u4e2a <code>DISPLAY=:0</code>\uff0c\u540c\u65f6\u8fd8 mount \u4e86\u4e0d\u5c11\u6587\u4ef6\u8fdb\u6765\uff1a</p> <pre><code>none on /usr/lib/wsl/drivers type 9p (ro,nosuid,nodev,noatime,dirsync,aname=drivers;fmask=222;dmask=222,mmap,access=client,msize=65536,trans=fd,rfd=7,wfd=7)\nnone on /usr/lib/wsl/lib type overlay (rw,relatime,lowerdir=/gpu_lib_packaged:/gpu_lib_inbox,upperdir=/gpu_lib/rw/upper,workdir=/gpu_lib/rw/work)\nnone on /mnt/wslg type tmpfs (rw,relatime)\n/dev/sdc on /mnt/wslg/distro type ext4 (ro,relatime,discard,errors=remount-ro,data=ordered)\nnone on /mnt/wslg/versions.txt type overlay (rw,relatime,lowerdir=/systemvhd,upperdir=/system/rw/upper,workdir=/system/rw/work)\nnone on /mnt/wslg/doc type overlay (rw,relatime,lowerdir=/systemvhd,upperdir=/system/rw/upper,workdir=/system/rw/work)\nnone on /tmp/.X11-unix type tmpfs (ro,relatime)\n</code></pre> <p>\u5176\u4e2d <code>/tmp/.X11-unix</code> \u662f\u4ece <code>/mnt/wslg/.X11-unix</code> bind-mount \u800c\u6765\uff1a</p> <pre><code>/bin/mount -o bind,ro,X-mount.mkdir -t none /mnt/wslg/.X11-unix /tmp/.X11-unix\n</code></pre> <p>\u8fd9\u70b9\u4e5f\u53ef\u4ee5\u5728\u6253\u5f00 systemd \u7684 WSL2 \u7cfb\u7edf\u91cc\uff0c\u5728 <code>/run/systemd/generator.early/wslg-mount.service</code> \u6587\u4ef6\u91cc\u770b\u5230\u3002</p> <p>\u5728 WSL2 \u7684\u5b89\u88c5\u7a0b\u5e8f\u91cc\uff0c\u8fd8\u80fd\u770b\u5230 RDP \u7684\u8eab\u5f71\uff0c\u56e0\u6b64\u8ba9\u4eba\u6000\u7591\uff0c\u662f\u5426\u662f\u5728 Windows \u4e0a\u542f\u52a8 RDP \u5ba2\u6237\u7aef\uff0c\u8fdc\u7a0b\u8fde\u63a5\u5230 WSL2 \u7684 Linux \u91cc\u9762\uff0c\u800c Linux \u91cc\u9762\u542f\u52a8\u4e86\u4e00\u4e2a\u7c7b\u4f3c xrdp \u7684\u7a0b\u5e8f\uff0c\u542f\u52a8\u4e86\u4e00\u4e2a X11 Server\uff0c\u901a\u8fc7 RDP \u628a\u754c\u9762\u5171\u4eab\u7ed9 Windows\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"os/2023/10/03/wsl2-internals/#systemvhd","title":"system.vhd","text":"<p>\u5728 WSL2 \u5b89\u88c5\u5305\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a <code>system.vhd</code> \u6587\u4ef6\uff0c\u91cc\u9762\u662f\u4e00\u4e2a ext2 \u7684 rootfs\uff0c\u89e3\u5f00\u4ee5\u540e\uff0c\u4f1a\u770b\u5230\u662f CBL-Mariner \u7684\u53d1\u884c\u7248\uff1a</p> <pre><code>DISTRIB_ID=\"Mariner\"\nDISTRIB_RELEASE=\"2.0.20230630\"\nDISTRIB_CODENAME=Mariner\nDISTRIB_DESCRIPTION=\"CBL-Mariner 2.0.20230630\"\n</code></pre> <p>\u5728\u8fd9\u4e2a\u53d1\u884c\u7248\u7cfb\u7edf\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u88c5\u4e86\u5f88\u591a\u8f6f\u4ef6\uff0c\u5305\u62ec\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u60f3\u5230\u662f\u548c WSLg \u6709\u5173\uff08\u6bd5\u7adf\u7cfb\u7edf\u91cc\u53ea\u6709\u4e00\u4e2a\u7528\u6237\u76ee\u5f55 <code>/home/wslg</code>\uff09\uff0c\u628a\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u4f9d\u8d56\u90fd\u6253\u5305\u8fdb\u53bb\u4e86\u3002\u751a\u81f3\u8fd8\u6709\u4e00\u4e2a <code>etc/wsl.conf</code>\uff1a</p> <pre><code>[boot]\ncommand=/usr/bin/WSLGd\n[user]\ndefault=wslg\n</code></pre> <p>\u6240\u4ee5\u53ef\u4ee5\u731c\u60f3\uff0cWSLg \u8fd0\u884c\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u907f\u514d\u6c61\u67d3 WSL2 Linux \u7684\u73af\u5883\uff0c\u628a WSLg \u7684\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u8fdb\u7a0b\u653e\u5230\u4e86\u4e00\u4e2a\u5355\u72ec\u7684 ns \u4e2d\uff0c\u4e24\u4e2a ns \u4e4b\u95f4\u901a\u8fc7 X11 unix socket \u8fdb\u884c\u4e92\u76f8\u8bbf\u95ee\uff0c\u8fd9\u6837 WSLg \u7684\u5185\u90e8\u5b9e\u73b0\u5bf9\u7528\u6237\u5c31\u662f\u900f\u660e\u7684\uff0c\u7528\u6237\u53ea\u4f1a\u770b\u5230\u4e00\u4e2a <code>DISPLAY=:0</code>\uff0c\u7528\u8fd9\u4e2a DISPLAY \u5c31\u53ef\u4ee5\u5728 Windows \u4e0a\u663e\u793a UI\u3002</p> <p>\u66f4\u8fdb\u4e00\u6b65\u731c\u60f3\uff0c\u7ed3\u5408 <code>mount</code> \u770b\u5230\u7684\u5404\u79cd overlayfs\uff0c\u8fd8\u6709\u4e0d\u5b58\u5728\u7684\u76ee\u5f55\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u662f\u4e0d\u662f\u81ea\u5df1\u8bbf\u95ee\u7684\u6574\u4e2a WSL2 Linux \u73af\u5883\uff0c\u5176\u5b9e\u662f\u5728\u4e00\u4e2a\u5bb9\u5668\u91cc\u9762\uff0c\u5bb9\u5668\u5916\u9762\u662f\u8fd9\u4e2a CBL-Mariner\uff0c\u5bb9\u5668\u91cc\u9762\u624d\u662f\u6211\u4eec\u770b\u5230\u7684\u90e8\u5206\u3002\u8fd9\u5b8c\u5168\u53ef\u4ee5\u505a\u5230\uff0c\u6bd5\u7adf systemd-nspawn \u5bb9\u5668\u662f\u53ef\u4ee5\u5728\u91cc\u9762 boot systemd \u7684\u3002\u53ef\u4ee5\u7528\u6765\u4f50\u8bc1\u8fd9\u4e2a\u731c\u6d4b\u7684\u4e00\u4e2a\u73b0\u8c61\u662f\uff0c\u7cfb\u7edf\u91cc\u627e\u4e0d\u5230\u76d1\u542c <code>/tmp/.X11-unix/X0</code> \u7684\u8fdb\u7a0b\u3002</p> <p>\u5728 WSL2 Linux \u91cc\u9762\uff0crootfs \u662f <code>/dev/sdc</code>\uff0c<code>/dev/sdb</code> \u662f SWAP \u5206\u533a\uff0c\u5982\u679c mount \u4e00\u4e0b <code>/dev/sda</code>\uff0c\u5c31\u4f1a\u53d1\u73b0\u5b83\u91cc\u9762\u7684\u5185\u5bb9\u5c31\u662f <code>systemd.vhd</code> \u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684 CBL-Mariner \u7cfb\u7edf\u3002\u540c\u65f6\uff0cCBL-Mariner \u7684 <code>/etc/versions.txt</code> \u5185\u5bb9\u548c WSL2 Linux \u7684 <code>/mnt/wslg/versions.txt</code> \u5185\u5bb9\u4e00\u6837\uff1a</p> <pre><code>none on /mnt/wslg/versions.txt type overlay (rw,relatime,lowerdir=/systemvhd,upperdir=/system/rw/upper,workdir=/system/rw/work)\n</code></pre> <p>\u53ef\u4ee5\u731c\u6d4b <code>/dev/sda</code> \u66fe\u7ecf\u88ab\u6302\u8f7d\u5230\u4e86 <code>/systemvhd</code>\uff0c\u7136\u540e\u5728\u4e0a\u9762\u5957\u4e86\u4e00\u5c42 overlayfs\uff0c\u6700\u540e mount \u5230 <code>/mnt/wslg</code> \u4e0b\u9762\u3002\u540c\u7406\uff0cCBL-Mariner \u7684 <code>/usr/share/doc</code> \u88ab\u6302\u8f7d\u5230\u4e86 <code>/mnt/wslg/doc</code> \u8def\u5f84\uff1a</p> <pre><code>none on /mnt/wslg/doc type overlay (rw,relatime,lowerdir=/systemvhd,upperdir=/system/rw/upper,workdir=/system/rw/work)\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u9a8c\u8bc1\u731c\u60f3\u7684\u65f6\u523b\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u8fdb\u5165 CBL-Mariner \u8fd9\u4e2a\u7cfb\u7edf\uff0c\u8fd9\u4e2a\u7cfb\u7edf\u79f0\u4e3a WSLg System Distro\uff1a</p> <pre><code>wsl --system\n</code></pre> <p>\u5c31\u53ef\u4ee5\u770b\u5230\u5b83\u91cc\u9762\u786e\u5b9e\u8dd1\u4e86\u4e00\u4e2a Xwayland\uff0c\u5e76\u4e14\u548c WSL2 Linux \u62e5\u6709\u540c\u6837\u7684 IP \u5730\u5740\uff1a\u8fd9\u8bf4\u660e\u5b83\u4eec\u5171\u4eab\u4e86\u540c\u4e00\u4e2a network namespace\uff0c\u4f46\u5176\u4ed6\u662f\u72ec\u7acb\u7684\uff0c\u751a\u81f3\u4f60\u8fd8\u53ef\u4ee5\u5728 CBL-Mariner \u770b\u5230\u4f60\u5728 WSL2 Linux \u91cc\u9762\u7684\u8fdb\u7a0b\uff0c\u5c31\u597d\u50cf\u4f60\u8fd0\u884c\u4e86\u4e00\u4e2a <code>docker run --net=host</code> \u7684\u5bb9\u5668\u4e00\u6837\u3002</p> <p>\u5173\u4e8e WSL2 System Distro \u7684\u8ba8\u8bba\uff0c\u63a8\u8350\u9605\u8bfb\uff1ahttps://unix.stackexchange.com/a/732459/144358\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u6784\u5efa\u4e00\u4e2a\uff1aBuilding the WSLg System Distro\uff0c\u5e76\u4e14\u66ff\u6362\u6389\u81ea\u5e26\u7684 WSLg System Distro\u3002</p> <p>\u6ce8\uff1a\u6839\u636e\u8bc4\u8bba\u533a Pierre J \u63d0\u9192\uff0c\u9664\u4e86 System Distro\uff0c\u5916\u9762\u8fd8\u6709\u4e00\u5c42 CBL-Mariner\uff0c\u901a\u8fc7 <code>wsl --debug-shell</code> \u53ef\u4ee5\u8fdb\u5165\uff0c\u8fd9\u771f\u7684\u662f\u5bb9\u5668\u5957\u5a03\u4e86\u3002</p>","tags":["windows","wsl","wsl2","linux"]},{"location":"others/2017/10/16/a-funny-wiki-of-splay-tree/","title":"\u4e00\u4e2a\u641e\u7b11\u7684\u4f38\u5c55\u6811\u7684 Wiki","text":"<p>\u5149\u54f2\u540c\u5b66\u5728\u7fa4\u91cc\u53d1\u4e86\u8fd9\u4e2a\u94fe\u63a5\uff0c\u7279\u522b\u641e\u7b11\uff0c\u7279\u6b64\u5206\u4eab\uff1a \u4f38\u5c55\u6811 - \u767e\u5ea6\u767e\u79d1</p> <p>\u4f38\u5c55\u6811\uff08Spaly Tree\uff0c\u4e8b\u5b9e\u4e0a\u5728\u56fd\u5185 IO \u754c\u5e38\u5e38\u88ab\u79f0\u4f5c Tajarn \u53d1\u660e\u7684 Spaly Tree\uff0c\u4e0e\u6b64\u540c\u7406\u7684\u8fd8\u6709 Terap\uff09\uff0c\u4e5f\u53eb\u5206\u88c2\u6811\uff0c\u662f\u4e00\u79cd\u4e8c\u53c9\u6392\u5e8f\u6811\uff0c\u5b83\u80fd\u5728 O(n log n) \u5185\u5b8c\u6210\u63d2\u5165\u3001\u67e5\u627e\u548c\u5220\u9664\u64cd\u4f5c\u3002\u5b83\u7531 Daniel Sleator \u548c Robert Tajarn \u53d1\u73b0\uff0c\u540e\u8005\u5bf9\u5176\u8fdb\u884c\u4e86\u6539\u9020\u3002\u5b83\u7684\u4f18\u52bf\u53ef\u4ee5\u4e0d\u65ad\u4f38\u5c55\u679d\u5e72\uff08\u4e00\u4e2a\u6708 2~3 \u6b21\uff09\uff0c\u4ece\u800c\u4f7f\u6811\u51a0\u6563\u5f00\uff0c\u63d0\u9ad8\u5149\u5408\u4f5c\u7528\u6548\u7387\u3002\u6728\u6750\u575a\u786c\uff0c\u662f\u91cd\u8981\u7684\u7ecf\u6d4e\u7c7b\u4e54\u6728\u3002\u4e0e\u5176\u4ed6\u690d\u7269\u4e0d\u540c\u7684\u662f\uff0c\u4f38\u5c55\u6811\u53ef\u4ee5\u8fdb\u884c\u51fa\u82bd\u751f\u6b96\uff0c\u7e41\u6b96\u901f\u5ea6\u6781\u5feb\u3002</p>","tags":["algorithm","wiki"]},{"location":"others/2017/10/26/alternative-to-pulse-secure/","title":"\u4e00\u4e2a\u4ee3\u66ff Pulse Secure \u5ba2\u6237\u7aef\u7684\u5de5\u5177","text":"<p>\u6e05\u534e\u7684\u6821\u5916 VPN \u670d\u52a1\u4f7f\u7528\u7684\u662f Pulse Secure\uff0c\u6240\u4ee5\u5728\u5916\u7f51\u6211\u4eec\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u5b89\u88c5 Pulse Secure \u624d\u80fd\u4f7f\u7528\u5185\u7f51\u7684 info \u548c\u7f51\u7edc\u5b66\u5802\u7b49\u7f51\u7ad9\u3002\u4f46\u662f Pulse Secure \u4e00\u662f\u975e\u81ea\u7531\u8f6f\u4ef6\u4e8c\u754c\u9762\u96be\u770b\uff0c\u6240\u4ee5\u6211\u627e\u5230\u4e86\u4e00\u4e2a\u4ee3\u66ff\u5b83\u7684\u5de5\u5177\uff1aOpenConnect.</p> <p>\u5b89\u88c5\u540e\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>sudo openconnect --user \u4f60\u7684\u5b66\u53f7 sslvpn.tsinghua.edu.cn --juniper --reconnect-timeout 60 --servercert sha256:398c6bccf414f7d71b6dc8d59b8e3b16f6d410f305aed7e30ce911c3a4064b31\n</code></pre> <p>\u7136\u540e\u8f93\u5165\u4f60\u7684 info \u5bc6\u7801\u5373\u53ef\u3002</p>","tags":["tsinghua","networking","sslvpn"]},{"location":"others/2020/05/01/bb84-explained/","title":"\u89e3\u91ca BB84 \u534f\u8bae","text":"","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2020/05/01/bb84-explained/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u8fd9\u5468\u5bc6\u7801\u5b66\u8bfe\u7a0b\uff0c\u6765\u81ea BUPT \u7684\u9ad8\u98de\u8001\u5e08\u8bb2\u4e86\u4e00\u4e0b qkd \u91cc\u7684 BB84 \u534f\u8bae\uff0c\u8001\u5e08\u8bb2\u5f97\u5f88\u597d\uff0c\u6211\u4e5f\u60f3\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e2a\u534f\u8bae\u7684\u6d41\u7a0b\u548c\u65b9\u6cd5\u3002\u6211\u4e0d\u662f\u8fd9\u65b9\u9762\u7684\u4e13\u4e1a\u4eba\u58eb\uff0c\u5982\u679c\u6709\u4ec0\u4e48\u95ee\u9898\u8bf7\u6307\u51fa\u3002</p>","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2020/05/01/bb84-explained/#\u80cc\u666f\u77e5\u8bc6","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>QKD\uff08Quantum Key Distribution\uff09\u76ee\u7684\u662f\u8ba9\u901a\u4fe1\u53cc\u65b9\u83b7\u5f97\u540c\u4e00\u4e2a\u5bc6\u94a5\uff0c\u5b83\u9700\u8981\u540c\u65f6\u9700\u8981\u91cf\u5b50\u4fe1\u9053\u548c\u7ecf\u5178\u4fe1\u9053\u3002\u5176\u4e2d\u7ecf\u5178\u4fe1\u9053\u88ab\u8ba4\u4e3a\u662f\u53ef\u4fe1\u7684\uff0c\u5b83\u53ef\u4ee5\u88ab\u76d1\u542c\uff0c\u4f46\u4e0d\u80fd\u88ab\u4e2d\u95f4\u4eba\u653b\u51fb\u3002</p> <p>\u5728 BB84\uff08Charles H. Bennett and Gilles Brassard (1984)\uff09\u534f\u8bae\u4e2d\uff0c\u4f20\u8f93\u7684\u662f\u4e00\u4e2a\u5149\u5b50\uff0c\u5b83\u5177\u6709\u5982\u4e0b\u7684\u7279\u6027\uff1a</p> <p>\u53ef\u4ee5\u7528\u4e24\u4e2a\u57fa\u53bb\u6d4b\u91cf\u5149\u5b50\uff1a\u2795\ufe0f\u548c\u2716\ufe0f\ufe0f\uff0c\u7136\u540e\u5149\u5b50\u6709\u56db\u4e2a\u504f\u632f\u89d2\u5ea6\uff0c\u5206\u522b\u662f \u2b06\ufe0f\ufe0f \u2b07\ufe0f\ufe0f \u2198\ufe0f\ufe0f \u2197\ufe0f\ufe0f\u3002\u5b9a\u4e49\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u548c\u504f\u632f\u89d2\u5ea6\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p> \u4f4d 0 1 0 1 \u57fa \u2795\ufe0f \u2795\ufe0f \u2716\ufe0f\ufe0f \u2716\ufe0f\ufe0f \u504f\u632f\u89d2\u5ea6 \u2b06\ufe0f\ufe0f \u2b07\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u2198\ufe0f\ufe0f <p>\u5bf9\u4e8e\u4e00\u4e2a\u672a\u77e5\u5149\u5b50\uff0c\u53ef\u4ee5\u7528\u4e24\u79cd\u57fa\u8fdb\u884c\u6d4b\u91cf\uff0c\u6d4b\u91cf\u7684\u7ed3\u679c\uff1a</p> \u504f\u632f\u89d2\u5ea6 \u2b06\ufe0f\ufe0f \u2b07\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u2198\ufe0f\ufe0f \u7528\u2795\ufe0f\u6d4b\u91cf 0 1 0/1 0/1 \u7528\u2716\ufe0f\ufe0f\u6d4b\u91cf 0/1 0/1 0 1 <p>\u8fd9\u91cc\u7684 <code>0/1</code> \u8868\u793a\u6709 50% \u6982\u7387\u6d4b\u5f97 0\uff0c\u6709 50% \u6982\u7387\u6d4b\u5f97 1\u3002</p>","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2020/05/01/bb84-explained/#\u534f\u8bae\u6d41\u7a0b","title":"\u534f\u8bae\u6d41\u7a0b","text":"<p>\u5047\u5982 Alice \u8981\u548c Bob \u8fdb\u884c BB84 \u534f\u8bae\u3002\u90a3\u4e48\uff0cAlice \u9996\u5148\u968f\u673a\u751f\u6210\u4e00\u6bb5\u4e8c\u8fdb\u5236\u5e8f\u5217\uff0c\u5e76\u968f\u673a\u751f\u6210\u4e00\u4e2a\u57fa\u7684\u5e8f\u5217\uff0c\u4ee5 Wikipedia \u4e0a\u7684\u4f8b\u5b50\u4e3a\u4f8b\uff1a</p> Alice's random bit 0 1 1 0 1 0 0 1 Alice's random sending basis \u2795\ufe0f \u2795\ufe0f \u2716\ufe0f\ufe0f \u2795\ufe0f \u2716\ufe0f\ufe0f \u2716\ufe0f\ufe0f \u2716\ufe0f\ufe0f \u2795\ufe0f Photon polarization Alice sends \u2b06\ufe0f\ufe0f \u27a1\ufe0f\ufe0f \u2198\ufe0f\ufe0f \u2b06\ufe0f\ufe0f \u2198\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u27a1\ufe0f\ufe0f Bob \u751f\u6210\u968f\u673a\u7684\u57fa \u2795\ufe0f \u2716\ufe0f\ufe0f \u2716\ufe0f\ufe0f \u2716\ufe0f\ufe0f \u2795\ufe0f \u2716\ufe0f\ufe0f \u2795\ufe0f \u2795\ufe0f Photon polarization Bob measures \u2b06\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u2198\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u27a1\ufe0f\ufe0f \u2197\ufe0f\ufe0f \u27a1\ufe0f\ufe0f \u27a1\ufe0f\ufe0f Bob \u8ba4\u4e3a\u7684\u4e8c\u8fdb\u5236\u4fe1\u606f 0 0 1 0 1 0 1 1 \u901a\u8fc7\u7ecf\u5178\u4fe1\u9053\u4ea4\u6362\u4fe1\u606f Shared secret key 0 \u4e22\u5f03 1 \u4e22\u5f03 \u4e22\u5f03 0 \u4e22\u5f03 1 <p>\u7b2c\u4e00\u6b65\uff0cAlice \u751f\u6210\u968f\u673a\u7684\u4e8c\u8fdb\u5236\u548c\u968f\u673a\u7684\u57fa\uff0c\u6309\u7167\u524d\u9762\u8c08\u5230\u8fc7\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u751f\u6210\u5e26\u6709\u504f\u632f\u89d2\u5ea6\u7684\u5149\u5b50\u53d1\u7ed9 Bob\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff0c\u7531\u4e8e Bob \u53ea\u6536\u5230\u5149\u5b50\uff0c\u4e0d\u77e5\u9053 Alice \u9009\u53d6\u7684\u57fa\u5e95\u4fe1\u606f\uff0c\u800c\u4e14\u53ea\u80fd\u7528\u4e00\u4e2a\u57fa\u6d4b\u91cf\u4e00\u6b21\uff0c\u6240\u4ee5 Bob \u968f\u673a\u4ece\u4e24\u79cd\u57fa\u9009\u62e9\u4e00\u4e2a\u6765\u6d4b\u91cf\uff0c\u5f97\u5230\u4e86\u4e00\u4e32\u4e8c\u8fdb\u5236\u3002\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u91cc\uff0c\u5982\u679c Alice \u548c Bob \u9009\u53d6\u4e86\u540c\u4e00\u4e2a\u57fa\uff0c\u90a3\u4e48\u8fd9\u4e00\u4f4d\u7684\u6570\u636e\u4e00\u5b9a\u662f\u5bf9\u7684\uff1b\u5982\u679c\u9009\u53d6\u4e86\u4e0d\u540c\u7684\u57fa\uff0c\u90a3\u4e48\u8fd9\u4e00\u4f4d\u6709\u4e00\u534a\u7684\u53ef\u80fd\u662f\u5bf9\u7684\u3002\u603b\u7684\u6765\u8bf4\uff0c\u671f\u671b\u6709\u56db\u5206\u4e4b\u4e00\u7684\u4f4d\u662f\u4e0d\u6b63\u786e\u7684\u3002</p> <p>\u7b2c\u4e09\u6b65\uff0cAlice \u548c Bob \u5728 \u53ef\u4fe1 \u7684\u7ecf\u5178\u4fe1\u9053\u4e2d\u628a\u53cc\u65b9\u7684\u57fa\u5e95\u8fdb\u884c\u5bf9\u6bd4\uff0c\u628a\u57fa\u5e95\u76f8\u7b49\u7684\u90e8\u5206\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u4f4d\u63d0\u53d6\u51fa\u6765\uff0c\u4f5c\u4e3a\u6700\u7ec8\u4f7f\u7528\u7684\u5bc6\u94a5\u3002</p> <p>\u7b2c\u56db\u6b65\uff0cAlice \u548c Bob \u5728\u6700\u7ec8\u4f7f\u7528\u7684\u5bc6\u94a5\u4e2d\u62bd\u53d6\u82e5\u5e72\u4f4d\uff0c\u7136\u540e\u5bf9\u6bd4\uff0c\u5982\u679c\u8fd9\u4e9b\u4f4d\u90fd\u4e00\u81f4\uff0c\u5219\u8fd9\u4e2a\u5bc6\u7801\u662f\u6709\u6548\u7684\u3002\u5982\u679c\u9519\u8bef\u7387\u592a\u9ad8\uff0c\u90a3\u4e48\u5f88\u5927\u6982\u7387\u662f\u88ab\u653b\u51fb\u4e86\u3002</p>","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2020/05/01/bb84-explained/#\u5b89\u5168\u6027","title":"\u5b89\u5168\u6027","text":"<p>\u534f\u8bae\u7684\u5b89\u5168\u6027\uff0c\u4e3b\u8981\u662f\u9760\u91cf\u5b50\u7684\u7279\u6027\uff1a\u672a\u77e5\u91cf\u5b50\u6001\u4e0d\u53ef\u514b\u9686\u3001\u5bf9\u672a\u77e5\u91cf\u5b50\u6001\u7684\u6d4b\u91cf\u53ef\u80fd\u4f1a\u6539\u53d8\u91cf\u5b50\u6001\u3002</p> <p>\u5047\u5982\u5728\u91cf\u5b50\u4fe1\u9053\u4e2d\u95f4\u6709\u4e00\u4e2a Eve \u60f3\u8981\u505a\u574f\u4e8b\uff0c\u5b83\u5982\u679c\u5728\u4e2d\u95f4\u89c2\u6d4b\u4e86\u4e00\u4e0b\u5149\u5b50\uff0c\u5b83\u5c31\u4f1a\u5f71\u54cd\u5149\u5b50\u7684\u91cf\u5b50\u6001\uff0c\u5bfc\u81f4 Bob \u7684\u5bc6\u94a5\u548c Alice \u5bc6\u94a5\u4f1a\u4e0d\u4e00\u81f4\uff0c\u4ece\u800c\u5728\u534f\u8bae\u7684\u7b2c\u56db\u6b65\u88ab\u53d1\u73b0\u3002\u5e76\u4e14\uff0c\u56e0\u4e3a Eve \u5e76\u4e0d\u77e5\u9053 Alice \u6240\u4f7f\u7528\u7684\u57fa\u5e95\uff08\u5047\u8bbe Eve \u53ea\u80fd\u63a7\u5236\u91cf\u5b50\u4fe1\u9053\u3001\u4e0d\u80fd\u63a7\u5236\u7ecf\u5178\u4fe1\u9053\uff09\uff0c\u6240\u4ee5\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u4e5f\u6709\u56db\u5206\u4e4b\u4e00\u662f\u4e0d\u6b63\u786e\u7684\u3002\u5373\u4f7f Eve \u5c1d\u8bd5\u622a\u83b7\u5e76\u4e14\u91cd\u53d1\u5149\u5b50\u7ed9 Bob\uff0cBob \u5f97\u5230\u7684\u5bc6\u94a5\u4ecd\u7136\u6709\u5f88\u9ad8\u7684\u9519\u8bef\u7387\u3002\u901a\u8fc7\u8fd9\u4e2a\u9519\u8bef\u7387\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u662f\u5426\u88ab\u653b\u51fb\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u5b83\u7684\u5b89\u5168\u6027\u8fd8\u4f9d\u8d56\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li>Eve \u4e0d\u80fd\u63a7\u5236 Alice \u548c Bob \u7684\u91cf\u5b50\u5bc6\u7801\u8bbe\u5907</li> <li>Alice \u548c Bob \u7684\u968f\u673a\u6570\u751f\u6210\u5668\u9700\u8981\u8db3\u591f\u5b89\u5168</li> <li>\u7ecf\u5178\u4fe1\u9053\u662f\u53ef\u4fe1\u7684</li> </ol>","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2020/05/01/bb84-explained/#\u5f15\u7528","title":"\u5f15\u7528","text":"<p>Quantum key distribution - Wikipedia</p>","tags":["algorithm","qkd","quantom","bb84"]},{"location":"others/2018/03/26/busy-these-days/","title":"\u6700\u8fd1\u6bd4\u8f83\u5fd9","text":"<p>\u6700\u8fd1\u4e00\u76f4\u6ca1\u6709\u66f4\u65b0\u6211\u7684 CS140e \u7cfb\u5217\u6587\u7ae0\uff0c\u662f\u56e0\u4e3a\u6700\u8fd1\u4e00\u76f4\u5fd9\u4e8e\u5404\u79cd\u4e8b\u60c5\u3002\u7b49\u6709\u7a7a\u4e86\u518d\u66f4\u65b0\u5427\u3002</p>","tags":[]},{"location":"others/2023/08/06/college-admission/","title":"\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b","text":"<p>\u672c\u6587\u662f\u672c\u4eba\u5bf9\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\u7684\u6574\u7406\uff0c\u53ef\u80fd\u6709\u8bef\uff0c\u6b22\u8fce\u6307\u51fa\u3002\u6587\u4e2d\u4e0d\u6d89\u53ca\u4e00\u4e9b\u7701\u4efd\u7684\u7279\u6b8a\u60c5\u51b5\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2023/08/06/college-admission/#\u8ba1\u5212","title":"\u8ba1\u5212","text":"<p>\u8ba1\u5212\u6307\u7684\u662f\u666e\u901a\u9ad8\u6821\u6bcf\u5e74\u8981\u5f55\u53d6\u7684\u65b0\u751f\u4eba\u6570\uff0c\u6bcf\u5e74\u63d0\u524d\u5236\u5b9a\u597d\uff0c\u8ba1\u5212\u7684\u7ec4\u6210\u5305\u62ec\uff1a</p> <ol> <li>\u666e\u901a\u62db\u751f\uff0c\u9884\u5148\u7ed9\u6bcf\u4e2a\u7701\u5206\u914d\u4e00\u90e8\u5206\u8ba1\u5212</li> <li>\u9884\u7559\u8ba1\u5212\uff0c\u6bd4\u4f8b\u4f1a\u5728\u62db\u751f\u7ae0\u7a0b\u4e2d\u516c\u5f00\uff0c\u4f8b\u5982\u4e0d\u8d85\u8fc7 1%</li> <li>\u975e\u666e\u901a\u62db\u751f\uff0c\u4f8b\u5982\u7279\u6b8a\u7c7b\u578b\u62db\u751f\uff0c\u5404\u79cd\u4e13\u9879</li> </ol> <p>\u8ba1\u5212\u6570\u662f\u516c\u5f00\u7684\uff0c\u6bcf\u5e74\u53ef\u4ee5\u5728\u5404\u7701\u5370\u53d1\u7684\u5927\u539a\u672c\u4e2d\uff0c\u67e5\u770b\u672c\u5e74\u67d0\u9ad8\u6821\u5728\u672c\u7701\u5404\u4e13\u4e1a\u7ec4\u8ba1\u5212\u62db\u6536\u7684\u8ba1\u5212\u6570\u3002</p> <p>\u8ba1\u5212\u6570\u901a\u5e38\u60c5\u51b5\u4e0b\u53ea\u589e\u4e0d\u51cf\uff0c\u5982\u679c\u9700\u8981\u51cf\u5c11\uff0c\u6d89\u53ca\u5230\u6559\u80b2\u516c\u5e73\uff0c\u9700\u8981\u6709\u5408\u7406\u8981\u6c42\uff0c\u5e76\u7ecf\u8fc7\u6559\u80b2\u90e8\u5ba1\u6279\u3002\u5f53\u7136\u4e86\uff0c\u5982\u679c\u62db\u4e0d\u6ee1\uff0c\u4e5f\u5c31\u662f\u6ee1\u8db3\u5408\u7406\u8981\u6c42\u7684\u8003\u751f\u6570\u91cf\u4e0d\u8db3\u8ba1\u5212\u6570\uff0c\u662f\u53ef\u4ee5\u628a\u8ba1\u5212\u632a\u5230\u5176\u4ed6\u5730\u65b9\u7684\u3002</p> <p>\u56e0\u6b64\u9ad8\u6821\u4f1a\u9884\u7559\u4fdd\u7559\u8ba1\u5212\uff0c\u4ece\u9884\u7559\u8ba1\u5212\u8c03\u6574\u5230\u5404\u7701\u62db\u751f\u8ba1\u5212\u662f\u6bd4\u8f83\u5bb9\u6613\u7684\u3002\u4f46\u4fdd\u7559\u8ba1\u5212\u7684\u6570\u91cf\u6709\u9650\uff0c\u4f8b\u5982\u6e05\u534e\u62db\u751f\u7ae0\u7a0b\u4e2d\uff0c\u5199\u9053\uff1a</p> <pre><code>\u5c06\u62db\u751f\u8ba1\u5212\u603b\u6570\u7684 1% \u4f5c\u4e3a\u9884\u7559\u8ba1\u5212\uff0c\u7528\u4e8e\u8c03\u8282\u5404\u5730\u7edf\u8003\u4e0a\u7ebf\u751f\u6e90\u4e0d\u5e73\u8861\u3002\u9884\u7559\u8ba1\u5212\u4f7f\u7528\u65f6\uff0c\u575a\u6301\u89c4\u8303\u6709\u5e8f\u3001\u8d28\u91cf\u4f18\u5148\u7684\u539f\u5219\u3002\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0a\u8ff0\u8ba1\u5212\u9488\u5bf9\u7684\u662f\u9ad8\u6821\uff0c\u800c\u4e0d\u662f\u4e13\u4e1a\u3002\u8fd9\u610f\u5473\u7740\uff0c\u8ba1\u5212\u53ea\u9650\u5236\u4e86\u6bcf\u5e74\u6bcf\u4e2a\u9ad8\u6821\u901a\u8fc7\u6bcf\u4e2a\u9014\u5f84\u6216\u8005\u6bcf\u4e2a\u7701\u4efd\u62db\u6536\u591a\u5c11\u65b0\u751f\u3002\u4f46\u662f\u5e76\u4e0d\u9650\u5236\u4e13\u4e1a\uff0c\u9ad8\u6821\u5728\u6bcf\u4e2a\u4e13\u4e1a\u5f55\u53d6\u591a\u5c11\u65b0\u751f\u7684\u65b9\u9762\u5177\u6709\u8f83\u5927\u7684\u81ea\u4e3b\u6743\u3002</p> <p>\u56e0\u6b64\u5728\u5927\u539a\u672c\u91cc\uff0c\u5404\u4e13\u4e1a\u7ec4\u7684\u8ba1\u5212\u603b\u6570\u662f\u53ef\u9760\u7684\uff0c\u5404\u4e13\u4e1a\u7684\u8ba1\u5212\u6570\u662f\u4e0d\u53ef\u9760\u7684\uff1a\u5b9e\u9645\u5f55\u53d6\u7684\u6bcf\u4e2a\u4e13\u4e1a\u7684\u8ba1\u5212\u6570\u548c\u5927\u539a\u672c\u4e0a\u5199\u7684\u5f88\u53ef\u80fd\u4e0d\u4e00\u81f4\uff0c\u4f46\u603b\u6570\u5e94\u5f53\u662f\u5dee\u4e0d\u591a\u7684\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2023/08/06/college-admission/#\u5e73\u884c\u5fd7\u613f","title":"\u5e73\u884c\u5fd7\u613f","text":"<p>\u8003\u751f\u5728\u9ad8\u8003\u51fa\u5206\u540e\uff0c\u9700\u8981\u586b\u62a5\u5fd7\u613f\uff0c\u6bcf\u4e2a\u5fd7\u613f\u5bf9\u5e94\u4e00\u4e2a\u6295\u6863\u5355\u4f4d\uff0c\u4e5f\u5c31\u662f\u9ad8\u6821\u7684\u67d0\u4e2a\u4e13\u4e1a\u7ec4\u3002\u4f8b\u5982\u7269\u7406\u7ec4\u8981\u6c42\u8003\u751f\u9009\u62e9\u7269\u7406\uff0c\u7269\u5316\u7ec4\u8981\u6c42\u8003\u751f\u9009\u62e9\u4e86\u7269\u7406\u548c\u5316\u5b66\u3002\u4e13\u4e1a\u7ec4\u7684\u5236\u5b9a\u53d6\u51b3\u4e8e\u9ad8\u6821\uff0c\u9ad8\u6821\u4f1a\u6839\u636e\u62db\u751f\u7ae0\u7a0b\uff0c\u5236\u5b9a\u5404\u4e13\u4e1a\u7ec4\u3002\u5728\u5927\u539a\u672c\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u4e13\u4e1a\u7ec4\u5185\u6709\u54ea\u4e9b\u4e13\u4e1a\u3002</p> <p>\u586b\u62a5\u5fd7\u613f\u65f6\uff0c\u6bcf\u4e2a\u5fd7\u613f\u5185\u5305\u542b\u8be5\u4e13\u4e1a\u7ec4\u5185\u7684\u591a\u4e2a\u4e13\u4e1a\uff0c\u8003\u751f\u5bf9\u4e13\u4e1a\u8fdb\u884c\u6392\u5e8f\uff0c\u5e76\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u670d\u4ece\u8c03\u5242\u3002</p> <p>\u5e73\u884c\u5fd7\u613f\u7684\u610f\u601d\u662f\uff0c\u6295\u6863\u7684\u65f6\u5019\uff0c\u6309\u7167\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u904d\u5386\u8003\u751f\uff0c\u6309\u7167\u8003\u751f\u7684\u5fd7\u613f\u67e5\u770b\u662f\u5426\u6ee1\u8db3\u6295\u6863\u6761\u4ef6\uff0c\u5982\u679c\u6ee1\u8db3\uff0c\u5219\u6295\u6863\u5230\u5bf9\u5e94\u6295\u6863\u5355\u4f4d\uff0c\u7ed3\u675f\u6295\u6863\u8fc7\u7a0b\uff1b\u5982\u679c\u4e0d\u6ee1\u8db3\uff0c\u5219\u68c0\u67e5\u4e0b\u4e00\u4e2a\u5fd7\u613f\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6295\u6863\u7684\u65f6\u5019\u53ea\u770b\u5fd7\u613f\uff0c\u4e5f\u5c31\u662f\u4e13\u4e1a\u7ec4\uff0c\u800c\u4e0d\u770b\u4e13\u4e1a\u3002\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>for student in all_students.sort_by(score):\n    for choice in student.all_choices:\n        if meet(student, choice):\n            assign(student, choice.group)\n            break\n</code></pre> <p>\u6295\u6863\u6761\u4ef6\u9996\u5148\u662f\u5206\u6570\uff0c\u8981\u6c42\u8003\u751f\u7684\u5206\u6570\u8d85\u8fc7\u8be5\u6295\u6863\u5355\u4f4d\u7684\u6295\u6863\u7ebf\uff1b\u5176\u6b21\uff0c\u90e8\u5206\u6295\u6863\u5355\u4f4d\u6709\u989d\u5916\u7684\u9650\u5236\uff0c\u4f8b\u5982\u4e0a\u9762\u63d0\u5230\u7684\u7269\u7406\u5316\u5b66\u7b49\u7b49\u3002</p> <p>\u518d\u6b21\u5f3a\u8c03\uff0c\u6295\u6863\u7684\u65f6\u5019\u4e0d\u4f1a\u770b\u586b\u4e86\u4e13\u4e1a\u7ec4\u91cc\u7684\u54ea\u4e9b\u4e13\u4e1a\uff0c\u4e5f\u4e0d\u4f1a\u770b\u662f\u5426\u9009\u62e9\u4e0d\u670d\u4ece\u5206\u914d\u3002</p> <p>\u5728\u5e73\u884c\u5fd7\u613f\u6a21\u5f0f\u4e0b\uff0c\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u9000\u6863\u7684\u65f6\u5019\uff0c\u8003\u751f\u4f1a\u5f88\u96be\u518d\u8fdb\u5165\u597d\u7684\u5b66\u6821\u3002\u89c2\u5bdf\u4e0a\u9762\u7684\u6295\u6863\u6d41\u7a0b\uff0c\u6bcf\u4e2a\u5b66\u751f\u53ea\u4f1a\u6295\u6863\u4e00\u6b21\uff0c\u5982\u679c\u6295\u6863\u4e86\u53c8\u9000\u6863\u4e86\uff0c\u662f\u4e0d\u4f1a\u7acb\u5373\u6295\u6863\u7684\u3002\u800c\u662f\u8981\u7b49\u5230\u6240\u6709\u5b66\u751f\u90fd\u6295\u6863\u548c\u5f55\u53d6\u5b8c\u6210\u4ee5\u540e\uff0c\u90e8\u5206\u9ad8\u6821\u6ca1\u6709\u5b8c\u6210\u62db\u751f\u8ba1\u5212\uff0c\u8fd8\u6709\u7a7a\u4f59\uff0c\u90a3\u4e48\u5728\u5f81\u96c6\u5fd7\u613f\u7684\u9636\u6bb5\uff0c\u8fd9\u4e9b\u9000\u6863\u7684\u5b66\u751f\u624d\u6709\u673a\u4f1a\u91cd\u65b0\u586b\u5fd7\u613f\uff0c\u91cd\u65b0\u6295\u6863\uff0c\u91cd\u65b0\u5f55\u53d6\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2023/08/06/college-admission/#\u6a21\u62df\u6295\u6863","title":"\u6a21\u62df\u6295\u6863","text":"<p>\u4e0a\u9762\u7684\u6295\u6863\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u5230\u4e00\u4e2a\u53c2\u6570\uff0c\u90a3\u5c31\u662f\u6295\u6863\u7ebf\u3002\u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u6982\u5ff5\uff0c\u6295\u6863\u6bd4\u4f8b\uff08\u4e5f\u53eb\u8c03\u6863\u6bd4\u4f8b\uff09\uff1a\u6295\u6863\u7684\u4eba\u6570\uff0c\u76f8\u6bd4\u8ba1\u5212\u6570\u7684\u6bd4\u4f8b\u3002\u4f8b\u5982 100% \u5c31\u662f\u8ba1\u5212\u6536 100 \u4e2a\u5b66\u751f\uff0c\u90a3\u5c31\u6295\u6863 100 \u4e2a\u5b66\u751f\uff1b105% \u5c31\u662f\u8ba1\u5212\u6536 100 \u4e2a\u5b66\u751f\uff0c\u6295\u6863 105 \u4e2a\u5b66\u751f\u3002</p> <p>\u90a3\u4e48\u6295\u6863\u7ebf\u662f\u600e\u4e48\u5b9a\u7684\u5462\uff1f\u7b54\u6848\u662f\u6a21\u62df\u6295\u6863\u3002\u5728\u6b63\u5f0f\u6295\u6863\u524d\uff0c\u9700\u8981\u8fdb\u884c\u591a\u8f6e\u7684\u6a21\u62df\u6295\u6863\uff0c\u6a21\u62df\u6295\u6863\u7684\u7ed3\u679c\u4f1a\u901a\u77e5\u5404\u9ad8\u6821\uff0c\u5404\u9ad8\u6821\u53ef\u4ee5\u8c03\u6574\u81ea\u5df1\u7684\u8ba1\u5212\u548c\u6295\u6863\u7ebf\uff0c\u8c03\u6574\u5b8c\u4ee5\u540e\u518d\u6b21\u6a21\u62df\u6295\u6863\u3002\u8fd9\u6837\u591a\u8f6e\u4ee5\u540e\uff0c\u6a21\u62df\u6295\u6863\u5c31\u4f1a\u6536\u655b\u5230\u4e00\u4e2a\u7a33\u5b9a\u7684\u72b6\u6001\uff0c\u6b64\u65f6\u5404\u4e2a\u9ad8\u6821\u90fd\u4f1a\u77e5\u9053\u81ea\u5df1\u7684\u6295\u6863\u7ebf\u662f\u591a\u5c11\uff0c\u53ef\u4ee5\u6295\u6863\u591a\u5c11\u4e2a\u5b66\u751f\uff0c\u4e5f\u4e0d\u6253\u7b97\u4fee\u6539\u53c2\u6570\u4e86\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u662f\u6b63\u5f0f\u7ed3\u679c\u3002</p> <p>\u6240\u4ee5\u6295\u6863\u7ebf\u5e76\u4e0d\u7b49\u4e8e\u5f55\u53d6\u7684\u6700\u540e\u4e00\u540d\u5b66\u751f\u7684\u5206\u6570\u7ebf\uff0c\u867d\u7136\u5f88\u591a\u65f6\u5019\u6070\u597d\u76f8\u7b49\u3002\u524d\u6587\u4e5f\u63d0\u5230\uff0c\u9000\u6863\u5728\u5e73\u884c\u5fd7\u613f\u7684\u6a21\u5f0f\u4e0b\uff0c\u662f\u4e00\u4e2a\u5bf9\u4e8e\u5b66\u751f\u6765\u8bf4\u5f88\u5403\u4e8f\u7684\u4e8b\u60c5\uff0c\u56e0\u6b64\u5b9e\u9645\u4e0a\u6295\u6863\u6bd4\u4f8b\u5927\u90e8\u5206\u65f6\u5019\u5c31\u662f 100%\u3002\u5177\u4f53\u64cd\u4f5c\u662f\uff0c\u5728\u6a21\u62df\u6295\u6863\u7684\u65f6\u5019\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u6295\u6863\u6bd4\u4f8b\u5927\u4e8e 100%\uff0c\u800c\u591a\u51fa\u6765\u7684\u90e8\u5206\u53c8\u4e0d\u4f1a\u5f55\u53d6\u8fdb\u6765\uff0c\u90a3\u5c31\u63d0\u9ad8\u6295\u6863\u7ebf\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u6295\u6863\u7684\u5b66\u751f\u90fd\u53ef\u4ee5\u5f55\u53d6\u3002\u4f46\u5982\u679c\u9047\u5230\u5206\u6570\u5728\u4e2d\u6e38\uff0c\u4e0d\u670d\u4ece\u4e13\u4e1a\u8c03\u5242\uff0c\u540c\u65f6\u65e0\u6cd5\u6ee1\u8db3\u4e13\u4e1a\uff0c\u6b64\u65f6\u53ef\u80fd\u4e5f\u4e0d\u5f97\u4e0d\u5148\u8c03\u6863\u518d\u9000\u6863\uff0c\u540c\u65f6\u6269\u5927\u6295\u6863\u6bd4\u4f8b\uff0c\u4fdd\u8bc1\u6709\u8db3\u591f\u8ba1\u5212\u6570\u7684\u8003\u751f\u53ef\u4ee5\u5f55\u53d6\u3002</p> <p>\u9ad8\u6821\u7684\u62db\u751f\u7ae0\u7a0b\u4f1a\u89c4\u5b9a\u8c03\u6863\u6bd4\u4f8b\u7684\u4e0a\u9650\uff0c\u5e38\u89c1\u7684\u662f 105%\uff0c\u4f46\u8fd9\u53ea\u662f\u4e0a\u9650\uff0c\u5b9e\u9645\u5927\u90e8\u5206\u90fd\u662f 100% \u7684\u6bd4\u4f8b\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c3d\u91cf\u51cf\u5c11\u9000\u6863\u7684\u60c5\u51b5\u53d1\u751f\u3002</p> <p>\u4ee5\u76ee\u524d\u7684\u8ba1\u7b97\u673a\u6027\u80fd\uff0c\u6295\u6863\u662f\u4e00\u4e2a\u5f88\u5feb\u7684\u4e8b\u60c5\uff0c\u51e0\u5206\u949f\u5c31\u53ef\u4ee5\u5b8c\u6210\uff0c\u6240\u4ee5\u6a21\u62df\u6295\u6863\u4e3b\u8981\u82b1\u7684\u65f6\u95f4\u8fd8\u662f\u5728\u9ad8\u6821\u4e00\u4fa7\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2023/08/06/college-admission/#\u6b63\u5f0f\u6295\u6863","title":"\u6b63\u5f0f\u6295\u6863","text":"<p>\u6b63\u5f0f\u6295\u6863\u65f6\uff0c\u4f1a\u6309\u7167\u524d\u8ff0\u5e73\u884c\u5fd7\u613f\u7684\u65b9\u5f0f\u8fdb\u884c\u6295\u6863\uff0c\u6bcf\u4e2a\u8003\u8bd5\u6295\u6863\u5230\u81f3\u591a\u4e00\u4e2a\u6295\u6863\u5355\u4f4d\uff0c\u4e5f\u5c31\u662f\u67d0\u9ad8\u6821\u7684\u67d0\u4e13\u4e1a\u7ec4\u3002\u9ad8\u6821\u8fdb\u884c\u9605\u6863\uff0c\u7136\u540e\u5bf9\u8be5\u8003\u8bd5\u8fdb\u884c\u4e13\u4e1a\u7684\u5206\u914d\uff0c\u9009\u62e9\u5f55\u53d6\u5230\u67d0\u4e2a\u4e13\u4e1a\uff0c\u6216\u8005\u9009\u62e9\u9000\u6863\u3002\u8fd9\u4e2a\u7ed3\u679c\u4f1a\u53cd\u9988\u5230\u7701\u8003\u8bd5\u9662\uff0c\u8003\u8bd5\u9662\u6309\u7167\u6559\u80b2\u516c\u5e73\u7684\u6807\u51c6\u8fdb\u884c\u5f55\u53d6\u68c0\u67e5\uff0c\u4f8b\u5982\uff1a</p> <ol> <li>\u9ad8\u5206\u8003\u751f\u4e13\u4e1a\u4f18\u5148</li> <li>\u9000\u6863\u9700\u7ed9\u51fa\u5fc5\u8981\u7406\u7531</li> </ol> <p>\u5176\u4e2d\u7b2c\u4e00\u70b9\u4fdd\u8bc1\u4e86\uff0c\u5982\u679c A \u6bd4 B \u5206\u9ad8\uff0c\u4e14\u90fd\u586b\u62a5\u4e86\u540c\u4e00\u4e2a\u4e13\u4e1a\uff0c\u90a3\u4e48 B \u80fd\u591f\u8fdb\u5165\u8fd9\u4e2a\u4e13\u4e1a\u7684\u524d\u63d0\u662f A \u4e5f\u80fd\u591f\u8fdb\u5165\u8fd9\u4e2a\u4e13\u4e1a\u3002\u5e76\u4e14\u8003\u751f\u7684\u4e13\u4e1a\u5f55\u53d6\u4e5f\u8981\u6309\u7167\u8003\u8bd5\u586b\u62a5\u7684\u4e13\u4e1a\u987a\u5e8f\u8fdb\u884c\u5339\u914d\u3002\u9ad8\u6821\u62db\u751f\u529e\u5fc5\u987b\u6309\u7167\u8fd9\u4e2a\u89c4\u5219\u8fdb\u884c\uff0c\u56e0\u6b64\u5176\u5b9e\u6240\u8c13\u7684\u4e13\u4e1a\u5206\u914d\uff0c\u4e5f\u5c31\u662f\u5728\u8ba1\u7b97\u673a\u4e0a\u8dd1\u4e00\u6bb5\u7c7b\u4f3c\u5e73\u884c\u5fd7\u613f\u7684\u7a0b\u5e8f\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u5206\u914d\u7684\u662f\u4e13\u4e1a\u3002</p> <p>\u8003\u8bd5\u9662\u53ef\u4ee5\u9009\u62e9\u5ba1\u6838\u901a\u8fc7\uff0c\u90a3\u4e48\u5f55\u53d6\u7684\u8003\u751f\u5c31\u5b8c\u6210\u4e86\u6574\u4e2a\u5f55\u53d6\u6d41\u7a0b\uff0c\u5f55\u53d6\u5230\u8be5\u9ad8\u6821\u7684\u8be5\u4e13\u4e1a\u3002\u5ba1\u6838\u4e0d\u901a\u8fc7\u65f6\uff0c\u9700\u8981\u9ad8\u6821\u62db\u751f\u529e\u91cd\u65b0\u5f55\u53d6\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2023/08/06/college-admission/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\u662f\u4e00\u4e2a\u5341\u5206\u4e25\u8c28\u7684\u8fc7\u7a0b\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u517c\u987e\u4e86\u516c\u5e73\u548c\u6548\u7387\uff1a</p> <ol> <li>\u516c\u5e73\uff1a\u6295\u6863\u548c\u5f55\u53d6\u90fd\u6309\u7167\u65e2\u5b9a\u7684\u89c4\u5219\u6267\u884c\uff0c\u7531\u8ba1\u7b97\u673a\u7a0b\u5e8f\u81ea\u52a8\u8ba1\u7b97\u7ed3\u679c\uff0c\u7ed3\u679c\u7531\u591a\u4f4d\u8001\u5e08\u8fdb\u884c\u5ba1\u6838</li> <li>\u6548\u7387\uff1a\u4e0d\u540c\u5206\u6570\u6bb5\u7684\u8003\u751f\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\uff0c\u4e0d\u540c\u9ad8\u6821\u4e4b\u95f4\u4e5f\u53ef\u4ee5\u540c\u65f6\u5e76\u884c\uff0c\u4ee3\u4ef7\u662f\u9000\u6863\u7684\u98ce\u9669\u8f83\u5927</li> </ol> <p>\u6574\u4e2a\u6d41\u7a0b\u4e2d\u5927\u90e8\u5206\u51b3\u7b56\u90fd\u662f\u8ba1\u7b97\u673a\u7a0b\u5e8f\u81ea\u52a8\u8fdb\u884c\u8ba1\u7b97\uff0c\u6709\u9650\u7684\u81ea\u7531\u5728\u6559\u80b2\u516c\u5e73\u7684\u524d\u63d0\u4e0b\u5b9e\u73b0\u3002</p>","tags":["gaokao","admission"]},{"location":"others/2016/08/02/dengshiyuan/","title":"\u7b49\u65f6\u5706","text":"<p>\u6700\u8fd1\u5b66\u6821\u8001\u5e08\u8bb2\u4e86\u4e00\u4e0b\u7b49\u65f6\u5706\u3002\u5148\u4ece\u8fd9\u4e2a\u9898\u8bb2\u8d77\uff1a</p> <p>\u5728\u540c\u4e00\u4e2a\u5730\u65b9\u5411\u4e0d\u540c\u503e\u89d2\u5149\u6ed1\u659c\u9762\u7528\u4e0d\u540c\u7684\u521d\u901f\u5ea6\u4e0a\u6ed1\uff0c\u5230\u8fbe\u6700\u9ad8\u70b9\u6240\u7528\u65f6\u95f4\u76f8\u7b49\uff0c\u6c42\u6700\u9ad8\u70b9\u7684\u8f68\u8ff9\u662f\u4ec0\u4e48\uff1f</p> <p>A. \u76f4\u7ebf B. \u692d\u5706 C. \u629b\u7269\u7ebf D. \u5706</p> <p>\u5f53\u65f6\u505a\u8fd9\u4e2a\u9898\u76ee\u7684\u7b2c\u4e00\u60f3\u6cd5\u662f\u628a x \u548c y \u5ea7\u6807\u8868\u793a\u51fa\u6765\uff1a</p> \\[ \\frac{1}{2}gsin\\theta{}t^2=l, y=lsin\\theta, x=ycot\\theta \\] <p>\u7136\u540e\u5c31\u50bb\u773c\u4e86\uff0c\u5e76\u5f97\u4e0d\u5230 x \u4e0e y \u7684\u5173\u7cfb\u5f0f\u3002\u5f53\u7136\u4e86\u53ef\u4ee5\u6c42\u51fa\u51e0\u4e2a\u70b9\uff0c\u5f3a\u884c\u5e26\u5165\u4e8c\u6b21\u66f2\u7ebf\u901a\u5f0f\u6c42\u89e3\u3002\u4e0d\u8fc7\u60f3\u4e86\u60f3\u8fd8\u662f\u7528\u89e3\u6790\u51e0\u4f55\u7684\u65b9\u6cd5\u53bb\u505a\u5427\uff1a</p> \\[ \\frac{1}{2}gsin\\theta{}t^2=\\sqrt{x^2+y^2}, sin\\theta=\\frac{y}{\\sqrt{x^2+y^2}} \\] <p>\u8fd9\u4e48\u4e00\u4ee3\u5165\uff0c\u663e\u7136\u662f\u5706\u3002\u4f46\u65e2\u7136\u8fd9\u662f\u7269\u7406\u9898\uff0c\u53ef\u4e0d\u53ef\u4ee5\u7528\u7269\u7406\u65b9\u6cd5\u505a\u5462\uff1f</p> <p>\u53ef\u4ee5\uff0c\u8fd9\u5c31\u662f\u7b49\u65f6\u5706\u3002</p> <p>\u5565\u53eb\u7b49\u65f6\u5706\uff1f</p> <p>\u7b49\u65f6\u5706\u5c31\u662f\uff0c\u5728\u4e00\u4e2a\u5149\u6ed1\u5706\u73af\u4e0a\u9009\u62e9\u4efb\u610f\u4e00\u70b9\uff0c\u8ba9\u4e00\u4e2a\u5c0f\u7403\u4ece\u8fd9\u4e2a\u70b9\u6cbf\u7740\u5149\u6ed1\u76f4\u6746\u5230\u5706\u7684\u6700\u4f4e\u70b9\uff0c\u65e0\u8bba\u8fd9\u4e2a\u70b9\u5728\u54ea\u91cc\uff08\u6700\u4f4e\u70b9\u4e0d\u7b97\u54c8\uff09\uff0c\u65f6\u95f4\u90fd\u662f\u4e00\u6837\u7684\u3002\u600e\u4e48\u8bc1\u660e\uff1f</p> <p>\u5f88\u7b80\u5355\uff1a\u8bbe\u5c0f\u7403\u4e0e\u6700\u4f4e\u70b9\u8fde\u7ebf\u4e0e\u6570\u503c\u65b9\u5411\u4e0a\u5939\u89d2\u4e3a\\(\\(\\theta\\)\\)\uff0c\u90a3\u4e48</p> \\[ s=2Rcos\\theta, \\frac{1}{2}gcos\\theta{}t^2=s \\] <p>\u4f60\u4f1a\u53d1\u73b0 t \u4e0e\\(\\(\\theta\\)\\)\u65e0\u5173\u3002\u8bc1\u660e\u5b8c\u6bd5\u3002</p> <p>\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5012\u8fc7\u6765\uff1a\u4ece\u5706\u7684\u6700\u9ad8\u70b9\u5f80\u5404\u4e2a\u65b9\u5411\u4e0b\u6ed1\uff0c\u5230\u8fbe\u5706\u5468\u65f6\u95f4\u76f8\u7b49\u3002</p> <p>\u597d\u4e86\uff0c\u5230\u6b64\u4e3a\u6b62\u5185\u5bb9\u90fd\u6ca1\u4ec0\u4e48\uff0c\u4f46\u4f60\u4f1a\u60f3\u95ee\u8fd9\u548c\u524d\u9762\u90a3\u9053\u9898\u76ee\u6709\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f\u8fd9\u600e\u4e48\u7b49\u65f6\u5706\uff1f\u91cd\u529b\u5f80\u4e0b\u8bf6\u3002\u8fd0\u52a8\u53ef\u662f\u5f80\u53f3\u4e0a\u65b9\u3002</p> <p>Here comes the black magic :)</p> <p>\u6211\u4eec\u8003\u8651\u5411\u4e0b\u6ed1\u5230\u6700\u4f4e\u70b9\u7684\u90a3\u4e2a\u7b49\u65f6\u5706\uff0c\u5728\u8fd9\u4e2a\u5706\u5468\u4e0a\u6ed1\u5012\u6700\u4f4e\u70b9\u7684\u65f6\u95f4\u90fd\u76f8\u7b49\u3002\u597d\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u56fe\u6cbf\u7740\u7ad6\u76f4\u65b9\u5411\u65cb\u8f6c 180 \u5ea6\u5f62\u6210\u4e00\u4e2a\u7403\uff0c\u60f3\u60f3\u8fd9\u4e2a\u7403\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u5230\u6700\u4f4e\u70b9\u65f6\u95f4\u662f\u4e0d\u662f\u4e5f\u4e00\u6837\uff1f\u90a3\u4e48\u8003\u8651\u9006\u8fc7\u7a0b\uff0c\u8ba9\u5c0f\u7403\u4ece\u659c\u9762\u4e0a\u6ed1\u4e0b\u6765\uff0c\u6211\u5bf9\u521a\u624d\u7684\u7403\u4f53\u518d\u7ad6\u7740\u5207\u4e00\u5200\uff0c\u5f97\u5230\u7684\u5e73\u9762\u4e0d\u5c31\u662f\u9898\u76ee\u4e2d\u90a3\u4e2a\u5417\uff1f\u5f97\u8bc1\u3002</p> <p>\u5f53\u7136\u4e86\u6700\u597d\u80fd\u6709\u52a8\u753b\u8bf4\u660e\uff0c\u9650\u4e8e\u672c\u4eba\u65f6\u95f4\u95ee\u9898\u6682\u65f6\u4e0d\u63d0\u4f9b ^_^</p>","tags":["physics"]},{"location":"others/2018/03/08/encountering-wu-wenhu/","title":"\u5076\u9047\u6e05\u534e\u5434\u6587\u864e\u6559\u6388","text":"<p>\u4eca\u5929\u767e\u56e2\u5927\u6218\uff0c\u6b63\u51c6\u5907\u6536\u644a\u7684\u65f6\u5019\uff0c\u5929\u7a7a\u5de5\u573a\u90a3\u8fb9\u6765\u4e86\u4e00\u4f4d\u957f\u8005\uff0c\u5728\u548c\u4ed6\u4eec\u804a\u7740\u4ec0\u4e48\u3002\u6211\u5f88\u611f\u5174\u8da3\uff0c\u5c31\u4e0a\u53bb\u542c\u3002\u8001\u4eba\u5927\u6982\u5df2\u6709\u516b\u5341\u9ad8\u9f84\uff08\u540e\u6765\u67e5\uff0c\u662f 1936 \u5e74\u751f\uff09\uff0c\u4f46\u4f9d\u7136\u7cbe\u795e\u77cd\u94c4\uff0c\u9996\u5148\u548c\u6211\u4eec\u8bb2\uff0c\u4f5c\u4e3a\u5de5\u79d1\u7684\u5b66\u751f\uff0c\u4e00\u5b9a\u5728\u7406\u89e3\u539f\u7406\u7684\u57fa\u7840\u4e0a\uff0c\u591a\u591a\u53bb\u5b9e\u8df5\u3002\u4ed6\u4e3e\u4e86\u4ed6\u81ea\u5df1\u7684\u4f8b\u5b50\uff0c\u4ed6\u9996\u5148\u5728\u7535\u673a\u7cfb\u5b66\u4e60\uff0c\u540e\u6765\uff0c\u8ba1\u7b97\u673a\u7cfb\u6210\u7acb\uff08\u5f53\u65f6\u8fd8\u662f\u81ea\u52a8\u63a7\u5236\u7cfb\uff09\uff0c\u4ed6\u8f6c\u5230\u4e86\u8ba1\u7b97\u673a\u7cfb\uff0c\u91cd\u65b0\u5b66\u8d77\u4e86\u8ba1\u7b97\u673a\uff0c\u8bf4\u8ba1\u7b97\u673a\u7f16\u7a0b\u5b66\u8d77\u6765\u5e76\u6ca1\u6709\u4ec0\u4e48\u96be\u7684\u3002\u5f53\u5e74\uff0c\u82f9\u679c\u516c\u53f8\u9001\u8fc7\u6765\u4e86\u4e2d\u56fd\u7b2c\u4e00\u53f0 Apple-2\uff0c\u4ed6\u4eec\u5c31\u628a\u7535\u8111\u62c6\u4e86\u4e0b\u6765\u7814\u7a76\u539f\u7406\uff0c\u53c8\u88c5\u4e0a\u53bb\u7ee7\u7eed\u5de5\u4f5c\u3002\u540e\u6765\uff0c\u4ed6\u5c31\u5728\u8ba1\u7b97\u673a\u7cfb\u4efb\u6559\uff0c\u6559\u7684\u6b63\u662f\u300a\u7a0b\u5e8f\u8bbe\u8ba1\u57fa\u7840\u300b\u8fd9\u95e8\u8bfe\u7a0b\u3002\u4ed6\u5341\u5206\u91cd\u89c6\u5b9e\u8df5\uff0c\u5728\u7b2c\u4e00\u5e74\u5f00\u8bfe\u7684\u65f6\u5019\u5c31\u8bf4\uff0c\u6700\u5173\u952e\u7684\u5c31\u662f\u5b9e\u8df5\uff0c\u5b89\u6392\u4e86\u4e00\u4e9b\u7f16\u7a0b\u5b9e\u9a8c\u8bfe\uff0c\u671f\u4e2d\u671f\u672b\u5c31\u662f\u5927\u4f5c\u4e1a\u3002\u4e00\u5f00\u59cb\u6709\u4e00\u4e9b\u540c\u5b66\u4e0d\u91cd\u89c6\u5b9e\u8df5\uff0c\u7ed3\u679c\u671f\u672b\u5c31\u6302\u79d1\u4e86\u3002\u540e\u6765\u540c\u5b66\u4eec\u5c31\u660e\u767d\u4e86\u5b9e\u8df5\u7684\u91cd\u8981\u6027\uff0c\u5b9e\u8df5\u8d77\u6765\u53d1\u73b0\u5e76\u6ca1\u6709\u90a3\u4e48\u96be\uff0c\u6700\u540e\u5c31\u8bf4\uff0c\u201c\u5434\u8001\u5e08\uff0c\u4f60\u8bf4\u5f97\u5bf9\u201d\u3002\u4ed6\u53c8\u8c08\u5230\u4e86\u4ed6\u7684\u4f53\u80b2\uff0c\u4ed6\u5f53\u5e74\u662f\u5317\u4eac\u957f\u8dd1\u4ee3\u8868\u961f\u7684\u96c6\u8bad\u961f\u9009\u624b\uff0c\u64c5\u957f\u4e00\u5343\u4e94\u767e\u7c73\u9879\u76ee\uff0c\u4ed6\u4e09\u5343\u7c73\u53ea\u9700\u8981\u4e5d\u5206\u949f\u5c31\u80fd\u8dd1\u5b8c\u3002\u6211\u4eec\u90fd\u611f\u5230\u81ea\u6127\u4e0d\u5982\u3002\u6211\u4eec\u8bf4\uff0c\u73b0\u5728\u7684\u300a\u7a0b\u5e8f\u8bbe\u8ba1\u57fa\u7840\u300b\u662f\u5f90\u660e\u661f\u8001\u5e08\u5728\u6559\uff0c\u4ed6\u8bf4\u5f90\u660e\u661f\u662f\u4ed6\u7684\u535a\u58eb\u751f\uff0c\u90ac\u6653\u94a7\u4e5f\u662f\u4ed6\u7684\u535a\u58eb\u751f\uff0c\u4ed6\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u9ad8\u5f92\u6211\u8bb0\u4e0d\u6e05\u695a\u4e86\u3002\u4ed6\u8fd8\u662f IOI \u4e2d\u56fd\u961f\u7684\u524d\u6559\u7ec3\uff0c\u542c\u5230\u6211\u4eec\u6709\u8fc7\u4e00\u4e9b OI \u57fa\u7840\uff0c\u8868\u793a\u4e86\u8d5e\u8bb8\u548c\u9f13\u52b1\u3002\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u8bb0\u4e0d\u6e05\u695a\u4e86\uff0c\u8bb0\u8d77\u6765\u4e86\u518d\u8865\u5145\u5427\u3002</p>","tags":["wuwenhu"]},{"location":"others/2023/08/01/lk99/","title":"LK-99 \u76f8\u5173\u94fe\u63a5","text":"<p>\u6536\u5f55\u81ea\u5df1\u627e\u5230\u7684\u4e00\u4e9b\u548c LK-99 \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u975e\u4e13\u4e1a\u4eba\u58eb\uff0c\u770b\u4e2a\u70ed\u95f9\u3002</p>","tags":["lk99"]},{"location":"others/2023/08/01/lk99/#\u8bba\u6587","title":"\u8bba\u6587","text":"<ul> <li>The First Room-Temperature Ambient-Pressure Superconductor\uff1a\u4f5c\u8005\u8bba\u6587 #1</li> <li>Superconductor Pb10\u2212xCux(PO4)6O showing levitation at room temperature and atmospheric pressure and mechanism v1\uff1a\u4f5c\u8005\u8bba\u6587 #2 v1</li> <li>Superconductor Pb10\u2212xCux(PO4)6O showing levitation at room temperature and atmospheric pressure and mechanism v2\uff1a\u4f5c\u8005\u8bba\u6587 #2 v2</li> <li>Superconductor Pb10\u2212xCux(PO4)6O showing levitation at room temperature and atmospheric pressure and mechanism v3\uff1a\u4f5c\u8005\u8bba\u6587 #2 v3</li> <li>Consideration for the development of room-temperature ambient-pressure superconductor (LK-99)\uff1a\u4f5c\u8005\u8bba\u6587 #3</li> <li>First-principles study on the electronic structure of Pb10\u2212xCux(PO4)6O (x=0, 1)\uff1a\u7406\u8bba</li> <li>Synthesis of possible room temperature superconductor LK-99:Pb9Cu(PO4)6O\uff1a\u590d\u73b0\uff0c\u5370\u5ea6</li> <li>Semiconducting transport in Pb10-xCux(PO4)6O sintered from Pb2SO5 and Cu3P\uff1a\u590d\u73b0\uff0c\u5317\u822a\uff0c\u6ca1\u6709\u60ac\u6d6e</li> <li>Origin of correlated isolated flat bands in copper-substituted lead phosphate apatite\uff1a\u7406\u8bba</li> <li>Electronic structure of the putative room-temperature superconductor Pb9Cu(PO4)6O\uff1a\u7406\u8bba</li> <li>Pb-apatite framework as a generator of novel flat-band CuO based physics, including possible room temperature superconductivity\uff1a\u7406\u8bba</li> <li>Theoretical insight on the LK-99 material\uff1a\u7406\u8bba</li> <li>Observation of zero resistance above 100\u2218 K in Pb10\u2212xCux(PO4)6O\uff1a\u590d\u73b0\uff0c\u4e1c\u5357\u5927\u5b66</li> <li>Broad Band Mott Localization is all you need for Hot Superconductivity: Atom Mott Insulator Theory for Cu-Pb Apatite\uff1a\u7406\u8bba</li> <li>Minimal model for the flat bands in copper-substituted lead phosphate apatite\uff1a\u7406\u8bba</li> <li>Successful growth and room temperature ambient-pressure magnetic levitation of LK-99\uff1a\u590d\u73b0\uff0c\u534e\u79d1</li> <li>Some remarks on possible superconductivity of composition Pb9CuP6O25</li> <li>S-wave pairing in a two-orbital t-J model on triangular lattice: possible application to Pb10\u2212xCux(PO4)6O</li> <li>Ferromagnetic half levitation of LK-99-like synthetic samples\uff1a\u590d\u73b0\uff0c\u5317\u5927</li> <li>The Cu induced ultraflat band in the room-temperature superconductor Pb10\u2212xCux(PO4)6O4 (x=0,0.5)</li> <li>Absence of superconductivity in LK-99 at ambient conditions</li> <li>Synthesis and characterisation of LK-99</li> <li>Electronic correlations in promising room-temperature superconductor Pb9Cu(PO4)6O: a DFT+DMFT study</li> <li>First order transition in Pb10\u2212xCux(PO4)6O (0.9&lt;x&lt;1.1) containing Cu2S</li> <li>{Pb10\u2212xCux(PO4)6O: a Mott or charge transfer insulator \\in need of further doping for (super)conductivity</li> <li>The 2023 Development of Room-Temperature Ambient-Pressure Superconductor: Vision and Future Trend of Power Systems</li> <li>The crystal structure of Pb10(PO4)6O revisited: the evidence of superstructure</li> <li>Correlated electronic structure of Pb10\u2212xCux(PO4)6O</li> <li>Observation of abnormal resistance-temperature behavior along with diamagnetic transition in Pb10\u2212xCux(PO4)6O-based composite</li> <li>Berry curvature and quantum metric in copper-substituted lead phosphate apatite</li> <li>Ferromagnetic ground state and Spin-orbit coupling induced bandgap open in LK99</li> <li>Pb9Cu(PO4)6(OH)2: Phonon bands, Localized Flat Band Magnetism, Models, and Chemical Analysis</li> <li>Phase transition of copper (I) sulfide and its implication for purported superconductivity of LK-99</li> <li>Wannier functions, minimal model and charge transfer in Pb9CuP6O25</li> <li>First-principles calculation on the electronic structures, phonon dynamics, and electrical conductivities of Pb10(PO4)6O and Pb9Cu(PO4)6O compounds</li> <li>On the synthesis methodologies to prepare Pb9Cu(PO4)6O -- phase, composition, magnetic analysis and absence of superconductivity</li> <li>Single crystal synthesis, structure, and magnetism of Pb10\u2212xCux(PO4)6O</li> <li>On the Experimental Evidence for Possible Superconductivity in LK99</li> <li>Entertaining the Possibility of RT Superconductivity in LK-99</li> <li>No superconductivity in Pb9Cu1(PO4)6O found in orbital and spin fluctuation exchange calculations</li> <li>Cu-doped Pb10(PO4)6O, and V doped SrTiO3 -- a tutorial on electron-crystal lattice coupling in insulating materials with transition metal dopants</li> <li>Cu-substituted lead phosphate apatite as an inversion-asymmetric Weyl semimetal</li> <li>Phases and magnetism at microscale in compounds containing nominal Pb10\u2212xCux(PO4)6O</li> <li>Phase Stability of Lead Phosphate Apatite Pb10\u2212xCux(PO4)6O, Pb10\u2212xCux(PO4)6(OH)2, and Pb8Cu2(PO4)6</li> <li>Different phase leads to different transport behavior in Pb9Cu(PO4)6O compounds</li> <li>Comment on \"Origin of correlated isolated flat bands in copper-substituted lead phosphate apatite\"</li> </ul>","tags":["lk99"]},{"location":"others/2023/08/01/lk99/#\u89c6\u9891","title":"\u89c6\u9891","text":"<ul> <li>LK-99 \u9a8c\u8bc1 \u5173\u5c71\u53e3\u7537\u5b50\u6280\u5e08</li> <li>\u8865\u5145\u89c6\u9891 \u5173\u5c71\u53e3\u7537\u5b50\u6280\u5e08</li> <li>\u5ba4\u6e29\u8d85\u5bfc\u590d\u73b0\u5b9e\u9a8c - \u5168\u6d41\u7a0b \u79d1\u5b66\u8c03\u67e5\u5c40</li> <li>LK99\uff0c110K \u96f6\u7535\u963b\u89c2\u6d4b\u6210\u529f \u79d1\u5b66\u8c03\u67e5\u5c40</li> <li>\u534a\u5bfc\u4f53\u4e0e\u7269\u7406</li> <li>LK-99 \u5ba4\u6e29\u8d85\u5bfc\u6750\u6599\u9a8c\u8bc1 \u70bc\u4e39\u5e08\u963f\u7fd4</li> </ul>","tags":["lk99"]},{"location":"others/2017/10/16/review-on-yesterdays-jiujing-adi-contest/","title":"\u56de\u987e\u6628\u5929\u7684\u9152\u4e95\u77e5\u8bc6\u7ade\u8d5b","text":"<p>\u6628\u5929\u665a\u4e0a\uff0c\u6211\u4f5c\u4e3a\u849f\u84bb\u7ec4\u7684\u4e00\u5458\u5728\u4e09\u6559 2102 \u53c2\u52a0\u4e86\u9152\u4e95\u77e5\u8bc6\u7ade\u8d5b\uff0c\u5e76\u56e0\u6b64\u9e3d\u6389\u4e86 TUNA \u548c Lab mU \u7684\u8fce\u65b0\u4f1a hhh\uff0c\u4e0d\u8fc7\u8fd0\u6c14\u597d\u62ff\u5230\u4e86\u4e8c\u7b49\u5956\u7684\u597d\u6210\u7ee9\uff0c\u83b7\u5f97 Paperang \u4fbf\u643a\u6253\u5370\u673a\u4e00\u53f0\u3002\u4e2d\u95f4\u9047\u5230\u4e86\u597d\u4e00\u4e9b\u7f51\u7edc\u65b9\u9762\u7684\u77e5\u8bc6\uff0c\u8fd9\u5bf9\u4e8e\u6ca1\u6709\u8bb0\u5fc6 OSI \u6a21\u578b\u7684\u6211\u65e0\u7591\u6709\u5de8\u5927\u7684\u96be\u5ea6\u3002\u4e0b\u9762\u662f\u51e0\u9053\u6bd4\u8f83\u6709\u5370\u8c61\u7684\u9898\u76ee\uff1a</p> <ol> <li>\u4ee5\u4e0b\u54ea\u4e2a\u4e0d\u662f\u7f16\u7a0b\u8bed\u8a00\uff1f    A. J B. L C. R D. K    \u8fd9\u9898\u4e0d\u96be\uff0cR \u80af\u5b9a\u5bf9\uff0cJ \u89c1\u8fc7\uff0cK \u7565\u5fae\u6709\u5370\u8c61\uff0c\u9009 B  </li> <li>IPv6 \u94fe\u8def\u5c42\u5730\u5740\u89e3\u6790\u7684\u534f\u8bae\u662f\uff1f    A. ARP B. Neighbour Solicitation C. Neighbour Advertisement D. Neighbour Discovery    \u5bf9\u4e8e\u4e00\u4e2a\u6ca1\u7814\u7a76\u8fc7 IPv6 \u7684\u4eba\u6765\u8bf4\u8fd9\u53ea\u597d\u8499\u4e86\u3002\u3002\u3002ARP \u662f IPv4 \u65f6\u4ee3\u7684\uff0cND(Neighbour Discovery \u5219\u662f IPv6 \u65f6\u4ee3\u7684\u65b0\u4ea7\u7269\uff0c\u628a ARP \u548c ICMP \u7b49\u534f\u8bae\u7684\u529f\u80fd\u90fd\u5305\u542b\u4e86\u8fdb\u6765\uff0c\u5e76\u4e14\u6709\u65b0\u7684\u529f\u80fd\u3002\u4e4b\u524d\u6837\u9898\u91cc\u8fd8\u51fa\u73b0\u8fc7\u95ee IPv6 \u4e2d\u53bb\u6389\u4e86 Unicast,Anycast,Multicast,Broadcast \u4e2d\u7684\u54ea\u79cd\uff0c\u7b54\u6848\u662f Broadcast\u3002</li> <li>\u7b2c\u4e00\u4e2a\u628a\u7a0b\u5e8f\u9519\u8bef\u79f0\u505a bug \u7684\u662f\uff1f     \u9009\u9879\u592a\u591a\u5fd8\u4e86\uff0c\u7b54\u6848\u662f Grace Hopper\uff0c\u56e0\u4e3a\u5f53\u65f6\u4e00\u53ea\u98de\u86fe\u610f\u5916\u98de\u5165\u4e86\u673a\u5668\u5bfc\u81f4\u4e86\u6545\u969c\uff0c\u540e\u6765\u6162\u6162\u5c31\u6d41\u4f20\u4e0b\u6765\u4e86\u3002</li> <li>\u4ee5\u4e0b\u4e0d\u662f\u7f51\u7edc\u64cd\u4f5c\u7cfb\u7edf\u7684\u662f\uff1f     A. Windows NT B. OS/2 warp C. DOS D. Netware     \u5f53\u65f6\u6211\u6ca1\u89c1\u8fc7 D\uff0c\u4e8e\u662f\u5c31\u9009\u4e86\u3002\u3002\u3002\u7136\u540e\u5c31\u6302\u4e86\uff0cNetware \u662f Novell \u5f00\u53d1\u7684\u7cfb\u7edf\uff0cOS/2 warp \u5f53\u7136\u662f\u5386\u53f2\u60a0\u4e45\u7684\u7cfb\u7edf\u5566\uff0c\u800c DOS=Disk Operating System \u6240\u4ee5\u6ca1\u6709\u201c\u7f51\u7edc\u201d\u4e8c\u5b57\u3002\u3002\u3002\u6655\u5012</li> <li>\u4ee5\u4e0b\u662f\u7528\u4f5c\u5c40\u57df\u7f51\u7684\u534f\u8bae\u662f\uff1f     A. TCP/IP B. IPX/SPX C. NetBEUI D. RS-232-C     TCP/IP \u5f53\u7136\u4e0d\u4ec5\u9650\u4e8e\u5c40\u57df\u7f51\uff0cRS-232-C \u662f\u63a5\u53e3\uff0c\u5f53\u65f6\u8499\u4e86 B \u7ed3\u679c\u5c31\u5bf9\u4e86\uff0c\u767d\u767d\u62ff\u4e86 50 \u5206\u54c8\u54c8\u54c8\u3002IPX/SPX \u662f Novell \u8bbe\u8ba1\u7528\u5728 Netware \u7cfb\u7edf\u4e0a\u7684\u5c40\u57df\u7f51\u534f\u8bae\uff0cNetBEUI \u5219\u662f NetBIOS \u7684\u4e00\u4e2a\u5386\u53f2\u9057\u7559\u7684\u4e00\u4e2a\u201c\u522b\u79f0\u201d\u3002</li> <li>\u59da\u671f\u667a\u7684\u592b\u4eba\u7ed9\u8c01\u53d6\u4e86\u4e2d\u6587\u540d\uff1f     \u5f53\u7136\u662f Donald Ervin Knuth \u5566\uff01\u9ad8\u5fb7\u7eb3\u4e07\u5c81\uff01</li> </ol>","tags":["adi","tsinghua","cs"]},{"location":"others/2016/02/21/start-next-term-tomorrow/","title":"Start next term tomorrow","text":"<p>My term starts tomorrow. Sad. Homework haven't finished. I went to Guangzhou for GDKOI thie weekend, and i haven't known the result. It should be bad. I have no confidence at all. I may write less when this term starts. The second term of Senior 2 should a hard time for me. That's all. Sorry for the laziness.</p>","tags":["school","gdkoi","homework"]},{"location":"others/2017/10/30/use-cpuid-to-get-machine-cpu/","title":"\u7528 CPUID \u83b7\u53d6\u8bc4\u6d4b\u673a\u5668\u7684 CPU","text":"<p>\u53d7\u7528 CPUID \u68c0\u6d4b\u5404\u5927 OJ \u6d4b\u8bc4\u673a\u6240\u7528\u7684 CPU\uff08\u4ee5\u53ca\u65e5\u5e38\u9ed1 BZOJ\uff09\u7684\u542f\u53d1\uff0c\u6211\u51b3\u5b9a\u53bb\u6d4b\u8bd5\u4e00\u4e0b\u5f90\u8001\u5e08\u81ea\u5df1\u5199\u7684 OJ\uff08\u540d\u4e3a Tyche\uff09\u6240\u8dd1\u7684\u673a\u5668\u662f\u4ec0\u4e48 CPU\u3002\u4e8e\u662f\u6211\u6539\u9020\u4e00\u4e0b\u4ee3\u7801\uff0c\u7528\u4ee5\u4e0b\u4ee3\u7801\u6d4b\u8bc4\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;iostream&gt;\n#include &lt;time.h&gt;\n#include &lt;cpuid.h&gt;\n#include &lt;sys/time.h&gt;\nstatic void cpuid(uint32_t func, uint32_t sub, uint32_t data[4]) {\n    __cpuid_count(func, sub, data[0], data[1], data[2], data[3]);\n}\nint main() {\n    uint32_t data[4];\n    char str[48];\n    for(int i = 0; i &lt; 3; ++i) {\n        cpuid(0x80000002 + i, 0, data);\n        for(int j = 0; j &lt; 4; ++j)\n            reinterpret_cast&lt;uint32_t*&gt;(str)[i * 4 + j] = data[j];\n    }\n\n    struct timeval stop, start;\n    gettimeofday(&amp;start, NULL);\n    while(1) {\n        gettimeofday(&amp;stop, NULL);\n        if(stop.tv_usec - start.tv_usec &gt; (str[##EDITME##] - 32) * 10000)\n            break;\n    }\n}\n</code></pre> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c<code>usleep()</code>\u548c<code>clock()</code>\u90fd\u88ab\u5c01\u6740\uff0c\u4f46\u662f<code>gettimeofday()</code>\u5b58\u6d3b\u4e86\u4e0b\u6765\u3002\u7136\u540e\u6211\u5c31\u4e0d\u65ad\u5730<code>C-a</code>\u4e0a\u9762\u7684<code>###EDITME###</code>\uff0c\u6839\u636e\u8bc4\u6d4b\u51fa\u6765\u7684\u65f6\u95f4\u63a8\u7b97\u51fa\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5f97\u5230\u4ee5\u4e0b\u7ed3\u679c\uff1a</p> <pre><code>0 ~ 7 : PADDING\n8 73 I\n9 110 n\n10 116 t\n11 101 e\n12 108 l\n13 40 (\n14 82 R\n15 41 )\n16 32 SPC\n17 67 C\n18 111 o\n19 114 r\n20 101 e\n21 40 (\n22 84 T\n23 77 M\n24 41 )\n25 32 SPC\n26 105 i\n27 51 3\n28 45 -\n29 50 2\n30 49 1\n31 50 2\n32 48 0\n33 32 SPC\n34 67 C\n35 80 P\n36 85 U\n37 32 SPC\n38 64 @\n39 32 SPC\n40 51 3\n41 46 .\n42 51 3\n43 48 0\n44 71 G\n45 72 H\n46 122 z\n</code></pre> <p>\u8fde\u8d77\u6765\u5c31\u662f\u8fd9\u4e2a CPU\uff1a</p> <pre><code>Intel(R) Core(TM) i3-2120 CPU @ 3.30GHz\n</code></pre> <p>\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u8fd8\u662f\u6bd4 BZOJ \u597d\u54c8\u54c8\u54c8\uff08\u53c8\u9ed1 BZOJ\uff09\u3002\u540e\u6765\u6709\u5927\u795e\u5728\u7fa4\u91cc\u5efa\u8bae\uff0c\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u6bd4\u8f83\u7684\u65b9\u5f0f\uff0c\u5bf9\u4e86\u5c31\u8ba9\u9898\u76ee AC\uff0c\u4e0d\u5bf9\u5c31 WA\u3002\u8fd9\u4e2a\u65b9\u6cd5\u66f4\u52a0\u9002\u5408\u624b\u91cc\u5df2\u7ecf\u77e5\u9053\u4e86\u4e00\u4e9b\u5e38\u89c1 CPUID \u7684\u8fd4\u56de\u5b57\u7b26\u4e32\uff0c\u8fd9\u91cc\u5c31\u662f\u8fd9\u6837\u3002</p>","tags":["tyche","oj","cpu","cpuid"]},{"location":"programming/2016/07/23/a-good-way-to-show-git-diff-for-compressed-files/","title":"A good way to show git diff for compressed files","text":"<p>I have found a good way to track changes in .gz files: Add these to ~/.gitconfig:</p> <pre><code>[core]\n  attributesFile = ~/.gitattributes\n[diff \"zip\"]\n  textconv = unzip -p\n  binary = true\n[diff \"gz\"]\n  textconv = gzcat\n  binary = true\n[diff \"bz2\"]\n  textconv = bzcat\n  binary = true\n[diff \"xz\"]\n  textconv = xzcat\n  binary = true\n[diff \"tar\"]\n  textconv = tar -O -xf\n  binary = true\n[diff \"tar-bz2\"]\n  textconv = tar -O -xjf\n  binary = true\n[diff \"tar-gz\"]\n  textconv = tar -O -xzf\n  binary = true\n[diff \"tar-xz\"]\n  textconv = tar -O -xJf\n  binary = true\n\n[diff \"odf\"]\n  textconv = odt2txt\n[diff \"pdf\"]\n  textconv = pdfinfo\n[diff \"bin\"]\n  textconv = hexdump -v -C\n</code></pre> <p>And these to ~/.gitattributes:</p> <pre><code>*.tar diff=tar\n*.tar.bz2 diff=tar-bz2\n*.tar.gz diff=tar-gz\n*.tar.xz diff=tar-xz\n*.bz2 diff=bz2\n*.gz diff=gz\n*.zip diff=zip\n*.xz diff=xz\n\n*.odf diff=odf\n*.odt diff=odf\n*.odp diff=odf\n*.pdf diff=pdf\n*.exe diff=bin\n*.png diff=bin\n*.jpg diff=bin\n</code></pre> <p>And then you can <code>git diff</code> for .gz files.</p> <p>Codes are adapted from https://gist.github.com/RsrchBoy/11197048 and https://git.wiki.kernel.org/index.php/GitTips#Getting_a_plain-text_diff and https://gist.github.com/kbaird/2654115.</p>","tags":["git","compression"]},{"location":"programming/2020/09/13/aarch64-rust-analyzer/","title":"\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer","text":"<p>\u8fdc\u7a0b\u5230 arm64 \u7684\u673a\u5668\u4e0a\u8fdb\u884c\u5f00\u53d1\uff0c\u53d1\u73b0\u6ca1\u6709 rust-analyzer \u7684\u652f\u6301\u3002\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u5728 rustup \u91cc\u9762\u53ef\u4ee5\u627e\u5230\uff0c\u4e0d\u8fc7\u8981\u914d\u7f6e\u4e00\u4e0b\uff1a</p> <pre><code>&gt; rustup toolchain add nightly\n&gt; rustup component add --toolchain nightly rust-analyzer-preview\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u5e94\u8be5\u53ef\u4ee5\u627e\u5230 <code>~/.rustup/toolchains/nightly-aarch64-unknown-linux-gnu/bin/rust-analyzer</code> \u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\uff0c\u914d\u7f6e VSCode \u63d2\u4ef6\u5373\u53ef\uff1a</p> <pre><code>{\n    \"rust-analyzer.serverPath\": \"~/.rustup/toolchains/nightly-aarch64-unknown-linux-gnu/bin/rust-analyzer\"\n}\n</code></pre> <p>\u8def\u5f84\u5728 <code>~/.vscode-server/data/Machine/settings.json</code>\u3002</p> <p>\u53c2\u8003\uff1ahttps://github.com/rust-analyzer/rust-analyzer/issues/5256</p>","tags":["rust","rust-analyzer","arm","arm64","aarch64"]},{"location":"programming/2018/09/13/adb-over-ssh-tunnel/","title":"\u901a\u8fc7 SSH \u96a7\u9053\u8fde\u63a5 ADB \u548c Android \u8bbe\u5907","text":"<p>\u7531\u4e8e\u672c\u673a\u7b97\u529b\u4e0d\u8db3\uff0c\u60f3\u8981\u5728\u8fdc\u7a0b\u7f16\u8bd1 LineageOS \uff0c\u5176\u4e2d\u6709\u4e00\u6b65\u9700\u8981\u8fde\u63a5\u5230\u5df2\u6709\u7684\u8bbe\u5907\uff0c\u4e8e\u662f\u7a81\u53d1\u5947\u60f3\uff1a</p> <ol> <li>adb \u53ef\u4ee5\u901a\u8fc7 \u7f51\u7edc\u8fde\u63a5</li> <li>ssh \u53ef\u4ee5\u8fdb\u884c\u7aef\u53e3\u8f6c\u53d1\uff0c\u8fd9\u91cc\u662f\u628a remote \u7684\u7aef\u53e3\u8f6c\u53d1\u5230 Android \u8bbe\u5907\u4e0a\u7684\u7aef\u53e3\u3002</li> </ol> <p>\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ adb shell ip -f inet addr show wlan0\n$ # remember the ip address here\n$ adb tcpip PORT1\n$ ssh -R PORT2:ANDROID_IP:PORT1 REMOTE\n(remote)$ adb connect localhost:PORT2 # trust this device on Android\n</code></pre> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>How can I connect to Android with ADB over TCP?</li> <li>SSH PORT FORWARDING EXAMPLE</li> </ol>","tags":["ssh","adb","forwarding"]},{"location":"programming/2017/10/17/analysis-on-a-primality-test/","title":"\u5206\u6790\u4e00\u4e2a\u6211\u7b2c\u4e00\u6b21\u89c1\u7684\u7d20\u6570\u6d4b\u8bd5\u51fd\u6570","text":"<p>\u4eca\u5929\u901b\u5230\u8fd9\u4e2a\u8fde\u63a5\uff0c\u53d1\u73b0\u5176\u4e2d\u7684\u7b2c\u56db\u79cd\u7d20\u6570\u5224\u5b9a\u65b9\u6cd5\u5f88\u6709\u610f\u601d\uff1a</p> <pre><code>#include&lt;stdio.h&gt;\n#include&lt;math.h&gt;\nint p[8]={4,2,4,2,4,6,2,6};\nint prime(int n)\n{\n    int i=7,j,q;\n    if(n==1)return 0;\n    if(n==2||n==5||n==3)return 1;\n    if(n%2==0||n%3==0||n%5==0)return 0;\n    q=(int)sqrt(n);\n    for(;i&lt;=q;){\n        for(j=0;j&lt;8;j++){\n            if(n%i==0)return 0;\n            i+=p[j];\n        }\n        if(n%i==0)return 0;\n    }\n    return 1;\n}\nvoid main()\n{\n    int n;\n    scanf(\"%d\",&amp;n);\n    if(prime(n))puts(\"Yes\");\n    else puts(\"No\");\n}\n</code></pre> <p>\u4ed4\u7ec6\u7814\u7a76\u53d1\u73b0\uff0c\u8fd9\u91cc\u5229\u7528\u7684\u662f\u8fd9\u6837\u7684\u539f\u7406\uff1a</p> <ol> <li>\u5224\u65ad\u662f\u4e0d\u662f 1, 2, 3, 5 \u53ca\u5176\u500d\u6570</li> <li>\u4ece 7 \u5f00\u59cb\uff0c\u4e0d\u65ad\u8003\u8651\u5176\u662f\u5426\u662f\u7d20\u6570\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a p \u662f\u4ec0\u4e48\u56de\u4e8b\u5462\uff1f</li> </ol> <p>\u9996\u5148\u628a p \u7684\u5404\u4e2a\u5143\u7d20\u52a0\u8d77\u6765\uff0c\u548c\u4e3a 30\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u89c4\u5f8b\uff1a 7 \u4e3a\u8d28\u6570\uff0c7+2=9 \u4e0d\u662f\u8d28\u6570\uff0c7+4=11 \u4e3a\u8d28\u6570\uff0c11+2=13 \u4e3a\u8d28\u6570\uff0c13+2=15 \u4e3a\u5408\u6570\uff0c15+2=17 \u4e3a\u8d28\u6570\uff0c17+2=19 \u4e3a\u8d28\u6570\uff0c19+2=21 \u4e3a\u5408\u6570\uff0c21+2=23 \u4e3a\u8d28\u6570\uff0c23+2=25 \u4e3a\u5408\u6570\uff0c25+2=27 \u4e3a\u5408\u6570\uff0c27+2=29 \u4e3a\u8d28\u6570\uff0c29+1=31 \u4e3a\u8d28\u6570\uff0c31+2=33 \u4e3a\u5408\u6570\uff0c33+2=35 \u4e3a\u5408\u6570\uff0c35+2=37 \u4e3a\u8d28\u6570\u3002 \u89c2\u5bdf\u4ee5\u4e0a\u6240\u6709\u7684\u5408\u6570\uff0c\u90fd\u542b\u6709 2 \u6216\u8005 3 \u6216\u8005 5 \u7684\u56e0\u5b50\uff0c\u800c 30 \u53c8\u662f 2,3,5 \u7684\u516c\u500d\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u540e\u9762\u7684\u7d20\u6570\u6a21 30 \u7684\u4f59\u6570\u4e0d\u53ef\u80fd\u662f\u4e0a\u9762\u8fd9\u4e9b\u5408\u6570\uff0c\u800c\u5269\u4e0b\u7684\u7d20\u6570\u624d\u53ef\u80fd\u662f\u771f\u6b63\u7684\u7d20\u6570\uff0c\u4e8e\u662f\u8df3\u8fc7\u4e86\u5f88\u591a\u7d20\u6570\u7684\u5224\u65ad\u3002</p> <p>\u81f3\u4e8e\u8fd9\u4e2a\u51fd\u6570\u7684\u6027\u80fd\u5982\u4f55\uff0c\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u6d4b\u8bd5\u6765\u8fdb\u884c\u5224\u65ad\u3002</p>","tags":["cs","prime","algorithm"]},{"location":"programming/2018/03/07/breaking-c-weak-access-control/","title":"\u3016\u65b0\u624b\u5411\u3017\u7ed5\u8fc7 C++ \u7c7b\u7684\u8bbf\u95ee\u9650\u5236","text":"<p>\u8fd9\u662f\u4e00\u7bc7\u5f88\u6c34\u7684\u6587\u7ae0\uff0c\u9762\u5411\u840c\u65b0\uff0c\u5df2\u7ecf\u77e5\u9053\u4e86\u7684\u53ef\u4ee5\u81ea\u89c9\u7ed5\u9053\u3002</p> <p>\u6628\u5929\u4e0a\u8bfe\uff0c\u6709\u540c\u5b66\u95ee\uff0c\u5982\u679c\u7528\u6237\u5077\u5077\u628a <code>private</code> \u6539\u6210 <code>public</code> \u518d\u548c\u539f\u6709\u7684\u5e93\u94fe\u63a5\uff0c\u662f\u4e0d\u662f\u5c31\u53ef\u4ee5\u5728\u7528\u6237\u4ee3\u7801\u91cc\u66f4\u6539\u4e86\u3002\u8fd9\u4e2a\u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u505a\u4e2a\u5b9e\u9a8c\uff1a</p> <p>\u9996\u5148\uff0c\u521b\u5efa good_class.h \u548c good_class.cpp:</p> <pre><code>class SomeClass {\nprivate:\n    int data;\npublic:\n    int getData();\n};\n</code></pre> <pre><code>#include \"good_class.h\"\n\nint SomeClass::getData() {\n    return data;\n}\n</code></pre> <p>\u7136\u540e\uff0c\u9996\u5148\u7f16\u8bd1\uff0c</p> <pre><code>clang++ -c good_class.cpp -o good_class.o\n</code></pre> <p>\u7136\u540e\uff0c\u4fee\u6539 good_class.cpp \u5e76\u5199\u4e00\u4e2a evil_user.cpp</p> <pre><code>class SomeClass {\npublic:\n    int data;\npublic:\n    int getData();\n};\n</code></pre> <pre><code>#include &lt;stdio.h&gt;\n#include \"good_class.h\"\n\nint main() {\n    SomeClass a;\n    a.data = 37;\n    printf(\"%d\\n\", a.getData());\n    return 0;\n}\n</code></pre> <p>\u7f16\u8bd1\uff1a</p> <pre><code>clang++ good_class.o evil_user.cpp -o evil\n</code></pre> <p>\u7136\u540e <code>evil</code> \u5982\u613f\u5730\u8f93\u51fa\u4e86 <code>37</code> \u3002</p> <p>\u4e00\u4e9b\u63d0\u9192\uff1a</p> <ol> <li><code>C++</code> \u7684\u8bbf\u95ee\u63a7\u5236\u5341\u5206\u7684\u5f31\uff0c\u4ec5\u4ec5\u662f\u7f16\u8bd1\u671f\u3002\u6240\u4ee5\u662f\u5f88\u5bb9\u6613\u7ed5\u8fc7\u7684\u3002</li> <li>\u5bf9\u4e8e\u4e0d\u60f3\u6cc4\u9732\u6e90\u4ee3\u7801\u7684\u5e93\uff0c\u4e0d\u8981\u5bfc\u51fa <code>C++</code> \u7684\u7c7b\u548c\u51fd\u6570\u3002\u9009\u62e9\u5bfc\u51fa <code>C</code> \u51fd\u6570\uff0c\u7ed3\u6784\u4f53\u7528 incomplete type \u6216\u8005\u5e72\u8106 <code>void *</code> \u3002</li> </ol> <p>\u6269\u5c55\u9605\u8bfb\uff1a L \u53d4\u7684\u901a\u8fc7\u865a\u51fd\u6570\u8868\u8bbf\u95ee\u79c1\u6709\u51fd\u6570 \u3002</p>","tags":["c++","hack"]},{"location":"programming/2016/02/18/building-emacs-git-version-with-xwidgets-and-modules-in-archlinux/","title":"Building emacs git version with xwidgets and modules in archlinux","text":"<p>First you need to install these packages:</p> <pre><code>sudo pacman -S git autoconf automake gtk3 webkitgtk\ngit clone --depth 1 https://github.com/emacs-mirror/emacs.git (or git protocol if you like)\ncd emacs\n./autogen.sh all\n./configure --with-xwidgets --with-x --with-x-toolkit=gtk3 --with-modules\nmake\ncd lisp\nmake autoloads\nmake\nmake\nmake\n</code></pre> <p>Until you got everything ok.</p> <p>Then you can just:</p> <pre><code>cd src\n./emacs\n</code></pre> <p>And then, M-x webkit-browse-url RET: </p> <p>Also, test the modules feature using syohex/emacs-qrencode: </p> <p>I'm using ssh and X11 Forward to show Emacs in Mac OS X! Cool!</p>","tags":["emacs","git","archlinux","xwidgets"]},{"location":"programming/2018/06/18/building-lineageos-in-archlinux/","title":"\u5728 ArchLinux \u4e0a\u7f16\u8bd1 LineageOS for Huawei Angler","text":"<p>\u5b9e\u8df5\u4e86\u4e00\u4e0b\u5982\u4f55\u5728 ArchLinux \u4e0a\u7f16\u8bd1\u81ea\u5df1\u7684 LineageOS\u3002\u672c\u6587\u4e3b\u8981\u6839\u636e\u5b98\u65b9\u6587\u6863 \u8fdb\u884c\u7f16\u5199\u3002</p> <pre><code>$ # for py2 virtualenv and running x86 prebuilt binaries(e.g. bison)\n$ sudo pacman -Sy python2-virtualenv lib32-gcc-libs \n$ mkdir -p ~/bin\n$ mkdir -p ~/virtualenv\n$ # build script is written in python 2\n$ cd ~/virtualenv\n$ virtualenv2 -p /usr/bin/python2 py2\n$ mkdir -p ~/android/lineage\n$ curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo\n$ chmod a+x ~/bin/repo\n$ vim ~/.config/fish/config.fish\nset -x PATH ~/bin $PATH\nset -x USE_CCACHE=1\n$ exec fish -l\n$ cd ~/android/lineage\n$ repo init -u https://github.com/LineageOS/android.git -b lineage-15.1\n$ # alternatively, follow https://mirrors.tuna.tsinghua.edu.cn/help/lineageOS/\n$ repo sync\n$ source ~/virtualenv/py2/bin/activate\n$ source build/envsetup.sh\n$ breakfast angler\n$ vim ~/.config/fish/config.fish\n$ ccache -M 50G\n$ cd ~/android/lineage/device/huawei/angler\n$ ./extract-files.sh\n# Plug in Nexus 6P, maybe over ssh, see my another post\n$ cd ~/android/lineage\n$ croot\n$ brunch angler\n$ # Endless waiting... (for me, more than 2 hrs)\n</code></pre>","tags":["lineageos","archlinux","python2","angler"]},{"location":"programming/2023/04/14/counting-arguments/","title":"C/C++ \u6570\u53c2\u6570\u4e2a\u6570\u7684\u7279\u522b\u65b9\u6cd5","text":"","tags":["c","printf","gcc","builtin"]},{"location":"programming/2023/04/14/counting-arguments/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u7fa4\u53cb\u4e0a\u4e2a\u6708\u63d0\u4e86\u4e00\u4e2a\u672a\u77e5\u6765\u6e90\u95ee\u9898\uff1a</p> <p>\u5b9e\u73b0\u4e00\u4e2a\u4f60\u81ea\u5df1\u7684 <code>printf(int, ...)</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5305\u542b\u53ef\u53d8\u53c2\u6570\u3002\u4e3a\u7b80\u4fbf\u671f\u95f4\uff0c\u5047\u8bbe\u6240\u6709\u53c2\u6570\u5747\u4e3a int \u7c7b\u578b\u3002</p> <ol> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u666e\u901a\u53c2\u6570\uff0c\u4e0d\u8868\u793a\u540e\u7eed\u53ef\u53d8\u53c2\u6570\u7684\u6570\u76ee</li> <li>\u5728 printf \u4e2d\u9010\u4e2a\u8f93\u51fa\u6240\u6709\u4f20\u5165\u7684\u6574\u6570\u503c\uff08\u53ef\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 kprintf \u5b9e\u73b0\u8f93\u51fa\uff09</li> <li>\u601d\u8003\u5982\u4f55\u5224\u5b9a\u53c2\u6570\u7ed3\u675f\uff0c\u662f\u5426\u6709\u526f\u4f5c\u7528</li> </ol>","tags":["c","printf","gcc","builtin"]},{"location":"programming/2023/04/14/counting-arguments/#va_args","title":"va_args","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u4f20\u7edf\u7684\u5904\u7406\u53ef\u53d8\u53c2\u6570\u7684\u65b9\u6cd5\u662f va_args\uff0c\u4f46\u662f\u5b83\u65e0\u6cd5\u77e5\u9053\u4f20\u5165\u4e86\u591a\u5c11\u53c2\u6570\uff0c\u800c\u8981\u50cf POSIX printf \u90a3\u6837\uff0c\u89e3\u6790 format \u53c2\u6570\uff0c\u7136\u540e\u4e00\u4e2a\u4e00\u4e2a\u53bb\u53d6\u3002</p> <p>\u6240\u4ee5\u95ee\u9898\u7684\u5173\u952e\u662f\uff0c\u5982\u4f55\u83b7\u53d6\u53c2\u6570\u7684\u4e2a\u6570\uff1f\u4e00\u4e2a\u601d\u8def\u662f\u5b8f\uff0c\u5c1d\u8bd5\u7528\u5b8f\u7684\u9b54\u6cd5\u6765\u8ba1\u7b97\u51fa\u53c2\u6570\u4e2a\u6570\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u80fd\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u662f\u6ca1\u6709\u6df1\u7a76\u3002\u53e6\u4e00\u4e2a\u601d\u8def\u662f\u5229\u7528 ABI \u7684\u7279\u70b9\uff0c\u4f8b\u5982 i386 \u4e0a\u53c2\u6570\u662f\u901a\u8fc7\u6808\u4f20\u9012\u7684\uff0c\u90a3\u6216\u8bb8\u53ef\u4ee5\u5728\u6808\u4e0a\u627e\u5230\u6240\u6709\u7684 int\uff0c\u4f46\u662f\u95ee\u9898\u662f\u65e0\u6cd5\u786e\u8ba4\u53c2\u6570\u5728\u54ea\u91cc\u7ed3\u675f\u3002</p>","tags":["c","printf","gcc","builtin"]},{"location":"programming/2023/04/14/counting-arguments/#__builtin_va_arg_pack_len","title":"__builtin_va_arg_pack_len","text":"<p>\u4eca\u5929\uff0c\u53e6\u4e00\u4f4d\u7fa4\u53cb\u53d1\u4e86\u4e00\u4e2a\u94fe\u63a5\uff1ahttps://gcc.gnu.org/onlinedocs/gcc/Constructing-Calls.html#Constructing-Calls\uff0c\u8bb2\u8ff0\u4e86 GCC \u4e2d\u4e00\u4e9b\u7279\u522b\u7684 builtin \u51fd\u6570\uff0c\u7528\u4e8e\u51fd\u6570\u8c03\u7528\u76f8\u5173\u7684\u9b54\u6cd5\uff0c\u5176\u4e2d\u4e00\u6bb5\u63cf\u8ff0\u5438\u5f15\u4e86\u6211\u7684\u773c\u7403\uff1a</p> <pre><code>Built-in Function: int __builtin_va_arg_pack_len ()\n\nThis built-in function returns the number of anonymous arguments of an\ninline function. It can be used only in inline functions that are always\ninlined, never compiled as a separate function, such as those using\n__attribute__ ((__always_inline__)) or __attribute__ ((__gnu_inline__))\nextern inline functions. For example following does link- or run-time\nchecking of open arguments for optimized code:\n</code></pre> <p>\u8fd9\u6b63\u597d\u5b9e\u73b0\u4e86\u524d\u9762\u63d0\u5230\u7684\u83b7\u53d6\u53c2\u6570\u4e2a\u6570\uff0c\u5b9e\u73b0\u601d\u8def\u4e5f\u53ef\u4ee5\u60f3\u5230\uff0c\u5c31\u662f\u7f16\u8bd1\u5668\u5728 inline \u7684\u65f6\u5019\uff0c\u987a\u4fbf\u505a\u4e86\u4e00\u6b21\u66ff\u6362\u3002\u4e5f\u56e0\u6b64\uff0c\u8fd9\u4e2a\u51fd\u6570\u5fc5\u987b\u88ab inline\uff0c\u4e0d\u80fd\u6b63\u5e38\u8c03\u7528\u3002\u6709\u4e86\u8fd9\u4e2a\u601d\u8def\u4ee5\u540e\uff0c\u7ecf\u8fc7\u4e00\u756a\u5c1d\u8bd5\uff0c\u5199\u5165\u4e86\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdarg.h&gt;\n\nvoid my_printf_inner(int count, ...) {\n    va_list args;\n    va_start(args, count);\n\n    for (int i = 0;i &lt; count;i++) {\n        printf(\"%d\\n\", va_arg(args, int));\n    }\n    va_end(args);\n}\n\n__attribute__ ((__always_inline__)) inline\nvoid my_printf(int a, ...) {\n    int count = __builtin_va_arg_pack_len();\n    printf(\"%d\\n\", a);\n    my_printf_inner(count, __builtin_va_arg_pack());\n}\n\nint main() {\n    my_printf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);\n    return 0;\n}\n</code></pre> <p>\u8fd9\u4e2a\u4ee3\u7801\u5728 GCC \u4e2d\u53ef\u4ee5\u6b63\u786e\u5730\u8f93\u51fa 1-10 \u7684\u5341\u4e2a\u6570\u5b57\u3002\u6211\u4e00\u5f00\u59cb\u5c1d\u8bd5\u7684\u65f6\u5019\uff0c\u628a\u5faa\u73af\u4e5f\u5199\u5230 <code>my_printf</code> \u51fd\u6570\u4e2d\uff0c\u4f46\u662f GCC \u7684 inline \u5c31\u7f62\u5de5\u4e86\uff0c\u6700\u540e\u53ea\u597d\u62c6\u6210\u4e24\u4e2a\u51fd\u6570\uff0c\u628a\u4e0d\u77e5\u9053\u53c2\u6570\u4e2a\u6570\u7684\u95ee\u9898\uff0c\u8f6c\u5316\u6210\u77e5\u9053\u53c2\u6570\u7684\u95ee\u9898\uff0c\u5269\u4e0b\u5c31\u597d\u89e3\u51b3\u4e86\u3002</p> <p>\u6700\u540e\u751f\u6210\u7684\u6c47\u7f16\u5982\u4e0b\uff1a</p> <pre><code>main:\n        push    rbp\n        mov     rbp, rsp\n        sub     rsp, 16\n        mov     DWORD PTR [rbp-4], 1\n        mov     DWORD PTR [rbp-8], 9\n        mov     eax, DWORD PTR [rbp-4]\n        mov     esi, eax\n        mov     edi, OFFSET FLAT:.LC0\n        mov     eax, 0\n        call    printf\n        mov     eax, DWORD PTR [rbp-8]\n        push    10\n        push    9\n        push    8\n        push    7\n        mov     r9d, 6\n        mov     r8d, 5\n        mov     ecx, 4\n        mov     edx, 3\n        mov     esi, 2\n        mov     edi, eax\n        mov     eax, 0\n        call    my_printf_inner\n        add     rsp, 32\n        nop\n        mov     eax, 0\n        leave\n        ret\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83 inline \u4e86 <code>my_printf</code> \u7684\u5b9e\u73b0\uff0c\u5148\u8c03\u7528\u4e86\u7b2c\u4e00\u4e2a <code>printf</code>\uff0c\u7136\u540e\u628a\u5269\u4e0b\u7684\u53c2\u6570\u4e2a\u6570 <code>9</code> \u8d4b\u503c\u7ed9\u4e86 <code>edi</code>\uff0c\u5269\u4e0b\u5c31\u662f\u6b63\u5e38\u7684\u4f20\u53c2\u4e86\u3002</p> <p>\u4ee5\u4e0a\u5b9e\u9a8c\u90fd\u5728 Godbolt Compiler Explorer \u4e2d\u8fdb\u884c\uff1ahttps://godbolt.org/z/KjYzETn5Y\u3002</p> <p>\u7ee7\u7eed\u6316\u6398\uff0c\u4f1a\u53d1\u73b0\u5728 libc \u4e2d\u51fa\u73b0\u4e86 __builtin_va_arg_pack_len \u7684\u8eab\u5f71\uff0c\u5728 fcntl2.h \u4e2d\uff1a</p> <pre><code>__errordecl (__open_too_many_args,\n             \"open can be called either with 2 or 3 arguments, not more\");\n__errordecl (__open_missing_mode,\n             \"open with O_CREAT or O_TMPFILE in second argument needs 3 arguments\");\n\n__fortify_function int\nopen (const char *__path, int __oflag, ...)\n{\n  if (__va_arg_pack_len () &gt; 1)\n    __open_too_many_args ();\n\n  if (__builtin_constant_p (__oflag))\n    {\n      if (__OPEN_NEEDS_MODE (__oflag) &amp;&amp; __va_arg_pack_len () &lt; 1)\n        {\n          __open_missing_mode ();\n          return __open_2 (__path, __oflag);\n        }\n      return __open_alias (__path, __oflag, __va_arg_pack ());\n    }\n\n  if (__va_arg_pack_len () &lt; 1)\n    return __open_2 (__path, __oflag);\n\n  return __open_alias (__path, __oflag, __va_arg_pack ());\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6838\u5fc3\u7684\u601d\u60f3\u5c31\u662f\u6839\u636e open \u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u6709\u65e0\uff0c\u8c03\u7528\u76f8\u5e94\u7684 <code>__open_2</code> \u6216\u8005 <code>__open_alias</code> \u51fd\u6570\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u518d\u7528 <code>va_args</code> \u65b9\u6cd5\u4e86\uff0c\u5e76\u4e14\u5982\u679c\u4f20\u5165\u4e86\u8fc7\u591a\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u7f16\u8bd1\u671f\u6307\u51fa\u9519\u8bef\u3002\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;fcntl.h&gt;\n\nint main() {\n    open(\"123\", 0, 0, 0, 0);\n    return 0;\n}\n</code></pre> <p>\u62a5\u9519\uff1a</p> <pre><code>In file included from /usr/include/fcntl.h:301,\n                 from &lt;source&gt;:2:\nIn function 'open',\n    inlined from 'main' at &lt;source&gt;:5:5:\n/usr/include/x86_64-linux-gnu/bits/fcntl2.h:44:5: error: call to '__open_too_many_args' declared with attribute error: open can be called either with 2 or 3 arguments, not more\n   44 |     __open_too_many_args ();\n      |     ^~~~~~~~~~~~~~~~~~~~~~~\nASM generation compiler returned: 1\nIn file included from /usr/include/fcntl.h:301,\n                 from &lt;source&gt;:2:\nIn function 'open',\n    inlined from 'main' at &lt;source&gt;:5:5:\n/usr/include/x86_64-linux-gnu/bits/fcntl2.h:44:5: error: call to '__open_too_many_args' declared with attribute error: open can be called either with 2 or 3 arguments, not more\n   44 |     __open_too_many_args ();\n      |     ^~~~~~~~~~~~~~~~~~~~~~~\nExecution build compiler returned: 1\n</code></pre> <p>Compiler Explorer:https://godbolt.org/z/hebshz3P5.</p>","tags":["c","printf","gcc","builtin"]},{"location":"programming/2023/04/14/counting-arguments/#\u4f7f\u7528-c-\u5b8f","title":"\u4f7f\u7528 C \u5b8f","text":"<p>\u548c Claude \u804a\u4e86\u4e00\u4e0b\uff0c\u662f\u5426\u80fd\u591f\u7528 C \u5b8f\u6765\u5b9e\u73b0\uff0c\u5b83\u7684\u56de\u7b54\u662f\uff1a</p> <pre><code>#define PRINTF(...) printf(__VA_ARGS__)\n#define NARG(...)  (sizeof((int[]){__VA_ARGS__})/sizeof(int))\n\nint printf(const char *format, ...) {\n    va_list args;\n    va_start(args, format);\n\n    // Access the variable arguments using va_arg based on \n    // the number of arguments passed, obtained using NARG\n\n    va_end(args);\n}\n\n// Usage:\nPRINTF(1, 2, 3);     // Prints 1 2 3 \nPRINTF(1, 2, 3, 4); // Prints 1 2 3 4\n</code></pre> <p>\u6838\u5fc3\u601d\u8def\u5c31\u662f\u628a\u53c2\u6570\u5217\u8868\u653e\u5230\u6570\u7ec4\u91cc\uff0c\u7136\u540e\u8ba9\u7f16\u8bd1\u5668\u53bb\u63a8\u65ad\u6570\u7ec4\u5927\u5c0f\u3002\u6cbf\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u5b9e\u73b0\u51fa\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdarg.h&gt;\n\nvoid my_printf_inner(int count, ...) {\n    va_list args;\n    va_start(args, count);\n\n    for (int i = 0;i &lt; count;i++) {\n        printf(\"%d\\n\", va_arg(args, int));\n    }\n    va_end(args);\n}\n\n#define MY_PRINTF(...) do {int len=(sizeof((int[]){__VA_ARGS__})/sizeof(int)); my_printf_inner(len, __VA_ARGS__); } while(0);\n\nint main() {\n    MY_PRINTF(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);\n    return 0;\n}\n</code></pre> <p>\u4e5f\u662f\u53ef\u4ee5\u5de5\u4f5c\u7684\u3002Compiler Explorer \u94fe\u63a5\uff1ahttps://godbolt.org/z/TxKb3YEcf\u3002</p>","tags":["c","printf","gcc","builtin"]},{"location":"programming/2023/04/14/counting-arguments/#chatgpt","title":"ChatGPT","text":"<p>\u5c1d\u8bd5\u8be2\u95ee\u4e86\u4e00\u4e0b ChatGPT\uff1ahttps://shareg.pt/IXUKjYK\uff0c\u5b83\u53ef\u4ee5\u5199\u51fa\u989d\u5916\u4f20\u5165 int \u4e2a\u6570\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u5199\u51fa\u54e8\u5175\uff08\u4f20\u5165 <code>-1</code> \u8868\u793a\u7ed3\u675f\uff09\u7684\u7248\u672c\uff0c\u63d0\u793a\u4e86 builtin \u4ee5\u540e\uff0c\u518d\u63d0\u793a inline \u548c always_inline\uff0c\u6700\u540e\u8ba9\u5b83\u62c6\u5206\u6210\u4e24\u4e2a\u51fd\u6570\uff0c\u5f97\u5230\u7684\u4ee3\u7801\u8ddd\u79bb\u6b63\u786e\u7ed3\u679c\u5df2\u7ecf\u6bd4\u8f83\u63a5\u8fd1\uff0c\u4f46\u8fd8\u662f\u6709\u4e00\u4e9b\u95ee\u9898\u3002</p>","tags":["c","printf","gcc","builtin"]},{"location":"programming/2021/06/23/cpp-11-abi-problem/","title":"C++ 11 \u7684 ABI \u95ee\u9898","text":"","tags":["gcc","clang","c++","cpp","c++11","abi"]},{"location":"programming/2021/06/23/cpp-11-abi-problem/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6709\u540c\u5b66\u9047\u5230\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4ee3\u7801\u4e2d\u94fe\u63a5\u4e86\u4e00\u4e2a\u7b2c\u4e09\u65b9\u7684\u52a8\u6001\u5e93\uff0c\u5728\u94fe\u63a5\u7684\u65f6\u5019\u51fa\u73b0\u4e86\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u6709\u4e00\u4e2a\u51fd\u6570\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>void foobar(std::string s) {}\n</code></pre> <p>\u4f7f\u7528 GCC 11.1.0 \u7f16\u8bd1\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u9700\u8981\u7684\u7b26\u53f7\u662f <code>_Z6foobarNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE</code>\uff0c\u4f46\u662f\u7b2c\u4e09\u65b9\u5e93\u91cc\u9762\u5374\u662f <code>_Z6foobarSs</code>\uff0c\u56e0\u6b64\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u7b26\u53f7\uff0c\u94fe\u63a5\u5931\u8d25\u3002</p>","tags":["gcc","clang","c++","cpp","c++11","abi"]},{"location":"programming/2021/06/23/cpp-11-abi-problem/#\u95ee\u9898","title":"\u95ee\u9898","text":"<p>\u7ecf\u8fc7\u4e00\u756a\u7814\u7a76\uff0c\u53d1\u73b0 <code>Ss</code> \u5728 Itanium ABI \u4e2d\u8868\u793a\u7684\u662f\u7f29\u5199\uff1a</p> <pre><code>In addition, the following catalog of abbreviations of the form \"Sx\" are used:\n\n\n   &lt;substitution&gt; ::= St # ::std::\n   &lt;substitution&gt; ::= Sa # ::std::allocator\n   &lt;substitution&gt; ::= Sb # ::std::basic_string\n   &lt;substitution&gt; ::= Ss # ::std::basic_string &lt; char,\n                         ::std::char_traits&lt;char&gt;,\n                         ::std::allocator&lt;char&gt; &gt;\n   &lt;substitution&gt; ::= Si # ::std::basic_istream&lt;char,  std::char_traits&lt;char&gt; &gt;\n   &lt;substitution&gt; ::= So # ::std::basic_ostream&lt;char,  std::char_traits&lt;char&gt; &gt;\n   &lt;substitution&gt; ::= Sd # ::std::basic_iostream&lt;char, std::char_traits&lt;char&gt; &gt;\n</code></pre> <p>\u8fd9\u770b\u8d77\u6765\u5f88\u6b63\u5e38\uff0c<code>_Z6foobarSs</code> \u8868\u793a\u7684\u662f <code>foobar(std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;)</code>\uff0c\u4f46\u662f GCC 11.1.0 \u7f16\u8bd1\u51fa\u6765\u7684\u4e0a\u9762\u7684\u4ee3\u7801\u5374\u6ca1\u6709\u7528\u8fd9\u4e2a\u7b26\u53f7\uff0c\u800c\u662f <code>foobar(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;)</code>\u3002\u5dee\u522b\u5c31\u5728\u4e8e <code>__cxx11</code> \u4e2d\u3002</p> <p>\u7ecf\u8fc7\u4e00\u756a\u641c\u7d22\uff0c\u627e\u5230\u4e86 GCC \u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u6587\u6863\u548c\u7f51\u4e0a\u7684\u6587\u7ae0\uff0c\u627e\u5230\u4e86\u539f\u56e0\uff1a\u4ece GCC5 \u5f00\u59cb\uff0c\u4e3a\u4e86\u517c\u5bb9 C++11 \u6807\u51c6\u7684\u6539\u53d8\uff0c\u505a\u4e86\u8fd9\u4e2a\u53d8\u52a8\u3002\u5982\u679c\u8981\u6062\u590d\u539f\u6765\u7684\u884c\u4e3a\uff0c\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u5b9a\u4e49\uff1a</p> <pre><code>$ g++ -D_GLIBCXX_USE_CXX11_ABI=0 -c test.cpp -o test.o &amp;&amp; nm test.o | grep foobar\n0000000000000000 T _Z6foobarSs\n$ g++ -c test.cpp -o test.o &amp;&amp; nm test.o | grep foobar\n0000000000000000 T _Z6foobarNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE\n# install g++-4.9 in ubuntu 16.04\n$ g++-4.9 -c test.cpp -o test.o &amp;&amp; nm test.o | grep foobar\n0000000000000000 T _Z6foobarSs\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6b63\u5e38\u94fe\u63a5\u5230\u7b2c\u4e09\u65b9\u7684\u52a8\u6001\u5e93\u4e86\u3002</p>","tags":["gcc","clang","c++","cpp","c++11","abi"]},{"location":"programming/2018/04/17/downgrade-gdb/","title":"\u628a GDB \u964d\u7ea7\u5230 8.0.1","text":"<p>\u5728 macOS \u4e0a\u4f7f\u7528 GDB \u9700\u8981 codesigning\u3002\u4f46\u662f\u5728 GDB \u5347\u7ea7\u5230 8.1 \u540e\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u77e5\u9053\u4e3a\u4f55\u5931\u6548\u4e86\u3002\u6240\u4ee5\u6211\u5b89\u88c5\u56de\u4e86 GDB 8.0.1 \u5e76\u4e14\u91cd\u65b0 codesigning\uff0c\u73b0\u5728\u53c8\u53ef\u4ee5\u6b63\u5e38\u5347\u7ea7\u4e86\u3002</p> <p>\u5bf9 Formula \u8fdb\u884c patch\uff1a</p> <pre><code>diff --git a/Formula/gdb.rb b/Formula/gdb.rb\nindex 29a1c590..25360893 100644\n--- a/Formula/gdb.rb\n+++ b/Formula/gdb.rb\n@@ -1,14 +1,15 @@\n class Gdb &lt; Formula\n   desc \"GNU debugger\"\n   homepage \"https://www.gnu.org/software/gdb/\"\n-  url \"https://ftp.gnu.org/gnu/gdb/gdb-8.1.tar.xz\"\n-  mirror \"https://ftpmirror.gnu.org/gdb/gdb-8.1.tar.xz\"\n-  sha256 \"af61a0263858e69c5dce51eab26662ff3d2ad9aa68da9583e8143b5426be4b34\"\n+  url \"https://ftp.gnu.org/gnu/gdb/gdb-8.0.1.tar.xz\"\n+  mirror \"https://ftpmirror.gnu.org/gdb/gdb-8.0.1.tar.xz\"\n+  sha256 \"3dbd5f93e36ba2815ad0efab030dcd0c7b211d7b353a40a53f4c02d7d56295e3\"\n\n   bottle do\n-    sha256 \"43a6d6cca157ef70d13848f35c04e11d832dc0c96f5bcf53a43330f524b3ac40\" =&gt; :high_sierra\n-    sha256 \"fe7c6261f9164e7a744c9c512ba7e5afff0e74e373ece9b5aa19d5da6443bfc2\" =&gt; :sierra\n-    sha256 \"cd89001bcf8c93b5d6425ab91a400aeffe0cd5bbb0eccd8ab38c719ab5ca34ba\" =&gt; :el_capitan\n+    sha256 \"e98ad847402592bd48a9b1468fefb2fac32aff1fa19c2681c3cea7fb457baaa0\" =&gt; :high_sierra\n+    sha256 \"0fdd20562170c520cfb16e63d902c13a01ec468cb39a85851412e7515b6241e9\" =&gt; :sierra\n+    sha256 \"f51136c70cff44167dfb8c76b679292d911bd134c2de3fef40777da5f1f308a0\" =&gt; :el_capitan\n+    sha256 \"2b32a51703f6e254572c55575f08f1e0c7bc2f4e96778cb1fa6582eddfb1d113\" =&gt; :yosemite\n   end\n\n   deprecated_option \"with-brewed-python\" =&gt; \"with-python@2\"\n</code></pre>","tags":["macos","gdb","homebrew"]},{"location":"programming/2018/06/15/ebpf-with-hyperloglog/","title":"\u7f16\u5199 eBPF \u7a0b\u5e8f\u548c\u5229\u7528 HyperLogLog \u7edf\u8ba1\u5305\u7684\u4fe1\u606f","text":"<p>\u524d\u6bb5\u65f6\u95f4\u5728\u5199\u6982\u7387\u8bba\u4e0e\u6570\u7406\u7edf\u8ba1\u7684\u671f\u672b\u8bba\u6587\uff0c\u8ba8\u8bba\u7684\u4e3b\u9898\u662f\u5982\u4f55\u5bf9\u4e00\u4e2a\u5341\u5206\u5de8\u5927\u7684\u591a\u91cd\u96c6\u5408\uff08\u6216\u8005\u662f\u6d41\uff09\u4e2d\u76f8\u5f02\u5143\u7d20\u4e2a\u6570\u8fdb\u884c\u4f30\u8ba1\uff0c\u5199\u7684\u662f HyperLogLog \u7b49\u7b97\u6cd5\u3002\u8054\u60f3\u5230\u524d\u6bb5\u65f6\u95f4 LWN \u4e0a\u591a\u6b21\u63d0\u5230\u7684 eBPF \u548c BCC \u7684\u6587\u7ae0\uff0c\u6211\u51c6\u5907\u81ea\u5df1\u7528 eBPF \u5b9e\u73b0\u4e00\u4e2a\u9ad8\u6548\u7684\u4f30\u8ba1 inbound packet \u4e2d\u6765\u76f8\u5f02\u6e90\u5730\u5740\u7684\u4e2a\u6570\u548c outbound packet \u4e2d\u76f8\u5f02\u76ee\u7684\u5730\u5740\u7684\u4e2a\u6570\u3002\u7ecf\u8fc7\u4e86\u8bb8\u591a\u7684\u5c1d\u8bd5\u548c\u52aa\u529b\uff0c\u6700\u7ec8\u662f\u5199\u6210\u4e86 jiegec/hll_ebpf \uff0c\u5927\u81f4\u539f\u7406\u5982\u4e0b\uff1a</p> <p>\u7531\u4e8e eBPF \u662f\u4e00\u4e2a\u91c7\u7528\u4e13\u7528\u7684 bytecode \u5e76\u4e14\u8dd1\u5728\u5185\u6838\u4e2d\u7684\u8bed\u8a00\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u7528 clang \u5199 C \u8bed\u8a00\u7136\u540e\u4ea4\u7ed9 LLVM \u751f\u6210\u76f8\u5e94\u5730 eBPF bytecode\uff0c\u4f46\u4ecd\u7136\u6536\u5230\u8bb8\u591a\u7684\u9650\u5236\u3002\u800c\u4e14\uff0c\u6211\u5f88\u5c11\u63a5\u89e6 Linux \u5185\u6838\u5f00\u53d1\uff0c\u4e8e\u662f\u5728\u627e\u5185\u6838\u5934\u6587\u4ef6\u65f6\u8d39\u4e86\u4e00\u756a\u529f\u592b\u3002\u9996\u5148\u662f\u6838\u5fc3\u4ee3\u7801\uff1a</p> <pre><code>struct bpf_map_def SEC(\"maps\") hll_ebpf_out_daddr = {\n    .type = BPF_MAP_TYPE_PERCPU_ARRAY,\n    .key_size = sizeof(u32),\n    .value_size = sizeof(u32),\n    .max_entries = 256,\n    .pinning = 2 // PIN_GLOBAL_NS\n};\n\nSEC(\"out_daddr\")\nint bpf_out_daddr(struct __sk_buff *skb) {\n  u32 daddr = get_daddr(skb);\n  u32 hash = Murmur3(daddr, 0);\n  update_hll(&amp;hll_ebpf_out_daddr, hash);\n  return 0;\n}\n</code></pre> <p>\u9996\u5148\u662f\u58f0\u540d\u4e00\u4e2a\u7c7b\u578b\u4e3a PERCPU_ARRAY \u7684 eBPF MAP \u7c7b\u578b\u3002\u8fd9\u91cc\u7684 MAP \u4e0d\u662f\u5b57\u5178\uff0cArray \u624d\u662f\u771f\u662f\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ea\u4e0d\u8fc7\u63d0\u4f9b\u7684 API \u662f\u7c7b\u4f3c\u4e8e\u5b57\u5178\u7684\u3002SEC \u5b8f\u5219\u662f\u6307\u5b9a\u8fd9\u4e2a\u4e1c\u897f\u8981\u653e\u5728\u54ea\u4e00\u4e2a\u6bb5\uff0c\u8fd9\u4e2a\u5728\u540e\u9762\u4f1a\u63d0\u5230\u3002\u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u5c31\u662f\uff0c\u83b7\u53d6 IP \u5305\u7684\u76ee\u7684\u5730\u5740\uff08\u5176\u5b9e\u5e94\u8be5\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u662f IPv4 \u7684\uff09\uff0c\u7136\u540e\u6839\u636e HyperLogLog \u7684\u8981\u6c42\uff0c\u8fdb\u884c\u54c8\u5e0c\uff08\u8fd9\u91cc\u91c7\u7528\u7684\u662f Murmur3\uff09\uff0c\u7136\u540e\u5bf9\u5f97\u5230\u7684\u54c8\u5e0c\u503c\u5206\u6bb5\uff0c\u524d\u4e00\u90e8\u5206\u7528\u4e8e\u7d22\u5f15\uff0c\u540e\u4e00\u90e8\u5206\u7684 nlz\uff08clz, whatever\uff09\u7528\u4e8e\u4f30\u8ba1\u3002\u5177\u4f53\u7b97\u6cd5\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003 HyperLogLog \u7684\u8bba\u6587\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a eBPF \u51fd\u6570\u8fdb\u884c\u7f16\u8bd1\uff0c\u5e76\u4e14\u5e94\u7528\u8d77\u6765\uff1a</p> <pre><code>$ export KERN=4.16.0-2 # or use uname -r with awk, see Makefile\n$ clang -O2 -I /usr/src/linux-headers-${KERN}-common/include -I /usr/src/linux-headers-${KERN}-common/arch/x86/include -emit-llvm -c bpf.c -o - | llc -march=bpf -filetype=obj -o bpf.o\n$ export IFACE=en0 \n$ sudo tc qdisc add dev ${IFACE} clsact || true\n$ sudo tc filter del dev ${IFACE} egress\n$ sudo tc filter add dev ${IFACE} egress bpf obj bpf.o sec out_daddr\n$ sudo tc filter del dev ${IFACE} ingress\n$ sudo tc filter add dev ${IFACE} ingress bpf obj bpf.o sec in_saddr\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u5728\u7528\u6237\u6001\u8bfb\u51fa\u4e0a\u9762\u8fd9\u4e2a MAP \u4e2d\u7684\u5185\u5bb9\u3002\u7531\u4e8e\u5b83\u662f\u5168\u5c40\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 <code>/sys/fs/bpf/tc/globals</code> \u4e2d\u627e\u5230\u4ed6\u4eec\u3002\u7136\u540e\uff0c\u628a\u7edf\u8ba1\u5f97\u5230\u7684\u6570\u636e\u8fdb\u884c\u7efc\u5408\uff0c\u5f97\u5230\u7ed3\u679c\uff1a</p> <pre><code>void read_file(const char *file) {\n  int fd = bpf_obj_get(file);\n  const static int b = 6;\n  const static int m = 1 &lt;&lt; b;\n  int M[m] = {0};\n  int V = 0;\n  double sum = 0;\n  for (unsigned long i = 0; i &lt;m; i++) {\n    unsigned long value[2] = {0};\n    bpf_map_lookup_elem(fd, &amp;i, &amp;value);\n    M[i] = value[0] &gt; value[1] ? value[0] : value[1]; // assuming 2 CPUs, will change later\n    if (M[i] == 0)\n      V++;\n    sum += pow(2, -M[i]);\n  }\n  double E = 0.709 * m * m / sum;\n  if (E &lt;= 5 * m / 2) {\n    if (V != 0) {\n      E = m * log(1.0 * m / V);\n    }\n  } else if (E&gt; pow(2, 32) / 30) {\n    E = -pow(2, 32) * log(1 - E / pow(2, 32));\n  }\n  printf(\"%ld\\n\", lround(E));\n}\n</code></pre> <p>\u53ef\u4ee5\u624b\u52a8\u901a\u8fc7 <code>nmap</code> \u6d4b\u8bd5\uff0c\u4f8b\u5982\u626b\u63cf\u4e00\u4e2a\u6bb5\uff0c\u53ef\u4ee5\u770b\u5230\u6570\u636e\u4f1a\u589e\u957f\u8bb8\u591a\u3002\u5982\u679c\u626b\u63cf\u76f8\u540c\u7684\u6bb5\uff0c\u5219\u6570\u5b57\u4e0d\u4f1a\u53d8\u5316\uff0c\u4f46\u5982\u679c\u626b\u63cf\u65b0\u7684\u6bb5\uff0c\u6570\u5b57\u4f1a\u6709\u53d8\u5316\u3002\u8fd9\u662f\u4e00\u4e2a \u5229\u7528\u4e86 eBPF \u7684 HyperLogLog \u7684\u5b9e\u73b0\u3002</p>","tags":["ebpf","tc","iproute2","hyperloglog"]},{"location":"programming/2016/05/22/exciting-new-software-updates/","title":"Exciting new software updates","text":"<p>Just got a piece of great news: GHC 8.0.1 is out! See the announcement [here][http://article.gmane.org/gmane.comp.lang.haskell.ghc.devel/11928].</p> <p>So excited! And Emacs 25 release will be out soon. Using Emacs 25.0.94 now. Many new features available. See [this][http://puntoblogspot.blogspot.com/2016/05/emacs-251-news.html] for more information.</p> <p>Recently I have finally started to use mu4e and gnus. What makes it truly great is that they integrate org, bbdb and so on.</p>","tags":["haskell","ghc","emacs","ghc"]},{"location":"programming/2018/05/11/finding-x11-display-and-xauthority/","title":"\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY","text":"<p>\u4e4b\u524d\u5728\u641e\u4e00\u4e2a\u5c0f\u5de5\u5177\uff0c\u5728\u91cc\u9762\u9700\u8981\u8bbf\u95ee X11 server\uff0c\u4f46\u662f\u8bbf\u95ee X11 server \u6211\u4eec\u9700\u8981\u4e24\u4e2a\u4e1c\u897f\uff1aDISPLAY \u548c XAUTHORITY \u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u5b83\u4eec\u5728\u4e0d\u540c\u7684\u53d1\u578b\u7248\u548c Display Manager \u4e0b\u90fd\u6709\u4e9b\u4e0d\u540c\uff0c\u6240\u4ee5\u82b1\u4e86\u4e0d\u5c11\u529f\u592b\u624d\u5199\u4e86\u4e00\u4e9b\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u6211\u4eec\u662f\u5426\u53ef\u4ee5\u8fde\u4e0a X11 server\uff0c\u6211\u4eec\u4f7f\u7528\u8fd9\u4e00\u53e5\uff1a <pre><code>DIMENSIONS=$(xdpyinfo | grep 'dimensions:' | awk '{print $2;exit}')\n</code></pre></p> <p>\u5b83\u5c1d\u8bd5\u6253\u5f00\u5f53\u524d\u7684 DISPLAY\uff0c\u5e76\u4e14\u8f93\u51fa\u5b83\u7684\u5206\u8fa8\u7387\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u5bf9\u4e0d\u540c\u7684\u4e00\u4e9b\u53d1\u578b\u7248\uff0c\u7efc\u5408\u7f51\u4e0a\u7684\u65b9\u6cd5\uff0c\u5c1d\u8bd5\u53bb\u627e\u5230\u6b63\u786e\u7684\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u5bf9\u4e8e Debian: <pre><code>DISPLAY=$(w -hs | awk -v tty=\"$(cat /sys/class/tty/tty0/active)\" '$2 == tty &amp;&amp; $3 != \"-\" {print $3; exit}')\nUSER=$(w -hs | awk -v tty=\"$(cat /sys/class/tty/tty0/active)\" '$2 == tty &amp;&amp; $3 != \"-\" {print $1; exit}')\neval XAUTHORITY=~$USER/.Xauthority\nexport DISPLAY\nexport XAUTHORITY\nDIMENSIONS=$(xdpyinfo | grep 'dimensions:' | awk '{print $2;exit}')\n</code></pre></p> <p>\u5bf9\u4e8e Archlinux\uff1a <pre><code>DISPLAY=$(w -hs | awk 'match($2, /:[0-9]+/) {print $2; exit}')\nUSER=$(w -hs | awk 'match($2, /:[0-9]+/) {print $1; exit}')\neval XAUTHORITY=/run/user/$(id -u $USER)/gdm/Xauthority\nexport DISPLAY\nexport XAUTHORITY\nDIMENSIONS=$(xdpyinfo | grep 'dimensions:' | awk '{print $2;exit}')\n</code></pre></p> <p>\u6700\u540e\u4e00\u79cd\u60c5\u51b5\u5f88\u7c97\u66b4\u7684\uff0c\u76f4\u63a5\u627e\u8fdb\u7a0b\u62ff\uff1a <pre><code>XAUTHORITY=$(ps a | awk 'match($0, /Xorg/) {print $0; exit}' | perl -n -e '/Xorg.*\\s-auth\\s([^\\s]+)\\s/ &amp;&amp; print $1')\nPID=$(ps a | awk 'match($0, /Xorg/) {print $1; exit}')\nDISPLAY=$(lsof -p $PID | awk 'match($9, /^\\/tmp\\/\\.X11-unix\\/X[0-9]+$/) {sub(\"/tmp/.X11-unix/X\",\":\",$9); print $9; exit}')\nexport DISPLAY\nexport XAUTHORITY\nDIMENSIONS=$(xdpyinfo | grep 'dimensions:' | awk '{print $2;exit}')\n</code></pre></p> <p>\u4e2d\u95f4\u6df7\u7528\u4e86\u5927\u91cf\u7684 awk perl \u4ee3\u7801\uff0c\u5c31\u5dee sed \u4e86\u3002\u727a\u7272\u4e86\u4e00\u70b9\u53ef\u8bfb\u6027\uff0c\u4f46\u662f\u5f00\u53d1\u8d77\u6765\u6bd4\u8f83\u8f7b\u677e\u3002</p>","tags":["linux","x11","display","xauthority","awk","perl"]},{"location":"programming/2016/02/15/good-software-engineering-rules/","title":"Good software engineering rules","text":"<p>I saw a great saying:</p> <p>No code runs faster than no code.</p> <p>No code has fewer bugs than no code.</p> <p>No code uses less memory than no code.</p> <p>No code is easier to understand than no code.</p> <p>It comes from here.</p> <p>And i strongly recommends this article for a better understanding of monads.</p>","tags":["coding","share","memo"]},{"location":"programming/2019/04/01/gowin-fpga/","title":"\u9ad8\u4e91 FPGA \u8e29\u5751","text":"<p>\u6700\u8fd1\u62ff\u5230\u4e86\u9ad8\u4e91 FPGA GW2A-18 \u5f00\u53d1\u7248\uff0c\u60f3\u5728\u8fd9\u4e0a\u9762\u505a\u4e00\u4e9b\u5c0f\u5de5\u7a0b\u3002\u4e0d\u8fc7\u9996\u5148\u8981\u914d\u7f6e\u597d\u73af\u5883\u4ec0\u4e48\u7684\u3002\u5b98\u65b9\u63d0\u4f9b\u4e86 Linux \u548c Windows \u7684\u4e24\u5957\u5de5\u5177\uff0c\u81ea\u7136\u662f\u62e5\u62b1 Linux \u54af\uff0c\u4f46\u662f\u7531\u4e8e\u5b98\u65b9\u9002\u914d\u7684\u662f Redhat \u7cfb\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6240\u4ee5\u7528 Debian \u7cfb\u7684\u65f6\u5019\u51fa\u73b0\u4e86\u82e5\u5e72\u95ee\u9898\uff0c\u540e\u9762\u4f1a\u8c08\u5230\u600e\u4e48\u89e3\u51b3\u7684\u3002</p> <p>\u9996\u5148\u662f\u5b98\u7f51\u4e0b\u8f7d\u4e86\u5b83\u7684\u8f6f\u4ef6\uff0c\u5927\u6982\u6709 IDE\uff0c\u7efc\u5408\u5668\uff0c\u5e03\u7ebf\u5668\u548c Programmer \u56db\u4e2a\u5de5\u5177\uff0c\u7136\u540e\u5f00\u59cb\u8dd1\uff0c\u53d1\u73b0\u7f3a\u5c11\u4e86 libcrypt.so.1.0.0\u3002\u4e0a\u7f51\u641c\u4e86\u4e00\u4e0b\u89e3\u51b3\u65b9\u6848\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1 openssl-1.0.0\uff0c\u4e8e\u662f\u4e0b\u8f7d\u5e76\u4e14\u7f16\u8bd1\u4e86 openssl-1.0.0t \u5e76\u4e14\u628a .so \u7684\u8def\u5f84\u8c03\u597d\u4e86\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u6253\u5f00 IDE \u4e86\u3002\u7136\u540e\u53d1\u73b0\u9700\u8981 License\uff0c\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u53bb\u5b98\u7f51\u7533\u8bf7\u4e00\u4e0b\uff0c\u4e00\u5929\u90ae\u4ef6\u5c31\u4e0b\u6765\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u914d\u7f6e License\uff0cIDE \u5f88\u5bb9\u6613\uff0c\u76f4\u63a5\u9009\u62e9\u90ae\u4ef6\u91cc\u53d1\u4e0b\u6765\u7684 node-locked License \u5373\u53ef\u3002\u4e0d\u8fc7 Synplify Pro \u7684 Linux \u7248\u672c\u4e0d\u652f\u6301\u76f4\u63a5\u5355\u6587\u4ef6 node-locked \u7684 License\uff0c\u53ea\u5141\u8bb8\u8dd1 SCL \u2026 \u4e0d\u8fc7\u9ad8\u4e91\u4e5f\u63d0\u4f9b\u4e86 SCL \u7684\u4e0b\u8f7d\uff0c\u548c IDE \u7684 License Server \u653e\u5728\u4e00\u8d77\uff0c\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u5728\u5f97\u5230\u7684 License \u91cc\u52a0\u4e0a\u4e24\u884c\uff1a</p> <pre><code>SERVER ${hostname} ${hostid} ${port}\nVENDER snpslmd /path/to/scl/2018.06/linux64/bin/snpslmd\n</code></pre> <p>\u7136\u540e\u628a $LM_LICENSE_FILE \u6307\u5411\u8fd9\u4e2a\u6587\u4ef6\u8def\u5f84\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u4e00\u90e8\u5206\u611f\u8c22 @Jackey-Huo\u3002</p> <p>\u968f\u624b\u5199\u4e86\u4e00\u4e2a\u7b80\u5316\u7248\u7684\u70b9\u4eae\u6570\u5b57\u4eba\u751f\uff08\u6ca1\u6709\u6570\u7801\u7ba1\uff09\uff0c\u5f97\u5230\u4e86 bistream\uff0c\u51c6\u5907\u5f80\u677f\u5b50\u91cc\u5237\uff0c\u7136\u540e\u95ee\u9898\u51fa\u73b0\u4e86\uff1a</p> <pre><code>ImportError: /path/to/Gowin_YunYuan_V1.9.0Beta_linux/Programmer/bin/librt.so.1: symbol __vdso_clock_gettime version GLIBC_PRIVATE not defined in file libc.so.6 with link time reference\n</code></pre> <p>\u76ee\u6d4b\u662f glibc \u7248\u672c\u95ee\u9898 \u2026 \u8fd9\u5c31\u5f88\u96be\u5904\u7406\u4e86\u3002\u53e6\u5916\u53c8\u4ece\u5b98\u7f51\u4e0b\u8f7d\u4e86\u72ec\u7acb\u7684 Programmer\uff0c\u4ecd\u7136\u4e0d\u884c\uff0c\u68c0\u6d4b\u4e0d\u5230\u8bbe\u5907\u3002</p> <p>\u6700\u540e\u60f3\u4e86\u60f3\uff0c\u627e\u5230\u4e86\u7ec8\u6781\u529e\u6cd5\uff0c\u5728 Docker \u91cc\u8fd0\u884c CentOS \u7684 Privileged Container\uff0c\u518d\u8dd1 programmer\uff1a</p> <pre><code>$ docker pull centos\n$ docker run -it --privileged -v /home:/home centos /bin/bash\n</code></pre> <p>CentOS \u955c\u50cf\u51fa\u4e4e\u610f\u6599\u5730\u5c0f\u3002\u8fdb\u53bb\u4ee5\u540e\uff0c\u627e\u5230 Programmer \u8def\u5f84\uff0c\u7136\u540e scan\uff1a</p> <pre><code># ./programmer_cli --scan\n Scanning!\nCurrent download-cable channel:0\nDevice Info:\n        Family: GW2A\n        Name: GW2A-18\n        ID: 0xREDACTED\n 1 device(s) found!\n Cost 0.54 second(s)\n</code></pre> <p>\u63a5\u7740\u70e7\u5230 SRAM \u4e2d\uff1a</p> <pre><code># ./programmer_cli -d GW2A-18 --fsFile /path/to/bitstream.fs --run 2\n \"SRAM Program\" starting on device-1...\nProgramming...: [#########################] 100%\n User Code: 0xREDACTED\n Status Code: 0xREDACTED\n Cost 4.54 second(s)\n</code></pre> <p>\u70e7\u5f55\u6210\u529f\uff0c\u529f\u80fd\u6d4b\u8bd5\u4e5f\u6ca1\u6709\u95ee\u9898\u3002\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c\u4e0b\u4e00\u6b65\u5de5\u4f5c\u4e86\u3002</p>","tags":["gowin","fpga","programmer","centos"]},{"location":"programming/2019/03/04/implement-network-syscalls/","title":"\u5b9e\u73b0\u7f51\u7edc\u7684 syscall","text":"<p>\u6709\u4e86\u7f51\u5361\u9a71\u52a8\uff0c\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u505a\u7f51\u7edc\u7684 syscall \u4e86\u3002\u4e3a\u4e86\u6d4b\u8bd5\uff0c\u9996\u5148\u5728 busybox \u91cc\u627e\u53ef\u4ee5\u7528\u6765\u6d4b\u8bd5\u7684 applet\uff0c\u7531\u4e8e\u6ca1\u6709\u5b9e\u73b0 poll\uff0c\u6240\u4ee5 nc telnet \u5565\u7684\u90fd\u7528\u4e0d\u4e86\u3002\u6700\u540e\u9009\u62e9\u5230\u4e86 ping \u548c pscan \u4e0a\u3002</p> <p>ping \u5927\u5bb6\u90fd\u5f88\u4e86\u89e3\uff0cpscan \u5c31\u662f\u4e00\u4e2a\u626b\u7aef\u53e3\u7684\uff0c\u5bf9\u4e00\u4e2a ip \u8fde\u7eed\u7684\u82e5\u5e72\u4e2a\u7aef\u53e3\u53d1\u8d77 tcp \u8bf7\u6c42\u3002\u8fd9\u5c31\u8981\u6c42\u6211\u63d0\u4f9b raw socket \u548c tcp socket \u72b6\u6001\u7684\u652f\u6301\u3002\u7531\u4e8e\u7f51\u7edc\u6808\u672c\u8eab\u662f\u5f02\u6b65\u7684\uff0c\u4f46 read connect \u8fd9\u4e9b\u51fd\u6570\u5728\u4e0d\u8c03 setsockopt \u7684\u524d\u63d0\u4e0b\u53c8\u662f\u540c\u6b65\u7684\uff0c\u7136\u800c\u73b0\u5728\u53c8\u6ca1\u6709 signal \u53ef\u4ee5\u7528\uff0c\u8981\u662f block \u4e86\u5c31\u518d\u4e5f\u51fa\u4e0d\u6765\u4e86\u3002\u4e8e\u662f\u5c31\u91c7\u7528\u4e86 Condvar \u7684\u529e\u6cd5\uff0c\u62ff\u4e00\u4e2a\u5168\u5c40\u7684\u6761\u4ef6\u53d8\u91cf\uff0c\u5f53 poll \u4e0d\u5230\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u5148\u628a\u7ebf\u7a0b\u62ff\u6389\uff0c\u7b49\u5230\u7f51\u7edc\u6808\u66f4\u65b0\u4e86\uff0c\u518d\u6062\u590d\u3002\u8fd9\u6837\u81f3\u5c11\u4e0d\u4f1a\u628a cpu \u4e5f block \u4f4f\u3002</p> <p>\u7136\u540e\u5c31\u662f\u628a socket \u90e8\u5206\u6539\u4e86\u53c8\u6539\u5427\uff0c\u6570\u636e\u7ed3\u6784\u7684\u8bbe\u8ba1\u6539\u4e86\u51e0\u6b21\uff0c\u4e3a\u4e86\u89e3\u51b3 ownership \u95ee\u9898\u4e0a\u9501\u554a\u4e5f\u6709\u70b9\u591a\uff0c\u4f46\u662f\u4e5f\u66f4\u7ec6\u4e86\uff0c\u867d\u7136\u5b9e\u9645\u4e0a\u53ef\u80fd\u6ca1\u6709\u5fc5\u8981\uff0c\u56e0\u4e3a\u4e0a\u9762\u8fd8\u6709\u5927\u7684\u9501\u3002\u4e0d\u8fc7\u6027\u80fd\u8fd8\u4e0d\u662f\u73b0\u5728\u8003\u8651\u7684\u91cd\u70b9\uff0c\u5173\u952e\u8fd8\u8981\u5148\u628a send recv accept bind listen \u5565\u7684\u5199\u5f97\u5dee\u4e0d\u591a\u4e86\uff0c\u7136\u540e\u8fd8\u6709\u628a poll/select \u5b9e\u73b0\u4e86\uff0c\u8fd9\u4e2a\u5f88\u5173\u952e\u3002</p> <p>\u4e2d\u95f4\u9047\u5230\u7684\u6700\u5927\u7684\u5751\u5c31\u662f\uff0c\u63a5\u6536 pci interrupt \u7684\u65f6\u5019\u603b\u662f\u5565\u4e5f\u6ca1\u6709\uff0c\u7136\u540e\u9760\u4e07\u80fd\u7684 qemu trace \u53d1\u73b0\uff0c\u539f\u6765\u662f mask \u6389\u4e86\uff0c\u6240\u4ee5\u5565\u4e5f\u6536\u4e0d\u4e86\uff0c\u7136\u540e\u6700\u540e\u7684\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u7528 MSI Interrupt #55 \u641e\u5b9a\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u81f3\u4e8e\u4e3a\u5565\u662f 55 \u5462\uff0c\u56e0\u4e3a 23 + 32 = 55 \u554a\uff08\u8bef</p> <p>\u603b\u4e4b\u662f\u4fee\u597d\u4e86\u3002\u7ec8\u4e8e\u53ef\u4ee5\u7ee7\u7eed\u5199\u5176\u5b83\u7684 syscall \u4e86\u3002\u8fd8\u6ca1\u60f3\u597d poll \u8981\u600e\u4e48\u5199\uff0corz\u3002</p>","tags":["rcore","rust","os","e1000","syscall","msi","pci","interrupt"]},{"location":"programming/2017/12/31/interesting-java-formatting-problem/","title":"\u6709\u8da3\u7684 Java \u65e5\u671f\u683c\u5f0f\u5316\u95ee\u9898","text":"<p>\u4eca\u5929\u5728\u7fa4\u91cc\u770b\u5230\u6709\u4eba\u8bf4\uff0cJava \u7684\u65e5\u671f\u683c\u5f0f\u5316\u6709\u95ee\u9898\uff0c\u5982\u679c\u7528 <code>YYYY-MM-dd</code> \uff0c\u4eca\u5929\u7684\u65e5\u671f\u5c31\u4f1a\u663e\u793a <code>2018-12-31</code> \u3002\u6211\u7acb\u9a6c\u5728\u672c\u5730\u7528 Java REPL (aka Groovy) \u8dd1\u4e86\u4e00\u4e0b\uff0c\u679c\u7136\u5982\u6b64\uff1a</p> <pre><code>$ date = new Date()\n===&gt; Sun Dec 31 10:51:26 CST 2017\n$ import java.text.SimpleDateFormat\n===&gt; java.text.SimpleDateFormat\n$ new SimpleDateFormat(\"YYYY-MM-dd\").format(date)\n===&gt; 2018-12-31\n</code></pre> <p>\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u628a\u683c\u5f0f\u6362\u4e3a <code>yyyy-MM-dd</code> \uff0c\u786e\u5b9e\u5c31\u53ef\u4ee5\u4e86\u3002\u4e8e\u662f\u6211\u5c31\u53bb\u7814\u7a76\u4e86\u4e00\u4e0b\u6587\u6863\uff1a Class SimpleDateFormat \uff0c\u53d1\u73b0\u4e86\u95ee\u9898\uff1a</p> <p><code>y</code> \u4ee3\u8868 <code>year</code> \uff0c\u800c <code>Y</code> \u4ee3\u8868 <code>week year</code> \u3002\u6839\u636e week year \uff0c\u56e0\u4e3a\u4eca\u5e74\u6700\u540e\u7684\u4e00\u4e2a\u661f\u671f\u5728\u660e\u5e74\u7684\u90e8\u5206\u66f4\u591a\uff0c\u4e8e\u662f\u8fd9\u4e2a\u661f\u671f\u88ab\u5f52\u5728\u4e86\u660e\u5e74\uff0c\u6240\u4ee5\u8fd9\u4e00\u5468\u5c5e\u4e8e 2018\uff0c\u8fd9\u5c31\u53ef\u4ee5\u89e3\u91ca\u4e4b\u524d\u7684\u90a3\u4e2a\u8f93\u51fa\u95ee\u9898\u4e86\u3002</p>","tags":["java","datetime formatting"]},{"location":"programming/2016/04/09/interesting-links/","title":"Interesting links","text":"<p>Having a bad cold. Really annoying.</p> <p>Okay, here comes the interesting links:</p> <p>https://glyph.twistedmatrix.com/2015/11/editor-malware.html</p> <p>http://kitchingroup.cheme.cmu.edu/blog/2016/04/07/Writing-hy-code-from-hy-code/</p> <p>https://github.com/holomorph/transmission</p> <p>https://github.com/bergey/org-babel-diagrams</p> <p>http://ess.r-project.org/</p> <p>http://projects.haskell.org/diagrams/</p>","tags":["links","share"]},{"location":"programming/2019/06/21/ip-prefix-unexpected-undefined-behavior/","title":"IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior","text":"<p>\u6700\u8fd1\u53d1\u73b0\u4e86\u4e24\u4e2a\u5f88\u795e\u5947\u7684 Undefined Behavior\uff0c\u51fa\u73b0\u5728 Prefix Len \u548c Netmask \u7684\u8f6c\u6362\u7684\u95ee\u9898\u4e0b\u3002\u4e00\u4e2a\u7b80\u5355\u601d\u8def\u53ef\u80fd\u662f\uff1a</p> <pre><code>#define PREFIX_BIN2DEC(bin) (32 - __builtin_ctz((bin)))\n#define PREFIX_DEC2BIN(hex) (((~0) &gt;&gt; (32 - (hex))) &lt;&lt; (32 - (hex))\n</code></pre> <p>\u4e4d\u4e00\u770b\uff0c\u4f3c\u4e4e\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u3002\u4f46\u662f\uff0c\u5728\u4e00\u4e9b\u5e73\u53f0\u4e0b\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u7ed3\u679c\uff1a</p> <pre><code>PREFIX_BIN2DEC(0x00000000) = 33\nPREFIX_DEC2BIN(0) = 0xFFFFFFFF\n</code></pre> <p>\u800c\u4e14\u53ea\u80fd\u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\u4e0d\u786e\u5b9a\u5730\u590d\u73b0\uff0c\u6700\u540e\u53d1\u73b0\u5176\u5b9e\u662f Undefined Behavior\uff0c\u5728 C \u7684\u6807\u51c6\u4e2d\uff1a</p> <pre><code>In any case, the behavior is undefined if rhs is negative or is greater or equal the number of bits in the promoted lhs.\n</code></pre> <p>\u610f\u5473\u7740\uff0c <code>0xFFFFFFFF &gt;&gt; 32</code> \u662f\u4e00\u4e2a UB\uff0c\u6240\u4ee5\u51fa\u73b0\u4e86\u4e0a\u9762\u7684\u95ee\u9898\u3002</p> <p>\u53e6\u5916\uff0c<code>__builtin_ctz</code> \u6709\u8fd9\u6837\u7684\u8bf4\u660e\uff1a</p> <pre><code>Returns the number of trailing 0-bits in x, starting at the least significant bit position. If x is 0, the result is undefined.\n</code></pre> <p>\u610f\u5473\u7740\uff0c<code>__builtin_ctz(0)</code> \u4e5f\u662f\u4e00\u4e2a UB\uff0c\u6240\u4ee5\u5f97\u5230\u4e86\u9519\u8bef\u7684\u7ed3\u679c\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\u4e5f\u5f88\u7b80\u5355\uff0c\u4e0b\u9762\u63d0\u4f9b\u4e00\u4e2a\u53c2\u8003\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <pre><code>#define PREFIX_BIN2DEC(bin) ((bin) ? (32 - __builtin_ctz((bin))) : 0)\n#define PREFIX_DEC2BIN(hex) (((uint64_t)0xFFFFFFFF &lt;&lt; (32 - (hex))) &amp; 0xFFFFFFFF)\n</code></pre> <p>Quagga \u7684\u5b9e\u73b0\uff1a</p> <pre><code>/* Convert masklen into IP address's netmask (network byte order). */\nvoid\nmasklen2ip (const int masklen, struct in_addr *netmask)\n{\n  assert (masklen &gt;= 0 &amp;&amp; masklen &lt;= IPV4_MAX_BITLEN);\n\n  /* left shift is only defined for less than the size of the type.\n   * we unconditionally use long long in case the target platform\n   * has defined behaviour for &lt;&lt; 32 (or has a 64-bit left shift) */\n\n  if (sizeof(unsigned long long) &gt; 4)\n    netmask-&gt;s_addr = htonl(0xffffffffULL &lt;&lt; (32 - masklen));\n  else\n    netmask-&gt;s_addr = htonl(masklen ? 0xffffffffU &lt;&lt; (32 - masklen) : 0);\n}\n\n/* Convert IP address's netmask into integer. We assume netmask is\n   sequential one. Argument netmask should be network byte order. */\nu_char\nip_masklen (struct in_addr netmask)\n{\n  uint32_t tmp = ~ntohl(netmask.s_addr);\n  if (tmp)\n    /* clz: count leading zeroes. sadly, the behaviour of this builtin\n     * is undefined for a 0 argument, even though most CPUs give 32 */\n    return __builtin_clz(tmp);\n  else\n    return 32;\n}\n</code></pre> <p>BIRD \u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <pre><code>/**\n * u32_mkmask - create a bit mask\n * @n: number of bits\n *\n * u32_mkmask() returns an unsigned 32-bit integer which binary\n * representation consists of @n ones followed by zeroes.\n */\nu32\nu32_mkmask(uint n)\n{\n  return n ? ~((1 &lt;&lt; (32 - n)) - 1) : 0;\n}\n\n/**\n * u32_masklen - calculate length of a bit mask\n * @x: bit mask\n *\n * This function checks whether the given integer @x represents\n * a valid bit mask (binary representation contains first ones, then\n * zeroes) and returns the number of ones or 255 if the mask is invalid.\n */\nuint\nu32_masklen(u32 x)\n{\n  int l = 0;\n  u32 n = ~x;\n\n  if (n &amp; (n+1)) return 255;\n  if (x &amp; 0x0000ffff) { x &amp;= 0x0000ffff; l += 16; }\n  if (x &amp; 0x00ff00ff) { x &amp;= 0x00ff00ff; l += 8; }\n  if (x &amp; 0x0f0f0f0f) { x &amp;= 0x0f0f0f0f; l += 4; }\n  if (x &amp; 0x33333333) { x &amp;= 0x33333333; l += 2; }\n  if (x &amp; 0x55555555) l++;\n  if (x &amp; 0xaaaaaaaa) l++;\n  return l;\n}\n</code></pre>","tags":["c","cpp","ip","cidr","ub"]},{"location":"programming/2017/12/12/lsp-and-cpp/","title":"LSP \u548c C++","text":"<p>\u4e4b\u524d\u65f6\u95f4\uff0c\u5de8\u786c\u53d1\u5e03\u4e86 LSP\uff08Language Server Protocol\uff09\uff0c\u76ee\u7684\u662f\u89e3\u51b3\u76ee\u524d IDE \u548c\u5404\u8bed\u8a00\u7684 m+n \u95ee\u9898\u3002\u60f3\u6cd5\u5f88\u597d\uff0c\u4e0d\u8fc7\u76f4\u5230\u6700\u8fd1\uff0c\u7ec8\u4e8e\u6709\u6211\u89c9\u5f97\u53ef\u4ee5\u7528\u7684\u5de5\u5177\u51fa\u6765\u4e86\uff0c\u5e76\u4e14\u5df2\u7ecf\u4ee3\u66ff\u4e86\u6211\u5728\u4f7f\u7528\u7684\u5176\u5b83\u7684\u63d2\u4ef6\u3002</p> <p>\u7531\u4e8e\u6211\u6700\u8fd1\u4e3b\u8981\u5c31\u662f\u505a\u505a\u7a0b\u8bbe\u4f5c\u4e1a\uff0c\u505a\u505a OJ \u8fd9\u4e9b\uff0c\u4e3b\u8981\u5c31\u662f\u548c C++ \u6253\u4ea4\u9053\u3002\u6240\u4ee5\u6211\u5f53\u7136\u5c31\u5f00\u59cb\u627e\u4e00\u4e9b\u6bd4\u8f83\u6210\u719f\u7684 C++\u7684 LSP server\u3002\u6709\u4e00\u4e2a Sourcegraph \u7ef4\u62a4\u7684 langserver.org \uff0c\u4e0a\u9762\u6709\u7740\u76ee\u524d\u7684\u5404\u4e2a\u8bed\u8a00\u548c\u7f16\u8f91\u5668/IDE \u7684\u652f\u6301\u60c5\u51b5\uff0c\u6211\u521a\u624d\u63d0\u5230\u7684 cquery \u4e5f\u4f1a\u52a0\u5165\u5230\u8fd9\u4e2a\u5217\u8868\u91cc\u53bb\u3002\u4ece\u8fd9\u4e2a\u5217\u8868\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u7528\u7684\u6bd4\u8f83\u591a\u7684 Python \u548c Haskell \u90fd\u5df2\u7ecf\u6709\u4e0d\u9519\u7684\u7684 LSP server\uff0c\u6211\u5df2\u7ecf\u5f00\u59cb\u5728\u672c\u5730\u4f53\u9a8c pyls \u548c hie \u4e86\uff0c\u611f\u89c9\u505a\u5f97\u633a\u4e0d\u9519\u7684\u3002</p> <p>\u56de\u5230 C++\uff0c\u6211\u7684\u4e3b\u529b\u7f16\u8f91\u5668\u662f Emacs\uff0c\u5176\u6b21\u662f CLion\uff0c\u800c Emacs \u4e0a\u7684LSP \u652f\u6301 lsp-mode\u4e5f\u5728\u5feb\u901f\u53d1\u5c55\uff0c\u4e0e\u4e4b\u914d\u5408\u7684lsp-ui \u4e5f\u51fa\u73b0\u4e86\u5f88\u591a\u5f88\u68d2\u7684\u529f\u80fd\u3002</p> <p>\u4e0b\u9762\u5f00\u59cb\u7f16\u8bd1\u5e76\u914d\u7f6ecquery\uff1a</p> <pre><code>git clone https://github.com/jacobdufault/cquery --recursive\ncd cquery\n./waf configure # to use system clang, append --use-system-clang\n./waf build\n</code></pre> <p>\u7136\u540e\u914d\u7f6e Emacs\uff1a</p> <pre><code>(use-package lsp-mode\n  :ensure t\n  :diminish\n  lsp-mode\n  :commands\n  (lsp-mode)\n  :config\n  (lsp-define-stdio-client\n   lsp-pyls\n   \"python\"\n   #'get-project-root\n   '(\"/usr/local/bin/pyls\")))\n\n(use-package lsp-ui\n  :commands\n  lsp-ui-mode\n  :init\n  (add-hook 'lsp-mode-hook 'lsp-ui-mode))\n\n(use-package cquery\n  :load-path\n  \"path_to_cquery/emacs\"\n  :config\n  (setq\n     cquery-executable \"path_to_cquery/build/app\"\n     cquery-resource-dir \"path_to_cquery/clang_resource_dir\"))\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u914d\u7f6e \u57fa\u4e8e Clang \u7684 \u5de5\u5177\u90fd\u9700\u8981\u7684 Compilation Database\u3002Sacrasm \u5bf9\u8fd9\u4e2a\u6709\u4e00\u4e2a\u975e\u5e38\u5b8c\u6574\u7684\u603b\u7ed3 \uff0c\u53ef\u4ee5\u67e5\u770b\u91cc\u9762\u7684\u65b9\u6cd5\u3002\u6211\u8fd9\u91cc\u63a8\u8350\u5728 CMake \u9879\u76ee\u4e2d\u7528 CMake \u81ea\u5e26\u7684\uff0c\u52a0\u4e0anickdiego/compiledb-generator \u5e94\u4ed8\u57fa\u4e8eMakefile/Autotools\u7684\u9879\u76ee\u3002\u5982\u679c\u90fd\u4e0d\u9002\u7528\uff0c\u5c31\u6309\u7167cquery\u7684README\u5199\u4e00\u4e2a\u7b80\u5355\u7684.cquery\u6587\u4ef6\u5373\u53ef\uff0c\u4e0d\u9700\u8981Bear\u90a3\u79cd\u5fc5\u987b\u5173\u95edSIP\u7684\u65b9\u6848\u3002</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u4eab\u53d7\u5f88\u591a\u529f\u80fd\u4e86\uff01\u8fd8\u662f\u633a\u597d\u7528\u7684\u3002</p>","tags":["lsp","cpp","clang","compilation_database","cquery","clangd"]},{"location":"programming/2018/01/30/more-on-scanf-and-scanf_s/","title":"\u518d\u6b21\u5410\u69fd VS \u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898","text":"<p>\u7ee7\u4e0a\u6b21\u7684\u5410\u69fd\u540e\uff0c\u4eca\u5929\u518d\u6b21\u9047\u5230\u540c\u5b66\u56e0\u4e3a <code>scanf</code> \u5728 VS \u4e0b\u7684 <code>deprecation error</code> \u611f\u5230\u5341\u5206\u8ff7\u832b\uff0c\u5728\u77e5\u4e4e\u4e0a\u6c42\u52a9\u53c8\u56e0\u4e3a\u62cd\u7167\u7684\u539f\u56e0\u88ab\u8bf4\uff0c\u6211\u5c31\u5728\u6b64\u518d\u6b21\u5410\u69fd\u4e00\u4e0b VS \u8fd9\u5bf9\u521d\u5b66\u8005\u5f88\u4e0d\u53cb\u5584\u5f88\u4e0d\u53cb\u5584\u7684\u4e24\u70b9\u3002</p> <p>\u4e00\u70b9\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u8fd9\u4e2a\uff0c\u53e6\u4e00\u70b9\u5c31\u662f\u7a0b\u5e8f\u7ed3\u675f\u540e\u4efb\u610f\u952e\u4ee5\u9000\u51fa\u8fd9\u4e00\u529f\u80fd\u8981\u505a\u5f97\u66f4\u52a0\u9192\u76ee\u4e00\u70b9\u3002\u524d\u8005\u7531\u4e8e\u5927\u591a\u6570\u65b0\u624b\u5728\u5b66\u4e60 <code>C/C++</code> \u7684\u65f6\u5019\u90fd\u4f1a\u8ddf\u7740\u4e66\u4e0a\u6216\u8005\u7f51\u4e0a\u7684\u4ee3\u7801\u6572\u4e00\u904d\u8f93\u5165\u8f93\u51fa\u7684\u4ee3\u7801\uff0c\u5f88\u5bb9\u6613\u5c31\u4f1a\u649e\u5230\u8fd9\u4e2a\u95ee\u9898\u3002\u540e\u8005\u5219\u4f1a\u8ba9\u65b0\u624b\u4e60\u60ef\u6027\u5730\u4ee5\u4e3a\u7a0b\u5e8f\u95ea\u9000\u4e86\uff0c\u6ca1\u6709\u51fa\u7ed3\u679c\uff0c\u800c\u4e0d\u77e5\u9053\u5176\u5b9e\u662f\u7a0b\u5e8f\u6267\u884c\u7ed3\u675f\u540e\u5173\u95ed\u800c\u5df2\u3002</p>","tags":["vs","c","cs","c++"]},{"location":"programming/2019/02/26/network-driver-again/","title":"\u4f7f\u7528 Rust \u5b9e\u73b0 e1000 \u9a71\u52a8","text":"<p>\u662f\u7684\u3002\u6211\u53c8\u6765\u4e86\u3002\u4e0a\u6b21\u505a\u4e86\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8\u4e4b\u540e\uff0c\u7ee7\u7eed\u5f80 rCore \u52a0\u66f4\u591a\u7684\u9a71\u52a8\u652f\u6301\u3002\u7531\u4e8e\u73b0\u5728\u5de5\u4f5c\u91cd\u70b9\u662f x86_64 \u4e0b\u7684 syscall \u5b9e\u73b0\uff0c\u6240\u4ee5\u9009\u4e86\u4e00\u4e2a\u6bd4\u8f83\u6709\u4ee3\u8868\u6027\u7684\u9a71\u52a8 e1000 \u6765\u5b9e\u73b0\u3002\u5176\u5b9e\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u5728 qemu \u4e0b\u8fd0\u884c\u7684\u8bdd\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u652f\u6301 virtio-pci \u5c31\u53ef\u4ee5\u4e86\uff0c\u539f\u6765\u7684 virtio-net \u76f4\u63a5\u62ff\u6765\u7528\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6311 e1000 \u5462\uff0c\u4e00\u65b9\u9762\u662f\u652f\u6301\u7684\u8bbe\u5907\u591a\uff0c\u6709\u771f\u5b9e\u786c\u4ef6\u53ef\u4ee5\u6d4b\u8bd5\uff0c\u867d\u7136\u4e0d\u4e00\u5b9a\u8981\u88f8\u673a\u4e0a\u8dd1\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 PCI passthrough \u6765\u6d4b\u8bd5\u9a71\u52a8\u7684\u6b63\u786e\u6027\u3002\u53e6\u4e00\u65b9\u9762\u662f\u7f51\u4e0a\u7684\u8d44\u6599\u6bd4\u8f83\u591a\uff0c\u6709\u73b0\u6210\u7684\u7b80\u5355\u7684\u4ee3\u7801\u53ef\u4ee5\u501f\u9274\u3002\u8fd9\u6b21\u4e3b\u8981\u501f\u9274\u4e86\u4e09\u4e2a\u6765\u6e90\uff1a\u4e00\u662f Biscuit OS\uff0c\u4e8c\u662f Judge Duck OS\uff0c\u4e09\u662f Linux\u3002</p> <p>\u9996\u5148\u662f\u5b9e\u73b0\u4e86\u7b80\u5355\u7684 PCI \u603b\u7ebf\u7684\u679a\u4e3e\uff0c\u7136\u540e\u627e\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\uff0c\u6fc0\u6d3b\uff0c\u5e76\u4e14\u627e\u5230\u6620\u5c04\u7684\u5185\u5b58\u5730\u5740\uff0c\u7136\u540e\u628a\u539f\u6765 C \u8bed\u8a00\u7684\u5b9e\u73b0\u642c\u8fd0\u5230 Rust \u4e2d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9047\u5230\u5f88\u591a\u5751\uff0c\u4f8b\u5982\u4e00\u5f00\u59cb\u6211\u4ee5\u4e3a\u5185\u6838\u91cc pa \u548c va \u662f\u4e00\u4e2a\u56fa\u5b9a\u7684\u504f\u79fb\uff0c\u4e0d\u8fc7\u591a\u6b21\u5c1d\u8bd5\u540e\u624d\u53d1\u73b0\u8fd9\u4e2a\u5047\u8bbe\u53ea\u5bf9 riscv \u5e73\u53f0\u91cc\u7684\u5b9e\u73b0\u6210\u7acb\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u6536\u5230\u5916\u9762\u7ed9\u8fdb\u6765\u7684\u4ee5\u592a\u7f51\u5e27\u4e86\u3002\u63a5\u7740\u5c31\u662f\u628a\u5b83\u63a5\u5165\u5230 smoltcp \u7684 API \u4e2d\u3002\u4f46\u662f\u53d1\u5305\u53c8\u4e0d\u5de5\u4f5c\u4e86\uff0c\u5c1d\u8bd5\u4e86\u5f88\u591a\u6b21\uff0c\u5404\u79cd\u65b9\u6cd5\u4e5f\u4e0d\u884c\u3002\u5176\u4e2d\u7279\u522b\u8981\u63d0\u5230\u7684\u5c31\u662f qemu \u7684 tracing API\uff0c\u5b83\u5728\u5e2e\u52a9\u6211\u8c03\u8bd5\u4e4b\u524d\u7684 virtio \u9a71\u52a8\u548c\u8fd9\u6b21\u7684 e1000(e) \u9a71\u52a8\u4e2d\u8d77\u5230\u4e86\u5f88\u5927\u7684\u5e2e\u52a9\u3002\u4e0d\u8fc7\uff0c\u9057\u61be\u7684\u662f\uff0c\u53d1\u5305\u76f8\u5173\u7684\u4ee3\u7801\u91cc\u7684 trace \u4e0d\u8db3\u4ee5\u8ba9\u6211\u627e\u5230\u95ee\u9898\u7684\u6240\u5728\uff0c\u6211\u53ea\u597d\u91c7\u7528\u4e86\u6700\u540e\u4e00\u62db\uff1a</p> <p>\u4e0b\u8f7d QEMU\uff0c\u81ea\u5df1\u6539\uff0c\u7136\u540e\u81ea\u5df1\u7f16\u8bd1\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u679c\u7136\u5f88\u6709\u6548\u554a\uff0c\u7ecf\u8fc7\u7b80\u5355\u7684\u51e0\u4e2a\u4fee\u6539\uff0c\u5f88\u5feb\u5c31\u5b9a\u4f4d\u5230\u95ee\u9898\u6240\u5728\u4e86\uff0c\u539f\u6765\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u9519\u8bef\uff0c\u628a 4 \u5199\u6210\u4e86 8\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6211\u4e5f\u53d1\u73b0 QEMU \u5728 incremental build \u7684\u65f6\u5019\u4f3c\u4e4e\u4f1a segfault\uff0c\u6211\u6ca1\u7ba1\u8fd9\u4e48\u591a\uff0c\u53cd\u6b63\u7f16\u8bd1\u4e5f\u4e0d\u6162\uff0c\u6b21\u6570\u4e5f\u4e0d\u591a\uff0c\u6bcf\u6b21 clean \u518d build \u95ee\u9898\u4e5f\u4e0d\u5927\u3002</p> <p>\u63a5\u4e0b\u6765\u8981\u6478\u7d22 82559 \u7684\u7f51\u5361\u9002\u7528\u60c5\u51b5\u5982\u4f55\uff0c\u56e0\u4e3a\u6709\u4e00\u4e2a\u771f\u5b9e\u7684 82559 \u7f51\u5361\u53ef\u4f9b\u6d4b\u8bd5\u3002\u53e6\u4e00\u65b9\u9762\u5c31\u8981\u5f00\u59cb\u8003\u8651 socket \u90a3\u4e00\u5957 syscall \u600e\u4e48\u505a\u4e86\u3002</p>","tags":["rcore","rust","os","e1000"]},{"location":"programming/2016/02/16/news/","title":"News","text":"<p>Oh StartSSL places its PKI in 360's server. You know, i hate 360. SO please beware if the website is using StartSSL. Here is the link.</p> <p>And here comes the vim-tips: <pre><code>You probably know that 'u' is undo. Do you know that Ctrl-R is redo?\n</code></pre> It comes from here.</p>","tags":["security","ca","twitter","tips","vim"]},{"location":"programming/2018/06/10/nginx-php-upload-size-limit/","title":"\u8c03\u6574 Nginx \u548c PHP \u7684\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236","text":"<p>\u4e4b\u524d\u8fc1\u79fb\u7684 MediaWiki\uff0c\u6709\u4eba\u63d0\u51fa\u8bf4\u65e0\u6cd5\u4e0a\u4f20\u4e00\u4e2a 1.4M \u7684\u6587\u4ef6\u3002\u6211\u53bb\u770b\u4e86\u4e00\u4e0b\u7f51\u7ad9\uff0c\u4e0a\u9762\u5199\u7684\u662f\u9650\u5236\u5728 2M\uff0c\u4f46\u662f\u4e00\u4e0a\u4f20\u5c31\u8bf4 Entity Too Large\uff0c\u65e0\u6cd5\u4e0a\u4f20\u3002\u540e\u6765\u7ecf\u8fc7\u7814\u7a76\uff0c\u662f Nginx \u5bf9 POST \u7684\u5927\u5c0f\u8fdb\u884c\u4e86\u9650\u5236\uff0c\u540c\u65f6 PHP \u4e5f\u6709\u9650\u5236\u3002</p> <p>Nginx \u7684\u8bdd\uff0c\u53ef\u4ee5\u5728 nginx.conf \u7684 http \u4e2d\u6dfb\u52a0\uff0c\u4e5f\u53ef\u4ee5\u5728 server \u6216\u8005 location \u4e2d\u52a0\u5165\u8fd9\u4e48\u4e00\u884c\uff1a</p> <pre><code>client_max_body_size 100m;\n</code></pre> <p>\u6211\u7684\u5efa\u8bae\u662f\uff0c\u5c3d\u91cf\u7f29\u5c0f\u8303\u56f4\u5230\u9700\u8981\u7684\u5730\u65b9\uff0c\u5373 location &gt; server &gt; http\u3002</p> <p>\u5728 PHP \u4e2d\uff0c\u5219\u4fee\u6539 /etc/php/7.0/fpm/php.ini\uff1a</p> <pre><code>post_max_size = 100M\n</code></pre> <p>\u56de\u5230 MediaWiki \u7684\u4e0a\u4f20\u9875\u9762\uff0c\u53ef\u4ee5\u770b\u5230\u663e\u793a\u7684\u5927\u5c0f\u9650\u5236\u81ea\u52a8\u53d8\u6210\u4e86 100M\uff0c\u8fd9\u4e2a\u662f\u4ece PHP \u7684\u914d\u7f6e\u4e2d\u76f4\u63a5\u83b7\u5f97\u7684\u3002</p>","tags":["nginx","php","mediawiki"]},{"location":"programming/2018/06/08/nodejs-experiences/","title":"\u6700\u8fd1\u5199 Node.js \u9047\u5230\u7684\u82e5\u5e72\u5751","text":"<p>\u6700\u8fd1\u5728\u505a\u524d\u540e\u7aef\u5206\u79bb\uff0c\u524d\u7aef\u5728\u7528 Vue.js \u9010\u6b65\u91cd\u5199\uff0c\u540e\u7aef\u5219\u53d8\u4e3a api \u7684\u5f62\u5f0f\u3002\u540c\u65f6\uff0c\u6211\u5c1d\u8bd5\u4e86\u7528 autocannon \u548c clinic \u5de5\u5177\u6d4b\u8bd5\u81ea\u5df1\u7684 api endpoint \u7684\u6027\u80fd\uff0c\u4e00\u5f00\u59cb\u53d1\u73b0\u6709\u51e0\u4e2a\u5ef6\u8fdf\u4f1a\u7279\u522b\u9ad8\uff0c\u5373\u4f7f\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u7684 api \u4e5f\u6709\u4e0d\u6b63\u5e38\u7684\u9ad8\u5ef6\u8fdf\u3002</p> <p>\u4e8e\u662f\uff0c\u6211\u7528 clinic \u751f\u6210\u4e86 flamegraph\uff0c\u53d1\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ol> <li>\u6211\u5728 session \u91cc\u4fdd\u5b58\u4e86\u4e00\u4e9b\u7f13\u5b58\u7684\u4fe1\u606f\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u6bd4\u8f83\u5927\uff0cexpress-session \u5728\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u524d\u4f1a\u5148 JSON.stringify \u518d crc \u5224\u65ad\u662f\u5426\u6709\u6539\u53d8\uff0c\u5982\u679c\u6709\u6539\u53d8\u5219\u4fdd\u5b58\u4e0b\u6765\u3002\u4f46\u662f\u7531\u4e8e\u6211\u7684\u8fd9\u4e2a\u5bf9\u8c61\u5d4c\u5957\u5c42\u6570\u591a\uff0c\u6240\u4ee5\u65f6\u95f4\u82b1\u5f97\u5f88\u591a\u3002\u6211\u8c03\u6574\u4e86\u8fd9\u4e2a\u5bf9\u8c61\u7684\u7ed3\u6784\uff0c\u7f29\u5c0f\u4e86\u5f88\u591a\u4ee5\u540e\uff0c\u679c\u7136\u8fd9\u90e8\u5206\u5feb\u4e86\u5f88\u591a</li> <li>\u6709\u4e00\u4e2a API \u9700\u8981\u5927\u91cf\u7684\u6570\u636e\u5e93\u67e5\u8be2\uff0c\u539f\u672c\u662f O\uff08\u7ed3\u70b9\u603b\u6570\uff09\u6b21\u67e5\u8be2\uff0c\u6211\u8003\u8651\u5230\u6211\u4eec\u6570\u636e\u7684\u7ed3\u6784\uff0c\u6539\u6210\u4e86 O\uff08\u6df1\u5ea6\uff09\uff0c\u679c\u7136\u5feb\u4e86\u8bb8\u591a</li> <li>\u4e4b\u524d\u9047\u5230\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u5c31\u662f\u5373\u4f7f\u6211\u6ca1\u6709\u767b\u5f55\uff0c\u670d\u52a1\u5668\u4e5f\u4f1a\u8bb0\u5f55 session \u5e76\u4e14\u8fd4\u56de\u4e00\u4e2a cookie\u3002\u68c0\u67e5\u4ee5\u540e\u53d1\u73b0\uff0c\u662f connect-flash \u5373\u4f7f\u5728\u6ca1\u6709\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u5f80 cookie \u4e2d\u5199\u5165\u4e00\u4e2a\u7a7a\u7684\u5bf9\u8c61\uff0c\u8fd9\u5c31\u5bfc\u81f4 express-session \u8ba4\u4e3a\u9700\u8981\u4fdd\u5b58\uff0c\u6240\u4ee5\u51fa\u73b0\u4e86\u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6848\u5c31\u662f\uff0c\u6362\u6210\u4e86\u5b83\u7684\u4e00\u4e2a fork\uff1aconnect-flash-plus\uff0c\u5b83\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898</li> </ol>","tags":["nodejs","mongodb","mongoose","session"]},{"location":"programming/2017/12/02/on-nginx-memory-pool/","title":"Nginx \u7684\u5185\u5b58\u6c60\u5b9e\u73b0","text":"<p>\u4eca\u665a\u53c2\u52a0\u4e86 Tunight\uff0c\u4f1a\u957f\u7ed9\u6211\u4eec\u8bb2\u4e86 Nginx \u7684\u4e00\u4e9b\u5185\u90e8\u8fd0\u4f5c\u7684\u673a\u5236\u548c\u539f\u7406\u3002\u4e2d\u95f4\u7684\u65f6\u5019\uff0c\u4f1a\u957f\u5c55\u793a\u7684\u4ee3\u7801\u4e2d\u7528\u5230\u4e86\u7ebf\u7a0b\u6c60\u65b9\u9762\u7684\u4e00\u4e9b\u51fd\u6570\uff0c\u4f46\u662f\u5927\u591a\u5730\u65b9\u53ea\u6709\u8c03\u7528 <code>ngx_pcalloc</code> \u800c\u6ca1\u6709\u770b\u5230\u76f8\u5e94\u7684\u5bf9\u8c61\u91ca\u653e\u7684\u8fc7\u7a0b\uff0c\u4e8e\u662f\u5728\u6f14\u793a\u7684\u6700\u540e\uff0c\u4f1a\u957f\u5e94\u5927\u5bb6\u8981\u6c42\u5bf9 Nginx \u9b54\u5e7b\u7684\u5185\u5b58\u6c60\u5b9e\u73b0\u505a\u4e86\u73b0\u573a\u4ee3\u7801\u5206\u6790\u3002</p> <p>\u5728\u5206\u6790\u7684\u4e2d\u9014\u9047\u5230\u4e86\u5f88\u591a\u5751\uff0c\u6700\u540e\u624d\u7ec8\u4e8e\u7406\u6e05\u4e86\u5185\u5b58\u6c60\u7684\u5de5\u4f5c\u539f\u7406\u3002\u8fd9\u91cc\u76f4\u63a5\u89e3\u91ca\u7ed3\u8bba\u5427\u3002\u4ee5\u4e0b\u4ee3\u7801\u5747\u6458\u81ea Nginx 1.13.7\uff0c\u4ee3\u7801\u90fd\u53ef\u4ee5\u5728\u5b98\u65b9\u4ed3\u5e93\u627e\u5230\u3002</p> <p>\u9996\u5148\u5206\u6790\u4e00\u4e0b\u521b\u5efa\u4e00\u4e2a\u5185\u5b58\u6c60\u7684\u51fd\u6570\uff1a <pre><code>ngx_pool_t *\nngx_create_pool(size_t size, ngx_log_t *log)\n{\n    ngx_pool_t  *p;\n\n    p = ngx_memalign(NGX_POOL_ALIGNMENT, size, log);\n    if (p == NULL) {\n        return NULL;\n    }\n\n    p-&gt;d.last = (u_char *) p + sizeof(ngx_pool_t);\n    p-&gt;d.end = (u_char *) p + size;\n    p-&gt;d.next = NULL;\n    p-&gt;d.failed = 0;\n\n    size = size - sizeof(ngx_pool_t);\n    p-&gt;max = (size &lt; NGX_MAX_ALLOC_FROM_POOL) ? size : NGX_MAX_ALLOC_FROM_POOL;\n\n    p-&gt;current = p;\n    p-&gt;chain = NULL;\n    p-&gt;large = NULL;\n    p-&gt;cleanup = NULL;\n    p-&gt;log = log;\n\n    return p;\n}\n</code></pre></p> <p>\u73b0\u5728\u5f00\u59cb\u5206\u6bb5\u5206\u6790\u8fd9\u4e2a\u51fd\u6570\uff1a\u5728\u8fd9\u91cc\uff0c\u4e00\u4e2a\u5185\u5b58\u6c60\u7528\u4e00\u4e2a <code>ngx_pool_t (aka struct ngx_pool_s)</code> \u7c7b\u578b\u7684\u6570\u636e\u8fdb\u884c\u5305\u88c5\uff0c\u6240\u6709\u7684\u5173\u4e8e\u5185\u5b58\u6c60\u7684\u64cd\u4f5c\u90fd\u57fa\u4e8e\u76f8\u5e94\u7684\u5185\u5b58\u6c60\u5bf9\u8c61\u3002 <code>ngx_log_t</code> \u8868\u793a\u8f93\u51fa\u4fe1\u606f\u7684\u5bf9\u8c61\uff0c\u4e0e\u5185\u5b58\u6c60\u65e0\u5173\uff0c\u540e\u9762\u4e5f\u4e0d\u4f1a\u8ba8\u8bba\u5b83\u3002</p> <pre><code>    p = ngx_memalign(NGX_POOL_ALIGNMENT, size, log);\n    if (p == NULL) {\n        return NULL;\n    }\n\n    p-&gt;d.last = (u_char *) p + sizeof(ngx_pool_t);\n    p-&gt;d.end = (u_char *) p + size;\n    p-&gt;d.next = NULL;\n    p-&gt;d.failed = 0;\n</code></pre> <p>\u8fd9\u91cc\u901a\u8fc7\u8c03\u7528 <code>ngx_memalign</code> \u5206\u914d\u4e00\u6bb5\uff08\u80fd\u5bf9\u9f50\u5c31\u5bf9\u9f50\uff0c\u4e0d\u80fd\u5bf9\u9f50\u5c31\u653e\u5f03\u7684\uff09\u4ee5 size \u4e3a\u5927\u5c0f\u7684\u5185\u5b58\uff0c\u505a\u4e3a\u8fd9\u4e2a\u5185\u5b58\u6c60\u7b2c\u4e00\u4e2a\u5757\u7684\u5185\u5b58\uff0c\u8fd9\u4e2a\u5757\u7684\u5934\u662f\u5b8c\u6574\u7684\uff0c\u5176\u4e2d <code>p-&gt;d.last</code> \u548c <code>p-&gt;d.end</code> \u5206\u522b\u8868\u793a\u53ef\u7528\u4e8e\u5206\u914d\u5bf9\u8c61\u7684\u5185\u5b58\u6bb5\u7684\u5f00\u59cb\u548c\u7ed3\u675f\uff0c\u5728\u7528 <code>p-&gt;d.next</code> \u8fde\u63a5\u8d77\u6765\u7684\u94fe\u8868\u4e2d\uff0c\u6bcf\u4e2a\u94fe\u8868\u5b9e\u9645\u4e0a\u53ea\u6709 <code>d</code> \u662f\u5b58\u50a8\u4e86\u6570\u636e\uff0c\u540e\u9762\u7684\u5404\u4e2a\u57df\u90fd\u4e0d\u518d\u4f7f\u7528\u3002\u8fd9\u91cc\u7684 <code>p-&gt;d.failed</code> \u6d89\u53ca\u5230\u94fe\u8868\u7684\u4f18\u5316\uff0c\u5728\u4ee5\u540e\u4f1a\u63a5\u89e6\u5230\u3002</p> <pre><code>    size = size - sizeof(ngx_pool_t);\n    p-&gt;max = (size &lt; NGX_MAX_ALLOC_FROM_POOL) ? size : NGX_MAX_ALLOC_FROM_POOL;\n\n    p-&gt;current = p;\n    p-&gt;chain = NULL;\n    p-&gt;large = NULL;\n    p-&gt;cleanup = NULL;\n    p-&gt;log = log;\n\n    return p;\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>size</code> \u8ba1\u7b97\u51fa\u5b9e\u9645\u7528\u4e8e\u5bf9\u8c61\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\uff0c <code>p-&gt;max</code> \u5b58\u50a8\u4e86\u5f53\u524d\u8fd9\u4e2a\u5757\u6700\u5927\u80fd\u5bb9\u7eb3\u7684\u5bf9\u8c61\u7684\u5927\u5c0f\uff0c <code>p-&gt;current</code> \u4f1a\u548c\u4e0a\u9762\u7684 <code>p-&gt;d.failed</code> \u5408\u5728\u4e00\u8d77\u5bf9\u94fe\u8868\u8fdb\u884c\u4f18\u5316\u3002 <code>p-&gt;chain</code> \u4e0e\u5176\u4ed6\u529f\u80fd\u5173\u7cfb\u8f83\u5bc6\u5207\uff0c\u4e0d\u4f1a\u5728\u672c\u6587\u4e2d\u5c55\u5f00\uff0c\u800c <code>p-&gt;cleanup</code> \u5141\u8bb8\u5916\u90e8\u6ce8\u518c\u4e00\u4e9b\u6e05\u7406\u51fd\u6570\uff0c\u5b9e\u73b0\u8d77\u6765\u5e76\u4e0d\u96be\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7531\u4e8e <code>ngx_pnalloc</code> \u548c <code>ngx_pcalloc</code> \u90fd\u548c <code>ngx_palloc</code> \u76f8\u8fd1\uff0c\u8fd9\u91cc\u53ea\u5bf9 <code>ngx_palloc</code> \u8fdb\u884c\u5206\u6790\uff1a</p> <pre><code>void *\nngx_palloc(ngx_pool_t *pool, size_t size)\n{\n#if !(NGX_DEBUG_PALLOC)\n    if (size &lt;= pool-&gt;max) {\n        return ngx_palloc_small(pool, size, 1);\n    }\n#endif\n\n    return ngx_palloc_large(pool, size);\n}\n</code></pre> <p>\u8fd9\u91cc\u5206\u4e86\u4e24\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u8981\u5206\u914d\u7684\u5185\u5b58\u5927\u4e8e\u4e00\u4e2a\u5757\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u8fd9\u6bb5\u5185\u5b58\u5fc5\u987b\u8981\u5355\u72ec\u5206\u914d\u5355\u72ec\u7ef4\u62a4\uff0c\u6240\u4ee5\u8c03\u7528\u4e86 <code>ngx_palloc_large</code> \uff0c\u4e0b\u9762\u5bf9\u5176\u5206\u6790\uff1a</p> <pre><code>static void *\nngx_palloc_large(ngx_pool_t *pool, size_t size)\n{\n    void              *p;\n    ngx_uint_t         n;\n    ngx_pool_large_t  *large;\n\n    p = ngx_alloc(size, pool-&gt;log);\n    if (p == NULL) {\n        return NULL;\n    }\n\n    n = 0;\n\n    for (large = pool-&gt;large; large; large = large-&gt;next) {\n        if (large-&gt;alloc == NULL) {\n            large-&gt;alloc = p;\n            return p;\n        }\n\n        if (n++ &gt; 3) {\n            break;\n        }\n    }\n\n    large = ngx_palloc_small(pool, sizeof(ngx_pool_large_t), 1);\n    if (large == NULL) {\n        ngx_free(p);\n        return NULL;\n    }\n\n    large-&gt;alloc = p;\n    large-&gt;next = pool-&gt;large;\n    pool-&gt;large = large;\n\n    return p;\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>ngx_alloc</code> \u5c31\u662f\u5bf9 <code>malloc</code> \u7684\u7b80\u5355\u5c01\u88c5\uff0c\u76f4\u63a5\u5206\u914d\u4e00\u6bb5\u5185\u5b58\uff0c\u7136\u540e\u5411 <code>pool-&gt;large</code> \u4e2d\u4ee5 <code>ngx_pool_large_t</code> \u7ec4\u6210\u7684\u94fe\u8868\u4e2d\u63d2\u5165\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u5c0f\u4f18\u5316\uff1a\u56e0\u4e3a <code>ngx_pool_large_t</code> \u672c\u8eab\u4e5f\u8981\u5360\u7528\u5185\u5b58\uff0c\u4e3a\u4e86\u590d\u7528\u5df2\u7ecf\u88ab\u91ca\u653e\u7684 <code>ngx_pool_large_t</code> \uff0c\u5c1d\u8bd5\u94fe\u8868\u7684\u524d\u51e0\u9879\uff0c\u5982\u679c\u51e0\u9879\u4e2d\u90fd\u6ca1\u6709\u7a7a\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a <code>ngx_pool_large_t</code> \u672c\u8eab\u662f\u4e00\u4e2a\u5f88\u5c0f\u7684\u5bf9\u8c61\uff0c\u81ea\u7136\u53ef\u4ee5\u590d\u7528\u81ea\u5df1\u5728\u5185\u5b58\u6c60\u4e2d\u5206\u914d\u5bf9\u8c61\u7684\u65b9\u6cd5 <code>ngx_palloc_small</code> \uff0c\u7136\u540e\u628a\u5b83\u52a0\u5165\u5230 <code>pool-&gt;large</code> \u7684\u94fe\u8868\u7684\u7b2c\u4e00\u5411\u524d\u3002\u5982\u679c\u5f88\u5927\u7684\u5185\u5b58\u90fd\u5728\u5206\u914d\u540e\u5f88\u5feb\u91ca\u653e\uff0c\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u590d\u7528\u5f88\u591a\u7684 <code>ngx_pool_large_t</code> \u3002</p> <p>\u63a5\u4e0b\u6765\u5206\u6790 <code>ngx_palloc_small</code> \uff1a</p> <pre><code>static ngx_inline void *\nngx_palloc_small(ngx_pool_t *pool, size_t size, ngx_uint_t align)\n{\n    u_char      *m;\n    ngx_pool_t  *p;\n\n    p = pool-&gt;current;\n\n    do {\n        m = p-&gt;d.last;\n\n        if (align) {\n            m = ngx_align_ptr(m, NGX_ALIGNMENT);\n        }\n\n        if ((size_t) (p-&gt;d.end - m) &gt;= size) {\n            p-&gt;d.last = m + size;\n\n            return m;\n        }\n\n        p = p-&gt;d.next;\n\n    } while (p);\n\n    return ngx_palloc_block(pool, size);\n}\n</code></pre> <p>\u9996\u5148\uff0c\u4ece <code>pool-&gt;current</code> \u904d\u5386\uff08\u8fd9\u6837\u505a\u7684\u539f\u56e0\u4e0b\u9762\u4f1a\u63d0\u5230\uff09\u5df2\u6709\u7684\u5404\u4e2a\u5757\uff0c\u5bfb\u627e\u6709\u6ca1\u6709\u54ea\u4e2a\u5757\u80fd\u5bb9\u7eb3\u4e0b\u73b0\u5728\u9700\u8981\u7684\u5927\u5c0f\uff0c\u5982\u679c\u80fd\u5c31\u53ef\u4ee5\u8c03\u6574 <code>p-&gt;d.last</code> \u8fd4\u56de\uff0c\u5426\u5219\u5c31\u5206\u914d\u4e00\u4e2a\u65b0\u7684\u5757\u5230\u5185\u5b58\u6c60\u4e2d\uff0c\u518d\u4ece\u65b0\u7684\u5757\u4e2d\u5206\u914d\u9700\u8981\u7684\u5927\u5c0f\u7684\u5185\u5b58\u3002\u9700\u8981\u4e00\u63d0\u7684\u662f\uff0c\u5728\u8bbe\u8ba1\u4e2d\uff0c\u5c0f\u7684\u5bf9\u8c61\u662f\u968f\u7740\u6574\u4e2a\u5185\u5b58\u6c60\u7684\u9500\u6bc1\u800c\u88ab\u4e00\u8d77\u91ca\u653e\u7684\uff0c\u4e0d\u4f1a\u5728\u4e2d\u9014\u88ab\u91ca\u653e\uff0c\u800c\u5927\u7684\u5bf9\u8c61\u5c3d\u91cf\u8981\u7528\u5b8c\u5373\u91ca\u653e\u3002\u63a5\u4e0b\u6765\u5206\u6790 <code>ngx_palloc_block</code> \uff1a</p> <pre><code>static void *\nngx_palloc_block(ngx_pool_t *pool, size_t size)\n{\n    u_char      *m;\n    size_t       psize;\n    ngx_pool_t  *p, *new;\n\n    psize = (size_t) (pool-&gt;d.end - (u_char *) pool);\n\n    m = ngx_memalign(NGX_POOL_ALIGNMENT, psize, pool-&gt;log);\n    if (m == NULL) {\n        return NULL;\n    }\n\n    new = (ngx_pool_t *) m;\n\n    new-&gt;d.end = m + psize;\n    new-&gt;d.next = NULL;\n    new-&gt;d.failed = 0;\n\n    m += sizeof(ngx_pool_data_t);\n    m = ngx_align_ptr(m, NGX_ALIGNMENT);\n    new-&gt;d.last = m + size;\n\n    for (p = pool-&gt;current; p-&gt;d.next; p = p-&gt;d.next) {\n        if (p-&gt;d.failed++ &gt; 4) {\n            pool-&gt;current = p-&gt;d.next;\n        }\n    }\n\n    p-&gt;d.next = new;\n\n    return m;\n}\n</code></pre> <p>\u4e3a\u4e86\u8282\u7701\u5185\u5b58\uff0c\u7ed3\u6784\u4f53\u4e2d\u5e76\u6ca1\u6709\u8bb0\u5f55\u5b9e\u9645\u5206\u914d\u7684\u5185\u5b58\u5757\u7684\u5927\u5c0f\uff0c\u4e8e\u662f\u6839\u636e\u7b2c\u4e00\u4e2a\u5757\u7684\u5927\u5c0f\u5206\u914d\u5f53\u524d\u7684\u5757\uff0c\u867d\u7136\u8fd9\u91cc\u7528\u7684\u4e5f\u662f\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>ngx_pool_t</code> \u7ed3\u6784\u4f53\uff0c\u5b9e\u9645\u4e0a\u53ea\u7528\u5230\u4e86 <code>new-&gt;d</code> \u4e2d\u7684\u5185\u5bb9\u7ef4\u62a4\u5757\u7ec4\u6210\u7684\u94fe\u8868\u548c\u5757\u5185\u7684\u5206\u914d\u60c5\u51b5\u3002\u7136\u540e\u4ece <code>pool-&gt;current</code> \u5f00\u59cb\u627e\u5757\u7684\u94fe\u8868\u7684\u7ed3\u5c3e\uff0c\u627e\u5230\u8282\u5c3e\u540e\u628a\u5f53\u524d\u7684\u5757\u52a0\u5230\u7ed3\u5c3e\u7684\u540e\u9762\uff0c\u7136\u540e\u628a\u521a\u624d\u9700\u8981\u5206\u914d\u7684\u5c0f\u5bf9\u8c61\u7684\u5730\u5740\u8fd4\u56de\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u7531\u4e8e\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u662f\u5f53\u524d\u7684\u5bf9\u8c61\u5728\u5df2\u6709\u7684\u4ece <code>pool-&gt;current</code> \u5f00\u59cb\u7684\u5757\u4e2d\u90fd\u653e\u4e0d\u4e0b\u4e86\uff0c\u6211\u4eec\u7ed9\u8fd9\u4e9b\u5757\u7684 <code>p-&gt;d.failed</code> \u8fdb\u884c\u81ea\u589e\uff0c\u610f\u601d\u662f\u8bf4\u8fd9\u4e2a\u5757\u5728\u5206\u914d\u65b0\u7684\u5bf9\u8c61\u7684\u65f6\u5019\u53c8\u4e00\u6b21\u653e\u4e0d\u4e0b\u4e86\uff0c\u5982\u679c\u653e\u4e0d\u4e0b\u7684\u6b21\u6570\u6bd4\u8f83\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u4e2a\u5757\u5df2\u7ecf\u88c5\u5f97\u6bd4\u8f83\u6ee1\u4e86\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u628a <code>pool-&gt;current</code> \u8bbe\u4e3a\u5b83\u7684\u540e\u7ee7\uff0c\u4ee5\u540e\u5728\u5206\u914d\u65b0\u7684\u5bf9\u8c61\u7684\u65f6\u5019\u5c31\u4f1a\u81ea\u52a8\u8df3\u8fc7\u8fd9\u4e9b\u6bd4\u8f83\u6ee1\u7684\u5757\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u6548\u7387\u3002</p> <pre><code>ngx_int_t\nngx_pfree(ngx_pool_t *pool, void *p)\n{\n    ngx_pool_large_t  *l;\n\n    for (l = pool-&gt;large; l; l = l-&gt;next) {\n        if (p == l-&gt;alloc) {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&gt;log, 0,\n                           \"free: %p\", l-&gt;alloc);\n            ngx_free(l-&gt;alloc);\n            l-&gt;alloc = NULL;\n\n            return NGX_OK;\n        }\n    }\n\n    return NGX_DECLINED;\n}\n</code></pre> <p>\u4ece <code>ngx_pfree</code> \u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u51fa\uff0c\u53ea\u6709\u5927\u7684\u5bf9\u8c61\u624d\u4f1a\u8981\u6c42\u5c3d\u5feb\u91ca\u653e\uff0c\u5c0f\u7684\u5bf9\u8c61\u548c\u6ca1\u6709\u88ab\u624b\u52a8\u91ca\u653e\u7684\u5927\u7684\u5bf9\u8c61\u90fd\u4f1a\u968f\u7740\u5185\u5b58\u6c60\u751f\u547d\u5468\u671f\u7684\u7ed3\u675f\u800c\u4e00\u8d77\u91ca\u653e\u3002\u5982 <code>ngx_destroy_pool</code> \u4e2d\u7684\u5b9e\u73b0\uff1a</p> <pre><code>void\nngx_destroy_pool(ngx_pool_t *pool)\n{\n    ngx_pool_t          *p, *n;\n    ngx_pool_large_t    *l;\n    ngx_pool_cleanup_t  *c;\n\n    for (c = pool-&gt;cleanup; c; c = c-&gt;next) {\n        if (c-&gt;handler) {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&gt;log, 0,\n                           \"run cleanup: %p\", c);\n            c-&gt;handler(c-&gt;data);\n        }\n    }\n\n#if (NGX_DEBUG)\n\n    /*\n     * we could allocate the pool-&gt;log from this pool\n     * so we cannot use this log while free()ing the pool\n     */\n\n    for (l = pool-&gt;large; l; l = l-&gt;next) {\n        ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&gt;log, 0, \"free: %p\", l-&gt;alloc);\n    }\n\n    for (p = pool, n = pool-&gt;d.next; /* void */; p = n, n = n-&gt;d.next) {\n        ngx_log_debug2(NGX_LOG_DEBUG_ALLOC, pool-&gt;log, 0,\n                       \"free: %p, unused: %uz\", p, p-&gt;d.end - p-&gt;d.last);\n\n        if (n == NULL) {\n            break;\n        }\n    }\n\n#endif\n\n    for (l = pool-&gt;large; l; l = l-&gt;next) {\n        if (l-&gt;alloc) {\n            ngx_free(l-&gt;alloc);\n        }\n    }\n\n    for (p = pool, n = pool-&gt;d.next; /* void */; p = n, n = n-&gt;d.next) {\n        ngx_free(p);\n\n        if (n == NULL) {\n            break;\n        }\n    }\n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u9996\u5148\u8c03\u7528\u4e86\u4e00\u7cfb\u5217\u7528\u6237\u5b9a\u4e49\u7684 <code>pool-&gt;cleanup</code> \u94fe\u8868\u4e2d\u7684\u51fd\u6570\uff0c\u5141\u8bb8\u81ea\u5b9a\u4e49\u56de\u6536\u4e00\u4e9b\u7279\u5b9a\u7684\u8d44\u6e90\u3002\u7136\u540e\u5bf9\u6bcf\u4e00\u4e2a <code>pool-&gt;large</code> \u94fe\u8868\u4e2d\u7684\u5185\u5bb9\u5206\u522b\u91ca\u653e\uff0c\u6700\u540e\u518d\u628a\u5404\u4e2a\u5757\u4e2d\u6240\u6709\u7684\u5185\u5b58\u6574\u5757\u91ca\u653e\u3002\u6ce8\u610f <code>ngx_large_block_t</code> \u4e5f\u662f\u5b58\u5728\u5757\u4e2d\u7684\uff0c\u6240\u4ee5\u987a\u5e8f\u4e0d\u80fd\u53cd\u4e86\u3002</p>"},{"location":"programming/2017/10/17/on-scanf-and-scanf_s/","title":"\u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898","text":"<p>\u6700\u8fd1\u4f5c\u4e3a\u7a0b\u8bbe\u57fa\u7840\u7684\u5c0f\u6559\u5458\uff0c\u6536\u5230\u5f88\u591a\u540c\u5b66\u7684\u6c42\u52a9\uff0c\u5173\u4e8e<code>scanf</code>\u548c<code>scanf_s</code>\u7684\u95ee\u9898\u5df2\u7ecf\u9047\u5230\u4e86\u4e24\u6b21\uff0c\u7279\u6b64\u5199\u4e00\u7bc7\u535a\u6587\u6765\u53d9\u8ff0\u4e00\u4e0b\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4e00\u5f00\u59cb\uff0c\u6709\u540c\u5b66\u95ee\u6211\uff0c <pre><code>char a;\nscanf(\"%c\",&amp;a);\n</code></pre> \u4e3a\u4ec0\u4e48\u4f1a\u62a5\u9519\uff1f\u6211\u8bf4\uff0cvs \u9ed8\u8ba4\u5f3a\u5236\u8981\u6c42\u4f7f\u7528 scanf_s \u51fd\u6570\uff0c\u4e8e\u662f\u6211\u5efa\u8bae\u8fd9\u4f4d\u540c\u5b66\u628a\u8fd9\u4e2a\u9519\u8bef\u4fe1\u606f\u5173\u6389\u4e86\u3002\u55ef\u3002\u7ecf\u8fc7\u767e\u5ea6\uff0c\u8fd9\u4f4d\u540c\u5b66\u7684\u95ee\u9898\u89e3\u51b3\u4e86\u3002</p> <p>\u540e\u6765\uff0c\u53c8\u6709\u4e00\u4f4d\u540c\u5b66\u95ee\u6211\uff0c <pre><code>char a;\nscanf_s(\"%c\",&amp;a);\n</code></pre> \u7a0b\u5e8f\u4e3a\u4ec0\u4e48\u4f1a\u5d29\u6e83\uff1f\u6211\u60f3\u4e86\u60f3\uff0c\u5982\u679c scanf_s \u548c scanf \u662f\u4e00\u6837\u7684\u884c\u4e3a\uff0c\u8fd9\u6bb5\u4ee3\u7801\u662f\u6ca1\u95ee\u9898\u7684\u3002\u4f46 scanf_s \u65e2\u7136\u5b89\u5168\uff0c\u5fc5\u7136\u662f\u5728\u5b57\u7b26\u4e32\u65b9\u9762\u505a\u4e86\u5904\u7406\u3002\u8fd9\u91cc\u7684 char*\u52c9\u5f3a\u4e5f\u7b97\u4e00\u4e2a\uff1f\u7f51\u4e0a\u4e00\u67e5\uff0c\u679c\u7136\uff0c\u5e94\u8be5\u5199\u6210<code>scanf_s(\"%c\",&amp;a,1);</code>\uff0c\u5b57\u7b26\u4e32\u5219\u8981\u5199\u6210<code>scanf_s(\"%s\",str,sizeof(str))</code>\uff0c\u6765\u4fdd\u8bc1\u7f13\u51b2\u533a\u4e0d\u4f1a\u6ea2\u51fa\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u6837\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u53c8\u9762\u4e34\u7740\u4e0d\u540c\u7684\u9009\u62e9\uff1a</p> <ol> <li>\u5b66\u4e60<code>scanf_s</code>\u548c<code>scanf</code>\u7684\u4e0d\u540c\uff0c\u628a\u6240\u6709<code>scanf</code>\u6362\u6210<code>scanf_s</code>\u5e76\u505a\u76f8\u5e94\u7684\u4fee\u6539\u3002    \u8fd9\u6837\u5f53\u7136\u7b26\u5408\u4e86\u8bed\u8a00\u8fdb\u5316\u7684\u6f6e\u6d41\uff0c\u4e5f\u4f1a\u8ba9 vs \u95ed\u5634\u3002\u4f46\u662f\uff0cscanf_s \u53ea\u6709\u5728 C11 \u6807\u51c6\u4e2d\u6709\uff0c\u800c\u4e14\uff0c\u6839\u636ecpprefrence.com \u4e0a\u5173\u4e8e scanf \u7684\u63cf\u8ff0\uff0c\u53ea\u6709\u5728<code>__STDC_LIB_EXT1__</code>\u88ab\u5b9a\u4e49\u4e14\u5728<code>#include&lt;stdio.h&gt;</code>\u4e4b\u524d<code>#define __STDC_WANT_LIB_EXT1__</code>\u624d\u80fd\u786e\u4fdd\u4f7f\u7528<code>scanf_s</code>\u80fd\u4f7f\u7528\uff0c\u5f53\u7136\u5728 vs \u8f83\u65b0\u7248\u672c\u4e2d\u662f\u9ed8\u8ba4\u53ef\u4ee5\u4f7f\u7528\u7684\u3002\u4f46\u662f\uff0c\u7a0b\u8bbe\u57fa\u7840\u7684\u4f5c\u4e1a\u662f\u8981\u4e22\u5230 oj \u4e0a\u7684\uff0c\u800c oj \u4e0a\u7684\u7f16\u8bd1\u5668\u4e0d\u4e00\u5b9a\u652f\u6301\u8fd9\u4e9b\uff0c\u6240\u4ee5\u8fd9\u4e2a\u9009\u9879\u4e0d\u884c\u3002</li> <li>\u575a\u6301\u7528<code>scanf</code>\uff0c\u81ea\u5df1\u6309\u7167\u9898\u76ee\u8981\u6c42\u4fdd\u8bc1\u7f13\u51b2\u533a\u4e0d\u6ea2\u51fa\uff0c\u540c\u65f6\u8ba9 vs \u95ed\u5634\u3002    \u7f51\u4e0a\u5df2\u6709\u6559\u7a0b\uff0c\u5df2\u7ecf\u8bb2\u7684\u5f88\u5168\u9762\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u6559\u7a0b\u628a vs \u6559\u8bad\u4e00\u987f\u3002\u4e3a\u4e86\u80fd\u5728 oj \u91cc\u8dd1\uff0c\u5efa\u8bae\u7528\u91cc\u9762\u7684\u65b9\u6cd5\u4e94\u5230\u516b\u3002\uff08\u4e2a\u4eba\u6700\u63a8\u8350\u5728\u6587\u4ef6\u5934\u6dfb\u52a0<code>#define _CRT_SECURE_NO_WARNINGS</code>\uff09</li> </ol> <p>\u4ee5\u540e\u518d\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u5c31\u4e22\u8fd9\u4e2a\u8fde\u63a5\u4e0a\u6765\u5c31\u597d\u4e86\u54af\u3002yeah\uff01</p>","tags":["vs","c","c++","cs"]},{"location":"programming/2019/07/17/parse-upload-csv-frontend/","title":"\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV","text":"<p>\u4e4b\u524d\u505a\u8fc7\u4e00\u4e2a\u5728\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV \u7684\u529f\u80fd\uff0c\u4f46\u662f\u53ea\u80fd\u652f\u6301\u90e8\u5206\u7684 encoding\uff0c\u9047\u5230 gbk \u5c31\u50bb\u773c\u4e86\u3002\u4e00\u756a\u7814\u7a76\u4ee5\u540e\uff0c\u627e\u5230\u4e86\u6bd4\u8f83\u79d1\u5b66\u7684\u65b9\u6848\uff1a</p> <pre><code>import * as Chardet from 'chardet';\nimport * as Iconv from 'iconv-lite';\n\nconst reader = new FileReader();\nreader.onload = (e) =&gt; {\n  const data = e.target.result;\n  const view = Buffer.from(data);\n  // detect encoding and convert\n  const encoding = Chardet.detect(view);\n  const result = Iconv.decode(view, encoding);\n  const csvData = Papa.parse(result).data;\n  // do anything with it\n};\n\nreader.readAsArrayBuffer(blob_here);\n</code></pre> <p>\u4f9d\u8d56\u4e86\u4e24\u4e2a\u5e93\uff1a<code>chardet</code> \u548c <code>iconv-lite</code> \uff0c\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u89e3\u6790 UTF-8 GBK UTF-16BE \u90fd\u6ca1\u95ee\u9898\u3002</p> <p>P.S. \u5728\u751f\u6210 csv \u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u51fa\u73b0 Excel \u6253\u5f00\u540e\u4e71\u7801\u7684\u95ee\u9898\uff0c\u4e00\u5f00\u59cb\u6211\u4ee5\u4e3a\u9700\u8981\u8f6c UTF-16 \u7136\u540e\u518d\u6dfb\u52a0 BOM Mark\uff0c\u540e\u6765\u53d1\u73b0\u53ea\u8981\u5728\u6700\u524d\u9762\u52a0\u4e0a 0xEF 0xBB 0xFB\uff08UTF-8 \u7f16\u7801\u4e0b\u7684 BOM Mark\uff09\u5373\u53ef\u3002</p>","tags":["js","frontend","iconv","encoding","gbk"]},{"location":"programming/2023/07/18/portable-script-across-bash-zsh-fish/","title":"\u5199\u4e00\u4e2a bash zsh \u548c fish \u90fd\u80fd\u8dd1\u7684\u811a\u672c","text":"","tags":["shell","bash","zsh","fish"]},{"location":"programming/2023/07/18/portable-script-across-bash-zsh-fish/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>bash \u548c zsh \u90fd\u5b9e\u73b0\u4e86 POSIX shell \u6807\u51c6\uff0c\u56e0\u6b64\u5199\u811a\u672c\u7684\u65f6\u5019\uff0c\u6bd4\u8f83\u5bb9\u6613\u517c\u5bb9\u8fd9\u4e24\u79cd\u5e38\u89c1\u7684 shell\u3002\u4f46\u73b0\u5728 fish \u4e5f\u5f88\u6d41\u884c\uff0c\u800c fish \u4e0d\u7b26\u5408 POSIX shell \u6807\u51c6\uff0c\u5f88\u591a\u5730\u65b9\u8bed\u6cd5\u591a\u4e0d\u517c\u5bb9\uff0c\u80fd\u5426\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u53ef\u4ee5\u7528 bash\uff0czsh \u548c fish \u8dd1\uff1f</p> <pre><code># The following commands should work\nbash test.sh\nzsh test.sh\nfish test.sh\n</code></pre>","tags":["shell","bash","zsh","fish"]},{"location":"programming/2023/07/18/portable-script-across-bash-zsh-fish/#\u7b80\u5355\u7248\u672c","title":"\u7b80\u5355\u7248\u672c","text":"<p>\u7b80\u5355\u7248\u672c\u662f\uff0c\u7ed9\u4e0d\u540c\u7684 shell \u5199\u4e0d\u540c\u7684\u7248\u672c\uff0c\u7136\u540e\u5199\u4e00\u4e2a\u5c0f\u7684\u901a\u7528\u7248\u672c\uff0c\u8d1f\u8d23\u6267\u884c\u4e0d\u540c\u7684\u7248\u672c\uff1a</p> <pre><code>type status &gt;/dev/null 2&gt;/dev/null &amp;&amp; exec fish ./code-fish.sh\ntype zstyle &gt;/dev/null 2&gt;/dev/null &amp;&amp; exec zsh ./code-zsh.sh\nexec bash ./code-bash.sh\n</code></pre> <p>\u539f\u7406\u662f\u5229\u7528 <code>type</code> \u5185\u7f6e\u547d\u4ee4\u5224\u65ad\u662f\u5426\u5b58\u5728\u67d0\u4e2a\u547d\u4ee4\uff1a<code>status</code> \u662f <code>fish</code> \u7279\u6709\u7684\uff0c<code>zstyle</code> \u662f <code>zsh</code> \u7279\u6709\u7684\uff0c\u5982\u679c\u5224\u65ad\u6210\u529f\uff0c\u5c31\u53bb\u6267\u884c\u76f8\u5e94\u7684\u811a\u672c\u3002\u56e0\u4e3a\u7528\u4e86 <code>exec</code>\uff0c\u6240\u4ee5\u5982\u679c\u6267\u884c\u5230 <code>exec</code>\uff0c\u540e\u9762\u7684\u4ee3\u7801\u5c31\u4e0d\u4f1a\u6267\u884c\u4e86\u3002</p>","tags":["shell","bash","zsh","fish"]},{"location":"programming/2023/07/18/portable-script-across-bash-zsh-fish/#\u590d\u6742\u7248\u672c","title":"\u590d\u6742\u7248\u672c","text":"<p>\u90a3\u4e48\uff0c\u5982\u679c\u5934\u94c1\uff0c\u60f3\u8981\u7528 <code>if-then-else</code> \u6765\u5b9e\u73b0\u5462\uff1f\u9996\u5148\uff0cPOSIX shell \u4e2d\u7684\u5199\u6cd5\u662f\uff1a</p> <pre><code>if expression\nthen\n        # do something\nelse\n        # do something\nfi\n</code></pre> <p>fish shell \u7684\u5199\u6cd5\u662f\uff1a</p> <pre><code>if expression\n    # do something\nelse\n    # do something\nend\n</code></pre> <p>\u8fd9\u5c31\u51fa\u73b0\u4e86\u77db\u76fe\uff1aPOSIX shell \u9700\u8981 <code>then</code> \u548c <code>fi</code>\uff0cfish shell \u9700\u8981\u7684\u662f <code>end</code>\u3002\u600e\u4e48\u529e\u5462\uff1f</p> <p>shell \u91cc\u9762\u6709\u4e00\u4e2a\u7279\u522b\u7684\u547d\u4ee4\uff1a<code>alias</code>\uff0c\u53ef\u4ee5\u7ed9\u547d\u4ee4\u8d77\u522b\u540d\u3002\u5982\u679c\u53ef\u4ee5\u8ba9 <code>then</code> \u548c <code>fi</code> \u5728 fish \u91cc\u9762\u53d8\u6210 no-op\uff0c\u8ba9 <code>end</code> \u5728 bash \u91cc\u53d8\u6210 no-op\uff0c\u90a3\u662f\u4e0d\u662f\u5c31\u597d\u4e86\uff1f</p> <p>\u6309\u7167\u8fd9\u4e2a\u601d\u8def\uff0c\u53ef\u4ee5\u5199\u51fa\u4e0b\u9762\u7684\u811a\u672c\uff1a</p> <pre><code>alias then=\"true\"\n\nif status current-command 2&gt;/dev/null | grep -q fish\nthen\n    echo \"I'm in fish\"\nelse\n    echo \"I'm in bash\"\nfi\nexit 0\nend\n</code></pre> <p>\u8fd9\u91cc\u5229\u7528\u5230\u4e00\u70b9\uff1aBash \u770b\u5230 <code>then</code> \u7684\u65f6\u5019\uff0c\u662f\u4e0d\u4f1a\u7ba1 alias \u7684\uff0c\u6240\u4ee5\u5bf9\u5b83\u6765\u8bf4\uff0c\u8fd9\u4e2a alias \u4e0d\u751f\u6548\u3002\u7136\u540e\u5c31\u4f1a\u6b63\u5e38\u8d70 else \u5206\u652f\uff0c\u7136\u540e\u5728\u8d70\u5230 <code>end</code> \u4e4b\u524d\u5c31\u9000\u51fa\u4e86\u3002\u5728 fish \u773c\u91cc\uff0cfish \u4e0d\u8ba4\u8bc6 <code>then</code>\uff0c\u6240\u4ee5\u5b83\u5c31\u4f1a\u5e94\u7528\u4e0a alias\uff0c\u53d8\u6210\u4e00\u4e2a <code>true</code> \u547d\u4ee4\uff0c\u6240\u4ee5\u5728 fish \u773c\u91cc\uff0c\u770b\u5230\u7684\u662f\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>if status current-command 2&gt;/dev/null | grep -q fish\n    true\n    echo \"I'm in fish\"\nelse\n    echo \"I'm in bash\"\n    fi\n    exit 0\nend\n</code></pre> <p>\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86 bash \u548c fish \u7684 if \u8bed\u6cd5\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\u3002\u4f46\u662f\uff0c\u5982\u679c\u5728 zsh \u91cc\u8dd1\uff0c\u5c31\u4f1a\u9047\u5230\u9519\u8bef\uff1a</p> <pre><code>test-bash-fish.sh:6: parse error near `else'\n</code></pre> <p>\u8fd9\u8bf4\u660e\u5f53 zsh \u89e3\u6790\u5230 <code>then</code> \u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u5c55\u5f00\u4e3a <code>true</code>\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u8bed\u6cd5\u9519\u8bef\u3002\u53ef\u89c1\u867d\u7136 bash \u548c zsh \u90fd\u5b9e\u73b0\u4e86 POSIX shell\uff0c\u4f46\u662f\u5728 alias \u7684\u5c55\u5f00\u65f6\u673a\u4e0a\u5b9e\u73b0\u5e76\u4e0d\u4e00\u6837\u3002\u600e\u4e48\u529e\u5462\uff1falias \u7684\u53cd\u4e49\u8bcd\u662f unalias\uff0c\u53ef\u4ee5\u628a\u5b83\u53d6\u6d88\u6389\uff1a</p> <pre><code>alias then=\"true\"\ntype unalias &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unalias then\n\nif status current-command 2&gt;/dev/null | grep -q fish\nthen\n    echo \"I'm in fish\"\nelse\n    type zstyle &gt;/dev/null 2&gt;&amp;1 &amp;&amp; echo \"I'm in zsh\" || echo \"I'm in bash\"\nfi\nexit 0\nend\n</code></pre> <p>\u8fd9\u91cc\u518d\u6b21\u5229\u7528\u4e86 <code>type</code> \u547d\u4ee4\u6765\u5224\u65ad <code>unalias</code> \u662f\u5426\u5b58\u5728\u3002\u641e\u4e86\u4e00\u5927\u901a\uff0c\u624d\u5b9e\u73b0\u4e86\u4e09\u79cd shell \u90fd\u53ef\u4ee5\u8dd1\u7684 if else \u8bed\u53e5\u3002</p>","tags":["shell","bash","zsh","fish"]},{"location":"programming/2017/11/30/run-cpp-in-jupyter-notebook/","title":"\u5728 Jupyter Notebook \u4e2d\u8fd0\u884c C++ \u4ee3\u7801","text":"<p>\u521a\u521a\u5728 HN \u4e0a\u770b\u5230\u4e86\u8fd9\u4e48\u4e00\u4e2a\u6587\u7ae0\uff1aInteractive Workflows for C++ with Jupyter HN \uff0c\u7ec8\u4e8e\u53ef\u4ee5\u5728 Jupyter Notebook \u91cc\u8dd1 C++\u4ee3\u7801\u4e86\uff0c\u5f88\u5f00\u5fc3\uff0c\u4e8e\u662f\u5f00\u59cb\u81ea\u5df1\u7814\u7a76\u4e86\u8d77\u6765\u600e\u4e48\u672c\u5730\u8dd1\u3002</p> <p>\u9996\u5148\u5f53\u7136\u662f\u66f4\u65b0\u4e00\u6ce2 jupyter\uff0c\u5b89\u88c5\u4e00\u6ce2 cling\uff1a</p> <pre><code>pip3 install -U jupyter\nbrew install cling\n</code></pre> <p>\u7136\u540e\u6839\u636e\u5b98\u65b9\u6559\u7a0b\u91cc\u7684\u8981\u6c42\u6267\u884c\uff1a</p> <pre><code>cd /usr/local/share/cling/Jupyter/kernel\npip3 install -e .\njupyter kernelspec install cling-cpp11\njupyter kernelspec install cling-cpp14\njupyter kernelspec install cling-cpp17\njupyter kernelspec install cling-cpp1z\n</code></pre> <p>\u7ed3\u679c\u53d1\u73b0\u627e\u4e0d\u5230<code>jupyter-kernelspec</code>\uff0c\u9042\u91cd\u88c5\u4e86\u4e00\u4e0b<code>jupyter-client</code>\u8fd9\u4e2a\u5305\uff0c\u679c\u7136\u5c31\u53ef\u4ee5\u4e86\u3002\u6253\u5f00\u4e00\u4e2a notebook \u6d4b\u8bd5\uff1a</p> <pre><code>jupyter notebook\n</code></pre> <p>\u7136\u540e\u521b\u5efa\u4e00\u4e2a C++14 \u7684 Notebook\uff0c\u7ed3\u679c\u53d1\u73b0\u4e00\u76f4 Kernel rebooting\uff0c\u9519\u8bef\u4fe1\u606f\u662f\u8bf4\u627e\u4e0d\u5230<code>../Cellar/cling/0.5/lib/libclingJupyter.dylib</code>\u3002\u8fd9\u4e00\u770b\u5c31\u662f\u8def\u5f84\u5904\u7406\u7684\u95ee\u9898\uff0c\u5f53\u524d\u76ee\u5f55\u80af\u5b9a\u4e0d\u662f<code>/usr/local</code>\uff0c\u80af\u5b9a\u51fa\u73b0\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u7136\u540e\u7814\u7a76\u53d1\u73b0<code>cling-kernel.py</code>\u4e2d\u5bf9<code>cling</code>\u5224\u65ad\u662f\u5426\u662f\u4e2a\u8fde\u63a5\uff0c\u5982\u679c\u662f\u8fde\u63a5\u5219\u6309\u7167\u8fde\u63a5\u53bb\u627e<code>cling</code>\u7684\u5b89\u88c5\u76ee\u5f55\uff0c\u4f46\u662f\uff01\u6ca1\u6709\u8003\u8651\u5230\u8fd9\u4e2a\u8fde\u63a5\u662f\u4e2a\u76f8\u5bf9\u8def\u5f84\u7684\u95ee\u9898\uff08Homebrew \u4f60\u80cc\u9505\u5417\uff09\u3002\u4e8e\u662f\u6211\u6109\u5feb\u5730\u6539\u4e86\u4ee3\u7801\u5e76\u63d0\u4ea4\u4e86PR\u3002\u4fee\u590d\u4e86\u4ee5\u540e\u5c31\u53ef\u4ee5\u7528\u4e86\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5c0f\u5c0f\u7684\u4f8b\u5b50\uff1a <pre><code>&gt;&gt; jupyter console --kernel cling-cpp14\nJupyter console 5.2.0\n\ncling-X\n\n\nIn [1]: #include &lt;stdio.h&gt;\nOut[1]:\n\nIn [2]: char *s = \"Hello, world!\";\ninput_line_4:2:12: warning: ISO C++11 does not allow conversion from string literal to 'char *' [-Wwritable-strings]\n char *s = \"Hello, world!\";\n           ^\nOut[2]:\n\nIn [3]: printf(\"%s\",s);\nHello, world!Out[3]:\n(int) 13\n</code></pre></p> <p>Okay\uff0c\u5927\u529f\u544a\u6210\uff01</p>","tags":["jupyter","cling","c++"]},{"location":"programming/2019/03/08/running-nginx-on-rcore/","title":"\u5728 rCore \u4e0a\u8fd0\u884c nginx","text":"<p>\u963f \u897f \u5427 nginx \u7ec8\u4e8e\u80fd\u5728 rCore \u4e0a\u8dd1\u4e86 orrrrrrrz</p> <p>\u901a\u8fc7\u8fd9\u534a\u4e2a\u591a\u6708\u6765\u7684\u5927\u91cf\u5f00\u53d1\uff0c\u6211\u548c\u738b\u6da6\u57fa @wangrunji0408 \u5b66\u957f\u7b97\u662f\u7ec8\u4e8e\u5b8c\u6210\u4e86\u7b2c\u4e00\u4e2a milestone\uff1a\u8dd1\u8d77\u6765\u4e00\u4e2a nginx\u3002\u9047\u5230\u4e86\u5f88\u591a\u56f0\u96be\uff0c\u5927\u6982\u6709\u8fd9\u4e9b\uff1a</p> <ol> <li>syscall \u5b9e\u73b0\u4e0d\u5168\u3002\u5404\u79cd\u65b9\u9762\u90fd\u7f3a\uff0c\u7136\u540e nginx \u5728\u7f16\u8bd1\u7684\u65f6\u5019\u53c8\u68c0\u6d4b\u5230\u6bd4\u8f83\u65b0\u7684 OS \u7248\u672c\uff0c\u6240\u4ee5\u5f88\u591a syscall \u90fd\u7528\u4e86\u65b0\u7684\u6765\u66ff\u4ee3\u8001\u7684\uff0c\u4f8b\u5982 readv/writev pread/pwrite accept4 \u7b49\u7b49\uff0c\u6240\u4ee5\u8fd9\u65b9\u9762\u505a\u4e86\u4e00\u4e9b\u5de5\u4f5c\u3002\u53e6\u5916\uff0c\u8fd8\u6709\u5f88\u591a\u65b0\u7684 syscall \u8fdb\u6765\uff0c\u592a\u591a\u4e86\u6211\u5c31\u4e0d\u7ec6\u8bf4\u4e86\uff0c\u57fa\u672c\u4e0a\u4e00\u4e2a commit \u505a\u4e00\u70b9\u4e00\u4e2a commit \u505a\u4e00\u70b9\u8fd9\u4e2a\u6837\u5b50\u3002</li> <li>nginx \u7528\u5230\u4e86 SSE \u7684\u5bc4\u5b58\u5668 xmm\uff0c\u4f46\u662f\u4e4b\u524d\u662f\u6ca1\u6709\u5f00\u7684\u3002\u6240\u4ee5\u628a sse \u6253\u5f00\uff0c\u7136\u540e\u5207\u6362\u4e0a\u4e0b\u6587\u7684\u65f6\u5019\u628a sse \u901a\u8fc7 fxsave \u4fdd\u5b58\u548c fxrstor \u6062\u590d\uff08\u6709\u610f\u601d\u7684\u662f\uff0cas \u5c45\u7136\u4e0d\u8ba4\u8fd9\u4fe9\uff0c\u53ea\u597d\u624b\u52a8\u5199\u5b57\u8282\u7801\uff09\uff0c\u7136\u540e\u4e3a\u4e86 16bit \u7684\u5bf9\u9f50\u53c8\u5199\u4e86\u51e0\u884c\u6c47\u7f16\u4ee3\u7801\u3002\u8fd9\u5757\u95ee\u9898\u4e0d\u5927\uff0c\u4eca\u5929\u4e00\u4f1a\u5c31\u641e\u5b9a\u4e86\u3002\u4f46\u662f\u5982\u679c\u8981\u6027\u80fd\u66f4\u9ad8\u4e00\u4e9b\u7684\u8bdd\uff0c\u53ef\u80fd\u9700\u8981\u5728\u7b2c\u4e00\u6b21\u4f7f\u7528 xmm \u7684\u65f6\u5019\u518d\u5f00\u59cb\u4fdd\u5b58\uff0c\u5927\u6982\u5c31\u662f\u52a0\u4e00\u4e2a bit \u7684\u4e8b\u60c5\u3002</li> <li>\u6587\u4ef6\u7cfb\u7edf\u6709\u70b9\u5d29\u3002\u5b9e\u73b0\u8fd8\u662f\u6709\u5f88\u591a BUG\uff0c\u8868\u73b0\u5c31\u662f\u9700\u8981\u7ecf\u5e38\u91cd\u65b0 mksfs \u4e00\u4e0b\uff0c\u518d\u91cd\u542f\u52a0\u8f7d\u5b8c\u597d\u7684 fs\uff0c\u6709\u65f6\u5019\u5f3a\u5236\u5173\u673a\u4e00\u4e0b\u5c31\u53c8\u5d29\u4e86\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\u505a\u4e86\u4e00\u4e9b\u6539\u53d8\u3002\u4e3a\u4e86\u5b9e\u73b0\u66f4\u52a0\u5b8c\u6574\u7684 mmap mumap \u548c mprotect\uff0c\u53c8\u53d1\u73b0\u4e86\u4e00\u4e9b\u65b0\u7684 BUG \u5728\u91cc\u9762\uff0c\u7136\u540e\u6162\u6162\u4fee\u590d\u4e86\u3002\u5c31\u662f\u5b9e\u73b0\u7684\u6709\u70b9\u7c97\u66b4\u3002</li> <li>\u6b7b\u9501\u95ee\u9898\u3002\u8fd9\u4e2a\u5176\u5b9e\u73b0\u5728\u8fd8\u4f1a\u51fa\u73b0\uff0c\u53ea\u662f\u8fd8\u6ca1\u8c03\u51fa\u6765\uff0c\u4e5f\u4e0d\u4f1a\u767e\u5206\u767e\u51fa\u73b0\u3002\u6211\u4eec\u8ba1\u5212\u5728\u9501\u4e0a\u9762\u505a\u4e00\u4e9b\u6b7b\u9501\u68c0\u6d4b\uff0c\u4f8b\u5982\u8bb0\u4f4f\u662f\u8c01\u4e0a\u9501\u7684\uff0c\u7b49\u7b49\u3002\u73b0\u5728\u5c31\u9047\u5230\u4e00\u4e2a\u5f88\u7384\u5b66\u7684\u6b7b\u9501\u95ee\u9898\u3002</li> </ol> <p>\u7136\u540e\u4ee3\u7801\u4e5f\u662f\u4e00\u8fb9\u5728\u5199\u4e00\u8fb9\u5728\u91cd\u6784\u5427\uff0c\u5f88\u591a\u5730\u65b9\u73b0\u5728\u90fd\u5199\u5f97\u5f88\u7c97\u66b4\uff0cFIXME \u548c TODO \u7559\u4e86\u5f88\u591a\uff0c\u5f88\u591a\u5730\u65b9\u4e5f\u5199\u5f97\u4e0d\u591f\u4f18\u96c5\u3002\u4ee5\u540e\u518d\u6162\u6162\u91cd\u6784 + \u4f18\u5316\u5427\u3002</p> <p>\u622a\u56fe\u7559\u5ff5\uff1a</p> <p></p> <p>\u518d\u5f80\u524d\u7684\u8bdd\uff0c\u8fd8\u6709\u5f88\u591a\u5c0f\u7684\u95ee\u9898\uff0c\u4f8b\u5982\u7f51\u5361\u7684\u4e2d\u65ad\u542f\u7528\u4e86\u4f46\u6ca1\u6709\u6539 mask\uff0c\u6240\u4ee5\u5565\u4e5f\u6ca1\u6536\u5230\uff0c\u9760 QEMU Tracing \u627e\u5230\u95ee\u9898\u3002\u8fd8\u6709\u4e00\u4e2a\u5f88\u6709\u610f\u601d\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u5982\u679c elf \u7684 program header \u6ca1\u6709 phdr \u8fd9\u4e2a\u9879\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e00\u4e2a load\uff08\u5982\u679c\u52a0\u8f7d\u4e86\u5b8c\u6574\u7684 elf \u5934\u7684\u8bdd\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u8fd9\u91cc\u63a8\u65ad\u51fa phdr \u7684\u5730\u5740\uff08load \u7684\u865a\u62df\u5730\u5740\u52a0\u504f\u79fb\uff09\uff0c\u7136\u540e\u4e22\u5230 auxv \u91cc\u53bb\u8ba9 musl \u914d\u7f6e tls\u3002\u603b\u4e4b\u8fd9\u4e9b\u90fd\u89e3\u51b3\u4e86\u3002\u4e5f\u4e0d\u7528\u53bb\u8003\u8651\u517c\u5bb9 litc \u4e86\uff0c\u5df2\u7ecf\u5168\u90e8\u5411 linux \u9760\u62e2\u4e86\uff0c\u7a33\u3002</p> <p>\u6ce8\uff1a\u6700\u7b80 nginx \u7f16\u8bd1\u53c2\u6570\uff1a</p> <pre><code>./configure --with-cc=/usr/bin/musl-gcc --with-cc-opt=-static --with-ld-opt=-satic --without-pcre --without-http_rewrite_module --without-http_gzip_module --with-poll_module\n</code></pre> <p>\u8fd9\u6837\u7f16\u8bd1\u51fa\u6765\u662f\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\uff0c\u5e76\u4e14\u5728 strip \u4e4b\u540e\u53ea\u6709\u4e0d\u5230 1M \u7684\u5927\u5c0f\u3002</p> <p>\u6700\u7b80 nginx \u914d\u7f6e\uff1a</p> <pre><code>daemon off;\nmaster_process off;\n\nevents {\n    use poll;\n}\n\nhttp {\n    server {\n        listen 80;\n        server_name _;\n\n        root /;\n    }\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u514d\u53bb\u4e86\u4e00\u4e9b\u9ebb\u70e6\uff08\u591a\u7ebf\u7a0b\u3001\u591a\u8fdb\u7a0b\u4ea4\u4e92\u8fd8\u662f\u6709\u5f88\u591a\u95ee\u9898\uff09\uff0c\u4f46\u786e\u5b9e\u53ef\u4ee5\u8dd1\u8d77\u6765\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u9700\u8981\u5199\u4e00\u4efd /etc/passwd \u548c /etc/group \u7528\u4e8e nobody \u548c nogroup\u3002\u4e0d\u9700\u8981\u5176\u4ed6\u989d\u5916\u7684\u4e1c\u897f\u4e86\u3002</p>","tags":["rcore","rust","os","nginx","syscall","fs","sfs"]},{"location":"programming/2019/01/07/rust-access-linker-script-address/","title":"Rust \u83b7\u53d6 Linker Script \u4e2d\u7684\u5730\u5740","text":"<p>\u5728 Linker Script \u4e2d\u53ef\u4ee5\u8bb0\u5f55\u4e0b\u4e00\u4e2a\u5730\u5740\u5230\u4e00\u4e2a\u53d8\u91cf\u4e2d\uff0c\u5927\u6982\u8fd9\u6837\uff1a</p> <pre><code>.text: {\n    PROVIDE(__text_start = .);\n    *(.text .text.* .gnu.linkonce.t*)\n    PROVIDE(__text_end = .);\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>PROVIDE()</code> \u662f\u53ef\u9009\u7684\u3002\u8fd9\u6837\uff0c\u4ee3\u7801\u91cc\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230 .text \u6bb5\u7684\u5730\u5740\u4e86\u3002\u5728 C \u4e2d\uff0c\u76f4\u63a5 extern \u4e00\u4e2a\u540c\u540d\u7684\u53d8\u91cf\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u5728 Rust \u4e2d\uff0c\u9700\u8981\u8fd9\u6837\u83b7\u53d6\uff1a</p> <pre><code>extern \"C\" {\n    fn __text_start();\n    fn __text_end();\n}\n\n// __text_start as usize\n// __text_end as usize\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u62ff\u5230\u5730\u5740\u4e86\u3002</p>","tags":["rust","ld","linker","ffi"]},{"location":"programming/2019/11/17/rust-decaf-lsp/","title":"\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 Decaf LSP","text":"","tags":["rust","decaf","lsp","tokio"]},{"location":"programming/2019/11/17/rust-decaf-lsp/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u7f16\u8bd1\u539f\u7406\u8bfe\u7a0b\u5728\u505a Decaf \u7684 PA\uff0c\u4e4b\u524d\u505a\u4e86\u4e00\u4e9b\u6bd4\u8f83\u7b80\u5355\u7684\u5c1d\u8bd5\uff0c\u5305\u62ec\u5728\u7ebf Decaf\u3001\u5728\u7ebf TAC VM \u7b49\u7b49\uff0c\u90fd\u662f\u5957\u4e00\u4e2a\u524d\u7aef\uff0c\u7136\u540e\u6574\u4e2a\u7f16\u8bd1\u5230 wasm \u8dd1\u524d\u7aef\u5c31\u53ef\u4ee5\u4e86\u3002\u5982\u679c\u8981\u505a LSP \u7684\u8bdd\uff0c\u5de5\u4f5c\u91cf\u4f1a\u7a0d\u5fae\u5927\u4e00\u4e9b\uff0c\u4e0d\u8fc7\u4e5f\u66f4\u52a0\u5b9e\u7528\u3002</p> <p>\u7136\u540e\u6709\u4e00\u5929\uff0c\u52a9\u6559 @equation314 \u5199\u4e86 decaf-vscode \u4e00\u4e2a VSCode \u5bf9 Decaf \u7684\u8bed\u6cd5\u9ad8\u4eae\u63d2\u4ef6\uff0c\u6211\u5c31 Fork \u4e86\u4e00\u4efd\u5230 jiegec/decaf-vscode\uff0c\u7136\u540e\u6dfb\u52a0\u4e86 LSP \u7684\u652f\u6301\uff0c\u8ba9\u5b83\u6709\u4e86\u4e00\u4e9b\u66f4\u9ad8\u7ea7\u7684\u529f\u80fd\u3002</p>","tags":["rust","decaf","lsp","tokio"]},{"location":"programming/2019/11/17/rust-decaf-lsp/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>LSP \u670d\u52a1\u7aef\u4e00\u822c\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u7a0b\u5e8f\uff0c\u901a\u8fc7 JSONRPC \u8fdb\u884c\u6d88\u606f\u901a\u8baf\uff0c\u7136\u540e\u5c31\u4e0a\u5348\u627e\u6709\u6ca1\u6709\u73b0\u6210\u7684\u6846\u67b6\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u662f lsp-types \u548c tower-lsp \uff0c\u524d\u8005\u5c01\u88c5\u4e86 LSP \u534f\u8bae\u7684\u5404\u4e2a\u7ed3\u6784\u4f53\uff0c\u540e\u8005\u63d0\u4f9b\u4e86\u670d\u52a1\u7aef\u7684\u5927\u6982\u5b9e\u73b0\u3002\u4e0d\u8fc7\u7531\u4e8e\u540e\u8005\u505a\u7684\u4e0d\u5927\u5168\uff0c\u6240\u4ee5\u6211\u81ea\u5df1 fork \u4e86\u4e00\u4efd\u6dfb\u52a0\u4e86\u4e00\u4e9b\u3002</p> <p>\u5b9e\u9645\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u9700\u8981\u5b9e\u73b0\u51e0\u4e2a\u51fd\u6570\uff0c\u5206\u522b\u76f8\u5e94\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u6bd4\u5982\u5728 initialize \u7684\u65f6\u5019\u544a\u8bc9\u5ba2\u6237\u7aef\u6211\u90fd\u5b9e\u73b0\u4e86\u54ea\u4e9b\u4e1c\u897f\uff0c\u7136\u540e\u76f8\u5e94\u5730\u63d0\u4f9b\u5404\u79cd\u4fe1\u606f\uff0c\u5982 symbol\uff0chover\uff0cfolding\uff0cdefinition \u7b49\u7b49\u3002\u4e3a\u4e86\u5b9e\u73b0\u7b80\u5355\uff0c\u6211\u8981\u6c42\u5ba2\u6237\u7aef\u6bcf\u6b21\u4fee\u6539\u7684\u65f6\u5019\u90fd\u628a\u5b8c\u6574\u7684\u6587\u4ef6\u4f20\u8fc7\u6765\uff0c\u867d\u7136\u4e0d\u662f\u5f88\u9ad8\u6548\uff0c\u4f46\u662f\u5f88\u7b80\u5355\uff0c\u76ee\u524d\u4e5f\u6ca1\u6709\u5565\u5f88\u957f\u7684 Decaf \u7a0b\u5e8f\u561b\u3002</p> <p>\u6bcf\u6b21\u62ff\u5230 Decaf \u7a0b\u5e8f\u4e4b\u540e\uff0c\u5c31\u6309\u7167 decaf-rs \u7684\u65b9\u6cd5\uff0cLex \u7136\u540e Parse\uff0c\u7136\u540e\u904d\u5386 AST\uff0c\u5206\u522b\u628a\u9700\u8981\u7684\u5404\u4e2a\u4fe1\u606f\u90fd\u5b58\u4e0b\u6765\uff0c\u5f53\u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u8fd4\u56de\u5373\u53ef\u3002\u7136\u540e\u5c31\u4f1a\u5728 VSCode \u4e2d\u51fa\u73b0\uff0c\u6bd4\u5982\u5b9e\u73b0\u4e86 document symbol\uff0c\u5728\u5de6\u8fb9\u7684 Outline \u4e2d\u5c31\u4f1a\u51fa\u73b0\u76f8\u5e94\u7684\u7ed3\u6784\uff1b\u5b9e\u73b0\u4e86 hover\uff0c\u5f53\u79fb\u52a8\u5230\u4e00\u4e9b\u5730\u65b9\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53d1\u51fa\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u5c31\u628a\u76f8\u5e94\u7684 hover \u4fe1\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u6574\u4e2a\u534f\u8bae\u5e76\u4e0d\u590d\u6742\uff0c\u540e\u9762\u5b9e\u9645\u5b9e\u73b0\u5176\u5b9e\u624d\u662f\u6bd4\u8f83\u590d\u6742\u7684\u5730\u65b9\u3002</p> <p>\u5b9e\u73b0\u7684\u529f\u80fd\u4e2d\uff0csymbols hovers ranges definition \u90fd\u662f\u5728\u5f97\u5230 AST \u540e\u4e00\u6b21\u904d\u5386\u90fd\u8ba1\u7b97\u597d\uff0c\u7136\u540e\u8fd4\u56de\uff0c\u540c\u65f6\u5728\u9047\u5230\u9519\u8bef\u7684\u65f6\u5019\uff0c\u4e5f\u901a\u8fc7 diagnostic \u7684\u5f62\u5f0f\u628a\u68c0\u67e5\u51fa\u6765\u7684\u9519\u8bef\u6c47\u62a5\u7ed9\u7528\u6237\u3002\u7531\u4e8e VSCode \u7684\u826f\u597d\u652f\u6301\uff0c\u57fa\u672c\u4e0d\u9700\u8981\u5199 TypeScript \u4ee3\u7801\u3002</p> <p>\u81f3\u4e8e\u4ee3\u7801\u8865\u5168\uff0c\u73b0\u5728\u505a\u7684\u6bd4\u8f83\u7c97\u7cd9\uff0c\u4ec5\u4ec5\u8865\u5168\u4e86\u4e00\u4e9b\u5185\u7f6e\u51fd\u6570\uff1aPrint ReadInteger \u548c ReadLine\u3002\u8fd8\u5728\u8003\u8651\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u8865\u5168\uff0c\u4f46\u662f\u5728\u8865\u5168\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u8bed\u6cd5\u9519\u8bef\uff0c\u610f\u5473\u7740\u9700\u8981\u4fdd\u8bc1\u5728\u8865\u5168\u7684\u65f6\u5019\u6211\u8fd8\u80fd\u62ff\u5230\u4e4b\u524d\u6b63\u786e\u7684\u7c7b\u578b\u4fe1\u606f\uff0c\u9700\u8981\u4e00\u4e9b\u5de5\u4f5c\u91cf\uff0c\u73b0\u5728\u8fd8\u6ca1\u6709\u53bb\u505a\u3002</p>","tags":["rust","decaf","lsp","tokio"]},{"location":"programming/2019/11/17/rust-decaf-lsp/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>\u6211\u81ea\u5df1\u6d4b\u8bd5\u7684\u65b9\u6cd5\u5c31\u662f\u4e24\u4e2a\u7a97\u53e3\uff0c\u4e00\u4e2a\u662f decaf-lsp \uff0c\u9996\u5148\u514b\u9686\u4e0b\u6765\uff0c\u7136\u540e <code>cargo install --path . --force</code> \u6765\u5b89\u88c5\u5230\u5168\u5c40\uff1b\u53e6\u4e00\u4e2a\u5c31\u662f\u6211 Fork \u7684 decaf-vscode \uff0c\u514b\u9686\u4e0b\u6765\uff0c\u7136\u540e\u6309 <code>F5</code> \u8fdb\u5165 VSCode \u7684\u8c03\u8bd5\u6a21\u5f0f\uff0c\u5b83\u4f1a\u6253\u5f00\u4e00\u4e2a\u65b0\u7a97\u53e3\uff0c\u91cc\u9762\u542f\u7528\u4e86 Decaf for VSCode \u63d2\u4ef6\u3002\u8fd9\u4e2a\u65f6\u5019\u770b Decaf \u4ee3\u7801\u5c31\u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u63d0\u5230\u7684\u90a3\u4e9b\u4e1c\u897f\u4e86\u3002</p>","tags":["rust","decaf","lsp","tokio"]},{"location":"programming/2019/11/17/rust-decaf-lsp/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u611f\u89c9 LSP \u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u5b9e\u73b0\u7684 Protocol\uff0c\u4f46 Protocol \u627f\u8f7d\u7684 Data \u624d\u662f\u6bd4\u8f83\u56f0\u96be\u7684\u4e1c\u897f\u3002\u8981\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u6574\u7684 completion \u8fd8\u9700\u8981\u5f88\u591a\u4e1c\u897f\uff0c\u73b0\u5728\u53ea\u80fd\u8bf4\u662f\u4e2a naive implementation \u5427\u3002</p> <p>\u521a\u5199\u5b8c\u5c31\u53d1\u73b0 Neovim \u53d1\u5e03\u4e86 \u5b98\u65b9\u7684 LSP client \u3002</p>","tags":["rust","decaf","lsp","tokio"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/","title":"\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser","text":"","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u7f16\u8bd1\u539f\u7406\u8bfe\u4e0a\uff0cPA \u6846\u67b6\u91c7\u7528\u7684\u662f MashPlant/lalr1 \uff0c\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7528\u7684 Lexer + Parser \u7684\u5de5\u5177\uff0c\u5b83\u7684\u5927\u6982\u8bed\u6cd5\u89c1 \u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50 \u3002\u7136\u540e\u4e4b\u524d\u770b\u5230\u4e86 GLL Parser\uff0c\u60f3\u7740\u53ef\u4e0d\u53ef\u4ee5\u7167\u7740\u7c7b\u4f3c\u7684\u8bed\u6cd5\u4e5f\u5199\u4e00\u4e2a GLL \u7684 Parser Generator\uff0c\u4e5f\u662f\u7528 Rust Procedure Macro \u7684\u65b9\u6cd5\uff0c\u5c31\u5f00\u59cb\u4e86\u7814\u7a76\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u5c1d\u8bd5","title":"\u5c1d\u8bd5","text":"<p>\u9996\u5148\u662f\u9605\u8bfb GLL \u7684\u8bba\u6587\uff0c\u5b83\u5e76\u4e0d\u957f\uff0c\u5927\u6982\u7684\u610f\u601d\u5c31\u662f\uff0cLL(1) \u6587\u6cd5\u9700\u8981\u8003\u8651 PS \u51b2\u7a81\u7684\u60c5\u51b5\uff0c\u800c GLL \u7684\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u201c\u90fd\u8bd5\u4e00\u4e0b\u201d\uff0c\u7136\u540e\u4e3a\u4e86\u6548\u7387\uff0c\u7528\u4e86 GSS \u8868\u793a\u89e3\u6790\u8fc7\u7a0b\u548c SPPF \u8868\u793a\u89e3\u6790\u7ed3\u679c\u3002\u7136\u540e\u5c31\u5f00\u59cb\u7167\u7740\u8bba\u6587\u624b\u5199\u4e86\u4e0d\u540c\u7248\u672c\u7684\u5b9e\u73b0\uff0c\u89c1 jiegec/gll-test \u3002</p> <p>\u7b2c\u4e00\u79cd\u5c31\u662f\u6309\u7167\u8bba\u6587\u91cc\u7b2c\u4e00\u6bb5\u5b9e\u73b0\u76f4\u63a5\u6284\u8fc7\u6765\uff0c\u6bcf\u4e2a\u53ef\u80fd\u6027\u4f5c\u4e3a\u4e00\u4e2a Continuation \u5b58\u4e0b\u6765\uff0c\u5b83\u6709\u81ea\u5df1\u7684\u6808\u548c\u6267\u884c\u4f4d\u7f6e\uff08Label\uff09\u3002\u8fd9\u6837 Work \u4ee5\u540e\u5462\uff0c\u6211\u53c8\u60f3\u5230\u4e86 async/await\uff0c\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u53c8\u5199\u4e86\u4e00\u904d\uff0c\u76f8\u5bf9\u8981\u7b80\u6d01\u4e00\u4e9b\uff0c\u4e5f\u662f\u5f88\u5e73\u5e38\u7684\u9012\u5f52\u4e0b\u964d\u7684\u5199\u6cd5\uff0c\u800c\u4e0d\u662f Loop + Label \u7684\u5f62\u5f0f\u3002\u4f46\u8fd9\u4e9b\u90fd\u4e0d\u80fd\u505a\u5230\u5408\u5e76\u6808\u7684\u76ee\u7684\uff0c\u6240\u4ee5\u9047\u5230\u5341\u5206\u6709\u6b67\u4e49\u7684\u6587\u6cd5\u7684\u65f6\u5019\u4f1a\u5f88\u7cdf\u7cd5\u3002</p> <p>\u7136\u540e\u5f00\u59cb\u6309\u7167\u8bba\u6587\u4e2d\u7684 GSS \u8fdb\u884c\u7f16\u5199\uff0c\u57fa\u672c\u8fd8\u662f\u6309\u7167\u8bba\u6587\u8fdb\u884c\u7ffb\u8bd1\uff0c\u7136\u540e\u4e00\u6b65\u4e00\u6b65\u505a\uff0c\u505a\u597d\u4ee5\u540e\u628a GSS \u753b\u51fa\u6765\uff0c\u548c\u8bba\u6587\u7684\u56fe\u53ef\u4ee5\u5bf9\u7684\u4e0a\uff1b\u7136\u540e\u7167\u7740 GLL parse-tree generation \u7684\u8bba\u6587\u628a SPPF \u5b9e\u73b0\u4e86\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u4ece recongizer \u53d8\u6210\u4e00\u4e2a parser \u4e86\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u5b8f","title":"\u5b8f","text":"<p>\u5f97\u5230\u4e00\u4efd\u53ef\u884c\u7684\u4ee3\u7801\u4ee5\u540e\uff0c\u5c31\u8981\u6269\u5c55\u5230\u901a\u7528\u7684\u60c5\u51b5\u4e0a\u3002\u5b66\u4e60\u4e86\u4e00\u4e0b MashPlant/lalr1 \u7684\u5b9e\u73b0\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a proc macro\uff0c\u5b83\u8bfb\u53d6\u4e86\u7528\u6237\u7684\u7a0b\u5e8f\uff0c\u4ece\u4e00\u4e2a\u6a21\u677f\u6587\u4ef6\u5f00\u59cb\uff0c\u5f80\u91cc\u9762\u63d2\u5165\u4e00\u4e9b\u751f\u6210\u7684\u4ee3\u7801\uff0c\u4e22\u7ed9\u7f16\u8bd1\u5668\u53bb\u7f16\u8bd1\u3002\u8fd9\u65f6\u5019\u5c31\u6d89\u53ca\u5230\u7f16\u8bd1\u671f\u548c\u8fd0\u884c\u65f6\u7684\u4e0d\u540c\u4e86\uff0c\u6211\u628a\u8fd0\u884c\u65f6\u4e00\u4e9b\u901a\u7528\u7684\u7ed3\u6784\u653e\u5230\u4e86 <code>gll-pg-core</code> \u4e2d\uff0c\u628a\u7f16\u8bd1\u671f\u7684\u4ee3\u7801\u653e\u5230\u4e86 <code>gll-pg-macros</code> \u3002</p> <p>\u4ee3\u7801\u751f\u6210\u7684\u65f6\u5019\uff0c\u57fa\u672c\u6309\u7167\u4e4b\u524d\u81ea\u5df1\u5199\u7684\u6837\u5b50\u6284\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u65f6\u5019\u8981\u6309\u7167\u7528\u6237\u7f16\u5199\u7684\u4ea7\u751f\u5f0f\u8fdb\u884c\u751f\u6210\u4e86\uff0c\u5404\u79cd\u540d\u5b57\u90fd\u8981\u89c4\u8303\u5316\uff0c\u53d8\u5f97\u53ef\u4ee5\u590d\u7528\uff0c\u7136\u540e\u5c3d\u91cf\u51cf\u5c11\u547d\u540d\u7a7a\u95f4\u7684\u6c61\u67d3\u7b49\u7b49\u8fd9\u4e9b\u5e38\u89c1\u7684\u5199\u5b8f\u9700\u8981\u6ce8\u610f\u7684\u64cd\u4f5c\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8003\u8651\u5230\u73b0\u5728\u8fd8\u6ca1\u6709\u5b9e\u73b0 Lexer\uff0c\u6240\u4ee5\u5148\u7528\u4e86 Logos \u5e93\u4f5c\u4e3a Lexer\u3002\u4f46\u6211\u5176\u5b9e\u4e0d\u5927\u559c\u6b22\u5b83\uff0c\u56e0\u4e3a\u5b83\u592a\u7b80\u5355\uff0c\u4e5f\u6ca1\u6709\u884c\u53f7\u7684\u4fe1\u606f\uff0c\u4e0d\u8fc7\u6682\u4e14\u5148\u8fd9\u6837\u5427\uff0c\u4ee5\u540e\u53ef\u80fd\u4f1a\u81ea\u5df1\u5b9e\u73b0\u3002</p> <p>\u7136\u540e 0.1.0 \u7248\u672c\u5c31\u8bde\u751f\u4e86\uff0c\u5b83\u7684\u6837\u4f8b\u957f\u8fd9\u6837\uff1a</p> <pre><code>//! This example is taken from MashPlant/lalr1\n\nuse gll_pg_core::LogosToken;\nuse gll_pg_macros::gll;\nuse logos::Logos;\n\n#[derive(Logos, Debug, Eq, PartialEq, Clone)]\npub enum Token {\n    #[end]\n    End,\n    #[error]\n    Error,\n    #[token = \" \"]\n    _Eps,\n    #[token = \"+\"]\n    Add,\n    #[token = \"-\"]\n    Sub,\n    #[token = \"*\"]\n    Mul,\n    #[token = \"/\"]\n    Div,\n    #[token = \"%\"]\n    Mod,\n    #[token = \"(\"]\n    LPar,\n    #[token = \")\"]\n    RPar,\n    #[regex = \"[0-9]+\"]\n    IntLit,\n}\n\n#[gll(Expr, Token)]\nimpl Parser {\n    #[rule(Expr -&gt; Expr Add Expr)]\n    fn expr_add(l: i32, _op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        l + r\n    }\n    #[rule(Expr -&gt; Expr Sub Expr)]\n    fn expr_sub(l: i32, _op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        l - r\n    }\n    #[rule(Expr -&gt; Expr Mul Expr)]\n    fn expr_mul(l: i32, _op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        l * r\n    }\n    #[rule(Expr -&gt; Expr Div Expr)]\n    fn expr_div(l: i32, _op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        l / r\n    }\n    #[rule(Expr -&gt; Expr Mod Expr)]\n    fn expr_mod(l: i32, _op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        l % r\n    }\n    #[rule(Expr -&gt; Sub Expr)]\n    fn expr_neg(_op: LogosToken&lt;Token&gt;, r: i32) -&gt; i32 {\n        -r\n    }\n    #[rule(Expr -&gt; LPar Expr RPar)]\n    fn expr_paren(_l: LogosToken&lt;Token&gt;, i: i32, _r: LogosToken&lt;Token&gt;) -&gt; i32 {\n        i\n    }\n    #[rule(Expr -&gt; IntLit)]\n    fn expr_int(i: LogosToken&lt;Token&gt;) -&gt; i32 {\n        i.slice.parse().unwrap()\n    }\n}\n\n#[test]\nfn gll() {\n    let mut lexer = Token::lexer(\"1 + 2 * 3\");\n    let res = Parser::parse(&amp;mut lexer);\n    // two ways to parse\n    assert_eq!(res, [7, 9]);\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u89e3\u6790\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5bf9\u5e94\u6240\u6709\u53ef\u80fd\u51fa\u73b0\u7684\u60c5\u51b5\u3002\u8fd9\u6837\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u8981\u6c42\u4e2d\u95f4\u5404\u79cd\u7c7b\u578b\u90fd\u662f Clone\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2a\u7ed3\u70b9\u53ef\u80fd\u4f1a\u88ab\u7528\u591a\u6b21\u3002\u5b83\u7684\u8ba1\u7b97\u65b9\u6cd5\u5c31\u662f\u5728\u6700\u7ec8\u7684 SPPF \u4e0a\u9012\u5f52\u627e\u5230\u6240\u6709\u53ef\u80fd\u6027\uff0c\u7136\u540e\u8c03\u7528\u7528\u6237\u4ee3\u7801\uff0c\u6700\u540e\u653e\u5230\u4e00\u4e2a Vec \u4e2d\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u8bb0\u5fc6\u5316","title":"\u8bb0\u5fc6\u5316","text":"<p>\u4f46\u662f\uff0c\u4e0a\u9762\u7684\u505a\u6cd5\u6709\u4e00\u4e2a\u5f88\u5927\u7684\u95ee\u9898\uff0c\u5c31\u662f\uff0c\u867d\u7136 SPPF \u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u662f\u6709\u9650\u7684\uff0c\u4f46\u6240\u6709\u53ef\u80fd\u7684\u89e3\u6790\u6811\u53ef\u4ee5\u6709\u5f88\u591a\uff0c\u5982\u679c\u628a\u6bcf\u4e00\u4e2a\u60c5\u51b5\u90fd\u5b8c\u6574\u7684\u5b58\u5728\u4e00\u4e2a Vec \u4e2d\uff0c\u7a7a\u95f4\u8981\u6c42\u662f\u5f88\u9ad8\u7684\uff0c\u4e2d\u95f4\u4e5f\u6709\u5f88\u591a\u91cd\u590d\u8ba1\u7b97\u7684\u60c5\u51b5\u3002\u6240\u4ee5\u9700\u8981\u505a\u8bb0\u5fc6\u5316\uff0c\u7136\u540e\u6bcf\u6b21\u7ed9\u51fa\u4e00\u4e2a\u3002\u56e0\u4e3a\u4f9d\u8d56\u81ea\u5df1\u5185\u90e8\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u4e0d\u80fd\u662f Iterator \u53ea\u80fd\u662f StreamingIterator\u3002</p> <p>\u8bb0\u5fc6\u5316\u4e5f\u82b1\u4e86\u6211\u4e00\u756a\u529f\u592b\uff0c\u73b0\u5728\u7528\u4e86\u4e00\u4e2a\u6bd4\u8f83\u571f\u7684\u529e\u6cd5\uff0c\u5728\u6bcf\u4e2a\u7ed3\u70b9\u4e0a\u8bb0\u5f55\u4e86\u5f53\u524d\u9047\u5230\u8fc7\u7684\u6240\u6709\u53ef\u80fd\uff0c\u8fd9\u4e2a\u662f\u9010\u6e10\u6784\u9020\u7684\uff0c\u610f\u5473\u7740\u5982\u679c\u53ea\u9700\u8981\u7b2c\u4e00\u79cd\u89e3\u6790\u6811\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u7a7a\u95f4\u3002\u7136\u540e\u9010\u6e10\u6269\u5f20\uff0c\u5982\u679c\u6709\u53ef\u4ee5\u91cd\u7528\u7684\u7ed3\u6784\u5c31\u91cd\u7528\uff0c\u628a\u6d89\u53ca\u7684\u6240\u6709\u7684\u7ed3\u6784\u90fd\u653e\u5728\u4e00\u4e2a Vec \u4e2d\uff0c\u7528\u5b8c\u4e4b\u540e\u4e00\u8d77 drop \u6389\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5404\u79cd\u4e1c\u897f\u90fd\u53d8\u6210\u4e86\u5f15\u7528\uff1a</p> <pre><code>//! This example is taken from MashPlant/lalr1\n\nuse gll_pg_core::*;\nuse gll_pg_macros::gll;\nuse logos::Logos;\n\n#[derive(Logos, Debug, Eq, PartialEq, Clone)]\nenum Token {\n    #[end]\n    End,\n    #[error]\n    Error,\n    #[token = \" \"]\n    _Eps,\n    #[token = \"+\"]\n    Add,\n    #[token = \"-\"]\n    Sub,\n    #[token = \"*\"]\n    Mul,\n    #[token = \"/\"]\n    Div,\n    #[token = \"%\"]\n    Mod,\n    #[token = \"(\"]\n    LPar,\n    #[token = \")\"]\n    RPar,\n    #[regex = \"[0-9]+\"]\n    IntLit,\n}\n\n#[derive(Default)]\nstruct Parser {\n    literals: Vec&lt;i32&gt;,\n}\n\n#[gll(Expr, Token)]\nimpl Parser {\n    // you can omit self\n    #[rule(Expr -&gt; Expr Add Expr)]\n    fn expr_add(l: &amp;i32, _op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        *l + *r\n    }\n    // you can use &amp;self\n    #[rule(Expr -&gt; Expr Sub Expr)]\n    fn expr_sub(&amp;self, l: &amp;i32, _op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        *l - *r\n    }\n    // you can use &amp;mut self as well\n    // but all of these have &amp;mut self in fact\n    #[rule(Expr -&gt; Expr Mul Expr)]\n    fn expr_mul(&amp;mut self, l: &amp;i32, _op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        *l * *r\n    }\n    #[rule(Expr -&gt; Expr Div Expr)]\n    fn expr_div(l: &amp;i32, _op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        *l / *r\n    }\n    #[rule(Expr -&gt; Expr Mod Expr)]\n    fn expr_mod(l: &amp;i32, _op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        *l % *r\n    }\n    #[rule(Expr -&gt; Sub Expr)]\n    fn expr_neg(_op: &amp;LogosToken&lt;Token&gt;, r: &amp;i32) -&gt; i32 {\n        -*r\n    }\n    #[rule(Expr -&gt; LPar Expr RPar)]\n    fn expr_paren(_l: &amp;LogosToken&lt;Token&gt;, i: &amp;i32, _r: &amp;LogosToken&lt;Token&gt;) -&gt; i32 {\n        *i\n    }\n    // so you can make your IDE happy with &amp;mut self here\n    #[rule(Expr -&gt; IntLit)]\n    fn expr_int(&amp;mut self, i: &amp;LogosToken&lt;Token&gt;) -&gt; i32 {\n        let lit = i.slice.parse().unwrap();\n        self.literals.push(lit);\n        lit\n    }\n}\n\n#[test]\nfn ambiguous() {\n    let mut lexer = Token::lexer(\"1 + 2 + 3\");\n    let mut parser = Parser { literals: vec![] };\n    let res = parser.parse(&amp;mut lexer).unwrap();\n    // two ways to parse\n    let res: Vec&lt;_&gt; = res.cloned().collect();\n    assert_eq!(res, vec![6, 6]);\n}\n</code></pre> <p>\u8fd9\u65f6\u5019\u5c31\u662f 0.3.0 \u7248\u672c\uff0c\u57fa\u672c\u8fbe\u5230\u4e86\u6211\u4e00\u5f00\u59cb\u60f3\u8981\u7684\u7a0b\u5ea6\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u9519\u8bef\u5904\u7406","title":"\u9519\u8bef\u5904\u7406","text":"<p>\u5728\u4e4b\u524d\u5199\u7f16\u8bd1\u539f\u7406 PA1 \u7684\u65f6\u5019\uff0c\u9047\u5230\u7684\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c\u5982\u679c\u81ea\u5df1\u7684\u4ee3\u7801\u6709\u9519\uff0c\u56e0\u4e3a\u5b8f\u5c55\u5f00\u4ee5\u540e\u4e22\u5931\u4e86\u4f4d\u7f6e\u4fe1\u606f\uff0c\u6240\u4ee5\u62a5\u9519\u90fd\u4f1a\u5728\u9519\u8bef\u7684\u4f4d\u7f6e\u3002\u4e00\u756a\u67e5\u627e\u4ee5\u540e\uff0c\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\uff1a\u539f\u6837\u8bb0\u5f55\u4e0b\u539f\u6765\u7684\u4ee3\u7801\uff08syn::Block\uff09\uff0c\u7136\u540e\u901a\u8fc7 quote \u5b8f\u76f4\u63a5\u62fc\u63a5\u5230\u6700\u7ec8\u7684 TokenStream \u4e2d\uff0c\u8fd9\u6837\u5728\u7ed3\u679c\u91cc\uff0c\u867d\u7136\u4ee3\u7801\u8fd8\u662f\u90a3\u4e9b\u4ee3\u7801\uff0c\u4f46\u90e8\u5206\u7684 Token \u5c31\u6709\u4e86\u6b63\u786e\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c31\u5f88\u65b9\u4fbf\u7528\u6237\u4ee3\u7801\u7684\u4fee\u6539\u4e86\u3002\u4e0d\u8fc7\u8fd8\u662f\u4e0d\u65b9\u4fbf\u627e\u6a21\u677f\u90e8\u5206\u7684\u4ee3\u7801\u9519\u8bef\uff0c\u6bd5\u7adf\u90a3\u90e8\u5206\u786e\u5b9e\u5728\u539f\u6765\u7684\u4ee3\u7801\u4e2d\u6ca1\u6709\u51fa\u73b0\u8fc7\u3002</p> <p>\u5bf9\u4e8e\u6a21\u677f\u4e2d\u7684\u4ee3\u7801\u9519\u8bef\uff0c\u6211\u6700\u7ec8\u7684\u89e3\u51b3\u65b9\u6848\u662f <code>cargo-expand</code> \uff0c\u628a\u6211\u7684\u6d4b\u8bd5\u4ee3\u7801\u548c\u5c55\u5f00\u540e\u7684\u4ee3\u7801\u62fc\u63a5\u8d77\u6765\uff0c\u7136\u540e\u5728\u832b\u832b\u7684\u65e0\u5173\u62a5\u9519\u4e0b\u53bb\u627e\u6211\u7684\u9519\u8bef\u7684\u5730\u65b9\u3002\u867d\u7136\u4e0d\u662f\u5f88\u597d\u7528\uff0c\u4f46\u6bd5\u7adf\u8fd8\u662f work \u7684\u3002\u53e6\u5916\uff0c\u5b8f\u8fd8\u9700\u8981\u5bf9\u7528\u6237\u4ee3\u7801\u7684\u4e00\u4e9b\u7c7b\u578b\u8fdb\u884c\u68c0\u67e5\uff0c\u6bd4\u5982\u4e0a\u9762\u7684 Expr \u5bf9\u5e94 i32\uff0c\u8fd9\u4e2a\u5c31\u9700\u8981\u5728\u5404\u5904\u90fd\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u8fd9\u4e2a\u5c31\u9700\u8981\u81ea\u5df1\u8fdb\u884c\u68c0\u67e5\u4e86\u3002\u4f7f\u7528\u4e86\u4e00\u4e0b proc_macro_diagnostic \u7684 API\uff0c\u8fd8\u4e0d\u662f\u5f88\u597d\u7528\uff0c\u7b49\u5b83 stable \u5427\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2019/11/15/rust-proc-macro-gll/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u7ec8\u4e8e\u81ea\u5df1\u624b\u5199\u4e86\u4e00\u4e2a Procedure Macro\uff0c\u611f\u89c9\u73b0\u6709\u7684\u5de5\u5177\u5df2\u7ecf\u6bd4\u8f83\u6210\u719f\u4e86\uff0c\u6709 syn quote \u4ee5\u540e\u5f88\u591a\u64cd\u4f5c\u90fd\u5f88\u65b9\u4fbf\u3002\u4f46\u4ee3\u7801\u8fd8\u6709\u5f88\u591a\u5730\u65b9\u53ef\u4ee5\u4f18\u5316\uff0c\u6162\u6162\u641e\u5427\u3002</p>","tags":["rust","gll","parsing","parser","metaprogramming"]},{"location":"programming/2016/03/09/some-interesting-links/","title":"Some interesting links","text":"<p>I'm here to share some interesting links. I do not have much time writing the blog now.</p> <p>Recently I have been working on CodeFalling/MacGesture on Github. If you are interested in it, go and have a look.</p> <p>Here are the links to share: https://twitter.com/PoolpOrg/status/694593152670437376 https://github.com/wellle/targets.vim http://thecodelesscode.com/case/225 https://twitter.com/zhangyuze320602/status/706457155763712000</p> <p>I have done reading the biography of Steve Jobs. Great book.</p>","tags":["twitter","vim","share"]},{"location":"programming/2018/02/06/thoughts-on-stanford-cs140e-2/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u6211\u53c8\u6709\u4e86\u4e00\u4e9b\u8fdb\u5c55\uff1a<code>UART</code> \uff0c\u7b80\u6613\u7684<code>shell</code> \uff0c\u4fee\u590d\u4e86\u4e4b\u524d\u5199\u7684 <code>xmodem</code> \u4e2d\u7684 BUG\uff0c\u4e00\u4e2a\u53ef\u4ee5\u4ece <code>UART</code> \u63a5\u6536\u4e00\u4e2a <code>kernel</code> \u5199\u5165\u5230\u5185\u5b58\u4e2d\u518d\u8df3\u8f6c\u8fc7\u53bb\u7684 <code>bootloader</code> \u3002</p> <p>\u9996\u5148\u662f <code>UART</code> \uff0c\u5c31\u662f\u901a\u8fc7\u4e24\u4e2a <code>GPIO pin</code> \u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u9996\u5148\u5728 <code>memory mapped IO</code> \u4e0a\u8fdb\u884c\u76f8\u5e94\u7684\u521d\u59cb\u5316\uff0c\u7136\u540e\u5305\u88c5\u4e86 <code>io::Read</code> \u548c <code>io::Write</code> \uff08\u8fd9\u91cc\u5b9e\u73b0\u4e00\u5f00\u59cb\u6709 BUG\uff0c\u540e\u6765\u4fee\u590d\u4e86\uff09\uff0c\u7136\u540e\u5f88\u5feb\u5730\u5b8c\u6210\u4e86\u4e00\u4e2a\u4ec5\u4ec5\u80fd <code>echo</code> \u7684 <code>kernel</code> \u3002</p> <p>\u7136\u540e\u5b9e\u73b0\u4e86 <code>CONSOLE</code> \uff0c\u4e00\u4e2a\u5bf9 <code>MiniUart</code> \u548c\u5355\u4f8b\u5c01\u88c5\uff0c\u5c31\u53ef\u4ee5\u7528 <code>kprint!/kprintln!</code> \u5b8f\u6765\u8f93\u51fa\u5230 <code>UART</code> \uff0c\u63a5\u7740\u5b9e\u73b0\u4e86\u4e00\u4e2a <code>echo</code> \u7684 <code>shell</code> \uff0c\u8bfb\u5165\u4e00\u884c\u8f93\u51fa\u4e00\u884c\u3002\u7136\u540e\u5b9e\u73b0\u9000\u683c\u952e\u548c\u65b9\u5411\u952e\uff0c\u8fd9\u91cc\u7684\u96be\u70b9\u5728\u4e8e\u8981\u63a7\u5236\u5149\u6807\u5e76\u4e14\u7528\u8bfb\u5165\u7684\u6216\u8005\u7a7a\u683c\u8986\u76d6\u6389\u5c4f\u5e55\u4e0a\u5df2\u7ecf\u663e\u793a\u800c\u4e0d\u5e94\u8be5\u663e\u793a\u7684\u5185\u5bb9\u3002\u63a5\u7740\uff0c\u5229\u7528 <code>skeleton</code> \u4e2d\u7684 <code>Command</code> \u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 <code>echo</code> \u547d\u4ee4\u3002</p> <p>\u63a5\u7740\uff0c\u5229\u7528\u4e4b\u524d\u7f16\u5199\u7684 <code>tty</code> \uff0c\u914d\u5408\u4e0a\u65b0\u7f16\u5199\u7684 <code>bootloader</code> \uff0c\u5b9e\u73b0\u901a\u8fc7 <code>UART</code> \u628a\u65b0\u7684 <code>kernel</code> \u901a\u8fc7 <code>XMODEM</code> \u534f\u8bae\u53d1\u9001\u5230\u8bbe\u5907\uff0c\u5199\u5165 <code>0x80000</code> \u542f\u52a8\u5730\u5740\u5e76\u4e14\u8c03\u8f6c\u5230\u65b0\u52a0\u8f7d\u7684 <code>kernel</code> \u4e2d\u6267\u884c\u3002</p> <p>\u6700\u540e\uff0c\u53c8\u5b9e\u73b0\u4e86 <code>uptime</code> \uff08\u8f93\u51fa\u8bbe\u5907\u542f\u52a8\u5230\u73b0\u5728\u7684\u65f6\u95f4\uff09\u548c <code>exit</code> \uff08\u8df3\u8f6c\u56de <code>bootloader</code> \uff0c\u53ef\u4ee5\u4e0a\u4f20\u65b0\u7684 <code>kernel</code> \uff09\u3002\u5e76\u6dfb\u52a0\u4e86 <code>TUNA</code> \u4f5c\u4e3a <code>shell</code> \u542f\u52a8\u65f6\u8f93\u51fa\u7684 <code>BANNER</code> \u3002</p> <p>\u6574\u4e2a\u8fc7\u7a0b\u633a\u8650\u7684\uff0c\u8e29\u4e86\u5f88\u591a\u7684\u5751\uff0c\u7531\u4e8e\u5f88\u591a\u4e1c\u897f\u90fd\u6ca1\u6709\uff0c\u8f93\u5165\u8f93\u51fa\u76ee\u524d\u4e5f\u53ea\u6709 <code>UART</code> \uff0c\u5199\u4e86 <code>UART</code> \u540e\u53c8\u9047\u5230 <code>XMODEM</code> \u96be\u4ee5\u8c03\u8bd5\u7684\u95ee\u9898\u3002\u5341\u5206\u611f\u8c22 <code>#tuna</code> \u4e0a\u7684 @BenYip \u53ca\u65f6\u5730\u6307\u51fa\u4e86\u4ee3\u7801\u7684\u51e0\u5904\u95ee\u9898\uff0c\u8282\u7701\u4e86\u6211\u8bb8\u591a\u65f6\u95f4\u3002</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","kernel","gpio","hardware","rpi3","shell","bootloader","xmodem","uart"]},{"location":"programming/2018/02/16/thoughts-on-stanford-cs140e-3/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09","text":"<p>\u7531\u4e8e <code>Assignment 2: File System</code> \u5ef6\u671f\u53d1\u5e03\uff0c\u6240\u4ee5\u4e2d\u95f4\u90a3\u6bb5\u65f6\u95f4\u8f6c\u5411 <code>MIT 6.828</code> \u7a0d\u5fae\u7814\u7a76\u4e86\u4e00\u4e0b\u3002\u524d\u51e0\u5929\u653e\u51fa\u4e86\u65b0\u7684\u4efb\u52a1\uff0c\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u6211\u53c8\u6709\u4e86\u4e00\u4e9b\u8fdb\u5c55\uff1a\u5b9e\u73b0\u4e86\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6 <code>ATAGS(ARM Tags)</code> \u4fe1\u606f\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u53ef\u4ee5\u83b7\u5f97\u5185\u5b58\u5927\u5c0f\u7684\u4fe1\u606f\uff0c\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\uff0c\u5b9e\u73b0\u4e86 <code>bump</code> \u548c <code>bin</code> \u4e24\u79cd\u5185\u5b58\u5206\u914d\u5668\uff0c\u5e76\u4e14\u628a\u4e8c\u8005\u4e4b\u4e00\u6ce8\u518c\u4e3a\u5168\u5c40\u5185\u5b58\u5206\u914d\u5668\uff0c\u5229\u7528\u4e0a\u66f4\u65b0\u4e86\u7684 <code>std</code> \u5c31\u53ef\u4ee5\u4f7f\u7528\u9700\u8981\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684\u76f8\u5173\u5de5\u5177\u4e86\u3002\u5229\u7528\u8fd9\u4e2a\uff0c\u6211\u5b9e\u73b0\u4e86 <code>shell</code> \u8f93\u5165\u5386\u53f2\u7684\u56de\u6eaf\uff0c\u628a\u8f93\u5165\u5386\u53f2\u4fdd\u5b58\u5728\u4e00\u4e2a\u52a8\u6001\u589e\u957f\u7684\u6570\u7ec4\u4e2d\uff0c\u518d\u7279\u6b8a\u5904\u7406\u4e0a\u4e0b\u952e\uff0c\u628a\u5f53\u524d\u7684\u884c\u66ff\u6362\u4e3a\u5386\u53f2\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u4e0d\u662f\u6ca1\u6709\u8e29\u5751\u3002\u4e00\u5f00\u59cb\u4ee3\u7801\u653e\u51fa\u6765\u4e86\uff0c\u4f46\u662f\u9898\u76ee\u8bf4\u660e\u8fd8\u6ca1\u51fa\uff0c\u6211\u5c31\u81ea\u5df1\u6309\u7167\u4ee3\u7801\u505a\u4e86 <code>ATAGS</code> \u548c <code>bump</code> \u5206\u914d\u5668\uff0c\u540e\u6765\u505a\u5b8c\u4e86\uff0c\u770b\u5230\u8bf4\u660e\u51fa\u4e86\u4ee5\u540e\uff0c\u53d1\u73b0\u7406\u89e3\u8fd8\u662f\u6709\u504f\u5dee\uff0c\u628a\u4ee3\u7801\u66f4\u6539\u4e86\u5e76\u4fee\u590d\u4e86\u5206\u914d\u5668\u7684 BUG\u3002\u770b\u5230 <code>bin</code> \u5206\u914d\u5668\u7684\u65f6\u5019\uff0c\u6211\u6309\u7167\u7f51\u4e0a\u7684 <code>buddy memory allocation</code> \u5b9e\u73b0\u4e86\u4e00\u4e2a\u5185\u5b58\u5206\u914d\u5668\uff0c\u539f\u7406\u770b\u8d77\u6765\u7b80\u5355\u5b9e\u73b0\u8d77\u6765\u8fd8\u662f\u6709\u5f88\u591a\u7ec6\u8282\u95ee\u9898\uff0c\u540e\u6765\u6309\u7167\u65b0\u653e\u51fa\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u4fee\u4fee\u8865\u8865\u624d\u5199\u5f97\u5dee\u4e0d\u591a\u53ef\u7528\u4e86\u3002\u540c\u65f6\uff0c\u539f\u6765\u7684 <code>bootloader</code> \u56e0\u4e3a\u7528\u4e86\u65b0\u7684 <code>std</code> \u800c\u7f3a\u5931\u4e86 <code>alloc</code> \u4e0d\u80fd\u7f16\u8bd1\uff0c\u6211\u5c31\u628a <code>kernel</code> \u4e0b\u7684\u76f8\u5173\u6587\u4ef6\u8f6f\u8fde\u63a5\u8fc7\u53bb\uff0c\u8c03\u4e86\u6570\u6b21\u540e\u628a\u95ee\u9898\u89e3\u51b3\u3002\u6b64\u65f6\uff0c <code>kernel</code> \u6587\u4ef6\u5927\u5c0f\u5df2\u7ecf\u6709 40K\uff0c\u6309\u7167 115200 Baudrate \u53d1\u9001\u9700\u8981\u51e0\u79d2\u624d\u80fd\u4f20\u8f93\u8fc7\u53bb\uff0c\u6211\u5c31\u8c03\u5230\u4e86 230400 Baudrate\uff0c\u679c\u7136\u73b0\u5728\u7684\u4f20\u8f93\u901f\u5ea6\u5c31\u6709\u6240\u63d0\u5347\uff0c\u53ef\u4ee5\u63a5\u53d7\u4e86\u3002\u7b49\u4e4b\u540e\u5199\u4e86 <code>EMMC(SD card)</code> \u7684\u9a71\u52a8\u548c <code>FAT32</code> \u7684\u6587\u4ef6\u7cfb\u7edf\u540e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u66f4\u591a\u7684 <code>shell</code> \u7684\u529f\u80fd\u4e86\u3002\u4e2d\u95f4\u8fd8\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5982\u679c\u7ed9 <code>kernel</code> \u5f00\u542f\u4e86 <code>bin</code> \u5206\u914d\u5668\uff0c\u4f7f\u7528 <code>exit</code> \u56de\u5230 <code>bootloader</code> \u5c31\u65e0\u6cd5\u4f20\u65b0\u7684 <code>kernel</code> \u4e0a\u53bb\u4e86\uff0c\u7ed3\u679c\u53d1\u73b0\u662f\u56e0\u4e3a <code>bin</code> \u4e2d\u7528\u5230\u7684\u4fb5\u5165\u5f0f <code>LinkedList</code> \u5b9e\u73b0\u8986\u76d6\u4e86\u90e8\u5206 <code>bootloader</code> \u7684\u4ee3\u7801\uff0c\u6362\u56de\u4e0d\u80fd\u56de\u6536\u5185\u5b58\u7684 <code>bump</code> \u5206\u914d\u5668\u5373\u53ef\uff0c\u53cd\u6b63\u76ee\u524d\u8fdc\u8fdc\u8fd8\u7528\u4e0d\u4e86\u90a3\u4e48\u591a\u5185\u5b58\u3002</p> <p>\u4e4b\u540e\u8fd8\u8981\u5728 <code>aarch64</code> \u4e0a\u7528 <code>MMU</code> \u5b9e\u73b0\u865a\u62df\u5185\u5b58\uff0c\u4e4b\u524d\u5728 <code>MIT 6.828</code> \u91cc\u88ab\u9875\u8868\u6574\u5f97\u8111\u5b50\u7729\u6655\uff0c\u5e0c\u671b\u5230\u65f6\u6211\u8fd8\u6d3b\u7740\u5427\uff08\u9003</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","kernel","hardware","rpi3","shell","bootloader","mit 6.828","atags"]},{"location":"programming/2018/02/27/thoughts-on-stanford-cs140e-4/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u4f5c\u8005\u591a\u6b21\u5ef6\u671f\u8df3\u7968\u4e4b\u540e\uff0c\u7ec8\u4e8e\u653e\u51fa\u4e86 <code>Assignment 2 Phase 2:32-bit Lipids</code> \uff0c\u8fd9\u4e24\u5929\u5c31\u628a\u53ea\u8bfb <code>FAT32</code> \u5199\u5b8c\u4e86\uff08\u4e0d\u8fc7\u5c01\u88c5\u5f97\u5e76\u4e0d\u597d\uff0c\u8bb8\u591a\u5730\u65b9\u5229\u7528\u4e86 <code>pub(super)</code> \u628a\u53d8\u91cf\u53ef\u4ee5\u8bbf\u95ee\u7684\u8303\u56f4\u63a7\u5236\u5230 <code>vfat</code> \u4e2d\uff0c\u7136\u540e\u76f4\u63a5\u8bfb\uff0c\u53ea\u6709\u5c11\u6570\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\u8fdb\u884c\u4e86\u51fd\u6570\u7684\u5c01\u88c5\uff09\u3002\u9996\u5148\u5f53\u7136\u662f\u7814\u7a76\u4e86\u534a\u5929 <code>MBR</code> \u548c <code>FAT32</code> \u7684\u7ed3\u6784\uff0c\u62ff\u4e86\u4e0d\u540c\u6765\u6e90\u7684 <code>FAT</code> \u7ed3\u6784\u8bf4\u660e\u8fdb\u884c\u5bf9\u6bd4\u548c\u9a8c\u8bc1\uff0c\u6700\u540e\u7ec8\u4e8e\u628a\u683c\u5f0f\u641e\u6e05\u695a\u4e86\uff0c\u5148\u5b9e\u73b0\u4e86 <code>MasterBootRecord</code> \uff0c\u8fd9\u4e2a\u5176\u5b9e\u5f88\u597d\u5b9e\u73b0\uff0c\u4ee5\u524d\u4e5f\u6709\u63a5\u89e6\u8fc7 <code>MBR</code> \uff0c\u672c\u8eab\u4e5f\u5f88\u7b80\u5355\u3002\u7136\u540e\u5c31\u662f\u6839\u636e <code>MBR</code> \u627e\u5230\u7b2c\u4e00\u4e2a <code>FAT32</code> \u7684\u5206\u533a\uff0c\u6839\u636e\u504f\u79fb\u627e\u5230\u5206\u533a\u7684\u5f00\u5934\uff0c\u5f00\u5934\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\u5c31\u662f <code>EBPB</code> \u6570\u636e\u7ed3\u6784\uff0c\u91cc\u9762\u4fdd\u5b58\u4e86 <code>FAT32</code> \u5206\u533a\u7684\u5404\u79cd\u4fe1\u606f\u3002\u6839\u636e\u91cc\u9762\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u627e\u5230 <code>FAT</code> \u8868\u7684\u4f4d\u7f6e\u548c\u6570\u91cf\uff0c\u8fd8\u6709\u6570\u636e\u90e8\u5206\u7684 <code>Cluster</code> \u7684\u4f4d\u7f6e\u548c\u6570\u91cf\u3002\u63a5\u7740\uff0c\u89e3\u6790\u4e00\u4e0b <code>FAT</code> \u8868\uff0c\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u4e0e <code>Cluster</code> \u4e00\u4e00\u5bf9\u5e94\u7684\u94fe\u8868\u7ed3\u6784\uff0c\u7528\u7279\u6b8a\u7684\u6570\u636e\u4ee3\u8868\u94fe\u8868\u7684\u5c3e\u548c\u7a7a\u3001\u574f\u6247\u533a\u3002\u5229\u7528\u8fd9\u4e9b\uff0c\u548c <code>EBPB</code> \u4e2d\u6839\u76ee\u5f55\u6240\u5728\u7684\u7b2c\u4e00\u4e2a <code>Cluster</code> \uff0c\u5148\u5728 <code>VFat</code> \u91cc\u9762\u5b9e\u73b0\u4e86\u8bfb\u53d6\u4e00\u4e2a <code>Cluster</code> \u94fe\u7684\u5185\u5bb9\u7684\u51fd\u6570\uff0c\u5229\u7528\u8fd9\u4e2a\u51fd\u6570\u8bfb\u53d6\u4e00\u4e2a\u4e00\u4e2a\u7684\u76ee\u5f55\u9879\uff0c\u89e3\u6790\u76ee\u5f55\u9879\uff0c\u628a\u957f\u6587\u4ef6\u540d\u7684\u9879\u5408\u5e76\u5230\u4e00\u4e2a\u4e4b\u4e2d\uff0c\u7136\u540e\u5bf9\u5e94\u5730\u4e22\u5230 <code>Entry</code> \u5bf9\u8c61\u4e2d\uff0c\u76ee\u5f55\u5219\u53ef\u4ee5\u679a\u4e3e\u5b50\u76ee\u5f55\u9879\uff0c\u6839\u636e\u540d\u5b57\u6bd4\u8f83\u53bb\u627e\u5b50\u76ee\u5f55\u6216\u8005\u5b50\u6587\u4ef6\u5939\uff0c\u6587\u4ef6\u5219\u5b9e\u73b0\u4e86 <code>io::Read</code>\u548c <code>io::Seek</code> \u4f7f\u5f97\u53ef\u4ee5\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\u3002\u5b9e\u73b0\u597d\u4e86\u8fd9\u4e9b\u4ee5\u540e\uff0c\u5c31\u62ff\u4e86 <code>raspbian-strech-lite.img</code> \u4f5c\u4e3a\u786c\u76d8\u6620\u50cf\uff0c\u4ece\u6587\u4ef6\u91cc\u8bfb\u53d6\u6587\u4ef6\u4fe1\u606f\uff0c\u6210\u529f\u5730\u628a <code>config.txt</code> \u8bfb\u53d6\u51fa\u6765\u3002</p> <p>\u5176\u4e2d\u8fd8\u662f\u9047\u5230\u8bb8\u591a\u56f0\u96be\uff0c\u5982\u5404\u79cd\u504f\u79fb\u7684\u8ba1\u7b97\uff0c\u5982\u4f55\u5904\u7406\u8de8 <code>Cluster</code> \u548c\u8de8 <code>Sector</code> \u7684\u8bfb\u5199\uff0c\u7b49\u7b49\uff0c\u6709\u4e0d\u5c11\u7684\u5751\u5728\u5176\u4e2d\uff0c\u82b1\u4e86\u4e24\u5929\u7684\u7a7a\u4f59\u65f6\u95f4\u624d\u5dee\u4e0d\u591a\u5b8c\u5584\u4e86\u8fd9\u4e2a\u529f\u80fd\u3002\u8fd8\u6709\u5c31\u662f\u5229\u7528 <code>Rust</code> \u73b0\u6709\u7684\u529f\u80fd\u5b8c\u6210 <code>C</code> \u91cc\u9762\u5f88\u8f7b\u6613\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7684\u6307\u9488\u64cd\u4f5c\uff0c\u4e5f\u82b1\u4e86\u4e0d\u5c11\u65f6\u95f4\u3002</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","rpi3","fat32"]},{"location":"programming/2018/03/03/thoughts-on-stanford-cs140e-5/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u4f5c\u8005\u591a\u6b21\u5ef6\u671f\u8df3\u7968\u4e4b\u540e\uff08again\uff09\uff0c\u7ec8\u4e8e\u653e\u51fa\u4e86 <code>Assignment 2 Phase 3: Saddle Up</code> \u3002\u8fd9\u6b21\uff0c\u6211\u4eec\u8981\u505a\u7684\u53d8\u6210\u4e86\u628a\u5df2\u7ecf\u5199\u597d\u7684\uff08\u9519\u6f0f\u767e\u51fa\uff09\u7684 <code>fat32</code> \u7684\u9a71\u52a8\u642c\u5230\u6811\u8393\u6d3e\u91cc\u9762\u53bb\uff0c\u7136\u540e\u5b9e\u73b0\u4e00\u4e9b\u57fa\u672c\u7684 <code>shell</code> \u547d\u4ee4\uff1a <code>ls</code> <code>cat</code> <code>cd</code> \u7b49\u7b49\u3002\u4f5c\u8005\u9996\u5148\u66f4\u65b0\u4e86\u8001\u7248\u672c\u7684\u65b0\u7684\u6d4b\u8bd5\u6837\u4f8b\uff0c\u653e\u4e86\u4e00\u4e9b\u6620\u50cf\u7136\u540e\u63d0\u4f9b\u4e86\u9884\u671f\u7684\u7ed3\u679c\uff0c\u7ed3\u679c\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684 <code>fat32</code> \u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u4e3b\u8981\u7684\u5c31\u662f <code>bytes_per_sector</code> \u4e0d\u662f <code>512</code> \u4e86\uff0c\u610f\u5473\u7740\u7269\u7406\u7684\u6247\u533a\u548c\u903b\u8f91\u6247\u533a\u5e76\u4e0d\u4e00\u81f4\u3002\u540c\u65f6\uff0c <code>sectors_per_cluster</code> \u4e5f\u4e0d\u662f <code>1</code> \u4e86\uff0c\u9700\u8981\u8003\u8651\u591a\u4e2a\u6247\u533a\u7684\u60c5\u51b5\u3002\u540c\u65f6\uff0c <code>read_cluster</code> \u4f20\u5165\u7684 <code>offset</code> \u4e5f\u53ef\u80fd\u4e0d\u518d\u662f\u7b2c\u4e00\u4e2a <code>sector</code> \u4e2d\u7684\uff0c\u6240\u4ee5\u9700\u8981\u505a\u4e00\u4e2a\u5904\u7406\u3002\u5bf9\u4e8e\u7269\u7406\u548c\u903b\u8f91\u6247\u533a\u7684\u95ee\u9898\uff0c\u4f5c\u8005\u63a8\u8350\u7684\u65b9\u6848\u662f\uff0c\u628a <code>fat32</code> \u4e4b\u5916\u7684\u6247\u533a\u4fdd\u6301\u4e0d\u53d8\uff0c\u628a\u5176\u5185\u7684\u6247\u533a\u89c6\u4e3a\u903b\u8f91\u6247\u533a\u3002\u8fd9\u6837\uff0c\u5176\u5b83\u4ee3\u7801\u90fd\u53ef\u4ee5\u900f\u660e\u5730\u5de5\u4f5c\uff0c\u800c\u4e0d\u7528\u5230\u5904\u66f4\u6539\uff0c\u8fd9\u5c31\u4f53\u73b0\u4e86\u5c01\u88c5\u7684\u5a01\u529b\u3002\u63a5\u7740\uff0c\u4f5c\u8005\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5199\u597d\u4e86\u7684 <code>libsd</code> \u548c\u4e00\u4e9b\u5bfc\u51fa\u7684\u51fd\u6570\uff0c\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u5373\u53ef\u3002\u4e0d\u8fc7\uff0c\u5728\u9519\u8bef\u5904\u7406\u548c <code>timeout</code> \u4e0a\u4e5f\u9047\u5230\u4e86\u4e00\u4e9b\u5751\u3002\u540e\u9762\uff0c\u628a\u4e1c\u897f\u642c\u5230\u6811\u8393\u6d3e\u4e0a\u8fd0\u884c\uff0c\u95ee\u9898\u5c31\u51fa\u73b0\u4e86\uff1a\u8bfb\u53d6\u4e86\u7b2c\u4e00\u4e2a\u6247\u533a\uff08\u5373 <code>MBR</code> \u6240\u5728\u7684\u6247\u533a\uff09\u4e4b\u540e\uff0c\u76f4\u63a5\u5c31\u6b7b\u6389\u4e86\u3002\u60f3\u4e86\u534a\u5929\u90fd\u6ca1\u627e\u5230\u65b9\u6848\uff0c\u7a81\u7136\u60f3\u8d77\u53ef\u4ee5\u5229\u7528 <code>panic!</code> \u5bf9\u9519\u8bef\u8bed\u53e5\u8fdb\u884c\u4e8c\u5206\u67e5\u627e\u3002\u67e5\u627e\u4e86\u5927\u6982\u6709\u4e03\u516b\u4e2a\u5c0f\u65f6\u4e4b\u540e\uff0c\u7ec8\u4e8e\u53d1\u73b0\uff0c\u95ee\u9898\u51fa\u73b0\u5728\u8bfb\u53d6\u4e00\u4e2a <code>u32</code> \u7c7b\u578b\u7684\u53d8\u91cf\u4e0a\u3002\u6211\u8d77\u521d\u6000\u7591\u662f\u6808\u51fa\u4e86\u95ee\u9898\uff0c\u6240\u4ee5\u653e\u5230\u5806\u4e0a\u5206\u914d\uff0c\u7136\u800c\u8fd8\u662f\u4e0d\u884c\u3002\u5ffd\u7136\u60f3\u8d77\u4ee5\u524d\u9047\u5230\u7684\u5bf9\u9f50\u95ee\u9898\uff0c\u5728 <code>AArch64</code> \u67b6\u6784\u4e0a\uff0c\u53ef\u80fd\u4e3a\u4e86\u7b80\u5316\uff0c\u8bfb\u53d6\u7684 <code>u32</code> \u5fc5\u987b\u5bf9\u9f50\u5230\u56db\u4e2a\u5b57\u8282\u4e0a\u3002\u4e8e\u662f\u627e\u4e86\u627e <code>Rust</code> \u4e2d\u7684\u5bf9\u9f50\u65b9\u9762\u7684\u6587\u6863\uff0c\u627e\u5230\u4e86 <code>#[repr(align=4)]</code> \u8fd9\u79cd\u8868\u793a\u65b9\u6cd5\uff0c\u4ee3\u66ff\u4e86\u539f\u6765\u7684 <code>#[repr(packed)]</code> \uff0c\u5e76\u4e14\u628a\u6570\u636e\u5148\u62f7\u8d1d\u5230\u5bf9\u9f50\u540e\u7684\u6808\u4e0a\u7684\u5bf9\u5e94\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u518d\u8bfb\u53d6\u5bf9\u5e94\u7684\u9879\u3002\u679c\u7136\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\u7136\u540e\u53c8\u53d1\u73b0\u6211\u7684\u76d8\u4e2d\u4f1a\u51fa\u73b0 <code>lfn</code> \u9879\u5e76\u4e0d\u662f\u4ece\u540e\u5f80\u524d\u7684\u60c5\u51b5\uff0c\u4e8e\u662f\u6211\u53c8\u4fee\u6539\u4e86\u4e00\u4e0b\u76f8\u5173\u7684\u4ee3\u7801\u3002\u73b0\u5728\uff0c\u7ec8\u4e8e\u53ef\u4ee5\u6210\u529f\u5730 <code>ls</code> <code>cat</code> <code>cd</code> \u3002</p> <p>\u4e0d\u8fc7\u8fd8\u662f\u8981\u5410\u69fd\u4e00\u4e0b\uff0c\u4f5c\u8005\u7684\u6d4b\u8bd5\u7528\u7684\u6620\u50cf\u6587\u4ef6\u4e2d\uff0c\u4f1a\u51fa\u73b0 <code>0xE5</code> \u8868\u793a\u8fd9\u4e2a\u9879\u5df2\u7ecf\u88ab\u5220\u9664\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u4f3c\u4e4e\u4f5c\u8005\u7684\u4ee3\u7801\u5e76\u6ca1\u6709\u5904\u7406\u8fd9\u4e2a\uff0c\u6240\u4ee5\u5728\u9884\u671f\u7684\u8f93\u51fa\u4e2d\u51fa\u73b0\u4e86\u4e00\u4e9b\u660e\u663e\u4e0d\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u5bfc\u81f4\u6211\u7684\u4ee3\u7801\u8dd1\u6d4b\u8bd5\u5e76\u4e0d\u80fd\u901a\u8fc7\u3002\u800c\u4e14\uff0c\u4f5c\u8005\u7684\u4ee3\u7801\u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u628a\u6587\u4ef6\u7684\u540e\u7f00\u6f0f\u6389\u3002\u4f5c\u8005\u540e\u6765\u66f4\u65b0\u4e86\u51e0\u6b21\u6d4b\u8bd5\u7684\u6587\u4ef6\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u95ee\u9898\u53ea\u89e3\u51b3\u4e86\u4e00\u90e8\u5206\uff0c\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u3002\u5750\u7b49\u4f5c\u8005\u7ee7\u7eed\u653e\u51fa\u65b0\u7684\u6d4b\u8bd5\u6587\u4ef6\u5427\u3002</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","rpi3","fat32","sd card","alignment"]},{"location":"programming/2018/03/05/thoughts-on-stanford-cs140e-6/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u4f5c\u8005\u7ec8\u4e8e\u66f4\u65b0\u4e86\u6d4b\u8bd5\u7684\u7528\u4f8b\uff0c\u6211\u7684\u7a0b\u5e8f\u7ec8\u4e8e\u53ef\u4ee5\u6210\u529f\u8dd1\u8fc7\u6240\u6709\u6d4b\u8bd5\uff0c\u4e5f\u6210\u529f\u5728\u6811\u8393\u6d3e\u8dd1\u8d77\u6765\u3002\u4e0d\u8fc7\uff0c\u6211\u7684\u4ee3\u7801\u4e2d\u5f88\u591a\u5730\u65b9\u7684\u9519\u8bef\u5904\u7406\u6bd4\u8f83\u5077\u61d2\uff0c\u5f80\u5f80\u76f4\u63a5 <code>panic</code> \uff0c\u663e\u7136\u5e76\u4e0d\u53cb\u597d\u3002\u540c\u65f6\uff0c\u6211\u60f3\u5230\u4e86\u4f7f\u7528 cargo-fuzz \u6765\u8fdb\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\uff0c\u679c\u7136\uff0c\u4f7f\u7528\u8fd9\u4e2a\u5f88\u5feb\u5c31\u4fee\u590d\u4e86\u4e0d\u5c11\u6211\u6ca1\u60f3\u5230\u7684\u4f1a\u51fa\u9519\u7684\u5730\u65b9\uff0c\u6bd4\u5982\u4e58\u6cd5\u6ea2\u51fa\uff0c\u76ee\u5f55\u9879\u6ca1\u6709\u6b63\u786e\u7ed3\u675f\u7b49\u7b49\u3002\u76ee\u524d\u8fd8\u53d1\u73b0\u4e00\u4e2a <code>timeout</code> \u7684\u95ee\u9898\uff0c\u7814\u7a76\u53d1\u73b0\u5927\u6982\u662f\u6587\u4ef6\u7684 <code>cluster chain</code> \u4e2d\u51fa\u73b0\u4e86\u73af\uff0c\u5bfc\u81f4\u4e00\u76f4\u8bfb\u53d6\u6587\u4ef6\u800c\u6ca1\u6709\u505c\u6b62\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u76ee\u524d\u60f3\u5230\u7684\u662f <code>Floyd</code> \u7684\u5224\u5708\u7b97\u6cd5\uff0c\u4f46\u8fd8\u6ca1\u4e0a\u5b9e\u73b0\u3002\u7b49\u8fc7\u51e0\u5929\uff0c\u65b0\u7684 <code>Assignment 3</code> \u51fa\u4e86\u4ee5\u540e\uff0c\u518d\u7ee7\u7eed\u66f4\u65b0\u3002\u5e0c\u671b\u4f5c\u8005\u5c11\u70b9\u8df3\u7968\uff0c\u591a\u70b9\u52e4\u594b\uff0c\u54c8\u54c8\u54c8\u54c8\u54c8</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","fat32","fuzz test"]},{"location":"programming/2018/04/07/thoughts-on-stanford-cs140e-7/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u6211\u5f88\u957f\u65f6\u95f4\u90fd\u6ca1\u6709\u5728\u7ee7\u7eed\u6211\u8fd9\u4e2a\u9879\u76ee\uff0c\u6e05\u660e\u8282\u521a\u597d\u95f2\u4e0b\u6765\u4e86\u6211\u5c31\u56de\u6765\u7ee7\u7eed\u5543\u5b83\u3002Stanford \u90a3\u8fb9\u5df2\u7ecf\u7ed3\u8bfe\uff0c\u6700\u540e\u7684 <code>3-spawn</code> \u4e5f\u53ea\u6709\u4e00\u90e8\u5206\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u4f5c\u8005\u624d\u4f1a\u586b\u4e0a\u53bb\u4e86\u3002</p> <p>\u8fd9\u6b21\u4e3b\u8981\u8981\u5199\u7684\u4ee3\u7801\u5c31\u662f\uff0c\u5bf9\u5f02\u5e38\u7684\u5904\u7406\u3002\u8fd9\u91cc\u7684\u5f02\u5e38\u5e76\u4e0d\u662f\u6211\u4eec\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684 catch/throw\uff0c\u800c\u662f\u786c\u4ef6\u7684\u5f02\u5e38\u3002AArch64 \u548c x86 \u4e00\u6837\uff0c\u4e5f\u6709\u4e0d\u540c\u7684\u7279\u6743\u7ea7\u522b\u7684\u533a\u5206\uff0c\u524d\u8005\u662f EL0~EL3\uff0c\u540e\u8005\u5219\u662f RING0 \u548c RING3\u3002\u7279\u6743\u7ea7\u522b\u9ad8\u53ef\u4ee5\u5f80\u7279\u6743\u7ea7\u522b\u4f4e\u8f6c\u6362\uff0c\u4f46\u662f\u53cd\u8fc7\u6765\uff0c\u53ea\u80fd\u901a\u8fc7\u5f02\u5e38\u7684\u65b9\u5f0f\u63d0\u9ad8\u7279\u6743\u7b49\u7ea7\uff0c\u5e76\u4e14\u5207\u6362\u7279\u6743\u7b49\u7ea7\u540e\u53ea\u6709\u56fa\u5b9a\u7684\u4e00\u4e9b\u4ee3\u7801\u53ef\u80fd\u4f1a\u8df3\u8f6c\uff0c\u8fd9\u5c31\u662f <code>exception handler/vectors</code> \u3002\u8fd9\u4e9b\u51fd\u6570\u53ef\u4ee5\u77e5\u9053\u662f\u4ec0\u4e48\u539f\u56e0\u8c03\u7528\u4e86\u4ed6\u4eec\uff0c\u6839\u636e\u786c\u4ef6\u89c4\u5b9a\u597d\u7684\u6587\u6863\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u53d1\u751f\u4e86\u4ec0\u4e48\u4e8b\u60c5\uff0c\u662f\u5bf9\u9f50\u51fa\u9519\u4e86\u5462\uff0c\u8fd8\u662f\u7528\u6237\u8c03\u7528\u4e86 syscall \u5462\uff0c\u7b49\u7b49\u3002\u6839\u636e\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e0d\u540c\u7684\u5904\u7406\u3002\u5f53\u5904\u7406\u5b8c\u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\uff0c\u8df3\u8f6c\u56de\u7528\u6237\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u56de\u5230\u54ea\u91cc\uff0c\u63d0\u4f9b\u4ec0\u4e48\u503c\uff0c\u4e0d\u63d0\u4f9b\u4ec0\u4e48\u3002</p> <p>\u5b9e\u73b0\u7684\u8bdd\uff0c\u9700\u8981\u5f88\u591a\u6b65\u9aa4\u3002\u9996\u5148\u662f\u6784\u9020\u597d <code>exception vector</code> \uff0c\u8fd9\u91cc\u4f5c\u8005\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u4e2a\u5b8f\uff08\u8fd9\u91cc @BenYip \u9047\u5230\u4e86\u4e00\u4e2a assembler \u7684 BUG\uff09\uff0c\u76f4\u63a5\u7528\u5b8f\u5c31\u53ef\u4ee5\u628a\u5b83\u5199\u51fa\u6765\u3002\u7136\u540e\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u52a0\u8f7d\u5230\u5f53\u524d EL \u7684 <code>VBAR_ELx</code> \u5bc4\u5b58\u5668\u4e2d\uff0c\u5f53 CPU \u629b\u51fa\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u627e\u5230\u8fd9\u91cc\u76f8\u5e94\u7684\u5904\u7406\u5668\u8fdb\u884c\u5904\u7406\u3002\u8fdb\u5230\u8fd9\u91cc\u4ee5\u540e\uff0c\u6211\u4eec\u9996\u5148\u5148\u4e0d\u8003\u8651\u592a\u591a\u4e0a\u4e0b\u6587\u4fdd\u5b58\u7684\u4e8b\u60c5--\u6211\u4eec\u5148\u4fdd\u8bc1\u80fd\u5904\u7406\u5f02\u5e38\uff0c\u6062\u590d\u4e5f\u662f\u4e2a\u6709\u5f88\u591a\u5751\u7684\u6b65\u9aa4\uff0c\u4f5c\u8005\u4e5f\u662f\u5728\u8fd9\u91cc\u5206\u6210\u4e86\u4e24\u4e2a Subphase\u3002\u9996\u5148\u8fd8\u662f\u4ece <code>ESR_ELx</code> \u4e2d\u89e3\u6790\u5230\u9519\u8bef\u7684\u6765\u6e90\u7684\u5177\u4f53\u5185\u5bb9\uff0c\u5982\u679c\u662f\u6211\u4eec\u5728 <code>shell</code> \u4e2d\u81ea\u5df1\u8c03\u7528\u7684 <code>brk 2</code> \u6307\u4ee4\uff0c\u6211\u4eec\u5c31\u81ea\u5df1\u65b0\u5f00\u4e00\u4e2a <code>shell</code> \uff0c\u4fee\u6539\u4e86\u63d0\u793a\u7b26\u4ee5\u793a\u533a\u522b\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u6210\u529f\u5730\u6355\u6349\u5230\u4e86\u8fd9\u4e2a\u5f02\u5e38\u3002\u7531\u4e8e\u6211\u4eec\u8fd8\u65e0\u6cd5\u6062\u590d\u56de\u53bb\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u6b7b\u5faa\u73af\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u505a\u7684\u662f\uff0c\u4ece\u5f02\u5e38\u4e2d\u6062\u590d\u51fa\u6765\u3002\u7531\u4e8e\u7528\u6237\u4ee3\u7801\u53ef\u80fd\u5728\u5404\u79cd\u5730\u65b9\u629b\u51fa\u5f02\u5e38\uff0c\u5f02\u5e38\u4e5f\u5206\u540c\u6b65\u548c\u5f02\u6b65\u4e24\u79cd\u60c5\u51b5\uff0c\u8fd9\u91cc\u6709\u8bb8\u591a\u9700\u8981\u8003\u8651\u7684\u95ee\u9898\u3002\u4e3a\u4e86\u7b80\u5316\uff0c\u6211\u4eec\u76ee\u524d\u53ea\u8003\u8651\u540c\u6b65\u7684 <code>brk 2</code> \u5bfc\u81f4\u7684 Brk \u5f02\u5e38\u3002\u4e3a\u4e86\u80fd\u6062\u590d\u4e4b\u540e\u80fd\u591f\u6b63\u5e38\u8fd0\u884c\uff0c\u6211\u4eec\u9700\u8981\u628a\u6240\u6709\u7684\u5bc4\u5b58\u5668\u90fd\u4fdd\u5b58\u4e0b\u6765\uff0c\u5373 <code>TrapFrame</code> \u3002\u4fdd\u5b58\u7684\u65f6\u5019\u9700\u8981\u8bb2\u7a76 AArch64 \u5e73\u53f0\u4e0b SP \u5bc4\u5b58\u5668\u7684\u5bf9\u9f50\u95ee\u9898\u3002\u6211\u4eec\u4e5f\u8981\u628a\u4e00\u4e9b\u7279\u6b8a\u7684\u5bc4\u5b58\u5668\u4fdd\u5b58\u4e0b\u6765\u3002\u8fd8\u6709\u4e00\u70b9\uff0c\u5c31\u662f\uff0c\u56e0\u4e3a <code>exception handler</code> \u4e2d\u8c03\u7528\u4e86 <code>context_save</code> \u51fd\u6570\uff0c\u6240\u4ee5\u6b64\u65f6\u7684 lr \u672c\u8eab\u4e5f\u9700\u8981\u8fdb\u884c\u4fdd\u5b58\uff0c\u8fd9\u4e2a\u5730\u65b9\u4e5f\u5361\u4e86\u6211\u5f88\u4e45\u3002\u6700\u540e\uff0c\u518d\u628a\u8fd9\u4e9b\u4e00\u4e2a\u4e00\u4e2a\u5730\u6062\u590d\u5230\u539f\u6765\u7684\u6837\u5b50\uff0c\u8c03\u6574 <code>ELR_EL1</code> \u4f7f\u5f97\u9000\u56de\u5230\u539f\u6765\u7684\u72b6\u6001\u65f6\uff0c\u4f1a\u8df3\u8fc7\u5f53\u524d\u7684 <code>brk 2</code> \u6307\u4ee4\uff0c\u8c03\u7528\u5b83\u7684\u4e0b\u4e00\u8c03\u6307\u4ee4\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u6210\u529f\u5730\u5728\u9047\u5230\u5f02\u5e38\u65f6\uff0c\u5f39\u51fa\u4e00\u4e2a <code>shell</code> \uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u56de\u9000\u56de\u6765\u3002</p> <p>\u5b66\u5230\u4e86\u5f88\u591a\u5f88\u591a\u3002\u4e4b\u540e\u5927\u4e09\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u505a\u81ea\u5df1\u7684 CPU\uff0c\u5728\u81ea\u5df1\u7684 CPU \u4e0a\u8dd1\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8dd1\u81ea\u5df1\u7684\u7f16\u8bd1\u5668\uff0c\u5728\u81ea\u5df1\u7684\u7f16\u8bd1\u5668\u4e2d\u7f16\u8bd1\u4e00\u4e2a\u6570\u636e\u5e93\u3002\u5e0c\u671b\u5230\u65f6\u6211\u8fd8\u6d3b\u7740\u5427\u3002#flag</p> <p>\u66f4\u65b0\uff1a\u4e0b\u4e00\u7bc7\u5728\u8fd9\u91cc\u3002</p>","tags":["rust","os","stanford","cs140e","rpi3","aarch64"]},{"location":"programming/2018/04/10/thoughts-on-stanford-cs140e-8/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e4b\u540e\uff0c\u6211\u5176\u5b9e\u8fd8\u662f\u5f88\u5fd9\uff0c\u4f46\u662f\u4e00\u76f4\u5fc3\u7406\u60e6\u8bb0\u7740\u8fd9\u4ef6\u4e8b\uff0c\u6bd5\u7adf\u53ea\u5269\u6700\u540e\u7684\u4e00\u70b9\u70b9\u5c31\u53ef\u4ee5\u505a\u5b8c\u4e86\uff0c\u4e0d\u505a\u5b8c\u603b\u662f\u89c9\u5f97\u5fc3\u75d2\u3002</p> <p>\u4eca\u5929\u505a\u7684\u90e8\u5206\u662f\u8c03\u5ea6\u3002\u6211\u4eec\u76ee\u524d\u53ea\u5728 EL0 \u8fd0\u884c\u4e86\u4e00\u4e2a shell\uff0c\u6bcf\u5f53\u89e6\u53d1 exception \u65f6\u56de\u5230 kernel \u8fdb\u884c\u5904\u7406\uff0c\u518d\u56de\u5230\u539f\u6765\u7684\u5730\u65b9\u3002\u4f46\u73b0\u5728\uff0c\u6211\u8981\u5b9e\u73b0\u4e00\u4e2a preemtive round-robin scheduler\uff0c\u5c31\u9700\u8981\u7ba1\u7406\u5f53\u524d\u7684\u6240\u6709\u8fdb\u7a0b\uff0c\u5e76\u4e14\u7ef4\u62a4\u5f53\u524d\u7684\u8fdb\u7a0b\u72b6\u6001\uff0c\u5f53\u65f6\u949f\u4e2d\u65ad\u5230\u6765\u7684\u65f6\u5019\uff0c\u51b3\u5b9a\u4e0b\u4e00\u4e2a time slice \u8981\u6267\u884c\u7684\u8fdb\u7a0b\uff0c\u518d\u5207\u6362\u8fc7\u53bb\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5f53\u7136\u4f1a\u9047\u5230\u4e0d\u5c11\u7684\u5751\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u4e00\u4e2a\u8fdb\u7a0b\u662f\u5426\u53ef\u4ee5\u6267\u884c\u4e86\u3002\u8003\u8651\u5230\u963b\u585e\u7684 IO\uff0c\u4f5c\u8005\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f18\u96c5\u7684\u65b9\u6cd5\uff1a\u5982\u679c\u8fd9\u4e2a\u8fdb\u7a0b\u963b\u585e\u5728 IO \u4e0a\uff0c\u90a3\u4e48\uff0c\u63d0\u4f9b\u4e00\u4e2a\u51fd\u6570\uff0c\u5728 scheduler \u4e2d\u8c03\u7528\uff0c\u5224\u65ad\u6240\u9700\u8981\u7684\u6570\u636e\u662f\u5426\u5230\u8fbe\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e00\u4e2a\u5faa\u73af\u628a\u4e0b\u4e00\u4e2a time slice \u8981\u6267\u884c\u7684\u7ebf\u7a0b\u627e\u5230\u3002\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5c31\u7b49\u5f85 interrupt \u518d\u5c1d\u8bd5\u3002</p> <p>\u56f0\u96be\u7684\u5730\u65b9\u5728\u4e8e\uff0c\u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5207\u6362\u5230\u4e00\u4e2a\u8d77\u59cb\u7ebf\u7a0b\u3002\u5e76\u4e14\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u65f6\u5019\uff0c\u5728 process 1 -&gt; kernel -&gt; process 2 \u8fd9\u4e24\u6b65\u8fc7\u7a0b\u4e2d\uff0c\u6709\u8bb8\u591a\u5bc4\u5b58\u5668\u90fd\u9700\u8981\u4ed4\u7ec6\u8003\u8651\u5982\u4f55\u5b9e\u73b0\u3002\u5e76\u4e14\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4e5f\u53d1\u73b0\u4e86\u4e4b\u524d\u5199\u7684\u4ee3\u7801\u4e2d\u7684\u95ee\u9898\uff0c\u6700\u7ec8\u4fee\u590d\u4e86\uff08\u76ee\u524d\u6765\u770b\u662f working \u4e86\uff09\u3002</p> <p>\u6211\u7684\u4ee3\u7801\u5b9e\u73b0\u5728 \u8fd9\u91cc \u3002\u4e0b\u4e00\u6b65\u5c31\u8981\u5199 syscall \u4e86\u3002\u5e0c\u671b\u80fd\u5728\u671f\u4e2d\u524d\u62bd\u65f6\u95f4\u8d76\u7d27\u628a\u8fd9\u4e2a\u505a\u5b8c\u3002</p> <p>18:54 PM Update: \u521a\u5b9e\u73b0\u5b8c\u4e86 sleep \u7684 syscall\u3002\u6bd4\u9884\u60f3\u4e2d\u8981\u7b80\u5355\u3002\u679c\u7136\u627e\u5230\u4e86\u81ea\u5df1\u5b9e\u73b0\u7684\u8c03\u5ea6\u5668\u7684 BUG\u3002\u6b64\u7cfb\u5217\u5927\u6982\u662f\u5b8c\u7ed3\u4e86\u3002</p> <p>2019-02-12 Update: \u4e0b\u4e00\u7bc7\u6587\u7ae0\u3002</p>","tags":["rust","os","stanford","cs140e","rpi3","aarch64"]},{"location":"programming/2019/02/12/thoughts-on-stanford-cs140e-9/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09","text":"<p>\u8ddd\u79bb\u4e0a\u4e00\u7bc7 CS140e \u7cfb\u5217\u6587\u7ae0\u5df2\u7ecf\u8fc7\u53bb\u4e86\u5f88\u4e45\uff0c\u8ddd\u79bb\u7b2c\u4e00\u7bc7\u6587\u7ae0\u8fc7\u4e86\u4e00\u5e74\u96f6\u51e0\u5929\u3002\u5728\u540e\u6765\u8fd9\u4e00\u6bb5\u65f6\u95f4\u5185\uff0cCS140e \u7ed3\u675f\u4e86\u8bfe\u7a0b\uff0c\u53c8\u5f00\u59cb\u4e86\u65b0\u4e00\u5e74\u7684 winter 2019 \u8bfe\u7a0b\uff0c\u8fce\u6765\u7684\u5374\u662f C \u7248\u672c\u7684 CS140e\uff0c\u4e0d\u7981\u8ba9\u4eba\u611f\u5230\u5931\u671b\u3002\u8fd8\u597d\uff0cSergio Benitez \u653e\u51fa\u4e86\u539f\u6765\u7684 CS140e \u7684\u955c\u50cf\uff0c\u5982\u679c\u5927\u5bb6\u4ecd\u7136\u60f3\u56de\u53bb\u67e5\u770b\u539f\u7248\u4f18\u8d28\u7684 CS140e\uff0c\u53ef\u4ee5\u70b9\u8fdb\u53bb\u53c2\u8003\u3002</p> <p>\u540e\u6765\u56e0\u4e3a\u673a\u7f18\u5de7\u5408\u53c2\u4e0e\u5230\u4e86\u6e05\u534e\u7684 Rust OS \u8bfe\u7a0b\uff0c\u53c8\u60f3\u5230\u56de\u6765\u628a\u539f\u6765\u7684 CS140e \u8fdb\u884c\u66f4\u65b0\uff0c\u4e8e\u662f\u987a\u5e26\u628a\u8dd1\u5728 QEMU \u4e0b\u7684\u4e00\u4e9b\u9700\u8981\u7684\u5de5\u4f5c\u7ed9\u505a\u4e86\uff0c\u53e6\u5916\u628a Rust nightly \u7248\u672c\u66f4\u65b0\u4e86\uff08\u4e00\u5e74\u524d\u7684 nightly \u8fd8\u80fd\u53eb nightly\uff1f\uff09\uff0c\u624d\u53d1\u73b0\u6807\u51c6\u5e93\u53d8\u5316\u8fd8\u662f\u86ee\u5927\u7684\uff0c\u7531\u4e8e nightly \u7248\u672c\u53d8\u4e86\uff0c\u800c\u4e14\u539f\u6765\u662f\u5185\u5d4c\u4e86\u4e00\u4e2a\u9609\u5272\u8fc7\u7684 std\uff0c\u6240\u4ee5\u4e3b\u8981\u662f\u4ece\u65b0\u7684 std \u91cc\u6284\u4ee3\u7801\u5230\u5185\u5d4c\u7684 std \u4e2d\u3002\u53e6\u5916\uff0c\u539f\u6765\u7684 xargo \u4e5f\u4e0d\u518d\u7ef4\u62a4\u4e86\uff0c\u8f6c\u800c\u4f7f\u7528 rust-xbuild \u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\u3002</p> <p>\u7136\u540e\u53c8\u987a\u624b\u5b9e\u73b0\u4e86 backtrace \u548c\u4ece backtrace \u4e2d\u914d\u5408 dward symbols \u627e\u51fd\u6570\u540d\u7684\u529f\u80fd\uff0c\u4e0d\u8fc7\u5b9e\u8df5\u8bc1\u660e\uff0c\u8fd9\u4e9b\u4e1c\u897f\u8fd8\u662f addr2line \u505a\u5f97\u66f4\u597d\uff0c\u6240\u4ee5\u4e5f\u5c31\u6ca1\u6709\u505a\u4e0b\u53bb\uff0c\u5728 relocation \u4e0a\u4e5f\u662f\u9047\u5230\u4e86\u5404\u79cd\u95ee\u9898\u3002\u8fd9\u4e2a\u7ecf\u9a8c\u4e5f\u662f\u5e94\u7528\u5230\u4e86 rCore \u90a3\u8fb9\u3002</p> <p>\u518d\u4e4b\u540e\u4e5f\u5c31\u662f\u5bd2\u5047\u5199\u9a71\u52a8\u4e86\uff0c\u89c1\u4e4b\u524d\u7684\u4e00\u4e2a\u535a\u6587\uff0c\u6211\u5c31\u6ca1\u6709\u5728 CS140e \u4e0a\u53bb\u5b9e\u73b0\u5b83\u4e86\u3002\u6709\u65f6\u95f4\u6709\u5174\u8da3\u7684\u65f6\u5019\u518d\u8003\u8651\u505a\u4e00\u4e0b Raspberry Pi \u7684\u7f51\u5361\u9a71\u52a8\u5427\u3002</p> <p>\u5199\u4e8e\u8fea\u62dc\u96e8\u5929\u3002</p>","tags":["rust","os","stanford","cs140e","kernel"]},{"location":"programming/2018/02/04/thoughts-on-stanford-cs140e/","title":"\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003","text":"<p>\u6700\u8fd1\uff0c\u53d7\u5404\u8def\u5b89\u5229\uff0c\u5241\u624b\u4e70\u4e0b\u4e86 \u8fd9\u4e2a\u6dd8\u5b9d\u5546\u5bb6\u7684\u6811\u8393\u6d3e\u7684\u5957\u9910 C \uff0c\u8fd8\u4e70\u4e86\u8bb8\u591a LED \u706f\u6ce1\u3001\u675c\u90a6\u7ebf\u548c\u7535\u963b\uff0c\u5f00\u59cb\u6309\u7167 CS 140e \u5b66\u4e60 Rust \u5e76\u4e14\u7528 Rust \u7f16\u8bd1\u5199\u4e00\u4e2a\u7b80\u6613\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002Assignment 0 \u7684\u76ee\u6807\u5c31\u662f\u7f16\u5199\u4e00\u4e2a\u5411 GPIO 16 \u8fde\u63a5\u7684 LED \u706f\u95ea\u70c1\u3002\u9996\u5148\u5f53\u7136\u5c31\u662f\u6109\u5feb\u5730\u6309\u7167\u6559\u7a0b\u4e0b\u8f7d bootloader\uff0c\u4e0b\u8f7d\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u987a\u5e26\u88c5\u4e00\u4e2a Raspbian \u5230\u673a\u5668\u4e0a\uff0c\u968f\u65f6\u53ef\u4ee5\u5f53\u6210\u4e00\u4e2a\u4f4e\u6027\u80fd\u7684 ARM/ARM64\uff08\u5b9e\u9645\u4e0a\uff0cRaspbian \u53ea\u7528\u4e86 armv7l\uff0c\u6ca1\u6709\u7528 64bit\uff09\u673a\u5668\u6765\u7528\uff0c\u4ee5\u540e\u5982\u679c\u914d\u4e0a @scateu \u56e2\u8d2d\u7684 Motorola Laptop Dock \u7684\u8bdd\u5c31\u662f\u4e00\u4e2a\u51e0\u767e\u5757\u7684\u7b14\u8bb0\u672c\u4e86\u3002\u628a\u8bfe\u7a0b\u4e0a\u7684\u6587\u4ef6\u4e22\u4e0a\u53bb\uff0c\u53ef\u4ee5\u770b\u5230\u7eff\u8272\u7684\u6d3b\u52a8\u6307\u793a\u706f\u95ea\u70c1\uff0c\u540e\u9762\u53c8\u628a CP2102 \u6a21\u5757\u8fde\u4e0a\u53bb\uff0c\u53c8\u80fd\u770b\u5230 Blink on, Blink off \u7684\u8f93\u51fa\u3002\u7136\u540e\u6309\u7167\u8981\u6c42\uff0c\u81ea\u5df1\u5148\u7801\u4e00\u6bb5 C \u8bed\u8a00\uff0c\u5b9e\u73b0 blinky:</p> <pre><code>#define GPIO_BASE (0x3F000000 + 0x200000)\n\nvolatile unsigned *GPIO_FSEL1 = (volatile unsigned *)(GPIO_BASE + 0x04);\nvolatile unsigned *GPIO_SET0  = (volatile unsigned *)(GPIO_BASE + 0x1C);\nvolatile unsigned *GPIO_CLR0  = (volatile unsigned *)(GPIO_BASE + 0x28);\n\nstatic void spin_sleep_us(unsigned int us) {\n  for (unsigned int i = 0; i &lt; us * 6; i++) {\n    asm volatile(\"nop\");\n  }\n}\n\nstatic void spin_sleep_ms(unsigned int ms) {\n  spin_sleep_us(ms * 1000);\n}\n\nint main(void) {\n  // STEP 1: Set GPIO Pin 16 as output.\n  *GPIO_FSEL1 = 0b001 &lt;&lt; 18;\n  // STEP 2: Continuously set and clear GPIO 16.\n  while (1) {\n    *GPIO_SET0 = 1 &lt;&lt; 16;\n    spin_sleep_ms(1000);\n    *GPIO_CLR0 = 1 &lt;&lt; 16;\n    spin_sleep_ms(1000);\n  }\n}\n</code></pre> <p>\u5176\u4e2d\u5927\u90e8\u5206\u4ee3\u7801\u90fd\u5df2\u7ecf\u7ed9\u51fa\u4e86\uff0c\u81ea\u5df1\u8981\u5b9e\u73b0\u4e5f\u53ea\u662f\u67e5\u8be2\u4e00\u4e0b BCM2837 SoC \u7684 GPIO \u6587\u6863\uff0c\u6309\u7167\u6587\u6863\u628a\u8be5\u505a\u7684\u5185\u5b58\u64cd\u4f5c\u548c\u4f4d\u8fd0\u7b97\u90fd\u5199\u4e00\u4e0b\u5373\u53ef\u3002\u6700\u540e\u53d1\u73b0\uff0c\u95ea\u70c1\u7684\u9891\u7387\u7279\u522b\u6162\uff0c\u51e0\u79d2\u949f\u624d\u95ea\u70c1\u4e00\u6b21\u3002\u6bd5\u7adf\u662f\u6309\u7167 CPU \u7684 clock speed \u8fdb\u884c\u7c97\u7565\u7684\u8ba1\u65f6\uff0c\u800c\u751f\u6210\u7684\u4ee3\u7801\u4e5f\u4e0d\u662f\u5f88\u9ad8\u6548\uff0c\u6ca1\u6709 inline\u3002\u63a5\u7740\u5219\u662f\u7528 Rust \u518d\u5b9e\u73b0\u4e00\u4e0b\u4e0a\u9762\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\uff1a</p> <pre><code>#![feature(compiler_builtins_lib, lang_items, asm, pointer_methods)]\n#![no_builtins]\n#![no_std]\n\nextern crate compiler_builtins;\n\npub mod lang_items;\n\nconst GPIO_BASE: usize = 0x3F000000 + 0x200000;\n\nconst GPIO_FSEL1: *mut u32 = (GPIO_BASE + 0x04) as *mut u32;\nconst GPIO_SET0: *mut u32 = (GPIO_BASE + 0x1C) as *mut u32;\nconst GPIO_CLR0: *mut u32 = (GPIO_BASE + 0x28) as *mut u32;\n\n#[inline(never)]\nfn spin_sleep_ms(ms: usize) {\n    for _ in 0..(ms * 600) {\n        unsafe { asm!(\"nop\" :::: \"volatile\"); }\n    }\n}\n\n#[no_mangle]\npub unsafe extern \"C\" fn kmain() {\n    // STEP 1: Set GPIO Pin 16 as output.\n    GPIO_FSEL1.write_volatile(1 &lt;&lt; 18);\n    // STEP 2: Continuously set and clear GPIO 16.\n    loop {\n        GPIO_SET0.write_volatile(1 &lt;&lt; 16);\n        spin_sleep_ms(1000);\n        GPIO_CLR0.write_volatile(1 &lt;&lt; 16);\n        spin_sleep_ms(1000);\n    }\n}\n</code></pre> <p>\u8fd9\u8fb9\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u5f88\u591a\u4e1c\u897f\u90fd\u5df2\u7ecf\u7ed9\u51fa\u4e86\uff0c\u53ea\u662f\u91cd\u65b0\u6539\u5199\u4e00\u4e0b\u800c\u5df2\u3002\u4e0d\u8fc7\uff0c\u8fd9\u8fb9\u7684\u5b9e\u6d4b\u7ed3\u679c\u5219\u662f\uff0c\u4e00\u79d2\u949f\u4f1a\u95ea\u70c1\u5f88\u591a\u4e0b\uff0c\u770b\u4e86\u4e0b\u6c47\u7f16\uff0c\u751f\u6210\u7684\u5faa\u73af\u6bd4\u8f83\u7d27\u51d1\uff0c\u6240\u4ee5\u4e5f\u6ca1\u6709\u8fbe\u5230\u60f3\u8981\u7684\u6548\u679c\uff0c\u4e0d\u8fc7\u540e\u9762\u5230\u6211\u5b9e\u73b0\u4e86 Timer \u7684\u8bfb\u53d6\u4e4b\u540e\uff0c\u5c31\u5f88\u7cbe\u51c6\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u75db\u82e6\u7684\u5b66\u4e60 Rust \u7684\u8fc7\u7a0b\uff0cAssignment 1 \u4e0a\u6765\u5c31\u662f\u89e3\u7b54\u5173\u4e8e Rust \u8bed\u8a00\u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u5728\u8fc7\u7a0b\u4e2d\u88ab Rust \u5341\u5206\u4e25\u683c\u7684 Lifetime \u548c Borrow checker \u5f04\u5f97\u60f3\u6b7b\uff0c\u597d\u6b79\u6700\u540e\u8fd8\u662f\u8ba9\u6d4b\u8bd5\u90fd\u901a\u8fc7\u4e86\u3002\u63a5\u4e0b\u6765\u5c31\u662f\u771f\u6b63\u5730\u63d0\u4f9b\u4e00\u4e9b\u5c01\u88c5\u786c\u4ef6\u63a5\u53e3\u7684 API\uff0c\u7136\u540e\u5229\u7528\u8fd9\u4e9b API \u53bb\u5b9e\u73b0\u66f4\u591a\u529f\u80fd\uff0c\u9996\u5148\u662f\u5229\u7528\u6808\u4e0a\u5206\u914d\u7684\u7a7a\u95f4\u6a21\u62df\u4e00\u4e2a\u53d8\u957f\u6570\u7ec4\u7684 API\uff1a<code>stack-vec</code> \uff0c\u7136\u540e\u662f\u628a\u5e95\u5c42\u7684\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\u7684\u5185\u5b58\u64cd\u4f5c\u5c01\u88c5\u6210\u7c7b\u578b\u5b89\u5168\u7684 <code>volatile</code> \uff0c\u7136\u540e\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u652f\u6301\u65ad\u70b9\u7eed\u4f20\u7684\u4f20\u6587\u4ef6\u7684\u534f\u8bae <code>xmodem</code> \uff0c\u53c8\u505a\u4e86\u4e00\u4e2a\u8f85\u52a9\u7535\u8111\u4e0a\u4f7f\u7528 TTY+XMODEM \u7684\u5c0f\u5de5\u5177 <code>ttywrite</code> \uff0c\u7136\u540e\u5c31\u5f00\u59cb\u64b8\u786c\u4ef6\u4e86\uff1a\u65f6\u949f <code>timer</code> \uff0c\u9488\u5bf9 GPIO pin \u7684\u7c7b\u578b\u5b89\u5168\u7684\u72b6\u6001\u673a <code>GPIO</code> \u3002\u76ee\u524d\u53ea\u5b9e\u73b0\u5230\u8fd9\u91cc\uff0c\u7136\u540e\u505a\u51fa\u4e86\u4e00\u4e2a\u51c6\u786e\u4e00\u79d2\u95ea\u70c1\u7684 blinky\uff08\u4ee4\u4eba\u60ca\u8bb6\u7684\u662f\uff0c\u56e0\u4e3a\u8fd9\u91cc\u7684 kernel \u76f4\u63a5\u4ece\u6587\u4ef6\u5934\u5f00\u59cb\u5c31\u662f\u4ee3\u7801\uff0c\u6700\u540e\u7684 binary \u5f02\u5e38\u5730\u5c0f\uff0c\u800c\u4e4b\u524d\u7684\u4ee3\u7801\u4ece\u6587\u4ef6\u7684\u504f\u79fb 0x8000 \u5f00\u59cb\u3002\u76ee\u524d\u770b\u6765\uff0c\u662f\u56e0\u4e3a\u4e4b\u524d\u7684\u4ee3\u7801\u662f\u6574\u4e2a\u6587\u4ef6\u52a0\u8f7d\u5230 0x0000 \u4e0a\uff0c\u800c\u4ee3\u7801\u9ed8\u8ba4\u4e86\u4ece  0x8000 \u5f00\u59cb\uff0c\u6240\u4ee5\u9664\u4e86\u6700\u5f00\u5934\u7684\u4e00\u4e2a\u8df3\u8f6c\u6307\u4ee4\uff0c\u4e2d\u95f4\u7559\u4e86\u8bb8\u591a\u7a7a\u4f59\u7684\u7a7a\u95f4\u3002\u800c\u8fd9\u91cc\u7684\u4ee3\u7801\u662f\u76f4\u63a5\u88ab bootloader \u52a0\u8f7d\u5230\u4e86 0x80000 \u5904\u5e76\u4e14\u8df3\u8f6c\u5230\u8fd9\u91cc\u6267\u884c\uff0c\u6240\u4ee5\u7701\u53bb\u4e86\u8bb8\u591a\u7a7a\u95f4\uff09\uff1a</p> <pre><code>fn blinky() {\n    let mut pin16 = Gpio::new(16);\n    let mut pin_out16 = pin16.into_output();\n\n    loop {\n        pin_out16.set();\n        spin_sleep_ms(1000);\n        pin_out16.clear();\n        spin_sleep_ms(1000);\n    }\n}\n\n#[no_mangle]\npub extern \"C\" fn kmain() {\n    // FIXME: Start the shell.\n    blinky();\n}\n</code></pre> <p>\u76ee\u524d\u53ea\u505a\u5230\u8fd9\u91cc\u3002\u540e\u9762\u8fd8\u6709\u5927\u628a\u7684\u5751\u8981\u8e29\uff0c\u96be\u5199\u7684 Rust \u8fd8\u5f97\u7ee7\u7eed\u5543\u4e0b\u53bb\u3002\u6211\u7684\u4ee3\u7801\u90fd\u4ee5 diff \u7684\u5f62\u5f0f\u653e\u5728\u4e86 jiegec/cs140e \uff0c\u5199\u5f97\u5e76\u4e0d\u7f8e\u89c2\u3002\u63a5\u4e0b\u6765\u5c31\u662f\u5b9e\u73b0 <code>UART</code> \u4e86\uff0c\u7ec8\u4e8e\u8981\u5b9e\u73b0\u4e32\u53e3\u901a\u4fe1\u4e86\u3002</p> <p>2018-01-06 \u66f4\u65b0\uff1a \u4e0b\u4e00\u7bc7\u6587\u7ae0\u5df2\u7ecf\u66f4\u65b0 \u3002</p>","tags":["rust","os","stanford","cs140e","kernel","gpio","hardware","rpi3","xmodem"]},{"location":"programming/2016/04/03/tips-on-git-shallow-clone/","title":"Tips on git shallow clone","text":"<p>Just learned a new tip on git shallow clone. As you know, some repository are really really large, such as emacs and linux. Cloning is slow and unstable. And there is no way to pause and resume a git clone. So I use shallow clone to clone them. But what if I want to clone other branches?</p> <p>From here: http://stackoverflow.com/a/27393574/2148614</p> <pre><code>git remote set-branches origin '*'\n</code></pre>","tags":["git","clone","tips"]},{"location":"programming/2018/01/07/two-patches-of-Emacs-I-am-using/","title":"\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch","text":"<p>\u6211\u5728\u672c\u5730\u5bf9 <code>emacs.rb</code> \u8fdb\u884c\u4e86\u4fee\u6539\uff1a</p> <pre><code>diff --git a/Formula/emacs.rb b/Formula/emacs.rb\nindex d0138cd..de3c5ff 100644\n--- a/Formula/emacs.rb\n+++ b/Formula/emacs.rb\n@@ -4,6 +4,14 @@ class Emacs &lt; Formula\n   url \"https://ftp.gnu.org/gnu/emacs/emacs-25.3.tar.xz\"\n   sha256 \"253ac5e7075e594549b83fd9ec116a9dc37294d415e2f21f8ee109829307c00b\"\n\n+  patch do\n+    url \"https://gist.githubusercontent.com/aatxe/260261daf70865fbf1749095de9172c5/raw/214b50c62450be1cbee9f11cecba846dd66c7d06/patch-multicolor-font.diff\"\n+  end\n+\n+  patch do\n+    url \"https://debbugs.gnu.org/cgi/bugreport.cgi?filename=0001-Fix-child-frame-placement-issues-bug-29953.patch;bug=29953;att=1;msg=8\"\n+  end\n+\n   bottle do\n     sha256 \"d5ce62eb55d64830264873a363a99f3de58c35c0bd1602cb7fd0bc37137b0c9d\" =&gt; :high_sierra\n     sha256 \"4d7ff7f96c9812a9f58cd45796aef789a1b5d26c58e3e68ecf520fab34af524d\" =&gt; :sierra\n</code></pre> <p>\u4e3b\u8981\u6d89\u53ca\u5230\u4e24\u4e2a Patch\uff1a</p> <ol> <li>\u542f\u7528\u5bf9 Multicolor font\uff0c\u6bd4\u5982 Emoji \u7684\u652f\u6301\u3002\u7531\u4e8e\u4e00\u4e9b ethic problems \u6682\u65f6\u5728 Emacs \u4e2d\u88ab\u7981\u7528\u4e86\uff0c\u6240\u4ee5\u81ea\u5df1\u542f\u7528\u56de\u6765\u3002</li> <li>\u6253\u4e0a\u6211\u524d\u51e0\u5929\u4e0a\u62a5\u7684 BUG #29953 \u7684\u4fee\u590d\u3002\u5df2\u7ecf\u5728\u4e0a\u6e38 Merge \u5230 <code>emacs-26</code> \u5206\u652f\u4e2d\uff0c\u8fd9\u4e2a\u4fee\u590d\u4f1a\u5728\u4e0b\u4e00\u4e2a\u7248\u672c\u4e2d\u3002</li> </ol> <p>\u6709\u4e86\u7b2c\u4e00\u4e2a\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u663e\u793a Emoji\uff08\u5bf9\u4e0d\u8d77\uff0cRMS\uff09\uff1b\u6709\u4e86\u7b2c\u4e8c\u4e2a\uff0c\u5c31\u89e3\u51b3\u4e86 <code>pyim</code> \u548c <code>lsp-ui-peek</code> \u7528 <code>child-frame</code> \u663e\u793a\u7684\u4e00\u4e9b\u95ee\u9898\u4e86\u3002</p> <p>\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u6211\u81ea\u5df1\u5728\u7528\u7684 <code>recoll.rb</code> \uff1a <pre><code># Documentation: https://docs.brew.sh/Formula-Cookbook.html\n#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula\n# PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!\n\nclass Recoll &lt; Formula\n  desc \"Recoll is a desktop full-text search tool.\"\n  homepage \"https://www.lesbonscomptes.com/recoll/\"\n  url \"https://www.lesbonscomptes.com/recoll/recoll-1.23.5.tar.gz\"\n  sha256 \"9b6b6941efc3e87c8325e95a69a5d0a37c022c3c45773c71dccd0fb3f364475f\"\n\n  depends_on \"xapian\"\n  depends_on \"qt\"\n  depends_on \"aspell\"\n\n  def install\n    inreplace \"Makefile.in\",\n      \"-Wl,--no-undefined -Wl,--warn-unresolved-symbols\", \"--no-undefined --warn-unresolved-symbols\"\n\n    system \"./configure\", \"--disable-dependency-tracking\",\n                          \"--disable-silent-rules\",\n                          \"--without-x\",\n                          \"--disable-x11mon\",\n                          \"--with-aspell\",\n                          \"--enable-recollq\",\n                          \"--disable-webkit\", # requires qtwebkit, which is not bundled with qt5\n                          \"--prefix=#{prefix}\"\n    system \"make\", \"install\"\n\n    mkdir libexec\n    mv bin/\"recoll.app\", libexec/\"recoll.app\"\n  end\n\n  test do\n    # `test do` will create, run in and delete a temporary directory.\n    #\n    # This test will fail and we won't accept that! For Homebrew/homebrew-core\n    # this will need to be a test that verifies the functionality of the\n    # software. Run the test with `brew test recoll`. Options passed\n    # to `brew install` such as `--HEAD` also need to be provided to `brew test`.\n    #\n    # The installed folder is not in the path, so use the entire path to any\n    # executables being tested: `system \"#{bin}/program\", \"do\", \"something\"`.\n    system \"false\"\n  end\nend\n</code></pre></p>","tags":["emacs","patch","multicolor font","emoji","frame","child frame"]},{"location":"programming/2023/07/22/uniform-int-distribution-performance/","title":"libc++ \u7684 uniform_int_distribution \u6027\u80fd\u95ee\u9898","text":"","tags":["cpp","stl","random","sampling"]},{"location":"programming/2023/07/22/uniform-int-distribution-performance/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u524d\u6bb5\u65f6\u95f4\uff0c@lwpie \u53d1\u73b0\u4e00\u6bb5 C++ \u4ee3\u7801\u5728 macOS \u4e0b\uff0c\u5206\u522b\u7528\u81ea\u5e26\u7684 Clang \u7f16\u8bd1\u548c\u7528 Homebrew \u7684 GCC \u7f16\u8bd1\uff0c\u6027\u80fd\u5dee\u8ddd\u63a5\u8fd1\u4e00\u4e2a\u6570\u91cf\u7ea7\uff0c\u4e0b\u9762\u662f\u8fd0\u884c\u65f6\u95f4\uff1a</p> <ul> <li>GCC-13 Homebrew: 300</li> <li>Apple Clang: 2170</li> </ul> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#include &lt;algorithm&gt;\n#include &lt;array&gt;\n#include &lt;chrono&gt;\n#include &lt;iostream&gt;\n#include &lt;memory&gt;\n#include &lt;random&gt;\n\nconstexpr size_t FILE_N = 1e8;\nconstexpr size_t DATA_R = (1 &lt;&lt; 23);\n\nint main() {\n  for (size_t i = 0; i &lt; 4; ++i) {\n    auto start = std::chrono::high_resolution_clock::now();\n    std::random_device rd;\n    std::mt19937_64 gen(rd());\n    std::uniform_int_distribution&lt;&gt; dis(0, DATA_R);\n    std::shared_ptr&lt;std::array&lt;size_t, FILE_N&gt;&gt; data(\n        new std::array&lt;size_t, FILE_N&gt;());\n    std::generate(data-&gt;begin(), data-&gt;end(),\n                  [&amp;dis, &amp;gen]() { return dis(gen); });\n    auto end = std::chrono::high_resolution_clock::now();\n    std::cout &lt;&lt; std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end -\n                                                                       start)\n                     .count()\n              &lt;&lt; std::endl;\n    auto mean = std::accumulate(data-&gt;begin(), data-&gt;end(), 0.0) / FILE_N;\n    std::cout &lt;&lt; mean &lt;&lt; std::endl;\n  }\n  return 0;\n}\n</code></pre> <p>\u9996\u5148\u4e0a\u7ed3\u8bba\uff1aGCC-13 Homebrew \u7528\u7684\u662f libstdc++\uff0c\u800c Apple Clang \u7528\u7684\u662f libc++\uff1blibstdc++ \u4f18\u5316\u4e86 uniform_int_distribution \u7684\u5b9e\u73b0\uff0c\u800c libc++ \u91c7\u7528\u7684\u662f\u6734\u7d20\u7684\u5b9e\u73b0\uff0c\u540c\u65f6\u53c2\u6570\u7684\u9009\u53d6\u6b63\u597d\u89e6\u53d1\u4e86\u6734\u7d20\u5b9e\u73b0\u7684\u6700\u574f\u60c5\u51b5\uff0c\u56e0\u6b64\u6027\u80fd\u5dee\u8ddd\u5de8\u5927\u3002</p>","tags":["cpp","stl","random","sampling"]},{"location":"programming/2023/07/22/uniform-int-distribution-performance/#\u63a2\u7a76","title":"\u63a2\u7a76","text":"<p>\u4ece\u73b0\u8c61\u4e0a\u6765\u770b\uff0c\u770b\u8d77\u6765\u662f GCC \u548c Clang \u7684\u6027\u80fd\u5dee\u5f02\u5f88\u5927\uff0c\u4f46\u7531\u4e8e\u8fd9\u91cc\u6d89\u53ca\u5230\u4e86 STL \u7684\u5b9e\u73b0\uff0c\u56e0\u6b64\u63a7\u5236\u53d8\u91cf\u5f88\u91cd\u8981\uff1a\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53d1\u73b0 Clang + libstdc++ \u6027\u80fd\u597d\uff0cGCC + libstdc++ \u6027\u80fd\u597d\uff0cClang + libc++ \u6027\u80fd\u5dee\u3002</p> <p>\u56e0\u6b64\u95ee\u9898\u5927\u6982\u53ef\u4ee5\u5b9a\u4f4d\u5728 libc++ \u4e0a\u3002\u90a3\u4e48\uff0c\u5c31\u53bb\u627e libc++ \u7684 uniform_int_distribution \u5b9e\u73b0\uff1a</p> <pre><code>// https://github.com/llvm/llvm-project/blob/9b2dfff57a382b757c358b43ee1df7591cb480ee/libcxx/include/__random/uniform_int_distribution.h#L233-L257\ntypename uniform_int_distribution&lt;_IntType&gt;::result_type\nuniform_int_distribution&lt;_IntType&gt;::operator()(_URNG&amp; __g, const param_type&amp; __p)\n_LIBCPP_DISABLE_UBSAN_UNSIGNED_INTEGER_CHECK\n{\n    static_assert(__libcpp_random_is_valid_urng&lt;_URNG&gt;::value, \"\");\n    typedef __conditional_t&lt;sizeof(result_type) &lt;= sizeof(uint32_t), uint32_t, __make_unsigned_t&lt;result_type&gt; &gt;\n        _UIntType;\n    const _UIntType __rp = _UIntType(__p.b()) - _UIntType(__p.a()) + _UIntType(1);\n    if (__rp == 1)\n        return __p.a();\n    const size_t __dt = numeric_limits&lt;_UIntType&gt;::digits;\n    typedef __independent_bits_engine&lt;_URNG, _UIntType&gt; _Eng;\n    if (__rp == 0)\n        return static_cast&lt;result_type&gt;(_Eng(__g, __dt)());\n    size_t __w = __dt - std::__countl_zero(__rp) - 1;\n    if ((__rp &amp; (numeric_limits&lt;_UIntType&gt;::max() &gt;&gt; (__dt - __w))) != 0)\n        ++__w;\n    _Eng __e(__g, __w);\n    _UIntType __u;\n    do\n    {\n        __u = __e();\n    } while (__u &gt;= __rp);\n    return static_cast&lt;result_type&gt;(__u + __p.a());\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684\u5b9e\u73b0\u601d\u8def\u662f\uff0c\u4e3a\u4e86\u751f\u6210 <code>[a, b]</code> \u4e4b\u95f4\u7684\u5747\u5300\u6574\u968f\u673a\u6570\uff0c\u5b83\u5148\u627e\u4e00\u4e2a\u6bd4 <code>b-a</code> \u5927\u7684\u4e8c\u7684\u5e42\uff0c\u7136\u540e\u751f\u6210\u968f\u673a\u6570\uff0c\u6a21\u8fd9\u4e2a\u4e8c\u7684\u5e42\uff0c\u63a5\u7740\u91c7\u7528\u62d2\u7edd\u91c7\u6837\uff1a\u5982\u679c\u91c7\u6837\u5f97\u5230\u7684\u503c\u5927\u4e8e <code>b-a</code>\uff0c\u90a3\u5c31\u91cd\u65b0\u91c7\u6837\u3002</p> <p>\u4f46\u662f\u524d\u9762\u6d4b\u8bd5\u7684\u4ee3\u7801\u4e2d\uff0c\u6b63\u597d\u533a\u95f4\u7684\u5927\u5c0f\u5c31\u662f\u4e8c\u7684\u5e42\uff0c\u90a3\u4e48\u5411\u4e0a\u53d6\u6574\u5230\u4e8c\u7684\u5e42\u6b21\u7684\u65f6\u5019\uff0c\u76f8\u5f53\u4e8e\u6bcf\u6b21\u91c7\u6837\u6709\u4e00\u534a\u7684\u6982\u7387\u9700\u8981\u91cd\u8bd5\u3002\u8fd9\u6837\u9700\u8981\u91cd\u65b0\u751f\u6210\u968f\u673a\u6570\u7684\u6b21\u6570\u5f88\u591a\uff0c\u800c\u4e14\u5206\u652f\u9884\u6d4b\u9519\u8bef\u7387\u4e5f\u5f88\u9ad8\u3002@Harry-Chen \u7528 perf \u6d4b\u8bd5\u5f97\u5230\u7684\u6570\u636e\uff1a</p> <ul> <li>branch-misses: 30% of all branches</li> <li>Top-down: 44.6% Bad Speculation</li> </ul> <p>\u8bf4\u660e\u5206\u652f\u9884\u6d4b\u786e\u5b9e\u6210\u4e3a\u4e86\u74f6\u9888\u3002\u90a3\u4e48 libstdc++ \u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u4e3a\u4ec0\u4e48\u5b83\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff1f\u7ecf\u8fc7\u641c\u7d22\uff0c\u53d1\u73b0\u4e86\u4e00\u7bc7\u535a\u5ba2\uff1aDoubling the speed of std::uniform_int_distribution in the GNU C++ library (libstdc++)\uff1a</p> <p>\u8bba\u6587 Fast Random Integer Generation in an Interval \u63d0\u51fa\u4e86\u65b0\u7684 uniform_int_distribution \u5b9e\u73b0\uff0c\u6bd4\u539f\u6765\u7684\u5b9e\u73b0\u5f97\u5230\u4e86\u4e24\u500d\u7684\u6027\u80fd\u63d0\u5347\uff0c\u5e76\u4e14\u5408\u5e76\u5230\u4e86 libstdc++ \u7684\u5b9e\u73b0\u5f53\u4e2d\u3002</p> <p>\u6240\u4ee5\u5230\u8fd9\u91cc\uff0c\u95ee\u9898\u5c31\u6bd4\u8f83\u6e05\u6670\u4e86\uff1alibstdc++ \u5b9e\u73b0\u4e86\u66f4\u597d\u7684\u7b97\u6cd5\uff0c\u540c\u65f6 libc++ \u7684\u7b97\u6cd5\u9047\u5230\u4e86\u6700\u574f\u60c5\u51b5\uff0c\u4e8c\u8005\u5408\u8d77\u6765\uff0c\u5c31\u89c2\u6d4b\u5230\u4e86\u5de8\u5927\u7684\u6027\u80fd\u5dee\u8ddd\u3002</p> <p>\u5982\u679c\u628a\u4ee3\u7801\u91cc <code>DATA_R</code> \u6539\u6210 <code>(1 &lt;&lt; 23)-1</code>\uff0c\u90a3\u4e48 libc++ \u7b97\u6cd5\u7684\u91c7\u6837\u5931\u8d25\u6982\u7387\u5c31\u4f1a\u964d\u5230\u6700\u5c0f\uff0c\u6b64\u65f6\u7684\u6027\u80fd\u60c5\u51b5\u662f\uff1a</p> <ul> <li>GCC-13 Homebrew: 253</li> <li>Apple Clang: 490</li> </ul> <p>\u53ef\u89c1\u8fd9\u91cc\u5c31\u662f\u5927\u6982\u4e24\u500d\u7684\u6027\u80fd\u5dee\u8ddd\uff0c\u8fd9\u4e2a\u5dee\u8ddd\u5c31\u6765\u6e90\u4e8e libstdc++ \u5b9e\u73b0\u7684\u66f4\u597d\u7684\u91c7\u6837\u7b97\u6cd5\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\uff0c\u7b49 libc++ \u4e5f\u5b9e\u73b0\u66f4\u597d\u7684\u7b97\u6cd5\uff0c\u6216\u8005\u5728\u9700\u8981\u7528 uniform_int_distribution \u7684\u65f6\u5019\uff0c\u907f\u514d\u94fe\u63a5 libc++\uff0c\u6216\u8005\u81ea\u5df1\u5b9e\u73b0\u66f4\u597d\u7684\u7b97\u6cd5\u3002</p>","tags":["cpp","stl","random","sampling"]},{"location":"programming/2016/02/24/unix-nice/","title":"Unix nice","text":"<p>I just saw this interesting tweet: <pre><code>Unix\u7cfb\u7edf\u7684\u6bcf\u4e2a\u8fdb\u7a0b\uff0c\u90fd\u6709\u4e00\u4e2anice\u503c\u3002\u8fd9\u4e2a\u503c\u8d8a\u5927\uff0c\u4f18\u5148\u7ea7\u8d8a\u4f4e\u3002\u7136\u540e\uff0c\u8fd8\u6709\u4e00\u4e2anice\u547d\u4ee4\uff0c\u6bcf\u8fd0\u884c\u4e00\u6b21\uff0c\u6307\u5b9a\u8fdb\u7a0b\u7684nice\u503c\uff0b10\u3002\u5b83\u7684\u610f\u601d\u5c31\u662f\u505a\u4eba\u8981nice\uff0c\u628a\u66f4\u591a\u7684CPU\u65f6\u95f4\u7559\u7ed9\u522b\u4eba\u3002nice\u503c\u8d8a\u9ad8\uff0c\u4f60\u7559\u7ed9\u81ea\u5df1\u7684\u4efd\u989d\u5c31\u8d8a\u5c11\u3002\n</code></pre></p> <p>From hereby @ruanyf.</p> <p>And i didn't known that until now. Cool! The name 'nice' is nice, too.</p> <p>Don't worry if you can't read Chinese. See also here and here. </p>","tags":["unix","nice","process","twitter"]},{"location":"programming/2018/07/04/upgrade-mongodb-to-4.0/","title":"\u5347\u7ea7 MongoDB \u5230 4.0","text":"<p>MongoDB 4.0 \u521a\u521a\u53d1\u5e03\uff0c\u52a0\u5165\u4e86\u6211\u5f88\u60f3\u8981\u7684 Transaction \u529f\u80fd\u3002\u4e0d\u8fc7\uff0c\u6211\u4e00\u66f4\u65b0\u5c31\u53d1\u73b0 MongoDB \u8d77\u4e0d\u6765\u4e86\u3002\u7814\u7a76\u4e86\u4e00\u4e0b\u65e5\u5fd7\uff0c\u53d1\u73b0\u7531\u4e8e\u6211\u521b\u5efa\u6570\u636e\u5e93\u65f6\uff0cMongoDB \u7248\u672c\u662f 3.4\uff0c\u867d\u7136\u540e\u6765\u5347\u7ea7\u5230\u4e86 3.6\uff0c\u4f46\u8fd8\u662f\u7528\u7740 3.4 \u7684\u517c\u5bb9\u6a21\u5f0f\u3002\u8fd9\u4e2a\u53ef\u4ee5\u8fd9\u6837\u6765\u68c0\u6d4b\uff1a</p> <pre><code>$ mongo\n&gt; db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )\n</code></pre> <p>\u5982\u679c\u4e0d\u662f 3.6\uff0c\u5347\u7ea7\u5230 4.0 \u4e4b\u524d\uff0c\u9700\u8981\u5148\u6267\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>$ # MongoDB version 3.6\n$ mongo\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: \"3.6\" } )\n</code></pre> <p>\u7136\u540e\u518d\u5347\u7ea7\u5230 MongoDB 4.0\uff0c\u624d\u80fd\u6b63\u5e38\u5730\u542f\u52a8 MongoDB 4.0\u3002\u4e4b\u540e\u53ef\u4ee5\u8003\u8651\u5c1d\u8bd5\u4f7f\u7528 MongoDB 4.0 \u7684 Transaction \u4e86\u3002\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u8fdb\u5165 Debian \u7684 stretch-backports \u6e90\u4e2d\u3002</p> <p>\u4e3a\u4e86\u4f7f\u7528 MongoDB 4.0 \u7684\u65b0\u7279\u6027\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>$ mongo\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: \"4.0\" } )\n</code></pre> <p>\u4e4b\u540e\u4f1a\u5c1d\u8bd5\u4e00\u4e0b MongoDB 4.0 \u7684 Transaction \u529f\u80fd\u3002</p>","tags":["mongodb","transaction"]},{"location":"programming/2016/02/28/using-chinese-pyim/","title":"Using chinese pyim","text":"<p>Recently i have been using tumashu's chinese-pyim. It's great to write Chinese right in Emacs. But as the personal dict is empty, this must be a hard time for me to build it. And i have found several bugs, too. After all, this project is great. I have donated some money to it.</p>","tags":["emacs","chinese","pyim","pinyin"]},{"location":"programming/2018/06/21/verilog-first-try/","title":"Verilog \u521d\u4f53\u9a8c","text":"<p>\u81ea\u5df1\u4ee5\u524d\u4e00\u76f4\u5bf9\u786c\u4ef6\u65b9\u9762\u6ca1\u6709\u63a5\u89e6\uff0c\u4f46\u662f\u5927\u4e8c\u5927\u4e09\u5f88\u5feb\u5c31\u8981\u63a5\u89e6\u76f8\u5173\u77e5\u8bc6\uff0c\u6240\u4ee5\u81ea\u5df1\u5c31\u5148\u9884\u4e60\u4e00\u4e0b Verilog HDL\uff0c\u4ee5\u4fbf\u4ee5\u540e\u9020\u8ba1\u7b97\u673a\u3002\u542c\u5b66\u957f\u4eec\u63a8\u8350\u4e86\u4e00\u672c\u4e66\u53eb\u300a\u81ea\u5df1\u52a8\u624b\u5199 CPU\u300b\uff0c\u7531\u4e8e\u81ea\u5df1\u624b\u4e2d\u53ea\u6709\u5f88\u8001\u7684 Spartan-3 \u677f\u5b50\uff0c\u624b\u4e0a\u6ca1\u6709\u53ef\u4ee5\u7528\u6765\u8bd5\u9a8c\u7684 FPGA\uff0c\u6240\u4ee5\u9009\u62e9\u7528 Verilog + Verilator \u8fdb\u884c\u6a21\u62df\u3002\u65e2\u7136\u662f\u6a21\u62df\uff0c\u81ea\u7136\u662f\u4f1a\u6709\u4e00\u5b9a\u7684\u95ee\u9898\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u4ee5\u540e\u518d\u8bf4\u3002</p> <p>\u7136\u540e\u5c31\u662f\u6a21\u4eff\u7740\u8fd9\u672c\u4e66\u7684\u4f8b\u5b50\uff0c\u5199\u4e86\u6307\u4ee4\u7684\u83b7\u53d6\u548c\u6307\u4ee4\u7684\u89e3\u7801\u4e24\u90e8\u5206\u5f88\u5c11\u5f88\u5c11\u7684\u4ee3\u7801\uff0c\u53ea\u80fd\u89e3\u7801 ori (or with immidiate) \u8fd9\u4e00\u4e2a\u6307\u4ee4\u3002\u7136\u540e\uff0c\u901a\u8fc7 verilator \u8dd1\u6a21\u62df\uff0c\u8f93\u51fa vcd \u6587\u4ef6\uff0c\u518d\u7528 gtkwave \u663e\u793a\u6ce2\u5f62\uff0c\u7ec8\u4e8e\u80fd\u591f\u770b\u5230\u6211\u60f3\u8981\u7684\u7ed3\u679c\u4e86\u3002\u80fd\u591f\u770b\u5230\uff0c\u524d\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u83b7\u53d6\u6307\u4ee4\uff0c\u4e0b\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u8fdb\u884c\u89e3\u7801\uff0c\u51fa\u73b0\u4e86\u6d41\u6c34\u7ebf\u7684\u7ed3\u679c\u3002\u8fd9\u8ba9\u6211\u5341\u5206\u5f00\u5fc3\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u5b9e\u73b0\u4e00\u4e9b\u57fa\u672c\u7684\u7b97\u672f\u6307\u4ee4\uff0c\u7136\u540e\u8bb2\u8ba1\u7b97\u7684\u7ed3\u679c\u5199\u5165\u5230\u76f8\u5e94\u7684\u5bc4\u5b58\u5668\u4e2d\u3002\u8fd9\u6837\u505a\u5b8c\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u505a\u4e00\u4e2a\u57fa\u4e8e verilator \u7684\u7b80\u6613 A+B \u7a0b\u5e8f\u4e86\u3002</p> <p>\u6211\u7684\u4ee3\u7801\u53d1\u5e03\u5728jiegec/learn_verilog\u4e2d\u3002\u6700\u8fd1\u9a6c\u4e0a\u5230\u8003\u8bd5\u5468\uff0c\u53ef\u80fd\u5230\u6691\u5047\u4f1a\u66f4\u9891\u7e41\u5730\u66f4\u65b0\u5427\u3002</p>","tags":["fpga","verilog","verilator","cpu"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/","title":"\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8","text":"","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7ed9 rCore \u6dfb\u52a0\u9a71\u52a8\u5c42\u7684\u652f\u6301\u3002\u4e00\u5f00\u59cb\u662f\u60f3\u505a\u7f51\u5361\u9a71\u52a8\uff0c\u540e\u6765\u53d1\u73b0\uff0c <code>qemu-system-riscv32</code> \u53ea\u652f\u6301\u5982\u4e0b\u7684\u9a71\u52a8\uff1a</p> <pre><code># qemu-system-riscv32 -device help\n\nStorage devices:\nname \"scsi-cd\", bus SCSI, desc \"virtual SCSI CD-ROM\"\nname \"scsi-disk\", bus SCSI, desc \"virtual SCSI disk or CD-ROM (legacy)\"\nname \"scsi-hd\", bus SCSI, desc \"virtual SCSI disk\"\nname \"virtio-blk-device\", bus virtio-bus\nname \"virtio-scsi-device\", bus virtio-bus\n\nNetwork devices:\nname \"virtio-net-device\", bus virtio-bus\n\nInput devices:\nname \"virtconsole\", bus virtio-serial-bus\nname \"virtio-keyboard-device\", bus virtio-bus\nname \"virtio-mouse-device\", bus virtio-bus\nname \"virtio-serial-device\", bus virtio-bus\nname \"virtio-tablet-device\", bus virtio-bus\nname \"virtserialport\", bus virtio-serial-bus\n\nDisplay devices:\nname \"virtio-gpu-device\", bus virtio-bus\n\nMisc devices:\nname \"loader\", desc \"Generic Loader\"\nname \"virtio-balloon-device\", bus virtio-bus\nname \"virtio-crypto-device\", bus virtio-bus\nname \"virtio-rng-device\", bus virtio-bus\n</code></pre> <p>\u6240\u4ee5\u8981\u5b9e\u73b0\u7f51\u5361\u7684\u8bdd\uff0c\u53ea\u80fd\u5b9e\u73b0\u8fd9\u91cc\u7684 <code>virtio-net-device</code> \uff0c\u800c VirtIO \u9a71\u52a8\u4e4b\u95f4\u6709\u5f88\u591a\u5171\u901a\u7684\u5730\u65b9\uff0c\u4e8e\u662f\u987a\u5e26\u628a <code>gpu</code> <code>mouse</code> \u548c <code>blk</code> \u5b9e\u73b0\u4e86\u3002</p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#\u7b2c\u4e00\u4e2a\u9a71\u52a8-virtio-net-\u7684\u5b9e\u73b0","title":"\u7b2c\u4e00\u4e2a\u9a71\u52a8 <code>virtio-net</code> \u7684\u5b9e\u73b0","text":"<p>\u9996\u5148\u60f3\u5230\u5e76\u4e14\u5b9e\u73b0\u4e86\u7684\u662f\u7f51\u5361\u9a71\u52a8\uff0c <code>virtio-net</code> \u3002\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u53ea\u5f00\u4e86\u4e00\u5757\u7f13\u51b2\u533a\uff0c\u6bcf\u6b21\u540c\u65f6\u53ea\u6536/\u53d1\u4e00\u4e2a\u5305\u3002\u9996\u5148\u62ff\u4e86 device_tree-rs \u8bfb\u53d6 bbl \u4f20\u8fc7\u6765\u7684 dtb \u5730\u5740\uff0c\u627e\u5230\u5404\u4e2a <code>virtio_mmio</code> \u603b\u7ebf\u4ee5\u540e\u6309\u7167\u8bbe\u5907\u7c7b\u578b\u627e\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\u3002\u7136\u540e\u5c31\u662f\u5bf9\u7740 virtio \u7684\u6807\u51c6\u6b7b\u78d5\uff0c\u540c\u65f6\u770b Linux \u548c QEMU \u7684\u6e90\u4ee3\u7801\u8f85\u52a9\u7406\u89e3\uff0c\u6700\u540e\u7ec8\u4e8e\u662f\u6210\u529f\u5730\u628a\u6536/\u53d1\u7684\u4e24\u4e2a virtqueue \u914d\u7f6e\u597d\uff0c\u5e76\u4e14\u5728\u4e2d\u65ad\u7684\u65f6\u5019\u5904\u7406\u6536\u5230\u7684\u5305\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ef\u4ee5\u6210\u529f\u5730\u8f93\u51fa\u6536\u5230\u7684\u5305\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u53d1\u51fa\u6307\u5b9a\u5185\u5bb9\u7684\u5305\u4e86\u3002\u6548\u679c\u5c31\u662f\u770b\u5230\u4e86\u8fd9\u6837\u7684\u56fe\u7247\uff08\u56fe\u4e2d\u7f51\u7ad9\u662f Hex Packet Decoder\uff09\uff1a</p> <p></p> <p>\u57fa\u4e8e\u6b64\uff0c\u5199\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u4ee5\u592a\u7f51\u5e27\u7684\u89e3\u6790\uff0cARP \u7684\u56de\u590d\u548c ping \u7684\u56de\u590d\uff08\u76f4\u63a5\u4fee\u6539 <code>ECHO_REQUEST</code> \u4e3a <code>ECHO_REPLY</code> \u7136\u540e\u66f4\u65b0 CHECKSUM\uff09\uff0c\u5b9e\u73b0\u4e86\u6700\u57fa\u672c\u7684 ping\uff1a</p> <p></p> <p></p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#\u663e\u5361\u9a71\u52a8","title":"\u663e\u5361\u9a71\u52a8","text":"<p>\u7f51\u5361\u53ef\u4ee5\u7528\u4e86\uff0c\u5f88\u81ea\u7136\u5730\u4f1a\u60f3\u5230\u505a\u4e00\u4e9b\u5176\u4ed6\u7684 virtio \u9a71\u52a8\uff0c\u7b2c\u4e00\u4e2a\u4e0b\u624b\u7684\u662f\u663e\u5361\u3002\u663e\u5361\u548c\u7f51\u5361\u7684\u4e3b\u8981\u533a\u522b\u662f\uff0c\u7f51\u5361\u662f\u4e24\u4e2a queue \u5f02\u6b65\u4f5c\uff0c\u800c\u5728\u663e\u5361\u9a71\u52a8\u4e0a\u5219\u662f\u5728\u4e00\u4e2a queue \u4e0a\u6bcf\u6b21\u653e\u4e00\u8f93\u5165\u4e00\u8f93\u51fa\u7684\u7f13\u51b2\u533a\u6765\u8fdb\u884c\u4ea4\u4e92\uff0c\u5177\u4f53\u6b65\u9aa4\u5728 virtio \u6807\u51c6\u4e2d\u4e5f\u5199\u5f97\u5f88\u6e05\u695a\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cQEMU \u7684 Tracing \u529f\u80fd\u5e2e\u4e86\u5f88\u5927\u7684\u5fd9\uff0c\u5728\u8c03\u8bd5 desc \u7684\u7ed3\u6784\u4e0a\u63d0\u4f9b\u4e86\u5f88\u591a\u5e2e\u52a9\u3002</p> <p>\u7136\u540e\u5c31\u5728 framebuffer \u4e0a\u753b\u4e86\u4e00\u4e2a mandelbrot\uff1a</p> <p></p> <p>\u5728 @shankerwangmiao \u7684\u5efa\u8bae\u4e0b\uff0c\u8c03\u4e86\u4e00\u4e0b\u989c\u8272\uff1a</p> <p></p> <p>\u8fd9\u6837\u5c31\u597d\u770b\u591a\u4e86\u3002</p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#http-\u670d\u52a1\u5668","title":"HTTP \u670d\u52a1\u5668","text":"<p>\u5728 @wangrunji0408 \u7684\u63d0\u9192\u548c\u5efa\u8bae\u4e0b\uff0c\u6211\u5f00\u59cb\u628a\u4e00\u4e2a Rust \u5b9e\u73b0\u7684\u7f51\u7edc\u6808 smoltcp \u96c6\u6210\u5230\u4ee3\u7801\u4e2d\u6765\u3002\u8fd9\u4e2a\u5e93\u4e2d\uff0c\u5bf9\u5e95\u5c42 Interface \u7684\u8981\u6c42\u5982\u4e0b\uff1a</p> <ol> <li>\u5f53\u53ef\u4ee5\u53d1\u5305\u5e76\u4e14\u53ef\u4ee5\u6536\u5305\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u4e00\u6536\u4e00\u53d1\u4e24\u4e2a Token\uff0c\u5e76\u5728\u4f7f\u7528\u7684\u65f6\u5019\u8c03\u7528\u6307\u5b9a\u7684\u51fd\u6570\u3002</li> <li>\u5f53\u53ef\u4ee5\u53d1\u5305\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u4e00\u4e2a\u53d1\u7684 Token\uff0c\u542b\u4e49\u540c\u4e0a\u3002</li> </ol> <p>\u8fd9\u662f\u6211\u7b2c\u4e00\u6b21\u770b\u5230\u8fd9\u79cd\u62bd\u8c61\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u7279\u522b\u660e\u786e\u7684\u6587\u6863\u8868\u793a\uff0c\u8fd9\u4e2a Token \u4ee3\u8868\u4ec0\u4e48\uff0c\u6211\u5e94\u8be5\u63d0\u4f9b\u4ec0\u4e48\u3002\u6211\u76f4\u63a5\u6309\u7167\u4e00\u4e9b\u5df2\u6709\u7684\u4f8b\u5b50\uff0c\u7167\u7740\u5b9e\u73b0\u4e86\u4e00\u628a\u3002\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86 ownership \u7684\u95ee\u9898\uff0c\u901a\u8fc7 Arc \u548c Mutex \u89e3\u51b3\u4e86\uff0c\u7136\u540e\u53c8\u51fa\u73b0\u4e86\u6b7b\u9501\u7684\u95ee\u9898\uff0c\u8c03\u4e86\u534a\u5929\u624d\u8c03\u51fa\u6765\u3002</p> <p>\u63a5\u7740\u6309\u7167 somltcp \u7684\u6837\u4f8b\u5199\u4e00\u4e2a\u7b80\u5355\u7684 udp echo server \u548c\uff08\u5047\u7684\uff09tcp \u670d\u52a1\u5668\uff1a</p> <pre><code>// simple http server\nlet mut socket = sockets.get::&lt;TcpSocket&gt;(tcp_handle);\nif !socket.is_open() {\n    socket.listen(80).unwrap();\n}\n\nif socket.can_send() {\n    write!(socket, \"HTTP/1.1 200 OK\\r\\nServer: rCore\\r\\nContent-Length: 13\\r\\nContent-Type: text/html\\r\\nConnection: Closed\\r\\n\\r\\nHello, world!\\r\\n\").unwrap();\n    socket.close();\n}\n</code></pre> <p>\u867d\u7136\u5f88\u7c97\u66b4\uff0c\u4f46\u662f work \u4e86\uff1a</p> <p></p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#\u9f20\u6807\u9a71\u52a8\u548c\u5757\u8bbe\u5907\u9a71\u52a8","title":"\u9f20\u6807\u9a71\u52a8\u548c\u5757\u8bbe\u5907\u9a71\u52a8","text":"<p>\u63a5\u7740\u81ea\u7136\u662f\u5f80 QEMU \u652f\u6301\u7684\u5269\u4e0b\u7684 virtio \u8bbe\u5907\u91cc\u4e0b\u624b\u3002\u9996\u5148\u4e0b\u624b\u7684\u662f\u9f20\u6807\u9a71\u52a8\u3002\u8fd9\u6b21\u9047\u5230\u4e86\u65b0\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u7531\u4e8e\u7f13\u51b2\u7684\u5b58\u5728\uff0c\u6bcf\u6b21\u53ea\u6709\u5728 EV_SYN \u7684\u65f6\u5019\u624d\u4f1a\u4e00\u6b21\u6027\u628a\u82e5\u5e72\u4e2a\u4e8b\u4ef6\u653e\u5165\u961f\u5217\u4e2d\u3002</li> <li>\u4e00\u4e2a\u4e8b\u4ef6\u5c31\u8981\u4e00\u4e2a desc chain\uff0c\u610f\u5473\u7740\u76f4\u63a5\u4e32\u8db3\u591f\u5927\u5c0f\u7684 buffer \u5230\u540c\u4e00\u4e2a desc chain \u4e2d\u5e76\u4e0d\u80fd\u5de5\u4f5c\u3002</li> </ol> <p>\u4e8e\u662f\u53ea\u597d\u75db\u5b9a\u601d\u75db\u7167\u7740 Linux \u5185\u6838\u7684\u5b9e\u73b0\u628a\u5b8c\u6574\u7684 Virtqueue \u7684\u64cd\u4f5c\u5b9e\u73b0\u4e86\uff0c\u5e76\u4e14\u987a\u5e26\u628a\u524d\u9762\u7684\u7f51\u5361\u548c\u663e\u5361\u7684\u9a71\u52a8\u4e5f\u66f4\u65b0\u4e86\u3002\u679c\u7136\uff0c\u6bcf\u6b21\u90fd\u662f\u4e09\u4e2a\u5de6\u53f3\u7684\u4e8b\u4ef6\uff08X\uff0cY\uff0cSYN\uff09\u63d2\u5165\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e9b\u4e8b\u4ef6\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5f53\u524d\u7684\u9f20\u6807\u4f4d\u7f6e\u4e86\u3002</p> <p>\u81f3\u4e8e\u5757\u8bbe\u5907\uff0c\u9047\u5230\u7684\u5219\u662f\u522b\u7684\u5751\u3002\u770b\u6807\u51c6\u7684\u65f6\u5019\uff0c\u672c\u4ee5\u4e3a\u5c31\u4e00\u4e2a\u7ed3\u6784\u4f53 virtio_blk_req \u5c31\u641e\u5b8c\u4e86\uff0c\u4f46\u4ed4\u7ec6\u8bfb\u4e86\u8bfb\uff0c\u6807\u51c6\u4f3c\u4e4e\u6ca1\u8bb2\u6e05\u695a\uff0c\u8bfb\u7684\u65f6\u5019\u662f\u600e\u4e48\u4f20\uff0c\u5199\u7684\u65f6\u5019\u53c8\u662f\u600e\u4e48\u4f20\u3002\u4e8e\u662f\u5728\u8fd9\u91cc\u5361\u4e86\u5f88\u4e45\uff0c\u4ece Tracing \u4fe1\u606f\u53ef\u4ee5\u770b\u51fa\uff0cQEMU \u4e00\u76f4\u8ba4\u4e3a\u6211\u63d0\u4f9b\u7684 buffer \u5927\u5c0f\u4e0d\u6b63\u786e\uff0c\u591a\u6b21\u5b9e\u9a8c\u4e4b\u540e\u53d1\u73b0\uff0c\u7ed9 device \u5199\u5165\u7684 buffer \u5927\u5c0f\u4e3a block size \u7684\u6574\u6570\u500d\u52a0\u4e00\uff0c\u8fd9\u4e2a\u4e00\u5b58\u653e\u7684\u662f\u72b6\u6001\uff0c\u5176\u4ed6\u5219\u662f\u6570\u636e\uff0c\u771f\u7684\u592a\u5751\u4e86\u3002</p> <p>\u6709\u4e86\u5757\u8bbe\u5907\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u66ff\u6362\u6389\u539f\u6765\u7684\u5185\u5d4c SFS \u7684\u65b9\u6848\uff0c\u8f6c\u4e3a\u76f4\u63a5\u4ece\u5757\u8bbe\u5907\u8bfb SFS \u6587\u4ef6\u3002\u8fd9\u91cc\u6211\u6ca1\u60f3\u660e\u767d lazy_static \u548c ownership \u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u6700\u540e\u4e5f\u5219\u662f@wangrunji0408 \u7684\u5e2e\u52a9\u6211\u89e3\u51b3\u4e86\u3002</p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u7528 Rust \u5199\u51fa\u4e00\u4e2a\u53ef\u4ee5\u5de5\u4f5c\u7684\u9a71\u52a8\u5e76\u4e0d\u96be\uff0c\u53ea\u8981\u77e5\u9053 unsafe \u600e\u4e48\u7528\uff0c\u4f46\u662f\u4e00\u65e6\u9700\u8981\u6df1\u5165\u601d\u8003\u8fd9\u91cc\u5e94\u8be5\u7528\u4ec0\u4e48\u5b89\u5168\u7684\u65b9\u6cd5\u5c01\u88c5\u7684\u65f6\u5019\uff0c\u624d\u53d1\u73b0\u662f\u4e2a\u5f88\u56f0\u96be\u7684\u4e8b\u60c5\u3002\u73b0\u5728\u867d\u7136\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u5f88\u591a\u5730\u65b9\u7ebf\u7a0b\u5e76\u4e0d\u5b89\u5168\uff0c\u4ee3\u7801\u4e5f\u4e0d\u591f\u7b80\u6d01\u9ad8\u6548\uff0c\u4ee5\u540e\u8fd8\u6709\u5f88\u591a\u9700\u8981\u6539\u8fdb\u7684\u5730\u65b9\u3002</p>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2019/01/29/virtio-drivers-implementation/#see-also","title":"See also","text":"<ol> <li>Virtio Spec</li> </ol>","tags":["driver","rcore","linux","virtio"]},{"location":"programming/2020/12/04/workaround-rust-on-m1/","title":"Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u4e0d\u4e45\u524d\uff0crust \u6dfb\u52a0\u4e86 Tier2 \u7684 aarch64-apple-darwin \u7684\u652f\u6301\uff0c\u8bd5\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u53ef\u4ee5\u8fd0\u884c\uff0c\u4e0d\u8fc7\u5f53\u6211\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u51fa\u73b0\uff1a</p> <pre><code>error: failed to run custom build command for `xxxx v1.0 (/path/to/xxxx)`\n\nCaused by:\n  process didn't exit successfully: `/path/to/xxx/target/debug/build/xxx-xxxx/build-script-build` (signal: 9, SIGKILL: kill)\n</code></pre> <p>\u770b\u4e86\u4e00\u4e0b Console.app \u91cc\u9762\u7684 crash \u65e5\u5fd7\uff0c\u53d1\u73b0\u662f codesigning \u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u7528 codesign \u547d\u4ee4\u6765\u7b7e\u540d\uff1a</p> <pre><code># for build.rs\ncodesign -s - target/debug/build/*/build-script-build\n# for dylib of some crates\ncodesign -s - target/debug/deps/*.dylib\n# for final executable\ncodesign -s - target/debug/xxx\n</code></pre> <p>\u591a\u6b21\u7f16\u8bd1\u5e76\u7b7e\u540d\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u6700\u540e\u7684\u4e8c\u8fdb\u5236\u4e86\uff1a</p> <pre><code>target/debug/xxxx: Mach-O 64-bit executable arm64\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u4e86\u3002\u7b49\u5f85\u4e0a\u6e38\u6dfb\u52a0 code signing \u652f\u6301\u5427\u3002</p> <p>2020-12-07 \u66f4\u65b0\uff1a\u627e\u4e86\u627e cargo \u7684 issues\uff0c\u627e\u5230\u4e86\u540c\u6837\u7684\u95ee\u9898\uff0c\u770b\u6765\u5e76\u4e0d\u662f code signing \u652f\u6301\u7684\u95ee\u9898\uff0c\u800c\u662f\u5728 Intel \u7684 Alacritty \u4e0b\u9762\uff0c\u8fd0\u884c Apple \u7684 rustc \u5de5\u5177\u94fe\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u51fa\u73b0\u7684 BUG\u3002\u6211\u4e5f\u81ea\u5df1\u8bd5\u4e86\u4e00\u4e0b\uff0c\u5728 Apple \u7684 Terminal \u4e0b\u8dd1\u7f16\u8bd1\u5c31\u6ca1\u6709\u95ee\u9898\u3002</p>","tags":["rust","rustc","codesign","m1","bigsur","macos","aarch64","darwin"]},{"location":"programming/2022/07/12/writing-code-cn/","title":"\u7f16\u7a0b\u4f5c\u4e1a\u4e2d\u7684\u5b66\u672f\u8bda\u4fe1","text":"<p>\u672c\u6587\u662f\u6211\u81ea\u5df1\u5bf9 Academic Integrity at MIT: Writing Code \u7684\u975e\u5b98\u65b9\u4e2d\u6587\u7ffb\u8bd1\u3002\u672c\u6587\u5df2\u7ecf\u5f97\u5230\u4e86\u5b98\u65b9\u7684\u90ae\u4ef6\u6388\u6743\u3002</p>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u7f16\u5199\u4ee3\u7801-writing-code","title":"\u7f16\u5199\u4ee3\u7801 Writing Code","text":"<p>\u4e0e\u5b66\u672f\u5199\u4f5c\u7c7b\u4f3c\uff0c\u5f53\u4f60\u5728\u505a\u8bfe\u7a0b\u9879\u76ee\u7684\u65f6\u5019\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u6216\u8005\u6539\u7f16\u4e86\u5176\u4ed6\u4eba\u5f00\u53d1\u7684\u4ee3\u7801\uff0c\u4f60\u5fc5\u987b\u8981\u5f15\u7528\u4ee3\u7801\u7684\u6765\u6e90\u3002\u4f60\u53ef\u4ee5\u5728\u4ee3\u7801\u6ce8\u91ca\u4e2d\u5f15\u7528\u4ee3\u7801\u6765\u6e90\u3002\u8fd9\u4e9b\u6ce8\u91ca\u4e0d\u4ec5\u4fdd\u62a4\u4e86\u4ed6\u4eba\u7684\u52b3\u52a8\u6210\u679c\uff0c\u4e5f\u4f1a\u5e2e\u52a9\u4f60\u7406\u89e3\u4ee3\u7801\u548c\u8c03\u8bd5\u3002</p> <pre><code>Writing code is similar to academic writing in that when you use or\nadapt code developed by someone else as part of your project, you must\ncite your source. However, instead of quoting or paraphrasing a source,\nyou include an inline comment in the code. These comments not only\nensure you are giving proper credit, but help with code understanding\nand debugging.\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u4ec0\u4e48\u65f6\u5019\u5e94\u8be5\u5728\u4ee3\u7801\u4e2d\u5f15\u7528\u6765\u6e90when-should-i-cite-a-source-in-my-code","title":"\u4ec0\u4e48\u65f6\u5019\u5e94\u8be5\u5728\u4ee3\u7801\u4e2d\u5f15\u7528\u6765\u6e90\uff1fWhen should I cite a source in my code?","text":"<ol> <li> <p>\u5f53\u4f60\u4ece\u5916\u90e8\u6765\u6e90\u590d\u5236\u4e86\u4ee3\u7801\u3002\u65e0\u8bba\u4f60\u662f\u590d\u5236\u4e86\u4ee3\u7801\u7247\u6bb5\uff0c\u8fd8\u662f\u4e00\u6574\u4e2a\u6a21\u5757\uff0c\u4f60\u90fd\u9700\u8981\u5f15\u7528\u6765\u6e90\u3002</p> <pre><code>When you copy code from an external source. Whether you are copying a\nsnippet of code or an entire module, you should credit the source.\n</code></pre> </li> <li> <p>\u5f53\u4f60\u590d\u5236\u4e86\u4ee3\u7801\u5e76\u505a\u4e86\u6539\u52a8\uff0c\u4f60\u4f9d\u7136\u8981\u5f15\u7528\u6765\u6e90\u3002\u4f60\u5e76\u4e0d\u662f\u4ee3\u7801\u7684\u539f\u4f5c\u8005\u3002</p> <pre><code>When you copy the code and adapt it, you should still credit the source.\nYou were not the original developer of the code.\n</code></pre> </li> </ol>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u6211\u5e94\u8be5\u5982\u4f55\u5f15\u7528\u4ee3\u7801how-should-i-cite-the-code","title":"\u6211\u5e94\u8be5\u5982\u4f55\u5f15\u7528\u4ee3\u7801\uff1fHow should I cite the code?","text":"<ol> <li> <p>\u901a\u5e38\u6765\u8bf4\uff0c\u4ee3\u7801\u7684\u7f51\u5740\u548c\u4e0b\u8f7d\u65f6\u95f4\u5c31\u8db3\u591f\u4e86\u3002\u5982\u679c\u53ef\u4ee5\u8ba9\u8bfb\u8005\u66f4\u52a0\u6e05\u6670\u5730\u4e86\u89e3\u5230\u4ee3\u7801\u6765\u6e90\uff0c\u53ef\u4ee5\u589e\u52a0\u66f4\u591a\u7684\u7ec6\u8282\u3002</p> <pre><code>Generally, the URL and the date of retrieval are sufficient. Add\nmore details if it will help the reader get a clearer\nunderstanding of the source.\n</code></pre> </li> <li> <p>\u5982\u679c\u4f60\u4fee\u6539\u4e86\u4ee3\u7801\uff0c\u4f60\u9700\u8981\u6ce8\u660e\uff1a\u201cAdapted from:\u201d\uff08\u4fee\u6539\u81ea\uff09\u6216\u8005\u201cBased on\u201d\uff08\u57fa\u4e8e\uff09\u3002\u8fd9\u6837\u8bfb\u8005\u5c31\u77e5\u9053\u4f60\u4fee\u6539\u4e86\u4ee3\u7801\u3002</p> <pre><code>If you adapted the code, you should indicate \u201cAdapted from:\u201d or\n\u201cBased on\u201d so it is understood that you modified the code.\n</code></pre> </li> <li> <p>\u4f60\u7684\u8001\u5e08\u53ef\u80fd\u4f1a\u5bf9\u4f60\u5982\u4f55\u5f15\u7528\u4ee3\u7801\u6709\u5177\u4f53\u7684\u8981\u6c42\u3002\u5982\u679c\u4f60\u4e0d\u80fd\u786e\u8ba4\u4ec0\u4e48\u662f\u53ef\u884c\u7684\uff0c\u8bf7\u8be2\u95ee\u4f60\u7684\u8001\u5e08\u3002</p> <pre><code>Your instructor may have specific instructions on how you should\nor should not cite your sources. If you are not clear on what is\nacceptable, ask your instructor.\n</code></pre> </li> </ol>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u5f00\u6e90\u8f6f\u4ef6\u7684\u4f7f\u7528-use-of-open-source-software","title":"\u5f00\u6e90\u8f6f\u4ef6\u7684\u4f7f\u7528 Use of Open Source Software","text":"<p>\u5f53\u4f60\u4f7f\u7528\u5f00\u6e90\u8f6f\u4ef6\u9879\u76ee\u7684\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f60\u4e0d\u4ec5\u8981\u6ce8\u660e\u4ee3\u7801\u7684\u6765\u6e90\uff0c\u8fd8\u9700\u8981\u9075\u5faa\u4ee3\u7801\u7684\u5f00\u6e90\u8f6f\u4ef6\u8bb8\u53ef\u8bc1\u3002\u8bf7\u8bb0\u4f4f\uff1a</p> <pre><code>When you use code from an open source project, you need both to\nattribute the source and follow the terms of any open source license\nthat applies to the code you are using. Keep in mind:\n</code></pre> <ol> <li> <p>\u5f53\u4f60\u4e0b\u8f7d\u6e90\u7801\u7684\u65f6\u5019\uff0c\u5b83\u7684\u5f00\u6e90\u8f6f\u4ef6\u8bb8\u53ef\u8bc1\u901a\u5e38\u4e5f\u5728\u6e90\u7801\u4e2d\u3002</p> <pre><code>When you download the source, the license is typically part of the\ndownload.\n</code></pre> </li> <li> <p>\u540c\u65f6\uff0c\u4ee3\u7801\u91cc\u4e5f\u901a\u5e38\u4f1a\u5305\u62ec\u5b83\u7684\u7248\u6743\u548c\u4f7f\u7528\u6761\u6b3e\u3002</p> <pre><code>Also, the source code itself will typically contain the\ncopyright and terms of use.\n</code></pre> </li> <li> <p>\u5f53\u4f60\u5f15\u5165\u4e86\u5f00\u6e90\u4ee3\u7801\uff0c\u5e76\u4e14\u5b83\u9644\u5e26\u4e86\u5f00\u6e90\u8f6f\u4ef6\u8bb8\u53ef\u8bc1\uff0c\u4f60\u5e94\u8be5\u628a\u5b83\u7684\u7248\u6743\u58f0\u660e\u590d\u5236\u5230\u4f60\u7684\u4ee3\u7801\u4e2d\uff0c\u548c/\u6216\u628a\u8bb8\u53ef\u8bc1\u590d\u5236\u5230\u4ee3\u7801\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002</p> <pre><code>When you incorporate open-source-licensed code into a program,\nit is good practice to duplicate the copyright in your code,\nand/or store the license in a file with the code.\n</code></pre> </li> <li> <p>\u5982\u679c\u5728\u4e0b\u8f7d\u7684\u6587\u4ef6\u91cc\u6ca1\u6709\u627e\u5230\u5f00\u6e90\u8f6f\u4ef6\u8bb8\u53ef\u8bc1\uff0c\u4f60\u53ef\u4ee5\u5728\u5f00\u6e90\u9879\u76ee\u7684\u7f51\u7ad9\u4e0a\u627e\u5230\u5168\u6587\uff0c\u5982 Apache HTTP Server \u7f51\u7ad9 \u6216\u8005 Open Source Initiative (OSI) \u7f51\u7ad9\u3002</p> <pre><code>If you don\u2019t obtain the license with the download, you should be\nable to find it on the site of the open source project, such as\nApache HTTP Server site, or on the Open Source Initiative (OSI)\nsite.\n</code></pre> </li> </ol>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u8001\u5e08\u51b3\u5b9a\u5177\u4f53\u7684\u4ee3\u7801\u590d\u7528\u7a0b\u5ea6-instructors-determine-the-specific-expectations-around-re-use-of-code-in-each-class","title":"\u8001\u5e08\u51b3\u5b9a\u5177\u4f53\u7684\u4ee3\u7801\u590d\u7528\u7a0b\u5ea6 Instructors determine the specific expectations around re-use of code in each class.","text":"<p>\u901a\u5e38\uff0c\u8001\u5e08\u4f1a\u786e\u5b9a\u8bfe\u7a0b\u7684\u534f\u4f5c\u89c4\u5219\u3002\u5982\u679c\u8fd9\u4e2a\u89c4\u5219\u6ca1\u6709\u660e\u786e\u5730\u7ed9\u51fa\u6765\uff0c\u6216\u8005\u4f60\u4e0d\u786e\u8ba4\u4ec0\u4e48\u662f\u53ef\u884c\u7684\uff0c\u8bf7\u8be2\u95ee\u4f60\u7684\u8001\u5e08\u3002</p> <pre><code>Often, the requirements are described in the collaboration policy for\nthe class. If policy is not clearly described in the course materials\nand you are not sure what is acceptable, ask your instructor.\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u4f8b\u5b50","title":"\u4f8b\u5b50","text":"<p>\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u4f8b\u5b50\uff0c\u662f\u8bfe\u7a0b\uff08Spring 2012 6.005 Elements of Software Construction\uff09\u7684\u534f\u4f5c\u89c4\u5219\uff1a</p> <pre><code>Collaboration policy from Spring 2012 6.005 Elements of Software\nConstruction: (used with the permission of Professor Rob Miller, Dept of\nElectrical Engineering &amp; Computer Science)\n</code></pre> <p>\u6211\u4eec\u9f13\u52b1\u540c\u5b66\u4eec\u4e92\u76f8\u5e2e\u52a9\uff0c\u4f46\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6bcf\u4e2a\u4eba\u90fd\u6709\u826f\u597d\u7684\u72ec\u7acb\u5b66\u4e60\u4f53\u9a8c\uff0c\u6211\u4eec\u5bf9\u4f60\u4eec\u505a\u4e86\u5982\u4e0b\u7684\u9650\u5236\uff1a</p> <pre><code>We encourage you to help each other with work in this class, but there\nare limits to what you can do, to ensure that everybody has a good\nindividual learning experience.\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u5355\u4eba\u4f5c\u4e1a-individual-work","title":"\u5355\u4eba\u4f5c\u4e1a Individual work","text":"<p>\u8bfe\u7a0b\u91cc\u7684\u4e60\u9898\u90fd\u8981\u5355\u4eba\u5b8c\u6210\u3002\u6211\u4eec\u9f13\u52b1\u540c\u5b66\u4eec\u8ba8\u8bba\u5b9e\u73b0\u65b9\u6cd5\uff0c\u4f46\u662f\u4f60\u7684\u4ee3\u7801\u548c\u62a5\u544a\u90fd\u9700\u8981\u81ea\u5df1\u5b8c\u6210\u3002</p> <pre><code>Problem sets in this class are intended to be primarily individual\nefforts. You are encouraged to discuss approaches with other students\nbut your code and your write-up must be your own.\n</code></pre> <p>\u4f60\u4e0d\u80fd\u4f7f\u7528\u5176\u4ed6\u540c\u5b66\u7f16\u5199\u7684\u8d44\u6599\uff0c\u65e0\u8bba\u662f\u8fd9\u4e2a\u5b66\u671f\u8fd8\u662f\u4ee5\u5f80\u5b66\u671f\u7684\u540c\u5b66\u3002\u4f60\u4e5f\u4e0d\u53ef\u4ee5\u628a\u4f60\u7684\u6210\u679c\u63d0\u4f9b\u7ed9\u5176\u4ed6\u540c\u5b66\u3002</p> <pre><code>You may not use materials produced as course work by other students,\nwhether in this term or previous terms, nor may you provide work for\nother students to use.\n</code></pre> <p>\u5e2e\u52a9\u5176\u4ed6\u540c\u5b66\u662f\u5e94\u8be5\u7684\u3002\u4f46\u8981\u4fdd\u8bc1\u4e00\u4e2a\u539f\u5219\uff0c\u5f53\u4f60\u5728\u5e2e\u52a9\u5176\u4ed6\u540c\u5b66\u7684\u65f6\u5019\uff0c\u4f60\u81ea\u5df1\u7684\u7b54\u6848\u6216\u4ee3\u7801\u4e0d\u5e94\u8be5\u53ef\u4ee5\u770b\u5230\uff0c\u65e0\u8bba\u662f\u81ea\u5df1\u8fd8\u662f\u5176\u4ed6\u540c\u5b66\u3002\u53ef\u4ee5\u517b\u6210\u4e00\u4e2a\u4e60\u60ef\uff0c\u5e2e\u52a9\u4ed6\u4eba\u7684\u65f6\u5019\u628a\u7b14\u8bb0\u672c\u7535\u8111\u5408\u4e0a\u3002</p> <pre><code>It\u2019s good to help other students. But as a general rule, during the time\nthat you are helping another student, your own solution should not be\nvisible, either to you or to them. Make a habit of closing your laptop\nwhile you\u2019re helping.\n</code></pre> <p>\u5728\u5e2e\u52a9\u5176\u4ed6\u540c\u5b66\uff0c\u9605\u8bfb\u540c\u5b66\u7684\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u770b\u5230\u540c\u5b66\u7684\u89e3\u7b54\u3002\u4f60\u53ef\u4ee5\u4ece\u540c\u5b66\u7684\u65b9\u6cd5\u91cc\u83b7\u5f97\u7075\u611f\uff0c\u4f46\u662f\u4e0d\u80fd\u590d\u5236\u4ed6\u4eec\u7684\u6210\u679c\u3002</p> <pre><code>During code review, you will see classmates\u2019 solutions to a problem set.\nWhile it is fine to take inspiration from their approach, do not copy\ntheir work.\n</code></pre> <p>\u4f60\u53ef\u4ee5\u7528\u5916\u90e8\u7f51\u7ad9\u4e0a\u7684\u8d44\u6599\uff0c\u6bd4\u5982 StackOverflow\uff0c\u4f46\u524d\u63d0\u662f\u52a0\u4e0a\u5f15\u7528\uff0c\u5e76\u4e14\u4f5c\u4e1a\u8981\u6c42\u91cc\u5141\u8bb8\u8fd9\u4e48\u505a\u3002\u7279\u522b\u5730\uff0c\u5982\u679c\u4f5c\u4e1a\u8981\u6c42\u91cc\u5199\u4e86\u201c\u5b9e\u73b0 X \u529f\u80fd\u201d\uff0c\u90a3\u4e48\u4f60\u5fc5\u987b\u81ea\u5df1\u5b9e\u73b0 X \u529f\u80fd\uff0c\u800c\u4e0d\u80fd\u590d\u7528\u5916\u90e8\u7684\u4ee3\u7801\u3002</p> <pre><code>It\u2019s fine to use material from external sources like StackOverflow, but\nonly with proper attribution, and only if the assignment allows it. In\nparticular, if the assignment says \u201cimplement X,\u201d then you must create\nyour own X, not reuse one from an external source.\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u7528\u8bfe\u7a0b\u7ec4\u63d0\u4f9b\u7684\u4ee3\u7801\uff0c\u4e0d\u9700\u8981\u5f15\u7528\u3002\u8001\u5e08\u63d0\u4f9b\u7684\u4ee3\u7801\u5728\u672a\u7ecf\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u80fd\u516c\u5f00\u5206\u4eab\uff0c\u6211\u4eec\u540e\u9762\u4f1a\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002</p> <pre><code>It\u2019s also fine to use any code provided by this semester\u2019s 6.031 staff\n(in class, readings, or problem sets), without need for attribution.\nStaff-provided code may not be publicly shared without permission,\nhowever, as discussed later in this document.\n</code></pre> <p>\u4f8b\u5b50\u4e00 Example 1\uff1a</p> <ul> <li> <p>A \u548c B \u505a\u4f5c\u4e1a\u7684\u65f6\u5019\u5750\u5728\u4e00\u8d77\u3002\u4ed6\u4eec\u7b80\u7565\u5730\u8ba8\u8bba\u5b9e\u73b0\u7684\u4e0d\u540c\u65b9\u6cd5\u3002\u4ed6\u4eec\u5728\u767d\u677f\u4e0a\u753b\u6d41\u7a0b\u56fe\u3002\u5f53 A \u53d1\u73b0 Java \u6807\u51c6\u5e93\u4e2d\u4e00\u4e2a\u6709\u7528\u7684\u7c7b\uff0c\u5979\u628a\u8fd9\u4e2a\u53d1\u73b0\u544a\u8bc9\u4e86 B\u3002\u5f53 B \u53d1\u73b0\u4e86 StackOverflow \u4e0a\u7684\u4e00\u4e2a\u56de\u7b54\uff0c\u4ed6\u7ed9 A \u53d1\u9001\u4e86 URL\u3002\u53ef\u4ee5\u3002</p> <pre><code>Alyssa and Ben sit next to each other with their laptops while\nworking on a problem set. They talk in general terms about\ndifferent approaches to doing the problem set. They draw\ndiagrams on the whiteboard. When Alyssa discovers a useful class\nin the Java library, she mentions it to Ben. When Ben finds a\nStackOverflow answer that helps, he sends the URL to Alyssa. OK.\n</code></pre> </li> <li> <p>\u5728\u4ed6\u4eec\u7f16\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4ed6\u4eec\u628a\u4ee3\u7801\u5927\u58f0\u5ff5\u51fa\u6765\uff0c\u597d\u8ba9\u53cc\u65b9\u90fd\u53ef\u4ee5\u7f16\u5199\u6b63\u786e\u7684\u4ee3\u7801\u3002\u9519\u8bef\uff01</p> <pre><code>As they type lines of code, they speak the code aloud to the\nother person, to make sure both people have the right code.\nINAPPROPRIATE.\n</code></pre> </li> <li> <p>\u5728\u4f5c\u4e1a\u6700\u56f0\u96be\u7684\u90e8\u5206\uff0cA \u548c B \u4e92\u76f8\u770b\u7535\u8111\u5c4f\u5e55\uff0c\u5e76\u5bf9\u6bd4\u4ee3\u7801\uff0c\u786e\u8ba4\u4ed6\u4eec\u4ee3\u7801\u5b9e\u73b0\u90fd\u662f\u6b63\u786e\u7684\u3002\u9519\u8bef\uff01</p> <pre><code>In a tricky part of the problem set, Alyssa and Ben look at each\nother\u2019s screens and compare them so that they can get their code\nright. INAPPROPRIATE.\n</code></pre> </li> </ul> <p>\u4f8b\u5b50\u4e8c Example 2\uff1a</p> <ul> <li> <p>J \u5df2\u7ecf\u5b8c\u6210\u4e86\u4f5c\u4e1a\uff0c\u4f46\u662f\u4ed6\u7684\u670b\u53cb B \u6b63\u5728\u52aa\u529b\u89e3\u51b3\u4e00\u4e2a bug\u3002J \u5750\u5728 B \u65c1\u8fb9\uff0c\u770b\u4ed6\u7684\u4ee3\u7801\uff0c\u5e2e\u4ed6\u8c03\u8bd5\u51fa\u4e86\u95ee\u9898\u3002\u53ef\u4ee5\u3002</p> <pre><code>Jerry already finished the problem set, but his friend Ben is\nnow struggling with a nasty bug. Jerry sits next to Ben, looks\nat his code, and helps him debug. OK.\n</code></pre> </li> <li> <p>J \u6253\u5f00\u4e86\u81ea\u5df1\u7684\u7b14\u8bb0\u672c\uff0c\u627e\u5230\u81ea\u5df1\u7684\u7b54\u6848\uff0c\u7136\u540e\u6307\u7740\u81ea\u5df1\u7684\u4ee3\u7801\u7ed9 B \u7ea0\u6b63\u9519\u8bef\u3002\u9519\u8bef\uff01</p> <pre><code>Jerry opens his own laptop, finds his solution to the problem\nset, and refers to it while he\u2019s helping Ben correct his code.\nINAPPROPRIATE.\n</code></pre> </li> </ul> <p>\u4f8b\u5b50\u4e09 Example 3\uff1a</p> <ul> <li> <p>L \u8fd9\u5468\u6709\u5f88\u591a\u4f5c\u4e1a\uff0c\u4f46\u662f\u56e0\u4e3a\u65f6\u95f4\u548c\u8eab\u4f53\u539f\u56e0\u6765\u4e0d\u53ca\u505a\u3002\u4ed6\u5df2\u7ecf\u9519\u8fc7\u622a\u6b62\u65f6\u95f4\u4e24\u5929\u4e86\uff0c\u4f46\u57fa\u672c\u6ca1\u6709\u4ec0\u4e48\u8fdb\u5ea6\u3002B \u89c9\u5f97 L \u53ef\u601c\uff0c\u60f3\u8981\u5e2e\u52a9 L\u3002\u5728 L \u5199\u4f5c\u4e1a\u7684\u65f6\u5019\uff0cB \u544a\u8bc9 L \u4ed6\u662f\u600e\u4e48\u505a\u4f5c\u4e1a\u7684\u3002B \u5df2\u7ecf\u63d0\u4ea4\u4e86\u81ea\u5df1\u7684\u7b54\u6848\uff0c\u5e76\u4e14\u5728\u5e2e\u52a9 L \u7684\u65f6\u5019\uff0c\u4e0d\u6253\u5f00\u81ea\u5df1\u7684\u7b14\u8bb0\u672c\u7535\u8111\u3002\u53ef\u4ee5\u3002</p> <pre><code>Louis had three problem sets and two quizzes this week, was away\nfrom campus for several days for a track meet, and then got\nsick. He\u2019s already taken two slack days on the deadline and has\nmade almost no progress on the problem set. Ben feels sorry for\nLouis and wants to help, so he sits down with Louis and talks\nwith him about how to do the problem set while Louis is working\non it. Ben already handed in his own solution, but he doesn\u2019t\nopen his own laptop to look at it while he\u2019s helping Louis. OK.\n</code></pre> </li> <li> <p>B \u6253\u5f00\u4e86\u81ea\u5df1\u7684\u7b14\u8bb0\u672c\u7535\u8111\uff0c\u5e76\u4e14\u5728\u5e2e\u52a9 L \u7684\u65f6\u5019\u9605\u8bfb\u81ea\u5df1\u7684\u4ee3\u7801\u3002\u9519\u8bef\uff01</p> <pre><code>Ben opens his laptop and reads his own code while he\u2019s helping\nLouis. INAPPROPRIATE.\n</code></pre> </li> <li> <p>B \u82b1\u4e86\u51e0\u4e2a\u5c0f\u65f6\u5e2e\u52a9 L\uff0c\u4f46\u662f L \u8fd8\u662f\u6ca1\u6709\u5b8c\u6210\u3002\u4f46\u662f B \u9700\u8981\u53bb\u505a\u81ea\u5df1\u7684\u4e8b\u60c5\u4e86\u3002\u5728 L \u627f\u8bfa\u53ea\u6709\u5728\u5fc5\u8981\u7684\u65f6\u5019\u624d\u4f1a\u770b B \u7684\u4ee3\u7801\u4e4b\u540e\uff0cB \u628a\u81ea\u5df1\u7684\u4ee3\u7801\u4e0a\u4f20\u5230 Dropbox \u5e76\u4e14\u5206\u4eab\u7ed9\u4e86 L\u3002\u9519\u8bef\uff01</p> <pre><code>Ben has by now spent a couple hours with Louis, and Louis still\nneeds help, but Ben really needs to get back to his own work. He\nputs his code in a Dropbox and shares it with Louis, after Louis\npromises only to look at it when he really has to.\nINAPPROPRIATE.\n</code></pre> </li> </ul> <p>\u4f8b\u5b50\u56db Example 4\uff1a</p> <ul> <li>J \u548c E \u72ec\u7acb\u5b8c\u6210\u4f5c\u4e1a\u3002\u4ed6\u4eec\u4ea4\u6362\u4e86\u81ea\u5df1\u7684\u6d4b\u4f8b\u6765\u68c0\u67e5\u4f5c\u4e1a\u3002\u9519\u8bef\uff01\u6d4b\u4f8b\u662f\u9898\u76ee\u7684\u4e00\u90e8\u5206\uff0c\u4e5f\u662f\u5b66\u4e60\u4f53\u9a8c\u7684\u4e00\u90e8\u5206\u3002\u5982\u679c\u4f60\u4f7f\u7528\u4e86\u5176\u4ed6\u4eba\u7684\u6d4b\u4f8b\uff0c\u5c31\u662f\u5728\u6284\u88ad\uff0c\u5373\u4f7f\u53ea\u662f\u4e34\u65f6\u7684\u3002<pre><code>John and Ellen both worked on their problem sets separately.\nThey exchange their test cases with each other to check their\nwork. INAPPROPRIATE. Test cases are part of the material for the\nproblem set, and part of the learning experience of the course.\nYou are copying if you use somebody else\u2019s test cases, even if\ntemporarily.\n</code></pre> </li> </ul> <p>\u6ce8\u610f\uff0c\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u53cc\u65b9\u90fd\u8d1f\u6709\u5b66\u672f\u4e0d\u7aef\u7684\u8d23\u4efb\u3002\u6284\u88ad\u4f5c\u4e1a\uff0c\u6216\u8005\u628a\u81ea\u5df1\u7684\u4f5c\u4e1a\u63d0\u4f9b\u7ed9\u4ed6\u4eba\uff0c\u662f\u4e00\u4e2a\u5f88\u4e25\u91cd\u7684\u4e8b\u60c5\uff0c\u53ef\u80fd\u5bfc\u81f4\u5206\u6570\u6263\u51cf\uff0c\u8bfe\u7a0b\u4e0d\u53ca\u683c\u751a\u81f3\u5904\u5206\u3002\u6284\u88ad\u4f5c\u4e1a\uff0c\u6216\u8005\u5e2e\u52a9\u4ed6\u4eba\u6284\u88ad\uff0c\u53ef\u80fd\u4f1a\u7ed9\u4f60\u7684\u6210\u7ee9\u5355\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u4e0d\u80fd\u6d88\u9664\u7684 F\u3002</p> <pre><code>Note that in the examples marked inappropriate above, both people are\nheld responsible for the violation in academic honesty. Copying work, or\nknowingly making work available for copying, in contravention of this\npolicy is a serious offense that may incur reduced grades, failing the\ncourse, and disciplinary action. Copying, or helping somebody copy, may\nresult in an F on your transcript that you will not be able to drop.\n</code></pre> <p>\u4e0a\u8ff0\u7684\u8981\u6c42\u5bf9\u8bfe\u7a0b\u6240\u6709\u7684\u5355\u4eba\u4f5c\u4e1a\u90fd\u4f7f\u7528\u3002</p> <pre><code>This policy applies to all coursework that is handed in by an\nindividual: problem sets, reading exercises, nanoquiz makeups, etc.\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u7ec4\u961f\u4f5c\u4e1a-group-work","title":"\u7ec4\u961f\u4f5c\u4e1a Group work","text":"<p>\u4f60\u5e94\u8be5\u548c\u4f60\u7684\u961f\u53cb\u5408\u4f5c\u5b8c\u6210\u7ec4\u961f\u4f5c\u4e1a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u4eba\u90fd\u5e94\u8be5\u6709\u63a5\u8fd1\u7684\u4efb\u52a1\u91cf\u3002</p> <pre><code>You should collaborate with your partners on all aspects of group\nproject work and in-class collaborative exercises, and each of you is\nexpected to contribute a roughly equal share to design and\nimplementation.\n</code></pre> <p>\u4f60\u53ef\u4ee5\u590d\u7528\u81ea\u5df1\u5728\u5b66\u671f\u5185\u65e9\u4e9b\u65f6\u5019\u7f16\u5199\u7684\u4ee3\u7801\u7b49\uff08\u5305\u62ec\u4e4b\u524d\u81ea\u5df1\u548c\u5176\u4ed6\u961f\u53cb\u5b8c\u6210\u7684\uff09\u3002\u4f60\u4e5f\u53ef\u4ee5\u7528\u8bfe\u7a0b\u63d0\u4f9b\u7684\u4efb\u4f55\u4ee3\u7801\u3002</p> <pre><code>You may reuse designs, ideas and code from your own work earlier in the\nsemester (even if it was done with a different partner). You may also\nuse any code provided by this semester\u2019s 6.031 staff.\n</code></pre> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u5916\u90e8\u4ee3\u7801\uff0c\u53ea\u8981\uff1a</p> <ol> <li>\u6240\u6709\u540c\u5b66\u90fd\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8d44\u6599</li> <li>\u8fdb\u884c\u4e86\u5408\u7406\u7684\u5f15\u7528</li> <li>\u4f5c\u4e1a\u5141\u8bb8\u4f60\u8fd9\u4e48\u505a</li> </ol> <p>\u7279\u522b\u5730\uff0c\u5982\u679c\u4f5c\u4e1a\u8981\u6c42\u4f60\u201c\u5b9e\u73b0 X \u529f\u80fd\u201d\uff0c\u4f60\u5c31\u5fc5\u987b\u81ea\u5df1\u5b9e\u73b0 X \u529f\u80fd\uff0c\u4e0d\u80fd\u590d\u7528\u4ed6\u4eba\u7684\u3002</p> <p>\u4f60\u4eec\u7ec4\u4e0d\u80fd\u590d\u7528\u5176\u4ed6\u7ec4\u7684\u4ee3\u7801\u548c\u601d\u8def\uff0c\u65e0\u8bba\u662f\u5176\u4ed6\u7ec4\u662f\u5f53\u524d\u5b66\u671f\u8fd8\u662f\u4ee5\u5f80\u5b66\u671f\u7684\u540c\u5b66\u3002</p> <pre><code>You may also use material from external sources, so long as: (1) the\nmaterial is available to all students in the class; (2) you give proper\nattribution; and (3) the assignment itself allows it. In particular, if\nthe assignment says \u201cimplement X,\u201d then you must create your own X, not\nreuse someone else\u2019s. Finally, your group may not reuse designs, ideas,\nor code created by another group, in this semester or previous\nsemesters.\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u5373\u4f7f\u4fee\u6539\u7f51\u7edc\u4e0a\u7684\u4ee3\u7801\u5f88\u5e38\u89c1-although-it-is-common-practice-to-adapt-code-examples-found-on-the-web","title":"\u5373\u4f7f\u4fee\u6539\u7f51\u7edc\u4e0a\u7684\u4ee3\u7801\u5f88\u5e38\u89c1 Although it is common practice to adapt code examples found on the web,","text":"<ul> <li> <p>\u4f60\u4e0d\u80fd\u6284\u88ad\u5176\u4ed6\u540c\u5b66\u7684\u4ee3\u7801\u3002\u4f60\u7684\u540c\u5b66\u4e0d\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u4ee3\u7801\u6765\u6e90\u3002</p> <pre><code>You should never copy code from other students. Your peers are\nnot considered an authorized source.\n</code></pre> </li> <li> <p>\u4f60\u4e0d\u80fd\u7b80\u5355\u5730\u590d\u7528\u7f51\u4e0a\u7684\u4ee3\u7801\u3002\u5c31\u50cf\u5b66\u672f\u5199\u4f5c\uff0c\u4f60\u53ef\u4ee5\u91c7\u7528\u522b\u4eba\u7684\u601d\u8def\uff0c\u4f46\u662f\u4f60\u4e5f\u8981\u628a\u81ea\u5df1\u7684\u7406\u89e3\u52a0\u8fdb\u53bb\u3002</p> <pre><code>You should not simply re-use code as the solution to an\nassignment. Like academic writing, your code can incorporate the\nideas of others but should reflect your original approach to the\nproblem.\n</code></pre> </li> </ul>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u5f15\u7528\u4ee3\u7801\u7684\u4f8b\u5b50-examples-of-citing-code-sources","title":"\u5f15\u7528\u4ee3\u7801\u7684\u4f8b\u5b50 Examples of citing code sources","text":"<p>\u4f8b\u5b50\u4e00 Example 1\uff1a</p> <p>\u5728 Apache \u9879\u76ee\u7684\u6e90\u7801\u7684 PluginProxyUtil \u7c7b\u4e2d\uff0c\u5f00\u53d1\u8005\u5f15\u7528\u4e86\u8bba\u575b\u7684 URL\uff0c\u4f5c\u8005\u548c\u65f6\u95f4\uff1a</p> <pre><code>In describing the class PluginProxyUtil in the Apache Project source\ncode, the developer cites the source as a post in a forum and includes\nthe URL, author and date:\n</code></pre> <pre><code>/**\n* A utility class that gives applets the ability to detect proxy host settings.\n* This was adapted from a post from Chris Forster on 20030227 to a Sun Java\n* forum here:\n* http://forum.java.sun.com/thread.jspa?threadID=364342&amp;tstart=120\n[\u2026]\n*/\n</code></pre> <p>\uff08\u6765\u6e90\uff1aApache Project \u6e90\u4ee3\u7801 http://svn.apache.org \u4e8e 2019 \u5e74 7 \u6708\u83b7\u53d6\uff09</p> <pre><code>(Source: Apache Project source code http://svn.apache.org retrieved in\nJuly 2019.)\n</code></pre> <p>\u4f8b\u5b50\u4e8c Example 2\uff1a</p> <p>\u5728 Google Chrome <code>stack_trace_win</code> \u7684 <code>OutputTraceToStream</code> \u51fd\u6570\u4e2d\uff0c\u5f00\u53d1\u8005\u5f15\u7528\u4e86 Microsoft Developer Network \u5e76\u4e14\u9644\u5e26\u4e86 URL\uff1a</p> <pre><code>In the function OutputTraceToStream in the Google Chrome stack_trace_win\nsource code, the developer cites the source code as the Microsoft\nDeveloper Network and includes a URL:\n</code></pre> <pre><code>// Code adapted from MSDN example:\n// http://msdn.microsoft.com/en-us/library/ms680578(VS.85).aspx \n</code></pre> <p>\uff08\u6765\u6e90\uff1ahttps://github.com/adobe/chromium/blob/master/base/debug/stack_trace_win.cc \u4e8e 2019 \u5e74 7 \u6708\u83b7\u53d6\uff09 </p> <pre><code>(Source:\nhttps://github.com/adobe/chromium/blob/master/base/debug/stack_trace_win.cc\nretrieved in July 2019.)\n</code></pre>","tags":["mit","plagiarism"]},{"location":"programming/2022/07/12/writing-code-cn/#\u5f15\u7528\u9644\u6709\u5f00\u6e90\u8bb8\u53ef\u8bc1\u7684\u4ee3\u7801\u7684\u4f8b\u5b50-example-of-open-source-licensed-code","title":"\u5f15\u7528\u9644\u6709\u5f00\u6e90\u8bb8\u53ef\u8bc1\u7684\u4ee3\u7801\u7684\u4f8b\u5b50 Example of open-source-licensed code:","text":"<p>\u5728 Google Chrome <code>stack_trace_win</code> \u4ee3\u7801\u7684\u5f00\u5934\uff0c\u53ef\u4ee5\u770b\u5230\u7248\u6743\u58f0\u660e\u548c\u5f00\u6e90\u8bb8\u53ef\u8bc1\u7684\u5f15\u7528\uff1a</p> <pre><code>At the top of the Google Chrome stack_trace_win source file, note the\ncopyright and reference to the open source license:\n</code></pre> <pre><code>// Copyright (c) 2011 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n</code></pre> <p>\u5982\u679c\u4f60\u628a\u8fd9\u4e2a\u4ee3\u7801\u52a0\u5165\u5230\u4f60\u7684\u7a0b\u5e8f\u4e2d\uff0c\u4f60\u9700\u8981\u9075\u5b88 Chromium \u4f5c\u8005\u7684\u5f00\u6e90\u8bb8\u53ef\u8bc1\u534f\u8bae\u4e2d\u7684\u6761\u6b3e\u3002\u867d\u7136\u8fd9\u4e2a\u5f00\u6e90\u8bb8\u53ef\u8bc1\u53ea\u8981\u6c42\u4f60\u5728\u91cd\u5206\u53d1\u7684\u65f6\u5019\u590d\u5236\u4e00\u4efd\u7248\u6743\u58f0\u660e\u548c\u8bb8\u53ef\u8bc1\uff0c\u4e00\u4e2a\u597d\u4e60\u60ef\u662f\u65e0\u8bba\u662f\u5426\u8981\u6c42\uff0c\u4f60\u90fd\u8981\u590d\u5236\u5b83\u7684\u7248\u6743\u58f0\u660e\u5230\u4ee3\u7801\u4e2d\uff0c\u548c/\u6216\u628a\u5b83\u7684\u8bb8\u53ef\u8bc1\u653e\u5230\u4ee3\u7801\u76ee\u5f55\u7684\u6587\u4ef6\u4e2d\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u5728\u5c06\u6765\u60f3\u8981\u91cd\u5206\u53d1\u4f60\u7684\u4ee3\u7801\uff0c\u5c31\u5f88\u5bb9\u6613\u68c0\u67e5\u77e5\u8bc6\u4ea7\u6743\u76f8\u5173\u7684\u95ee\u9898\u3002</p> <pre><code>If you incorporate this code into a program, you should follow the terms\noutlined in The Chromium Authors' open source license file, which is\nshown below. While this license only requires that you duplicate the\ncopyright and license if you are redistributing the code, it is good\npractice to always duplicate the copyright in your code, and/or store\nthe license in a file with the code. This way, if you want to\nredistribute the code later, intellectual property reviewing becomes\nmuch easier.\n</code></pre> <pre><code>// Copyright (c) 2014 The Chromium Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//* Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//* Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//* Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n</code></pre> <p>\uff08\u6765\u6e90\uff1aThe Chromium Authors license file https://src.chromium.org/viewvc/chrome/trunk/src/LICENSE \u4e8e 2019 \u5e74 7 \u6708\u83b7\u53d6\uff09</p> <pre><code>(Source: The Chromium Authors license file\nhttps://src.chromium.org/viewvc/chrome/trunk/src/LICENSE retrieved in\nJuly 2019.)\n</code></pre>","tags":["mit","plagiarism"]},{"location":"software/2018/12/06/010-editor-flv-parsing/","title":"\u7f16\u5199 010 Editor \u7684 FLV Template","text":"<p>\u6700\u8fd1\u5728\u505a FLV \u548c H264 \u65b9\u9762\u7684\u7814\u7a76\uff0c\u7814\u7a76\u4e86\u5f88\u591a\u6807\u51c6\u548c\u6587\u6863\uff0c\u7136\u540e\u7528 010 Editor \u5bf9\u7740\u6587\u4ef6\u8fdb\u884c\u5206\u6790\u3002\u8fd9\u4e2a\u8f6f\u4ef6\u771f\u7684\u5f88\u597d\u7528\uff0c\u5bf9\u7814\u7a76\u4e8c\u8fdb\u5236\u7ed3\u6784\u7528\u5904\u7279\u522b\u5927\u3002\u4e0d\u8fc7\u5b83\u81ea\u5e26\u7684 FLV.bt \u529f\u80fd\u4e0d\u662f\u5f88\u597d\uff0c\u6211\u5bf9\u5b83\u52a0\u4e0a\u4e86 H264(AVC) \u7684\u90e8\u5206\u652f\u6301\uff0c\u653e\u5728\u4e86 myFLV.bt \u91cc\u3002\u6211\u4e5f\u5199\u4e86 H264 \u7684\u89e3\u6790\uff0c\u4e0d\u8fc7\u6548\u7387\u4e0d\u9ad8\uff0c\u5927\u6587\u4ef6\u8981\u5361\u597d\u4e00\u4f1a\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5f88\u591a\u683c\u5f0f\uff0c010 editor \u90fd\u6709\u652f\u6301\uff0c\u7279\u522b\u597d\u7528\uff0c\u5b83\u7684\u89e3\u6790\u5668\u8bed\u6cd5\u4e5f\u5f88\u597d\u5199\u3002</p>","tags":["010editor","macos","parser","binary","hex","flv","h264","avc"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/","title":"\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a","text":"","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u770b\u5230 @jsteward \u5728 M1 \u7684 QEMU \u4e2d\u8fd0\u884c\u4e86 Windows on ARM\uff0c\u6240\u4ee5\u6211\u5148\u6765\u8bd5\u8bd5 Debian on AArch64\uff0c\u8fd9\u6837\u4f1a\u7b80\u5355\u4e00\u4e9b\u3002</p> <p>\u53c2\u8003\uff1ahttps://gist.github.com/niw/e4313b9c14e968764a52375da41b4278#file-readme-md</p> <p>\u5927\u7ea6\u9700\u8981 3G \u7684\u786c\u76d8\u7a7a\u95f4\u3002</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u5b89\u88c5-qemu-w-m1-patches","title":"\u5b89\u88c5 QEMU w/ M1 patches","text":"<p>\u76ee\u524d\u4e0a\u6e38\u7684 QEMU \u8fd8\u4e0d\u652f\u6301 M1 \u7684 Hypervisor framework\uff0c\u9700\u8981\u6253 patch\uff1a</p> <pre><code>git clone https://mirrors.tuna.tsinghua.edu.cn/git/qemu.git\ncd qemu\ngit checkout master -b wip/hvf\ncurl 'https://patchwork.kernel.org/series/400619/mbox/'|git am --3way\nmkdir build\ncd build\n../configure --target-list=aarch64-softmmu --enable-cocoa --disable-gnutls\nmake -j4\n</code></pre> <p>\u7f16\u8bd1\u540e\uff0c\u5f97\u5230 <code>qemu-system-aarch64</code> \u7684\u4e8c\u8fdb\u5236</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u51c6\u5907\u597d\u6587\u4ef6\u7cfb\u7edf","title":"\u51c6\u5907\u597d\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u9700\u8981\u4e0b\u8f7d EFI \u56fa\u4ef6 \u548c Debian \u5b89\u88c5\u955c\u50cf\uff0c\u89e3\u538b\u524d\u8005\u4ee5\u540e\u628a\u6587\u4ef6\u653e\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d\uff0c\u5e76\u4e14\u521b\u5efa\u9700\u8981\u7684\u6587\u4ef6\uff1a</p> <pre><code>$ ls *.fd\nQEMU_EFI.fd   QEMU_VARS.fd\n$ dd if=/dev/zero of=pflash0.img bs=1m count=64\n$ dd if=/dev/zero of=pflash1.img bs=1m count=64\n$ dd if=QEMU_EFI.fd of=pflash0.img conv=notrunc\n$ dd if=QEMU_VARS.fd of=pflash1.img conv=notrunc\n$ $QEMU/qemu-img create -f qcow2 disk.qcow2 40G\n</code></pre>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u5b89\u88c5-debian-\u7cfb\u7edf","title":"\u5b89\u88c5 Debian \u7cfb\u7edf","text":"<p>\u63a5\u7740\uff0c\u6267\u884c\u4ee5\u4e0b\u7684\u547d\u4ee4\uff0c\u7136\u540e\u6309\u7167\u63d0\u793a\u5b89\u88c5\u7cfb\u7edf\uff1a</p> <pre><code>$ $QEMU/qemu-system-aarch64 \\\n  -serial mon:stdio \\\n  -M virt,highmem=off \\\n  -accel hvf \\\n  -cpu cortex-a72 \\\n  -smp 4 \\\n  -m 4096 \\\n  -drive file=./pflash0.img,format=raw,if=pflash,readonly=on \\\n  -drive file=./pflash1.img,format=raw,if=pflash \\\n  -device virtio-scsi-pci \\\n  -device virtio-gpu-pci \\\n  -device qemu-xhci \\\n  -device usb-kbd \\\n  -device usb-tablet \\\n  -drive file=./disk.qcow2,if=none,id=boot,cache=writethrough \\\n  -device nvme,drive=boot,serial=boot \\\n  -drive if=none,id=cd,file=debian-10.7.0-arm64-xfce-CD-1.iso,media=cdrom \\\n  -device scsi-cd,drive=cd \\\n  -display default,show-cursor=on\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u7528 <code>-cdrom</code> \u9009\u9879\uff0cDebian \u4f1a\u65e0\u6cd5\u8bc6\u522b\uff0c\u6240\u4ee5\u9700\u8981\u8d70 SCSI\u3002\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u7b2c\u4e00\u6b21\u91cd\u542f\u53ef\u80fd\u4f1a\u663e\u793a\u5931\u8d25\uff0c\u4e0d\u7528\u7ba1\u3002\u53e6\u5916\uff0c\u5b89\u88c5\u754c\u9762\u53ea\u5728\u4e32\u53e3\u5904\u663e\u793a\uff0c\u4f46\u4e0d\u4f1a\u663e\u793a\u5728 GUI \u4e2d\uff0c\u4f30\u8ba1\u662f\u56e0\u4e3a BUG\uff08\u611f\u8c22 @Harry-Chen \u6307\u51fa\uff09\u3002</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u542f\u52a8\u7cfb\u7edf","title":"\u542f\u52a8\u7cfb\u7edf","text":"<p>\u5b89\u88c5\u597d\u540e\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u542f\u52a8 Debian \u7cfb\u7edf\uff1a</p> <pre><code>$ $QEMU/qemu-system-aarch64 \\\n  -monitor stdio \\\n  -M virt,highmem=off \\\n  -accel hvf \\\n  -cpu cortex-a72 \\\n  -smp 4 \\\n  -m 4096 \\\n  -drive file=./pflash0.img,format=raw,if=pflash,readonly=on \\\n  -drive file=./pflash1.img,format=raw,if=pflash \\\n  -device virtio-gpu-pci \\\n  -device virtio-scsi-pci \\\n  -device qemu-xhci \\\n  -device usb-kbd \\\n  -device usb-tablet \\\n  -drive file=./disk.qcow2,if=none,id=boot,cache=writethrough \\\n  -device nvme,drive=boot,serial=boot \\\n  -display default,show-cursor=on \\\n  -nic user,model=virtio\n</code></pre> <p>\u6ce8\u610f\u53c2\u6570\u548c\u4e0a\u9762\u6709\u6240\u4e0d\u540c\u3002\u542f\u52a8\u540e\u5c31\u53ef\u4ee5\u5728 GUI \u4e0a\u770b\u5230 Debian \u767b\u5f55\u7684\u754c\u9762\u4e86\u3002</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u7f51\u7edc","title":"\u7f51\u7edc","text":"<p>\u8d77\u6765\u4ee5\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u7f51\u5361 <code>enp0s1</code> \u542f\u52a8\u5e76\u83b7\u53d6 IP \u5730\u5740\uff1a</p> <pre><code>$ ip l set enp0s1 up\n$ dhclient enp0s1\n</code></pre> <p>\u83b7\u53d6\u5230\u4e00\u4e2a IP \u5730\u5740\u540e\uff0c\u5c31\u53ef\u4ee5\u4e0a\u7f51\u4e86\u3002</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2021/01/02/aarch64-debian-in-qemu-m1/#\u5df2\u77e5\u95ee\u9898","title":"\u5df2\u77e5\u95ee\u9898","text":"<p>\u5728\u865a\u62df\u673a\u5185\u91cd\u542f\u4ee5\u540e\uff0c\u53ef\u80fd\u4f1a\u542f\u52a8\u5931\u8d25\u3002\u9000\u51fa QEMU \u8fdb\u7a0b\u91cd\u65b0\u542f\u52a8\u5373\u53ef\u3002</p>","tags":["debian","macos","m1","qemu","aarch64"]},{"location":"software/2018/10/23/admin-mongo-docker/","title":"\u90e8\u7f72 adminMongo \u7684 Docker \u955c\u50cf","text":"<p>\u4e4b\u524d\u5728\u8f6f\u5de5\u7684\u5e73\u53f0\u4e0a\u90e8\u7f72\u4e86\u4e00\u4e2a MongoDB\uff0c\u4f46\u662f\u81ea\u7136\u662f\u4ec5\u5185\u7f51\u8bbf\u95ee\uff0c\u60f3\u8981\u6d4f\u89c8\u5185\u5bb9\u53ea\u80fd\u901a\u8fc7\u7f51\u9875\u4e0a\u7684 Console \u8fdb\u53bb\u770b\uff0c\u4f53\u9a8c\u7279\u522b\u4e0d\u597d\u3002\u6240\u4ee5\u60f3\u7740\u80fd\u4e0d\u80fd\u627e\u4e00\u4e2a\u5728\u7ebf\u7684 MongoDB \u6d4f\u89c8\u5668\u3002\u7531\u4e8e\u8f6f\u5de5\u5e73\u53f0\u53ea\u80fd\u90e8\u7f72 Docker \u955c\u50cf\uff0c\u6240\u4ee5\u6211\u627e\u5230\u4e86mongo-express\u548cadicom/admin-mongo\u3002\u4f46\u8f6f\u5de5\u5e73\u53f0\u73b0\u5728\u8fd8\u6ca1\u5b9e\u73b0\u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u6211\u9009\u4e86\u540e\u8005\u3002</p> <p>\u9996\u5148\u672c\u5730\u521b\u5efa\u4e00\u4e2a app.json\uff0c\u8ba9\u5b83\u76d1\u542c 0.0.0.0:80\uff0c\u901a\u8fc7 deployer \u4f20\u5230\u5e73\u53f0\u4e0a\u7684\u914d\u7f6e\uff0c\u7136\u540e\u518d\u628a\u914d\u7f6e mount \u5230 /app/config \u8def\u5f84\u4e0a\u3002\u73b0\u5728\u5c31\u53ef\u4ee5\u6210\u529f\u5730\u5728\u7f51\u9875\u4e0a\u6d4f\u89c8 MongoDB \u4e86\u3002</p>","tags":["docker","secoder","mongodb"]},{"location":"software/2019/01/10/alacritty-powerline-font-offset/","title":"\u8c03\u6574 Alacritty \u7684 Powerline \u5b57\u4f53\u663e\u793a\u504f\u79fb","text":"<p>\u4eca\u5929\u4f53\u9a8c\u4e86\u4e00\u4e0b Alacritty\uff0c\u4ee5\u524d\u4e00\u76f4\u5728\u7528 iTerm2\uff0c\u4f46\u662f\u5b83\u7684\u9ad8\u7ea7\u529f\u80fd\u6211\u90fd\u6ca1\u7528\u5230\u3002\u4e8e\u662f\u73b0\u5728\u7528\u4e86\u4e0b Alacritty\uff0c\u628a Solarized Dark \u914d\u7f6e\u4e86\uff0c\u53d1\u73b0 Inconsolata for Powerline \u5b57\u4f53\u663e\u793a\u6709\u70b9\u504f\u5dee\uff0c\u4e8e\u662f\u8c03\u6574\u4e86\u4e00\u4e0b\uff1a</p> <pre><code># Font configuration (changes require restart)\nfont:\n  # Normal (roman) font face\n  normal:\n    family: Inconsolata for Powerline\n    # The `style` can be specified to pick a specific face.\n    #style: Regular\n\n  # Bold font face\n  bold:\n    family: Inconsolata for Powerline\n    # The `style` can be specified to pick a specific face.\n    #style: Bold\n\n  # Italic font face\n  italic:\n    family: Inconsolata for Powerline\n    # The `style` can be specified to pick a specific face.\n    #style: Italic\n\n  # Point size\n  size: 18.0\n\n  # Offset is the extra space around each character. `offset.y` can be thought of\n  # as modifying the line spacing, and `offset.x` as modifying the letter spacing.\n  offset:\n    x: 0\n    y: 0\n\n  # Glyph offset determines the locations of the glyphs within their cells with\n  # the default being at the bottom. Increasing `x` moves the glyph to the right,\n  # increasing `y` moves the glyph upwards.\n  glyph_offset:\n    x: 0\n    y: 3\n</code></pre> <p>\u4e3b\u8981\u662f\u8fd9\u91cc\u7684 glyph_offset \u8bbe\u7f6e\u4e3a 3\uff082 \u4e5f\u53ef\u4ee5\uff0c\u6211\u66f4\u559c\u6b22 3\uff09 \uff0c\u8fd9\u6837\u7bad\u5934\u5c31\u57fa\u672c\u5bf9\u9f50\u4e86\u4e0d\u4f1a\u7a81\u51fa\u6765\u3002</p> <p>\u7136\u540e\u6309\u7167\u5b98\u65b9 Wiki\uff0c\u914d\u7f6e\u4e86 Solarized Dark \u914d\u8272\uff1a</p> <pre><code>## Colors (Solarized Dark)\ncolors:\n  # Default colors\n  primary:\n    background: '0x002b36' # base03\n    foreground: '0x839496' # base0\n\n  # Normal colors\n  normal:\n    black:   '0x073642' # base02\n    red:     '0xdc322f' # red\n    green:   '0x859900' # green\n    yellow:  '0xb58900' # yellow\n    blue:    '0x268bd2' # blue\n    magenta: '0xd33682' # magenta\n    cyan:    '0x2aa198' # cyan\n    white:   '0xeee8d5' # base2\n\n  # Bright colors\n  bright:\n    black:   '0x002b36' # base03\n    red:     '0xcb4b16' # orange\n    green:   '0x586e75' # base01\n    yellow:  '0x657b83' # base00\n    blue:    '0x839496' # base0\n    magenta: '0x6c71c4' # violet\n    cyan:    '0x93a1a1' # base1\n    white:   '0xfdf6e3' # base3\n</code></pre> <p>\u771f\u9999</p>","tags":["alacritty","font"]},{"location":"software/2023/11/23/apple-silicon-linux-rosetta/","title":"\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta","text":"","tags":["macOS","apple","m1","x86","linux","arm64"]},{"location":"software/2023/11/23/apple-silicon-linux-rosetta/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u9700\u8981\u8dd1\u67d0\u4e2a x86 only \u4e14\u9700\u8981 GUI \u7684\u7a0b\u5e8f\uff0c\u4ee5\u5f80\u90fd\u662f\u8dd1\u5728\u8fdc\u7a0b Linux/Windows \u673a\u5668\u4e0a\u518d\u8fdc\u7a0b\u684c\u9762\u53bb\u4f7f\u7528\u3002\u6700\u8fd1\u770b\u5230\u4e86\u4e00\u4e9b\u6bd4\u8f83\u6210\u719f\u7684\u5728 macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta \u7684\u529e\u6cd5\uff08M1 Mac \u3067 Vivado \u304c\u52d5\u3044\u305f\uff01\uff09\uff0c\u56e0\u6b64\u8bb0\u5f55\u4e0b\u6765\u3002</p> <p>\u672c\u6587\u53c2\u8003\u4e86\u5f88\u591a M1 Mac \u3067 Vivado \u304c\u52d5\u3044\u305f\uff01 \u7684\u5185\u5bb9\u3002</p>","tags":["macOS","apple","m1","x86","linux","arm64"]},{"location":"software/2023/11/23/apple-silicon-linux-rosetta/#\u5b89\u88c5-lima-\u548c-xquartz","title":"\u5b89\u88c5 lima \u548c xquartz","text":"<p>\u7528 homebrew \u5b89\u88c5\uff1a</p> <pre><code>brew install lima\nbrew install xquartz\n</code></pre> <p>lima \u662f\u7528\u6765\u7ba1\u7406\u865a\u62df\u673a\u7684\u5de5\u5177\uff0cXQuartz \u662f\u4e3a\u4e86\u8ba9\u865a\u62df\u673a\u91cc\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5728 macOS \u4e0a\u901a\u8fc7 X11 \u663e\u793a GUI\u3002</p> <p>\u56e0\u4e3a\u9700\u8981\u8dd1 x86\uff0c\u8fd8\u9700\u8981 rosetta\uff1a</p> <pre><code>softwareupdate --install-rosetta\n</code></pre>","tags":["macOS","apple","m1","x86","linux","arm64"]},{"location":"software/2023/11/23/apple-silicon-linux-rosetta/#\u521b\u5efa-linux-\u865a\u62df\u673a","title":"\u521b\u5efa Linux \u865a\u62df\u673a","text":"<p>\u7528 lima \u521b\u5efa Linux \u865a\u62df\u673a\uff1a</p> <pre><code>limactl start template://debian --rosetta --vm-type=vz\n</code></pre> <p>\u521b\u5efa\u7684\u65f6\u5019\uff0c\u9009\u62e9\u7f16\u8f91\u914d\u7f6e\uff0c\u8ba9 ssh \u8f6c\u53d1 X11\uff1a</p> <pre><code>ssh:\n  forwardX11: true\n  forwardX11Trusted: true\n</code></pre> <p>\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u8fd0\u884c <code>limactl shell debian</code>\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u5230 Linux shell \u4e86\u3002</p> <p>\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u989d\u5916\u7684 mount\uff0c\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\uff0c\u6216\u8005\u5728 <code>limactl start</code> \u547d\u4ee4\u884c\u53c2\u6570\u4e0a\u6dfb\u52a0 <code>--mount</code>\uff0c\u4f8b\u5982\uff1a<code>limactl start template://debian --rosetta --vm-type=vz --mount /Volumes/Data:w</code>\u3002</p>","tags":["macOS","apple","m1","x86","linux","arm64"]},{"location":"software/2023/11/23/apple-silicon-linux-rosetta/#\u8fd0\u884c-x11-\u7a0b\u5e8f","title":"\u8fd0\u884c X11 \u7a0b\u5e8f","text":"<p>\u542f\u52a8 XQuartz\uff0c\u5728 XQuartz \u7684 Terminal \u91cc\u542f\u52a8\u5e76\u8fde\u63a5 lima\uff0c\u5b89\u88c5 x11-app \u5e76\u663e\u793a\uff1a</p> <pre><code>limactl shell debian\n# In Linux\nsudo apt install xauth\n# Back to macOS\necho $DISPLAY\nlimactl shell debian\n# In Linux\nsudo apt install x11-apps\necho $DISPLAY\nxeyes\n</code></pre> <p>\u5c31\u53ef\u4ee5\u5728 macOS \u4e0a\u770b\u5230 xeyes \u7684\u8f93\u51fa\u4e86\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u8fd0\u884c\u5728 Linux \u865a\u62df\u673a\u91cc\u9762\uff0c\u901a\u8fc7 ssh \u8f6c\u53d1\u51fa\u6765\u3002\u5982\u679c\u6ca1\u6709\u5b89\u88c5 xauth\uff0c\u4f1a\u51fa\u73b0 X11 \u8f6c\u53d1\u5931\u8d25\uff08\u89c1 X11 forwarding request failed on channel 0\uff09\u3002</p> <p>Rosetta \u4e5f\u5df2\u7ecf\u6ce8\u518c\u5230 binfmt \u4e2d\uff1a</p> <pre><code>$ cat /proc/sys/fs/binfmt_misc/rosetta\nenabled\ninterpreter /mnt/lima-rosetta/rosetta\nflags: OCF\noffset 0\nmagic 7f454c4602010100000000000000000002003e00\nmask fffffffffffefe00fffffffffffffffffeffffff\n</code></pre> <p>\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c x86_64 \u7684\u7a0b\u5e8f\u3002\u5f53\u7136\u4e86\uff0c\u5982\u679c x86 \u7684\u7a0b\u5e8f\u9700\u8981\u52a8\u6001\u5e93\uff0c\u8fd8\u9700\u8981\u5b83\u7684\u52a8\u6001\u5e93\u4f9d\u8d56\u3002\u6bd4\u8f83\u7b80\u5355\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u7528 docker/podman\u3002lima \u9ed8\u8ba4\u5b89\u88c5\u4e86 containerd\uff0c\u53ef\u4ee5\u7528 nerdctl \u6765\u8fd0\u884c\u5bb9\u5668\uff1a</p> <pre><code># AMD64 container\nnerdctl run -it --platform amd64 --rm debian:stable\n# ARM64 container\nnerdctl run -it --rm debian:stable\n</code></pre> <p>\u4e0d\u559c\u6b22 containerd\uff0c\u4e5f\u53ef\u4ee5\u7528 podman\uff1a<code>sudo apt install podman</code>\uff0c</p> <pre><code># AMD64 rootful container\nsudo podman run -it --arch amd64 --rm debian:stable\n# AMD64 rootless container\npodman run -it --arch amd64 --rm debian:stable\n</code></pre> <p>\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5728 AMD64 container \u4e2d\u8fd0\u884c wine\uff1a</p> <pre><code>limactl shell debian\n# In Linux\nsudo podman run -it --rm --arch amd64 --network host -e DISPLAY=$DISPLAY -e HOME=$HOME -u $(id -u):$(id -g) -v $HOME:$HOME -v /Volumes/Data:/Volumes/Data docker.io/tobix/wine:stable\n# In container\nwine64 regedit\n</code></pre>","tags":["macOS","apple","m1","x86","linux","arm64"]},{"location":"software/2022/07/11/archive-common-linking/","title":"Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898","text":"","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2022/07/11/archive-common-linking/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u770b\u5230\u4e00\u4e2a issue: irssi 1.4.1 fails to build on darwin arm64\uff0c\u5b83\u7684\u73b0\u8c61\u662f\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff1a</p> <pre><code>Undefined symbols for architecture arm64:\n  \"_current_theme\", referenced from:\n      _format_get_text_theme in libfe_common_core.a(formats.c.o)\n      _format_get_text in libfe_common_core.a(formats.c.o)\n      _strip_codes in libfe_common_core.a(formats.c.o)\n      _format_send_as_gui_flags in libfe_common_core.a(formats.c.o)\n      _window_print_daychange in libfe_common_core.a(fe-windows.c.o)\n      _printformat_module_dest_charargs in libfe_common_core.a(printtext.c.o)\n      _printformat_module_gui_args in libfe_common_core.a(printtext.c.o)\n      ...\n  \"_default_formats\", referenced from:\n      _format_find_tag in libfe_common_core.a(formats.c.o)\n      _format_get_text_theme_args in libfe_common_core.a(formats.c.o)\n      _printformat_module_dest_args in libfe_common_core.a(printtext.c.o)\n      _printformat_module_gui_args in libfe_common_core.a(printtext.c.o)\nld: symbol(s) not found for architecture arm64\n</code></pre> <p>\u4ee3\u7801 <code>themes.c</code> \u5b9a\u4e49\u4e86\u8fd9\u4e24\u4e2a\u5168\u5c40\u53d8\u91cf\uff1a</p> <pre><code>THEME_REC *current_theme;\nGHashTable *default_formats;\n</code></pre> <p>\u5e76\u4e14 <code>themes.c</code> \u7f16\u8bd1\u51fa\u6765\u7684 <code>themes.c.o</code> \u4e5f\u5728 archive \u6587\u4ef6\u4e2d\uff1a</p> <pre><code>$ ar t src/fe-common/core/libfe_common_core.a | grep themes.c.o\nthemes.c.o\n</code></pre> <p>\u5e76\u4e14 <code>themes.c.o</code> \u4e5f\u5b9a\u4e49\u4e86\u8fd9\u4e24\u4e2a\u7b26\u53f7\uff1a</p> <pre><code>$ objdump -t src/fe-common/core/libfe_common_core.a.p/themes.c.o | grep COM\n0000000000000008         01 COM    00 0300 _current_theme\n0000000000000008         01 COM    00 0300 _default_formats\n0000000000000008         01 COM    00 0300 _themes\n</code></pre> <p>\u90a3\u4e48\uff0c\u95ee\u9898\u5728\u54ea\u5462\uff1f\u770b\u8d77\u6765\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u63d0\u4f9b\u4e86 <code>libfe_common_core.a</code> \u7684\u53c2\u6570\uff0c\u5e76\u4e14 <code>.a</code> \u91cc\u9762\u4e5f\u6709 <code>themes.c.o</code>\uff0c\u6211\u4eec\u8981\u627e\u7684\u7b26\u53f7\u4e5f\u6709\u5b9a\u4e49\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0 <code>Undefined symbols</code> \u7684\u95ee\u9898\u5462\uff1f</p> <p>\u7b54\u6848\u51fa\u5728 COMMON \u7b26\u53f7\u4e0a\u3002</p>","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2022/07/11/archive-common-linking/#common-\u7b26\u53f7","title":"COMMON \u7b26\u53f7","text":"<p>COMMON \u7b26\u53f7\u7684\u539f\u56e0\u548c\u539f\u7406\uff0c\u8be6\u7ec6\u53ef\u4ee5\u89c1 MaskRay \u7684\u535a\u5ba2 All about COMMON symbols\uff0c\u91cc\u9762\u4ece\u94fe\u63a5\u5668\u7684\u89d2\u5ea6\u5f88\u8be6\u7ec6\u5730\u8bb2\u8ff0\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cCOMMON \u7b26\u53f7\u7684\u5f15\u5165\u662f\u4e3a\u4e86\u548c Fortran \u8fdb\u884c\u4e92\u64cd\u4f5c\u3002\u5b83\u5728 C \u4e2d\u5bf9\u5e94\u4e86\u6ca1\u6709\u521d\u59cb\u5316\u8bed\u53e5\u7684\u5168\u5c40\u53d8\u91cf\u3002\u5b9e\u9645\u4e0a\u5230\u6700\u540e\uff0c\u8fd8\u662f\u4f1a\u4fdd\u5b58\u5230 .bss \u6bb5\u4e2d\uff0c\u9ed8\u8ba4\u6e05\u96f6\u3002\u6240\u4ee5\uff1a</p> <pre><code>int common_symbol;\nint not_common_symbol = 0;\n</code></pre> <p>\u4e24\u4e2a\u8bed\u53e5\u6700\u7ec8\u7ed3\u679c\u662f\u7c7b\u4f3c\u7684\uff0c\u53ea\u4e0d\u8fc7\u7b2c\u4e00\u4e2a\u662f COMMON Symbol\uff0c\u7b2c\u4e8c\u4e2a\u5c31\u662f\u666e\u901a\u7684 GLOBAL Symbol\u3002</p> <p>\u8fd9\u770b\u8d77\u6765\u548c <code>Undefined symbols</code> \u9519\u8bef\u8fd8\u662f\u6ca1\u6709\u5173\u7cfb\u3002\u95ee\u9898\u5728\u54ea\uff1f</p>","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2022/07/11/archive-common-linking/#archive","title":"Archive","text":"<p>\u9759\u6001\u5e93\u901a\u5e38\u662f\u4ee5 Archive \u7684\u65b9\u5f0f\u7ed9\u51fa\uff0c\u540e\u7f00\u662f <code>.a</code>\u3002\u5b83\u5b9e\u9645\u4e0a\u662f\u4e00\u5806 <code>.o</code> \u6253\u5305\u7684\u96c6\u5408\uff0c\u5916\u52a0\u4e00\u4e2a\u7d22\u5f15\uff0c\u5373\u5355\u72ec\u4fdd\u5b58\u4e00\u4e2a\u8868\uff0c\u4fdd\u5b58\u4e86\u6bcf\u4e2a <code>.o</code> \u5b9a\u4e49\u4e86\u54ea\u4e9b\u7b26\u53f7\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\u627e\u7b26\u53f7\u7684\u65f6\u5019\uff0c\u4e0d\u7528\u904d\u5386 <code>.o</code>\uff0c\u800c\u662f\u76f4\u63a5\u5728\u7d22\u5f15\u91cc\u9762\u627e\u76f8\u5173\u7684\u7b26\u53f7\u3002</p> <p>\u4e3a\u4e86\u521b\u5efa\u4e00\u4e2a Archive\uff0cLinux \u4e0a\u53ef\u4ee5\u7528 <code>ar</code> \u547d\u4ee4\uff1a</p> <pre><code>ar cr libxxx.a a.o b.o c.o\n</code></pre> <p>\u5176\u4e2d <code>c</code> \u8868\u793a create\uff0c<code>r</code> \u8868\u793a\u63d2\u5165\uff08\u548c\u8986\u76d6\uff09\u3002</p> <p>macOS \u4e0a\u8981\u7528 <code>libtool -static</code> \u6765\u521b\u5efa Archive\uff1a</p> <pre><code>libtool -static libxxx.a a.o b.o c.o\n</code></pre> <p>\u5426\u5219\u94fe\u63a5\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff1a</p> <pre><code>ld: warning: ignoring file libxxx.a, building for macOS-arm64 but attempting to link with file built for unknown-unsupported file format\n</code></pre> <p>\u7136\u540e\u7528 <code>ar t</code> \u547d\u4ee4\u5c31\u53ef\u4ee5\u770b Archive \u6709\u54ea\u4e9b\u5185\u5bb9\uff1a</p> <pre><code>$ ar t libxxx.a\na.o\nb.o\nc.o\n</code></pre> <p>\u53ef\u4ee5\u7528 <code>nm --print-armap</code> \u547d\u4ee4\u67e5\u770b Archive \u7684\u7d22\u5f15\uff1a</p> <pre><code>$ nm --print-armap libxxx.a\nArchive index:\nsymbol1 in a.o\nsymbol2 in b.o\nsymbol3 in c.o\n\na.o:\n0000000000000000 T symbol1\n</code></pre> <p>\u6240\u4ee5\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86 Archive \u7684\u60c5\u51b5\uff1a\u5b83\u662f\u591a\u4e2a <code>.o</code> \u6587\u4ef6\u7684\u96c6\u5408\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u7d22\u5f15\u3002\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7\u7d22\u5f15\u6765\u627e <code>.o</code>\uff0c\u800c\u4e0d\u662f\u904d\u5386\u6240\u6709\u7684 <code>.o</code> \u6587\u4ef6\u3002</p>","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2022/07/11/archive-common-linking/#\u94fe\u63a5\u95ee\u9898","title":"\u94fe\u63a5\u95ee\u9898","text":"<p>\u90a3\u4e48\uff0c\u56de\u5230\u4e00\u5f00\u59cb\u7684\u94fe\u63a5\u95ee\u9898\uff0c\u65e2\u7136\u6211\u4eec\u5df2\u7ecf\u786e\u8ba4\u4e86\uff0c<code>.o</code> \u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u7b26\u53f7\uff0c\u5e76\u4e14\u8fd9\u4e2a <code>.o</code> \u4e5f\u786e\u5b9e\u5728 <code>.a</code> \u6587\u4ef6\u4e2d\uff0c\u90a3\u5c31\u53ea\u5269\u4e0b\u6700\u540e\u4e00\u4e2a\u53ef\u80fd\u4e86\uff1a\u7d22\u5f15\u91cc\u9762\u6ca1\u6709\u8fd9\u4e2a\u7b26\u53f7\u3002</p> <p>\u7528 <code>nm --print-armap</code> \u547d\u4ee4\u5c1d\u8bd5\uff0c\u53d1\u73b0\u4e0a\u9762\u7684 <code>_default_formats</code> \u548c <code>_current_theme</code> \u53ea\u5728\u5bf9\u5e94\u7684 <code>.o</code> \u4e2d\u6709\u5b9a\u4e49\uff0c\u5728 Archive index \u90e8\u5206\u662f\u6ca1\u6709\u7684\u3002</p> <p>\u7f51\u53cb @ailin-nemui \u6307\u51fa\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u4e2a\u94fe\u63a5\uff1aOS X linker unable to find symbols from a C file which only contains variables\u3002\u5b83\u8bb2\u4e86\u5f88\u91cd\u8981\u7684\u4e00\u70b9\uff0c\u662f macOS \u7684 ar/ranlib/libtool \u7248\u672c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u4e3a COMMON \u7b26\u53f7\u521b\u5efa\u7d22\u5f15\u3002\u6240\u4ee5\uff0c\u89e3\u51b3\u65b9\u6848\u4e5f\u5f88\u660e\u786e\u4e86\uff1a</p> <ol> <li>\u7b2c\u4e00\u79cd \u4e0d\u8981\u521b\u5efa COMMON \u7b26\u53f7\uff1a\u6dfb\u52a0\u7f16\u8bd1\u9009\u9879 <code>-fno-common</code>\uff0c\u8fd9\u4e2a\u9009\u9879\u5728\u6bd4\u8f83\u65b0\u7684\u7f16\u8bd1\u5668\u91cc\u90fd\u662f\u9ed8\u8ba4\u4e86</li> <li>\u7b2c\u4e8c\u79cd \u4e3a COMMON \u7b26\u53f7\u521b\u5efa\u7d22\u5f15\uff1a\u7528 <code>libtool -static -c</code> \u547d\u4ee4\uff0c\u5176\u4e2d <code>-c</code> \u9009\u9879\u5c31\u662f\u6253\u5f00\u4e3a COMMON \u7b26\u53f7\u521b\u5efa\u7d22\u5f15</li> <li>\u7b2c\u4e09\u79cd \u4fee\u6539\u4ee3\u7801\uff1a\u7ed9\u5168\u5c40\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u521d\u59cb\u5316\u503c</li> </ol> <p>\u8fd9\u6837\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u5f97\u5230\u4e86\u59a5\u5584\u7684\u89e3\u51b3\u3002</p>","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2022/07/11/archive-common-linking/#\u9644\u5f55","title":"\u9644\u5f55","text":"<p>\u4e0b\u9762\u662f macOS libtool manpage \u4e2d\u5199\u7684\u76f8\u5173\u6587\u6863\uff1a</p> <pre><code>-c     Include common symbols as definitions with respect to the table of contents.  This is seldom the intended behavior for linking  from\n          a library, as it forces the linking of a library member just because it uses an uninitialized global that is undefined at that point\n          in the linking.  This option is included only because this was the original behavior of ranlib.  This option is not the default.\n</code></pre>","tags":["macos","ld","linking","common","fortran"]},{"location":"software/2021/02/09/big-sur-m1-latex-kaiti-fonts/","title":"\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898","text":"","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/big-sur-m1-latex-kaiti-fonts/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5c1d\u8bd5\u79fb\u690d MiKTeX \u5230 Apple Silicon \u4e0a\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e9b patch \u4ee5\u540e\u5c31\u53ef\u4ee5\u5de5\u4f5c\u4e86\uff0c\u4f46\u9047\u5230\u4e86\u65b0\u7684\u95ee\u9898\uff0c\u5373\u627e\u4e0d\u5230 KaiTi</p> <pre><code>~/Library/Application Support/MiKTeX/texmfs/install/tex/latex/ctex/fontset/ctex-fontset-macnew.def:99:\n   Package fontspec Error:\n      The font \"Kaiti SC\" cannot be found.\n</code></pre> <p>\u7528 <code>miktex-fc-list</code> \u547d\u4ee4\u627e\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u6ca1\u6709\u627e\u5230\uff1a</p> <pre><code>$ /Applications/MiKTeX\\ Console.app/Contents/bin/miktex-fc-list | grep Kaiti\n# Nothing\n</code></pre> <p>\u4e0a\u7f51\u641c\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff1a\u5b57\u4f53\u5728\u76ee\u5f55 <code>/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/Versions/A/Support/FontSubsets/Kaiti.ttc</code> \u91cc\uff0c\u6240\u4ee5\u624b\u52a8\u5b89\u88c5\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u8ba9 LaTeX \u627e\u5230\u4e86\u3002\u4f46\u6211\u89c9\u5f97\uff0c\u4e0e\u5176\u5b89\u88c5\u591a\u4e00\u4efd\u5728\u6587\u4ef6\u7cfb\u7edf\u91cc\uff0c\u4e0d\u5982\u8ba9 LaTeX \u53bb\u627e\u5b83\u3002</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/big-sur-m1-latex-kaiti-fonts/#\u89e3\u51b3\u65b9\u6cd5","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u6309\u7167\u4e0a\u9762\u7684\u7ebf\u7d22\uff0c\u627e\u5230\u4e86 <code>Kaiti.ttc</code> \u6240\u5728\u7684\u8def\u5f84\uff1a</p> <pre><code>$ fd Kaiti.ttc\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u548c\u4e0a\u9762\u7684\u8def\u5f84\u53c8\u4e0d\u5927\u4e00\u6837\u3002\u7814\u7a76\u4e86\u4e00\u4e0b fontconfig\uff0c\u53d1\u73b0\u53ef\u4ee5\u7528 <code>miktex-fc-conflist</code> \u627e\u5230\u914d\u7f6e\u6587\u4ef6\u7684\u76ee\u5f55\uff1a</p> <pre><code>$ /Applications/MiKTeX\\ Console.app/Contents/bin/miktex-fc-conflist\n+ ~/Library/Application Support/MiKTeX/texmfs/config/fontconfig/config/localfonts2.conf: No description\n+ ~/Library/Application Support/MiKTeX/texmfs/config/fontconfig/config/localfonts.conf: No description\n...\n</code></pre> <p>\u770b\u4e86\u4e0b\u7b2c\u4e00\u4e2a\u6587\u4ef6\uff08localfonts.conf\uff09\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n\n&lt;!--\n  DO NOT EDIT THIS FILE! It will be replaced when MiKTeX is updated.\n  Instead, edit the configuration file localfonts2.conf.\n--&gt;\n\n&lt;fontconfig&gt;\n&lt;include&gt;localfonts2.conf&lt;/include&gt;\n&lt;dir&gt;/Library/Fonts/&lt;/dir&gt;\n&lt;dir&gt;/System/Library/Fonts/&lt;/dir&gt;\n&lt;dir&gt;~/Library/Application Support/MiKTeX/texmfs/install/fonts/type1&lt;/dir&gt;\n&lt;dir&gt;~/Library/Application Support/MiKTeX/texmfs/install/fonts/opentype&lt;/dir&gt;\n&lt;dir&gt;~/Library/Application Support/MiKTeX/texmfs/install/fonts/truetype&lt;/dir&gt;\n&lt;/fontconfig&gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u8def\u5f84\uff0c\u4e0d\u8fc7\u5efa\u8bae\u4fee\u6539\u7684\u662f <code>localfonts2.conf</code>\u3002\u6309\u7167\u7c7b\u4f3c\u7684\u683c\u5f0f\uff0c\u4fee\u6539\u6210\uff1a</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;fontconfig&gt;\n&lt;dir&gt;/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets&lt;/dir&gt;\n&lt;!-- REMOVE THIS LINE\n&lt;dir&gt;Your font directory here&lt;/dir&gt;\n&lt;dir&gt;Your font directory here&lt;/dir&gt;\n&lt;dir&gt;Your font directory here&lt;/dir&gt;\n     REMOVE THIS LINE --&gt;\n&lt;/fontconfig&gt;\n</code></pre> <p>UPDATE: \u65b0\u7248\u672c macOS \u4e2d\uff0c\u8def\u5f84\u5efa\u8bae\u52a0\u4e0a <code>/System/Library/AssetsV2/com_apple_MobileAsset_Font7</code>\uff1a</p> <pre><code>&lt;dir&gt;/System/Library/AssetsV2/com_apple_MobileAsset_Font7&lt;/dir&gt;\n</code></pre> <p>\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u627e\u5230 Kaiti SC \u4e86\uff1a</p> <pre><code>$ miktex-fc-list | grep Kaiti\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti TC,\u6977\u9ad4\\-\u7e41,\u6977\u4f53\\-\u7e41:style=Regular,\u6a19\u6e96\u9ad4,\u5e38\u89c4\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti SC,\u6977\u9ad4\\-\u7c21,\u6977\u4f53\\-\u7b80:style=Regular,\u6a19\u6e96\u9ad4,\u5e38\u89c4\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti SC,\u6977\u9ad4\\-\u7c21,\u6977\u4f53\\-\u7b80:style=Bold,\u7c97\u9ad4,\u7c97\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti TC,\u6977\u9ad4\\-\u7e41,\u6977\u4f53\\-\u7e41:style=Bold,\u7c97\u9ad4,\u7c97\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti SC,\u6977\u9ad4\\-\u7c21,\u6977\u4f53\\-\u7b80:style=Black,\u9ed1\u9ad4,\u9ed1\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: Kaiti TC,\u6977\u9ad4\\-\u7e41,\u6977\u4f53\\-\u7e41:style=Black,\u9ed1\u9ad4,\u9ed1\u4f53\n/System/Library/PrivateFrameworks/FontServices.framework/Versions/A/Resources/Fonts/Subsets/Kaiti.ttc: STKaiti:style=Regular,\u6a19\u6e96\u9ad4,Ordin\u00e6r,Normal,Normaali,Regolare,\u30ec\u30ae\u30e5\u30e9\u30fc,\uc77c\ubc18\uccb4,Regulier,\u041e\u0431\u044b\u0447\u043d\u044b\u0439,\u5e38\u89c4\u4f53\n</code></pre> <p>\u8fd9\u6837\u5c31\u641e\u5b9a\u4e86\uff0c\u7528 LaTeX \u627e\u5b57\u4f53\u7684\u65f6\u5019\u4e5f\u6ca1\u6709\u51fa\u73b0\u95ee\u9898\u4e86\u3002</p> <p>\u5982\u679c\u4f60\u7528\u7684\u662f TeX Live\uff0c\u90a3\u4e48\u76f4\u63a5\u628a\u4e0a\u9762\u7684 Kaiti.ttc \u8def\u5f84\u590d\u5236\u5230 <code>~/Library/Fonts</code> \u4e0b\u5373\u53ef\u3002</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2022/09/19/buildroot-fakeroot-incompat/","title":"Buildroot 2020.08 \u7684 Fakeroot \u7248\u672c\u8fc7\u65e7\u5bfc\u81f4\u7684\u517c\u5bb9\u6027\u95ee\u9898","text":"","tags":["linux","fakeroot","mknod"]},{"location":"software/2022/09/19/buildroot-fakeroot-incompat/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7ed9\u4e4b\u524d\u7684 Buildroot 2020.09 \u589e\u52a0\u65b0\u7684\u8f6f\u4ef6\u5305\uff0c\u7ed3\u679c\u7f16\u8bd1\u7684\u65f6\u5019\u62a5\u9519\uff1a</p> <pre><code>mknod: ....../dev/console: Operation not permitted\n</code></pre> <p>\u8fd8\u6709\u4e00\u4e2a\u80cc\u666f\u662f\u524d\u6bb5\u65f6\u95f4\u628a\u7cfb\u7edf\u5347\u7ea7\u5230\u4e86 Ubuntu 22.04 LTS\u3002</p>","tags":["linux","fakeroot","mknod"]},{"location":"software/2022/09/19/buildroot-fakeroot-incompat/#\u7814\u7a76","title":"\u7814\u7a76","text":"<p>\u8dd1\u7684\u65f6\u5019\u6ca1\u6709\u7528 root\uff0c\u800c\u662f\u7528 fakeroot \u8dd1\u7684\uff0c\u6309\u7406\u8bf4\u5728 fakeroot \u91cc\u8dd1 mknod \u662f\u4e0d\u4f1a\u62a5\u9519\u7684\uff0c\u6211\u76f4\u63a5\u8fd0\u884c\u7cfb\u7edf\u7684 fakeroot \u662f\u6b63\u5e38\u7684\uff1a</p> <pre><code>fakeroot -- mknod -m 0622 test c 5 1\n</code></pre> <p>\u6b64\u65f6 fakeroot \u4f1a\u751f\u6210\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u8fd9\u662f\u6b63\u5e38\u73b0\u8c61\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48 Buildroot \u91cc\u8dd1\u5c31\u4e0d\u5bf9\u4e86\u5462\uff1f</p> <p>\u6211\u4ed4\u7ec6\u89c2\u5bdf\u4e86\u4e00\u4e0b\uff0cbuildroot \u7528\u7684\u662f\u81ea\u5df1\u7f16\u8bd1\u7684 fakeroot\uff0c\u7248\u672c\u662f 1.20.2\uff0c\u7528\u8fd9\u4e2a\u7248\u672c\u8dd1\u5c31\u4f1a\u62a5\u9519\uff1a</p> <pre><code>$ ./output/host/bin/fakeroot -- mknod -m 0622 test c 5 1\nmknod: test: Operation not permitted\n</code></pre> <p>\u679c\u7136\u5c31\u51fa\u95ee\u9898\u4e86\u3002</p> <p>\u7528 strace \u89c2\u5bdf\u4e0b\u533a\u522b\uff1a</p> <pre><code>$ fakeroot -- strace mknod -m 0622 test c 5 1\nnewfstatat(AT_FDCWD, \"test\", {st_mode=S_IFREG|0644, st_size=0, ...}, AT_SYMLINK_NOFOLLOW) = 0\nmsgget(0x4b33194b, IPC_CREAT|0600)      = 32771\nmsgget(0x4b33194c, IPC_CREAT|0600)      = 32772\nmsgsnd(...) = 0\nnewfstatat(AT_FDCWD, \"test\", {st_mode=S_IFREG|0644, st_size=0, ...}, AT_SYMLINK_NOFOLLOW) = 0\nmsgsnd(...) = 0\nopenat(AT_FDCWD, \"test\", O_RDONLY|O_NOFOLLOW|O_CLOEXEC|O_PATH) = 3\nnewfstatat(3, \"\", {st_mode=S_IFREG|0644, st_size=0, ...}, AT_EMPTY_PATH) = 0\nfchmodat(AT_FDCWD, \"/proc/self/fd/3\", 0622) = 0\n$ ./output/host/bin/fakeroot -- strace mknod -m 0622 test c 5 1\numask(000)                              = 002\numask(002)                              = 000\nmknodat(AT_FDCWD, \"test\", S_IFCHR|0622, makedev(0x5, 0x1)) = -1 EPERM (Operation not permitted)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cmknodat \u7cfb\u7edf\u8c03\u7528\u88ab\u62e6\u622a\uff0c\u7531 fakeroot \u6765\u521b\u5efa\u7a7a\u6587\u4ef6\uff1b\u800c\u9519\u8bef\u7684 fakeroot \u7248\u672c\u4e0b\uff0c\u6ca1\u6709\u62e6\u622a\u6210\u529f\uff0c\u5c31\u51fa\u73b0\u4e86 EPERM\u3002</p>","tags":["linux","fakeroot","mknod"]},{"location":"software/2022/09/19/buildroot-fakeroot-incompat/#\u89e3\u51b3","title":"\u89e3\u51b3","text":"<p>\u4e00\u4e2a\u7c97\u66b4\u7684\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u76f4\u63a5\u4fee\u6539 buildroot \u6e90\u4ee3\u7801\uff0c\u8ba9\u5b83\u7528\u7cfb\u7edf\u7684 fakeroot\uff1a</p> <pre><code>        PATH=$$(BR_PATH) FAKEROOTDONTTRYCHOWN=1 /usr/bin/fakeroot -- $$(FAKEROOT_SCRIPT)\n</code></pre> <p>\u6211\u8fd8\u5c1d\u8bd5\u91cd\u65b0\u7f16\u8bd1 fakeroot 1.20.2\uff0c\u4f1a\u51fa\u73b0\u7f16\u8bd1\u9519\u8bef\uff0c\u91c7\u7528\u7c7b\u4f3c bug 69572 fakeroot failes to build: _STAT_VER undeclared \u7684\u65b9\u6cd5\u53ef\u4ee5\u89e3\u51b3\u7f16\u8bd1\u7684\u95ee\u9898\uff0c\u4f46\u662f\u8fd8\u662f\u51fa\u73b0 EPERM\u3002Buildroot \u540e\u6765\u4e5f\u5f15\u5165\u4e86\u7c7b\u4f3c\u7684\u4fee\u590d\u3002</p> <p>\u4e8e\u662f\u5728\u6e90\u4ee3\u7801\u5386\u53f2\u4e2d\u641c\u5bfb\u4e86\u4e00\u756a\uff0c\u53d1\u73b0\u4e86\u4e00\u4e2a\u7591\u4f3c\u7684\u4fee\u590d commit\uff1aconfigure.ac: fix __xmknod{,at} pointer argument\uff0c\u4e0d\u8fc7\u6211\u5e76\u4e0d\u80fd\u786e\u5b9a\u662f\u4e0d\u662f\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u8fdb\u4e00\u6b65\uff0c\u6211\u5728 Docker \u955c\u50cf\u4e2d\u624b\u52a8\u4e0b\u8f7d\u5e76\u7f16\u8bd1 fakeroot 1.20.2\u30011.21 \u548c 1.25.3\uff0c\u90fd\u53ef\u4ee5\u590d\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u7f16\u8bd1 1.29 \u7248\u672c\u5219\u6ca1\u6709\u95ee\u9898\u3002\u7528 git \u514b\u9686\u4ed3\u5e93\uff0c\u8fdb\u4e00\u6b65\u5b9a\u4f4d\u5230 upstream/1.26 \u548c upstream/1.27 \u7248\u672c\u90fd\u662f\u6b63\u5e38\u7684\u3002\u800c upstream/1.25.2 \u4f1a\u51fa\u9519\u3002\u8fdb\u4e00\u6b65\u4e8c\u5206\uff0c\u627e\u5230\u4fee\u590d\u7684 commit \u662f libfakeroot.c: add wrappers for new glibc 2.33+ symbols\uff0c\u76f8\u5173\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>+  int mknod(const char *pathname, mode_t mode, dev_t dev) {\n+     return WRAP_MKNOD MKNOD_ARG(_STAT_VER, pathname, mode, &amp;dev);\n+  }\n+\n+  #if defined(HAVE_FSTATAT) &amp;&amp; defined(HAVE_MKNODAT)\n+    int mknodat(int dir_fd, const char *pathname, mode_t mode, dev_t dev) {\n+       return WRAP_MKNODAT MKNODAT_ARG(_STAT_VER, dir_fd, pathname, mode, &amp;dev);\n+    }\n+  #endif\n+#endif /* GLIBC_PREREQ */\n</code></pre> <p>\u8fd9\u8bf4\u660e\u5728\u8fd9\u4e2a\u4fee\u590d\u4e4b\u524d\uff0c\u4e0d\u80fd\u6b63\u786e\u5730\u62e6\u622a mknod \u7684\u8c03\u7528\u3002\u6240\u4ee5 glibc 2.33+ \u8981\u914d\u5408 fakeroot 1.26+ \u7248\u672c\u624d\u53ef\u4ee5\u6b63\u786e\u5730\u8fd0\u884c fakeroot\u3002</p> <p>\u7ed3\u8bba\uff1a\u627e\u4e2a\u65f6\u95f4\u7528\u65b0\u7248\u7684 Buildroot \u91cd\u65b0\u6784\u5efa\u4e00\u4efd\u3002</p>","tags":["linux","fakeroot","mknod"]},{"location":"software/2018/10/04/bypass-gpgmail-activation/","title":"\u7ed5\u8fc7 GPGMail \u7684\u6fc0\u6d3b\u68c0\u6d4b","text":"<p>\u524d\u6bb5\u65f6\u95f4 GPGMail \u5ba3\u5e03\u4e0d\u518d\u514d\u8d39\uff0c\u5728\u4e09\u5341\u5929\u7684\u8bd5\u7528\u671f\u540e\u5c31\u4e0d\u7ed9\u7528\u4e86\u3002\u5509\uff0c\u53ef\u80fd\u662f\u5b98\u65b9\u5b9e\u5728\u6ca1\u94b1\u7ef4\u62a4\u4e86\uff0c\u4e5f\u53ef\u80fd\u662f\u5b98\u65b9\u60f3\u8d5a\u94b1\u4e86\u3002\u4e0d\u8fc7\uff0c\u65e2\u7136 GPGMail \u91c7\u7528\u7684\u662f\u81ea\u7531\u7684\u8bb8\u53ef\u8bc1\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5bf9\u4ee3\u7801\u8fdb\u884c\u66f4\u6539\u3002\u548c\u8bb8\u53ef\u8bc1\u9a8c\u8bc1\u76f8\u5173\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>- (BOOL)hasActiveContract {\n    NSDictionary *contractInformation = [self contractInformation];\n    return [contractInformation[@\"Active\"] boolValue];\n}\n</code></pre> <p>\u6211\u4eec\u53ea\u8981\u6539\u6210 <code>return TRUE</code> \uff0c\u5728\u81ea\u5df1\u7684\u7535\u8111\u4e0a\u624b\u52a8\u7f16\u8bd1\u3001\u5e76\u590d\u5236\u5230 <code>/Library/Application Support/GPGTools/GPGMail</code> \u4e0b\u5373\u53ef\u3002</p> <p>\u53e6\uff1a\u8fd8\u6709\u4e00\u4e2a\u76f4\u63a5\u5bf9\u4e8c\u8fdb\u5236\u6253 patch \u7684\u65b9\u6cd5\uff08\u4ecd\u7136\u7b26\u5408\u8bb8\u53ef\u8bc1\uff09\uff0c\u5229\u7528\u4e86\u6700\u8fd1\u6253 CTF \u5b66\u5230\u7684\u4e00\u4e9b\u77e5\u8bc6\u3002\u627e\u5230\u4ee5\u4e0a\u8fd9\u4e2a\u51fd\u6570\uff0c\u7136\u540e\u628a\u8fd4\u56de\u503c\u4fee\u6539\u6210\u975e\u96f6\u5373\u53ef\u3002\u8fd9\u91cc\u5c31\u4e0d\u63d0\u4f9b\u65b9\u6cd5\u4e86\u3002\u6700\u540e\u7684\u66f4\u6539\uff1a</p> <pre><code>$ radiff2 -D\n--- 0x0000282f  410fbec7\n- movsx eax, r15b\n+++ 0x0000282f  4c89e090\n+ mov rax, r12\n+ nop\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c\u8fd8\u9700\u8981\u989d\u5916 <code>codesign --remove-signature</code> \u4e00\u4e0b\u3002</p> <p>\u8c28\u614e\u5bf9\u975e\u81ea\u7531\u8f6f\u4ef6\u91c7\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002\u53ef\u80fd\u6709\u6cd5\u5f8b\u98ce\u9669\u3002</p>","tags":["gpg","gpgmail","macos","radare2"]},{"location":"software/2024/01/25/chromium-build-port/","title":"Chromium \u6784\u5efa\u4e0e\u79fb\u690d","text":"","tags":["linux","loongarch","chromium","port"]},{"location":"software/2024/01/25/chromium-build-port/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>Google Chrome \u4e5f\u7528\u4e86\u5f88\u957f\u65f6\u95f4\u4e86\uff0c\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u5c1d\u8bd5\u8fc7\u6784\u5efa Chromium\uff0c\u8fd9\u6b21\u8d81\u7740\u5f80 LoongArch \u79fb\u690d Chromium \u7684\u673a\u4f1a\uff0c\u5b66\u4e60\u4e86\u4e00\u4e0b Chromium \u7684\u6784\u5efa\u3002</p>","tags":["linux","loongarch","chromium","port"]},{"location":"software/2024/01/25/chromium-build-port/#\u514b\u9686\u4ee3\u7801","title":"\u514b\u9686\u4ee3\u7801","text":"<p>Chromium \u5b98\u65b9\u7684\u6784\u5efa\u6587\u6863\u94fe\u63a5\u662f Checking out and building Chromium on Linux\uff0c\u6309\u7167\u6d41\u7a0b\u505a\u5c31\u53ef\u4ee5\uff1a</p> <pre><code>cd build-chromium\n\n# setup depot_tools\ngit clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n# fish syntax to add depot_tools to PATH\nset -x PATH $PWD/depot_tools $PATH\n\n# clone chromium using fetch from depot_tools\nmkdir chromium\ncd chromium\nfetch --nohooks chromium\n# or\nfetch --nohooks --no-history chromium\n\n# setup build dependencies\ncd src\n./build/install-build-deps.sh\ngclient runhooks\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u662f\u4e3a\u4e86\u5f00\u53d1 chromium \u505a\u7684\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u505a\u4e00\u4e9b\u7b80\u5316\uff1a\u5982\u679c\u53ea\u662f\u8981\u7f16\u8bd1\u4e00\u4e2a\u5df2\u7ecf\u53d1\u5e03\u6b63\u5f0f\u7248\u7684 chromium\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d tarball\uff0c\u4f8b\u5982 https://commondatastorage.googleapis.com/chromium-browser-official/chromium-120.0.6099.216.tar.xz\uff0c\u628a\u94fe\u63a5\u91cc\u7684\u7248\u672c\u53f7\u6539\u6389\u5373\u53ef\uff1b\u8fd9\u6837\u53ef\u4ee5\u7701\u53bb\u514b\u9686 git repo \u4ee5\u53ca\u4e00\u5806 submodule \u7684\u5927\u91cf\u65f6\u95f4\u3002\u5f53\u7136\u4e86\uff0c\u89e3\u538b\u672c\u8eab\u4e5f\u9700\u8981\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\uff0c\u5bf9\u4ed8\u8fd9\u79cd\u5927\u578b\u8f6f\u4ef6\u5fc5\u987b\u8981\u6709\u8010\u5fc3\u3002\u540c\u7406\uff0cdepot_tools \u4e5f\u53ef\u4ee5\u4e0d\u8981\uff0c\u6bd5\u7adf\u81ea\u5df1\u628a\u4ee3\u7801\u4e0b\u8f7d\u4e0b\u6765\u4e86\uff0c\u53ea\u9700\u8981\u518d\u88c5\u4e00\u4e2a gn\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u5269\u4e0b\u7684\u6784\u5efa\u3002</p>","tags":["linux","loongarch","chromium","port"]},{"location":"software/2024/01/25/chromium-build-port/#\u6784\u5efa","title":"\u6784\u5efa","text":"<p>\u6309\u7167\u9ed8\u8ba4\u914d\u7f6e\u6784\u5efa\uff0c\u53ea\u9700\u8981\uff1a</p> <pre><code>gn gen out/Default\n</code></pre> <p>\u610f\u601d\u662f\u7528 <code>gn</code> \u5de5\u5177\u751f\u6210\u4e00\u5957\u7528 Ninja \u6784\u5efa\u7684\u914d\u7f6e\uff0c\u76ee\u5f55\u5728 <code>out/Default</code> \u4e0b\u9762\uff0c\u7136\u540e\u4e0d\u6dfb\u52a0\u989d\u5916\u7684\u8bbe\u7f6e\u3002\u8981\u6784\u5efa Chromium\uff0c\u90a3\u5c31\u5728\u91cc\u9762\u8dd1 ninja\uff1a</p> <pre><code>ninja -C out/Default chrome\n# or\nautoninja -C out/Default chrome\n</code></pre> <p>\u4f46\u662f\u5982\u679c\u4f60\u53bb\u7ffb\u5404\u4e2a Linux \u53d1\u884c\u7248\uff0c\u5c31\u4f1a\u53d1\u73b0\u5b83\u4eec\u90fd\u4f1a\u4f20\u5f88\u591a\u7684\u53c2\u6570\u7ed9 gn\uff0c\u5b9e\u73b0\u5404\u79cd\u76ee\u7684\uff1a</p> <pre><code>gn gen out/Default --args='...'\n</code></pre> <p>\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e9b\u94fe\u63a5\uff1a</p> <ul> <li>AOSC OS</li> <li>Arch Linux</li> <li>Debian</li> <li>Fedora</li> </ul> <p>\u8fd9\u91cc\u7684\u95e8\u95e8\u9053\u9053\u5c31\u5f88\u591a\u4e86\uff0c\u5f88\u591a\u7f16\u8bd1\u53c2\u6570\u5f71\u54cd\u4e86\u6700\u7ec8 Chromium \u7684\u529f\u80fd\u3001\u6027\u80fd\u7b49\u7b49\u91cd\u8981\u7684\u6307\u6807\u3002</p> <p>\u9996\u5148\u662f\u5de5\u5177\u94fe\u7684\u9009\u62e9\uff1aChromium \u5f00\u53d1\u7684\u65f6\u5019\u7528\u7684\u662f\u5f88\u65b0\u7684 Clang\uff0c\u8fd8\u81ea\u5e26\u4e86\u4e00\u4efd libc++\uff0c\u4f46\u662f\u5f88\u81ea\u7136\u5730\u5404\u5927\u53d1\u884c\u7248\u90fd\u4f1a\u503e\u5411\u4e8e\u7528\u81ea\u5df1\u7684\u5de5\u5177\u94fe\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5de5\u5177\u94fe\u53ef\u80fd\u662f\u7a0d\u5fae\u65e7\u4e00\u4e9b\u7684 Clang\uff0c\u6216\u8005\u662f GCC\uff0c\u8fd9\u91cc\u5c31\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u95ee\u9898\uff1aChromium \u5f00\u53d1\u7684\u65f6\u5019\u662f\u4e0d\u5728\u65e7 Clang \u6216\u8005 GCC \u4e0a\u6d4b\u8bd5\u7684\uff0c\u6240\u4ee5\u5404\u4e2a\u53d1\u884c\u7248\u90fd\u8981\u7ef4\u62a4\u4e00\u5806\u7684 patch\uff0c\u4f7f\u5f97\u7528\u7a0d\u5fae\u65e7\u4e00\u70b9\u7684\u6b63\u5f0f\u7248 Clang/GCC \u4e5f\u53ef\u4ee5\u6784\u5efa Chromium\u3002\u8fd9\u4e9b patch \u53ef\u4ee5\u5728\u4e0a\u9762\u7684\u94fe\u63a5\u4e2d\u627e\u5230\u3002</p> <p>\u9664\u4e86\u7f16\u8bd1\u5668\u4ee5\u5916\uff0c\u8fd8\u6709\u5f88\u591a\u4f9d\u8d56\u4e5f\u53ef\u4ee5\u9009\u62e9\u7528 chromium \u81ea\u5e26\u7684\u7248\u672c\uff0c\u8fd8\u662f\u7cfb\u7edf\u81ea\u5e26\u7684\u7248\u672c\uff0c\u8fd9\u91cc\u4e5f\u6709\u5f88\u591a\u53ef\u80fd\u6027\u3002\u4f8b\u5982\u8981\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 Clang\uff1a</p> <pre><code>host_toolchain=\"//build/toolchain/linux/unbundle:default\"\ncustom_toolchain=\"//build/toolchain/linux/unbundle:default\"\nclang_base_path=\"/usr\" \nclang_use_chrome_plugins=false\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u7528 GCC\uff0c\u4f46\u662f\u9700\u8981\u6253\u4e0d\u5c11\u7684 patch\uff1a</p> <pre><code>CC=gcc CXX=g++ AR=ar NM=nm gn gen out/Default --args='is_clang=false ...'\n</code></pre> <p>\u7b49\u7b49\uff0c\u8fd8\u6709\u5f88\u591a\u53ef\u80fd\u7684\u914d\u7f6e\u9009\u9879\uff0c\u8fd9\u4e9b\u53ef\u4ee5\u5728 Chromium \u7684\u6e90\u7801\u4e2d\u627e\u5230\uff1a\u5b83\u4eec\u4f1a\u7528 gn \u7684\u914d\u7f6e\u8bed\u8a00\u7f16\u5199\uff0c\u653e\u5728 <code>declare_args</code> \u91cc\u9762\u3002</p>","tags":["linux","loongarch","chromium","port"]},{"location":"software/2024/01/25/chromium-build-port/#\u79fb\u690d","title":"\u79fb\u690d","text":"<p>\u9664\u4e86\u5728 amd64 \u6784\u5efa\u4ee5\u5916\uff0cChromium \u4e3b\u8981\u8fd8\u652f\u6301 arm64 \u67b6\u6784\uff0c\u5176\u4ed6\u67b6\u6784\u5c5e\u4e8e\u6709\u7b2c\u4e09\u65b9 patch\uff0c\u4f46\u662f Chromium \u5904\u4e8e\u4e00\u4e2a\u4ed8\u51fa\u989d\u5916\u7ef4\u62a4\u8d1f\u62c5\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u5176\u4ed6\u67b6\u6784\u7684\u8865\u4e01\u5c31\u6ca1\u6709\u5408\u5e76\uff0c\u56e0\u6b64\u4f60\u4f1a\u53d1\u73b0 riscv64 \u548c ppc64le \u67b6\u6784\u4e0a\u80fd\u627e\u5230\u4e00\u4e9b\u53d1\u884c\u7248\u81ea\u5df1\u7ef4\u62a4\u7684 patch\uff0c\u5e76\u4e14\u6ca1\u6709\u5408\u5e76\u5230\u4e0a\u6e38\u3002loongarch64 \u7684\u5904\u5883\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u9f99\u82af\u4e4b\u524d\u505a\u8fc7\u4e00\u4e9b\u79fb\u690d\uff0c\u5c1d\u8bd5\u63d0\u4ea4\u4e0a\u6e38\uff0c\u4f46\u662f\u6700\u540e\u6ca1\u6709\u5408\u5e76\u8fdb\u53bb\u3002</p> <p>\u4f46\u662f Chromium \u5bf9\u4e8e\u684c\u9762\u6765\u8bf4\u53c8\u662f\u6bd4\u8f83\u91cd\u8981\u7684\uff0c\u65e0\u8bba\u662f\u4f5c\u4e3a\u6d4f\u89c8\u5668\uff0c\u8fd8\u662f\u7528\u5728 Electron \u6216\u8005 QT \u751f\u6001\u4e2d\u3002\u56e0\u6b64\u501f\u7740\u9f99\u82af\u628a\u79fb\u690d Electron \u7684 patch \u653e\u51fa\u6765\u7684\u673a\u4f1a\uff0c\u987a\u4fbf\u628a Chromium \u7684\u79fb\u690d\u505a\u4e86\uff1a\u6700\u65e9\u662f @prcups \u628a\u8865\u4e01\u79fb\u690d\u5230 qt6-webengine \u4e0a\uff0c\u8bc1\u5b9e\u4e86\u8865\u4e01\u7684\u53ef\u7528\u6027\uff1b\u4e4b\u540e\u6211\u53c8\u79fb\u690d\u5230\u4e86\u6700\u65b0\u7248\u7684 Chromium \u4e0a\uff0c\u8865\u4e01\u53d1\u5e03\u5728 AOSC-Dev/chromium-loongarch64\u3002\u76ee\u524d 120 \u5df2\u7ecf\u9002\u914d\u4e86\uff0c\u4f46\u662f\u8fd9\u51e0\u5929 121 \u53c8\u53d1\u5e03\u4e86\uff0c\u9700\u8981\u518d\u6b21\u66f4\u65b0\u8865\u4e01\u3002\u65b0\u7248 Electron \u7684\u8865\u4e01\u4e5f\u8fd8\u6ca1\u6709\u505a\u3002</p> <p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53d1\u73b0\u9f99\u82af\u539f\u6765\u7684 patch \u5185\u7f6e\u7684 bug\uff1a\u4e0e seccomp sandbox \u6709\u5173\uff0c\u539f\u6765\u7684\u4ee3\u7801\u628a\u5bf9 stat \u7684\u5904\u7406\u7167\u6284\u5230\u4e86 statx \u4e0a\uff0c\u4f46\u662f\u5b83\u7684\u53c2\u6570\u987a\u5e8f\u548c\u542b\u4e49\u90fd\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4e0d\u80fd\u76f4\u63a5\u7167\u6284\u3002\u5bf9\u7740\u4ee3\u7801\uff0c\u5927\u6982\u662f\u6b63\u786e\u5730\u5b9e\u73b0\u4e86\u51fa\u6765\u3002\u4e4b\u524d\u6ca1\u6709\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u5927\u6982\u7387\u662f Electron \u4e0b\u4e0d\u4f1a\u7528\u5230\u8fd9\u4e2a sandbox\u3002\u56de\u987e\u4e0b\u6765\uff0c\u79fb\u690d\u7684\u8865\u4e01\u4e0d\u7b97\u591a\uff0c\u4e3b\u8981\u662f crashpad \u548c sandbox \u4e24\u90e8\u5206\u4ee3\u7801\uff0c\u89c2\u5bdf\u4e86\u4e00\u4e0b archriscv \u7ef4\u62a4\u7684 riscv \u8865\u4e01\uff0c\u5176\u5b9e\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u9047\u5230\u4e86\u5f88\u591a\u56f0\u96be\uff1a\u4e00\u5f00\u59cb Clang \u6784\u5efa\u9047\u5230\u95ee\u9898\uff0c\u4e8e\u662f\u6539\u7528 GCC\uff0c\u4f46\u662f\u524d\u9762\u4e5f\u8bf4\u4e86\uff0cChromium \u6ca1\u6709\u7528 GCC \u6d4b\u8bd5\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u5f88\u591a\u95ee\u9898\uff0c\u9700\u8981\u7ec6\u5fc3\u5730\u4fee\u590d\uff1b\u6700\u540e\u7ec8\u4e8e\u641e\u597d\u4e86\u4ee5\u540e\uff0c\u518d\u56de\u5230 Clang\uff0c\u53d1\u73b0 Clang \u7684\u95ee\u9898\u5df2\u7ecf\u88ab Fedora/Debian \u7b49\u53d1\u884c\u7248\u89e3\u51b3\uff0c\u53ea\u9700\u8981\u5bfc\u5165\u5df2\u6709\u7684\u8865\u4e01\u5373\u53ef\u3002\u8fd9\u6837\u6298\u817e\u4e0b\u6765\uff0c\u7ec8\u4e8e\u662f\u641e\u5b9a\u4e86\u3002\u800c\u76ee\u524d\u9f99\u82af\u7684\u6784\u5efa\u673a\u5668\uff083C5000\uff09\u6027\u80fd\u8fd8\u662f\u4e0d\u591f\u597d\uff0c\u6784\u5efa\u4e00\u6b21\u5b8c\u6574\u7684 Chromium \u9700\u8981\u4e5d\u4e2a\u5c0f\u65f6\uff0c\u672a\u6765\u7b49\u9f99\u82af\u670d\u52a1\u5668\u6027\u80fd\u63d0\u5347\u4ee5\u540e\uff0c\u53ef\u4ee5\u9884\u89c1\u5230\u7ef4\u62a4\u6210\u672c\u7684\u964d\u4f4e\u3002</p>","tags":["linux","loongarch","chromium","port"]},{"location":"software/2023/10/17/clang-cuda-support/","title":"Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f","text":"","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u7f16\u8bd1 CUDA \u7a0b\u5e8f\u7684\u4e3b\u8981\u5de5\u5177\u662f NVIDIA \u63d0\u4f9b\u7684\u95ed\u6e90\u7f16\u8bd1\u5668 NVCC\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0cNVCC \u662f\u57fa\u4e8e LLVM \u5f00\u53d1\u7684\uff08\u6765\u6e90\uff1aNVIDIA CUDA Compiler\uff09\uff0cNVIDIA \u4e5f\u628a NVCC \u5176\u4e2d\u4e00\u90e8\u5206\u903b\u8f91\u8d21\u732e\u7ed9\u4e86 LLVM \u4e0a\u6e38\uff0c\u4f7f\u5f97 Clang \u4e5f\u53ef\u4ee5\u5728 CUDA \u7684\u914d\u5408\u4e0b\u7f16\u8bd1 CUDA \u7a0b\u5e8f\u3002\u8fd9\u7bc7\u535a\u5ba2\u5c1d\u8bd5\u7814\u7a76 Clang/LLVM \u5982\u4f55\u5b9e\u73b0 CUDA \u7a0b\u5e8f\u7684\u7f16\u8bd1\uff0c\u4e3b\u8981\u662f Clang \u524d\u7aef\u90e8\u5206\uff0c\u540e\u7aef\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u4ece LLVM IR \u5230 NVPTX \u7684\u8fd9\u4e00\u6b65\u8fd8\u6ca1\u6709\u8fdb\u884c\u6df1\u5165\u7684\u7814\u7a76\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#\u7f16\u8bd1\u547d\u4ee4","title":"\u7f16\u8bd1\u547d\u4ee4","text":"<p>\u9996\u5148\u6309\u7167 Compiling CUDA with clang \u6587\u6863\uff0c\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528 clang \u7f16\u8bd1 CUDA \u7a0b\u5e8f\u7684\u547d\u4ee4\uff1a</p> <pre><code>clang++ axpy.cu -o axpy -L&lt;CUDA install path&gt;/&lt;lib64 or lib&gt; -lcudart/cudart_static [--cuda-gpu-arch=&lt;GPU arch&gt;]\n</code></pre> <p>\u5176\u4e2d <code>-L&lt;CUDA install path&gt;/&lt;lib64 or lib&gt; -lcudart/cudart_static</code> \u8868\u793a\u7684\u662f\u94fe\u63a5 CUDA \u63d0\u4f9b\u7684 libcudart\uff0c\u5b83\u6709\u9759\u6001\u5e93\u548c\u52a8\u6001\u5e93\u4e24\u79cd\u5f62\u5f0f\uff0c\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9\u3002<code>--cuda-gpu-arch=&lt;GPU arch&gt;</code> \u5c31\u548c NVCC \u4e00\u6837\uff0c\u6307\u5b9a GPU \u7684 SM Architecture \u7248\u672c\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a\u3002\u5982\u679c CUDA \u5b89\u88c5\u5230 <code>/usr/local/cuda</code>\uff0c\u4e00\u4e2a\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>clang++ axpy.cu -o axpy -L /usr/local/cuda/lib64 -lcudart\n</code></pre> <p>\u7f16\u8bd1\u51fa\u6765\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u5c31\u548c NVCC \u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u9700\u8981\u624b\u52a8\u94fe\u63a5 libcudart\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#\u7f16\u8bd1\u6d41\u7a0b","title":"\u7f16\u8bd1\u6d41\u7a0b","text":"<p>\u4e3a\u4e86\u67e5\u770b clang \u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u547d\u4ee4\u4e2d\uff0c\u6dfb\u52a0 <code>-v</code> \u9009\u9879\u8ba9\u5b83\u6253\u5370\u51fa\u4e2d\u95f4\u6267\u884c\u7684\u547d\u4ee4\uff0c\u518d\u6dfb\u52a0 <code>--save-temps</code> \u547d\u4ee4\u53ef\u4ee5\u628a\u4e2d\u9014\u7684\u7f16\u8bd1\u4ea7\u7269\u4fdd\u7559\u5728\u5f53\u524d\u8def\u5f84\u4e0b\u3002\u89c2\u5bdf\u8f93\u51fa\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u8fdb\u884c\u4e86\u5982\u4e0b\u64cd\u4f5c\uff08\u7701\u7565\u4e86\u5927\u91cf\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff09\uff1a</p> <ol> <li><code>clang -triple nvptx64-nvidia-cuda -S -target-cpu sm_70 axpy.cu -o axpy-sm_70.s</code>\uff1a\u4ee5 NVPTX \u4e3a target\uff0c\u7f16\u8bd1\u6e90\u4ee3\u7801\uff0c\u751f\u6210 PTX \u6c47\u7f16</li> <li><code>ptxas --gpu-name sm_70 --output-file axpy-sm_70.o axpy-sm_70.s</code>\uff1a\u4f7f\u7528 CUDA \u63d0\u4f9b\u7684 <code>ptxas</code> \u7a0b\u5e8f\uff0c\u628a PTX \u6c47\u7f16\u7ffb\u8bd1\u6210 SM 70 \u7684 SASS \u6307\u4ee4\uff0c\u6253\u5305\u5230\u4e00\u4e2a ELF object \u4e2d</li> <li><code>fatbinary --create axpy.fatbin --image=profile=sm_70,file=axpy-sm_70.o --image=profile=compute_70,file=axpy-sm_70.s</code>: \u4f7f\u7528 CUDA \u63d0\u4f9b\u7684 <code>fatbinary</code> \u7a0b\u5e8f\uff0c\u628a ptxas \u751f\u6210\u7684 ELF object \u548c clang \u751f\u6210\u7684 PTX \u6c47\u7f16\u5185\u5bb9\u6253\u5305\u6210\u4e00\u4e2a fatbin \u6587\u4ef6</li> <li><code>clang -triple x86_64-pc-linux-gnu -emit-obj axpy.cu -fcuda-include-gpubinary axpy.fatbin -o axpy.o</code>\uff1a\u7f16\u8bd1 Host \u4ee3\u7801\uff0c\u628a fatbin \u7684\u5185\u5bb9\u5d4c\u5165\u5230\u4e00\u4e2a <code>.nv_fatbin</code> section \u4e2d\uff0c\u751f\u6210\u4e00\u4e2a ELF object \u4e2d</li> <li><code>ld -o axpy axpy.o -lcudart</code>\uff1a\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5e38\u89c4\u7684\u94fe\u63a5\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6</li> </ol> <p>\u5b9e\u9645\u4e0a\u8fd8\u6709\u4e00\u6b65\u9884\u5904\u7406\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\u3002\u5bf9\u6bd4\u901a\u5e38 C++ \u7a0b\u5e8f\u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u8fd9\u91cc\u4e0d\u540c\u7684\u70b9\u5728\u4e8e\uff1a</p> <ol> <li>\u7528 Clang \u4ee5 NVPTX target \u7f16\u8bd1\u4e86\u4e00\u904d\uff0c\u5f97\u5230 PTX \u6c47\u7f16</li> <li>\u7528 CUDA \u7684 ptxas\uff0c\u628a PTX \u6c47\u7f16\u7ffb\u8bd1\u6210\u5bf9\u5e94 SM Architecture \u7684 SASS \u6307\u4ee4\uff0c\u653e\u5230\u4e00\u4e2a ELF object \u91cc</li> <li>\u7528 CUDA \u7684 fatbinary\uff0c\u628a\u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u7684\u7ed3\u679c\u653e\u5230\u4e00\u4e2a fatbin \u6587\u4ef6\u91cc</li> <li>\u628a fatbin \u6587\u4ef6\u5d4c\u5165\u5230 ELF \u4e2d</li> </ol> <p>\u5176\u4e2d\u7b2c\u4e00\u6b65\u548c\u7b2c\u56db\u6b65\u662f\u7531 LLVM \u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u627e\u5230\u76f8\u5e94\u7684\u4ee3\u7801\uff1b\u7b2c\u4e8c\u6b65\u548c\u7b2c\u4e09\u6b65\u5219\u6ca1\u6709\u6e90\u7801\uff0c\u4f46\u662f\u7f51\u4e0a\u6709\u5f88\u591a\u516c\u5f00\u7684\u9006\u5411\uff0c\u4f8b\u5982 Decoding CUDA binary\u3001decodecudabinary/Decoding-CUDA-Binary \u548c n-eiling/cuda-fatbin-decompression\u3002</p> <p>\u6b64\u5916\uff0cClang \u8fd8\u9700\u8981\u9488\u5bf9 Host \u90e8\u5206\u4ee3\u7801\uff0c\u8fdb\u884c\u7279\u6b8a\u5904\u7406\uff0c\u56e0\u4e3a CUDA \u6709\u4e00\u4e9b\u6269\u5c55\u8bed\u6cd5\uff08\u4e3b\u8981\u662f\u542f\u52a8 Kernel \u7684 <code>&lt;&lt;&lt;&gt;&gt;&gt;</code>\uff09\uff0c\u9700\u8981\u628a\u8fd9\u4e9b\u90e8\u5206\u66ff\u6362\u4e3a\u5bf9 CUDA Runtime\uff08\u4e5f\u5c31\u662f libcudart\uff09\u7684\u8c03\u7528\u3002\u63a5\u4e0b\u6765\u8981\u8ba8\u8bba\u7684\u5c31\u662f\u8fd9\u4e00\u90e8\u5206\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#host-\u4ee3\u7801","title":"Host \u4ee3\u7801","text":"<p>\u9996\u5148\u7814\u7a76\u7684\u662f CUDA \u7684\u6269\u5c55\u8bed\u6cd5\u91cc\u7684\u542f\u52a8 Kernel \u8bed\u6cd5\uff1a</p> <pre><code>axpy&lt;&lt;&lt;1, kDataLen&gt;&gt;&gt;(kDataLen, a, device_x, device_y);\n</code></pre> <p>\u5b9e\u9645\u4e0a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5462\uff1f\u5982\u679c\u53bb\u67e5\u770b LLVM IR\uff0c\u4f1a\u53d1\u73b0\u5b83\u7684\u903b\u8f91\u7c7b\u4f3c\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>success = __cudaPushCallConfiguration(1, kDataLen);\nif (success) {\n    __device_stub__axpy(kDataLen, a, device_x, device_y);\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u751f\u6210\u903b\u8f91\u5728 EmitCUDAKernelCallExpr \u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u6784\u9020\u4e86\u4e24\u4e2a\u57fa\u672c\u5757\uff0c\u5bf9\u5e94 success \u5185\u7684 device stub \u8c03\u7528\uff08ConfigOKBlock\uff09\u548c\u5b8c\u6210\u8c03\u7528\u7684\u57fa\u672c\u5757\uff08ContBlock\uff09\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u9996\u5148\u628a <code>&lt;&lt;&lt;</code> \u548c <code>&gt;&gt;&gt;</code> \u4e4b\u95f4\u7684\u53c2\u6570\u4f20\u7ed9\u4e86 <code>__cudaPushCallConfiguration</code>\uff08\u5b9e\u9645\u4e0a\u662f\u6784\u9020\u4e86\u4e00\u4e2a <code>dim3</code> \u518d\u4f20\u8fdb\u53bb\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\uff09\uff0c\u5982\u679c\u5b83\u6210\u529f\u4e86\uff0c\u518d\u53bb\u8c03\u7528\u4e00\u4e2a <code>__device_stub__axpy</code>\u3002\u53ef\u4ee5\u731c\u60f3\uff0c\u5b83\u4f1a\u5bf9\u53c2\u6570\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u4e0d\u7b26\u5408 CUDA \u7684\u8981\u6c42\uff0c\u90a3\u5c31\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u4e0d\u53bb\u542f\u52a8 Kernel\u3002\u5982\u679c\u914d\u7f6e\u6ca1\u95ee\u9898\uff0c\u5c31\u53bb\u8c03\u7528 <code>__device_stub__axpy</code>\u3002\u90a3\u4e48\u8fd9\u4e2a\u51fd\u6570\u662f\u4ec0\u4e48\u5462\uff1f\u5b83\u662f\u5728 Clang \u4ee3\u7801 \u91cc\u751f\u6210\u7684\uff1a</p> <pre><code>// CUDA 9.0+ uses new way to launch kernels. Parameters are packed in a local\n// array and kernels are launched using cudaLaunchKernel().\nvoid CGNVCUDARuntime::emitDeviceStubBodyNew(CodeGenFunction &amp;CGF,\n                                            FunctionArgList &amp;Args) {\n  // omitted\n\n  // Calculate amount of space we will need for all arguments.  If we have no\n  // args, allocate a single pointer so we still have a valid pointer to the\n  // argument array that we can pass to runtime, even if it will be unused.\n  // Store pointers to the arguments in a locally allocated launch_args.\n  // omitted\n\n  // Lookup cudaLaunchKernel/hipLaunchKernel function.\n  // cudaError_t cudaLaunchKernel(const void *func, dim3 gridDim, dim3 blockDim,\n  //                              void **args, size_t sharedMem,\n  //                              cudaStream_t stream);\n  auto LaunchKernelName = addPrefixToName(KernelLaunchAPI);\n  IdentifierInfo &amp;cudaLaunchKernelII =\n      CGM.getContext().Idents.get(LaunchKernelName);\n  FunctionDecl *cudaLaunchKernelFD = nullptr;\n\n  // Create temporary dim3 grid_dim, block_dim.\n  llvm::FunctionCallee cudaPopConfigFn = CGM.CreateRuntimeFunction(\n      llvm::FunctionType::get(IntTy,\n                              {/*gridDim=*/GridDim.getType(),\n                               /*blockDim=*/BlockDim.getType(),\n                               /*ShmemSize=*/ShmemSize.getType(),\n                               /*Stream=*/Stream.getType()},\n                              /*isVarArg=*/false),\n      addUnderscoredPrefixToName(\"PopCallConfiguration\"));\n\n  CGF.EmitRuntimeCallOrInvoke(cudaPopConfigFn,\n                              {GridDim.getPointer(), BlockDim.getPointer(),\n                               ShmemSize.getPointer(), Stream.getPointer()});\n\n  // Emit the call to cudaLaunch\n  llvm::Value *Kernel = CGF.Builder.CreatePointerCast(\n      KernelHandles[CGF.CurFn-&gt;getName()], VoidPtrTy);\n  CallArgList LaunchKernelArgs;\n  LaunchKernelArgs.add(RValue::get(Kernel),\n                       cudaLaunchKernelFD-&gt;getParamDecl(0)-&gt;getType());\n  LaunchKernelArgs.add(RValue::getAggregate(GridDim), Dim3Ty);\n  LaunchKernelArgs.add(RValue::getAggregate(BlockDim), Dim3Ty);\n  LaunchKernelArgs.add(RValue::get(KernelArgs.getPointer()),\n                       cudaLaunchKernelFD-&gt;getParamDecl(3)-&gt;getType());\n  LaunchKernelArgs.add(RValue::get(CGF.Builder.CreateLoad(ShmemSize)),\n                       cudaLaunchKernelFD-&gt;getParamDecl(4)-&gt;getType());\n  LaunchKernelArgs.add(RValue::get(CGF.Builder.CreateLoad(Stream)),\n                       cudaLaunchKernelFD-&gt;getParamDecl(5)-&gt;getType());\n  llvm::FunctionCallee cudaLaunchKernelFn =\n      CGM.CreateRuntimeFunction(FTy, LaunchKernelName);\n  CGF.EmitCall(FI, CGCallee::forDirect(cudaLaunchKernelFn), ReturnValueSlot(),\n               LaunchKernelArgs);\n}\n</code></pre> <p>\u4ee3\u7801\u6bd4\u8f83\u957f\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u5220\u51cf\uff0c\u5927\u6982\u7684\u903b\u8f91\u662f\uff1a\u628a device stub \u7684\u51fd\u6570\u53c2\u6570\u653e\u5230\u4e00\u4e2a\u6570\u7ec4\u91cc\uff0c\u7136\u540e\u901a\u8fc7\u8c03\u7528 <code>__cudaPopCallConfiguration</code> \u628a\u521a\u521a\u5728 <code>__cudaPushCallConfiguration</code> \u4f20\u5165\u7684\u542f\u52a8\u914d\u7f6e\u518d\u8bfb\u53d6\u51fa\u6765\uff0c\u518d\u8c03\u7528\u771f\u6b63\u542f\u52a8 CUDA Kernel \u7684\u51fd\u6570 <code>cudaLaunchKernel</code>\uff1a</p> <pre><code>__host__\u200bcudaError_t cudaLaunchKernel ( const void* func, dim3 gridDim, dim3 blockDim, void** args, size_t sharedMem, cudaStream_t stream )\n</code></pre> <p>\u5176\u4e2d <code>const void* func</code> \u6307\u5411\u4e86 device stub function \u672c\u8eab\uff0c<code>args</code> \u662f device stub \u628a\u81ea\u5df1\u7684\u53c2\u6570\u4fdd\u5b58\u4e0b\u6765\u653e\u5230\u6570\u7ec4\u4e2d\u7684\uff0c\u5176\u4f59\u7684\u53c2\u6570\u662f\u7ecf\u8fc7 <code>__cudaPushCallConfiguration</code> \u4fdd\u5b58\u53c8\u7528 <code>__cudaPopCallConfiguration</code> \u53d6\u51fa\u7684\u542f\u52a8\u914d\u7f6e\u3002</p> <p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u89c9\u5f97\u5f88\u5947\u602a\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f20 function \u672c\u8eab\u7684\u6307\u9488\uff0c\u6309\u7406\u8bf4\u8981\u542f\u52a8 GPU \u4e0a\u7684 CUDA Kernel\uff0c\u4e0d\u5e94\u8be5\u7ed9\u4e00\u4e2a CUDA Kernel \u7684\u6307\u9488\u5417\uff1fCUDA Runtime \u600e\u4e48\u80fd\u901a\u8fc7 device stub function \u7684\u6307\u9488\uff0c\u5224\u65ad\u5bf9\u5e94\u7684 CUDA Kernel \u662f\u54ea\u4e2a\u5462\uff1f\u4e0b\u9762\u6765\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#cuda-runtime-\u6ce8\u518c","title":"CUDA Runtime \u6ce8\u518c","text":"<p>\u9664\u4e86\u542f\u52a8 Kernel \u4ee5\u5916\uff0cClang \u8fd8\u751f\u6210\u4e86\u5f88\u591a\u4ee3\u7801\uff0c\u7528\u6765\u5411 CUDA Runtime \u6ce8\u518c\u4e00\u4e9b\u4fe1\u606f\u3002\u56de\u5fc6\u524d\u9762\u7684\u6d41\u7a0b\uff0cKernel \u7f16\u8bd1\u6210 PTX \u6c47\u7f16\u4ee5\u540e\uff0c\u5148\u662f\u7f16\u8bd1\u6210 SASS \u6307\u4ee4\u6253\u5305\u5728\u4e86 ELF \u91cc\uff0c\u540e\u6765 PTX \u548c ELF \u4e00\u8d77\u6253\u5305\u6210\u4e86\u4e00\u4e2a fatbin \u6587\u4ef6\uff0c\u6700\u540e\u5d4c\u5165\u5230\u53ef\u6267\u884c\u7a0b\u5e8f\u91cc\u9762\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u8fd8\u6ca1\u6709\u7528\u5230\u5b83\uff0c\u800c\u5982\u679c\u8981\u542f\u52a8 Kernel\uff0c\u80af\u5b9a\u9700\u8981\u8ba9 CUDA Runtime \u53bb\u89e3\u6790 fatbin\uff0c\u627e\u5230\u91cc\u9762\u7684 Kernel \u6307\u4ee4\uff0c\u653e\u5230 GPU \u4e0a\u53bb\u6267\u884c\u3002\u53e6\u5916\uff0c\u6839\u636e\u4e0a\u4e00\u8282\u5185\u5bb9\uff0cCUDA Runtime \u8fd8\u9700\u8981\u77e5\u9053 device stub function \u548c Kernel \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u624d\u80fd\u77e5\u9053 Launch \u54ea\u4efd Kernel \u6307\u4ee4\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u662f\u7531 Clang \u751f\u6210\u7684\u521d\u59cb\u5316\u4ee3\u7801\u5b8c\u6210\u7684\uff1a</p> <pre><code>/// Creates a global constructor function for the module:\n///\n/// For CUDA:\n/// \\code\n/// void __cuda_module_ctor() {\n///     Handle = __cudaRegisterFatBinary(GpuBinaryBlob);\n///     __cuda_register_globals(Handle);\n/// }\n/// \\endcode\n</code></pre> <p>Clang \u4f1a\u8d1f\u8d23\u751f\u6210\u4e00\u4e2a <code>__cuda_module_ctor</code> \u51fd\u6570\uff0c\u653e\u5230\u53ef\u6267\u884c\u7a0b\u5e8f\u91cc\u9762\uff0c\u5e76\u4e14\u628a\u5730\u5740\u6dfb\u52a0\u5230 <code>.init_array</code> \u4e2d\uff0c\u8fd9\u4e2a section \u91cc\u9762\u7684\u51fd\u6570\u5730\u5740\u4f1a\u88ab libc \u5728\u52a0\u8f7d\u7684\u65f6\u5019\u8c03\u7528\uff0c\u8fd9\u4e5f\u662f C++ \u91cc\u5168\u5c40\u7c7b\u53d8\u91cf\u81ea\u52a8\u8c03\u7528\u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\uff0c\u9996\u5148\u8c03\u7528 cudart \u7684 <code>__cudaRegisterFatBinary</code> \u51fd\u6570\uff0c\u628a fatbin \u5730\u5740\u4f20\u9012\u8fc7\u53bb\uff08\u6ce8\uff1a\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff09\uff0c\u8fd9\u6837 cudart \u5c31\u77e5\u9053\u4e86\u8fd9\u4e2a\u7a0b\u5e8f\u91cc\u6253\u5305\u7684 fatbin\uff0c\u4e5f\u5c31\u62ff\u5230\u4e86\u6240\u6709\u7684 PTX \u4ee3\u7801\u548c SASS \u6307\u4ee4\u3002\u63a5\u7740\u8fd8\u8c03\u7528\u4e86 <code>__cuda_register_globals</code>\uff0c\u8fd9\u4e5f\u662f Clang \u751f\u6210\u7684\uff1a</p> <pre><code>/// Creates a function that sets up state on the host side for CUDA objects that\n/// have a presence on both the host and device sides. Specifically, registers\n/// the host side of kernel functions and device global variables with the CUDA\n/// runtime.\n/// \\code\n/// void __cuda_register_globals(void** GpuBinaryHandle) {\n///    __cudaRegisterFunction(GpuBinaryHandle,Kernel0,...);\n///    ...\n///    __cudaRegisterFunction(GpuBinaryHandle,KernelM,...);\n///    __cudaRegisterVar(GpuBinaryHandle, GlobalVar0, ...);\n///    ...\n///    __cudaRegisterVar(GpuBinaryHandle, GlobalVarN, ...);\n/// }\n/// \\endcode\n</code></pre> <p>Clang \u4f1a\u626b\u63cf\u4ee3\u7801\u91cc\u7684 Kernel \u51fd\u6570\u548c\u9700\u8981\u548c GPU \u4e92\u64cd\u4f5c\u7684\u5168\u5c40\u53d8\u91cf\uff08\u7528\u4e8e <code>cudaMemcpyFromSymbol</code> \u7b49\u51fd\u6570\uff09\uff0c\u7136\u540e\u53bb\u8c03\u7528 cudart \u7684 <code>__cudaRegisterFunction</code> \u548c <code>__cudaRegisterVar</code> \u51fd\u6570\u3002\u4e5f\u5c31\u662f\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u5efa\u7acb\u4e86 device stub function \u5730\u5740\u548c Kernel \u7684\u6620\u5c04\u5173\u7cfb\uff1acudart \u7684 <code>cudaLaunchKernel</code> \u5b9e\u73b0\u91cc\u9762\uff0c\u53ef\u4ee5\u6839\u636e device stub function \u7684\u5730\u5740\uff0c\u53bb\u67e5\u8be2 Kernel \u7684\u7b26\u53f7\uff0c\u518d\u6839\u636e\u7b26\u53f7\u53bb\u627e\u5230\u5bf9\u5e94\u7684 PTX \u548c SASS \u6307\u4ee4\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2023/10/17/clang-cuda-support/#fatbin","title":"fatbin","text":"<p>\u5728\u524d\u9762\u63d0\u5230\u4e86 fatbin \u7684\u8fc7\u7a0b\uff0c\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\uff0c\u4fdd\u5b58\u4e86 PTX \u4ee3\u7801\u6216\u8005\u4f7f\u7528 ptxas \u7f16\u8bd1\u540e\u5f97\u5230\u7684 ELF \u6587\u4ef6\u3002\u5b83\u7684\u683c\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u53ef\u4ee5\u5728 n-eiling/cuda-fatbin-decompression \u548c fatbinary \u4e2d\u770b\u5230\u3002\u5b83\u7684\u7ed3\u6784\u5927\u4f53\u5982\u4e0b\uff1a</p> <ol> <li>\u5f00\u5934\u662f\u4e00\u4e2a fatbin \u5934\u90e8</li> <li>\u63a5\u4e0b\u6765\u662f\u82e5\u5e72\u4e2a entry:<ol> <li>\u6bcf\u4e2a entry \u6709\u4e00\u4e2a\u5934\u90e8</li> <li>\u6bcf\u4e2a entry \u6709\u4e00\u4e2a payload\uff0c\u91cc\u9762\u662f ELF \u6216\u8005 PTX\uff0c\u53ef\u9009\u538b\u7f29</li> </ol> </li> </ol> <p>\u5b83\u5728\u6bcf\u4e2a entry \u7684\u5934\u90e8\u91cc\u4f1a\u8bb0\u5f55\u4e00\u4e9b\u4fe1\u606f\uff0c\u4f8b\u5982 SM Architecture \u7b49\u7b49\uff0c\u65b9\u4fbf CUDA Runtime \u5feb\u901f\u5730\u5b9a\u4f4d\u5230\u8981\u53bb\u4f7f\u7528\u7684 ELF \u6216\u8005 PTX\uff0c\u514d\u5f97\u626b\u63cf\u5b8c\u6574\u7684 ELF \u6216\u8005 PTX \u5185\u5bb9\u3002\u8fd9\u6709\u70b9\u50cf .a\uff08archive\uff09\u6587\u4ef6\uff0c\u672c\u8eab\u662f\u4e00\u4e2a .o\uff08object\uff09\u6587\u4ef6\u7684\u5bb9\u5668\uff0c\u4f46\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7d22\u5f15\uff0c\u4ece\u7b26\u53f7\u5230 object \u6587\u4ef6\u7684\u6620\u5c04\u3002\u867d\u7136 fatbin \u6ca1\u6709\u505a\u6620\u5c04\uff0c\u4f46\u662f\u5b83\u6bcf\u4e2a entry \u5934\u90e8\u90fd\u8bb0\u5f55\u4e86 entry \u7684\u957f\u5ea6\uff0c\u89e3\u6790\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e0d\u5173\u5fc3\u7684 payload\u3002</p> <p>\u5982\u679c\u60f3\u770b fatbin \u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u7528 <code>cuobjdump</code> \u547d\u4ee4\u6765\u67e5\u770b\uff0c\u5b83\u53ef\u4ee5\u663e\u793a\u51fa\u6bcf\u4e2a entry \u5728\u5934\u90e8\u4e2d\u8bb0\u5f55\u7684\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u628a\u5185\u90e8\u7684 payload \u91ca\u653e\u51fa\u6765\u3002\u5982\u679c\u60f3\u751f\u6210 fatbin\uff0c\u53ef\u4ee5\u7528 <code>fatbinary</code> \u547d\u4ee4\uff0c\u5b83\u4f1a\u89e3\u6790 ELF \u548c PTX \u6587\u4ef6\uff0c\u63d0\u53d6\u4e00\u4e9b\u4fe1\u606f\uff0c\u653e\u5230 entry \u5934\u90e8\u4e2d\u3002</p> <p>fatbin \u8fd8\u91c7\u7528\u4e86\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684\u538b\u7f29\u7b97\u6cd5\uff1a\u5982\u679c\u51fa\u73b0\u4e86\u91cd\u590d\u7684\u90e8\u5206\uff0c\u628a\u91cd\u590d\u7684\u90e8\u5206\u66ff\u6362\u4e3a\u8ddd\u79bb\u4e0a\u4e00\u6b21\u91cd\u590d\u7684\u504f\u79fb\u548c\u91cd\u590d\u7684\u957f\u5ea6\uff0c\u90a3\u4e48\u89e3\u538b\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981 memcpy \u5373\u53ef\uff0c\u4e0d\u6d89\u53ca\u5230\u590d\u6742\u7684\u5b57\u5178\u64cd\u4f5c\uff0c\u89c1 decompress \u51fd\u6570\u3002</p>","tags":["clang","llvm","cuda","nvidia"]},{"location":"software/2021/02/09/common-symbols-linking/","title":"COMMON \u7b26\u53f7","text":"","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/common-symbols-linking/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5728\u7f16\u8bd1\u4e00\u4e2a\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u9047\u5230\u4e86 undefined symbol \u7684\u95ee\u9898\u3002\u5177\u4f53\u60c5\u51b5\u662f\u8fd9\u6837\u7684\uff1a</p> <ol> <li>\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u628a\u6240\u6709\u7684\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210 <code>.o</code>\uff0c\u518d\u4e00\u6b21\u6027\u94fe\u63a5\uff0c\u8fd9\u6837\u4e0d\u4f1a\u62a5\u9519</li> <li>\u540e\u6765\uff0c\u628a\u4e00\u4e9b\u4ee3\u7801\u7f16\u8bd1\u6210\u9759\u6001\u5e93\uff0c\u5373\u628a\u5176\u4e2d\u4e00\u90e8\u5206\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210 <code>.o</code> \u540e\uff0c\u7528 <code>ar</code> \u5408\u5e76\u5230\u4e00\u4e2a <code>.a</code> \u4e2d\uff0c\u518d\u548c\u5176\u4f59\u7684 <code>.o</code> \u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u8fd9\u65f6\u5019\u5c31\u62a5\u9519\u4e86\uff1a</li> </ol> <pre><code>Undefined symbols for architecture arm64:\n  \"_abcd\", referenced from:\n    ...\n</code></pre> <p>\u5982\u679c\u6362\u53f0\u673a\u5668\uff0c\u7f16\u8bd1\uff08\u4f7f\u7528\u7684\u662f gcc 10.2.0\uff09\u5c31\u6ca1\u6709\u95ee\u9898\u3002</p> <p>\u800c\u5982\u679c\u53bb\u627e\u8fd9\u4e2a\u7b26\u53f7\u5b58\u5728\u7684 <code>.o</code> \u91cc\uff0c\u662f\u53ef\u4ee5\u627e\u5230\u7684\uff1a</p> <pre><code>$ objdump -t /path/to/abcd.o\n0000000000000028         *COM*  00000008 _abcd\n</code></pre> <p>\u5728\u5408\u6210\u7684\u9759\u6001\u5e93 <code>.a</code> \u91cc\uff0c\u4e5f\u662f\u5b58\u5728\u7684\uff08\u4e00\u4e2a\u5b9a\u4e49 + \u82e5\u5e72\u4e2a\u5f15\u7528\uff09\uff1a</p> <pre><code>$ objdump -t /path/to/libabc.a | grep abcd\n0000000000000028         *COM*  00000008 _abcd\n0000000000000000         *UND* _abcd\n0000000000000000         *UND* _abcd\n0000000000000000         *UND* _abcd\n0000000000000000         *UND* _abcd\n0000000000000000         *UND* _abcd\n</code></pre> <p>\u4e8e\u662f\u89c9\u5f97\u5f88\u5947\u602a\uff0c\u5c31\u4e0a\u7f51\u641c\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86\u4e00\u7bc7 StackOverflow \u8bb2\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6848\u5f88\u7b80\u5355\uff0c\u5c31\u662f\uff1a</p> <p>\u7f16\u8bd1\u7684\u65f6\u5019\u6253\u5f00 <code>-fno-common</code> \u8bbe\u7f6e</p> <p>\u800c gcc 10 \u4e0d\u4f1a\u51fa\u9519\u7684\u539f\u56e0\u662f\uff0c\u5b83\u9ed8\u8ba4\u4ece <code>-fcommon</code> \u6539\u6210\u4e86 <code>-fno-common</code> \u3002</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/common-symbols-linking/#common-\u662f\u4ec0\u4e48","title":"COMMON \u662f\u4ec0\u4e48","text":"<p>\u8fd9\u65f6\u5019\uff0c\u80af\u5b9a\u4e0d\u6ee1\u8db3\u4e8e\u627e\u5230\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0c\u80af\u5b9a\u8fd8\u662f\u4f1a\u53bb\u627e\u80cc\u540e\u7684\u539f\u7406\u3002</p> <p>\u9996\u5148\uff0c\u641c\u7d22\u4e86\u4e00\u4e0b COMMON \u662f\u4ec0\u4e48\uff0c\u627e\u5230\u4e86 Investigating linking with COMMON symbols in ELF \u8fd9\u7bc7\u6587\u7ae0\u3002</p> <p>\u6587\u7ae0\u91cc\u8bb2\u4e86 COMMON \u662f\u505a\u4ec0\u4e48\u7684\uff1a</p> <p>Common symbols are a feature that allow a programmer to 'define' several variables of the same name in different source files.  This is in contrast with the more popular way of doing, where you define a variable once in a source file, and reference it everywhere else in other source files, using extern.  When common symbols are used, the linker will merge all symbols of the same name into a single memory location, the size of which is the largest type of the individual common symbol definitions.  For example, if fileA.c defines an uninitialized 32-bit integer myint, and fileB.c defines an 8-bit char myint, then in the final executable, references to myint from both files will point to the same memory location (common location), and the linker will reserve 32 bits for that location.</p> <p>\u6587\u7ae0\u91cc\u8fd8\u8bb2\u4e86\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u6cd5\uff1a\u4e00\u4e2a\u6ca1\u6709\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5728 <code>-fcommon</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u8bbe\u4e3a COMMON\uff1b\u5982\u679c\u6709\u521d\u59cb\u5316\uff0c\u5c31\u6309\u7167\u521d\u59cb\u5316\u7684\u503c\u9884\u5206\u914d\u5230 .bss \u6216\u8005 .data\u3002\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u5982\u679c\u6709\u591a\u4e2a\u540c\u540d\u7684 symbol\uff0c\u4f1a\u6709\u4e00\u4e2a\u89c4\u5219\u51b3\u5b9a\u6700\u540e\u7684 symbol \u653e\u5230\u54ea\u91cc\uff1b\u5982\u679c\u6709\u51b2\u7a81\u7684\u8bdd\uff0c\u5c31\u662f\u6211\u4eec\u719f\u6089\u7684 <code>multiple definition</code> \u9519\u8bef\u4e86\u3002</p> <p>\u4e3a\u5565\u4f1a\u6709\u8fd9\u79cd\u9700\u6c42\uff0c\u591a\u4e2a variable \u540c\u540d\uff0c\u4e0d\u4f1a\u51b2\u7a81\u800c\u4e14\u5171\u4eab\u5185\u5b58\uff1f\u53c8\u5728\u522b\u7684\u5730\u65b9\u770b\u5230\u8bf4\u6cd5\uff0cCOMMON \u662f\u7ed9 <code>ancient</code> \u4ee3\u7801\u4f7f\u7528\u7684\uff0c\u8fd8\u6709\u7684\u63d0\u5230\u4e86 FORTRAN\u3002\u4e8e\u662f\u53bb\u641c\u4e86\u4e00\u4e0b\uff0c\u679c\u7136\uff0cFORTRAN \u662f\u95ee\u9898\u7684\u5173\u952e</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/common-symbols-linking/#fortran-\u91cc\u9762\u7684-common","title":"FORTRAN \u91cc\u9762\u7684 COMMON","text":"<p>\u7528\u5173\u952e\u8bcd\u5f88\u5bb9\u6613\u53ef\u4ee5\u641c\u7d22\u5230\u8bb2 COMMON BLOCK in FORTRAN \u7684\u6587\u7ae0\uff0cFORTRAN \u91cc\u9762\u7684 COMMON \u662f\u4e00\u79cd\u901a\u8fc7\u5168\u5c40\u5b58\u50a8\u9690\u5f0f\u4f20\u9012\u53c2\u6570\u7684\u65b9\u6cd5\u3002\u62ff\u6587\u7ae0\u91cc\u7684\u4f8b\u5b50\uff1a</p> <pre><code>      PROGRAM MAIN\n      INTEGER A\n      REAL    F,R,X,Y\n      COMMON  R,A,F\n      A = -14\n      R = 99.9\n      F = 0.2\n      CALL SUB(X,Y)\n      END\n\n      SUBROUTINE SUB(P,Q)\n      INTEGER I\n      REAL    A,B,P,Q\n      COMMON  A,I,B\n      END\n</code></pre> <p>\u5728\u51fd\u6570 MAIN \u548c SUB \u4e2d\uff0c\u90fd\u6709 COMMON \u8bed\u53e5\uff0c\u800c COMMON \u540e\u9762\u7684\u53d8\u91cf\uff0c\u5c31\u662f\u5b58\u50a8\u5728\u4e00\u4e2a COMMON \u7684 symbol \u4e4b\u4e2d\uff0c\u6309\u7167\u987a\u5e8f\u6620\u5c04\u5230 symbol \u7684\u5185\u5b58\u5730\u5740\u3002\u5c1d\u8bd5\u7f16\u8bd1\u4e00\u4e0b\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u7136\u540e\u770b\u4e00\u4e0b symbol\uff1a</p> <pre><code>$ gfortran -g -c test.f -o test.o\n$ objdump -t test.o\n\ntest.o: file format Mach-O arm64\n\nSYMBOL TABLE:\n0000000000000078 g     F __TEXT,__text _main\n0000000000000000 g     F __TEXT,__text _sub_\n000000000000000c         *COM*  00000010 ___BLNK__\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a\u53eb\u505a <code>___BLNK__</code> \u7684 COMMON symbol\uff0c\u5927\u5c0f\u662f 16 \u5b57\u8282\u3002\u770b\u4e00\u4e0b\u4ee3\u7801\u4e2d\u662f\u5982\u4f55\u5f15\u7528\u7684\uff1a</p> <pre><code>$ objdump -S --reloc test.o\n\ntest.o: file format Mach-O arm64\n\nDisassembly of section __TEXT,__text:\n\n0000000000000018 _MAIN__:\n;         PROGRAM MAIN\n      18: fd 7b be a9                   stp x29, x30, [sp, #-32]!\n      1c: fd 03 00 91                   mov x29, sp\n;         A = -14\n      20: 00 00 00 90                   adrp    x0, #0\n        0000000000000020:  ARM64_RELOC_GOT_LOAD_PAGE21  ___BLNK__\n      24: 00 00 40 f9                   ldr x0, [x0]\n        0000000000000024:  ARM64_RELOC_GOT_LOAD_PAGEOFF12   ___BLNK__\n      28: a1 01 80 12                   mov w1, #-14\n      2c: 01 04 00 b9                   str w1, [x0, #4]\n;         R = 99.9\n      30: 00 00 00 90                   adrp    x0, #0\n        0000000000000030:  ARM64_RELOC_GOT_LOAD_PAGE21  ___BLNK__\n      34: 00 00 40 f9                   ldr x0, [x0]\n        0000000000000034:  ARM64_RELOC_GOT_LOAD_PAGEOFF12   ___BLNK__\n      38: a1 99 99 52                   mov w1, #52429\n      3c: e1 58 a8 72                   movk    w1, #17095, lsl #16\n      40: 20 00 27 1e                   fmov    s0, w1\n      44: 00 00 00 bd                   str s0, [x0]\n;         F = 0.2\n      48: 00 00 00 90                   adrp    x0, #0\n        0000000000000048:  ARM64_RELOC_GOT_LOAD_PAGE21  ___BLNK__\n      4c: 00 00 40 f9                   ldr x0, [x0]\n        000000000000004c:  ARM64_RELOC_GOT_LOAD_PAGEOFF12   ___BLNK__\n      50: a1 99 99 52                   mov w1, #52429\n      54: 81 c9 a7 72                   movk    w1, #15948, lsl #16\n      58: 20 00 27 1e                   fmov    s0, w1\n      5c: 00 08 00 bd                   str s0, [x0, #8]\n;         CALL SUB(X,Y)\n      60: e1 63 00 91                   add x1, sp, #24\n      64: e0 73 00 91                   add x0, sp, #28\n      68: 00 00 00 94                   bl  #0 &lt;_MAIN__+0x50&gt;\n        0000000000000068:  ARM64_RELOC_BRANCH26 _sub_\n;         END\n      6c: 1f 20 03 d5                   nop\n      70: fd 7b c2 a8                   ldp x29, x30, [sp], #32\n      74: c0 03 5f d6                   ret\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728 MAIN \u4e2d\u5f15\u7528 <code>A</code> \u7684\u65f6\u5019\uff0c\u53d6\u7684\u5730\u5740\u662f <code>___BLNK__+4</code>\uff0c<code>R</code> \u662f <code>___BLNK__+0</code>\uff0c<code>F</code> \u662f <code>___BLNK__+8</code>\u3002\u8fd9\u548c\u4ee3\u7801\u91cc\u7684\u987a\u5e8f\u4e5f\u662f\u4e00\u81f4\u7684\u3002\u6240\u4ee5\u5728 SUB \u4e2d\u8bfb A I B \u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u4e86 MAIN \u4e2d\u7684 A R F\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5728 MAIN \u51fd\u6570\u91cc\u9762\u9690\u5f0f\u5730\u7ed9\u6240\u6709\u51fd\u6570\u4f20\u9012\u53c2\u6570\u3002</p> <p>\u6b64\u5916\uff0cCOMMON \u8fd8\u53ef\u4ee5\u547d\u540d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u533a\u5206\u4e0d\u540c\u7684\u53c2\u6570\u7528\u9014\uff1a</p> <pre><code>        PROGRAM MAIN\n        INTEGER A\n        REAL    F,R,X,Y\n        COMMON  R,A,F\n        COMMON /test/ X,Y\n        A = -14\n        R = 99.9\n        F = 0.2\n        CALL SUB(X,Y)\n        END\n\n        SUBROUTINE SUB(P,Q)\n        INTEGER I\n        REAL    A,B,P,Q\n        COMMON  A,I,B\n        END\n</code></pre> <p>\u4ee3\u7801\u6dfb\u52a0\u4e86\u4e00\u884c <code>COMMON /test/</code>\uff0c\u89c2\u5bdf\u4e00\u4e0b symbol\uff1a</p> <pre><code>$ objdump -t test.o\n\ntest.o: file format Mach-O arm64\n\nSYMBOL TABLE:\n0000000000000088 g     F __TEXT,__text _main\n0000000000000000 g     F __TEXT,__text _sub_\n000000000000000c         *COM*  00000010 ___BLNK__\n0000000000000008         *COM*  00000010 _test_\n</code></pre> <p>\u548c\u9884\u671f\u7684\u4e00\u81f4\uff1a\u51fa\u73b0\u4e86\u65b0\u7684 COMMON symbol\uff0c\u5bf9\u5e94\u4e86 named COMMON Block \u91cc\u9762\u7684\u53d8\u91cf X \u548c Y\u3002</p> <p>\u518d\u770b\u4e00\u4e0b\u6c47\u7f16\u91cc\u600e\u4e48\u5f15\u7528\u7684\uff1a</p> <pre><code>;         CALL SUB(X,Y)\n      60: 00 00 00 90                   adrp    x0, #0\n                0000000000000060:  ARM64_RELOC_GOT_LOAD_PAGE21  _test_\n      64: 00 00 40 f9                   ldr     x0, [x0]\n                0000000000000064:  ARM64_RELOC_GOT_LOAD_PAGEOFF12       _test_\n      68: 01 10 00 91                   add     x1, x0, #4\n      6c: 00 00 00 90                   adrp    x0, #0\n                000000000000006c:  ARM64_RELOC_GOT_LOAD_PAGE21  _test_\n      70: 00 00 40 f9                   ldr     x0, [x0]\n                0000000000000070:  ARM64_RELOC_GOT_LOAD_PAGEOFF12       _test_\n      74: 00 00 00 94                   bl      #0 &lt;_MAIN__+0x5c&gt;\n                0000000000000074:  ARM64_RELOC_BRANCH26 _sub_\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08x0\uff09\u4e3a <code>_test_</code>\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08x1\uff09\u4e3a <code>_test_+4</code>\uff0c\u548c\u9884\u671f\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>\u8bfb\u5230\u8fd9\u91cc\uff0c\u5c31\u53ef\u4ee5\u7406\u89e3\u4e3a\u5565\u6709 COMMON symbol \u4e86\u3002\u53ef\u80fd\u662f\u4e3a\u4e86\u8ba9 C \u4ee3\u7801\u548c FORTRAN \u4ee3\u7801\u53ef\u4ee5\u4e92\u64cd\u4f5c COMMON symbol\uff0c\u5c31\u6709\u4e86\u8fd9\u4e48\u4e00\u51fa\u3002\u4e5f\u53ef\u80fd\u6709\u7684 C \u5e93\u786e\u5b9e\u7528\u4e86\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd\u3002</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2021/02/09/common-symbols-linking/#\u89e3\u51b3\u65b9\u6848","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>\u4f46\u662f\uff0c\u8fd9\u79cd\u7528\u6cd5\u5728\u73b0\u5728\u6765\u770b\u662f\u4e0d\u63a8\u8350\u7684\uff0c\u5efa\u8bae\u8fd8\u662f\u8be5 extern \u5c31 extern\uff0c\u53e6\u5916\uff0c\u5728\u7f16\u8bd1\u9759\u6001\u5e93\u7684\u65f6\u5019\uff0c\u8bb0\u5f97\u52a0\u4e0a <code>-fno-common</code>\u3002</p>","tags":["c++","fortran","gcc","clang","ld","linking","symbols","objdump"]},{"location":"software/2022/07/02/connectx-4-switch-to-ethernet/","title":"\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f","text":"","tags":["linux","mellanox","connectx4","ethernet","infiniband","mst","mft"]},{"location":"software/2022/07/02/connectx-4-switch-to-ethernet/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7ed9\u673a\u623f\u914d\u7f6e\u7f51\u7edc\uff0c\u9047\u5230\u4e00\u4e2a\u9700\u6c42\uff0c\u5c31\u662f\u60f3\u8981\u628a ConnectX-4 \u5f53\u6210\u4ee5\u592a\u7f51\u5361\u7528\uff0c\u5b83\u65e2\u652f\u6301 Infiniband\uff0c\u53c8\u652f\u6301 Ethernet\uff0c\u53ea\u4e0d\u8fc7\u9ed8\u8ba4\u662f Infiniband \u6a21\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u7528 mlxconfig \u5de5\u5177\u6765\u505a\u8fd9\u4e2a\u5207\u6362\u3002</p>","tags":["linux","mellanox","connectx4","ethernet","infiniband","mst","mft"]},{"location":"software/2022/07/02/connectx-4-switch-to-ethernet/#\u5207\u6362\u65b9\u6cd5","title":"\u5207\u6362\u65b9\u6cd5","text":"<p>\u5728 Using mlxconfig \u6587\u6863\u4e2d\uff0c\u5199\u4e86\u5982\u4f55\u5207\u6362\u7f51\u5361\u4e3a Infiniband \u6a21\u5f0f\uff1a</p> <pre><code>$ mlxconfig -d /dev/mst/mt4103_pci_cr0 set LINK_TYPE_P1=1 LINK_TYPE_P2=1\n\nDevice #1:\n----------\nDevice type:   ConnectX3Pro\nPCI device:    /dev/mst/mt4103_pci_cr0\nConfigurations:        Next Boot        New\n  LINK_TYPE_P1         ETH(2)           IB(1)\n  LINK_TYPE_P2         ETH(2)           IB(1)\n\nApply new Configuration? ? (y/n) [n] : y\nApplying... Done!\n-I- Please reboot machine to load new configurations.\n</code></pre> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u53ea\u9700\u8981\u53cd\u5176\u9053\u800c\u884c\u4e4b\uff0c\u8bbe\u7f6e\u6a21\u5f0f\u4e3a <code>ETH(2)</code> \u5373\u53ef\u3002</p>","tags":["linux","mellanox","connectx4","ethernet","infiniband","mst","mft"]},{"location":"software/2022/07/02/connectx-4-switch-to-ethernet/#mst-\u5b89\u88c5","title":"MST \u5b89\u88c5","text":"<p>\u8981\u4f7f\u7528 mlxconfig\uff0c\u5c31\u9700\u8981\u5b89\u88c5 MFT(Mellanox Firmware Tools)\u3002\u6211\u4eec\u7528\u7684\u662f Debian bookworm\uff0c\u4e8e\u662f\u8981\u4e0b\u8f7d DEB\uff1a</p> <pre><code>wget https://www.mellanox.com/downloads/MFT/mft-4.20.1-14-x86_64-deb.tgz\nunar mft-4.20.1-14-x86_64-deb.tgz\ncd mft-4.20.1-14-x86_64-deb\n</code></pre> <p>UPDATE 2022-10-28: \u73b0\u5728\u6700\u65b0\u7248\u672c mft-4.21.0-99 \u5df2\u7ecf\u4fee\u590d\u4e86\u4e0b\u9762\u51fa\u73b0\u7684\u7f16\u8bd1\u95ee\u9898\u3002</p> <pre><code>wget https://www.mellanox.com/downloads/MFT/mft-4.21.0-99-x86_64-deb.tgz\nunar mft-4.21.0-99-x86_64-deb.tgz\ncd mft-4.21.0-99-x86_64-deb\n</code></pre> <p>\u5c1d\u8bd5\u7528 <code>sudo ./install.sh</code> \u5b89\u88c5\uff0c\u53d1\u73b0 dkms \u62a5\u9519\u3002\u67e5\u770b\u65e5\u5fd7\uff0c\u53d1\u73b0\u662f\u56e0\u4e3a\u5185\u6838\u8fc7\u9ad8\uff085.18\uff09\uff0c\u6709\u51fd\u6570\u4fee\u6539\u4e86\u7528\u6cd5\uff0c\u5373\u8981\u628a pci_unmap_single \u7684\u8c03\u7528\u6539\u4e3a dma_unmap_single\uff0c\u5e76\u4e14\u4fee\u6539\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5982 linux commit a2e759612e5ff3858856fe97be5245eecb84e29b \u6307\u51fa\u7684\u90a3\u6837\uff1a</p> <pre><code>-           pci_unmap_single(dev-&gt;pci_dev, dev-&gt;dma_props[i].dma_map, DMA_MBOX_SIZE, DMA_BIDIRECTIONAL);\n+           dma_unmap_single(&amp;dev-&gt;pci_dev-&gt;dev, dev-&gt;dma_props[i].dma_map, DMA_MBOX_SIZE, DMA_BIDIRECTIONAL);\n</code></pre> <p>\u4fee\u6539\u5b8c\u4ee5\u540e\uff0c\u624b\u52a8 <code>sudo dkms install kernel-mft-dkms/4.20.1</code>\uff0c\u53d1\u73b0\u5c31\u7f16\u8bd1\u6210\u529f\u4e86\u3002\u518d\u624b\u52a8\u5b89\u88c5\u4e00\u4e0b mft \u5e76\u542f\u52a8\u670d\u52a1\uff1a</p> <pre><code>$ sudo dpkg -i DEBS/mft_4.20.1-14_amd64.deb\n$ sudo mst start\nStarting MST (Mellanox Software Tools) driver set\nLoading MST PCI module - Success\n[warn] mst_pciconf is already loaded, skipping\nCreate devices\nUnloading MST PCI module (unused) - Success\n$ sudo mst status\nMST modules:\n------------\n    MST PCI module is not loaded\n    MST PCI configuration module loaded\n\nMST devices:\n------------\n/dev/mst/mtxxxx_pciconf0         - PCI configuration cycles access.\n                                   domain:bus:dev.fn=0000:xx:xx.0 addr.reg=yy data.reg=zz cr_bar.gw_offset=-1\n                                   Chip revision is: 00\n</code></pre> <p>\u65e2\u7136\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86\uff0c\u6700\u540e\u6267\u884c <code>mlxconfig</code> \u5373\u53ef\u5207\u6362\u4e3a\u4ee5\u592a\u7f51\uff1a</p> <pre><code>$ sudo mlxconfig -d /dev/mst/mtxxxx_pciconf0 set LINK_TYPE_P1=2 LINK_TYPE_P2=2\n\nDevice #1:\n----------\n\nDevice type:    ConnectX4\nName:           REDACTED\nDescription:    ConnectX-4 VPI adapter card; FDR IB (56Gb/s) and 40GbE; dual-port QSFP28; PCIe3.0 x8; ROHS R6\nDevice:         /dev/mst/mtxxxx_pciconf0\n\nConfigurations:                              Next Boot       New\n         LINK_TYPE_P1                        IB(1)           ETH(2)\n         LINK_TYPE_P2                        IB(1)           ETH(2)\n\n Apply new Configuration? (y/n) [n] : y\nApplying... Done!\n-I- Please reboot machine to load new configurations.\n</code></pre> <p>\u663e\u793a\u5404\u4e2a\u914d\u7f6e\u53ef\u80fd\u7684\u9009\u9879\u548c\u5185\u5bb9\uff1a<code>sudo mlxconfig -d /dev/mst/mtxxxx_pciconf0 show_confs</code></p> <p>\u6574\u4e2a\u5b89\u88c5\u6d41\u7a0b\u5728\u4ed3\u5e93 https://github.com/jiegec/mft-debian-bookworm \u4e2d\u7528\u811a\u672c\u5b9e\u73b0\u3002</p>","tags":["linux","mellanox","connectx4","ethernet","infiniband","mst","mft"]},{"location":"software/2022/07/02/connectx-4-switch-to-ethernet/#vmware-esxi","title":"VMware ESXi","text":"<p>\u5982\u679c\u8981\u5728 ESXi \u4e0a\u628a\u7f51\u5361\u6539\u6210\u4ee5\u592a\u7f51\u6a21\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0b\u9762\u7684\u6587\u6863\uff1a</p> <ul> <li>https://docs.nvidia.com/networking/pages/releaseview.action?pageId=15049813</li> <li>https://docs.nvidia.com/networking/plugins/servlet/mobile?contentId=15051769#content/view/15051769</li> </ul> <p>\u547d\u4ee4\uff08ESXi 7.0U3\uff09\uff1a</p> <pre><code>scp *.vib root@esxi:/some/path\nesxcli software vib install -v /some/path/MEL_bootbank_mft_4.21.0.703-0.vib\nesxcli software vib install -v /some/path/MEL_bootbank_nmst_4.21.0.703-1OEM.703.0.0.18434556.vib\nreboot\n/opt/mellanox/bin/mst start\n/opt/mellanox/bin/mst status -vv\n/opt/mellanox/bin/mlxfwmanager --query\n/opt/mellanox/bin/mlxconfig -d mt4115_pciconf0 set LINK_TYPE_P1=2 LINK_TYPE_P2=2\nreboot\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u770b\u5230\u7f51\u5361\u4e86\u3002</p>","tags":["linux","mellanox","connectx4","ethernet","infiniband","mst","mft"]},{"location":"software/2019/09/14/create-esp-partition-macos/","title":"\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6","text":"<p>\u6700\u8fd1 rCore \u6dfb\u52a0\u4e86 UEFI \u652f\u6301\uff0c\u5728 QEMU \u91cc\u8dd1\u81ea\u7136\u662f\u6ca1\u6709\u95ee\u9898\uff0c\u7136\u540e\u5c1d\u8bd5\u653e\u5230 VMWare \u865a\u62df\u673a\u91cc\u8dd1\uff0c\u8fd9\u65f6\u5019\u95ee\u9898\u5c31\u6765\u4e86\uff1a\u9700\u8981\u4e00\u4e2a\u5e26\u6709 ESP \u76d8\u7684 vmdk \u865a\u62df\u76d8\u3002\u641c\u7d22\u4e86\u4e00\u4e0b\u7f51\u7edc\uff0c\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\uff1a</p> <pre><code>hdiutil create -fs fat32 -ov -size 60m -volname ESP -format UDTO -srcfolder esp uefi.cdr\n</code></pre> <p>\u5176\u4e2d <code>60m</code> <code>esp</code> \u548c <code>uefi.cdr</code> \u90fd\u53ef\u4ee5\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\u3002\u5b83\u4f1a\u628a esp \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u653e\u5230 ESP \u5206\u533a\u4e2d\uff0c\u7136\u540e\u5f97\u5230\u4e00\u4e2a\u955c\u50cf\u6587\u4ef6\uff1a</p> <pre><code>uefi.cdr: DOS/MBR boot sector; partition 1 : ID=0xb, start-CHS (0x3ff,254,63), end-CHS (0x3ff,254,63), startsector 1, 122879 sectors, extended partition table (last)\n</code></pre> <p>\u63a5\u7740\u8f6c\u6362\u4e3a vmdk\uff1a</p> <pre><code>qemu-img convert -O vmdk uefi.cdr uefi.vmdk\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["linux","efi","esp","macos","vmware"]},{"location":"software/2019/03/22/cross-compiling-nginx-to-riscv/","title":"\u4ea4\u53c9\u7f16\u8bd1 Nginx 1.14.2 \u5230 RISC-V","text":"<p>\u6700\u8fd1\u53c8\u628a\u4e00\u5b9a\u7684\u7cbe\u529b\u653e\u5230\u4e86 RISC-V 64 \u4e0a\u7684 rCore \u7528\u6237\u6001\u7a0b\u5e8f\u7684\u652f\u6301\u4e0a\uff0c\u540c\u65f6\u4e5f\u501f\u5230\u4e86 HiFive Unleashed \u677f\u5b50\uff0c\u6240\u4ee5\u6709\u771f\u5b9e\u786c\u4ef6\u53ef\u4ee5\u62ff\u6765\u8dd1\u4e86\u3002\u5728\u8fd9\u4e4b\u524d\u5148\u5728 QEMU \u4e0a\u628a\u80fd\u8dd1\u7684\u90fd\u8dd1\u8d77\u6765\u3002</p> <p>\u7531\u4e8e rCore \u5bf9 glibc \u7684\u652f\u6301\u4e00\u76f4\u6709\u95ee\u9898\uff0cRISC-V \u4e5f\u4e0d\u4f8b\u5916\uff0c\u6240\u4ee5\u8fd8\u662f\u9009\u62e9\u7528 musl \u6765\u505a\u8fd9\u4ef6\u4e8b\u60c5\u3002\u4e00\u822c\u641c\u7d22\uff0c\u7ec8\u4e8e\u627e\u5230\u4e86 Linux \u4e0b\u80fd\u7528\u7684 musl-riscv-toolchain \u3002\u7f16\u8bd1\u597d\u5de5\u5177\u94fe\u4ee5\u540e\uff0c\u5f88\u591a\u9700\u8981 libc \u7684\u7528\u6237\u6001\u90fd\u80fd\u8dd1\u4e86\uff0c\u4e8e\u662f\u60f3\u7740\u8bd5\u4e00\u4e0b nginx \u7684\u7f16\u8bd1\u3002\u8bd5\u7740\u7f16\u8bd1\u4e86\u4e00\u4e0b\uff0c\u9047\u5230\u4e86\u5404\u79cd\u95ee\u9898\uff0c\u6700\u540e\u641c\u5230\u4e86\u4ea4\u53c9\u7f16\u8bd1 Hi3536 \u4e0a\u9762\u4f7f\u7528\u7684 nginx\uff0c\u91cc\u9762\u7684\u65b9\u6cd5\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u6700\u540e\u603b\u7ed3\u51fa\u4e86\u8fd9\u6837\u7684 patch :</p> <pre><code>diff --git a/nginx-1.14.2/auto/cc/name b/nginx-1.14.2/auto/cc/name\nindex ded93f5..d6ab27a 100644\n--- a/nginx-1.14.2/auto/cc/name\n+++ b/nginx-1.14.2/auto/cc/name\n@@ -7,7 +7,7 @@ if [ \"$NGX_PLATFORM\" != win32 ]; then\n\n     ngx_feature=\"C compiler\"\n     ngx_feature_name=\n-    ngx_feature_run=yes\n+    ngx_feature_run=no\n     ngx_feature_incs=\n     ngx_feature_path=\n     ngx_feature_libs=\ndiff --git a/nginx-1.14.2/auto/lib/openssl/make b/nginx-1.14.2/auto/lib/openssl/make\nindex 126a238..7a0e768 100644\n--- a/nginx-1.14.2/auto/lib/openssl/make\n+++ b/nginx-1.14.2/auto/lib/openssl/make\n@@ -51,7 +51,7 @@ END\n $OPENSSL/.openssl/include/openssl/ssl.h:   $NGX_MAKEFILE\n    cd $OPENSSL \\\\\n    &amp;&amp; if [ -f Makefile ]; then \\$(MAKE) clean; fi \\\\\n-   &amp;&amp; ./config --prefix=$ngx_prefix no-shared no-threads $OPENSSL_OPT \\\\\n+   &amp;&amp; ./config --prefix=$ngx_prefix no-shared no-threads --cross-compile-prefix=riscv64-linux-musl- $OPENSSL_OPT \\\\\n    &amp;&amp; \\$(MAKE) \\\\\n    &amp;&amp; \\$(MAKE) install_sw LIBDIR=lib\n\ndiff --git a/nginx-1.14.2/auto/types/sizeof b/nginx-1.14.2/auto/types/sizeof\nindex 480d8cf..52c7287 100644\n--- a/nginx-1.14.2/auto/types/sizeof\n+++ b/nginx-1.14.2/auto/types/sizeof\n@@ -33,7 +33,7 @@ int main(void) {\n END\n\n\n-ngx_test=\"$CC $CC_TEST_FLAGS $CC_AUX_FLAGS \\\n+ngx_test=\"gcc $CC_TEST_FLAGS $CC_AUX_FLAGS \\\n           -o $NGX_AUTOTEST $NGX_AUTOTEST.c $NGX_LD_OPT $ngx_feature_libs\"\n\n eval \"$ngx_test &gt;&gt; $NGX_AUTOCONF_ERR 2&gt;&amp;1\"\n</code></pre> <p>\u63a5\u7740\uff0c\u5728 <code>./configure --with-cc=riscv64-linux-musl-gcc --with-cc-opt=-static --with-ld-opt=-static --without-pcre --without-http_rewrite_module --without-http_gzip_module --with-poll_module --without-http_upstream_zone_module</code> \u4e4b\u540e\uff0c\u4fee\u6539 <code>objs/ngx_auto_config.h</code>\uff0c\u52a0\u5165\uff1a</p> <pre><code>#ifndef NGX_SYS_NERR\n#define NGX_SYS_NERR  132\n#endif\n\n#ifndef NGX_HAVE_SYSVSHM\n#define NGX_HAVE_SYSVSHM 1\n#endif\n</code></pre> <p>\u63a5\u7740\u5c31\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\u4e86\uff1a</p> <pre><code>$ file objs/nginx\nobjs/nginx: ELF 64-bit LSB executable, UCB RISC-V, version 1 (SYSV), statically linked, with debug_info, not stripped\n</code></pre>","tags":["rcore","riscv","crosscompiling","musl"]},{"location":"software/2023/09/25/docker-rootless/","title":"Podman \u548c Docker Rootless \u5b9e\u8df5","text":"<p>\u6700\u8fd1\u5728\u914d\u7f6e\u516c\u7528\u673a\u5668\u7684\u73af\u5883\uff0c\u9700\u6c42\u662f\u5f88\u591a\u7528\u6237\u9700\u8981\u4f7f\u7528 docker\uff0c\u4f46\u662f\u4f17\u6240\u5468\u77e5\uff0c\u6709 docker \u6743\u9650\u5c31\u7b49\u4e8e\u6709\u4e86 root \u6743\u9650\uff0c\u56e0\u6b64\u6b63\u597d\u60f3\u5c1d\u8bd5\u4e00\u4e0b\u73b0\u5728\u7684 Rootless \u5bb9\u5668\u5316\u65b9\u6848\uff0c\u4f8b\u5982 docket rootless \u548c podman\u3002</p>","tags":["docker","rootless","podman"]},{"location":"software/2023/09/25/docker-rootless/#docker-rootless","title":"Docker Rootless","text":"<p>\u9996\u5148\u662f Docker\uff0c\u5b98\u65b9\u5df2\u7ecf\u652f\u6301 Rootless \u90e8\u7f72\uff0c\u6587\u6863\u5728 https://docs.docker.com/engine/security/rootless/\uff0c\u4f7f\u7528\u4e0a\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ol> <li>\u7ba1\u7406\u5458\u7528 root \u6743\u9650\u914d\u7f6e\u597d\u5404\u9879\u4f9d\u8d56</li> <li>\u6bcf\u4e2a\u7528\u6237\u8dd1\u4e00\u6b21 setup \u811a\u672c\uff0c\u7136\u540e\u6b63\u5e38\u7528 docker</li> </ol> <p>\u7b2c\u4e00\u6b65\u5b89\u88c5 docker \u4e0d\u5fc5\u8d58\u8ff0\uff0c\u4e3a\u4e86 docker rootless\uff0c\u8fd8\u9700\u8981\u5b89\u88c5\u989d\u5916\u7684\u5305\uff1a</p> <pre><code>sudo apt install uidmap dbus-user-session fuse-overlayfs slirp4netns docker-ce-rootless-extras\n</code></pre> <p>\u5efa\u8bae\u7528\u6bd4\u8f83\u65b0\u7684\u53d1\u884c\u7248\uff0c\u65e7\u53d1\u884c\u7248\u5bf9 docker rootless \u7684\u652f\u6301\u53ef\u80fd\u4f1a\u6bd4\u8f83\u5dee\u3002</p> <p>\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u6bcf\u4e2a\u7528\u6237\u81ea\u5df1\u6267\u884c\u4e00\u4e2a\u521d\u59cb\u5316\u811a\u672c\uff1a</p> <pre><code>dockerd-rootless-setuptool.sh install\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528 docker \u4e86\uff0c\u4ece <code>docker info</code> \u53ef\u4ee5\u770b\u5230\u76ee\u524d\u662f rootless \u6a21\u5f0f\uff1a</p> <pre><code>docker info | grep Context\n</code></pre> <p>\u66f4\u591a\u7684\u6ce8\u610f\u4e8b\u9879\u53ef\u4ee5\u770b Docker \u5b98\u65b9\u7684\u6587\u6863\u3002</p>","tags":["docker","rootless","podman"]},{"location":"software/2023/09/25/docker-rootless/#gpu","title":"GPU","text":"<p>\u5982\u679c\u60f3\u8981\u5728 Docker Rootless \u4e2d\u4f7f\u7528 NVIDIA GPU\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4f1a\u62a5\u9519\u7684\uff0c\u53ef\u4ee5\u53c2\u8003 GPU with rootless Docker \u6587\u6863\u89e3\u51b3\u3002\u4fee\u6539\u6587\u4ef6\u540e\uff0c\u5c31\u4f1a\u53d1\u73b0\u53ef\u4ee5\u5728\u5bb9\u5668\u91cc\u4f7f\u7528 <code>nvidia-smi</code> \u4e86\uff1a</p> <pre><code>docker run -it --rm --gpus all debian nvidia-smi\n</code></pre>","tags":["docker","rootless","podman"]},{"location":"software/2023/09/25/docker-rootless/#podman-rootless","title":"Podman Rootless","text":"<p>Podman Rootless \u7684\u5b98\u65b9\u6587\u6863\u5728 https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md\uff0c\u76f8\u6bd4 Docker\uff0cPodman Rootless \u914d\u7f6e\u66f4\u52a0\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u7528\u6237\u8fd0\u884c install \u811a\u672c\uff0c\u548c\u524d\u6587\u4e00\u6837\u914d\u7f6e\u597d\u4f9d\u8d56\u4ee5\u540e\uff0c\u76f4\u63a5\u8fd0\u884c podman \u5373\u53ef\u3002</p> <p>UPDATE: @Harry-Chen \u5efa\u8bae\uff1a\u5982\u679c\u8981\u89e3\u51b3 podman rootless \u4f1a\u4fdd\u5b58\u5f88\u591a\u4efd\u955c\u50cf\u5728\u5404\u4e2a\u7528\u6237\u7684 home \u76ee\u5f55\u4e0b\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u5168\u5c40\u7684\u955c\u50cf\u8def\u5f84\uff0c\u89c1 Exploring additional image stores in Podman\uff0c\u6216\u8005\u4f7f\u7528 FS\uff08\u5982 ZFS\uff09\u7684 Dedup \u529f\u80fd\u3002</p>","tags":["docker","rootless","podman"]},{"location":"software/2023/09/25/docker-rootless/#gpu_1","title":"GPU","text":"<p>\u8981\u5728 Podman Rootless \u4e2d\u4f7f\u7528 NVIDIA GPU\uff0c\u4e5f\u9700\u8981\u50cf\u4e0a\u9762 Docker \u90a3\u6837\uff0c\u4fee\u6539\u914d\u7f6e <code>no-cgroups=true</code>\uff0c\u7136\u540e\u6309\u7167 Support for Container Device Interface \u914d\u7f6e Container Device Interface\uff1a</p> <pre><code>sudo nvidia-ctk cdi generate --output=/etc/cdi/nvidia.yaml\nnvidia-ctk cdi list\n</code></pre> <p>\u6b64\u65f6\u5c31\u4f1a\u751f\u6210 <code>/etc/cdi/nvidia.yaml</code> \u914d\u7f6e\u6587\u4ef6\uff0c\u91cc\u9762\u662f\u4e3a\u4e86\u8ba9\u5bb9\u5668\u53ef\u4ee5\u7528 NVIDIA GPU \u6240\u9700\u8981\u7684\u914d\u7f6e\u3002\u5982\u679c\u60f3\u5728 podman \u91cc\u4f7f\u7528 NVIDIA GPU\uff0c\u8fd0\u884c\uff1a</p> <pre><code>podman run --device nvidia.com/gpu=all -it --rm debian nvidia-smi\n</code></pre> <p>\u5982\u679c Podman \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u53ef\u80fd\u4f1a\u9047\u5230 <code>nvidia-smi not found</code> \u7684\u95ee\u9898\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u867d\u7136 Podman \u4ece 3.2.0 \u7248\u672c\u5f00\u59cb\u652f\u6301 Container Device Interface\u3002\u4f46\u662f\u5982\u679c nvidia container \u7248\u672c\u6bd4\u8f83\u65b0\uff0c\u751f\u6210\u4e86 0.5.0 \u7248\u672c\u7684 CDI Spec\uff0c\u5c31\u9700\u8981\u6bd4\u8f83\u65b0\u7684 Podman \u7248\u672c\uff08\u5927\u6982 4.1.0 \u4ee5\u540e\uff09\u3002\u5b9e\u9645\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0cUbuntu 22.04 \u6253\u5305\u7684 Podman 3.4.4 \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u53ef\u4ee5\u6309\u7167 Podman Installation Instrucions \u6587\u6863\u5b89\u88c5\u6700\u65b0\u7684 Podman 4.6.2\uff1a</p> <pre><code>sudo mkdir -p /etc/apt/keyrings\ncurl -fsSL \"https://download.opensuse.org/repositories/devel:kubic:libcontainers:unstable/xUbuntu_$(lsb_release -rs)/Release.key\" \\\n  | gpg --dearmor \\\n  | sudo tee /etc/apt/keyrings/devel_kubic_libcontainers_unstable.gpg &gt; /dev/null\necho \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/devel_kubic_libcontainers_unstable.gpg]\\\n    https://download.opensuse.org/repositories/devel:kubic:libcontainers:unstable/xUbuntu_$(lsb_release -rs)/ /\" \\\n  | sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:unstable.list &gt; /dev/null\nsudo apt-get update -qq\nsudo apt-get -qq -y install podman\n</code></pre> <p>\u66f4\u65b0 podman \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u5bb9\u5668\u91cc\u4f7f\u7528 NVIDIA GPU\uff1a</p> <pre><code>podman run --device nvidia.com/gpu=all -it --rm debian nvidia-smi\n</code></pre> <p>\u6ce8\uff1a\u7f51\u4e0a\u53ef\u4ee5\u67e5\u5230\u4e00\u4e9b podman \u7528 nvidia gpu \u7684\u6559\u7a0b\uff0c\u4f7f\u7528\u7684\u662f\u65e7\u7684 oci hooks \u673a\u5236\uff0c\u53ef\u80fd\u5728\u65b0\u7248\u672c\u7cfb\u7edf\u4e0a\u65e0\u6cd5\u5de5\u4f5c\uff0c\u9700\u8981\u6309\u7167\u4e0a\u9762\u63d0\u793a\u7684 Container Device Interface \u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\u3002\u65b0\u7684 nvidia-container-toolkit \u5305\u5df2\u7ecf\u4e0d\u5305\u542b oci hooks \u914d\u7f6e\uff0c\u6240\u4ee5\u5efa\u8bae\u7528\u4e0a\u9762\u7684\u65b0\u4f7f\u7528\u65b9\u6cd5\u3002</p>","tags":["docker","rootless","podman"]},{"location":"software/2023/09/25/docker-rootless/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u603b\u800c\u8a00\u4e4b\uff0c\u5728\u6bd4\u8f83\u65b0\u7684\u53d1\u884c\u7248\u91cc\uff0c\u65e0\u8bba\u662f docker \u8fd8\u662f podman\uff0c\u5176 rootless \u90fd\u5df2\u7ecf\u6bd4\u8f83\u6210\u719f\uff0c\u5efa\u8bae\u5728\u5171\u4eab\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\uff0c\u51cf\u5c11 rootful docker \u7684\u4f7f\u7528\u3002\u76ee\u524d nvidia gpu \u7684\u652f\u6301\u65b9\u9762\uff0cdocker \u6bd4\u8f83\u6613\u7528\uff0cpodman \u8fd8\u9700\u8981\u6bd4\u8f83\u591a\u7684\u914d\u7f6e\uff0c\u4ee5\u53ca\u8db3\u591f\u65b0\u7684\u7248\u672c\u3002</p> <p>\u6d4b\u8bd5\u73af\u5883\uff1a</p> <ul> <li>Ubuntu 22.04 + Kubic repo</li> <li>docker 23.0.4</li> <li>containerd 1.6.16</li> <li>runc 1.1.4</li> <li>slirp4netns 1.2.2</li> <li>fuse-overlayfs 1.13</li> <li>crun 1.9</li> <li>podman 4.6.2</li> </ul>","tags":["docker","rootless","podman"]},{"location":"software/2018/11/27/enable-dark-mode-google-chrome/","title":"\u5f3a\u5236\u542f\u7528 Google Chrome \u539f\u751f\u7684 Dark Mode","text":"<p>Mojave \u7684 Dark Mode \u771f\u9999\uff0c\u4f46\u662f Google Chrome \u5e76\u4e0d\u4f1a\u968f\u7740\u7cfb\u7edf\u7684 Dark Mode \u8bbe\u7f6e\u53d8\u5316\uff0c\u6240\u4ee5 NightOwl \u53ea\u80fd\u8ba9\u90e8\u5206\u8f6f\u4ef6\u6309\u7167\u65f6\u95f4\u53d8\u66f4 Dark/Light Mode\u3002\u4e00\u756a\u641c\u7d22\uff0c\u53d1\u73b0\u5176\u5b9e Google Chrome \u5176\u5b9e\u5df2\u7ecf\u652f\u6301\u4e86 Dark Mode\uff0c\u4f46\u53ea\u80fd\u8bbe\u7f6e\uff0c\u4e0d\u80fd\u6309\u7167\u7cfb\u7edf\u7684\u72b6\u6001\u81ea\u52a8\u5207\u6362\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ open -a Google\\ Chrome --args --force-dark-mode\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u770b\u5230 Google Chrome \u5df2\u7ecf\u662f Dark Mode \u4e86\u3002\u4f46\u53ef\u60dc\u5e76\u4e0d\u80fd\u81ea\u52a8\u5207\u6362\u3002</p>","tags":["macos","darkmode","googlechrome"]},{"location":"software/2018/09/08/enable-vim-mode-in-xcode-9/","title":"\u5728 Xcode 9 \u4e0a\u542f\u7528 Vim \u6a21\u62df\uff08XVim 2\uff09","text":"<p>\u4f5c\u4e3a\u4e00\u4e2a\u4e0d\u7528 vim \u7f16\u8f91\u4f1a\u6b7b\u661f\u4eba\uff0c\u7528 Xcode \u603b\u662f\u6b62\u4e0d\u4f4f\u81ea\u5df1\u60f3 Escape \u7684\u5fc3\u3002\u4e8e\u662f\u627e\u5230\u4e86 XVimProject/XVim2 \u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u5927\u81f4\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li>\u6309\u7167 Signing Xcode \u5bf9 Xcode \u8fdb\u884c\u91cd\u7b7e\u540d\u3002\u5957\u8def\u548c\u5bf9 GDB \u8fdb\u884c\u7b7e\u540d\u4e00\u6837\u3002\u4e0d\u8fc7\u8fd9\u6b21\uff0c\u7b7e\u540d\u5b8c\u6210\u7684\u65f6\u95f4\u53ef\u957f\u591a\u4e86\uff0c\u6bd5\u7adf Xcode \u8fd9\u4e48\u5927\u3002</li> <li>\u63a5\u7740\u6309\u7167\u9879\u76ee\u7684 README\uff0c\u9996\u5148 <code>git clone</code> \u7136\u540e <code>make</code> \uff0c\u7b2c\u4e00\u6b21\u6253\u5f00 Xcode \u7684\u65f6\u5019\u9009\u62e9 <code>Load Bundle</code> \u5373\u53ef\u3002</li> </ol> <p>\u7ec8\u4e8e\u53ef\u4ee5\u6ee1\u8db3\u6211 Escape Xcode \u7684\u6b32\u671b\u4e86\u3002</p>","tags":["xcode","vim","xvim"]},{"location":"software/2019/08/12/framebuffer-capture/","title":"\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer","text":"<p>\u6700\u8fd1\u9700\u8981\u5728 linux \u4e0b\u6293\u53d6 Framebuffer \u7684\u5185\u5bb9\uff0c\u5728\u7f51\u4e0a\u627e\u5230\u4e86\u4e24\u79cd\u65b9\u6cd5\uff0c\u5728\u6211\u8fd9\u91cc\u53ea\u6709\u7b2c\u4e8c\u3001\u7b2c\u4e09\u79cd\u53ef\u4ee5\u6210\u529f\uff0c\u6ca1\u6709\u7ec6\u7a76\u5177\u4f53\u539f\u56e0\uff0c\u53ef\u80fd\u4e0e\u6211\u7684 Framebuffer \u914d\u7f6e\u6709\u5173\u3002\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li><code>fbgrab</code> \uff1a\u547d\u4ee4\u5c31\u662f fbgrab image.png\uff0c\u76f4\u63a5\u5f97\u5230 png \u6587\u4ef6\uff0c\u683c\u5f0f\u662f\u5bf9\u7684\uff0c\u4f46\u662f\u7528\u8f6f\u4ef6\u6253\u5f00\u5c31\u662f\u4e00\u7247\u7a7a\u767d\u3002\u7528 ImageMagick \u8f6c\u6362\u4e3a jpg \u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u5185\u5bb9\uff0c\u4f46\u662f\u548c\u5b9e\u9645\u6709\u4e9b\u4e0d\u4e00\u6837\u3002</li> <li><code>fbdump</code> \uff1a\u547d\u4ee4\u5c31\u662f fbdump &gt; image.ppm\uff0c\u5f97\u5230\u88f8\u7684 ppm \u6587\u4ef6\uff0c\u56fe\u50cf\u662f\u6b63\u786e\u7684\uff0c\u4e5f\u53ef\u4ee5\u8f6c\u6362\u4e3a\u522b\u7684\u683c\u5f0f\u6b63\u5e38\u6253\u5f00\u3002</li> <li>cat+\u811a\u672c\u5904\u7406\uff1a\u76f4\u63a5 cat /dev/fb0 &gt; image.rgb\uff0c\u7136\u540e\u7528\u4e0b\u9762\u7684\u811a\u672c\u8f6c\u6362\u4e3a png\u3002\u7531\u4e8e Framebuffer \u683c\u5f0f\u4e3a RGB\uff0c\u672c\u6765 A \u6240\u5728\u7684 channel \u90fd\u4e3a 0\uff0c\u6240\u4ee5\u7528\u4e00\u4e9b\u8f6f\u4ef6\u76f4\u63a5\u6253\u5f00\u90fd\u662f\u7a7a\u767d\uff0c\u53ea\u597d\u5199\u4e86\u811a\u672c\u76f4\u63a5\u8df3\u8fc7 Alpha Channel\u3002</li> </ol> <p>Framebuffer \u914d\u7f6e\uff08 <code>fbset</code> \u8f93\u51fa\uff09\uff1a</p> <pre><code>mode \"640x480-0\"\n        # D: 0.000 MHz, H: 0.000 kHz, V: 0.000 Hz\n        geometry 640 480 1024 480 32\n        timings 0 0 0 0 0 0 0\n        accel false\n        rgba 8/16,8/8,8/0,0/0\nendmode\n</code></pre> <p>\u8f6c\u6362\u811a\u672c\uff08\u53c2\u8003 [Tips] \u64f7\u53d6 framebuffer \u756b\u9762\uff09\uff1a</p> <pre><code>#!/usr/bin/perl -w\n\n$w = shift || 240;\n$h = shift || 320;\n$pixels = $w * $h;\n\nopen OUT, \"|pnmtopng\" or die \"Can't pipe pnmtopng: $!\\n\";\n\nprintf OUT \"P6%d %d\\n255\\n\", $w, $h;\n\nwhile ((read STDIN, $raw, 4) and $pixels--) {\n   $short = unpack('I', $raw);\n   print OUT pack(\"C3\",\n      ($short &amp; 0xff0000) &gt;&gt; 16,\n      ($short &amp; 0xff00) &gt;&gt; 8,\n      ($short &amp; 0xff));\n}\n\nclose OUT;\n</code></pre> <p>\u7528\u6cd5\uff1a <code>cat image.rgb | perl script.pl 1024 480 &gt; console.png</code></p>","tags":["linux","fb","framebuffer","fbgrab","fbdump"]},{"location":"software/2022/08/05/from-tex-to-pdf/","title":"\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b","text":"","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2022/08/05/from-tex-to-pdf/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4eca\u5929\u8dd1 <code>xdvipdfmx</code> \u7684\u65f6\u5019\u51fa\u73b0\u4e86\u62a5\u9519\uff0c\u5ffd\u7136\u60f3\u7814\u7a76\u4e00\u4e0b\uff0cDVI \u683c\u5f0f\u662f\u4ec0\u4e48\uff0cTeX \u662f\u5982\u4f55\u4e00\u6b65\u6b65\u53d8\u6210 PDF \u7684\u3002</p>","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2022/08/05/from-tex-to-pdf/#\u6d41\u7a0b","title":"\u6d41\u7a0b","text":"<p>\u5b9e\u9645\u4e0a\u4ece TeX \u5230 PDF \u6709\u4e0d\u540c\u7684\u5de5\u5177\uff0c\u5176\u4e2d\u53ef\u80fd\u7ecf\u5386\u4e86\u4e0d\u540c\u7684\u8f6c\u5316\u8fc7\u7a0b\u3002</p> <p>\u6211\u4eec\u4eca\u5929\u6765\u770b\u4e00\u79cd\u6bd4\u8f83\u539f\u59cb\u7684\u8f6c\u6362\u65b9\u5f0f\uff1a\u4ece TeX \u5230 DVI\uff0c\u4ece DVI \u5230 PS\uff0c\u518d PS \u5230 PDF\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u770b\u770b\u8fd9\u4e9b\u683c\u5f0f\u5185\u90e8\u90fd\u662f\u4ec0\u4e48\u6837\u5b50\u7684\u3002</p>","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2022/08/05/from-tex-to-pdf/#\u4ece-tex-\u5230-dvi","title":"\u4ece TeX \u5230 DVI","text":"<p>\u4e3e\u4e00\u4e2a\u5f88\u5c0f\u7684\u4f8b\u5b50\uff0c\u4f8b\u5982 <code>test.tex</code> \u6709\u5982\u4e0b\u7684\u5185\u5bb9\uff1a</p> <pre><code>Hello, world!\n\\bye\n</code></pre> <p>\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c <code>tex test.tex</code>\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u751f\u6210\u4e86 <code>test.dvi</code> \u6587\u4ef6\uff1a</p> <pre><code>$ tex test.tex\n(test.tex [1] )\nOutput written on test.dvi (1 page, 228 bytes).\nTranscript written on test.log.\n</code></pre> <p>\u90a3\u4e48 DVI \u5c31\u662f TeX \u5f15\u64ce\u8f93\u51fa\u7684\u9ed8\u8ba4\u683c\u5f0f\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u7528 dviinfox \u548c dviasm \u5de5\u5177\u6765\u770b\u5b83\u7684\u4e00\u4e9b\u4fe1\u606f\uff1a</p> <pre><code>$ dviinfox test.dvi\ntest.dvi: DVI format 2; 1 page\n  Magnification: 1000/1000\n  Size unit: 1000x25400000/(1000x473628672)dum = 0.054dum = 1.000sp\n  Page size: 469ptx667pt = 16.510cmx23.449cm\n  Stack size: 2\n  Comment: \" TeX output 2022.08.05:2055\"\n  Font   0:     cmr10 at 10.000 (design size 10.000, checksum=1274110073)\n$ dviasm test.dvi\n[preamble]\nid: 2\nnumerator: 25400000\ndenominator: 473628672\nmagnification: 1000\ncomment: ' TeX output 2022.08.05:2058'\n\n[postamble]\nmaxv: 667.202545pt\nmaxh: 469.754990pt\nmaxs: 2\npages: 1\n\n[font definitions]\nfntdef: cmr10 at 10pt\n\n[page 1 0 0 0 0 0 0 0 0 0]\npush:\n  down: -14pt\npop:\ndown: 643.202545pt\npush:\n  down: -633.202545pt\n  push:\n    right: 20pt\n    fnt: cmr10 at 10pt\n    set: 'Hello,'\n    right: 3.333328pt\n    set: 'w'\n    right: -0.277786pt\n    set: 'orld!'\n  pop:\npop:\ndown: 24pt\npush:\n  right: 232.377487pt\n  set: '1'\npop:\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u5b9a\u4e49\u4e86\u6587\u6863\u7684\u4e00\u4e9b\u5c3a\u5bf8\u548c\u5b57\u4f53\u4fe1\u606f\uff0c\u7136\u540e\u4e3b\u4f53\u90e8\u5206\u5c31\u662f\u6bcf\u4e2a\u9875\u9762\u4e0a\u9700\u8981\u7ed8\u5236\u7684\u5185\u5bb9\uff1a</p> <pre><code>push:\n  down: -14pt\npop:\ndown: 643.202545pt\npush:\n  down: -633.202545pt\n  push:\n    right: 20pt\n    fnt: cmr10 at 10pt\n    set: 'Hello,'\n    right: 3.333328pt\n    set: 'w'\n    right: -0.277786pt\n    set: 'orld!'\n  pop:\npop:\ndown: 24pt\npush:\n  right: 232.377487pt\n  set: '1'\npop:\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4fdd\u5b58\u4e86\u4e00\u4e9b\u547d\u4ee4\uff0c\u5c31\u50cf\u662f\u5728\u79fb\u52a8\u5149\u6807\uff0c\u7136\u540e\u8f93\u51fa\u6587\u5b57\uff1a</p> <ol> <li>\u5411\u4e0b\u79fb\u52a8 643.20 pt</li> <li>\u5411\u4e0a\u79fb\u52a8 633.20 pt</li> <li>\u5411\u53f3\u79fb\u52a8 20.00 pt</li> <li>\u8bbe\u7f6e\u5b57\u4f53\u4e3a cmr10</li> <li>\u8f93\u51fa \"Hello,\"</li> <li>\u5411\u53f3\u79fb\u52a8 3.33 pt</li> <li>\u8f93\u51fa \"w\"</li> <li>\u5411\u5de6\u79fb\u52a8 0.28 pt</li> <li>\u8f93\u51fa \"orld!\"</li> </ol> <p>\u5b9e\u9645\u4e0a\uff0c\u5b83\u7684\u7f16\u7801\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u4e00\u4e2a\u5b57\u8282\u7684\u547d\u4ee4\u52a0\u4e0a\u82e5\u5e72\u5b57\u8282\u7684\u53c2\u6570\u3002DVI \u4e8c\u8fdb\u5236\u683c\u5f0f\u8be6\u7ec6\u7684\u6587\u6863\u53ef\u89c1 https://www.mn.uio.no/ifi/tjenester/it/hjelp/latex/dvi.pdf\u3002</p>","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2022/08/05/from-tex-to-pdf/#\u4ece-dvi-\u5230-ps","title":"\u4ece DVI \u5230 PS","text":"<p>\u6709\u4e86 DVI \u6587\u4ef6\u4ee5\u540e\uff0c\u4e0b\u4e00\u6b65\u662f\u7528 <code>dvips</code> \u5de5\u5177\u6765\u751f\u6210 PS \u6587\u4ef6\uff1a</p> <pre><code>$ dvips test.dvi\nThis is dvips(k) 2020.1 Copyright 2020 Radical Eye Software (www.radicaleye.com)\n' TeX output 2022.08.05:2058' -&gt; test.ps\n&lt;/usr/share/texlive/texmf-dist/dvips/base/tex.pro&gt;\n&lt;/usr/share/texlive/texmf-dist/dvips/base/texps.pro&gt;.\n&lt;/usr/share/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb&gt;[1]\n</code></pre> <p>DVI \u662f\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u800c PS \u662f\u7eaf\u6587\u672c\u683c\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u7f16\u8f91\u5668\u6253\u5f00\uff0c\u770b\u5230\u91cc\u9762\u5927\u6982\u6709\u51e0\u90e8\u5206\u5185\u5bb9\uff1a</p> <ol> <li>\u5f00\u5934\u7684\u5143\u6570\u636e</li> <li>tex.pro \u6587\u4ef6\u7684\u5185\u5bb9</li> <li>texps.pro \u6587\u4ef6\u7684\u5185\u5bb9</li> <li>\u5b9a\u4e49 CMR10 \u5b57\u4f53</li> <li>\u63cf\u8ff0\u6587\u6863\u5185\u5bb9</li> </ol> <p>\u8ba9\u6211\u4eec\u76f4\u63a5\u6765\u770b\u6700\u540e\u4e00\u90e8\u5206\uff1a</p> <pre><code>TeXDict begin 39158280 55380996 1000 600 600 (test.dvi)\n@start /Fa 136[60 4[33 2[42 2[23 6[37 46 27[62 22[42\n4[23 10[23 33[{}10 83.022 /CMR10 rf end\n%%EndProlog\n%%BeginSetup\n%%Feature: *Resolution 600dpi\nTeXDict begin\n%%BeginPaperSize: a4\n/setpagedevice where\n{ pop &lt;&lt; /PageSize [595 842] &gt;&gt; setpagedevice }\n{ /a4 where { pop a4 } if }\nifelse\n%%EndPaperSize\n end\n%%EndSetup\n%%Page: 1 1\nTeXDict begin 1 0 bop 166 83 a Fa(Hello,)28 b(w)n(orld!)1929\n5539 y(1)p eop end\n%%Trailer\n\nuserdict /end-hook known{end-hook}if\n%%EOF\n</code></pre> <p>\u770b\u5230\u8fd9\u4e2a\uff0c\u80af\u5b9a\u89c9\u5f97\u5f88\u7591\u60d1\uff0c\u8fd9\u90fd\u662f\u5565\uff1f\u9664\u4e86\u9690\u7ea6\u53ef\u4ee5\u770b\u5230\u7684 <code>Hello,</code> <code>w</code> <code>orld!</code> \u5b57\u6837\u4ee5\u5916\uff0c\u6709\u5f88\u591a\u4e0d\u660e\u542b\u4e49\u7684\u5b57\u6bcd\u548c\u4ee3\u7801\u3002</p> <p>\u4e3a\u4e86\u8bfb\u61c2\u8fd9\u4e9b\u4ee3\u7801\u5728\u505a\u4ec0\u4e48\uff0c\u9996\u5148\u6765\u5b66\u4e60\u4e00\u4e0b PostScript\u3002PostScript \u662f\u4e00\u4e2a\u57fa\u4e8e\u6808\u7684\u8bed\u8a00\uff0c\u7c7b\u4f3c Forth\uff0c\u6240\u4ee5\u5f88\u591a\u8fd0\u7b97\u90fd\u548c\u6211\u4eec\u5e73\u65f6\u770b\u5230\u7684\u4e0d\u4e00\u6837\u3002\u4f8b\u5982\uff1a</p> <pre><code>userdict /end-hook known{end-hook}if\n</code></pre> <p>\u5b9e\u9645\u4e0a\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u5224\u65ad userdict \u4e2d\u662f\u5426\u5b58\u5728 <code>/end-hook</code>\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5219\u5c55\u5f00\u5b83\u3002\u5b83\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff1a</p> <pre><code>userdict\nuserdict /end-hook\nuserdict /end-hook known\ntrue\ntrue {end-hook}\ntrue {end-hook} if\nend-hook\n</code></pre> <p>\u90a3\u4e48\u56de\u8fc7\u5934\u6765\u770b <code>Hello, world!</code> \u76f8\u5173\u7684\u4ee3\u7801\uff1a</p> <pre><code>TeXDict begin 1 0 bop 166 83 a Fa(Hello,)28 b(w)n(orld!)1929\n5539 y(1)p eop end\n</code></pre> <p>\u8fd9\u91cc\u51fa\u73b0\u7684 <code>TeXDict</code> <code>bop</code> <code>a</code> \u7b49\u7b49\u5e94\u8be5\u4e5f\u662f\u5728\u524d\u9762\u5b9a\u4e49\u7684\u4e86\u3002\u5f80\u56de\u7ffb\uff0c\u53d1\u73b0\u6b63\u662f <code>tex.pro</code> \u6587\u4ef6\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u5bf9\u8c61\u3002\u8ba9\u6211\u4eec\u4e00\u70b9\u70b9\u6765\u770b\uff1a</p> <pre><code>/TeXDict 300 dict def   % define a working dictionary\n</code></pre> <p>\u8868\u793a <code>TexDict</code> \u4f1a\u5c55\u5f00\u4e3a <code>300 dict</code>\uff0c\u5373\u521b\u5efa\u4e00\u4e2a\u6700\u5927\u5bb9\u91cf\u4e3a 300 \u7684 dict\u3002\u63a5\u4e0b\u6765\u7684 begin \u548c end \u5c31\u662f\u5728\u8fd9\u4e2a dict \u7684\u4f5c\u7528\u57df\u4e2d\u8fdb\u884c\u8fd0\u7b97\u3002</p> <p>\u63a5\u4e0b\u6765\u662f <code>1 0 bop</code>\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u770b <code>bop</code> \u7684\u5b9a\u4e49\uff0c\u6839\u636e DVI \u4e2d\u540c\u540d\u7684\u547d\u4ee4\uff0c\u6211\u4eec\u77e5\u9053\u5b83\u7684\u610f\u601d\u662f <code>begin of page</code>:</p> <pre><code>/bop           % %t %d bop -  -- begin a brand new page, %t=pageno %d=seqno\n  {\n    userdict /bop-hook known { bop-hook } if\n    /SI save N\n    @rigin\n%\n%   Now we check the resolution.  If it's correct, we use RV as V,\n%   otherwise we use QV.\n%\n    0 0 moveto\n    /V matrix currentmatrix\n    A 1 get A mul exch 0 get A mul add .99 lt\n    {/QV} {/RV} ifelse load def\n    pop pop\n  } N\n</code></pre> <p>\u8fd9\u91cc\u6709\u4e00\u4e9b\u4ee3\u7801\u7684\u542b\u4e49\u6211\u8fd8\u4e0d\u6e05\u695a\uff0c\u5148\u8df3\u8fc7\u3002</p> <p>\u63a5\u4e0b\u6765\u7684 <code>166 83 a</code>\uff0c\u6839\u636e\u5b9a\u4e49\u5c31\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u5b83\u662f\u5728\u79fb\u52a8\u4f4d\u7f6e\uff1a</p> <pre><code>/a { moveto } B    % absolute positioning\n</code></pre> <p>\u7d27\u968f\u5176\u540e\u7684 <code>Fa</code> \u6307\u7684\u662f\u5b57\u4f53\u3002</p> <p>\u63a5\u4e0b\u6765\u662f <code>(Hello,)</code>\uff0c\u5373\u628a <code>Hello,</code> \u8fd9\u4e9b\u6587\u5b57\u538b\u5165\u6808\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u5230 <code>28 b</code>\uff0c\u5b83\u8f93\u51fa\u4e86\u6808\u9876\u7684\u6587\u672c\uff0c\u8fdb\u884c\u4e86\u4e00\u4e2a\u76f8\u5bf9\u7684\u6c34\u5e73\u79fb\u52a8\uff0c\u5e76\u4e14\u66f4\u65b0\u4e86 delta\uff1a</p> <pre><code>/delta 0 N         % we need a variable to hold space moves\n%\n%   The next ten macros allow us to make horizontal motions that\n%   are within 4 of the previous horizontal motion with a single\n%   character.  These are typically used for spaces.\n%\n/tail { A /delta X 0 rmoveto } B\n/M { S p delta add tail } B\n/b { S p tail } B      % show and tail!\n</code></pre> <p>\u540e\u9762\u7684\u4e5f\u90fd\u662f\u7c7b\u4f3c\u7684\u64cd\u4f5c\uff0c\u8ba9\u6211\u4eec\u7b80\u5355\u6765\u603b\u7ed3\u4e00\u4e0b <code>TeXDict begin 1 0 bop 166 83 a Fa(Hello,)28 b(w)n(orld!)1929 5539 y(1)p eop end</code> \u90fd\u505a\u4e86\u4ec0\u4e48\uff1a</p> <ol> <li><code>1 0 bop</code>: \u521b\u5efa\u4e86\u65b0\u9875\u9762</li> <li><code>166 83 a</code>: \u79fb\u52a8\u5750\u6807\u5230 <code>(166, 83)</code></li> <li><code>Fa</code>: \u8bbe\u7f6e\u5b57\u4f53</li> <li><code>(Hello,)</code>: \u538b\u6808 \"Hello,\"</li> <li><code>28 b</code>: \u8f93\u51fa\u6808\u9876\uff0c\u79fb\u52a8\u5750\u6807\uff0c\u5bf9\u5e94 <code>dviasm</code> \u8f93\u51fa\u4e2d\u7684 <code>right: 3.333328pt</code></li> <li><code>(w)</code>: \u538b\u6808 \"w\"</li> <li><code>n</code>: \u8f93\u51fa\u6808\u9876\uff0c\u79fb\u52a8\u5750\u6807\uff0c\u5bf9\u5e94 <code>dviasm</code> \u8f93\u51fa\u4e2d\u7684 <code>right: -0.277786pt</code></li> <li><code>(orld!)</code>: \u538b\u6808 \"orld!\"</li> <li><code>1929 5539 y</code>: \u8f93\u51fa\u6808\u9876\uff0c\u79fb\u52a8\u5750\u6807\u5230\u9875\u7801\u7684\u4f4d\u7f6e\uff0c\u5bf9\u5e94 <code>dviasm</code> \u8f93\u51fa\u4e2d\u7684 <code>down: 24pt</code> \u548c <code>right: 232.377487.pt</code></li> <li><code>(1)</code>: \u538b\u6808 \"1\"</li> <li><code>p</code>: \u8f93\u51fa\u6808\u9876</li> <li><code>eop</code>: \u7ed3\u675f\u9875\u9762</li> </ol> <p>\u7531\u6b64\u6211\u4eec\u57fa\u672c\u660e\u767d\u4e86\u4ece DVI \u5230 PS \u662f\u600e\u4e48\u4e00\u4e2a\u6d41\u7a0b\uff1a</p> <ol> <li>\u9996\u5148\u5728 <code>tex.pro</code> \u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e9b\u51fd\u6570\uff0c\u6765\u5b9e\u73b0 DVI \u4e2d\u7684\u547d\u4ee4</li> <li>\u628a DVI \u4e2d\u7684\u547d\u4ee4\u7ffb\u8bd1\u6210 PS \u4ee3\u7801</li> <li>\u628a <code>tex.pro</code>\u3001\u5b57\u4f53\u7b49\u8fd8\u6709\u7ffb\u8bd1\u51fa\u6765\u7684 PS \u62fc\u63a5\u8d77\u6765\u4f5c\u4e3a\u6700\u7ec8\u7684\u8f93\u51fa</li> </ol> <p>\u8fd9\u7b97\u662f\u4e00\u79cd\u5143\u7f16\u7a0b\uff0c\u5728 PS \u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a DSL\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u6267\u884c DVI \u6307\u4ee4\u3002</p> <p>\u5728 \u8fd9\u91cc \u53ef\u4ee5\u770b\u5230\u539f\u59cb\u7684\u5e26\u6ce8\u91ca\u7684 <code>tex.lpro</code> \u5b9e\u73b0\uff0c\u4e0a\u9762\u6d89\u53ca <code>tex.pro</code> \u7684\u4ee3\u7801\u5185\u5bb9\u4e5f\u662f\u4ece\u8fd9\u91cc\u590d\u5236\u6765\u7684\u3002</p>","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2022/08/05/from-tex-to-pdf/#\u4ece-ps-\u5230-pdf","title":"\u4ece PS \u5230 PDF","text":"<p>\u6700\u540e\u4e00\u6b65\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 <code>ps2pdf</code> \u628a PS \u8f6c\u6362\u4e3a PDF\u3002\u8f6c\u6362\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u7528\u5e38\u89c1\u7684 PDF \u6d4f\u89c8\u5668\u6765\u9605\u8bfb\u4e86\u3002\u8ba9\u6211\u4eec\u89e3\u538b\u7f29\u5176\u4e2d\u88ab\u538b\u7f29\u7684\u90e8\u5206\uff0c\u8fd9\u6837\u5c31\u65b9\u4fbf\u9605\u8bfb\u5b83\u7684\u5185\u5bb9\u4e86\uff1a</p> <pre><code>ps2pdf test.ps\npdftk test.pdf output test.unc.pdf uncompress\n</code></pre> <p>\u5728\u91cc\u9762\u5c31\u53ef\u4ee5\u627e\u5230\u6211\u4eec\u7684 <code>Hello, world!</code> \u4e86\uff1a</p> <pre><code>5 0 obj\n\n&lt;&lt;\n/Length 225\n&gt;&gt;\nstream\nq 0.1 0 0 0.1 0 0 cm\n0 g\nq\n10 0 0 10 0 0 cm BT\n/R7 9.96264 Tf\n1 0 0 1 91.9199 710.04 Tm\n[(H)3.21024(e)-1.66516(llo)-5.88993(,)-337.276(w)23.3747(o)-5.88993(r)-6.48419(ld)0.929988(!)]TJ\n211.56 -654.72 Td\n[(1)-5.8887]TJ\nET\nQ\nQ\n\nendstream\nendobj\n</code></pre> <p>\u9605\u8bfb PDF \u6807\u51c6\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u7684\u8f93\u51fa\u6587\u672c\u90e8\u5206\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code>BT\n    /R7 9.96264 Tf\n    1 0 0 1 91.9199 710.04 Tm\n    [(H)3.21024(e)-1.66516(llo)-5.88993(,)-337.276(w)23.3747(o)-5.88993(r)-6.48419(ld)0.929988(!)]TJ\n    211.56 -654.72 Td\n    [(1)-5.8887]TJ\nET\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ol> <li><code>/R7 9.96264 Tf</code> \u8bbe\u7f6e\u4e86\u5b57\u4f53 <code>/R7</code>\uff0c\u5927\u5c0f\u662f <code>9.96264</code></li> <li><code>1 0 0 1 91.9199 710.04 Tm</code> \u8bbe\u7f6e Text matrix</li> <li><code>[(H)3.21024(e)-1.66516(llo)-5.88993(,)-337.276(w)23.3747(o)-5.88993(r)-6.48419(ld)0.929988(!)]TJ</code> \u8f93\u51fa\u4e00\u7cfb\u5217\u7684 <code>Hello, world!</code>\uff0c\u4e2d\u95f4\u7684\u6570\u5b57\u8868\u793a\u7684\u662f\u6587\u5b57\u4e4b\u95f4\u79fb\u52a8\u7684\u5750\u6807</li> <li><code>211.56 -654.72 Td</code> \u79fb\u52a8\u5750\u6807\u5230\u9875\u7801\u7684\u4f4d\u7f6e</li> <li><code>[(1)-5.8887]TJ</code> \u8f93\u51fa\u9875\u7801</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4ece PS \u5230 PDF \u8fd9\u4e00\u6b65\u5c31\u4e0d\u662f\u7b80\u5355\u7684\u6620\u5c04\u4e86\uff0c\u4f8b\u5982\u5728 DVI \u548c PS \u4e2d\u90fd\u662f <code>Hello,</code> <code>w</code> <code>orld!</code> \u8fd9\u6837\u65ad\u5f00\uff0c\u800c\u5728 PDF \u91cc\u9762\u5219\u662f <code>H</code> <code>e</code> <code>llo</code> <code>,</code> <code>w</code> <code>o</code> <code>r</code> <code>ld</code> <code>!</code>\u3002</p>","tags":["tex","latex","ps","dvi","pdf"]},{"location":"software/2019/04/30/get-resolvers-in-c/","title":"\u5728 Linux \u4e2d\u7528 C \u4ee3\u7801\u83b7\u53d6 DNS \u670d\u52a1\u5668\u5217\u8868","text":"<p>\u6700\u8fd1\u5728\u505a\u4e00\u4e2a\u4f5c\u4e1a\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u91cc\u9762\u6709\u4e2a\u6b65\u9aa4\u662f\u83b7\u53d6 Linux \u7cfb\u7edf\u4e2d\u7684 DNS \u670d\u52a1\u5668\u5217\u8868\uff0c\u5b83\u7684\u65b9\u6cd5\u5f88\u7c97\u66b4\uff0c\u76f4\u63a5 cat grep cut \u518d\u5904\u7406\u3002\u6211\u5c31\u5728\u60f3\u6709\u6ca1\u6709\u5b8c\u5168\u4ee3\u7801\u7684\u5b9e\u73b0\uff0c\u7136\u540e\u641c\u4e86\u4e00\u4e0b\uff0c\u679c\u7136\u6709\uff1a</p> <pre><code>#include &lt;resolv.h&gt;\n// ...\nres_init();\n// _res.nsaddr_list is an array of resolvers\n</code></pre> <p>\u7528\u5230\u4e86\u5168\u5c40\u53d8\u91cf <code>_res</code> \uff0c\u867d\u7136\u5f88 hacky\uff0c\u4f46\u662f\u81f3\u5c11\u662f\u5de5\u4f5c\u7684\uff0c\u4e0d\u6e05\u695a\u517c\u5bb9\u6027\u51e0\u4f55\u3002</p>","tags":["libc","linux","c","dns"]},{"location":"software/2021/03/13/gnome-fractional-scaling/","title":"Gnome \u7684 Fractional Scaling","text":"","tags":["gnome","scaling","x11","wayland","xwayland"]},{"location":"software/2021/03/13/gnome-fractional-scaling/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u53d1\u73b0\u90e8\u5206\u8f6f\u4ef6\uff08\u5305\u62ec Google Chrome\uff0cFirefox \u548c Visual Studio Code\uff09\u5728 125% \u7684 Fractional Scaling \u6a21\u5f0f\u4e0b\u4f1a\u5f88\u5361\u3002\u627e\u5230\u4e86\u4e00\u4e9b\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5\uff0c\u4f46\u662f\u5f88\u4e0d\u4f18\u96c5\uff0c\u4e5f\u5f88\u9ebb\u70e6\u3002\u6240\u4ee5\u6df1\u5165\u7814\u7a76\u4e86\u4e00\u4e0b Fractional Scaling \u7684\u5de5\u4f5c\u65b9\u5f0f\u3002</p>","tags":["gnome","scaling","x11","wayland","xwayland"]},{"location":"software/2021/03/13/gnome-fractional-scaling/#\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5","title":"\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u6839\u636e\u5173\u952e\u5b57\uff0c\u627e\u5230\u4e86 Chrome menus too slow after enabling fractional scaling in Ubuntu 20.04\u3002\u6309\u5b83\u7684\u65b9\u6cd5\uff0c\u5173\u95ed Google Chrome \u7684\u786c\u4ef6\u52a0\u901f\uff0c\u53d1\u73b0\u5361\u987f\u95ee\u9898\u786e\u5b9e\u89e3\u51b3\u4e86\u3002</p> <p>\u7c7b\u4f3c\u5730\uff0c\u4e5f\u53ef\u4ee5\u5173\u95ed VSCode \u7684\u786c\u4ef6\u52a0\u901f\uff0c\u5728 Firefox \u91cc\u4e5f\u53ef\u4ee5\u627e\u5230\u76f8\u5e94\u7684\u8bbe\u7f6e\u3002\u8fd9\u6837\u64cd\u4f5c\u786e\u5b9e\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u51fa\u95ee\u9898\u7684\u5e94\u7528\u90fd\u8fd9\u6837\u641e\u4e00\u904d\uff0c\u8fd8\u662f\u633a\u9ebb\u70e6\u7684\u3002</p> <p>\u53e6\u4e00\u4e2a\u601d\u8def\u662f\uff0c\u4e0d\u4f7f\u7528 Fractional Scaling\uff0c\u800c\u53ea\u662f\u628a\u5b57\u4f53\u53d8\u5927\u3002\u4f46\u6bd5\u7adf\u548c\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u4e0d\u5927\u4e00\u6837\u3002</p>","tags":["gnome","scaling","x11","wayland","xwayland"]},{"location":"software/2021/03/13/gnome-fractional-scaling/#\u4e00\u4e9b\u53d1\u73b0","title":"\u4e00\u4e9b\u53d1\u73b0","text":"<p>\u5728\u7269\u7406\u673a\u8fdb\u884c\u4e86\u4e00\u4e9b\u5b9e\u9a8c\u4ee5\u540e\uff0c\u53d1\u73b0\u4e00\u4e2a\u73b0\u8c61\uff1a125% \u7684\u65f6\u5019\u5361\u987f\uff0c\u800c\u5176\u4ed6\u6bd4\u4f8b\uff08100%\uff0c150%\uff0c175%\uff0c200%\uff09\u90fd\u4e0d\u5361\u987f\u3002</p> <p>\u7f51\u4e0a\u4e00\u987f\u641c\u5230\uff0c\u627e\u5230\u4e86 xrandr \u5de5\u5177\u3002\u4e0b\u9762\u662f\u89c2\u5bdf\u5230\u7684\u4e00\u4e9b\u73b0\u8c61\uff08GNOME \u8bbe\u7f6e\u5206\u8fa8\u7387\u4e00\u76f4\u662f 1920x1080\uff09\uff1a</p> \u653e\u7f29\u6bd4\u4f8b xrandr \u663e\u793a\u7684\u5206\u8fa8\u7387 xrandr \u663e\u793a\u7684 transform 100% 1920x1080 diag(1.0, 1.0, 1.0) 125% 3072x1728 diag(1.6, 1.6, 1.0) 150% 2560x1440 diag(1.33, 1.33, 1.0) 175% 2208x1242 diag(1.15, 1.15, 1.0) 200% 1920x1080 diag(1.0, 1.0, 1.0) <p>\u5728 xrandr \u6587\u6863 \u4e2d\uff0c\u5199\u4e86\uff1atransform \u662f\u4e00\u4e2a 3x3 \u77e9\u9635\uff0c\u77e9\u9635\u4e58\u4ee5\u8f93\u51fa\u7684\u70b9\u7684\u5750\u6807\u5f97\u5230\u56fe\u5f62\u7f13\u5b58\u91cc\u9762\u7684\u5750\u6807\u3002</p> <p>\u7531\u6b64\u53ef\u4ee5\u731c\u60f3\uff1afractional scaling \u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff0c\u628a\u7ed8\u5236\u7684 buffer \u8c03\u5927\uff0c\u7136\u540e\u518d\u7528 transform \u628a\u6700\u7ec8\u8f93\u51fa\u5206\u8fa8\u7387\u8c03\u6210 1920x1080\u3002\u53ef\u4ee5\u770b\u5230\uff0cxrandr \u663e\u793a\u7684\u5206\u8fa8\u7387\u9664\u4ee5 transform \u5bf9\u5e94\u7684\u503c\uff0c\u5c31\u662f 1920x1080\u3002\u4f46\u8fd9\u5e76\u4e0d\u80fd\u89e3\u91ca 100% \u548c 200% \u7684\u533a\u522b\uff0c\u6240\u4ee5\u80af\u5b9a\u8fd8\u6f0f\u4e86\u4ec0\u4e48\u4fe1\u606f\u3002</p> <p>\u7ffb\u4e86\u7ffb mutter \u5b9e\u73b0 fractional scaling \u7684 pr\uff0c\u627e\u5230\u4e86\u5b9e\u73b0 scale \u7684\u4e00\u90e8\u5206\uff1a</p> <pre><code>if (clutter_actor_get_resource_scale (priv-&gt;actor, &amp;resource_scale) &amp;&amp;\n    resource_scale != 1.0f)\n  {\n    float paint_scale = 1.0f / resource_scale;\n    cogl_matrix_scale (&amp;modelview, paint_scale, paint_scale, 1);\n  }\n</code></pre> <p>\u7136\u540e\u627e\u5230\u4e86\u4e00\u6bb5\u5bf9 scale \u505a ceiling \u7684\u4ee3\u7801\uff1a</p> <pre><code>if (_clutter_actor_get_real_resource_scale (priv-&gt;actor, &amp;resource_scale))\n  {\n    ceiled_resource_scale = ceilf (resource_scale);\n    stage_width *= ceiled_resource_scale;\n    stage_height *= ceiled_resource_scale;\n  }\n</code></pre> <p>\u8fd9\u6837\uff0c100% \u548c\u5176\u4ed6\u6bd4\u4f8b\u5c31\u533a\u5206\u5f00\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u4e5f\u5728\u4ee3\u7801 \u4e2d\u53d1\u73b0\uff1a</p> <pre><code>#define SCALE_FACTORS_PER_INTEGER 4\n#define SCALE_FACTORS_STEPS (1.0 / (float) SCALE_FACTORS_PER_INTEGER)\n#define MINIMUM_SCALE_FACTOR 1.0f\n#define MAXIMUM_SCALE_FACTOR 4.0f\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u89c4\u5b9a\u4e86\u6bd4\u4f8b\u53ea\u80fd\u662f 25% \u7684\u500d\u6570\u3002</p> <p>\u6211\u4e5f\u8bd5\u4e86\u4e00\u4e0b\u7528 xrandr --scale 1.5x1.5\uff1a\u6548\u679c\u5c31\u662f\u7a97\u53e3\u770b\u8d77\u6765\u90fd\u66f4\u5c0f\u4e86\uff0c\u5206\u8fa8\u7387\u53d8\u6210\u4e86 2880x1620\uff0ctransform \u662f diag(1.5, 1.5, 1.0)\u3002</p>","tags":["gnome","scaling","x11","wayland","xwayland"]},{"location":"software/2021/03/13/gnome-fractional-scaling/#\u865a\u62df\u673a\u6d4b\u8bd5","title":"\u865a\u62df\u673a\u6d4b\u8bd5","text":"<p>\u63a5\u7740\uff0c\u7528\u865a\u62df\u673a\u505a\u4e86\u4e00\u4e9b\u6d4b\u8bd5\u3002\u4e3a\u4e86\u5728 GNOME over Wayland \u4e0a\u4f7f\u7528 fractional scaling\uff0c\u9700\u8981\u8fd0\u884c\uff1a</p> <pre><code>$ gsettings set org.gnome.mutter experimental-features \"['scale-monitor-framebuffer']\"\n</code></pre> <p>\u63a5\u7740\u53c8\u505a\u4e86\u7c7b\u4f3c\u4e0a\u9762\u7684\u6d4b\u8bd5\uff08GNOME \u8bbe\u7f6e\u5206\u8fa8\u7387\u4e00\u76f4\u662f 2560x1600\uff09\uff1a</p> \u653e\u7f29\u6bd4\u4f8b xrandr \u663e\u793a\u7684\u5206\u8fa8\u7387 100% 2560x1600 125% 2048x1280 150% 1704x1065 175% 1464x915 200% 1280x800 <p>\u5728\u8fd9\u4e2a\u6d4b\u8bd5\u4e2d\uff0cxrandr \u663e\u793a\u7684 transform \u4e00\u76f4\u90fd\u662f\u5355\u4f4d\u77e9\u9635\uff1b\u8fd8\u7528\u4e86\u6765\u81ea xyproto/wallutils \u7684 <code>wayinfo</code> \u547d\u4ee4\u67e5\u770b\u8f93\u51fa\u7684\u5206\u8fa8\u7387\uff0c\u4e00\u76f4\u662f 2560x1600\uff0cDPI \u4e00\u76f4\u662f 96\u3002\u7528 wallutils \u7684 xinfo \u770b\u5230\u7684\u7ed3\u679c\u548c xrandr \u4e00\u81f4\uff08\u901a\u8fc7 XWayland\uff09\u3002\u4f46\u662f\u548c\u7269\u7406\u673a\u6709\u4e00\u70b9\u4e0d\u540c\uff1a\u7269\u7406\u673a\u6709\u4e00\u4e2a\u9009\u9879\u95ee\u8981\u4e0d\u8981\u6253\u5f00 fractional scaling\uff0c\u4e0b\u9762\u8fd8\u4f1a\u63d0\u793a\u6027\u80fd\u4e0b\u964d\u7684\u95ee\u9898\uff1b\u4f46\u662f\u865a\u62df\u673a\u4e0a\u5e76\u6ca1\u6709\u8fd9\u4e2a\u63d0\u793a\uff0c\u800c\u662f\u76f4\u63a5\u7ed9\u4e86\u4e00\u4e9b Scale \u6bd4\u4f8b\u7684\u9009\u9879\u3002</p> <p>\u5c1d\u8bd5\u4e86\u4e00\u4e0b\uff0c\u5728 GNOME over X11 \u4e0a\u662f\u627e\u4e0d\u5230 fractional scaling \u7684\uff08\u6ca1\u6709\u51fa\u73b0\u8bbe\u7f6e scale \u7684\u9009\u9879\uff09\u3002\u627e\u5230\u4e00\u4e2a\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u7684 fork\uff1ahttps://github.com/puxplaying/mutter-x11-scaling\uff0c\u4e0d\u8fc7\u6ca1\u6709\u5c1d\u8bd5\u8fc7\u3002</p> <p>\u6211\u4e5f\u5c1d\u8bd5\u5728\u865a\u62df\u673a\u4e2d\u7528 xrandr --scale\uff0c\u7ed3\u679c\u5c31\u662f\u8f93\u51fa\u9ed1\u5c4f\uff0c\u9700\u8981\u91cd\u542f gdm \u6765\u6062\u590d\u5230\u767b\u5f55\u754c\u9762\u3002</p> <p>\u66f4\u65b0\uff1a\u7531\u4e8e\u7269\u7406\u673a\u4f7f\u7528\u7684\u662f Ubuntu\uff0c\u60f3\u5230\u662f\u4e0d\u662f Ubuntu \u91c7\u7528\u4e86\u4e0a\u9762\u90a3\u4e2a fork \u7684 patch\uff0c\u7136\u540e\u5c31\u5728 changelog \u4e2d\u770b\u5230\uff1a</p> <pre><code>mutter (3.38.1-1ubuntu1) groovy; urgency=medium\n\n  * Merge with debian, including new upstream version, remaining changes:\n    - debian/gbp.conf: update upstream branch to point to ubuntu/master\n    - debian/patches/x11-Add-support-for-fractional-scaling-using-Randr.patch:\n      + X11: Add support for fractional scaling using Randr\n  * d/p/clutter-backend-x11-Don-t-set-the-font-dpi-computed-on-X1.patch:\n    - Dropped, applied upstream\n</code></pre> <p>\u4e5f\u627e\u5230\u4e86\u5bf9\u5e94\u7684 patch \u6587\u4ef6\u3002\u8fd9\u4e5f\u5c31\u89e3\u91ca\u4e86\uff0c\u4e3a\u4ec0\u4e48\u7f51\u4e0a\u4f1a\u8bf4 GNOME over X11 \u652f\u6301 fractional scaling\uff0c\u5e76\u4e14\u9700\u8981\u7528 gsettings \u6253\u5f00\uff0c\u800c\u6211\u5728 Debian \u548c Arch Linux \u4e0a\u8bbe\u7f6e\u8fd9\u4e2a\u9009\u9879\u4e5f\u6ca1\u6709\u7528\u4e86\u3002\u539f\u6765\u662f Ubuntu \u52a0\u7684\u79c1\u8d27\u554a\u3002</p> <p>\u5728 patch \u4e2d\uff0c\u627e\u5230\u4e86\u8fd9\u4e48\u4e00\u6bb5\u914d\u7f6e\u7684\u89e3\u91ca\uff1a</p> <pre><code>+    &lt;key name=\"fractional-scale-mode\" enum=\"org.gnome.mutter.X11.scale-mode\"&gt;\n+      &lt;default&gt;\"scale-ui-down\"&lt;/default&gt;\n+      &lt;description&gt;\n+        Choose the scaling mode to be used under X11 via Randr extension.\n+\n+        Supported methods are:\n+\n+        \u2022 \u201cscale-up\u201d     \u2014 Scale everything up to the requested scale, shrinking\n+                           the UI. The applications will look blurry when scaling\n+                           at higher values and the resolution will be lowered.\n+        \u2022 \u201cscale-ui-down \u2014 Scale up the UI toolkits to the closest integer\n+                           scaling value upwards, while scale down the display\n+                           to match the requested scaling level.\n+                           It increases the resolution of the logical display.\n+      &lt;/description&gt;\n+    &lt;/key&gt;\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u91ca\u524d\u9762\u770b\u5230\u7684\u73b0\u8c61\u4e86\uff1a\u9ed8\u8ba4\u662f <code>scale-ui-down</code>\uff0c\u4e5f\u5c31\u662f\u5148\u653e\u5927\u5230\u4e24\u500d\uff08closest integer scaling value upwards\uff09\uff0c\u518d\u7f29\u5c0f\uff08scale down the display to match the requested scaling level\uff09\u3002</p>","tags":["gnome","scaling","x11","wayland","xwayland"]},{"location":"software/2018/11/27/grafana-influxdb-telegraf-miio/","title":"\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90","text":"<p>\u4e4b\u524d\u4e00\u76f4\u60f3\u914d\u4e00\u4e2a\u76d1\u63a7\u7cfb\u7edf\uff0c\u73b0\u5728\u6709\u673a\u4f1a\u4e86\uff0c\u5c31\u7b80\u5355\u914d\u4e86\u4e00\u4e0b\u3002\u53d1\u73b0\u771f\u7684\u7279\u522b\u7b80\u5355\uff0c\u7528 Homebrew \u5b89\u88c5\u8fd9\u4e09\u4e2a\u8f6f\u4ef6\u5e76\u4e14\u90fd\u8dd1\u8d77\u6765\uff0c\u7136\u540e\u7a0d\u5fae\u52a8\u4e00\u4e0b\u914d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u53ef\u89c2\u7684\u6548\u679c\u4e86\u3002</p> <p>\u7136\u540e\u60f3\u5229\u7528 miio \u914d\u7f6e\u4e00\u4e0b\uff0c\u628a\u5bbf\u820d\u7684\u7a7a\u6c14\u51c0\u5316\u5668\u5404\u9879\u53c2\u6570\u62ff\u5230\uff0c\u4ee5 Telegraf \u7684\u63d2\u4ef6\u5f62\u5f0f\u5b9a\u65f6\u4e0a\u62a5\uff0c\u7136\u540e\u901a\u8fc7 Grafana \u8fdb\u884c\u53ef\u89c6\u5316\u3002\u63d2\u4ef6\u653e\u5728\u4e86 jiegec/tools \u4e0b\uff0c\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684 Python \u811a\u672c\u3002\u914d\u7f6e\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p>\u7f16\u8f91 <code>/usr/local/etc/telegraf.d/miio.conf</code>\uff1a</p> <pre><code>[[inputs.exec]]\n    commands = [\"/usr/local/bin/python3 /Volumes/Data/tools/telegraf/miio.py MIID_HERE\"]\n    timeout = \"5s\"\n    data_format = \"influx\"\n</code></pre> <p>\u9ed8\u8ba4\u4e86 miio \u8def\u5f84\u4e3a <code>/usr/local/bin/miio</code> \u3002</p>","tags":["macos","grafana","influxdb","telegraf","miio"]},{"location":"software/2019/01/13/grafana-influxdb-visualize-ping/","title":"Grafana \u4e2d\u53ef\u89c6\u5316 Ping \u65f6\u628a Timeout \u663e\u793a\u4e3a\u6307\u5b9a\u503c","text":"<p>\u521a\u9047\u5230\u4e00\u4e2a\u9700\u6c42\uff0c\u5c31\u662f\u7528 Telegraf \u6536\u96c6 ping \u4fe1\u606f\uff0c\u7136\u540e\u5728 Grafana \u91cc\u53ef\u89c6\u5316\u5f53\u524d\u7684\u5ef6\u8fdf\uff0c\u5982\u679c\u8d85\u65f6\u4e86\uff0c\u5c31\u663e\u793a\u4e00\u4e2a\u6307\u5b9a\u503c\uff0c\u5982 999\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u653e\u5230\u4e00\u4e2a Gauge \u91cc\u9762\u53ef\u89c6\u5316\u4e86\u3002\u4f46\u662f\uff0c\u95ee\u9898\u5728\u4e8e\uff0cTelegraf \u7684 ping input \u5728\u8d85\u65f6\u7684\u65f6\u5019\u53ea\u4f1a\u5728 result_code \u91cc\u5199\u4e00\u4e2a 2 \uff0c\u5176\u4ed6\u9879\u90fd\u662f\u7a7a\u7684\uff0c\u56e0\u800c\u5982\u679c\u76f4\u63a5\u7528 GROUP BY time(interval) fill(999) \u4f1a\u5bfc\u81f4\u6700\u65b0\u7684\u4e00\u4e2a\u6570\u636e\u7ecf\u5e38\u5f97\u5230 999\u3002\u8fd9\u610f\u5473\u7740\u9700\u8981\u6839\u636e \"result_code\" \u6765\u8fdb\u884c\u533a\u5206 Timeout \u7684\u60c5\u51b5\u3002\u6700\u540e\u6363\u817e\u4e86\u5f88\u4e45\uff0c\u5f97\u5230\u4e86\u8fd9\u4e2a\u65b9\u6848\uff1a</p> <pre><code> select \"average_response_ms\" * (2 - \"result_code\") / 2 + \"result_code\" / 2 * 999 from (select \"average_response_ms\", \"result_code\" from ping where $timeFilter fill(0))\n</code></pre> <p>\u6700\u540e\u7684\u65b9\u6cd5\u5f88\u7c97\u7cd9\uff1a\u5f53 \"result_code\" \u662f 0 \u4e5f\u5c31\u662f\u6210\u529f\u7684\u65f6\u5019\uff0c\u5f97\u5230\u5ef6\u8fdf\uff0c\u800c\u5f53 \"result_code\" \u662f 2 \u4e5f\u5c31\u662f\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u5f97\u5230 999\u3002\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002</p>","tags":["grafana","influxdb","telegraf"]},{"location":"software/2019/01/10/grafana-variable-regex-exclusion/","title":"Grafana Variable \u7684 regex \u8fc7\u6ee4\u65b9\u5f0f","text":"<p>\u7528 InfluxDB \u6536\u96c6\u5230 Mountpoint \u6570\u636e\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u4f1a\u63ba\u6742\u4e00\u4e9b\u4e0d\u5173\u5fc3\u7684\uff0c\u5982 TimeMachine\uff0cKSInstallAction \u548c AppTranslocation \u7b49\u7b49\u3002\u6240\u4ee5\uff0c\u4e3a\u4e86\u5728 Variables \u91cc\u8fc7\u6ee4\u6389\u4ed6\u4eec\uff0c\u9700\u8981\u7528 Regex \u8fdb\u884c\u5904\u7406\u3002\u7f51\u4e0a\u6709\u4eba\u63d0\u4f9b\u4e86\u65b9\u6848\uff0c\u5c31\u662f\u901a\u8fc7 Negative Lookahead \u5b9e\u73b0\uff1a</p> <pre><code>/^(?!.*TimeMachine)(?!.*KSInstallAction)(?!.*\\/private)/\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4e0d\u60f3\u770b\u5230\u7684\u8fd9\u4e9b mountpoint \u9690\u85cf\uff0c\u8282\u7701\u9875\u9762\u7a7a\u95f4\u4e86\u3002\u5f53\u7136\u4e86\uff0c\u8fd9\u91cc\u5176\u5b9e\u4e5f\u53ef\u4ee5\u7528\u767d\u540d\u5355\u7684\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u76f4\u63a5\u5199 regex \u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["grafana","regex"]},{"location":"software/2018/12/07/grafana-visualize-vote18/","title":"Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009","text":"<p>\u6700\u8fd1\u8fd9\u6bb5\u65f6\u95f4\uff0c\u6e05\u534e\u5185\u90e8\u6b63\u5728\u6295\u7968\u9009\u51fa\u4eca\u5e74\u7684\u5e74\u5ea6\u4eba\u7269\uff0c\u60f3\u5230\u6700\u8fd1\u521a\u597d\u5728\u5b66\u4e60\u4f7f\u7528 Grafana+InfluxDB+Telegraf \u5168\u5bb6\u6876\uff0c\u4e8e\u662f\u60f3\u7740\u80fd\u4e0d\u80fd\u5199\u4e2a\u722c\u866b\u628a\u6570\u636e\u90fd\u62ff\u4e0b\u6765\uff0c\u7136\u540e\u7528 Grafana \u753b\u51fa\u6765\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6295\u7968\u968f\u65f6\u95f4\u53d8\u5316\u7684\u8d8b\u52bf\u3002\u722c\u866b\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u767b\u5f55\uff0c\u83b7\u53d6\u9875\u9762\u4fe1\u606f\uff0c\u7136\u540e\u6309\u7167 InfluxDB \u7684\u8f93\u5165\u683c\u5f0f\u8fdb\u884c\u8f93\u51fa\u5373\u53ef\u3002\u4ee3\u7801\u653e\u5728\u4e86 jiegec/student-tsinghua-vote18 \u4e0b\u3002</p> <p>\u63a5\u7740\u5c31\u662f\u7528 Grafana \u8fdb\u884c\u53ef\u89c6\u5316\uff0c\u5927\u6982\u5f97\u5230\u4e86\u8fd9\u6837\u4e00\u4e2a\u66f2\u7ebf\uff1a</p> <p></p> <p>\u4e3a\u4fdd\u62a4\u9690\u79c1\uff0c\u628a\u540d\u5b57\u9690\u53bb\u4e86\u3002\u5b9e\u9645\u4e0a\u7684\u6295\u7968\u65f6\u95f4\u662f\u4ece 12-3 \u53f7\u5f00\u59cb\u5230 12-7 \u53f7\u7ed3\u675f\uff0c\u4f46\u7531\u4e8e\u5bbf\u820d\u505c\u7535\u7684\u539f\u56e0\u6240\u4ee5\u91c7\u6837\u7684\u70b9\u5728\u534a\u591c\u7684\u65f6\u5019\u90fd\u6ca1\u6709\uff0c\u6240\u4ee5\u770b\u8d77\u6765\u6709\u70b9\u5947\u602a\uff0c\u4f46\u8fd8\u662f\u80fd\u591f\u53cd\u5e94\u603b\u4f53\u7684\u8d8b\u52bf\u7684\u3002\u6bd4\u5982\u53ef\u4ee5\u770b\u5230\u524d\u4e24\u540d\u5f88\u65e9\u5c31\u4e00\u9a6c\u5f53\u5148\uff0c\u800c\u540e\u4e00\u76f4\u9065\u9065\u9886\u5148\uff0c\u4e0b\u9762\u7684\u9009\u624b\u5219\u6392\u540d\u53d8\u52a8\u5f88\u5927\uff0c\u7279\u522b\u662f\u622a\u6b62\u524d\u6700\u540e\u4e00\u6bb5\u65f6\u95f4\uff0c\u5927\u5bb6\u90fd\u5728\u62fc\u547d\u62c9\u7968\uff0c\u53ef\u89c1\u5927\u5bb6\u90fd\u662f DDL \u9009\u624b\u554a\u3002\u5982\u679c\u5bf9\u4e0a\u9762\u8fd9\u4e2a\u56fe\u6c42\u4e2a\u5bfc\uff0c\u770b\u770b\u53d8\u5316\u7387\u7684\u8bdd\uff1a</p> <p></p> <p>\u8fd9\u663e\u73b0\u51fa\u4e86\u5f88\u6709\u610f\u601d\u7684\u4e00\u4e2a\u8d8b\u52bf\uff0c\u5c31\u662f\u6bcf\u5929\u5341\u4e8c\u70b9\u5de6\u53f3\u90fd\u6709\u4e00\u4e2a\u9ad8\u5cf0\u671f\uff0c\u7136\u540e\u5728\u96f6\u70b9\u524d\u5927\u6982\u7184\u706f\u9644\u8fd1\u7684\u65f6\u95f4\u4e5f\u662f\u4e00\u4e2a\u9ad8\u5cf0\u671f\uff0c\u53e6\u5916\u5c31\u662f\u622a\u6b62\u524d\u6700\u540e\u7684\u62a2\u7968\u9636\u6bb5\uff0c\u5927\u5bb6\u90fd\u5728\u75af\u72c2\u62c9\u7968\uff0c\u4ece\u4e2d\u5348\u62c9\u5230\u6700\u540e\u65f6\u523b\u3002\u7531\u4e8e\u505c\u7535\u7684\u539f\u56e0\uff0c\u5728\u96f6\u70b9\u9644\u8fd1\u7684\u6570\u636e\u90fd\u6bd4\u8f83\u7684\u9b3c\u755c\uff0c\u4e0d\u8fc7\u5f71\u54cd\u4e0d\u5927\uff0c\u8d8b\u52bf\u4e00\u76ee\u4e86\u7136\u3002</p> <p>Grafana \u771f\u9999\uff01\u671f\u671b\u53ef\u4ee5\u5b66\u5230\u66f4\u591a\u9ad8\u7aef\u7684\u67e5\u8be2\u8bed\u6cd5\u548c\u53ef\u89c6\u5316\u7684\u9a9a\u64cd\u4f5c\uff0c\u73b0\u5728\u6709\u5f88\u591a\u4e1c\u897f\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u53ef\u89c6\u5316\uff0c\u6bd4\u8f83\u82e6\u607c\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u4ec0\u4e48\u7ecf\u9a8c\u53ef\u4ee5\u5206\u4eab\u3002</p>","tags":["grafana","influxdb","telegraf","nodejs","scraper"]},{"location":"software/2018/12/13/homebridge-mi-aqara-telegraf/","title":"\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90","text":"<p>\u6700\u8fd1\u6709\u4e86\u8bbe\u5907\uff0c\u60f3\u628a\u8bbe\u5907\u62ff\u5230\u7684\u6570\u636e\u90fd\u5bfc\u4e00\u4efd\u5b58\u5230 influxdb \u91cc\uff0c\u4f46\u662f\u76ee\u524d\u627e\u5230\u7684\u53ea\u6709 homebridge-mi-aqara \u53ef\u4ee5\u8bbf\u95ee\u5e76\u62ff\u5230\u6570\u636e\uff0c\u7136\u540e\u5b83\u53c8\u63d0\u4f9b\u4e86 mqtt \u7684\u6570\u636e\u83b7\u53d6\u65b9\u6848\uff0c\u4e8e\u662f\u81ea\u5df1\u5199\u4e86\u4e2a\u811a\u672c\u53bb\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\u3002</p> <p>\u9996\u5148\u5f53\u7136\u662f\u914d\u7f6e\u4e00\u4e0b homebridge-mi-aqara\uff0c\u6309\u7167\u7f51\u4e0a\u7684\u6559\u7a0b\u6765\uff0c\u8fd9\u4e2a\u4e0d\u96be\u3002\u7136\u540e\u672c\u5730\u5f00\u4e00\u4e2a MQTT Broker\uff08\u5982 mosquitto\uff09\uff0c\u914d\u7f6e\u4e3a\u672c\u5730\u76d1\u542c\uff0c\u7136\u540e\u6211\u7f16\u5199\u4e86\u811a\u672c telegraf-mi-aqara.py \uff0c\u4f7f\u7528\u524d\u9700\u8981 <code>pip install paho-mqtt</code>\uff0c\u5e76\u4e14\u6309\u7167\u5b9e\u9645\u8def\u5f84\u4fee\u6539\u4e00\u4e0b\u5185\u5bb9\u3002\u9a8c\u8bc1\u80fd\u591f\u8dd1\u8d77\u6765\u540e\uff0c\u5199\u4e00\u4e2a telegraf \u914d\u7f6e\uff1a</p> <pre><code>[[inputs.exec]]\n        commands = [\"/usr/bin/python3 /path/to/telegraf-mi-aqara.py\"]\n        timeout = \"5s\"\n        data_format = \"influx\"\n</code></pre> <p>\u73b0\u5728\u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230\u5404\u9879\u4fe1\u606f\uff0c\u5982\u6e29\u5ea6\uff0c\u6e7f\u5ea6\uff0c\u662f\u5426\u5f00\u95e8\uff0c\u5f00\u5173\u7528\u7535\u60c5\u51b5\u7b49\u7b49\u3002</p> <p>2018-12-16 \u66f4\u65b0\uff1a</p> <p>\u7814\u7a76\u4e86\u4e00\u4e0b\u7eff\u7c73\u7f51\u5173\u5c40\u57df\u7f51\u901a\u4fe1\u534f\u8bae\uff0c\u5f97\u5230\u4e86\u7b2c\u4e8c\u4e2a\u7248\u672c telegraf-mi-aqara-v2.py\uff0c\u5b83\u4e0e\u7b2c\u4e00\u7248\u7684\u533a\u522b\u662f\uff0c\u7b2c\u4e00\u7248\u662f\u4e3b\u52a8\u5411\u7f51\u5173\u8bfb\u53d6\u4fe1\u606f\uff0c\u800c\u8fd9\u4e00\u7248\u5219\u662f\u76d1\u542c\u7ec4\u64ad\u5305\uff0c\u7b49\u5f85\u7f51\u5173\u53d1\u6d88\u606f\u3002\u8fd9\u4e2a\u811a\u672c\u8d1f\u8d23\u628a\u8bfb\u53d6\u5230\u7684\u7ec4\u64ad\u4fe1\u606f\u53d1\u9001\u5230 MQTT\uff0c\u518d\u8ba9 telegraf \u4ece MQTT \u91cc\u89e3\u6790 JSON \u6d88\u606f\uff0c\u5199\u5165\u6570\u636e\u5e93\u3002Telegraf \u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>[[inputs.mqtt_consumer]]\n        servers = [\"tcp://127.0.0.1:1883\"]\n        qos = 0\n        connection_timeout = \"30s\"\n        topics = [\n                \"/telegraf-mi-aqara\"\n        ]\n        persistent_session = true\n        client_id = \"Telegraf\"\n        data_format = \"json\"\n        json_string_fields = [\"model\", \"sid\", \"status\"]\n        tag_keys = [\"model\", \"sid\", \"short_id\"]\n</code></pre> <p>\u7531\u4e8e\u8bbe\u5907\u4e0d\u5168\uff0c\u6709\u4e9b\u5b57\u6bb5\u53ef\u80fd\u4e0d\u5b8c\u6574\u3002\u5982\u679c\u5927\u5bb6\u81ea\u5df1\u8981\u7528\u7684\u8bdd\uff0c\u53ef\u80fd\u9700\u8981\u81ea\u884c\u4fee\u6539\u4e00\u4e0b\u3002</p>","tags":["homebridge","mi","aqara","telegraf","influxdb"]},{"location":"software/2021/07/24/homebridge-rm-mini-3/","title":"\u914d\u7f6e homebridge-broadlink-rm-pro","text":"","tags":["homebridge","broadlink","rm"]},{"location":"software/2021/07/24/homebridge-rm-mini-3/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u53d1\u73b0\u7a7a\u8c03\u9065\u63a7\u5668\u7535\u6c60\u6709\u70b9\u4e0d\u8db3\uff0c\u6709\u65f6\u5019\u4f1a\u81ea\u52a8\u5173\u673a\uff0c\u4e8e\u662f\u62ff\u51fa\u4ee5\u524d\u4e70\u7684 Broadlink RM mini 3 \u5145\u5f53\u8fdc\u7a0b\u7684\u7a7a\u8c03\u9065\u63a7\u5668\u4f7f\u7528\u3002\u4e3a\u4e86\u65b9\u4fbf\u624b\u673a\u4e0a\u914d\u7f6e\uff0c\u5206\u522b\u91c7\u7528\u4e86\u5b98\u65b9\u7684 App \u667a\u6167\u661f\u548c homebridge \u8fdb\u884c\u914d\u7f6e\u3002</p>","tags":["homebridge","broadlink","rm"]},{"location":"software/2021/07/24/homebridge-rm-mini-3/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>\u9996\u5148\u7528\u5b98\u65b9\u7684\u667a\u6167\u661f\u914d\u7f6e\u597d Broadlink RM mini 3 \u7684\u7f51\u7edc\uff0c\u7136\u540e\u914d\u7f6e homebridge-broadlink-rm-pro\u3002\u6700\u65e9\u7684\u63d2\u4ef6\u4f5c\u8005\u4e0d\u600e\u4e48\u66f4\u65b0\u4e86\uff0c\u8fd9\u4e2a\u7248\u672c\u662f\u76ee\u524d\u7528\u7684\u6bd4\u8f83\u591a\u7684\u4e00\u4e2a fork\u3002</p> <p>\u5b89\u88c5\u597d\u4ee5\u540e\uff0c\u5728 Home \u91cc\u9762\u53ef\u4ee5\u770b\u5230 Scan Code \u7684\u5f00\u5173\u3002\u6253\u5f00\u4ee5\u540e\uff0c\u7528\u9065\u63a7\u5668\u5728 Broadlink RM mini 3 \u9644\u8fd1\u6309\u6309\u952e\uff0c\u5c31\u53ef\u4ee5\u5728 Homebridge \u65e5\u5fd7\u91cc\u770b\u5230 hex code \u4e86\u3002\u7136\u540e\uff0c\u5c31\u6309\u7167\u63d2\u4ef6\u6559\u7a0b\u91cc\u7684\u65b9\u6cd5\u5199\u914d\u7f6e\uff0c\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>{\n        \"platform\": \"BroadlinkRM\",\n        \"name\": \"Broadlink RM\",\n        \"accessories\": [\n        {\n                \"name\": \"Air Conditioner\",\n                \"type\": \"air-conditioner\",\n                \"noHumidity\": true,\n                \"minTemperature\": 26,\n                \"maxTemperature\": 28,\n                \"defaultCoolTemperature\": 27,\n                \"data\": {\n                        \"off\": \"2600...\",\n                        \"cool28\": {\n                                \"data\": \"2600...\"\n                        },\n                        \"cool27\": {\n                                \"data\": \"2600...\"\n                        },\n                        \"cool26\": {\n                                \"data\": \"2600...\"\n                        }\n                }\n        }]\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u624b\u673a\u4e0a\u65b9\u4fbf\u5730\u63a7\u5236\u7a7a\u8c03\u6e29\u5ea6\u4e86\u3002\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u53ef\u4ee5\u7528 Siri \u8bf4\u201c\u8bbe\u7f6e\u7a7a\u8c03\u4e3a XX \u5ea6\u201d\uff0c\u4e5f\u662f\u5b8c\u5168\u53ef\u4ee5\u5de5\u4f5c\u7684\u3002</p> <p>P.S. \u5c0f\u7c73\u7684\u7a7a\u6c14\u51c0\u5316\u5668\u73b0\u5728\u53ef\u4ee5\u7528\u63d2\u4ef6 https://github.com/torifat/xiaomi-mi-air-purifier#readme\uff0c\u4e4b\u524d\u535a\u5ba2\u91cc\u5199\u7684\u90a3\u4e00\u4e2a\u5df2\u7ecf\u4e0d\u66f4\u65b0\u4e86\u3002</p>","tags":["homebridge","broadlink","rm"]},{"location":"software/2022/07/06/install-nvidia-cuda/","title":"NVIDIA \u9a71\u52a8\u548c CUDA \u5b89\u88c5\u901f\u67e5","text":"","tags":["nvidia","cuda"]},{"location":"software/2022/07/06/install-nvidia-cuda/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728 Ubuntu \u4e0a\u914d\u7f6e NVIDIA \u9a71\u52a8\u548c CUDA \u73af\u5883\u7684\u6b21\u6570\u6bd4\u8f83\u591a\uff0c\u5728\u6b64\u603b\u7ed3\u4e00\u4e0b\u6574\u4e2a\u6d41\u7a0b\uff0c\u4f5c\u4e3a\u6559\u7a0b\u4f9b\u5927\u5bb6\u5b66\u4e60\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2022/07/06/install-nvidia-cuda/#\u914d\u7f6e-nvidia-apt-\u6e90","title":"\u914d\u7f6e NVIDIA APT \u6e90","text":"<p>Ubuntu \u6e90\u6709\u81ea\u5e26\u7684 NVIDIA \u9a71\u52a8\u7248\u672c\uff0c\u4f46\u8fd9\u91cc\u6211\u4eec\u8981\u4f7f\u7528 NVIDIA \u7684 APT \u6e90\u3002\u9996\u5148\uff0c\u6211\u4eec\u8981\u8bbf\u95ee https://developer.nvidia.com/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;Distribution=Ubuntu&amp;target_version=20.04&amp;target_type=deb_network\uff0c\u5728\u7f51\u9875\u4e2d\u9009\u62e9\u6211\u4eec\u7684\u7cfb\u7edf\uff0c\u4f8b\u5982\uff1a</p> <ol> <li>Operating System: Linux</li> <li>Architecture: x86_64</li> <li>Distribution: Ubuntu</li> <li>Version: 20.04</li> <li>Installer Type: deb (network)</li> </ol> <p>\u6b64\u65f6\uff0c\u4e0b\u9762\u5c31\u4f1a\u663e\u793a\u4e00\u4e9b\u547d\u4ee4\uff0c\u590d\u5236\u4e0b\u6765\u6267\u884c\uff1a</p> <pre><code>wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-keyring_1.0-1_all.deb\nsudo dpkg -i cuda-keyring_1.0-1_all.deb\nsudo apt-get update\n</code></pre> <p>\u6700\u540e\u4e00\u6b65\u7684 <code>sudo apt-get -y install cuda</code> \u53ef\u4ee5\u4e0d\u7740\u6025\u5b89\u88c5\uff0c\u6211\u4eec\u5728\u540e\u9762\u518d\u6765\u8ba8\u8bba CUDA \u7248\u672c\u7684\u95ee\u9898\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2022/07/06/install-nvidia-cuda/#nvidia-\u9a71\u52a8","title":"NVIDIA \u9a71\u52a8","text":"<p>\u914d\u7f6e\u597d\u6e90\u4ee5\u540e\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u8981\u5b89\u88c5 NVIDIA \u9a71\u52a8\u4e86\u3002\u9996\u5148\uff0c\u6211\u4eec\u8981\u9009\u53d6\u4e00\u4e2a NVIDIA \u7248\u672c\uff0c\u9009\u62e9\u7684\u6807\u51c6\u5982\u4e0b\uff1a</p> <ol> <li>\u9a71\u52a8\u7248\u672c\u9700\u8981\u652f\u6301\u6240\u4f7f\u7528\u7684\u663e\u5361</li> <li>\u9a71\u52a8\u7248\u672c\u9700\u8981\u652f\u6301\u6240\u4f7f\u7528\u7684 CUDA \u7248\u672c</li> </ol> <p>\u8fd9\u4e9b\u4fe1\u606f\u5728\u7f51\u7edc\u4e0a\u90fd\u53ef\u4ee5\u67e5\u5230\uff0c\u4e5f\u53ef\u4ee5\u53c2\u8003 NVIDIA \u9a71\u52a8\u548c CUDA \u7248\u672c\u4fe1\u606f\u901f\u67e5\u3002</p> <p>\u5047\u5982\u6211\u4eec\u5df2\u7ecf\u9009\u62e9\u4e86\u8981\u5b89\u88c5 470.129.06 \u7248\u672c\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u786e\u8ba4\u4e00\u4e0b NVIDIA \u7684 APT \u6e90\u7684\u7248\u672c\u540d\u79f0\uff1a</p> <pre><code>sudo apt show -a nvidia-driver-470\n</code></pre> <p>\u5728\u8f93\u51fa\u7684\u7ed3\u679c\u4e2d\u641c\u7d22 <code>470.129.06</code>\uff0c\u627e\u5230 <code>Version: 470.129.06-0ubuntu1</code>\uff0c\u4e0b\u9762\u5199\u4e86 <code>APT-Sources: https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64 Packages</code>\uff0c\u8fd9\u5c31\u8bf4\u660e\u8fd9\u4e2a\u7248\u672c\u662f\u4ece NVIDIA \u7684 APT \u6e90\u6765\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u7528 <code>470.129.06-0ubuntu1</code>\uff0c\u800c\u4e0d\u662f <code>470.129.06-0ubuntu0.20.04.1</code>\uff0c\u540e\u8005\u662f Ubuntu \u6e90\u81ea\u5e26\u7684\uff0c\u6211\u4eec\u8981\u7528\u524d\u8005\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6307\u5b9a\u7248\u672c\u5b89\u88c5\u9a71\u52a8\uff1a</p> <pre><code>sudo apt install nvidia-driver-470=470.129.06-0ubuntu1\n</code></pre> <p>\u5982\u679c\u7cfb\u7edf\u91cc\u5df2\u7ecf\u5b89\u88c5\u4e86\u5176\u4ed6\u7248\u672c\u7684 nvidia \u9a71\u52a8\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u51b2\u7a81\u3002\u8fd9\u65f6\u5019\uff0c\u53ea\u9700\u8981\u628a\u51b2\u7a81\u7684\u5305\u4e5f\u5199\u5728\u8981\u5b89\u88c5\u7684\u5305\u91cc\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sudo apt install nvidia-utils-470=470.129.06-0ubuntu1 cuda-drivers=470.129.06-1 cuda-drivers-470=470.129.06-1 nvidia-driver-470=470.129.06-0ubuntu1 libnvidia-gl-470=470.129.06-0ubuntu1 libnvidia-compute-470=470.129.06-0ubuntu1 libnvidia-decode-470=470.129.06-0ubuntu1 libnvidia-encode-470=470.129.06-0ubuntu1 libnvidia-ifr1-470=470.129.06-0ubuntu1 libnvidia-fbc1-470=470.129.06-0ubuntu1 libnvidia-common-470=470.129.06-0ubuntu1 nvidia-kernel-source-470=470.129.06-0ubuntu1 nvidia-dkms-470=470.129.06-0ubuntu1 nvidia-kernel-common-470=470.129.06-0ubuntu1 libnvidia-extra-470=470.129.06-0ubuntu1 nvidia-compute-utils-470=470.129.06-0ubuntu1 xserver-xorg-video-nvidia-470=470.129.06-0ubuntu1 libnvidia-cfg1-470=470.129.06-0ubuntu1 nvidia-settings=470.129.06-0ubuntu1 libxnvctrl0=470.129.06-0ubuntu1 nvidia-modprobe=470.129.06-0ubuntu1\n</code></pre> <p>\u6700\u7ec8\uff0c\u6211\u4eec\u8981\u4fdd\u8bc1\uff0c\u7cfb\u7edf\u91cc\u9762\u6240\u6709 nvidia \u9a71\u52a8\u76f8\u5173\u7684\u5305\u90fd\u662f\u540c\u4e00\u4e2a\u7248\u672c\uff1a</p> <pre><code>$ sudo apt list --installed | grep nvidia\nlibnvidia-cfg1-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nlibnvidia-common-470/unknown,now 470.129.06-0ubuntu1 all [installed,automatic]\nlibnvidia-compute-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nlibnvidia-decode-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nlibnvidia-encode-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nlibnvidia-extra-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nlibnvidia-fbc1-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nlibnvidia-gl-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nlibnvidia-ifr1-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nnvidia-compute-utils-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nnvidia-dkms-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nnvidia-driver-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed]\nnvidia-fabricmanager-470/unknown,now 470.129.06-1 amd64 [installed,automatic]\nnvidia-kernel-common-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nnvidia-kernel-source-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nnvidia-modprobe/unknown,now 470.129.06-0ubuntu1 amd64 [installed,upgradable to: 515.48.07-0ubuntu1]\nnvidia-settings/unknown,now 470.129.06-0ubuntu1 amd64 [installed,upgradable to: 515.48.07-0ubuntu1]\nnvidia-utils-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\nxserver-xorg-video-nvidia-470/unknown,now 470.129.06-0ubuntu1 amd64 [installed,automatic]\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u4e3a\u4e86\u9632\u6b62 apt \u5347\u7ea7\u7684\u65f6\u5019\u987a\u624b\u7834\u574f\u4e86\u4e00\u81f4\u7684\u7248\u672c\uff0c\u6211\u4eec\u8981\u628a\u5305\u56fa\u5b9a\u5728\u4e00\u4e2a\u7248\u672c\u91cc\uff1a</p> <pre><code>sudo apt-mark hold cuda-drivers nvidia-modprobe nvidia-settings libxnvctrl0\n</code></pre> <p>\u5982\u679c\u6709\u5176\u4ed6 nvidia \u5305\u8bf4\u8981\u81ea\u52a8\u5347\u7ea7\uff0c\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u56fa\u5b9a\u4f4f\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2022/07/06/install-nvidia-cuda/#cuda","title":"CUDA","text":"<p>CUDA \u5b9e\u9645\u4e0a\u662f\u7eff\u8272\u8f6f\u4ef6\uff0c\u628a\u6574\u4e2a\u76ee\u5f55\u653e\u5728\u4efb\u610f\u4e00\u4e2a\u76ee\u5f55\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002</p> <p>\u5b89\u88c5 CUDA \u7684\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 APT \u5b89\u88c5\u5168\u5c40\u7684\uff0c\u4e5f\u53ef\u4ee5\u7528 Spack \u6216\u8005 Anaconda \u5b89\u88c5\u5230\u672c\u5730\u76ee\u5f55\u3002\u5b9e\u9645\u4e0a\u8fd9\u4e9b\u5b89\u88c5\u8fc7\u7a0b\u90fd\u662f\u628a\u540c\u6837\u7684\u6587\u4ef6\u590d\u5236\u5230\u4e0d\u540c\u7684\u5730\u65b9\u800c\u5df2\u3002</p> <p>\u5982\u679c\u8981\u5b89\u88c5\u5168\u5c40\u7684\u8bdd\uff0c\u8fd8\u662f\u63a8\u8350\u7528 NVIDIA \u7684 APT \u6e90\uff0c\u4ee5\u5b89\u88c5 CUDA 11.1 \u4e3a\u4f8b\uff1a</p> <pre><code>sudo apt install cuda-11-1\n</code></pre> <p>\u90a3\u4e48 CUDA \u5c31\u4f1a\u5b89\u88c5\u5230 /usr/local/cuda-11.1 \u76ee\u5f55\u4e0b\u3002\u5982\u679c\u60f3\u8981\u7528 nvcc\uff0c\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u628a\u5b83\u52a0\u5230 PATH \u73af\u5883\u53d8\u91cf\u4e2d\u3002</p> <p>CUDA \u662f\u53ef\u4ee5\u591a\u7248\u672c\u5171\u5b58\u7684\uff0c\u6bd4\u5982\u4f60\u53ef\u4ee5\u628a CUDA 11.1 \u5230 CUDA 11.7 \u4e00\u53e3\u6c14\u90fd\u88c5\u4e86\u3002\u4e0d\u8fc7\u6ce8\u610f\uff0cCUDA \u5bf9 NVIDIA \u9a71\u52a8\u6709\u7248\u672c\u8981\u6c42\uff0c\u6240\u4ee5\u6709\u4e00\u4e9b\u53ef\u80fd\u4f1a\u4e0d\u6ee1\u8db3 APT \u7684\u7248\u672c\u8981\u6c42\uff1b\u540c\u65f6\uff0cCUDA \u5bf9\u7f16\u8bd1\u5668\u7248\u672c\u6709\u8981\u6c42\uff0c\u6240\u4ee5\u5982\u679c\u7cfb\u7edf\u8fd8\u662f Ubuntu 16.04 \u6216\u8005 18.04\uff0c\u8d76\u7d27\u5347\u7ea7\u5427\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2022/07/06/install-nvidia-cuda/#nvidia-container-toolkit","title":"NVIDIA Container Toolkit","text":"<p>\u5b89\u88c5\u65b9\u6cd5\uff1ahttps://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#linux-distributions</p> <p>\u547d\u4ee4\uff1a</p> <pre><code>curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \\\n  &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \\\n    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\n    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list \\\n  &amp;&amp; \\\n    sudo apt-get update\n</code></pre>","tags":["nvidia","cuda"]},{"location":"software/2022/07/26/invalid-date-timezone/","title":"invalid date \u62a5\u9519\u4e0e\u65f6\u533a\u7684\u5173\u7cfb","text":"","tags":["linux","timezone","date","tzdata"]},{"location":"software/2022/07/26/invalid-date-timezone/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u9a8c\u9898\u7684\u65f6\u5019\uff0c@HarryChen \u53d1\u73b0\u4e86\u4e00\u4e2a\u73b0\u8c61\uff1a</p> <pre><code>$ date -d \"1919-04-13\"\ndate: invalid date \u20181919-04-13\u2019\n$ TZ=UTC date -d \"1919-04-13\"\nSun Apr 13 00:00:00 UTC 1919\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u73b0\u8c61\u4e0e\u65f6\u533a\u6709\u5173\uff0c\u90a3\u4e48\u4e3a\u5565 <code>1919-04-13</code> \u662f\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7684\u65e5\u671f\u5462\uff1f</p>","tags":["linux","timezone","date","tzdata"]},{"location":"software/2022/07/26/invalid-date-timezone/#\u65f6\u533a","title":"\u65f6\u533a","text":"<p>\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u67d0\u4e00\u4e2a\u65f6\u533a\u6765\u8bf4\uff0c\u6709\u7684\u65f6\u95f4\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u590f\u4ee4\u65f6\u3002\u5728 Timezone DB \u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u6070\u597d\u5728 1919 \u5e74 4 \u6708 13 \u65e5\u53d1\u751f\u4e86\u4e00\u6b21 UTC+8 \u5230 UTC+9 \u7684\u53d8\u5316\uff0c\u56e0\u6b64\u96f6\u70b9\u53d8\u6210\u4e86\u4e00\u70b9\uff0c\u5c31\u53d8\u6210\u4e86\u4e0d\u5408\u6cd5\u7684\u65e5\u671f\u3002</p> <p>\u8fd9\u4e2a\u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u4fdd\u5b58\u5728 tzdata \u4e2d\uff0c\u53ef\u4ee5\u7528 zdump \u5de5\u5177\u67e5\u770b\uff1a</p> <pre><code>$ tzdata -v Asia/Shanghai\nAsia/Shanghai  Fri Dec 13 20:45:52 1901 UTC = Sat Dec 14 04:45:52 1901 CST isdst=0\nAsia/Shanghai  Sat Dec 14 20:45:52 1901 UTC = Sun Dec 15 04:45:52 1901 CST isdst=0\nAsia/Shanghai  Sat Apr 12 15:59:59 1919 UTC = Sat Apr 12 23:59:59 1919 CST isdst=0\nAsia/Shanghai  Sat Apr 12 16:00:00 1919 UTC = Sun Apr 13 01:00:00 1919 CDT isdst=1\nAsia/Shanghai  Tue Sep 30 14:59:59 1919 UTC = Tue Sep 30 23:59:59 1919 CDT isdst=1\nAsia/Shanghai  Tue Sep 30 15:00:00 1919 UTC = Tue Sep 30 23:00:00 1919 CST isdst=0\nAsia/Shanghai  Fri May 31 15:59:59 1940 UTC = Fri May 31 23:59:59 1940 CST isdst=0\nAsia/Shanghai  Fri May 31 16:00:00 1940 UTC = Sat Jun  1 01:00:00 1940 CDT isdst=1\nAsia/Shanghai  Sat Oct 12 14:59:59 1940 UTC = Sat Oct 12 23:59:59 1940 CDT isdst=1\nAsia/Shanghai  Sat Oct 12 15:00:00 1940 UTC = Sat Oct 12 23:00:00 1940 CST isdst=0\nAsia/Shanghai  Fri Mar 14 15:59:59 1941 UTC = Fri Mar 14 23:59:59 1941 CST isdst=0\nAsia/Shanghai  Fri Mar 14 16:00:00 1941 UTC = Sat Mar 15 01:00:00 1941 CDT isdst=1\nAsia/Shanghai  Sat Nov  1 14:59:59 1941 UTC = Sat Nov  1 23:59:59 1941 CDT isdst=1\nAsia/Shanghai  Sat Nov  1 15:00:00 1941 UTC = Sat Nov  1 23:00:00 1941 CST isdst=0\nAsia/Shanghai  Fri Jan 30 15:59:59 1942 UTC = Fri Jan 30 23:59:59 1942 CST isdst=0\nAsia/Shanghai  Fri Jan 30 16:00:00 1942 UTC = Sat Jan 31 01:00:00 1942 CDT isdst=1\nAsia/Shanghai  Sat Sep  1 14:59:59 1945 UTC = Sat Sep  1 23:59:59 1945 CDT isdst=1\nAsia/Shanghai  Sat Sep  1 15:00:00 1945 UTC = Sat Sep  1 23:00:00 1945 CST isdst=0\nAsia/Shanghai  Tue May 14 15:59:59 1946 UTC = Tue May 14 23:59:59 1946 CST isdst=0\nAsia/Shanghai  Tue May 14 16:00:00 1946 UTC = Wed May 15 01:00:00 1946 CDT isdst=1\nAsia/Shanghai  Mon Sep 30 14:59:59 1946 UTC = Mon Sep 30 23:59:59 1946 CDT isdst=1\nAsia/Shanghai  Mon Sep 30 15:00:00 1946 UTC = Mon Sep 30 23:00:00 1946 CST isdst=0\nAsia/Shanghai  Mon Apr 14 15:59:59 1947 UTC = Mon Apr 14 23:59:59 1947 CST isdst=0\nAsia/Shanghai  Mon Apr 14 16:00:00 1947 UTC = Tue Apr 15 01:00:00 1947 CDT isdst=1\nAsia/Shanghai  Fri Oct 31 14:59:59 1947 UTC = Fri Oct 31 23:59:59 1947 CDT isdst=1\nAsia/Shanghai  Fri Oct 31 15:00:00 1947 UTC = Fri Oct 31 23:00:00 1947 CST isdst=0\nAsia/Shanghai  Fri Apr 30 15:59:59 1948 UTC = Fri Apr 30 23:59:59 1948 CST isdst=0\nAsia/Shanghai  Fri Apr 30 16:00:00 1948 UTC = Sat May  1 01:00:00 1948 CDT isdst=1\nAsia/Shanghai  Thu Sep 30 14:59:59 1948 UTC = Thu Sep 30 23:59:59 1948 CDT isdst=1\nAsia/Shanghai  Thu Sep 30 15:00:00 1948 UTC = Thu Sep 30 23:00:00 1948 CST isdst=0\nAsia/Shanghai  Sat Apr 30 15:59:59 1949 UTC = Sat Apr 30 23:59:59 1949 CST isdst=0\nAsia/Shanghai  Sat Apr 30 16:00:00 1949 UTC = Sun May  1 01:00:00 1949 CDT isdst=1\nAsia/Shanghai  Fri May 27 14:59:59 1949 UTC = Fri May 27 23:59:59 1949 CDT isdst=1\nAsia/Shanghai  Fri May 27 15:00:00 1949 UTC = Fri May 27 23:00:00 1949 CST isdst=0\nAsia/Shanghai  Sat May  3 17:59:59 1986 UTC = Sun May  4 01:59:59 1986 CST isdst=0\nAsia/Shanghai  Sat May  3 18:00:00 1986 UTC = Sun May  4 03:00:00 1986 CDT isdst=1\nAsia/Shanghai  Sat Sep 13 16:59:59 1986 UTC = Sun Sep 14 01:59:59 1986 CDT isdst=1\nAsia/Shanghai  Sat Sep 13 17:00:00 1986 UTC = Sun Sep 14 01:00:00 1986 CST isdst=0\nAsia/Shanghai  Sat Apr 11 17:59:59 1987 UTC = Sun Apr 12 01:59:59 1987 CST isdst=0\nAsia/Shanghai  Sat Apr 11 18:00:00 1987 UTC = Sun Apr 12 03:00:00 1987 CDT isdst=1\nAsia/Shanghai  Sat Sep 12 16:59:59 1987 UTC = Sun Sep 13 01:59:59 1987 CDT isdst=1\nAsia/Shanghai  Sat Sep 12 17:00:00 1987 UTC = Sun Sep 13 01:00:00 1987 CST isdst=0\nAsia/Shanghai  Sat Apr 16 17:59:59 1988 UTC = Sun Apr 17 01:59:59 1988 CST isdst=0\nAsia/Shanghai  Sat Apr 16 18:00:00 1988 UTC = Sun Apr 17 03:00:00 1988 CDT isdst=1\nAsia/Shanghai  Sat Sep 10 16:59:59 1988 UTC = Sun Sep 11 01:59:59 1988 CDT isdst=1\nAsia/Shanghai  Sat Sep 10 17:00:00 1988 UTC = Sun Sep 11 01:00:00 1988 CST isdst=0\nAsia/Shanghai  Sat Apr 15 17:59:59 1989 UTC = Sun Apr 16 01:59:59 1989 CST isdst=0\nAsia/Shanghai  Sat Apr 15 18:00:00 1989 UTC = Sun Apr 16 03:00:00 1989 CDT isdst=1\nAsia/Shanghai  Sat Sep 16 16:59:59 1989 UTC = Sun Sep 17 01:59:59 1989 CDT isdst=1\nAsia/Shanghai  Sat Sep 16 17:00:00 1989 UTC = Sun Sep 17 01:00:00 1989 CST isdst=0\nAsia/Shanghai  Sat Apr 14 17:59:59 1990 UTC = Sun Apr 15 01:59:59 1990 CST isdst=0\nAsia/Shanghai  Sat Apr 14 18:00:00 1990 UTC = Sun Apr 15 03:00:00 1990 CDT isdst=1\nAsia/Shanghai  Sat Sep 15 16:59:59 1990 UTC = Sun Sep 16 01:59:59 1990 CDT isdst=1\nAsia/Shanghai  Sat Sep 15 17:00:00 1990 UTC = Sun Sep 16 01:00:00 1990 CST isdst=0\nAsia/Shanghai  Sat Apr 13 17:59:59 1991 UTC = Sun Apr 14 01:59:59 1991 CST isdst=0\nAsia/Shanghai  Sat Apr 13 18:00:00 1991 UTC = Sun Apr 14 03:00:00 1991 CDT isdst=1\nAsia/Shanghai  Sat Sep 14 16:59:59 1991 UTC = Sun Sep 15 01:59:59 1991 CDT isdst=1\nAsia/Shanghai  Sat Sep 14 17:00:00 1991 UTC = Sun Sep 15 01:00:00 1991 CST isdst=0\nAsia/Shanghai  Mon Jan 18 03:14:07 2038 UTC = Mon Jan 18 11:14:07 2038 CST isdst=0\nAsia/Shanghai  Tue Jan 19 03:14:07 2038 UTC = Tue Jan 19 11:14:07 2038 CST isdst=0\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u5217\u51fa\u6765\u4e86\u5386\u53f2\u4e0a Asia/Shanghai \u65f6\u533a\u7684\u53d8\u5316\u5386\u53f2\u3002\u5177\u4f53\u7684\u5386\u53f2\uff0c\u53ef\u4ee5\u67e5\u770b \u4e2d\u56fd\u65f6\u533a\u3002</p> <p>\u6b64\u5916\uff0c\u5386\u53f2\u4e0a\uff0c\u4ece\u5112\u7565\u5386\u5230\u683c\u91cc\u9ad8\u5229\u5386\u7684\u6f14\u53d8\u8fc7\u7a0b\uff0c\u4e5f\u51fa\u73b0\u4e86\u4e00\u6bb5\u201c\u4e0d\u5b58\u5728\u201d\u7684\u65e5\u671f\uff0c\u5982 Setting October 14 ,1582 fails in java.sql.Date\u3002</p>","tags":["linux","timezone","date","tzdata"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/","title":"\u4ece libvirtd \u8fc1\u79fb\u5230 Proxmox VE","text":"","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u7528 libvirtd + virt-manager \u505a Linux \u4e0a\u7684\u865a\u62df\u5316\uff0c\u597d\u5904\u662f\u6bd4\u8f83\u8f7b\u91cf\u7ea7\uff0c\u4f46\u662f\u8fdc\u7a0b\u63a7\u5236\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\uff0c\u8981\u4e48\u901a\u8fc7 RDP \u8bbf\u95ee virt-manager \u7684 UI\uff0c\u8981\u4e48\u5c31\u7528 cockpit \u5728\u7f51\u9875\u91cc\u53bb\u914d\u7f6e\u865a\u62df\u673a\u3002\u6b64\u65f6\u5c31\u4f1a\u6bd4\u8f83\u6000\u5ff5 VMware ESXi \u7684\u7f51\u9875\uff0c\u4f46\u662f ESXi \u88c5\u5b8c\u4ee5\u540e\uff0c\u5bbf\u4e3b\u673a\u5c31\u5f88\u4e0d\u81ea\u7531\u4e86\uff0c\u5f88\u591a\u4e1c\u897f\u6ca1\u6cd5\u81ea\u5b9a\u4e49\u3002\u6700\u540e\u5c31\u60f3\u5230\u5728 Debian \u4e0a\u88c5\u4e00\u4e2a Proxmox VE\uff0c\u5e0c\u671b\u5f97\u5230\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u4e2d\u95f4\u6001\u3002</p>","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/#proxmox-ve-\u5b89\u88c5","title":"Proxmox VE \u5b89\u88c5","text":"<p>\u6309\u7167\u5b98\u65b9\u7684 Install Proxmox VE on Debian 11 Bullseye \u53bb\u5b89\u88c5\u5373\u53ef\u3002\u6211\u7684\u73af\u5883\u662f Debian Bookworm\uff0c\u628a\u8def\u5f84\u6539\u6210 Bookworm \u7684 pvetest \u5373\u53ef\u3002\u5b89\u88c5\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u4f8b\u5982\u7528 ifupdown2 \u66ff\u6362 ifupdown \u7684\u65f6\u5019\u4f1a\u68c0\u67e5 config \u662f\u5426\u6b63\u786e\u7b49\u7b49\u3002\u5b89\u88c5\u5b8c\u4ee5\u540e\u91cd\u542f\uff0c\u5c31\u53ef\u4ee5\u7528 root \u7528\u6237\u8bbf\u95ee Proxmox VE \u4e86\u3002</p>","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/#\u8fc1\u79fb-libvirtd-\u865a\u62df\u673a","title":"\u8fc1\u79fb libvirtd \u865a\u62df\u673a","text":"<p>\u4e0b\u4e00\u6b65\u662f\u8fc1\u79fb libvirtd \u865a\u62df\u673a\u3002\u5728\u7f51\u4e0a\u641c\u7d22\uff0c\u4f1a\u770b\u5230\u63d0\u4f9b\u7684\u65b9\u6cd5\u662f\uff0c\u5728 Proxmox VE \u91cc\u521b\u5efa\u4e00\u4e2a\u540c\u6837\u5927\u5c0f\u7684\u955c\u50cf\uff0c\u7136\u540e\u628a\u539f\u6765\u7684 qcow2 \u7684\u6570\u636e\u590d\u5236\u4e00\u4efd\uff0c\u4f46\u662f\u8fd9\u6837\u590d\u5236\u7684\u65f6\u5019\u5f97\u5b58\u4e24\u4efd\u6570\u636e\uff0c\u800c\u4e14\u5bf9\u7a00\u758f qcow2 \u7684\u652f\u6301\u4e5f\u4e0d\u592a\u597d\u3002</p> <p>\u6700\u540e\u5b9e\u9645\u7684\u89e3\u51b3\u529e\u6cd5\u662f\uff1a\u5728 Proxmox VE \u91cc\u521b\u5efa\u4e00\u4e2a\u548c qcow2 \u5927\u5c0f\u4e00\u6837\u7684\u955c\u50cf\uff0c\u8bbe\u7f6e\u4e3a qcow2 \u683c\u5f0f\uff0c\u7136\u540e\u53bb <code>/var/lib/vz/images</code> \u8def\u5f84\u4e0b\u627e\u5230\u65b0\u5efa\u7684 qcow2\uff0c\u76f4\u63a5\u7528\u539f\u6765 libvirtd \u521b\u5efa\u7684 qcow2 \u8986\u76d6\u8fc7\u53bb\u3002\u76ee\u524d\u6765\u770b\uff0c\u8fd8\u6ca1\u6709\u9047\u5230\u95ee\u9898\uff0c\u6bd5\u7adf ProxmoxVE \u7528\u7684\u4e5f\u662f QEMU\uff0c\u548c libvirtd \u4e00\u6837\u3002</p>","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/#uefi","title":"UEFI","text":"<p>\u5728 Proxmox VE \u521b\u5efa\u865a\u62df\u673a\uff0c\u5982\u679c\u9009\u7684\u662f UEFI\uff0c\u7531\u4e8e\u5b83\u4f1a\u91c7\u7528\u65b0\u7684 EFI vars \u955c\u50cf\uff0c\u6240\u4ee5\u539f\u6765\u7684 UEFI vars \u5c31\u4e22\u5931\u4e86\uff0c\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5982\u679c grub \u7684 EFI \u7a0b\u5e8f\u4e0d\u5728\u6807\u51c6\u7684\u8def\u5f84\u4e0b\uff0c\u53ef\u80fd\u4f1a\u627e\u4e0d\u5230 grub\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u5148\u5220\u6389\u7f51\u5361\uff0c\u7136\u540e\u4fee\u6539 boot order\uff0c\u628a ESP \u5206\u533a\u6240\u5728\u7684\u76d8\u52a0\u4e0a\u53bb\uff0c\u8fd9\u6837 UEFI \u542f\u52a8\u7684\u65f6\u5019\u76f4\u63a5\u8fdb shell\uff0c\u7136\u540e\u5728 fs0 \u91cc\u627e\u5230 grub \u7684 EFI \u7a0b\u5e8f\u518d\u542f\u52a8\u3002</p> <p>\u5728\u542f\u52a8 NixOS \u7684\u65f6\u5019\uff0c\u8fd8\u53d1\u73b0\u8fd0\u884c systemd-boot \u7684 EFI \u7a0b\u5e8f\u7684\u65f6\u5019\u4f1a Access Denied\uff0c\u67e5\u8be2\u4e86\u4e00\u4e0b\uff0c\u662f\u56e0\u4e3a Secure Boot\u3002\u8fdb\u5165 UEFI Firmware Setup\uff0c\u628a Secure Boot \u5173\u6389\u518d\u91cd\u542f\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fdb\u5165\u4e86\u3002</p>","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/06/15/libvirtd-migrate-proxmox-ve/#windows","title":"Windows","text":"<p>\u5728\u521b\u5efa\u865a\u62df\u673a\u7684\u65f6\u5019\uff0c\u5982\u679c\u6307\u5b9a\u4e86 Windows 11\uff0c\u5c31\u4f1a\u81ea\u52a8\u52fe\u9009\u4e0a TPM \u76f8\u5173\u7684\u914d\u7f6e\u3002\u4f46\u542f\u52a8\u7684\u65f6\u5019\uff0c\u8bf4 swtpm \u62a5\u9519\u65e0\u6cd5\u542f\u52a8\uff0c\u6309\u7167\u9519\u8bef\u4fe1\u606f\u67e5\u8be2\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86 Apparmor &gt; swtpm: Could not open UnixIO socket: Permission denied\uff1a\u539f\u56e0\u662f AppArmor \u62e6\u622a\u4e86 swtpm \u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u7528\u547d\u4ee4\u6765\u89e3\u9664 AppArmor \u7684\u62e6\u622a\uff1a</p> <pre><code>sudo aa-complain /usr/bin/swtpm\nsudo apparmor_parser -r /etc/apparmor.d/usr.bin.swtpm\n</code></pre> <p>\u8fd9\u6837\u5904\u7406\u4ee5\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8 Windows \u4e86\u3002</p>","tags":["libvirtd","qemu","proxmoxve","pve"]},{"location":"software/2023/05/06/linker/","title":"\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u539f\u7406","text":"","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u548c\u540c\u5b66\u8ba8\u8bba\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u94fe\u63a5\u95ee\u9898\uff0c\u9047\u5230\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u590d\u4e60\u4e00\u904d\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5728\u8fd9\u91cc\u603b\u7ed3\u5de5\u4f5c\u539f\u7406\u548c\u5e38\u89c1\u7684\u95ee\u9898\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u7f16\u8bd1","title":"\u7f16\u8bd1","text":"<p>\u7f16\u8bd1\u5668\u4f1a\u628a\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210 obj\uff0cobj \u91cc\u9762\u6709\u7b26\u53f7\u8868\uff0c\u5b9a\u4e49\u4e86\u4e0d\u540c\u7684\u7b26\u53f7\u7c7b\u578b\u3002\u5e38\u89c1\u7684\u4ee3\u7801\u4e0e\u7b26\u53f7\u7684\u5bf9\u5e94\u5173\u7cfb\uff1a</p> <pre><code>// global in .bss section if -fno-common\n// common symbol if -fcommon\nint uninitialized;\n// global in .bss section\nint initialized = 0;\n// global in .data section\nint initialized_one = 1;\n// global in .rodata section\nconst int const_initialized = 0;\n// global in .rodata section\nconst int const_initialized_one = 1;\n// global undefined symbol\nextern int external;\n// local in .bss section\nstatic int static_uninitialized;\n// local in .bss section\nstatic int static_initialized = 0;\n// local in .data section\nstatic int static_initialized_one = 1;\n// local in .rodata section\nconst static int const_static_initialized = 0;\n// local in .rodata section\nconst static int const_static_initialized_one = 1;\n// global in .text section\nint simple_function() {\n  // local in .bss section\n  static int static_in_function = 0;\n}\n// global in .text section\nvoid access_external() { external = 1; }\n// global undefined symbol\nextern double external_function();\n// global in .text section\nlong call_external() { external_function(); }\n// local in .text section\nstatic int static_function() {}\n// weak in .text section\n__attribute__ ((weak)) float weak_function() {}\n// global in .text section marked .hidden\n__attribute__ ((visibility (\"hidden\"))) int hidden_function() {}\n</code></pre> <p>\u4f7f\u7528 <code>readelf -s</code> \u67e5\u770b\u7b26\u53f7\u8868\uff1a</p> <pre><code>   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     6: 0000000000000008     4 OBJECT  LOCAL  DEFAULT    4 static_uninitialized\n     7: 000000000000000c     4 OBJECT  LOCAL  DEFAULT    4 static_initialized\n     8: 0000000000000004     4 OBJECT  LOCAL  DEFAULT    3 static_initializ[...]\n     9: 0000000000000008     4 OBJECT  LOCAL  DEFAULT    5 const_static_ini[...]\n    10: 000000000000000c     4 OBJECT  LOCAL  DEFAULT    5 const_static_ini[...]\n    11: 0000000000000029     7 FUNC    LOCAL  DEFAULT    1 static_function\n    12: 0000000000000010     4 OBJECT  LOCAL  DEFAULT    4 static_in_function.0\n    16: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    4 uninitialized\n    17: 0000000000000004     4 OBJECT  GLOBAL DEFAULT    4 initialized\n    18: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 initialized_one\n    19: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    5 const_initialized\n    20: 0000000000000004     4 OBJECT  GLOBAL DEFAULT    5 const_initialized_one\n    21: 0000000000000000     7 FUNC    GLOBAL DEFAULT    1 simple_function\n    22: 0000000000000007    17 FUNC    GLOBAL DEFAULT    1 access_external\n    23: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND external\n    24: 0000000000000018    17 FUNC    GLOBAL DEFAULT    1 call_external\n    25: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_\n    26: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND external_function\n    27: 0000000000000030    11 FUNC    WEAK   DEFAULT    1 weak_function\n    28: 000000000000003b     7 FUNC    GLOBAL HIDDEN     1 hidden_function\n</code></pre> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u6bcf\u4e2a\u7b26\u53f7\u6709\u5982\u4e0b\u5c5e\u6027\uff1a</p> <ol> <li>Bind\uff1aLocal\uff08static\uff09\u3001Global\uff08extern \u6216\u8005\u975e static\uff09\u3001Weak\uff08\u6807\u8bb0 <code>__attribute__ ((weak))</code>\uff09</li> <li>Vis(Visibility): Default\u3001Hidden\uff08\u6807\u8bb0 <code>__attribute__ ((visibility (\"hidden\")))</code>\uff09</li> <li>Ndx\uff1a<ol> <li>COMMON\uff1a\u5982\u679c\u6253\u5f00\u4e86 -fcommon\uff0c\u90a3\u4e48\u6ca1\u6709\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\uff08\u4e0a\u9762\u7684 <code>uninitialized</code>\uff09\u4f1a\u751f\u6210 COMMON \u7b26\u53f7\uff1b\u5982\u679c\u6253\u5f00\u4e86 -fno-common\uff0c\u5219\u4e0d\u4f1a\u6709 COMMON \u7b26\u53f7</li> <li>UNDEFINED\uff1aextern \u7b26\u53f7</li> </ol> </li> <li>Section:<ol> <li>const \u53d8\u91cf\u653e\u5728 .rodata section</li> <li>\u975e const \u53d8\u91cf\uff0c\u5982\u679c\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u5982\u679c\u5f00\u4e86 -fcommon\uff0c\u5219\u751f\u6210 COMMON \u7b26\u53f7\uff1b\u5982\u679c\u5f00\u4e86 -fno-common\uff0c\u5219\u653e\u5728 .bss section</li> <li>\u975e const \u53d8\u91cf\uff0c\u5982\u679c\u521d\u59cb\u5316\u4e86\uff0c\u653e\u5728 .data section</li> <li>\u51fd\u6570\u653e\u5728 .text section</li> </ol> </li> </ol> <p>\u5173\u4e8e COMMON \u7b26\u53f7\u7684\u8be6\u7ec6\u5185\u5bb9\uff0c\u5efa\u8bae\u9605\u8bfb All about COMMON symbols - MaskRay \u548c COMMON \u7b26\u53f7\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u94fe\u63a5","title":"\u94fe\u63a5","text":"<p>\u94fe\u63a5\u8981\u505a\u7684\u662f\u628a\u591a\u4e2a obj \u5408\u5e76\u6210\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u52a8\u6001\u5e93\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u5c06\u4e00\u4e2a obj \u4e2d\u5b9a\u4e49\u7684\u7b26\u53f7\u4e0e\u53e6\u4e00\u4e2a obj \u4e2d undefined \u7684\u7b26\u53f7\u5bf9\u5e94\u8d77\u6765\u3002</p> <p>\u94fe\u63a5\u5668\u8fd0\u884c\u65f6\uff0c\u4f20\u5165\u82e5\u5e72\u4e2a obj \u6587\u4ef6\uff0c\u7136\u540e\u6309\u7167\u4e0b\u9762\u7684\u6d41\u7a0b\u8fdb\u884c\uff1a</p> <ol> <li>\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u7684\u7b26\u53f7\u8868</li> <li>\u5faa\u73af\u6bcf\u4e2a obj \u6587\u4ef6\uff0c\u5faa\u73af\u5176\u4e2d\u7684\u7b26\u53f7\uff0c\u627e\u5230\u5176\u4e2d\u7684 GLOBAL/WEAK \u7b26\u53f7</li> <li>\u628a GLOBAL/WEAK \u7b26\u53f7\u63d2\u5165\u5230\u7b26\u53f7\u8868\u4e2d\uff0c\u5904\u7406\u5404\u79cd\u60c5\u51b5\uff0c\u4f8b\u5982\uff1a<ol> <li>\u5982\u679c\u51fa\u73b0\u4e24\u4e2a defined \u7b26\u53f7\u51b2\u7a81\uff0c\u62a5\u544a multiple definition \u9519\u8bef</li> <li>\u5982\u679c\u51fa\u73b0\u91cd\u540d\u7684 weak \u7b26\u53f7\u548c strong \u7b26\u53f7\uff0c\u9009\u62e9\u4fdd\u7559 strong \u7684\u7b26\u53f7</li> </ol> </li> <li>\u5982\u679c\u5b58\u5728\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684 defined \u7b26\u53f7\u7684 undefined \u7b26\u53f7\uff0c\u62a5\u544a undefined reference \u9519\u8bef</li> </ol> <p>\u7b26\u53f7\u8868\u662f\u5728\u89e3\u6790 obj \u6587\u4ef6\u7684\u540c\u65f6\u52a8\u6001\u66f4\u65b0\u7684\uff0c\u56e0\u6b64\uff0c\u5982\u679c A \u4f7f\u7528\u4e86 B \u7684\u7b26\u53f7\uff0c\u90a3\u4e48\u5e94\u8be5\u628a A \u653e\u5728\u524d\u9762\uff0c\u8fd9\u6837\u94fe\u63a5\u5668\u89e3\u6790 A \u7684\u65f6\u5019\u4f1a\u5728\u7b26\u53f7\u8868\u4e2d\u521b\u5efa undefined \u7b26\u53f7\uff0c\u7136\u540e B \u5728\u540e\u9762\uff0c\u5f53\u94fe\u63a5\u5668\u89e3\u6790 B \u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u628a B \u7684 defined \u7b26\u53f7\u4e0e A \u7684 undefined \u7b26\u53f7\u8fdb\u884c\u5339\u914d\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u9759\u6001\u5e93","title":"\u9759\u6001\u5e93","text":"<p>\u9759\u6001\u5e93\u5c06\u591a\u4e2a .o \u5408\u5e76\u4e3a\u4e00\u4e2a .a\uff0c\u5e76\u4e14\u521b\u5efa\u4e86\u7d22\u5f15\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u521b\u5efa\u4e00\u4e2a\u9759\u6001\u5e93\u7684\u65f6\u5019\uff1a</p> <pre><code>$ ar rcs libxxx.a obj1.o obj2.o obj3.o ...\n</code></pre> <p>\u751f\u6210\u7684 .a \u4f1a\u5305\u62ec\u6240\u6709\u7684 .o\uff0c\u7136\u540e\u521b\u5efa\u7d22\u5f15\uff08<code>ar rcs</code> \u4e2d\u7684 <code>s</code>\uff0c\u4f1a\u8fd0\u884c <code>ranlib</code> \u547d\u4ee4\uff09\uff0c\u7d22\u5f15\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u7b26\u53f7\u5230 .o \u6587\u4ef6\u7684\u6620\u5c04\uff1a</p> <pre><code>$ nm -s /lib/x86_64-linux-gnu/libc.a\nArchive index:\n__printf in printf.o\n_IO_printf in printf.o\nprintf in printf.o\n__scanf in scanf.o\nscanf in scanf.o\n</code></pre> <p>\u56e0\u6b64\uff0c\u94fe\u63a5\u5668\u5728\u9047\u5230\u53c2\u6570\u662f .a \u7684\u9759\u6001\u5e93\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u67e5\u770b\u91cc\u9762\u7684\u6bcf\u4e2a .o \u6587\u4ef6\uff0c\u800c\u662f\u4ece Archive index \u5165\u624b\uff0c\u5982\u679c\u5f53\u524d\u7684\u7b26\u53f7\u8868\u4f9d\u8d56\u4e86 Archive index \u4e2d\u7684\u7b26\u53f7\uff0c\u90a3\u5c31\u52a0\u8f7d\u76f8\u5e94\u7684 .o \u6587\u4ef6\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u52a8\u6001\u5e93","title":"\u52a8\u6001\u5e93","text":"<p>\u751f\u6210\u52a8\u6001\u5e93\u7684\u65b9\u6cd5\u662f\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u6dfb\u52a0 <code>-fPIC</code> \u9009\u9879\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u6dfb\u52a0 <code>-shared</code> \u7f16\u8bd1\u53c2\u6570\uff1a</p> <pre><code>gcc -fPIC -c source1.c -o source1.o\ngcc -shared source1.o -o libtest.so.0.0.0\n# oneliner:\ngcc -fPIC -shared source1.c -o libtest.so.0.0.0\n</code></pre> <p>\u6b64\u65f6\u4ee3\u7801\u4e2d\u5b9a\u4e49\u7684\u51fd\u6570\u4f1a\u51fa\u73b0\u5728 Dynamic Symbol Table \u4e2d\uff0c\u53ef\u4ee5\u7528 <code>objdump -T</code> \u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code>$ cat source1.c\nint simple_function() {}\n$ objdump -T libtest.so.0.0.0\n\nlibtest.so.0.0.0:     file format elf64-x86-64\n\nDYNAMIC SYMBOL TABLE:\n0000000000000000  w   D  *UND*  0000000000000000 __cxa_finalize\n0000000000000000  w   D  *UND*  0000000000000000 _ITM_registerTMCloneTable\n0000000000000000  w   D  *UND*  0000000000000000 _ITM_deregisterTMCloneTable\n0000000000000000  w   D  *UND*  0000000000000000 __gmon_start__\n00000000000010f9 g    DF .text  0000000000000007 simple_function\n</code></pre> <p>\u5982\u679c\u4ee3\u7801\u4e2d\u7528\u4e86 libc \u7684\u4e00\u4e9b\u51fd\u6570\uff0c\u90a3\u4e48\u8fd9\u4e9b\u51fd\u6570\u5219\u4f1a\u4ee5 undefined symbol \u7684\u5f62\u5f0f\u51fa\u73b0\u5728 Dynamic Symbol Table \u4e2d\uff1a</p> <pre><code>$ cat source1.c\n#include &lt;stdio.h&gt;\nint simple_function() {\n  printf(\"Simple function\");\n  return 0;\n}\n$ objdump -T libtest.so.0.0.0\n\nlibtest.so.0.0.0:     file format elf64-x86-64\n\nDYNAMIC SYMBOL TABLE:\n0000000000000000  w   D  *UND*  0000000000000000  Base        _ITM_deregisterTMCloneTable\n0000000000000000      DF *UND*  0000000000000000 (GLIBC_2.2.5) printf\n0000000000000000  w   D  *UND*  0000000000000000  Base        __gmon_start__\n0000000000000000  w   D  *UND*  0000000000000000  Base        _ITM_registerTMCloneTable\n0000000000000000  w   DF *UND*  0000000000000000 (GLIBC_2.2.5) __cxa_finalize\n0000000000001109 g    DF .text  000000000000001b  Base        simple_function\n</code></pre>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u7b26\u53f7\u7248\u672c","title":"\u7b26\u53f7\u7248\u672c","text":"<p>\u4e2d\u95f4\u51fa\u73b0\u7684 Base \u6216\u8005 GLIBC_2.2.5 \u662f\u7b26\u53f7\u7684\u7248\u672c\u53f7\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u517c\u5bb9\u6027\uff1a\u5047\u5982\u67d0\u5929 glibc \u60f3\u8981\u7ed9\u4e00\u4e2a\u51fd\u6570\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\uff0c\u4f46\u662f\u73b0\u6709\u7684\u7a0b\u5e8f\u7f16\u8bd1\u7684\u65f6\u5019\u52a8\u6001\u94fe\u63a5\u4e86\u65e7\u7248\u672c\u7684 glibc\uff0c\u65b0\u65e7\u4e24\u4e2a\u7248\u672c\u7684\u51fd\u6570\u540d\u5b57\u4e00\u6837\uff0c\u4f46\u662f\u529f\u80fd\u5374\u4e0d\u4e00\u6837\uff0c\u5982\u679c\u76f4\u63a5\u8ba9\u65e7\u7a0b\u5e8f\u7528\u65b0 glibc \u7684\u51fd\u6570\uff0c\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u5373\u4f7f\u53c2\u6570\u4e0d\u53d8\uff0c\u5982\u679c\u51fd\u6570\u7684\u8bed\u4e49\u53d8\u4e86\uff0c\u4e5f\u53ef\u80fd\u5e26\u6765\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u662f\u7ed9\u7b26\u53f7\u6dfb\u52a0\u7248\u672c\u53f7\uff0c\u8fd9\u6837\u65e7\u7248\u672c\u7684\u7a0b\u5e8f\u4f1a\u7ee7\u7eed\u627e\u5230\u65e7\u7248\u672c\u7684\u7b26\u53f7\uff0c\u89e3\u51b3\u4e86\u517c\u5bb9\u6027\u7684\u95ee\u9898\u3002\u4f8b\u5982 memcpy \u5728 glibc \u4e2d\u5c31\u6709\u4e24\u4e2a\u7248\u672c\uff1a</p> <pre><code>$ objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep memcpy\n00000000000a2b70 g    DF .text  0000000000000028 (GLIBC_2.2.5) memcpy\n000000000009bc50 g   iD  .text  0000000000000109  GLIBC_2.14  memcpy\n</code></pre> <p>\u5728 glibc \u4ee3\u7801\u4e2d\uff0c\u901a\u8fc7 <code>versioned_symbol</code> \u5b8f\u6765\u5b9e\u73b0\uff1a</p> <pre><code>versioned_symbol (libc, __new_memcpy, memcpy, GLIBC_2_14);\n</code></pre> <p>\u66f4\u591a\u5173\u4e8e\u7b26\u53f7\u7248\u672c\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u9605\u8bfb All about symbol versioning\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u52a8\u6001\u94fe\u63a5","title":"\u52a8\u6001\u94fe\u63a5","text":"<p>\u7f16\u8bd1\u597d\u52a8\u6001\u94fe\u63a5\u5e93\u4ee5\u540e\uff0c\u53ef\u4ee5\u5728\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u4f5c\u4e3a\u53c2\u6570\u5f15\u5165\uff1a</p> <pre><code>$ cat main.c\nextern void simple_function();\nint main() { simple_function(); }\n$ gcc main.c libtest.so.0.0.0 -o main\n$ LD_LIRBARY_PATH=$PWD ./main\nSimple function\n</code></pre> <p>\u53ef\u4ee5\u89c2\u5bdf\u4e00\u4e0b\u53d1\u751f\u4e86\u4ec0\u4e48\u4e8b\u60c5\uff1a\u9996\u5148\uff0c\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u4f1a\u627e\u5230 <code>libtest.so.0.0.0</code> \u5bfc\u51fa\u7684\u7b26\u53f7\u8868\uff0c\u53d1\u73b0\u5b83\u5b9a\u4e49\u4e86 <code>main.c</code> \u7f3a\u5c11\u7684 <code>simple_function</code> \u51fd\u6570\uff0c\u56e0\u6b64\u94fe\u63a5\u4e0d\u4f1a\u51fa\u9519\u3002\u4f46\u662f\uff0c\u51fd\u6570\u672c\u8eab\u6ca1\u6709\u88ab\u94fe\u63a5\u5230 <code>main</code> \u91cc\u9762\uff0c\u9700\u8981\u5728\u8fd0\u884c\u65f6\u53bb\u52a0\u8f7d\u52a8\u6001\u5e93\uff0c\u8fd9\u6837 <code>main</code> \u624d\u53ef\u4ee5\u8c03\u7528\u51fd\u6570\uff1a</p> <pre><code>$ objdump -t main\n0000000000000000       F *UND*  0000000000000000              simple_function\n$ objdump -T main\n0000000000000000      DF *UND*  0000000000000000  Base        simple_function\n$ readelf -d ./main\nDynamic section at offset 0x2dd0 contains 27 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libtest.so.0.0.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n$ ./main\n./main: error while loading shared libraries: libtest.so.0.0.0: cannot open shared object file: No such file or directory\n$ ldd ./main\n        linux-vdso.so.1 (0x00007ffe07dbc000)\n        libtest.so.0.0.0 =&gt; not found\n        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f83ee3fb000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f83ee602000)\n$ LD_LIBRARY_PATH=$PWD ldd ./main\n        linux-vdso.so.1 (0x00007fffb0bd5000)\n        libtest.so.0.0.0 =&gt; /tmp/libtest.so.0.0.0 (0x00007f985b3db000)\n        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f985b1db000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f985b3e7000)\n</code></pre> <p>\u9996\u5148\u53ef\u4ee5\u770b\u5230\uff0c\u4e8c\u8fdb\u5236\u91cc\u9762 <code>simple_function</code> \u4f9d\u7136\u5c5e\u4e8e undefined \u72b6\u6001\u3002\u4f46 <code>main</code> \u4e5f\u6307\u5b9a\u4e86 NEEDED libtest.so.0.0.0\uff0c\u90a3\u4e48\u5728\u8fd0\u884c\u7684\u65f6\u5019\uff0cld.so \u5c31\u4f1a\u53bb\u5bfb\u627e\u8fd9\u4e2a\u52a8\u6001\u5e93\u3002\u7531\u4e8e\u5f53\u524d\u8def\u5f84\u4e0d\u5728\u7cfb\u7edf\u9ed8\u8ba4\u8def\u5f84\u4e2d\uff0c\u76f4\u63a5\u8fd0\u884c\u662f\u627e\u4e0d\u5230\u7684\uff08<code>not found</code>\uff09\uff0c\u8fd9\u91cc\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u6dfb\u52a0\u52a8\u6001\u5e93\u7684\u8def\u5f84\u5230 <code>LD_LIBRARY_PATH</code> \u4e2d\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#soname","title":"soname","text":"<p>\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\uff0c\u7f16\u8bd1\u51fa\u6765\u7684\u52a8\u6001\u5e93\u540d\u79f0\u5e26\u6709\u5b8c\u6574\u7684\u7248\u672c\u53f7\uff1a<code>major.minor.patch=0.0.0</code>\uff0c\u4f46\u4e00\u822c\u8ba4\u4e3a\uff0c\u5982\u679c <code>major</code> \u7248\u672c\u53f7\u6ca1\u6709\u53d8\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f ABI \u517c\u5bb9\u7684\uff0c\u53ef\u4ee5\u66f4\u65b0\u52a8\u6001\u5e93\u7684\u7248\u672c\uff0c\u800c\u4e0d\u7528\u91cd\u65b0\u7f16\u8bd1\u7a0b\u5e8f\u3002\u4f46\u662f\uff0c\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c<code>readelf -d main</code> \u663e\u793a NEEDED \u7684\u52a8\u6001\u5e93\u540d\u5b57\u91cc\u4e5f\u5305\u62ec\u4e86\u5b8c\u6574\u7684\u7248\u672c\u53f7\uff0c\u90a3\u5c31\u6ca1\u6709\u529e\u6cd5\u5bfb\u627e\u5230\u540c major \u7684\u4e0d\u540c\u7248\u672c\u4e86\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u662f\u8ba9\u540c major \u7684\u4e0d\u540c\u7248\u672c\u5171\u4eab\u540c\u4e00\u4e2a soname\uff0c\u5e38\u89c1\u7684\u505a\u6cd5\u5c31\u662f\u53ea\u4fdd\u7559 major \u7248\u672c\u53f7\uff1a<code>libtest.so.0</code>\uff0c\u800c\u4e0d\u662f <code>libtest.so.0.0.0</code>\u3002\u5728\u7f16\u8bd1\u52a8\u6001\u5e93\u7684\u65f6\u5019\uff0c\u901a\u8fc7 <code>-Wl,-soname,libtest.so.0</code> \u53c2\u6570\u6765\u6307\u5b9a soname\uff1a</p> <pre><code>$ gcc -fPIC -shared source1.c -Wl,-soname,libtest.so.0 -o libtest.so.0.0.0\n$ gcc main.c libtest.so.0.0.0 -o main\n$ readelf -d main\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libtest.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n</code></pre> <p>\u6b64\u65f6\u53ef\u4ee5\u770b\u5230 NEEDED \u7684\u52a8\u6001\u5e93\u540d\u5b57\u5df2\u7ecf\u662f\u9884\u671f\u7684 <code>libtest.so.0</code>\uff0c\u8fd9\u610f\u5473\u7740 <code>main</code> \u51fd\u6570\u5728\u52a8\u6001\u52a0\u8f7d\u7684\u65f6\u5019\uff0c\u4e0d\u8003\u8651\u5c0f\u7248\u672c\uff0c\u53ea\u6307\u5b9a\u4e86 <code>major</code> \u7248\u672c\u4e3a 0 \u7684 libtest \u52a8\u6001\u5e93\u3002\u4f46\u5355\u662f\u8fd9\u6837\u8fd8\u4e0d\u80fd\u8fd0\u884c\uff1a</p> <pre><code>$ LD_LIBRARY_PATH=$PWD ./main\n./main: error while loading shared libraries: libtest.so.0: cannot open shared object file: No such file or directory\n</code></pre> <p>\u6bd5\u7adf ld.so \u8981\u627e\u7684\u662f <code>libtest.so.0</code>\uff0c\u4f46\u662f\u6587\u4ef6\u7cfb\u7edf\u91cc\u53ea\u6709 <code>libtest.so.0.0.0</code>\uff0c\u6700\u540e\u7684\u8fd9\u4e00\u6b65\u7528\u7b26\u53f7\u94fe\u63a5\u6765\u5b9e\u73b0\uff1a</p> <pre><code>$ ln -s libtest.so.0.0.0 libtest.so.0\n$ LD_LIBRARY_PATH=$PWD ./main\nSimple function\n</code></pre> <p>\u8fd9\u6837\uff0c\u5982\u679c\u54ea\u5929\u53d1\u5e03\u4e86 libtest.so \u7684 0.0.1 \u7248\u672c\uff0c\u53ea\u9700\u8981\u4fee\u6539\u7b26\u53f7\u94fe\u63a5 <code>libtest.so.0 -&gt; libtest.so.0.0.1</code> \u5373\u53ef\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u8bd1 <code>main</code> \u7a0b\u5e8f\u3002</p> <p>\u60f3\u8981\u67e5\u770b\u52a8\u6001\u5e93\u7684 soname\uff0c\u53ef\u4ee5\u7528 <code>readelf -d</code> \u67e5\u770b\uff1a</p> <pre><code>$ readelf -d libtest.so.0.0.0\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000e (SONAME)             Library soname: [libtest.so.0]\n</code></pre>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#cuda","title":"cuda","text":"<p>\u5728 CUDA \u4e2d\uff0c\u5982\u679c\u7a0b\u5e8f\u9700\u8981\u8bbf\u95ee NVML \u6216\u8005\u4e00\u4e9b\u5e95\u5c42\u7684 CUDA \u51fd\u6570\uff0c\u4f1a\u94fe\u63a5\u5230 libcuda\uff08\u800c\u4e0d\u662f libcudart\uff09\uff0c\u4f46\u662f\u5982\u679c\u5728 CUDA \u76ee\u5f55\u4e0b\u5bfb\u627e libcuda\uff0c\u53ea\u4f1a\u627e\u5230\u4e00\u4e2a <code>targets/x86_64-linux/lib/stubs/libcuda.so</code>\uff0c\u91cc\u9762\u7684\u51fd\u6570\u90fd\u662f\u7a7a\u7684\uff0c\u53ea\u6709\u4e00\u4e2a <code>retq</code> \u6307\u4ee4\uff1a</p> <pre><code>$ objdump -S ./targets/x86_64-linux/lib/stubs/libcuda.so\n./targets/x86_64-linux/lib/stubs/libcuda.so:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000007370 &lt;cuGetErrorString&gt;:\n    7370:       b8 22 00 00 00          mov    $0x22,%eax\n    7375:       c3                      retq\n    7376:       66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n    737d:       00 00 00\n\n0000000000007380 &lt;cuGetErrorName&gt;:\n    7380:       b8 22 00 00 00          mov    $0x22,%eax\n    7385:       c3                      retq\n    7386:       66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n    738d:       00 00 00\n</code></pre> <p>\u8fd9\u4e2a <code>libcuda.so</code> \u7528\u9014\u5c31\u662f\u5bfc\u51fa\u4e86\u6240\u6709\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u7b26\u53f7\uff0c\u5e76\u4e14\u8bbe\u7f6e <code>soname</code> \u4e3a <code>libcuda.so.1</code>\uff1a</p> <pre><code>$ readelf -d ./targets/x86_64-linux/lib/stubs/libcuda.so\n\nDynamic section at offset 0xdf30 contains 8 entries:\n  Tag        Type                         Name/Value\n 0x000000000000000e (SONAME)             Library soname: [libcuda.so.1]\n</code></pre> <p>\u8fd9\u5c31\u610f\u5473\u7740\uff0c<code>ld.so</code> \u4f1a\u53bb\u5bfb\u627e <code>libcuda.so.1</code>\uff0c\u800c\u4e0d\u662f <code>libcuda</code>\u3002\u524d\u8005\u624d\u662f\u771f\u6b63\u5b9e\u73b0\u4e86 CUDA Driver \u7684\u52a8\u6001\u5e93\uff1a</p> <pre><code>$ dpkg -S libcuda.so.1\nlibnvidia-compute-470:amd64: /usr/lib/x86_64-linux-gnu/libcuda.so.1\n$ ls -alh /usr/lib/x86_64-linux-gnu/libcuda.so.1\nlrwxrwxrwx 1 root root 21 May 13  2022 /usr/lib/x86_64-linux-gnu/libcuda.so.1 -&gt; libcuda.so.470.129.06\n</code></pre> <p>\u800c CUDA Driver \u7684\u5b9e\u73b0\u548c NVIDIA Driver \u7684\u7248\u672c\u662f\u7ed1\u5b9a\u7684\uff0c\u56e0\u6b64 <code>libcuda.so.1</code> \u662f\u8f6f\u94fe\u63a5\uff0c\u8f6f\u94fe\u63a5\u5230\u5bf9\u5e94\u9a71\u52a8\u7248\u672c\u7684 <code>libcuda.so</code>\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\uff0c\u7f16\u8bd1 CUDA \u7684\u673a\u5668\uff0c\u4e0d\u9700\u8981\u5b89\u88c5 NVIDIA Driver\uff0cCUDA \u4e5f\u4e0d\u9700\u8981\u81ea\u5df1\u5e26\u4e00\u4efd CUDA Driver \u8fdb\u6765\uff0c\u8282\u7701\u4e86\u7a7a\u95f4\u3002</p> <p>\u50cf pytorch \u8fd9\u79cd\u652f\u6301 CUDA \u7684\u7a0b\u5e8f\uff0c\u4e0d\u4f1a\u5728\u94fe\u63a5\u7684\u65f6\u5019\u94fe\u63a5\u5230 <code>libcuda</code> \u4e0a\uff0c\u800c\u662f\u5728\u7528\u6237\u9700\u8981\u7684\u65f6\u5019\uff0c\u53bb <code>dlopen</code>\u3002\u8fd9\u6837\u5373\u4f7f\u7528\u6237\u7684\u7535\u8111\u4e0a\u6ca1\u6709\u88c5 NVIDIA Driver\uff0c\u4e5f\u53ef\u4ee5\u8fd0\u884c\u652f\u6301 CUDA \u7684 pytorch\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#dynamic-linkerloader","title":"dynamic linker/loader","text":"<p>\u524d\u6587\u8bb2\u5230\uff0c\u52a8\u6001\u94fe\u63a5\u5e93\u53c2\u4e0e\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u51fd\u6570\u672c\u8eab\u6ca1\u6709\u94fe\u63a5\u8fdb\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u6700\u540e\u7684\u52a0\u8f7d\u662f\u7531 dynamic linker/loader \u5b8c\u6210\u7684\uff0c\u5728 linux \u4e0a\u662f ld.so\uff0c\u5728 macOS \u4e0a\u662f dyld\u3002\u5b83\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\uff0c\u8d1f\u8d23\u6839\u636e NEEDED \u4fe1\u606f\uff0c\u77e5\u9053\u7a0b\u5e8f\u8981\u52a0\u8f7d\u54ea\u4e9b\u52a8\u6001\u5e93\uff0c\u7136\u540e\u53bb\u6587\u4ef6\u7cfb\u7edf\u91cc\u627e\uff0c\u5982\u679c\u627e\u5230\u4e86\uff0c\u5c31\u628a\u76f8\u5e94\u7684\u52a8\u6001\u5e93\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u628a\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u5bf9\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u51fd\u6570\u8c03\u7528\uff0c\u53d8\u6210\u771f\u5b9e\u7684\u5730\u5740\u3002\u76f8\u5f53\u4e8e\u628a\u539f\u6765\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u94fe\u63a5\u5668\u505a\u7684\u4e8b\u60c5\uff0c\u632a\u5230\u4e86\u7a0b\u5e8f\u8fd0\u884c\u5f00\u59cb\u65f6\uff0c\u5373 linking at run time\u3002</p> <p>\u90a3\u4e48\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e00\u4e2a\u95ee\u9898\u4e86\uff1aNEEDED \u53ea\u8bb0\u5f55\u4e86\u6587\u4ef6\u540d\uff0c\u4f46\u662f\u5374\u6ca1\u6709\u8def\u5f84\u3002\u8fd9\u610f\u5473\u7740\u52a8\u6001\u5e93\u4e5f\u9700\u8981\u7528\u7c7b\u4f3c PATH \u7684\u673a\u5236\uff0c\u5728\u4e00\u4e9b\u8def\u5f84\u91cc\u53bb\u5bfb\u627e\u4e00\u4e2a\u60f3\u8981\u7684\u52a8\u6001\u5e93\u3002\u4f8b\u5982\u524d\u6587\u4fee\u6539 <code>LD_LIBRARY_PATH</code>\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u544a\u8bc9 ld.so\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u6307\u5411\u7684\u8def\u5f84\u4e2d\u5bfb\u627e\u52a8\u6001\u5e93\u7684\u6587\u4ef6\u3002</p> <p>\u800c\u7528\u7cfb\u7edf\u5305\u7ba1\u7406\u5668\u5b89\u88c5\u7684\u52a8\u6001\u5e93\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u4fee\u6539 <code>LD_LIBRARY_PATH</code> \u4e5f\u53ef\u4ee5\u7528\u3002\u8fd9\u662f\u9760 <code>/etc/ld.so.cache</code> \u6587\u4ef6\u5b9e\u73b0\u7684\u3002\u5728\u52a8\u6001\u5e93\u76f8\u5173\u7684\u95ee\u9898\u91cc\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u8fd0\u884c <code>ldconfig</code> \u547d\u4ee4\u3002\u8fd9\u4e2a\u547d\u4ee4\u7684\u7528\u9014\u662f\uff0c\u6536\u96c6\u7cfb\u7edf\u76ee\u5f55\u91cc\u7684\u52a8\u6001\u5e93\uff0c\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\uff0c\u4fdd\u5b58\u5728 <code>/etc/ld.so.cache</code> \u6587\u4ef6\u4e2d\u3002\u7136\u540e ld.so \u76f4\u63a5\u53bb <code>/etc/ld.so.cache</code> \u4e2d\u5bfb\u627e NEEDED \u7684\u52a8\u6001\u5e93\u5bf9\u5e94\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u8def\u5f84\uff0c\u4e0d\u9700\u8981\u518d\u91cd\u65b0\u626b\u63cf\u4e00\u904d\u76ee\u5f55\u4e86\u3002\u6240\u4ee5 <code>/etc/ld.so.cache</code> \u5c31\u662f\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u52a8\u6001\u5e93\u7684\u7f13\u5b58\uff0c\u8fd9\u4e5f\u5c31\u662f\u4e3a\u5565\u53eb\u505a <code>ld.so.cache</code>\u3002</p> <p>\u65e2\u7136\u662f\u7f13\u5b58\uff0c\u5c31\u8981\u8003\u8651\u7f13\u5b58\u548c\u5b9e\u9645\u5bf9\u4e0d\u4e0a\u7684\u60c5\u51b5\uff0c\u8fd9\u5c31\u662f\u4e3a\u5565\u8981\u8fd0\u884c <code>ldconfig</code> \u547d\u4ee4\u66f4\u65b0\u7f13\u5b58\u3002\u5f53\u7136\u4e86\uff0c\u5305\u7ba1\u7406\u5668\u4f1a\u81ea\u52a8\u8fd0\u884c <code>ldconfig</code>\uff0c\u53ea\u6709\u81ea\u5df1 <code>make install</code> \u4e00\u4e9b\u5e93\u7684\u65f6\u5019\uff0c\u624d\u9700\u8981\u624b\u52a8\u8fdb\u884c <code>ldconfig</code>\u3002</p> <p><code>ldconfig</code> \u4f1a\u4ece <code>/etc/ld.so.conf</code> \u4e2d\u914d\u7f6e\u7684\u8def\u5f84\u4e2d\u626b\u63cf\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5e38\u89c1\u7684\u8def\u5f84\u5305\u62ec\uff1a</p> <ul> <li>/lib/x86_64-linux-gnu</li> <li>/usr/lib/x86_64-linux-gnu</li> <li>/usr/local/lib</li> <li>/usr/local/lib/x86_64-linux-gnu</li> </ul> <p>\u5305\u7ba1\u7406\u5668\u5b89\u88c5\u7684\u52a8\u6001\u5e93\u57fa\u672c\u90fd\u5728\u8fd9\u4e9b\u76ee\u5f55\u4e2d\u3002\u53ef\u4ee5\u7528 <code>ldconfig -p</code> \u6765\u67e5\u770b\u7f13\u5b58 <code>ld.so.cache</code> \u7684\u5185\u5bb9\uff1a</p> <pre><code>$ /sbin/ldconfig -p\n1967 libs found in cache `/etc/ld.so.cache'\n        libz3.so.4 (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libz3.so.4\n        libz3.so (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libz3.so\n        ld-linux.so.2 (ELF) =&gt; /lib/i386-linux-gnu/ld-linux.so.2\n        ld-linux.so.2 (ELF) =&gt; /lib32/ld-linux.so.2\n        ld-linux.so.2 (ELF) =&gt; /lib/ld-linux.so.2\n        ld-linux-x86-64.so.2 (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2\n        ld-linux-x32.so.2 (libc6,x32) =&gt; /libx32/ld-linux-x32.so.2\n</code></pre> <p>\u7ef4\u62a4\u4e86 soname \u5230\u6587\u4ef6\u7cfb\u7edf\u4e2d\u52a8\u6001\u5e93\u6587\u4ef6\u7684\u6620\u5c04\u3002\u5e76\u4e14\u6dfb\u52a0\u4e86\u4e00\u4e9b\u5c5e\u6027\u6765\u5e2e\u52a9 ld.so \u8fdb\u884c\u8fc7\u6ee4\u548c\u9009\u62e9\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#rpath","title":"rpath","text":"<p>\u9664\u4e86 LD_LIBRARY_PATH \u548c <code>/etc/ld.so.cache</code>\uff0cld.so \u8fd8\u53ef\u4ee5\u901a\u8fc7 rpath \u6765\u5bfb\u627e\u52a8\u6001\u5e93\u3002\u8bbe\u60f3\u8981\u6253\u5305\u4e00\u4e2a Qt \u7a0b\u5e8f\uff0c\u5e0c\u671b\u5728\u522b\u4eba\u7684\u673a\u5668\u4e0a\u53ef\u4ee5\u76f4\u63a5\u8dd1\uff0c\u4f46\u662f\u522b\u4eba\u7684\u673a\u5668\u4e0a\u4e0d\u4e00\u5b9a\u6709 Qt\uff0c\u56e0\u6b64\u9700\u8981\u628a\u7a0b\u5e8f\u548c Qt \u7684\u5404\u79cd\u52a8\u6001\u5e93\u6253\u5305\u5728\u4e00\u8d77\u3002\u4f46\u662f\uff0c\u8fd9\u65f6\u5019 Qt \u7684\u52a8\u6001\u5e93\u4e0d\u4f1a\u5728\u7cfb\u7edf\u8def\u5f84\u4e2d\uff0c\u4e0d\u4f1a\u88ab <code>ldconfig</code> \u7d22\u5f15\u3002\u4e00\u79cd\u529e\u6cd5\u5c31\u662f\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u8bbe\u7f6e\u4e00\u4e0b <code>LD_LIBRARY_PATH</code>\uff0c\u518d\u542f\u52a8 Qt \u7a0b\u5e8f\u3002\u53e6\u4e00\u79cd\u529e\u6cd5\uff0c\u5c31\u662f\u5229\u7528 rpath\uff1a\u5728\u7a0b\u5e8f\u4e2d\u5c31\u544a\u8bc9 ld.so \u53bb\u54ea\u91cc\u627e\u5b83\u4f9d\u8d56\uff08NEEDED\uff09\u7684\u52a8\u6001\u5e93\u3002\u8fd9\u4e2a\u8def\u5f84\u53ef\u4ee5\u662f\u76f8\u5bf9\u4e8e\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8def\u5f84\u3002</p> <p>\u8bbe\u7f6e <code>rpath</code> \u7684\u65b9\u6cd5\u662f\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u6dfb\u52a0 <code>-Wl,-rpath,RPATH</code> \u9009\u9879\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ gcc main.c libtest.so.0.0.0 -o main\n$ ./main\n./main: error while loading shared libraries: libtest.so.0: cannot open shared object file: No such file or directory\n$ gcc main.c libtest.so.0.0.0 -Wl,-rpath,$PWD -o main\n$ ./main\nSimple function\n$ readelf -d main\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libtest.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000001d (RUNPATH)            Library runpath: [/tmp]\n$ gcc main.c libtest.so.0.0.0 -Wl,-rpath,'$ORIGIN' -o main\n$ ./main\nSimple function\n$ readelf -d main\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libtest.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000001d (RUNPATH)            Library runpath: [$ORIGIN]\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u7f16\u8bd1\u547d\u4ee4\u4e0d\u5e26 <code>rpath</code>\uff0c\u56e0\u6b64 ld.so \u4f1a\u627e\u4e0d\u5230\u52a8\u6001\u5e93\uff0c\u53ef\u4ee5\u6dfb\u52a0 LD_LIBRARY_PATH \u7684\u529e\u6cd5\u6765\u89e3\u51b3\u3002\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u7f16\u8bd1\u547d\u4ee4\u5e26 <code>rpath</code>\uff0c\u5176\u4e2d\u7b2c\u4e8c\u4e2a\u4f7f\u7528\u4e86\u7edd\u5bf9\u8def\u5f84\uff0c\u7b2c\u4e09\u4e2a\u4f7f\u7528\u4e86\u76f8\u5bf9\u8def\u5f84\uff08<code>$ORIGIN</code> \u8868\u793a\u53ef\u6267\u884c\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\uff09\u3002\u90a3\u4e48\uff0cld.so \u5728\u5bfb\u627e libtest.so.0 \u7684\u65f6\u5019\uff0c\u4f1a\u5728 RUNPATH \u4e2d\u8fdb\u884c\u5bfb\u627e\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#\u8c03\u8bd5","title":"\u8c03\u8bd5","text":"<p>\u52a8\u6001\u94fe\u63a5\u7ecf\u5e38\u4f1a\u9047\u5230\u5404\u79cd\u627e\u4e0d\u5230\u52a8\u6001\u5e93\u7684\u95ee\u9898\uff0c\u9700\u8981\u4f7f\u7528\u4e00\u4e9b\u5de5\u5177\u6765\u5e2e\u52a9\u627e\u5230\u95ee\u9898\u3002\u6700\u5e38\u7528\u7684\u5c31\u662f <code>ldd</code> \u547d\u4ee4\uff0c\u663e\u793a\u4e00\u4e2a\u7a0b\u5e8f\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\u4ee5\u53ca\u8def\u5f84\uff1a</p> <pre><code>$ ldd $(which vim)\n        linux-vdso.so.1 (0x00007fff599a4000)\n        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f0504dfc000)\n        libtinfo.so.6 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.6 (0x00007f0504dc9000)\n        libselinux.so.1 =&gt; /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f0504d9b000)\n        libsodium.so.23 =&gt; /lib/x86_64-linux-gnu/libsodium.so.23 (0x00007f05049a6000)\n        libacl.so.1 =&gt; /lib/x86_64-linux-gnu/libacl.so.1 (0x00007f0504d90000)\n        libgpm.so.2 =&gt; /lib/x86_64-linux-gnu/libgpm.so.2 (0x00007f050499e000)\n        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f05047bd000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f0504f07000)\n        libpcre2-8.so.0 =&gt; /lib/x86_64-linux-gnu/libpcre2-8.so.0 (0x00007f0504723000)\n        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f0504d89000)\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c<code>ldd</code> \u6709\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u4e0d\u5efa\u8bae\u5728\u4e0d\u4fe1\u4efb\u7684\u7a0b\u5e8f\u4e0a\u8fd0\u884c <code>ldd</code>\uff0c\u8be6\u60c5\u89c1 ldd.1\u3002\u66f4\u7a33\u59a5\u7684\u65b9\u6cd5\u662f\u7528 <code>objdump -p</code> \u6216\u8005 <code>readelf -d</code>\uff1a</p> <pre><code>$ objdump -p $(which vim) | grep NEEDED\n$ readelf -d $(which vim) | grep NEEDED\n</code></pre> <p>\u4f46\u662f ldd \u53ef\u4ee5\u6253\u5370\u51fa\u52a8\u6001\u5e93\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\uff0c\u800c objdump \u548c readelf \u53ea\u4f1a\u6253\u5370\u76f4\u63a5\u4f9d\u8d56\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u8ba9 ld.so \u6253\u5370\u51fa\u52a0\u8f7d\u7684\u52a8\u6001\u5e93\uff1a</p> <pre><code>$ export LD_DEBUG=files\n$ ./main\n   2243766:     file=libtest.so.0 [0];  needed by ./main [0]\n   2243766:     file=libtest.so.0 [0];  generating link map\n   2243766:       dynamic: 0x00007fcd57c23df8  base: 0x00007fcd57c20000   size: 0x0000000000004018\n   2243766:         entry: 0x00007fcd57c20000  phdr: 0x00007fcd57c20040  phnum:                  9\n   2243766:\n   2243766:     file=libc.so.6 [0];  needed by ./main [0]\n   2243766:     file=libc.so.6 [0];  generating link map\n   2243766:       dynamic: 0x00007fcd57bf1b60  base: 0x00007fcd57a20000   size: 0x00000000001e0f50\n   2243766:         entry: 0x00007fcd57a47350  phdr: 0x00007fcd57a20040  phnum:                 14\n   2243766:\n   2243766:     calling init: /lib64/ld-linux-x86-64.so.2\n   2243766:     calling init: /lib/x86_64-linux-gnu/libc.so.6\n   2243766:     calling init: /tmp/libtest.so.0\n   2243766:     initialize program: ./main\n   2243766:     transferring control: ./main\n   2243766:     calling fini: ./main [0]\n   2243766:     calling fini: /tmp/libtest.so.0 [0]\nSimple function\n</code></pre>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#macos","title":"macOS","text":"<p>macOS \u4e0e Linux \u4e0b\u52a8\u6001\u5e93\u7684\u4f7f\u7528\u65b9\u6cd5\u57fa\u672c\u7c7b\u4f3c\uff0c\u4f46\u6709\u4e00\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\u3002\u9996\u5148\u662f macOS \u4e0a\u7684\u52a8\u6001\u5e93\u7684\u540e\u7f00\u7528\u7684\u662f dylib \u800c\u4e0d\u662f so\uff1a</p> <pre><code>$ gcc -fPIC -shared source1.c -o libtest.dylib\n$ gcc main.c libtest.dylib -o main\n$ objdump -t libtest.dylib\nlibtest.dylib:  file format mach-o arm64\n\nSYMBOL TABLE:\n0000000000003f7c g     F __TEXT,__text _simple_function\n0000000000000000         *UND* _printf\n$ objdump -t main\nmain:   file format mach-o arm64\n\nSYMBOL TABLE:\n0000000100000000 g     F __TEXT,__text __mh_execute_header\n0000000100003f94 g     F __TEXT,__text _main\n0000000000000000         *UND* _simple_function\n</code></pre> <p>\u867d\u7136\u8fd9\u91cc\u7528\u7684\u662f gcc \u547d\u4ee4\uff0c\u4f46\u5b9e\u9645\u4e0a macOS \u4e0a\u7684 gcc \u547d\u4ee4\u662f clang\u3002\u8fd9\u91cc\u76f4\u63a5\u7528 clang \u547d\u4ee4\u4e5f\u662f\u4e00\u6837\u7684\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d <code>simple_function</code> \u51fd\u6570\u4e5f\u662f\u5904\u4e8e undefined \u72b6\u6001\uff0c\u9700\u8981\u5728\u8fd0\u884c\u65f6\u7531 <code>libtest.dylib</code> \u63d0\u4f9b\u3002</p> <p>macOS \u4e0b\u7684\u52a8\u6001\u94fe\u63a5\u5668\u662f dyld\uff0c\u5b83\u4f1a\u89e3\u6790 MachO \u7684 Load command \u53bb\u52a0\u8f7d\u52a8\u6001\u5e93\uff1a</p> <pre><code>$ objdump -p main\nLoad command 13\n          cmd LC_LOAD_DYLIB\n      cmdsize 40\n         name libtest.dylib (offset 24)\n   time stamp 2 Thu Jan  1 08:00:02 1970\n      current version 0.0.0\ncompatibility version 0.0.0\nLoad command 14\n          cmd LC_LOAD_DYLIB\n      cmdsize 56\n         name /usr/lib/libSystem.B.dylib (offset 24)\n   time stamp 2 Thu Jan  1 08:00:02 1970\n      current version 1319.100.3\ncompatibility version 1.0.0\n</code></pre> <p>\u8fd9\u5c31\u76f8\u5f53\u4e8e Linux \u4e2d\u7684 NEEDED\uff0c\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\u8981\u52a0\u8f7d\u54ea\u4e9b\u52a8\u6001\u5e93\u3002\u53ef\u4ee5\u7528 <code>otool -L</code> \u6216\u8005 <code>dyld_info</code> \u547d\u4ee4\u5217\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u6240\u6709\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\uff1a</p> <pre><code>$ otool -L main\nmain:\n        libtest.dylib (compatibility version 0.0.0, current version 0.0.0)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1319.100.3)\n$ dyld_info -dependents main\nmain [arm64]:\n    -dependents:\n        attributes     load path\n                       libtest.dylib\n                       /usr/lib/libSystem.B.dylib\n</code></pre> <p>macOS \u4e5f\u63d0\u4f9b\u4e86 rpath \u7684\u673a\u5236\uff0c\u5728 <code>LC_LOAD_DYLIB</code> \u4e2d\u6307\u5b9a <code>@rpath</code>\uff0c\u7136\u540e\u901a\u8fc7 <code>LC_RPATH</code> \u6307\u5b9a\u6709\u54ea\u4e9b rpath\uff0c\u90a3\u4e48\u52a8\u6001\u94fe\u63a5\u5668\u5c31\u53ef\u4ee5\u6839\u636e\u53ef\u6267\u884c\u6587\u4ef6\u7684\u76f8\u5bf9\u8def\u5f84\u53bb\u5bfb\u627e\u52a8\u6001\u5e93\uff1a</p> <pre><code>$ objdump -p /Applications/Visual\\ Studio\\ Code.app/Contents/MacOS/Electron\nLoad command 8\n          cmd LC_RPATH\n      cmdsize 48\n         path @executable_path/../Frameworks (offset 12)\nLoad command 13\n          cmd LC_LOAD_DYLIB\n      cmdsize 80\n         name @rpath/Electron Framework.framework/Electron Framework (offset 24)\n   time stamp 0 Thu Jan  1 08:00:00 1970\n      current version 22.5.2\ncompatibility version 0.0.0\nLoad command 14\n          cmd LC_LOAD_DYLIB\n      cmdsize 56\n         name /usr/lib/libSystem.B.dylib (offset 24)\n   time stamp 0 Thu Jan  1 08:00:00 1970\n      current version 1311.100.3\n$ otool -L /Applications/Visual\\ Studio\\ Code.app/Contents/MacOS/Electron\n/Applications/Visual Studio Code.app/Contents/MacOS/Electron:\n        @rpath/Electron Framework.framework/Electron Framework (compatibility version 0.0.0, current version 22.5.2)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.100.3)\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u8ba9 dyld \u52a8\u6001\u6253\u5370\u65e5\u5fd7\uff1a</p> <pre><code>$ export DYLD_PRINT_LIBRARIES=1\n$ ./main\ndyld[17486]: &lt;F4E9A9E0-E958-3D0C-8D5A-7DC3ABA8E8C4&gt; /Volumes/Data/temp/main\ndyld[17486]: &lt;DD5E30FB-753D-3746-8034-50C56971C47B&gt; /Volumes/Data/temp/libtest.dylib\ndyld[17486]: &lt;4BEBCD61-9E62-39BE-BFD2-C7D0689A826D&gt; /usr/lib/libSystem.B.dylib\ndyld[17486]: &lt;FEA038BA-CC59-3085-93B0-AB8437AA6CE2&gt; /usr/lib/system/libcache.dylib\ndyld[17486]: &lt;34AC4B05-E145-3C58-8C24-1190770EAB31&gt; /usr/lib/system/libcommonCrypto.dylib\ndyld[17486]: &lt;1D6552C4-49C4-374F-8371-198BCFC4174D&gt; /usr/lib/system/libcompiler_rt.dylib\ndyld[17486]: &lt;E61C2838-9EA2-33CE-B96B-85FF38DB7744&gt; /usr/lib/system/libcopyfile.dylib\ndyld[17486]: &lt;4A9F9101-A1B1-3FB7-89EA-746CFCE95099&gt; /usr/lib/system/libcorecrypto.dylib\ndyld[17486]: &lt;C2FD3094-B465-39A4-B774-16583FF53C4B&gt; /usr/lib/system/libdispatch.dylib\ndyld[17486]: &lt;A2947B47-B494-36D4-96C6-95977FFB51FB&gt; /usr/lib/system/libdyld.dylib\ndyld[17486]: &lt;C4512BA5-7CA3-30AE-9793-5CC5417F0FC3&gt; /usr/lib/system/libkeymgr.dylib\ndyld[17486]: &lt;91A88FDF-FD27-32AF-A2CE-70F7E4065C3B&gt; /usr/lib/system/libmacho.dylib\ndyld[17486]: &lt;A2D17FF6-CBC6-3D19-89E1-F5E57191E8A3&gt; /usr/lib/system/libquarantine.dylib\ndyld[17486]: &lt;2213EE66-253B-3234-AA4D-B46F07C3540E&gt; /usr/lib/system/libremovefile.dylib\ndyld[17486]: &lt;68D76774-F8B4-36EA-AA35-0AB4044D56C7&gt; /usr/lib/system/libsystem_asl.dylib\ndyld[17486]: &lt;5541DF62-A795-3F57-A54C-1AEC4DD3E44C&gt; /usr/lib/system/libsystem_blocks.dylib\ndyld[17486]: &lt;95A70E20-1DF3-3DDF-900C-315ED0B2C067&gt; /usr/lib/system/libsystem_c.dylib\ndyld[17486]: &lt;BEB9DE52-6F49-370A-B45B-CBE6780E7083&gt; /usr/lib/system/libsystem_collections.dylib\ndyld[17486]: &lt;121F8B4D-3939-300D-BE22-979D6B476361&gt; /usr/lib/system/libsystem_configuration.dylib\ndyld[17486]: &lt;7CE9526A-B673-363A-8905-71D080974C0E&gt; /usr/lib/system/libsystem_containermanager.dylib\ndyld[17486]: &lt;54BF691A-0908-3548-95F2-34CFD58E5617&gt; /usr/lib/system/libsystem_coreservices.dylib\ndyld[17486]: &lt;579733C7-851D-3B3E-83B5-FD203BA50D02&gt; /usr/lib/system/libsystem_darwin.dylib\ndyld[17486]: &lt;4EFF0147-928F-3321-8268-655FE71DC209&gt; /usr/lib/system/libsystem_dnssd.dylib\ndyld[17486]: &lt;5068382F-DC0F-3824-8ED5-18A24B35FEF9&gt; /usr/lib/system/libsystem_featureflags.dylib\ndyld[17486]: &lt;4448FB99-7B1D-3E15-B7EE-3340FF0DA88D&gt; /usr/lib/system/libsystem_info.dylib\ndyld[17486]: &lt;82E529F5-C4DF-3D42-9113-3A4F87FEF1A0&gt; /usr/lib/system/libsystem_m.dylib\ndyld[17486]: &lt;0AC99C6E-CB01-30E5-AB10-65AB990652A5&gt; /usr/lib/system/libsystem_malloc.dylib\ndyld[17486]: &lt;3B2CC4A9-A5EE-3627-8293-4AF4D891074E&gt; /usr/lib/system/libsystem_networkextension.dylib\ndyld[17486]: &lt;E4AA6E5F-2501-3382-BFB3-64464E6D8254&gt; /usr/lib/system/libsystem_notify.dylib\ndyld[17486]: &lt;99FDEFF2-36F1-3436-B8B2-DE0003B5A4BF&gt; /usr/lib/system/libsystem_sandbox.dylib\ndyld[17486]: &lt;E529D1AC-D20A-3308-9033-E1712A9C655E&gt; /usr/lib/system/libsystem_secinit.dylib\ndyld[17486]: &lt;42F503E2-9273-360A-A086-C1B19BBD3962&gt; /usr/lib/system/libsystem_kernel.dylib\ndyld[17486]: &lt;F80C6971-C080-31F5-AB6E-BE01311154AF&gt; /usr/lib/system/libsystem_platform.dylib\ndyld[17486]: &lt;46D35233-A051-3F4F-BBA4-BA56DDDC4D1A&gt; /usr/lib/system/libsystem_pthread.dylib\ndyld[17486]: &lt;F9F1F4BE-D97F-37A7-8382-552C22DF1BB4&gt; /usr/lib/system/libsystem_symptoms.dylib\ndyld[17486]: &lt;3F3E75B7-F0A7-30BB-9FD7-FD1307FE6055&gt; /usr/lib/system/libsystem_trace.dylib\ndyld[17486]: &lt;E3BF7A76-2CBE-3DB9-8496-8BB6DBBE0CFC&gt; /usr/lib/system/libunwind.dylib\ndyld[17486]: &lt;F3F19227-FF8F-389C-A094-6F4C16E458AF&gt; /usr/lib/system/libxpc.dylib\ndyld[17486]: &lt;52AA13E2-567C-36C2-9494-7B892FDBF245&gt; /usr/lib/libc++abi.dylib\ndyld[17486]: &lt;5BEAFA2B-3AF4-3ED2-B054-1F58A7C851EF&gt; /usr/lib/libobjc.A.dylib\ndyld[17486]: &lt;FB664621-26AE-3F46-8F5A-DD5D890A5CE7&gt; /usr/lib/liboah.dylib\ndyld[17486]: &lt;54E8FBE1-DF0D-33A2-B8FA-356565C12929&gt; /usr/lib/libc++.1.dylib\nSimple function\n</code></pre> <p>\u4e0e Linux \u4e0a\u7684 <code>/etc/ld.so.cache</code> \u7c7b\u4f3c\uff0cmacOS \u4e5f\u9488\u5bf9\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u505a\u4e86\u4f18\u5316\uff0c\u4f46\u662f macOS \u505a\u7684\u66f4\u5f7b\u5e95\uff1a\u7531\u4e8e macOS \u7684\u7cfb\u7edf\u5e93\u662f\u53ea\u8bfb\u7684\uff0c\u4e8e\u662f\u76f4\u63a5\u628a\u6240\u6709\u7cfb\u7edf\u5e93\u6253\u5305\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5c31\u662f dyld shared cache\u3002\u53ef\u4ee5\u7528 keith/dyld-shared-cache-extractor \u6765\u8fd8\u539f\u51fa\u5185\u90e8\u7684 dylib\u3002\u5728 macOS Ventura 13.4 \u4e2d\uff0c\u53ef\u4ee5\u89e3\u51fa 2499 \u4e2a\u52a8\u6001\u5e93\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#relocation","title":"relocation","text":"<p>\u94fe\u63a5\u5668\u627e\u5230\u7b26\u53f7\u4ee5\u540e\uff0c\u5c31\u9700\u8981\u8fdb\u884c relocation\u3002\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u51c6\u5907\u672a\u6765\u94fe\u63a5\u65f6\u7684\u9700\u8981\uff0c\u63d0\u524d\u505a\u4e86\u4e00\u4e9b\u51c6\u5907\uff1a\u56e0\u4e3a\u7b26\u53f7\u7684\u5730\u5740\u8fd8\u4e0d\u77e5\u9053\uff0c\u6240\u4ee5\u751f\u6210\u4e00\u6761\u6307\u4ee4\uff0c\u6307\u4ee4\u7684\u7acb\u5373\u6570\u5185\u5305\u62ec\u4e86\u7b26\u53f7\u7684\u5730\u5740\u7684\u4fe1\u606f\uff0c\u4f46\u6b64\u65f6\u8fd8\u4e0d\u77e5\u9053\u7acb\u5373\u6570\u5e94\u8be5\u662f\u591a\u5c11\uff0c\u6240\u4ee5\u7f16\u8bd1\u5668\u628a\u6307\u4ee4\u7684\u7acb\u5373\u6570\u586b\u5145\u4e3a 0\uff0c\u540c\u65f6\u751f\u6210\u4e00\u4e2a relocation\u3002\u5f53\u94fe\u63a5\u5668\u770b\u5230 relocation \u7684\u65f6\u5019\uff0c\u5728\u5df2\u7ecf\u6392\u597d\u6240\u6709\u7b26\u53f7\u7684\u5730\u5740\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u6309\u7167 relocation \u66f4\u65b0\u4ee3\u7801\u3002</p> <p>\u7531\u4e8e\u52a8\u6001\u94fe\u63a5\u5e93\u53ef\u80fd\u4f1a\u88ab\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u57fa\u5730\u5740\u4e0a\uff0c\u6240\u4ee5\u4e3a\u4e86\u89e3\u51b3\u52a8\u6001\u94fe\u63a5\u5e93\u5185\u90e8\u7684\u7b26\u53f7\u94fe\u63a5\u95ee\u9898\uff0c\u91c7\u7528 PIC \u7684\u65b9\u6cd5\uff0c\u5373\u901a\u8fc7\u6307\u4ee4\u672c\u8eab\u7684\u5730\u5740\u8fdb\u884c\u76f8\u5bf9\u8fd0\u7b97\uff0c\u8ba1\u7b97\u51fa\u53e6\u4e00\u4e2a\u7b26\u53f7\u7684\u5730\u5740\u3002\u8fd9\u6837\u52a8\u6001\u94fe\u63a5\u5e93\u52a0\u8f7d\u5230\u4e0d\u540c\u5730\u5740\u7684\u65f6\u5019\uff0c\u5185\u90e8\u7684\u7b26\u53f7\u4e4b\u95f4\u90fd\u53ef\u4ee5\u6b63\u5e38\u5f15\u7528\uff0c\u4e0d\u9700\u8981\u4fee\u6539\u6307\u4ee4\uff0c\u4f7f\u5f97\u52a8\u6001\u5e93\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u95f4\u5171\u4eab\u3002</p> <p>\u4f46\u662f\u8fd8\u9700\u8981\u8003\u8651\u52a8\u6001\u94fe\u63a5\u5e93\u4f7f\u7528\u4e86\u5176\u4ed6\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u7b26\u53f7\uff08\u5168\u5c40\u53d8\u91cf\uff09\u3002\u8fd9\u4e2a\u65f6\u5019\uff0cPIC \u7684\u65b9\u6cd5\u5931\u6548\u4e86\uff0c\u56e0\u4e3a\u65e0\u6cd5\u786e\u5b9a\u5176\u4ed6\u52a8\u6001\u94fe\u63a5\u5e93\u4f1a\u52a0\u8f7d\u5230\u4ec0\u4e48\u5730\u5740\u3002\u6b64\u65f6\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u7528 GOT\uff0c\u7a0b\u5e8f\u5728\u5f15\u7528\u7b26\u53f7\u7684\u65f6\u5019\uff0c\u53bb GOT \u91cc\u67e5\u627e\u5b9e\u9645\u7684\u5730\u5740\u3002\u52a8\u6001\u94fe\u63a5\u5668\u8d1f\u8d23\u586b GOT \u8868\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u52a8\u6001\u5e93\u672c\u8eab\u8fd8\u662f\u4e0d\u4f1a\u4fee\u6539\uff0c\u53ea\u4f1a\u4fee\u6539 GOT\u3002</p> <p>\u5982\u679c\u52a8\u6001\u94fe\u63a5\u5e93\u8c03\u7528\u4e86\u5176\u4ed6\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u5b9e\u8df5\u8d77\u6765\u7a0d\u6709\u4e0d\u540c\u3002\u51fd\u6570\u4e5f\u5728 GOT \u8868\u7684 PLT \u8868\u91cc\u6709\u5b9e\u9645\u7684\u5730\u5740\uff0c\u4f46\u52a8\u6001\u94fe\u63a5\u5e93\u4e0d\u4f1a\u81ea\u52a8\u66ff\u6362\uff0c\u800c\u662f\u8ba9\u7f16\u8bd1\u5668\u751f\u6210\u4e00\u4e2a PLT stub\u3002PLT stub \u505a\u7684\u4e8b\u60c5\u662f\uff1a</p> <ol> <li>\u5982\u679c\u521d\u59cb\u5316\u8fc7\uff0c\u90a3\u4e48\u76f4\u63a5\u8df3\u8f6c\u5230\u5b9e\u9645\u7684\u51fd\u6570</li> <li>\u5982\u679c\u6ca1\u6709\u521d\u59cb\u5316\u8fc7\uff0c\u8c03\u7528 ld.so \u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u51fd\u6570\u4f1a\u627e\u5230\u5b9e\u9645\u7684\u51fd\u6570\uff0c\u5e76\u4e14\u5bf9 PLT \u8fdb\u884c\u521d\u59cb\u5316</li> </ol> <p>\u8fd9\u4e00\u7cfb\u5217\u7684\u505a\u6cd5\u90fd\u662f\u4e3a\u4e86\u8ba9\u52a8\u6001\u5e93\u7684\u5927\u90e8\u5206\u5185\u5bb9\u4fdd\u6301\u4e0d\u53d8\uff0c\u53ea\u4fee\u6539\u5c11\u90e8\u5206\u6570\u636e\u4f7f\u5f97 relocation \u53ef\u4ee5\u5de5\u4f5c\u3002\u5b8c\u6574\u7684\u5185\u5bb9\u5efa\u8bae\u9605\u8bfbPLT and GOT - the key to code sharing and dynamic libraries\u3002</p>","tags":["linker","ld"]},{"location":"software/2023/05/06/linker/#relocation-truncated-to-fit","title":"relocation truncated to fit","text":"<p>\u5e38\u89c1\u7684 <code>relocation truncated to fit</code> \u9519\u8bef\u7684\u610f\u601d\u662f\uff0c\u94fe\u63a5\u5668\u5728\u8fdb\u884c relocation \u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u628a\u60f3\u8981\u7684\u503c\u586b\u5165\u5230\u7f16\u8bd1\u5668\u9884\u7559\u7684\u7acb\u5373\u6570\u91cc\u9762\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u4e0d\u77e5\u9053\u504f\u79fb\u5177\u4f53\u662f\u591a\u5c11\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u9009\u62e9\u7528\u4e0d\u540c\u7684\u6307\u4ee4\u5e8f\u5217\uff0c\u6709\u7684\u6307\u4ee4\u5e8f\u5217\u6bd4\u8f83\u77ed\uff0c\u4f46\u662f\u7acb\u5373\u6570\u4f4d\u6570\u4e5f\u6bd4\u8f83\u5c11\uff1b\u6709\u7684\u6307\u4ee4\u5e8f\u5217\u6bd4\u8f83\u957f\uff0c\u4f46\u662f\u53ef\u4ee5\u8bbf\u95ee\u66f4\u5927\u8303\u56f4\u7684\u504f\u79fb\u3002\u5982\u679c\u7f16\u8bd1\u5668\u9009\u62e9\u4e86\u6bd4\u8f83\u5c0f\u7684\u8303\u56f4\uff0c\u4f46\u662f\u94fe\u63a5\u5668\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u653e\u4e0d\u4e0b\uff0c\u5c31\u4f1a\u51fa\u73b0 <code>relocation truncated to fit</code> \u7684\u9519\u8bef\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff0c\u4e00\u662f\u67e5\u770b\u662f\u5426\u771f\u7684\u6709\u90a3\u4e48\u5927\u7684\u504f\u79fb\uff0c\u4f8b\u5982\u662f\u5426\u4e0d\u5c0f\u5fc3\u5206\u914d\u4e86\u4e00\u4e2a\u8d85\u7ea7\u5927\u7684\u5168\u5c40\u6570\u7ec4\uff0c\u662f\u7684\u8bdd\u662f\u5426\u780d\u6389\u4e00\u4e9b\u5927\u5c0f\uff1b\u4e8c\u662f\u4fee\u6539 Code Model\uff0c\u4e5f\u5c31\u662f\u8ba9\u7f16\u8bd1\u5668\u9009\u62e9\u66f4\u5927\u7684 Code Model\uff0c\u4ee5\u66f4\u957f\u7684\u6307\u4ee4\u7684\u4ee3\u4ef7\uff0c\u652f\u6301\u66f4\u5927\u8303\u56f4\u7684 relocation\u3002\u5b8c\u6574\u5185\u5bb9\u63a8\u8350\u9605\u8bfb Relocation overflow and code models by MaskRay\u3002</p>","tags":["linker","ld"]},{"location":"software/2024/10/23/linux-core-scheduling/","title":"Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76","text":"","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u770b\u5230\u4e00\u4e9b\u5173\u4e8e Linux \u5927\u5c0f\u6838\u8c03\u5ea6\u7b97\u6cd5\u7684\u4e00\u4e9b\u535a\u5ba2\uff0c\u8003\u8651\u5230\u5927\u5c0f\u6838\u76ee\u524d\u5df2\u7ecf\u6bd4\u8f83\u5e38\u89c1\u4e86\uff0c\u56e0\u6b64\u505a\u4e00\u4e9b\u73b0\u72b6\u7684\u63a2\u7a76\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#\u73b0\u8c61","title":"\u73b0\u8c61","text":"","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#intel","title":"Intel","text":"<p>\u9996\u5148\u53ef\u4ee5\u505a\u4e00\u4e0b\u5b9e\u9a8c\uff0c\u7528 <code>stress --cpu N</code> \u542f\u52a8 N \u4e2a\u8ba1\u7b97\u8d1f\u8f7d\uff0c\u770b\u770b\u8fd9\u4e9b\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u5206\u914d\u5230\u54ea\u4e9b\u6838\u4e0a\u3002\u5728 Intel Core i9-14900K \u4e0a\u5b9e\u9a8c\uff0c\u8fd9\u4e2a CPU \u662f 8P+16E\uff0c8P \u5bf9\u5e94 0-15 \u6838\uff0c\u8d85\u7ebf\u7a0b\u7684\u6838\u7684 ID \u662f\u8fde\u53f7\u7684\uff0c16E \u5bf9\u5e94 16-31 \u6838\uff0c\u89c2\u5bdf\u5230\u4e0b\u9762\u7684\u7ed3\u679c\uff1a</p> <ul> <li><code>N=1</code> \u65f6\uff0c\u4e3b\u8981\u8c03\u5ea6\u5230 12-15 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a\uff0c\u8fd9\u5bf9\u5e94\u7684\u662f 8P \u4e2d\u7684\u6700\u540e 2P</li> <li><code>N=2</code> \u65f6\uff0c\u4e3b\u8981\u8c03\u5ea6\u5230 12-13 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a\uff0c\u4ee5\u53ca 14-15 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a\uff0c\u540c\u6837\u4e5f\u662f 8P \u4e2d\u7684\u6700\u540e 2P\uff0c\u6bcf\u4e2a P \u4e0a\u5206\u914d\u4e00\u4e2a\u4efb\u52a1</li> <li><code>N=3</code> \u65f6\uff0c\u5728 <code>N=2</code> \u7684\u57fa\u7840\u4e0a\uff0c\u5728 0-11 \u6838\u91cc\u518d\u8c03\u5ea6\u4e00\u4e2a</li> <li><code>N=4..=8</code> \u65f6\uff0c\u5728 <code>N=2</code> \u7684\u57fa\u7840\u4e0a\uff0c\u5728 0-11 \u6838\u91cc\u8c03\u5ea6\u5269\u4e0b\u7684\u4efb\u52a1\uff0c\u4f46\u4e0d\u4f1a\u5206\u914d\u5230\u4e00\u4e2a P \u6838\u7684\u4e24\u4e2a\u903b\u8f91\u6838\u4e0a</li> <li><code>N=9..=24</code> \u65f6\uff0c\u5728 <code>N=8</code> \u7684\u57fa\u7840\u4e0a\uff0c\u5728 16-31 \u6838\u91cc\u8c03\u5ea6\u5269\u4e0b\u7684\u4efb\u52a1</li> <li><code>N=25..=32</code> \u65f6\uff0c\u5728 <code>N=24</code> \u7684\u57fa\u7840\u4e0a\uff0c\u628a\u4efb\u52a1\u5206\u914d\u5230 P \u6838\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u4e0a</li> </ul> <p>\u53ef\u89c1\u5728\u8c03\u5ea6\u65f6\uff0c\u6309\u7167\u5982\u4e0b\u7684\u4f18\u5148\u7ea7\uff1a</p> <ol> <li>\u6700\u540e 2 \u4e2a P \u6838</li> <li>\u5176\u4f59 6 \u4e2a P \u6838</li> <li>E \u6838</li> <li>P \u6838\u7684\u8d85\u7ebf\u7a0b</li> </ol> <p>\u53ef\u89c1 P \u6838\u5185\u90e8\u4e5f\u6709\u4f18\u5148\u7ea7\u4e0d\u540c\uff0c\u6700\u540e 2 \u4e2a P \u6838\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u800c\u5b83\u4eec\u7684 Boost \u9891\u7387\u786e\u5b9e\u4e5f\u66f4\u9ad8\uff1a</p> <pre><code>$ cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq\n5700000\n$ cat /sys/devices/system/cpu/cpufreq/policy12/scaling_max_freq\n6000000\n</code></pre> <p>6 \u4e2a P \u6838\u7684\u6700\u5927\u9891\u7387\u8bbe\u5b9a\u4e3a 5.7 GHz\uff0c2 \u4e2a P \u6838\u7684\u6700\u5927\u9891\u7387\u8bbe\u5b9a\u4e3a 6.0 GHz\u3002\u56e0\u6b64\u8fd9\u4e24\u4e2a 6.0 GHz \u7684 P \u6838\u4f1a\u88ab\u4f18\u5148\u8c03\u5ea6\u3002\u6b64\u65f6\u518d\u6765\u770b Intel\u00ae Core\u2122 i9 processor 14900K Spec:</p> <ul> <li>Max Turbo Frequency: 6 GHz</li> <li>Intel\u00ae Thermal Velocity Boost Frequency: 6 GHz</li> <li>Intel\u00ae Turbo Boost Max Technology 3.0 Frequency: 5.8 GHz</li> <li>Performance-core Max Turbo Frequency: 5.6 GHz</li> <li>Performance-core Base Frequency: 3.2 GHz</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b98\u65b9\u5ba3\u4f20\u7684\u6700\u9ad8 Turbo \u9891\u7387\u662f 6 GHz\uff0c\u4f46\u5b9e\u9645\u4e0a\u53ea\u6709\u4e24\u4e2a P \u6838\u53ef\u4ee5\u8fbe\u5230\u3002</p> <p>\u4f46\u5e76\u975e\u6240\u6709\u5e73\u53f0\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u90fd\u80fd\u8fbe\u5230\u5ba3\u79f0\u7684\u6700\u9ad8\u9891\u7387\u7684\u3002\u4f8b\u5982\u5728 Dell R730 \u4e0a\uff0cXeon E5-2680 v4 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u80fd\u8fbe\u5230 2.9 GHz \u7684 Boost \u9891\u7387\uff0c\u4f46\u6309\u7167 Intel \u5b98\u7f51\uff0c\u8fd9\u4e2a CPU \u7684 Boost \u6700\u9ad8\u53ef\u4ee5\u8fbe\u5230 3.3 GHz\u3002\u5f53\u7136\u4e86\uff0c2.9 GHz \u662f\u5168\u6838\u80fd\u591f\u8fbe\u5230\u7684 Boost\uff0c3.3 GHz \u53ea\u80fd\u5c11\u6570\u7684\u6838\u8fbe\u5230\uff0c\u800c\u670d\u52a1\u5668\u573a\u666f\u4e0b\uff0c\u5927\u591a\u65f6\u95f4\u662f\u8dd1\u591a\u6838\u8d1f\u8f7d\uff0c\u9650\u5236\u5230 2.9 GHz \u4e5f\u53ef\u4ee5\u7406\u89e3\u3002\u5982\u679c\u60f3\u8981 3.3 GHz\uff0c\u5c31\u9700\u8981\u8fdb BIOS \u8bbe\u7f6e\uff0c\u628a\u8c03\u9891\u4ea4\u7ed9 OS\uff0cC-State \u4e5f\u5168\u90e8\u653e\u5f00\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0 3.3 GHz \u4e86\u3002\u8fd9\u91cc\u6bd4\u8f83\u91cd\u8981\u7684\u662f\u8981\u6253\u5f00 C6\uff0c\u56e0\u4e3a\u628a\u7a7a\u95f2\u7684\u6838\u653e\u5230 C6 \u4ee5\u540e\uff0c\u624d\u80fd\u628a\u5355\u6838\u8dd1\u5230\u6700\u9ad8\u7684\u9891\u7387\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#amd","title":"AMD","text":"<p>\u5728 AMD Ryzen 9 9950X \u4e0a\u8fdb\u884c\u7c7b\u4f3c\u7684\u5b9e\u9a8c\uff0c\u8fd9\u4e2a CPU \u6709 16 \u4e2a\u6838\uff0c0 \u6838\u548c 16 \u6838\u5bf9\u5e94\u4e00\u4e2a\u7269\u7406\u6838\uff0c\u5176\u4ed6\u4f9d\u6b64\u7c7b\u63a8\uff0c0-7 \u662f\u4e00\u4e2a CCD\uff0c8-15 \u662f\u53e6\u4e00\u4e2a CCD\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <ul> <li><code>N=1</code> \u65f6\uff0c\u4e3b\u8981\u8c03\u5ea6\u5230 4\uff0c9 \u548c 20 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=2</code> \u65f6\uff0c\u4e3b\u8981\u8c03\u5ea6\u5230 0 \u548c 16 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a\uff0c9 \u548c 25 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=3</code> \u65f6\uff0c\u5728 <code>N=2</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 4 \u548c 20 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=4</code> \u65f6\uff0c\u5728 <code>N=3</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 11 \u548c 27 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=5</code> \u65f6\uff0c\u5728 <code>N=4</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 5 \u548c 21 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=6</code> \u65f6\uff0c\u5728 <code>N=5</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 8 \u548c 24 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=7</code> \u65f6\uff0c\u5728 <code>N=6</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 3 \u548c 19 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> <li><code>N=8</code> \u65f6\uff0c\u5728 <code>N=7</code> \u7684\u57fa\u7840\u4e0a\uff0c\u8c03\u5ea6\u5230 10 \u548c 26 \u6838\u91cc\u5176\u4e2d\u4e00\u4e2a</li> </ul> <p>\u67e5\u770b\u5b83\u4eec\u7684 <code>scaling_max_freq</code>\uff0c\u4f1a\u53d1\u73b0\u90fd\u662f\u76f8\u540c\u7684 5.752 GHz\u3002\u67e5\u770b\u5b83\u4eec\u7684 <code>amd_pstate_prefcore_ranking</code>\uff0c\u53d1\u73b0\u53d6\u503c\u548c\u903b\u8f91\u6838\u7684\u6620\u5c04\u5173\u7cfb\uff1a</p> <ul> <li>236: 0,4,16,20</li> <li>231: 5,21</li> <li>226: 3,19</li> <li>221: 1,17</li> <li>216: 2,18</li> <li>211: 7,23</li> <li>206: 6,22</li> <li>201: 9,25</li> <li>196: 11,27</li> <li>191: 8,24</li> <li>186: 10,26</li> <li>181: 12,28</li> <li>176: 13,29</li> <li>171: 15,31</li> <li>166: 14,30</li> </ul> <p>\u6309\u7406\u8bf4\u503c\u8d8a\u5927\u7684\uff0c\u8d8a\u5e94\u8be5\u5148\u88ab\u8c03\u5ea6\uff0c\u5e94\u8be5\u6309 0-&gt;4-&gt;5-&gt;3 \u7684\u987a\u5e8f\u5206\u914d\uff0c\u4f46\u5b9e\u9645\u4e0a\u89c2\u5bdf\u7684\u7ed3\u679c\u5e76\u4e0d\u662f\u8fd9\u6837\u3002\u5bfb\u627e\u89c4\u5f8b\uff0c\u53d1\u73b0\u5b83\u5148\u4ece\u7b2c\u4e00\u4e2a CCD \u627e\u5230\u5206\u6570\u6700\u9ad8\u7684\uff0c\u518d\u4ece\u7b2c\u4e8c\u4e2a CCD \u627e\uff0c\u518d\u56de\u5230\u7b2c\u4e00\u4e2a CCD \u627e\u5206\u6570\u7b2c\u4e8c\u9ad8\u7684\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff1a</p> <ol> <li>\u627e\u7b2c\u4e00\u4e2a CCD \u5206\u6570\u6700\u9ad8\u7684\u6838\uff1a0</li> <li>\u627e\u7b2c\u4e8c\u4e2a CCD \u5206\u6570\u6700\u9ad8\u7684\u6838\uff1a9</li> <li>\u627e\u7b2c\u4e00\u4e2a CCD \u5206\u6570\u7b2c\u4e8c\u9ad8\u7684\u6838\uff1a4</li> <li>\u627e\u7b2c\u4e8c\u4e2a CCD \u5206\u6570\u7b2c\u4e8c\u9ad8\u7684\u6838\uff1a11</li> <li>\u627e\u7b2c\u4e00\u4e2a CCD \u5206\u6570\u7b2c\u4e09\u9ad8\u7684\u6838\uff1a5</li> <li>\u627e\u7b2c\u4e8c\u4e2a CCD \u5206\u6570\u7b2c\u4e09\u9ad8\u7684\u6838\uff1a8</li> <li>\u627e\u7b2c\u4e00\u4e2a CCD \u5206\u6570\u7b2c\u56db\u9ad8\u7684\u6838\uff1a3</li> <li>\u627e\u7b2c\u4e8c\u4e2a CCD \u5206\u6570\u7b2c\u56db\u9ad8\u7684\u6838\uff1a10</li> </ol> <p>\u8bf4\u660e\u5b83\u7684\u903b\u8f91\u662f\uff0c\u8f6e\u6d41\u4ece\u4e24\u4e2a CCD \u4e2d\u53d6\u51fa\u4e00\u4e2a\u5206\u6570\u5c3d\u91cf\u9ad8\u7684\u6838\u53bb\u5206\u914d\u8d1f\u8f7d\u3002\u5b9e\u9645\u6d4b\u4e0b\u6765\uff0c\u5206\u6570\u9ad8\u7684\u6838\u4e5f\u786e\u5b9e\u80fd\u591f Boost \u5230\u66f4\u9ad8\u7684\u9891\u7387\uff1a</p> <pre><code>$ for i in $(seq 0 15); do echo -n \"$i:\" &amp;&amp; numactl -C $i perf stat -e cycles,task-clock stress --cpu 1 --timeout 1s 2&gt;&amp;1 | grep GHz &amp;&amp; sleep 1; done\n0:     5,700,258,748      cycles:u                         #    5.717 GHz\n1:     5,642,814,521      cycles:u                         #    5.659 GHz\n2:     5,648,004,395      cycles:u                         #    5.665 GHz\n3:     5,663,175,321      cycles:u                         #    5.680 GHz\n4:     5,687,251,660      cycles:u                         #    5.704 GHz\n5:     5,667,947,179      cycles:u                         #    5.685 GHz\n6:     5,595,919,881      cycles:u                         #    5.613 GHz\n7:     5,599,885,078      cycles:u                         #    5.617 GHz\n8:     5,424,861,894      cycles:u                         #    5.441 GHz\n9:     5,427,318,403      cycles:u                         #    5.443 GHz\n10:     5,422,689,654      cycles:u                         #    5.439 GHz\n11:     5,425,760,950      cycles:u                         #    5.442 GHz\n12:     5,418,583,254      cycles:u                         #    5.435 GHz\n13:     5,425,842,189      cycles:u                         #    5.442 GHz\n14:     5,375,985,781      cycles:u                         #    5.392 GHz\n15:     5,377,887,646      cycles:u                         #    5.394 GHz\n</code></pre> <p>\u5206\u6570\u9ad8\u7684\u53ef\u4ee5\u51b2\u5230 5.7 GHz\uff0c\u5206\u6570\u4f4e\u4e00\u4e9b\u7684\u5c31\u53ea\u80fd\u5230 5.4 GHz \u4e86\u3002</p> <p>\u6ce8\uff1a\u6839\u636e David Huang \u63d0\u4f9b\u7684\u4fe1\u606f\uff0cAMD \u7684 Linux \u5185\u6838\u7ef4\u62a4\u8005\u5df2\u7ecf\u63d0\u4ea4 Patch \u6765\u4fee\u6539\u8fd9\u4e2a\u884c\u4e3a\uff0c\u4f7f\u5f97\u8fdb\u7a0b\u5c3d\u91cf\u8c03\u5ea6\u5230\u5206\u6570\u66f4\u9ad8\u7684\u6838\uff0c\u65e0\u8bba\u5b83\u5728\u54ea\u4e2a CCD\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u4e0d\u7ed1\u6838\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u5355\u6838\u8d1f\u8f7d\u4f1a\u7a33\u5b9a\u8dd1\u5728\u9891\u7387\u6700\u9ad8\u7684\u6838\u4e0a\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#qualcomm","title":"Qualcomm","text":"<p>\u6700\u540e\u518d\u770b\u4e00\u4e0b Qualcomm X1E80100 \u5e73\u53f0\uff0c\u8fd9\u4e2a\u5e73\u53f0\u6709\u4e09\u4e2a Cluster\uff1a0-3\uff0c4-7 \u548c 8-11 \u662f\u4e09\u4e2a Cluster\u3002\u5176\u4e2d\u540e\u4e24\u4e2a Cluster \u7684\u6bcf\u4e2a Cluster \u53ef\u4ee5\u652f\u6301\u5176\u4e2d\u4e00\u4e2a\u6838\u5fc3\u4ece 3.4 GHz Boost \u5230 4.0 GHz\uff0c\u52a0\u8d77\u6765\u5c31\u662f\u6700\u591a\u4e24\u4e2a\u6838\u5fc3 Boost \u5230 4.0 GHz\u3002\u6253\u4e0a cpufreq \u7684\u8865\u4e01\u540e\uff0c\u5185\u6838\u901a\u8fc7 scmi \u63a5\u53e3\u5f97\u5230\u4e86\u8fd9\u4e9b\u4fe1\u606f\uff1a</p> <pre><code>$ cat /sys/devices/system/cpu/cpufreq/policy*/scaling_max_freq\n3417600\n4012800\n4012800\n</code></pre> <p>\u4f46\u5b9e\u9645\u8c03\u5ea6\u8d77\u6765\uff0c\u5404\u4e2a\u6838\u5fc3\u4e71\u8dd1\uff0c\u800c 3.4 GHz \u8ddd\u79bb 4.0 GHz \u5dee\u8ddd\u4e0d\u5c0f\uff0c\u6027\u80fd\u5dee\u63a5\u8fd1 15%\uff0c\u53ef\u89c1\u76ee\u524d Linux \u5185\u6838\u5e76\u6ca1\u6709\u5f88\u597d\u5730\u9002\u914d\uff0c\u76ee\u524d\u8fd8\u662f\u9700\u8981\u624b\u52a8\u7ed1\u6838\u3002\u9ad8\u901a\u76ee\u524d\u8fd8\u63d0\u4ea4\u4e86 memlat govenor \u8865\u4e01\u6765\u5bf9 LLC/DDR \u6765\u8fdb\u884c DVFS\uff0c\u4f46\u5bf9\u8fd9\u4e2a\u95ee\u9898\u5e94\u8be5\u6ca1\u6709\u6539\u8fdb\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#\u5206\u6790","title":"\u5206\u6790","text":"<p>\u63a5\u4e0b\u6765\u5c31\u8981\u8fdb\u5165\u5230 Linux \u6e90\u7801\uff0c\u627e\u5230 Linux \u662f\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u8c03\u5ea6\u4f18\u5148\u7ea7\u7684\uff0c\u8fd9\u4e9b\u4f18\u5148\u7ea7\u662f\u8c01\u786e\u5b9a\u7684\uff0c\u53c8\u662f\u600e\u4e48\u4f20\u9012\u5230 Linux \u5185\u6838\uff0c\u53c8\u662f\u600e\u4e48\u53c2\u4e0e\u5230\u8c03\u5ea6\u7684\u5462\uff1f</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#intel-itmt","title":"Intel ITMT","text":"<p>\u9996\u5148\u6765\u770b\u4e00\u4e0b Intel \u7684\u8865\u4e01\uff1aSupport Intel Turbo Boost Max Technology 3.0\uff0c\u8fd9\u4e2a patch \u505a\u4e86\u8fd9\u4e9b\u4e8b\u60c5\uff1a</p> <ol> <li>PATCH v8 8/8: \u8bfb\u53d6 ACPI \u7684 CPPC \u4fe1\u606f\uff0c\u5f97\u5230\u6bcf\u4e2a\u6838\u5fc3\u7684 highest_perf\uff0c\u6839\u636e highest_perf\uff0c\u8bbe\u7f6e\u903b\u8f91\u6838\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\uff1a<code>sched_set_itmt_core_prio(cppc_perf.highest_perf, cpu);</code></li> <li>PATCH v8 1/8: \u4fee\u6539\u8c03\u5ea6\u5668\uff0c\u8ba9\u5b83\u5c0a\u91cd arch_asym_cpu_priority \u51fd\u6570\u8ba1\u7b97\u51fa\u6765\u7684\u4f18\u5148\u7ea7\uff0c\u800c\u4e0d\u662f\u6309\u7167\u6838\u5fc3\u7f16\u53f7\u4ece\u5c0f\u5230\u5927</li> <li>PATCH v8 3/8: \u5b9e\u73b0 arch_asym_cpu_priority\uff0c\u5982\u679c\u4e00\u4e2a\u7269\u7406\u6838\u5bf9\u5e94 n \u4e2a\u903b\u8f91\u6838\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u4f18\u5148\u7ea7\u4e58\u4ee5 n/1\uff0c\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7684\u4f18\u5148\u7ea7\u4e58\u4ee5 n/2\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002</li> </ol> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u4ece ACPI \u4e2d\u83b7\u53d6 CPPC \u4fe1\u606f\uff0c\u628a CPPC \u7684 Highest Perf \u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7269\u7406\u6838\u7684\u4f18\u5148\u7ea7\uff0c\u518d\u6839\u636e\u7269\u7406\u6838\u7684\u4f18\u5148\u7ea7\u8ba1\u7b97\u6bcf\u4e2a\u903b\u8f91\u6838\u7684\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u662f 2-SMT\uff0c\u90a3\u5c31\u662f\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u4f18\u5148\u7ea7\u7ffb\u500d\uff0c\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7684\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002\u4f46\u8fd9\u4e2a\u65b9\u6cd5\u6709\u5c40\u9650\u6027\uff0c\u5c31\u662f\u8981\u6c42 E \u6838\u7684\u4f18\u5148\u7ea7\u4ecb\u4e8e P \u6838\u7684\u4e24\u4e2a\u4f18\u5148\u7ea7\u4e4b\u95f4\uff0c\u8bbe\u7f6e\u8d77\u6765\u6bd4\u8f83\u522b\u626d\u3002\u540e\u6765\u9488\u5bf9 SMT \u7684\u5904\u7406\u88ab\u96c6\u6210\u5230\u4e86\u8c03\u5ea6\u5668\u5f53\u4e2d\uff0c\u56e0\u6b64\u4ece itmt \u7684\u89c6\u89d2\u6765\u770b\uff0c\u4e0d\u9700\u8981\u9488\u5bf9 SMT \u8fdb\u884c\u7279\u6b8a\u5904\u7406\uff0cSMT \u7684\u6838\u8bbe\u7f6e\u4e3a\u540c\u4e00\u4e2a\u4f18\u5148\u7ea7\u5373\u53ef\uff1ax86/sched/itmt: Give all SMT siblings of a core the same priority\u3002</p> <p>\u5728 Intel i9-14900K \u5e73\u53f0\u4e0a\uff0c\u65e0\u8bba\u5927\u5c0f\u6838\uff0cHighest Perf \u90fd\u7b49\u4e8e 255\uff0c\u6b64\u65f6\u65e0\u6cd5\u901a\u8fc7 Highest Perf \u6765\u533a\u5206\u6838\u5fc3\u7684\u4f53\u8d28\uff0c\u6b64\u65f6\u4f1a\u89e6\u53d1\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>/*\n * If CPPC is not available, fall back to MSR_HWP_CAPABILITIES bits [8:0].\n *\n * Also, on some systems with overclocking enabled, CPPC.highest_perf is\n * hardcoded to 0xff, so CPPC.highest_perf cannot be used to enable ITMT.\n * Fall back to MSR_HWP_CAPABILITIES then too.\n */\nif (ret || cppc_perf.highest_perf == CPPC_MAX_PERF)\n    cppc_perf.highest_perf = HWP_HIGHEST_PERF(READ_ONCE(all_cpu_data[cpu]-&gt;hwp_cap_cached));\n</code></pre> <p>\u67e5\u770b\u5404\u4e2a\u6838\u5fc3\u4e0a MSR_HWP_CAPABILITIES MSR \u8bb0\u5f55\u7684 Highest Perf \u503c\uff1a</p> <pre><code>for i in $(seq 0 31); do sudo turbostat -c $i -n 1 2 --interval 1 2&gt;&amp;1 | grep MSR_HWP_CAPABILITIES; done\n</code></pre> <p>\u53d1\u73b0\u540e\u4e24\u4e2a P \u6838\u7684 highest perf \u662f 77\uff0c\u5176\u4ed6 P \u6838\u7684 highest perf \u662f 73\uff0cE \u6838\u7684 highest perf \u662f 44\u3002\u56e0\u6b64 Linux \u7684\u8c03\u5ea6\u7b56\u7565\u5c31\u51fa\u6765\u4e86\uff1a\u5148\u662f\u540e\u4e24\u4e2a P \u6838\uff0c\u518d\u662f\u5176\u4ed6 P \u6838\uff0c\u7136\u540e\u662f E \u6838\uff0c\u6700\u540e\u662f SMT \u51fa\u6765\u7684\u903b\u8f91\u6838\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#acpi-cppc","title":"ACPI CPPC","text":"<p>\u63a5\u4e0b\u6765\uff0c\u67e5\u770b ACPI \u7684 CPPC \u4fe1\u606f\u4fdd\u5b58\u4e86\u4ec0\u4e48\u3002CPPC \u5168\u79f0\u662f Collaborative Processor Performance Control\uff0c\u662f\u5bf9\u5df2\u6709\u7684 P State \u7684\u6539\u8fdb\uff0c\u539f\u6765\u7684 P State \u662f\u5206\u7acb\u7684\u51e0\u4e2a\u914d\u7f6e\uff0c\u53ef\u9009\u9879\u6bd4\u8f83\u5c11\uff0cCPPC \u5bf9\u6027\u80fd\u505a\u4e86\u62bd\u8c61\uff0c\u6bcf\u4e2a\u6838\u5fc3\u53ef\u4ee5\u6709 Highest Performance\uff0cNominal Performance\uff0cLowest Nonlinear Performance \u548c Lowest Performance \u8fd9\u51e0\u4e2a\u503c\uff0c\u6027\u80fd\u53ef\u4ee5\u5728\u8fd9\u4e9b\u503c\u4e4b\u95f4\u6d6e\u52a8\u3002\u7b80\u5355\u6765\u8bf4\uff0cHighest \u5bf9\u5e94\u5355\u6838 Boost \u5230\u7684\u6700\u9ad8\u6027\u80fd\uff0cNominal \u5bf9\u5e94\u5168\u6838\u80fd\u8fbe\u5230\u7684\u6027\u80fd\uff0cLowest \u5bf9\u5e94\u6700\u4f4e\u9891\u4e0b\u7684\u6027\u80fd\uff0cLowest Nonlinear \u4ee3\u8868\u6027\u80fd\u529f\u8017\u6bd4\u7ebf\u6027\u7684\u754c\u9650\uff0c\u5f80\u4e0b\u6027\u80fd\u6838\u529f\u8017\u662f\u7ebf\u6027\u7684\uff0c\u5f80\u4e0a\u6027\u80fd\u529f\u8017\u6bd4\u4f1a\u4e0b\u964d\u3002OS \u53ef\u4ee5\u8bbe\u5b9a\u60f3\u8981\u7684\u6027\u80fd\u8303\u56f4\uff1aMinimum \u548c Maximum Perf\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u60f3\u8981\u7684\u6027\u80fd Desired Performance\u3002\u5f53\u7136\u4e86\uff0c\u786c\u4ef6\u4e5f\u4e0d\u4e00\u5b9a\u80fd\u591f\u8fbe\u5230 Highest Perf\uff0c\u5f53\u524d\u80fd\u4fdd\u8bc1\u8fbe\u5230\u7684\u6700\u9ad8\u6027\u80fd\u53eb\u505a Guaranteed Perf\u3002\u6b64\u5916\u8fd8\u6709 Energy Performance Preference (EPP)\uff0cOS \u544a\u8bc9\u786c\u4ef6\uff0c\u6211\u60f3\u8981\u80fd\u6548\u8fd8\u662f\u6027\u80fd\uff0c\u6700\u5c0f\u7684 0 \u8868\u793a\u6027\u80fd\uff0c\u6700\u5927\u7684 255 \u8868\u793a\u80fd\u6548\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u786c\u4ef6\u544a\u8bc9 OS \u4e94\u4e2a\u503c\uff1aHighest Perf\uff0cNominal Perf\uff0cLowest Nonlinear Perf\uff0cLowest Perf \u548c Guaranteed Perf\uff0cOS \u901a\u8fc7\u4e09\u4e2a\u503c\u544a\u8bc9\u786c\u4ef6\uff0c\u6211\u60f3\u8981\u4ec0\u4e48\u6837\u7684\u6027\u80fd\uff1aMin Perf\uff0cMax Perf\uff0cDesired Perf\uff0c\u4ee5\u53ca\u6027\u80fd\u548c\u529f\u8017\u54ea\u4e2a\u66f4\u770b\u91cd\uff1aEPP\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#amd-cppc","title":"AMD CPPC","text":"<p>\u5728 AMD \u5e73\u53f0\u4e0a\uff0cCPPC \u7684\u8fd9\u4e9b\u6027\u80fd\u503c\u65e2\u53ef\u4ee5\u901a\u8fc7 ACPI \u83b7\u53d6\uff0c\u53c8\u53ef\u4ee5\u901a\u8fc7 MSR \u6765\u8bfb\u5199\uff08\u6765\u6e90\uff1aProcessor Programming Reference (PPR) for AMD Family 1Ah Model 24h, Revision B0 Processors\uff09\uff1a</p> <p></p> <p></p> <p>\u5728\u66f4\u65e9\u7684 AMD \u5904\u7406\u5668\u4e2d\uff0c\u6ca1\u6709\u8fd9\u4e9b MSR\uff0c\u800c\u662f\u901a\u8fc7 MMIO \u6765\u63a7\u5236\uff0c\u8fd9\u4e9b\u4fe1\u606f\u8bb0\u5f55\u5728 ACPI CPPC \u5f53\u4e2d\u3002</p> <p>\u901a\u8fc7\u6bd4\u5bf9 <code>/sys/devices/system/cpu/cpu*/acpi_cppc/highest_perf</code> \u548c <code>/sys/devices/system/cpu/cpu*/cpufreq/amd_pstate_prefcore_ranking</code>\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5b83\u4eec\u662f\u4e00\u6837\u7684\uff0c\u8bf4\u660e amd-pstate \u9a71\u52a8\u505a\u7684\u4e8b\u60c5\u548c itmt \u7c7b\u4f3c\uff0c\u6839\u636e ACPI \u7684 Highest Perf \u4fe1\u606f\uff08\u6216\u8005\u4ece MSR 0xC001_02B0 \u8bfb\u51fa Highest Perf\uff09\uff0c\u8bbe\u7f6e Preferred Core Ranking \u4ee5\u53ca\u8c03\u5ea6\u5668\u7684\u4f18\u5148\u7ea7\u3002\u9605\u8bfb\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u786e\u5b9e\u662f\u8fd9\u4e48\u505a\u7684\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u4e2d\uff0c\u8bbe\u7f6e\u4f18\u5148\u7ea7\u4e3a <code>highest_perf</code>\uff1a<code>sched_set_itmt_core_prio((int)READ_ONCE(cpudata-&gt;highest_perf), cpudata-&gt;cpu);</code></li> <li>\u8bbe\u7f6e <code>prefcore_ranking</code> \u4e3a <code>highest_perf</code>: <code>WRITE_ONCE(cpudata-&gt;prefcore_ranking, cppc_perf.highest_perf)</code></li> <li>\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d1\u73b0 <code>highest_perf</code> \u51fa\u73b0\u53d8\u5316\uff0c\u4e5f\u66f4\u65b0\u5230\u8c03\u5ea6\u5668\u7684\u4f18\u5148\u7ea7\u5f53\u4e2d\uff1a<code>sched_set_itmt_core_prio((int)cur_high, cpu);</code></li> </ol> <p>\u5269\u4e0b\u7684\u5c31\u548c Intel \u4e00\u6837\u4e86\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8c03\u5ea6\u5668\u8f6e\u6d41\u4ece\u4e24\u4e2a CCD \u53d6\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u6838\u5fc3\u8c03\u5ea6\uff0c\u5e94\u8be5\u662f\u8c03\u5ea6\u5668\u8003\u8651\u4e86\u8fd9\u4e9b\u6838\u5fc3\u7684\u62d3\u6251\uff0c\u8fdb\u884c\u4e86\u8d1f\u8f7d\u5747\u8861\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u6bcf\u4e2a CCD \u4e0a\u7684\u8d1f\u8f7d\u76f8\u5f53\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u5728 9950X \u8fd9\u79cd\u5bf9\u79f0\u7684\u67b6\u6784\u4e0a\u6ca1\u5565\u95ee\u9898\uff0c\u4f46\u5982\u679c\u662f Strix Point \u8fd9\u79cd\u6df7\u5408 Zen5 \u548c Zen5c \u7684\u60c5\u51b5\uff0c\u5982\u679c\u8fd8\u50cf\u8fd9\u6837\uff0c\u5c31\u4f1a\u5728 Zen5 \u548c Zen5c \u4e4b\u95f4\u6765\u56de\u8c03\u5ea6\uff0c\u8fd9\u6837\u5c31\u4e0d\u592a\u5408\u9002\u4e86\uff1a\u5e94\u8be5\u5148\u8c03\u5ea6 Zen5\uff0c\u518d\u8c03\u5ea6 Zen5c\u3002\u5b8c\u6574\u7684\u8ba8\u8bba\u89c1 \u8c08\u8c08 Linux \u4e0e ITMT \u8c03\u5ea6\u5668\u4e0e\u591a\u7c07\u5904\u7406\u5668\u3002\u6700\u8fd1 Linux \u4e5f\u4e0a\u6e38\u5316\u4e86\u76f8\u5173\u7684 Patch\uff0c\u4f7f\u5f97 P \u6838\u4f18\u5148\u88ab\u8c03\u5ea6\uff1aAMD Heterogeneous CPU Design Topology Patches Coming For Linux 6.13\u3002</p> <p>\u800c\u6211\u4eec\u77e5\u9053 Linux \u7684 cpufreq \u8bbe\u7f6e\u4e86\u4e0d\u540c\u7684 governor\uff0c\u4f8b\u5982 performance \u548c powersave\u3002\u90a3\u4e48\u5b83\u4eec\u662f\u600e\u4e48\u6620\u5c04\u5230 Min/Max/Desired Perf \u7684\u5462\uff1f\u901a\u8fc7\u9605\u8bfb\u4ee3\u7801\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ol> <li>powersave \u5bf9\u5e94\u7684\u914d\u7f6e\u662f\uff1aMin Perf \u8bbe\u7f6e\u4e3a Lowest/Lowest Nonlinear Perf\uff0cMax Perf \u8bbe\u7f6e\u4e3a Highest/Nominal Perf</li> <li>performance \u5bf9\u5e94\u7684\u914d\u7f6e\u662f\uff1aMin Perf \u548c Max Perf \u90fd\u8bbe\u7f6e\u4e3a Highest/Nominal Perf</li> </ol> <p>\u5982\u679c\u542f\u7528 boost\uff08<code>echo 1 &gt; /sys/devices/system/cpu/cpufreq/policy0/boost</code>\uff09\uff0c\u90a3\u5c31\u628a Max Perf \u8bbe\u7f6e\u5230 Highest Perf\uff1b\u5982\u679c\u4e0d\u542f\u7528 Boost\uff0c\u5c31\u8bbe\u7f6e\u5230 Nominal Perf\u3002</p> <p>\u4e0b\u9762\u7ed9\u51fa\u51e0\u4e2a\u4f8b\u5b50\uff0c\u5176\u4e2d Highest Perf \u4e3a 166\uff0cNominal Perf \u4e3a 124\uff0cLowest Perf \u4e3a 18\uff1a</p> <ol> <li>performance + boost=1: Min = 166, Max = 166</li> <li>performance + boost=0: Min = 124, Max = 124</li> <li>powersave + boost=1: Min = 18, Max = 166</li> <li>powersave + boost=0: Min = 18, Max = 124</li> </ol> <p>\u800c\u5176\u4ed6\u7531 Linux \u5b9e\u73b0\u53d8\u9891\u7684 governor\uff1aschedutil \u548c ondemand\uff0c\u4f1a\u901a\u8fc7 Desired Perf \u6765\u5b9e\u73b0\u3002</p> <p>amd-pstate \u652f\u6301\u4e09\u4e2a\u8fd0\u884c\u6a21\u5f0f\uff1a</p> <ol> <li>active(\u9ed8\u8ba4): \u8f6f\u4ef6\u5c31\u8bbe\u7f6e\u4e00\u4e0b\u8981\u6027\u80fd\u8fd8\u662f\u80fd\u8017\uff08\u901a\u8fc7 performance/powersave governor \u548c EPP <code>/sys/devices/system/cpu/cpufreq/policy0/energy_performance_preference</code>\uff09\uff0c\u5176\u4ed6\u7684\u90fd\u4ea4\u7ed9\u786c\u4ef6\u81ea\u52a8\u8c03\u6574</li> <li>guided\uff1a\u8f6f\u4ef6\u8bbe\u7f6e\u4e00\u4e2a\u6700\u4f4e\u548c\u6700\u9ad8\u7684\u6027\u80fd\uff0c\u5176\u4ed6\u90fd\u4ea4\u7ed9\u786c\u4ef6</li> <li>passive\uff1a\u8f6f\u4ef6\u6765\u8d1f\u8d23\u8c03\u9891\uff0c\u7ed3\u679c\u901a\u8fc7 Desired Perf \u544a\u8bc9\u786c\u4ef6</li> </ol> <p>\u8fd9\u91cc\u8bf4\u7684 active \u548c passive \u662f\u4ece\u786c\u4ef6\u7684\u89d2\u5ea6\u51fa\u53d1\u7684\uff0c\u800c\u4e0d\u662f OS\u3002</p> <p>\u6ce8\uff1a\u867d\u7136\u8fd9\u91cc\u8bf4\u662f\u786c\u4ef6\u8c03\u6574\uff0c\u5b9e\u9645\u4e0a\u5927\u6982\u7387\u662f\u7531\u5728\u4e00\u4e2a\u7247\u4e0a\u7684\u5c0f CPU \u8fd0\u884c\u7684\u56fa\u4ef6\uff08PMFW\uff0cPower Management Firmware\uff09\u8d1f\u8d23\u8c03\u6574\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#qualcomm_1","title":"Qualcomm","text":"<p>arm64 \u67b6\u6784\u6ca1\u6709\u5b9e\u73b0 arch_asym_cpu_priority \u51fd\u6570\uff0c\u56e0\u6b64\u7528\u7684\u4e0d\u662f\u4e0a\u8ff0 Intel/AMD \u7684\u673a\u5236\uff0c\u800c\u662f\u5728 Device Tree \u4e2d\u7528 capacity-dmips-mhz \u6807\u8bb0\u6bcf\u4e2a\u6838\u5fc3\u7684\u6027\u80fd\uff0c\u4f46\u662f X Elite \u7684 DTS \u6ca1\u6709\u8bb0\u5f55\u8fd9\u4e2a\u4fe1\u606f\uff0c\u56e0\u6b64 Linux \u5185\u6838\u4e5f\u5c31\u65e0\u6cd5\u5408\u7406\u5730\u8c03\u5ea6\u4e86\u3002\u56e0\u6b64\u4e00\u4e2a\u53ef\u80fd\u7684\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u7ed9\u540e\u4e24\u4e2a Cluster \u7684\u4e00\u4e2a\u6838\u8bbe\u7f6e\u66f4\u9ad8\u7684 capacity-dmips-mhz\uff0c\u5176\u4ed6\u7684\u6838\u5fc3\u90fd\u8bbe\u7f6e\u6210\u4e00\u6837\u3002\u4f46\u5176\u5b9e\u901a\u5e38\u6765\u8bf4\uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a\u6838\u6765\u8bf4\uff0c\u63d0\u9ad8\u9891\u7387\u4ee5\u540e\uff0cDMIPS/MHz \u53cd\u800c\u662f\u4e0b\u964d\u7684\uff0c\u5185\u6838\u7528 DMIPS/MHz \u8fd9\u4e2a\u6307\u6807\uff0c\u4e3b\u8981\u662f\u7528\u6765\u533a\u5206\u5927\u5c0f\u6838\uff0c\u800c\u4e0d\u662f\u7528\u6765\u5224\u65ad\u6709\u6ca1\u6709 Boost\u3002</p> <p>\u5b9e\u9645\u5c1d\u8bd5\u4e86\u4e00\u4e0b\uff0c\u7ed9 4 \u548c 8 \u8fd9\u4e24\u4e2a\u6838\u6807\u8bb0\u66f4\u9ad8\u7684 capacity-dmips-mhz\uff0c\u73b0\u5728\u8dd1\u5355\u6838\u6216\u53cc\u6838\u8d1f\u8f7d\u53ef\u4ee5\u81ea\u52a8\u8dd1\u5230 4.0 GHz \u4e0a\u4e86\u3002\u8868\u73b0\u5728 Geekbench 6 \u4e0a\uff0c\u5c31\u662f\u5355\u6838\u6027\u80fd 2452 \u5206\u5230 2892 \u5206\u7684\u533a\u522b\u3002\u4fee\u6539\u7684\u5185\u5bb9\u5df2\u7ecf\u63d0\u4ea4\uff1a[PATCH] arm64: dts: qcom: x1e80100: Add performance hint for boost clock\uff0c\u4e0d\u8fc7\u5408\u5e76\u7684\u6982\u7387\u4e0d\u5927\uff0c\u6bd5\u7adf\u4e0d\u662f\u4ec0\u4e48\u4f18\u96c5\u7684\u89e3\u51b3\u529e\u6cd5\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u9488\u5bf9\u4e0d\u540c\u6838\u5fc3\u7684\u4e0d\u540c\u6027\u80fd\u4ee5\u53ca SMT\uff0cLinux \u7684\u8c03\u5ea6\u5668\u9700\u8981\u77e5\u9053\u5404\u4e2a\u903b\u8f91\u6838\u5fc3\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\u3002\u5728 Intel/AMD \u5e73\u53f0\u4e0a\uff0c\u8fd9\u4e2a\u4fe1\u606f\u76ee\u524d\u4e3b\u8981\u662f\u901a\u8fc7 CPPC \u7684 Highest Perf \u6765\u83b7\u53d6\uff0c\u4e5f\u53ef\u80fd Fallback \u5230 MSR_HWP_CAPABILITIES \u4e0a\u3002\u5728 ARM64 \u5e73\u53f0\u4e0a\uff0c\u5219\u9700\u8981 DTS \u6807\u8bb0\u5404\u6838\u5fc3\u7684\u6027\u80fd\u3002</p>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/10/23/linux-core-scheduling/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>\u8c08\u8c08 Linux \u4e0e ITMT \u8c03\u5ea6\u5668\u4e0e\u591a\u7c07\u5904\u7406\u5668</li> <li>Intel CPU \u4e0a\u9762\u7684 Linux \u5927\u5c0f\u6838\u8c03\u5ea6\u95ee\u9898</li> </ul>","tags":["linux","cpu","scheduler","intel","qualcomm"]},{"location":"software/2024/12/10/linux-perf-pmu/","title":"Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76","text":"","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u4f7f\u7528 Linux \u7684\u6027\u80fd\u5206\u6790\u529f\u80fd\u6bd4\u8f83\u591a\uff0c\u4f46\u662f\u5f88\u5c11\u53bb\u63a2\u7a76\u80cc\u540e\u7684\u539f\u7406\uff0c\u4f8b\u5982\u786c\u4ef6\u7684 PMU \u662f\u600e\u4e48\u914d\u7f6e\u7684\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u4e43\u81f3\u6bcf\u4e2a\u7ebf\u7a0b\u7ea7\u522b\u7684 PMU \u662f\u600e\u4e48\u91c7\u6837\u7684\u3002\u8fd9\u7bc7\u535a\u5ba2\u5c1d\u8bd5\u63a2\u7a76\u8fd9\u80cc\u540e\u7684\u539f\u7406\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#pmu","title":"PMU","text":"","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#\u786c\u4ef6","title":"\u786c\u4ef6","text":"<p>\u652f\u6491\u6027\u80fd\u5206\u6790\u7684\u80cc\u540e\u662f\u786c\u4ef6\u63d0\u4f9b\u7684\u673a\u5236\uff0c\u6700\u5e38\u7528\u7684\u5c31\u662f\u6027\u80fd\u8ba1\u6570\u5668\uff1a\u786c\u4ef6\u4f1a\u63d0\u4f9b\u4e00\u4e9b\u53ef\u4ee5\u914d\u7f6e\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u5728\u5bf9\u5e94\u7684\u786c\u4ef6\u4e8b\u4ef6\u89e6\u53d1\u662f\uff0c\u66f4\u65b0\u8fd9\u4e9b\u8ba1\u6570\u5668\uff0c\u7136\u540e\u518d\u7531\u7a0b\u5e8f\u8bfb\u53d6\u8ba1\u6570\u5668\u7684\u503c\u5e76\u7edf\u8ba1\u3002\u4e0b\u9762\u4ee5 ARM \u4e3a\u4f8b\uff0c\u5206\u6790\u4e00\u4e0b\u786c\u4ef6\u63d0\u4f9b\u7684\u6027\u80fd\u8ba1\u6570\u7684\u63a5\u53e3\uff1a</p> <ol> <li>Cycle \u8ba1\u6570\u5668\uff1aCycle Counter Register(PMCCNTR_EL0) \u548c Cycle Count Filter Register(PMCCFILTR_EL0)\uff0c\u5176\u4e2d\u540e\u8005\u63a7\u5236\u524d\u8005\u5728\u4ec0\u4e48\u7279\u6743\u6001\u4e0b\u4f1a\u8fdb\u884c\u8ba1\u6570</li> <li>\u6700\u591a 31 \u4e2a\u901a\u7528\u6027\u80fd\u8ba1\u6570\u5668\uff1a<ol> <li>\u8be5\u6027\u80fd\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u786c\u4ef6\u4e8b\u4ef6\u4ee5\u53ca\u8ba1\u6570\u7684\u6761\u4ef6\uff1aPMEVTYPER_EL0\uff0cn \u53d6 0 \u5230 31 <li>\u8be5\u6027\u80fd\u8ba1\u6570\u5668\u5f53\u524d\u7684\u503c\uff1aPMEVCNTR_EL0\uff0cn \u53d6 0 \u5230 31 <li>\u63a7\u5236 Cycle \u8ba1\u6570\u5668\u548c\u901a\u7528\u6027\u80fd\u8ba1\u6570\u5668\u7684\u72b6\u6001\uff1aPMCNTENCLR_EL0/PMCNTENSET_EL0/PMCR_EL0</li> <li>\u5404\u8ba1\u6570\u5668\u662f\u5426\u6ea2\u51fa\uff1aPMOVSCLR_EL0/PMOVSSET_EL0</li> <li>\u5f53\u8ba1\u6570\u5668\u6ea2\u51fa\u65f6\uff0cPMU \u4f1a\u62c9\u8d77\u4e2d\u65ad\uff0c\u9488\u5bf9\u8fd9\u4e9b\u4e2d\u65ad\u7684\u914d\u7f6e\uff1aPMINTENCLR_EL1/PMINTENSET_EL1</li> <p>\u6ce8\uff1a\u5b9e\u9645\u4e0a\uff0c\u7531\u4e8e\u7ecf\u5e38\u4f1a\u5bf9\u6307\u4ee4\u6570\u8fdb\u884c\u91c7\u6837\uff0cARM v9.4/8.9 \u5141\u8bb8\u786c\u4ef6\u5b9e\u73b0\u4e00\u4e2a\u989d\u5916\u7684\u6307\u4ee4\u8ba1\u6570\u5668\uff0c\u548c Cycle \u8ba1\u6570\u5668\u7c7b\u4f3c\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5728\u7528\u6237\u6001\u9891\u7e41\u5730\u8bfb\u53d6\u6027\u80fd\u8ba1\u6570\u5668\uff08cap_user_rdpmc\uff09\uff0c\u907f\u514d\u9891\u7e41\u8fdb\u5165\u5185\u6838\u7684\u5f00\u9500\uff0c\u4e5f\u53ef\u4ee5\u5728\u7528\u6237\u6001\u4e2d\u76f4\u63a5\u8bfb\u53d6\u6027\u80fd\u8ba1\u6570\u5668 PMCCNTR_EL0/PMEVCNTR_EL0\uff1a\u5185\u6838\u5728 PMUSERENR_EL0 \u4e2d\u8fdb\u884c\u76f8\u5e94\u7684\u6743\u9650\u914d\u7f6e\u5373\u53ef\u3002v3.9 \u6216\u66f4\u9ad8\u7248\u672c\u7684 PMU \u5b9e\u73b0\u5141\u8bb8\u6309\u7167\u6bcf\u4e2a counter \u7684\u7c92\u5ea6\u6765\u63a7\u5236\u7528\u6237\u6001\u662f\u5426\u5141\u8bb8\u8bbf\u95ee\uff08PMUACR\uff09\u3002 <p>LoongArch \u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u5176\u63a5\u53e3\u66f4\u7b80\u5355\uff1a\u5b83\u53ea\u6709\u901a\u7528\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u6709\u5982\u4e0b\u7684 csr \u6765\u914d\u7f6e\u5404\u4e2a\u6027\u80fd\u8ba1\u6570\u5668\uff1a</p> <ol> <li>\u6027\u80fd\u8ba1\u6570\u5668\u7684\u503c\uff1aperfcntr <li>\u6027\u80fd\u8ba1\u6570\u5668\u7684\u914d\u7f6e\uff1aperfctrl\uff0c\u6709\u5982\u4e0b\u5b57\u6bb5\uff1a<ol> <li>EVENT: \u4e8b\u4ef6\u7f16\u53f7</li> <li>PLV{0,1,2,3}: \u7279\u6743\u6001\u8fc7\u6ee4\uff0c\u5bf9\u5e94\u56db\u4e2a\u7279\u6743\u6001\u4e0b\u662f\u5426\u91c7\u6837</li> <li>IE\uff1a\u662f\u5426\u542f\u7528\u6ea2\u51fa\u4e2d\u65ad</li> </ol> <li>misc.rpcntl3\uff1a\u5141\u8bb8\u7528\u6237\u6001\u7a0b\u5e8f\u8bfb\u53d6\u6027\u80fd\u8ba1\u6570\u5668</li>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#\u5185\u6838\u9a71\u52a8","title":"\u5185\u6838\u9a71\u52a8","text":"<p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u8d1f\u8d23\u63a7\u5236 ARM \u6027\u80fd\u8ba1\u6570\u63a5\u53e3\u7684\u4ee3\u7801\u5728 arm_pmuv3.c \u5f53\u4e2d\u3002\u6839\u636e\u8fd9\u4e2a\u786c\u4ef6\u63a5\u53e3\uff0c\u53ef\u4ee5\u9884\u60f3\u5230\uff0c\u5982\u679c\u8981\u5bf9\u4e00\u6bb5\u7a0b\u5e8f\u89c2\u5bdf\u5b83\u5728\u67d0\u4e2a\u8ba1\u6570\u5668\u4e0a\u7684\u53d6\u503c\uff0c\u9700\u8981\uff1a</p> <ol> <li>\u5206\u914d\u4e00\u4e2a\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u53ef\u80fd\u662f Cycle \u8ba1\u6570\u5668\u6216\u8005\u901a\u7528\u6027\u80fd\u8ba1\u6570\u5668\uff1a\u5bf9\u5e94 armv8pmu_get_event_idx \u51fd\u6570\uff0c\u5148\u5206\u914d Cycle \u8ba1\u6570\u5668\uff0c\u518d\u4ece\u5269\u4e0b\u7684\u901a\u7528\u6027\u80fd\u8ba1\u6570\u5668\u4e2d\u627e\u5230\u4e00\u4e2a\u7a7a\u95f2\u7684</li> <li>\u914d\u7f6e\u5e76\u542f\u7528\u8be5\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u5bf9\u5e94 armv8pmu_enable_event \u51fd\u6570\uff1a<ol> <li>\u628a\u4e8b\u4ef6\u7c7b\u578b\u5199\u5165\u5230 PMEVTYPER_EL0 \u4e2d\uff0c\u5bf9\u5e94 armv8pmu_write_event_type \u51fd\u6570 <li>\u542f\u7528\u4e8b\u4ef6\u5bf9\u5e94\u7684\u6ea2\u51fa\u4e2d\u65ad\uff0c\u5199\u5165 PMINTENSET_EL1\uff0c\u5bf9\u5e94 armv8pmu_enable_event_irq \u51fd\u6570</li> <li>\u4e8b\u4ef6\u5f00\u59cb\u8ba1\u6570\uff0c\u5199\u5165 PMCNTENSET_EL0\uff0c\u5bf9\u5e94 armv8pmu_enable_event_counter \u51fd\u6570</li> <li>\u5728\u7a0b\u5e8f\u5f00\u59cb\u524d\uff0c\u4ece PMEVCNTR_EL0 \u8bfb\u53d6\u4e00\u6b21\u8ba1\u6570\u5668\u7684\u5f53\u524d\u53d6\u503c\uff0c\u5bf9\u5e94 armv8pmu_read_counter \u51fd\u6570 <li>\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\uff0c\u518d\u8bfb\u53d6\u4e00\u6b21\u8ba1\u6570\u5668\u7684\u5f53\u524d\u53d6\u503c\uff0c\u548c\u7a0b\u5e8f\u5f00\u59cb\u65f6\u7684\u503c\u6c42\u5dee</li> <li>\u4e3a\u4e86\u89e3\u51b3\u6ea2\u51fa\u7684\u95ee\u9898\uff1a\u914d\u7f6e\u4e2d\u65ad\uff0c\u5728\u6ea2\u51fa\u65f6\u4f1a\u8fdb\u5165\u4e2d\u65ad\u5904\u7406\u4ee3\u7801\uff0c\u7edf\u8ba1\u6ea2\u51fa\u6b21\u6570\uff0c\u8ba1\u5165\u5dee\u503c\u7684\u9ad8\u4f4d\uff0c\u5bf9\u5e94 armv8pmu_handle_irq \u51fd\u6570</li>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#perf-\u5b50\u7cfb\u7edf","title":"Perf \u5b50\u7cfb\u7edf","text":"<p>\u9664\u4e86\u7531\u5355\u72ec\u7684\u67b6\u6784\u76f8\u5173\u7684\u5185\u6838\u9a71\u52a8\u8d1f\u8d23\u914d\u7f6e\u786c\u4ef6\u4ee5\u5916\uff0c\u8fd8\u9700\u8981\u7531 Perf \u5b50\u7cfb\u7edf\u6765\u5904\u7406\u6765\u81ea\u7528\u6237\u7684 perf \u4f7f\u7528\u3002\u5177\u4f53\u5730\uff0c\u5185\u6838\u9a71\u52a8\u4f1a\u6ce8\u518c\u4e00\u4e2a <code>struct pmu</code> \u7ed9 Perf \u5b50\u7cfb\u7edf\uff0c\u5b9e\u73b0\u8fd9\u4e9b\u51fd\u6570\uff1a</p> <pre><code>// Fully disable/enable this PMU\nvoid (*pmu_enable)      (struct pmu *pmu); /* optional */\nvoid (*pmu_disable)     (struct pmu *pmu); /* optional */\n// Try and initialize the event for this PMU.\nint (*event_init)       (struct perf_event *event);\n// Adds/Removes a counter to/from the PMU\nint  (*add)         (struct perf_event *event, int flags);\nvoid (*del)         (struct perf_event *event, int flags);\n// Starts/Stops a counter present on the PMU.\nvoid (*start)           (struct perf_event *event, int flags);\nvoid (*stop)            (struct perf_event *event, int flags);\n// Updates the counter value of the event.\nvoid (*read)            (struct perf_event *event);\n</code></pre> <p>\u53ef\u89c1\u5728\u5185\u6838\u91cc\uff0cPMU \u8ba1\u6570\u5668\u7684\u62bd\u8c61\u662f <code>struct perf_event</code>\uff0c\u8fd9\u4e2a\u662f\u67b6\u6784\u65e0\u5173\u7684\uff0c\u6839\u636e\u7528\u6237\u6001\u7a0b\u5e8f\u901a\u8fc7 <code>perf_event_open</code> \u6784\u9020\u51fa\u6765\u7684\uff1b\u5185\u6838\u9a71\u52a8\u5c31\u4f1a\u6839\u636e\u8fd9\u4e2a <code>struct perf_event</code> \u53bb\u8fdb\u884c\u5b9e\u9645\u7684\u786c\u4ef6\u8ba1\u6570\u5668\u7684\u914d\u7f6e\u3002\u4f8b\u5982\u7528\u6237\u7a0b\u5e8f\u5728 <code>struct perf_event_attr</code> \u91cc\u8bbe\u7f6e <code>exclude_kernel = 1</code>\uff0c\u5c31\u4f1a\u4f20\u5230 <code>struct perf_event</code> \u5f53\u4e2d\uff0c\u6700\u540e\u5728\u76f8\u5e94\u7684\u5185\u6838\u9a71\u52a8\u4e2d\uff0c\u53d8\u6210\u786c\u4ef6\u6027\u80fd\u8ba1\u6570\u5668\u914d\u7f6e\u91cc\uff0c\u8ba1\u6570\u65f6\u5ffd\u7565\u5185\u6838\u6240\u5728\u7279\u6743\u6001\u7684\u914d\u7f6e\u3002</p> <p><code>perf record</code> \u662f\u57fa\u4e8e\u91c7\u6837\u5b9e\u73b0\u7684\uff1a\u5f53\u6027\u80fd\u8ba1\u6570\u5668\u6ea2\u51fa\uff08\u4e00\u822c\u662f Cycle \u8ba1\u6570\u5668\uff09\u7684\u65f6\u5019\uff0c\u89e6\u53d1\u4e2d\u65ad\u8fdb\u5165\u5185\u6838\uff0c\u6b64\u65f6\u7531\u8f6f\u4ef6\u6765\u6536\u96c6\u88ab\u6253\u65ad\u7684\u7a0b\u5e8f\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u6536\u96c6\u5b8c\u6210\u540e\u518d\u56de\u5230\u88ab\u6253\u65ad\u7684\u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#\u865a\u62df\u5316","title":"\u865a\u62df\u5316","text":"<p>\u5728\u865a\u62df\u5316\u573a\u666f\u4e0b\uff0c\u4f9d\u7136\u5e0c\u671b\u865a\u62df\u673a\u5185\u7684 OS \u53ef\u4ee5\u6709\u6027\u80fd\u8ba1\u6570\u5668\u53ef\u4ee5\u7528\uff0c\u540c\u65f6\u5bbf\u4e3b\u673a\u4e0a\u4e5f\u53ef\u80fd\u5e0c\u671b\u83b7\u53d6\u865a\u62df\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\u4fe1\u606f\u3002</p> <p>\u4e00\u79cd\u65b9\u6cd5\u662f\u4ee5\u7eaf\u8f6f\u4ef6\u7684\u65b9\u6cd5\u53bb\u5b9e\u73b0\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u6bd4\u5982 QEMU \u7684 TCG \u6a21\u5f0f\uff0c\u53ef\u4ee5\u6a21\u62df\u51fa\u4e00\u4e2a\u4ee5\u56fa\u5b9a\u9891\u7387\u8fd0\u884c\u7684\u5904\u7406\u5668\u7684 Cycle \u8ba1\u6570\u5668\uff0c\u4f46\u5b9e\u9645\u4e0a\u5c31\u662f\u62ff\u65f6\u95f4\u9664\u4ee5\u9891\u7387\uff0c\u662f\u5047\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff1b\u6b64\u5916\u8fd8\u80fd\u6a21\u62df\u51fa Instruction \u8ba1\u6570\u5668\uff0c\u56e0\u4e3a QEMU \u5728\u505a\u6307\u4ee4\u7ffb\u8bd1\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u987a\u5e26\u8bb0\u5f55\u4e0b\u6267\u884c\u7684\u6307\u4ee4\u6570\uff1b\u800c\u5fae\u67b6\u6784\u76f8\u5173\u7684\u6027\u80fd\u8ba1\u6570\u5668\u5c31\u6ca1\u6cd5\u9760\u8fd9\u4e2a\u6765\u5b9e\u73b0\u4e86\u3002</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u5219\u662f\u5728\u786c\u4ef6\u865a\u62df\u5316\u7684\u57fa\u7840\u4e0a\uff0c\u8ba9\u865a\u62df\u673a\u4eab\u53d7\u5230\u6027\u80fd\u8ba1\u6570\u5668\u3002\u4e0d\u8fc7\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u5bbf\u4e3b\u673a\u53ef\u4ee5\u83b7\u53d6\u865a\u62df\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u4f46\u53cd\u8fc7\u6765\uff0c\u865a\u62df\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\u4e0d\u5e94\u8be5\u5f97\u5230\u5bbf\u4e3b\u673a\u7684\u4fe1\u606f\u3002</p> <p>\u76ee\u524d LoongArch KVM \u5df2\u7ecf\u652f\u6301\u6027\u80fd\u8ba1\u6570\u5668\u7684\u865a\u62df\u5316\uff0c\u4e0b\u9762\u6765\u770b\u5b83\u662f\u600e\u4e48\u505a\u7684\uff1a</p> <ol> <li>\u7ed9\u5bbf\u4e3b\u673a\uff08host\uff09\u7ef4\u62a4\u4e00\u4efd\u6027\u80fd\u8ba1\u6570\u5668\u7684\u4e0a\u4e0b\u6587\uff0c\u7528 kvm_save_host_pmu \u4fdd\u5b58\uff0c\u7528 kvm_restore_host_pmu \u6062\u590d</li> <li>\u518d\u7ed9\u6bcf\u4e2a\u865a\u62df\u673a\uff08guest\uff09\u7ef4\u62a4\u4e00\u4efd\u6027\u80fd\u8ba1\u6570\u5668\u7684\u4e0a\u4e0b\u6587\uff0c\u6b64\u65f6\u4e3a\u4e86\u8bbf\u95ee\u865a\u62df\u673a\u7684 csr\uff0c\u8981\u8bbf\u95ee gcsr(guest csr)\uff1a\u7528 kvm_save_guest_pmu \u4fdd\u5b58\uff0c\u7528 kvm_restore_guest_pmu</li> <li>\u5f53\u865a\u62df\u673a\uff08guest\uff09\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u56de\u5230\u4e86 VMM\uff0c\u5c31\u8981\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4fdd\u5b58\u865a\u62df\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u6062\u590d\u5bbf\u4e3b\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff1b\u540c\u7406\uff0c\u8fdb\u5165\u865a\u62df\u673a\u65f6\uff0c\u518d\u6b21\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4fdd\u5b58\u5bbf\u4e3b\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u6062\u590d\u865a\u62df\u673a\u7684\u6027\u80fd\u8ba1\u6570\u5668</li> </ol>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#intel-pt","title":"Intel PT","text":"<p>Intel PT \u662f Intel \u5e73\u53f0\u4e0a\u8ddf\u8e2a\u6307\u4ee4\u6d41\u7684\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u8bb0\u5f55\u8fd9\u4e9b\u4fe1\u606f\uff1a</p> <ol> <li>\u9875\u8868\u7684\u4fee\u6539</li> <li>\u65f6\u949f\u5468\u671f</li> <li>\u5206\u652f\u8df3\u8f6c</li> <li>\u529f\u8017\u72b6\u6001\u53d8\u5316</li> </ol> <p>perf \u5de5\u5177\u4e5f\u662f\u652f\u6301\u7528 Intel PT \u8fdb\u884c\u8ddf\u8e2a\u7684\uff1aperf-intel-pt(1) \u2014 Linux manual page\uff0c\u4e0b\u9762\u7684\u547d\u4ee4\u7528 Intel PT \u8ddf\u8e2a\u4e00\u6761\u547d\u4ee4\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u5e76\u663e\u793a\u51fa\u5b83\u751f\u6210\u7684\u8ddf\u8e2a\u4fe1\u606f\uff1a</p> <pre><code>perf record -e intel_pt//u ls\n# itrace: instruction trace\n# i: instructions events\n# y: cycles events\n# b: branches events\n# x: transactions events\n# w: ptwrite events\n# p: power events\n# e: error events\nperf script --itrace=iybxwpe\n</code></pre> <p>\u6bd4\u5982\u5199\u4e00\u4e2a\u5faa\u73af 10 \u6b21\u7684\u4ee3\u7801\uff1a</p> <pre><code>int main() {\n  for (int i = 0; i &lt; 10; i++) {\n  }\n}\n</code></pre> <p>\u5bf9\u5e94\u7684\u6c47\u7f16\uff1a</p> <pre><code>0000000000001129 &lt;main&gt;:\n    1129:       55                      push   %rbp\n    112a:       48 89 e5                mov    %rsp,%rbp\n    112d:       c7 45 fc 00 00 00 00    movl   $0x0,-0x4(%rbp)\n    1134:       eb 04                   jmp    113a &lt;main+0x11&gt;\n    1136:       83 45 fc 01             addl   $0x1,-0x4(%rbp)\n    113a:       83 7d fc 09             cmpl   $0x9,-0x4(%rbp)\n    113e:       7e f6                   jle    1136 &lt;main+0xd&gt;\n    1140:       b8 00 00 00 00          mov    $0x0,%eax\n    1145:       5d                      pop    %rbp\n    1146:       c3                      ret\n</code></pre> <p>\u6309\u7167\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u751f\u6210\u4e86\u5404\u4e2a\u5206\u652f\u8df3\u8f6c\u7684\u4fe1\u606f\uff1a</p> <pre><code>test1 3772291 [006] 1693209.504363:          1     branches:u:      7311943d6248 __libc_start_call_main+0x78 (/usr/lib/x86_64-linux-gnu/libc.so.6) =&gt;     5b4f1df51129 main+0x0 (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df51134 main+0xb (/home/jiegec/test1) =&gt;     5b4f1df5113a main+0x11 (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df5113e main+0x15 (/home/jiegec/test1) =&gt;     5b4f1df51136 main+0xd (/home/jiegec/test1)\ntest1 3772291 [006] 1693209.504363:          1     branches:u:      5b4f1df51146 main+0x1d (/home/jiegec/test1) =&gt;     7311943d624a __libc_start_call_main+0x7a (/usr/lib/x86_64-linux-gnu/libc.so.6)\n</code></pre> <p>\u901a\u8fc7\u8fd9\u4e2a\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u8fd8\u539f\u51fa\u7a0b\u5e8f\u6267\u884c\u4e86\u54ea\u4e9b\u4ee3\u7801\uff1a</p> <ol> <li>__libc_start_call_main \u8c03\u7528 main \u51fd\u6570\uff0c\u5230\u5165\u53e3 0x1129(main+0x0)</li> <li>\u4ece 0x1134(main+0xb) \u8df3\u8f6c\u5230 0x113a(main+0x11)</li> <li>\u5faa\u73af 10 \u6b21\uff1a0x113e(main+0x15) \u8df3\u8f6c\u5230 0x1136(main+0xd)</li> <li>\u6700\u7ec8 \u5728 0x1146(main+0x1d) return \u56de\u5230 __libc_start_call_main \u51fd\u6570</li> </ol> <p>\u5982\u679c\u8981\u770b Intel PT \u5230\u5e95\u751f\u6210\u4e86\u4ec0\u4e48\u6570\u636e\uff0c\u53ef\u4ee5\u7528 <code>perf script -D</code> \u663e\u793a\u3002\u4f8b\u5982\u8981\u8bb0\u5f55\u5206\u652f\u8df3\u8f6c\u8fd8\u662f\u4e0d\u8df3\u8f6c\u7684\u5386\u53f2\uff0c\u7528\u7684\u662f\u5982\u4e0b\u7684 TNT(Taken/Not Taken) packet\uff1a</p> <p></p> <p>TNT packet \u7684\u5b9a\u4e49\u5728 Intel\u00ae 64 and IA-32 Architectures Software Developer Manuals \u4e2d\u7ed9\u51fa\uff1a</p> <p></p> <p>\u7531\u4e8e Intel PT \u7684\u6570\u636e\u91cf\u5f88\u5927\uff0c\u5b83\u548c SPE \u7c7b\u4f3c\uff0c\u4e5f\u662f\u5728\u5185\u5b58\u4e2d\u4fdd\u5b58 trace \u4fe1\u606f\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#intel-lbr","title":"Intel LBR","text":"<p>Intel LBR(Last Branch Record) \u673a\u5236\u8bb0\u5f55\u4e86\u5904\u7406\u5668\u6700\u8fd1\u82e5\u5e72\u6b21\u63a7\u5236\u6d41\u8f6c\u79fb\uff0c\u6bd4\u5982 taken branch\u3002\u5b83\u8bb0\u5f55\u7684\u6570\u91cf\u5f88\u5c0f\uff0c\u4fe1\u606f\u76f4\u63a5\u4fdd\u5b58\u5728 MSR \u5f53\u4e2d\uff0c\u800c\u4e0d\u662f\u50cf\u524d\u9762\u7684 SPE \u548c Intel PT \u90a3\u6837\uff0c\u9700\u8981\u5728\u5185\u5b58\u4e2d\u8bb0\u5f55\u4fe1\u606f\u3002</p> <p>LBR \u5728 perf \u4e2d\uff0c\u4e3b\u8981\u7528\u6765\u8ddf\u8e2a call stack\uff1a\u8bbe\u7f6e LBR\uff0c\u53ea\u8bb0\u5f55 call \u6307\u4ee4\uff0c\u5e76\u4e14\u6253\u5f00 call-stack \u6a21\u5f0f\uff0c\u90a3\u4e48 LBR \u8bb0\u5f55\u7684\u5c31\u662f\u5f53\u524d\u7684 call stack\uff0cperf \u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u4fe1\u606f\u6765\u627e\u5230\u5f53\u524d\u51fd\u6570\u7684\u8c03\u7528\u94fe\uff0c\u867d\u7136\u6709\u957f\u5ea6\u9650\u5236\u3002\u9664\u4e86 lbr \u4ee5\u5916\uff0cperf \u8fd8\u652f\u6301\u5229\u7528 fp(frame pointer) \u6216 dwarf(\u8c03\u8bd5\u4fe1\u606f) \u6765\u5bfb\u627e\u8c03\u7528\u94fe\uff1a</p> <pre><code>--call-graph\n    Setup and enable call-graph (stack chain/backtrace)\n    recording, implies -g. Default is \"fp\" (for user space).\n\n    Valid options are \"fp\" (frame pointer), \"dwarf\" (DWARF's CFI -\n    Call Frame Information) or \"lbr\" (Hardware Last Branch Record\n    facility).\n</code></pre> <p>\u548c Intel PT \u76f8\u6bd4\uff0c\u5b83\u8bb0\u5f55\u7684\u4fe1\u606f\u8f83\u5c11\uff0c\u4f46\u5b9e\u73b0\u4e0a\u4e5f\u66f4\u7b80\u5355\uff0c\u5f00\u9500\u66f4\u5c0f\u3002\u800c\u4e14 LBR \u53ea\u4f1a\u8bb0\u5f55\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u6ca1\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u6b64\u5916\u5c31\u662f\u8bb0\u5f55\u7684\u5206\u652f\u6570\u6709\u4e0a\u9650\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#intel-bts","title":"Intel BTS","text":"<p>\u8f83\u65e9\u7684 Intel \u5904\u7406\u5668\u6ca1\u6709\u5b9e\u73b0 Intel PT\uff0c\u4f46\u8003\u8651\u5230 LBR \u8bb0\u5f55\u7684\u5386\u53f2\u957f\u5ea6\u9650\u5236\uff0c\u57fa\u4e8e LBR \u505a\u4e86\u4e00\u4e2a\u628a LBR \u4fe1\u606f\u4fdd\u5b58\u5230\u5185\u5b58\u91cc\u7684\u6280\u672f\uff0c\u53eb\u505a Branch Trace Store\u3002perf \u4e5f\u652f\u6301\u57fa\u4e8e BTS \u6765\u8bb0\u5f55\u5206\u652f\u5386\u53f2\uff1a</p> <pre><code># record\nsudo perf record --per-thread -e intel_bts//u ls\n# display trace\nsudo perf script\n# dump raw data\nsudo perf script -D\n</code></pre> <p>BTS \u6bcf\u4e2a entry \u5360\u7528 24 \u5b57\u8282\uff0c\u5305\u62ec 8 \u5b57\u8282\u7684 Last Branch From \u548c 8 \u5b57\u8282\u7684 Last Branch To\uff0c\u8fd8\u6709 8 \u5b57\u8282\u8bb0\u5f55\u4e86\u5206\u652f\u9884\u6d4b\u6b63\u786e\u8fd8\u662f\u9519\u8bef\uff08\u56fe\u6e90 Intel\u00ae 64 and IA-32 Architectures Software Developer Manuals\uff09\uff1a</p> <p></p> <p>\u548c LBR \u4e00\u6837\uff0cBTS \u53ea\u8bb0\u5f55\u8df3\u8f6c\u7684\u5206\u652f\uff0c\u4e0d\u8bb0\u5f55\u6ca1\u8df3\u8f6c\u7684\u5206\u652f\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#intel-pebs","title":"Intel PEBS","text":"<p>Intel PEBS(Processor Event Based Sampling) \u662f\u4e00\u79cd\u786c\u4ef6\u7684\u91c7\u6837\u65b9\u6cd5\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5f53\u5904\u7406\u5668\u89e6\u53d1\u67d0\u4e9b\u4e8b\u4ef6\u65f6\uff0c\u81ea\u52a8\u8fdb\u884c\u4e00\u6b21\u91c7\u6837\u3002\u8fd9\u4e2a\u4e8b\u4ef6\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u67d0\u4e2a\u6027\u80fd\u8ba1\u6570\u5668\u6ea2\u51fa\u3002\u672c\u6765\uff0c\u6027\u80fd\u8ba1\u6570\u5668\u6ea2\u51fa\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u89e6\u53d1\u4e2d\u65ad\uff0c\u8ba9\u5185\u6838\u7ef4\u62a4\u6027\u80fd\u8ba1\u6570\u5668\u7684\u771f\u5b9e\u503c\uff08\u4f8b\u5982\u786c\u4ef6\u5b9e\u73b0\u4e86 32 \u4f4d\u8ba1\u6570\u5668\uff0c\u4f46\u5185\u6838\u7ef4\u62a4\u7684\u662f 64 \u4f4d\uff09\uff1b\u4f46\u5728 PEBS \u4e2d\uff0c\u8fd9\u4e2a\u6027\u80fd\u8ba1\u6570\u5668\u7684\u6ea2\u51fa\u4e8b\u4ef6\u88ab\u7528\u6765\u89e6\u53d1\u786c\u4ef6\u7684\u91c7\u6837\uff1a\u8ba1\u6570\u6ea2\u51fa\u7684\u65f6\u5019\uff0c\u4f1a\u6355\u6349\u5f53\u524d\u7684\u5904\u7406\u5668\u72b6\u6001\uff08PC\u3001\u8bbf\u5b58\u5730\u5740\u548c\u5ef6\u8fdf\u3001\u901a\u7528\u5bc4\u5b58\u5668\u548c\u6d6e\u70b9\u5bc4\u5b58\u5668\u7684\u503c\u3001\u65f6\u949f\u5468\u671f\u8ba1\u6570\u548c LBR \u4fe1\u606f\uff09\uff0c\u628a\u72b6\u6001\u5199\u5165\u5230\u5185\u5b58\u4e2d\u7684\u7f13\u51b2\u533a\uff0c\u5e76\u81ea\u52a8\u628a\u6027\u80fd\u8ba1\u6570\u5668\u8bbe\u4e3a\u6307\u5b9a\u7684\u590d\u4f4d\u503c\u3002\u5f53\u5185\u5b58\u4e2d\u7684\u7f13\u51b2\u533a\u6ee1\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u89e6\u53d1\u4e2d\u65ad\uff0c\u8ba9\u5185\u6838\u6765\u5904\u7406 PEBS \u751f\u6210\u7684\u6570\u636e\uff0c\u5e76\u5206\u914d\u65b0\u7684\u7a7a\u95f4\u3002</p> <p>PEBS \u53ef\u4ee5\u7cbe\u7ec6\u5730\u6839\u636e\u6027\u80fd\u8ba1\u6570\u5668\u6765\u51b3\u5b9a\u91c7\u6837\u7684\u9891\u7387\uff0c\u4f8b\u5982\u6bcf 1000 \u6761\u6307\u4ee4\u91c7\u6837\u4e00\u6b21\uff0c\u6bcf 1000 \u4e2a\u5468\u671f\u91c7\u6837\u4e00\u6b21\uff0c\u751a\u81f3\u6bcf 1000 \u6b21\u7f13\u5b58\u7f3a\u5931\u91c7\u6837\u4e00\u6b21\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u628a\u5bf9\u5e94\u7684\u6027\u80fd\u8ba1\u6570\u5668\u7684\u590d\u4f4d\u503c\u8bbe\u7f6e\u4e3a\u6700\u5927\u503c\u51cf 1000\uff0c\u90a3\u4e48\u6bcf\u6b21\u6ea2\u51fa\u89e6\u53d1 PEBS \u91c7\u6837\u4ee5\u540e\uff0c\u6027\u80fd\u8ba1\u6570\u5668\u4f1a\u88ab\u8bbe\u7f6e\u4e3a\u6700\u5927\u503c\u51cf 1000\uff0c\u7b49\u6027\u80fd\u8ba1\u6570\u5668\u589e\u52a0 1000 \u4ee5\u540e\uff0c\u518d\u6b21\u6ea2\u51fa\uff0c\u89e6\u53d1 PEBS \u91c7\u6837\uff0c\u5982\u6b64\u5faa\u73af\u3002</p> <p>AMD \u4e5f\u6709\u7c7b\u4f3c\u7684\u673a\u5236\uff0c\u53eb\u505a IBS(Instruction Based Sampling)\u3002IBS \u6ca1\u6709\u548c PMU \u7ed1\u5b9a\u8d77\u6765\uff0c\u800c\u662f\u6570\u6307\u4ee4\u6570\u6216\u6570\u5468\u671f\u3002\u63a8\u8350\u9605\u8bfb\u8bba\u6587 Precise Event Sampling on AMD Versus Intel: Quantitative and Qualitative Comparison\uff0c\u5b83\u6df1\u5165\u6bd4\u8f83\u4e86 AMD IBS \u548c Intel PEBS \u7684\u5dee\u5f02\u3002</p> <p>\u5982\u679c\u8981\u542f\u7528 PEBS \u6216 IBS\uff0c\u5728 <code>perf record</code> \u6307\u4ee4\u4e8b\u4ef6\u65f6\uff0c\u8ffd\u52a0 <code>:p</code>\uff1a</p> <pre><code>The p modifier can be used for specifying how precise the instruction address should be. The p modifier can be specified\nmultiple times:\n\n    0 - SAMPLE_IP can have arbitrary skid\n    1 - SAMPLE_IP must have constant skid\n    2 - SAMPLE_IP requested to have 0 skid\n    3 - SAMPLE_IP must have 0 skid, or uses randomization to avoid\n        sample shadowing effects.\n\nFor Intel systems precise event sampling is implemented with PEBS which supports up to precise-level 2, and precise level 3 for some special cases.\n\nOn AMD systems it is implemented using IBS OP (up to precise-level 2).\n</code></pre> <p>\u8be6\u7ec6\u4fe1\u606f\u89c1 perf-list(1) \u2014 Linux manual page\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#arm-brbe","title":"ARM BRBE","text":"<p>ARM \u5e73\u53f0\u5b9a\u4e49\u4e86 BRBE(Branch Record Buffer Extension)\uff0c\u5b83\u548c Intel LBR \u7c7b\u4f3c\uff0c\u4e5f\u662f\u5728 System Register \u4e2d\u8bb0\u5f55\u6700\u8fd1\u82e5\u5e72\u6761\u8df3\u8f6c\u7684\u5206\u652f\u7684\u4fe1\u606f\u3002\u5b83\u4f1a\u8bb0\u5f55 taken branch \u7684\u8fd9\u4e9b\u4fe1\u606f\uff1a</p> <ol> <li>\u6e90\u5730\u5740</li> <li>\u76ee\u7684\u5730\u5740</li> <li>\u8ddd\u79bb\u4e0a\u4e00\u6b21 taken branch \u7684\u5468\u671f\u6570</li> <li>\u5206\u652f\u7c7b\u578b</li> <li>\u7279\u6743\u6001\uff08EL\uff09</li> <li>\u5206\u652f\u9884\u6d4b\u7ed3\u679c</li> </ol> <p>\u4e0d\u8df3\u8f6c\u7684\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u5c31\u4e0d\u8bb0\u5f55\u3002\u548c LBR \u7c7b\u4f3c\uff0c\u5b83\u4e5f\u652f\u6301\u6839\u636e\u5206\u652f\u7c7b\u578b\u8fc7\u6ee4\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u7528\u4e8e call graph \u7684\u6293\u53d6\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#arm-spe","title":"ARM SPE","text":"<p>ARM \u5e73\u53f0\u5b9a\u4e49\u4e86 SPE(Statistical Profiling Extension)\uff0c\u5b83\u7684\u505a\u6cd5\u662f\u57fa\u4e8e\u91c7\u6837\u7684\uff1a\u786c\u4ef6\u4e0a\u6bcf\u8fc7\u4e00\u6bb5\u65f6\u95f4\uff0c\u91c7\u6837\u4e00\u4e2a\u64cd\u4f5c\uff0c\u6bd4\u5982\u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\uff1b\u91c7\u6837\u5f97\u5230\u7684\u64cd\u4f5c\u7684\u8be6\u7ec6\u4fe1\u606f\u4f1a\u5199\u5165\u5230\u5185\u5b58\u5f53\u4e2d\uff0c\u7531\u5185\u6838\u9a71\u52a8\u51c6\u5907\u597d\u7684\u4e00\u6bb5\u7a7a\u95f4\u3002\u7a7a\u95f4\u6ee1\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u4e2d\u65ad\u901a\u77e5\u5185\u6838\u5e76\u8ba9\u5185\u6838\u91cd\u65b0\u5206\u914d\u7a7a\u95f4\u3002</p> <p><code>perf record</code> \u5728\u9ed8\u8ba4\u53c2\u6570\u4e0b\u7684\u5de5\u4f5c\u539f\u7406\u548c SPE \u6709\u70b9\u50cf\uff0c\u90fd\u662f\u5b9a\u65f6\u6253\u65ad\u7a0b\u5e8f\u5e76\u91c7\u6837\uff1a\u4f46 <code>perf record</code> \u662f\u5728\u7a0b\u5e8f\u88ab\u6253\u65ad\u540e\uff0c\u7531\u8f6f\u4ef6\u6765\u6536\u96c6\u4fe1\u606f\uff1b\u800c SPE \u662f\u7531\u786c\u4ef6\u91c7\u6837\uff0c\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u7684\u5fae\u67b6\u6784\u4fe1\u606f\uff08\u5ef6\u8fdf\uff0c\u8bbf\u5b58\u5730\u5740\uff0c\u662f\u5426\u547d\u4e2d TLB\uff0c\u5206\u652f\u8df3\u8f6c\u4e0e\u5426\u7b49\u7b49\uff09\u3002</p> <p>SPE \u7684\u5185\u6838\u9a71\u52a8\u5b9e\u73b0\u5728 arm_spe_pmu.c \u5f53\u4e2d\uff1b\u5b83\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u5728\u5185\u5b58\u4e2d\u5206\u914d\u597d\u7f13\u51b2\u533a\uff0c\u542f\u52a8 SPE\uff0c\u5e76\u4e14\u5728 SPE \u89e6\u53d1\u4e2d\u65ad\u65f6\uff0c\u8fdb\u884c\u7f13\u51b2\u533a\u7684\u7ef4\u62a4\uff1b\u540c\u65f6\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u4f1a\u901a\u8fc7 perf ring buffer (aka perf aux) \u4f20\u9012\u7ed9\u7528\u6237\u6001\u7684\u7a0b\u5e8f\uff0c\u5177\u4f53\u6570\u636e\u7684\u89e3\u6790\u662f\u7531\u7528\u6237\u6001\u7684\u7a0b\u5e8f\u5b8c\u6210\u7684\u3002\u5982\u679c\u7528 perf \u5de5\u5177\uff0c\u90a3\u4e48\u8fd9\u4e2a\u89e3\u6790\u548c\u5c55\u793a\u7684\u5de5\u4f5c\u5c31\u662f\u7531 perf \u5b8c\u6210\u7684\u3002</p> <p>SPE \u548c AMD IBS \u7c7b\u4f3c\uff0c\u4e5f\u662f\u6570\u6307\u4ee4\u6570\uff1b\u548c Intel PEBS \u4e0d\u540c\uff0c\u5b83\u6ca1\u6709\u548c\u6027\u80fd\u8ba1\u6570\u5668\u8026\u5408\u8d77\u6765\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#arm-amu","title":"ARM AMU","text":"<p>ARM \u9664\u4e86\u63d0\u4f9b\u6027\u80fd\u8ba1\u6570\u5355\u5143\uff08PMU\uff09\u4ee5\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86 AMU\uff08Activity Monitor Unit\uff09\u3002\u5b83\u548c PMU \u5f88\u7c7b\u4f3c\uff0c\u4e5f\u662f\u6709\u4e00\u4e9b\u6027\u80fd\u8ba1\u6570\u5668\uff0c\u4f46 AMU \u5728\u8ba1\u6570\u5668\u6ea2\u51fa\u7684\u65f6\u5019\u4e0d\u4f1a\u89e6\u53d1\u4e2d\u65ad\uff0c\u6240\u4ee5\u5b83\u5e76\u4e0d\u662f\u62ff\u6765\u89c2\u5bdf\u67d0\u4e2a\u7a0b\u5e8f\u7684\u6027\u80fd\u600e\u4e48\u6837\uff0c\u800c\u662f\u89c2\u5bdf\u7cfb\u7edf\u6574\u4f53\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u65f6\u949f\u9891\u7387\uff0cIPC \u7b49\u7b49\u3002</p> <p>\u76ee\u524d AMU \u7684\u4e3b\u8981\u7528\u9014\u662f\u5728\u5185\u6838\u7684\u8c03\u5ea6\u5668\u4e0a\uff1a\u8c03\u5ea6\u5668\u9700\u8981\u4f30\u8ba1\u4e00\u6bb5\u65f6\u95f4\u5185\u505a\u4e86\u591a\u5c11\u5355\u4f4d\u7684\u4efb\u52a1\uff0c\u9700\u8981\u77e5\u9053 CPU \u7684\u9891\u7387\uff0c\u6bd4\u5982\u9891\u7387\u9ad8\uff0c\u5c31\u8ba4\u4e3a\u5b83\u505a\u4e86\u66f4\u591a\u7684\u4efb\u52a1\u3002\u4e4b\u524d\u7684\u505a\u6cd5\u662f\u8ba9\u8c03\u5ea6\u5668\u901a\u8fc7 cpufreq \u8bfb\u53d6\u5f53\u524d\u7684 CPU \u9891\u7387\uff0c\u4f46\u7531\u4e8e CPU \u7684\u9891\u7387\u4f1a\u4e0d\u65ad\u53d8\u5316\uff0c\u8fd9\u6837\u8bfb\u53d6\u5230\u7684\u9891\u7387\u662f\u4e00\u4e2a\u77ac\u65f6\u529f\u7387\uff0c\u4e0d\u80fd\u4ee3\u8868\u4e00\u6bb5\u65f6\u95f4\u7684\u5e73\u5747\u503c\uff0c\u5c31\u4f1a\u5e26\u6765\u8bef\u5dee\u3002</p> <p>\u4e3a\u4e86\u83b7\u53d6\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u5e73\u5747\u9891\u7387\uff0camu_scale_freq_tick \u51fd\u6570\u5c31\u4f7f\u7528\u4e86 AMU \u7684\u4e24\u4e2a\u8ba1\u6570\u5668\uff1a</p> <ol> <li>Processor Cycle \u8ba1\u6570\u5668\uff1a\u8bb0\u5f55\u6838\u5fc3\u7684\u5468\u671f\u6570\uff0c\u4e5f\u5c31\u662f\u4ee5 CPU \u9891\u7387\u81ea\u589e\u7684\u8ba1\u6570\u5668</li> <li>Constant Cycle \u8ba1\u6570\u5668\uff1a\u4ee5\u56fa\u5b9a\u9891\u7387\uff08\u800c\u975e CPU \u9891\u7387\uff09\u81ea\u589e\u7684\u8ba1\u6570\u5668</li> </ol> <p>\u901a\u8fc7\u8bb0\u5f55\u4e00\u6bb5\u65f6\u95f4\u5185\u4e24\u4e2a\u8ba1\u6570\u5668\u7684\u53d8\u5316\u91cf\uff0c\u5c06\u4e24\u4e2a\u53d8\u5316\u91cf\u505a\u9664\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6b63\u6bd4\u4e8e\u8fd9\u6bb5\u65f6\u95f4\u5185 CPU \u7684\u5e73\u5747\u9891\u7387\u7684\u503c\uff0c\u4ea4\u7ed9\u8c03\u5ea6\u5668\u3002</p>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2024/12/10/linux-perf-pmu/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>Arm Architecture Reference Manual for A-profile architecture</li> <li>LoongArch Reference Manual Volume 1: Basic Architecture</li> <li>perf: Linux profiling with performance counters</li> <li>Perf tools support for Intel\u00ae Processor Trace</li> <li>Precise Event Sampling on AMD Versus Intel: Quantitative and Qualitative Comparison</li> </ul>","tags":["linux","perf","pmu","arm","aarch64"]},{"location":"software/2023/05/06/linux-regression-vivado-en/","title":"How a Linux 6.2.13 BUG stops Vivado from recognizing FPGA","text":"<p>\u4e2d\u6587\u7248\u672c</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado-en/#tldr","title":"TLDR","text":"<p>In short, the commit introduced by Linux 6.2.13:</p> <pre><code>commit 0d30989fe9a176565d360376d4bc2ea1c61cbbac\nAuthor: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\nDate:   Fri Apr 14 14:59:19 2023 -0400\n\n    mm/mmap: regression fix for unmapped_area{_topdown}\n\n    commit 58c5d0d6d522112577c7eeb71d382ea642ed7be4 upstream.\n\n    The maple tree limits the gap returned to a window that specifically fits\n    what was asked.  This may not be optimal in the case of switching search\n    directions or a gap that does not satisfy the requested space for other\n    reasons.  Fix the search by retrying the operation and limiting the search\n    window in the rare occasion that a conflict occurs.\n\n    Link: https://lkml.kernel.org/r/20230414185919.4175572-1-Liam.Howlett@oracle.com\n    Fixes: 3499a13168da (\"mm/mmap: use maple tree for unmapped_area{_topdown}\")\n    Signed-off-by: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\n    Reported-by: Rick Edgecombe &lt;rick.p.edgecombe@intel.com&gt;\n    Cc: &lt;stable@vger.kernel.org&gt;\n    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;\n    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;\n</code></pre> <p>While fixing a BUG, a new BUG is introduced, causing MAP_32BIT to fail to work sometimes, and Xilinx's Digilent driver uses this parameter, causing mmap to fail and unable to recognize the FPGA.</p> <p>The new BUG has been fixed in [PATCH v2] maple_tree: Make maple state reusable after mas_empty_area().</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado-en/#background","title":"Background","text":"<p>The background is that after @vowstar upgraded the kernel to 6.2.14, he found that Vivado could not find the FPGA. But restarting and switching to 6.2.12, it works.</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado-en/#troubleshooting","title":"Troubleshooting","text":"<p>Because the kernel has been upgraded, the first reaction is whether it is a problem with the ftdi_sio driver. Comparing the dmesg logs of the two kernel versions, We found that Linux 6.2.12 will display <code>ftdi_sio: device disconnected</code> message: this is because the FPGA programmer has a built-in FTDI chip, which supports multiple modes. By default, after the kernel detects the usb device, the ftdi_sio driver will initialize the FTDI chip to the serial port mode to create a <code>/dev/ttyUSB*</code> device; and Vivado needs to use the MPSSE mode to communicate with the FPGA using the JTAG protocol. MPSSE mode conflicts with the serial port mode, so Vivado has to detach the kernel module so that it no longer occupies the USB device, and then let the FTDI chip enter MPSSE mode.</p> <p>Following this line of thought, the first thing that comes to mind is the permission issue: by default, the USB device permissions are strict, so when Vivado is installed, it will install udev rules, to change the permissions of the usb device file of the Digilent programmer to 666, so that all users are allowed to access USB devices. But after checking, the device file permissions under /dev/bus/usb are correct:</p> <pre><code>kernel 6.2.12: crw-rw-rw- 1 root usb 189, 271 May  6 15:31 /dev/bus/usb/003/016\nkernel 6.2.14: crw-rw-rw- 1 root usb 189, 262 May  6 15:32 /dev/bus/usb/003/016\n</code></pre> <p>At this time, we feel very strange. Only the kernel has been updated, and nothing else has changed. Why is the behavior different? So we looked through the ChangeLog of the Linux kernel, because 6.2.12 is good, while 6.2.14 is not working, so you only need to look at the changelog between the two:</p> <ul> <li>6.2.13</li> <li>6.2.14</li> </ul> <p>Searching for keywords such as ftdi or usb, only one commit seems to be related: <code>USB: serial: option: add UNISOC vendor and TOZED LT70C product</code>, but after a closer look, it only adds a new VID/PID, and it has no conflict with Digilent programmer.</p> <p>At this time, we feel that it is not a Linux problem. We continue to control the variables, by seeing if there is something wrong with the FTDI chip. At this time, OpenOCD was used to see if OpenOCD can configure the FTDI chip to enter MPSSE mode and find the FPGA. We tried it, it worked, ftdi_sio detached normally, and OpenOCD also found FPGA.</p> <p>But at this time, when Vivado is opened again, the FPGA is still not found, indicating that it is not a problem in MPSSE mode. Considering that the process that Vivado accesses the hardware is hw_server, we wonder if we can look at the log of hw_server.</p> <p>Run hw_server, printing all log types:</p> <pre><code>$ hw_server -L- -l alloc,eventcore,waitpid,events,protocol,context,children,discovery,asyncreq,proxy,tcflog,elf,stack,plugin,shutdown,disasm,jtag2,jtag,pcie,slave,dpc\n</code></pre> <p>Here <code>-L-</code> means to output the log to stderr, and the following <code>-l</code> string of parameters are various log switches. It is ran on both kernels, and the difference is found by comparing the logs:</p> <pre><code>Success (6.2.12):\nTCF 08:39:37.247: jtagpoll: add node 0xxxxxxxx(jsn-JTAG-SMT2NC-XXXXXXXXXXXX)\nTCF 08:39:37.247: Node 000000FF, added jsn-JTAG-SMT2NC-XXXXXXXXXXXX\n\nFailed (6.2.14):\nTCF 08:45:12.385: jtagpoll: cannot get port description list: ftdidb_lock failed: FTDMGR wasn't properly initialized\nTCF 08:45:12.391: jtagpoll: cannot get port description list: JTAG device enumeration failed: Initialization of the DPCOMM library failed.\n</code></pre> <p>Finally saw the error message: <code>jtagpoll: cannot get port description list: ftdidb_lock failed: FTDMGR wasn't properly initialized</code>. Use it as a keyword to search, and sure enough, someone else has encountered the same problem:</p> <ul> <li>XSDB fails with \"ftdidb_lock failed: FTDMGR wasn't properly initialized\"</li> <li>Linux \u591a\u7528\u6237\u73af\u5883\u4e0b Vivado \u65e0\u6cd5\u8fde\u63a5 Digilent JTAG \u9002\u914d\u5668\u7684\u89e3\u51b3\u65b9\u6cd5 (Solution to Vivado unable to connect to Digilent JTAG adapter in Linux multi-user environment)</li> </ul> <p>We tried the solution from the first post, it didn't work. The problem pointed out in the second article is that in a multi-user environment, multiple users use the same file, and then there is a permission problem, so the file must be deleted. We tried the method in the second document, but it didn't solve the problem.</p> <p>But the second article gives a debugging method: run the dadutil program provided by Digilent to see if it can recognize the programmer, and the problem reappears:</p> <pre><code>$ dadutil enum\nERROR: DmgrSetNetworkEnumTimeout failed, erc = 3090\n$ dadutil enum\nFound 1 device(s)\n$ dadutil enum\nFound 1 device(s)\n$ dadutil enum\nERROR: DmgrSetNetworkEnumTimeout failed, erc = 3090\n</code></pre> <p>We have tried many times here and found that there is a one-third probability of failure, but it is enough to explain why hw_server does not work: there is a high probability that it also calls the code provided by Digilent and gets the same result, so it fails.</p> <p>The second article above used strace to find the problem, so we use strace to locate the error:</p> <pre><code>$ strace dadutil enum\nopenat(AT_FDCWD, \"/dev/shm/digilent-adept2-mtx-ftdmgr\", O_RDWR|O_NOFOLLOW|O_CLOEXEC) = 7\nftruncate(7, 4)                         = 0\nmmap(NULL, 4, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_32BIT, 7, 0) = -1 ENOMEM (Cannot allocate memory)\nclose(7)                                = 0\n</code></pre> <p>The problem is that ENOMEM is returned, which is very strange, because <code>/dev/shm</code> is a tmpfs, and there is still a lot of space, how can it return ENOMEM?</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado-en/#found-the-culprit","title":"Found the culprit","text":"<p>Continue to research according to new clues: mmap returns an error that should not be returned, is that 6.2.13 or 6.2.14 introduced related changes? After checking, there are really:</p> <pre><code># https://cdn.kernel.org/pub/linux/kernel/v6.x/ChangeLog-6.2.13\ncommit 0d30989fe9a176565d360376d4bc2ea1c61cbbac\nAuthor: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\nDate:   Fri Apr 14 14:59:19 2023 -0400\n\n    mm/mmap: regression fix for unmapped_area{_topdown}\n\n    commit 58c5d0d6d522112577c7eeb71d382ea642ed7be4 upstream.\n\n    The maple tree limits the gap returned to a window that specifically fits\n    what was asked.  This may not be optimal in the case of switching search\n    directions or a gap that does not satisfy the requested space for other\n    reasons.  Fix the search by retrying the operation and limiting the search\n    window in the rare occasion that a conflict occurs.\n\n    Link: https://lkml.kernel.org/r/20230414185919.4175572-1-Liam.Howlett@oracle.com\n    Fixes: 3499a13168da (\"mm/mmap: use maple tree for unmapped_area{_topdown}\")\n    Signed-off-by: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\n    Reported-by: Rick Edgecombe &lt;rick.p.edgecombe@intel.com&gt;\n    Cc: &lt;stable@vger.kernel.org&gt;\n    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;\n    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;\n</code></pre> <p>It is related to mmap, click on the email link to have a look, and found that this commit was proposed to fix a BUG, but introduced a new BUG:</p> <pre><code>* Re: [PATCH v2] mm/mmap: Regression fix for unmapped_area{_topdown}\n  2023-04-14 18:59   ` [PATCH v2] \" Liam R. Howlett\n  2023-04-14 19:09     ` Andrew Morton\n@ 2023-04-29 14:32     ` Tad\n  2023-04-30 22:41       ` Michael Keyes\n  1 sibling, 1 reply; 18+ messages in thread\nFrom: Tad @ 2023-04-29 14:32 UTC (permalink / raw)\n  To: liam.howlett; +Cc: akpm, linux-kernel, linux-mm, rick.p.edgecombe\n\nThis reintroduces the issue described in\nhttps://lore.kernel.org/linux-mm/cb8dc31a-fef2-1d09-f133-e9f7b9f9e77a@sony.com/\n\nLinux 6.2.13 can no longer successfully run the mmap-test reproducer linked\nthere.\n\nLinux 6.2.12 passes.\n\nRegards,\nTad.\n</code></pre> <p>Continue to follow the above link, and you can see that in the error log inside, there is also a similar mmap call:</p> <pre><code>&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = 0x40720000\n&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = 0x4124e000\n&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = -1 ENOMEM (Cannot allocate memory)\n&gt; dex2oatd F 03-01 10:32:33 74063 74063 mem_map_arena_pool.cc:65] Check failed: map.IsValid() Failed anonymous mmap((nil), 131072, 0x3, 0x22, -1, 0): Cannot allocate memory. See process maps in the log.\n</code></pre> <p>Look at the mmap log reported above by <code>dadutil enum</code>:</p> <pre><code>mmap(NULL, 4, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_32BIT, 7, 0) = -1 ENOMEM (Cannot allocate memory)\n</code></pre> <p>The parameter also contains MAP_32BIT, and the result is also ENOMEM. Combined with other discussions on the mailing list, it can be basically confirmed that the author ignored the situation of MAP_32BIT, and the BUG is introduced by the commit.</p> <p>After reverting the commit from Linux 6.2.14, the problem is gone.</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado-en/#summary","title":"Summary","text":"<p>This is the whole debugging process. From the fact that Vivado can't find the FPGA, to the internal Linux kernel BUG, they seem irrelevant, but we can find the connection behind the scene.</p> <p>I went through the whole debugging process with @vowstar and learned a lot, hence the blog post.</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/","title":"Linux 6.2.13 \u5f15\u5165\u7684 BUG \u5bfc\u81f4 Vivado \u65e0\u6cd5\u8bc6\u522b FPGA","text":"<p>English version</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/#tldr","title":"TLDR","text":"<p>\u7b80\u5355\u6765\u8bf4\uff0cLinux 6.2.13 \u5f15\u5165\u7684 commit\uff1a</p> <pre><code>commit 0d30989fe9a176565d360376d4bc2ea1c61cbbac\nAuthor: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\nDate:   Fri Apr 14 14:59:19 2023 -0400\n\n    mm/mmap: regression fix for unmapped_area{_topdown}\n\n    commit 58c5d0d6d522112577c7eeb71d382ea642ed7be4 upstream.\n\n    The maple tree limits the gap returned to a window that specifically fits\n    what was asked.  This may not be optimal in the case of switching search\n    directions or a gap that does not satisfy the requested space for other\n    reasons.  Fix the search by retrying the operation and limiting the search\n    window in the rare occasion that a conflict occurs.\n\n    Link: https://lkml.kernel.org/r/20230414185919.4175572-1-Liam.Howlett@oracle.com\n    Fixes: 3499a13168da (\"mm/mmap: use maple tree for unmapped_area{_topdown}\")\n    Signed-off-by: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\n    Reported-by: Rick Edgecombe &lt;rick.p.edgecombe@intel.com&gt;\n    Cc: &lt;stable@vger.kernel.org&gt;\n    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;\n    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;\n</code></pre> <p>\u4fee\u590d\u4e86 BUG \u7684\u540c\u65f6\uff0c\u5f15\u5165\u4e86\u65b0\u7684 BUG\uff0c\u5bfc\u81f4 MAP_32BIT \u6709\u65f6\u65e0\u6cd5\u5de5\u4f5c\uff0c\u800c Xilinx \u7684 Digilent \u4e0b\u8f7d\u5668\u4ee3\u7801\u4f7f\u7528\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u5bfc\u81f4 mmap \u5931\u8d25\uff0c\u65e0\u6cd5\u8bc6\u522b FPGA\u3002</p> <p>\u65b0 BUG \u5728 [PATCH v2] maple_tree: Make maple state reusable after mas_empty_area() \u4e2d\u88ab\u4fee\u590d\u3002</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e8b\u60c5\u7684\u80cc\u666f\u662f\uff0c@vowstar \u5347\u7ea7\u5185\u6838\u5230 6.2.14 \u4ee5\u540e\uff0c\u53d1\u73b0 Vivado \u627e\u4e0d\u5230 FPGA \u4e86\uff0c\u91cd\u542f\u56de\u5230 6.2.12 \u5c31\u597d\u4e86\u3002</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/#\u6392\u67e5","title":"\u6392\u67e5","text":"<p>\u56e0\u4e3a\u5347\u7ea7\u4e86\u5185\u6838\uff0c\u7b2c\u4e00\u53cd\u5e94\u662f\u4e0d\u662f ftdi_sio \u9a71\u52a8\u7684\u95ee\u9898\u3002\u6bd4\u5bf9\u4e86\u4e00\u4e0b\u4e8c\u8005\u7684 dmesg \u65e5\u5fd7\uff0c\u53d1\u73b0 Linux 6.2.12 \u4f1a\u663e\u793a <code>ftdi_sio: device disconnected</code> \u6d88\u606f\uff1a\u8fd9\u662f\u56e0\u4e3a FPGA \u4e0b\u8f7d\u5668\u5185\u7f6e\u7684\u662f FTDI \u82af\u7247\uff0c\u5b83\u652f\u6301\u591a\u79cd\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5185\u6838\u68c0\u6d4b\u5230\u8bbe\u5907\u4ee5\u540e\uff0c\u4f1a\u7531 ftdi_sio \u9a71\u52a8\u521d\u59cb\u5316\u4e3a\u4e32\u53e3\u6a21\u5f0f\uff0c\u521b\u5efa <code>/dev/ttyUSB*</code> \u8bbe\u5907\uff1b\u800c Vivado \u9700\u8981\u7528\u7684\u662f MPSSE \u6a21\u5f0f\uff0c\u4ece\u800c\u4f7f\u7528 JTAG \u534f\u8bae\u4e0e FPGA \u901a\u8baf\u3002\u8fd9\u4e0e\u4e32\u53e3\u6a21\u5f0f\u51b2\u7a81\uff0c\u56e0\u6b64 Vivado \u8981\u505a\u7684\u4e8b\u60c5\uff0c\u9996\u5148\u662f\u628a\u5185\u6838\u6a21\u5757 detach\uff0c\u4e5f\u5c31\u662f\u4e0d\u518d\u5360\u7528 USB \u8bbe\u5907\uff0c\u7136\u540e\u518d\u8ba9 FTDI \u82af\u7247\u8fdb\u5165 MPSSE \u6a21\u5f0f\u3002</p> <p>\u6cbf\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u9996\u5148\u60f3\u5230\u7684\u662f\u6743\u9650\u95ee\u9898\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cUSB \u8bbe\u5907\u6743\u9650\u6bd4\u8f83\u4e25\u683c\uff0c\u6240\u4ee5 Vivado \u5728\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4f1a\u5b89\u88c5 udev rule\uff0c\u628a Digilent \u4e0b\u8f7d\u5668\u7684 usb \u8bbe\u5907\u6587\u4ef6\u7684\u6743\u9650\u6539\u4e3a 666\uff0c\u8fd9\u6837\u5c31\u5141\u8bb8\u6240\u6709\u7528\u6237\u8bbf\u95ee USB \u8bbe\u5907\u3002\u4f46\u662f\u68c0\u67e5\u4e86\u4e00\u4e0b\uff0c/dev/bus/usb \u4e0b\u7684\u8bbe\u5907\u6587\u4ef6\u6743\u9650\u662f\u6b63\u786e\u7684\uff1a</p> <pre><code>kernel 6.2.12: crw-rw-rw- 1 root usb 189, 271 May  6 15:31 /dev/bus/usb/003/016\nkernel 6.2.14: crw-rw-rw- 1 root usb 189, 262 May  6 15:32 /dev/bus/usb/003/016\n</code></pre> <p>\u8fd9\u65f6\u5019\u5c31\u89c9\u5f97\u5f88\u8e4a\u8df7\uff0c\u53ea\u66f4\u65b0\u4e86\u5185\u6838\uff0c\u5176\u4ed6\u90fd\u6ca1\u6709\u53d8\uff0c\u4e3a\u4ec0\u4e48\u884c\u4e3a\u5c31\u4f1a\u4e0d\u540c\u3002\u4e8e\u662f\u7ffb\u4e86\u7ffb Linux \u5185\u6838\u7684 ChangeLog\uff0c\u56e0\u4e3a 6.2.12 \u662f\u597d\u7684\uff0c6.2.14 \u662f\u4e0d\u5de5\u4f5c\u7684\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u770b\u4e24\u8005\u4e4b\u95f4\u7684 changelog\uff1a</p> <ul> <li>6.2.13</li> <li>6.2.14</li> </ul> <p>\u4ee5 ftdi \u6216 usb \u4e3a\u5173\u952e\u8bcd\u641c\u7d22\uff0c\u53ea\u6709\u4e00\u4e2a\u770b\u8d77\u6765\u6709\u4e00\u4e9b\u76f8\u5173\u7684 commit\uff1a<code>USB: serial: option: add UNISOC vendor and TOZED LT70C product</code>\uff0c\u4f46\u662f\u4ed4\u7ec6\u4e00\u770b\uff0c\u53ea\u662f\u6dfb\u52a0\u4e86\u65b0\u7684 VID/PID\uff0c\u4e5f\u6ca1\u6709\u548c Digilent \u4e0b\u8f7d\u5668\u51b2\u7a81\u3002</p> <p>\u8fd9\u65f6\u5019\uff0c\u5c31\u89c9\u5f97\u4e0d\u662f Linux \u7684\u95ee\u9898\u4e86\u3002\u6309\u7167\u8fd9\u4e2a\u601d\u8def\uff0c\u7ee7\u7eed\u63a7\u5236\u53d8\u91cf\u6cd5\uff0c\u770b\u770b\u662f\u4e0d\u662f FTDI \u82af\u7247\u51fa\u4e86\u95ee\u9898\u3002\u8fd9\u65f6\u5019\u5c31\u796d\u51fa\u4e86 OpenOCD\uff0c\u770b\u770b OpenOCD \u80fd\u5426\u914d\u7f6e FTDI \u82af\u7247\u8fdb\u5165 MPSSE \u6a21\u5f0f\uff0c\u5e76\u4e14\u627e\u5230 FPGA\u3002\u8bd5\u4e86\u4e00\u4e0b\uff0c\u8fd8\u771f\u53ef\u4ee5\uff0cftdi_sio \u6b63\u5e38 detach\uff0c\u7136\u540e OpenOCD \u4e5f\u627e\u5230 FPGA \u4e86\u3002</p> <p>\u4f46\u6b64\u65f6\u518d\u6253\u5f00 Vivado\uff0c\u8fd8\u662f\u627e\u4e0d\u5230\u8bbe\u5907\uff0c\u8bf4\u660e\u4e0d\u662f MPSSE \u6a21\u5f0f\u7684\u95ee\u9898\u3002\u8003\u8651\u5230 Vivado \u8bbf\u95ee\u786c\u4ef6\u7684\u8fdb\u7a0b\u662f hw_server\uff0c\u60f3\u5230\u80fd\u4e0d\u80fd\u770b\u770b hw_server \u7684\u65e5\u5fd7\u3002</p> <p>\u8fd0\u884c hw_server\uff0c\u6253\u5370\u6240\u6709\u65e5\u5fd7\u7c7b\u578b\uff1a</p> <pre><code>$ hw_server -L- -l alloc,eventcore,waitpid,events,protocol,context,children,discovery,asyncreq,proxy,tcflog,elf,stack,plugin,shutdown,disasm,jtag2,jtag,pcie,slave,dpc\n</code></pre> <p>\u8fd9\u91cc <code>-L-</code> \u8868\u793a\u8f93\u51fa\u65e5\u5fd7\u5230 stderr\uff0c\u540e\u9762\u7684 <code>-l</code> \u4e00\u4e32\u53c2\u6570\u5c31\u662f\u5404\u79cd\u65e5\u5fd7\u5f00\u5173\u3002\u5728\u4e24\u4e2a\u5185\u6838\u91cc\u90fd\u8fd0\u884c\u4e00\u6b21\uff0c\u6bd4\u5bf9\u65e5\u5fd7\uff0c\u53d1\u73b0\u4e86\u4e0d\u540c\uff1a</p> <pre><code>Success (6.2.12):\nTCF 08:39:37.247: jtagpoll: add node 0xxxxxxxx(jsn-JTAG-SMT2NC-XXXXXXXXXXXX)\nTCF 08:39:37.247: Node 000000FF, added jsn-JTAG-SMT2NC-XXXXXXXXXXXX\n\nFailed (6.2.14):\nTCF 08:45:12.385: jtagpoll: cannot get port description list: ftdidb_lock failed: FTDMGR wasn't properly initialized\nTCF 08:45:12.391: jtagpoll: cannot get port description list: JTAG device enumeration failed: Initialization of the DPCOMM library failed.\n</code></pre> <p>\u7ec8\u4e8e\u770b\u5230\u4e86\u9519\u8bef\u4fe1\u606f\uff1a<code>jtagpoll: cannot get port description list: ftdidb_lock failed: FTDMGR wasn't properly initialized</code>\u3002\u628a\u8fd9\u4e2a\u4f5c\u4e3a\u5173\u952e\u8bcd\u4e00\u641c\u7d22\uff0c\u679c\u7136\u6709\u522b\u4eba\u4e5f\u9047\u5230\u4e86\u540c\u6837\u7684\u95ee\u9898\uff1a</p> <ul> <li>XSDB fails with \"ftdidb_lock failed: FTDMGR wasn't properly initialized\"</li> <li>Linux \u591a\u7528\u6237\u73af\u5883\u4e0b Vivado \u65e0\u6cd5\u8fde\u63a5 Digilent JTAG \u9002\u914d\u5668\u7684\u89e3\u51b3\u65b9\u6cd5</li> </ul> <p>\u5c1d\u8bd5\u4e86\u7b2c\u4e00\u7bc7\u6587\u7ae0\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6ca1\u6709\u6548\u679c\u3002\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u6307\u51fa\u7684\u95ee\u9898\u662f\uff0c\u591a\u7528\u6237\u73af\u5883\u4e0b\uff0c\u591a\u4e2a\u7528\u6237\u62a2\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u51fa\u73b0\u6743\u9650\u95ee\u9898\uff0c\u6240\u4ee5\u8981\u5220\u6389\u6587\u4ef6\u518d\u542f\u52a8\u3002\u6309\u7167\u7b2c\u4e8c\u7bc7\u6587\u6863\u7684\u65b9\u6cd5\u5c1d\u8bd5\u4e86\u4e00\u4e0b\uff0c\u4e5f\u6ca1\u6709\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u4f46\u662f\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u7ed9\u51fa\u4e86\u4e00\u4e2a\u8c03\u8bd5\u65b9\u6cd5\uff1a\u8fd0\u884c Digilent \u63d0\u4f9b\u7684 dadutil \u7a0b\u5e8f\uff0c\u770b\u770b\u5b83\u662f\u5426\u53ef\u4ee5\u8bc6\u522b\u4e0b\u8f7d\u5668\uff0c\u679c\u7136\u590d\u73b0\u51fa\u95ee\u9898\u4e86\uff1a</p> <pre><code>$ dadutil enum\nERROR: DmgrSetNetworkEnumTimeout failed, erc = 3090\n$ dadutil enum\nFound 1 device(s)\n$ dadutil enum\nFound 1 device(s)\n$ dadutil enum\nERROR: DmgrSetNetworkEnumTimeout failed, erc = 3090\n</code></pre> <p>\u5230\u8fd9\u91cc\u591a\u6b21\u5c1d\u8bd5\uff0c\u53d1\u73b0\u6709\u4e09\u5206\u4e4b\u4e00\u7684\u6982\u7387\u4f1a\u5931\u8d25\uff0c\u4f46\u5df2\u7ecf\u8db3\u591f\u89e3\u91ca\u4e3a\u4ec0\u4e48 hw_server \u4e0d\u5de5\u4f5c\u4e86\uff1a\u5927\u6982\u7387\u5b83\u4e5f\u8c03\u7528\u4e86 Digilent \u63d0\u4f9b\u7684\u4ee3\u7801\uff0c\u5f97\u5230\u4e86\u540c\u6837\u7684\u7ed3\u679c\uff0c\u6240\u4ee5\u5931\u8d25\u4e86\u3002</p> <p>\u4e0a\u9762\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u7528 strace \u7684\u65b9\u6cd5\u627e\u5230\u4e86\u95ee\u9898\uff0c\u7167\u846b\u82a6\u753b\u74e2\uff0c\u7528 strace \u627e\u5230\u51fa\u9519\u7684\u65e5\u5fd7\uff1a</p> <pre><code>$ strace dadutil enum\nopenat(AT_FDCWD, \"/dev/shm/digilent-adept2-mtx-ftdmgr\", O_RDWR|O_NOFOLLOW|O_CLOEXEC) = 7\nftruncate(7, 4)                         = 0\nmmap(NULL, 4, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_32BIT, 7, 0) = -1 ENOMEM (Cannot allocate memory)\nclose(7)                                = 0\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u95ee\u9898\u662f\u8fd4\u56de\u4e86 ENOMEM\uff0c\u8fd9\u5c31\u5f88\u5947\u602a\u4e86\uff0c<code>/dev/shm</code> \u662f\u4e2a tmpfs\uff0c\u8fd8\u6709\u5f88\u591a\u7a7a\u95f4\uff0c\u600e\u4e48\u4f1a\u8fd4\u56de ENOMEM \u5462\uff1f</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/#\u67f3\u6697\u82b1\u660e\u53c8\u4e00\u6751","title":"\u67f3\u6697\u82b1\u660e\u53c8\u4e00\u6751","text":"<p>\u6309\u7167\u65b0\u7ebf\u7d22\u7ee7\u7eed\u7814\u7a76\uff1ammap \u8fd4\u56de\u4e86\u4e0d\u5e94\u8be5\u8fd4\u56de\u7684\u9519\u8bef\uff0c\u90a3\u662f\u4e0d\u662f 6.2.13 \u6216 6.2.14 \u5f15\u5165\u4e86\u76f8\u5173\u6539\u52a8\u5462\uff1f\u4e00\u67e5\uff0c\u8fd8\u771f\u6709\uff1a</p> <pre><code># https://cdn.kernel.org/pub/linux/kernel/v6.x/ChangeLog-6.2.13\ncommit 0d30989fe9a176565d360376d4bc2ea1c61cbbac\nAuthor: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\nDate:   Fri Apr 14 14:59:19 2023 -0400\n\n    mm/mmap: regression fix for unmapped_area{_topdown}\n\n    commit 58c5d0d6d522112577c7eeb71d382ea642ed7be4 upstream.\n\n    The maple tree limits the gap returned to a window that specifically fits\n    what was asked.  This may not be optimal in the case of switching search\n    directions or a gap that does not satisfy the requested space for other\n    reasons.  Fix the search by retrying the operation and limiting the search\n    window in the rare occasion that a conflict occurs.\n\n    Link: https://lkml.kernel.org/r/20230414185919.4175572-1-Liam.Howlett@oracle.com\n    Fixes: 3499a13168da (\"mm/mmap: use maple tree for unmapped_area{_topdown}\")\n    Signed-off-by: Liam R. Howlett &lt;Liam.Howlett@oracle.com&gt;\n    Reported-by: Rick Edgecombe &lt;rick.p.edgecombe@intel.com&gt;\n    Cc: &lt;stable@vger.kernel.org&gt;\n    Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;\n    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;\n</code></pre> <p>\u548c mmap \u76f8\u5173\uff0c\u70b9\u8fdb\u90ae\u4ef6\u94fe\u63a5\u770b\u770b\uff0c\u53d1\u73b0\u6709\u4eba\u63d0\u51fa\u8fd9\u4e2a commit \u867d\u7136\u4fee\u590d\u4e86\u4e00\u4e2a BUG\uff0c\u4f46\u662f\u5f15\u5165\u4e86\u65b0\u7684 BUG\uff1a</p> <pre><code>* Re: [PATCH v2] mm/mmap: Regression fix for unmapped_area{_topdown}\n  2023-04-14 18:59   ` [PATCH v2] \" Liam R. Howlett\n  2023-04-14 19:09     ` Andrew Morton\n@ 2023-04-29 14:32     ` Tad\n  2023-04-30 22:41       ` Michael Keyes\n  1 sibling, 1 reply; 18+ messages in thread\nFrom: Tad @ 2023-04-29 14:32 UTC (permalink / raw)\n  To: liam.howlett; +Cc: akpm, linux-kernel, linux-mm, rick.p.edgecombe\n\nThis reintroduces the issue described in\nhttps://lore.kernel.org/linux-mm/cb8dc31a-fef2-1d09-f133-e9f7b9f9e77a@sony.com/\n\nLinux 6.2.13 can no longer successfully run the mmap-test reproducer linked\nthere.\n\nLinux 6.2.12 passes.\n\nRegards,\nTad.\n</code></pre> <p>\u518d\u7ee7\u7eed\u8ddf\u8e2a\u4e0a\u9762\u7684\u94fe\u63a5\uff0c\u8d6b\u7136\u770b\u5230\u91cc\u9762\u7684\u9519\u8bef\u65e5\u5fd7\u91cc\uff0c\u4e5f\u51fa\u73b0\u4e86\u7c7b\u4f3c\u7684 mmap \u8c03\u7528\uff1a</p> <pre><code>&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = 0x40720000\n&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = 0x4124e000\n&gt; mmap(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_32BIT, -1, 0) = -1 ENOMEM (Cannot allocate memory)\n&gt; dex2oatd F 03-01 10:32:33 74063 74063 mem_map_arena_pool.cc:65] Check failed: map.IsValid() Failed anonymous mmap((nil), 131072, 0x3, 0x22, -1, 0): Cannot allocate memory. See process maps in the log.\n</code></pre> <p>\u518d\u770b\u770b\u4e0a\u9762 <code>dadutil enum</code> \u62a5\u9519\u7684 mmap \u65e5\u5fd7\uff1a</p> <pre><code>mmap(NULL, 4, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_32BIT, 7, 0) = -1 ENOMEM (Cannot allocate memory)\n</code></pre> <p>\u8d6b\u7136\u4e5f\u662f MAP_32BIT\uff0c\u7ed3\u679c\u4e5f\u662f ENOMEM\uff0c\u90a3\u8bf4\u660e\u5c31\u662f\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\u7ed3\u5408\u90ae\u4ef6\u5217\u8868\u7684\u5176\u4ed6\u8ba8\u8bba\uff0c\u57fa\u672c\u53ef\u4ee5\u786e\u8ba4\u662f\u4f5c\u8005\u5ffd\u7565\u4e86 MAP_32BIT \u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u51fa\u73b0\u4e86\u95ee\u9898\u3002</p> <p>\u4ece Linux 6.2.14 \u56de\u6eda\u51fa\u95ee\u9898\u7684 commit \u4ee5\u540e\uff0c\u95ee\u9898\u89e3\u51b3\u4e86\u3002</p>","tags":["linux","vivado"]},{"location":"software/2023/05/06/linux-regression-vivado/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u8fd9\u5c31\u662f\u6574\u4e2a Debug \u6d41\u7a0b\uff0c\u4ece Vivado \u627e\u4e0d\u5230 FPGA \u7684\u8868\u8c61\uff0c\u5230\u5185\u5728\u7684 Linux \u5185\u6838 BUG\uff0c\u770b\u8d77\u6765\u6beb\u4e0d\u76f8\u5173\uff0c\u4f46\u5374\u80fd\u53d1\u73b0\u80cc\u540e\u7684\u903b\u8f91\u3002</p> <p>\u6211\u548c @vowstar \u4e00\u8d77\u5b8c\u6210\u4e86\u6574\u4e2a\u8c03\u8bd5\u7684\u6d41\u7a0b\uff0c\u5b66\u5230\u4e86\u8bb8\u591a\uff0c\u56e0\u6b64\u5199\u4e86\u8fd9\u7bc7\u535a\u5ba2\u3002</p>","tags":["linux","vivado"]},{"location":"software/2021/09/02/locale/","title":"Locale \u5f71\u54cd\u6392\u5e8f\u7684\u7279\u6b8a\u526f\u4f5c\u7528","text":"","tags":["locale","sort"]},{"location":"software/2021/09/02/locale/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7b54\u7591\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u540c\u4e00\u6761\u547d\u4ee4\u5728\u4e0d\u540c\u7cfb\u7edf\u4e0a\u884c\u4e3a\u4e0d\u540c\uff0c\u4e00\u5f00\u59cb\u4ee5\u4e3a\u662f bash \u7248\u672c\u95ee\u9898\uff0c\u6392\u67e5\u540e\u6700\u540e\u53d1\u73b0\u662f locale \u7684\u95ee\u9898\u3002\u4e00\u4e2a\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>$ cat poc.txt | tr '\\\\n' ' '\n1 + - * / \\ a b A B \u4e00 \u4e8c \u6d4b \u8bd5 \u03b1\n$ LANG=\"\" sort poc.txt | tr '\\\\n' ' '\n* + - / 1 A B \\ a b \u03b1 \u4e00 \u4e8c \u6d4b \u8bd5\n$ LANG=\"zh_CN.UTF-8\" sort poc.txt | tr '\\\\n' ' '\n* + - / \\ 1 \u6d4b \u4e8c \u8bd5 \u4e00 a A b B \u03b1\n$ LANG=\"en_US.UTF-8\" sort poc.txt | tr '\\\\n' ' '\n* + - / \\ 1 a A b B \u03b1 \u4e00 \u4e8c \u6d4b \u8bd5\n</code></pre> <p>\u6ce8\u610f  1 a A \u7684\u987a\u5e8f\uff0c\u5728\u4e0d\u540c\u7684 locale \u4e0b\u7ed3\u679c\u4e0d\u540c\u3002</p> <p>\u7f51\u4e0a\u4e5f\u6709\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u8ba8\u8bba\uff1a</p> <ol> <li>https://unix.stackexchange.com/questions/75341/specify-the-sort-order-with-lc-collate-so-lowercase-is-before-uppercase</li> <li>https://stackoverflow.com/questions/43448655/weird-behavior-of-bash-glob-regex-ranges</li> </ol>","tags":["locale","sort"]},{"location":"software/2022/05/02/loongarch64-toolchain/","title":"LoongArch64 \u5de5\u5177\u94fe\u6784\u5efa","text":"<p>\u6700\u8fd1\u56e0\u4e3a\u9f99\u82af\u676f\u7684\u539f\u56e0\uff0c\u60f3\u81ea\u5df1\u641e\u4e2a LoongArch64 \u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u8bd5\u8bd5\uff0c\u7ed3\u679c\u9047\u5230\u4e86\u5f88\u591a\u5751\uff0c\u6700\u540e\u7ec8\u4e8e\u7b97\u662f\u641e\u51fa\u6765\u4e86\u3002</p> <p>\u4e00\u5f00\u59cb\u662f\u60f3\u641e\u4e00\u4e2a newlib \u7684\u5de5\u5177\u94fe\uff0c\u6bd4\u8f83\u7b80\u5355\uff0c\u800c\u4e14\u4e4b\u524d\u505a\u8fc7\u4e00\u4e2a\u4ed3\u5e93\uff1ajiegec/riscv-toolchain\uff0c\u5c31\u662f\u6784\u5efa\u7684 riscv64-unknown-elf \u5de5\u5177\u94fe\uff0c\u7167\u7740 riscv-gnu-toolchain \u5c31\u53ef\u4ee5\u4e86\u3002\u4e0d\u8fc7\u7814\u7a76\u53d1\u73b0\uff0cnewlib \u8fd8\u4e0d\u652f\u6301 loongarch\uff0c\u76ee\u524d\u53ea\u6709 glibc \u652f\u6301\uff0c\u53ea\u597d\u786c\u7740\u5934\u76ae\u4e0a\u4e86\u3002</p> <p>\u4e8e\u662f\u6211\u5c31\u5728 riscv-toolchain \u7684\u57fa\u7840\u4e0a\u641e loongarch64-unknown-linux-gnu\uff0c\u4e5f\u5c31\u662f\u5e26 glibc \u7684\u5de5\u5177\u94fe\uff0c\u7ed3\u679c\u53d1\u73b0\u9047\u5230\u5f88\u591a\u5751\u3002\u9996\u5148\u7f16\u8bd1 libgcc \u7684\u65f6\u5019\u5c31\u627e\u4e0d\u5230\u5934\u6587\u4ef6\uff0c\u4e8e\u662f\u5148\u8981\u4ece glibc \u548c linux \u5b89\u88c5\u5934\u6587\u4ef6\u5230 sysroot \u91cc\u9762\uff0c\u5bf9\u4e8e sysroot \u91cc\u9762\u7684\u5934\u6587\u4ef6\u8def\u5f84\u5230\u5e95\u662f include \u8fd8\u662f usr/include \u4e5f\u6298\u817e\u4e86\u534a\u5929\u3002\u7136\u540e\u7f16\u8bd1 libgcc \u53c8\u5404\u79cd\u51fa\u95ee\u9898\uff0c\u6700\u540e\u6298\u817e\u4e86\u534a\u5929\uff0c\u7ed3\u679c\u662f gcc stage1 \u548c glibc \u90fd\u6ca1\u95ee\u9898\uff0cgcc stage2 \u4f1a\u62a5\u94fe\u63a5\u9519\u8bef\uff0c\u4f46\u662f\u4e0d\u7ba1\u5b83\u4e5f\u80fd\u7528\uff0c\u53ef\u4ee5\u7f16\u8bd1\u51fa\u6b63\u5e38\u7684\u7a0b\u5e8f\uff0c\u6bd5\u7adf libc \u662f\u597d\u7684\u3002</p> <p>\u4e8e\u662f\u8f6c\u5ff5\u4e00\u60f3\uff0c\u8981\u4e0d\u8981\u8bd5\u8bd5 crosstool-ng\u3002\u514b\u9686\u4e86\u4e00\u4efd\u4e0a\u6e38\u7684\u7248\u672c\uff0c\u7167\u7740 riscv \u7684\u90e8\u5206\u6284\u4e86\u4e00\u4efd\u53d8\u6210\u4e86 loongarch\uff0c\u7136\u540e\u628a config \u91cc\u9762\u7684 linux/glibc/gcc/binutils-gdb \u90fd\u66ff\u6362\u4e3a custom location\uff0c\u8fd9\u6837\u6211\u5c31\u53ef\u4ee5\u7528\u4e0a\u6e38\u7684\u6700\u65b0\u7248\u672c\u4e86\u3002\u4e2d\u9014\u8fd8\u9047\u5230\u4e86 crosstool-ng \u5bf9 gcc 12/13 \u4e0d\u517c\u5bb9\u7684 bug\uff0c\u8fd8\u597d\u4e0b\u9762\u6709\u4eba\u63d0\u51fa\u4e86\u89e3\u51b3\u65b9\u6cd5\u3002\u8fd9\u4e9b\u90fd\u641e\u5b9a\u4ee5\u540e\uff0c\u7ec8\u4e8e\u6784\u5efa\u51fa\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684 loongarch64-unknown-linux-gnu \u5de5\u5177\u94fe\u3002\u4ed3\u5e93\u5730\u5740\u662f jiegec/ct-ng-loongarch64\uff0c\u9700\u8981\u914d\u5408\u6dfb\u52a0\u4e86 LoongArch \u7684 jiegec/crosstool-ng loongarch \u5206\u652f \u4f7f\u7528\u3002</p> <p>\u6700\u540e\u5f97\u5230\u7684\u5de5\u5177\u94fe\u5404\u7ec4\u4ef6\u7248\u672c\u5982\u4e0b\uff1a</p> <pre><code>loongarch64-unknown-linux-gnu-gcc (crosstool-NG 1.25.0_rc2.1_7e21141) 13.0.0 20220502 (experimental)\nCopyright (C) 2022 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nGNU ld (crosstool-NG 1.25.0_rc2.1_7e21141) 2.38.50.20220502\nCopyright (C) 2022 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License version 3 or (at your option) a later version.\nThis program has absolutely no warranty.\nGNU gdb (crosstool-NG 1.25.0_rc2.1_7e21141) 13.0.50.20220502-git\nCopyright (C) 2022 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n</code></pre> <p>\u4e4b\u540e\u6709\u65f6\u95f4\u7684\u8bdd\uff0c\u518d\u628a qemu \u548c\u7cfb\u7edf\u641e\u8d77\u6765\u8dd1\u8dd1\u3002</p> <p>UPDATE: GCC 12.1 \u53d1\u5e03\u4e86\uff0c\u8bd5\u4e86\u4e00\u4e0b\u8fd9\u4e2a\u6b63\u5f0f\u7248\u672c\u53ef\u4ee5\u6b63\u786e\u5730\u7f16\u8bd1\u3002\u76ee\u524d\u8fd8\u9700\u8981\u4f7f\u7528 HEAD \u7248\u672c\u7684 binutils \u548c\u9f99\u82af\u7684 glibc \u548c linux\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ul> <li>\u624b\u628a\u624b\u6559\u4f60\u6784\u5efa\u57fa\u4e8e LoongArch64 \u67b6\u6784\u7684 Linux \u7cfb\u7edf</li> <li>How to Build a GCC Cross-Compiler</li> </ul>","tags":["loongarch","toolchain","gcc"]},{"location":"software/2020/02/07/macos-mmap-exec/","title":"\u5728 macOS \u4e0a\u5e26\u6267\u884c\u6743\u9650 mmap \u4e00\u4e2a\u5df2\u5220\u9664\u6587\u4ef6\u9047\u5230\u7684\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848","text":"","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5b9e\u9a8c\u73af\u5883\uff1amacOS Catalina 10.15.2</p> <p>\u6700\u8fd1\u5728 rcore-rs/zircon-rs \u9879\u76ee\u4e2d\u9047\u5230\u4e00\u4e2a\u6bd4\u8f83\u7384\u5b66\u7684\u95ee\u9898\uff0c\u9996\u5148\u9700\u6c42\u662f\u5728 macOS \u7684\u7528\u6237\u8fdb\u7a0b\u91cc\u5f00\u8f9f\u4e00\u6bb5\u5730\u5740\u7a7a\u95f4\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u5730\u5740\u7a7a\u95f4\u591a\u6b21\u6620\u5c04\uff08\u6743\u9650\u53ef\u80fd\u4e0d\u540c\u3001\u540c\u4e00\u5757\u5185\u5b58\u53ef\u80fd\u88ab\u6620\u5c04\u5230\u591a\u4e2a\u5730\u5740\uff09\uff0c\u901a\u8fc7 mmap \u6a21\u62df\u865a\u62df\u5730\u5740\u7684\u6620\u5c04\u3002\u91c7\u7528\u7684\u662f\u5982\u4e0b\u7684\u65b9\u6848\uff1a</p> <ol> <li>\u5728\u4e34\u65f6\u76ee\u5f55\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u628a\u6587\u4ef6\u5927\u5c0f\u8bbe\u4e3a 16M\uff08\u6682\u4e0d\u8003\u8651\u6269\u5bb9\uff09</li> <li>\u9700\u8981\u6620\u5c04\u4e00\u4e2a\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u65f6\u5019\uff0c\u5c31\u5bf9\u8fd9\u4e2a\u6587\u4ef6\u7684\u7269\u7406\u5730\u5740\u504f\u79fb\u8fdb\u884c FIXED \u6620\u5c04\uff0c\u865a\u62df\u5730\u5740\u5c31\u662f\u671f\u671b\u7684\u865a\u62df\u5730\u5740\u3002</li> </ol> <p>\u8fd9\u6837\u7684\u65b9\u6848\u5728 Linux \u4e0b\u8fd0\u884c\u5730\u5f88\u597d\uff0c\u4f46\u5728 macOS \u4e0b\u603b\u662f\u4ee5\u4e00\u5b9a\u6982\u7387\u5728\u7b2c\u4e8c\u90e8\u51fa\u73b0 EPERM\u3002\u7f51\u4e0a\u641c\u4e86\u5f88\u591a\uff0c\u4f46\u4e5f\u6ca1\u641c\u5230\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4e8e\u662f\u81ea\u5df1\u65ad\u65ad\u7eed\u7eed\u5730\u7814\u7a76\u4e86\u4e00\u4e0b\uff0c\u73b0\u5728\u6709\u4e00\u4e2a\u6bd4\u8f83\u521d\u6b65\u7684\u7ed3\u679c\u3002</p>","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#tldr","title":"TL\uff1bDR","text":"<p>\u5148\u8bf4\u7ed3\u8bba\uff1a\u8c03\u7528\u4e00\u4e2a\u5e26 PROT_EXEC \u5e76\u4e14\u6620\u5c04\u6587\u4ef6\u7684 mmap \u65f6\uff0cmacOS \u4f1a\u8fdb\u884c\u5b89\u5168\u68c0\u6d4b\uff0c\u5982\u679c\u6b64\u65f6\u53d1\u73b0\u6587\u4ef6\u5728\u6587\u4ef6\u7cfb\u7edf\u4e0a\u6d88\u5931\u4e86\uff0c\u5b83\u4f1a\u8ba4\u4e3a\u8fd9\u53ef\u80fd\u662f\u4e00\u4e2a\u6076\u610f\u8f6f\u4ef6\u884c\u4e3a\uff0c\u8fdb\u884c\u62e6\u622a\uff0c\u8fd4\u56de EPERM\u3002</p> <p>\u800c\u4ee3\u7801\u5b9e\u9645\u4e0a\u5728\u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u4e4b\u95f4\uff0c\u628a\u4e34\u65f6\u76ee\u5f55\u5220\u4e86\uff1a\u7531\u4e8e\u8fdb\u7a0b\u6301\u6709 fd\uff0c\u6240\u4ee5\u6587\u4ef6\u5e76\u4e0d\u4f1a\u771f\u7684\u5220\u6389\uff0c\u5f53\u8f6f\u4ef6\u9000\u51fa\u7684\u65f6\u5019\u6587\u4ef6\u81ea\u7136\u4f1a\u5220\u9664\uff0c\u8fd9\u662f\u4e34\u65f6\u6587\u4ef6\u7684\u5e38\u89c1\u505a\u6cd5\uff08\u89c1 tmpfile(3)\uff09\u3002</p>","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#\u7814\u7a76\u8fc7\u7a0b","title":"\u7814\u7a76\u8fc7\u7a0b","text":"","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#\u67e5\u770b-console","title":"\u67e5\u770b Console","text":"<p>\u5728\u7f51\u4e0a\u4e00\u756a\u641c\u7d22\u672a\u679c\u540e\uff0c\u5c31\u5c1d\u8bd5\u5728 Console \u91cc\u9762\u5bfb\u627e\u4fe1\u606f\u3002\u7167\u7740\u7a0b\u5e8f\u540d\u5b57\u641c\u7d22\uff0c\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b\u4fe1\u606f\uff1a</p> <pre><code>temporarySigning type=1 matchFlags=0x0 path=/path/to/executable\n</code></pre> <p>\u8fd9\u662f\u7f16\u8bd1\u8fd9\u4e2a executable \u7684\u65f6\u5019\u51fa\u73b0\u7684\uff0c\u597d\u50cf\u4e5f\u6ca1\u5565\u95ee\u9898\u3002\u7136\u540e\u89e3\u9664\u8fc7\u6ee4\uff0c\u5728\u8fd9\u4e2a\u4fe1\u606f\u524d\u540e\u6309\u7167 syspolicyd \u5bfb\u627e\uff1a</p> <pre><code>initiating malware scan (... info_path: /path/to/temp/file proc_path: /path/to/executable)\nUnable (errno: 2) to read file at &lt;private&gt; for process path: &lt;private&gt; library path: &lt;private&gt;\nDisallowing load of &lt;private&gt; in 50001, &lt;private&gt;\nLibrary load (/path/to/temp/file) rejected: library load denied by system policy\n</code></pre> <p>\u8fd9\u51e0\u6761\u8bb0\u5f55\u6bd4\u8f83\u53ef\u7591\uff0c\u6bcf\u6b21\u8fd0\u884c\u7a0b\u5e8f\uff0c\u5982\u679c\u8dd1\u6302\u4e86\uff0c\u5c31\u4f1a\u51fa\u73b0\u8fd9\u51e0\u6761\uff0c\u5982\u679c\u6ca1\u8dd1\u6302\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u4e00\u6761\u3002\u6240\u4ee5\u5f88\u5927\u6982\u7387\u662f\u88ab macOS \u62e6\u622a\u4e86\u3002\u9519\u8bef\u4fe1\u606f\u7684\u7528\u8bcd\u662f library\uff0c\u6240\u4ee5\u5927\u6982\u7387\u662f\u88ab\u5f53\u6210\u52a0\u8f7d\u52a8\u6001\u5e93\u4e86\uff0c\u4f46\u65e2\u7136\u5185\u5bb9\u662f\u7a7a\u7684\uff0c\u6240\u4ee5\u6211\u60f3\u7684\u662f\u6587\u4ef6\u540d\u89e6\u78b0\u5230\u4e86\u4ec0\u4e48\u5947\u602a\u7684\u89c4\u5219\uff0c\u7136\u540e\u6587\u4ef6\u540d\u53c8\u662f\u968f\u673a\u7684\uff0c\u968f\u673a\u5bfc\u81f4 EPERM \u662f\u6982\u7387\u6027\u51fa\u73b0\u7684\uff0c\u8fd9\u597d\u50cf\u5f88\u6709\u9053\u7406\u3002\u4e8e\u662f\u6211\u628a tmpfile \u6362\u6210\u4e86\u56fa\u5b9a\u7684\u8def\u5f84\uff0c\u5ffd\u7136\u5c31\u597d\u4e86\u3002\u4f46\u56fa\u5b9a\u7684\u8def\u5f84\u53ea\u80fd\u4fdd\u8bc1\u540c\u65f6\u53ea\u6709\u4e00\u4e2a\u7a0b\u5e8f\u5728\u8dd1\uff0c\u5982\u679c\u8def\u5f84\u62fc\u63a5\u4e0a pid\uff0c\u600e\u4e48\u5220\uff0c\u8c01\u6765\u5220\u53c8\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u867d\u7136\u53ef\u4ee5\u653e\u5230 /tmp \u4e0b\u9762\u7136\u540e\u968f\u4fbf\u641e\uff0c\u4f46 /tmp \u7684\u56de\u6536\u5e76\u4e0d\u662f\u90a3\u4e48\u79ef\u6781\uff0c\u5728\u4e34\u65f6\u76ee\u5f55\u4e0b\u4e22\u592a\u591a\u6587\u4ef6\u4e5f\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p>","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#\u4e00\u4e1d\u66d9\u5149","title":"\u4e00\u4e1d\u66d9\u5149","text":"<p>\u8fd9\u65f6\u5019\uff0c@wangrunji0408 \u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u6848\uff1a\u5728 System Preferences -&gt; Security &amp; Privacy -&gt; Privacy -&gt; Developer Tools \u4e2d\u6dfb\u52a0\u7f16\u8bd1\u8be5 executable \u7684\u7a0b\u5e8f\uff08\u5982 iTerm\u3001CLion\uff09\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u90a3\u4e48\u95ee\u9898\u5e94\u8be5\u6bd4\u8f83\u660e\u786e\u4e86\uff0c\u5c31\u662f malware scan \u7684\u95ee\u9898\uff0c\u5982\u679c\u4fe1\u4efb\u4e86\u8fd9\u4e2a App \u4e3a Developer Tools\uff0c\u5b83\u4ea7\u751f\u7684 executable \u4e5f\u662f\u53ef\u4fe1\u7684\uff0c\u5e94\u8be5\u4e0d\u662f\u6076\u610f\u8f6f\u4ef6\u3002\u4f46\u5728 tmux \u73af\u5883\u4e0b\uff0c\u5b83\u54ea\u4e2a App \u4e5f\u4e0d\u5c5e\u4e8e\uff0c\u6ca1\u6cd5\u7ee7\u627f\uff0c\u51b5\u4e14\u628a\u8fd9\u4e2a\u6743\u9650\u5f00\u653e\u51fa\u53bb\u4e5f\u6709\u6f5c\u5728\u7684\u5b89\u5168\u95ee\u9898\u3002\u5e76\u4e14\u8ba9\u6bcf\u4e2a\u5f00\u53d1\u8005\u90fd\u8981\u8fd9\u4e48\u64cd\u4f5c\u4e00\u904d\u5f88\u4e0d\u65b9\u4fbf\u3002</p>","tags":["macos","mmap","catalina"]},{"location":"software/2020/02/07/macos-mmap-exec/#\u56de\u5230-console","title":"\u56de\u5230 Console","text":"<p>\u4eca\u5929\u521a\u597d\u770b\u5230\u4e00\u4e2a post\uff0c\u5185\u5bb9\u662f\u5982\u4f55\u5728 macOS Catalina \u4e2d\u67e5\u770b log \u4e2d\u6807\u8bb0\u4e3a private \u7684\u5185\u5bb9\u3002\u5982\u679c\u4f60\u6ce8\u610f\u5230\u7684\u8bdd\uff0c\u4e0a\u9762\u7684 log \u4e2d\u51fa\u73b0\u4e86\u51e0\u5904 private\uff0c\u8fd9\u5e76\u4e0d\u662f\u6211\u6539\u7684\uff0c\u800c\u662f macOS \u81ea\u5e26\u7684\u9690\u79c1\u673a\u5236\uff08\u5f53\u7136\u8fd9\u79cd\u673a\u5236\u4f3c\u4e4e\u5e76\u6ca1\u6709\u91c7\u7528\u7684\u5f88\u5b8c\u5168\uff0c\u4e00\u4e9b\u6d88\u606f\u6e90\u6ca1\u6709\u6253\u4e0a private \u7684\u6807\u7b7e\uff09\u3002</p> <p>\u7136\u540e\u6309\u7167\u4e0a\u9762\u7684 post \u7684\u65b9\u6cd5\uff08\u53e6\u4e00\u4e2a post\uff09\u5f00\u542f\u4e86\u4e00\u4e0b\u6807\u8bb0\u4e3a private \u7684\u5185\u5bb9\uff0c\u6b63\u597d\u6211\u7684\u7cfb\u7edf\u6ca1\u6709\u5347\u7ea7\u5230 10.15.3 \u6240\u4ee5\u8fd8\u80fd\u7528\u3002\u6b64\u65f6\u4e0a\u9762\u7684\u7b2c\u4e8c\u6761\u548c\u7b2c\u4e09\u6761\u5c31\u51fa\u73b0\u4e86\u5177\u4f53\u5185\u5bb9\uff1a</p> <pre><code>Unable (errno: 2) to read file at /path/to/temp/file for process path: /path/to/executable library path: /path/to/temp/file\nDisallowing load of /path/to/temp/file in 61254, /path/to/executable\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u5019\u95ee\u9898\u5c31\u5f88\u660e\u663e\u4e86\uff1a\u8bfb\u53d6\u4e0d\u5230\u6587\u4ef6\u3002\u8fd9\u65f6\u5019\u56de\u60f3\u8d77 tmpfile \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5b83\u4f1a\u5220\u9664\u751f\u6210\u7684\u6587\u4ef6\uff0c\u5728\u5220\u9664\u6587\u4ef6\u4e4b\u540e\uff0cmacOS \u8fdb\u884c\u626b\u63cf\uff0c\u53d1\u73b0\u627e\u4e0d\u5230\u6587\u4ef6\uff0c\u4e8e\u662f disallow \u4e86\uff0cmmap \u5c31\u4f1a\u8fd4\u56de EPERM\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\u4e5f\u5f88\u663e\u7136\u4e86\uff1a\u628a\u5220\u9664\u76ee\u5f55\u5ef6\u540e\uff0c\u6216\u8005\u653e\u5728 /tmp \u4e0b\u7b49\u5f85\u6e05\u7406\u7b49\u5f85\u3002</p> <p>\u6211\u4e5f\u5199\u4e86\u4e00\u6bb5 C \u4ee3\u7801\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u73b0\u8c61\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;unistd.h&gt;\n\n\nint main() {\n    int fd = open(\"mmap\", O_RDWR | O_CREAT, 0777);\n    uint64_t addr = 0x200000000;\n    ftruncate(fd, 16*1024*1024);\n    // might not work if unlink is put here (race condition)\n    // you can use sleep to reproduce\n    unlink(\"mmap\");\n    void * res = mmap((void *)addr, 16*1024*1024, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_SHARED | MAP_FIXED, fd, 0);\n    // always works if unlink is put here\n    // unlink(\"mmap\");\n    if (res == MAP_FAILED) {\n        perror(\"mmap\");\n    } else {\n        printf(\"good\");\n    }\n    return 0;\n}\n</code></pre>","tags":["macos","mmap","catalina"]},{"location":"software/2018/11/04/mi-air-purifier-homekit/","title":"\u4f7f\u7528 HomeBridge \u628a\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\u52a0\u5165\u5230 HomeKit \u4e2d","text":"<p>\u53d7 @NSBlink \u5b89\u5229\uff0c\u81ea\u5df1\u90e8\u7f72\u4e86\u4e00\u4e0b HomeBridge \uff0c\u7136\u540e\u5728 iOS \u7684\u5bb6\u5ead\u4e0a\u5c31\u53ef\u4ee5\u770b\u5230\u5b83\u3002\u7136\u540e\uff0c\u901a\u8fc7 homebrdige-mi-airpurifier \u548c miio \u6309\u7167\u6559\u7a0b\u8fdb\u884c\u914d\u7f6e\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u5728\u5bb6\u5ead\u91cc\u770b\u5230\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\uff0c\u5305\u62ec\u7a7a\u6c14\u8d28\u91cf\uff0c\u6e7f\u5ea6\uff0c\u7761\u7720\u6a21\u5f0f\uff0c\u6e29\u5ea6\uff0c\u6253\u5f00\u72b6\u6001\u3002\u7136\u540e\u6211\u5c31\u53ef\u4ee5\u505a\u4e00\u4e9b\u914d\u7f6e\uff0c\u5982\u79bb\u5f00\u5bbf\u820d\u7684\u65f6\u5019\u81ea\u52a8\u5173\u95ed\u7a7a\u6c14\u51c0\u5316\u5668\uff0c\u56de\u6765\u7684\u65f6\u5019\u81ea\u52a8\u6253\u5f00\u3002\u4e0d\u8fc7\u7531\u4e8e\u81ea\u5df1\u6ca1\u6709\u4e00\u4e2a\u4e00\u76f4\u653e\u5728\u5bbf\u820d\u7684 iPad\u3001Apple TV \u6216\u8005 HomePod\uff0c\u5931\u53bb\u4e86\u4e2d\u67a2\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u80fd\u4f1a\u6253\u6298\u6263\u3002</p> <p>\u540e\u7eed\u60f3\u4e70\u4e00\u4e9b\u667a\u80fd\u7684\u706f\u554a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7528 Siri \u8fdb\u884c\u6253\u5f00 / \u5173\u95ed\u4e86\u3002</p> <p>\u6b64\u5916\uff0c\u6211\u53c8\u8bd5\u4e86\u4e0b\uff0c\u53ef\u4ee5\u7528 homebridge-camera-ffmpeg \u628a\u6444\u50cf\u5934\u914d\u7f6e\u5230 HomeKit \u4e2d\u3002\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u8fdc\u7a0b\u67e5\u770b\u89c6\u9891\u6d41\u4e86\u3002</p>","tags":["homebridge","xiaomi","airpurifier","homekit"]},{"location":"software/2018/09/13/migrate-mongodb-on-ubuntu/","title":"\u5728 Ubuntu \u4e0a\u8de8\u7248\u672c\u8fc1\u79fb MongoDB","text":"<p>\u7531\u4e8e MongoDB \u53ea\u652f\u6301\u5f53\u524d\u7248\u672c\u548c\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\u5e93\u683c\u5f0f\uff0c\u7136\u540e\u521a\u521a\u6eda\u7cfb\u7edf\u5347\u7ea7\u7684\u65f6\u5019\u5347\u7ea7\u5230\u4e86 3.6.x\uff0c\u800c\u6570\u636e\u5e93\u683c\u5f0f\u4ecd\u7136\u662f 3.2.x \u7684\uff0c\u4e8e\u662f\u9700\u8981\u5148\u5b89\u88c5\u56de 3.4.x \u7248\u672c\u7684 MongoDB\uff0c\u8f93\u5165\u547d\u4ee4\u628a\u6570\u636e\u5e93\u5347\u7ea7\u5230 3.4.x \u7248\u672c\u540e\uff0c\u518d\u7528 3.6.x \u7684\u6570\u636e\u5e93\u8fdb\u884c\u5347\u7ea7\u3002</p> <p>\u4ee5 \u4ece Ubuntu 14.04 LTS \u5347\u7ea7\u5230 Ubuntu 18.04.1 LTS \u4e3a\u4f8b\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1604-3.4.17.tgz\n$ tar xvf mongodb-linux-x86_64-ubuntu1604-3.4.17.tgz\n$ cd mongodb-linux-x86_64-ubuntu1604-3.4.17/bin/\n$ sudo ./mongod --config /etc/mongodb.conf &amp;\n$ mongo\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: '3.4' } )\n{ \"ok\" : 1 }\n$ fg\n^C\n$ sudo chown -R mongodb:mongodb /var/lib/mongodb\n$ sudo systemctl start mongodb\n$ mongo\n&gt; db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )\n{ \"featureCompatibilityVersion\" : { \"version\" : \"3.4\" }, \"ok\" : 1 }\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: '3.6' } )\n{ \"ok\" : 1 }\n&gt; db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )\n{ \"featureCompatibilityVersion\" : { \"version\" : \"3.6\" }, \"ok\" : 1 }\n$ # Okay now\n</code></pre>","tags":["mongodb","ubuntu"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/","title":"mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9","text":"","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>mkdocs-material \u652f\u6301 Instant Navigation\uff1a\u542f\u7528\u4e86\u4ee5\u540e\uff0c\u5728\u7f51\u9875\u91cc\u70b9\u51fb\u5176\u4ed6\u9875\u9762\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u7528\u7c7b\u4f3c SPA \u7684\u65b9\u6cd5\uff0c\u53bb fetch \u65b0\u7684\u7f51\u9875\uff0c\u7136\u540e\u539f\u5730\u66ff\u6362\uff0c\u800c\u4e0d\u662f\u8ba9\u6d4f\u89c8\u5668\u8df3\u8f6c\u8fc7\u53bb\uff0c\u53ef\u4ee5\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002</p> <p>\u4f46\u662f\u5728\u7528\u8fd9\u4e2a\u529f\u80fd\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u73b0\u5176\u5b9e\u5e76\u4e0d\u662f\u90a3\u4e48\u7b80\u5355\u3002\u3002\u3002</p>","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/#sitemap","title":"Sitemap","text":"<p>\u4f7f\u7528 Instant Navigation \u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff1a\u672c\u5730 <code>mkdocs serve</code> \u7684\u65f6\u5019\u53ef\u4ee5\u5de5\u4f5c\uff0c\u800c\u7ebf\u4e0a <code>mkdocs build</code> \u518d\u7528 nginx \u90e8\u7f72\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u5de5\u4f5c\u4e86\uff0c\u8fd9\u662f\u4e3a\u5565\u5462\uff1f</p> <p>\u9605\u8bfb instant/index.ts \u6e90\u4ee3\u7801\uff0c\u53d1\u73b0\u5b83\u4f1a\u68c0\u67e5\u70b9\u51fb\u7684\u94fe\u63a5\u662f\u5426\u5728 sitemap \u4e2d\u51fa\u73b0\uff1a</p> <pre><code>        // Skip, if URL is not included in the sitemap - this could be the case\n        // when linking between versions or languages, or to another page that\n        // the author included as part of the build, but that is not managed by\n        // MkDocs. In that case we must not continue with instant navigation.\n        if (!sitemap.includes(`${url}`))\n          return EMPTY\n</code></pre> <p>\u4f46\u662f\u89c2\u5bdf\u4e86\u4e00\u4e0b\u751f\u6210\u7684 <code>site</code> \u76ee\u5f55\uff0c\u53d1\u73b0\u4e0b\u9762\u7684 sitemap.xml \u662f\u7a7a\u7684\u3002\u67e5\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u9700\u8981\u914d\u7f6e <code>site_url</code> \u624d\u4f1a\u751f\u6210 sitemap.xml \u7684\u5185\u5bb9\u3002\u8fd9\u4e5f\u53ef\u4ee5\u7406\u89e3\uff0c\u6bd5\u7adf sitemap.xml \u91cc\u9762\u5199\u5f97\u662f\u7edd\u5bf9 URL\u3002</p> <p>\u6dfb\u52a0 <code>site_url</code> \u4ee5\u540e\uff0c\u7ec8\u4e8e\u751f\u6210\u4e86 sitemap\uff0c\u4f46\u662f instant navigation \u4f9d\u7136\u4e0d\u5de5\u4f5c\uff1a\u7528 Chrome Developer Tools \u8c03\u8bd5\uff0c\u53d1\u73b0\u4ee3\u7801\u8bfb\u53d6\u51fa\u6765\u7684 sitemap \u4f9d\u7136\u4e3a\u7a7a\u3002\u9605\u8bfb\u4ee3\u7801\uff0c\u53d1\u73b0\uff1a</p> <pre><code>  const cached = __md_get&lt;Sitemap&gt;(\"__sitemap\", sessionStorage, base)\n  if (cached) {\n    return of(cached)\n  } else {\n    const config = configuration()\n    return requestXML(new URL(\"sitemap.xml\", base || config.base))\n      .pipe(\n        map(sitemap =&gt; preprocess(getElements(\"loc\", sitemap)\n          .map(node =&gt; node.textContent!)\n        )),\n        catchError(() =&gt; EMPTY), // @todo refactor instant loading\n        defaultIfEmpty([]),\n        tap(sitemap =&gt; __md_set(\"__sitemap\", sitemap, sessionStorage, base))\n      )\n  }\n</code></pre> <p>\u4ee3\u7801\u91cc\u7f13\u5b58\u4e86 sitemap \u7684\u5185\u5bb9\u5230 session storage \u4e2d\uff0c\u8fdb\u5165 developer tools\uff0c\u4ece session storage \u4e2d\u5220\u6389 sitemap\uff0c\u5c31\u53ef\u4ee5\u53d1\u73b0\u5b83\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684 sitemap\uff0cinstant navigation \u4e5f\u5de5\u4f5c\u4e86\u3002</p>","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/#wavedrom","title":"Wavedrom","text":"<p>Instant Navigation \u867d\u7136\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u70b9\u51fb\u7528\u4e86 WaveDrom \u7684\u7f51\u9875\u540e\uff0c\u4f1a\u53d1\u73b0\u91cc\u9762\u7684 WaveDrom \u4ee3\u7801\u6ca1\u6709\u88ab\u6e32\u67d3\u51fa\u6765\uff0c\u5e76\u4e14 Developer Tools \u4f1a\u62a5\u9519\u3002</p> <p>\u9605\u8bfb\u4ee3\u7801\uff0c\u53d1\u73b0 Instant Navigation \u4f1a\u91cd\u65b0\u8fd0\u884c\u65b0\u9875\u9762\u4e0a\u5185\u5d4c\u7684 <code>&lt;script&gt;</code> \u6807\u7b7e\uff0c\u7136\u800c WaveDrom \u4e5f\u6b63\u597d\u4f1a\u4f7f\u7528 <code>&lt;script&gt;</code> \u6807\u7b7e\u6765\u5199\u5b83\u7684 WaveJSON \u914d\u7f6e\uff0c\u53ea\u4e0d\u8fc7\u662f <code>&lt;script type=\"WaveDrom\"&gt;</code>\uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u6d4f\u89c8\u5668\u6267\u884c\u3002</p> <p>\u7136\u800c Instant Navigation \u91cd\u65b0\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u8003\u8651\u5230\u8fd9\u79cd\u60c5\u51b5\uff1a</p> <pre><code>              const script = next.createElement(\"script\")\n              // ...\n              script.textContent = el.textContent\n              el.replaceWith(script)\n</code></pre> <p>\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 <code>&lt;script&gt;</code> tag\uff0c\u4ece\u65e7\u7684\u590d\u5236\u4e86 textContent\uff0c\u4f46\u662f\u6ca1\u6709\u590d\u5236 type\u3002\u56e0\u6b64\u6d4f\u89c8\u5668\u4f1a\u628a\u5185\u5bb9\u5f53\u6210 JavaScript \u53bb\u6267\u884c\uff0c\u81ea\u7136\u5c31\u5931\u8d25\u4e86\u3002</p> <p>\u8fd9\u65f6\u5019\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u6709\u4ee5\u4e0b\u51e0\u79cd\u89e3\u51b3\u529e\u6cd5\uff1a</p> <ol> <li>\u4fee\u6539 mkdocs-material \u4ee3\u7801\uff0c\u8ba9\u5b83\u628a type \u5b57\u6bb5\u4e5f\u7ee7\u627f\u4e0b\u6765</li> <li>\u8ba9 wavedrom \u7528\u5176\u4ed6 tag\uff0c\u56e0\u4e3a wavedrom \u53ea\u4f1a\u68c0\u67e5 type \u662f\u5426\u7b49\u4e8e wavedrom\uff0c\u4e0d\u4f1a\u68c0\u67e5\u662f\u4ec0\u4e48 tag</li> <li>\u63d0\u524d\u6e32\u67d3 wavedrom \u5230 svg\uff0c\u76f4\u63a5\u5185\u5d4c svg</li> </ol> <p>\u6700\u540e\u5728\u81ea\u5df1 fork \u7684 mkdocs-wavedrom-plugin \u4e2d\u7528\u4e86\u7b2c\u4e09\u79cd\u65b9\u6cd5\u3002\u5982\u679c\u8bfb\u8005\u6709\u5174\u8da3\uff0c\u53ef\u4ee5\u7ed9 mkdocs-material \u63d0\u4ea4 pr\u3002</p> <p>\u6b64\u5916\uff0c\u524d\u4e24\u79cd\u65b9\u6cd5\u8fd8\u9700\u8981\u4fee\u6539 WaveDrom.ProcessAll \u7684\u8c03\u7528\u65b9\u6cd5\uff1a\u6a21\u4eff mkdocs-material \u7684 MathJax \u6e32\u67d3\u65b9\u6cd5\uff0c\u53bb\u8c03\u7528 <code>document$.subscribe</code>\uff1a</p> <pre><code>document$.subscribe(() =&gt; {\n  WaveDrom.ProcessAll();\n})\n</code></pre> <p>\u8fd9\u6837 Instant Navigation \u5728\u201c\u91cd\u65b0\u52a0\u8f7d\u201d\u9875\u9762\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u91cd\u65b0\u8c03\u7528 <code>WaveDrom.ProcessAll</code>\u3002</p>","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/#math","title":"Math","text":"<p>\u548c WaveDrom \u7c7b\u4f3c\uff0cArithmatex \u6269\u5c55\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e5f\u4f1a\u7ed9\u6570\u5b66\u516c\u5f0f\u751f\u6210 <code>&lt;script&gt;</code> tag\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u662f MathJax \u7684\u65e7\u683c\u5f0f\uff1a</p> <pre><code>&lt;script type=\"math/tex\"&gt;\n  1234\n&lt;/script&gt;\n</code></pre> <p>\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\u5728\u6bd4\u8f83\u65b0\u7684 mkdocs-material \u6587\u6863\u91cc\u5df2\u7ecf\u7ed9\u51fa\uff1a</p> <pre><code># in mkdocs.yaml\nmarkdown_extensions:\n  - pymdownx.arithmatex:\n      generic: true\n\nextra_javascript:\n  - javascripts/mathjax.js\n  - https://polyfill.io/v3/polyfill.min.js?features=es6\n  - https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\n</code></pre> <pre><code>// in docs/javascripts/mathjax.js\nwindow.MathJax = {\n  tex: {\n    inlineMath: [[\"\\\\(\", \"\\\\)\"]],\n    displayMath: [[\"\\\\[\", \"\\\\]\"]],\n    processEscapes: true,\n    processEnvironments: true\n  },\n  options: {\n    ignoreHtmlClass: \".*|\",\n    processHtmlClass: \"arithmatex\"\n  }\n};\n\ndocument$.subscribe(() =&gt; {\n  MathJax.typesetPromise()\n})\n</code></pre> <p>\u6ce8\u610f\u5230\u719f\u6089\u7684 <code>document$</code>\uff0c\u8fd9\u4e5f\u662f\u5b83\u53ef\u4ee5\u5728 Instant Navigation \u4e0b\u6b63\u5e38\u5de5\u4f5c\u7684\u539f\u56e0\u3002</p>","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2023/11/26/mkdocs-material-instant-navigation/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u8ba9 mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5de5\u4f5c\uff0c\u4f60\u9700\u8981\u4fdd\u8bc1\uff1a</p> <ol> <li>\u8bbe\u7f6e site_url\uff0c\u4fdd\u8bc1 sitemap \u6b63\u5e38\u751f\u6210</li> <li>\u4fdd\u8bc1\u4ee3\u7801\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u975e javascript \u7684 <code>&lt;script&gt;</code> tag\uff0c\u5982 wavedrom \u548c math/tex</li> <li>\u5982\u679c\u6d89\u53ca\u5230\u9700\u8981\u7528 javascript \u52a8\u6001\u6e32\u67d3\u7684\u5185\u5bb9\uff0c\u9700\u8981\u5728 <code>document$</code> \u4e0a\u6ce8\u518c\u56de\u8c03\u4ee5\u91cd\u65b0\u6e32\u67d3\u65b0\u9875\u9762</li> </ol>","tags":["mkdocs","mkdocsmaterial","markdown","instant","spa"]},{"location":"software/2021/07/16/nginx-post-internal-server-error/","title":"Nginx \u5904\u7406 POST \u8bf7\u6c42\u51fa\u73b0 Internal Server Error \u6392\u67e5\u4e00\u5219","text":"","tags":["nginx","http","post","disk"]},{"location":"software/2021/07/16/nginx-post-internal-server-error/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u6700\u8fd1\u4e00\u4e2a\u670d\u52a1\u5ffd\u7136\u51fa\u73b0\u95ee\u9898\uff0c\u7528\u6237\u53cd\u9988\uff0cHTTP POST \u4e00\u4e2a\u5c0f\u7684 body \u4e0d\u4f1a\u51fa\u9519\uff0cPOST \u4e00\u4e2a\u5927\u7684 body \u5c31\u4f1a 500 Internal Server Error\u3002</p>","tags":["nginx","http","post","disk"]},{"location":"software/2021/07/16/nginx-post-internal-server-error/#\u6392\u67e5","title":"\u6392\u67e5","text":"<p>\u89c2\u5bdf\u540e\u7aef\u65e5\u5fd7\uff0c\u53d1\u73b0\u6ca1\u6709\u51fa\u9519\u7684\u90a3\u4e00\u4e2a\u8bf7\u6c42\u3002\u89c2\u5bdf Nginx \u65e5\u5fd7\uff0c\u53d1\u73b0\u6700\u540e\u4e00\u6b21\u65e5\u5fd7\u662f\u51e0\u4e2a\u5c0f\u65f6\u524d\u3002\u6700\u540e\u51e0\u6761 Nginx \u65e5\u5fd7\u5199\u7684\u662f <code>a client request body is buffered to a temporary file</code>\u3002</p>","tags":["nginx","http","post","disk"]},{"location":"software/2021/07/16/nginx-post-internal-server-error/#\u7ed3\u8bba","title":"\u7ed3\u8bba","text":"<p>\u7ee7\u7eed\u7814\u7a76\u540e\uff0c\u53d1\u73b0\u662f\u786c\u76d8\u6ee1\u4e86\u3002Nginx \u5728\u5904\u7406 POST body \u7684\u65f6\u5019\uff0c\u5982\u679c body \u8d85\u8fc7\u9608\u503c\uff0c\u4f1a\u5199\u5165\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>Syntax: client_body_buffer_size size;\nDefault: client_body_buffer_size 8k|16k;\nContext: http, server, location\nSets buffer size for reading client request body. In case the request body is larger than the buffer, the whole body or only its part is written to a temporary file. By default, buffer size is equal to two memory pages. This is 8K on x86, other 32-bit platforms, and x86-64. It is usually 16K on other 64-bit platforms.\n</code></pre> <p>\u8be6\u89c1 https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_buffer_size</p> <p>\u8fd9\u5c31\u53ef\u4ee5\u89e3\u91ca\u4e3a\u4ec0\u4e48 Nginx \u8fd4\u56de 500 \u800c\u4e14\u6ca1\u6709\u8f6c\u53d1\u5230\u540e\u7aef\uff0c\u4e5f\u53ef\u4ee5\u89e3\u91ca\u4e3a\u4ec0\u4e48 Nginx \u6ca1\u6709\u8f93\u51fa\u65b0\u7684\u9519\u8bef\u65e5\u5fd7\u3002</p>","tags":["nginx","http","post","disk"]},{"location":"software/2022/06/07/nix-cookbook/","title":"Nix Cookbook","text":"","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5c1d\u8bd5 NixOS \u548c\u5728 macOS \u4e0a\u8dd1 Nix\uff0c\u4e0b\u9762\u8bb0\u5f55\u4e00\u4e9b\u6211\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u4e00\u4e9b\u5c0f\u95ee\u9898\u548c\u89e3\u51b3\u601d\u8def\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#nixos","title":"NixOS","text":"","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u5168\u5c40\u914d\u7f6e","title":"\u5168\u5c40\u914d\u7f6e","text":"<p>NixOS \u7684\u5168\u5c40\u914d\u7f6e\u8def\u5f84\uff1a<code>/etc/nixos/configuration.nix</code> \u548c <code>/etc/nixos/hardware-configuration.nix</code></p> <p>\u5e94\u7528\u66f4\u65b0\u540e\u7684\u5168\u5c40\u914d\u7f6e\uff1a</p> <pre><code>nixos-rebuild switch\n# or\nnixos-rebuild switch --upgrade\n</code></pre> <p>\u5e94\u7528 Flakes \u914d\u7f6e\u6587\u4ef6\u5e76\u663e\u793a\u53d8\u5316\uff1a</p> <pre><code>#!/usr/bin/env python3\nimport os\n\nuser = os.getenv(\"USER\")\nhome = f\"/nix/var/nix/profiles/\"\nold = home + os.readlink(f\"{home}system\")\nos.system(\"sudo nixos-rebuild switch --flake .\")\nnew = home + os.readlink(f\"{home}system\")\nos.system(f\"nix store diff-closures {old} {new}\")\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u66f4\u65b0\u5927\u7248\u672c","title":"\u66f4\u65b0\u5927\u7248\u672c","text":"<p>\u5982\u679c\u8981\u66f4\u65b0 NixOS 21.11 \u5230 22.05:</p> <pre><code>nix-channel --list\nnix-channel --add https://nixos.org/channels/nixos-22.05 nixos\nnixos-rebuild switch --upgrade\n</code></pre> <p>\u53ef\u4ee5\u8003\u8651\u6539\u6216\u8005\u4e0d\u6539 <code>/etc/nixos/configuration.nix</code> \u4e2d\u7684 <code>system.stateVersion</code>\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u5e38\u7528\u914d\u7f6e","title":"\u5e38\u7528\u914d\u7f6e","text":"<p>\u5e38\u7528\u7684 NixOS \u914d\u7f6e\uff1a</p> <pre><code># Enable XFCE\nservices.xserver.enable = true;\nservices.xserver.desktopManager.xfce.enable = true;\n\n# System wide packages\nenvironment.systemPackages = with pkgs; [\n  xxx\n];\n\n# Fish shell\nprograms.fish.enable = true;\nusers.users.xxx = {\n  shell = pkgs.fish;\n}\n\n# Command not found\nprograms.command-not-found.enable = true;\n\n# Steam gaming\nnixpkgs.config.allowUnfree = true;\nprograms.steam.enable = true;\n\n# NOPASSWD for sudo\nsecurity.sudo.wheelNeedsPassword = false;\n\n# QEMU guest\nservices.qemuGuest.enable = true;\nservices.spice-vdagentd.enable = true;\n\n# XRDP\nservices.xrdp.enable = true;\nservices.xrdp.defaultWindowManager = \"xfce4-session\";\nservices.xrdp.openFirewall = true;\n\n# OpenSSH server\nservices.openssh.enable = true;\n\n# Udev rules for Altera USB Blaster\nservices.udev.packages = with pkgs; [\n  usb-blaster-udev-rules\n];\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#vscode-remote","title":"VSCode Remote","text":"<p>VSCode Remote \u4f1a\u5728\u8fdc\u7a0b\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u4e00\u4e2a\u9884\u7f16\u8bd1\u7684 nodejs\uff0c\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u56e0\u4e3a\u8def\u5f84\u95ee\u9898\u65e0\u6cd5\u6267\u884c\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u5728 NixOS Wiki \u4e0a\u6709\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u9996\u5148\uff0c\u9700\u8981\u5b89\u88c5 <code>nodejs</code>\uff1a</p> <pre><code>environment.systemPackages = with pkgs; [\n  nodejs-16_x # vscode remote\n];\n</code></pre> <p>\u7136\u540e\uff0c\u7528\u8f6f\u94fe\u63a5\u6765\u8986\u76d6 nodejs\uff1a</p> <pre><code>cd ~/.vscode-server/bin/HASH\nln -sf /run/current-system/sw/bin/node\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528 VSCode Remote \u4e86\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#home-manager","title":"Home Manager","text":"<p>Home Manager \u63cf\u8ff0\u7528\u6237\u9ed8\u8ba4\u770b\u5230\u7684\u7a0b\u5e8f\uff0c\u800c NixOS \u7684\u914d\u7f6e\u662f\u6240\u6709\u7528\u6237\u7684\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u914d\u7f6e\u6587\u4ef6\uff1a<code>~/.config/nixpkgs/home.nix</code></p> <p>\u5e94\u7528\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>home-manager switch\n</code></pre> <p>\u5e94\u7528 Flakes \u914d\u7f6e\u6587\u4ef6\u5e76\u663e\u793a\u53d8\u5316\uff1a</p> <pre><code>#!/usr/bin/env python3\nimport os\n\nuser = os.getenv(\"USER\")\nhome = f\"/nix/var/nix/profiles/per-user/{user}/\"\nold = home + os.readlink(f\"{home}profile\")\nos.system(\"home-manager switch --flake .\")\nnew = home + os.readlink(f\"{home}profile\")\nos.system(f\"nix store diff-closures {old} {new}\")\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u5e38\u7528\u914d\u7f6e_1","title":"\u5e38\u7528\u914d\u7f6e","text":"<p>\u5e38\u7528\u7684 Home Manager \u914d\u7f6e\uff1a</p> <pre><code># Allow unfree\nnixpkgs.config.allowUnfree = true;\nnixpkgs.config.allowUnfreePredicate = (pkg: true);\n\n# User wide packages\nhome.packages = with pkgs; [\n  xxx\n];\n</code></pre> <p>\u751f\u6210 Nix \u914d\u7f6e <code>~/.config/nix/nix.conf</code>\uff1a</p> <pre><code># Enable flakes &amp; setup TUNA mirror\nnix.package = pkgs.nix;\nnix.settings = {\n  experimental-features = [ \"nix-command\" \"flakes\" ];\n  substituters = [ \"https://mirrors.tuna.tsinghua.edu.cn/nix-channels/store\" \"https://cache.nixos.org/\"];\n};\n</code></pre> <p>Shell \u73af\u5883\u53d8\u91cf\u548c PATH\uff1a</p> <pre><code>home.sessionVariables = {\n  A = \"B\";\n};\nhome.sessionPath = [\n  \"$HOME/.local/bin\"\n];\n</code></pre> <p>\u79bb\u7ebf Home Manager \u6587\u6863\uff08\u7528 <code>home-manager-help</code> \u547d\u4ee4\u6253\u5f00\uff09\uff1a</p> <pre><code>manual.html.enable = true;\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u8986\u76d6\u4f9d\u8d56\u7248\u672c","title":"\u8986\u76d6\u4f9d\u8d56\u7248\u672c","text":"<p>\u8bbe\u7f6e JVM \u7a0b\u5e8f\u4f9d\u8d56\u7684 JDK \u7248\u672c\uff1a</p> <pre><code># Maven with java 11\nhome.packages = with pkgs; [\n  (maven.override { jdk = jdk11; })\n];\n\n# Many packages with the same JDK\nhome.packages = \n  let java = pkgs.jdk11; in\n  with pkgs; [\n    (maven.override { jdk = java; })\n    (sbt.override { jre = java; })\n  ];\n</code></pre> <p>\u5177\u4f53\u7684\u53c2\u6570\u547d\u540d\u8981\u770b nixpkgs \u4e0a\u5bf9\u5e94\u7684\u5305\u7684\u5f00\u5934\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u914d\u7f6e-direnv","title":"\u914d\u7f6e direnv","text":"<p>direnv \u662f\u4e00\u4e2a shell \u63d2\u4ef6\uff0c\u5b83\u7684\u7528\u9014\u662f\u8fdb\u5165\u76ee\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e .envrc \u6765\u6267\u884c\u547d\u4ee4\uff0c\u6bd4\u5982\u81ea\u52a8\u8fdb\u5165 nix-shell \u7b49\u3002\u914d\u7f6e\uff1a</p> <pre><code>programs.direnv.enable = true;\n</code></pre> <p>\u7136\u540e\u5728\u5de5\u7a0b\u8def\u5f84\u4e0b\uff0c\u7f16\u5199 <code>.envrc</code>\uff1a</p> <pre><code>use_nix\n</code></pre> <p>\u90a3\u4e48\uff0c\u5728 shell \u8fdb\u5165\u76ee\u5f55\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u81ea\u52a8\u83b7\u5f97 nix-shell \u7684\u73af\u5883\u53d8\u91cf\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u914d\u7f6e-fish","title":"\u914d\u7f6e fish","text":"<p>\u53ef\u4ee5\u5728 home manager \u914d\u7f6e\u4e2d\u7f16\u5199 fish \u914d\u7f6e\uff0c\u8fd9\u6837\u5b83\u4f1a\u81ea\u52a8\u751f\u6210 <code>~/.config/fish/config.fish</code> \u6587\u4ef6\uff1a</p> <pre><code>programs.fish.enable = true;\nprograms.fish.shellAliases = {\n  a = \"b\";\n};\nprograms.fish.shellInit = ''\n  # Rust\n  set -x PATH ~/.cargo/bin $PATH\n'';\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u914d\u7f6e-git","title":"\u914d\u7f6e git","text":"<p>\u540c\u7406\uff0c\u4e5f\u53ef\u4ee5\u5728 home manager \u4e2d\u914d\u7f6e git\uff1a</p> <pre><code>programs.git.enable = true;\nprograms.git.lfs.enable = true;\nprograms.git.userName = \"Someone\";\nprograms.git.userEmail = \"mail@example.com\";\nprograms.git.extraConfig = {\n  core = {\n    quotepath = false;\n  };\n  pull = {\n    rebase = false;\n  };\n};\nprograms.git.ignores = [\n  \".DS_Store\"\n];\n</code></pre> <p>\u751f\u6210\u7684 <code>git</code> \u914d\u7f6e\u5728 <code>~/.config/git/config</code> \u548c <code>~/.config/git/ignore</code>\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#flakes","title":"Flakes","text":"<p>Flakes \u53ef\u4ee5\u7528\u6765\u628a\u591a\u4e2a\u7cfb\u7edf\u7684 nix \u914d\u7f6e\u5199\u5728\u4e00\u4e2a\u9879\u76ee\u4e2d\u3002\u4f8b\u5982\uff1a</p> <pre><code>{\n  description = \"Nix configuration\";\n\n  inputs = {\n    home-manager.url = \"github:nix-community/home-manager/release-22.05\";\n    nixpkgs.url = \"github:nixos/nixpkgs/nixos-22.05\";\n  };\n\n  outputs = { self, nixpkgs, home-manager }:\n    {\n      nixosConfigurations.xxxx = nixpkgs.lib.nixosSystem {\n        system = \"x86_64-linux\";\n        modules = [\n          ./nixos/xxxx/configuration.nix\n          home-manager.nixosModules.home-manager\n          ./nixos/xxxx/home.nix\n        ];\n      };\n      homeConfigurations.yyyy = home-manager.lib.homeManagerConfiguration {\n        configuration = import ./home-manager/yyyy/home.nix;\n        system = \"aarch64-darwin\";\n        homeDirectory = \"/Users/yyyy\";\n        username = \"yyyy\";\n        stateVersion = \"22.05\";\n      };\n    };\n}\n</code></pre> <p>\u7136\u540e\uff0c\u8981\u5e94\u7528\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u8fd0\u884c\uff1a</p> <pre><code># NixOS\nnixos-rebuild switch --flake .\n# Home manager\nhome-manager switch --flake .\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u82e5\u5e72\u4e2a\u7cfb\u7edf\u4e0a\u7684 nix \u914d\u7f6e\u7ba1\u7406\u5728\u4e00\u4e2a\u4ed3\u5e93\u4e2d\u4e86\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u5b9e\u7528\u5de5\u5177","title":"\u5b9e\u7528\u5de5\u5177","text":"","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#nixpkgs-fmt","title":"nixpkgs-fmt","text":"<p>nixpkgs-fmt \u7528\u6765\u683c\u5f0f\u5316 Nix \u4ee3\u7801\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#searchnixosorg","title":"search.nixos.org","text":"<p>search.nixos.org \u53ef\u4ee5\u641c\u7d22 nixpkgs \u4e0a\u7684\u5404\u79cd\u5305\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230\u4e0d\u540c\u5e73\u53f0\u652f\u6301\u60c5\u51b5\u3002\u7f3a\u70b9\u662f\u770b\u4e0d\u51fa\u662f\u5426 unfree \u548c broken\uff0c\u5e76\u4e14\u4e00\u4e9b darwin os-specific \u7684\u5305\u4e0d\u4f1a\u663e\u793a\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#nix-tree","title":"nix-tree","text":"<p>\u663e\u793a\u5404\u4e2a nix derivation \u7684\u786c\u76d8\u5360\u7528\u548c\u4f9d\u8d56\u5173\u7cfb\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u6253\u5305","title":"\u6253\u5305","text":"<p>\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u7f16\u5199 <code>default.nix</code> \u6765\u7ed9\u81ea\u5df1\u7684\u9879\u76ee\u6253\u5305\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#cmake","title":"CMake","text":"<p>\u5bf9\u4e8e\u4e00\u4e2a\u7b80\u5355\u7684 cmake \u7a0b\u5e8f\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u7684\u683c\u5f0f\u7f16\u5199 <code>default.nix</code>\uff1a</p> <pre><code>with import &lt;nixpkgs&gt; {};\n\nstdenv.mkDerivation {\n  name = \"xyz\";\n  version = \"1.0\";\n\n  src = ./.;\n\n  nativeBuildInputs = [\n    cmake\n  ];\n\n  buildInputs = [\n    xxx\n    yyy\n  ];\n}\n</code></pre> <p>\u53ef\u4ee5\u7528 <code>nix-build</code> \u547d\u4ee4\u6765\u6784\u5efa\uff0c\u751f\u6210\u7ed3\u679c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a <code>result</code> \u7684\u8f6f\u94fe\u63a5\uff0c\u91cc\u9762\u5c31\u662f\u5b89\u88c5\u76ee\u5f55\u3002</p> <p>\u7531\u4e8e <code>nix-build</code> \u7684\u65f6\u5019\u4e5f\u4f1a\u521b\u5efa <code>build</code> \u76ee\u5f55\uff0c\u4e3a\u4e86\u9632\u6b62\u51b2\u7a81\uff0c\u5efa\u8bae\u5f00\u53d1\u7684\u65f6\u5019\u7528\u5176\u4ed6\u7684\u540d\u5b57\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#qt","title":"Qt","text":"<p>\u5bf9\u4e8e Qt \u9879\u76ee\u6765\u8bf4\uff0c\u7531\u4e8e\u6709\u4e0d\u540c\u7684 Qt \u5927\u7248\u672c\uff0c\u6240\u4ee5\u5b9e\u73b0\u7684\u65f6\u5019\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b\uff0c\u8981\u62c6\u6210\u4e24\u4e2a\u6587\u4ef6\uff0c\u9996\u5148\u662f <code>default.nix</code>\uff1a</p> <pre><code>with import &lt;nixpkgs&gt; {};\n\nlibsForQt5.callPackage ./xxx.nix { }\n</code></pre> <p>\u8fd9\u91cc\u5c31\u8868\u793a\u7528 <code>qt5</code> \u6765\u7f16\u8bd1\uff0c\u90a3\u4e48\u7f16\u5199 <code>xxx.nix</code> \u7684\u65f6\u5019\uff0c\u4f20\u5165\u7684 <code>qtbase</code> \u7b49\u5e93\u5c31\u662f <code>qt5</code> \u7684\u7248\u672c\uff1a</p> <pre><code>{ stdenv, qtbase, wrapQtAppsHook, cmake }:\n\nstdenv.mkDerivation {\n  name = \"xxx\";\n  version = \"1.0\";\n\n  src = ./.;\n\n  nativeBuildInputs = [\n    cmake\n    wrapQtAppsHook # must-have for qt apps\n  ];\n\n  buildInputs = [\n    qtbase\n  ];\n}\n</code></pre> <p>\u5b9e\u9645\u6d4b\u8bd5\u4e2d\u53d1\u73b0\uff0c\u8fd0\u884c\u7684\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u62a5\u544a <code>Could not initialize GLX</code> \u7684\u9519\u8bef\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u901a\u8fc7 <code>wrapProgram</code> \u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u89e3\u51b3\uff1a</p> <pre><code>  # https://github.com/NixOS/nixpkgs/issues/66755#issuecomment-657305962\n  # Fix \"Could not initialize GLX\" error\n  postInstall = ''\n    wrapProgram \"$out/bin/xxx\" --set QT_XCB_GL_INTEGRATION none\n  '';\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u5f00\u53d1\u73af\u5883","title":"\u5f00\u53d1\u73af\u5883","text":"<p>\u9664\u4e86\u6253\u5305\u4ee5\u5916\uff0c\u901a\u5e38\u8fd8\u4f1a\u5728 <code>shell.nix</code> \u4e2d\u5b9a\u4e49\u5f00\u53d1\u73af\u5883\u9700\u8981\u7684\u5305\uff1a</p> <pre><code>{ pkgs ? import &lt;nixpkgs&gt; {}\n}:\n\npkgs.mkShell {\n  buildInputs = with pkgs; [\n    cmake\n  ];\n}\n</code></pre> <p>\u7136\u540e\u53ef\u4ee5\u7528 <code>nix-shell</code> \u6765\u8fdb\u5165\u5f00\u53d1\u73af\u5883\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u5916\u9762\u7684\u73af\u5883\u53d8\u91cf\u4f20\u9012\u8fdb\u53bb\uff0c\u53ef\u4ee5\u7528 <code>nix-shell --pure</code>\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u641c\u7d22","title":"\u641c\u7d22","text":"<p>\u6309\u540d\u5b57\u641c\u7d22\u4e00\u4e2a\u5305\uff1a</p> <pre><code>nix search nixpkgs xxx\nnix-env -qaP yyy\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#nixpkgs","title":"Nixpkgs","text":"<p>\u53ef\u4ee5\u4ece TUNA \u955c\u50cf\u4e0a\u5148 clone \u4e00\u4efd\u5230\u672c\u5730\uff0c\u7136\u540e\u518d\u6dfb\u52a0 github \u4e0a\u6e38\u4f5c\u4e3a remote\u3002</p> <p>\u4ece\u672c\u5730 nixpkgs \u5b89\u88c5\uff1a</p> <pre><code>nix-env -f $PWD -iA xxx\n</code></pre> <p>\u4ece\u672c\u5730 nixpkgs \u7f16\u8bd1\uff1a</p> <pre><code>nix-build $PWD -A xxx\n</code></pre> <p>\u4ece\u672c\u5730 nixpkgs \u5f00\u4e00\u4e2a shell\uff1a</p> <pre><code>nix-shell -I nixpkgs=$PWD -p xxx\n</code></pre>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#nixpkgs-\u7684\u5206\u652f","title":"Nixpkgs \u7684\u5206\u652f","text":"<p>Nixpkgs \u5f00\u53d1\u5206\u652f\u4e3b\u8981\u6709\u4e09\u4e2a\uff1a</p> <ol> <li>master</li> <li>staging-next</li> <li>staging</li> </ol> <p>\u53d1 PR \u7684\u65f6\u5019\uff0c\u5982\u679c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u7684\u5305\u6bd4\u8f83\u591a\uff0c\u5c31\u8981\u5f80 staging \u63d0\u4ea4\uff1b\u6bd4\u8f83\u5c11\uff0c\u5c31\u5f80 staging-next \u63d0\u4ea4\u3002</p> <p>CI \u4f1a\u81ea\u52a8\u628a master \u5408\u5e76\u5230 staging-next\uff0c\u4e5f\u4f1a\u628a staging-next \u5408\u5e76\u5230 staging\u3002\u8fd9\u6837 master \u4e0a\u7684\u6539\u52a8\u4e5f\u4f1a\u540c\u6b65\u5230 staging \u4e0a\u3002</p> <p>\u7ef4\u62a4\u8005\u4f1a\u5b9a\u4e49\u628a staging \u624b\u52a8\u5408\u5e76\u5230 staging-next\uff0c\u7136\u540e\u624b\u52a8\u5408\u5e76 staging-next \u5230 staging\u3002\u8fd9\u4e2a\u7684\u5468\u671f\u4e00\u822c\u662f\u4e00\u5468\u591a\uff0c\u53ef\u4ee5\u5728 pr \u91cc\u641c\u7d22 staging-next\u3002</p> <p>Hydra \u4f1a\u7f16\u8bd1 master \u5206\u652f\u548c staging-next \u5206\u652f\u4e0a\u7684\u5305\uff0c\u4e0d\u4f1a\u7f16\u8bd1 staging \u5206\u652f\u4e0a\u7684\u5305\u3002\u540c\u7406\uff0cbinary cache \u4e0a\u524d\u4e24\u4e2a\u5206\u652f\u4e0a\u6709\u7684\uff0c\u800c staging \u4e0a\u6ca1\u6709\u7684\u3002</p> <p>\u53c2\u8003\uff1ahttps://nixos.org/manual/nixpkgs/stable/#submitting-changes-commit-policy</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u63d0\u4ea4\u8d21\u732e","title":"\u63d0\u4ea4\u8d21\u732e","text":"<p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>\u5347\u7ea7\u4e00\u4e9b\u6bd4\u8f83\u8001\u7684\u5199\u6cd5\uff0c\u4f8b\u5982 mkDerivation -&gt; stdenv.mkDerivation\uff0cQt \u7684 hook</li> <li>\u5f15\u5165 patch \u7684\u65f6\u5019\uff0c\u5efa\u8bae\u5148\u5411\u4e0a\u6e38\u63d0 PR\uff0c\u5982\u679c\u5408\u5e76\u4e86\uff0c\u5c31\u76f4\u63a5\u7528\u4e0a\u6e38\u7684 commit\uff1b\u5982\u679c\u6ca1\u6709\u5408\u5e76\uff0c\u9000\u800c\u6c42\u5176\u6b21\u53ef\u4ee5\u7528 pr \u7684 patch\uff1b\u5982\u679c\u6ca1\u6709\u63d0 PR \u7684\u6e20\u9053\uff0c\u6216\u8005\u4e0a\u6e38\u7684 commit \u65e0\u6cd5\u5e94\u7528\u5230\u5f53\u524d\u7684\u7248\u672c\uff0c\u6216\u8005\u8fd9\u4e2a patch \u6ca1\u6709\u666e\u9002\u6027\uff0c\u518d\u5199\u672c\u5730\u7684 patch\uff1b\u6ce8\u91ca\u91cc\u8981\u5199\u6253 patch \u7684\u539f\u56e0\u548c\u76f8\u5173\u7684 issue \u94fe\u63a5\uff0c\u4ec0\u4e48\u65f6\u5019\u4e0d\u518d\u9700\u8981\u8fd9\u4e2a patch\uff0c\u5e76\u4e14\u8d77\u4e2a\u540d\u5b57</li> <li>\u4e0d\u77e5\u9053 SHA256 \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6ce8\u91ca\u6389\u6216\u8005\u968f\u4fbf\u5199\u4e00\u4e2a\uff0c\u8fd9\u6837 nix build \u7684\u65f6\u5019\u4f1a\u91cd\u65b0\u4e0b\u8f7d\uff0c\u7136\u540e\u628a\u6b63\u786e\u7684\u663e\u793a\u51fa\u6765</li> <li>\u5bf9\u4e8e\u6709\u547d\u4ee4\u7684\u5305\uff0c\u53ef\u4ee5\u6dfb\u52a0 testVersion \u6d4b\u8bd5</li> <li>\u957f\u65f6\u95f4\u6ca1\u6709 review \u7684 pr\uff0c\u53ef\u4ee5\u5728 discourse \u4e0a\u56de\u590d\u5e16\u5b50\u3002</li> <li>\u66f4\u65b0\u4e4b\u524d\uff0c\u53ef\u4ee5\u641c\u7d22\u4e00\u4e0b\uff0c\u6709\u6ca1\u6709\u76f8\u5173\u7684 issue \u6216\u8005 pr\uff1b\u5982\u679c\u6709 issue\uff0c\u65b0\u5efa pr \u7684\u65f6\u5019\u8981\u63d0\u4e00\u4e0b</li> </ol> <p>\u4e00\u4e9b\u5e38\u89c1\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u7f16\u8bd1\u5668\u6253\u5f00 <code>-fno-common</code> \u540e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u94fe\u63a5\u95ee\u9898</li> <li>Darwin \u4e0a\u7684 clang \u6ca1\u6709\u6253\u5f00 LTO\uff0c\u4e5f\u6ca1\u6709\u6253\u5f00 Universal \u652f\u6301</li> <li>AArch64 Darwin \u4e0a\u7684 gfortran \u7684 stack protector \u4e0d\u5de5\u4f5c\uff0c\u9700\u8981\u628a hardening \u5173\u6389</li> <li>\u5f53\u7f16\u8bd1\u62a5\u9519\u662f <code>-Werror</code> \u5bfc\u81f4\u7684\u65f6\u5019\uff0c\u6309\u7167 warning \u7c7b\u578b\u5728 NIX_CFLAGS_COMPILE \u4e2d\u6dfb\u52a0 <code>-Wno-error=warning-type</code></li> <li>configure \u7248\u672c\u8f83\u8001\uff0c\u9700\u8981\u5f15\u5165 autoreconfHook</li> </ol> <p>\u9605\u8bfb\u6587\u6863\uff1ahttps://github.com/NixOS/nixpkgs/blob/master/doc/contributing/quick-start.chapter.md \u548c https://github.com/NixOS/nixpkgs/blob/master/doc/contributing/coding-conventions.chapter.md</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#vscode","title":"VSCode","text":"<p>\u53ef\u4ee5\u5b89\u88c5 https://github.com/nix-community/vscode-nix-ide/ \u63d2\u4ef6\uff0c\u914d\u5408 <code>rnix-lsp</code> \u6765\u4f7f\u7528\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/06/07/nix-cookbook/#\u6742\u9879","title":"\u6742\u9879","text":"<p>\u53ef\u4ee5\u7528 <code>nix copy</code> \u547d\u4ee4\u5728\u4e0d\u540c\u673a\u5668\u7684 store \u4e4b\u95f4\u590d\u5236\u6587\u4ef6\uff0c\u89c1 nix copy - copy paths between Nix stores\u3002</p>","tags":["nix","nixos","cookbook"]},{"location":"software/2022/10/29/nix-on-ppc64le/","title":"\u5728 ppc64le Linux \u4e0a\u8fd0\u884c Nix","text":"","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2022/10/29/nix-on-ppc64le/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u5c1d\u8bd5\u8fc7\u5728 ppc64le \u7684\u673a\u5668\u4e0a\u8fd0\u884c Nix\uff0c\u5f53\u65f6\u7684\u5c1d\u8bd5\u662f\u628a\u4ee3\u7801\u514b\u9686\u4e0b\u6765\u7f16\u8bd1\uff0c\u6211\u8fd8\u5199\u4e86\u4e00\u4e2a Docker \u811a\u672c\uff1a</p> <pre><code># Based on https://github.com/NixOS/nix/issues/6048\n# Build nixos/nix from source\nFROM ubuntu:20.04\n\nRUN sed -i 's/ports.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list\nRUN apt-get update\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -y \\\n    autoconf-archive autoconf automake pkg-config build-essential git gcc g++ jq libboost-all-dev libcrypto++-dev libcurl4-openssl-dev \\\n    libssh-dev libarchive-dev libsqlite3-dev libbz2-dev wget liblzma-dev libbrotli-dev libseccomp-dev bison flex libsodium-dev libgc-dev \\\n    libgtest-dev libgmock-dev cmake unzip\n\n# Install editline - newer version required\nWORKDIR /root\nRUN wget https://github.com/troglobit/editline/releases/download/1.17.1/editline-1.17.1.tar.xz\nRUN tar xf editline-1.17.1.tar.xz\nWORKDIR /root/editline-1.17.1\nRUN ./configure --prefix=/usr\nRUN make all\nRUN make install\n\n# Install lowdown - not available via apt\nWORKDIR /root\nRUN wget https://github.com/kristapsdz/lowdown/archive/refs/tags/VERSION_0_10_0.tar.gz\nRUN tar xf VERSION_0_10_0.tar.gz\nWORKDIR /root/lowdown-VERSION_0_10_0\nRUN ./configure\nRUN make all\nRUN make install  \n\n# Install nlohmann_json - newer version required\nWORKDIR /root\nRUN wget https://github.com/nlohmann/json/archive/refs/tags/v3.10.5.tar.gz\nRUN tar xf v3.10.5.tar.gz\nWORKDIR /root/json-3.10.5\nRUN mkdir build\nWORKDIR /root/json-3.10.5/build\nRUN cmake .. &amp;&amp; make -j$(nproc)\nRUN make install\nWORKDIR /root\nRUN wget https://github.com/nlohmann/json/releases/download/v3.10.5/include.zip &amp;&amp; unzip include.zip\nRUN mv include/nlohmann/* /usr/local/include/nlohmann/\n\n# Compile &amp; build nix\nWORKDIR /root\nRUN git clone -b 2.8.1 https://github.com/NixOS/nix.git\nWORKDIR /root/nix\nRUN ./bootstrap.sh\nRUN ./configure\nRUN make -j$(nproc)\nRUN make install -k || true\n</code></pre> <p>\u4f46\u662f\u53d1\u73b0\u95ee\u9898\u5728\u4e8e\uff0c\u79bb\u5f00\u4e86 nix install \u811a\u672c\uff0c\u6211\u5e76\u4e0d\u77e5\u9053\u5982\u4f55\u914d\u7f6e\u4e00\u4e2a multi-user install\u3002\u4f46\u662f\u5b98\u65b9\u7684 nix install \u811a\u672c\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u6ca1\u6709 ppc64le \u7684 prebuilt tarball\u3002</p>","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2022/10/29/nix-on-ppc64le/#\u89e3\u51b3\u529e\u6cd5","title":"\u89e3\u51b3\u529e\u6cd5","text":"","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2022/10/29/nix-on-ppc64le/#binarytarballcross-\u65b9\u6cd5","title":"binaryTarballCross \u65b9\u6cd5","text":"<p>\u8be5\u65b9\u6cd5\u5b66\u81ea @NickCao\uff0c\u5728 NixOS/nix \u7684 flake \u4e2d\uff0c\u6709\u751f\u6210 tarball \u7684\u65b9\u6cd5\uff0c\u5982\uff1a</p> <pre><code>nix build \".#hydraJobs.binaryTarballCross.x86_64-linux.armv7l-linux\"\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 x86_64-linux \u7684 host \u4e0a\uff0c\u4ea4\u53c9\u7f16\u8bd1\u751f\u6210\u4e00\u4e2a\u7528\u4e8e armv7l-linux \u7684\u5b89\u88c5 tarball\u3002\u7c7b\u4f3c\u5730\uff0c\u53ef\u4ee5\u4fee\u6539 flake.nix \u6765\u52a0\u5165\u5176\u4ed6\u67b6\u6784\uff0c\u5982\uff1a</p> <pre><code>diff --git a/flake.nix b/flake.nix\nindex cc2a48d9c..c55a267e2 100644\n--- a/flake.nix\n+++ b/flake.nix\n@@ -21,7 +21,7 @@\n       linuxSystems = linux64BitSystems ++ [ \"i686-linux\" ];\n       systems = linuxSystems ++ [ \"x86_64-darwin\" \"aarch64-darwin\" ];\n\n-      crossSystems = [ \"armv6l-linux\" \"armv7l-linux\" ];\n+      crossSystems = [ \"armv6l-linux\" \"armv7l-linux\" \"powerpc64le-linux\" \"riscv64-linux\" ];\n\n       stdenvs = [ \"gccStdenv\" \"clangStdenv\" \"clang11Stdenv\" \"stdenv\" \"libcxxStdenv\" \"ccacheStdenv\" ];\n</code></pre> <p>\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u751f\u6210 riscv64-linux \u548c powerpc64le-linux \u67b6\u6784\u7684\u5b89\u88c5 tarball \u4e86\uff1a</p> <pre><code>nix build \".#hydraJobs.binaryTarballCross.x86_64-linux.powerpc64le-linux\"\nnix build \".#hydraJobs.binaryTarballCross.x86_64-linux.riscv64-linux\"\n</code></pre> <p>\u751f\u6210\u7684 tarball \u53ef\u4ee5\u5728 result \u4e2d\u627e\u5230\u3002</p>","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2022/10/29/nix-on-ppc64le/#\u624b\u52a8\u66ff\u6362\u6cd5","title":"\u624b\u52a8\u66ff\u6362\u6cd5","text":"<p>\u56e0\u6b64\uff0c\u6211\u5728\u7f51\u4e0a\u8fdb\u884c\u641c\u7d22\uff0c\u53d1\u73b0 Getting started with Nix on ppc64le \u4e2d\u6709\u4eba\u63d0\u5230\uff0c\u53ef\u4ee5\u5148\u5728 x86 \u7684\u673a\u5668\u4e0a\u4ea4\u53c9\u7f16\u8bd1\u51fa ppc64le \u7684 nix\uff0c\u7136\u540e\u628a nix tarball \u4e2d\u7684 x86 nix \u66ff\u6362\u6210 ppc64le \u7248\u672c\uff0c\u518d\u590d\u5236\u5230 ppc64le \u4e0a\u5b89\u88c5\uff0c\u5176\u4f59\u7684\u6b65\u9aa4\u5c31\u4e00\u6837\u4e86\u3002</p> <p>\u6211\u628a\u811a\u672c\u66f4\u65b0\u4e86\u4e00\u4e0b\uff0c\u9002\u914d\u4e86\u6700\u65b0\u7684 nix \u7248\u672c\uff0c\u6700\u540e\u5f97\u5230\u4e86\u5982\u4e0b\u7684\u811a\u672c\uff1a</p> <pre><code>#!/bin/sh\n# Based on https://discourse.nixos.org/t/getting-started-with-nix-on-ppc64le/12712/8?u=jiegec\nnix-build '&lt;nixpkgs&gt;' -A pkgsCross.powernv.nix\n\n# Get a donor copy of the installer\nwget -c https://releases.nixos.org/nix/nix-2.11.1/nix-2.11.1-x86_64-linux.tar.xz\ntar xf nix-2.11.1-x86_64-linux.tar.xz\n\n# Keep the cert package\nmkdir -p nix-ppc64le-linux/store\ncp -r nix-2.11.1-x86_64-linux/store/*nss-cacert* nix-ppc64le-linux/store/\n\n# Toss other packages, keep the scripts\nrm -rf nix-2.11.1-x86_64-linux/store\nmv nix-2.11.1-x86_64-linux/* nix-ppc64le-linux/\n\n# Add ppc64le packages\ncp -r $(nix-store -qR result) nix-ppc64le-linux/store/\n\n# Generate a .reginfo for those ppc64le packages\nnix-store --dump-db $(nix-store -qR result) &gt; nix-ppc64le-linux/.reginfo\n\n# Replace NIX_INSTALLED_NIX in install script\nexport NIX_INSTALLED_NIX=$(readlink result)\nsed -i \"s#NIX_INSTALLED_NIX=\\\".*\\\"#NIX_INSTALLED_NIX=\\\"$NIX_INSTALLED_NIX\\\"#\" nix-ppc64le-linux/install-multi-user\n\necho \"Done! Copy nix-ppc64le-linux to ppc64le machine and run ./install --daemon\"\n</code></pre> <p>\u628a\u751f\u6210\u7684\u76ee\u5f55\u590d\u5236\u5230 ppc64le \u673a\u5668\u4e0a\u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2022/10/29/nix-on-ppc64le/#\u7f16\u8bd1\u95ee\u9898","title":"\u7f16\u8bd1\u95ee\u9898","text":"<p>\u5f53\u7136\u4e86\uff0c\u65e2\u7136 ppc64le \u7684 Nixpkgs \u6ca1\u6709\u4ec0\u4e48\u4eba\u6d4b\u8bd5\uff0c\u6240\u4ee5\u80af\u5b9a\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898\u3002\u4e0b\u9762\u662f\u9047\u5230\u7684\u51e0\u4e2a\u6bd4\u8f83\u4e3b\u8981\u7684\u95ee\u9898\uff0c\u4ee5\u53ca\u76f8\u5e94\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ul> <li>boehm-gc checkPhase \u4f1a\u5931\u8d25\uff0c\u89c1 ivmai/bdwgc#376\uff0c\u4e00\u76f4\u6ca1\u6709\u4fee\u590d\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u6dfb\u52a0 overlay\uff0c\u8ba9\u5b83\u4e0d\u8981\u8dd1\u6d4b\u8bd5\uff1a</li> </ul> <pre><code>custom-overlay = final: prev: {\n  # https://github.com/ivmai/bdwgc/issues/376\n  boehmgc = prev.boehmgc.overrideAttrs (_: { doCheck = false; });\n};\n</code></pre> <p>UPDATE: \u5411 nixpkgs \u63d0\u4ea4\u4e86 pr: https://github.com/NixOS/nixpkgs/pull/198591</p> <p>\u53e6\u5916\u6839\u636e bdwgc \u7684 issue \u63d0\u793a\uff0c\u6dfb\u52a0\u4e0b\u5217\u7684\u9009\u9879\u53ef\u4ee5\u8ba9\u5b83\u6d4b\u8bd5\u901a\u8fc7\uff1a</p> <pre><code>makeFlags = [\"CFLAGS_EXTRA=\\\"-DNO_SOFT_VDB\\\"\"];\n</code></pre> <p>\u4f46\u662f issue \u4e5f\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5bf9\u4e8e Power9 \u4e0d\u5de5\u4f5c\u3002</p> <ul> <li>linux-headers \u7f16\u8bd1\u5931\u8d25\uff0c\u62a5\u544a unknown type name __vector128\uff0c\u89c1 tools/bpf: Compilation issue on powerpc: unknown type name '__vector128'  bpftools: add enableDebugger, set to false on Power64 (WIP)\u3002\u76ee\u524d\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u8ba9 procps/tmux \u7b49\u5305\u4e0d\u8981\u4f9d\u8d56 systemd\uff0c\u8fdb\u800c\u4e0d\u4f1a\u4f9d\u8d56 linux-headers\uff1a</li> </ul> <pre><code>custom-overlay = final: prev: {\n  # systemd cannot build due to linux-headers\n  procps = prev.procps.override { withSystemd = false; };\n  tmux = prev.tmux.override { withSystemd = false; };\n};\n</code></pre> <p>\u5bf9\u4e8e home-manager\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u914d\u7f6e\u8ba9\u5b83\u4e0d\u8981\u7f16\u8bd1 systemd\uff1a</p> <pre><code># systemd does not build\nsystemd.user.systemctlPath = \"/bin/systemctl\";\n</code></pre> <p>\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u6cbb\u6807\u4e0d\u6cbb\u672c\uff0c\u8fd8\u662f\u8981\u7b49\u4e0a\u6e38\u4fee\u590d\u3002</p> <p>UPDATE: \u5411 nixpkgs \u63d0\u4ea4\u4e86 pr: https://github.com/NixOS/nixpkgs/pull/198587</p>","tags":["nix","power","powerpc","ppc64le"]},{"location":"software/2021/12/26/nvidia-cuda/","title":"NVIDIA \u9a71\u52a8\u548c CUDA \u7248\u672c\u4fe1\u606f\u901f\u67e5","text":"","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u548c NVIDIA \u9a71\u52a8\u548c CUDA \u640f\u6597\u6bd4\u8f83\u591a\uff0c\u56e0\u6b64\u8bb0\u5f55\u4e00\u4e0b\u4e00\u4e9b\u5e38\u7528\u4fe1\u606f\uff0c\u65b9\u4fbf\u67e5\u8be2\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#\u5e38\u7528\u5730\u5740","title":"\u5e38\u7528\u5730\u5740","text":"<ul> <li>CUDA Toolkit Downloads</li> <li>NVIDIA Driver Installation Quickstart Guide</li> <li>NVIDIA Driver Downloads</li> <li>NVIDIA Docker Installation Guide</li> </ul>","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#cuda-\u7248\u672c\u4e0e-nvidia-\u9a71\u52a8\u517c\u5bb9\u6027","title":"CUDA \u7248\u672c\u4e0e NVIDIA \u9a71\u52a8\u517c\u5bb9\u6027","text":"<p>\u53ef\u4ee5\u901a\u8fc7 apt show cuda-runtime-x-x \u627e\u5230\uff1a</p> <ul> <li>cuda 12.6 &gt;= 560 (Release Notes: 525)</li> <li>cuda 12.5 &gt;= 555 (Release Notes: 525)</li> <li>cuda 12.4 &gt;= 550 (Release Notes: 525)</li> <li>cuda 12.3 &gt;= 545 (Release Notes: 525)</li> <li>cuda 12.2 &gt;= 535 (Release Notes: 525)</li> <li>cuda 12.1 &gt;= 530 (Release Notes: 525)</li> <li>cuda 12.0 &gt;= 525 (Release Notes: 525)</li> <li>cuda 11.8 &gt;= 520 (Release Notes: 450)</li> <li>cuda 11.7 &gt;= 515 (Release Notes: 450)</li> <li>cuda 11.6 &gt;= 510 (Release Notes: 450)</li> <li>cuda 11.5 &gt;= 495 (Release Notes: 450)</li> <li>cuda 11.4 &gt;= 470 (Release Notes: 450)</li> <li>cuda 11.3 &gt;= 465 (Release Notes: 450)</li> <li>cuda 11.2 &gt;= 460 (Release Notes: 450)</li> <li>cuda 11.1 &gt;= 455 (Release Notes: 450)</li> <li>cuda 11.0 &gt;= 450 (Release Notes: 450)</li> <li>cuda 10.2 &gt;= 440</li> <li>cuda 10.1 &gt;= 418</li> <li>cuda 10.0 &gt;= 410</li> <li>cuda 9.2 &gt;= 396</li> <li>cuda 9.1 &gt;= 390</li> <li>cuda 9.0 &gt;= 384</li> </ul> <p>\u4f7f\u7528 nvidia-smi \u770b\u5230\u7684 CUDA \u7248\u672c\uff0c\u901a\u5e38\u5c31\u662f\u8fd9\u4e2a\u9a71\u52a8\u5728\u4e0a\u8868\u91cc\u5bf9\u5e94\u7684 CUDA \u7248\u672c\uff0c\u4f8b\u5982\u5185\u6838\u9a71\u52a8\u7248\u672c\u662f 470 \u7684\u8bdd\uff0c\u770b\u5230\u7684 CUDA \u7248\u672c\u5c31\u662f 11.4\u3002</p> <p>\u5b9e\u9645\u4e0a\u517c\u5bb9\u7684\u9a71\u52a8\u7248\u672c\u4f1a\u6bd4 APT \u5ba3\u79f0\u7684\u66f4\u591a\u4e00\u4e9b\uff1a\u5b98\u65b9\u6587\u6863 \u91cc\u9762\u5199\u4e86 CUDA 11.x \u53ef\u4ee5\u517c\u5bb9 NVIDIA &gt;= 450\uff0cCUDA 12.x \u53ef\u4ee5\u517c\u5bb9 NVIDIA &gt;= 525\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#cuda-\u7248\u672c\u548c-gccclang-\u7248\u672c\u517c\u5bb9\u6027","title":"CUDA \u7248\u672c\u548c GCC/Clang \u7248\u672c\u517c\u5bb9\u6027","text":"<p>\u53ef\u4ee5\u5728 cuda/include/crt/host_config.h \u6587\u4ef6\u91cc\u627e\u5230\uff1a</p> <ul> <li>cuda 12.6: gcc &lt;= 13, 3.2 &lt; clang &lt; 19</li> <li>cuda 12.1: gcc &lt;= 12, 3.2 &lt; clang &lt; 16</li> <li>cuda 12.0: gcc &lt;= 12, 3.2 &lt; clang &lt; 15</li> <li>cuda 11.8: gcc &lt;= 11, 3.2 &lt; clang &lt; 15</li> <li>cuda 11.5: gcc &lt;= 11</li> <li>cuda 11.4: gcc &lt;= 10</li> <li>cuda 11.3: gcc &lt;= 10, 3.2 &lt; clang &lt; 12</li> <li>cuda 11.1: gcc &lt;= 10, 3.2 &lt; clang &lt; 11</li> <li>cuda 11.0: gcc &lt;= 9, 3.2 &lt; clang &lt; 10</li> <li>cuda 10.2: gcc &lt;= 8, 3.2 &lt; clang &lt; 9</li> <li>cuda 10.1: gcc &lt;= 8, 3.2 &lt; clang &lt; 9</li> <li>cuda 10.0: gcc &lt;= 7</li> <li>cuda 9.1: gcc &lt;= 6</li> </ul>","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#cuda-\u7248\u672c\u4e0e\u663e\u5361\u517c\u5bb9\u6027","title":"CUDA \u7248\u672c\u4e0e\u663e\u5361\u517c\u5bb9\u6027","text":"<p>\u7f16\u8bd1\u9009\u9879\u4e0e\u663e\u5361\u5bf9\u5e94\u5173\u7cfb https://arnon.dk/matching-sm-architectures-arch-and-gencode-for-various-nvidia-cards/</p> <p>\u53ef\u4ee5\u5728 <code>nvcc --help</code> \u641c\u7d22 gpu-architecture \u627e\u5230\uff1a</p> <ul> <li>cuda 12.1 sm_50 to sm_90a</li> <li>cuda 12.0 sm_50 to sm_90a</li> <li>cuda 11.8 sm_35 to sm_90</li> <li>cuda 11.4 sm_35 to sm_87</li> <li>cuda 11.3 sm_35 to sm_86</li> <li>cuda 11.1 sm_35 to sm_86</li> <li>cuda 11.0 sm_35 to sm_80</li> <li>cuda 10.2 sm_30 to sm_75</li> <li>cuda 10.0 sm_30 to sm_75</li> <li>cuda 9.1 sm_30 to sm_72</li> <li>cuda 9.0 sm_30 to sm_70</li> </ul> <p>\u663e\u5361\u7684 Compute Capability \u53ef\u4ee5\u5728 https://developer.nvidia.com/cuda-gpus \u627e\u5230\uff1a</p> <ul> <li>H100: 90</li> <li>A100: 80</li> <li>V100: 70</li> <li>P100: 60</li> </ul>","tags":["nvidia","cuda"]},{"location":"software/2021/12/26/nvidia-cuda/#\u5347\u7ea7-nvidia-\u9a71\u52a8","title":"\u5347\u7ea7 NVIDIA \u9a71\u52a8","text":"<p>\u5347\u7ea7\u540e\uff0c\u9700\u8981 rmmod \u5df2\u6709\u7684\uff0c\u518d modprobe \u65b0\u7684\uff1a</p> <pre><code>sudo rmmod nvidia_uvm nvidia_drm nvidia_modeset nvidia &amp;&amp; sudo modprobe nvidia\n</code></pre> <p>\u5982\u679c\u53d1\u73b0 rmmod \u5931\u8d25\uff0c\u53ef\u4ee5 <code>lsof /dev/nvidiactl</code> \u67e5\u770b\u8c01\u5728\u5360\u7528\u3002DGX OS \u4e0a\u9700\u8981\u505c\u6b62\uff1a</p> <pre><code>sudo systemctl stop nvsm.service\nsudo systemctl stop nvidia-dcgm.service \n</code></pre> <p>\u9664\u4e86 <code>/dev/nvidia*</code> \u53ef\u80fd\u88ab\u5360\u7528\u4ee5\u5916\uff0c\u8fd8\u9700\u8981\u7528 lsof \u68c0\u67e5 <code>/dev/dri/render*</code>\u3002</p>","tags":["nvidia","cuda"]},{"location":"software/2023/05/13/openldap-in-docker/","title":"\u4f7f\u7528 Docker \u90e8\u7f72 OpenLDAP","text":"<p>OpenLDAP \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7528\u6237\u7cfb\u7edf\u5b9e\u73b0\uff0c\u4e3b\u8981\u652f\u6301 LDAP \u534f\u8bae\uff0c\u53ef\u4ee5\u7ed9\u5176\u4ed6\u7cfb\u7edf\u63d0\u4f9b\u7528\u6237\u8ba4\u8bc1\u3002\u4e0b\u9762\u8ba8\u8bba\u4e86\u5982\u4f55\u5728 Docker \u4e2d\u90e8\u7f72 OpenLDAP\u3002</p>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#docker-compose","title":"Docker-Compose","text":"<p>OpenLDAP \u53ef\u4ee5\u7528\u73b0\u6210\u7684 Docker \u955c\u50cf\uff1abitnami/openldap\uff0c\u914d\u5408 Docker-Compose \u8fdb\u884c\u90e8\u7f72\uff1a</p> <pre><code>version: '2'\n\nservices:\n  openldap:\n    image: bitnami/openldap:2.6\n    ports:\n      - '1389:1389' # LDAP\n    environment:\n      - LDAP_ROOT=dc=example,dc=com # example.com\n    env_file: .env # admin password\n    volumes:\n      - './data:/bitnami/openldap' # data storage\n</code></pre> <p>admin \u5bc6\u7801\u5efa\u8bae\u5355\u72ec\u4fdd\u5b58\uff0c\u4f8b\u5982\u5199\u5728 <code>.env</code> \u4e2d\uff1a</p> <pre><code>LDAP_ADMIN_PASSWORD=12345678REDACTED\n</code></pre> <p>\u542f\u52a8\u670d\u52a1\uff1a</p> <pre><code># prepare data folder\nsudo rm -rf data\nsudo mkdir data\nsudo chown 1001:root data\n# launch docker compose\nsudo docker-compose up -d\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7 ldapsearch \u5217\u51fa\u6240\u6709\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u9700\u8981\u767b\u5f55\uff08Bind DN\uff09\uff0c\u53ef\u4ee5\u53ea\u8bfb\u8bbf\u95ee\uff1a</p> <pre><code># search elements under dc=example,dc=com\n# -x: Simple authentication without user and password\n# -b dc=example,dc=com: base dn for search\n# -H: ldap server\n$ ldapsearch -x -b dc=example,dc=com -H ldap://localhost:1389/\n# user01, users, example.com\ndn: cn=user01,ou=users,dc=example,dc=com\ncn: User1\ncn: user01\nsn: Bar1\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuserPassword:: Yml0bmFtaTE=\nuid: user01\nuidNumber: 1000\ngidNumber: 1000\nhomeDirectory: /home/user01\n\n# user02, users, example.com\ndn: cn=user02,ou=users,dc=example,dc=com\ncn: User2\ncn: user02\nsn: Bar2\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuserPassword:: Yml0bmFtaTI=\nuid: user02\nuidNumber: 1001\ngidNumber: 1001\nhomeDirectory: /home/user02\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 Docker \u955c\u50cf\u521d\u59cb\u5316\u4e86\u4e24\u4e2a\u7528\u6237\uff0c\u4ec5\u4f9b\u6d4b\u8bd5\u7528\uff0c\u5b83\u7528\u7684\u5bc6\u7801\u6bd4\u8f83\u5f31\u3002</p>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#tls","title":"TLS","text":"<p>\u63a5\u7740\uff0c\u7ed9 OpenLDAP \u914d\u7f6e TLS\u3002\u9996\u5148\u7528 OpenSSL \u751f\u6210 CA \u548c\u8bc1\u4e66\uff1a</p> <pre><code># https://arminreiter.com/2022/01/create-your-own-certificate-authority-ca-using-openssl/\n# setup CA\nrm -rf certs\nmkdir -p certs\n\nopenssl genrsa -out certs/ldap_ca.key 4096\nopenssl req -x509 -new -nodes -key certs/ldap_ca.key -sha256 -days 1826 -out certs/ldap_ca.crt -subj \"/CN=Example Com CA/ST=Somewhere/L=Earth/O=ExampleOrg\"\n\n# setup cert\n# CN must match hostname\nopenssl req -new -nodes -out certs/ldap_server.csr -newkey rsa:4096 -keyout certs/ldap_server.key -subj \"/CN=$(hostname)/ST=Somewhere/L=Earth/O=ExampleOrg\"\nopenssl x509 -req -in certs/ldap_server.csr -CA certs/ldap_ca.crt -CAkey certs/ldap_ca.key -CAcreateserial -out certs/ldap_server.crt -days 730 -sha256\n\nchown -R 1001:root certs\n</code></pre> <p>\u7136\u540e\u4fee\u6539 docker-compose.yml\uff1a</p> <pre><code>version: '2'\n\nservices:\n  openldap:\n    image: bitnami/openldap:2.6\n    ports:\n      - '1389:1389' # LDAP\n      - '1636:1636' # LDAPS\n    environment:\n      - LDAP_ROOT=dc=example,dc=com # example.com\n      - LDAP_ENABLE_TLS=yes\n      - LDAP_TLS_CERT_FILE=/opt/bitnami/openldap/certs/ldap_server.crt\n      - LDAP_TLS_KEY_FILE=/opt/bitnami/openldap/certs/ldap_server.key\n      - LDAP_TLS_CA_FILE=/opt/bitnami/openldap/certs/ldap_ca.crt\n    env_file: .env # admin password\n    volumes:\n      - './data:/bitnami/openldap' # data storage\n      - './certs:/opt/bitnami/openldap/certs'\n</code></pre> <p>\u518d\u91cd\u65b0\u542f\u52a8\uff0c\u5c31\u53ef\u4ee5\u7528 LDAPS \u6765\u8bbf\u95ee LDAP Server\uff1a</p> <pre><code># LDAP\n$ ldapsearch -x -b dc=example,dc=com -H ldap://localhost:1389/\n# LDAPS\n$ LDAPTLS_CACERT=$PWD/certs/ldap_ca.crt ldapsearch -x -b dc=example,dc=com -H ldaps://localhost:1636/\n</code></pre>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#\u4fee\u6539\u5bc6\u7801","title":"\u4fee\u6539\u5bc6\u7801","text":"<p>\u7ba1\u7406\u5458\u4fee\u6539\u7528\u6237\u7684\u5bc6\u7801\uff0c\u4f7f\u7528 ldappasswd \u4fee\u6539\uff1a</p> <pre><code># Generate a new password for cn=user01,ou=users,dc=example,dc=com\n# -W: prompt for bind(login) password\n# -D cn=admin,dc=example,dc=com: bind(login) to admin user\n$ ldappasswd -x -W -D cn=admin,dc=example,dc=com -H ldap://localhost:1389/ cn=user01,ou=users,dc=example,dc=com\nEnter LDAP Password:\nNew password: REDACTED\n\n# Set password for for cn=user01,ou=users,dc=example,dc=com\n# -S: prompt for new password\n$ ldappasswd -x -W -S -D cn=admin,dc=example,dc=com -H ldap://localhost:1389/ cn=user01,ou=users,dc=example,dc=com\nNew password:\nRe-enter new password:\nEnter LDAP Password:\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u6ca1\u6709\u6743\u9650\u4fee\u6539\u81ea\u5df1\u7684\u5bc6\u7801\u3002\u53ef\u4ee5\u8fdb\u5165 Docker \u5bb9\u5668\uff0c\u4fee\u6539\u6570\u636e\u5e93\u7684\u6743\u9650\uff1a</p> <pre><code>$ sudo docker-compose exec openldap bash\n# Authenticate using local user\nopenldap$ ldapmodify -Y EXTERNAL -H \"ldapi:///\"\nSASL/EXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=1001,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\n# Paste the following lines\n# Allow user to change its own password\ndn: olcDatabase={2}mdb,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to attrs=userPassword\n  by anonymous auth\n  by self write\n  by * none\nolcAccess: {1}to *\n  by * read\n</code></pre> <p>\u6b64\u65f6\u7528\u6237\u5c31\u53ef\u4ee5\u81ea\u5df1\u4fee\u6539\u5bc6\u7801\u4e86\uff1a</p> <pre><code>$ ldappasswd -x -W -S -D cn=user01,ou=users,dc=example,dc=com -H ldap://localhost:1389/\nNew password:\nRe-enter new password:\nEnter LDAP Password:\n</code></pre> <p>\u5e76\u4e14 userPassword \u4e5f\u5bf9\u975e admin \u7528\u6237\u88ab\u9690\u85cf\u4e86\uff1a</p> <pre><code>$ ldapsearch -x -b dc=example,dc=com -H ldap://localhost:1389/\n# user01, users, craft.cn\ndn: cn=user01,ou=users,dc=craft,dc=cn\ncn: User1\ncn: user01\nsn: Bar1\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuid: user01\nuidNumber: 1000\ngidNumber: 1000\nhomeDirectory: /home/user01\n</code></pre>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#ldap-ui","title":"ldap-ui","text":"<p>\u5982\u679c\u60f3\u8981 Web \u7ba1\u7406\u754c\u9762\uff0c\u53ef\u4ee5\u7528 ldap-ui\uff0c\u5728 docker-compose \u6dfb\u52a0\uff1a</p> <pre><code>  ldap-ui:\n    image: dnknth/ldap-ui\n    ports:\n      - '5000:5000'\n    links:\n      - openldap\n    environment:\n      - LDAP_URL=ldap://openldap:1389/\n      - BASE_DN=dc=example,dc=com\n      - BIND_PATTERN=cn=%s,dc=example,dc=com\n</code></pre> <p>\u8bbf\u95ee localhost:5000\uff0c\u5c31\u53ef\u4ee5\u7528 admin \u7528\u6237\u767b\u5f55\u4e86\u3002\u5982\u679c\u60f3\u7528\u5176\u4ed6\u7528\u6237\u767b\u5f55\uff0c\u7531\u4e8e BIND \u8def\u5f84\u591a\u4e86\u4e00\u7ea7 ou=users\uff0c\u6240\u4ee5\u8981\u4e48\u4fee\u6539 BIND_PATTERN\uff0c\u8981\u4e48\u7528\u6237\u540d\u8981\u5199\u6210 user01,ou=users</p>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#\u6743\u9650\u7ba1\u7406","title":"\u6743\u9650\u7ba1\u7406","text":"<p>\u524d\u9762\u4fee\u6539\u4e86\u6743\u9650\uff0c\u4ece\u800c\u5141\u8bb8\u7528\u6237\u4fee\u6539\u81ea\u5df1\u7684\u5bc6\u7801\uff1a</p> <pre><code>$ sudo docker-compose exec openldap bash\n# Authenticate using local user\nopenldap$ ldapmodify -Y EXTERNAL -H \"ldapi:///\"\nSASL/EXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=1001,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\n# Paste the following lines\n# Allow user to change its own password\ndn: olcDatabase={2}mdb,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to attrs=userPassword\n  by anonymous auth\n  by self write\n  by * none\nolcAccess: {1}to *\n  by * read\n</code></pre> <p>\u6838\u5fc3\u90e8\u5206\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ol> <li>to attrs=userPassword\uff1a\u9488\u5bf9 userPassword \u8fd9\u4e2a\u5b57\u6bb5\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u8ba4\u8bc1\uff0c\u7528\u6237\u81ea\u5df1\u53ef\u4ee5\u5199\uff0c\u5176\u4ed6\u4eba\u6ca1\u6709\u6743\u9650</li> <li>to *\uff1a\u4efb\u4f55\u4eba\u53ef\u4ee5\u8bfb</li> </ol> <p>\u5982\u679c\u60f3\u8981\u8fdb\u4e00\u6b65\u6536\u7f29\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <ol> <li>\u4e0d\u767b\u5f55\u770b\u4e0d\u5230\u4efb\u4f55\u4fe1\u606f</li> <li>\u666e\u901a\u7528\u6237\u767b\u5f55\u540e\uff0c\u53ea\u80fd\u8bfb\u53d6\u81ea\u5df1\u7684\u4fe1\u606f</li> </ol> <p>\u90a3\u4e48\uff0c\u53ef\u4ee5\u5199\u51fa\u5982\u4e0b\u7684\u914d\u7f6e\uff1a</p> <pre><code>dn: olcDatabase={2}mdb,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to attrs=userPassword\n  by anonymous auth\n  by self write\n  by * none\nolcAccess: {1}to *\n  by self read\n  by * none\n</code></pre> <p>\u7531\u4e8e\u4ece\u524d\u5f80\u540e\u5339\u914d\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u5339\u914d\u5c31\u4e0d\u770b\u540e\u9762\u7684\u89c4\u5219\u7684\u539f\u56e0\uff0c\u66f4\u7cbe\u786e\u7684\u8fc7\u6ee4\u8981\u653e\u5728\u524d\u9762\u3002</p>","tags":["ldap","openldap","docker"]},{"location":"software/2023/05/13/openldap-in-docker/#ldap-\u7528\u4e8e\u5176\u4ed6\u8f6f\u4ef6\u7684\u8ba4\u8bc1","title":"LDAP \u7528\u4e8e\u5176\u4ed6\u8f6f\u4ef6\u7684\u8ba4\u8bc1","text":"<p>LDAP \u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u7528\u9014\u662f\u7528\u4e8e\u5176\u4ed6\u8f6f\u4ef6\u7684\u8ba4\u8bc1\uff0c\u4e00\u822c\u6765\u8bf4\u6709\u4e24\u79cd\u7528\u6cd5\uff1a</p> <ol> <li>LDAP \u81ea\u8eab\u5e26\u4e86\u8ba4\u8bc1\u7684\u529f\u80fd\uff08Simple Auth\uff09\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u628a\u7528\u6237\u540d\uff08user01\uff09\u6620\u5c04\u5230 LDAP \u7684 Bind DN \u4e0a\uff08cn=user01,ou=users,cn=example,cn=com\uff09\uff0cBind DN \u548c\u5bc6\u7801\u4f1a\u4f20\u8f93\u5230 LDAP Server\uff1b\u5728 LDAP Server \u4e0a\u5bc6\u7801\u4f1a\u4e0e\u7528\u6237\u7684 userPassword \u8fdb\u884c\u5339\u914d\uff0c\u5982\u679c Bind \u6210\u529f\uff0c\u5c31\u8ba4\u4e3a\u7528\u6237\u767b\u5f55\u6210\u529f</li> <li>LDAP \u9644\u5e26\u4e86\u5217\u7528\u6237\u7684\u529f\u80fd\uff08Search\uff09\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e00\u822c\u662f\u8981\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u641c\u7d22\u7684 DN \u6765\u63a7\u5236\u6743\u9650\uff1b\u7136\u540e\u5176\u4ed6\u8f6f\u4ef6 Bind \u5230\u7528\u4e8e\u641c\u7d22\u7684 DN \u4e0a\uff0c\u641c\u7d22\u7528\u6237\uff0c\u628a\u7528\u6237\u4fe1\u606f\u540c\u6b65\u5230\u672c\u5730</li> </ol> <p>\u7b2c\u4e00\u79cd\u4f7f\u7528\u65b9\u6cd5\u8981\u6c42\u7528\u6237\u548c DN \u6709\u76f4\u63a5\u6620\u5c04\u5173\u7cfb\uff0c\u4f8b\u5982\u4e0a\u9762\u7684 <code>cn=%s,ou=users,cn=example=com</code>\uff0c\u597d\u5904\u662f\u6bd4\u8f83\u7b80\u5355\uff0c\u7f3a\u70b9\u662f\u8981\u628a\u6240\u6709\u7528\u6237\u653e\u5728\u540c\u4e00\u4e2a DN \u4e0b\u9762\uff0c\u4e0d\u9002\u5408\u6bd4\u8f83\u590d\u6742\u7684\u7ec4\u7ec7\u7ed3\u6784\u3002</p> <p>\u7b2c\u4e8c\u79cd\u4f7f\u7528\u65b9\u6cd5\uff0c\u5219\u662f\u5176\u4ed6\u8f6f\u4ef6\u5148\u8fdb\u884c\u641c\u7d22\uff08\u641c\u7d22\u672c\u8eab\u53ef\u80fd\u9700\u8981 Bind \u5230\u7528\u4e8e\u641c\u7d22\u7684 DN \u4e0a\uff09\uff0c\u627e\u5230\u5339\u914d\u7528\u6237\u540d\u6216\u8005\u90ae\u7bb1\u7684\u7528\u6237\uff0c\u518d\u8fdb\u884c Simple Auth\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\u7075\u6d3b\u6027\u66f4\u597d\uff0c\u7528\u6237\u4e0d\u9700\u8981\u653e\u5728\u540c\u4e00\u4e2a DN \u4e0b\u9762\uff0c\u53ef\u4ee5\u6709\u66f4\u591a\u5c42\u7ea7\u3002</p> <p>\u7531\u4e8e\u4f7f\u7528\u4e86 Simple Auth\uff0c\u5bc6\u7801\u4f1a\u660e\u6587\u53d1\u9001\u7ed9 LDAP Server\uff0c\u56e0\u6b64\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u5efa\u8bae\u914d\u7f6e TLS\u3002</p>","tags":["ldap","openldap","docker"]},{"location":"software/2023/12/05/packaging-cookbook/","title":"\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5","text":"<p>\u968f\u7740 Linux \u4f7f\u7528\u9010\u6e10\u6df1\u5165\uff0c\u5f00\u59cb\u5c1d\u8bd5\u53c2\u4e0e\u5230\u4e00\u4e9b\u53d1\u884c\u7248/\u5305\u7ba1\u7406\u5668\u7684\u7ef4\u62a4\u5f53\u4e2d\u3002\u5728\u6b64\u8bb0\u5f55\u4e00\u4e0b\u6253\u5305\u76f8\u5173\u547d\u4ee4\uff0c\u65b9\u4fbf\u81ea\u5df1\u901f\u67e5\u3002</p>","tags":["linux","packaging"]},{"location":"software/2023/12/05/packaging-cookbook/#aosc-os","title":"AOSC OS","text":"<p>\u6587\u6863\uff1aIntro to Package Maintenance: Basics</p> <p>\u7528 ciel \u5de5\u5177\u514b\u9686\u8f6f\u4ef6\u6e90 + \u5728\u5bb9\u5668\u4e2d\u6784\u5efa\u3002\u521b\u5efa\u4e00\u4e2a\u6253\u5305\u73af\u5883\uff1a</p> <pre><code>ciel new\n</code></pre> <p>\u6b64\u65f6\u76ee\u5f55\u4e0b\u5305\u62ec\uff1a</p> <ol> <li>TREE \u76ee\u5f55\uff1aAOSC-Dev/aosc-os-abbs \u7684\u514b\u9686</li> <li>OUTPUT-* \u76ee\u5f55\uff1a\u653e\u7f6e\u6253\u5305\u51fa\u6765\u7684 deb</li> </ol> <p>\u53ef\u4ee5\u5728 TREE \u76ee\u5f55\u4e0b\u8fdb\u884c\u5305\u7684\u66f4\u65b0\u7b49\u7b49\u64cd\u4f5c\u3002\u5982\u679c\u8981\u6784\u5efa\u5305\uff0c\u5047\u8bbe\u5728\u4e0a\u4e00\u6b65\u521b\u5efa\u6253\u5305\u73af\u5883\u65f6\uff0c\u540d\u5b57\u8bbe\u7f6e\u4e3a main\uff0c\u7528\u547d\u4ee4\uff1a</p> <pre><code>ciel build -i main [packages]\n</code></pre> <p>\u6784\u5efa\u5b8c\u6210\u7684 deb \u4f1a\u653e\u5230 <code>OUTPUT-[branch]</code> \u4e0b\uff0c\u4f8b\u5982\u9ed8\u8ba4\u662f stable \u5206\u652f\u7684\u8bdd\uff0c\u9ed8\u8ba4\u4f1a\u653e\u5230 <code>OUTPUT-stable</code> \u4e0b\u3002</p> <p>\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u5982\u679c\u8981\u63d0\u4ea4\u5230\u8f6f\u4ef6\u6e90\uff0c\u8fdb\u5165\u67d0\u4e2a OUTPUT \u76ee\u5f55\uff0c\u7528 <code>pushpkg</code> \u547d\u4ee4\uff1a</p> <pre><code>pushpkg [-d] [user_name] [branch]\n</code></pre> <p><code>-d</code> \u53c2\u6570\u8868\u793a\u63d0\u4ea4\u540e\u5220\u9664\u672c\u5730\u7684\u6587\u4ef6\u3002</p> <p>\u8d21\u732e\u6d41\u7a0b\uff1a</p> <ol> <li>\u4ece stable checkout \u51fa\u65b0\u7684\u5206\u652f</li> <li>\u4fee\u6539 TREE \u91cc\u9762\u7684\u5185\u5bb9</li> <li>\u7528 <code>ciel build -i main [packages]</code> \u6784\u5efa\uff0c\u53ef\u4ee5\u7528\u793e\u533a\u63d0\u4f9b\u7684 Buildbot</li> <li>\uff08\u53ef\u9009\uff09pushpkg \u63a8\u5230\u8f6f\u4ef6\u6e90</li> <li>Push \u5230 GitHub \u7684\u5206\u652f\uff0c\u6253\u5f00 pr</li> <li>\u7b49\u5f85\u5ba1\u6838\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u5408\u5e76\u5e76 pushpkg \u5230 stable</li> </ol>","tags":["linux","packaging"]},{"location":"software/2023/12/05/packaging-cookbook/#debian","title":"Debian","text":"<p>\u6211\u8fd8\u6ca1\u6709\u6210\u4e3a Debian \u7ef4\u62a4\u8005\uff0c\u56e0\u6b64\u5e76\u4e0d\u4e86\u89e3\u5b8c\u6574\u6d41\u7a0b\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u6709\u7684\u5305\uff0c\u7528 <code>apt source</code> \u4e0b\u8f7d\u6e90\u7801\u548c debian \u7684\u6587\u4ef6\u3002\u5f88\u591a\u5305\u5df2\u7ecf\u632a\u5230\u4e86 salsa\uff0c\u4e5f\u5c31\u662f debian \u7684 gitlab \u5b9e\u4f8b\u4e0a\uff0c\u5982\u679c\u6709\uff0c<code>apt source</code> \u4f1a\u63d0\u793a\u4f60\u53ef\u4ee5\u76f4\u63a5\u4ece salsa \u4e0a\u514b\u9686\u4ed3\u5e93\u3002</p> <p>\u4e0b\u8f7d\u4e86\u4ee5\u540e\uff0c\u5f97\u5230\u7684\u662f\u4e00\u4efd\u6e90\u7801\uff0c\u5916\u52a0 <code>debian</code> \u76ee\u5f55\u3002\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u662f <code>debian/control</code>\uff08\u8bb0\u5f55\u4e86\u5305\u7684\u5143\u6570\u636e\uff09\u548c <code>debian/rules</code>\uff08\u5982\u4f55\u6784\u5efa\uff09\u3002</p> <p>\u4e3a\u4e86\u6784\u5efa\u5305\uff0c\u7b80\u5355\u7684\u529e\u6cd5\u662f\u7528 <code>dpkg-buildpackage</code> \u547d\u4ee4\u3002\u5e38\u7528\u53c2\u6570\uff1a</p> <ol> <li><code>-b</code>\uff1a\u53ea\u6784\u5efa\u4e8c\u8fdb\u5236\u5305</li> <li><code>-us -uc</code>\uff1a\u6ca1\u6709\u914d\u7f6e GPG\uff0c\u6ca1\u6cd5\u7b7e\u540d\uff0c\u81ea\u7528\u7684\u65f6\u5019\u9009\u62e9\u4e0d\u7b7e\u540d</li> <li><code>-nc</code>\uff1a\u6784\u5efa\u524d\u4e0d clean</li> <li><code>-d</code>\uff1a\u5373\u4f7f\u4f9d\u8d56\u4e0d\u80fd\u6ee1\u8db3\uff0c\u4e5f\u8981\u6784\u5efa</li> </ol> <p>\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</p> <ol> <li><code>DEB_BUILD_PROFILES</code>\uff1a\u8bbe\u7f6e profile\uff0c\u5e38\u89c1\u7684\u6709 nocheck nodoc \u7b49\u7b49\uff0c\u548c debian/control \u6587\u4ef6\u91cc\u7684 <code>&lt;profile&gt;</code> \u5bf9\u5e94</li> <li><code>DEB_BUILD_OPTIONS</code>\uff1a\u548c profile \u7c7b\u4f3c\uff0c\u4f46\u662f\u7528\u6cd5\u7565\u6709\u4e0d\u540c\uff0c\u5e38\u89c1\u7684\u6709 nocheck nodoc noopt nostrip \u7b49\u7b49</li> </ol> <p>\u5bf9\u4e8e\u57fa\u4e8e git \u7684\u5305\uff0c\u4f8b\u5982\u4ece salsa \u4e0a clone \u7684\u5305\uff0c\u53ef\u4ee5\u7528 gbp \u5de5\u5177\uff1a</p> <ol> <li><code>gbp buildpackage</code>\uff1a\u529f\u80fd\u5bf9\u5e94 dpkg-buildpackage\u3002</li> <li><code>gbp import-orig</code>\uff1a\u5bfc\u5165\u4e00\u4e2a\u4e0a\u6e38\u6e90\u7801\u7684 tarball \u5230\u4ed3\u5e93\u4e2d\uff0c\u53ef\u4ee5\u6dfb\u52a0 <code>--uscan</code> \u53c2\u6570\u8ba9\u5b83\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e0b\u8f7d\u65b0\u7248\uff1b\u53ef\u4ee5\u6dfb\u52a0 <code>--pristine-tar</code> \u53c2\u6570\u8ba9\u5b83\u4fdd\u7559\u4e00\u4efd\u539f\u59cb tarball\uff08\u7684 delta\uff09\u3002</li> </ol> <p>dpkg-buildpackage \u9ed8\u8ba4\u4f1a\u5728\u5f53\u524d\u73af\u5883\u4e0b\u6784\u5efa\u65b0\u5305\uff0c\u56e0\u6b64\u5982\u679c\u7f3a\u4e86\u4f9d\u8d56\uff0c\u5c31\u9700\u8981\u5168\u5c40\u5b89\u88c5\u3002\u5982\u679c\u4e0d\u60f3\u8fd9\u6837\uff0c\u53ef\u4ee5\u914d\u7f6e sbuild\uff0c\u5728 chroot \u4e2d\u8fdb\u884c\u6784\u5efa\u3002</p> <p>\u914d\u7f6e sbuild \u7684\u7b80\u5355\u529e\u6cd5\u662f\u7528 sbuild-debian-developer-setup \u547d\u4ee4\u3002\u5b83\u4f1a\u5728 <code>/srv/chroot</code> \u4e0b\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u5bb9\u5668\u7684 sysroot\uff0c\u91cc\u9762\u662f\u4e00\u4e2a\u5e72\u51c0\u7684 debian \u73af\u5883\u3002\u4e4b\u540e\uff0c\u53ef\u4ee5\u7528 sbuild \u547d\u4ee4\uff0c\u5728\u5bb9\u5668\u91cc\u9762\u6784\u5efa\u3002</p>","tags":["linux","packaging"]},{"location":"software/2023/12/05/packaging-cookbook/#nixpkgs","title":"Nixpkgs","text":"<p>Nixpkgs \u6253\u5305\u8fc7\u7a0b\u6bd4\u8f83\u7b80\u5355\uff1a</p> <ol> <li>\u4fee\u6539 Nixpkgs \u4ed3\u5e93</li> <li>\u7528 nix \u547d\u4ee4\u6784\u5efa\u65b0\u5305\uff1a<code>nix build -L .#package</code></li> <li>\uff08\u53ef\u9009\uff09\u7528 nixpkgs-review \u6784\u5efa\u6240\u6709\u9700\u8981\u91cd\u65b0\u6784\u5efa\u7684\u5305</li> <li>Push \u5230 GitHub\uff0c\u521b\u5efa PR</li> <li>\u7b49\u5f85\u5ba1\u6838\u548c\u5408\u5e76</li> </ol> <p>Homebrew \u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p>","tags":["linux","packaging"]},{"location":"software/2022/05/31/qemu-rv64-in-libvirt/","title":"\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a","text":"","tags":["qemu","libvirt","virtmanager","debian","riscv","rv64"]},{"location":"software/2022/05/31/qemu-rv64-in-libvirt/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6211\u5728 libvirt \u4e2d\u8dd1\u4e86\u51e0\u4e2a KVM \u52a0\u901f\u7684\u865a\u62df\u673a\uff0c\u7136\u540e\u7a81\u53d1\u5947\u60f3\uff0c\u65e2\u7136 libvirt \u80cc\u540e\u662f qemu\uff0c\u7136\u540e qemu \u662f\u652f\u6301\u8de8\u6307\u4ee4\u96c6\u7684\uff0c\u90a3\u662f\u5426\u53ef\u4ee5\u8ba9 libvirt \u6765\u8fd0\u884c RISC-V \u67b6\u6784\u7684\u865a\u62df\u673a\uff1f\u7ecf\u8fc7\u4e00\u756a\u641c\u7d22\uff0c\u53d1\u73b0\u53ef\u4ee5\u8dd1 ARM\uff1aHow To: Running Fedora-ARM under QEMU\uff0c\u65e2\u7136\u5982\u6b64\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8bd5\u8bd5\u7528 libvirt \u6765\u8fd0\u884c RV64 \u865a\u62df\u673a\u3002</p>","tags":["qemu","libvirt","virtmanager","debian","riscv","rv64"]},{"location":"software/2022/05/31/qemu-rv64-in-libvirt/#\u51c6\u5907-rootfs","title":"\u51c6\u5907 rootfs","text":"<p>\u7b2c\u4e00\u6b65\u662f\u6839\u636e Debian \u7684\u6587\u6863 Creating a riscv64 chroot \u6765\u521b\u5efa rootfs\uff0c\u7136\u540e\u518d\u7528 virt-make-fs \u6765\u6253\u5305\u3002</p> <p>\u9996\u5148\u662f\u7528 mmdebstrap \u6765\u751f\u6210\u4e00\u4e2a chroot\uff1a</p> <pre><code>$ sudo mkdir -p /tmp/riscv64-chroot\n$ sudo apt install mmdebstrap qemu-user-static binfmt-support debian-ports-archive-keyring\n$ sudo mmdebstrap --architectures=riscv64 --include=\"debian-ports-archive-keyring\" sid /tmp/riscv64-chroot \"deb http://deb.debian.org/debian-ports sid main\" \"deb http://deb.debian.org/debian-ports unreleased main\"\n</code></pre> <p>\u8fdb\u5165 chroot \u4ee5\u540e\uff0c\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\uff1a</p> <pre><code>$ sudo chroot /tmp/riscv64-chroot\n$ apt update\n$ apt install linux-image-riscv64 u-boot-menu vim\n# set root password\n$ passwd\n</code></pre> <p>\u7136\u540e\u4fee\u6539 <code>/etc/default/u-boot</code> \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u7684\u914d\u7f6e\uff1a</p> <pre><code># change ro to rw, set root device\nU_BOOT_PARAMETERS=\"rw noquiet root=/dev/vda1\"\n# fdt is provided by qemu\nU_BOOT_FDT_DIR=\"noexist\"\n</code></pre> <p>\u7136\u540e\u8fd0\u884c <code>u-boot-update</code> \u751f\u6210\u914d\u7f6e\u6587\u4ef6 <code>/boot/extlinux/extlinux.conf</code>\u3002</p> <p>\u5230\u8fd9\u91cc\uff0crootfs \u5df2\u7ecf\u51c6\u5907\u5b8c\u6bd5\u3002</p>","tags":["qemu","libvirt","virtmanager","debian","riscv","rv64"]},{"location":"software/2022/05/31/qemu-rv64-in-libvirt/#\u5c1d\u8bd5\u5728-qemu-\u4e2d\u542f\u52a8","title":"\u5c1d\u8bd5\u5728 QEMU \u4e2d\u542f\u52a8","text":"<p>\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u53c2\u8003 Setting up a riscv64 virtual machine \u5148\u542f\u52a8\u4e00\u4e2a qemu \u6765\u6d4b\u8bd5\u4e00\u4e0b\u662f\u5426\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff1a</p> <p>\u9996\u5148\u5236\u4f5c\u4e00\u4e2a qcow2 \u683c\u5f0f\u7684\u955c\u50cf\uff1a</p> <pre><code>$ sudo virt-make-fs --partition=gpt --type=ext4 --size=+10G --format=qcow2 /tmp/riscv64-chroot rootfs.qcow2\n$ qemu-img info rootfs.qcow2\nimage: rootfs.qcow2\nfile format: qcow2\nvirtual size: 11.4 GiB (12231971328 bytes)\ndisk size: 1.33 GiB\ncluster_size: 65536\nFormat specific information:\n    compat: 1.1\n    compression type: zlib\n    lazy refcounts: false\n    refcount bits: 16\n    corrupt: false\n    extended l2: false\n</code></pre> <p>\u7136\u540e\u542f\u52a8 qemu\uff0c\u914d\u7f6e\u597d OpenSBI \u548c U-Boot \u7684\u8def\u5f84\uff1a</p> <pre><code>$ sudo apt install qemu-system-misc opensbi u-boot-qemu\n$ sudo qemu-system-riscv64 -nographic -machine virt -m 8G \\\n    -bios /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf \\\n    -kernel /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf \\\n    -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-device,rng=rng0 \\\n    -append \"console=ttyS0 rw root=/dev/vda1\" \\\n    -device virtio-blk-device,drive=hd0 -drive file=rootfs.qcow2,format=qcow2,id=hd0 \\\n    -device virtio-net-device,netdev=usernet -netdev user,id=usernet,hostfwd=tcp::22222-:22\n</code></pre> <p>\u5982\u679c\u7cfb\u7edf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u770b\u5230\u4e0b\u9762\u7684\u8f93\u51fa\uff0c\u4e0b\u4e00\u6b65\u5c31\u53ef\u4ee5\u914d\u7f6e libvirt \u4e86\u3002</p> <pre><code>[    6.285024] Run /init as init process\nLoading, please wait...\nStarting version 251.1-1\n[    7.743714] virtio_ring: module verification failed: signature and/or required key missing - tainting kernel\n[    8.071762] virtio_blk virtio1: [vda] 23838189 512-byte logical blocks (12.2 GB/11.4 GiB)\n[    8.181210]  vda: vda1\nBegin: Loading essential drivers ... done.\nBegin: Running /scripts/init-premount ... done.\nBegin: Mounting root file system ... Begin: Running /scripts/local-top ... done.\nBegin: Running /scripts/local-premount ... done.\nWarning: fsck not present, so skipping root file system\n[    9.003143] EXT4-fs (vda1): mounted filesystem with ordered data mode. Quota mode: none.\ndone.\nBegin: Running /scripts/local-bottom ... done.\nBegin: Running /scripts/init-bottom ... done.\n[    9.754151] Not activating Mandatory Access Control as /sbin/tomoyo-init does not exist.\n[    9.808860] random: fast init done\n[   10.651361] systemd[1]: Inserted module 'autofs4'\n[   10.735574] systemd[1]: systemd 251.1-1 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY -P11KIT -QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)\n[   10.736902] systemd[1]: Detected architecture riscv64.\n\nWelcome to Debian GNU/Linux bookworm/sid!\n</code></pre>","tags":["qemu","libvirt","virtmanager","debian","riscv","rv64"]},{"location":"software/2022/05/31/qemu-rv64-in-libvirt/#\u914d\u7f6e-libvirt","title":"\u914d\u7f6e libvirt","text":"<p>\u9996\u5148\uff0c\u6253\u5f00 virt-manager\uff0c\u5728\u5411\u5bfc\u4e2d\uff0c\u53ef\u4ee5\u5728\u4e0b\u62c9\u83dc\u5355\u9009\u62e9\u81ea\u5b9a\u4e49\u7684\u67b6\u6784\uff0c\u9009\u62e9 riscv64 \u548c virt\uff0c\u7136\u540e\u9009\u62e9 Import existing disk image\uff0c\u627e\u5230\u521a\u521a\u521b\u5efa\u7684 qcow2 \u6587\u4ef6\u3002</p> <p>\u521b\u5efa\u597d\u4ee5\u540e\uff0c\u6211\u4eec\u8fd8\u4e0d\u80fd\u76f4\u63a5\u542f\u52a8\uff0c\u56e0\u4e3a\u6b64\u65f6\u8fd8\u6ca1\u6709\u914d\u7f6e OpenSBI \u548c U-Boot\u3002\u7531\u4e8e virt-aa-helper \u4f1a\u68c0\u67e5 OpenSBI \u548c U-Boot \u7684\u8def\u5f84\uff0c\u8981\u6c42\u5b83\u4eec\u4e0d\u80fd\u5728 /usr/lib \u8def\u5f84\u4e0b\uff1a</p> <pre><code>/*\n * Don't allow access to special files or restricted paths such as /bin, /sbin,\n * /usr/bin, /usr/sbin and /etc. This is in an effort to prevent read/write\n * access to system files which could be used to elevate privileges. This is a\n * safety measure in case libvirtd is under a restrictive profile and is\n * subverted and trying to escape confinement.\n *\n * Note that we cannot exclude block devices because they are valid devices.\n * The TEMPLATE file can be adjusted to explicitly disallow these if needed.\n *\n * RETURN: -1 on error, 0 if ok, 1 if blocked\n */\n    const char * const restricted[] = {\n        \"/bin/\",\n        \"/etc/\",\n        \"/lib\",\n        \"/lost+found/\",\n        \"/proc/\",\n        \"/sbin/\",\n        \"/selinux/\",\n        \"/sys/\",\n        \"/usr/bin/\",\n        \"/usr/lib\",\n        \"/usr/sbin/\",\n        \"/usr/share/\",\n        \"/usr/local/bin/\",\n        \"/usr/local/etc/\",\n        \"/usr/local/lib\",\n        \"/usr/local/sbin/\"\n    };\n</code></pre> <p>\u6240\u4ee5\uff0c\u6211\u624b\u52a8\u628a U-Boot \u548c OpenSBI \u590d\u5236\u4e00\u4efd\u5230 /var/lib \u4e0b\uff1a</p> <pre><code>$ sudo mkdir -p /var/lib/custom\n$ cd /var/lib/custom\n$ sudo cp -r /usr/lib/u-boot/qemu-riscv64_smode .\n$ sudo cp -r /usr/lib/riscv64-linux-gnu .\n</code></pre> <p>\u6b64\u65f6\uff0c\u518d\u53bb\u914d\u7f6e libvirt \u7684 XML \u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>  &lt;os&gt;\n    &lt;type arch='riscv64' machine='virt'&gt;hvm&lt;/type&gt;\n    &lt;loader type='rom'&gt;/var/lib/custom/riscv64-linux-gnu/opensbi/generic/fw_jump.elf&lt;/loader&gt;\n    &lt;kernel&gt;/var/lib/custom/qemu-riscv64_smode/uboot.elf&lt;/kernel&gt;\n    &lt;boot dev='hd'/&gt;\n  &lt;/os&gt;\n</code></pre> <p>\u5176\u4f59\u90e8\u5206\u4e0d\u7528\u4fee\u6539\u3002\u5728\u4e0b\u9762\u53ef\u4ee5\u770b\u5230 virt-manager \u5df2\u7ecf\u8bbe\u7f6e\u597d\u4e86 qemu-system-riscv64:</p> <pre><code>&lt;devices&gt;\n  &lt;emulator&gt;/usr/bin/qemu-system-riscv64&lt;/emulator&gt;\n  &lt;disk type='file' device='disk'&gt;\n    &lt;driver name='qemu' type='qcow2'/&gt;\n    &lt;source file='/path/to/rootfs.qcow2'/&gt;\n    &lt;target dev='vda' bus='virtio'/&gt;\n    &lt;address type='pci' domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;\n  &lt;/disk&gt;\n</code></pre> <p>\u4fdd\u5b58\u4ee5\u540e\u76f4\u63a5\u542f\u52a8\uff0c\u5c31\u5b8c\u6210\u4e86\u5728 libvirt \u4e2d\u8fd0\u884c Debian RV64 \u865a\u62df\u673a\u7684\u76ee\u7684\u3002</p>","tags":["qemu","libvirt","virtmanager","debian","riscv","rv64"]},{"location":"software/2019/04/07/rcore-soft-router/","title":"rCore \u8f6f\u8def\u7531\u5b9e\u73b0","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u8f6f\u8def\u7531\u5728 rCore \u4e0a\u7684\u5b9e\u73b0\uff0c\u4f46\u9650\u4e8e\u786c\u4ef6\u9650\u5236\uff0c\u76ee\u524d\u5148\u5728\u865a\u62df\u673a\u91cc\u6d4b\u8bd5\u3002\u8f6f\u8def\u7531\u5927\u6982\u8981\u505a\u8fd9\u4e9b\u4e1c\u897f\uff1a</p> <pre><code>1. \u6293\u5305\uff0c\u89e3\u6790\u5305\u91cc\u7684\u5185\u5bb9\n2. \u67e5\u8def\u7531\u8868\uff0c\u627e\u5230\u4e0b\u4e00\u8df3\u5728\u54ea\n3. \u67e5 ARP\uff0c\u77e5\u9053\u4e0b\u4e00\u8df3\u7684 MAC \u5730\u5740\n4. \u51cf\u5c11 TTL\uff0c\u66f4\u65b0 IP Checksum\n5. \u628a\u5305\u53d1\u51fa\u53bb\n</code></pre> <p>\u7b2c\u4e00\u6b65\u76f4\u63a5\u62ff smoltcp \u7684 Raw Socket \u5373\u53ef\uff0c\u4f46\u662f\u76ee\u524d\u53ea\u80fd\u6293\u6307\u5b9a IP Protocol \u7684\u5305\uff0c\u6211\u7528\u7684\u662f ICMP\uff0c\u4f46\u5176\u4ed6\u7684\u5c31\u8fd8\u6293\u4e0d\u4e86\uff0c\u9700\u8981\u7ee7\u7eed\u6539 Smoltcp \u6e90\u4ee3\u7801\u3002</p> <p>\u7b2c\u4e8c\u6b65\u7528\u7684\u662f\u4e4b\u524d\u521a\u4fee\u597d\u7684 treebitmap \u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\u8def\u7531\u8868\u7684\u67e5\u8be2\u529f\u80fd\uff0c\u76ee\u524d\u8def\u7531\u8868\u8fd8\u662f\u5199\u6b7b\u7684\uff0c\u4e4b\u540e\u4f1a\u7528\u5df2\u7ecf\u90e8\u5206\u5b9e\u73b0\u597d\u7684 Netlink \u63a5\u53e3\u8bfb\u53d6\u51fa\u6765\u3002</p> <p>\u7b2c\u4e09\u6b65\u5219\u662f ioctl \u53d1\u8bf7\u6c42\uff0c\u7136\u540e\u4ece smoltcp \u5185\u90e8\u7684 ARP cache \u91cc\u8bfb\u53d6\u3002</p> <p>\u7b2c\u56db\u6b65\u5f88\u7b80\u5355\uff0c\u4e0d\u7528\u591a\u8bf4\u3002</p> <p>\u7b2c\u4e94\u6b65\u5219\u9700\u8981\u6307\u5b9a\u51fa\u7aef\u53e3\uff0c\u7528\u4e86\u4e00\u4e2a index\uff0c\u653e\u5728\u4e00\u4e2a\u7279\u5b9a\u7684 sockaddr \u4e2d\u3002</p> <p>\u6700\u540e\u7684\u6548\u679c\u5c31\u662f\uff0c\u80fd\u53cc\u5411\u8f6c\u53d1 ping \u901a\u3002</p> <p>\u7f51\u7edc\u62d3\u6251\uff1a</p> <p></p> <p>\u53ef\u4ee5\uff0c\u8fd9\u5f88\u7384\u5b66\u3002</p> <p>\u540e\u7eed\u5728\u60f3\u5728\u771f\u673a\u4e0a\u5b9e\u9a8c\uff0c\u4f46\u662f\u8fd8\u7f3a\u4e00\u4e2a\u7f51\u5361\u9a71\u52a8\uff0c\u4e0d\u7136\u5c31\u53ef\u4ee5\u7528\u795e\u5947\u7684\u529e\u6cd5\u6765\u505a\u8fd9\u4e2a\u5b9e\u9a8c\u4e86\u3002</p>","tags":["rcore","router","ixgbe","os"]},{"location":"software/2019/08/14/read-edid-decode-macos/","title":"macOS \u4e0b\u8bfb\u53d6\u5e76\u89e3\u6790 EDID","text":"<p>\u4e4b\u524d\u542c\u8bf4\u4e86 EDID \u7684\u5b58\u5728\uff0c\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u7ec6\u7a76\u91cc\u9762\u7684\u683c\u5f0f\u548c\u5185\u5bb9\u3002\u4eca\u5929\u4e86\u89e3\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u4e0b\u9762\u662f\u65b9\u6cd5\uff1a</p> <p>\u9996\u5148\u83b7\u53d6\u6240\u6709\u663e\u793a\u5668\u8f93\u51fa\u7684 EDID\uff1a</p> <pre><code>ioreg -lw0 | grep IODisplayEDID\n</code></pre> <p>\u8f93\u51fa\u91cc\u4f1a\u51fa\u73b0 \"IODisplayEDID\" = &lt;00ffxxxxxxxxxxxxx&gt; \u7684\u5185\u5bb9\uff0c\u5c16\u62ec\u53f7\u5185\u7684\u5c31\u662f EDID \u7684\u5185\u5bb9\u3002\u63a5\u7740\uff0c\u6211\u4eec\u91c7\u7528 edid-decode \u8fdb\u884c\u89e3\u6790\uff1a</p> <pre><code>git clone git://linuxtv.org/edid-decode.git\ncd edid-decode\nmake\n./edid-decode\n&lt;Paste EDID here&gt;\n</code></pre> <p>\u5c31\u53ef\u4ee5\u770b\u5230\u5f88\u8be6\u7ec6\u7684 EDID \u6570\u636e\u89e3\u6790\u4e86\u3002</p> <p>ref: https://gist.github.com/OneSadCookie/641549 https://www.avsforum.com/forum/115-htpc-mac-chat/1466910-ability-dump-display-s-edid-mac.html</p>","tags":["macos","edid"]},{"location":"software/2023/12/07/reverse-proxy-partial-transfer/","title":"\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898","text":"<p>\u53cd\u5411\u4ee3\u7406\u5df2\u7ecf\u662f\u65e0\u5904\u4e0d\u5728\uff0c\u4f46\u662f\u5982\u679c\u53cd\u5411\u4ee3\u7406\u6ca1\u6709\u6839\u636e\u4f7f\u7528\u573a\u666f\u8c03\u4f18\uff0c\u6216\u8005\u51fa\u73b0\u4e86\u4e00\u4e9b\u5f02\u5e38\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u4e0d\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u5e76\u4e14\u73b0\u8c61\u5341\u5206\u5947\u602a\uff0c\u4f8b\u5982\u8bbf\u95ee\u67d0 GitLab \u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u5076\u5c14\u4f1a\u51fa\u73b0\u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u7684\u60c5\u51b5\u3002</p> <p>\u8fd9\u4e9b\u95ee\u9898\u56f0\u6270\u4e86\u6211\u4eec\u5f88\u4e45\uff0c\u5230\u6700\u540e\u624d\u53d1\u73b0\uff0c\u539f\u6765\u95ee\u9898\u5728\u53cd\u5411\u4ee3\u7406\u4e0a\u3002\u4e0b\u9762\u5c31\u6765\u56de\u987e\u4e00\u4e0b\u4e8b\u60c5\u7684\u7ecf\u8fc7\u3002</p>","tags":["nginx","proxy","http","network"]},{"location":"software/2023/12/07/reverse-proxy-partial-transfer/#gitlab-\u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u73b0\u8c61","title":"GitLab \u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u73b0\u8c61","text":"<p>\u67d0 GitLab \u5b9e\u4f8b\u4ece\u67d0\u4e00\u5929\u5f00\u59cb\uff0c\u7528\u6237\u5c31\u5f00\u59cb\u53cd\u9988\u9875\u9762\u7ecf\u5e38\u5237\u4e0d\u51fa\u6765\u7684\u95ee\u9898\u3002\u6253\u5f00\u6d4f\u89c8\u5668\u7684 Developer Tools \u67e5\u770b HTTP \u8bf7\u6c42\uff0c\u4f1a\u53d1\u73b0\u51fa\u73b0\u62a5\u9519 <code>ERR_CONTENT_LENGTH_MISMATCH</code>\uff08Chrome\uff09\u6216\u8005 <code>NS_ERROR_NET_PARTIAL_TRANSFER</code>\uff08Firefox\uff09\u3002\u4ece\u540d\u5b57\u6765\u770b\uff0c\u8fd9\u4e2a\u9519\u8bef\u7684\u610f\u601d\u662f\uff0c\u6d4f\u89c8\u5668\u53ea\u6536\u5230\u4e86 HTTP \u54cd\u5e94\u7684\u4e00\u90e8\u5206\uff0c\u4f46\u662f HTTP \u54cd\u5e94\u5934\u90e8\u7684 Content-Length \u5374\u6bd4\u5b9e\u9645\u6536\u5230\u7684\u5185\u5bb9\u8981\u591a\uff0c\u8bf4\u660e\u786e\u5b9e\u662f\u6ca1\u53d1\u5168\u3002\u7528 Wireshark \u6293\u5305\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u7f51\u7ad9\u4e3b\u52a8\u53d1\u7684 FIN\uff0c\u4e5f\u4e0d\u50cf\u662f NAT \u7f51\u5173\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u56f0\u6270\u4e86\u7528\u6237\u548c\u7ba1\u7406\u5458\u5f88\u4e45\uff0c\u4e00\u76f4\u6ca1\u6709\u627e\u5230\u539f\u56e0\u3002\u505a\u4e00\u4e9b\u7b80\u5355\u7684\u6d4b\u8bd5\uff0c\u4f1a\u53d1\u73b0\u4e0b\u8f7d\u662f\u5426\u5b8c\u5168\u548c HTTP \u54cd\u5e94\u7684\u5185\u5bb9\u5927\u5c0f\u6709\u5173\uff0c\u4f8b\u5982\u6d4f\u89c8\u4e00\u4e9b\u5927\u7684 HTML\uff0c\u5c31\u5bb9\u6613\u88ab\u622a\u65ad\uff0c\u5e76\u4e14\u622a\u65ad\u4ee5\u540e\u7684\u957f\u5ea6\u6bd4\u8f83\u7a33\u5b9a\u5730\u51fa\u73b0\u5728\u51e0\u4e2a\u6570\u5b57\u4e4b\u95f4\uff1a130304 \u548c 130269\uff0c\u5927\u6982 130 KB\u3002</p> <p>\u5728\u7f51\u4e0a\u641c\u7d22\u5173\u952e\u8bcd\uff0c\u53ef\u4ee5\u627e\u5230\u8fd9\u4e48\u4e00\u7bc7 StackOverflow \u56de\u7b54\uff1a<code>Express and nginx net::ERR_CONTENT_LENGTH_MISMATCH</code>\uff0c\u770b\u8d77\u6765\u548c\u6211\u4eec\u9047\u5230\u7684\u73b0\u8c61\u5f88\u7c7b\u4f3c\u3002\u56de\u7b54\u4e2d\u63d0\u5230\uff0cNginx \u6709\u5185\u5efa\u7684 buffering \u673a\u5236\uff0c\u5173\u6389\u5b83\u5c31\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u662f\u8fd9\u770b\u8d77\u6765\u592a\u66b4\u529b\u4e86\uff0c\u4e0d\u50cf\u662f\u5408\u7406\u7684\u89e3\u51b3\u529e\u6cd5\uff0c\u6bd5\u7adf buffering \u673a\u5236\u662f\u6709\u7528\u7684\u3002</p> <p>\u4ece Nginx \u5b98\u7f51\u53ef\u4ee5\u627e\u5230 buffering \u673a\u5236\u7684\u8bf4\u660e\uff1a</p> <pre><code>When buffering is enabled, nginx receives a response from the proxied server as\nsoon as possible, saving it into the buffers set by the proxy_buffer_size and\nproxy_buffers directives. If the whole response does not fit into memory, a part\nof it can be saved to a temporary file on the disk. Writing to temporary files\nis controlled by the proxy_max_temp_file_size and proxy_temp_file_write_size\ndirectives.\n</code></pre> <p>\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u610f\u601d\u5c31\u662f Nginx \u6253\u5f00 buffering \u673a\u5236\u540e\uff0c\u4f1a\u5c3d\u91cf\u5feb\u5730\u4ece\u540e\u7aef\u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u3002\u8fd9\u5f88\u5408\u7406\uff0c\u56e0\u4e3a\u4e00\u822c\u540e\u7aef\u670d\u52a1\u5668\u7684\u8d44\u6e90\u6bd4\u8f83\u5b9d\u8d35\uff0c\u5982\u679c\u6709\u5f88\u591a\u4e2a\u94fe\u63a5\u5835\u585e\u4e86\uff0cTCP \u53d1\u9001\u7a97\u53e3\u6ee1\u4e86\uff0c\u53d1\u4e0d\u4e86\u65b0\u7684\u6570\u636e\uff0c\u4e00\u76f4\u5728\u7b49\u5f85\u5ba2\u6237\u7aef\u56de\u590d ACK\uff0c\u8fd9\u6837\u5c31\u4f1a\u7ef4\u6301\u5f88\u591a TCP \u8fde\u63a5\uff0c\u5f71\u54cd\u670d\u52a1\u5668\u5904\u7406\u65b0\u8fde\u63a5\u7684\u80fd\u529b\uff0c\u8fd9\u79cd\u7d2f\u6d3b\u5e94\u8be5\u8fd8\u662f\u7531 Nginx \u6765\u5e72\u3002\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff1aNginx \u4ece\u540e\u7aef\u5c3d\u91cf\u5feb\u5730\u8bfb\u53d6\u54cd\u5e94\uff0c\u4f46\u6d4f\u89c8\u5668\u5e76\u4e0d\u4e00\u5b9a\u80fd\u591f\u5f88\u5feb\u5730\u4ece Nginx \u8bfb\u53d6\u54cd\u5e94\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u5230 Nginx \u7684\u7f51\u7edc\u53ef\u80fd\u5f88\u6162\u3002\u901f\u7387\u4e0d\u5339\u914d\uff0c\u90a3\u4e48 Nginx \u80af\u5b9a\u8981\u5b9e\u73b0\u4e00\u5b9a\u7684\u7f13\u5b58\uff0c\u8fd9\u5c31\u662f buffering \u673a\u5236\u3002</p> <p>\u5177\u4f53\u5730\uff0c\u4e3a\u4e86\u5b9e\u73b0\u9ad8\u6548\u7684 buffering \u673a\u5236\uff0c\u5f88\u81ea\u7136\u5730\u56de\u60f3\u5230\u7528\u5185\u5b58\u505a buffer\u3002\u4f46\u662f\u5185\u5b58\u5bb9\u91cf\u4e5f\u662f\u76f8\u5bf9\u6709\u9650\u7684\uff0c\u5185\u5b58\u653e\u4e0d\u4e0b\uff0c\u81ea\u7136\u5c31\u53ea\u80fd\u5199\u5230\u786c\u76d8\u91cc\u9762\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u8981\u662f\u786c\u76d8\u4e5f\u6ee1\u4e86\uff0c\u6216\u8005\u5199\u5165\u786c\u76d8\u5931\u8d25\u4e86\uff0c\u600e\u4e48\u529e\uff1f\u4e00\u65b9\u9762\uff0c\u8fd8\u5f97\u8d76\u7d27\u4ece\u540e\u7aef\u8bfb\u53d6\u54cd\u5e94\uff0c\u8ba9\u540e\u7aef\u53bb\u505a\u522b\u7684\u4e8b\u60c5\uff1b\u53e6\u4e00\u65b9\u9762\uff0c\u5ba2\u6237\u7aef\u5728\u6162\u541e\u541e\u5730\u6536\u6570\u636e\uff0c\u786c\u76d8\u53c8\u5199\u4e0d\u8fdb\u53bb\u3002\u8fd9\u65f6\u5019 Nginx \u53ea\u80fd\u653e\u5f03\u6323\u624e\uff0c\u628a\u8fde\u63a5\u65ad\u6389\u3002\u4e8e\u662f\u5ba2\u6237\u7aef\u5c31\u770b\u5230\u4e86 HTTP \u54cd\u5e94\u4f20\u4e86\u4e00\u534a\u7684\u60c5\u51b5\u3002</p> <p>\u8fd9\u4e5f\u5c31\u80fd\u89e3\u91ca\u4e4b\u524d\u89c2\u5bdf\u5230\u7684\u4e00\u4e2a\u73b0\u8c61\uff1a\u6709\u7684\u7f51\u9875\uff0c\u8d70\u6709\u7ebf\u7f51\u80fd\u591f\u5b8c\u6574\u6253\u5f00\uff0c\u8d70\u65e0\u7ebf\u7f51\u6253\u5f00\u662f\u4e0d\u5b8c\u6574\u7684\u3002\u4ece buffering \u673a\u5236\u6765\u89e3\u91ca\uff0c\u5c31\u662f\u6709\u7ebf\u7f51\u80fd\u591f\u5728 buffer \u6ee1\u4e4b\u524d\u628a\u6570\u636e\u90fd\u4f20\u5b8c\uff0c\u800c\u65e0\u7ebf\u7f51\u6765\u4e0d\u53ca\u3002</p>","tags":["nginx","proxy","http","network"]},{"location":"software/2023/12/07/reverse-proxy-partial-transfer/#\u672c\u5730\u590d\u73b0","title":"\u672c\u5730\u590d\u73b0","text":"<p>\u7406\u8bba\u7406\u89e3\u4e86\uff0c\u4e0b\u9762\u6765\u5b9e\u8df5\u4e00\u4e0b\u3002\u6211\u4eec\u7528 docker compose \u542f\u52a8\u4e24\u4e2a\u5bb9\u5668\uff0c\u4e00\u4e2a\u5bb9\u5668 proxy \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\uff0c\u8fd0\u884c\u4e00\u4e2a nginx\uff1b\u53e6\u4e00\u4e2a\u5bb9\u5668 backend \u4f5c\u4e3a\u540e\u7aef\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u4e5f\u8dd1\u4e86\u4e2a nginx\uff0c\u670d\u52a1\u4e00\u4e2a\u7b80\u5355\u7684\u5927 HTML \u6587\u4ef6\u3002\u540e\u7aef\u7528\u5176\u4ed6\u8f6f\u4ef6\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u53ea\u8981\u53ef\u4ee5\u6784\u5efa\u51fa\u8db3\u591f\u5927\u7684 HTTP \u54cd\u5e94\uff08MB \u91cf\u7ea7\uff09\u3002</p> <p>Docker compose \u914d\u7f6e\uff1a</p> <pre><code>services:\n  backend:\n    image: nginx:stable\n    ports:\n      - \"127.0.0.1:8001:80\"\n    volumes:\n      - ./backend.conf:/etc/nginx/conf.d/default.conf:ro\n      - ./backend:/web:ro\n  proxy:\n    image: nginx:stable\n    ports:\n      - \"127.0.0.1:8002:80\"\n    volumes:\n      - ./proxy.conf:/etc/nginx/conf.d/default.conf:ro\n</code></pre> <p>\u540e\u7aef Nginx \u914d\u7f6e\uff1a</p> <pre><code>server {\n    listen 80;\n    location / {\n        root /web;\n    }\n}\n</code></pre> <p>\u53cd\u5411\u4ee3\u7406 Nginx \u914d\u7f6e\uff1a</p> <pre><code>server {\n    listen 80;\n    location / {\n        proxy_pass http://backend;\n    }\n}\n</code></pre> <p>\u90a3\u4e48\u5bf9\u53cd\u4ee3\u7684\u8bbf\u95ee\uff0c\u5c31\u80fd\u8bbf\u95ee\u5230\u540e\u7aef\u4e0a\u7684 <code>index.html</code> \u4e86\u3002\u5728\u672c\u5730\u521b\u5efa\u4e00\u4e2a\u8db3\u591f\u5927\u7684 <code>index.html</code> \u6587\u4ef6\uff0c\u786e\u8ba4\u4e0b\u8f7d\u90fd\u6ca1\u6709\u95ee\u9898\u3002</p> <p>\u5728\u641e\u7834\u574f\u4e4b\u524d\uff0c\u53ef\u4ee5\u5148\u7528 <code>inotifywait</code> \u5de5\u5177\u6765\u89c2\u5bdf Nginx \u8bfb\u5199\u6587\u4ef6\u7684\u884c\u4e3a\uff1a</p> <pre><code>apt update\napt install inotify-tools\ndocker exec -it nginx-partial-content-test-proxy-1 /bin/bash\ninotifywait -r -m /var/cache/nginx\n</code></pre> <p>\u7528 ApacheBench \u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\uff1a<code>ab -n 10000 -c 10 http://localhost:8002/</code>\uff0c\u53ef\u4ee5\u770b\u5230 <code>inotifywait</code> \u663e\u793a Nginx \u8fdb\u7a0b\u5bf9 <code>/var/cache/nginx/proxy_temp</code> \u76ee\u5f55\u4e0b\u8fdb\u884c\u4e86\u5927\u91cf\u7684\u8bfb\u5199\uff0c\u8fd9\u5c31\u662f\u524d\u9762\u6240\u8ff0\u7684 buffering \u673a\u5236\uff0c\u7528\u6765\u4fdd\u5b58\u6587\u4ef6\u7684\u8def\u5f84\u3002</p> <p>\u63a5\u4e0b\u6765\u4fee\u6539\u6743\u9650\uff0c\u8ba9 Nginx \u65e0\u6cd5\u8bfb\u53d6\u8be5\u76ee\u5f55\uff1a</p> <pre><code>docker exec -it nginx-partial-content-test-proxy-1 /bin/bash\nchmod 000 /var/cache/nginx/proxy_temp\n</code></pre> <p>\u6b64\u65f6\u518d\u53bb\u8dd1 ApacheBench\uff0c\u4f1a\u53d1\u73b0\u5927\u90e8\u5206\u8bf7\u6c42\u90fd\u56e0\u4e3a\u957f\u5ea6\u95ee\u9898\u5931\u8d25\u4e86\uff1a</p> <pre><code>Concurrency Level:      10\nTime taken for tests:   5.707 seconds\nComplete requests:      10000\nFailed requests:        9999\n   (Connect: 0, Receive: 0, Length: 9999, Exceptions: 0)\n</code></pre> <p>\u7528 curl \u4e5f\u53ef\u4ee5\u6d4b\u8bd5\u51fa\u7c7b\u4f3c\u7684\u9519\u8bef\uff1a<code>curl: (18) transfer closed with 455593 bytes remaining to read</code>\u3002\u6b64\u65f6 proxy \u5bb9\u5668\u4e5f\u4f1a\u62a5\u9519\uff1a<code>open() \"/var/cache/nginx/proxy_temp/7/63/0000014637\" failed (13: Permission denied) while reading upstream, client: 172.18.0.1, server: , request: \"GET / HTTP/1.1\", upstream: \"http://172.18.0.3:80/\", host: \"localhost:8002\"</code>\u3002\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u4e5f\u590d\u73b0\u4e86\u4e4b\u524d\u5728 GitLab \u5b9e\u4f8b\u4e0a\u770b\u5230\u7684\u73b0\u8c61\u3002\u6062\u590d\u76ee\u5f55\u6743\u9650\u4ee5\u540e\uff0c\u4e00\u5207\u90fd\u6b63\u5e38\u4e86\u3002</p> <p>\u8fd9\u5370\u8bc1\u4e86\u4e4b\u524d\u7684\u731c\u60f3\uff1a<code>proxy_temp</code> \u76ee\u5f55\u5199\u4e0d\u8fdb\u53bb\uff0c\u5c31\u6709\u6982\u7387\u51fa\u73b0 Partial Transfer \u7684\u60c5\u51b5\u3002\u4f46\u662f\uff0c\u6b64\u65f6\u4e0b\u8f7d\u7684\u6587\u4ef6\u5927\u5c0f\u6bd4\u8f83\u968f\u673a\uff0c\u4e0d\u50cf\u4e4b\u524d\u90a3\u6837\u96c6\u4e2d\u5728 130 KB\u3002\u8fd9\u65f6\u5019\u5c31\u8981\u601d\u8003 Partial Transfer \u7684\u539f\u7406\u4e86\uff1a\u5ba2\u6237\u7aef\u53d1\u8d77 HTTP \u8bf7\u6c42\uff0cproxy \u5bb9\u5668\u6536\u5230\u8bf7\u6c42\uff0c\u8f6c\u53d1\u7ed9 backend\uff1bbackend \u6536\u5230 HTTP \u8bf7\u6c42\u540e\uff0c\u5c31\u7ed9 proxy \u53d1\u9001 HTTP \u54cd\u5e94\u3002\u7136\u540e proxy \u5bb9\u5668\u4e00\u8fb9\u4ece backend \u63a5\u6536 HTTP \u54cd\u5e94\uff0c\u53e6\u4e00\u8fb9\u8fd8\u8981\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u65ad\u5f00\u5462\uff1f\u5c31\u662f\u5185\u5b58\u91cc\u7684 buffer \u90fd\u7528\u5b8c\u4e86\uff0cbackend \u7ed9 proxy \u53d1\u9001\u5f97\u5feb\uff0cproxy \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u5f97\u6162\uff0c\u901f\u5ea6\u7684\u5dee\uff0c\u51b3\u5b9a\u4e86\u5185\u5b58\u91cc\u7684 buffer \u53ef\u4ee5\u6491\u591a\u4e45\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u7406\u8bba\uff0c\u624b\u52a8\u7ed9\u5ba2\u6237\u7aef\u5230 proxy \u5bb9\u5668\u7684\u94fe\u8def\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5ef6\u8fdf\uff0c\u8fd9\u6837\u5c31\u62d6\u6162\u4e86 proxy \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u901f\u5f55\u3002\u5728 Linux \u4e0a\uff0c\u53ef\u4ee5\u7528 tc \u7ed9\u7f51\u7edc\u63a5\u53e3\u4eba\u4e3a\u5730\u6dfb\u52a0\u5ef6\u8fdf\uff1a</p> <pre><code>tc qdisc add dev [bridge_name] root netem delay 100ms\n</code></pre> <p>`bridge_name`` \u662f\u4ee5 br- \u5f00\u5934\u7684 bridge \u7f51\u7edc\u63a5\u53e3\u540d\u3002\u6b64\u65f6\u7528 ping \u6d4b\u91cf\uff0c\u4ece proxy \u5bb9\u5668\u8bbf\u95ee host \u8981 100 ms\uff0cproxy \u5bb9\u5668\u8bbf\u95ee backend \u5bb9\u5668\u8981 0.02 ms\u3002\u8fd9\u5c31\u8fbe\u6210\u4e86\u4e0d\u5bf9\u79f0\u7684\u76ee\u7684\u3002\u6dfb\u52a0\u4e86\u5ef6\u8fdf\u540e\uff0c\u53d1\u73b0 curl \u4e0b\u8f7d\u7684\u6587\u4ef6\u5927\u5c0f\u7a33\u5b9a\u5728 109312 \u5b57\u8282\u9644\u8fd1\uff0c\u4e5f\u5c31\u662f 109 KB\u3002\u867d\u7136\u548c\u524d\u9762\u7684 130 KB \u4e0d\u76f8\u7b49\uff0c\u4f46\u662f\u4e5f\u8db3\u4ee5\u8bc1\u660e\u4e86\u662f\u7c7b\u4f3c\u7684\u60c5\u51b5\u3002\u8fd9\u4e2a\u5927\u5c0f\uff0c\u5e94\u8be5\u548c nginx \u5728\u5185\u5b58\u4e2d\u7ed9\u6bcf\u4e2a\u94fe\u63a5\u7ef4\u62a4\u7684 buffer \u5927\u5c0f\u6709\u5173\uff0c\u4e5f\u548c\u7f51\u7edc\u4e0a\u4f20\u8f93\u7684\u8fc7\u7a0b\u6709\u5173\u3002</p> <p>\u5c0f\u7ed3\uff1a</p> <ol> <li>\u56e0 nginx \u5bb9\u5668\u4e0a proxy_temp \u8def\u5f84\u4e0b\u65e0\u6cd5\u5199\u5165\u6587\u4ef6\uff08\u4f8b\u5982\u6743\u9650\u4e0d\u6b63\u786e\u3001\u76d8\u6ee1\u4e86\uff09\uff0cnginx \u7684 buffering \u673a\u5236\u5728\u9047\u5230\u5185\u5b58\u4e2d buffer \u7528\u5b8c\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u622a\u65ad HTTP \u54cd\u5e94\uff1b</li> <li>\u6839\u636e\u5ba2\u6237\u7aef\u5230 nginx\uff0cnginx \u5230\u540e\u7aef\u7684\u5e26\u5bbd\u548c\u5ef6\u8fdf\u60c5\u51b5\uff0c\u53ef\u80fd\u4f1a\u622a\u65ad\u5230\u4e0d\u540c\u7684\u4f4d\u7f6e\u3002</li> </ol>","tags":["nginx","proxy","http","network"]},{"location":"software/2023/12/07/reverse-proxy-partial-transfer/#\u6743\u9650\u95ee\u9898","title":"\u6743\u9650\u95ee\u9898","text":"<p>\u6709\u610f\u601d\u7684\u662f\uff0c\u7ba1\u7406\u5458\u8868\u793a\u4e4b\u524d\u5e76\u6ca1\u6709\u6539\u8fc7\u76ee\u5f55\u7684\u6743\u9650\u3002\u5728\u7f51\u4e0a\u67e5\u4e86\u4e00\u4e0b\uff0c\u6709\u7f51\u53cb\u53cd\u9988\u9047\u5230\u4e86\u7c7b\u4f3c\u7684\u95ee\u9898\uff1aChanging ownership of proxy_temp and other temp directories\u3002\u7f51\u53cb\u8868\u793a\uff0c\u4ed6\u5347\u7ea7 nginx \u4e4b\u524d\uff0cproxy_temp \u8def\u5f84\u7684\u6743\u9650\u662f\u5f52 nobody \u6240\u6709\uff0cnginx \u4e5f\u662f\u7528 nobody \u7528\u6237\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u6ca1\u6709\u95ee\u9898\u3002\u5347\u7ea7 nginx \u4ee5\u540e\uff0cnginx \u7528\u5355\u72ec\u7684 nginx \u7528\u6237\u53bb\u6267\u884c\uff0c\u6b64\u65f6\u5b83\u6ca1\u6709\u529e\u6cd5\u8bbf\u95ee nobody \u7528\u6237\u521b\u5efa\u7684\u6587\u4ef6\u5939\uff0c\u56e0\u4e3a\u6743\u9650\u662f <code>rwx------</code>\u3002</p> <p>\u5982\u679c\u6df1\u5165\u89c2\u5bdf\u90ae\u4ef6\u56de\u590d\uff0c\u4f1a\u53d1\u73b0\u6700\u7ec8\u5f15\u5230\u4e86\u4e00\u4e2a GitHub commit\uff0c\u5b83\u5728\u7ed9 nginx \u6dfb\u52a0\u65b0\u529f\u80fd\u7684\u540c\u65f6\uff0c\u4fee\u6539\u4e86\u9ed8\u8ba4\u7684 nginx \u7528\u6237\u8bbe\u7f6e\uff0c\u4f7f\u5f97\u9ed8\u8ba4\u7528\u6237\u53d8\u6210\u4e86 nginx\u3002\u4ece\u7ef4\u62a4\u8005\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u628a nobody \u6362\u6210 nginx \u7528\u6237\uff0c\u5e94\u8be5\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\u3002\u5374\u4e0d\u77e5\u9053 nginx \u4f1a\u7528 nobody \u7528\u6237\u521b\u5efa proxy_temp \u7b49\u76ee\u5f55\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u4e25\u683c\u7684\u6743\u9650\u3002\u4e00\u5347\u7ea7\uff0c\u7528\u6237\u4e00\u53d8\uff0cnginx \u81ea\u5df1\u5c31\u7528\u4e0d\u4e86\u4e86\u3002\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u95ee\u9898\u3002</p> <p>\u5728\u67d0 GitLab \u5b9e\u4f8b\u7684\u95ee\u9898\u4e0a\uff0c\u6700\u540e\u53d1\u73b0\u786e\u5b9e\u662f\u6743\u9650\u95ee\u9898\u3002\u4f46\u662f\u7ec6\u8282\u548c\u4e0a\u9762\u7684\u4e5f\u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u5177\u4f53\u6743\u9650\u600e\u4e48\u574f\u7684\uff0c\u76ee\u524d\u8fd8\u662f\u4e00\u4e2a\u8c1c\u3002</p>","tags":["nginx","proxy","http","network"]},{"location":"software/2022/07/01/rsyslog-remote/","title":"rsyslog \u6536\u96c6\u8fdc\u7a0b\u65e5\u5fd7","text":"","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/07/01/rsyslog-remote/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u8fd0\u7ef4\u7684\u65f6\u5019\u53d1\u73b0\u7f51\u7edc\u8bbe\u5907\uff08\u5982\u4ea4\u6362\u673a\uff09\u6709\u4e00\u4e2a\u8fdc\u7a0b\u53d1\u9001\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u5373\u53ef\u4ee5\u901a\u8fc7 syslog udp \u534f\u8bae\u53d1\u9001\u65e5\u5fd7\u5230\u6307\u5b9a\u7684\u670d\u52a1\u5668\u3002\u4e3a\u6b64\uff0c\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c rsyslog \u5e76\u6536\u96c6\u65e5\u5fd7\u3002</p>","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/07/01/rsyslog-remote/#rsyslog-\u914d\u7f6e","title":"rsyslog \u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u7684 rsyslog \u914d\u7f6e\u662f\u6536\u96c6\u7cfb\u7edf\u672c\u5730\u7684\u914d\u7f6e\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u7f16\u5199\u4e00\u4e2a rsyslog \u914d\u7f6e\uff0c\u7528\u4e8e\u6536\u96c6\u8fdc\u7a0b\u7684\u65e5\u5fd7\u3002</p> <p>\u9996\u5148\u590d\u5236 <code>/etc/rsyslog.conf</code> \u5230 <code>/etc/rsyslog-remote.conf</code>\uff0c\u7136\u540e\u4fee\u6539\uff1a</p> <ol> <li>\u6ce8\u91ca\u6389 <code>imuxsock</code> \u548c <code>imklog</code> \u76f8\u5173\u7684 module \u52a0\u8f7d</li> <li>\u53bb\u6389 <code>imudp</code> \u548c <code>imtcp</code> \u76f8\u5173\u7684\u6ce8\u91ca\uff0c\u8fd9\u6837\u5c31\u4f1a\u76d1\u542c\u5728\u76f8\u5e94\u7684\u7aef\u53e3\u4e0a</li> <li>\u4fee\u6539 <code>$WorkDirectory</code>\uff0c\u4f8b\u5982 <code>$WorkDirectory /var/spool/rsyslog-remote</code>\uff0c\u9632\u6b62\u4e0e\u5df2\u6709\u7684 rsyslog \u51b2\u7a81</li> <li>\u6ce8\u91ca <code>$IncludeConfig</code>\uff0c\u9632\u6b62\u5f15\u5165\u4e86\u4e0d\u5fc5\u8981\u7684\u914d\u7f6e</li> <li>\u6ce8\u91ca\u6240\u6709\u5df2\u6709\u7684 <code>RULES</code> \u4e0b\u9762\u7684\u914d\u7f6e</li> <li>\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</li> </ol> <pre><code>$template FromIp,\"/var/log/rsyslog-remote/%FROMHOST-IP%.log\"\n*.* ?FromIp\n</code></pre> <p>\u8fd9\u6837\uff0c\u5c31\u4f1a\u6309\u7167\u6765\u6e90\u7684 IP \u5730\u5740\u8fdb\u884c\u5206\u7c7b\uff0c\u7136\u540e\u90fd\u5199\u5165\u5230 <code>/var/log/rsyslog-remote/x.x.x.x.log</code> \u6587\u4ef6\u91cc\u3002</p>","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/07/01/rsyslog-remote/#systemd-service","title":"systemd service","text":"<p>\u6700\u540e\uff0c\u5199\u4e00\u4e2a systemd service \u8ba9\u5b83\u81ea\u52a8\u542f\u52a8\uff1a</p> <pre><code>[Unit]\nConditionPathExists=/etc/rsyslog-remote.conf\nDescription=Remote Syslog Service\n\n[Service]\nType=simple\nPIDFile=/var/run/rsyslogd-remote.pid\nExecStart=/usr/sbin/rsyslogd -n -f /etc/rsyslog-remote.conf -i /var/run/rsyslogd-remote.pid\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <pre><code>systemctl daemon-reload\nsystemctl enable --now rsyslog-remote\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u8fdc\u7a0b\u65e5\u5fd7\u7684\u6536\u96c6\u3002</p>","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/07/01/rsyslog-remote/#logrotate-\u8bbe\u7f6e","title":"logrotate \u8bbe\u7f6e","text":"<p>\u4e3a\u4e86\u9632\u6b62\u65e5\u5fd7\u592a\u591a\uff0c\u8fd8\u9700\u8981\u914d\u7f6e logrotate\u3002</p> <p>\u590d\u5236 <code>/etc/logrotate.d/rsyslog</code> \u5230 <code>/etc/logrotate.d/rsyslog-remote</code>\uff0c\u7136\u540e\u4fee\u6539\u5f00\u5934\u4e3a <code>/var/log/rsyslog-remote/*.log</code> \u5373\u53ef\uff0c\u8def\u5f84\u548c\u4e0a\u9762\u5bf9\u5e94\u3002\u6ce8\u610f\u811a\u672c <code>/usr/lib/rsyslog/rsyslog-remote</code> \u4e5f\u9700\u8981\u590d\u5236\u4e00\u4efd\uff0c\u7136\u540e\u4fee\u6539\u4e00\u4e0b systemd service \u540d\u5b57\u3002</p>","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/07/01/rsyslog-remote/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>How to Set Up Remote Logging on Linux Using rsyslog</li> <li>Configuring Remote Logging using rsyslog in CentOS/RHEL</li> <li>How to Setup Central Logging Server with Rsyslog in Linux</li> <li>How to Setup Rsyslog Client to Send Logs to Rsyslog Server in CentOS 7</li> </ul>","tags":["linux","rsyslog","remote","logging"]},{"location":"software/2022/08/02/rust-nix/","title":"\u7528 Nix \u7f16\u8bd1 Rust \u9879\u76ee","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>Rust \u9879\u76ee\u4e00\u822c\u662f\u7528 Cargo \u7ba1\u7406\uff0c\u4f46\u662f\u5b83\u7684\u7f3a\u70b9\u662f\u6bcf\u4e2a\u9879\u76ee\u90fd\u8981\u91cd\u65b0\u7f16\u8bd1\u4e00\u6b21\u6240\u6709\u4f9d\u8d56\uff0c\u786c\u76d8\u7a7a\u95f4\u5360\u7528\u8f83\u5927\uff0c\u4e0d\u80fd\u8de8\u9879\u76ee\u5171\u4eab\u7f16\u8bd1\u7f13\u5b58\u3002\u8c03\u7814\u4e86\u4e00\u4e0b\uff0c\u6709\u82e5\u5e72\u57fa\u4e8e Nix \u7684 Rust \u6784\u5efa\u5de5\u5177\uff1a</p> <ul> <li>cargo2nix: https://github.com/cargo2nix/cargo2nix</li> <li>carnix: \u4e0d\u518d\u66f4\u65b0</li> <li>crane: https://github.com/ipetkov/crane</li> <li>crate2nix: https://github.com/kolloch/crate2nix</li> <li>naersk: https://github.com/nix-community/naersk</li> <li>nocargo: https://github.com/oxalica/nocargo</li> </ul> <p>\u4e0b\u9762\u6211\u5206\u522b\u6765\u5c1d\u8bd5\u4e00\u4e0b\u8fd9\u51e0\u4e2a\u5de5\u5177\u7684\u4f7f\u7528\u3002</p> <p>\u4e0b\u9762\u51fa\u73b0\u7684\u4e00\u4e9b\u547d\u4ee4\u53c2\u8003\u4e86\u5bf9\u5e94\u9879\u76ee\u7684\u6587\u6863\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#cargo2nix","title":"cargo2nix","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5356\u70b9","title":"\u5356\u70b9","text":"<p>cargo2nix \u7684 README \u63d0\u5230\u4e86\u5b83\u7684\u5356\u70b9\uff1a</p> <ul> <li>Development Shell - knowing all the dependencies means easy creation of complete shells. Run nix develop or direnv allow in this repo and see!</li> <li>Caching - CI &amp; CD pipelines move faster when purity guarantees allow skipping more work!</li> <li>Reproducibility - Pure builds. Access to all of nixpkgs for repeatable environment setup across multiple distributions and platforms</li> </ul>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>cargo2nix \u63d0\u4f9b\u4e86 flakes \u652f\u6301\uff0c\u4e0d\u9700\u8981\u5355\u72ec\u5b89\u88c5\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>cargo2nix \u7684\u8fd0\u884c\u6bd4\u8f83\u7b80\u5355\uff0c\u5229\u7528 flakes \u7684\u7279\u6027\uff0c\u76f4\u63a5 <code>nix run</code> \u5373\u53ef\uff1a</p> <pre><code>nix run github:cargo2nix/cargo2nix\n</code></pre> <p>\u5b83\u4f1a\u751f\u6210\u4e00\u4e2a Cargo.nix \u6587\u4ef6\uff0c\u8fd8\u9700\u8981\u7f16\u5199\u4e00\u4e2a <code>flake.nix</code> \u914d\u5408\u4f7f\u7528\uff0c\u8fd9\u91cc\u4ee5 <code>jiegec/webhookd</code> \u4e3a\u4f8b\uff1a</p> <pre><code>{\n  inputs = {\n    cargo2nix.url = \"github:cargo2nix/cargo2nix/release-0.11.0\";\n    flake-utils.follows = \"cargo2nix/flake-utils\";\n    nixpkgs.follows = \"cargo2nix/nixpkgs\";\n  };\n\n  outputs = inputs: with inputs;\n    flake-utils.lib.eachDefaultSystem (system:\n      let\n        pkgs = import nixpkgs {\n          inherit system;\n          overlays = [cargo2nix.overlays.default];\n        };\n\n        rustPkgs = pkgs.rustBuilder.makePackageSet {\n          rustVersion = \"1.61.0\";\n          packageFun = import ./Cargo.nix;\n        };\n\n      in rec {\n        packages = {\n          webhookd = (rustPkgs.workspace.webhookd {}).bin;\n          default = packages.webhookd;\n        };\n      }\n    );\n}\n</code></pre> <p>\u7136\u540e\u7f16\u8bd1\uff1a</p> <pre><code>$ git add .\n$ nix build\n$ ./result-bin/bin/webhookd --version\nwebhookd 0.2.1\n</code></pre>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u539f\u7406","title":"\u539f\u7406","text":"<p>cargo2nix \u89e3\u6790\u4e86 Cargo.lock\uff0c\u751f\u6210 Cargo.nix \u6587\u4ef6\uff0c\u6700\u540e\u5305\u88c5\u6210 flake.nix\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#crane","title":"crane","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5356\u70b9_1","title":"\u5356\u70b9","text":"<p>crane \u7684 README \u63d0\u5230\u4e86\u5b83\u7684\u5356\u70b9\uff1a</p> <ul> <li>Source fetching: automatically done using a Cargo.lock file</li> <li>Incremental: build your workspace dependencies just once, then quickly lint, build, and test changes to your project without slowing down</li> <li>Composable: split builds and tests into granular steps. Gate CI without burdening downstream consumers building from source.</li> </ul>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5b89\u88c5_1","title":"\u5b89\u88c5","text":"<p>crane \u4e0d\u9700\u8981\u5b89\u88c5\uff0c\u76f4\u63a5\u7528 flakes \u5373\u53ef\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u4f7f\u7528_1","title":"\u4f7f\u7528","text":"<p>crane \u4f7f\u7528\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u5728\u9879\u76ee\u4e2d\u7f16\u5199 <code>flake.nix</code>\uff1a</p> <pre><code>{\n  inputs = {\n    nixpkgs.url = \"github:NixOS/nixpkgs/nixpkgs-unstable\";\n    crane.url = \"github:ipetkov/crane\";\n    crane.inputs.nixpkgs.follows = \"nixpkgs\";\n    flake-utils.url = \"github:numtide/flake-utils\";\n  };\n\n  outputs = { self, nixpkgs, crane, flake-utils, ... }:\n    flake-utils.lib.eachDefaultSystem (system: {\n      packages.default = crane.lib.${system}.buildPackage {\n        src = ./.;\n      };\n    });\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u5de5\u5177\u4ece Cargo.lock \u751f\u6210\u5bf9\u5e94\u7684 Cargo.nix\u3002</p> <p>\u4f46\u662f\u7531\u4e8e webhookd \u4f9d\u8d56 native \u5e93\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u9700\u8981\u624b\u52a8\u52a0\u5165 native \u4f9d\u8d56\uff1a</p> <pre><code>{\n  inputs = {\n    nixpkgs.url = \"github:NixOS/nixpkgs/nixpkgs-unstable\";\n    crane.url = \"github:ipetkov/crane\";\n    crane.inputs.nixpkgs.follows = \"nixpkgs\";\n    flake-utils.url = \"github:numtide/flake-utils\";\n  };\n\n  outputs = { self, nixpkgs, crane, flake-utils, ... }:\n    flake-utils.lib.eachDefaultSystem (system:\n      let\n        pkgs = import nixpkgs {\n          inherit system;\n        };\n      in\n      {\n        packages.default = crane.lib.${system}.buildPackage {\n          src = ./.;\n\n          buildInputs = with pkgs; [\n            libiconv\n            darwin.apple_sdk.frameworks.Security\n          ];\n        };\n      });\n}\n</code></pre> <p>\u6784\u5efa\uff1a</p> <pre><code>$ nix build\n$ ./result/bin/webhookd --version\nwebhookd 0.2.1\n</code></pre>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u539f\u7406_1","title":"\u539f\u7406","text":"<p>crane \u4f1a\u628a\u6240\u6709\u7684\u4f9d\u8d56\u4e0b\u8f7d\u8d77\u6765\u7528 cargo \u8fdb\u884c\u4e00\u6b21\u6784\u5efa\uff0c\u628a\u751f\u6210\u7684 target \u76ee\u5f55\u6253\u6210 <code>target.tar.zst</code>\uff0c\u7136\u540e\u518d\u52a0\u4e0a\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u518d\u6784\u5efa\u4e00\u6b21\uff0c\u8fd9\u6837\u6765\u5b9e\u73b0 incremental compilation\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b check lint \u7b49\u5b9e\u7528\u7684\u547d\u4ee4\u3002\u4f46\u662f\uff0c\u5b83\u7684\u76ee\u7684\u548c\u5176\u4ed6\u9879\u76ee\u4e0d\u5927\u4e00\u6837\uff0c\u5b83\u5e76\u4e0d\u8003\u8651\u8de8\u9879\u76ee\u7684\u4f9d\u8d56\u7f13\u5b58\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#crate2nix","title":"crate2nix","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5356\u70b9_2","title":"\u5356\u70b9","text":"<p>crate2nix \u5728 README \u4e2d\u5199\u7684\u5356\u70b9\uff1a</p> <ul> <li>Same dependency tree as cargo: It uses cargo_metadata to obtain the dependency tree from cargo. Therefore, it will use the exact same library versions as cargo and respect any locked down version in Cargo.lock.</li> <li>Smart caching: It uses smart crate by crate caching so that nix rebuilds exactly the crates that need to be rebuilt. Compare that to docker layers...</li> <li>Nix ecosystem goodness: You can use all things that make the nix/NixOS ecosystem great, e.g. distributed/remote builds, build minimal docker images, deploy your binary as a service to the cloud with NixOps, ...</li> <li>Out of the box support for libraries with non-rust dependencies: It builds on top of the buildRustCrate function from NixOS so that native dependencies of many rust libraries are already correctly fetched when needed. If your library with native dependencies is not yet supported, you can customize defaultCrateOverrides / crateOverrides, see below.</li> <li>Easy to understand nix template: The actual nix code is generated via templates/build.nix.tera so you can fix/improve the nix code without knowing rust if all the data is already there.</li> </ul>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5b89\u88c5_2","title":"\u5b89\u88c5","text":"<p>\u9996\u5148\u8981\u5b89\u88c5 crate2nix\uff0c\u7531\u4e8e\u5b83\u7684\u7a33\u5b9a\u7248\u672c 0.10.0 \u5df2\u7ecf\u662f\u53bb\u5e74\u7684\u7248\u672c\u4e86\uff0c\u6211\u76f4\u63a5\u7528\u4e86 master \u5206\u652f\u3002\u5982\u679c\u662f\u76f4\u63a5\u5b89\u88c5\uff0c\u7528\uff1a</p> <pre><code>nix-env -i -f https://github.com/kolloch/crate2nix/tarball/master\n</code></pre> <p>\u4f46\u6211\u662f\u7528 flakes + home-manager \u7ba1\u7406\u7684\uff0c\u6240\u4ee5\u6211\u5b9e\u9645\u7684\u914d\u7f6e\u65b9\u6cd5\u662f\uff1a</p> <ol> <li>\u5411 flake.nix \u6dfb\u52a0 crate2nix \u5230 inputs\uff0c\u5e76\u4e14\u8bbe\u7f6e <code>crate2nix.flake = false</code></li> <li>\u628a crate2nix \u4ece inputs \u4f20\u5230\u5b9e\u9645\u7684 home manager \u914d\u7f6e\uff0c\u7136\u540e\u5728 <code>home.packages</code> \u91cc\u52a0\u5165 <code>callPackage crate2nix {}</code></li> </ol>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u4f7f\u7528_2","title":"\u4f7f\u7528","text":"<p>\u63a5\u4e0b\u6765\uff0c\u627e\u5230\u4e00\u4e2a Rust \u9879\u76ee\uff0c\u5728\u5176\u4e2d\u8fd0\u884c <code>crate2nix generate</code>:</p> <pre><code>$ crate2nix generate\nGenerated ./Cargo.nix successfully.\n</code></pre> <p>\u6784\u5efa\uff1a</p> <pre><code>nix build -f Cargo.nix rootCrate.build\n</code></pre> <p>\u7f16\u8bd1\u7684\u7ed3\u679c\u53ef\u4ee5\u5728 <code>result/bin</code> \u4e0b\u770b\u5230\u3002</p> <p>\u6211\u7f16\u8bd1\u7684\u662f <code>jiegec/webhookd</code>\uff0c\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u62a5\u9519\uff1a</p> <pre><code>&gt;   = note: ld: framework not found Security\n&gt;           clang-11: error: linker command failed with exit code 1 (use -v to see invocation)\n&gt;\n&gt;\n&gt; error: aborting due to previous error\n</code></pre> <p>\u524d\u9762\u7684 cargo2nix \u6ca1\u6709\u51fa\u73b0\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u5e94\u8be5\u662f\u56e0\u4e3a cargo2nix \u5e2e\u6211\u4eec\u5f15\u5165\u4e86 Security \u7684\u4f9d\u8d56\uff0c\u89c1 overrides.nix\u3002</p> <p>\u6839\u636e crate2nix \u7684\u6587\u6863\uff0c\u9700\u8981\u6dfb\u52a0\u989d\u5916\u7684 native \u4f9d\u8d56\uff1a</p> <pre><code>{ pkgs ? import &lt;nixpkgs&gt; { } }:\n\nlet\n  generatedBuild = import ./Cargo.nix {\n    inherit pkgs;\n    defaultCrateOverrides = with pkgs; defaultCrateOverrides // {\n      webhookd = attrs: {\n        buildInputs =\n          lib.optionals\n            stdenv.isDarwin\n            [ darwin.apple_sdk.frameworks.Security ];\n      };\n    };\n  };\nin\ngeneratedBuild.rootCrate.build\n</code></pre> <p>\u7136\u540e\u6784\u5efa\uff1a</p> <pre><code>$ nix build -f default.nix\n$ ./result/bin/webhookd --version\nwebhookd 0.2.1\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u4e86\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u539f\u7406_2","title":"\u539f\u7406","text":"<p>\u5b83\u7684\u539f\u7406\u662f\u4f7f\u7528 <code>cargo_metadata</code> \u5e93\u4ece Cargo.lock \u4e2d\u83b7\u53d6\u5404\u4e2a crate \u7684\u4fe1\u606f\uff0c\u7136\u540e\u7ffb\u8bd1\u6210 <code>Cargo.nix</code>\uff0c\u4e4b\u540e\u5c31\u662f\u7531 nix \u6765\u7f16\u8bd1\u5404\u4e2a crate \u7684\u5185\u5bb9\u3002\u6240\u4ee5\u4e00\u5f00\u59cb\u8fd8\u662f\u9700\u8981\u5148\u7528 Cargo \u521b\u5efa\u9879\u76ee\uff0c\u6dfb\u52a0\u4f9d\u8d56\uff0c\u751f\u6210 <code>Cargo.lock</code>\uff1b\u4e4b\u540e\u518d\u7528 <code>crate2nix generate</code> \u540c\u6b65\u4f9d\u8d56\u4fe1\u606f\u5230 <code>Cargo.nix</code> \u6587\u4ef6\uff0c\u6784\u5efa\u7684\u65f6\u5019\u5c31\u4e0d\u9700\u8981 Cargo \u53c2\u4e0e\u4e86\uff0c\u76f4\u63a5 rustc\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#naersk","title":"naersk","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5b89\u88c5_3","title":"\u5b89\u88c5","text":"<p>\u9700\u8981\u5b89\u88c5 niv:</p> <pre><code>nix-env -iA nixpkgs.niv\n</code></pre>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u4f7f\u7528_3","title":"\u4f7f\u7528","text":"<p>\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\uff0c\u9996\u5148\u7528 <code>niv</code> \u5bfc\u5165 naersk\uff1a</p> <pre><code>niv init\nniv add nix-community/naersk\n</code></pre> <p>\u7136\u540e\u7f16\u5199\u4e00\u4e2a <code>default.nix</code>\uff1a</p> <pre><code>let\n  pkgs = import &lt;nixpkgs&gt; { };\n  sources = import ./nix/sources.nix;\n  naersk = pkgs.callPackage sources.naersk { };\nin\nnaersk.buildPackage ./.\n</code></pre> <p>\u6784\u5efa\uff1a</p> <pre><code>$ nix build -f default.nix\n$ ./result/bin/webhookd --version\nwebhookd 0.2.1\n</code></pre>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u539f\u7406_3","title":"\u539f\u7406","text":"<p>naersk \u7684\u539f\u7406\u548c crane \u662f\u7c7b\u4f3c\u7684\uff1a\u628a\u6240\u6709\u4f9d\u8d56\u4e0b\u8f7d\u4e0b\u6765\uff0c\u521b\u5efa\u4e00\u4e2a\u53ea\u6709\u4f9d\u8d56\u7684\u9879\u76ee\uff0c\u7136\u540e\u7528 cargo \u9884\u7f16\u8bd1\uff0c\u7f16\u8bd1\u5b8c\u5f97\u5230\u7684 target \u76ee\u5f55\u6253\u6210 <code>target.tar.zst</code>\uff1b\u7136\u540e\u57fa\u4e8e\u9884\u7f16\u8bd1\u7684\u7ed3\u679c\u518d\u7f16\u8bd1\u6574\u4e2a\u9879\u76ee\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#nocargo","title":"nocargo","text":"","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u5356\u70b9_3","title":"\u5356\u70b9","text":"<p>nocargo \u7684 README \u63d0\u5230\u4e86\u4ee5\u4e0b\u5356\u70b9\uff1a</p> <ul> <li>No IFDs (import-from-derivation). See meme.</li> <li>No cargo dependency during building. Only rustc.</li> <li>No need for hash prefetching or code generation1.</li> <li>Crate level caching, globally shared.</li> <li>nixpkgs integration for non-Rust dependencies.</li> </ul> <p>README \u4e5f\u63d0\u5230\u4e86 nocargo, cargo2nix, naersk \u548c buildRustPackage \u7684\u5bf9\u6bd4\u3002</p>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u4f7f\u7528_4","title":"\u4f7f\u7528","text":"<p>nocargo \u76ee\u524d\u4ec5\u652f\u6301 x86_64-linux \u5e73\u53f0\u3002</p> <p>\u5728\u4e00\u4e2a Cargo \u9879\u76ee\u4e2d\uff0c\u8fd0\u884c\uff1a</p> <pre><code>nix run github:oxalica/nocargo init\n</code></pre> <p>\u5b83\u4f1a\u751f\u6210 <code>flake.nix</code> \u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code># See more usages of nocargo at https://github.com/oxalica/nocargo#readme\n{\n  description = \"Rust package webhookd\";\n\n  inputs = {\n    nixpkgs.url = \"github:NixOS/nixpkgs\";\n    flake-utils.url = \"github:numtide/flake-utils\";\n    nocargo = {\n      url = \"github:oxalica/nocargo\";\n      inputs.nixpkgs.follows = \"nixpkgs\";\n      # inputs.registry-crates-io.follows = \"registry-crates-io\";\n    };\n    # Optionally, you can override crates.io index to get cutting-edge packages.\n    # registry-crates-io = { url = \"github:rust-lang/crates.io-index\"; flake = false; };\n  };\n\n  outputs = { nixpkgs, flake-utils, nocargo, ... }@inputs:\n    flake-utils.lib.eachSystem [ \"x86_64-linux\" ] (system:\n      let\n        ws = nocargo.lib.${system}.mkRustPackageOrWorkspace {\n          src = ./.;\n        };\n      in rec {\n        packages = {\n          default = packages.webhookd;\n          webhookd = ws.release.webhookd.bin;\n          webhookd-dev = ws.dev.webhookd.bin;\n        };\n      });\n}\n</code></pre> <p>\u6784\u5efa\uff1a</p> <pre><code>$ git add .\n$ nix build\n</code></pre> <p>\u51fa\u73b0\u4e86\u7f16\u8bd1\u9519\u8bef\uff0c\u8bf4\u660e crates.io index \u7248\u672c\u4e0d\u662f\u6700\u65b0\u7684\uff1a</p> <pre><code>error: Package bytes doesn't have version 1.2.0 in index. Available versions: 0.0.1 0.1.0 0.1.1 0.1.2 0.2.0 0.2.1 0.2.10 0.2.11 0.2.2 0.2.3 0.2.4 0.2.5 0.2.6 0.2.7 0.2.8 0.2.9 0.3.0 0.4.0 0.4.1 0.4.10 0.4.11 0.4.12 0.4.2 0.4.3 0.4.4 0.4.5 0.4.6 0.4.7 0.4.8 0.4.9 0.5.0 0.5.1 0.5.2 0.5.3 0.5.4 0.5.5 0.5.6 0.6.0 1.0.0 1.0.1 1.1.0\n(use '--show-trace' to show detailed location information)\n</code></pre> <p>\u6309\u7167 <code>flake.nix</code> \u4e2d\u7684\u63d0\u793a\uff0c\u4f7f\u7528\u6700\u65b0\u7684 crates.io index\uff1a</p> <pre><code># See more usages of nocargo at https://github.com/oxalica/nocargo#readme\n{\n  description = \"Rust package webhookd\";\n\n  inputs = {\n    nixpkgs.url = \"github:NixOS/nixpkgs\";\n    flake-utils.url = \"github:numtide/flake-utils\";\n    nocargo = {\n      url = \"github:oxalica/nocargo\";\n      inputs.nixpkgs.follows = \"nixpkgs\";\n      inputs.registry-crates-io.follows = \"registry-crates-io\";\n    };\n    # Optionally, you can override crates.io index to get cutting-edge packages.\n    registry-crates-io = { url = \"github:rust-lang/crates.io-index\"; flake = false; };\n  };\n\n  outputs = { nixpkgs, flake-utils, nocargo, ... }@inputs:\n    flake-utils.lib.eachSystem [ \"x86_64-linux\" ] (system:\n      let\n        ws = nocargo.lib.${system}.mkRustPackageOrWorkspace {\n          src = ./.;\n        };\n      in rec {\n        packages = {\n          default = packages.webhookd;\n          webhookd = ws.release.webhookd.bin;\n          webhookd-dev = ws.dev.webhookd.bin;\n        };\n      });\n}\n</code></pre> <p>\u7ee7\u7eed\u6784\u5efa\u5c31\u6210\u529f\u4e86\uff1a</p> <pre><code>$ nix build\n\u2022 Updated input 'nocargo/registry-crates-io':\n    'github:rust-lang/crates.io-index/1ce12a7e3367a2a673f91f07ab7cc505a0b8f069' (2022-07-17)\n  \u2192 follows 'registry-crates-io'\n\u2022 Added input 'registry-crates-io':\n    'github:rust-lang/crates.io-index/627caba32f416e706bf3f2ceac55230ec79710c5' (2022-08-02)\n$ ./result/bin/webhookd --version\nwebhookd 0.2.1\n</code></pre>","tags":["nix","rust"]},{"location":"software/2022/08/02/rust-nix/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u7684\u4e0d\u540c\u5de5\u5177\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u8981\u6bd4\u8f83\u7684\u8bdd\uff1a</p> <ul> <li>Nix drv \u7c92\u5ea6\uff1a\u6bcf\u4e2a\u4f9d\u8d56\uff08cargo2nix\uff0ccrate2nix\uff0cnocargo\uff09\u3001\u6240\u6709\u4f9d\u8d56\uff08crane\uff0cnaersk\uff09\u3002\u524d\u8005\u7684\u597d\u5904\u662f\u4f1a\u8de8\u9879\u76ee\u5171\u4eab\u4f9d\u8d56\uff0c\u8fdb\u4e00\u6b65\u53ef\u4ee5\u4f20\u5230 binary cache\u3002</li> <li>\u662f\u5426\u751f\u6210\u5305\u62ec\u5b8c\u6574\u4f9d\u8d56\u4fe1\u606f\u7684 nix \u6587\u4ef6\uff1a\u662f\uff08cargo2nix\uff0ccrate2nix\uff09\u3001\u5426\uff08crane\uff0cnaersk\uff0cnocargo\uff09\u3002\u751f\u6210\u7684\u8bdd\uff0c\u4ed3\u5e93\u91cc\u7684 Cargo.lock \u548c Cargo.nix \u7684\u4fe1\u606f\u662f\u91cd\u590d\u7684\uff0c\u5982\u679c\u4fee\u6539\u4e86 Cargo.lock\uff0c\u9700\u8981\u91cd\u65b0\u540c\u6b65 Cargo.nix\u3002</li> </ul>","tags":["nix","rust"]},{"location":"software/2022/01/25/rvv-1.0-toolchain/","title":"RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa","text":"<p>\u4e0d\u4e45\u524d RVV 1.0 \u6807\u51c6\u7ec8\u4e8e\u662f\u51fa\u6765\u4e86\uff0c\u4f46\u662f\u5de5\u5177\u94fe\u7684\u652f\u6301\u76ee\u524d\u57fa\u672c\u8fd8\u5904\u4e8e\u521a upstream \u8fd8\u6ca1\u6709 release \u7684\u72b6\u6001\u3002\u800c\u76ee\u524d RVV 1.0 \u7684\u652f\u6301\u4e3b\u8981\u5728 LLVM \u4e0a\u6bd4\u8f83\u6d3b\u8dc3\uff0c\u56e0\u6b64\u4e5f\u662f\u91c7\u7528 LLVM Clang + GCC Newlib Toolchain \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u5408\uff0c\u524d\u8005\u505a RVV 1.0 \u7684\u7f16\u8bd1\uff0c\u540e\u8005\u63d0\u4f9b libc \u7b49\u57fa\u7840\u5e93\u3002</p> <p>UPDATE: LLVM 14 \u5df2\u7ecf\u53d1\u5e03\uff0c\u8fd9\u4e2a\u7248\u672c\u5df2\u7ecf\u652f\u6301 RVV 1.0\uff0c\u76f4\u63a5\u4ece https://apt.llvm.org \u7b49\u5730\u5b89\u88c5 LLVM 14 \u5373\u53ef\u3002</p> <p>LLVM Clang \u76f4\u63a5\u91c7\u7528 upstream \u5373\u53ef\u3002\u7f16\u8bd1\u9009\u9879\uff1a</p> <pre><code>$ cmake -G Ninja ../llvm -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_INSTALL_PREFIX=/prefix/llvm -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS=\"clang\" -DLLVM_TARGETS_TO_BUILD=\"RISCV\"\n$ ninja\n$ ninja install\n$ /prefix/llvm/bin/clang --version\nclang version 14.0.0 (https://github.com/llvm/llvm-project.git 8d298355ca3778a47fd6b3110aeee03ea5e8e02b)\nTarget: x86_64-unknown-linux-gnu\nThread model: posix\nInstalledDir: /data/llvm/bin\n</code></pre> <p>\u8fd8\u9700\u8981\u914d\u5408\u4e00\u4e2a GCC \u5de5\u5177\u94fe\u624d\u53ef\u4ee5\u5b8c\u6574\u5730\u5de5\u4f5c\u3002\u53ef\u4ee5\u76f4\u63a5\u91c7\u7528 riscv-gnu-toolchain nightly \u7248\u672c\uff0c\u6bd4\u5982 riscv64-elf-ubuntu-20.04-nightly-2022.01.17-nightly.tar.gz\u3002\u4e0b\u8f7d\u4ee5\u540e\u89e3\u538b\uff0c\u5f97\u5230 riscv \u76ee\u5f55\uff0cGCC \u7248\u672c\u662f\u6bd4\u8f83\u65b0\u7684\uff1a</p> <pre><code>$ ~/riscv/bin/riscv64-unknown-elf-gcc --version\nriscv64-unknown-elf-gcc (GCC) 11.1.0\nCopyright (C) 2021 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre> <p>\u4f46\u662f\u5982\u679c\u7f16\u8bd1 C++ \u7a0b\u5e8f\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u5c31\u4f1a\u62a5\u9519\uff1a<code>prefixed ISA extension must separate with _</code>\uff0c\u8fd9\u662f\u56e0\u4e3a riscv-gnu-toolchain \u4ed3\u5e93\u7684 binutils \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u5728 upstream \u7684 binutils \u91cc\u9762\u5df2\u7ecf\u4fee\u590d\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u6240\u4ee5 clone \u4e0b\u6765\uff0c\u7136\u540e\u7f16\u8bd1\uff0c\u8986\u76d6\u6389 riscv-gnu-toolchain \u91cc\u9762\u7684 binutils\uff1a</p> <p>UPDATE: binutils 2.38 \u5df2\u7ecf\u53d1\u5e03\uff0c\u7528\u8fd9\u4e2a\u7248\u672c\u5373\u53ef\u3002</p> <pre><code>$ ../configure --target=riscv64-unknown-elf --prefix=$HOME/riscv --disable-gdb --disable-sim --disable-libdecnumber --disable-readline\n$ make\n$ make install\n$ ~/riscv/bin/riscv64-unknown-elf-ld --version\nGNU ld (GNU Binutils) 2.38.50.20220125\nCopyright (C) 2022 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License version 3 or (at your option) a later version.\nThis program has absolutely no warranty.\n</code></pre> <p>\u7136\u540e\u7f16\u8bd1\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f7f\u7528 clang\uff0c\u914d\u7f6e\u53c2\u6570 <code>--gcc-toolchain=~/riscv</code> \u5373\u53ef\u8ba9 clang \u627e\u5230 GNU \u5de5\u5177\u94fe\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u7f16\u8bd1\u51fa\u6765 RVV 1.0 \u7684\u7a0b\u5e8f\u4e86\uff1a</p> <pre><code>$ /llvm/bin/clang --target=riscv64-unknown-elf -O2 -march=rv64gcv1p0 -menable-experimental-extensions -mllvm --riscv-v-vector-bits-min=256 --gcc-toolchain=$HOME/riscv add.cpp -o add\n$ /data/llvm/bin/llvm-objdump --mattr=+v -S add\n   1020e: 57 70 04 c5   vsetivli        zero, 8, e32, m1, ta, mu\n   10212: 07 64 03 02   vle32.v v8, (t1)\n   10216: 87 e4 03 02   vle32.v v9, (t2)\n   1021a: 93 07 07 fe   addi    a5, a4, -32\n   1021e: 07 e5 07 02   vle32.v v10, (a5)\n   10222: 87 65 07 02   vle32.v v11, (a4)\n   10226: 57 14 85 02   vfadd.vv        v8, v8, v10\n   1022a: d7 94 95 02   vfadd.vv        v9, v9, v11\n   1022e: 93 07 05 fe   addi    a5, a0, -32\n   10232: 27 e4 07 02   vse32.v v8, (a5)\n   10236: a7 64 05 02   vse32.v v9, (a0)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 llvm \u7684\u81ea\u52a8\u5411\u91cf\u5316\u662f\u5de5\u4f5c\u7684\u3002\u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u7f16\u5199 rvv intrinsic\u3002</p>","tags":["riscv","vector","rvv","llvm","clang","binutils"]},{"location":"software/2020/04/13/sbt-fork-parallel-test/","title":"\u5728 sbt \u4e2d fork \u5e76\u4e14\u5e76\u884c\u8fd0\u884c\u6d4b\u8bd5","text":"","tags":["sbt","scala","testing"]},{"location":"software/2020/04/13/sbt-fork-parallel-test/#\u95ee\u9898","title":"\u95ee\u9898","text":"<p>\u6700\u8fd1\u5728 sbt \u4f7f\u7528\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u6709\u4e24\u4e2a\u6d4b\u8bd5\uff0c\u5206\u522b\u7528 testOnly \u6d4b\u8bd5\u7684\u65f6\u5019\u6ca1\u6709\u95ee\u9898\uff0c\u5982\u679c\u540c\u65f6\u6d4b\u8bd5\u5c31\u4f1a\u51fa\u95ee\u9898\uff0c\u5e94\u8be5\u662f\u5168\u5c40\u7684\u72b6\u6001\u4e0a\u51fa\u73b0\u4e86\u51b2\u7a81\u3002\u4e00\u4e2a\u81ea\u7136\u7684\u89e3\u51b3\u601d\u8def\u662f fork\uff0c\u4f46\u662f sbt \u9ed8\u8ba4 fork \u4e4b\u540e test \u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u8fd9\u4f1a\u5f88\u6162\u3002\u6240\u4ee5\u641c\u7d22\u4e86\u4e00\u4e0b\uff0c\u627e\u5230\u4e86 fork \u5e76\u4e14\u5e76\u884c\u6d4b\u8bd5\u7684\u65b9\u6cd5\u3002</p>","tags":["sbt","scala","testing"]},{"location":"software/2020/04/13/sbt-fork-parallel-test/#\u89e3\u51b3\u65b9\u6cd5","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u89e3\u51b3\u65b9\u6cd5\u5728 sbt \u6587\u6863\u4e2d\u5176\u5b9e\u5c31\u6709\uff08\u539f\u6587\uff09\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff1a\u628a\u6bcf\u4e2a test \u653e\u5230\u5355\u72ec\u7684 TestGroup \u4e2d\uff0c\u6bcf\u4e2a TestGroup \u5206\u522b\u7528\u4e00\u4e2a forked JVM \u53bb\u8fd0\u884c\uff1b\u7136\u540e\u8ba9 sbt \u7684\u5e76\u884c\u9650\u5236\u8bbe\u9ad8\u4e00\u4e9b\uff1a</p> <pre><code>// move each test into a group and fork them to avoid race condition\nimport Tests._\ndef singleTests(tests: Seq[TestDefinition]) =\n  tests map { test =&gt;\n    new Group(\n      name = test.name,\n      tests = Seq(test),\n      SubProcess(ForkOptions()))\n  }\n\nTest / testGrouping := singleTests( (Test / definedTests).value )\n// allow multiple concurrent tests\nconcurrentRestrictions in Global := Seq(Tags.limitAll(4))\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\u3002</p>","tags":["sbt","scala","testing"]},{"location":"software/2018/10/12/secoder-platform-sucks/","title":"\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0","text":"<p>\u8001\u5e08\u8981\u6c42\u6211\u4eec\u641e CI/CD\uff0cCI \u81ea\u7136\u662f\u5f88\u5feb\u5c31\u641e\u597d\u4e86\uff0c\u4e0d\u8fc7 CD \u8fd8\u5f97\u914d\u4e00\u4e0b\u3002\u4eca\u5929\u7814\u7a76\u4e86\u4e00\u4e0b\u5b83\u7684 Deployer \u67b6\u6784\uff0c\u53d1\u73b0\u4e86\u82e5\u5e72\u6613\u7528\u6027\u95ee\u9898\uff1a</p> <ol> <li>\u7f3a\u4e4f\u6587\u6863</li> <li>\u53ea\u6709\u6837\u4f8b\u914d\u7f6e\u6ca1\u6709\u8bb2\u89e3</li> <li>\u5df2\u6709\u7684\u6587\u6863 \u8bed\u7109\u4e0d\u8be6</li> <li>\u5b98\u65b9\u5bf9\u6b64\u56de\u590d\uff1a\u529f\u80fd\u592a\u591a\uff0c\u8fd8\u6ca1\u5fd9\u8fc7\u6765\u5199\u6587\u6863</li> </ol> <p>\u4e8e\u662f\u53ea\u597d\u7ecf\u5e38\u6233\u52a9\u6559\u7136\u540e\u5c1d\u8bd5\u7406\u89e3\u8fd9\u4e2a\u4e1c\u897f\u3002\u3002\u7136\u540e\u9047\u5230\u4e86\u5f88\u591a\u7684 BUG\uff1a</p> <ol> <li>\u5bb9\u5668\u6ca1\u6709\u91cd\u542f\u529f\u80fd\u3002\u3002\u3002</li> <li>\u5bb9\u5668\u6b7b\u4e86\u8fd8\u662f\u6d3b\u7740\u770b\u4e00\u4e2a\u56fe\u7684\u989c\u8272\u3002\u3002\u3002\u6beb\u65e0\u8bf4\u660e</li> <li>\u5bb9\u5668\u867d\u7136\u6709 Console\uff0c\u4f46\u662f\u8f93\u5165\u8fc7\u957f\u540e\u76f4\u63a5\u56de\u5230\u884c\u9996\u6ca1\u6709\u6362\u884c\u3002\u3002\u3002</li> <li>\u5bb9\u5668\u5bf9\u5916\u7684\u57df\u540d\u91cc\u6709\u4e0b\u5212\u7ebf\u3002\u3002\u3002Django \u4e0a\u6765\u5c31\u4e00\u53e5 <code>Invalid HTTP_HOST header: 'xxxx_xxx.app.secoder.net'. The domain name provided is not valid according to RFC 1034/1035.</code> Express \u76f4\u63a5\u5c31 <code>Invalid Host header</code> \u653e\u5f03\u6cbb\u7597\u3002\u3002\u3002</li> <li>\u52a9\u6559\u5bf9\u4e0a\u4e00\u6761\u7684\u56de\u590d\u662f\uff0c\u7b49\u6211\u5fd9\u5b8c DDL \u6709\u7a7a\u518d\u505a\u5427\u3002\u3002\u3002\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u8981\u505a\u53ea\u80fd\u81ea\u5df1\u518d\u5f00\u4e00\u4e2a Nginx \u5bb9\u5668\u7136\u540e\u81ea\u5df1\u5728 <code>proxy_set_header</code> \u4e0a\u505a\u624b\u811a\u3002\u3002\u3002</li> </ol>","tags":["secoder","softwarengineering","cd","ci","gitlab"]},{"location":"software/2020/11/08/spack-openmpi-slurm-external/","title":"\u5728 Spack \u4e2d\u7528 external \u7684 Slurm \u4f9d\u8d56\u7f16\u8bd1 OpenMPI","text":"<p>\u6700\u8fd1\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e0a\uff0c\u9700\u8981\u7528\u4e00\u4e2a\u81ea\u5df1\u7f16\u8bd1\u7684 openmpi\uff0c\u4f46\u5e76\u6ca1\u6709 root \u6743\u9650\uff0c\u6240\u4ee5\u9700\u8981\u81ea\u5df1\u641e\u4e00\u4e2a spack\uff0c\u5728 spack \u91cc\u9762\u88c5 openmpi\u3002\u4f46\u9ed8\u8ba4\u7684\u5b89\u88c5\u9009\u9879\u4e0b\uff0c\u5b83\u6ca1\u6709\u6253\u5f00 slurm \u652f\u6301\uff0c\u6240\u4ee5 srun \u7684\u8bdd\u4f1a\u51fa\u95ee\u9898\uff0c\u53ea\u80fd sbatch \u7136\u540e\u6307\u5b9a host \u53bb\u505a\u3002\u4e8e\u662f\u6211\u7814\u7a76\u4e86\u4e00\u4e0b\u600e\u4e48\u5728 spack \u91cc\u5f15\u5165 external \u7684 slurm\uff0c\u7136\u540e\u7528\u5b83\u6765\u7f16\u8bd1 openmpi</p> <p>\u9996\u5148\uff0c\u7f16\u8bd1 <code>~/.spack/packages.yaml</code>\uff1a</p> <pre><code>packages:\n  slurm:\n    buildable: False\n    paths:\n      \"slurm@15-08-7-1%gcc@8.3.0 arch=linux-ubuntu16.04-haswell\": /usr\n</code></pre> <p>\u8fd9\u91cc slurm \u7248\u672c\u662f <code>15.08.7</code>\uff0c\u6211\u5c31\u6309\u7167 spack \u91cc\u9762 slurm \u7684\u7248\u672c\u53f7\u6765\u5199\u4e86\u3002\u53ef\u4ee5\u7528 <code>spack spec openmpi schedulers=slurm +pmi</code> \u6765\u786e\u8ba4\u4e00\u4e0b\u5916\u90e8\u7684 slurm \u786e\u5b9e\u51fa\u73b0\u5728\u4e86\u4f9d\u8d56\u4e4b\u4e2d\u3002</p> <p>\u8fd9\u4e00\u6b65\u914d\u597d\u7684\u8bdd\uff0c\u5b89\u88c5\u7684\u65f6\u5019\u5c31\u4f1a\u76f4\u63a5\u8df3\u8fc7 spack \u91cc\u9762 slurm \u7684\u5b89\u88c5\u3002\u4f46\u53c8\u51fa\u73b0\u4e86 configure \u9519\u8bef\uff0c\u627e\u4e0d\u5230 pmi \u7684\u5e93\u3002\u4e8e\u662f\uff0c\u5148\u7528 external \u7684 mpirun \u770b\u4e00\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>$ module load openmpi-3.0.0\n$ ompi_info\n...\n--with-pmi=/usr\n--with-pmi-libdir=/usr/lib/x86_64-linux-gnu\n...\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u9700\u8981\u4e24\u4e2a config \u53c2\u6570\u3002\u7136\u540e\uff0c\u5728 spack \u7684 openmpi package.py \u4e2d\uff1a</p> <pre><code>if spec.satisfies('schedulers=slurm'):\n  config_args.append('--with-pmi={0}'.format(spec['slurm'].prefix))\n  if spec.satisfies('@3.1.3:') or spec.satisfies('@3.0.3'):\n    if '+static' in spec:\n      config_args.append('--enable-static')\n</code></pre> <p>\u6240\u4ee5\uff0c\u9700\u8981\u52a0\u4e00\u4e2a\u5c0f patch\uff1a</p> <pre><code>if spec.satisfies('schedulers=slurm'):\n  config_args.append('--with-pmi={0}'.format(spec['slurm'].prefix))\n  # patched here\n  config_args.append('--with-pmi-libdir={0}/lib/x86_64-linux-gnu'.format(spec['slurm'].prefix))\n  if spec.satisfies('@3.1.3:') or spec.satisfies('@3.0.3'):\n    if '+static' in spec:\n      config_args.append('--enable-static')\n</code></pre> <p>\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u7f16\u8bd1\u901a\u8fc7\u4e86\u3002</p>","tags":["spack","openmpi","slurm"]},{"location":"software/2023/08/02/spec-cpu-2006/","title":"SPEC CPU 2006 \u6027\u80fd\u6d4b\u8bd5","text":"","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7f51\u4e0a\u770b\u5230\u9f99\u82af 3A6000 \u7684 SPEC CPU 2006 \u6027\u80fd\u8bc4\u6d4b\u6570\u636e\uff0c\u60f3\u7740\u81ea\u5df1\u4e5f\u53ef\u4ee5\u5728\u624b\u4e0a\u7684\u4e00\u4e9b\u5e73\u53f0\u4e0a\u6d4b\u4e00\u6d4b\uff0c\u628a\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u8bb0\u5f55\u5728\u672c\u6587\u3002</p>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u57fa\u672c\u6982\u5ff5","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>SPEC CPU 2006 \u5206 int \u548c fp \u4e24\u79cd\uff0c\u53c8\u5206\u4e0d\u540c\u7684\u6a21\u5f0f\uff08\u89c1 Q15. What is the difference between a \"rate\" and a \"speed\" metric?\uff09\uff1a</p> <ol> <li>speed\uff1a\u8dd1\u5355\u8fdb\u7a0b\uff0c\u770b\u770b\u5355\u8fdb\u7a0b\u591a\u5c11\u65f6\u95f4\u80fd\u5b8c\u6210\uff0c\u6d4b\u8bd5\u5b8c\u6210\u5355\u4e2a\u4efb\u52a1\u7684\u65f6\u95f4\uff1b\u4e0d\u5f00 OpenMP\uff0c\u4f46\u662f\u7f16\u8bd1\u5668\u53ef\u4ee5\u81ea\u52a8\u5e76\u884c\u5316\uff08ICC\uff09</li> <li>rate\uff1a\u8dd1\u591a\u8fdb\u7a0b\uff0c\u770b\u770b\u5355\u4f4d\u65f6\u95f4\u5185\u80fd\u8dd1\u591a\u5c11\u4e2a\u4efb\u52a1\uff0c\u6d4b\u8bd5\u5b8c\u6210\u591a\u4e2a\u4efb\u52a1\u7684\u541e\u5410\u91cf</li> </ol> <p>\u6ce8\uff1aSPEC CPU 2017 \u7a0d\u6709\u4e0d\u540c\uff0cspeed \u5141\u8bb8\u5f00 OpenMP\uff0crate \u9664\u4e86 xz \u4ee5\u5916\u4e0d\u5141\u8bb8\u5f00 OpenMP\u3002\u6bd4\u5355\u6838\u6027\u80fd\uff0c\u8981\u4e48\u7528\u5355\u7ebf\u7a0b\u7684 speed\uff08speed \u8981\u6c42\u5355\u8fdb\u7a0b\uff09\uff0c\u8981\u4e48\u7528\u5355 copy \u7684 rate\uff08rate \u8981\u6c42\u5355\u7ebf\u7a0b\uff09\u3002</p> <p>\u6839\u636e\u7f16\u8bd1\u9009\u9879\u7684\u4e0d\u540c\uff0c\u5206\u4e3a\uff08\u89c1 Q14. What is the difference between a \"base\" metric and a \"peak\" metric?\uff09\uff1a</p> <ol> <li>base\uff1a\u6240\u6709\u6d4b\u4f8b\u90fd\u7528\u540c\u6837\u7684\u4f18\u5316\u9009\u9879</li> <li>peak\uff1a\u4e0d\u540c\u6d4b\u4f8b\u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u4f18\u5316\u9009\u9879</li> </ol> <p>spec cpu int 2006 \u6709 12 \u4e2a benchmark\uff0cspec cpu fp 2006 \u6709 17 \u4e2a benchmark\u3002</p>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u9996\u5148\u9700\u8981\u83b7\u53d6\u4e00\u4efd cpu2006-1.2.iso \u6587\u4ef6\uff0cmd5 \u53ef\u4ee5\u5728 \u5b98\u7f51 \u4e0a\u67e5\u5230\u3002\u5728 Linux \u73af\u5883\u4e0b\uff0cmount \u8fd9\u4e2a iso \u5e76\u8fd0\u884c\u91cc\u9762\u7684 install.sh\uff1a</p> <pre><code>mount cpu2006-1.2.iso /mnt\ncd /mnt\n./install.sh\n</code></pre> <p>\u6309\u7167\u63d0\u793a\u8f93\u5165\u5b89\u88c5\u8def\u5f84\uff0c\u7b49\u5f85\u5b89\u88c5\u5b8c\u6210\uff0c\u7136\u540e\u6309\u7167\u63d0\u793a\u8fdb\u5165\u73af\u5883\uff1a</p> <pre><code>cd /usr/cpu2006\nsource ./shrc\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u914d\u7f6e\u548c\u8fd0\u884c","title":"\u914d\u7f6e\u548c\u8fd0\u884c","text":"<p>\u63a5\u7740\uff0c\u9700\u8981\u6309\u7167 SPEC CPU2006 Config Files \u7684\u6587\u6863\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\u3002\u7f16\u8f91 <code>config/default.cfg</code>\uff0c\u5199\u4e00\u4e2a\u57fa\u672c\u7684\u914d\u7f6e\uff1a</p> <pre><code># run one iteration\niterations = 1\n# skip peak\nbasepeak = yes\n# show live output\nteeout = yes\n\n# optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2\nCXXOPTIMIZE = -O2\nFOPTIMIZE = -O2\n</code></pre> <p>\u8fd9\u6837\u5c31\u4f1a\u7528\u5355\u7ebf\u7a0b\u8dd1\u4e00\u4e2a <code>-O2</code> \u4f18\u5316\u7684 401.bzip2 \u6d4b\u4f8b\uff1a</p> <pre><code>runspec bzip2\n</code></pre> <p>\u8fd0\u884c\u51e0\u5206\u949f\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 result \u76ee\u5f55\u4e0b\u770b\u5230\u7ed3\u679c\uff0c\u53ef\u4ee5\u770b\u5230 bzip2 \u5355\u9879\u7684\u7ed3\u679c\u3002\u63a5\u4e0b\u6765\uff0c\u5c1d\u8bd5\u8fd0\u884c\u5b8c\u6574\u7684 SPECint_base2006\uff0c\u4fee\u6539 <code>config/default.cfg</code>\uff1a</p> <pre><code># match spec result standard\nreportable = yes\n# skip peak\nbasepeak = yes\n# show live output\nteeout = yes\n\n# optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2\nCXXOPTIMIZE = -O2\nFOPTIMIZE = -O2\n</code></pre> <p>\u518d\u8fd0\u884c\uff1a</p> <pre><code>runspec int\n</code></pre> <p>\u6b64\u65f6\u4f1a\u9047\u5230\u7f16\u8bd1\u95ee\u9898\uff0c\u4e0b\u9762\u6765\u8fdb\u884c\u89e3\u51b3\u3002</p>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u7f16\u8bd1\u9519\u8bef","title":"\u7f16\u8bd1\u9519\u8bef","text":"<p>\u7f16\u8bd1\u9519\u8bef\u5b9e\u9645\u4e0a\u662f\u56e0\u4e3a\u73b0\u5728\u7528\u7684\u7cfb\u7edf\u592a\u65b0\u4e86\uff0c\u5728\u65b0\u7cfb\u7edf\u4e0a\u7f16\u8bd1 2006 \u5e74\u524d\u7684\u4ee3\u7801\uff0c\u5fc5\u7136\u6709\u5404\u79cd\u95ee\u9898\u3002</p>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#perlbench","title":"perlbench","text":"<p>\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f perlbench\uff1a</p> <pre><code>pp_sys.c:4489:42: error: invalid use of undefined type 'struct tm'\n 4489 |                             dayname[tmbuf-&gt;tm_wday],\n      |                                          ^~\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a\u6ca1\u6709 include time.h\uff0c\u9605\u8bfb perlbench \u4e0b\u9762\u7684 spec_config.h\uff0c\u53ef\u77e5\u9700\u8981\u7ed9 perlbench \u4f20\u5355\u72ec\u7684\u7f16\u8bd1\u53c2\u6570\u3002\u4fee\u6539 <code>config/default.cfg</code>\uff0c\u6dfb\u52a0\u5982\u4e0b\u90e8\u5206\uff1a</p> <pre><code># fix compilation\nint=default=default=default:\nPORTABILITY = -DSPEC_CPU_LP64\n\n400.perlbench=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX_X64\n</code></pre> <p>\u8868\u793a\u7ed9\u6240\u6709\u6d4b\u4f8b\u90fd\u52a0\u4e0a <code>SPEC_CPU_LP64</code> \u7684\u5b9a\u4e49\uff0cperlbench \u8fd8\u8981\u989d\u5916\u5b9a\u4e49 <code>SPEC_CPU_LINUX_X64</code>\u3002\u8fd9\u6837 time.h \u7684\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u63a5\u4e0b\u6765\u9047\u5230\u4e86\u65b0\u7684\u95ee\u9898\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u51fa\u73b0 multiple definition \u9519\u8bef\uff1a</p> <pre><code>Opcode.c:(.text+0x1b60): multiple definition of `ferror_unlocked'; av.o:av.c:(.text+0x2f0): first defined here\ncollect2: error: ld returned 1 exit status\n</code></pre> <p>\u5728\u7f51\u4e0a\u67e5\u627e\uff0c\u53d1\u73b0\u5728 SPEC 2017 FAQ \u91cc\u6709\u89e3\u51b3\u65b9\u6848\uff0c\u867d\u7136\u7528\u7684\u662f CPU 2006\uff0c\u4f46\u662f\u4e5f\u4e00\u6837\u9002\u7528\uff0c\u4fee\u6539 <code>config/default.cfg</code>\uff1a</p> <pre><code># optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2 -fgnu89-inline -fcommon\nCXXOPTIMIZE = -O2\nFOPTIMIZE = -O2\n\n# fix compilation\nint=default=default=default:\nPORTABILITY = -DSPEC_CPU_LP64\n\n400.perlbench=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX_X64\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#libquantum","title":"libquantum","text":"<p>\u4e0b\u4e00\u4e2a\u7f16\u8bd1\u9519\u8bef\u5728 libquantum\uff1a</p> <pre><code>complex.c: In function 'quantum_conj':\ncomplex.c:42:14: error: 'IMAGINARY' undeclared (first use in this function)\n   42 |   return r - IMAGINARY * i;\n</code></pre> <p>\u548c perlbench \u4e00\u6837\uff0c\u9700\u8981\u989d\u5916\u7684\u5b8f\u5b9a\u4e49\u3002\u53c2\u8003 config \u76ee\u5f55\u4e0b\u7684 Example config\uff0c\u76f4\u63a5\u628a\u5269\u4e0b\u51e0\u4e2a\u90fd\u914d\u7f6e\u4e0a\uff1a</p> <pre><code># fix compilation\nint=default=default=default:\nPORTABILITY = -DSPEC_CPU_LP64\n\n400.perlbench=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX_X64\n\n462.libquantum=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX\n\n483.xalancbmk=default=default=default:\nCXXPORTABILITY = -DSPEC_CPU_LINUX\n\n481.wrf=default=default=default:\nCPORTABILITY = -DSPEC_CPU_CASE_FLAG -DSPEC_CPU_LINUX\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#omnetpp","title":"omnetpp","text":"<p>\u4e0b\u4e00\u4e2a\u9519\u8bef\u662f specmake \u8bf4 CC not found\uff1a</p> <pre><code>CC -c -o EtherAppCli.o -DSPEC_CPU -DNDEBUG -I. -Iomnet_include -Ilibs/envir   -O2   -DSPEC_CPU_LP64 -fgnu89-inline -fcommon       EtherAppCli.cc\nspecmake: CC: Command not found\nspecmake: *** [EtherAppCli.o] Error 127\n</code></pre> <p>\u90a3\u5c31\u5728\u914d\u7f6e <code>config/default.cfg</code> \u91cc\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\uff1a</p> <pre><code># specify compilers\ndefault=default=default=default:\nCC = /usr/bin/gcc\nCXX = /usr/bin/g++\nFC = /usr/bin/gfortran\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#gamess","title":"gamess","text":"<p>gamess \u662f SPECfp \u91cc\u9762\u7684\u6d4b\u4f8b\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u62a5\u9519\uff1a</p> <pre><code>aldeci.fppized.f:1674:72:\n\n 1674 |       CALL BINOM6(X(LIFA),NACT)\n      |                                                                        1\nError: Type mismatch in argument 'ifa' at (1); passed REAL(8) to INTEGER(4)\n</code></pre> <p>\u53c2\u8003 Disable argument-mismatch errors for SPEC CPU2006 416.gamess for GCC &gt;= 8\uff0c\u6dfb\u52a0\u7f16\u8bd1\u9009\u9879 <code>-std=legacy</code> \u6765\u89e3\u51b3\uff1a</p> <pre><code># optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2 -fgnu89-inline -fcommon\nCXXOPTIMIZE = -O2\nFOPTIMIZE = -O2 -std=legacy\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#dealii","title":"dealII","text":"<p>dealII \u662f SPECfp \u91cc\u9762\u7684\u6d4b\u4f8b\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u62a5\u9519\uff1a</p> <pre><code>parameter_handler.cc: In member function 'long int ParameterHandler::get_integer(const std::string&amp;) const':\nparameter_handler.cc:763:26: error: ISO C++ forbids comparison between pointer and integer [-fpermissive]\n  763 |   AssertThrow ((s.c_str()!='\\0') || (*endptr == '\\0'),\n      |                 ~~~~~~~~~^~~~~~\ninclude/base/exceptions.h:596:15: note: in definition of macro 'AssertThrow'\n  596 |         if (!(cond))                                                 \\\n      |               ^~~~\n</code></pre> <p>\u7f16\u8bd1\u9009\u9879\u6253\u5f00 <code>-fpermissive</code> \u5373\u53ef\uff1a</p> <pre><code># optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2 -fgnu89-inline -fcommon\nCXXOPTIMIZE = -O2 -fpermissive\nFOPTIMIZE = -O2 -std=legacy\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#soplex","title":"soplex","text":"<p>soplex \u662f SPECfp \u91cc\u9762\u7684\u6d4b\u4f8b\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u62a5\u9519\uff1a</p> <pre><code>mpsinput.cc: In member function 'bool soplex::MPSInput::readLine()':\nmpsinput.cc:75:52: error: no match for 'operator==' (operand types are 'std::basic_istream&lt;char&gt;::__istream_type' {aka 'std::basic_istream&lt;char&gt;'} and 'int')\n   75 |          if (m_input.getline(m_buf, sizeof(m_buf)) == 0)\n      |              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^~ ~\n      |                             |                         |\n      |                             |                         int\n      |                             std::basic_istream&lt;char&gt;::__istream_type {aka std::basic_istream&lt;char&gt;}\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5\uff1a\u964d\u4f4e C++ \u6807\u51c6\u7248\u672c\uff1a</p> <pre><code># optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2 -fgnu89-inline -fcommon\nCXXOPTIMIZE = -O2 -fpermissive --std=c++98\nFOPTIMIZE = -O2 -std=legacy\n</code></pre>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u5b8c\u6574\u914d\u7f6e","title":"\u5b8c\u6574\u914d\u7f6e","text":"<p>\u89e3\u51b3\u7f16\u8bd1\u95ee\u9898\u540e\uff0c\u5b8c\u6574\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code># match spec result standard\nreportable = yes\n# skip peak\nbasepeak = yes\n# show live output\nteeout = yes\n\n# optimization flags for base\ndefault=base=default=default:\nCOPTIMIZE = -O2 -fgnu89-inline -fcommon\nCXXOPTIMIZE = -O2 -fpermissive --std=c++98\nFOPTIMIZE = -O2 -std=legacy\n\n# specify compilers\ndefault=default=default=default:\nCC = /usr/bin/gcc\nCXX = /usr/bin/g++\nFC = /usr/bin/gfortran\n\n# fix compilation\nint=default=default=default:\nPORTABILITY = -DSPEC_CPU_LP64\n\n400.perlbench=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX_X64\n\n462.libquantum=default=default=default:\nCPORTABILITY = -DSPEC_CPU_LINUX\n\n483.xalancbmk=default=default=default:\nCXXPORTABILITY = -DSPEC_CPU_LINUX\n\n481.wrf=default=default=default:\nCPORTABILITY = -DSPEC_CPU_CASE_FLAG -DSPEC_CPU_LINUX\n</code></pre> <p>\u6b64\u65f6\u518d\u8fd0\u884c <code>runspec int</code> \u5c31\u53ef\u4ee5\u6b63\u5e38\u8dd1\u4e86\u3002</p>","tags":["benchmark","spec"]},{"location":"software/2023/08/02/spec-cpu-2006/#\u5176\u4ed6-isa","title":"\u5176\u4ed6 ISA","text":"<p>\u5982\u679c\u60f3\u5728 AArch64 \u4e0a\u8dd1\uff0c\u90a3\u4e48\u5b89\u88c5\u7684\u65f6\u5019\u4f1a\u53d1\u73b0\u7f3a\u5c11 prebuilt \u7684 tools \u4e8c\u8fdb\u5236\uff0c\u6b64\u65f6\u5c31\u8981\u624b\u52a8\u6309\u7167 Building the SPEC CPU2006 Tool Suite \u8fdb\u884c\u7f16\u8bd1\uff1a</p> <pre><code>cd tools/src\n./buildtools\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u4e00\u6b65\u9700\u8981\u4fee\u6539\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u5982\u679c\u4e4b\u524d\u662f\u76f4\u63a5 mount ISO\uff0c\u8981\u5148\u590d\u5236\u4e00\u4efd\uff0c\u6b64\u5916\u8fd8\u8981\u628a\u6743\u9650\u6539\u6210\u53ef\u5199\uff08<code>chmod -R u+w</code>\uff09\u3002</p> <p>\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u9047\u5230\u9519\u8bef\uff0c\u53ef\u4ee5\u53c2\u8003 Build SPEC CPU2006 in riscv64 linux \u89e3\u51b3\uff0criscv64 \u548c aarch64 \u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u7c7b\u4f3c\u7684\uff1a</p> <ol> <li> <p>\u66ff\u6362\u6e90\u4ee3\u7801\u4e0b\u7684\u51e0\u4e2a config.guess \u548c config.sub\uff08\u5728 expat-2.0.1/conftools\uff0cmake-3.82/config\uff0crxp-1.5.0\uff0cspecinvoke\uff0cspecsum/build-aux\uff0ctar-1.25/build-aux\uff0cxz-5.0.0/build-aux \u76ee\u5f55\u4e0b\uff09\uff0c\u89e3\u51b3\u4e0d\u8ba4\u8bc6 aarch64 target triple \u7684\u95ee\u9898</p> <pre><code>wget -O config.guess 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD'\nwget -O config.sub 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD'\ncp config.* expat-2.0.1/conftools/\ncp config.* make-3.82/config/\ncp config.* rxp-1.5.0/\ncp config.* specinvoke/\ncp config.* specsum/build-aux/\ncp config.* tar-1.25/build-aux/\ncp config.* xz-5.0.0/build-aux/\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>make-3.82/glob/glob.c</code>\uff0c\u628a <code># if _GNU_GLOB_INTERFACE_VERSION == GLOB_INTERFACE_VERSION</code> \u6539\u6210 <code># if _GNU_GLOB_INTERFACE_VERSION &gt;= GLOB_INTERFACE_VERSION</code>\uff0c\u7981\u7528 make \u81ea\u5e26\u7684 glob \u5b9e\u73b0\uff0c\u89e3\u51b3 alloca \u548c stat \u7684\u95ee\u9898</p> <pre><code>@@ -52,7 +52,7 @@\n #define GLOB_INTERFACE_VERSION 1\n #if !defined _LIBC &amp;&amp; defined __GNU_LIBRARY__ &amp;&amp; __GNU_LIBRARY__ &gt; 1\n # include &lt;gnu-versions.h&gt;\n-# if _GNU_GLOB_INTERFACE_VERSION == GLOB_INTERFACE_VERSION\n+# if _GNU_GLOB_INTERFACE_VERSION &gt;= GLOB_INTERFACE_VERSION\n #  define ELIDE_CODE\n # endif\n #endif\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>make-3.82/make.h</code>\uff0c\u5728 <code>struct rlimit stack_limit;</code> \u524d\u9762\u6dfb\u52a0 <code>extern</code>\uff0c\u89e3\u51b3 -fno-common \u7684\u95ee\u9898</p> <pre><code>@@ -344,7 +344,7 @@\n #endif\n #ifdef SET_STACK_SIZE\n # include &lt;sys/resource.h&gt;\n-struct rlimit stack_limit;\n+extern struct rlimit stack_limit;\n #endif\n\n struct floc\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>make-3.82/dir.c</code>\uff0c\u5728 <code>dir_setup_glob</code> \u51fd\u6570\u91cc\u6dfb\u52a0\u4e00\u53e5 <code>gl-&gt;gl_lstat = lstat;</code>\uff0c\u89e3\u51b3 <code>make: ./file.c:158: enter_file: Assertion strcache_iscached (name) failed.</code> \u7684\u95ee\u9898\uff08\u53c2\u8003\u4e86 [PATCH v2] make: 4.2.1 -&gt; 4.3\uff09</p> <pre><code>@@ -1213,6 +1213,7 @@\n   gl-&gt;gl_readdir = read_dirstream;\n   gl-&gt;gl_closedir = ansi_free;\n   gl-&gt;gl_stat = local_stat;\n+  gl-&gt;gl_lstat = lstat;\n   /* We don't bother setting gl_lstat, since glob never calls it.\n      The slot is only there for compatibility with 4.4 BSD.  */\n }\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>tar-1.25/gnu/stdio.in.h</code> \u548c <code>specsum/gnulib/stdio.in.h</code>\uff0c\u627e\u5230 <code>_GL_WARN_ON_USE (gets, \"gets is a security hole - use fgets instead\");</code> \u4e00\u53e5\uff0c\u6ce8\u91ca\u6389\uff0c\u89e3\u51b3 gets undefined \u7684\u95ee\u9898\uff08\u53c2\u8003\u4e86 CentOS \u4e0b Git \u5347\u7ea7\uff09</p> <pre><code>@@ -159,7 +159,7 @@\n    so any use of gets warrants an unconditional warning.  Assume it is\n    always declared, since it is required by C89.  */\n #undef gets\n-_GL_WARN_ON_USE (gets, \"gets is a security hole - use fgets instead\");\n+// _GL_WARN_ON_USE (gets, \"gets is a security hole - use fgets instead\");\n\n #if @GNULIB_FOPEN@\n # if @REPLACE_FOPEN@\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>buildtools</code>\uff0c\u5728 perl \u7684 configure \u547d\u4ee4\u4e2d\u7684 <code>-A ldflags</code> \u9644\u8fd1\uff0c\u628a <code>-A libs=-lm -A ccflags=-fwrapv</code> \u6dfb\u52a0\u5230\u547d\u4ee4\u4e2d\uff0c\u89e3\u51b3\u627e\u4e0d\u5230 math \u51fd\u6570\u7684\u95ee\u9898\u548c numconvert.t \u6d4b\u8bd5\u5931\u8d25\u7684\u95ee\u9898\uff08\u53c2\u8003 https://serverfault.com/a/801997/323597 \u548c \u5982\u4f55\u5728 Hifive Unmatched \u5f00\u53d1\u677f\u4e0a\u5b89\u88c5 SPEC CPU 2006\uff09\uff1a</p> <pre><code>@@ -355,7 +355,7 @@\n     LD_LIBRARY_PATH=`pwd`\n     DYLD_LIBRARY_PATH=`pwd`\n     export LD_LIBRARY_PATH DYLD_LIBRARY_PATH\n-    ./Configure -dOes -Ud_flock $PERLFLAGS -Ddosuid=undef -Dprefix=$INSTALLDIR -Dd_bincompat3=undef -A ldflags=-L${INSTALLDIR}/lib -A ccflags=-I${INSTALLDIR}/include -Ui_db -Ui_gdbm -Ui_ndbm -Ui_dbm -Uuse5005threads ; testordie \"error configuring perl\"\n+    ./Configure -dOes -Ud_flock $PERLFLAGS -Ddosuid=undef -Dprefix=$INSTALLDIR -Dd_bincompat3=undef -A libs=-lm -A ccflags=-fwrapv -A ldflags=\"-L${INSTALLDIR}/lib\" -A ccflags=\"-I${INSTALLDIR}/include -g\" -Ui_db -Ui_gdbm -Ui_ndbm -Ui_dbm -Uuse5005threads ; testordie \"error configuring perl\"\n     $MYMAKE; testordie \"error building Perl\"\n     ./perl installperl; testordie \"error installing Perl\"\n     setspecperllib\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>perl-5.12.3/Configure</code>\uff0c\u628a\u5224\u65ad GCC \u7248\u672c\u7684 <code>1*</code> \u90fd\u6539\u6210 <code>1.*</code>\uff0c\u89e3\u51b3 miniperl Segmentation fault \u7684\u95ee\u9898\uff08\u53c2\u8003 unmatched(riscv64) \u4e0a\u7f16\u8bd1\uff0c\u5b89\u88c5\u548c\u79fb\u690d SPEC CPU 2006\uff09</p> <pre><code>@@ -4536,7 +4536,7 @@\n fi\n $rm -f try try.*\n case \"$gccversion\" in\n-1*) cpp=`./loc gcc-cpp $cpp $pth` ;;\n+1.*) cpp=`./loc gcc-cpp $cpp $pth` ;;\n esac\n case \"$gccversion\" in\n '') gccosandvers='' ;;\n@@ -5128,7 +5140,7 @@\n case \"$hint\" in\n default|recommended)\n        case \"$gccversion\" in\n-       1*) dflt=\"$dflt -fpcc-struct-return\" ;;\n+       1.*) dflt=\"$dflt -fpcc-struct-return\" ;;\n        esac\n        case \"$optimize:$DEBUGGING\" in\n        *-g*:old) dflt=\"$dflt -DDEBUGGING\";;\n@@ -5143,7 +5155,7 @@\n                ;;\n        esac\n        case \"$gccversion\" in\n-       1*) ;;\n+       1.*) ;;\n        2.[0-8]*) ;;\n        ?*)     set strict-aliasing -fno-strict-aliasing\n                eval $checkccflag\n@@ -5245,7 +5257,7 @@\n *)  cppflags=\"$cppflags $ccflags\" ;;\n esac\n case \"$gccversion\" in\n-1*) cppflags=\"$cppflags -D__GNUC__\"\n+1.*) cppflags=\"$cppflags -D__GNUC__\"\n esac\n case \"$mips_type\" in\n '');;\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>perl-5.12.3/Configure</code>\uff0c\u5728 <code>if $ok; then</code> \u540e\u9762\u52a0\u4e0a\u5982\u4e0b\u4ee3\u7801\uff0c\u89e3\u51b3 magic.t \u6d4b\u8bd5\u5931\u8d25\u7684\u95ee\u9898\uff08\u53c2\u8003 \u5982\u4f55\u5728 Hifive Unmatched \u5f00\u53d1\u677f\u4e0a\u5b89\u88c5 SPEC CPU 2006 \u548c Tests fail with GCC 5.0 because Errno cannot obtain errno constants\uff09\uff1a</p> <pre><code>elif echo 'Maybe \"'\"$cc\"' -E -ftrack-macro-expansion=0\" will work...'; \\\n       $cc -E -ftrack-macro-expansion=0 &lt;testcpp.c &gt;testcpp.out 2&gt;&amp;1; \\\n       $contains 'abc.*xyz' testcpp.out &gt;/dev/null 2&gt;&amp;1 ; then\n       echo \"Yup, it does.\"\n       x_cpp=\"$cc $cppflags -E -ftrack-macro-expansion=0\"\n       x_minus='';\nelif echo 'Maybe \"'\"$cc\"' -E -ftrack-macro-expansion=0 -\" will work...';\n       $cc -E -ftrack-macro-expansion=0 - &lt;testcpp.c &gt;testcpp.out 2&gt;&amp;1; \\\n       $contains 'abc.*xyz' testcpp.out &gt;/dev/null 2&gt;&amp;1 ; then\n       echo \"Yup, it does.\"\n       x_cpp=\"$cc $cppflags -E -ftrack-macro-expansion=0\"\n       x_minus='-';\n</code></pre> <pre><code>@@ -4688,6 +4688,18 @@\n\n if $ok; then\n        : nothing\n+elif echo 'Maybe \"'\"$cc\"' -E -ftrack-macro-expansion=0\" will work...'; \\\n+       $cc -E -ftrack-macro-expansion=0 &lt;testcpp.c &gt;testcpp.out 2&gt;&amp;1; \\\n+       $contains 'abc.*xyz' testcpp.out &gt;/dev/null 2&gt;&amp;1 ; then\n+       echo \"Yup, it does.\"\n+       x_cpp=\"$cc $cppflags -E -ftrack-macro-expansion=0\"\n+       x_minus='';\n+elif echo 'Maybe \"'\"$cc\"' -E -ftrack-macro-expansion=0 -\" will work...';\n+       $cc -E -ftrack-macro-expansion=0 - &lt;testcpp.c &gt;testcpp.out 2&gt;&amp;1; \\\n+       $contains 'abc.*xyz' testcpp.out &gt;/dev/null 2&gt;&amp;1 ; then\n+       echo \"Yup, it does.\"\n+       x_cpp=\"$cc $cppflags -E -ftrack-macro-expansion=0\"\n+       x_minus='-';\n elif echo 'Maybe \"'\"$cc\"' -E\" will work...'; \\\n        $cc -E &lt;testcpp.c &gt;testcpp.out 2&gt;&amp;1; \\\n        $contains 'abc.*xyz' testcpp.out &gt;/dev/null 2&gt;&amp;1 ; then\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>TimeDate-1.20/t/getdate.t</code> \u7684 <code>my $offset = Time::Local::timegm(0,0,0,1,0,70);</code> \u4e3a <code>my $offset = Time::Local::timegm(0,0,0,1,0,1970);</code>\uff0c\u89e3\u51b3 <code>error running TimeDate-1.20 test suite</code> \u62a5\u9519\uff08\u53c2\u8003 unmatched(riscv64) \u4e0a\u7f16\u8bd1\uff0c\u5b89\u88c5\u548c\u79fb\u690d SPEC CPU 2006\uff09\uff1a</p> <pre><code>@@ -156,7 +156,7 @@\n!;\n\nrequire Time::Local;\n-my $offset = Time::Local::timegm(0,0,0,1,0,70);\n+my $offset = Time::Local::timegm(0,0,0,1,0,1970);\n\n@data = split(/\\n/, $data);\n</code></pre> </li> </ol> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6b63\u5e38\u5b8c\u6210 <code>./buildtools</code> \u4e86\uff0c\u4e2d\u95f4 perl \u6d4b\u8bd5\u51fa\u9519\uff0c\u6309 <code>y</code> \u5ffd\u7565\u5373\u53ef\u3002</p> <p>\u7f16\u8bd1\u5b8c\u6210\u4ee5\u540e\uff0c\u56de\u5230\u590d\u5236\u540e\u7684 ISO \u6839\u76ee\u5f55\u8fdb\u884c\u6253\u5305\uff0c\u6253\u5305\u5b8c\u6b63\u5e38\u5b89\u88c5\u5373\u53ef\uff1a</p> <pre><code>source shrc\npackagetools linux-aarch64\nexport SPEC_INSTALL_NOCHECK=1\n./install.sh -d /install/path\n</code></pre> <p>\u6dfb\u52a0 <code>export SPEC_INSTALL_NOCHECK=1</code> \u73af\u5883\u53d8\u91cf\u662f\u56e0\u4e3a\u4fee\u6539\u4e86\u6e90\u7801\uff0cmd5 \u5bf9\u4e0d\u4e0a\uff0c\u6240\u4ee5\u8981\u8df3\u8fc7\u6821\u9a8c\u3002</p> <p>\u5b9e\u6d4b\u4e0a\u8ff0\u6b65\u9aa4\u5728 POWER8 ppc64le \u548c LoongArch64 \u4e0a\u4e5f\u53ef\u4ee5\u6210\u529f\u3002</p> <p>\u5728 AArch64 \u6216\u8005 PPC64LE \u4e0a\u8dd1 SPEC \u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u9047\u5230 Miscompare #7\uff0c\u5728\u7f16\u8bd1\u9009\u9879\u91cc\u52a0\u4e0a <code>-fsigned-char</code> \u5373\u53ef\uff1a</p> <pre><code># fix compilation and miscompare\nint=default=default=default:\nPORTABILITY = -DSPEC_CPU_LP64 -fsigned-char\n</code></pre> <p>SPEC CPU 2017 \u57fa\u672c\u7c7b\u4f3c\uff0c\u4e0b\u9762\u7ed9\u51fa\u9700\u8981\u8fd0\u884c\u7684\u547d\u4ee4\uff1a</p> <pre><code># https://gist.github.com/cyyself/4cee148ad11081dde7b938e3584b4536\nwget -O config.guess 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD'\nwget -O config.sub 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD'\ncp config.* /mnt/tools/src/expat-2.1.0/conftools/\ncp config.* /mnt/tools/src/make-4.2.1/config/\ncp config.* /mnt/tools/src/rxp-1.5.0/\ncp config.* /mnt/tools/src/specinvoke/\ncp config.* /mnt/tools/src/specsum/build-aux/\ncp config.* /mnt/tools/src/tar-1.28/build-aux/\ncp config.* /mnt/tools/src/xz-5.2.2/build-aux/\n# fix glob impl\n# https://github.com/GQBBBB/GQBBBB.github.io/issues/10\n# http://git.savannah.gnu.org/cgit/make.git/patch/?id=48c8a116a914a325a0497721f5d8b58d5bba34d4\nsed -i 's/_GNU_GLOB_INTERFACE_VERSION ==/_GNU_GLOB_INTERFACE_VERSION &gt;=/' /mnt/tools/src/make-4.2.1/glob/glob.c\n# fix missing test_driver.pl\n# https://bugs.gentoo.org/613772\n# http://git.savannah.gnu.org/cgit/make.git/commit/tests/run_make_tests.pl?id=d9d4e06084a4c7da480bd49a3487aadf6ba77b54\nsed -i 's/require \"test_driver.pl\";/use FindBin;\\nuse lib \"$FindBin::Bin\";\\n\\0/' /mnt/tools/src/make-4.2.1/tests/run_make_tests.pl\n# fix wildcard test sigsegv\n# https://lore.kernel.org/all/20200122223655.2569-1-sno@netbsd.org/T/\n# http://git.savannah.gnu.org/cgit/make.git/commit/?id=193f1e81edd6b1b56b0eb0ff8aa4b41c7b4257b4\nsed -i 's/gl-&gt;gl_stat = local_stat;/gl-&gt;gl_lstat = lstat;\\n\\0/' /mnt/tools/src/make-4.2.1/dir.c\n# missing include ctype.h for isxdigit\nsed -i 's/#include \"xfreopen.h\"/#include &lt;ctype.h&gt;\\n\\0/' /mnt/tools/src/specsum/src/md5sum.c\n# fix gcc version detection\nsed -i 's/1\\*)/1.\\*)/g' /mnt/tools/src/perl-5.24.0/Configure\n# fix gettime test\nsed -i 's/timegm(0,0,0,1,0,70)/timegm(0,0,0,1,0,1970)/g' /mnt/tools/src/TimeDate-2.30/t/getdate.t\n# fix re.o generated instead of re.so\nsed -i 's/main/int main/g' /mnt/tools/src/perl-5.24.0/hints/linux.sh\n# build tools\ncd /mnt &amp;&amp; echo 'y' | SKIPTOOLSINTRO=1 FORCE_UNSAFE_CONFIGURE=1 MAKEFLAGS=-j16 ./tools/src/buildtools\n</code></pre> <p>\u5b98\u65b9\u6587\u6863\uff1aBuilding the SPEC CPU\u00ae2017 Toolset</p>","tags":["benchmark","spec"]},{"location":"software/2021/02/15/sssd-ldap/","title":"\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1","text":"","tags":["sssd","ldap","pam","nss","starttls"]},{"location":"software/2021/02/15/sssd-ldap/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u66ff\u6362\u4e00\u4e2a\u8001\u7684\u7528\u6237\u7cfb\u7edf\uff0c\u4e8e\u662f\u987a\u4fbf\u5b66\u4e60\u4e86\u4e00\u4e0b LDAP\uff0c\u8fd8\u6709 SSSD\u3002LDAP \u662f\u4e00\u4e2a\u76ee\u5f55\u534f\u8bae\uff0c\u987a\u5e26\u7684\uff0c\u56e0\u4e3a\u7528\u6237\u4fe1\u606f\u4e5f\u53ef\u4ee5\u5b58\u5728\u91cc\u9762\uff0c\u6240\u4ee5\u4e5f\u5c31\u6210\u4e86\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u6237\u8ba4\u8bc1\u534f\u8bae\u3002SSSD \u5c31\u662f\u4e00\u4e2a daemon\uff0c\u628a\u7cfb\u7edf\u7684 NSS PAM \u7684\u673a\u5236\u548c LDAP \u8fde\u63a5\u8d77\u6765\u3002</p>","tags":["sssd","ldap","pam","nss","starttls"]},{"location":"software/2021/02/15/sssd-ldap/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5b89\u88c5 sssd \u5e76\u4e14\u914d\u7f6e\u5373\u53ef\uff1a</p> <pre><code>$ sudo apt install sssd\n$ sudo vim /etc/sssd/sssd.conf\n# file content:\n[sssd]\nconfig_file_version = 2\nservices = nss,pam\ndomains = LDAP\n\n[domain/LDAP]\ncache_credentials = true\nenumerate = true\nentry_cache_timeout = 10\nldap_network_timeout = 2\n\nid_provider = ldap\nauth_provider = ldap\nchpass_provider = ldap\n\nldap_uri = ldap://127.0.0.1/\nldap_chpass_uri = ldap://127.0.0.1/\nldap_search_base = dc=example,dc=com\nldap_default_bind_dn = cn=localhost,ou=machines,dc=example,dc=com\nldap_default_authtok = REDACTED\n$ sudo systemctl enable --now sssd\n</code></pre> <p>\u4e00\u4e9b\u5b57\u6bb5\u9700\u8981\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u7f16\u5199\uff0c\u8bf7\u53c2\u8003sssd.conf \u548c sssd-ldap\u3002</p>","tags":["sssd","ldap","pam","nss","starttls"]},{"location":"software/2021/02/15/sssd-ldap/#\u534f\u8bae","title":"\u534f\u8bae","text":"<p>\u90a3\u4e48\uff0cLDAP \u91cc\u9762\u7684\u7528\u6237\u662f\u5982\u4f55\u548c Linux \u91cc\u7684\u7528\u6237\u5bf9\u5e94\u8d77\u6765\u7684\u5462\uff1f\u53ef\u4ee5\u770b\u5230\uff0cSSSD \u4f1a\u67e5\u8be2 posixAccount\uff1a</p> <pre><code>(&amp;(objectclass=posixAccount)(uid=*)(uidNumber=*)(gidNumber=*))\n</code></pre> <p>\u7136\u540e\uff0c\u53ef\u4ee5\u67e5\u5230 posixAccount \u7684 schema\uff0c\u91cc\u9762\u53ef\u4ee5\u89c1\u5230\u5bf9\u5e94 <code>/etc/passwd</code> \u7684\u5404\u4e2a\u5b57\u6bb5\u3002\u76f8\u5e94\u7684\uff0c\u4e5f\u6709 <code>shadowAccount</code> \u5bf9\u5e94 <code>/etc/shadow</code>\u3002</p> <p>\u6309\u7167\u8981\u6c42\u914d\u597d\u4ee5\u540e\uff08\u5efa\u8bae\u7528 ldapvi \u5de5\u5177\uff09\uff0c\u5c31\u53ef\u4ee5\u7528 <code>getent passwd</code> \u770b\u5230\u65b0\u589e\u7684\u7528\u6237\u4e86\u3002</p> <p>\u4e0a\u9762\u7684\u90e8\u5206\u662f\u901a\u8fc7 NSS \u63a5\u53e3\u6765\u67e5\u8be2\u7684\uff0c\u9664\u4e86\u7528\u6237\u4ee5\u5916\uff0c\u8fd8\u6709\u5176\u4ed6\u7684\u4e00\u4e9b NIS \u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7 LDAP \u67e5\u8be2\u3002\u6b64\u5916\uff0c\u5982\u679c\u8981\u767b\u5f55\u7684\u8bdd\uff0c\u5219\u662f\u7528 PAM \u8ba4\u8bc1\uff0cSSSD \u5219\u4f1a\u628a PAM \u8ba4\u8bc1\u8f6c\u6362\u6210 LDAP \u7684 Bind\uff1a</p> <pre><code>$ su test\nPassword:\n# sssd: bind to dn of test user with password\n</code></pre> <p>\u5982\u679c Bind \u6210\u529f\uff0c\u5219\u8ba4\u4e3a\u767b\u5f55\u6210\u529f\uff1b\u5426\u5219\u5c31\u662f\u767b\u5f55\u5931\u8d25\u3002</p> <p>\u5982\u679c\u7528\u6237\u8981\u4fee\u6539\u5bc6\u7801\uff0cSSSD \u9ed8\u8ba4\u7528\u7684\u662f RFC3062 LDAP Password Modify Extended Operation \u7684\u65b9\u5f0f\uff1b\u5982\u679c\u670d\u52a1\u5668\u4e0d\u652f\u6301\u7684\u8bdd\uff0c\u53ef\u4ee5\u6309\u7167 \u6587\u6863 \u4f7f\u7528 ldap modify \u65b9\u5f0f\u6765\u4fee\u6539\u5bc6\u7801\u3002</p> <p>SSD \u8fd8\u53ef\u4ee5\u914d\u7f6e sudo \u652f\u6301\uff0c\u4e5f\u662f\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u6dfb\u52a0 objectClass=sudoRole \u7684\u76ee\u5f55\u9879\u5373\u53ef\u3002\u53ef\u4ee5\u53c2\u8003 man sudoers.ldap \u7f16\u5199\u5bf9\u5e94\u7684\u76ee\u5f55\u9879\u3002</p> <p>\u5bf9\u4e8e SSH \u914d\u7f6e\uff0c\u53ef\u4ee5\u53c2\u8003 RedHat \u7684\u6587\u6863\uff0c\u548c\u53c2\u8003 man sss_ssh_authorizedkeys \u914d\u7f6e authorized keys \u547d\u4ee4\u3002\u7136\u540e\uff0c\u7ed9\u7528\u6237\u6dfb\u52a0 <code>sshPublicKey</code> \u5c5e\u6027\u5373\u53ef\uff0c\u5185\u5bb9\u4e0e <code>~/.ssh/id_*.pub</code> \u4e00\u81f4\u3002</p>","tags":["sssd","ldap","pam","nss","starttls"]},{"location":"software/2021/02/15/sssd-ldap/#\u76f8\u5173-rfc","title":"\u76f8\u5173 RFC","text":"<p>LDAP-Related RFCs</p> <ul> <li>RFC2307 An Approach for Using LDAP as a Network Information Service</li> <li>RFC3062 LDAP Password Modify Extended Operation</li> <li>RFC4511 Lightweight Directory Access Protocol (LDAP): The Protocol</li> <li>RFC4512 Lightweight Directory Access Protocol (LDAP): Directory Information Models</li> <li>RFC4513 Lightweight Directory Access Protocol (LDAP): Authentication Methods and Security Mechanisms</li> <li>RFC4517 Lightweight Directory Access Protocol (LDAP): Syntaxes and Matching Rules</li> <li>RFC4519 Lightweight Directory Access Protocol (LDAP): Schema for User Applications</li> </ul>","tags":["sssd","ldap","pam","nss","starttls"]},{"location":"software/2019/03/24/static-building-sqlite/","title":"\u9759\u6001\u7f16\u8bd1 sqlite3","text":"<p>\u6700\u8fd1 rCore \u652f\u6301\u4e86\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u4e8e\u662f\u60f3\u7740\u5728\u6d4b\u8bd5 sqlite \u7684\u65f6\u5019\u76f4\u63a5\u7528\u52a8\u6001\u7684\uff0c\u4e0d\u8fc7\u51fa\u73b0\u4e86\u7384\u5b66\u7684\u95ee\u9898\uff0c\u5b83\u4f1a\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u5730\u5740\uff0c\u770b\u4ee3\u7801\u4e5f\u6ca1\u770b\u51fa\u4e2a\u6240\u4ee5\u7136\u6765\u3002\u6240\u4ee5\u7814\u7a76\u4e86\u4e00\u4e0b sqlite \u7684\u9759\u6001\u7f16\u8bd1\u3002\u9996\u5148\u5728 <code>configure</code> \u7684\u65f6\u5019\u5c1d\u8bd5\u4e86\u4e00\u4e0b\uff1a</p> <pre><code>$ ./configure CC=x86_64-linux-musl-gcc --disable-shared --enabled-static\n</code></pre> <p>\u53d1\u73b0 <code>libsqlite</code> \u786e\u5b9e\u662f\u9759\u6001\u4e86\uff0c\u4f46\u662f <code>sqlite3</code> \u5e76\u4e0d\u662f\u3002\u4e00\u756a\u7814\u7a76\u4ee5\u540e\uff0c\u53d1\u73b0\u662f <code>libtool</code> \u7684\u539f\u56e0\uff0c\u53ea\u8981\u8fd9\u6837\u7f16\u8bd1\uff1a</p> <pre><code>$ make LTLINK_EXTRAS=-all-static\n</code></pre> <p>\u5c31\u53ef\u4ee5\u7f16\u8bd1\u51fa\u9759\u6001\u7684 <code>sqlite3</code> \uff1a</p> <pre><code>sqlite3: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n</code></pre>","tags":["rcore","x86","x86_64","static","musl","sqlite"]},{"location":"software/2023/05/23/tar-format/","title":"Tar \u6587\u4ef6\u683c\u5f0f","text":"<p>\u672c\u6587\u7684\u5185\u5bb9\u5df2\u7ecf\u6574\u5408\u5230\u77e5\u8bc6\u5e93\u4e2d\u3002</p>","tags":["tar"]},{"location":"software/2023/05/23/tar-format/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u89e3\u538b tar.gz \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u5982\u679c\u7528 unar \u89e3\u538b\uff0c\u5c31\u4f1a\u51fa\u73b0\u6587\u4ef6\u540d\u622a\u65ad\u5230 100 \u4e2a\u5b57\u8282\u7684\u95ee\u9898\uff0c\u800c\u5982\u679c\u7528 gnu tar \u89e3\u538b\uff0c\u6587\u4ef6\u540d\u5c31\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u6b64\u6df1\u5165\u7814\u7a76\u4e86\u4e00\u4e0b Tar \u7684\u6587\u4ef6\u683c\u5f0f\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u662f\u56e0\u4e3a\u65e9\u671f tar \u683c\u5f0f\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5c31\u8bbe\u5b9a\u4e86\u8def\u5f84\u6700\u957f 100 \u5b57\u8282\u7684\u9650\u5236\uff0c\u540e\u6765\u7684\u6269\u5c55\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f unar \u6ca1\u80fd\u6b63\u786e\u5730\u8bc6\u522b\u6269\u5c55\uff0c\u5bfc\u81f4\u89e3\u538b\u8def\u5f84\u51fa\u9519\u3002</p>","tags":["tar"]},{"location":"software/2023/05/23/tar-format/#tar-\u6587\u4ef6\u683c\u5f0f_1","title":"Tar \u6587\u4ef6\u683c\u5f0f","text":"<p>Tar \u7684\u6587\u4ef6\u683c\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u4e00\u7cfb\u5217\u7684 File Entry\uff0c\u6700\u540e\u662f\u4e24\u4e2a 512 \u5b57\u8282\u7684\u5168 0\uff0c\u8868\u793a\u7ed3\u675f\u3002\u6bcf\u4e2a File Entry \u7531\u5934\u90e8\u548c\u6570\u636e\u7ec4\u6210\uff0c\u5934\u90e8\u7684\u683c\u5f0f\u662f\uff1a</p> <pre><code>/* tar Header Block, from POSIX 1003.1-1990.  */\n\n/* POSIX header.  */\n\nstruct posix_header\n{                              /* byte offset */\n  char name[100];               /*   0 */\n  char mode[8];                 /* 100 */\n  char uid[8];                  /* 108 */\n  char gid[8];                  /* 116 */\n  char size[12];                /* 124 */\n  char mtime[12];               /* 136 */\n  char chksum[8];               /* 148 */\n  char typeflag;                /* 156 */\n  char linkname[100];           /* 157 */\n  char magic[6];                /* 257 */\n  char version[2];              /* 263 */\n  char uname[32];               /* 265 */\n  char gname[32];               /* 297 */\n  char devmajor[8];             /* 329 */\n  char devminor[8];             /* 337 */\n  char prefix[155];             /* 345 */\n                                /* 500 */\n};\n</code></pre> <p>\u6765\u6e90\uff1aBasic Tar Format</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5c31\u662f\u4e00\u7cfb\u5217\u7684 char \u6570\u7ec4\uff0c\u91cc\u9762\u7684\u5f88\u591a\u6570\u5b57\u5b57\u6bb5\uff0c\u4f8b\u5982 mode\uff0cuid \u548c gid \u7b49\uff0c\u90fd\u662f\u7528 ASCII \u7801\u5199\u7684\u3002\u7531\u4e8e\u5934\u90e8\u9700\u8981\u5bf9\u9f50\u5230 512 \u5b57\u8282\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u540e\u9762\u8fd8\u6709 12 \u5b57\u8282\u7684 padding\u3002</p> <p>\u5934\u90e8\u7684 512 \u5b57\u8282\u7ed3\u675f\u540e\uff0c\u7d27\u63a5\u7740\u5c31\u662f\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5185\u5bb9\u7684\u5927\u5c0f\u5728\u5934\u90e8\u7684 size \u5b57\u6bb5\u5df2\u7ecf\u4fdd\u5b58\uff0c\u628a\u5b57\u7b26\u4e32\u5f53\u6210 8 \u8fdb\u5236\u6570\u8f6c\u6362\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6587\u4ef6\u957f\u5ea6\u3002\u6587\u4ef6\u4e5f\u8981\u5bf9\u9f50\u5230 512 \u5b57\u8282\uff0c\u6240\u4ee5\u6587\u4ef6\u540e\u9762\u8fd8\u6709\u82e5\u5e72\u4e2a 0 \u4f5c\u4e3a padding\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0cTar \u6587\u4ef6\u7684\u683c\u5f0f\u5c31\u662f\uff1a<code>(\u5934\u90e8\uff0c\u6570\u636e)*\u7ed3\u5c3e</code>\u3002\u6bcf\u4e00\u4e2a\u90e8\u5206\u90fd\u5bf9\u9f50\u5230 512 \u5b57\u8282\u3002</p>","tags":["tar"]},{"location":"software/2023/05/23/tar-format/#pax-\u6269\u5c55","title":"PAX \u6269\u5c55","text":"<p>\u5982\u679c\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0\u4e0a\u9762\u7684 <code>posix_header</code> \u91cc\u9762\uff0c<code>name</code> \u5b57\u6bb5\u53ea\u6709 100 \u4e2a\u5b57\u8282\uff0c\u610f\u5473\u7740\u5982\u679c\u6587\u4ef6\u8def\u5f84\u7279\u522b\u957f\uff0c\u90a3\u5c31\u653e\u4e0d\u4e0b\uff0c\u53ea\u80fd\u622a\u65ad\u4e86\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cTar \u5f15\u5165\u4e86 PAX \u6269\u5c55\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0cPAX \u6269\u5c55\u4ee5\u7279\u6b8a\u7684\u6587\u4ef6\u5f62\u5f0f\u5b58\u5728\u3002\u4f8b\u5982\u8981\u8bb0\u5f55\u4e00\u4e2a\u540d\u5b57\u5f88\u957f\u7684\u6587\u4ef6 <code>'X'*101</code>\uff0c\u5b9e\u9645\u4e0a Tar \u4e2d\u8bb0\u5f55\u4e86\u4e24\u4e2a\u6587\u4ef6\uff1a</p> <ol> <li>PaxHeader\uff1a\u7279\u6b8a\u7684 PAX \u6587\u4ef6\uff0c\u4e0d\u5bf9\u5e94\u5b9e\u9645\u7684\u6587\u4ef6</li> <li><code>'X'*100</code>\uff1a\u6587\u4ef6\u540d\u88ab\u622a\u65ad\uff0c\u5176\u4ed6\u4e0d\u53d8</li> </ol> <p>\u8fd9\u4e2a PaxHeader \u5728\u89e3\u538b\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u751f\u6210\u5b9e\u9645\u7684\u6587\u4ef6\u3002\u5b83\u7684\u5185\u5bb9\u662f\u4e00\u4e9b\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>123 path=XXXXXXXXXXXXXXXXX...\n</code></pre> <p>\u683c\u5f0f\u662f\uff1a<code>length key=value\\n</code>\uff0c\u7136\u540e\u53ef\u4ee5\u6709\u591a\u4e2a\u8fd9\u6837\u7684\u952e\u503c\u5bf9\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u51b3 <code>posix_header</code> \u91cc\u540d\u5b57\u957f\u5ea6\u9650\u5236\u7684\u95ee\u9898\uff1a\u53ea\u8981\u5728 PaxHeader \u6587\u4ef6\u91cc\uff0c\u4fdd\u5b58\u4e00\u4e2a key \u4e3a path\uff0cvalue \u4e3a\u5b9e\u9645\u540d\u5b57\u7684\u4fe1\u606f\u3002\u90a3\u4e48 tar \u5728\u770b\u5230 PaxHeader \u7684\u65f6\u5019\uff0c\u8bb0\u5f55\u4e0b\u6765\uff0c\u518d\u9047\u5230\u4e0b\u4e00\u4e2a\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5c31\u77e5\u9053\u8981\u7528 PaxHeader \u4e2d\u7684 path\uff0c\u800c\u4e0d\u662f\u4fdd\u5b58\u5728 <code>posix_header</code> \u4e2d\u7684 <code>name[100]</code>\u3002</p> <p>\u7c7b\u4f3c\u5730\uff0cPaxHeader \u8fd8\u53ef\u4ee5\u5b58\u5f88\u591a\u5176\u4ed6 <code>posix_header</code> \u4e2d\u6ca1\u6709\u7684\u4fe1\u606f\uff0c\u4f8b\u5982 <code>atime</code>\u3001<code>ctime</code> \u548c <code>uid</code> \u7b49\u7b49\u3002\u5b8c\u6574\u5217\u8868\u53ef\u4ee5\u53c2\u8003 Extended header keywords\u3002</p>","tags":["tar"]},{"location":"software/2023/05/23/tar-format/#bard","title":"Bard","text":"<p>Bard \u8bb2\u89e3 Tar \u683c\u5f0f\uff1a</p> <p>A tar file is an archive file format that is used to store a collection of files in a single file. The tar format is a standard format on Unix-like operating systems and is also supported by many other operating systems.</p> <p>A tar file consists of a series of blocks, each of which contains 512 bytes of data. Each block contains a header and a body. The header contains information about the file, such as the file name, the file size, and the file permissions. The body contains the actual contents of the file.</p> <p>The tar format is a simple and efficient format for storing files. It is also a portable format, which means that tar files can be moved from one computer to another without any problems.</p> <p>Here is a more detailed description of the tar file format:</p> <ul> <li>The header of a tar file is 512 bytes long. It contains the following information:<ul> <li>The name of the file</li> <li>The size of the file</li> <li>The permissions of the file</li> <li>The modification time of the file</li> <li>The owner of the file</li> <li>The group of the file</li> </ul> </li> <li>The body of a tar file contains the actual contents of the file. The body is padded to a multiple of 512 bytes.</li> <li>Tar files can be compressed using a variety of compression algorithms, such as gzip, bzip2, and xz.</li> </ul> <p>Tar files are a versatile format that can be used for a variety of purposes. They are commonly used for backing up files, distributing software, and archiving files.</p> <p>Here are some of the benefits of using tar files:</p> <ul> <li>Tar files are a standard format that is supported by many operating systems.</li> <li>Tar files are a portable format, which means that they can be moved from one computer to another without any problems.</li> <li>Tar files can be compressed using a variety of compression algorithms, which can significantly reduce the size of the archive.</li> <li>Tar files can be easily created and managed using the tar command-line tool.</li> </ul> <p>If you need to store a collection of files in a single file, then a tar file is a good option to consider.</p> <p>Bard \u8bb2\u89e3 PAX \u6269\u5c55\uff1a</p> <p>The POSIX 1003.1-2001 (pax) format for tar archives supports file names longer than 256 characters by using a different format for storing file names and metadata than the traditional ustar format. In the pax format, file names are stored as null-terminated strings, which means that they can be any length up to the maximum file size supported by the underlying file system. The metadata for each file is also stored in a separate record, which allows for more flexibility in the types of metadata that can be stored.</p> <p>To create a tar archive in the pax format, you can use the following command:</p> <pre><code>tar cf - --format=pax /path/to/files\n</code></pre> <p>To extract a tar archive in the pax format, you can use the following command:</p> <pre><code>tar xvf - --format=pax archive.tar\n</code></pre> <p>The pax format is a more flexible and powerful format than the ustar format, and it is recommended for use when creating or extracting tar archives that may contain file names longer than 256 characters.</p> <p>Here are some additional details about the pax format:</p> <ul> <li>File names are stored as null-terminated strings, which means that they can be any length up to the maximum file size supported by the underlying file system.</li> <li>The metadata for each file is stored in a separate record, which allows for more flexibility in the types of metadata that can be stored.</li> <li>The pax format is supported by most modern tar implementations.</li> </ul> <p>Here are some examples of file names that can be stored in the pax format:</p> <ul> <li>\"This is a file name with more than 256 characters.\"</li> <li>\"/path/to/a/file/with/a/long/name.\"</li> <li>\"file.with.spaces.in.its.name\"</li> </ul> <p>The pax format is a good choice for storing file names that may be long, contain special characters, or be stored in a directory hierarchy with a long path.</p>","tags":["tar"]},{"location":"software/2016/02/17/tips-in-os-x/","title":"Screen Capturing Tips in macOS","text":"<p>I'm sure many people have already known this. But i haven't memorize it yet.</p> <p>How to screen capture:</p> <pre><code>Shift+Command+3: Capture fullscreen.\nShift+Command+4: Capture region.\n               : Press space to capture window. \n               : Hold option and drag, then\n               : you will capture a region with its center in where you started dragging \n               : and one of its corners under your cursor.\nCtrl+OneOfTheTwoAbove: Capture to clipboard.\ndefaults write com.apple.screencapture location: Change the default location storing the images.\n</code></pre> <p>Apps enhancing the snapshots: Snappy and Mapture.</p> <p>See more detailed here.</p>","tags":["tips","osx","macos"]},{"location":"software/2020/05/15/usb-ip-simulation/","title":"USB/IP \u6a21\u62df USB \u8bbe\u5907","text":"","tags":["linux","usbip"]},{"location":"software/2020/05/15/usb-ip-simulation/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>2018 \u5e74\u7684\u65f6\u5019\u53d1\u8fc7\u4e00\u7bc7\u535a\u5ba2\uff0c\u8bb2\u5982\u4f55\u7528 USB/IP \u534f\u8bae\u5728\u4e24\u53f0 Linux \u7535\u8111\u4e4b\u95f4\u5171\u4eab USB \u8bbe\u5907\u3002\u6700\u8fd1\u521a\u597d\u6709\u4e00\u4e2a\u9700\u6c42\uff0c\u5c31\u662f\u9488\u5bf9\u4e00\u4e2a\u73b0\u6210\u7684 USB device \u7684\u4ee3\u7801\uff0c\u901a\u8fc7 USB/IP \u6a21\u62df\u51fa\u4e00\u4e2a USB \u8bbe\u5907\uff0c\u7136\u540e\u8fdb\u884c\u8c03\u8bd5\u3002</p>","tags":["linux","usbip"]},{"location":"software/2020/05/15/usb-ip-simulation/#usbip-\u534f\u8bae","title":"USB/IP \u534f\u8bae","text":"<p>USB/IP \u53ea\u6709\u4e00\u4e2a\u7b80\u7565\u7684\u6587\u6863\uff0c\u4e3a\u6570\u4e0d\u591a\u7684\u4f7f\u7528 USB/IP \u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u6709\u4e00\u4e9b\u7ec6\u8282\u6ca1\u6709\u8bf4\u7684\u5f88\u6e05\u695a\uff0c\u53ea\u80fd\u4e00\u70b9\u70b9\u53bb\u5c1d\u8bd5\u3002</p> <p>\u9996\u5148\uff0cUSB/IP \u57fa\u4e8e TCP\uff0c\u7aef\u53e3\u53f7 3240\u3002\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u8fdb\u884c\u56de\u5e94\u3002</p> <p>\u8bf7\u6c42\u7684\u7c7b\u578b\uff1aOP_REQ_DEVLIST OP_REQ_IMPORT USBIP_CMD_SUBMIT \u548c USBIP_CMD_UNLINK</p> <p>\u56de\u5e94\u7684\u7c7b\u578b\uff1aOP_REP_DEVLIST OP_REP_IMPORT USBIP_RET_SUBMIT USBIP_RET_UNLINK</p> <p>\u5de5\u4f5c\u7684\u8fc7\u7a0b\u5927\u6982\u5982\u4e0b\uff1a</p> <ol> <li>OP_REQ_DEVLIST \u8bf7\u6c42\u83b7\u53d6\u8bbe\u5907\u5217\u8868</li> <li>OP_REP_DEVLIST \u8fd4\u56de\u8bbe\u5907\u5217\u8868</li> <li>OP_REQ_IMPORT \u8bf7\u6c42 USB \u8bbe\u5907</li> <li>OP_REP_IMPORT \u8fd4\u56de USB \u8bbe\u5907</li> <li>USBIP_CMD_SUBMIT \u53d1\u9001 URB</li> <li>USBIP_RET_SUBMIT \u8fd4\u56de URB</li> </ol> <p>\uff08\u5148\u4e0d\u8003\u8651 CMD_UNLINK \u548c RET_UNLINK\uff09</p> <p>\u5176\u4e2d\u524d\u9762\u56db\u4e2a\u6bd4\u8f83\u7b80\u5355\u6e05\u6670\uff0c\u6240\u9700\u8981\u7684\u5b57\u6bb5\u4e5f\u90fd\u662f Descriptor \u4e2d\u5bf9\u5e94\u7684\u5b57\u6bb5\u3002\u540e\u9762\u4e24\u4e2a\u5c31\u76f8\u5bf9\u590d\u6742\u4e00\u4e9b\uff1aURB data \u7684\u957f\u5ea6\u9700\u8981\u6839\u636e endpoint \u7c7b\u578b\u548c direction \u5171\u540c\u51b3\u5b9a\u3002URB \u5b9e\u9645\u4e0a\u662f Linux \u5185\u6838\u91cc\u7684\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u3002</p>","tags":["linux","usbip"]},{"location":"software/2020/05/15/usb-ip-simulation/#usb-\u534f\u8bae","title":"USB \u534f\u8bae","text":"<p>\u90a3\u4e48\uff0cUSB \u534f\u8bae\u7684\u51e0\u79cd transfer \u600e\u4e48\u5bf9\u5e94\u5230 URB \u7684\u6570\u636e\u5462\uff1f\u9996\u5148\u770b\u6700\u5e38\u89c1\u7684\u4e09\u79cd\uff08[ref](https://www.beyondlogic.org/usbnutshell/usb4.shtml\uff09\uff1a</p> <ol> <li>Control Transfer</li> <li>\u7b2c\u4e00\u79cd\u662f Control IN\uff0c\u4e00\u5171\u6709\u4e09\u4e2a\u9636\u6bb5\uff0c\u7b2c\u4e00\u4e2a\u9636\u6bb5\u662f Setup\uff0cHost \u53d1\u9001\u7ed9 Device \u4e00\u4e2a\u516b\u5b57\u8282\u7684 Setup Packet\uff1b\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u662f Data\uff0cDevice \u53d1\u9001\u7ed9 Host \u4e00\u6bb5\u6570\u636e\uff1b\u7b2c\u4e09\u4e2a\u9636\u6bb5\u662f Status\uff0cHost \u53d1\u9001\u7ed9 Device \u4e00\u4e2a Zero Length Packet\u3002\u6b64\u65f6 Setup Packet \u5bf9\u5e94 urb \u4e2d\u7684 setup\uff0cData \u5c31\u5bf9\u5e94 RET_SUBMIT \u91cc\u9762\u7684 URB data \u4e86\uff0c\u81ea\u7136 CMD_SUBMIT \u4e2d\u662f\u6ca1\u6709 URB data \u7684</li> <li>\u7b2c\u4e8c\u79cd\u662f Control OUT\uff0c\u4e00\u5171\u6709\u4e09\u4e2a\u9636\u6bb5\uff0c\u7b2c\u4e00\u4e2a\u9636\u6bb5\u662f Setup\uff0cHost \u53d1\u9001\u7ed9 Device \u4e00\u4e2a\u5427\u5b57\u8282\u7684 Setup Packet\uff1b\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u662f Data\uff0cHost \u7ed9 Device \u53d1\u9001\u4e00\u6bb5\u6570\u636e\uff1b\u7b2c\u4e09\u4e2a\u9636\u6bb5\u662f Status\uff0cDevice \u7ed9 Host \u53d1\u9001\u4e00\u4e2a Zero Length Packet\u3002\u6b64\u65f6 Setup Packet \u5bf9\u5e94 urb \u4e2d\u7684 setup\uff0cData \u5bf9\u5e94 CMD_SUBMIT \u672b\u5c3e\u7684 URB data\uff0c\u957f\u5ea6\u7531 transfer_buffer_length \u6307\u5b9a\u3002\u8fd4\u56de\u7684 RET_SUBMIT \u4e0d\u5e26 URB data\uff0c\u4f46\u4f9d\u7136\u9700\u8981\u6709 RET_SUBMIT\u3002</li> <li>Interrupt/Bulk Transfer</li> <li>\u7b2c\u4e00\u79cd\u662f Interrupt/Bulk IN\uff0c\u7531 Device \u7ed9 Host \u53d1\u9001\u4e00\u6bb5\u6570\u636e\uff0c\u9644\u5728 RET_SUBMIT \u4e2d\u3002</li> <li>\u7b2c\u4e8c\u79cd\u662f Interrupt/Bulk OUT\uff0c\u7531 Host \u7ed9 Device \u53d1\u9001\u4e00\u6bb5\u6570\u636e\uff0c\u4e2d CMD_SUBMIT \u7684 URB data \u4e2d\u3002\u8fd4\u56de\u7684 RET_SUBMIT \u4e0d\u5e26 URB data\uff0c\u4f46\u4e0d\u80fd\u4e0d\u53d1 RET_SUBMIT\u3002</li> </ol> <p>\u53ef\u89c1\uff0cInterrupt \u548c Bulk \u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u800c Control \u548c Isochronous\uff08\u6ca1\u6709\u63d0\u5230\uff09\u5219\u6bd4\u8f83\u590d\u6742\u3002</p>","tags":["linux","usbip"]},{"location":"software/2020/05/15/usb-ip-simulation/#\u56de\u5230-usbip-\u534f\u8bae","title":"\u56de\u5230 USB/IP \u534f\u8bae","text":"<p>\u5176\u5b9e\u8865\u5145\u4e86\u8fd9\u4e9b\u4fe1\u606f\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a USB/IP \u534f\u8bae\u7684\u670d\u52a1\u5668\u4e86\u3002</p>","tags":["linux","usbip"]},{"location":"software/2018/11/20/usb-ip/","title":"USB/IP \u5b9e\u8df5","text":"<p>\u4e4b\u524d\u4e00\u76f4\u60f3\u73a9 USB/IP\uff0c\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u627e\u4fe9 Linux \u8bbe\u5907\u7136\u540e\u5171\u4eab\uff0c\u4eca\u5929\u7ec8\u4e8e\u5c1d\u8bd5\u4e86\u4e00\u4e0b\uff0c\u6ca1\u6709\u4ec0\u4e48\u5927\u95ee\u9898\u3002\u8fd9\u6b21\u91c7\u7528\u7684\u8bbe\u5907\u662f Raspberri Pi 3 \u548c SaltedFish Pi\u3002\u4e00\u5f00\u59cb\u5c1d\u8bd5\u4ece\u540e\u8005\u5411\u524d\u8005\u5171\u4eab\uff0c\u4f46\u603b\u662f\u51fa\u73b0\u8fd9\u4e2a\u9519\u8bef\uff1a</p> <pre><code>libusbip: error: udev_device_get_sysattr_value failed\nusbip: error: open vhci_driver\n</code></pre> <p>\u7136\u540e\u6211\u53cd\u8fc7\u6765\u505a\u5c31\u597d\u4e86\uff0c\u6bd4\u8f83\u795e\u5947\u3002</p> <p>\u4e3b\u8981\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li><code>pacman -S usbip</code> \u5b89\u88c5\u7528\u6237\u6001\u8f6f\u4ef6</li> <li><code>systemctl enable --now usbipd</code> \u542f\u52a8 USB/IP \u7684\u7aef\u53e3\u76d1\u542c daemon</li> <li><code>usbip list -l</code> \u67e5\u770b\u672c\u5730\u6709\u54ea\u4e9b USB \u8bbe\u5907\u53ef\u4ee5\u5171\u4eab</li> <li><code>usbip bind -b [BUS_ID]</code> \u628a\u6307\u5b9a\u7684 USB \u8bbe\u5907\u5171\u4eab\u51fa\u53bb\uff0c\u5176\u4e2d BUS_ID \u4ece\u4e0a\u4e2a\u547d\u4ee4\u4e2d\u67e5\u770b</li> <li><code>usbip list -r [IP]</code> \u5728\u53e6\u4e00\u4e2a\u8bbe\u5907\u4e0a\u67e5\u770b\u8fd9\u4e2a\u8bbe\u5907\u5171\u4eab\u7684 USB \u8bbe\u5907\uff0c\u53ef\u4ee5\u770b\u5230\u8bb8\u591a\u4fe1\u606f</li> <li><code>usbip attach -r [IP] -b [BUS_ID]</code> \u628a\u5bf9\u65b9\u5171\u4eab\u7684 USB \u8bbe\u5907 attach \u5230\u672c\u5730</li> </ul> <p>\u6548\u679c\uff1a\u628a\u4e00\u4e2a U \u76d8\u6210\u529f\u6620\u5c04\u5230\u4e86\u672c\u5730\uff1a</p> <pre><code>$ lsusb -t\n/:  Bus 04.Port 1: Dev 1, Class=root_hub, Driver=vhci_hcd/8p, 480M\n    |__ Port 1: Dev 2, If 0, Class=Mass Storage, Driver=usb-storage, 480M\n$ lsblk\nNAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda           8:0    1 14.9G  0 disk\n`-sda1        8:1    1 14.9G  0 part /tmp/mnt\n</code></pre> <p>\u5c1d\u8bd5 mount \u4ec0\u4e48\u7684\uff0c\u4e5f\u90fd\u6ca1\u6709\u95ee\u9898\u3002\u4ee5\u540e\u53ef\u4ee5\u8003\u8651\u628a\u672c\u5730\u7684 LicheeTang \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u7a7f\u900f\u5230\u8fdc\u7aef\uff0c\u7136\u540e\u5728\u8fdc\u7aef\u7528\u5b83\u7684 IDE \u8fdb\u884c\u7f16\u7a0b\u3002</p> <p>UPDATE: LicheeTang \u70e7\u5199\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u76f4\u63a5 JTAG \u5199\u4e0a\u53bb\u6ca1\u6709\u4f5c\u7528\uff0c\u4f46\u662f SPI Flash \u662f\u53ef\u4ee5\u6210\u529f\u5199\u5165\u5e76\u4e14\u6709\u4f5c\u7528\u7684\uff0c\u867d\u7136\u9700\u8981\u5f3a\u5236\u6253\u65ad\u3002\u611f\u89c9\u8fd8\u662f\u7f51\u7edc\u5ef6\u8fdf\u5bfc\u81f4\u4e86\u4e00\u4e9b\u95ee\u9898\u3002</p>","tags":["linux","usbip","raspi","sfpi"]},{"location":"software/2019/09/28/use-nginx-as-rtmp-server/","title":"\u7528 Nginx \u4f5c\u4e3a RTMP \u670d\u52a1\u5668\u5e76\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1","text":"<p>Nginx \u9664\u4e86\u53ef\u4ee5\u505a HTTP \u670d\u52a1\u5668\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u505a RTMP \u670d\u52a1\u5668\uff0c\u540c\u65f6\u8f6c\u6210 HLS \u518d\u63d0\u4f9b\u7ed9\u7528\u6237\uff0c\u8fd9\u6837\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u76f4\u64ad\u7684\u670d\u52a1\u5668\uff0c\u7528 OBS \u63a8\u4e0a\u6765\u5373\u53ef\u3002</p> <p>\u9996\u5148\u8981\u5b89\u88c5 nginx-rtmp-server \u6a21\u5757\uff0c\u5f88\u591a\u7684\u53d1\u884c\u7248\u90fd\u5df2\u7ecf\u5305\u542b\u4e86\uff0c\u5b83\u7684\u4e3b\u9875\u662f https://github.com/arut/nginx-rtmp-module\uff0c\u4e0b\u9762\u5f88\u591a\u5185\u5bb9\u4e5f\u662f\u6765\u81ea\u4e8e\u5b83\u7684\u6559\u7a0b\u4e2d\u3002</p> <p>\u63a5\u7740\uff0c\u914d\u7f6e Nginx\uff0c\u5728 nginx.conf \u7684\u9876\u5c42\u4e2d\u6dfb\u52a0\u5982\u4e0b\u7684\u914d\u7f6e\uff1a</p> <pre><code>rtmp {\n    server {\n            listen 1935;\n            chunk_size 4096;\n\n            application live {\n                    live on;\n                    record off;\n\n                    hls on;\n                    hls_path /path/to/save/hls;\n                    hls_fragment 1s;\n                    hls_playlist_length 10s;\n            }\n\n    }\n}\n</code></pre> <p>\u8fd9\u91cc\u8868\u793a Nginx \u8981\u5728 1935 \u76d1\u542c\u4e00\u4e2a RTMP \u670d\u52a1\u5668\uff0c\u7136\u540e\u628a live \u4e0b\u7684\u89c6\u9891\u5207\u6210\u7247\u7136\u540e\u5b58\u5728\u76ee\u5f55\u4e0b\uff0c\u63d0\u4f9b\u4e00\u4e2a m3u8 \u6587\u4ef6\u4ee5\u4f9b\u64ad\u653e\u5668\u4f7f\u7528\u3002\u8fd9\u91cc\u7684\u53c2\u6570\u90fd\u53ef\u4ee5\u6309\u7167\u5b9e\u9645\u9700\u6c42\u8fdb\u884c\u8c03\u6574\u3002\u8fd9\u65f6\u5019\u5e94\u8be5\u53ef\u4ee5\u770b\u5230 nginx \u6b63\u786e\u76d1\u542c 1935 \u7aef\u53e3\uff0c\u8fd9\u662f rtmp \u7684\u9ed8\u8ba4\u7aef\u53e3\u3002</p> <p>\u63a5\u7740\uff0c\u9700\u8981\u5728\u4e00\u4e2a HTTP server \u8def\u5f84\u4e0b\u628a HLS serve \u51fa\u53bb\uff1a</p> <pre><code>        location /hls {\n            # Serve HLS fragments\n            types {\n                application/vnd.apple.mpegurl m3u8;\n                video/mp2t ts;\n            }\n            root /path/to/save/hls;\n            add_header Cache-Control no-cache;\n        }\n</code></pre> <p>\u8fd9\u65f6\u5019\uff0c\u5982\u679c\u4f60\u7528 rtmp \u63a8\u4e00\u4e2a\u6d41\uff08\u6bd4\u5982\u7528 OBS\uff09\u5230 rtmp://SERVER_IP/live/SOMETHING\uff0c\u90a3\u4e48\u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u4f1a\u770b\u5230 SOMETHING \u5f00\u5934\u7684\u4e00\u7cfb\u5217\u6587\u4ef6\uff1b\u7528\u64ad\u653e\u5668\u6253\u5f00 http://SERVER_IP/hls/SOMETHING.m3u8 \u5c31\u53ef\u4ee5\u770b\u5230\u76f4\u64ad\u7684\u89c6\u9891\u6d41\u4e86\u3002</p> <p>\u5982\u679c\u8981\u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u91cc\u64ad\u653e HLS\uff0c\u9700\u8981\u7528 Flowplayer\uff0c\u76f4\u63a5\u53c2\u8003\u5b98\u65b9\u7684\u4f8b\u5b50\u5373\u53ef\uff1a</p> <pre><code>&lt;script&gt;\nvar player = flowplayer(\"#player\", {\n        clip: {\n                sources: [\n                {\n                        type: \"application/x-mpegurl\",\n                        src: \"https://SERVER_IP/hls/SOMETHING.m3u8\"\n                }]\n        },\n        autoplay: true,\n        loop: true,\n        live: true\n});\n&lt;/script&gt;\n</code></pre> <p>\u4e0a\u9762\u7684\u5404\u4e2a\u8def\u5f84\u53ef\u4ee5\u6309\u7167\u5b9e\u9645\u9700\u6c42\u6539\u52a8\u3002</p>","tags":["nginx","rtmp","hls","obs"]},{"location":"software/2023/07/24/vfio/","title":"VFIO - Virtual Function I/O","text":"","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>VFIO \u662f Linux \u5185\u6838\u4e2d\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u76ee\u7684\u662f\u628a PCIe \u8bbe\u5907\u66b4\u9732\u7ed9\u7528\u6237\u6001\u7684\u7a0b\u5e8f\uff0c\u8fdb\u800c\u53ef\u4ee5\u66b4\u9732\u7ed9\u865a\u62df\u673a\u5185\u7684\u7cfb\u7edf\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684\u865a\u62df\u673a PCIe \u76f4\u901a\u3002\u4e3a\u4e86\u4fdd\u8bc1\u5b89\u5168\u6027\uff0cVFIO \u8fd8\u4f1a\u914d\u7f6e\u597d IOMMU\uff0c\u4fdd\u8bc1\u7528\u6237\u6001\u7a0b\u5e8f\u65e0\u6cd5\u5229\u7528\u8bbe\u5907\u7684 DMA \u8bbf\u95ee\u5230\u5176\u4ed6\u5730\u5740\u7a7a\u95f4\u7684\u6570\u636e\u3002</p> <p>\u672c\u6587\u63a2\u8ba8 VFIO \u66b4\u9732\u7684\u7528\u6237\u6001 API \u4ee5\u53ca\u5982\u4f55\u5728\u7528\u6237\u6001\u4e2d\u4f7f\u7528 VFIO \u76f4\u63a5\u63a7\u5236 PCIe \u8bbe\u5907\u3002</p> <p>\u63a8\u8350\u9605\u8bfb VFIO \u5b98\u65b9\u6587\u6863\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u4e5f\u53c2\u8003\u4e86\u8fd9\u4e2a\u6587\u6863\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#\u9700\u6c42","title":"\u9700\u6c42","text":"<p>\u5728\u63a2\u8ba8 VFIO \u63d0\u4f9b\u54ea\u4e9b\u63a5\u53e3\u4e4b\u524d\uff0c\u9996\u5148\u8981\u8003\u8651\u5230\u5728\u7528\u6237\u6001\u64cd\u4f5c PCIe \u8bbe\u5907\u7684\u9700\u6c42\uff1a\u4f8b\u5982\u5728\u7528\u6237\u6001\u8981\u64cd\u4f5c\u4e00\u4e2a\u7f51\u5361\uff0c\u90a3\u80af\u5b9a\u9700\u8981\u76f8\u5e94\u7684\u7f51\u5361\u9a71\u52a8\uff0c\u90a3\u4e48\u7f51\u5361\u9a71\u52a8\u9700\u8981\u505a\u7684\u4e8b\u60c5\u6709\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u786c\u4ef6\uff0c\u4e3a\u4e86\u8bfb\u5199\u5bc4\u5b58\u5668\uff0c\u9700\u8981\u80fd\u591f\u8bbf\u95ee PCIe \u8bbe\u5907\u7684 BAR \u7a7a\u95f4\uff0cBAR \u7a7a\u95f4\u7684\u7269\u7406\u5730\u5740\u63d0\u524d\u5df2\u7ecf\u5206\u914d\u597d\u4e86\uff0c\u5728\u5185\u6838\u4e2d\u76f4\u63a5\u628a\u7269\u7406\u5730\u5740\u8f6c\u6362\u4e3a\u5185\u6838\u6001\u7684\u865a\u62df\u5730\u5740\u5c31\u53ef\u4ee5\u8bbf\u95ee\u4e86\uff1b\u4e3a\u4e86\u914d\u7f6e\u4e2d\u65ad\u7b49 PCIe \u7684\u529f\u80fd\uff0c\u9700\u8981\u80fd\u591f\u8bbf\u95ee PCIe \u8bbe\u5907\u7684 Configuration \u7a7a\u95f4\uff0c\u5728\u5185\u6838\u4e2d\u6309 PCIe ECAM \u65b9\u6cd5\u8ba1\u7b97\u51fa\u7269\u7406\u5730\u5740\uff0c\u7136\u540e\u8f6c\u6362\u4e3a\u865a\u62df\u5730\u5740\u4e5f\u5c31\u53ef\u4ee5\u8bbf\u95ee\u4e86</li> <li>\u53d1\u9001\u6570\u636e\uff0c\u9700\u8981\u5728\u5185\u5b58\u91cc\u51c6\u5907\u597d\u6570\u636e\uff0c\u8ba9\u7f51\u5361\u8fdb\u884c DMA\uff0c\u610f\u5473\u7740\u9700\u8981\u77e5\u9053\u5728\u5185\u5b58\u4e2d\u5206\u914d\u7684\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff1b\u540c\u7406\uff0c\u63a5\u6536\u6570\u636e\u7684\u65f6\u5019\uff0c\u8981\u5728\u5185\u5b58\u91cc\u5206\u914d\u597d\u7f13\u51b2\u533a\uff0c\u628a\u7269\u7406\u5730\u5740\u4ea4\u7ed9\u7f51\u5361\uff0c\u8ba9\u7f51\u5361 DMA</li> <li>\u8bbe\u7f6e\u4e2d\u65ad\uff0c\u4f8b\u5982\u914d\u7f6e PCIe \u7684 MSI/MSI-X \u529f\u80fd\uff0c\u7136\u540e\u5728\u5185\u6838\u7684\u4e2d\u65ad\u5904\u7406\u4ee3\u7801\u91cc\u6ce8\u518c\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570\uff1b\u5f53 PCIe \u8bbe\u5907\u901a\u8fc7 MSI/MSI-X \u53d1\u9001\u4e2d\u65ad\u7ed9\u4e2d\u65ad\u63a7\u5236\u5668\u7684\u65f6\u5019\uff0c\u5185\u6838\u6700\u7ec8\u8981\u80fd\u628a\u8fd9\u4e2a\u4e2d\u65ad\u8def\u7531\u7ed9\u7f51\u5361\u9a71\u52a8</li> </ol> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c\u5305\u62ec\u5982\u4e0b\u7684\u9700\u6c42\uff1a</p> <ol> <li>\u8bbf\u95ee Configuration \u7a7a\u95f4\u548c BAR \u7a7a\u95f4</li> <li>\u5bf9\u4e8e\u9700\u8981 DMA \u7684\u5185\u5b58\u533a\u57df\uff0c\u53ef\u4ee5\u5f97\u5230\u5b83\u7684\u7269\u7406\u5730\u5740\uff08\u6709\u4e86 IOMMU \u4ee5\u540e\u662f\u8bbe\u5907\u865a\u62df\u5730\u5740 IOVA\uff09\uff0c\u8ba9\u786c\u4ef6\u53bb\u8bfb\u5199\u5185\u5b58</li> <li>\u53ef\u4ee5\u6ce8\u518c\u4e2d\u65ad\uff0c\u5f53\u8bbe\u5907\u53d1\u9001\u4e2d\u65ad\u7684\u65f6\u5019\uff0c\u9a71\u52a8\u7684\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4f1a\u88ab\u8c03\u7528</li> </ol> <p>\u56e0\u6b64 VFIO \u4e5f\u5e94\u8be5\u63d0\u4f9b\u4ee5\u4e0a\u7684\u8fd9\u4e9b\u529f\u80fd\u3002\u989d\u5916\u5730\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b89\u5168\u6027\uff0c\u5728\u7b2c\u4e8c\u6b65\u7684\u65f6\u5019\uff0c\u9700\u8981\u548c IOMMU \u6253\u914d\u5408\uff0c\u4fdd\u8bc1 PCIe \u8bbe\u5907\u53ea\u80fd\u770b\u5230\u7528\u6237\u7a0b\u5e8f\u5411 VFIO \u4e0a\u6ce8\u518c\u7684\u5185\u5b58\u533a\u57df\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#iommu","title":"IOMMU","text":"<p>IOMMU \u662f\u9700\u8981\u786c\u4ef6\u652f\u6301\u7684\uff0c\u56e0\u6b64 VFIO \u7684\u5b9e\u73b0\u4f1a\u53d7\u5236\u4e8e\u786c\u4ef6\u7684 IOMMU \u5b9e\u73b0\u3002IOMMU \u5728\u786c\u4ef6\u4e0a\u7684\u5b9e\u73b0\u65b9\u5f0f\u7c7b\u4f3c CPU \u4e0a\u7684 MMU\uff0c\u53ea\u4e0d\u8fc7\u5bf9\u8c61\u662f PCIe \u8bbe\u5907\uff0c\u5f53 PCIe \u8bbe\u5907\u5728\u53d1\u8d77\u5185\u5b58\u8bfb\u5199\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u9700\u8981\u7ecf\u8fc7 IOMMU\uff0cIOMMU \u6309\u7167\u9884\u5148\u914d\u7f6e\u597d\u7684\u8bbe\u5b9a\u8fdb\u884c\u5730\u5740\u8f6c\u6362\uff0c\u5982\u679c\u8f6c\u6362\u4e0d\u6210\u529f\uff0c\u90a3\u5c31\u62d2\u7edd\u8bf7\u6c42\uff0c\u4fdd\u8bc1\u4e86\u5b89\u5168\u6027\u3002</p> <p>\u4f46\u662f\u6709\u4e9b\u60c5\u51b5\u4e0b IOMMU \u4e0d\u80fd\u4fdd\u8bc1\u7ed9\u6bcf\u4e2a\u8bbe\u5907\u90fd\u5355\u72ec\u4e00\u4e2a\u5730\u5740\u8f6c\u6362\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u628a\u6bcf\u4e2a\u8bbe\u5907\u7684\u5730\u5740\u7a7a\u95f4\u90fd\u9694\u79bb\u5f00\uff0c\u53ef\u80fd\u6709\u82e5\u5e72\u4e2a\u8bbe\u5907\u9700\u8981\u5171\u4eab\u540c\u4e00\u4e2a\u5730\u5740\u7a7a\u95f4\u6620\u5c04\u3002\u6b64\u65f6\u8fd9\u4e9b\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u7684\u8bbe\u5907\u5c31\u7ec4\u6210\u4e00\u4e2a IOMMU Group\uff0cGroup \u5185\u7684\u8bbe\u5907\u4e0d\u9694\u79bb\uff0cGroup \u4e4b\u95f4\u9694\u79bb\u3002</p> <p>\u4e8e\u662f\u540c\u4e00\u4e2a IOMMU Group \u5185\u7684\u8bbe\u5907\u4e0d\u80fd\u8ba9\u7528\u6237\u6001\u7a0b\u5e8f\u548c\u5185\u6838\u6001\u9a71\u52a8\uff08\u975e VFIO\uff09\u6df7\u7528\uff1a\u540c\u4e00\u4e2a Group \u5185\u4e0d\u4fdd\u8bc1\u9694\u79bb\uff0c\u5982\u679c\u6df7\u7528\u4e86\uff0c\u7528\u6237\u6001\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u901a\u8fc7 PCIe \u8bbe\u5907\u8bbf\u95ee\u5185\u6838\u6001\u9a71\u52a8\u7684\u6570\u636e\u4e86\u3002</p> <p>IOMMU Group \u53ea\u662f\u5730\u5740\u9694\u79bb\u7684\u6700\u5c0f\u7c92\u5ea6\u3002\u6709\u4e9b\u65f6\u5019\uff0c\u7a0b\u5e8f\u5e0c\u671b\u540c\u65f6\u63a7\u5236\u591a\u4e2a PCIe \u8bbe\u5907\uff0c\u5b83\u4eec\u5206\u5904\u4e0d\u540c\u7684 IOMMU Group\uff0c\u5982\u679c\u8981\u9010\u4e2a IOMMU Group \u914d\u7f6e\u8fc7\u53bb\uff0c\u672a\u514d\u6709\u70b9\u9ebb\u70e6\u3002\u6b64\u65f6 VFIO \u4e5f\u63d0\u4f9b\u4e86\u66f4\u9ad8\u4e00\u7ea7\u7684\u62bd\u8c61\uff1aContainer\u3002Container \u5305\u62ec\u591a\u4e2a Group\uff0c\u8fd9\u4e9b Group \u5171\u4eab\u540c\u6837\u7684\u5730\u5740\u7a7a\u95f4\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u786c\u4ef6\u4e0a\u652f\u6301\u9694\u79bb\uff0c\u4f46\u53cd\u6b63\u662f\u540c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u90a3\u5c31\u4eba\u4e3a\u5730\u8ba9\u5b83\u4e0d\u9694\u79bb\u3002</p> <p>\u603b\u800c\u8a00\u4e4b\uff0cVFIO \u8003\u8651\u5230 IOMMU \u7684\u7269\u7406\u9650\u5236\uff0c\u8bbe\u8ba1\u4e86\u4e09\u4e2a\u5c42\u7ea7\uff1a</p> <ul> <li>Device\uff1a\u5b9e\u9645\u7684 PCIe \u8bbe\u5907</li> <li>Group\uff1aIOMMU \u9694\u79bb\u5730\u5740\u7a7a\u95f4\u7684\u7c92\u5ea6</li> <li>Container\uff1a\u4e3a\u4e86\u8f6f\u4ef6\u4e0a\u65b9\u4fbf\u540c\u65f6\u64cd\u4f5c\u591a\u4e2a Group</li> </ul>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#\u7528\u6237-api","title":"\u7528\u6237 API","text":"<p>VFIO \u7684\u7528\u6237 API \u5728 include/uapi/linux/vfio.h \u4e2d\u5b9a\u4e49\uff0c\u5f62\u5f0f\u662f\u82e5\u5e72\u4e2a ioctl \u8c03\u7528\uff0c\u5927\u81f4\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u628a vfio-pci \u8bbe\u5907\u7ed1\u5b9a\u5728 PCIe \u8bbe\u5907\u4e0a</li> <li>\u6839\u636e PCIe \u8bbe\u5907\uff0c\u627e\u5230\u5b83\u6240\u5c5e\u7684 IOMMU Group ID\uff0c\u4f8b\u5982\u662f 26</li> <li>\u521b\u5efa\u4e00\u4e2a Container\uff1a<code>container = open(\"/dev/vfio/vfio\")</code></li> <li>\u6253\u5f00 IOMMU Group\uff1a<code>group = open(\"/dev/vfio/2\")</code></li> <li>\u628a Group \u653e\u5230 Container \u4e2d\uff1a<code>ioctl(group, VFIO_GROUP_SET_CONTAINER, &amp;container)</code></li> <li>\u6253\u5f00 Group \u4e2d\u7684 Device\uff1a<code>device = ioctl(group, VFIO_GROUP_GET_DEVICE_FD, \"0000:06:0d.0\")</code></li> </ol> <p>\u4e0a\u9762\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u5ffd\u7565\u4e86\u4e00\u90e8\u5206\u8c03\u7528\uff0c\u8be6\u60c5\u8bf7\u9605\u8bfb VFIO \u6587\u6863\u3002</p> <p>\u6709\u4e86 Container\uff0cGroup \u548c Device \u7684 FD \u4ee5\u540e\uff0c\u53ef\u4ee5\u505a\u4ee5\u4e0b\u7684\u4e8b\u60c5\uff1a</p> <ol> <li>\u5bf9 Container \u8bbe\u7f6e DMA \u6620\u5c04\uff1a<code>ioctl(container, VFIO_IOMMU_MAP_DMA, &amp;dma_Map)</code></li> <li>\u628a Device \u7684 BAR \u7a7a\u95f4\u6620\u5c04\u5230\u7528\u6237\u6001\uff1a<code>ioctl(device, VFIO_DEVICE_GET_REGION_INFO, &amp;reg)</code> \u4e4b\u540e <code>mmap</code></li> <li>\u8bfb\u5199 Device \u7684 Configuration \u7a7a\u95f4\uff1a<code>ioctl(device, VFIO_DEVICE_GET_REGION_INFO, &amp;reg)</code> \u5f97\u5230 Configuration \u7a7a\u95f4\u7684\u504f\u79fb\uff0c\u628a Device FD \u5f53\u6210\u6587\u4ef6\uff0c\u7528 <code>pread/pwrite</code> \u5728\u6307\u5b9a\u504f\u79fb\u4e0a\u8fdb\u884c\u8bfb\u5199</li> <li>\u8bbe\u7f6e\u4e2d\u65ad\uff1a<code>ioctl(device, VFIO_DEVICE_SET_IRQS, irq_set)</code>\uff0c\u53c2\u6570\u4e2d\u5305\u62ec\u4e86\u4e00\u4e2a eventfd\uff0c\u5f53\u5185\u6838\u6536\u5230\u6765\u81ea\u8bbe\u5907\u7684\u4e2d\u65ad\u65f6\uff0c\u66f4\u65b0 eventfd\uff0c\u7528\u6237\u6001\u53ef\u4ee5\u901a\u8fc7 epoll \u76d1\u6d4b eventfd \u7684\u66f4\u65b0</li> </ol> <p>\u56de\u987e\u4e00\u4e0b\u6587\u7ae0\u5f00\u5934\u8bb2\u5230\u7684\u9a71\u52a8\u5bf9 VFIO \u7684\u9700\u6c42\uff1a</p> <ol> <li>\u8bbf\u95ee Configuration \u7a7a\u95f4\uff1a\u901a\u8fc7 <code>pread/pwrite</code> \u8bfb\u5199</li> <li>\u8bbf\u95ee BAR \u7a7a\u95f4\uff1a<code>mmap</code> \u5230\u7528\u6237\u6001\u7684\u865a\u62df\u5730\u5740\uff0c\u7136\u540e\u76f4\u63a5 MMIO</li> <li>DMA\uff1a\u914d\u7f6e\u7528\u6237\u6001\u865a\u62df\u5730\u5740\u548c\u8bbe\u5907\u865a\u62df\u5730\u5740\uff08IOVA\uff09\u7684\u6620\u5c04\uff0c\u7136\u540e\u628a IOVA \u4f20\u7ed9\u8bbe\u5907\uff0c\u8bbe\u5907\u5728 DMA \u7684\u65f6\u5019\uff0cIOMMU \u8d1f\u8d23\u628a IOVA \u8f6c\u6362\u4e3a\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740</li> <li>\u4e2d\u65ad\uff1a\u914d\u7f6e MSI/MSI-X\uff0c\u8bbe\u5907\u53d1\u9001\u4e2d\u65ad\u65f6\uff0c\u5185\u6838\u901a\u8fc7 eventfd \u901a\u77e5\u7528\u6237\u6001\u7a0b\u5e8f</li> </ol> <p>\u53ef\u89c1\u8fd9\u4e9b\u9700\u6c42\u90fd\u5df2\u7ecf\u6ee1\u8db3\uff0c\u53ef\u4ee5\u5728\u7528\u6237\u6001\u5b9e\u73b0\u8bbe\u5907\u9a71\u52a8\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#qemu","title":"QEMU","text":"","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#\u521d\u59cb\u5316","title":"\u521d\u59cb\u5316","text":"<p>\u63a5\u4e0b\u6765\u5206\u6790 QEMU \u662f\u5982\u4f55\u901a\u8fc7 VFIO \u5b9e\u73b0 PCIe \u8bbe\u5907\u76f4\u901a\u7684\u3002\u5728\u547d\u4ee4\u884c\u4e2d\uff0c\u53ef\u4ee5\u7528 <code>-device vfio-pci</code> \u6765\u6dfb\u52a0\u76f4\u901a\u8bbe\u5907\uff0c\u6bcf\u4e2a\u8bbe\u5907\u5bf9\u5e94\u4e00\u4e2a <code>VFIOPCIDevice</code> \u7ed3\u6784\u4f53\uff1a</p> <pre><code>#define TYPE_VFIO_PCI \"vfio-pci\"\nOBJECT_DECLARE_SIMPLE_TYPE(VFIOPCIDevice, VFIO_PCI)\n\nstruct VFIOPCIDevice {\n    PCIDevice pdev;\n    VFIODevice vbasedev;\n    VFIOINTx intx;\n    unsigned int config_size;\n    uint8_t *emulated_config_bits; /* QEMU emulated bits, little-endian */\n    off_t config_offset; /* Offset of config space region within device fd */\n    unsigned int rom_size;\n    off_t rom_offset; /* Offset of ROM region within device fd */\n    void *rom;\n    int msi_cap_size;\n    VFIOMSIVector *msi_vectors;\n    VFIOMSIXInfo *msix;\n    int nr_vectors; /* Number of MSI/MSIX vectors currently in use */\n    int interrupt; /* Current interrupt type */\n    VFIOBAR bars[PCI_NUM_REGIONS - 1]; /* No ROM */\n    VFIOVGA *vga; /* 0xa0000, 0x3b0, 0x3c0 */\n    void *igd_opregion;\n    PCIHostDeviceAddress host;\n    QemuUUID vf_token;\n    EventNotifier err_notifier;\n    EventNotifier req_notifier;\n    int (*resetfn)(struct VFIOPCIDevice *);\n    uint32_t vendor_id;\n    uint32_t device_id;\n    uint32_t sub_vendor_id;\n    uint32_t sub_device_id;\n    uint32_t features;\n#define VFIO_FEATURE_ENABLE_VGA_BIT 0\n#define VFIO_FEATURE_ENABLE_VGA (1 &lt;&lt; VFIO_FEATURE_ENABLE_VGA_BIT)\n#define VFIO_FEATURE_ENABLE_REQ_BIT 1\n#define VFIO_FEATURE_ENABLE_REQ (1 &lt;&lt; VFIO_FEATURE_ENABLE_REQ_BIT)\n#define VFIO_FEATURE_ENABLE_IGD_OPREGION_BIT 2\n#define VFIO_FEATURE_ENABLE_IGD_OPREGION \\\n                                (1 &lt;&lt; VFIO_FEATURE_ENABLE_IGD_OPREGION_BIT)\n    OnOffAuto display;\n    uint32_t display_xres;\n    uint32_t display_yres;\n    int32_t bootindex;\n    uint32_t igd_gms;\n    OffAutoPCIBAR msix_relo;\n    uint8_t pm_cap;\n    uint8_t nv_gpudirect_clique;\n    bool pci_aer;\n    bool req_enabled;\n    bool has_flr;\n    bool has_pm_reset;\n    bool rom_read_failed;\n    bool no_kvm_intx;\n    bool no_kvm_msi;\n    bool no_kvm_msix;\n    bool no_geforce_quirks;\n    bool no_kvm_ioeventfd;\n    bool no_vfio_ioeventfd;\n    bool enable_ramfb;\n    bool defer_kvm_irq_routing;\n    bool clear_parent_atomics_on_exit;\n    VFIODisplay *dpy;\n    Notifier irqchip_change_notifier;\n};\n\nstatic Property vfio_pci_dev_properties[] = {\n    DEFINE_PROP_PCI_HOST_DEVADDR(\"host\", VFIOPCIDevice, host),\n    DEFINE_PROP_UUID_NODEFAULT(\"vf-token\", VFIOPCIDevice, vf_token),\n    DEFINE_PROP_STRING(\"sysfsdev\", VFIOPCIDevice, vbasedev.sysfsdev),\n    DEFINE_PROP_ON_OFF_AUTO(\"x-pre-copy-dirty-page-tracking\", VFIOPCIDevice,\n                            vbasedev.pre_copy_dirty_page_tracking,\n                            ON_OFF_AUTO_ON),\n    DEFINE_PROP_ON_OFF_AUTO(\"display\", VFIOPCIDevice,\n                            display, ON_OFF_AUTO_OFF),\n    DEFINE_PROP_UINT32(\"xres\", VFIOPCIDevice, display_xres, 0),\n    DEFINE_PROP_UINT32(\"yres\", VFIOPCIDevice, display_yres, 0),\n    DEFINE_PROP_UINT32(\"x-intx-mmap-timeout-ms\", VFIOPCIDevice,\n                       intx.mmap_timeout, 1100),\n    DEFINE_PROP_BIT(\"x-vga\", VFIOPCIDevice, features,\n                    VFIO_FEATURE_ENABLE_VGA_BIT, false),\n    DEFINE_PROP_BIT(\"x-req\", VFIOPCIDevice, features,\n                    VFIO_FEATURE_ENABLE_REQ_BIT, true),\n    DEFINE_PROP_BIT(\"x-igd-opregion\", VFIOPCIDevice, features,\n                    VFIO_FEATURE_ENABLE_IGD_OPREGION_BIT, false),\n    DEFINE_PROP_ON_OFF_AUTO(\"enable-migration\", VFIOPCIDevice,\n                            vbasedev.enable_migration, ON_OFF_AUTO_AUTO),\n    DEFINE_PROP_BOOL(\"x-no-mmap\", VFIOPCIDevice, vbasedev.no_mmap, false),\n    DEFINE_PROP_BOOL(\"x-balloon-allowed\", VFIOPCIDevice,\n                     vbasedev.ram_block_discard_allowed, false),\n    DEFINE_PROP_BOOL(\"x-no-kvm-intx\", VFIOPCIDevice, no_kvm_intx, false),\n    DEFINE_PROP_BOOL(\"x-no-kvm-msi\", VFIOPCIDevice, no_kvm_msi, false),\n    DEFINE_PROP_BOOL(\"x-no-kvm-msix\", VFIOPCIDevice, no_kvm_msix, false),\n    DEFINE_PROP_BOOL(\"x-no-geforce-quirks\", VFIOPCIDevice,\n                     no_geforce_quirks, false),\n    DEFINE_PROP_BOOL(\"x-no-kvm-ioeventfd\", VFIOPCIDevice, no_kvm_ioeventfd,\n                     false),\n    DEFINE_PROP_BOOL(\"x-no-vfio-ioeventfd\", VFIOPCIDevice, no_vfio_ioeventfd,\n                     false),\n    DEFINE_PROP_UINT32(\"x-pci-vendor-id\", VFIOPCIDevice, vendor_id, PCI_ANY_ID),\n    DEFINE_PROP_UINT32(\"x-pci-device-id\", VFIOPCIDevice, device_id, PCI_ANY_ID),\n    DEFINE_PROP_UINT32(\"x-pci-sub-vendor-id\", VFIOPCIDevice,\n                       sub_vendor_id, PCI_ANY_ID),\n    DEFINE_PROP_UINT32(\"x-pci-sub-device-id\", VFIOPCIDevice,\n                       sub_device_id, PCI_ANY_ID),\n    DEFINE_PROP_UINT32(\"x-igd-gms\", VFIOPCIDevice, igd_gms, 0),\n    DEFINE_PROP_UNSIGNED_NODEFAULT(\"x-nv-gpudirect-clique\", VFIOPCIDevice,\n                                   nv_gpudirect_clique,\n                                   qdev_prop_nv_gpudirect_clique, uint8_t),\n    DEFINE_PROP_OFF_AUTO_PCIBAR(\"x-msix-relocation\", VFIOPCIDevice, msix_relo,\n                                OFF_AUTOPCIBAR_OFF),\n    /*\n     * TODO - support passed fds... is this necessary?\n     * DEFINE_PROP_STRING(\"vfiofd\", VFIOPCIDevice, vfiofd_name),\n     * DEFINE_PROP_STRING(\"vfiogroupfd, VFIOPCIDevice, vfiogroupfd_name),\n     */\n    DEFINE_PROP_END_OF_LIST(),\n};\n</code></pre> <p>QEMU \u89e3\u6790\u547d\u4ee4\u884c\u4ee5\u540e\uff0c\u5c31\u4f1a\u628a\u547d\u4ee4\u884c\u91cc\u4f20\u7ed9 <code>-device vfio-pci</code> \u7684\u989d\u5916\u53c2\u6570\u586b\u5165\u5230\u7ed3\u6784\u4f53\u5bf9\u5e94\u5b57\u6bb5\u5f53\u4e2d\u3002\u53e6\u4e00\u65b9\u9762\uff0cQEMU \u4e5f\u4f1a\u628a VFIOPCIDevice \u4f5c\u4e3a PCIe \u8bbe\u5907\u6302\u8f7d\u5230 QEMU \u7684\u865a\u62df PCIe \u603b\u7ebf\u4e0a\u3002\u5728\u521d\u59cb\u5316 PCIe \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8c03\u7528 <code>vfio_realize</code> \u51fd\u6570\uff0c\u4e0b\u9762\u5217\u51fa\u4e86 <code>vfio_realize</code> \u7684\u5b9e\u73b0\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u90e8\u5206\uff1a</p> <pre><code>static void vfio_realize(PCIDevice *pdev, Error **errp)\n{\n    // locate device in sysfs\n    vbasedev-&gt;sysfsdev =\n        g_strdup_printf(\"/sys/bus/pci/devices/%04x:%02x:%02x.%01x\",\n                        vdev-&gt;host.domain, vdev-&gt;host.bus,\n                        vdev-&gt;host.slot, vdev-&gt;host.function);\n\n    // locate iommu group via sysfs\n    tmp = g_strdup_printf(\"%s/iommu_group\", vbasedev-&gt;sysfsdev);\n    len = readlink(tmp, group_path, sizeof(group_path));\n\n    // open /dev/vfio/$group_id and bind to container\n    group = vfio_get_group(groupid, pci_device_iommu_address_space(pdev), errp);\n\n    // get device fd\n    ret = vfio_get_device(group, name, vbasedev, errp);\n\n    // initialize device\n    vfio_populate_device(vdev, &amp;err);\n\n    // mmap BAR spaces\n    vfio_bars_register(vdev);\n}\n</code></pre>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#bar-\u7a7a\u95f4","title":"BAR \u7a7a\u95f4","text":"<p>\u5728\u6620\u5c04 Memory-Mapped \u7684 BAR \u7a7a\u95f4\u7684\u65f6\u5019\uff0cQEMU \u4f1a\u5728\u865a\u62df\u673a\u5185\u7684\u7269\u7406\u5730\u5740\u7a7a\u95f4\u5185\u5206\u914d\u76f8\u5e94\u7684\u7a7a\u95f4\uff0c\u5e76\u4e14\u8bbe\u7f6e\u8bfb\u5199\u56de\u8c03\u51fd\u6570\uff1a</p> <pre><code>static void vfio_populate_device(VFIOPCIDevice *vdev, Error **errp)\n{\n    for (i = VFIO_PCI_BAR0_REGION_INDEX; i &lt; VFIO_PCI_ROM_REGION_INDEX; i++) {\n        char *name = g_strdup_printf(\"%s BAR %d\", vbasedev-&gt;name, i);\n\n        vfio_region_setup(OBJECT(vdev), vbasedev,\n                                &amp;vdev-&gt;bars[i].region, i, name);\n    }\n}\n\nint vfio_region_setup(Object *obj, VFIODevice *vbasedev, VFIORegion *region,\n                      int index, const char *name)\n{\n    memory_region_init_io(region-&gt;mem, obj, &amp;vfio_region_ops,\n                              region, name, region-&gt;size);\n}\n\nconst MemoryRegionOps vfio_region_ops = {\n    .read = vfio_region_read,\n    .write = vfio_region_write,\n    .endianness = DEVICE_LITTLE_ENDIAN,\n    .valid = {\n        .min_access_size = 1,\n        .max_access_size = 8,\n    },\n    .impl = {\n        .min_access_size = 1,\n        .max_access_size = 8,\n    },\n};\n</code></pre> <p>\u90a3\u4e48\u5728\u865a\u62df\u673a\u8bfb\u5199\u8fd9\u6bb5\u5185\u5b58\u7684\u65f6\u5019\uff0c\u56de\u8c03\u51fd\u6570 vfio_region_read/vfio_region_write \u4f1a\u88ab\u8c03\u7528\uff0c\u6b64\u65f6\u518d\u53bb\u901a\u8fc7 Device FD \u6765\u8bbf\u95ee\u5b9e\u9645\u7684 BAR \u7a7a\u95f4\uff1a</p> <pre><code>// error handling code removed\nuint64_t vfio_region_read(void *opaque,\n                          hwaddr addr, unsigned size)\n{\n    VFIORegion *region = opaque;\n    VFIODevice *vbasedev = region-&gt;vbasedev;\n    union {\n        uint8_t byte;\n        uint16_t word;\n        uint32_t dword;\n        uint64_t qword;\n    } buf;\n    uint64_t data = 0;\n\n    pread(vbasedev-&gt;fd, &amp;buf, size, region-&gt;fd_offset + addr);\n\n    switch (size) {\n    case 1:\n        data = buf.byte;\n        break;\n    case 2:\n        data = le16_to_cpu(buf.word);\n        break;\n    case 4:\n        data = le32_to_cpu(buf.dword);\n        break;\n    case 8:\n        data = le64_to_cpu(buf.qword);\n        break;\n    default:\n        hw_error(\"vfio: unsupported read size, %u bytes\", size);\n        break;\n    }\n\n    return data;\n}\n</code></pre> <p>\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u5e76\u4e0d\u9ad8\u6548\uff0c\u56e0\u4e3a\u6bcf\u6b21\u8bbf\u95ee BAR \u7a7a\u95f4\u90fd\u9700\u8981\u8c03\u7528\u4e00\u6b21\u56de\u8c03\u51fd\u6570\u3002\u6240\u4ee5\u4e0b\u9762\u91c7\u7528\u5730\u5740\u6620\u5c04\u7684\u65b9\u5f0f\uff0c\u5148\u4ece Device FD \u7684\u6307\u5b9a\u504f\u79fb\u4e0a\u628a BAR \u7a7a\u95f4\u6620\u5c04\u5230 QEMU \u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u518d\u628a\u5730\u5740\u6ce8\u518c\u5230\u865a\u62df\u673a\u5185\u7684\u7269\u7406\u5730\u5740\u7a7a\u95f4\uff1a</p> <pre><code>// error handling code removed\nint vfio_region_mmap(VFIORegion *region)\n{\n    int i, prot = 0;\n    char *name;\n\n    prot |= region-&gt;flags &amp; VFIO_REGION_INFO_FLAG_READ ? PROT_READ : 0;\n    prot |= region-&gt;flags &amp; VFIO_REGION_INFO_FLAG_WRITE ? PROT_WRITE : 0;\n\n    for (i = 0; i &lt; region-&gt;nr_mmaps; i++) {\n        region-&gt;mmaps[i].mmap = mmap(NULL, region-&gt;mmaps[i].size, prot,\n                                     MAP_SHARED, region-&gt;vbasedev-&gt;fd,\n                                     region-&gt;fd_offset +\n                                     region-&gt;mmaps[i].offset);\n        name = g_strdup_printf(\"%s mmaps[%d]\",\n                               memory_region_name(region-&gt;mem), i);\n        memory_region_init_ram_device_ptr(&amp;region-&gt;mmaps[i].mem,\n                                          memory_region_owner(region-&gt;mem),\n                                          name, region-&gt;mmaps[i].size,\n                                          region-&gt;mmaps[i].mmap);\n        memory_region_add_subregion(region-&gt;mem, region-&gt;mmaps[i].offset,\n                                    &amp;region-&gt;mmaps[i].mem);\n    }\n\n    return 0;\n}\n</code></pre> <p>\u8fd9\u6837\u914d\u7f6e\u4e86\u4ee5\u540e\uff0c\u865a\u62df\u673a\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5230 BAR \u7a7a\u95f4\uff0c\u800c\u4e0d\u7528\u6bcf\u6b21\u8c03\u7528\u90fd trap \u5230 QEMU\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#configuration-space","title":"Configuration Space","text":"<p>\u5f53\u865a\u62df\u673a\u8981\u8bfb\u5199 PCIe Configuration Space \u7684\u65f6\u5019\uff0cQEMU \u4f1a\u9996\u5148\u5224\u65ad\uff0c\u8981\u8bfb\u53d6\u7684\u5b57\u6bb5\u662f\u5426\u88ab\u81ea\u5df1\u6a21\u62df\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u518d\u4ece VFIO \u63d0\u4f9b\u7684 Device FD \u4e2d\u8bfb\u53d6 PCIe \u8bbe\u5907\u7684\u5bf9\u5e94\u5b57\u6bb5\uff1a</p> <pre><code>// error handling code removed\nuint32_t vfio_pci_read_config(PCIDevice *pdev, uint32_t addr, int len)\n{\n    VFIOPCIDevice *vdev = VFIO_PCI(pdev);\n    uint32_t emu_bits = 0, emu_val = 0, phys_val = 0, val;\n\n    memcpy(&amp;emu_bits, vdev-&gt;emulated_config_bits + addr, len);\n    emu_bits = le32_to_cpu(emu_bits);\n\n    if (emu_bits) {\n        emu_val = pci_default_read_config(pdev, addr, len);\n    }\n\n    if (~emu_bits &amp; (0xffffffffU &gt;&gt; (32 - len * 8))) {\n        pread(vdev-&gt;vbasedev.fd, &amp;phys_val, len,\n                    vdev-&gt;config_offset + addr);\n        phys_val = le32_to_cpu(phys_val);\n    }\n\n    val = (emu_val &amp; emu_bits) | (phys_val &amp; ~emu_bits);\n\n    return val;\n}\n</code></pre> <p>\u56e0\u6b64\u5982\u679c QEMU \u60f3\u5728 PCIe passthrough \u7684\u65f6\u5019\uff0c\u4f2a\u88c5\u4e00\u4e9b Configuration Space \u7684\u5185\u5bb9\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 emulated_config_bits \u6765\u5b9e\u73b0\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#\u4e2d\u65ad","title":"\u4e2d\u65ad","text":"<p>VFIO \u7684\u4e2d\u65ad\u901a\u8fc7 <code>ioctl(VFIO_DEVICE_SET_IRQS)</code> \u6765\u521d\u59cb\u5316\uff0c\u628a eventfd \u548c\u4e2d\u65ad\u7ed1\u5b9a\u8d77\u6765\uff1a</p> <pre><code>// error handling code removed\nint vfio_set_irq_signaling(VFIODevice *vbasedev, int index, int subindex,\n                           int action, int fd, Error **errp)\n{\n    struct vfio_irq_set *irq_set;\n    int argsz;\n    int32_t *pfd;\n\n    argsz = sizeof(*irq_set) + sizeof(*pfd);\n\n    irq_set = g_malloc0(argsz);\n    irq_set-&gt;argsz = argsz;\n    irq_set-&gt;flags = VFIO_IRQ_SET_DATA_EVENTFD | action;\n    irq_set-&gt;index = index;\n    irq_set-&gt;start = subindex;\n    irq_set-&gt;count = 1;\n    pfd = (int32_t *)&amp;irq_set-&gt;data;\n    *pfd = fd;\n\n    ioctl(vbasedev-&gt;fd, VFIO_DEVICE_SET_IRQS, irq_set);\n\n    return 0;\n}\n</code></pre>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#dpdk","title":"DPDK","text":"<p>DPDK \u662f\u4e00\u4e2a\u5728\u7528\u6237\u6001\u8fdb\u884c\u7f51\u7edc\u5904\u7406\u7684\u6846\u67b6\uff0c\u5b83\u53ef\u4ee5\u7528 VFIO \u6765\u63a5\u7ba1\u7f51\u5361\uff0c\u5728\u7528\u6237\u6001\u8fd0\u884c\u7f51\u5361\u9a71\u52a8\u3002\u5b83\u5bf9 VFIO \u7684\u8c03\u7528\u548c QEMU \u7c7b\u4f3c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d34\u51fa\u4ee3\u7801\u4e86\uff0c\u76f4\u63a5\u7ed9\u51fa\u94fe\u63a5\uff1a</p> <ul> <li>\u6838\u5fc3\uff1ahttps://github.com/DPDK/dpdk/blob/main/lib/eal/linux/eal_vfio.c</li> <li>\u4e2d\u65ad\uff1ahttps://github.com/DPDK/dpdk/blob/main/lib/eal/linux/eal_interrupts.c</li> </ul>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/07/24/vfio/#uio","title":"UIO","text":"<p>\u5728 VFIO \u4e4b\u524d\uff0c\u8fd8\u53ef\u4ee5\u7528 UIO\uff08User I/O\uff09\u9a71\u52a8\u6765\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\u3002\u7b80\u5355\u6765\u8bf4\uff0cUIO \u9a71\u52a8\u4f1a\u521b\u5efa\u4e00\u4e2a\u8bbe\u5907\u6587\u4ef6 <code>/dev/uioX</code>\uff0c\u8bfb\u53d6\u6587\u4ef6\u7b49\u4e8e\u7b49\u5f85\u4e2d\u65ad\uff0cmmap \u4ee5\u540e\u53ef\u4ee5\u8bbf\u95ee\u5b83\u7684 BAR \u7a7a\u95f4\uff08\u504f\u79fb\u4ece sysfs \u4e2d\u8bfb\u53d6\uff09\uff0cConfiguration \u7a7a\u95f4\u901a\u8fc7 sysfs \u6765\u8bfb\u5199\u3002\u7528\u6237\u7a0b\u5e8f\u7684\u4f8b\u5b50\u89c1 Example code using uio_pci_generic \u548c Linux Userspace Memory &amp; I/O\u3002</p> <p>\u4f46\u662f UIO \u9a71\u52a8\u4e0d\u5904\u7406 IOMMU \u6620\u5c04\uff0c\u6240\u4ee5\u4f1a\u6709\u5b89\u5168\u95ee\u9898\uff0c\u4f7f\u7528 UIO \u7684\u65f6\u5019\u4e5f\u9700\u8981\u5173\u6389 IOMMU\u3002\u7279\u522b\u5730\uff0c\u5982\u679c\u6253\u5f00\u4e86 Secure Boot\uff0c\u5c06\u4f1a\u65e0\u6cd5\u4f7f\u7528 UIO\u3002\u5173\u4e8e UIO \u7684\u6587\u6863\u53ef\u4ee5\u9605\u8bfb The Userspace I/O HOWTO\u3002</p>","tags":["linux","pcie","driver","vfio"]},{"location":"software/2023/01/13/vscode-server-on-freebsd/","title":"\u5728 FreeBSD \u4e0a\u8fd0\u884c code-server","text":"","tags":["vscode","code-server","freebsd"]},{"location":"software/2023/01/13/vscode-server-on-freebsd/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728 FreeBSD \u4e0a\u79fb\u690d\u5f00\u6e90\u8f6f\u4ef6\uff0c\u4f46\u662f\u56e0\u4e3a vscode \u5b98\u65b9\u4e0d\u652f\u6301 FreeBSD\uff0c\u6240\u4ee5\u5c1d\u8bd5\u4f7f\u7528 code-server\u3002</p>","tags":["vscode","code-server","freebsd"]},{"location":"software/2023/01/13/vscode-server-on-freebsd/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>\u9996\u5148\u6309\u7167\u5b98\u65b9\u6587\u6863\u5b89\u88c5 code-server\uff1a</p> <pre><code>curl -fsSL https://code-server.dev/install.sh | sh\n</code></pre> <p>\u5982\u679c\u63d0\u793a node \u7248\u672c\u9700\u8981 16 \u800c\u4e0d\u662f 18\uff0c\u5b89\u88c5 node 16 \u540e\u91cd\u65b0\u5b89\u88c5 code-server:</p> <pre><code>sudo pkg install node16 npm-node16\ncurl -fsSL https://code-server.dev/install.sh | sh\n</code></pre> <p>\u542f\u52a8 code-server\uff1a</p> <pre><code>code-server --bind-addr 0.0.0.0:8080\n</code></pre> <p>\u5982\u679c\u8fd0\u884c\u65e5\u5fd7\u4e2d\u62a5\u544a\u4e86\u5f88\u591a\u9519\u8bef\uff0c\u7f3a\u5c11\u4e86\u4e00\u4e9b\u5305\uff0c\u90a3\u5c31\u5b89\u88c5\u4e0a\uff1a</p> <pre><code>sudo npm i -g yazl yauzl @microsoft/1ds-core-js vscode-regexpp xterm-headless vscode-proxy-agent --unsafe-perm\n</code></pre> <p>\u5230\u8fd9\u91cc\u5c31\u80fd\u5728\u7f51\u9875\u91cc\u770b\u5230 UI \u4e86\uff0c\u4f46\u662f\u53d1\u73b0\u5f88\u591a\u529f\u80fd\u90fd\u4e0d\u5de5\u4f5c\u3002\u4f8b\u5982\u641c\u7d22\u7684\u65f6\u5019\uff0c\u4f1a\u544a\u8bc9\u4f60\u627e\u4e0d\u5230 rg\uff0c\u662f\u56e0\u4e3a ripgrep \u6ca1\u6709\u63d0\u4f9b FreeBSD \u7684 prebuilt binary\u3002\u7528 pkg \u5b89\u88c5\u518d\u8f6f\u94fe\u63a5\u8fc7\u53bb\uff1a</p> <pre><code>sudo pkg install ripgrep\ncd /usr/local/lib/node_modules/@vscode/ripgrep/bin &amp;&amp; ln -s /usr/local/bin/rg\ncd /usr/local/lib/node_modules/code-server/lib/vscode/node_modules/@vscode/ripgrep/bin &amp;&amp; ln -s /usr/local/bin/rg\n</code></pre> <p>\u7136\u540e\uff0c\u65e5\u5fd7\u4e2d\u4f1a\u663e\u793a @parcel/watcher \u542f\u52a8\u5931\u8d25\uff0c\u663e\u793a Undefined symbol\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fd9\u4e2a\u5e93\u622a\u6b62\u5230 v2.2.0 \u8fd8\u6ca1\u6709\u505a FreeBSD \u652f\u6301\uff0c\u7b49\u4e0b\u4e2a\u7248\u672c\u5e94\u8be5\u5c31\u652f\u6301\u4e86\u3002\u9700\u8981\u4f7f\u7528 https://github.com/parcel-bundler/watcher/pull/149 \u7248\u672c\uff0c\u7f16\u8bd1\u51fa watcher.node \u6587\u4ef6\uff0c\u66ff\u6362\uff1a</p> <pre><code>cd watcher\nnpm install\nsudo cp build/Release/watcher.node /usr/local/lib/node_modules/@parcel/watcher/build/Release/\nsudo cp build/Release/watcher.node /usr/local/lib/node_modules/code-server/lib/vscode/node_modules/@parcel/watcher/build/Release/watcher.node\n</code></pre> <p>\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86 watcher \u7684\u95ee\u9898\u3002</p> <p>\u6700\u540e\u4e00\u4e2a\u95ee\u9898\u662f\u65e0\u6cd5\u6253\u5f00 Terminal\uff0c\u56e0\u4e3a\u5728 VSCode \u4ee3\u7801\u4e2d\uff0c\u68c0\u6d4b\u5230\u4e0d\u652f\u6301\u7684 Platform \u7684\u65f6\u5019\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\uff1a</p> <pre><code>[IPC Library: Pty Host] The factory function of \"vs/platform/terminal/node/ptyHostMain\" has thrown an exception\n[IPC Library: Pty Host] Error: Platform not supported\n</code></pre> <p>\u53ef\u4ee5\u4fee\u6539\u6e90\u7801\uff1a<code>sudo vim /usr/local/lib/node_modules/code-server/lib/vscode/out/vs/platform/terminal/node/ptyHostMain.js</code>\uff0c\u627e\u5230 <code>Platform not supported</code> \u9644\u8fd1\u7684\u4ee3\u7801\uff0c\u628a\u8fd9\u4e2a\u68c0\u67e5\u6539\u6389\uff0c\u4f8b\u5982\u66ff\u6362 linux \u4e3a freebsd\uff0c\u628a freebsd \u5f53\u6210 linux \u6765\u68c0\u6d4b\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u548c https://github.com/coder/code-server/issues/5760 \u4e00\u81f4\uff0c\u5b89\u88c5\u4f9d\u8d56\uff0c\u91cd\u65b0 <code>npm install</code>\uff1a</p> <pre><code>sudo pkg install libsecret pkgconf\ncd /usr/local/lib/node_modules/code-server\nsudo npm install --unsafe-perm\n# go back to @parcel/watcher\ncd watcher\nsudo cp build/Release/watcher.node /usr/local/lib/node_modules/code-server/lib/vscode/node_modules/@parcel/watcher/build/Release\n</code></pre> <p>\u5b8c\u6210\u8fd9\u4e9b\u6b65\u9aa4\u4ee5\u540e\uff0cTerminal \u4e5f\u6b63\u5e38\u4e86\u3002</p>","tags":["vscode","code-server","freebsd"]},{"location":"software/2019/01/16/vscode-vim-chinese-word-motion/","title":"\u5b9e\u73b0 VSCodeVim \u4e2d\u652f\u6301\u4e2d\u6587\u5206\u8bcd\u7684\u5355\u8bcd\u79fb\u52a8","text":"<p>\u6700\u8fd1\u7528 VS Code \u5199\u4e2d\u6587 LaTeX \u6bd4\u8f83\u591a\uff0c\u4f46\u662f\u7f16\u8f91\u8d77\u6765\u603b\u662f\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4e0d\u80fd\u7528\u5404\u79cd\u5e26 w \u7684 motion\uff0c\u4e0d\u7136\u6574\u884c\u90fd\u6ca1\u4e86\u3002\u4e8e\u662f @xalanq \u63d0\u51fa\u80fd\u4e0d\u80fd\u62ff\u4e00\u4e2a JS \u7684\u5206\u8bcd\u5e93\uff0c\u9b54\u6539\u4e00\u4e0b VSCode Vim \u6765\u5f97\u5230\u540c\u6837\u6548\u679c\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u6700\u540e\u4ee3\u7801\u5728 jiegec/VSCodeVimChinese \u91cc\uff0c\u8fd8\u6ca1\u6709\u5408\u5e76\u5230\u4e0a\u6e38\u7684\u6253\u7b97\u3002\u4e0d\u5b9a\u671f\u6839\u636e\u4e0a\u6e38\u53d1\u7248\u672c\u540c\u6b65\u66f4\u65b0\uff0c\u5728 Github Release \u91cc\u53d1\u5e03 vsix \u6587\u4ef6\uff0c\u76ee\u524d\u7248\u672c\u4e3a v1.0.1\u3002\u5728 VS Code \u91cc <code>Extensions: Install from VSIX...</code> \u5373\u53ef\u5b89\u88c5\u3002</p> <p>\u7ecf\u8fc7\u5bf9\u4ee3\u7801\u7684\u7814\u7a76\uff0c\u53d1\u73b0\u5bf9 motion w \u7684\u5904\u7406\u90fd\u662f\u901a\u8fc7 <code>getWordLeft</code> <code>getWordRight</code> \u548c <code>getCurrentWordEnd</code> \u5b8c\u6210\u7684\u3002\u4e8e\u662f\u6211\u4fee\u6539\u4e86\u8fd9\u4e09\u4e2a\u51fd\u6570\uff0c\u6839\u636e\u539f\u6765\u7684\u8fd4\u56de\u503c\u628a\u5b57\u7b26\u4e32\u5582\u7ed9\u5206\u8bcd\u5668\uff0c\u518d\u8fd4\u56de\u7684\u65b0\u7684\u4f4d\u7f6e\u3002\u4e00\u5f00\u59cb\u7528\u7684\u662f <code>nodejieba</code> \uff0c\u4f46\u662f\u56e0\u4e3a\u9700\u8981\u7528\u5230 <code>node-gyp</code> \u9047\u5230\u4e86 Node \u7248\u672c\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\uff0c\u4e8e\u662f\u6362\u4e86\u4e00\u4e2a\u7eaf Node \u7684\u5b9e\u73b0 <code>node-segment</code> \uff0c\u5c31\u5b8c\u6210\u4e86\u8fd9\u4e2a\u529f\u80fd\u3002</p>","tags":["vscode","vim","vscodevim","chinese"]},{"location":"software/2024/02/18/write-a-linker-1/","title":"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u65e0\u8bba\u662f\u5728\u8bfe\u7a0b\u4e2d\u8fd8\u662f\u5b9e\u8df5\u4e2d\uff0c\u90fd\u7ecf\u5e38\u548c\u94fe\u63a5\u5668\u6253\u4ea4\u9053\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5927\u6982\u4e86\u89e3\u4e86\u5b83\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5bf9\u4e8e\u5e38\u89c1\u7684\u9519\u8bef\u53ef\u4ee5\u77e5\u9053\u5927\u6982\u662f\u600e\u4e48\u4e00\u56de\u4e8b\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u51b3\u3002\u4f46\u6700\u8fd1\u9047\u5230\u4e00\u4e9b\u6d89\u53ca\u5230\u94fe\u63a5\u5668\u5185\u90e8\u7684\u95ee\u9898\uff0c\u624d\u53d1\u73b0\u81ea\u5df1\u5bf9\u94fe\u63a5\u5668\u7684\u5185\u90e8\u7684\u4e86\u89e3\u8fd8\u662f\u6bd4\u8f83\u532e\u4e4f\u7684\u3002\u56e0\u6b64\u60f3\u5230\u81ea\u5df1\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff0c\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u5b66\u4e60\u3002</p> <p>\u672c\u6587\u5047\u5b9a\u8bfb\u8005\u5df2\u7ecf\u5bf9\u94fe\u63a5\u5668\u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u4e86\u89e3\u94fe\u63a5\u7684\u5927\u81f4\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u5148\u5b66\u4e60\u7f51\u7edc\u4e0a\u7684\u8d44\u6599\u3002</p> <p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u535a\u5ba2\u7684\u76ee\u6807\u662f\uff1a\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u8f93\u5165\u5355\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u5206\u6790","title":"\u5206\u6790","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6","title":"\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6","text":"<p>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff0c\u5148\u4ece\u6700\u7b80\u5355\u7684\u60c5\u51b5\u5f00\u59cb\uff1a\u8f93\u5165\u4e00\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa\u4e00\u4e2a ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u4e3a\u4e86\u907f\u514d\u5f15\u5165 libc \u7b49\u4f9d\u8d56\uff0c\u4ece\u7f51\u4e0a\u627e\u4e86\u4e00\u6bb5\u76f4\u63a5\u7528 syscall \u6253\u5370\u5b57\u7b26\u4e32\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u505a\u4e86\u7b80\u5355\u4fee\u6539\uff1a</p> <pre><code># From https://gist.github.com/adrianratnapala/1321776\n# Hello World on amd64 under Linux.\n#\n# One way to build this is with: \n#\n#    gcc hello.S  -s -nostartfiles -nostdlib -o hello\n#\n# for syscall numbers look in /usr/include/asm/unistd_64.h\n# for examples look at http://99-bottles-of-beer.net/language-assembler-(amd64)-933.html\n# for inspiration look at http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html\n\n    .section .rodata\nhello:\n    .string \"Hello world!\\n\"\n\n\n    .section .text\n    .globl _start\n_start:\n    # write(1, hello, 13)\n    mov     $1, %rdi\n    mov     $hello, %rsi\n    mov     $13, %rdx\n    mov     $1, %rax\n    syscall\n\n    # _exit(0)\n    xor     %rdi, %rdi\n    mov     $60, %rax\n    syscall\n</code></pre> \u8fd9\u6bb5\u6c47\u7f16\u505a\u4e86\u4ec0\u4e48\uff1f <p>\u8fd9\u6bb5\u6c47\u7f16\u8981\u5b9e\u73b0\u7684\u662f\u5411\u6807\u51c6\u8f93\u51fa\u6253\u5370 <code>Hello world!\\n</code>\uff0c\u4f46\u4e3a\u4e86\u907f\u514d\u5f15\u5165 C \u6807\u51c6\u5e93\uff08libc\uff09\uff0c\u53ea\u80fd\u76f4\u63a5\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u6765\u5b8c\u6210\u6253\u5370\u3002\u5728 Linux \u4e2d\uff0c\u5411\u6807\u51c6\u8f93\u51fa\u6253\u5370\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5411\u6807\u51c6\u8f93\u51fa\u5bf9\u5e94\u7684 file handle\uff08\u7b80\u79f0 fd\uff0c\u901a\u5e38\u7ea6\u5b9a\u6807\u51c6\u8f93\u5165 stdin \u662f 0\uff0c\u6807\u51c6\u8f93\u51fa stdout \u662f 1\uff0c\u6807\u51c6\u9519\u8bef\u8f93\u51fa stderr \u662f 2\uff09\u5199\u5165\u8981\u6253\u5370\u7684\u5185\u5bb9\u3002\u800c\u8fd9\u4e2a\u9700\u8981\u901a\u8fc7\u8c03\u7528 <code>write</code> syscall \u6765\u5b9e\u73b0\u3002</p> <p>\u77e5\u9053\u8fd9\u4e00\u70b9\u4ee5\u540e\uff0c\u5c31\u8981\u53bb\u67e5\u627e Linux \u7684 write syscall \u7684\u6587\u6863\u3002\u6587\u6863\u544a\u8bc9\u4f60\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f <code>fd</code>\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>buf</code> \u6307\u5411\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570 <code>count</code> \u662f\u8981\u5199\u5165\u7684\u6570\u636e\u7684\u957f\u5ea6\u3002\u7ed3\u5408\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u4e3a\u4e86\u6253\u5370 <code>Hello world!\\n</code>\uff0c\u5b9e\u9645\u4e0a\u8981\u5b8c\u6210\u7684\u76f8\u5f53\u4e8e\u662f C \u4ee3\u7801\u4e2d\u7684 <code>write(1, hello, 13)</code>\uff0c\u5176\u4e2d 1 \u5c31\u662f stdout \u7684 fd\uff0c<code>hello</code> \u6307\u5411\u4fdd\u5b58 <code>Hello world!\\n</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\uff0c13 \u662f\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u8981\u7814\u7a76\uff0c\u5982\u4f55\u7528\u6c47\u7f16\u8c03\u7528 syscall\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8981\u77e5\u9053\u5728 amd64 Linux \u4e0b\uff0c\u5982\u4f55\u7528\u6c47\u7f16\u8c03\u7528 syscall\u3002\u9996\u5148\u627e\u5230 amd64 Linux syscall \u8c03\u7528\u7ea6\u5b9a\uff0c\u5b83\u544a\u8bc9\u6211\u4eec\uff1a</p> <ol> <li>syscall \u7f16\u53f7\u4fdd\u5b58\u5728 rax \u5bc4\u5b58\u5668\u4e2d</li> <li>syscall \u7684\u53c2\u6570\u6309\u987a\u5e8f\uff0c\u4f9d\u6b21\u4fdd\u5b58\u5728 rdi, rsi, rdx, r10, r8, r9 \u5bc4\u5b58\u5668\u4e2d</li> <li>\u7528 syscall \u6307\u4ee4\u8c03\u7528 syscall</li> <li>syscall \u7684\u8fd4\u56de\u503c\u4e5f\u4f1a\u4fdd\u5b58\u5728 rax \u5bc4\u5b58\u5668\u4e2d</li> </ol> <p>\u65e2\u7136\u8981\u8c03\u7528 <code>write(1, hello, 13)</code>\uff0c\u90a3\u5c31\u6309\u7167\u4e0a\u9762\u7684\u8981\u6c42\uff0c\u8bbe\u7f6e <code>rdi=1</code>\u3001<code>rsi=hello</code> \u548c <code>rdx=13</code>\uff0c\u6700\u540e\u5728 amd64 Linux syscall table \u4e2d\u627e\u5230 <code>write</code> syscall \u7684\u7f16\u53f7\u662f 1\uff0c\u6240\u4ee5\u8bbe\u7f6e <code>rax=1</code>\u3002\u5230\u8fd9\u91cc\uff0c\u8c03\u7528 <code>write</code> syscall \u7684\u6240\u6709\u51c6\u5907\u4efb\u52a1\u90fd\u5df2\u7ecf\u5b8c\u6210\uff0c\u8c03\u7528 <code>syscall</code> \u6307\u4ee4\u5373\u53ef\u5b8c\u6210\u7cfb\u7edf\u8c03\u7528\u3002\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u4e00\u6b21 <code>Hello world!\\n</code> \u7684\u6253\u5370\uff1a</p> <pre><code># write(1, hello, 13)\nmov     $1, %rdi\nmov     $hello, %rsi\nmov     $13, %rdx\nmov     $1, %rax\nsyscall\n</code></pre> <p>\u540e\u9762 <code>exit(0)</code> \u7684\u7cfb\u7edf\u8c03\u7528\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\u4ee3\u7801\u4e2d\u5199 <code>_exit(0)</code> \u662f\u4e3a\u4e86\u548c C \u6807\u51c6\u5e93\u4e2d\u7684 <code>exit(0)</code> \u505a\u533a\u5206\uff1a\u524d\u8005\u76f4\u63a5\u9000\u51fa\u7a0b\u5e8f\uff08\u53ea\u4f1a\u7ed3\u675f\u5f53\u524d\u7ebf\u7a0b\uff0c\u4f46\u662f\u7531\u4e8e\u5f53\u524d\u8fdb\u7a0b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u6574\u4e2a\u8fdb\u7a0b\u90fd\u7ed3\u675f\u4e86\uff09\uff0c\u800c\u540e\u8005\u4f1a\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u89c1 _exit manpage\u3002</p> <p>\u7531\u4e8e\u662f\u6c47\u7f16\u4ee3\u7801\uff0c\u6240\u4ee5\u76f4\u63a5\u8c03\u7528\u6c47\u7f16\u5668\u751f\u6210 ELF .o \u6587\u4ef6\uff0c\u7136\u540e\u89c2\u5bdf\u5b83\u7684\u5185\u5bb9\uff1a</p> <pre><code># Use assembler (GNU as) to assemble\n$ as helloworld_asm.s -o helloworld_asm.o\n# readelf -a, --all: Equivalent to: -h -l -S -s -r -d -V -A -I\n#         -h, --file-header: Display the ELF file header\n#         -l, --program-headers: Display the program headers\n#         -S, --section-headers: Display the sections' header\n#         -s, --syms: Display the symbol table\n#         -r, --relocs: Display the relocations (if present)\n#         -d, --dynamic: Display the dynamic section (if present)\n#         -V, --version-info: Display the version sections (if present)\n#         -A, --arch-specific: Display architecture specific information (if any)\n#         -I, --histogram: Display histogram of bucket list lengths\n$ readelf -a helloworld_asm.o\n# Output is shown below\n</code></pre> <p>\u4e0b\u9762\u89c2\u5bdf readelf \u547d\u4ee4\u7684\u8f93\u51fa\uff0c\u9996\u5148\u662f ELF \u7684\u5934\u90e8\uff0c\u4ea4\u4ee3\u4e86\u6587\u4ef6\u7c7b\u578b\uff0c\u6267\u884c\u5728\u4ec0\u4e48\u6307\u4ee4\u96c6\u67b6\u6784\u4e0a\u7b49\u7b49\uff1a</p> <pre><code>ELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 \n  Class:                             ELF64\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              REL (Relocatable file)\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x0\n  Start of program headers:          0 (bytes into file)\n  Start of section headers:          320 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           0 (bytes)\n  Number of program headers:         0\n  Size of section headers:           64 (bytes)\n  Number of section headers:         9\n  Section header string table index: 8\n</code></pre> <p>\u63a5\u4e0b\u6765\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u90e8\u5206\uff0cELF \u5305\u62ec\u591a\u4e2a section\uff0c\u6839\u636e\u7528\u9014\uff0c\u4e0d\u540c\u7684\u6307\u4ee4\u548c\u6570\u636e\u4f1a\u653e\u5728\u5bf9\u5e94\u7684 section \u4e2d\uff0c\u4f8b\u5982 .text \u5b58\u653e\u6307\u4ee4\uff0c.data .bss .rodata \u5b58\u653e\u5404\u79cd\u6570\u636e\uff0c.rela \u5b58\u653e\u91cd\u5b9a\u4f4d\uff08relocation\uff09\u3002</p> <pre><code>Section Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .text             PROGBITS         0000000000000000  00000040\n       000000000000002a  0000000000000000  AX       0     0     1\n  [ 2] .rela.text        RELA             0000000000000000  000000e8\n       0000000000000018  0000000000000018   I       6     1     8\n  [ 3] .data             PROGBITS         0000000000000000  0000006a\n       0000000000000000  0000000000000000  WA       0     0     1\n  [ 4] .bss              NOBITS           0000000000000000  0000006a\n       0000000000000000  0000000000000000  WA       0     0     1\n  [ 5] .rodata           PROGBITS         0000000000000000  0000006a\n       000000000000000e  0000000000000000   A       0     0     1\n  [ 6] .symtab           SYMTAB           0000000000000000  00000078\n       0000000000000060  0000000000000018           7     3     8\n  [ 7] .strtab           STRTAB           0000000000000000  000000d8\n       000000000000000e  0000000000000000           0     0     1\n  [ 8] .shstrtab         STRTAB           0000000000000000  00000100\n       0000000000000039  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  D (mbind), l (large), p (processor specific)\n</code></pre> <p>\u90a3\u4e48\u94fe\u63a5\u5668\u9700\u8981\u7279\u522b\u5173\u6ce8\u548c\u5904\u7406\u7684\u5c31\u662f\u91cc\u9762\u7684 relocation \u4ee5\u53ca\u7b26\u53f7\u8868\uff08Symbol table\uff09\u4e86\uff1a\u5728\u6c47\u7f16\u751f\u6210 .o \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6307\u4ee4\u5f15\u7528\u4e86\u6570\u636e\uff08\"Hello world!\\n\"\uff09\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u63d0\u524d\u77e5\u9053\u6570\u636e\u6240\u5904\u7684\u5730\u5740\uff0c\u56e0\u6b64\u6c47\u7f16\u5668\u4f1a\u751f\u6210\u4e00\u4e2a relocation \u6761\u76ee\uff0c\u4e5f\u5c31\u662f\u4e0b\u9762\u7684 <code>R_X86_64_32S</code>\uff1a</p> <pre><code>Relocation section '.rela.text' at offset 0xe8 contains 1 entry:\n  Offset          Info           Type           Sym. Value    Sym. Name + Addend\n00000000000a  00010000000b R_X86_64_32S      0000000000000000 .rodata + 0\nNo processor specific unwind information to decode\n\nSymbol table '.symtab' contains 4 entries:\n   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND \n     1: 0000000000000000     0 SECTION LOCAL  DEFAULT    5 .rodata\n     2: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT    5 hello\n     3: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT    1 _start\n</code></pre> <p>\u800c\u5f53\u94fe\u63a5\u5668\u786e\u5b9a\u4e86\u4ee3\u7801\u548c\u6570\u636e\u7684\u5730\u5740\u4ee5\u540e\uff0c\u53d1\u73b0\u90e8\u5206 relocation \u7684\u5730\u5740\u5df2\u7ecf\u53ef\u4ee5\u786e\u5b9a\u4e0b\u6765\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u5730\u5740\u5199\u5165\u5230\u6307\u4ee4\u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u52a8\u6001\u7684 relocation\u3002\u7b26\u53f7\u8868\u5219\u63d0\u4f9b\u4e86\u7b26\u53f7\u5230\u5730\u5740\u7684\u6620\u5c04\uff0c\u505a\u7b26\u53f7\u89e3\u6790\u7684\u65f6\u5019\u4f1a\u7528\u5230\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","title":"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u4e0b\u9762\u6211\u4eec\u8981\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff0c\u5c31\u628a\u8fd9\u4e00\u4e2a ELF .o \u751f\u6210\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002\u53ef\u4ee5\u5148\u8ba9\u73b0\u6709\u7684 ld \u94fe\u63a5\u51fa\u6765\uff0c\u770b\u770b\u5b83\u7684\u6700\u7ec8\u6548\u679c\u662f\u4ec0\u4e48\u6837\u7684\uff1a</p> <pre><code># Use ld (GNU ld.bfd) to link\n$ ld helloworld_asm.o -o helloworld_asm\n$ readelf -a helloworld_asm\n# Output is shown below\n</code></pre> <p>\u9996\u5148\u662f ELF \u7684\u5934\u90e8\uff0c\u8fd9\u6b21\u53ef\u4ee5\u770b\u5230\u6587\u4ef6\u7c7b\u578b\u53d8\u6210\u4e86\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u4e14\u6709\u4e86\u4e00\u4e2a\u5165\u53e3\u5730\u5740\uff080x401000\uff09\uff1a</p> <pre><code>ELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 \n  Class:                             ELF64\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x401000\n  Start of program headers:          64 (bytes into file)\n  Start of section headers:          8472 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           56 (bytes)\n  Number of program headers:         3\n  Size of section headers:           64 (bytes)\n  Number of section headers:         6\n  Section header string table index: 5\n</code></pre> <p>\u800c section \u4e5f\u53d8\u5f97\u66f4\u5c11\uff1a\u6ca1\u7528\u5230\u7684 .data .bss \u6bb5\u90fd\u5220\u6389\u4e86\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u4e86 relocation\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fd9\u4e2a\u7a0b\u5e8f\u91cc\u6240\u6709\u7684 relocation \u90fd\u662f\u5185\u90e8\u7684\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u5c31\u76f4\u63a5\u8ba1\u7b97\u51fa\u5730\u5740\u4e86\u5e76\u586b\u8fdb\u53bb\u4e86\u3002</p> <pre><code>Section Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .text             PROGBITS         0000000000401000  00001000\n       000000000000002a  0000000000000000  AX       0     0     1\n  [ 2] .rodata           PROGBITS         0000000000402000  00002000\n       000000000000000e  0000000000000000   A       0     0     1\n  [ 3] .symtab           SYMTAB           0000000000000000  00002010\n       00000000000000a8  0000000000000018           4     3     8\n  [ 4] .strtab           STRTAB           0000000000000000  000020b8\n       0000000000000030  0000000000000000           0     0     1\n  [ 5] .shstrtab         STRTAB           0000000000000000  000020e8\n       0000000000000029  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  D (mbind), l (large), p (processor specific)\n</code></pre> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6bd4\u8f83\u7279\u6b8a\u7684\u70b9\uff0c\u5b83\u6709 segment \u7684\u6982\u5ff5\uff0c\u6307\u793a\u5185\u6838\u5e94\u8be5\u600e\u6837\u628a\u7a0b\u5e8f\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\uff1a</p> <pre><code>Program Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000\n                 0x00000000000000e8 0x00000000000000e8  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000401000 0x0000000000401000\n                 0x000000000000002a 0x000000000000002a  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000402000 0x0000000000402000\n                 0x000000000000000e 0x000000000000000e  R      0x1000\n\n Section to Segment mapping:\n  Segment Sections...\n   00     \n   01     .text \n   02     .rodata \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6307\u793a\u5185\u6838\u4ece\u6587\u4ef6\u7684\u4e09\u4e2a\u504f\u79fb\u5904\u52a0\u8f7d\u4e09\u4e2a\u90e8\u5206\u5185\u5bb9\u5230\u5185\u5b58\u91cc\uff0c\u5206\u522b\u662f\u6587\u4ef6\u5934\u3001.text \u6bb5\u4ee5\u53ca .rodata \u6bb5\u3002\u52a0\u8f7d\u5b8c\u4ee5\u540e\uff0c\u5185\u6838\u4ece\u5934\u90e8\u91cc\u5199\u7684\u5165\u53e3\u5730\u5740\u5f00\u59cb\u6267\u884c\uff0c\u5c31\u53ef\u4ee5\u628a\u7a0b\u5e8f\u8dd1\u8d77\u6765\u3002\u8fd9\u65f6\u5019\u518d\u53bb\u770b\u6c47\u7f16\uff0c\u53ef\u4ee5\u53d1\u73b0\u94fe\u63a5\u540e\u7684\u4ee3\u7801\u4ece 0x4001000 \u5f00\u59cb\uff0c\u5e76\u4e14\u76f4\u63a5\u628a .rodata \u7684\u5730\u5740\u5199\u5230\u4e86\u6307\u4ee4\u7684\u7acb\u5373\u6570\u4e4b\u4e2d\uff1a</p> <pre><code># objdump -S: Display assembly and intermix source code with disassembly\n$ objdump -S helloworld_asm.o\n0000000000000000 &lt;_start&gt;:\n   0:   48 c7 c7 01 00 00 00    mov    $0x1,%rdi\n   7:   48 c7 c6 00 00 00 00    mov    $0x0,%rsi\n   e:   48 c7 c2 0d 00 00 00    mov    $0xd,%rdx\n  15:   48 c7 c0 01 00 00 00    mov    $0x1,%rax\n  1c:   0f 05                   syscall\n  1e:   48 31 ff                xor    %rdi,%rdi\n  21:   48 c7 c0 3c 00 00 00    mov    $0x3c,%rax\n  28:   0f 05                   syscall\n$ objdump -S helloworld_asm\n0000000000401000 &lt;_start&gt;:\n  401000:       48 c7 c7 01 00 00 00    mov    $0x1,%rdi\n  401007:       48 c7 c6 00 20 40 00    mov    $0x402000,%rsi\n  40100e:       48 c7 c2 0d 00 00 00    mov    $0xd,%rdx\n  401015:       48 c7 c0 01 00 00 00    mov    $0x1,%rax\n  40101c:       0f 05                   syscall\n  40101e:       48 31 ff                xor    %rdi,%rdi\n  401021:       48 c7 c0 3c 00 00 00    mov    $0x3c,%rax\n  401028:       0f 05                   syscall\n</code></pre>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u4ece\u8fd9\u91cc\u53ef\u4ee5\u5f52\u7eb3\u51fa\uff0c\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff0c\u628a\u4e0a\u8ff0\u7684 .o \u94fe\u63a5\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5927\u81f4\u9700\u8981\u505a\u54ea\u4e9b\u4e8b\u60c5\uff1a</p> <ol> <li>\u89e3\u6790 ELF \u6587\u4ef6\uff0c\u89e3\u6790\u91cc\u9762\u7684\u5185\u5bb9</li> <li>\u8003\u8651\u5c06\u8981\u8f93\u51fa\u7684 ELF \u6587\u4ef6\u7684\u5e03\u5c40\uff0c\u8ba1\u7b97\u51fa\u5404\u4e2a section \u9700\u8981\u4fdd\u5b58\u7684\u5185\u5bb9\u4ee5\u53ca\u5730\u5740\uff0c\u9700\u8981\u8003\u8651 segment \u7684\u5e03\u5c40\u4ee5\u53ca\u5bf9\u9f50</li> <li>\u6839\u636e\u5730\u5740\uff0c\u5b8c\u6210 relocation \u6240\u9700\u8981\u7684\u8ba1\u7b97\u5e76\u586b\u5165\u5bf9\u5e94\u7684\u4f4d\u7f6e</li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u63a5\u4e0b\u6765\u63cf\u8ff0\u4e00\u4e0b\u5b9e\u73b0\u7684\u5177\u4f53\u601d\u8def\uff1a</p> <ol> <li>\u7b2c\u4e00\u6b65\u5c31\u662f\u89e3\u6790\u8f93\u5165\u7684 ELF \u6587\u4ef6\uff0c\u63d0\u53d6\u51fa\u4e2d\u95f4\u7684\u5185\u5bb9\uff0c\u5305\u62ec\u6709\u54ea\u4e9b section\uff0c\u89e3\u6790 relocation \u7684\u5185\u5bb9\u7b49\u7b49\uff1b\u8fd9\u4e2a\u53ef\u4ee5\u7528\u73b0\u6210\u7684\u5e93\u6765\u8f85\u52a9\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199\u3002</li> <li>\u628a section \u7684\u5185\u5bb9\u6536\u96c6\u4e0b\u6765\uff0c\u4f8b\u5982 .text .rodata \u7b49\u7b49\uff0c\u8fd9\u4e9b\u6570\u636e\u4e4b\u540e\u4f1a\u5199\u5165\u5230\u53ef\u6267\u884c ELF \u6587\u4ef6\u4e2d\u3002</li> <li>\u6536\u96c6\u5b8c\u4ee5\u540e\uff0c\u5c31\u77e5\u9053\u8f93\u51fa\u7684 ELF \u5927\u6982\u9700\u8981\u54ea\u4e9b\u5185\u5bb9\u4e86\u3002\u5728\u8fdb\u884c relocation \u4e4b\u524d\uff0c\u56e0\u4e3a\u76ee\u524d\u5b9e\u73b0\u7684\u662f\u91c7\u7528\u7edd\u5bf9\u5730\u5740\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u5148\u786e\u5b9a\u597d\u5404\u4e2a section \u548c symbol \u7684\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0 relocation \u7684\u8ba1\u7b97\u3002\u89c2\u5bdf ld.bfd \u8f93\u51fa\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230 ELF \u6587\u4ef6\u5305\u62ec\u5982\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a<ol> <li>ELF file header\uff1aELF \u5934\u90e8\uff0c\u586b\u5199\u5404\u79cd\u4fe1\u606f\uff0c\u4ee5\u53ca\u5230\u540e\u7eed\u5404\u4e2a header \u7684\u5730\u5740\u504f\u79fb</li> <li>ELF program header\uff1a\u8ba9 ELF Loader \u77e5\u9053\u6709\u54ea\u4e9b Segment \u8981\u52a0\u8f7d</li> <li>section data\uff1a\u5404\u4e2a section \u7684\u5185\u5bb9\uff0c\u7531\u4e8e section \u9700\u8981\u4fdd\u8bc1\u5bf9\u9f50\uff0c\u56e0\u6b64\u4e2d\u95f4\u9700\u8981\u586b\u4e00\u4e9b\u989d\u5916\u7684\u96f6\u5b57\u8282</li> <li>ELF section header\uff1a\u4fdd\u5b58 section header\uff0c\u8bb0\u5f55\u4e86 section \u7684\u4fe1\u606f</li> </ol> </li> <li>\u800c\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\u7684\u65f6\u5019\uff0c\u5c31\u662f\u76f4\u63a5\u5927\u6bb5\u5730\u8fde\u7eed\u5730\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u63d0\u524d\u8ba1\u7b97\u597d\u5404\u4e2a\u90e8\u5206\u7684\u5730\u5740\u3002\u4f8b\u5982\u8981\u628a ELF \u52a0\u8f7d\u5230 0x400000\uff0c\u90a3\u5c31\u628a file header \u548c program header \u653e\u5728\u5f00\u5934\uff0c\u7136\u540e\u56e0\u4e3a segment \u9700\u8981\u5bf9\u9f50\u5230\u9875\u7684\u8fb9\u754c <sup>1</sup> \uff0c\u4f8b\u5982\u5bf9\u9f50\u5230 0x1000\uff084 KB\uff09\uff0c\u90a3\u5c31\u628a\u8fde\u7eed\u7684\u76f8\u540c\u8bbf\u95ee\u6743\u9650\u7684 section \u653e\u5230\u4e00\u4e2a segment \u5185\uff0c\u7136\u540e\u7b2c\u4e00\u4e2a segment \u653e\u5230 0x401000\uff0c\u5f80\u540e\u518d\u5bf9\u9f50\u518d\u653e\u4e0b\u4e00\u4e2a segment\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u628a\u6240\u6709 segment \u90fd\u653e\u4e0b\u4e3a\u6b62\u3002</li> <li>\u8ba1\u7b97\u597d\u5404\u4e2a\u90e8\u5206\u7684\u5730\u5740\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5404\u4e2a section \u548c symbol \u5728\u6700\u7ec8\u7684\u5185\u5b58\u91cc\u4f1a\u5904\u4e8e\u4ec0\u4e48\u5730\u5740\u4e86\u3002\u6b64\u65f6\u5c31\u6309\u7167 relocation \u7684\u8981\u6c42\u8fdb\u884c\u8ba1\u7b97\uff08\u4f8b\u5982\u524d\u9762\u51fa\u73b0\u8fc7\u7684 <code>R_X86_64_32S</code> \u5c31\u662f\u540e\u5199\u5165 64 \u4f4d\u7684\u5730\u5740\u7684\u4f4e 32 \u4f4d\uff0c\u5e76\u4e14\u68c0\u67e5\u5b83\u7b26\u53f7\u6269\u5c55\u540e\u7b49\u4e8e\u539f\u6765 64 \u4f4d\u7684\u5730\u5740\uff0c\u5982\u679c\u68c0\u67e5\u5931\u8d25\uff0c\u5c31\u4f1a\u5f97\u5230\u5927\u5bb6\u719f\u6089\u7684 <code>relocation truncated to fit</code> \u9519\u8bef\uff09\uff0c\u76f4\u63a5\u628a\u8ba1\u7b97\u7ed3\u679c\u586b\u5165\u5230\u6570\u636e\u4e2d\u3002\u7531\u4e8e\u76ee\u524d\u53ea\u8003\u8651\u6700\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u4e0d\u6d89\u53ca\u5230\u52a8\u6001\u91cd\u5b9a\u4f4d\uff0c\u6240\u4ee5\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u6240\u6709\u91cd\u5b9a\u4f4d\u90fd\u4f1a\u88ab\u94fe\u63a5\u5668\u5b8c\u6210\u3002</li> <li>\u9488\u5bf9\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd8\u9700\u8981\u751f\u6210 segment \u653e\u5230 program header \u91cc\u3002\u7b80\u5355\u7c97\u66b4\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u6574\u4e2a\u6587\u4ef6\u76f4\u63a5\u6620\u5c04\u5230\u5185\u5b58\u7684 0x400000\uff0c\u8bbe\u7f6e\u6743\u9650\u4e3a read + write + execute\u3002\u66f4\u7cbe\u7ec6\u7684\u505a\u6cd5\uff0c\u5219\u662f\u628a\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u6309\u7167\u5408\u9002\u7684\u6743\u9650\u6620\u5c04\uff0c\u4f8b\u5982 .rodata \u653e\u5230 read only \u7684 segment \u91cc\uff0c.text \u653e\u5230 read + execute \u7684 segment \u91cc\u3002</li> <li>\u518d\u6309\u7167\u524d\u9762\u6240\u8ff0\u7684\u6d41\u7a0b\uff0c\u6309\u7167\u9884\u8ba1\u597d\u7684\u5e03\u5c40\uff0c\u628a ELF \u7684\u5185\u5bb9\u5199\u5230\u6587\u4ef6\u91cc\u3002</li> </ol> <p>\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u6ca1\u6709\u4ea4\u4ee3\uff0c\u4f8b\u5982 section string table (.shstrtab) \u7684\u7ef4\u62a4\u7b49\u7b49\u3002\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u8dd1\u8d77\u6765\uff0c\u7b26\u53f7\u8868\u90fd\u53ef\u4ee5\u76f4\u63a5\u5220\u6389\u4e0d\u8981\u3002</p> <p>\u5b9e\u73b0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7075\u6d3b\u8fd0\u7528 readelf \u548c objdump \u7b49\u5de5\u5177\uff0c\u786e\u8ba4\u81ea\u5df1\u8f93\u51fa\u7684 ELF \u6587\u4ef6\u5185\u5bb9\u662f\u6b63\u786e\u7684\u3002\u5982\u679c\u5b9e\u73b0\u6210\u529f\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6210\u529f\u6253\u5370 <code>Hello world\uff01</code>\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u4f7f\u7528\u4e86\u73b0\u6210\u7684 ELF \u8bfb\u5199\u5e93 <code>object</code>\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 200 \u884c\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/02/18/write-a-linker-1/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p> <ul> <li>Tool Interface Standard (TIS) Executable and Linking Format (ELF) Specification</li> <li>System V Application Binary Interface AMD64 Architecture Processor Supplement Draft Version 0.99.6</li> </ul> <ol> <li> <p>\u8fd9\u662f\u4e3a\u4e86\u5728\u52a0\u8f7d ELF \u65f6\u53ef\u4ee5\u76f4\u63a5 mmap\uff0c\u800c\u4e0d\u9700\u8981\u7acb\u5373\u628a\u6587\u4ef6\u5185\u5bb9\u8bfb\u53d6\u5230\u5185\u5b58\u91cc\uff1b\u66f4\u8fdb\u4e00\u6b65\uff0cmmap \u662f\u5141\u8bb8\u591a\u4e2a\u865a\u62df\u9875\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\u4e0a\u7684\uff0c\u6240\u4ee5\u5141\u8bb8\u4e00\u4e9b\u51fa\u73b0\u4e00\u4e9b\u201c\u4e0d\u5bf9\u9f50\u201d\u7684\u60c5\u51b5\uff0c\u5f97\u4ee5\u8282\u7701\u56e0\u4e3a\u5bf9\u9f50\u800c\u6d6a\u8d39\u7684\u7a7a\u95f4\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u8bdd\u9898\u7684\u8fdb\u4e00\u6b65\u4e86\u89e3\uff0c\u5efa\u8bae\u9605\u8bfb Exploring the section layout in linker output\u3002\u00a0\u21a9</p> </li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/","title":"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u5355\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u5347\u7ea7\u5230\u652f\u6301\u8f93\u5165\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u7684 ELF .o \u6587\u4ef6\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u56de\u987e","title":"\u56de\u987e","text":"<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u4e00\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p> <ol> <li>\u89e3\u6790\u8f93\u5165\u7684 ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9</li> <li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li> <li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li> <li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li> </ol> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5b9e\u73b0\u5355\u6587\u4ef6\u8f93\u5165\u5230\u591a\u6587\u4ef6\u8f93\u5165\u7684\u8de8\u8d8a\uff0c\u8ba9\u6211\u4eec\u9996\u5148\u5206\u6790\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7684\u4e0d\u540c\u5728\u54ea\u91cc\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u5206\u6790","title":"\u5206\u6790","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u62c6\u5206\u4ee3\u7801","title":"\u62c6\u5206\u4ee3\u7801","text":"<p>\u8f93\u5165\u53ea\u6709\u4e00\u4e2a ELF object\uff08.o\uff09\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a object \u6587\u4ef6\u91cc\u9700\u8981\u7684\u6240\u6709\u4e1c\u897f\u90fd\u53ea\u80fd\u7531\u8fd9\u4e2a object \u81ea\u5df1\u6765\u63d0\u4f9b\uff0c\u6240\u4ee5\u6bd4\u8f83\u597d\u5b9e\u73b0\u3002\u4f46\u5982\u679c\u8981\u8f93\u5165\u591a\u4e2a ELF object \u6587\u4ef6\uff0c\u6b64\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u9700\u8981\u4f9d\u8d56\u7684\u60c5\u51b5\u3002\u9996\u5148\u56de\u5fc6\u4e00\u4e0b\u4e4b\u524d\u5b66\u4e60\u7684 C/C++ \u7684\u5185\u5bb9\uff0c\u5728\u7f16\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u4f1a\u628a\u58f0\u660e\uff08declaration\uff09\u653e\u5230\u5934\u6587\u4ef6\uff08.h\uff09\u91cc\uff0c\u5b9e\u73b0\uff08definition\uff09\u653e\u5728\u6e90\u6587\u4ef6\uff08.c/cpp\uff09\uff1a\u8fd9\u6837\u53ef\u4ee5\u5728 <code>A.cpp</code> \u4e2d\u8c03\u7528 <code>B.cpp</code> \u91cc\u7684\u51fd\u6570\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5927\u5bb6\u7ecf\u5e38\u9047\u5230\u7684 <code>duplicate symbol</code> \u9519\u8bef\u3002\u90a3\u4e48\u8fd9\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u9996\u5148\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\u6a21\u62df\u8fd9\u4e2a\u573a\u666f\u3002\u9996\u5148\u56de\u987e\u4e00\u4e0b\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\u7528\u6c47\u7f16\u5b9e\u73b0\u7684 Hello World \u4f8b\u5b50\uff1a</p> <pre><code># From https://gist.github.com/adrianratnapala/1321776\n# Hello World on amd64 under Linux.\n#\n# One way to build this is with: \n#\n#    gcc hello.S  -s -nostartfiles -nostdlib -o hello\n#\n# for syscall numbers look in /usr/include/asm/unistd_64.h\n# for examples look at http://99-bottles-of-beer.net/language-assembler-(amd64)-933.html\n# for insipration look at http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html\n\n    .section .rodata\nhello:\n    .string \"Hello world!\\n\"\n\n\n    .section .text\n    .globl _start\n_start:\n    # write(1, hello, 13)\n    mov     $1, %rdi\n    mov     $hello, %rsi\n    mov     $13, %rdx\n    mov     $1, %rax \n    syscall\n\n    # _exit(0)\n    xor     %rdi, %rdi\n    mov     $60, %rax\n    syscall\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u4ee3\u7801\u5b9e\u9645\u4e0a\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5\uff0c\u9996\u5148\u8f93\u51fa Hello World\uff0c\u7136\u540e\u9000\u51fa\u7a0b\u5e8f\u3002\u6211\u4eec\u628a\u8fd9\u4e24\u90e8\u5206\u5206\u522b\u5b9e\u73b0\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u653e\u5230\u53e6\u4e00\u4e2a <code>.s</code> \u6587\u4ef6\uff08<code>printer.s</code>\uff09\u4e2d\uff1a</p> <pre><code># https://gist.github.com/adrianratnapala/1321776\n# printer.s\n    .section .rodata\nhello:\n    .string \"Hello world!\\n\"\n\n\n    .section .text\n    .globl print\nprint:\n    # write(1, hello, 13)\n    mov     $1, %rdi\n    mov     $hello, %rsi\n    mov     $13, %rdx\n    mov     $1, %rax\n    syscall\n    ret\n\n    .globl exit\nexit:\n    # _exit(0)\n    xor     %rdi, %rdi\n    mov     $60, %rax\n    syscall\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u628a\u4e0a\u9762\u7684\u4e24\u6bb5\u6c47\u7f16\u5206\u522b\u653e\u5728 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u4e2d\uff0c\u5e76\u4e14\u52a0\u4e0a\u4e86 <code>ret</code> \u6307\u4ee4\u4ee5\u5b9e\u73b0\u8fd4\u56de\u51fd\u6570\u7684\u8c03\u7528\u8005\u3002<code>exit</code> \u51fd\u6570\u6ca1\u6709\u6dfb\u52a0 <code>ret</code> \uff0c\u662f\u56e0\u4e3a\u8c03\u7528 <code>exit</code> \u7cfb\u7edf\u8c03\u7528\u540e\uff0c\u8fdb\u7a0b\u5c31\u9000\u51fa\u4e86\uff0c\u540e\u9762\u7684\u6307\u4ee4\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u5728\u5165\u53e3\u51fd\u6570\u4e2d\u8c03\u7528\u8fd9\u4e24\u4e2a\u51fd\u6570\u6765\u5b9e\u73b0 <code>Hello world</code> \u7684\u6253\u5370\uff1a</p> <pre><code># main.s\n    .section .text\n    .globl _start\n_start:\n    call print\n    call exit\n</code></pre> <p>\u8c03\u7528 GNU as \u5206\u522b\u6c47\u7f16\u4e24\u4e2a\u6587\u4ef6\u7136\u540e\u94fe\u63a5\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code># Use assembler (GNU as) to assemble\n$ as main.s -o main.o\n$ as printer.s -o printer.o\n# Use ld (GNU ld.bfd) to link\n$ ld main.o printer.o -o helloworld\n$ ./helloworld\nHello world!\n</code></pre>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6","title":"\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6","text":"<p>\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u8981\u63a2\u7a76\uff0c\u6c47\u7f16\u5668\u548c\u94fe\u63a5\u5668\u662f\u5982\u4f55\u534f\u4f5c\uff0c\u4f7f\u5f97 <code>main.s</code> \u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u8c03\u7528 <code>printer.s</code> \u4e2d\u7684\u51fd\u6570\u3002\u5f53\u7136\u4e86\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u7528\u7684\u662f\u6c47\u7f16\u8bed\u8a00\uff0c\u6c47\u7f16\u5668\u9047\u5230\u4e0d\u5b58\u5728\u7684\u51fd\u6570\u540d\u5c31\u4f1a\u8ba4\u4e3a\u662f\u5916\u90e8\u51fd\u6570\u3002\u5982\u679c\u662f C/C++ \u8bed\u8a00\uff0c\u5219\u8981\u5148\u5728 <code>main.c</code> \u4e2d\u58f0\u660e\u8fd9\u4e24\u4e2a\u51fd\u6570\uff08\u6216\u8005 <code>#include</code> \u4e86\u4e00\u4e2a\u58f0\u660e\u4e86\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u5934\u6587\u4ef6\uff09\u518d\u8c03\u7528\uff08\u6bd4\u8f83\u8001\u7684 C \u6807\u51c6\u5141\u8bb8\u4e0d\u58f0\u660e\u76f4\u63a5\u8c03\u7528\uff0c\u4f46\u8fd9\u662f\u4e0d\u63a8\u8350\u7684\uff09\u3002</p> <p>\u9996\u5148\u89c2\u5bdf <code>main.s</code> \u7ecf\u8fc7\u6c47\u7f16\u5f97\u5230\u7684 <code>main.o</code>\uff0c\u770b\u5b83\u662f\u600e\u4e48\u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u7684\uff1a</p> <pre><code># objdump -S: Display assembly and intermix source code with disassembly\n$ objdump -S main.o\n\nmain.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;_start&gt;:\n   0:   e8 00 00 00 00          call   5 &lt;_start+0x5&gt;\n   5:   e8 00 00 00 00          call   a &lt;_start+0xa&gt;\n</code></pre> <p>\u53cd\u6c47\u7f16\u51fa\u6765\u53ef\u4ee5\u770b\u5230\u4e24\u6761 <code>call</code> \u6307\u4ee4\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u5730\u5740\u90fd\u5f88\u5947\u602a\uff1a\u7b2c\u4e00\u6761\u6307\u4ee4\u662f <code>call 5</code>\uff0c\u800c 0x5 \u662f\u7b2c\u4e8c\u6761 call \u5730\u5740\u7684\u5730\u5740\uff1b\u7b2c\u4e8c\u6761\u6307\u4ee4\u662f <code>call a</code>\uff0c\u6309\u7167\u89c4\u5f8b\uff0c\u53ef\u4ee5\u731c\u51fa\u6765 0xa \u662f\u7b2c\u4e8c\u6761\u6307\u4ee4\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\uff0c\u6bcf\u6761\u6307\u4ee4 5 \u4e2a\u5b57\u8282\uff0c\u4e24\u6761\u6307\u4ee4\u521a\u597d 10 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 0xa\u3002\u8fd9\u4f3c\u4e4e\u4e0e <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u90fd\u6ca1\u6709\u5173\u7cfb\uff0c\u6267\u884c\u7684\u65f6\u5019\u600e\u4e48\u4f1a\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u5462\uff1f</p> <p>\u56de\u5fc6\u4e00\u4e0b\uff0c\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u53cd\u6c47\u7f16 <code>.o</code> \u6587\u4ef6\u7684\u65f6\u5019\u4e5f\u51fa\u73b0\u8fc7\u7c7b\u4f3c\u7684\u60c5\u51b5\uff1a<code>_start</code> \u51fd\u6570\u9700\u8981\u77e5\u9053 <code>.rodata</code> \u6bb5\u91cc\u7684 <code>hello</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\uff0c\u4f46\u662f\u6c47\u7f16\u7684\u65f6\u5019\u8fd9\u4e2a\u5730\u5740\u65e0\u6cd5\u77e5\u9053\uff0c\u6240\u4ee5\u6c47\u7f16\u5668\u751f\u6210\u4e86\u4e00\u4e2a relocation\uff08relocation \u7684\u4e2d\u6587\u7ffb\u8bd1\u662f\u91cd\u5b9a\u4f4d\uff0c\u4f46\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u7ffb\u8bd1\uff0c\u6240\u4ee5\u4e0b\u6587\u8fd8\u662f\u7528 relocation\uff09\uff0c\u544a\u8bc9\u94fe\u63a5\u5668\u53bb\u586b\u5165\u6b63\u786e\u7684\u5730\u5740\u3002\u8fd9\u91cc\u4e5f\u662f\u7c7b\u4f3c\u7684\uff1a\u6c47\u7f16\u5668\u5728\u6c47\u7f16 <code>main.s</code> \u7684\u65f6\u5019\uff0c\u4e5f\u65e0\u6cd5\u77e5\u9053 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u4f1a\u5728\u4ec0\u4e48\u5730\u5740\uff0c\u6240\u4ee5\u53ea\u80fd\u751f\u6210\u4e00\u4e2a relocation\uff0c\u628a\u504f\u79fb\u521d\u59cb\u5316\u4e3a\u96f6\uff0c\u7b49\u7740\u94fe\u63a5\u5668\u6765\u586b\u5199\u3002\u800c x86 \u4e0a <code>call</code> \u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u8ba1\u7b97\u65b9\u6cd5\u662f <code>call</code> \u6307\u4ee4\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u5730\u5740\u52a0\u4e0a\u504f\u79fb\uff0c\u8fd9\u4e2a\u504f\u79fb\u521d\u59cb\u5316\u4e3a 0\uff0c\u90a3\u4e48\u53cd\u6c47\u7f16\u770b\u5230\u7684\u5c31\u597d\u50cf\u662f <code>call</code> \u8981\u8c03\u7528\u5b83\u81ea\u5df1\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e0a\u9762\u89c2\u5bdf\u5230\u7684\u73b0\u8c61\u3002</p> <p>\u6b63\u597d <code>objdump</code> \u53ef\u4ee5\u5e2e\u6211\u4eec\u663e\u793a\u51fa relocation\uff0c\u53ea\u9700\u8981\u6dfb\u52a0 <code>-r</code> \u53c2\u6570\uff1a</p> <pre><code># objdump -r, --reloc: Display the relocation entries in the file\n$ objdump -S -r main.o\n\nmain.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;_start&gt;:\n   0:   e8 00 00 00 00          call   5 &lt;_start+0x5&gt;\n                        1: R_X86_64_PLT32       print-0x4\n   5:   e8 00 00 00 00          call   a &lt;_start+0xa&gt;\n                        6: R_X86_64_PLT32       exit-0x4\n</code></pre> <p>\u8fd9\u65f6\u5019\u4f1a\u53d1\u73b0\uff0c<code>print</code> \u548c <code>exit</code> \u679c\u7136\u51fa\u73b0\u4e86\uff0c\u6240\u4ee5\u6c47\u7f16\u5668\u662f\u901a\u8fc7\u8fd9\u4e24\u6761 relocation \u544a\u8bc9\u94fe\u63a5\u5668\uff0c\u8fd9\u91cc\u5b9e\u9645\u4e0a\u8981\u8c03\u7528\u54ea\u4e2a\u51fd\u6570\u3002\u4f46\u662f\u8fd9\u91cc\u51fa\u73b0\u7684 <code>R_X86_64_PLT32</code> \u662f\u4ec0\u4e48\u610f\u601d\uff1f<code>print</code> \u548c <code>exit</code> \u540e\u9762\u7684 <code>-0x4</code> \u662f\u4ec0\u4e48\u610f\u601d\uff0c\u4e3a\u4ec0\u4e48\u8981\u51cf 4\uff1f\u5982\u679c\u8003\u8651\u5230\u524d\u9762\u6240\u8bf4\u7684\uff0c<code>call</code> \u6307\u4ee4\u5360\u7528 5 \u4e2a\u5b57\u8282\uff0c\u90a3\u4e0d\u5e94\u8be5\u662f\u51cf 5 \u624d\u5bf9\u5417\uff1f\u4e0b\u9762\u6765\u89e3\u91ca\u8fd9\u4e9b\u95ee\u9898\uff1a</p> <p>\u4ec0\u4e48\u662f <code>R_X86_64_PLT32</code> \uff1f</p> <p>\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u51fa\u73b0\u8fc7 <code>R_X86_64_32S</code> \u8fd9\u79cd relocation \u7c7b\u578b\uff0c\u5b83\u7684\u610f\u601d\u662f\u628a\u76ee\u6807\u7b26\u53f7\u7684\u5730\u5740\u4ee5 32 \u4f4d\u6709\u7b26\u53f7\u6570\u7684\u683c\u5f0f\u5199\u5230\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u7528\u7684\u662f\u7edd\u5bf9\u5730\u5740\uff0c\u4f8b\u5982 <code>0x402000</code>\u3002\u4f46\u662f\uff0c\u521a\u624d\u63d0\u5230\uff0cx86 \u7684 <code>call</code> \u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u8ba1\u7b97\u65b9\u6cd5\u662f\uff0c<code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\uff0c\u52a0\u4e0a\u5730\u5740\u504f\u79fb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u5730\u5740\u504f\u79fb\u662f\u76f8\u5bf9\u7684\uff0c\u518d\u586b\u5165\u7edd\u5bf9\u5730\u5740\u5c31\u51fa\u9519\u4e86\u3002\u5b9e\u9645\u4e0a\uff0c<code>R_X86_64_PLT32</code> \u8fd8\u6d89\u53ca\u5230\u4e00\u4e2a\u65b0\u7684\u8fd8\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u6982\u5ff5 PLT\uff08Procedure Linkage Table\uff09\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u5148\u4e0d\u6d89\u53ca PLT\uff0c\u628a\u5b83\u5f53\u6210\u5355\u7eaf\u7684\u76f8\u5bf9\u5730\u5740\u8ba1\u7b97\u53bb\u5904\u7406\u3002\u8fd9\u4e2a\u5355\u7eaf\u7684\u76f8\u5bf9\u5730\u5740\u8ba1\u7b97\u7684 relocation \u4e5f\u6709\u6b63\u5f0f\u540d\u5b57\uff0c\u4e5f\u5c31\u662f <code>R_X86_64_PC32</code>\uff0c\u610f\u601d\u662f\u6839\u636e PC\uff08Program Counter\uff09\u8ba1\u7b97\u51fa\u548c\u76ee\u7684\u5730\u5740\u7684\u76f8\u5bf9\u504f\u79fb\uff0832 \u4f4d\uff09\u3002</p> <p>\u4e3a\u4ec0\u4e48\u662f <code>print-0x4</code>\uff1f\u8fd9\u4e2a\u51cf\u53bb 0x4 \u662f\u600e\u4e48\u6765\u7684\uff1f</p> <p>\u521a\u624d\u63d0\u5230\uff0cx86 \u7684 <code>call</code> \u6307\u4ee4\u662f\u7528 <code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\u52a0\u4e0a\u5730\u5740\u504f\u79fb\uff0c\u6c42\u7684\u548c\u5c31\u662f\u8981\u8c03\u7528\u7684\u51fd\u6570\u7684\u5730\u5740\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u4e0b\u9762\u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1a</p> <p>\u4ee5\u4e0a\u9762\u7684 <code>call exit</code> \u6307\u4ee4\u4e3a\u4f8b\uff0c\u4e5f\u5c31\u662f\u53cd\u6c47\u7f16\u51fa\u6765\u7684\u7b2c\u4e8c\u6761\u6307\u4ee4\uff1a</p> <pre><code>   5:   e8 00 00 00 00          call   a &lt;_start+0xa&gt;\n                        6: R_X86_64_PLT32       exit-0x4\n</code></pre> <p>\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053 <code>print</code> \u51fd\u6570\u7684\u5730\u5740\u5c31\u662f <code>0xbbbb</code>\uff0c\u4e5f\u5047\u8bbe\u8fd9\u6761 <code>call</code> \u6307\u4ee4\u6700\u7ec8\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u4e5f\u662f <code>0x5</code>\u3002\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u586b\u5199\u8fd9\u6761 <code>call</code> \u6307\u4ee4\u7684\u5730\u5740\u504f\u79fb\u5462\uff1f</p> <p>\u5047\u8bbe\u5730\u5740\u504f\u79fb\u7b49\u4e8e <code>X</code>\uff0c\u5df2\u77e5 <code>call</code> \u6307\u4ee4\u7684\u5730\u5740\u662f 0x5\uff0c<code>call</code> \u6307\u4ee4\u5360\u7528 0x5 \u4e2a\u5b57\u8282\uff0c\u90a3\u4e48 <code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\u5c31\u662f <code>0x5 + 0x5</code>\uff0c\u6309\u7167 x86 \u7684\u89c4\u5b9a\uff0c\u8981\u8c03\u7528\u7684\u51fd\u6570\u7684\u5730\u5740\u5c31\u662f <code>0x5 + 0x5 + X</code>\u3002\u800c\u6211\u4eec\u77e5\u9053\u8981\u8c03\u7528\u7684\u51fd\u6570\u662f <code>print</code>\uff0c<code>print</code> \u51fd\u6570\u7684\u5730\u5740\u662f <code>0xbbbb</code>\uff0c\u53cd\u89e3\u51fa <code>X = 0xbbb1</code>\uff0c\u90a3\u4e48\u8981\u586b\u8fdb\u53bb\u7684\u5730\u5740\u504f\u79fb\u5c31\u662f 0xbbb1 \u8fd9\u4e2a\u6570\u3002</p> <p>\u5982\u679c\u6309\u7167\u8fd9\u4e2a\u903b\u8f91\uff0c\u8981\u8ba1\u7b97 X \u7684\u8bdd\uff0c\u5e94\u8be5\u662f <code>print - 0x5 - 0x5</code> \u624d\u5bf9\uff0c\u7b2c\u4e00\u4e2a <code>0x5</code> \u662f <code>call</code> \u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u7b2c\u4e8c\u4e2a <code>0x5</code> \u662f <code>call</code> \u6307\u4ee4\u7684\u957f\u5ea6\u3002\u4f46\u662f\u4e3a\u4ec0\u4e48\u770b\u5230\u7684\u662f <code>print - 0x4</code> \u5462\uff1f\u4e3a\u4ec0\u4e48\u53ea\u51cf\u4e86\u4e00\u4e2a\u6570\uff08<code>-0x4</code>\uff09\uff0c\u800c\u4e0d\u662f\u4e24\u4e2a\uff08<code>- 0x5 - 0x5</code>\uff09\uff1f</p> <p>\u7ec6\u5fc3\u7684\u8bfb\u8005\u53ef\u80fd\u89c2\u5bdf\u5230\uff0c\u5728 <code>R_X86_64_PLT32</code> \u7684\u524d\u9762\uff0c\u663e\u793a\u7684\u662f <code>6:</code>\uff0c\u8fd9\u8868\u793a\u7684\u662f relocation \u6807\u8bb0\u7684\u5730\u5740\u662f 0x6\uff0c\u800c\u4e0d\u662f 0x5\uff08<code>call</code> \u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff09\u3002\u8fdb\u4e00\u6b65\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0 <code>call</code> \u6307\u4ee4\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282 <code>0xe8</code> \u51b3\u5b9a\u4e86\u8fd9\u662f\u4e00\u6761 <code>call</code> \u6307\u4ee4\uff0c\u5269\u4e0b\u7684\u56db\u4e2a\u5b57\u8282\u90fd\u662f\u5730\u5740\u504f\u79fb\uff0c\u800c\u94fe\u63a5\u5668\u8981\u6539\u7684\u4e5f\u5c31\u662f\u8fd9\u4e2a\u5730\u5740\u504f\u79fb\uff1a\u65e2\u7136\u8981\u6539\u7684\u662f\u4ece 0x6 \u5f00\u59cb\u7684\u56db\u4e2a\u5b57\u8282\uff0c\u90a3 relocation \u81ea\u7136\u6307\u5411\u7684\u5c31\u662f 0x6\uff01\u6362\u53e5\u8bdd\u8bf4\uff0c\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u77e5\u9053\u8fd9\u662f\u4e00\u6761 <code>call</code> \u6307\u4ee4\uff0c\u53ea\u9700\u8981\u6309\u7167 relocation \u7684\u89c4\u5219\u8ba1\u7b97\u51fa\u503c\u586b\u8fdb\u53bb\u5c31\u597d\u4e86\u3002</p> <p>\u65e2\u7136\u8d77\u59cb\u5730\u5740\u8981\u4ece 0x6 \u5f00\u59cb\u7b97\u4e86\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u51fa\u73b0 <code>0x4</code> \u5c31\u53ef\u4ee5\u89e3\u91ca\u4e86\uff1a\u4ece relocation \u7684 0x6 \u5730\u5740\u5f00\u59cb\u7b97\uff0c\u53ea\u9700\u8981\u51cf\u53bb 4\uff08<code>call</code> \u6307\u4ee4\u5185\u5730\u5740\u504f\u79fb\u7684\u957f\u5ea6\uff09\uff0c\u800c\u4e0d\u662f\u51cf\u53bb 5\uff08<code>call</code> \u6307\u4ee4\u7684\u957f\u5ea6\uff09\u3002\u53e6\u4e00\u65b9\u9762\uff0c<code>R_X86_64_PLT32</code> \u672c\u8eab\u5c31\u544a\u8bc9\u94fe\u63a5\u5668\uff0c\u8ba9\u94fe\u63a5\u5668\u8ba1\u7b97\u7684\u65f6\u5019\uff0c\u8981\u51cf\u53bb\u5f53\u524d relocation \u7684\u8d77\u59cb\u5730\u5740\u4e86\u3002\u6309\u7167\u8fd9\u4e2a\u89c4\u5219\uff0c\u6211\u4eec\u518d\u590d\u73b0\u4e00\u904d\u521a\u624d\u7684\u4f8b\u5b50\uff1a</p> <p>\u94fe\u63a5\u5668\u89c2\u5bdf\u5230\u4e00\u4e2a <code>R_X86_64_PLT32</code> \u7684 relocation\uff0crelocation \u81ea\u8eab\u7684\u5730\u5740\u662f 0x6\uff0c\u76ee\u6807\u5730\u5740\u662f <code>print-0x4</code>\uff0c<code>print</code> \u51fd\u6570\u7684\u5730\u5740\u662f <code>0xbbbb</code>\uff0c\u90a3\u4e48\u8981\u586b\u5165\u7684\u5730\u5740\u504f\u79fb\u5c31\u7b49\u4e8e <code>0xbbbb - 0x4 - 0x6 = 0xbbb1</code>\u3002\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u7528 ABI \u6587\u6863\u4e2d\u7684\u8868\u793a\u65b9\u6cd5\uff0c\u5c31\u662f <code>S + A - P</code>\uff0cS\uff08Symbol\uff09\u8868\u793a\u7b26\u53f7\u7684\u5730\u5740\uff08<code>print</code> \u7684\u5730\u5740\uff0c<code>S=0xbbbb</code>\uff09\uff0cA\uff08Addend\uff09\u8868\u793a\u989d\u5916\u52a0\u6216\u8005\u51cf\u53bb\u7684\u6570\uff08\u8fd9\u91cc\u662f\u51cf\u53bb 0x4\uff0c\u4e5f\u5c31\u662f <code>A=-0x4</code>\uff09\uff0cP \u8868\u793a relocation \u81ea\u5df1\u7684\u5730\u5740\uff08<code>P=0x6</code>\uff09\u3002</p> <p>\u8ba1\u7b97\u7ed3\u679c\u548c\u4e4b\u524d\u6211\u4eec\u624b\u52a8\u63a8\u5bfc\u7684\u662f\u4e00\u81f4\u7684\uff0c\u770b\u8d77\u6765\u8fd9\u4e24\u4e2a\u8ba1\u7b97\u65b9\u6cd5\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u53cd\u6b63\u7ed3\u679c\u90fd\u4e00\u6837\uff1f\u533a\u522b\u5728\u4e8e\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0c\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u77e5\u9053\u6307\u4ee4\u662f\u4ec0\u4e48\uff0c\u4e0d\u7ba1\u662f\u4e0d\u662f <code>call</code> \u6307\u4ee4\uff0c\u53ea\u7ba1\u8ba1\u7b97\u548c\u586b\u6570\u3002\u90a3\u4e48\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\uff0c\u6216\u8bb8\u53ef\u4ee5\u590d\u7528\u76f8\u540c\u7684 relocation \u7c7b\u578b\u3002</p> <p>relocation \u7684\u60c5\u51b5\u5206\u6790\u5b8c\u4e86\uff0c\u6211\u4eec\u5b66\u4e60\u5230\u6c47\u7f16\u5668\u5728\u9047\u5230\u5916\u90e8\u51fd\u6570\u65f6\uff0c\u5982\u4f55\u751f\u6210\u770b\u8d77\u6765\u9519\u8bef\u7684 <code>call</code> \u6307\u4ee4\uff0c\u53c8\u662f\u5982\u4f55\u8f93\u51fa relocation \u8ba9\u94fe\u63a5\u5668\u586b\u5165\u6b63\u786e\u7684\u504f\u79fb\uff0c\u4f7f\u5f97 <code>call</code> \u6307\u4ee4\u53ef\u4ee5\u8c03\u7528\u6b63\u786e\u7684\u51fd\u6570\u3002</p> <p>\u6b64\u65f6\u518d\u770b <code>printer.o</code> \u7684\u53cd\u6c47\u7f16\u7ed3\u679c\uff1a</p> <pre><code>$ objdump -S -r printer.o\n\nprinter.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;print&gt;:\n   0:   48 c7 c7 01 00 00 00    mov    $0x1,%rdi\n   7:   48 c7 c6 00 00 00 00    mov    $0x0,%rsi\n                        a: R_X86_64_32S .rodata\n   e:   48 c7 c2 0d 00 00 00    mov    $0xd,%rdx\n  15:   48 c7 c0 01 00 00 00    mov    $0x1,%rax\n  1c:   0f 05                   syscall\n  1e:   c3                      ret\n\n000000000000001f &lt;exit&gt;:\n  1f:   48 31 ff                xor    %rdi,%rdi\n  22:   48 c7 c0 3c 00 00 00    mov    $0x3c,%rax\n  29:   0f 05                   syscall\n</code></pre> <p>\u4e0d\u51fa\u610f\u5916\uff0c\u4e24\u4e2a\u51fd\u6570\u90fd\u51fa\u73b0\u4e86\uff0c\u540c\u65f6\u4e5f\u51fa\u73b0\u4e86\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\u63d0\u5230\u7684 <code>R_X86_64_32S</code> \u7684 relocation \u7c7b\u578b\u3002\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a relocation \u7684\u5730\u5740\u662f <code>0xa</code>\uff0c\u800c\u4e0d\u662f <code>mov</code> \u6307\u4ee4\u7684\u5730\u5740 <code>0x7</code>\uff0c\u806a\u660e\u7684\u4f60\u5e94\u8be5\u5df2\u7ecf\u89c2\u5bdf\u51fa\u6765\uff1a<code>mov</code> \u6307\u4ee4\u524d\u4e09\u4e2a\u5b57\u8282\u8868\u793a\u4e86\u8fd9\u662f\u4e00\u6761 <code>mov</code> \u6307\u4ee4\uff0c\u76ee\u7684\u5bc4\u5b58\u5668\u662f <code>%rsi</code>\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u5c31\u662f\u8981 <code>mov</code> \u7684\u7acb\u5373\u6570\uff0c\u6240\u4ee5 relocation \u76f4\u63a5\u6307\u5411\u4e86\u540e\u56db\u4e2a\u5b57\u8282\u7684\u5730\u5740\u3002\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u53cd\u6c47\u7f16\uff0c\u4e0d\u9700\u8981\u77e5\u9053\u8fd9\u662f\u4e00\u6761 <code>mov</code> \u6307\u4ee4\uff0c\u53ea\u7ba1\u627e relocation \u5f80\u91cc\u586b\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","title":"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u5173\u4e8e\u4e24\u4e2a <code>.o</code> \u6587\u4ef6\u5206\u6790\u5f97\u5dee\u4e0d\u591a\u4e86\uff0c\u63a5\u4e0b\u6765\u770b\u6700\u540e\u8fd0\u884c <code>ld main.o printer.o -o helloworld</code> \u5f97\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1a</p> <pre><code>helloworld:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000401000 &lt;_start&gt;:\n  401000:       e8 05 00 00 00          call   40100a &lt;print&gt;\n  401005:       e8 1f 00 00 00          call   401029 &lt;exit&gt;\n\n000000000040100a &lt;print&gt;:\n  40100a:       48 c7 c7 01 00 00 00    mov    $0x1,%rdi\n  401011:       48 c7 c6 00 20 40 00    mov    $0x402000,%rsi\n  401018:       48 c7 c2 0d 00 00 00    mov    $0xd,%rdx\n  40101f:       48 c7 c0 01 00 00 00    mov    $0x1,%rax\n  401026:       0f 05                   syscall\n  401028:       c3                      ret\n\n0000000000401029 &lt;exit&gt;:\n  401029:       48 31 ff                xor    %rdi,%rdi\n  40102c:       48 c7 c0 3c 00 00 00    mov    $0x3c,%rax\n  401033:       0f 05                   syscall\n</code></pre> <p>\u53ef\u4ee5\u5f97\u5230\u51e0\u70b9\u89c2\u5bdf\uff1a</p> <ol> <li><code>_start</code> \u51fd\u6570\u91cc\u51fd\u6570\u8c03\u7528\u7684\u6307\u4ee4 <code>call print</code> \u548c <code>call exit</code> \u5df2\u7ecf\u88ab\u94fe\u63a5\u5668\u4fee\u590d\uff0c<code>print</code> \u51fd\u6570\u5185\u5f15\u7528 <code>hello</code> \u5b57\u7b26\u4e32\u5730\u5740\u4e5f\u6b63\u786e\u88ab\u586b\u5199</li> <li>\u6765\u81ea\u4e24\u4e2a <code>.o</code> \u6587\u4ef6\u7684\u4ee3\u7801\u6bb5 <code>.text</code> \u7684\u5185\u5bb9\u88ab\u62fc\u63a5\u8d77\u6765\uff0c\u5f97\u5230\u4e86\u8f93\u51fa\u7684 ELF \u91cc\u7684 <code>.text</code> \u6bb5\u5185\u5bb9\uff1b\u7c7b\u4f3c\u5730\uff0c<code>printer.o</code> \u91cc\u9762\u7684\u53ea\u8bfb\u6570\u636e\u6bb5 <code>.rodata</code> \u7684\u5185\u5bb9\u4e5f\u590d\u5236\u5230\u4e86\u8f93\u51fa\u7684 ELF \u4e2d\uff0c\u5730\u5740\u662f <code>0x402000</code></li> <li>\u867d\u7136 <code>objdump</code> \u53c2\u6570\u91cc\u5199\u4e86 <code>-r</code>\uff0c\u8981\u6c42 <code>objdump</code> \u663e\u793a\u4ee3\u7801\u4e2d\u7684 relocation\uff0c\u4f46\u662f\u94fe\u63a5\u5668\u5df2\u7ecf\u5b8c\u6210\u4e86\u6240\u6709 relocation \u7684\u8ba1\u7b97\u5e76\u66f4\u65b0\u4e86\u5bf9\u5e94\u7684\u6570\uff0c\u56e0\u6b64\u8f93\u51fa\u7684 ELF \u91cc\u5c31\u6ca1\u6709 relocation \u4e86\u3002\u5728\u672a\u6765\u7684\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u4f1a\u770b\u5230\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u4e5f\u53ef\u4ee5\u6709 relocation</li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<p>\u6309\u7167\u8fd9\u4e9b\u89c2\u5bdf\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\uff0c\u4e3a\u4e86\u652f\u6301\u7b2c\u4e8c\u7248\u7684\u94fe\u63a5\u5668\uff0c\u4e5f\u5c31\u662f\u652f\u6301\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u4e2a .o \u6587\u4ef6\u7684\u94fe\u63a5\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u9700\u8981\u505a\u7684\u989d\u5916\u5de5\u4f5c\uff1a</p> <p>\u5408\u5e76\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u7684\u540c\u4e00\u4e2a section</p> <p>\u4e0a\u9762\u5df2\u7ecf\u89c2\u5bdf\u5230\uff0c\u6765\u81ea\u4e0d\u540c .o \u7684 <code>.text</code> \u6bb5\u88ab\u5408\u5e76\u8d77\u6765\uff0c\u5199\u5165\u5230\u4e86\u6700\u7ec8\u8f93\u51fa\u7684 ELF \u7684 <code>.text</code> \u6bb5\u3002\u540c\u7406\uff0c\u5176\u4ed6\u9700\u8981\u8f93\u51fa\u5230\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u7684\u6bb5\uff0c\u4e5f\u9700\u8981\u5408\u5e76</p> <p>\u5b8c\u5584\u6307\u5411 section \u7684 relocation \u7684\u5904\u7406</p> <p>\u4e0a\u4e00\u7bc7\u6587\u7ae0\u91cc\uff0c\u53ea\u6d89\u53ca\u5230\u4e00\u4e2a\u8f93\u5165\u7684 ELF object \u6587\u4ef6\uff0c\u5e76\u4e14\u4e5f\u53ea\u6d89\u53ca\u5230\u5bf9 section \u7684 relocation\uff0c\u6240\u4ee5\u6bcf\u4e2a section \u53ea\u6709\u4e00\u4efd\uff0c\u53ea\u9700\u8981\u4fdd\u5b58\u6bcf\u4e2a section \u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\u3002\u4f46\u6b64\u65f6\uff0c\u6bcf\u4e2a ELF object \u6587\u4ef6\u90fd\u53ef\u80fd\u6709\u81ea\u5df1\u7684 <code>.text</code> <code>.rodata</code> section\uff0c\u6b64\u65f6\u518d\u51fa\u73b0\u5bf9 section \u7684 relocation \u65f6\uff0c\u662f\u5bf9\u8f93\u5165\u7684 ELF object \u81ea\u5df1\u7684 <code>.rodata</code>\uff0c\u800c\u4e0d\u662f\u5bf9\u8f93\u51fa ELF executable \u7684 <code>.rodata</code>\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u5982\u679c <code>main.s</code> \u548c <code>printer.s</code> \u90fd\u5f80 <code>.rodata</code> \u6bb5\u5199\u4e86\u6570\u636e\uff0c\u5047\u5982 <code>main.s</code> \u4ea7\u751f\u4e86 0x10 \u5b57\u8282\u7684\u6570\u636e\uff0c<code>printer.s</code> \u4ea7\u751f\u4e86 0x20 \u5b57\u8282\u7684\u6570\u636e\uff0c\u5047\u8bbe\u8f93\u51fa\u7684 <code>.rodata</code> \u6bb5\u4ece <code>0x402000</code> \u5730\u5740\u5f00\u59cb\uff0c\u5148\u5b58 <code>main.o</code> \u7684 <code>.rodata</code> \u7684\u5185\u5bb9\uff0c\u518d\u5b58 <code>printer.o</code> \u7684 <code>.rodata</code> \u7684\u5185\u5bb9\uff0c\u90a3\u4e48 <code>printer.o</code> \u7684 <code>.rodata</code> \u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\u5c31\u662f <code>0x402000 + 0x10 = 0x402010</code>\u3002</p> <p>\u540c\u65f6\uff0c\u5728 <code>printer.o</code> \u4e2d\uff0c<code>print</code> \u51fd\u6570\u4ea7\u751f\u4e86\u5bf9 <code>.rodata</code> \u7684 relocation\uff0c\u5b9e\u9645\u4e0a\u662f\u8981\u5f97\u5230 <code>printer.o</code> \u7684 <code>.rodata</code> \u6bb5\u4e2d\u7684 <code>Hello world</code> \u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u5730\u5740\u3002\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u8ba1\u7b97 relocation \u7684\u65f6\u5019\uff0c\u5e94\u8be5\u7528 <code>0x402010</code>\uff08<code>printer.o</code> \u7684 <code>.rodata</code> \u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\uff09\uff0c\u800c\u4e0d\u662f <code>0x402000</code>\uff08\u8f93\u51fa\u7684 <code>.rodata</code> \u7684\u8d77\u59cb\u5730\u5740\uff09 \u4f5c\u4e3a <code>Hello world</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002</p> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u73b0\u5728\u9700\u8981\u8bb0\u5f55\u6765\u81ea\u4e0d\u540c .o \u6587\u4ef6\u7684 section \u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u5728\u5b9e\u73b0\u4e0a\u4e5f\u5e76\u4e0d\u590d\u6742\uff0c\u53ea\u662f\u4e0d\u8981\u5fd8\u8bb0\u8fd9\u4ef6\u4e8b\u60c5\u3002</p> <p>\u89e3\u6790\u548c\u7ef4\u62a4\u7b26\u53f7\u8868\uff0c\u627e\u5230\u7b26\u53f7\u5bf9\u5e94\u7684\u5730\u5740</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u7b26\u53f7\u8868\uff0c\u8bb0\u5f55\u5404\u4e2a\u7b26\u53f7\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\uff0c\u90a3\u4e48\u540e\u7eed\u8ba1\u7b97 relocation \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u5730\u5740\u4f1a\u53c2\u4e0e\u5230\u8ba1\u7b97\u5f53\u4e2d\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c<code>main.s</code> \u548c <code>printer.s</code> \u90fd\u5f80 <code>.text</code> \u6bb5\u5199\u4e86\u6307\u4ee4\u3002<code>main.s</code> \u4ea7\u751f\u4e86 0xa \u5b57\u8282\u7684\u6307\u4ee4\uff0c<code>printer.s</code> \u4ea7\u751f\u4e86 0x2b \u5b57\u8282\u7684\u6307\u4ee4\u3002\u8f93\u51fa\u65f6\uff0c\u5047\u5982 <code>.text</code> \u6bb5\u4ece <code>0x401000</code> \u5f00\u59cb\uff0c\u6309\u7167\u4e0b\u9762\u7684\u903b\u8f91\u8ba1\u7b97\u5404\u4e2a\u7b26\u53f7\u7684\u5730\u5740\uff1a</p> <ol> <li>\u5148\u590d\u5236 <code>main.o</code> \u7684 <code>.text</code> \u4ee3\u7801\u6bb5\u7684\u5185\u5bb9\u5230\u8f93\u51fa\u7684 <code>.text</code> \u6bb5\uff0c\u6b64\u65f6\u8fd9\u90e8\u5206\u6307\u4ee4\u7684\u7684\u8d77\u59cb\u5185\u5b58\u5730\u5740\u5c31\u662f <code>0x401000</code></li> <li>\u7531\u4e8e <code>_start</code> \u51fd\u6570\u5728 <code>main.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x0</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x401000 + 0x0 = 0x401000</code></li> <li>\u63a5\u7740\u590d\u5236 <code>printer.o</code> \u7684 <code>.text</code> \u4ee3\u7801\u6bb5\u7684\u5185\u5bb9\u5230\u8f93\u51fa\u7684 <code>.text</code> \u6bb5\uff0c\u7531\u4e8e\u524d\u9762\u5df2\u7ecf\u6709 0xa \u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u6307\u4ee4\u7684\u8d77\u59cb\u5185\u5b58\u5730\u5740\u5c31\u662f <code>0x40100a</code></li> <li><code>print</code> \u51fd\u6570\u5728 <code>printer.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x0</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x40100a + 0x0 = 0x40100a</code></li> <li><code>exit</code> \u51fd\u6570\u5728 <code>printer.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x1f</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x40100a + 0x1f = 0x401029</code></li> </ol> <p>\u6240\u4ee5\u5728\u590d\u5236\u6bb5\u5185\u5bb9\u7684\u540c\u65f6\uff0c\u5404\u4e2a\u7b26\u53f7\u7684\u5730\u5740\u4e5f\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6765\u4e86\u3002\u6709\u4e86\u7b26\u53f7\u8868\u4ee5\u540e\uff0c\u4e4b\u540e\u8ba1\u7b97\u9488\u5bf9 <code>print</code> \u548c <code>exit</code> \u7684 relocation \u7684\u65f6\u5019\uff0c\u67e5\u7b26\u53f7\u8868\u5c31\u53ef\u4ee5\u77e5\u9053\u5730\u5740\u4e86\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/03/30/write-a-linker-2/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u7ed3\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0a\u4e00\u6b21\u535a\u5ba2\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7b2c\u4e8c\u7248\u7684\u94fe\u63a5\u5668\uff0c\u8fd9\u4e2a\u94fe\u63a5\u5668\u53ef\u4ee5\u652f\u6301\u8f93\u5165\u591a\u4e2a ELF .o \u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 400 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 200 \u884c\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/","title":"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e24\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8fdb\u4e00\u6b65\u652f\u6301\u52a8\u6001\u5e93\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u52a8\u6001\u5e93\u3002</p> <p>\u6ce8\u610f\uff0c\u672c\u7bc7\u535a\u5ba2\u53ea\u8ba8\u8bba\u5982\u4f55\u751f\u6210 ELF \u52a8\u6001\u5e93\uff0c\u5e76\u4e0d\u6d89\u53ca\u5982\u4f55\u94fe\u63a5 ELF \u52a8\u6001\u5e93\uff0c\u8fd9\u5c06\u4f1a\u4f5c\u4e3a\u540e\u7eed\u6587\u7ae0\u7684\u5185\u5bb9\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u56de\u987e","title":"\u56de\u987e","text":"<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e24\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p> <ol> <li>\u89e3\u6790\u8f93\u5165\u7684\u82e5\u5e72\u4e2a ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u5408\u5e76\u6765\u81ea\u4e0d\u540c ELF \u7684\u540c\u540d section</li> <li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li> <li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff0c\u8fdb\u800c\u66f4\u65b0\u7b26\u53f7\u8868\uff0c\u5f97\u5230\u6bcf\u4e2a\u7b26\u53f7\u5728\u8fd0\u884c\u65f6\u4f1a\u5904\u5728\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li> <li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li> </ol> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5b9e\u73b0\u751f\u6210\u52a8\u6001\u5e93\u6587\u4ef6\uff0c\u8ba9\u6211\u4eec\u9996\u5148\u5206\u6790\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7684\u4e0d\u540c\u5728\u54ea\u91cc\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u5206\u6790","title":"\u5206\u6790","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u52a8\u6001\u94fe\u63a5","title":"\u52a8\u6001\u94fe\u63a5","text":"<p>\u672c\u7cfb\u5217\u7684\u524d\u9762\u4e24\u7bc7\u6587\u7ae0\u535a\u5ba2\u5b9e\u73b0\u7684\u90fd\u662f\u9759\u6001\u94fe\u63a5\uff1a\u7531\u9759\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u6240\u6709\u7684\u4e8b\u60c5\uff0c\u5f97\u5230\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u5c31\u53ef\u4ee5\u8dd1\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u64cd\u4f5c\u3002\u4f46\u662f\u9759\u6001\u94fe\u63a5\u4e5f\u6709\u4e00\u4e9b\u7f3a\u70b9\uff1a</p> <ol> <li>\u4e8c\u8fdb\u5236\u4f53\u79ef\u5927\uff0c\u540c\u6837\u7684\u4ee3\u7801\u51fa\u73b0\u5728\u5f88\u591a\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\uff0c\u540c\u65f6\u56e0\u4e3a\u8fd9\u4e9b\u4ee3\u7801\u7ecf\u8fc7\u4e86\u91cd\u5b9a\u4f4d\uff0c\u5185\u5bb9\u6709\u4e9b\u8bb8\u5dee\u522b\uff0c\u65e0\u6cd5\u590d\u7528\uff0c\u6d6a\u8d39\u786c\u76d8\u548c\u5185\u5b58\u7a7a\u95f4</li> <li>\u5982\u679c\u67d0\u4e2a\u5e95\u5c42\u5e93\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u7531\u4e8e\u8fd9\u4e2a\u5e93\u53ef\u80fd\u9759\u6001\u94fe\u63a5\u5230\u4e86\u5f88\u591a\u4e0d\u540c\u7684\u7a0b\u5e8f\u91cc\uff0c\u4e3a\u4e86\u53bb\u9664\u6709\u95ee\u9898\u7684\u4ee3\u7801\uff0c\u9700\u8981\u628a\u6240\u6709\u7528\u5230\u8fd9\u4e2a\u5e93\u7684\u7a0b\u5e8f\u90fd\u91cd\u65b0\u7f16\u8bd1\u4e00\u904d\uff0c\u624d\u80fd\u4fdd\u8bc1\u5b89\u5168\u7684\u4ee3\u7801\u88ab\u94fe\u63a5\u8fdb\u53bb</li> </ol> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u5e38\u7528\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u52a8\u6001\u94fe\u63a5\uff1a\u9759\u6001\u94fe\u63a5\u5668\u53ea\u5b8c\u6210\u4e00\u90e8\u5206\u7684\u94fe\u63a5\uff0c\u5269\u4e0b\u7684\u4e00\u90e8\u5206\u5de5\u4f5c\uff0c\u8981\u7b49\u5230\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\u5b8c\u6210\uff0c\u90a3\u4e48\u7a0b\u5e8f\u5728\u542f\u52a8\u65f6\u7531\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u7684\u94fe\u63a5\uff0c\u5c31\u662f\u52a8\u6001\u94fe\u63a5\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u6bb5 C \u4ee3\u7801\u8c03\u7528\u4e86\u6807\u51c6\u5e93\u91cc\u7684 C \u51fd\u6570\uff0c\u8981\u4e48\u7528\u9759\u6001\u94fe\u63a5\uff0c\u628a\u6574\u4e2a\u6807\u51c6\u5e93\u8fde\u63a5\u5230\u53ef\u6267\u884c\u6587\u4ef6\u91cc\uff1b\u8981\u4e48\u5c31\u7528\u52a8\u6001\u94fe\u63a5\uff0c\u5728\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u4fdd\u7559\u4e0e\u51fd\u6570\u8c03\u7528\u76f8\u5173\u7684\u91cd\u5b9a\u4f4d\uff0c\u5728\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u518d\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u6700\u540e\u7684\u94fe\u63a5\u8fc7\u7a0b\u3002\u52a8\u6001\u94fe\u63a5\u89e3\u51b3\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u7531\u4e8e\u52a8\u6001\u94fe\u63a5\u7b49\u5230\u6700\u540e\u7a0b\u5e8f\u542f\u52a8\u65f6\u624d\u8fdb\u884c\uff0c\u6240\u4ee5\u53ef\u6267\u884c\u6587\u4ef6\u672c\u8eab\u7684\u4f53\u79ef\u5c31\u53ef\u4ee5\u505a\u5230\u5f88\u5c0f\uff0c\u4e0d\u518d\u9700\u8981\u9759\u6001\u94fe\u63a5\u4e00\u4e2a\u53ef\u80fd\u5de8\u5927\u7684\u9759\u6001\u5e93</li> <li>\u52a8\u6001\u94fe\u63a5\u662f\u6bcf\u6b21\u7a0b\u5e8f\u542f\u52a8\u65f6\u8fdb\u884c\uff0c\u6240\u4ee5\u5982\u679c\u52a8\u6001\u5e93\u6587\u4ef6\u66ff\u6362\u4e86\uff0c\u90a3\u4e48\u7a0b\u5e8f\u672a\u6765\u518d\u6b21\u542f\u52a8\u65f6\uff0c\u81ea\u7136\u5c31\u4f1a\u7528\u5230\u65b0\u7684\u52a8\u6001\u5e93\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u7a0b\u5e8f</li> </ol> <p>\u5f53\u7136\u4e86\uff0c\u52a8\u6001\u94fe\u63a5\u4e5f\u5e26\u6765\u4e86\u65b0\u7684\u8981\u6c42\u548c\u6311\u6218\uff1a</p> <ol> <li>\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u91cc\u53ea\u4f1a\u52a0\u8f7d\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6240\u4ee5\u6240\u6709\u5730\u5740\u90fd\u53ef\u4ee5\u9884\u5148\u7b97\u597d\uff0c\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u51b2\u7a81\uff1b\u800c\u52a8\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u540c\u4e00\u4e2a\u52a8\u6001\u5e93\u6ca1\u529e\u6cd5\u4fdd\u8bc1\u603b\u662f\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u5730\u5740\u4e0a\uff1a\u5982\u679c\u6bcf\u4e2a\u52a8\u6001\u5e93\u90fd\u5199\u6b7b\u4e86\u81ea\u5df1\u8981\u52a0\u8f7d\u5230\u7684\u5730\u5740\uff0c\u90a3\u4e48\u4e0d\u540c\u7684\u52a8\u6001\u5e93\u9009\u4e86\u540c\u6837\u7684\u5730\u5740\uff0c\u662f\u5426\u5c31\u610f\u5473\u7740\u4e0d\u80fd\u540c\u65f6\u7528\u8fd9\u4e24\u4e2a\u52a8\u6001\u5e93\u4e86\uff1f\u56e0\u6b64\u52a8\u6001\u5e93\u8981\u652f\u6301\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5730\u5740\u4e0a\uff0c\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u6807\uff0c\u5c31\u9700\u8981\u5728\u7f16\u8bd1\u52a8\u6001\u5e93\u7684\u65f6\u5019\uff0c\u4ee5 PIC\uff08Position Independent Code\uff0c\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff09\u7684\u65b9\u5f0f\u7f16\u8bd1\uff0c\u4f7f\u5f97\u65e0\u8bba\u52a8\u6001\u5e93\u52a0\u8f7d\u5230\u54ea\u91cc\uff0c\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u4e0b\u9762\u4f1a\u7ed9\u51fa\u4e00\u4e2a\u4f8b\u5b50</li> <li>\u7531\u4e8e\u7a0b\u5e8f\u6bcf\u6b21\u542f\u52a8\u90fd\u9700\u8981\u52a8\u6001\u94fe\u63a5\uff0c\u90a3\u4e48\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u5c31\u8981\u5c3d\u91cf\u597d\uff1b\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\uff0c\u540e\u9762\u4f1a\u770b\u5230\u9759\u6001\u94fe\u63a5\u5668\u548c\u52a8\u6001\u94fe\u63a5\u5668\u662f\u5982\u4f55\u914d\u5408\u7740\u63d0\u9ad8\u6027\u80fd\u7684</li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u751f\u6210\u52a8\u6001\u5e93","title":"\u751f\u6210\u52a8\u6001\u5e93","text":"<p>\u56de\u987e\u4e00\u4e0b\uff0c\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u628a\u4ee3\u7801\u5206\u6210\u4e86\u4e24\u90e8\u5206\uff1a<code>main.s</code> \u548c <code>printer.s</code>\uff0c\u524d\u8005\u8c03\u7528\u540e\u8005\u5b9e\u73b0\u7684 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\uff1a</p> <pre><code># https://gist.github.com/adrianratnapala/1321776\n# printer.s\n    .section .rodata\nhello:\n    .string \"Hello world!\\n\"\n\n\n    .section .text\n    .globl print\nprint:\n    # write(1, hello, 13)\n    mov     $1, %rdi\n    mov     $hello, %rsi\n    mov     $13, %rdx\n    mov     $1, %rax\n    syscall\n    ret\n\n    .globl exit\nexit:\n    # _exit(0)\n    xor     %rdi, %rdi\n    mov     $60, %rax\n    syscall\n</code></pre> <pre><code># main.s\n    .section .text\n    .globl _start\n_start:\n    call print\n    call exit\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u5c31\u60f3\u628a <code>printer.s</code> \u7f16\u8bd1\u6210\u4e00\u4e2a\u52a8\u6001\u5e93 <code>libprinter.so</code>\uff0c\u7136\u540e <code>main.s</code> \u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u52a8\u6001\u94fe\u63a5\u5230 <code>libprinter.so</code>\u3002\u4e3a\u4e86\u751f\u6210\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u9700\u8981\u4e3a <code>ld</code> \u6dfb\u52a0 <code>-shared</code> \u547d\u4ee4\u884c\u53c2\u6570\uff1a</p> <pre><code>$ as main.s -o main.o\n$ as printer.s -o printer.o\n# ld -shared: generate shared library\n$ ld -shared printer.o -o libprinter.so\nld: printer.o: relocation R_X86_64_32S against `.rodata' can not be used when making a shared object; recompile with -fPIC\nld: failed to set dynamic section sizes: bad value\n</code></pre> <p>\u548c\u5f80\u5e38\u4e00\u6837\uff0c\u6211\u4eec\u5206\u522b\u4e3a <code>main.s</code> \u548c <code>printer.s</code> \u8c03\u7528\u6c47\u7f16\u5668 <code>as</code>\uff0c\u4f46\u8fd9\u6b21\uff0c\u5355\u72ec\u7528 <code>printer.o</code> \u94fe\u63a5\u51fa\u52a8\u6001\u5e93 <code>libprinter.so</code>\uff0c\u4e0d\u5e78\u7684\u662f\uff0c\u5b83\u62a5\u9519\u4e86\uff0c\u544a\u8bc9\u6211\u4eec\u751f\u6210\u52a8\u6001\u5e93\u7684\u65f6\u5019\uff0c\u4e0d\u5141\u8bb8\u51fa\u73b0 <code>R_X86_64_32S</code> \u7684 relocation \u7c7b\u578b\uff1a<code>ld: printer.o: relocation R_X86_64_32S against ``.rodata' can not be used when making a shared object</code>\u3002\u56de\u5fc6\u7b2c\u4e00\u7bc7\u535a\u5ba2\uff0c<code>R_X86_64_32S</code> \u7684\u610f\u601d\u662f\u628a\u76ee\u7684\u7b26\u53f7\u7684\u7edd\u5bf9\u5730\u5740\u4ee5 32 \u4f4d\u6709\u7b26\u53f7\u6570\u7684\u5f62\u5f0f\u586b\u5199\uff0c\u4f46\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u52a8\u6001\u5e93\u662f\u65e0\u6cd5\u63d0\u524d\u77e5\u9053\u81ea\u5df1\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\u7684\uff0c\u94fe\u63a5\u5668\u6ca1\u529e\u6cd5\u63d0\u524d\u77e5\u9053\u76ee\u7684\u7b26\u53f7\u7684\u7edd\u5bf9\u5730\u5740\u3002\u8fd9\u8bf4\u660e\u6211\u4eec\u9700\u8981\u628a <code>printer.s</code> \u6539\u5199\u6210\u53ea\u7528\u76f8\u5bf9\u5730\u5740\uff0c\u4e0d\u7528\u7edd\u5bf9\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u6210\u4e3a\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08PIC\uff09\u4e86\u3002\u94fe\u63a5\u5668\u8fd8\u8d34\u5fc3\u5730\u544a\u8bc9\u6211\u4eec\uff0c\u53ef\u4ee5\u7ed9\u7f16\u8bd1\u5668\u4f20 <code>-fPIC</code> \u53c2\u6570\u6765\u8ba9\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1 C \u4ee3\u7801\u7684\u65f6\u5019\u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08PIC\uff09\u3002\u4e0d\u8fc7\u6211\u4eec\u6b63\u5728\u624b\u5199\u6c47\u7f16\uff0c\u90a3\u5c31\u5fc5\u987b\u624b\u52a8\u6539\u5199\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\u4e86\uff0c\u600e\u4e48\u6539\u5462\uff1f</p> <p>\u65e2\u7136\u4e0d\u5141\u8bb8\u51fa\u73b0\u7684\u662f <code>R_X86_64_32S</code>\uff0c\u6211\u4eec\u8981\u627e\u5230\u4ea7\u751f\u8fd9\u4e2a relocation \u7684\u6c47\u7f16\u4ee3\u7801\uff1a</p> <pre><code>    mov     $hello, %rsi\n</code></pre> <p>\u5b83\u7684\u76ee\u7684\u662f\u628a <code>hello</code> \u7684\u5730\u5740\u5199\u5230 <code>%rsi</code> \u5bc4\u5b58\u5668\u4e2d\uff0c\u4f46\u662f\u8fd9\u4e2a\u5199\u6cd5\u4f1a\u8981\u6c42\u94fe\u63a5\u5668\u4ee5\u7acb\u5373\u6570\u7684\u5f62\u5f0f\u628a\u7edd\u5bf9\u5730\u5740\u5199\u8fdb\u53bb\u3002\u800c\u6211\u4eec\u60f3\u8981\u7684\u662f\u5730\u5740\u65e0\u5173\u4ee3\u7801\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7528\u5230\u76f8\u5bf9\u5730\u5740\u3002\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u5728\u4ec0\u4e48\u5730\u65b9\u51fa\u73b0\u4e86\u76f8\u5bf9\u5730\u5740\uff1f\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c<code>main.s</code> \u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u65f6\u7528\u5230\u4e86 <code>R_X86_64_PC32</code>\uff0c\u5b83\u7684\u7acb\u5373\u6570\u8bb0\u5f55\u7684\u662f\u76f8\u5bf9\u5730\u5740\u504f\u79fb\u3002\u5982\u679c\u5728\u8fd9\u91cc\uff0c\u4e5f\u8ba9\u94fe\u63a5\u5668\u751f\u6210\u4e00\u4e2a\u76f8\u5bf9\u7684 relocation\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5730\u5740\u65e0\u5173\u4e86\uff0c\u8fd9\u6761\u6307\u4ee4\u662f\uff1a</p> <pre><code>    lea     hello(%rip), %rsi\n</code></pre> <p><code>lea</code> \u662f x86 \u7684 LEA\uff08Load Effective Address\uff09\u6307\u4ee4\uff0c\u5b83\u7684\u529f\u80fd\u662f\u8ba1\u7b97 <code>%rip</code> \u52a0\u7acb\u5373\u6570\u7684\u503c\uff0c\u5199\u5165\u5230 <code>%rsi</code> \u7684\u503c\uff0c\u800c\u8fd9\u4e2a\u7acb\u5373\u6570\u5c31\u662f <code>hello</code> \u76f8\u5bf9\u4e8e <code>%rip</code> \u7684\u76f8\u5bf9\u5730\u5740\u504f\u79fb\u3002\u5f88\u9057\u61be\uff0c\u6c47\u7f16\u5668\u6ca1\u529e\u6cd5\u5e2e\u6211\u4eec\u505a\u8fd9\u4e2a\u6539\u5199\uff0c\u5fc5\u987b\u5728\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5c31\u60f3\u7740\u8981\u5199\u5730\u5740\u65e0\u5173\u4ee3\u7801\u3002\u6539\u5199\u540e\u7684 <code>printer.s</code> \u5982\u4e0b\uff1a</p> <pre><code># https://gist.github.com/adrianratnapala/1321776\n# printer.s\n    .section .rodata\nhello:\n    .string \"Hello world!\\n\"\n\n\n    .section .text\n    .globl print\nprint:\n    # write(1, hello, 13)\n    mov     $1, %rdi\n    # this instruction requires absolute addressing\n    # mov     $hello, %rsi\n    # this one is position independent\n    lea     hello(%rip), %rsi\n    mov     $13, %rdx\n    mov     $1, %rax\n    syscall\n    ret\n\n    .globl exit\nexit:\n    # _exit(0)\n    xor     %rdi, %rdi\n    mov     $60, %rax\n    syscall\n</code></pre> <p>\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5b83\u786e\u5b9e\u4ea7\u751f\u4e86\u4e00\u4e2a\u76f8\u5bf9\u7684 relocation <code>R_X86_64_PC32</code>\uff1a</p> <pre><code>$ as printer.s -o printer.o\n$ objdump -S -r printer.o\n\nprinter.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;print&gt;:\n   0:   48 c7 c7 01 00 00 00    mov    $0x1,%rdi\n   7:   48 8d 35 00 00 00 00    lea    0x0(%rip),%rsi        # e &lt;print+0xe&gt;\n                        a: R_X86_64_PC32        .rodata-0x4\n   e:   48 c7 c2 0d 00 00 00    mov    $0xd,%rdx\n  15:   48 c7 c0 01 00 00 00    mov    $0x1,%rax\n  1c:   0f 05                   syscall\n  1e:   c3                      ret\n\n000000000000001f &lt;exit&gt;:\n  1f:   48 31 ff                xor    %rdi,%rdi\n  22:   48 c7 c0 3c 00 00 00    mov    $0x3c,%rax\n  29:   0f 05                   syscall\n</code></pre> <p>\u867d\u7136\u7edd\u5bf9\u5730\u5740\u65e0\u6cd5\u786e\u5b9a\uff0c\u4f46\u9759\u6001\u94fe\u63a5\u5668\u4f9d\u7136\u53ef\u4ee5\u8ba1\u7b97\u51fa\u76f8\u5bf9\u5730\u5740\u504f\u79fb\uff0c\u5b8c\u6210 relocation \u7684\u8ba1\u7b97\u3002\u91cd\u65b0\u94fe\u63a5\uff0c\u53d1\u73b0\u5b83\u786e\u5b9e\u6210\u529f\u751f\u6210\u4e86\u52a8\u6001\u5e93\uff0c\u4e0d\u518d\u62a5\u9519\uff1a</p> <pre><code>$ ld -shared printer.o -o libprinter.so\n</code></pre>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u89c2\u5bdf\u52a8\u6001\u5e93","title":"\u89c2\u5bdf\u52a8\u6001\u5e93","text":"<p>\u63a5\u4e0b\u6765\u5c31\u6765\u770b\u770b\u65b0\u751f\u6210\u7684 <code>libprinter.so</code> \u548c\u4e4b\u524d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u9996\u5148\u662f <code>ELF Header</code> \u90e8\u5206\uff1a</p> <pre><code>$ readelf -a libprinter.so\nELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 \n  Class:                             ELF64\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              DYN (Shared object file)\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x0\n  Start of program headers:          64 (bytes into file)\n  Start of section headers:          12584 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           56 (bytes)\n  Number of program headers:         6\n  Size of section headers:           64 (bytes)\n  Number of section headers:         12\n  Section header string table index: 11\n</code></pre> <p>\u548c\u53ef\u6267\u884c\u6587\u4ef6\u7684\u533a\u522b\u5728\u4e8e\uff0c<code>Type</code> \u662f <code>DYN (Shared object file)</code>\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u52a8\u6001\u5e93\u6587\u4ef6\uff1b<code>Entry point address</code> \u7b49\u4e8e\u96f6\uff0c\u56e0\u4e3a\u52a8\u6001\u5e93\u6ca1\u6709\u5165\u53e3\uff0c\u5165\u53e3\u5730\u5740\u8fd8\u662f\u7531\u53ef\u6267\u884c\u7a0b\u5e8f\u63d0\u4f9b\u3002</p> <p>\u63a5\u4e0b\u6765\u662f Section \u90e8\u5206\uff1a</p> <pre><code>Section Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .hash             HASH             0000000000000190  00000190\n       0000000000000018  0000000000000004   A       3     0     8\n  [ 2] .gnu.hash         GNU_HASH         00000000000001a8  000001a8\n       0000000000000028  0000000000000000   A       3     0     8\n  [ 3] .dynsym           DYNSYM           00000000000001d0  000001d0\n       0000000000000048  0000000000000018   A       4     1     8\n  [ 4] .dynstr           STRTAB           0000000000000218  00000218\n       000000000000000c  0000000000000000   A       0     0     1\n  [ 5] .text             PROGBITS         0000000000001000  00001000\n       000000000000002b  0000000000000000  AX       0     0     1\n  [ 6] .rodata           PROGBITS         0000000000002000  00002000\n       000000000000000e  0000000000000000   A       0     0     1\n  [ 7] .eh_frame         PROGBITS         0000000000002010  00002010\n       0000000000000000  0000000000000000   A       0     0     8\n  [ 8] .dynamic          DYNAMIC          0000000000003f40  00002f40\n       00000000000000c0  0000000000000010  WA       4     0     8\n  [ 9] .symtab           SYMTAB           0000000000000000  00003000\n       00000000000000a8  0000000000000018          10     5     8\n  [10] .strtab           STRTAB           0000000000000000  000030a8\n       0000000000000025  0000000000000000           0     0     1\n  [11] .shstrtab         STRTAB           0000000000000000  000030cd\n       0000000000000056  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  D (mbind), l (large), p (processor specific)\n\nThere are no section groups in this file.\n</code></pre> <p>\u53ef\u4ee5\u89c2\u5bdf\u5230\u591a\u4e86\u51e0\u4e2a\u6ca1\u6709\u89c1\u5230\u8fc7\u7684 section\uff0c\u8fd9\u91cc\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u540e\u9762\u4f1a\u8be6\u7ec6\u89e3\u91ca\uff1a</p> <ol> <li><code>.hash</code> \u548c <code>.gnu.hash</code>\uff1a\u4ece\u540d\u5b57\u53ef\u4ee5\u731c\u51fa\u6765\uff0c\u8fd9\u662f\u67d0\u79cd\u54c8\u5e0c\u8868\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u63d0\u4f9b\u4e00\u4e2a\u7b26\u53f7\u540d\u5b57\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff0c\u63d0\u9ad8\u52a8\u6001\u94fe\u63a5\u5668\u67e5\u627e\u7b26\u53f7\u7684\u6027\u80fd</li> <li><code>.dynsym</code>\uff1aDynamic Symbol\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u52a8\u6001\u7b26\u53f7\u8868</li> <li><code>.dynstr</code>\uff1aDynamic String\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u5b57\u7b26\u4e32\u7684\u8868</li> <li><code>.dynamic</code>\uff1aDynamic\uff0c\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fe1\u606f</li> </ol> <p>\u6b64\u5916\uff0c\u8fd9\u4e9b\u6bb5\u7684\u5730\u5740\u90fd\u4ece 0 \u5f00\u59cb\uff0c\u800c\u4e0d\u662f\u53ef\u6267\u884c\u6587\u4ef6\u90a3\u6837\uff0c\u4ece 0x400000 \u5f00\u59cb\uff0c\u6bd5\u7adf\u52a8\u6001\u5e93\u662f\u53ef\u80fd\u88ab\u52a0\u8f7d\u5230\u4e0d\u540c\u5730\u5740\u4e0a\u7684\uff0c\u662f\u6ca1\u529e\u6cd5\u63d0\u524d\u786e\u5b9a\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u662f Program Header \u90e8\u5206\uff1a</p> <pre><code>Program Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000224 0x0000000000000224  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000001000 0x0000000000001000\n                 0x000000000000002b 0x000000000000002b  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000002000 0x0000000000002000\n                 0x0000000000000010 0x0000000000000010  R      0x1000\n  LOAD           0x0000000000002f40 0x0000000000003f40 0x0000000000003f40\n                 0x00000000000000c0 0x00000000000000c0  RW     0x1000\n  DYNAMIC        0x0000000000002f40 0x0000000000003f40 0x0000000000003f40\n                 0x00000000000000c0 0x00000000000000c0  RW     0x8\n  GNU_RELRO      0x0000000000002f40 0x0000000000003f40 0x0000000000003f40\n                 0x00000000000000c0 0x00000000000000c0  R      0x1\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .hash .gnu.hash .dynsym .dynstr \n   01     .text \n   02     .rodata \n   03     .dynamic \n   04     .dynamic \n   05     .dynamic \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86\u5df2\u6709\u7684 <code>LOAD</code> \u4ee5\u5916\uff0c\u8fd8\u51fa\u73b0\u4e86\u65b0\u7684\u9879\u76ee\uff1a</p> <ol> <li><code>DYNAMIC</code>\uff1a\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c<code>.dynamic</code> section \u5728\u54ea\u4e2a\u5730\u65b9</li> <li><code>GNU_RELRO</code>\uff1a\u8fd9\u662f GNU \u94fe\u63a5\u5668\u5b89\u5168\u6027\u6269\u5c55\uff0c\u610f\u601d\u662f\u5728\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u91cd\u5b9a\u4f4d\u540e\uff0c\u54ea\u4e9b\u5185\u5b58\u533a\u57df\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff0c\u9632\u6b62\u7a0b\u5e8f\u7be1\u6539</li> </ol> <p>\u7d27\u63a5\u7740\u5c31\u662f <code>.dynamic</code> section \u7684\u5185\u5bb9\uff1a</p> <pre><code>Dynamic section at offset 0x2f40 contains 7 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000004 (HASH)               0x190\n 0x000000006ffffef5 (GNU_HASH)           0x1a8\n 0x0000000000000005 (STRTAB)             0x218\n 0x0000000000000006 (SYMTAB)             0x1d0\n 0x000000000000000a (STRSZ)              12 (bytes)\n 0x000000000000000b (SYMENT)             24 (bytes)\n 0x0000000000000000 (NULL)               0x0\n</code></pre> <p>\u8868\u793a\u8fd9\u4e2a\u52a8\u6001\u5e93\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4f1a\u5728\u52a8\u6001\u94fe\u63a5\u4e2d\u7528\u5230\u7684\u4fe1\u606f\uff1a</p> <ol> <li><code>HASH</code>\uff1a<code>.hash</code> section \u7684\u5730\u5740</li> <li><code>GNU_HASH</code>\uff1a<code>.gnu.hash</code> section \u7684\u5730\u5740</li> <li><code>STRTAB</code>: <code>.dynstr</code> section \u7684\u5730\u5740</li> <li><code>SYMTAB</code>: <code>.dynsym</code> section \u7684\u5730\u5740</li> <li><code>STRSZ</code>: <code>.dynstr</code> section \u7684\u5927\u5c0f</li> <li><code>SYMENT</code>: <code>.dynsym</code> \u6bcf\u4e00\u9879\u7684\u5927\u5c0f</li> <li><code>NULL</code>: \u8868\u793a\u540e\u9762\u6ca1\u6709\u66f4\u591a\u5185\u5bb9\u4e86</li> </ol> <p>\u4f60\u53ef\u80fd\u4f1a\u5947\u602a\uff0c\u8fd9\u91cc\u9762\u7684\u5730\u5740\u548c\u5927\u5c0f\u4fe1\u606f\uff0c\u5176\u5b9e\u90fd\u53ef\u4ee5\u4ece Section Headers \u91cc\u627e\u5230\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u591a\u6b64\u4e00\u4e3e\uff0c\u653e\u5230\u8fd9\u91cc\u5462\uff1f\u9996\u5148\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5b58\u7684\u4e1c\u897f\u8fd8\u6709\u5f88\u591a\uff0c\u4e0d\u6b62\u662f\u8fd9\u4e9b\uff0c\u540e\u7eed\u4f1a\u770b\u5230\u66f4\u591a\u7684\u4f8b\u5b50\uff08\u4f8b\u5982 <code>DT_NEEDED</code>\uff0c<code>DT_SONAME</code>\uff0c<code>DT_RPATH</code> \u7b49\u7b49\uff09\uff1b\u5176\u6b21\uff0c\u524d\u6587\u63d0\u5230\uff0c\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u8981\u6c42\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u4e3a\u4e86\u51cf\u5c11\u5b83\u89e3\u6790 ELF \u7684\u8d1f\u62c5\uff0c\u63d0\u524d\u628a\u8981\u7528\u7684\u6570\u636e\u51c6\u5907\u597d\u3002</p> <p>\u4e0b\u9762\u662f relocation \u7684\u90e8\u5206\uff0c\u4e0d\u51fa\u610f\u6599\uff0c\u6ca1\u6709 relocation\uff0c\u56e0\u4e3a\u9759\u6001\u94fe\u63a5\u5668\u5df2\u7ecf\u628a <code>printer.s</code> \u91cc\u6d89\u53ca\u5230\u7684 relocation \u90fd\u8ba1\u7b97\u5b8c\u6210\u4e86\u3002</p> <pre><code>There are no relocations in this file.\nNo processor specific unwind information to decode\n</code></pre> <p>\u63a5\u4e0b\u6765\u662f\u7b26\u53f7\u8868\uff0c\u6709\u4e24\u4efd\uff0c<code>.dynsym</code> \u662f\u52a8\u6001\u7b26\u53f7\u8868\uff0c<code>.symtab</code> \u662f\u539f\u6765\u9759\u6001\u94fe\u63a5\u4f7f\u7528\u7684\u7b26\u53f7\u8868\uff1a</p> <pre><code>Symbol table '.dynsym' contains 3 entries:\n   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND \n     1: 0000000000001000     0 NOTYPE  GLOBAL DEFAULT    5 print\n     2: 000000000000101f     0 NOTYPE  GLOBAL DEFAULT    5 exit\n\nSymbol table '.symtab' contains 7 entries:\n   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND \n     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS printer.o\n     2: 0000000000002000     0 NOTYPE  LOCAL  DEFAULT    6 hello\n     3: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS \n     4: 0000000000003f40     0 OBJECT  LOCAL  DEFAULT    8 _DYNAMIC\n     5: 0000000000001000     0 NOTYPE  GLOBAL DEFAULT    5 print\n     6: 000000000000101f     0 NOTYPE  GLOBAL DEFAULT    5 exit\n</code></pre> <p>\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c<code>.dynsym</code> \u53ea\u4fdd\u7559\u4e86\u90a3\u4e9b\u5916\u90e8\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u7b26\u53f7\uff08<code>Bind=GLOBAL</code>\uff09\uff0c\u4e5f\u5c31\u662f <code>print</code> \u548c <code>exit</code>\uff0c\u800c\u5185\u90e8\u81ea\u5df1\u7528\u7684 <code>hello</code> \u6ca1\u6709\u653e\u5728\u91cc\u9762\uff0c\u53ea\u4fdd\u7559\u53ef\u80fd\u8981\u7528\u5230\u7684\u4e1c\u897f\uff0c\u7ed9\u52a8\u6001\u94fe\u63a5\u5668\u51cf\u8d1f\u3002\u6b64\u5916\uff0c<code>.symtab</code> \u8fd8\u4f1a\u591a\u51fa\u4e00\u4e2a <code>_DYNAMIC</code> \u7b26\u53f7\uff0c\u6307\u5411 <code>.dynamic</code> section\u3002</p> <p>\u6700\u540e\uff0c<code>readelf</code> \u8fd8\u8d34\u5fc3\u5730\u8ba1\u7b97\u4e86\u4e00\u4e0b\u54c8\u5e0c\u8868\u7684\u5e73\u5747\u67e5\u8be2\u6b21\u6570\uff1a</p> <pre><code>Histogram for bucket list length (total of 1 bucket):\n Length  Number     % of total  Coverage\n      0  0          (  0.0%)\n      1  0          (  0.0%)      0.0%\n      2  1          (100.0%)    100.0%\n\nHistogram for `.gnu.hash' bucket list length (total of 2 buckets):\n Length  Number     % of total  Coverage\n      0  0          (  0.0%)\n      1  2          (100.0%)    100.0%\n\nNo version information found in this file.\n</code></pre> <p>\u540e\u9762\u4f1a\u518d\u7ec6\u8bb2\u4e00\u4e0b\u5b83\u6240\u91c7\u7528\u7684\u54c8\u5e0c\u8868\u7684\u67b6\u6784\u3002</p> <p>\u7ed3\u5408\u4e0a\u9762\u7684\u89c2\u5bdf\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u521d\u6b65\u7684\u5370\u8c61\uff0c\u6bd4\u8f83\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u4e0e\u751f\u6210\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u533a\u522b\uff1a</p> <ol> <li>ELF \u6587\u4ef6\u7c7b\u578b\u4e0d\u540c\uff0cDYN (Shared object file) vs EXEC (Executable file)</li> <li>\u52a8\u6001\u5e93\u6709\u989d\u5916\u7684\u4e00\u5957\u7528\u4e8e\u52a8\u6001\u94fe\u63a5\u7684 section\uff0c\u5305\u62ec\u52a8\u6001\u7684\u7b26\u53f7\u8868\uff0c\u52a8\u6001\u7684\u5b57\u7b26\u4e32\u8868\uff0c\u52a8\u6001\u8868\uff08<code>.dynamic</code>\uff09\uff0c\u4ee5\u53ca\u54c8\u5e0c\u8868\uff08\u5b9e\u73b0\u7b26\u53f7\u540d\u79f0\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff09</li> <li>\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u5730\u5740\u4e0d\u786e\u5b9a\uff0c\u5728 ELF \u4e2d\u4ece 0 \u5f00\u59cb\u8ba1\u7b97\uff0c\u9700\u8981\u5730\u5740\u65e0\u5173\u4ee3\u7801</li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u4f7f\u7528\u52a8\u6001\u5e93","title":"\u4f7f\u7528\u52a8\u6001\u5e93","text":"<p>\u751f\u6210\u52a8\u6001\u5e93 <code>libprinter.so</code> \u4ee5\u540e\uff0c\u6700\u540e\u8fd8\u9700\u8981\u8ba9 <code>main.o</code> \u52a8\u6001\u94fe\u63a5 <code>libprinter.so</code>\uff0c\u5e76\u8fd0\u884c\uff1a</p> <pre><code># ld -dynamic-linker: Set path to dynamic linker for the executable\n$ ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 main.o libprinter.so -o main\n$ LD_LIBRARY_PATH=$PWD ./main\nHello world!\n</code></pre> <p>\u8fd9\u91cc\u7279\u522b\u6307\u5b9a\u4e86 <code>main</code> \u7684\u52a8\u6001\u94fe\u63a5\u5668\u8def\u5f84\u4e3a <code>/lib64/ld-linux-x86-64.so.2</code>\uff0c\u8fd9\u662f\u56e0\u4e3a <code>main</code> \u5728\u542f\u52a8\u65f6\uff0c\u9700\u8981\u7531\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u6700\u540e\u7684\u52a8\u6001\u94fe\u63a5\uff0c\u90a3\u4e48\u7528\u54ea\u4e2a\u52a8\u6001\u94fe\u63a5\u5668\u53bb\u505a\u8fd9\u4e2a\u4e8b\u60c5\u5462\uff1f\u8fd9\u91cc\u5c31\u662f\u5728\u6307\u5b9a\u52a8\u6001\u94fe\u63a5\u5668\u7684\u8def\u5f84\u3002\u542f\u52a8 <code>main</code> \u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u627e\u5230\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 <code>libprinter.so</code>\uff0c\u6dfb\u52a0\u4e86\u73af\u5883\u53d8\u91cf <code>LD_LIBRARY_PATH</code> \u5e76\u8bbe\u7f6e\u4e3a\u5f53\u524d\u76ee\u5f55\u3002\u8fd9\u6837 <code>main</code> \u7a0b\u5e8f\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u8d77\u6765\u4e86\u3002</p> <p>\u867d\u7136 <code>libprinter.so</code> \u51fa\u73b0\u5728\u4e86 <code>ld</code> \u7684\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\uff0c\u4f46\u5e76\u4e0d\u4ee3\u8868\u5b83\u7684\u5185\u5bb9\u4f1a\u88ab\u9759\u6001\u94fe\u63a5\u5230 <code>main</code> \u5f53\u4e2d\uff1a\u5b9e\u9645\u4e0a\uff0c\u9759\u6001\u94fe\u63a5\u5668\u4f1a\u4ee5\u67d0\u79cd\u5f62\u5f0f\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u5728 <code>main</code> \u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u5982\u4f55\u53bb\u52a8\u6001\u94fe\u63a5 <code>libprinter.so</code>\u3002\u8fd9\u4e2a\u5177\u4f53\u5f62\u5f0f\uff0c\u4f1a\u5728\u4e0b\u4e00\u7bc7\u535a\u5ba2\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u3002\u73b0\u5728\u5148\u8ba8\u8bba\u4e00\u4e0b\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u53ef\u80fd\u9700\u8981\u505a\u4e9b\u4ec0\u4e48\uff1a</p> <ol> <li>\u6839\u636e <code>main</code> \u7a0b\u5e8f\u8bb0\u5f55\u7684\u4fe1\u606f\uff0c\u53bb\u52a0\u8f7d <code>libprinter.so</code> \u7684\u5185\u5bb9\uff0c\u52a0\u8f7d\u5230\u67d0\u4e2a\u5185\u5b58\u5730\u5740\u4e0a</li> <li><code>main</code> \u7a0b\u5e8f\u9700\u8981\u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\uff0c\u90a3\u4e48\u52a8\u6001\u94fe\u63a5\u5668\u5c31\u9700\u8981\u53bb\u67e5\u8be2\uff0c<code>libprinter.so</code> \u6709\u6ca1\u6709\u8fd9\u4e9b\u51fd\u6570\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5730\u5740\u662f\u4ec0\u4e48</li> </ol> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u5c31\u4f1a\u7528\u5230\u4e0a\u9762\u51fa\u73b0\u7684 <code>.dynamic</code> section\uff0c\u6839\u636e\u5b83\u7684\u5185\u5bb9\uff0c\u8bb0\u5f55\u4e0b\u54c8\u5e0c\u8868\u7684\u4f4d\u7f6e\u3002\u7a0b\u5e8f\u8981\u8c03\u7528 <code>print</code> \u51fd\u6570\uff0c\u90a3\u5c31\u5728\u54c8\u5e0c\u8868\u91cc\u67e5\u8be2 <code>print</code> \u51fd\u6570\u5bf9\u5e94\u7684\u7b26\u53f7\uff0c\u5982\u679c\u627e\u5230\u4e86\uff0c\u90a3\u5c31\u53ef\u4ee5\u5f97\u5230 <code>print</code> \u51fd\u6570\u5728 <code>libprinter.so</code> \u91cc\u7684\u504f\u79fb\uff0c\u504f\u79fb\u518d\u52a0\u4e0a <code>libprinter.so</code> \u52a8\u6001\u52a0\u8f7d\u7684\u57fa\u5730\u5740\uff0c\u5c31\u5f97\u5230\u4e86\u5b9e\u9645\u662f <code>print</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u8c03\u7528\u51fd\u6570\u4e86\u3002</p> <p>\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u53d1\u751f\u5f88\u591a\u6b21\uff0c\u6240\u4ee5\u6027\u80fd\u662f\u5f88\u91cd\u8981\u7684\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u54c8\u5e0c\u8868\u3002\u90a3\u4e48\u8fd9\u4e2a\u54c8\u5e0c\u8868\u5177\u4f53\u662f\u600e\u4e48\u4e00\u4e2a\u6784\u9020\u5462\uff1f\u4ee5\u5f80\u5728\u6570\u636e\u7ed3\u6784\u8bfe\u4e0a\u8bb2\u54c8\u5e0c\u8868\u7684\u65f6\u5019\uff0c\u66f4\u591a\u662f\u5728\u5185\u5b58\u4e2d\u7528\u54c8\u5e0c\u8868\uff0c\u7528\u62c9\u94fe\u6cd5\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u8bdd\uff0c\u76f4\u63a5\u7528\u6307\u9488\u6570\u7ec4\u5c31\u53ef\u4ee5\u4e86\uff1b\u800c\u8fd9\u91cc\u7684\u54c8\u5e0c\u8868\u9700\u8981\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u6240\u4ee5\u90fd\u662f\u7528\u4e0b\u6807\u6765\u66ff\u4ee3\u6307\u9488\u3002</p> <p>\u9996\u5148\u8bb2\u4f20\u7edf\u7684 SystemV Hash \u5b9e\u73b0\uff0c\u5b83\u4fdd\u5b58\u5728 <code>.hash</code> \u6bb5\u5185\uff0c\u4f7f\u7528\u62c9\u94fe\u6cd5\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u3002\u5b83\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684\uff1a</p> <ol> <li>\u4e24\u4e2a 32 \u4f4d\u6570 <code>nbucket</code> \u548c <code>nchain</code>\uff0c\u5206\u522b\u4fdd\u5b58\u6709\u591a\u5c11\u4e2a bucket \u548c\u591a\u5c11\u4e2a chain</li> <li>\u63a5\u4e0b\u6765\u662f <code>nbucket</code> \u4e2a 32 \u4f4d\u6570\uff08bucket \u6570\u7ec4\uff09\uff0c\u5bf9\u5e94\u54c8\u5e0c\u8868\u7684 bucket\uff0c\u5185\u5bb9\u662f chain \u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u4e5f\u5c31\u662f\u62c9\u94fe\u6cd5\u91cc\uff0c\u94fe\u8868\u7684\u8d77\u59cb\u7ed3\u70b9\u4e0b\u6807</li> <li>\u6700\u540e\u662f <code>nchain</code> \u4e2a 32 \u4f4d\u6570\uff08chain \u6570\u7ec4\uff09\uff0c\u8bb0\u5f55\u94fe\u8868\u7684\u4e0b\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e0b\u6807\uff0c\u5982\u679c\u94fe\u8868\u540e\u7ee7\u7ed3\u70b9\u4e0d\u5b58\u5728\uff0c\u5219\u4fdd\u5b58 <code>STN_UNDEF</code></li> </ol> <p>chain \u6570\u7ec4\u548c\u52a8\u6001\u7b26\u53f7\u8868\u5927\u5c0f\u76f8\u540c\uff0c\u5143\u7d20\u4e00\u4e00\u5bf9\u5e94\u3002\u90a3\u4e48\u7528\u54c8\u5e0c\u8868\u67e5\u8be2\u7b26\u53f7\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5bf9\u7b26\u53f7\u540d\u79f0\u6c42\u54c8\u5e0c\u503c\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u89c4\u5b9a\u597d\u7684\uff0c\u8f93\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8f93\u51fa\u4e00\u4e2a 32 \u4f4d\u6574\u6570</li> <li>\u67e5\u8be2\u54c8\u5e0c\u503c\u5bf9\u5e94\u7684 bucket\uff0c\u5f97\u5230 chain \u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u8fd9\u4e2a\u4e0b\u6807\u4e5f\u5bf9\u5e94\u4e86\u4e00\u4e2a\u7b26\u53f7</li> <li>\u53bb\u7b26\u53f7\u8868\u67e5\u770b\u8fd9\u4e2a\u7b26\u53f7\u662f\u5426\u662f\u8981\u67e5\u8be2\u7684\u7b26\u53f7\uff08\u5b57\u7b26\u4e32\u6bd4\u8f83\uff09\uff0c\u5982\u679c\u662f\uff0c\u90a3\u5c31\u627e\u5230\u4e86\u76ee\u6807\u7b26\u53f7</li> <li>\u5982\u679c\u4e0d\u662f\uff0c\u68c0\u67e5 chain \u6570\u7ec4\uff0c\u67e5\u770b\u94fe\u8868\u662f\u5426\u6709\u540e\u7ee7\u7ed3\u70b9\uff0c\u5982\u679c\u6709\uff0c\u90a3\u4e48\u6cbf\u7740\u94fe\u8868\uff0c\u9010\u4e2a\u68c0\u67e5\u7b26\u53f7\u8868\u4e2d\u7684\u7b26\u53f7</li> <li>\u5982\u679c\u904d\u5386\u5230 <code>STT_UNDEF</code> \u90fd\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u7b26\u53f7\uff0c\u8bf4\u660e\u76ee\u6807\u7b26\u53f7\u4e0d\u5b58\u5728</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u662f\u6bd4\u8f83\u539f\u59cb\u7684\u54c8\u5e0c\u8868\u5b9e\u73b0\u65b9\u6cd5\uff0c\u4e3a\u4e86\u51cf\u5c11\u78b0\u649e\uff0c\u5c31\u9700\u8981\u6bd4\u8f83\u5927\u7684 <code>nbucket</code>\uff0c\u4f46\u5c31\u9700\u8981\u66f4\u591a\u7684\u7a7a\u95f4\u4e86\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u52a8\u6001\u5e93\u65e5\u76ca\u589e\u957f\u7684\u7b26\u53f7\u8868\u5927\u5c0f\u548c\u4e0d\u591f\u9ad8\u7684\u52a8\u6001\u94fe\u63a5\u6027\u80fd\u4e4b\u95f4\u7684\u77db\u76fe\uff0c\u76ee\u524d\u5e38\u89c1\u53e6\u4e00\u79cd\u54c8\u5e0c\u8868\u7684\u5b9e\u73b0\uff1aGNU Hash\uff0c\u5b83\u4fdd\u5b58\u5728 <code>.gnu.hash</code> \u6bb5\u5185\u3002\u867d\u8bf4\u662f\u54c8\u5e0c\u8868\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u7684\u7ec4\u5408\uff1a</p> <ol> <li>Bloom Filter\uff1aBloom Filter \u662f\u4e00\u79cd\u5feb\u901f\u5224\u65ad\u67d0\u4e2a\u503c\u662f\u5426\u4e0d\u5728\u67d0\u4e2a\u96c6\u5408\u4e2d\u7684\u6570\u636e\u7ed3\u6784 <sup>1</sup>\uff0c\u5728\u8fd9\u91cc\uff0c\u5c31\u662f\u5224\u65ad\u7b26\u53f7\u662f\u5426\u4e0d\u5728\u8be5\u52a8\u6001\u5e93\u7684\u7b26\u53f7\u8868\u4e2d\uff0c\u5982\u679c\u4e0d\u5728\uff0c\u90a3\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u540e\u7eed\u7684\u54c8\u5e0c\u67e5\u8868</li> <li>\u54c8\u5e0c\u8868\uff1a\u76f8\u6bd4 SystemV Hash\uff0c\u505a\u4e86\u8fd9\u4e9b\u6539\u52a8\uff1a<ol> <li>\u62c9\u94fe\u6cd5\u7684\u5185\u5b58\u8bbf\u95ee\u6bd4\u8f83\u968f\u673a\uff0c\u7f13\u5b58\u5c40\u90e8\u6027\u5dee\uff1b\u6240\u4ee5\u6539\u6210\u4e86\u7ebf\u6027\u6cd5\uff1a\u628a\u7b26\u53f7\u6309\u7167 bucket \u6392\u5e8f\uff0c\u4f7f\u5f97\u540c\u4e00\u4e2a bucket \u5185\u7684\u6240\u6709\u7b26\u53f7\u5728\u6570\u7ec4\u4e2d\u8fde\u7eed\u5b58\u653e\uff0c\u6539\u8fdb\u4e86\u7f13\u5b58\u5c40\u90e8\u6027</li> <li>\u5728 SystemV Hash \u4e2d\uff0c\u5728\u94fe\u8868\u904d\u5386\u7684\u65f6\u5019\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u90fd\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83\uff0c\u8fd9\u662f\u6bd4\u8f83\u6162\u7684\uff1b\u5728 GNU Hash \u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u4fdd\u5b58\u94fe\u8868\u7684\u540e\u7ee7\u7ed3\u70b9\u7684\u53d8\u5316\uff0c\u6539\u4e3a\u4fdd\u5b58\u5bf9\u5e94\u7b26\u53f7\u7684\u54c8\u5e0c\u503c\uff0c\u90a3\u4e48\u5728\u904d\u5386\u8fde\u7eed\u7684 bucket \u5185\u7684\u7b26\u53f7\u65f6\uff0c\u9996\u5148\u6bd4\u8f83\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u65f6\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u5b57\u7b26\u4e32\u6bd4\u8f83\u4e86</li> <li>\u4e3a\u4e86\u5224\u65ad\u5f53\u524d bucket \u5185\u7b26\u53f7\u662f\u5426\u904d\u5386\u5b8c\u6210\uff0c\u62ff\u54c8\u5e0c\u7684\u6700\u4f4e\u4f4d\u505a\u6807\u8bc6\uff0c\u6bd4\u8f83\u54c8\u5e0c\u65f6\u4e0d\u8003\u8651\u6700\u4f4e\u4f4d</li> </ol> </li> </ol> <p>\u90a3\u4e48\u7528 GNU Hash \u67e5\u8be2\u7b26\u53f7\u8868\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5728 Bloom Filter \u4e2d\u67e5\u8be2\u76ee\u6807\u7b26\u53f7\u662f\u5426\u4e0d\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u8bf4\u660e\u76ee\u6807\u7b26\u53f7\u4e0d\u5b58\u5728</li> <li>\u8ba1\u7b97\u51fa\u7b26\u53f7\u540d\u79f0\u7684\u54c8\u5e0c\uff0c\u627e\u5230\u5bf9\u5e94\u7684 bucket\uff0c\u904d\u5386 bucket \u5185\u7684\u5143\u7d20\uff0c\u5224\u65ad\u76ee\u6807\u7b26\u53f7\u4e0e\u5f53\u524d\u5143\u7d20\u7684\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5e76\u4e14\u5b57\u7b26\u4e32\u6bd4\u8f83\u4e5f\u76f8\u540c\uff0c\u90a3\u5c31\u627e\u5230\u4e86\u76ee\u6807\u7b26\u53f7\uff1b\u5982\u679c\u6ca1\u67e5\u5230\uff0c\u5c31\u67e5\u5230\u76f4\u5230 bucket \u7ed3\u675f</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u4f1a\u6bd4 SystemV Hash \u6027\u80fd\u66f4\u9ad8\uff0c\u6784\u5efa\u8d77\u6765\u81ea\u7136\u4e5f\u66f4\u52a0\u590d\u6742\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u7ed3\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0a\u4e00\u6b21\u535a\u5ba2\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7b2c\u4e09\u7248\u7684\u94fe\u63a5\u5668\uff0c\u8fd9\u4e2a\u94fe\u63a5\u5668\u53ef\u4ee5\u652f\u6301\u8f93\u5165\u591a\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u52a8\u6001\u5e93\u3002\u989d\u5916\u7684\u9700\u8981\u5b9e\u73b0\u7684\u5185\u5bb9\uff0c\u5305\u62ec\uff1a</p> <ol> <li>\u4ece\u7b26\u53f7\u8868\uff08<code>.symtab</code>\uff09\u4e2d\uff0c\u53d6\u51fa\u90a3\u4e9b GLOBAL \u7684\u7b26\u53f7\uff0c\u6784\u5efa\u51fa\u52a8\u6001\u7b26\u53f7\u8868\uff08<code>.dynsym</code>\uff09\uff0c\u8ba1\u7b97\u51fa\u54c8\u5e0c\u8868\uff0c\u4fdd\u5b58\u5728 <code>.hash</code> \u548c <code>.gnu.hash</code> \u6bb5\u4e2d</li> <li>\u6784\u9020 <code>.dynamic</code> section\uff0c\u5e76\u5728 Program Header \u4e2d\u6dfb\u52a0 DYNAMIC\uff0c\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u52a8\u6001\u94fe\u63a5\u65f6\u6240\u9700\u8981\u7684\u5404\u79cd\u4fe1\u606f</li> </ol> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 600 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 200 \u884c\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/06/write-a-linker-3/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p> <ul> <li>Dynamic Linking</li> <li>ELF: better symbol lookup via DT_GNU_HASH</li> <li>GNU Hash ELF Sections</li> </ul> <ol> <li> <p>\u8fd9\u53e5\u8bdd\u6709\u70b9\u62d7\u53e3\uff0c\u4f46\u662f\u4f60\u6ca1\u6709\u770b\u9519\uff0cBloom Filter \u53ea\u80fd\u786e\u5b9a\u67d0\u4e2a\u5143\u7d20\u4e0d\u5728\u96c6\u5408\u4e2d\uff0c\u4f46\u53cd\u4e4b\uff0c\u4e0d\u80fd\u786e\u5b9a\u5143\u7d20\u662f\u5426\u4e00\u5b9a\u5728\u96c6\u5408\u4e2d\u3002\u5b83\u7684\u539f\u7406\u662f\uff0c\u8ba1\u7b97\u96c6\u5408\u7684\u6bcf\u4e2a\u5143\u7d20\u7684\u54c8\u5e0c\u503c\uff0c\u6784\u5efa\u51fa\u4e00\u4e2a bitset\uff0c\u628a\u54c8\u5e0c\u503c\u5bf9\u5e94\u7684\u4f4d\u8bbe\u4e3a 1\uff0c\u5176\u4f59\u8bbe\u4e3a 0\uff1b\u67e5\u8be2\u65f6\uff0c\u8ba1\u7b97\u5143\u7d20\u7684\u54c8\u5e0c\u503c\uff0c\u68c0\u67e5 bitset \u4e2d\u5bf9\u5e94\u4f4d\u662f\u5426\u4e3a 0\uff1a\u5982\u679c\u4e3a 0\uff0c\u90a3\u4e48\u5143\u7d20\u4e00\u5b9a\u4e0d\u5728\u96c6\u5408\u4e2d\uff1b\u5982\u679c\u4e3a 1\uff0c\u7531\u4e8e\u53ef\u80fd\u51fa\u73b0\u54c8\u5e0c\u51b2\u7a81\uff0c\u4e0d\u80fd\u786e\u5b9a\u8be5\u5143\u7d20\u4e00\u5b9a\u5728\u96c6\u5408\u4e2d\u3002\u00a0\u21a9</p> </li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/","title":"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e09\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u52a8\u6001\u5e93\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u8fdb\u4e00\u6b65\u652f\u6301\u52a8\u6001\u5e93\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u751f\u6210\u52a8\u6001\u5e93\uff0c\u8fd8\u652f\u6301\u8ba9\u52a8\u6001\u5e93\u53c2\u4e0e\u5230\u9759\u6001\u94fe\u63a5\u5f53\u4e2d\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u56de\u987e","title":"\u56de\u987e","text":"<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e09\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005 ELF \u52a8\u6001\u5e93\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p> <ol> <li>\u89e3\u6790\u8f93\u5165\u7684\u82e5\u5e72\u4e2a ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u5408\u5e76\u6765\u81ea\u4e0d\u540c ELF \u7684\u540c\u540d section</li> <li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li> <li>\u5982\u679c\u8981\u751f\u6210\u52a8\u6001\u5e93\uff0c\u8fd8\u9700\u8981\u9488\u5bf9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u6784\u9020\u4e00\u4e9b\u989d\u5916\u7684 section\uff08<code>.dynamic</code>\uff0c<code>.dynsym</code> \u548c <code>.dynstr</code>\uff09</li> <li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff0c\u8fdb\u800c\u66f4\u65b0\u7b26\u53f7\u8868\uff0c\u5f97\u5230\u6bcf\u4e2a\u7b26\u53f7\u5728\u8fd0\u884c\u65f6\u4f1a\u5904\u5728\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li> <li>\u5982\u679c\u8981\u751f\u6210\u52a8\u6001\u5e93\uff0c\u56e0\u4e3a\u8fd0\u884c\u65f6\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u5730\u5740\u4e0d\u786e\u5b9a\uff0c\u6240\u4ee5\u5728 ELF \u4e2d\u628a\u52a0\u8f7d\u5730\u5740\u8bbe\u4e3a 0\uff0c\u5e76\u4e14\u8981\u6c42\u4ee3\u7801\u662f\u5730\u5740\u65e0\u5173\u4ee3\u7801\uff08PIC\uff0cPosition Independent Code\uff09</li> <li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li> </ol> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u652f\u6301\u94fe\u63a5\u52a8\u6001\u5e93\uff0c\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6700\u540e\u7684\u8fd9\u4e00\u6b65\u662f\u7528 GNU ld \u5b8c\u6210\u7684\uff1a</p> <pre><code># assemble sources\n$ as main.s -o main.o\n$ as printer.s -o printer.o\n# ld -shared: generate shared library\n# we have implemented this in the previous blog post\n$ ld -shared printer.o -o libprinter.so\n\n# ld -dynamic-linker: Set path to dynamic linker for the executable\n# we are going to implement this one\n$ ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 main.o libprinter.so -o main\n\n$ LD_LIBRARY_PATH=$PWD ./main\nHello world!\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u5c31\u662f <code>ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 main.o libprinter.so -o main</code> \u547d\u4ee4\u7684\u529f\u80fd\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u5206\u6790","title":"\u5206\u6790","text":"","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","title":"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u9996\u5148\u8981\u5206\u6790\u4e00\u4e0b ld \u5728\u5b9e\u73b0\u52a8\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\u3002\u89c2\u5bdf\u94fe\u63a5\u5f97\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6 <code>main</code>\uff1a</p> <pre><code>$ ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 main.o libprinter.so -o main\n$ readelf -a main\n</code></pre> <p>\u9996\u5148\u662f ELF Header \u90e8\u5206\uff1a</p> <pre><code>ELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 \n  Class:                             ELF64\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x401030\n  Start of program headers:          64 (bytes into file)\n  Start of section headers:          12696 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           56 (bytes)\n  Number of program headers:         8\n  Size of section headers:           64 (bytes)\n  Number of section headers:         15\n  Section header string table index: 14\n</code></pre> <p>\u548c\u4e4b\u524d\u770b\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6ca1\u4ec0\u4e48\u4e0d\u540c\uff1aType \u662f EXEC \u8868\u793a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5165\u53e3\u5730\u5740\u6307\u5411\u4e86 <code>main</code> \u7684\u5730\u5740 <code>0x401030</code>\u3002</p> <p>\u63a5\u4e0b\u6765\u770b Section \u90e8\u5206\uff1a</p> <pre><code>Section Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .interp           PROGBITS         0000000000400200  00000200\n       000000000000001c  0000000000000000   A       0     0     1\n  [ 2] .hash             HASH             0000000000400220  00000220\n       0000000000000018  0000000000000004   A       4     0     8\n  [ 3] .gnu.hash         GNU_HASH         0000000000400238  00000238\n       000000000000001c  0000000000000000   A       4     0     8\n  [ 4] .dynsym           DYNSYM           0000000000400258  00000258\n       0000000000000048  0000000000000018   A       5     1     8\n  [ 5] .dynstr           STRTAB           00000000004002a0  000002a0\n       000000000000001a  0000000000000000   A       0     0     1\n  [ 6] .rela.plt         RELA             00000000004002c0  000002c0\n       0000000000000030  0000000000000018  AI       4    11     8\n  [ 7] .plt              PROGBITS         0000000000401000  00001000\n       0000000000000030  0000000000000010  AX       0     0     16\n  [ 8] .text             PROGBITS         0000000000401030  00001030\n       000000000000000a  0000000000000000  AX       0     0     1\n  [ 9] .eh_frame         PROGBITS         0000000000402000  00002000\n       0000000000000000  0000000000000000   A       0     0     8\n  [10] .dynamic          DYNAMIC          0000000000402ec8  00002ec8\n       0000000000000120  0000000000000010  WA       5     0     8\n  [11] .got.plt          PROGBITS         0000000000402fe8  00002fe8\n       0000000000000028  0000000000000008  WA       0     0     8\n  [12] .symtab           SYMTAB           0000000000000000  00003010\n       00000000000000d8  0000000000000018          13     3     8\n  [13] .strtab           STRTAB           0000000000000000  000030e8\n       0000000000000043  0000000000000000           0     0     1\n  [14] .shstrtab         STRTAB           0000000000000000  0000312b\n       0000000000000069  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  D (mbind), l (large), p (processor specific)\n\nThere are no section groups in this file.\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u51fa\u73b0\u4e86\u4e00\u4e9b\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u91cc\u51fa\u73b0\u8fc7\u7684\u548c\u52a8\u6001\u94fe\u63a5\u76f8\u5173\u7684\u6bb5\uff1a</p> <ol> <li><code>.hash</code> \u548c <code>.gnu.hash</code>\uff1a\u4e0d\u540c\u683c\u5f0f\u7684\u54c8\u5e0c\u8868\uff0c\u63d0\u4f9b\u4e86\u4ece\u7b26\u53f7\u540d\u5b57\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff0c\u63d0\u9ad8\u52a8\u6001\u94fe\u63a5\u5668\u67e5\u627e\u7b26\u53f7\u7684\u6027\u80fd</li> <li><code>.dynsym</code>\uff1aDynamic Symbol\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u52a8\u6001\u7b26\u53f7\u8868</li> <li><code>.dynstr</code>\uff1aDynamic String\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u5b57\u7b26\u4e32\u7684\u8868</li> <li><code>.dynamic</code>\uff1aDynamic\uff0c\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fe1\u606f</li> </ol> <p>\u6b64\u5916\uff0c\u8fd8\u51fa\u73b0\u4e86\u4e00\u4e9b\u65b0\u7684\u6bb5\uff1a</p> <ol> <li><code>.interp</code>\uff1a\u8fd9\u4e2a\u6bb5\u8bb0\u5f55\u4e86 Program Interpreter \u7684\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u7528\u547d\u4ee4\u884c <code>ld -dynamic-linker /lib64/ld-linux-x86-64.so.2</code> \u6240\u6307\u5b9a\u7684 <code>/lib64/ld-linux-x86-64.so.2</code>\uff0c\u7528\u6765\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8981\u8fd0\u884c\u8fd9\u4e2a\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u9700\u8981\u4f9d\u9760\u8fd9\u4e2a Program Interpreter\uff0c\u5b83\u540c\u65f6\u4e5f\u662f\u52a8\u6001\u94fe\u63a5\u5668</li> <li><code>.plt</code>\uff1aProcedure Linkage Table\uff0c\u6d89\u53ca\u5230\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u51fd\u6570\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li> <li><code>.rela.plt</code>\uff1a\u9488\u5bf9 Procedure Linkage Table \u7684\u91cd\u5b9a\u4f4d\uff08Relocation\uff09\u4fe1\u606f\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li> <li><code>.got.plt</code>\uff1a\u9488\u5bf9 Procedure Linkage Table \u7684 Global Offset Table\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li> </ol> <p>\u8fd9\u65f6\u5019\u4f60\u89c9\u5f97\u5f88\u5947\u602a\uff1a\u901a\u5e38\u770b\u5230 <code>.rela</code> \u5f00\u5934\u7684\u6bb5\uff0c\u90fd\u662f\u5728\u5bf9\u8c61\u6587\u4ef6\u91cc\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u6bb5\u7684\u91cd\u5b9a\u4f4d\u4fe1\u606f\u3002\u4f46\u662f\u4e3a\u5565\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u8fd8\u6709\u5462\uff1f\u5728\u524d\u9762\u7684\u51e0\u7bc7\u535a\u5ba2\u4e2d\uff0c\u9759\u6001\u94fe\u63a5\u5668\u5df2\u7ecf\u89e3\u51b3\u4e86\u6240\u6709\u91cd\u5b9a\u4f4d\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u6ca1\u6709\u91cd\u5b9a\u4f4d\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u52a8\u6001\u5e93\uff0c\u7531\u4e8e\u9759\u6001\u94fe\u63a5\u5668\u65e0\u6cd5\u77e5\u9053\u52a8\u6001\u5e93\u4f1a\u88ab\u52a0\u8f7d\u5230\u4ec0\u4e48\u5730\u5740\u4e0a\u53bb\uff0c\u53ea\u597d\u4fdd\u7559\u4e86\u4e00\u4e9b\u91cd\u5b9a\u4f4d\u4fe1\u606f\uff0c\u800c\u8fd9\u4e9b\u4f1a\u7559\u7ed9\u540e\u6765\u7684\u52a8\u6001\u94fe\u63a5\u5668\uff1a\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u8d1f\u8d23\u52a0\u8f7d\u52a8\u6001\u5e93\uff0c\u4e5f\u5c31\u77e5\u9053\u4e86\u52a8\u6001\u5e93\u7684\u5730\u5740\uff0c\u56e0\u6b64\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5269\u4e0b\u7684\u8fd9\u4e9b\u9488\u5bf9\u52a8\u6001\u5e93\u7684\u91cd\u5b9a\u4f4d\u4e86\u3002</p> <p>\u7ee7\u7eed\u5f80\u4e0b\u770b Program Headers \u90e8\u5206\uff1a</p> <pre><code>Program Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040\n                 0x00000000000001c0 0x00000000000001c0  R      0x8\n  INTERP         0x0000000000000200 0x0000000000400200 0x0000000000400200\n                 0x000000000000001c 0x000000000000001c  R      0x1\n      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]\n  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000\n                 0x00000000000002f0 0x00000000000002f0  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000401000 0x0000000000401000\n                 0x000000000000003a 0x000000000000003a  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000402000 0x0000000000402000\n                 0x0000000000000000 0x0000000000000000  R      0x1000\n  LOAD           0x0000000000002ec8 0x0000000000402ec8 0x0000000000402ec8\n                 0x0000000000000148 0x0000000000000148  RW     0x1000\n  DYNAMIC        0x0000000000002ec8 0x0000000000402ec8 0x0000000000402ec8\n                 0x0000000000000120 0x0000000000000120  RW     0x8\n  GNU_RELRO      0x0000000000002ec8 0x0000000000402ec8 0x0000000000402ec8\n                 0x0000000000000138 0x0000000000000138  R      0x1\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a <code>INTERP</code> \u9879\uff0c\u5b83\u6307\u5411\u4e86 <code>.interp</code> \u6bb5\u7684\u5730\u5740\uff0c\u8fd9\u4e2a\u6bb5\u91cc\u4fdd\u5b58\u7684\u5c31\u662f <code>/lib64/ld-linux-x86-64.so.2</code> \u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5176\u5b9e\u5c31\u662f\u5728\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ece\u8fd9\u4e2a\u5730\u5740\u8bfb\u53d6 Program Interpreter \u7684\u8def\u5f84\u3002\u548c\u4e4b\u524d\u7684\u52a8\u6001\u5e93\u4e00\u6837\uff0c\u4e5f\u51fa\u73b0\u4e86 <code>DYNAMIC</code>\uff0c\u6307\u5411\u4e86 <code>.dynamic</code> \u6bb5\uff0c\u610f\u5473\u7740\u8fd9\u5373\u4f7f\u662f\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e5f\u548c\u52a8\u6001\u5e93\u6709\u4e00\u4e9b\u76f8\u4f3c\u7684\u5730\u65b9\u3002</p> <p>\u4e0b\u9762\u53ef\u4ee5\u770b\u5230 <code>.dynamic</code> \u6bb5\u7684\u5185\u5bb9\uff1a</p> <pre><code>Dynamic section at offset 0x2ec8 contains 13 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libprinter.so]\n 0x0000000000000004 (HASH)               0x400220\n 0x000000006ffffef5 (GNU_HASH)           0x400238\n 0x0000000000000005 (STRTAB)             0x4002a0\n 0x0000000000000006 (SYMTAB)             0x400258\n 0x000000000000000a (STRSZ)              26 (bytes)\n 0x000000000000000b (SYMENT)             24 (bytes)\n 0x0000000000000015 (DEBUG)              0x0\n 0x0000000000000003 (PLTGOT)             0x402fe8\n 0x0000000000000002 (PLTRELSZ)           48 (bytes)\n 0x0000000000000014 (PLTREL)             RELA\n 0x0000000000000017 (JMPREL)             0x4002c0\n 0x0000000000000000 (NULL)               0x0\n</code></pre> <p>\u548c\u4e4b\u524d\u770b\u5230\u7684\u52a8\u6001\u5e93\u5bf9\u6bd4\uff0c\u591a\u51fa\u73b0\u4e86\u8fd9\u4e9b\u9879\uff1a</p> <ol> <li><code>NEEDED</code>\uff1a\u8868\u793a\u8fd0\u884c\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6240\u9700\u8981\u52a0\u8f7d\u7684\u52a8\u6001\u5e93\u6587\u4ef6\u540d\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u52a8\u6001\u5e93\uff0c\u5c31\u4f1a\u51fa\u73b0\u719f\u6089\u7684 <code>error while loading shared libraries</code> \u9519\u8bef</li> <li><code>DEBUG</code>\uff1a\u7528\u4e8e\u8c03\u8bd5\uff0c\u8fd9\u91cc\u4e0d\u8ba8\u8bba</li> <li><code>PLTGOT</code>\uff1a\u6307\u5411\u4e86 <code>.got.plt</code> \u6bb5\u7684\u5730\u5740</li> <li><code>PLTRELSZ</code>\uff1a\u8bb0\u5f55\u4e86 <code>.rela.plt</code> \u6bcf\u4e00\u9879\u7684\u5927\u5c0f</li> <li><code>PLTREL</code>\uff1a<code>RELA</code> \u8868\u793a <code>.rela.plt</code> \u6bcf\u4e00\u9879\u91cc\u5305\u542b addend \u9879\uff08RELA = REL with Addend\uff09</li> <li><code>JMPREL</code>\uff1a\u6307\u5411\u4e86 <code>.rela.plt</code> \u6bb5\u7684\u5730\u5740</li> </ol> <p>\u52a8\u6001\u94fe\u63a5\u5668\u5728\u52a0\u8f7d\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u53bb\u5bfb\u627e <code>NEEDED</code> \u6240\u6307\u5411\u7684\u90a3\u4e9b\u52a8\u6001\u5e93\u5e76\u52a0\u8f7d\u8fdb\u6765\u3002\u90a3\u4e48\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u4fdd\u5b58\u5728\u54ea\u91cc\u5462\uff1f\u548c\u6267\u884c\u7a0b\u5e8f\u8981\u53bb <code>PATH</code> \u4e2d\u5bfb\u627e\u7c7b\u4f3c\uff0c\u52a8\u6001\u5e93\u4e5f\u4f1a\u6839\u636e\u73af\u5883\u53d8\u91cf\u4ee5\u53ca\u7cfb\u7edf\u914d\u7f6e\u7684\u8def\u5f84\u53bb\u5bfb\u627e\u3002\u7531\u4e8e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u9891\u7e41\u8fdb\u884c\u7684\u64cd\u4f5c\uff0c\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\uff0c\u7cfb\u7edf\u4e2d\u4f1a\u6709\u4e00\u4efd\u7f13\u5b58\uff0c\u8fd9\u4e2a\u7f13\u5b58\u7684\u5185\u5bb9\u53ef\u4ee5\u901a\u8fc7 <code>ldconfig -p</code> \u547d\u4ee4\u67e5\u770b\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u4e86\u5f88\u591a\u6b21 Procedure Linkage Table\uff08PLT\uff09\uff0c\u90a3\u4e48\u5b83\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u4e0b\u9762\u6765\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4ee3\u7801\u6bb5\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u89c2\u5bdf\u4ee3\u7801\u6bb5\u548c-plt","title":"\u89c2\u5bdf\u4ee3\u7801\u6bb5\u548c PLT","text":"<p>\u7528 <code>objdump -S main</code> \u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4ee3\u7801\u6bb5\u548c PLT\uff1a</p> <pre><code>$ objdump -S main\n\nmain:     file format elf64-x86-64\n\n\nDisassembly of section .plt:\n\n0000000000401000 &lt;print@plt-0x10&gt;:\n  401000:   ff 35 ea 1f 00 00       push   0x1fea(%rip)        # 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;\n  401006:   ff 25 ec 1f 00 00       jmp    *0x1fec(%rip)        # 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;\n  40100c:   0f 1f 40 00             nopl   0x0(%rax)\n\n0000000000401010 &lt;print@plt&gt;:\n  401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;\n  401016:   68 00 00 00 00          push   $0x0\n  40101b:   e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n\n0000000000401020 &lt;exit@plt&gt;:\n  401020:   ff 25 e2 1f 00 00       jmp    *0x1fe2(%rip)        # 403008 &lt;exit&gt;\n  401026:   68 01 00 00 00          push   $0x1\n  40102b:   e9 d0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n\nDisassembly of section .text:\n\n0000000000401030 &lt;_start&gt;:\n  401030:   e8 db ff ff ff          call   401010 &lt;print@plt&gt;\n  401035:   e8 e6 ff ff ff          call   401020 &lt;exit@plt&gt;\n</code></pre> <p>\u4f1a\u53d1\u73b0\u5728 <code>.plt</code> \u6bb5\u4e2d\u51fa\u73b0\u4e86\u4e24\u4e2a\u51fd\u6570\uff1a<code>print@plt</code> \u548c <code>exit@plt</code>\uff0c\u6b63\u597d\u662f <code>main</code> \u51fd\u6570\u8c03\u7528\u7684\uff0c\u7531\u52a8\u6001\u94fe\u63a5\u5e93\u63d0\u4f9b\u7684\u51fd\u6570\u3002\u5728 <code>main</code> \u51fd\u6570\u91cc\uff0c\u4e5f\u4e0d\u662f\u76f4\u63a5\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5e93\u7684 <code>print</code> \u548c <code>exit</code>\uff0c\u800c\u662f\u8c03\u7528 <code>.plt</code> \u6bb5\u91cc\u5bf9\u5e94\u7684\u5e26 <code>@plt</code> \u540e\u7f00\u7684\u7248\u672c\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f\u800c\u4e14\uff0c<code>.plt</code> \u6bb5\u5f00\u5934\u7684\u90a3\u6bb5\u4ee3\u7801\u53c8\u662f\u505a\u4ec0\u4e48\u7684\uff1f\u4e3a\u4ec0\u4e48 <code>print@plt</code> \u548c <code>exit@plt</code> \u51fd\u6570\u90fd\u8981\u8df3\u5230 <code>0x401000</code> \u5904\u7684\u4ee3\u7801\uff1f</p> <p>\u8fd9\u65f6\u5019\u5c31\u8981\u4e86\u89e3 PLT \u7684\u7528\u9014\u4e86\u3002\u5728\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u94fe\u63a5\u5668\u53ef\u4ee5\u77e5\u9053\u6240\u6709\u51fd\u6570\u7684\u5730\u5740\uff0c\u6240\u4ee5\u91cd\u5b9a\u4f4d\u90fd\u53ef\u4ee5\u8ba1\u7b97\u51fa\uff0c\u8df3\u8f6c\u548c\u8c03\u7528\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u5b9e\u9645\u7684\u7edd\u5bf9\u5730\u5740\u6216\u8005\u504f\u79fb\u91cf\u3002\u4f46\u5982\u679c\u94fe\u63a5\u4e86\u4e00\u4e2a\u52a8\u6001\u5e93\uff0c\u94fe\u63a5\u5668\u65e0\u6cd5\u77e5\u9053\u52a8\u6001\u5e93\u7684\u5730\u5740\uff0c\u6240\u4ee5\u91cd\u5b9a\u4f4d\u8fd8\u662f\u5f97\u7ee7\u7eed\u7559\u7740\uff0c\u4ea4\u7ed9\u6700\u540e\u7684\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u91cd\u5b9a\u4f4d\u3002\u90a3\u4e48\uff0c\u4e00\u4e2a\u6734\u7d20\u7684\u65b9\u6cd5\u5c31\u662f\uff0c\u4fdd\u7559\u5bf9\u52a8\u6001\u5e93\u7684\u6240\u6709\u91cd\u5b9a\u4f4d\u4fe1\u606f\u3002\u7b80\u5355\u5730\u628a\u5de5\u4f5c\u63a8\u8fdf\u7ed9\u4e86\u52a8\u6001\u94fe\u63a5\u5668\u3002\u4f46\u662f\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u5de5\u4f5c\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\uff0c\u7528\u6237\u80af\u5b9a\u4e0d\u671f\u671b\u7a0b\u5e8f\u6bcf\u6b21\u542f\u52a8\u7684\u65f6\u5019\uff0c\u90fd\u8981\u82b1\u5f88\u957f\u7684\u65f6\u95f4\u5728\u52a8\u6001\u94fe\u63a5\u4e0a\uff0c\u6240\u4ee5\u52a8\u6001\u94fe\u63a5\u8fd8\u5f97\u8db3\u591f\u5feb\uff1a\u524d\u9762\u4e5f\u770b\u5230\u4e86\uff0c\u5404\u79cd\u54c8\u5e0c\u8868\u5404\u79cd\u4f18\u5316\uff0c\u5c31\u662f\u4e3a\u4e86\u63d0\u5347\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u3002\u8981\u662f\u6bcf\u4e2a\u8c03\u7528\u90fd\u6709\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u9700\u8981\u5904\u7406\uff0c\u90a3\u4e48\u6027\u80fd\u80af\u5b9a\u4e0d\u597d\u3002</p> <p>\u90a3\u4e48\u600e\u4e48\u529e\u5462\uff1f\u5f88\u591a\u5e38\u7528\u51fd\u6570\uff0c\u6bd4\u5982 <code>malloc</code> \u548c <code>free</code> \u7b49\u7b49\uff0c\u8c03\u7528\u7684\u5730\u65b9\u662f\u975e\u5e38\u591a\u7684\u3002\u4e0d\u8fc7\uff0c\u8f6c\u5ff5\u4e00\u60f3\uff0c\u867d\u7136\u8c03\u7528\u7684\u5730\u65b9\u5f88\u591a\uff0c\u4f46\u662f\u88ab\u8c03\u7528\u7684\u51fd\u6570\u76f8\u6bd4\u4e4b\u4e0b\u5374\u4f1a\u5c11\u5f88\u591a\uff1a\u53ef\u80fd\u6709\u4e00\u5343\u4e2a\u5730\u65b9\u8c03\u7528 <code>malloc</code>\uff0c\u4f46\u662f <code>malloc</code> \u51fd\u6570\u53ea\u6709\u4e00\u4e2a\uff0c\u5982\u679c\u53ea\u91cd\u5b9a\u4f4d\u4e00\u6b21\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3\u6240\u6709\u5bf9 <code>malloc</code> \u7684\u8c03\u7528\uff0c\u90a3\u8be5\u591a\u597d\uff01\u4f46\u662f\u91cd\u5b9a\u4f4d\u4e00\u6b21\u53ea\u80fd\u4fee\u6539\u4e00\u4e2a\u5730\u65b9\u7684\u4ee3\u7801\uff0c\u600e\u4e48\u529e\u5462\uff1f\u90a3\u5c31\u8ba9\u4e00\u5343\u4e2a\u5730\u65b9\u90fd\u8c03\u7528\u4e00\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\uff0c\u8fd9\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\u901a\u8fc7\u91cd\u5b9a\u4f4d\u8c03\u7528\u771f\u5b9e\u7684 <code>malloc</code> \u51fd\u6570\uff0c\u8fd9\u6837\u91cd\u5b9a\u4f4d\u53ea\u6709\u4e00\u6b21\uff0c\u4ee3\u4ef7\u5c31\u662f\u591a\u4e86\u4e00\u6b21\u8df3\u8f6c\u3002\u6211\u4eec\u628a\u8fd9\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\u53eb\u505a <code>malloc@plt</code>\uff0c\u628a\u8bb0\u5f55\u6240\u6709\u8fd9\u4e9b\u4e34\u65f6\u51fd\u6570\u7684\u8868\u79f0\u4e3a Procedure Linkage Table\uff08PLT\uff09\uff0c\u90a3\u4e48\u4ee3\u7801\u53d8\u6210\uff1a</p> <pre><code>    .section .plt\nmalloc@plt:\n    call real_malloc # emit relocation to the real malloc\n\n    .section .text\nfunc1:\n    call malloc@plt\n    # ...\n\nfunc2:\n    call malloc@plt\n    # ...\n</code></pre> <p>\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u91cd\u5b9a\u4f4d\u6570\u91cf\u592a\u591a\u7684\u95ee\u9898\uff1a\u4ece\u6bcf\u4e2a\u8c03\u7528\u90fd\u8981\u4e00\u4e2a\u91cd\u5b9a\u4f4d\uff0c\u964d\u4f4e\u5230\u6bcf\u4e2a\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u7684 PLT \u548c\u5b9e\u9645\u770b\u5230\u7684\u8fd8\u662f\u6709\u5f88\u5927\u7684\u533a\u522b\uff1a</p> <pre><code>0000000000401010 &lt;print@plt&gt;:\n  401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;\n  401016:   68 00 00 00 00          push   $0x0\n  40101b:   e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n</code></pre> <p>\u8fd9\u4e09\u6761\u6307\u4ee4\u662f\u5728\u505a\u4ec0\u4e48\u5462\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u751f\u6210\u4e00\u4e2a\u91cd\u5b9a\u4f4d\uff0c\u76f4\u63a5\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 print \u51fd\u6570\uff1f\u800c\u8981\u641e\u5f97\u8fd9\u4e48\u9ebb\u70e6\uff1f</p> <p>\u7b54\u6848\u662f\u8fd8\u4e0d\u6ee1\u8db3\u4e8e\u5f53\u524d\u7684\u6027\u80fd\uff1a\u5b8c\u6574\u7684\u4ee3\u7801\u91cc\u53ef\u80fd\u4f1a\u8c03\u7528\u52a8\u6001\u5e93\u91cc\u7684\u7684\u4e00\u5343\u4e2a\u51fd\u6570\uff0c\u4f46\u662f\u5b9e\u9645\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5e76\u975e\u6240\u6709\u4ee3\u7801\u90fd\u4f1a\u88ab\u6267\u884c\uff0c\u4e8e\u662f\u53ef\u80fd\u53ea\u6709\u4e00\u5c0f\u90e8\u5206\u52a8\u6001\u5e93\u7684\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u65f6\u5019\uff0c\u5c31\u5e0c\u671b\u5b9e\u73b0\u4e00\u70b9\uff1a\u7b2c\u4e00\u6b21\u8c03\u7528\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u7684\u65f6\u5019\uff0c\u518d\u8fdb\u884c\u91cd\u5b9a\u4f4d\uff0c\u4e4b\u540e\u5c31\u4e00\u76f4\u7528\u8fd9\u4e2a\u91cd\u5b9a\u4f4d\u597d\u7684\u7ed3\u679c\u3002\u90a3\u4e48\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u4ece\u6765\u6ca1\u6709\u88ab\u8c03\u7528\u8fc7\uff0c\u90a3\u5c31\u7701\u4e0b\u4e86\u91cd\u5b9a\u4f4d\u7684\u65f6\u95f4\u3002\u8fd9\u5c31\u662f\u60f0\u6027\uff08Lazy\uff09\u6216\u8005\u8bf4\u5ef6\u8fdf\uff08Deferred\uff09\u7684\u601d\u60f3\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u5b83\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\uff1a</p> <ol> <li>\u7b2c\u4e00\u6b21\u8c03\u7528\u7684\u65f6\u5019\uff0c\u4f1a\u8df3\u8f6c\u5230\u52a8\u6001\u94fe\u63a5\u5668\u91cc\uff0c\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u91cd\u5b9a\u4f4d\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570</li> <li>\u7b2c\u4e8c\u6b21\u548c\u4e4b\u540e\u8c03\u7528\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u8df3\u8f6c\u5230\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570</li> </ol> <p>\u90a3\u4e48\u600e\u4e48\u53bb\u8bb0\u5f55\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u7684\u5730\u5740\u5462\uff1f\u90a3\u5c31\u627e\u4e2a\u5730\u65b9\uff0c\u628a\u8fd9\u4e2a\u5730\u5740\u5b58\u4e0b\u6765\u5c31\u597d\u3002\u7b2c\u4e00\u6b21\u8c03\u7528\u7684\u65f6\u5019\uff0c\u60f3\u529e\u6cd5\u8fdb\u5165\u5230\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u8ba9\u5b83\u8fdb\u884c\u91cd\u5b9a\u4f4d\u3002\u91cd\u5b9a\u4f4d\u5b8c\u4ee5\u540e\uff0c\u5c31\u628a\u8fd9\u4e2a\u5730\u5740\u4fdd\u5b58\u4e0b\u6765\uff0c\u4e0b\u6b21\u8c03\u7528\u5c31\u4f1a\u76f4\u63a5\u8df3\u8f6c\u8fc7\u53bb\u4e86\u3002\u518d\u56de\u770b <code>print@plt</code> \u7684\u7b2c\u4e00\u6761\u6307\u4ee4\uff1a</p> <pre><code>0000000000401010 &lt;print@plt&gt;:\n  401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;\n  401016:   68 00 00 00 00          push   $0x0\n  40101b:   e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n</code></pre> <p>\u5b83\u8df3\u8f6c\u5230 <code>0x1fea(%rip) # 0x403000</code> \u6307\u5411\u7684\u5730\u5740\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u4fdd\u5b58\u4e86\u672a\u6765 <code>print</code> \u5728\u52a8\u6001\u5e93\u4e2d\u7684\u771f\u5b9e\u5730\u5740\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u600e\u4e48\u5b9e\u73b0\u7b2c\u4e00\u6b21\u8c03\u7528 <code>print@plt</code> \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8fdb\u5165\u5230\u52a8\u6001\u94fe\u63a5\u5668\u5462\uff1f<code>0x1fea(%rip) # 0x403000</code> \u6307\u5411\u7684\u5730\u5740\u7684\u5185\u5bb9\u7684\u521d\u59cb\u503c\u53c8\u662f\u4ec0\u4e48\u5462\uff1f\u4e0b\u9762\u7684 <code>push</code> \u548c <code>jmp</code> \u53c8\u662f\u5728\u505a\u4ec0\u4e48\uff1f</p> <p>\u5176\u5b9e\uff0c\u591a\u4f59\u7684\u4e24\u6761\u6307\u4ee4\uff0c\u7ed3\u5408\u524d\u9762\u7684 <code>0x4010000</code> \u5730\u5740\u7684\u4ee3\u7801\uff0c\u5c31\u5b9e\u73b0\u4e86\u7b2c\u4e00\u6b21\u8c03\u7528\u8fdb\u52a8\u6001\u94fe\u63a5\u5668\u7684\u529f\u80fd\uff1a</p> <pre><code>0000000000401000 &lt;print@plt-0x10&gt;:\n  401000:   ff 35 ea 1f 00 00       push   0x1fea(%rip)        # 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;\n  401006:   ff 25 ec 1f 00 00       jmp    *0x1fec(%rip)        # 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;\n  40100c:   0f 1f 40 00             nopl   0x0(%rax)\n\n0000000000401010 &lt;print@plt&gt;:\n  401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;\n  401016:   68 00 00 00 00          push   $0x0\n  40101b:   e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n\n0000000000401020 &lt;exit@plt&gt;:\n  401020:   ff 25 e2 1f 00 00       jmp    *0x1fe2(%rip)        # 403008 &lt;exit&gt;\n  401026:   68 01 00 00 00          push   $0x1\n  40102b:   e9 d0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;\n</code></pre> <p>\u521d\u59cb\u60c5\u51b5\u4e0b\uff0c<code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5730\u5740\u662f <code>0x401016</code>\uff0c\u4e5f\u5c31\u662f <code>print@plt</code> \u7684 <code>push</code> \u6307\u4ee4\u7684\u5730\u5740\u3002\u90a3\u4e48\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528 <code>print@plt</code> \u4f1a\u53d1\u751f\u7684\u4e8b\u60c5\u662f\uff1a</p> <ol> <li>\u8c03\u7528 <code>print@plt</code>\uff0c\u6267\u884c <code>401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;</code>\uff0c\u6b64\u65f6 <code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\u662f <code>0x401016</code>\uff0c\u4e5f\u5c31\u662f\u8df3\u8f6c\u5230 <code>0x401016</code></li> <li>\u6267\u884c <code>401016:  68 00 00 00 00          push   $0x0</code>\uff0c\u5411\u6808\u4e0a\u538b\u5165\u4e86 <code>0</code>\uff0c\u5177\u4f53\u4ec0\u4e48\u542b\u4e49\uff0c\u4e0b\u9762\u4f1a\u8fdb\u884c\u5206\u6790</li> <li>\u6267\u884c <code>40101b:  e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;</code>\uff0c\u8df3\u8f6c\u5230 <code>0x401000</code></li> <li>\u6267\u884c <code>401000:  ff 35 ea 1f 00 00       push   0x1fea(%rip)        # 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</code>\uff0c\u5177\u4f53\u4ec0\u4e48\u542b\u4e49\uff0c\u4e0b\u9762\u4f1a\u8fdb\u884c\u5206\u6790</li> <li>\u6267\u884c <code>401006:  ff 25 ec 1f 00 00       jmp    *0x1fec(%rip)        # 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</code>\uff0c\u8fd9\u4e00\u6761\u6307\u4ee4\u8df3\u8f6c\u5230 <code>0x402ff8</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u5185\u5bb9\u5c31\u662f\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u5b83\u4f1a\u8d1f\u8d23\u8fdb\u884c\u91cd\u5b9a\u4f4d\uff0c\u91cd\u5b9a\u4f4d\u4ee5\u540e\uff0c\u5c31\u4f1a\u628a\u7ed3\u679c\u5199\u5230 <code>0x403000</code> \u5730\u5740\u91cc</li> </ol> <p>\u90a3\u4e48\uff0c\u4e4b\u540e\u8c03\u7528 <code>print@plt</code> \u4f1a\u53d1\u751f\u7684\u4e8b\u60c5\u662f\uff1a</p> <ol> <li>\u8c03\u7528 <code>print@plt</code>\uff0c\u6267\u884c <code>401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;</code>\uff0c\u6b64\u65f6 <code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\u662f\u7ecf\u8fc7\u91cd\u5b9a\u4f4d\u540e\u7684\u771f\u5b9e\u7684 <code>print</code> \u51fd\u6570\u7684\u5730\u5740</li> </ol> <p>\u90a3\u4e48\u8fd9\u4e2a\u903b\u8f91\u5c31\u6e05\u695a\u4e86\uff1a<code>0x403000</code> \u4fdd\u5b58\u4e86 <code>print</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u5982\u679c\u8fd8\u6ca1\u6709\u91cd\u5b9a\u4f4d\uff0c\u5c31\u6307\u5411\u521d\u59cb\u5316\u7684\u4ee3\u7801 <code>0x401016</code>\u3002\u8fd9\u6bb5\u4ee3\u7801\u5411\u6808\u4e0a\u538b\u5165\u4e86\u4e24\u4e2a\u5185\u5bb9\uff1a</p> <ol> <li><code>print@plt</code> \u538b\u5165\u4e86 0\uff0c<code>exit@plt</code> \u538b\u5165\u4e86 1\uff0c\u8fd9\u5bf9\u5e94\u4e86\u52a8\u6001\u7b26\u53f7\u8868\u91cc\u8fd9\u4e24\u4e2a\u7b26\u53f7\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u7f16\u53f7\uff0c\u5c31\u53ef\u4ee5\u67e5\u5230\u8981\u627e\u7684\u7b26\u53f7\u540d\u79f0</li> <li>\u538b\u5165\u4e86 <code>0x402ff0</code> \u5730\u5740\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u5185\u5bb9\u7531\u52a8\u6001\u94fe\u63a5\u5668\u521d\u59cb\u5316\uff0c\u53ef\u4ee5\u60f3\u5230\u5927\u6982\u662f\u7528\u6765\u8868\u793a\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u67d0\u4e2a\u6307\u9488</li> </ol> <p>\u90a3\u4e48\u6700\u540e\u8df3\u8f6c\u5230\u52a8\u6001\u94fe\u63a5\u5668\u91cc\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u538b\u6808\u7684\u5185\u5bb9\uff0c\u627e\u5230\u8981\u91cd\u5b9a\u4f4d\u7684\u51fd\u6570\uff0c\u8fdb\u884c\u91cd\u5b9a\u4f4d\u3002</p> <p>\u4e3a\u4e86\u4fdd\u5b58\u4e0a\u9762\u7684\u8fd9\u4e9b\u6570\u636e\uff1a<code>0x403000</code> \u4fdd\u5b58\u7684 <code>print</code> \u51fd\u6570\u5730\u5740\uff0c\u6216\u662f\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u7684 <code>0x402ff0</code> \u4ee5\u53ca <code>0x402ff8</code>\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2a <code>.got.plt</code> \u6bb5\uff1a</p> <pre><code>0000000000402fe8 &lt;_GLOBAL_OFFSET_TABLE_&gt;:\n  402fe8:   c8 2e 40 00             enter  $0x402e,$0x0\n    ...\n  403000:   16                      (bad)\n  403001:   10 40 00                adc    %al,0x0(%rax)\n  403004:   00 00                   add    %al,(%rax)\n  403006:   00 00                   add    %al,(%rax)\n  403008:   26 10 40 00             es adc %al,0x0(%rax)\n  40300c:   00 00                   add    %al,(%rax)\n    ...\n</code></pre> <p>\u8fd9\u4e2a\u5c31\u53eb\u505a Global Offset Table\uff0c\u8fd9\u91cc\u5c55\u793a\u7684\u662f\u7528\u4e8e PLT \u7684 GOT\u3002\u5b83\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <ol> <li>0x402fe8 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u5b58\u4e86 .dynamic \u6bb5\u7684\u5730\u5740</li> <li>0x402ff0 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u7559\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li> <li>0x402ff8 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u7559\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li> <li>0x403000 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a<code>print</code> \u7684\u5730\u5740\uff0c\u521d\u59cb\u5316\u4e3a <code>0x401016</code></li> <li>0x403008 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a<code>exit</code> \u7684\u5730\u5740\uff0c\u521d\u59cb\u5316\u4e3a <code>0x401026</code></li> </ol> <p>\u90a3\u4e48\u5230\u8fd9\u91cc\uff0c\u5c31\u5b8c\u6210\u4e86 PLT \u4ee5\u53ca GOT \u7684\u5206\u6790\u4e86\u3002</p> <p>\u7b80\u5355\u5c0f\u7ed3\u4e00\u4e0b\uff1a</p> <ol> <li>\u4e3a\u4e86\u51cf\u5c11\u52a8\u6001\u94fe\u63a5\u8981\u8017\u8d39\u7684\u65f6\u95f4\uff0c\u91c7\u7528\u4e86\u60f0\u6027\u91cd\u5b9a\u4f4d\u7684\u65b9\u6cd5</li> <li>\u4e3a\u4e86\u51cf\u5c11\u91cd\u5b9a\u4f4d\u6b21\u6570\uff0c\u5728 PLT \u91cc\u7ed9\u6bcf\u4e2a\u8981\u8c03\u7528\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8df3\u677f\u51fd\u6570</li> <li>\u4e3a\u4e86\u5b9e\u73b0\u60f0\u6027\u91cd\u5b9a\u4f4d\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528\u8df3\u677f\u51fd\u6570\uff0c\u4f1a\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5668\u7684\u51fd\u6570\u6765\u5b9e\u73b0\u91cd\u5b9a\u4f4d\uff0c\u901a\u8fc7\u538b\u6808\u6765\u533a\u5206\u8981\u91cd\u5b9a\u4f4d\u7684\u51fd\u6570</li> <li>\u60f0\u6027\u91cd\u5b9a\u4f4d\u5b8c\u6210\u4ee5\u540e\uff0c\u8df3\u677f\u51fd\u6570\u76f4\u63a5 jmp \u5230\u76ee\u6807\u51fd\u6570</li> </ol>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u7efc\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u843d\u5230\u5b9e\u73b0\u4e0a\uff0c\u9700\u8981\u505a\u8fd9\u4e9b\u5904\u7406\uff1a</p> <ol> <li>\u9047\u5230\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u590d\u5236\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5185\u5bb9\u5230\u5404\u4e2a\u6bb5\u4e2d\uff0c\u66f4\u65b0\u7b26\u53f7\u8868\u5e76\u6253\u4e0a\u6807\u8bb0</li> <li>\u751f\u6210 .plt \u548c .got.plt \u6bb5\u7684\u5f00\u5934<ol> <li>.plt \u5f00\u5934\u8981\u751f\u6210 push\uff0cjmp \u548c nop \u7684\u6307\u4ee4\u5e8f\u5217</li> <li>.got.plt \u6bb5\u5f00\u5934\u4fdd\u5b58 .dynamic \u6bb5\u7684\u5730\u5740\uff0c\u7136\u540e\u9884\u7559 16 \u5b57\u8282\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li> </ol> </li> <li>\u8981\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5e93\u91cc\u7684\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5728 PLT \u548c GOT \u91cc\u751f\u6210\u5bf9\u5e94\u7684\u9879\uff1a<ol> <li>.plt \u91cc\u8981\u751f\u6210 jmp\uff0cpush \u548c jmp \u4e09\u6761\u6307\u4ee4\u7684\u5e8f\u5217</li> <li>.got.plt \u8981\u6dfb\u52a0\u7528\u4e8e\u4fdd\u5b58\u5b9e\u9645\u5730\u5740\u7684\u4e00\u9879</li> <li>.rela.plt \u4e5f\u76f8\u5e94\u5730\u66f4\u65b0\uff0c\u6307\u5411 .got.plt \u91cc\u5bf9\u5e94\u9879\u7684\u5730\u5740</li> </ol> </li> <li>\u6839\u636e\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bbe\u7f6e DT_INTERP\uff1b\u5bf9\u4e8e\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\uff0c\u6dfb\u52a0 DT_NEEDED</li> <li>\u628a .plt\u3001.got.plt \u76f8\u5173\u7684\u4fe1\u606f\u8bb0\u5f55\u5230 .dynamic \u6bb5\u4e2d</li> </ol> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 1000 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 400 \u884c\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u8fd9\u5c31\u662f\u300a\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\u300b\u7cfb\u5217\u535a\u5ba2\u7684\u6700\u540e\u4e00\u7bc7\u535a\u5ba2\u4e86\u3002\u56de\u987e\u4e00\u4e0b\uff0c\u6211\u4eec\u90fd\u5b8c\u6210\u4e86\u54ea\u4e9b\u529f\u80fd\uff1a</p> <ol> <li>\u7b2c\u4e00\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u5355\u4e2a ELF \u5bf9\u8c61\u6587\u4ef6\u7684\u94fe\u63a5</li> <li>\u7b2c\u4e8c\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u591a\u4e2a ELF \u5bf9\u8c61\u6587\u4ef6\u7684\u94fe\u63a5</li> <li>\u7b2c\u4e09\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u751f\u6210\u52a8\u6001\u5e93</li> <li>\u7b2c\u56db\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u52a8\u6001\u94fe\u63a5</li> </ol> <p>\u8fd9\u8ddd\u79bb\u4e00\u4e2a\u771f\u6b63\u80fd\u7528\u7684\u94fe\u63a5\u5668\u8fd8\u5dee\u5f88\u591a\u4e1c\u897f\uff1aPIE\uff0cLinker Script\uff0c\u524d\u9762\u51fa\u73b0\u8fc7\u4f46\u662f\u6ca1\u6709\u8ba8\u8bba\u7684 <code>.eh_frame</code> \u7684\u5904\u7406\u7b49\u7b49\u3002\u4f46\u5e0c\u671b\u8fd9\u4e2a\u7cfb\u5217\u535a\u5ba2\u53ef\u4ee5\u8ba9\u4f60\u5bf9\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u65b9\u5f0f\u6709\u8fdb\u4e00\u6b65\u7684\u4e86\u89e3\u3002</p> <p>\u6211\u5b9e\u73b0\u7684\u94fe\u63a5\u5668\u4ee3\u7801\u5df2\u7ecf\u5f00\u6e90\u5728 jiegec/cold\uff0c\u7f16\u5199\u7684\u8fc7\u7a0b\u548c\u535a\u5ba2\u7684\u65f6\u95f4\u57fa\u672c\u662f\u4e00\u81f4\u7684\uff0c\u9488\u5bf9\u76f8\u5e94\u535a\u5ba2\u7684\u8fdb\u5ea6\uff0c\u53ef\u4ee5\u627e git commit \u5386\u53f2\uff0c\u67e5\u770b\u5bf9\u5e94\u7248\u672c\u7684\u5b9e\u73b0\u3002</p>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2024/04/07/write-a-linker-4/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p> <ul> <li>All about Procedure Linkage Table</li> </ul>","tags":["linux","linker","elf","write-a-linker"]},{"location":"software/2018/12/27/wxapp-recap/","title":"\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e","text":"","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u5173\u6ce8\u6e05\u534e\u7684\u540c\u5b66\u53ef\u80fd\u77e5\u9053\uff0c\u6628\u5929\uff0c\u201c\u6e05\u534e\u5927\u5b66\u201d\u516c\u4f17\u53f7\u53d1\u4e86\u4e00\u7bc7\u540d\u4e3a\u300a2018\uff0c\u6211\u4eec\u5171\u82b3\u534e\u4e28@THUers \u81f4\u76f8\u4f34\u4e00\u5e74\u7684\u4f60\uff0c\u8bf7\u67e5\u6536\u8fd9\u4efd\u5fc3\u610f\u300b\u7684\u63a8\u9001\uff0c\u5185\u5bb9\u5927\u6982\u5c31\u662f\uff0c\u6709\u90a3\u4e48 100 \u4e2a\u65b0\u5e74\u53f0\u5386\u793c\u54c1\u8981\u9001\u51fa\u53bb\uff0c\u5927\u5bb6\u5982\u679c\u60f3\u8981\u7684\u8bdd\uff0c\u5c31\u626b\u63cf\u5c0f\u7a0b\u5e8f\u3002\u5c0f\u7a0b\u5e8f\u6a21\u4eff\u4e86\u706b\u8f66\u62a2\u7968\u7684\u75c5\u6bd2\u5f0f\u8425\u9500\u7684\u6a21\u5f0f\uff0c\u8981\u6c42\u5927\u5bb6\u5206\u4eab\u5230\u7fa4\u804a\u6216\u8005\u670b\u53cb\u5708\uff0c\u8ba9\u522b\u4eba\u7ed9\u81ea\u5df1\u52a0\u901f\uff0c\u52a0\u901f\u5230 2019 \u7684\u524d 100 \u540d\u5373\u53ef\u586b\u5199\u4fe1\u606f\u9886\u53d6\u5956\u54c1\u3002</p> <p>\u7136\u540e\u5927\u5bb6\u5c31\u5728\u63a8\u9001\u91cc\u770b\u5230\u4e86\u6211\u3002\u5c31\u9171\u3002</p>","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u5f00\u59cb","title":"\u5f00\u59cb","text":"<p>\u8fd9\u4ef6\u4e8b\u60c5\u636e\u8bf4\u7b56\u5212\u4e86\u6709\u4e00\u6bb5\u65f6\u95f4\u4e86\uff0c\u53ea\u662f\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u4e00\u76f4\u6ca1\u6709\u505a\uff0c\u6700\u540e\u8fd9\u4e2a\u9505\u5c31\u8def\u7531\u5230\u4e86\u6211\u7684\u5934\u4e0a\u3002\u4e00\u5f00\u59cb\u8bf4\u5c31\u662f\u4e2a\u52a0\u901f\u5c0f\u7a0b\u5e8f\uff0c\u903b\u8f91\u5f88\u7b80\u5355\uff0c\u4f46\u540e\u6765\u9010\u6e10\u53d1\u73b0\u9700\u6c42\u8d8a\u6765\u8d8a\u591a\uff0c\u4e3b\u8981\u662f\u754c\u9762\u4e0a\u7684\uff0c\u52a8\u753b\u4e0a\u7684\uff0c\u8fd8\u6709\u4e00\u4e9b\u975e\u6280\u672f\u56e0\u7d20\u7684\u529f\u80fd\uff0c\u55ef\u3002\u8fd9\u5176\u5b9e\u7b97\u662f\u4e00\u4e2a\u4e0d\u5927\u597d\u7684\u8f6f\u4ef6\u5de5\u7a0b\u6848\u4f8b\u3002</p>","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u7ebf\u4e0a\u7684\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848","title":"\u7ebf\u4e0a\u7684\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848","text":"<p>\u7136\u540e\u5c31\u662f\u4e0a\u7ebf\u4e86\u3002\u5927\u6982\u662f\u6628\u5929\uff082018-12-27\uff09\u4e2d\u5348\u7684\u65f6\u5019\u63a8\u9001\u53d1\u51fa\u53bb\uff0c\u5f88\u5feb\u6d41\u91cf\u5c31\u5f00\u59cb\u6765\u4e86\u3002\u5f88\u5feb\uff0c\u5728\u670b\u53cb\u5708\u770b\u5230\u6709\u540c\u5b66\u5728\u8f6c\u53d1\u4e86\uff0c\u4e5f\u6709\u4eba\u53cd\u6620\u8bf4\uff0c\u7f51\u7edc\u6709\u70b9\u5361\uff0c\u52a0\u8f7d\u8d44\u6e90\u6709\u70b9\u591a\u3002\u6211\u53bb\u673a\u5668\u4e0a\u7528 iftop \u770b\u4e86\u4e0b\uff0c\u6d41\u91cf\u5927\u6982\u662f 250Mb/s\uff0c\u6ca1\u6253\u5230\u5343\u5146\u3002\u6211\u4e00\u5f00\u59cb\u770b\u4e86\u4e0b\uff0cCPU \u548c\u5185\u5b58\u5360\u7528\u90fd\u826f\u597d\uff0c\u4ee5\u4e3a\u662f\u7f51\u7edc\u51fa\u53e3\u9650\u5236\u7684\u95ee\u9898\uff0c\u5c31\u60f3\u7740\u6ca1\u529e\u6cd5\u4e86\uff0c\u5c31\u8fd9\u6837\u5427\uff0c\u625b\u8fc7\u53bb\u518d\u8bf4\u3002\u4e0d\u8fc7\uff0c\u5ffd\u7136\u6709\u4e86\u8f6c\u673a\u3002</p> <p>TUNA \u6280\u672f\u7fa4\u91cc\uff0c\u5ffd\u7136\u6709\u4eba\u5728\u8ba8\u8bba SOMAXCONN \u7684\u95ee\u9898\uff0c\u6211\u60f3\u5230\uff0c\u4f1a\u4e0d\u4f1a\u662f\u6709\u4e9b\u53c2\u6570\u6ca1\u5f00\u591f\u5927\uff0c\u5bfc\u81f4\u4e86\u6027\u80fd\u74f6\u9888\uff0c\u53c8\u53d7\u5230\u554a\u8363\u7684\u70b9\u62e8\uff0c\u7acb\u9a6c\u8c03\u6574\u4e86\u8fd9\u4e9b\u53d8\u91cf\uff1a</p> <pre><code>net.core.somaxconn\nfs.file-max\nnet.core.netdev_max_backlog\nnet.ipv4.tcp_max_syn_backlog\nnginx: worker_rlimit_nofile\nnginx: event.worker_connections\n</code></pre> <p>\u5f88\u5feb\u5e26\u5bbd\u4ece 200Mb/s \u5de6\u53f3\u6253\u5230\u4e86 400Mb/s \u591a\uff0c\u5728 iftop \u4e2d\u770b\u5230\u7684\u5cf0\u503c\u63a5\u8fd1 600Mb/s\uff0c\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e8b\u540e\u56de\u6765\u770b\uff0c\u53d1\u73b0\u914d\u7f6e\u4e00\u5957\u79d1\u5b66\u7684\u76d1\u63a7\u7cfb\u7edf\u771f\u7684\u5f88\u6709\u7528\uff0c\u5982 TCP \u8fde\u63a5\u7684\u72b6\u6001\u56fe\uff1a</p> <p></p> <p>\u8fd9\u91cc\u6700\u9ad8\u7684\u9ec4\u7ebf\u4ee3\u8868\u7684\u662f TIME_WAIT\uff0c\u610f\u5473\u7740\u5f88\u591a\u7684 TCP \u8fde\u63a5\u90fd\u5361\u5728\u4e86\u7b49\u5f85\u8d44\u6e90\u4e0a\uff0c\u800c\u4e00\u5f53\u6211\u4fee\u6539\u53c2\u6570\u4ee5\u540e\uff0c\u7acb\u523b\u5c31\u964d\u4e86\u4e0b\u6765\uff0cESTBALISHED \u7684\u8fde\u63a5\u6709\u4e86\u663e\u8457\u7684\u63d0\u5347\u3002\u8fd9\u4e2a\u95ee\u9898\u4ece\u53e6\u4e00\u4e2a\u56fe\u4e5f\u53ef\u4ee5\u660e\u5730\u770b\u51fa\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u56fe\u662f TCP Handshake Issues\uff0c\u53ef\u4ee5\u770b\u5230\u65e0\u8bba\u662f activeopen \u8fd8\u662f passiveopen\uff0c\u90fd\u5f88\u9ad8\uff0c\u610f\u5473\u7740\u8fd9\u91cc\u65e0\u8bba\u662f\u53d1\u8fd8\u662f\u6536\u90fd\u9047\u5230\u4e86\u95ee\u9898\u3002\u800c\u4fee\u6539\u53c2\u6570\u4ee5\u540e\uff0c\u8fd9\u4e9b\u95ee\u9898\u7acb\u9a6c\u5f97\u5230\u4e86\u5f88\u597d\u7684\u6539\u5584\u3002</p> <p>\u5176\u5b9e\u8fd9\u4e9b\u672c\u5e94\u8be5\u5728\u4e0a\u7ebf\u524d\u505a\u597d\u7684\uff0c\u4f46\u6211\u4f4e\u4f30\u4e86\u6e05\u534e\u5927\u5b66\u7684\u5f71\u54cd\u529b\uff0c\u6ca1\u6709\u505a\u597d\u76f8\u5e94\u7684\u51c6\u5907\uff0c\u8fd8\u662f\u5728\u4f18\u79c0\u7684\u8fd0\u7ef4\u4eba\u5458\u7684\u6307\u70b9\u4e0b\u5f97\u5230\u4e86\u8f83\u597d\u7684\u6548\u679c\u3002</p>","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u7528\u6237\u6570\u636e\u5206\u6790","title":"\u7528\u6237\u6570\u636e\u5206\u6790","text":"<p>\u5f53\u7136\u4e86\uff0c\u9664\u4e86 Grafana+InfluxDB+Telegraf \u8fd9\u4e00\u5957\u76d1\u63a7\u7cfb\u7edf\uff0c\u6211\u4eec\u4e5f\u90e8\u7f72\u4e86 ElasticSearch+Logstash+Kibana\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u8fd8\u662f\u7528 Grafana \u505a\u4e86 ElasticSearch \u7684\u524d\u7aef\u4e86\u3002\u901a\u8fc7\u5bf9 Nginx \u65e5\u5fd7\u7684\u5206\u6790\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u8fd9\u4e9b\u5173\u952e\u7684\u6570\u636e\uff08\u4ece 12-26 12:00 \u5230 12-27 12:00 \u4e00\u5929\u65f6\u95f4\uff09\uff1a</p> <p></p> <p></p> <p>\u9664\u4e86\u8fd9\u4e9b\uff0c\u8fd8\u6709\u5f88\u591a\u6709\u8da3\u7684\u6570\u636e\uff0c\u4f8b\u5982\u7528\u6237\u91cc\u5317\u4eac\u7684\u6700\u591a\uff0c\u4e5f\u53ef\u4ee5\u5927\u81f4\u5730\u770b\u51fa\u5404\u4e2a\u5730\u65b9\u7f51\u7edc\u548c\u624b\u673a\u7684\u666e\u53ca\u7a0b\u5ea6\uff1b\u7528\u6237\u4f7f\u7528\u7684\u624b\u673a\u7684\u673a\u578b\u91cc\u524d\u51e0\u540d\u90fd\u662f\u82f9\u679c\u7684\uff0c\u4ece\u5355\u9879\u5360\u9886\u4e86\u6392\u540d\u7684\u524d\u5f88\u591a\u4f4d\uff0c\u4e4b\u540e\u5219\u662f\u534e\u4e3a\u5c0f\u7c73 OPPO \u7b49\uff0c\u4f46\u603b\u4f53\u4e0a\u53cd\u800c\u662f\u5b89\u5353\u7528\u6237\u66f4\u591a\u3002</p> <p>\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u5b98\u65b9\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6570\u636e\u7edf\u8ba1\u53ef\u4f9b\u53c2\u8003\u3002\u4f8b\u5982\u9875\u9762\u7684\u8bbf\u95ee\u6b21\u6570\u4fe1\u606f\uff0c\u4e00\u5171\u5927\u7ea6\u6709\u4e8c\u5341\u591a\u4e07\u6b21\uff0c\u6253\u5f00\u5c0f\u7a0b\u5e8f\u6709\u5341\u4e09\u4e07\u591a\u6b21\uff0c\u8bbf\u95ee\u4eba\u6570\u662f\u4e94\u4e07\u591a\uff0c\u8fd8\u6709\u5973\u6027\u7528\u6237\u6bd4\u7537\u6027\u7528\u6237\u591a\u7b49\u7b49\u3002\u8fd9\u4e2a\u65f6\u4ee3\uff0c\u6709\u6570\u636e\u786e\u5b9e\u80fd\u591f\u5f97\u5230\u8bb8\u591a\u6709\u4ef7\u503c\u7684\u5224\u65ad\u3002</p>","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2018/12/27/wxapp-recap/#\u53cd\u601d","title":"\u53cd\u601d","text":"<p>\u8fd9\u6b21\u5b66\u5230\u4e86\u5f88\u591a\u4e1c\u897f\uff0c\u9a8c\u8bc1\u4e86\u76d1\u63a7\u7cfb\u7edf\u7684\u5fc5\u8981\u6027\uff0c\u5b83\u80fd\u591f\u5b9e\u65f6\u770b\u5230\u670d\u52a1\u7684\u8fd0\u884c\u72b6\u6001\u5e76\u8fdb\u884c\u8c03\u4f18\uff0c\u4e8b\u540e\u4e5f\u53ef\u4ee5\u56de\u8fc7\u5934\u6765\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5206\u6790\u548c\u603b\u7ed3\u3002\u4e0d\u8db3\u7684\u662f\uff0c\u9047\u5230\u5927\u5ba2\u6237\u91cf\u7684\u65f6\u5019\uff0c\u9759\u6001\u8d44\u6e90\u5c31\u5e94\u8be5\u7528 CDN \u670d\u52a1\u800c\u4e0d\u5e94\u8be5\u81ea\u5df1\u642d\u5efa\uff0c\u6210\u672c\u4e0d\u9ad8\u800c\u4e14\u7528\u6237\u4f53\u9a8c\u4f1a\u5f88\u597d\u3002\u8fd9\u6b21\u540e\u7aef\u5728\u6570\u636e\u5e93\u64cd\u4f5c\u90fd\u7528\u4e86\u539f\u5b50\u64cd\u4f5c\uff0c\u6ca1\u6709\u51fa\u73b0\u5927\u7684\u95ee\u9898\uff0c\u4f46\u5982\u679c\u4ee5\u540e\u9047\u5230\u66f4\u590d\u6742\u7684\u9700\u6c42\u7684\u65f6\u5019\u5c31\u6ca1\u6709\u8fd9\u4e48\u5bb9\u6613\u4e86\u3002</p>","tags":["wechat","wxapp","grafana","elk","mongodb"]},{"location":"software/2021/12/29/xrdp-nvidia/","title":"XRDP \u548c NVIDIA \u663e\u5361\u517c\u5bb9\u6027\u95ee\u9898","text":"","tags":["linux","nvidia","xrdp","rdp"]},{"location":"software/2021/12/29/xrdp-nvidia/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u5c1d\u8bd5\u914d\u7f6e XRDP\uff0c\u53d1\u73b0\u5b83\u5728\u6709 NVIDIA \u7684\u673a\u5668\u4e0a\u542f\u52a8\u8fdc\u7a0b\u684c\u9762\u540e\u4f1a\u9ed1\u5c4f\uff0c\u67e5\u770b\u9519\u8bef\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\uff1a</p> <pre><code>xf86OpenConsole: Cannot open virtual console 1 (Permission denied)\n</code></pre> <p>2024 \u5e74\u6ce8\uff1a\u4e00\u4e9b\u6bd4\u8f83\u65b0\u7684\u53d1\u884c\u7248\u4e0a\u643a\u5e26\u7684 xrdp \u5df2\u7ecf\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u6b64\u5916\u4e0d\u8981\u5fd8\u8bb0\u5b89\u88c5 xorgxrdp\u3002</p>","tags":["linux","nvidia","xrdp","rdp"]},{"location":"software/2021/12/29/xrdp-nvidia/#\u89e3\u51b3\u65b9\u6cd5","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>XRDP \u4f5c\u8005\u5728 issue #2010 \u4e2d\u63d0\u5230\u4e86\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <p>\u4fee\u6539 /etc/xrdp/sesman.ini\uff0c\u5728 <code>[Xorg]</code> \u90e8\u5206\u91cc\u52a0\u4e0a\u4e0b\u9762\u7684\u914d\u7f6e\uff1a</p> <pre><code>param=-configdir\nparam=/\n</code></pre> <p>\u5b9e\u9645\u4e0a\u5c31\u662f\u4e0d\u8ba9 Xorg \u52a0\u8f7d nvidia xorg \u9a71\u52a8\uff0c\u8fd9\u6837\u5c31\u7ed5\u8fc7\u4e86\u95ee\u9898\u3002</p>","tags":["linux","nvidia","xrdp","rdp"]},{"location":"software/2018/11/26/zfs-on-macos-and-linux/","title":"Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999","text":"<p>\u6700\u8fd1\u5728 Mac \u4e0a\u88c5\u4e86 Arch Linux\uff0c\u6309\u7167 Mac - Arch Linux Wiki \u4e00\u8def\u4e00\u8def\u8d70\uff0c\u521b\u5efa\u5355\u72ec\u7684\u4e00\u4e2a EFI \u5206\u533a\u7ed9 Arch Linux \u653e GRUB \u548c\u5185\u6838\uff0c\u4e00\u4e2a ext4 \u4f5c\u4e3a\u6839\u5206\u533a\u3002\u7531\u4e8e Arch ISO \u4e0d\u652f\u6301 Broadcom \u7684\u65e0\u7ebf\u7f51\u5361\uff0c\u4e8e\u662f\u5148\u62ff Apple Ethernet Adapter \u8fde\u5230\u8def\u7531\u5668\u4e0a\u88c5\u673a\u3002\u7136\u540e\u628a\u4e00\u4e9b\u9700\u8981\u7684\u9a71\u52a8\u88c5\u4e0a\u4e86\uff0c\u684c\u9762\u7528\u7684 KDE Plasma\uff0cTrackpad \u7528\u7684 xf86-input-mtrack-git\uff0cHiDPI \u8bbe\u7f6e\u4e3a 2x Scale\uff0c\u5404\u79cd\u4f53\u9a8c\u90fd\u8fd8\u53ef\u4ee5\uff0c\u5c31\u662f Wi-Fi \u7684 802.1X \u6ca1\u914d\u7f6e\u597d\uff0c\u7136\u540e kwalletd5 \u8001\u662f\u5d29\u6ca1\u627e\u5230\u539f\u56e0\u3002\u5e38\u89c1\u7684\u5e94\u7528\u9664\u4e86\u5fae\u4fe1\u57fa\u672c\u90fd\u6709\uff0c\u4e5f\u7ec8\u4e8e\u53ef\u4ee5\u4f53\u9a8c Steam Play\uff0c\u5229\u7528 Proton \u5728 Linux \u4e0a\u8dd1\u4e00\u4e9b\u53ea\u652f\u6301 Windows \u7684\u6e38\u620f\uff0c\u4e0d\u8fc7\u6211\u5df2\u7ecf\u5f88\u5c11\u73a9\u6e38\u620f\u4e86\u3002</p> <p>\u7136\u540e\u6211\u5c31\u60f3\uff0c\u600e\u4e48\u505a macOS \u548c Linux \u4e4b\u95f4\u7684\u6587\u4ef6\u5171\u4eab\u3002\u5178\u578b\u7684\u64cd\u4f5c\u53ef\u80fd\u662f exFAT\uff0c\u4f46\u662f\u4f5c\u4e3a\u6570\u636e\u76d8\u7684\u8bdd\uff0c\u8fd9\u8fd8\u662f\u4e0d\u5927\u9002\u5408\u3002\u6216\u8005\u5c31\u76f4\u63a5\u7528 ext4\uff0c\u914d\u5408 extFS For Mac by Paragon \u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\uff0c\u6700\u540e\u6211\u9009\u62e9\u4e86 ZFS\u3002</p> <p>\u5728 macOS \u4e0a\u5b89\u88c5 OpenZFS on OSX \uff0c\u5728 Linux \u4e0a\u5b89\u88c5 ZFS on Linux \u3002\u5177\u4f53\u547d\u4ee4\u5c31\u662f\uff1a</p> <pre><code>$ brew cask install openzfs # macOS\n$ yay zfs-dkms-git # Arch Linux\n</code></pre> <p>\u7531\u4e8e\u786c\u76d8\u7a7a\u95f4\u6240\u9650\uff0c\u6211\u53ea\u7528\u4e86\u4e00\u4e2a\u5206\u533a\u4f5c\u4e3a vdev\uff0c\u6ca1\u6709\u91c7\u7528 mirror\u3001raidz \u7b49\u65b9\u6848\u3002\u6211\u9996\u5148\u5728 macOS \u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a zpool\uff0c\u53c2\u8003 Creating a pool - OpenZFS on OSX \uff1a</p> <pre><code>$ sudo zpool create -f -o ashift=13 Data diskxsy\n</code></pre> <p>\u6b64\u65f6\u5e94\u8be5\u80fd\u591f\u770b\u5230 /Volumes/Data \u4e0a\u5df2\u7ecf\u6302\u8f7d\u4e86\u4e00\u4e2a ZFS Dataset\u3002\u6211\u91c7\u7528 cbreak-black/ZetaWatch \u5728\u83dc\u5355\u680f\u91cc\u67e5\u770b ZFS \u4fe1\u606f\u3002\u6b64\u65f6\u56de\u5230 Arch Linux \u4e0a\uff0c\u901a\u8fc7 <code>zfs import</code> \u53ef\u4ee5\u627e\u5230\u5e76\u4e14\u6302\u8f7d\u8fd9\u4e2a ZFS Dataset \u5230 <code>/Data</code> \u5904\u3002</p> <p>\u6211\u8fd8\u5c1d\u8bd5\u521b\u5efa\u4e86\u4e00\u4e2a\u52a0\u5bc6\u7684 ZFS Dataset\uff0c\u5bf9\u52a0\u5bc6\u7684\u90e8\u5206\u7684\u7c92\u5ea6\u63a7\u5236\u53ef\u4ee5\u5f88\u7ec6\u3002\u53e6\u5916\uff0c\u6211\u53c2\u8003 Time Machine Backups - OpenZFS on OSX \u4e5f\u5728\u79fb\u52a8\u786c\u76d8\u4e0a\u5212\u51fa\u4e00\u4e2a\u65b0\u7684\u5206\u533a\u4f5c\u4e3a ZFS\uff0c\u5728\u4e0a\u9762\u521b\u5efa\u4e86\u4e00\u4e2a\u52a0\u5bc6\u7684 Sparse Bundle\uff0c\u628a\u5b83\u4f5c\u4e3a Time Machine \u7684\u76ee\u6807\u3002\u4e4b\u540e\u8fd8\u4f1a\u5c1d\u8bd5\u4e00\u4e0b <code>zfs send</code> \u4f5c\u4e3a\u66ff\u4ee3\u7684\u5907\u4efd\u65b9\u6848\u3002</p>","tags":["linux","zfs","macos","timemachine","backup"]},{"location":"speech/2016/03/19/listen-and-write-subtitles-cameron/","title":"Listen and write down subtitles of Cameron's speech","text":"<p>Here is the subtitle: <pre><code>We meet in a week that could change the United Kingdom for ever. Indeed, it could end the United Kingdom as we know it. On Thursday, Scotland votes, of the future of our country is at stake. On Friday, people could be living in a different country with a different place in the world and the different future ahead of it. This is the decision that could break up our family of nations and rips Scotland from rest of the United Kingdom. And we must be very clear, there is no going back from this. No re-run. This is a once and for all decision. If Scots vote 'yes', the U.K. will split and we will go on separate ways forever. When people vote on Thursday, they are not just voting for themselves, but for their children and grandchildren and the generations beyond. So I want to speak very directly to the people this country today about what is at stake. I believe I speak for millions of people across England, Wales, and North Ireland and many in Scotland too who would be utterly heart-broken by the break-up of the United Kingdom, utterly heart-broken to wake up on Friday morning, to the end of the country we love, to know that Scots will no longer join with the English, welsh-man, Irish, in the army, navy, and air force. [???] U.K. white celebrations and commemorations [???] U.K.'s fourteen teams in the Olympics to the British lines. The United Kingdom, would be no more, no U.K. pension, no U.K. passports, no U.K. pound. The greatest example of the [???] in the world have ever known of openness of people of different nationalities and face coming together as one, would be no more. It would be the end of the country that lodged the enlightenment(?) and abolished the slavery and drove the industrial revolution and defeated fascism. The end of a country that people around the world respect and admire. The end of a country that all of us call home. And you know what, we built this home together. It's only become Great Britain, because of the greatness of Scotland because of the thinkers the writers the artists the leaders the soldiers and inventors that make this country what it is. It's Alexander Fleming and David Hume J.K. Rowling Andy Murray and all the millions of people who play the part in this extraordinarily success story. The Scots who let the charge on pensions and the [???] and social justice we did all this together. For the people of Scotland to walk away now, we will be like painstakingly building a home and then [???] the door and throwing away the keys. So I would say that everyone voting on Thursday, please remember this is just [???] country. This is the United Kingdom. This is our country. And you know what makes it a truly great country, it is not a [???]. It is our values. British values. Fan of freedom, justice. The values that say wherever you are whoever you are, your life has dignity and worth. The values that say we don't work on by when the people are sick. We do not ask for your credit card in the hospital. We don't turn our backs when you get old and frail. We don't turn a blind eye or cold heart to people around the world from repair and cry and for help. This is what Britain means. This is what makes our country 'Yes the greatest on Earth'! And it is why millions of us could not bear to see that country ending for good for ever on Friday. Now i know that many people across Scotland were planning to vote yes. I understand why this might sound appealing. It is the promise of something different. I also know that the people who running the 'yes' campaign painting a picture of Scotland that is better than everywhere. And they can be good painting the picture. But when something looks too good to be true, that is usually because it is. And it's my duty to be clear about the lightly consequences of a 'yes' vote. Independence, would not be a trial separation but would be a painful divorce. As a Prime Minister, I have to tell you what that would mean. It would mean we no longer share the same currency. It would mean the arm forces we built up together over centuries being splitted up for ever. It would mean our pension funds being sliced up at some cost. It would mean the borders we have would become international and may no longer be so easily crossed. It would mean the automatic support that you currently get from British embassies when you are traveling around world the that would come to end. It would mean over half of Scottish [???] suddenly from one day to the next begin provided by banks in a foreign country. It would mean the interest rates in Scotland are no longer set by the bank with England's robust ability and security that promises. And it would mean for many banks that remain in Scotland, if they ever gotten to travel, it will be Scotish taxpayers and Scottish taxpayers and loan, that will bare the costs. It would mean that we no longer pull exhausted across the whole of out United Kingdom to pay for institutions [???] national health service or our welfare system. This is what guess work, there are no question marks, no maybe this, or maybe that. The nationalists want to break up U.K. funding on pensions, the U.K. funding on health care, the U.K. funding and comprehensive protection on national security. These are the facts. This is what would happen and end to the things that we should share together. And people in Scotland must know these facts before they make this once and for all decision. And one of the consequences is not to scare [???]. It is like warning a friend about the decision that they might take that will affect the rest of their lives and the lives of their children. I [???] this because I don't want the people of the Scotland to be sold a dream that disappears. Now I know that some people say we have heard about the risks and uncertainties, but we still want change. And look, the United Kingdom is not a perfect country. The country is, of course, constantly changing and improve people's lives. No one is content when there are still children living in poverty. No one is content when there are people struggling and the young people not reaching their full potential. And yes, of course, every political party is different, but all of us, all of us, conservatives, labor, [???], nationalists, we are all on a constant mission to change our country for the better. The question is, how to you get that change. And for me, it is simple. You don't get the change you want, by ripping your country apart. You don't get change by underlying your economy and damaging your businesses and diminishing your place in the world. But you can't get real concrete change on Thursday. If you vote 'no', businesses usual is not on the [???] paper. The status clown is gone. The campaign has swepted away. There is no going back to the way things were. A vote for 'no', means real change. If we [???] that change in practical terms, with a plan and a process. If we gotta know vote on Thursday that will trigger a major unpresidentive program of devolution with the [???] powers for the Scottish [???]. Major new powers will protest spending. Some welfare services will have agreed that time table for that stronger Scottish [???], a timetable for bringing that new powers that will go ahead in frozen [???]. White paper by November put into draft [???] by January, this is the timetable that is now agreed by all the main political parties in [???]. And I am prepared to work with all the main parties to deliver this during 2015. So a 'no' vote actually means faster, fairly, safer and better change. And this is vital point. Scotland is not a observer in this fairs of this country. Scotland is shaping and changing the United Kingdom for the better. Also did they [???] at any point in the last three hundred years. And Scotland will continue to help shape the constitution of our country. And Scottish people who enjoys the [???]  without losing the U.K. pension, the U.K. pound and the U.K. passport. Real change is Scotland's for the taking. The [???] and make [???] decisions but with this security and being in the United Kingdom and with idol risks of [???] alone. It is the both well or both worse. The Scotland's identity is your [???] strong Scottish culture, strong Scottish art, and strong [???] Scotland. And in the last fifteen years, you built a strong British [???]. Not all [???] institutions but a permanent one. So the vote on Thursday, it is not about whether Scotland is a nation. Scotland is a proud strong successful nation. The vote on Thursday is about two competing nations for Scotland's future. And that's the nationalist's vision. Narrowing down, going alone, breaking all ties with the United Kingdom. Or there is the patriotic vision, they strongs Scottish nation allied to the rest of the United Kingdom with its own strong Scottish Parliament. And it's hard. And with the benefit of working together in the U.K on [???] on pensions on health care funding, currency and interest rates. It is really the best of both wills. And it's the best way to get real change and secure a better future for your children and your grandchildren which all this vital debate is all about. [Clap Drink Water] And speaking of family, there is quite simply how I feel about all of this. We're a family. The United Kingdom is not one nation. We are four nations in a single country. That could be difficult but it is wonderful. Scotland, England, Welsh, North Ireland, different nations with individual identities competing with each other, even in time in raging each other. But It still mean so much stronger together. We're a family of nations. And why should the generations of that family be forced to choose whether to identiy only with their emperor or only with London. Why should they have to choose which embassy they want to go to when they are in trouble abroad. Or pack that passport when they go to see friends, loved ones and family. A family is not a compromise or second best. It is the magical identity that makes us more together than we can ever be apart. So please, do not break this family apart. In human relations, it is almost no good thing to turn away from each other to put up walls or score new lines on the map. Why should we take one Great Britain and turn it into separate smaller nations. What is that an answer to? How will that help ambitious young people who wanna make the mock on the world. Or [???] just want security. Or the family relying on jobs that will made in the U.K. Let no one fool you, that 'yes' is a positive vision. It is about dividing people. It is about closing doors. It is about making forigners our friends and family. That is not a optimistic vision. [Clap] The optimistic vision is about our family of nations staying together. Therefore, each other in the hard times, coming through the better times, we're just pulled through the great reception together. If we're not moving forward together, the road had been longer but it is finally lead upwards. And that's why I ask you to vote 'no' to walking away. Vote 'no' &amp; you are voting for a bigger and broader and better future of Scotland. And you are investing in the future for your children and grandchildren. So this is our message to the people of Scotland: we want you to stay. Head hard and sow we want you to stay. Please don't mix up the temporary and permanent. Please don't think I am frustrated with politics right now and I just walk out of the door and never come back. If you don't like me, I won't be here for ever. If you don't like this government, it won't last for ever. But if you leave the United Kingdom, that will be for ever. Yes, the different parts of the U.K. do not always see eye to eye. Yes we need change, we'll deliver it. But to get that change together bright future would don't need to tear our country apart. [Yeah and Clap] In two days' time, this long campaign will be to an end. And you stand on the [???] of the billing board. I hope you ask yourself this: will my family and I truly be better off? By going alone? Will we really be more save and secure? Do I really want to turn my back on the rest of Britain? And why it is that so many people across the world asking why would Scotland want to do that? Why? And if you don't know the answers of these questions, then please vote 'no'. At the end of the day, all the eyes on this campaign can be rejuiced to a single fact. We are better together. As you reach your final decision, please, please, don't let anyone tell you you can't be a pride Scot and a pribe Brit. [Clap] Please, don't lose faith in what this country is and what we can be. Don't forget what a great United Kingdom you are a part of. Don't turn you back to what is the best family in the nations in the world. And the best hope for your family in this world. So please from all of us, vote to stick together, vote to stay, vote to save our United Kingdom. Thank you. [Clap and The End].\n</code></pre></p>","tags":["cameron","subtitles"]},{"location":"system/2023/04/09/aix/","title":"AIX 7.2 \u865a\u62df\u673a\u5b89\u88c5","text":"","tags":["aix","unix"]},{"location":"system/2023/04/09/aix/#\u5b89\u88c5\u8fc7\u7a0b","title":"\u5b89\u88c5\u8fc7\u7a0b","text":"<p>\u5bbf\u4e3b\u673a\u73af\u5883\u662f Debian bookworm\uff0c\u4e0d\u9700\u8981\u50cf\u5176\u4ed6\u6559\u7a0b\u90a3\u6837\u81ea\u5df1\u7f16\u8bd1 qemu\uff0c\u76f4\u63a5 apt install \u5373\u53ef\u3002</p> <p>\u901a\u8fc7 google \u53ef\u4ee5\u641c\u7d22\u5230 AIX 7.2 \u7684 ISO\uff0c\u4e0b\u8f7d\u7b2c\u4e00\u4e2a ISO \u5230\u672c\u5730\uff0c\u7136\u540e\u5728 QEMU \u4e2d\u542f\u52a8\u5b89\u88c5\u955c\u50cf\uff1a</p> <pre><code>qemu-img create -f qcow2 aix-hdd.qcow2 20G\nqemu-system-ppc64 -cpu POWER8 -machine pseries -m 16384 -serial mon:stdio -drive file=aix-hdd.qcow2,if=none,id=drive-virtio-disk0 -device virtio-scsi-pci,id=scsi -device scsi-hd,drive=drive-virtio-disk0 -cdrom aix_7200-04-02-2027_1of2_072020.iso -prom-env boot-command='boot cdrom:\\ppc\\chrp\\bootfile.exe' -display none\n</code></pre> <p>\u8fdb\u53bb\u4ee5\u540e\uff0c\u8010\u5fc3\u7b49\u5f85\uff0c\u76f4\u5230\u8fdb\u5165\u5b89\u88c5\u754c\u9762\uff0c\u6309\u7167\u63d0\u793a\u8fdb\u884c\u5b89\u88c5\uff0c\u5efa\u8bae\u5b89\u88c5\u4e0a SSH Server\uff0c\u5173\u6389\u56fe\u5f62\u754c\u9762\uff0c\u8fd9\u6837\u5b89\u88c5\u4f1a\u6bd4\u8f83\u5feb\u3002\u5b89\u88c5\u9700\u8981\u51e0\u5341\u5206\u949f\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u4f1a\u8fdb\u5165 bootloop\uff0c\u5173\u6389 QEMU\u3002\u63a5\u7740\uff0c\u51c6\u5907\u597d\u7f51\u7edc\uff1a</p> <pre><code>sudo ip tuntap add tap0 mode tap\nsudo ip link set tap0 up\nsudo ip a add 10.0.2.15/24 dev tap0\n</code></pre> <p>\u518d\u542f\u52a8\u865a\u62df\u673a\uff0c\u6ce8\u610f\u542f\u52a8\u9009\u9879\u4fee\u6539\u4e86\uff0c\u5e76\u4e14\u591a\u4e86\u7f51\u7edc\u7684\u914d\u7f6e\uff1a</p> <pre><code>qemu-system-ppc64 -cpu POWER8 -machine pseries -m 16384 -serial mon:stdio -drive file=aix-hdd.qcow2,if=none,id=drive-virtio-disk0 -device virtio-scsi-pci,id=scsi -device scsi-hd,drive=drive-virtio-disk0 -cdrom aix_7200-04-02-2027_1of2_072020.iso -prom-env boot-command='boot disk:' -display none -net nic -net tap,script=no,ifname=tap0\n</code></pre> <p>\u7b2c\u4e00\u6b21\u542f\u52a8\u7cfb\u7edf\u65f6\uff0c\u4f1a\u8fdb\u5165\u914d\u7f6e\u754c\u9762\uff0c\u4fee\u6539\u597d root \u5bc6\u7801\uff0c\u7136\u540e\u914d\u7f6e\u7f51\u7edc\uff1a</p> <pre><code>chdev -l en0 -a netaddr=10.0.2.16 -a netmask=255.255.255.0 -a state=up\n</code></pre> <p>\u5230\u8fd9\u91cc\u4e86\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 ssh \u8bbf\u95ee\u865a\u62df\u673a\uff1a</p> <pre><code>ssh root@10.0.2.16\n</code></pre>","tags":["aix","unix"]},{"location":"system/2023/04/09/aix/#kvm","title":"KVM","text":"<p>\u53e6\u5916\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u5728 powerpc64 \u673a\u5668\u4e0a\uff0c\u53ef\u4ee5\u5f00\u542f KVM \u6765\u52a0\u901f QEMU\uff0c\u4f46\u662f\u9700\u8981\u9996\u5148\u5173\u6389 SMT\u3002\u53e6\u5916\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u7384\u5b66\u95ee\u9898\uff0c\u6700\u540e\u8fd8\u662f\u5728 x86 \u4e0a\u8dd1\u4e86\u865a\u62df\u673a\u3002</p>","tags":["aix","unix"]},{"location":"system/2023/04/09/aix/#\u5b89\u88c5\u8f6f\u4ef6","title":"\u5b89\u88c5\u8f6f\u4ef6","text":"<p>\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u4ece AIX Toolbox for Open Source Software \u5b89\u88c5\u8f6f\u4ef6\uff1a</p> <pre><code># in aix\nchfs -a size=+200M /home\nchfs -a size=+400M /opt\nchfs -a size=+400M /tmp\n# setup default gateway\nroute add 0 10.0.2.15 -if en0\n# edit /etc/resolv.conf\necho \"nameserver 1.1.1.1\" &gt; /etc/resolv.conf\n# in host\nwget https://public.dhe.ibm.com/aix/freeSoftware/aixtoolbox/ezinstall/ppc/dnf_aixtoolbox.sh\nscp dnf_aixtoolbox.sh root@10.0.2.16:/\n# in aix\nrpm --rebuilddb\nksh /dnf_aixtoolbox.sh -y\n/opt/freeware/bin/dnf update\n/opt/freeware/bin/dnf install gcc\n</code></pre> <p>\u5b89\u88c5\u597d\u7684\u5305\u4f1a\u653e\u5230 /opt/freeware \u8def\u5f84\u4e0b\u3002</p> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9700\u8981\u7ee7\u7eed\u6269\u5927\u5404\u4e2a fs \u7684\u5927\u5c0f\u3002</p> <p>dnf \u5982\u679c\u63d0\u793a\u7f3a\u5c11 <code>libssl.a</code>\uff0c\u53c2\u8003 https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors \u8fdb\u884c\u89e3\u51b3\uff1a</p> <ol> <li> <p>\u8bbf\u95ee https://www.ibm.com/resources/mrs/assets?source=aixbp&amp;S_PKG=openssl \u4e0b\u8f7d\u5b89\u88c5\u5305\uff0c\u4f8b\u5982 <code>openssl-1.1.2.2000.tar.Z</code>\u3002</p> </li> <li> <p>scp \u5230 AXI \u4e0a\u5b89\u88c5\uff1a</p> </li> </ol> <pre><code>uncompress openssl-1.1.2.2000.tar.Z\ntar -xvf openssl-1.1.2.2000.tar\n# install openssl.base using smitty\n</code></pre> <p>\u4e3a\u4e86\u65b9\u4fbf\uff0c\u53ef\u4ee5\u4fee\u6539 <code>/etc/environment</code> \u6587\u4ef6\uff0c\u628a <code>/opt/freeware/bin</code> \u76ee\u5f55\u52a0\u5230 PATH \u76ee\u5f55\u4e2d\u3002</p>","tags":["aix","unix"]},{"location":"system/2023/04/09/aix/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<p>\u672c\u535a\u5ba2\u53c2\u8003\u4e86\u4ee5\u4e0b\u6587\u6863\u4e2d\u7684\u547d\u4ee4\uff1a</p> <ul> <li>https://aix4admins.blogspot.com/2020/04/qemu-aix-on-x86-qemu-quick-emulator-is.html</li> <li>https://virtuallyfun.com/2019/04/22/installing-aix-on-qemu/</li> <li>https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors</li> </ul>","tags":["aix","unix"]},{"location":"system/2020/01/05/archer-t4u-v3-driver/","title":"TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5","text":"<p>\u4e4b\u524d\u56e0\u4e3a MacBookPro \u5185\u7f6e\u7684 Wi-Fi \u603b\u662f\u6709\u95ee\u9898\uff0c\u5c31\u627e\u4e86\u4e2a USB \u7684\u65e0\u7ebf\u7f51\u5361\uff1aTP-Link Archer T4U V3\uff08VID\uff1a2357\uff0cPID\uff1a0115\uff09\uff0c\u8fd9\u4e2a\u7f51\u5361\u4e5f\u6ca1\u6709\u4e3b\u7ebf\u7684\u9a71\u52a8\uff0c\u5728\u7f51\u4e0a\u627e\u5230\u4e86\u73b0\u6210\u7684\u9a71\u52a8\uff1acilynx/rtl88x2bu\uff0c\u6309\u7167 README \u7528 DKMS \u5b89\u88c5\u5373\u53ef\uff0c\u5b9e\u6d4b\u53ef\u7528\u3002</p> <p>Update: Linux 6.2+ \u5df2\u7ecf\u652f\u6301\uff0c\u89c1 https://linux-hardware.org/?id=usb:2357-0115</p>","tags":["linux","wifi","tplink","rtl8822bu","dkms"]},{"location":"system/2023/01/21/bsd-cookbook/","title":"FreeBSD/NetBSD/OpenBSD/DragonFlyBSD Cookbook","text":"","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u5728\u7ef4\u62a4 lsof \u7684\u65f6\u5019\uff0c\u9700\u8981\u5728 FreeBSD/NetBSD/OpenBSD/DragonFlyBSD \u4e0a\u8fdb\u884c\u5f00\u53d1\u548c\u6d4b\u8bd5\uff0c\u4e8e\u662f\u5c31\u88c5\u4e86\u865a\u62df\u673a\uff0c\u7279\u6b64\u8bb0\u5f55\u6211\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4e0e Linux \u4e0d\u4e00\u6837\u7684\u4e00\u4e9b\u5e38\u7528 FreeBSD/NetBSD/OpenBSD/DragonFlyBSD \u547d\u4ee4\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#freebsd","title":"FreeBSD","text":"<p>\u6587\u6863\u53c2\u8003\uff1ahttps://docs.freebsd.org/en/books/handbook</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u5728 https://www.freebsd.org/where/ \u627e\u5230\u6700\u65b0\u7248\u4e0b\u8f7d\uff0c\u5bf9\u4e8e\u865a\u62df\u673a\u7684\u9700\u6c42\uff0c\u7528 <code>-disk1.iso</code>\uff0c1 GB \u5de6\u53f3\u3002\u5b89\u88c5\u8fc7\u7a0b\u6309\u7167 UI \u4e00\u6b65\u6b65\u8d70\u5373\u53ef\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#root-\u6743\u9650","title":"root \u6743\u9650","text":"<p>FreeBSD \u7684 su \u9ed8\u8ba4\u53ea\u6709 wheel \u7ec4\u53ef\u4ee5 su \u5230 root\uff0c\u6240\u4ee5\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u5efa\u8bae\u7ed9\u521b\u5efa\u7684\u5e10\u53f7\u52a0\u4e0a wheel \u7ec4\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 pw \u547d\u4ee4\uff1a</p> <pre><code>pw groupmod wheel -m freebsd\n</code></pre> <p>sudo \u9700\u8981\u901a\u8fc7\u5305\u7ba1\u7406\u5668\u5b89\u88c5\uff0c\u7528\u6cd5\u548c Linux \u4e00\u6837\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5305\u7ba1\u7406","title":"\u5305\u7ba1\u7406","text":"<p>\u4f7f\u7528 <code>pkg</code> \u547d\u4ee4\u8fdb\u884c\u5305\u7ba1\u7406\uff1a</p> <pre><code>pkg update\npkg install -U sudo vim fish\n</code></pre> <p><code>-U</code> \u8868\u793a\u5728 install \u7684\u65f6\u5019\u4e0d\u8981\u518d update\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4ece Ports \u6e90\u7801\u7f16\u8bd1\uff0c\u5982\uff1a</p> <pre><code>git clone https://git.FreeBSD.org/ports.git /usr/ports\ncd /usr/ports/sysutils/lsof\nmake install\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5347\u7ea7","title":"\u5347\u7ea7","text":"<p>\u4f7f\u7528 <code>freebsd-update</code> \u547d\u4ee4\u5347\u7ea7\uff1a</p> <pre><code>freebsd-update fetch\nfreebsd-update install\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u7f51\u7edc\u914d\u7f6e","title":"\u7f51\u7edc\u914d\u7f6e","text":"<p>\u663e\u793a\u8def\u7531\u8868\uff1a</p> <pre><code>netstat -nr\n</code></pre> <p>\u4fee\u6539\u8def\u7531\uff1a</p> <pre><code># ip route add 1.2.3.0/24 via 4.5.6.7\nroute add -net 1.2.3.0/24 4.5.6.7\n# ip route del 1.2.3.0/24\nroute delete -net 1.2.3.0/24\n</code></pre> <p>\u7f51\u7edc\u63a5\u53e3\uff1a</p> <pre><code># ip a\nifconfig\n# ip link set dev abc up\nifconfig abc up\n# ip a add 1.2.3.4/24 dev abc\niconfig abc inet 1.2.3.4/24\n</code></pre> <p>\u7f51\u8def\u914d\u7f6e\u5728 <code>/etc/rc.conf</code>\uff1a</p> <pre><code># DHCP\nifconfig_xxx=\"DHCP\"\n# Default Gateway\ndefaultrouter=\"1.2.3.4\"\n# Static IP\nifconfig_xxx=\"inet 1.2.3.4/24\"\n# Static route\nstatic_routes=\"name1 name2\"\nroute_name1=\"-net 1.2.3.0/24 4.5.6.7\"\nroute_name2=\"-net 3.2.1.0/24 7.6.5.4\"\n# Bridge\ncloned_interfaces=\"bridge0\"\nifconfig_bridge0=\"addm net0 addm net1 up\"\nifconfig_net0=\"up\"\nifconfig_net1=\"up\"\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u6362\u6e90","title":"\u6362\u6e90","text":"<p>USTC https://mirrors.ustc.edu.cn/help/freebsd-pkg.html:</p> <pre><code>mkdir -p /usr/local/etc/pkg/repos/\necho 'FreeBSD: { url: \"pkg+http://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/quarterly\" }' \\\n        &gt; /usr/local/etc/pkg/repos/FreeBSD.conf\npkg update\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#truss","title":"truss","text":"<p>truss \u76f8\u5f53\u4e8e Linux \u4e2d\u7684 strace\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u7f16\u8bd1\u5185\u6838","title":"\u7f16\u8bd1\u5185\u6838","text":"<p>\u6587\u6863\uff1ahttps://docs.freebsd.org/en/books/handbook/kernelconfig/</p> <p>\u9996\u5148\u4e0b\u8f7d\u5185\u6838\u6e90\u7801\uff0c\u7136\u540e\u521b\u5efa\u5185\u6838\u914d\u7f6e\uff1a</p> <pre><code>cd /path/to/kernel/src\ncd sys/amd64/conf\ncp GENERIC MYKERNEL\n</code></pre> <p>\u7f16\u8bd1\u548c\u5b89\u88c5\uff1a</p> <pre><code>make buildkernel KERNCONF=MYKERNEL\nmake installkernel KERNCONF=MYKERNEL\n</code></pre> <p>\u63d0\u4ea4 patch\uff1ahttps://wiki.freebsd.org/Phabricator</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5173\u673a","title":"\u5173\u673a","text":"<p>FreeBSD \u7684 shutdown \u9ed8\u8ba4\u4f1a\u505c\u7559\u5728 halt \u7684\u72b6\u6001\uff0c\u4f46\u662f\u4e0d\u4f1a\u65ad\u7535\uff0c\u9700\u8981\u6dfb\u52a0 <code>-p</code> \u9009\u9879\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#netbsd","title":"NetBSD","text":"","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5305\u7ba1\u7406_1","title":"\u5305\u7ba1\u7406","text":"<p>\u53c2\u8003\uff1ahttps://www.netbsd.org/docs/pkgsrc/using.html</p> <p>\u4f7f\u7528 pkgin \u505a\u4e8c\u8fdb\u5236\u5305\u7684\u5305\u7ba1\u7406\uff0c\u9996\u5148\u5b89\u88c5 pkgin\uff1a</p> <pre><code>PATH=\"/usr/pkg/sbin:/usr/pkg/bin:$PATH\"\nPKG_PATH=\"https://cdn.NetBSD.org/pub/pkgsrc/packages\"\nPKG_PATH=\"$PKG_PATH/NetBSD/amd64/9.3/All/\"\nexport PATH PKG_PATH\npkg_add pkgin\n</code></pre> <p>\u5305\u7ba1\u7406\uff1a</p> <pre><code>pkgin install sudo vim fish\npkgin upgrade\n</code></pre> <p>\u548c FreeBSD \u4e00\u6837\uff0cNetBSD \u7684 su \u9ed8\u8ba4\u53ea\u6709 wheel \u7ec4\u53ef\u4ee5 su \u5230 root\uff0c\u5efa\u8bae\u5728\u5b89\u88c5\u521b\u5efa\u65b0\u7528\u6237\u7684\u65f6\u5019\u5c31\u628a\u81ea\u5df1\u7684\u5e10\u53f7\u52a0\u5165\u5230 wheel \u7ec4\u4e2d\u3002sudo \u4f7f\u7528\u4e4b\u524d\u9700\u8981 visudo \u4fee\u6539\u914d\u7f6e\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4ece\u6e90\u7801 pkgsrc \u8fdb\u884c\u7f16\u8bd1\uff0c\u5728 /usr/pkgsrc \u8def\u5f84\u4e0b\uff0c\u7f16\u8bd1\u597d\u7684\u7a0b\u5e8f\u4f1a\u5b89\u88c5\u5230 /usr/pkg/bin\u3002</p> <p>\u514b\u9686\u5e76\u521d\u59cb\u5316 pkgsrc\uff1a</p> <pre><code>cd /usr &amp;&amp; cvs -q -z2 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc\ncd /usr/pkgsrc/bootstrap\n./bootstrap\n</code></pre> <p>\u7f16\u8bd1 pkgsrc \u4e2d\u7684\u8f6f\u4ef6\uff1a</p> <pre><code>cd /usr/pkgsrc/sysutils/lsof\nmake\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u7f51\u7edc\u914d\u7f6e_1","title":"\u7f51\u7edc\u914d\u7f6e","text":"<p>\u7f51\u7edc\u914d\u7f6e\u7684\u547d\u4ee4\u548c FreeBSD \u57fa\u672c\u4e00\u6837\uff1a</p> <ul> <li><code>netstat -nr</code>\uff1a\u67e5\u770b\u8def\u7531\u8868</li> <li><code>route</code>\uff1a\u4fee\u6539\u8def\u7531\u8868</li> <li><code>ifconfig</code>\uff1a\u914d\u7f6e\u7f51\u7edc\u63a5\u53e3</li> </ul> <p>\u4f46\u662f <code>/etc/rc.conf</code> \u7684\u914d\u7f6e\u8bed\u6cd5\u4e0d\u540c\uff0c\u89c1 <code>man rc.conf</code> \u548c https://www.netbsd.org/docs/network/#configuration_files\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5347\u7ea7_1","title":"\u5347\u7ea7","text":"<p>\u53c2\u8003 https://www.netbsd.org/docs/guide/en/chap-upgrading.html</p> <p>\u4f7f\u7528 sysupgrade \u547d\u4ee4\u5347\u7ea7\uff1a</p> <pre><code>pkgin install sysupgrade\nsysupgrade auto https://cdn.NetBSD.org/pub/NetBSD/NetBSD-9.3/amd64\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5b89\u88c5\u5185\u6838\u6e90\u7801","title":"\u5b89\u88c5\u5185\u6838\u6e90\u7801","text":"<p>\u5185\u6838\u6e90\u7801\u53ef\u4ee5\u4ece https://mirrors.tuna.tsinghua.edu.cn/NetBSD/NetBSD-9.3/source/sets/ \u4e0b\u8f7d\u3002\u5bf9\u4e8e lsof \u53ea\u9700\u8981\u5176\u4e2d\u7684 syssrc.tgz\u3002</p> <p>\u89e3\u538b\uff1a</p> <pre><code>tar -xzf syssrc.tgz -C /\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#openbsd","title":"OpenBSD","text":"","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5b89\u88c5_1","title":"\u5b89\u88c5","text":"<p>\u6587\u6863\uff1ahttps://www.openbsd.org/faq/faq4.html</p> <p>\u4e0b\u8f7d https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/amd64/install72.iso\uff0c\u7136\u540e\u6309\u7167 UI \u63d0\u793a\u8fdb\u884c\u5b89\u88c5\u3002\u4f7f\u7528 virt-manager \u5b89\u88c5 OpenBSD \u865a\u62df\u673a\u7684\u65f6\u5019\uff0c\u5728\u5b89\u88c5\u754c\u9762\u4f1a\u9047\u5230\u65e0\u6cd5\u8f93\u5165\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a USB Keyboard \u6765\u89e3\u51b3\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5305\u7ba1\u7406_2","title":"\u5305\u7ba1\u7406","text":"<p>\u6587\u6863\uff1ahttps://www.openbsdhandbook.com/package_management/</p> <p>\u5e38\u7528\u547d\u4ee4\uff1a</p> <pre><code># Use TUNA Mirrors\necho \"https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/\" &gt; /etc/installurl\n# Search\npkg_info -Q fish\n# Install\npkg_add sudo fish vim\n# Update packages\npkg_add -u\n</code></pre> <p>\u53e6\u4e00\u4e2a\u65b9\u6cd5\u662f\u4ece\u6e90\u7801\u7f16\u8bd1\uff0c\u9996\u5148\u4e0b\u8f7d ports\uff1a</p> <pre><code>wget https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/ports.tar.gz\ncd /usr/src\ntar xzf /path/to/ports.tar.gz\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u7cfb\u7edf\u5347\u7ea7","title":"\u7cfb\u7edf\u5347\u7ea7","text":"<p>\u53c2\u8003\uff1ahttps://www.openbsdhandbook.com/system_management/updates/</p> <pre><code>syspatch -c\nsyspatch\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#autotools","title":"autotools","text":"<p>OpenBSD \u5141\u8bb8\u5b58\u5728\u591a\u4e2a\u7248\u672c\u7684 autoconf/automake\uff0c\u6240\u4ee5\u5728\u8fd0\u884c\u7684\u65f6\u5019\u9700\u8981\u7528\u73af\u5883\u53d8\u91cf\u6307\u5b9a\u7248\u672c\uff0c\u5982\uff1a</p> <pre><code>export AUTOCONF_VERSION=2.71\nexport AUTOMAKE_VERSION=1.16\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u83b7\u53d6\u5185\u6838\u6e90\u7801","title":"\u83b7\u53d6\u5185\u6838\u6e90\u7801","text":"<p>\u6587\u6863\uff1ahttps://www.openbsd.org/faq/faq5.html</p> <p>\u547d\u4ee4\uff1a</p> <pre><code># Add exampleuser to group wsrc\nuser mod -G wsrc exampleuser\n# Download and extract\nwget https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/sys.tar.gz\ncd /usr/src\ntar xzf /path/to/sys.tar.gz\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#ktrace","title":"ktrace","text":"<p>ktrace \u76f8\u5f53\u4e8e Linux \u4e2d\u7684 strace\u3002\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u7528 kdump \u547d\u4ee4\u663e\u793a\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#dragonflybsd","title":"DragonFlyBSD","text":"","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5b89\u88c5_2","title":"\u5b89\u88c5","text":"<p>\u4e0b\u8f7d ISO \u6587\u4ef6\uff1ahttps://mirror-master.dragonflybsd.org/iso-images/dfly-x86_64-6.4.0_REL.iso</p> <p>\u7528 installer \u7528\u6237\u767b\u5f55\u5f00\u59cb\u5b89\u88c5\u3002</p>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u7528\u6237\u7ba1\u7406","title":"\u7528\u6237\u7ba1\u7406","text":"<p>\u548c FreeBSD \u4e00\u6837\uff0csu \u9700\u8981 wheel \u7ec4\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u7528\u6237\u5230 wheel \u7ec4\u4e2d\uff1a</p> <pre><code>pw groupmod wheel -m username\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#sshd","title":"SSHD","text":"<p>DragonFlyBSD \u9ed8\u8ba4 sshd \u914d\u7f6e\u4e0d\u5141\u8bb8\u5bc6\u7801\u767b\u5f55\uff0c\u5982\u679c\u8981\u5141\u8bb8\uff0c\u9700\u8981\u4fee\u6539 <code>/etc/ssh/sshd_config</code>\uff0c\u7136\u540e\u91cd\u542f ssh\uff1a</p> <pre><code>/etc/rc.d/sshd restart\n</code></pre>","tags":["freebsd","cookbook"]},{"location":"system/2023/01/21/bsd-cookbook/#\u5305\u7ba1\u7406_3","title":"\u5305\u7ba1\u7406","text":"<p>DragonFlyBSD \u53ef\u4ee5\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305\uff1a</p> <pre><code>pkg update\npkg upgrade\npkg install sudo vim fish\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4ece\u6e90\u7801\u7f16\u8bd1\uff0c\u89c1 https://www.dragonflybsd.org/docs/howtos/HowToDPorts/</p>","tags":["freebsd","cookbook"]},{"location":"system/2021/03/03/idrac-versions/","title":"iDRAC \u5404\u7248\u672c","text":"","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/03/idrac-versions/#idrac-\u7248\u672c","title":"iDRAC \u7248\u672c","text":"<p>\u76ee\u524d\u63a5\u89e6\u5230\u7684 iDRAC \u7248\u672c\u6709\uff1a7 8 9\u3002\u4e00\u4e9b\u5e38\u89c1\u7684\u670d\u52a1\u5668\u578b\u53f7\u548c iDRAC \u7248\u672c\u5bf9\u5e94\u5173\u7cfb\uff1a</p> <ul> <li>7: PowerEdge R320, PowerEdge R720</li> <li>8: PowerEdge R730xd\uff0cPowerEdge R630\uff0cPowerEdge R730\uff0cPowerEdge C4130</li> <li>9: PowerEdge R7425</li> </ul> <p>\u57fa\u672c\u4e0a\uff0c\u5982\u679c\u662f PowerEdge R \u4ec0\u4e48\u7684\uff0c\u5c31\u770b\u7b2c\u4e8c\u4f4d\u6570\u5b57\uff0c\u5c31\u53ef\u4ee5\u63a8\u65ad\u51fa\u7248\u672c\u53f7\u4e86\u3002</p> <p>\u4e0b\u9762\u5217\u4e3e\u4e86\u4e00\u4e0b\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u7248\u672c\u3002</p>","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/03/idrac-versions/#idrac-7","title":"iDRAC 7","text":"<p>iDRAC 7 \u5728 2020 \u5e74 2 \u6708\u505c\u6b62\u66f4\u65b0\u4e86\uff0c\u6700\u65b0\u7248\u672c\u662f 2.65.65.65\u3002</p> <p>\u5347\u7ea7\u8def\u7ebf\u53c2\u8003\uff1aReddit\u3002</p> <ul> <li>1.66.65 \u4e0b\u8f7d\u9875\u9762\uff0c2014 \u5e74 12 \u6708\u7248\u672c\u3002</li> <li>2.10.10.10 \u4e0b\u8f7d\u9875\u9762\uff0c2015 \u5e74 4 \u6708\u7248\u672c\u3002</li> <li>2.65.65.65 \u4e0b\u8f7d\u9875\u9762\uff0c2020 \u5e74 3 \u6708\u7248\u672c\uff0c\u6dfb\u52a0\u4e86 HSTS\u3002</li> </ul>","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/03/idrac-versions/#idrac-8","title":"iDRAC 8","text":"<ul> <li>2.10.10.10 \u4e0b\u8f7d\u9875\u9762\uff0c2015 \u5e74 3 \u6708\u7248\u672c\u3002</li> <li>2.30.30.30: \u4e0b\u8f7d\u9875\u9762\uff0c2016 \u5e74 2 \u6708\u7248\u672c\uff0c\u6dfb\u52a0\u4e86 HTML5 virtual console \u652f\u6301\u3002</li> <li>2.60.60.60: \u4e0b\u8f7d\u9875\u9762\uff0c2018 \u5e74 6 \u6708\u7248\u672c\uff0c\u6dfb\u52a0\u4e86 virtual media over HTTP \u652f\u6301\u3002</li> <li>2.63.60.61: \u4e0b\u8f7d\u9875\u9762\uff0c2019 \u5e74 5 \u6708\u7248\u672c\u3002</li> <li>2.70.70.70: \u4e0b\u8f7d\u9875\u9762\uff0c2019 \u5e74 10 \u6708\u7248\u672c\u3002</li> <li>2.75.75.75: \u4e0b\u8f7d\u9875\u9762\uff0c2020 \u5e74 6 \u6708\u7248\u672c\u3002</li> <li>2.75.100.75: \u4e0b\u8f7d\u9875\u9762\uff0c2021 \u5e74 1 \u6708\u7248\u672c\u3002</li> <li>2.80.80.80: \u4e0b\u8f7d\u9875\u9762\uff0c2021 \u5e74 5 \u6708\u7248\u672c\u3002</li> <li>2.81.81.81: \u4e0b\u8f7d\u9875\u9762\uff0c2021 \u5e74 7 \u6708\u7248\u672c\u3002</li> <li>2.82.82.82: \u4e0b\u8f7d\u9875\u9762\uff0c2021 \u5e74 12 \u6708\u7248\u672c\u3002</li> <li>2.83.83.83: \u4e0b\u8f7d\u9875\u9762\uff0c2022 \u5e74 4 \u6708\u7248\u672c\u3002</li> <li>2.84.84.84: \u4e0b\u8f7d\u9875\u9762\uff0c2023 \u5e74 3 \u6708\u7248\u672c\u3002</li> <li>2.85.85.85: \u4e0b\u8f7d\u9875\u9762\uff0c2023 \u5e74 10 \u6708\u7248\u672c\u3002</li> </ul>","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/03/idrac-versions/#idrac-9","title":"iDRAC 9","text":"<ul> <li>4.00.00.00: \u4e0b\u8f7d\u9875\u9762\uff0c2019 \u5e74 12 \u6708\u7248\u672c\u3002LLDP \u8fde\u63a5\u89c6\u56fe\u3002</li> <li>4.22.00.00: \u4e0b\u8f7d\u9875\u9762\uff0c2020 \u5e74 7 \u6708\u7248\u672c\u3002</li> <li>4.40.00.00: \u4e0b\u8f7d\u9875\u9762\uff0c2020 \u5e74 12 \u6708\u7248\u672c\uff0c\u4e0b\u4e00\u4ee3\u7684 iDRAC virtual console \u548c virtual media\uff0c\u652f\u6301 Infiniband\u3002</li> <li>5.00.00.00: \u4e0b\u8f7d\u9875\u9762\uff0c2021 \u5e74 6 \u6708\u7248\u672c\u3002</li> <li>7.00.00.00: \u4e0b\u8f7d\u9875\u9762\uff0c2023 \u5e74 6 \u6708\u7248\u672c\u3002</li> </ul>","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/03/idrac-versions/#\u5728\u7ebf\u5347\u7ea7","title":"\u5728\u7ebf\u5347\u7ea7","text":"<p>iDRAC \u53ef\u4ee5\u5728\u7ebf\u4ece Dell \u5b98\u7f51\u4e0b\u8f7d\u65b0\u7248\u672c\u5347\u7ea7\uff0c\u5728\u7f51\u9875\u4e0a\u9009\u62e9\u901a\u8fc7 HTTPS \u5347\u7ea7\uff0c\u57df\u540d\u5199  \uff0c\u5177\u4f53\u89c1\u6587\u6863\u3002","tags":["poweredge","dell","idrac"]},{"location":"system/2021/03/29/ilo-nic-selection-ipmitool/","title":"\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3","text":"<p>ipmitool \u81ea\u5e26\u4e86\u5bf9 iDRAC \u7684\u652f\u6301\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>ipmitool delloem</code> \u8bbe\u7f6e iDRAC \u7684\u7ba1\u7406\u7aef\u53e3\u3002\u4f46\u662f\u5bf9 iLO \u7684\u652f\u6301\u5e76\u6ca1\u6709\u5b9e\u73b0\u3002\u7814\u7a76\u4e86\u4e00\u756a\uff0c\u627e\u5230\u4e86\u901a\u8fc7 raw command \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3\u7684\u65b9\u6cd5\u3002</p> <p>\u8fd9\u7bc7\u6587\u7ae0 \u8bb2\u8ff0\u4e86 <code>ipmitool lan</code> \u547d\u4ee4\u5b9e\u9645\u4f1a\u53d1\u9001\u7684\u547d\u4ee4\uff1a</p> <p>\u8bfb\u53d6\u914d\u7f6e\uff1a</p> <pre><code>$ ipmitool raw 0x0c 0x02 CHANNEL KEY SET BLOCK\n</code></pre> <p>\u4e00\u822c\u6765\u8bf4 SET \u548c BLOCK \u90fd\u662f 0\u3002KEY \u7684\u5e38\u89c1\u53d6\u503c\uff1a</p> <ul> <li>3: IP \u5730\u5740</li> <li>4: IP \u5730\u5740\u6765\u6e90</li> <li>5: MAC \u5730\u5740</li> <li>6: \u5b50\u7f51\u63a9\u7801</li> <li>12: \u9ed8\u8ba4\u7f51\u5173</li> </ul> <p>\u8fd4\u56de\u7684\u6570\u636e\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u5ffd\u7565\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u6570\u636e\u4e86\u3002</p> <p>\u5199\u5165\u914d\u7f6e\uff1a</p> <pre><code>$ ipmitool raw 0x0c 0x01 CHANNEL KEY DATA...\n</code></pre> <p>\u77e5\u9053\u5982\u4f55\u8bfb\u53d6\u914d\u7f6e\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u627e\u5230 iLO 4 \u914d\u7f6e NIC \u7684\u5730\u65b9\u4e86\u3002\u4e00\u756a\u641c\u7d22\uff0c\u627e\u5230\u4e86 HPE iLO IPMI User Guide\u3002\u5728\u7b2c 101 \u9875\uff0c\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u7528\u4e8e\u914d\u7f6e iLO NIC \u9009\u62e9\u7684\u8bbe\u7f6e\uff1a</p> <pre><code>Index: 224\niLO Dedicated/Shared NIC Selection.\ndata 3:\n\u2022 Selected iLO NIC.\n\u25e6 0h = iLO Dedicated NIC is selected.\n\u25e6 1h = iLO Shared NIC is selected.\n\u25e6 All others = reserved\n\u2022 To switch to another iLO NIC:\n1. Write this (and possibly parameter 197) to the desired NIC selection\n2. Configure all other relevant network parameters for the desin\n3. Reset iLO. The desired NIC will be in use after iLO reset.\n\u2022 When writing changes to data 3, NIC selection:\n\u25e6 data 1 must be AAh\n\u25e6 data 2 must be 55h\n\u25e6 data 4 must be FFh\n</code></pre> <p>\u6709\u8fd9\u6837\u7684\u4fe1\u606f\u4ee5\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u8bbe\u7f6e Shared NIC\uff1a</p> <pre><code>$ ipmitool raw 0x0c 0x01 0x01 224 0xAA 0x55 0x01 0xFF\n</code></pre> <p>\u518d\u8bfb\u51fa\u6765 224\uff0c\u53d1\u73b0\u5b83\u7684 data 4 \u8868\u793a <code>iLO reset needed for some settings changes that have been made</code>\u3002\u4e8e\u662f\uff0c\u6267\u884c <code>ipmitool mc reset warm</code> \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u770b\u5230 NIC \u9009\u62e9\u5df2\u7ecf\u66f4\u65b0\uff1a</p> <pre><code>$ ipmitool raw 0x0c 0x02 0x01 197 0x00 0x00\n11 02 01 02\n</code></pre> <p>\u6570\u636e\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>0x02: Shared NIC Selection = ALOM</li> <li>0x01: Shared NIC Port Number = Port 1</li> <li>0x02: Platform supports ALOM shared NIC</li> </ul> <p>\u5982\u679c\u60f3\u8981\u7684\u7aef\u53e3\u548c\u9ed8\u8ba4\u9009\u62e9\u4e0d\u4e00\u6837\uff0c\u53ef\u4ee5\u5199\u5165 197 \u6765\u66f4\u65b0\u3002\u8be6\u89c1\u4e0a\u9762\u7684\u6587\u6863\u94fe\u63a5\u3002</p> <p>\u8d85\u5fae\u7684\u673a\u5668\u4e5f\u6709\u7c7b\u4f3c\u7684\u529e\u6cd5\uff1ahttps://www.supermicro.org.cn/support/faqs/faq.cfm?faq=15868\uff0c\u53ef\u4ee5\u7528 <code>ipmiutil smcoem lanport</code> \u547d\u4ee4\u6765\u8bfb\u53d6/\u4fee\u6539\u3002</p> <p>Update\uff1a\u6211\u7ed9 IPMITOOL \u63d0\u4ea4\u4e86 PR\uff0c\u6765\u7b80\u5316\u8fd9\u4e2a\u8fc7\u7a0b</p>","tags":["hpe","ilo","ilo4","ipmi","ipmitool"]},{"location":"system/2018/05/01/installing-arch-experience/","title":"\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Archlinux \u8bb0\u5f55","text":"<p>\u6709\u4e00\u53f0\u670d\u52a1\u5668\u7684 Ubuntu \u6302\u4e86\uff0c\u6211\u4eec\u60f3\u5728\u4e0a\u9762\u91cd\u88c5\u4e00\u4e2a Archlinux\u3002\u6211\u4eec\u9996\u5148\u4e0b\u8f7d\u4e86 archlinux-2018.04.01 \u7684 ISO, \u76f4\u63a5 dd \u5230 U \u76d8\u4e0a\uff0c\u4f46\u662f\u9047\u5230\u4e86\u95ee\u9898\u3002</p> <p>\u9996\u5148\u9047\u5230\u7684\u95ee\u9898\u662f\uff0c\u4e00\u542f\u52a8\u4e4b\u540e\u5c31\u4f1a\u82b1\u5c4f\u3002\u6211\u4eec\u4e00\u5f00\u59cb\u6000\u7591\u662f NVIDIA \u9a71\u52a8\u7684\u95ee\u9898\uff0c\u4e8e\u662f\u60f3\u6539 kernel param \u4f46\u662f\u53d1\u73b0\uff0c\u8fd9\u4e2a ISO \u662f hybrid \u7684\uff0c\u6211\u4eec\u5728 macOS \u548c Windows \u4e0a\u90fd\u4e0d\u80fd mount \u4e0a\u8fd9\u79cd\u7c7b\u578b\u7684\u76d8\u3002\u4e8e\u662f\u6211\u4eec\u9009\u62e9\u81ea\u5df1\u641e\u5206\u533a\u8868\u3002\u6211\u4eec\u628a U \u76d8\u63d2\u5230\u7535\u8111\u4e0a\uff0c\u7136\u540e\u5728 Linux \u865a\u62df\u673a\u5185\u91cd\u65b0\u5206\u533a\u4e3a GPT\uff0c\u7136\u540e mount \u5230 /mnt/usb\uff0c\u518d\u91cd\u65b0\u4e0b\u8f7d archlinux iso\uff0c\u4e0d\u8fc7\u6b64\u65f6\u521a\u597d\u4e0a\u6e38\u66f4\u65b0\u4e86 archlinux-2018.05.01 \u7684\u5f71\u54cd\u3002\u6211\u4eec\u628a ISO \u4e2d\u6839\u5206\u533a mount \u5230 /mnt/iso \u4e0a\u6765\uff0c\u7136\u540e <code>cp -a /mnt/iso/* /mnt/usb</code> \u3002\u8c03\u6574\u4e86 grub \u4e2d\u7684\u5185\u6838\u53c2\u6570\uff0c\u4ecd\u7136\u65e0\u679c\u3002\u6211\u4eec\u8ba4\u4e3a\u95ee\u9898\u53ef\u80fd\u5728\u663e\u5361\u4e0a\uff0c\u5c31\u628a\u90a3\u5f20\u663e\u5361\u62d4\u4e0b\u6765\u4e86\uff0c\u679c\u7136\u663e\u793a\u5c31\u6b63\u5e38\u4e86\uff0c\u4f46\u662f\u65b0\u7684\u95ee\u9898\u5c31\u6765\u4e86\u3002</p> <p>\u4e00\u542f\u52a8\uff0cfstab \u5c1d\u8bd5\u628a LABEL=ARCHISO_201805 \u6302\u5728\u4e0a\u6765\uff0c\u4f46\u662f\u5931\u8d25\u3002\u4e8e\u662f\u6211\u4eec\u628a U \u76d8\u63d2\u5230 mac \u4e0a\uff0c\u7528 Disk Utility \u7ed9\u5206\u533a\u547d\u4e86\u540d\uff0c\u518d\u63d2\u56de\u53bb\uff0c\u7136\u540e\u8fd9\u4e2a Live CD \u7684 Systemd \u5c31\u6210\u529f\u8d77\u6765\u4e86\u3002\u63a5\u4e0b\u6765\u5c31\u662f\u6839\u636e\u5b98\u65b9\u7684 Installation Guide \u8fdb\u884c\u5b89\u88c5\u5404\u79cd\u4e1c\u897f\u3002\u5b89\u88c5\u5b8c\u540e\uff0c\u5728 /boot/EFI \u7684\u64cd\u4f5c\u4e0a\u4e5f\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u4e00\u5f00\u59cb\u5fd8\u8bb0\u8c03\u7528 <code>grub-mkconfig</code> \uff0c\u5bfc\u81f4\u91cd\u542f\u4ee5\u540e\u8fdb\u5165 grub-rescue\uff0c\u6240\u4ee5\u53c8\u56de\u5230 Live CD \u91cd\u65b0 <code>grub-mkconfig</code>  \u3002\u540c\u65f6\u5bf9 systemd-networkd \u4e5f\u8fdb\u884c\u4e86\u76f8\u5e94\u7684\u8c03\u6574\uff0c\u8fd9\u6837\u5f00\u673a\u4ee5\u540e\u53ef\u4ee5\u914d\u597d\u7f51\u7edc\u3002\u4e3b\u8981\u5c31\u662f\u5728\u7f51\u5361\u4e0a\u914d\u4e0a\u4e24\u4e2a VLAN \u548c\u76f8\u5e94\u7684 DHCP \u548c\u9759\u6001\u5730\u5740\u3002</p> <p>\u63a5\u4e0b\u6765\u5bf9\u4ee5\u524d\u7684\u4e1c\u897f\u8fdb\u884c\u8fc1\u79fb\u3002\u4e3b\u8981\u5c31\u662f\u6309\u7167\u5341\u5206\u8be6\u7ec6\u7684 Arch Wiki \u8fdb\u884c\u76f8\u5e94\u7684\u914d\u7f6e\u3002\u7531\u4e8e\u7a7a\u95f4\u6240\u9650\uff0c\u6211\u4eec\u628a\u539f\u6765\u7684 home \u76ee\u5f55\u76f4\u63a5 mount --bind \u5230 /home\uff0c\u4f46\u662f\u4e0d\u53ef\u907f\u514d\u5730\uff0c\u4f1a\u51fa\u73b0\u7528\u6237 id \u4e0d\u5bf9\u5e94\u7684\u95ee\u9898\u3002\u4e8e\u662f\u6211\u4eec\u628a\u9700\u8981\u7528\u5230\u7684\u7528\u6237\u7684 /etc/{passwd,group,shadow} \u7edf\u7edf\u62f7\u8d1d\u5230\u65b0\u7684\u7cfb\u7edf\u7684\u76f8\u5e94\u5730\u65b9\u3002\u7136\u540e\u662f\u914d\u7f6e winbind\uff0c\u5c31\u662f\u6309\u90e8\u5c31\u73ed\u5730\u6309\u7167 Arch Wiki \u548c\u4ee5\u524d\u7684\u914d\u7f6e\u8fdb\u884c\u66f4\u65b0\uff0c\u7136\u540e\u6210\u529f\u5730\u628a AD \u4e0a\u7684\u7528\u6237\u83b7\u53d6\u5230\u3002\u6b64\u65f6\u518d\u6b21\u51fa\u73b0\u4e86 uid \u4e0d\u5bf9\u5e94\u7684\u95ee\u9898\uff0c\u6b64\u65f6\u6211\u4eec\u4f7f\u7528 <code>chown -R user:user /home/user</code> \u7684\u65b9\u6cd5\u3002</p> <p>\u5269\u4e0b\u7684\u5de5\u4f5c\u5c31\u662f\u7410\u788e\u7684\u5b89\u88c5\u5404\u79cd\u5e38\u7528\u8f6f\u4ef6\u3002\u4e0d\u5fc5\u591a\u8bf4\u3002</p> <p>P.S. \u6211\u7814\u7a76\u51fa\u4e86\u4e00\u4e2a\u5f88\u597d\u7528\u7684 mosh + tmux \u7684 fish function: (\u4f46\u662f\u6709\u65f6\u5de5\u4f5c\u6709\u65f6\u4e0d\u5de5\u4f5c\uff0c\u4e0d\u660e\u767d\u4ec0\u4e48\u56de\u4e8b) <pre><code>function tmosh\n    mosh $argv -- tmux new-session bash -c 'tmux set -g mouse on; tmux setw -g mode-keys vi; fish'\nend\n</code></pre></p>","tags":["arch","boot","efi","fat32"]},{"location":"system/2020/01/05/macbookpro-linux-wifi/","title":"MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848","text":"<p>\u4e4b\u524d\u5728 MacBookPro 14,3 \u5b89\u88c5 Linux \u540e\uff0c\u5f88\u591a\u4e1c\u897f\u7684\u9a71\u52a8\u90fd\u6709\u4e86\u89e3\u51b3\u65b9\u6cd5\uff0c\u53c2\u8003 1\uff0c\u53c2\u8003 2\uff0c\u89e6\u6478\u677f\u548c\u952e\u76d8\u7b49\u7b49\u90fd\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\uff0c\u89e6\u6478\u677f\u7684\u4f7f\u7528\u6548\u679c\u6bd4\u6211\u610f\u6599\u8981\u597d\u4e00\u4e9b\uff0c\u867d\u7136\u8fd8\u662f\u6ca1\u6709 macOS \u539f\u751f\u90a3\u4e48\u597d\u3002\u4f46 Wi-Fi \u4e00\u76f4\u6709\u80fd\u626b\u5230\u4fe1\u53f7\u4f46\u8fde\u4e0d\u4e0a\u7684\u95ee\u9898\uff0c\u6700\u8fd1\u7ec8\u4e8e\u6709\u4e86\u6bd4\u8f83\u5b8c\u5584\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5730\u5740\uff0c\u4e5f\u662f\u4e24\u4e2a\u6708\u524d\u624d\u51fa\u6765\u7684\u65b9\u6848\uff0c\u6211\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u7f51\u7edc\u95ee\u9898\uff0c\u7f51\u5361\u578b\u53f7\u662f BCM43602\uff0c\u9a71\u52a8\u7528\u7684\u662f brcmfmac\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u5e26 T2 \u7684 MacBook \u4f3c\u4e4e\u4e5f\u6709\u4e86\u652f\u6301\uff0c\u89c1 aunali1/linux-mbp-arch\uff0c\u6709\u4e00\u4e9b\u5c1a\u672a upstream \u7684 patch\uff0c\u4f46\u6211\u6ca1\u6709\u8bbe\u5907\uff0c\u5c31\u6ca1\u6709\u6d4b\u8bd5\u4e86\u3002\u9700\u8981\u5410\u69fd\u7684\u662f ArchWiki \u4e0d\u600e\u4e48\u66f4\u65b0\u65b0 Model \u7684 MacBook \u7684\u6559\u7a0b\uff0c\u90fd\u662f\u5230\u5904\u627e\u6563\u843d\u7684 github repo \u548c gist \u627e\u522b\u4eba\u7684\u65b9\u6848\u3002</p> <p>P.S. \u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u7684\u6709\uff1aWi-Fi\uff0c\u952e\u76d8\uff0c\u89e6\u6478\u677f\uff0cTouchbar\uff0c\u5185\u7f6e\u6444\u50cf\u5934\uff0c\u952e\u76d8\u80cc\u5149\uff0c\u84dd\u7259 P.P.S MacBookPro11,2 \u7684\u7f51\u5361\u662f BCM4360\uff0c\u76f4\u63a5\u7528 broadcom-wl \u9a71\u52a8\u5c31\u53ef\u4ee5\u3002</p>","tags":["linux","wifi","broadcom","bcm43602","brcmfmac","macbookpro"]},{"location":"system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/","title":"In macOS Sierra, Karabiner-Elements finally support complex modifications","text":"<p>In favor of this commit, Karabiner-Elements now supports the much welcomed yet long-lost feature, namely complex modifications that enable users to trigger complex keypress.</p> <p>Now I can achieve this: <pre><code>If I press &lt;Enter&gt;, then:\n1. If &lt;Enter&gt; is pressed alone, then send &lt;Enter&gt;.\n2. If &lt;Enter&gt; is pressed along with other keys, then send &lt;Control&gt; + Other.\n</code></pre></p> <p>By adding this code to ~/.config/karabiner/karabiner.json : <pre><code>\"complex_modifications\": {\n    \"rules\": [\n        {\n            \"manipulators\": [\n                {\n                    \"description\": \"Change return_or_enter to left_control. (Post return_or_enter if pressed alone)\",\n                    \"from\": {\n                        \"key_code\": \"return_or_enter\",\n                        \"modifiers\": {\n                            \"optional\": [\n                                \"any\"\n                            ]\n                        }\n                    },\n                    \"to\": [\n                        {\n                            \"key_code\": \"left_control\"\n                        }\n                    ],\n                    \"to_if_alone\": [\n                        {\n                            \"key_code\": \"return_or_enter\"\n                        }\n                    ],\n                    \"type\": \"basic\"\n                }\n            ]\n        }\n    ]\n},\n</code></pre> in one of profiles.</p> <p>Note: the snippet above is adopted from this example. You can explore more examples since the GUI is not updated accordingly yet.</p> <p>Important: Until NOW (2017-06-15), this feature is only implemented in beta versions of Karabiner-Elements (at least 0.91.1).</p>","tags":["macos","karabiner-elements","keyboard"]},{"location":"system/2022/05/05/nuc11-igpu-passthrough/","title":"NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a","text":"","tags":["windows","win11","esxi","vmware","gpu","igpu","passthrough"]},{"location":"system/2022/05/05/nuc11-igpu-passthrough/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u4e4b\u524d\u5728 NUC11PAKi5 \u4e0a\u88c5\u4e86 ESXI \u52a0\u51e0\u4e2a\u865a\u62df\u673a\u7cfb\u7edf\uff0c\u4f46\u662f\u81ea\u5e26\u7684 iGPU Intel Iris Xe Graphics(Tiger Lake GT-2) \u6ca1\u7528\u4e0a\uff0c\u611f\u89c9\u6709\u4e9b\u6d6a\u8d39\u3002\u56e0\u6b64\u60f3\u8981\u7ed9 Windows \u76f4\u901a\u3002\u5728\u76f4\u901a\u5230 Windows \u540e\u53d1\u73b0\u4f1a\u65e0\u9650\u91cd\u542f\uff0c\u6700\u540e\u76f4\u901a\u5230 Linux \u4e2d\u3002</p>","tags":["windows","win11","esxi","vmware","gpu","igpu","passthrough"]},{"location":"system/2022/05/05/nuc11-igpu-passthrough/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>\u7b2c\u4e00\u6b65\u662f\u5230 esxi \u7684\u8bbe\u5907\u8bbe\u7f6e\u7684\u5730\u65b9\uff0c\u628a iGPU \u7684 Passthrough \u6253\u5f00\uff0c\u8fd9\u65f6\u5019\u4f1a\u63d0\u793a\u9700\u8981\u91cd\u542f\uff0c\u4f46\u662f\u5982\u679c\u91cd\u542f\uff0c\u4f1a\u53d1\u73b0\u8fd8\u662f\u5904\u4e8e Needs reboot \u72b6\u6001\u3002\u7f51\u4e0a\u8fdb\u884c\u641c\u7d22\uff0c\u53d1\u73b0\u662f ESXi \u81ea\u5df1\u5360\u7528\u4e86 iGPU \u7684\u8f93\u51fa\uff0c\u89e3\u51b3\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ esxcli system settings kernel set -s vga -v FALSE\n</code></pre> <p>\u8fd9\u6837\u8bbe\u7f6e\u4ee5\u540e\u5c31\u4e0d\u4f1a\u5728\u663e\u5361\u8f93\u51fa\u4e0a\u663e\u793a dcui \u4e86\uff0c\u8fd9\u662f\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u7f3a\u70b9\uff0c\u4f46\u662f\u5e73\u65f6\u4e5f\u4e0d\u7528\u81ea\u5e26\u7684\u663e\u793a\u8f93\u51fa\uff0c\u5c31\u65e0\u6240\u8c13\u4e86\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff0c\u91cd\u542f\u4ee5\u540e\uff0c\u8fd9\u65f6\u5019\u770b\u8bbe\u5907\u72b6\u6001\u5c31\u662f Active\u3002\u56de\u5230 Windows \u865a\u62df\u673a\uff0c\u6dfb\u52a0 PCI device\uff0c\u7136\u540e\u542f\u52a8\u3002\u8fd9\u65f6\u5019\uff0c\u6211\u9047\u5230\u4e86\u8fd9\u6837\u7684\u9519\u8bef\uff1a</p> <pre><code>Module \u2018DevicePowerOn\u2019 power on failed\nFailed to register the device pciPassthru0\n</code></pre> <p>\u641c\u7d22\u4e86\u4e00\u756a\uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u5173\u6389 IOMMU\u3002\u5728\u865a\u62df\u673a\u8bbe\u8ba1\u4e2d\u5173\u6389 IOMMU\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u4e86\u3002</p> <p>\u7b2c\u4e09\u6b65\uff0c\u8fdb\u5165 Windows\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u65b0\u7684\u672a\u77e5\u8bbe\u5907\u4e86\uff0cVID=8086\uff0cPID=9a49\uff1b\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0cWindows \u81ea\u52a8\u5b89\u88c5\u597d\u4e86\u9a71\u52a8\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u8bc6\u522b\u4e86\u3002GPU-Z \u4e2d\u53ef\u4ee5\u770b\u5230\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0d\u8fc7\u5173\u673a\u91cd\u542f\u7684\u65f6\u5019\u4f1a\u84dd\u5c4f\uff0c\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u6709\u4eba\u5728\u8bba\u575b\u4e0a\u4e5f\u8bf4 passthrough \u4e4b\u540e\u4f1a\u84dd\u5c4f\u3002\u8fd9\u4e2a\u95ee\u9898\u4e00\u76f4\u6ca1\u6709\u89e3\u51b3\u3002</p> <p>\u518d\u5c1d\u8bd5 Passthrough \u5230 Linux\uff1a</p> <pre><code>$ sudo dmesg | grep i915\n[    2.173500] i915 0000:13:00.0: enabling device (0000 -&gt; 0003)\n[    2.180137] i915 0000:13:00.0: [drm] VT-d active for gfx access\n[    2.182109] i915 0000:13:00.0: BAR 6: can't assign [??? 0x00000000 flags 0x20000000] (bogus alignment)\n[    2.182110] i915 0000:13:00.0: [drm] Failed to find VBIOS tables (VBT)\n[    2.182541] i915 0000:13:00.0: vgaarb: changed VGA decodes: olddecodes=io+mem,decodes=none:owns=none\n[    2.197374] i915 0000:13:00.0: firmware: direct-loading firmware i915/tgl_dmc_ver2_08.bin\n[    2.198037] i915 0000:13:00.0: [drm] Finished loading DMC firmware i915/tgl_dmc_ver2_08.bin (v2.8)\n[    3.401676] i915 0000:13:00.0: [drm] failed to retrieve link info, disabling eDP\n[    3.515822] [drm] Initialized i915 1.6.0 20200917 for 0000:13:00.0 on minor 0\n[    3.516054] i915 0000:13:00.0: [drm] Cannot find any crtc or sizes\n[    3.516144] i915 0000:13:00.0: [drm] Cannot find any crtc or sizes\n</code></pre> <p>OpenCL \u4e5f\u53ef\u4ee5\u68c0\u6d4b\u5230\uff1a</p> <pre><code>$ sudo apt install intel-opencl-icd clinfo\nNumber of devices                                 1\n  Device Name                                     Intel(R) Graphics Gen12LP [0x9a49]\n  Device Vendor                                   Intel(R) Corporation\n  Device Vendor ID                                0x8086\n  Device Version                                  OpenCL 3.0 NEO\n  Device Numeric Version                          0xc00000 (3.0.0)\n  Driver Version                                  1.0.0\n</code></pre> <p>Vulkan\uff1a</p> <pre><code>$ vulkaninfo\nGroup 1:\n        Properties:\n                physicalDevices: count = 1\n                        Intel(R) Xe Graphics (TGL GT2) (ID: 0)\n                subsetAllocation = 0\n\n        Present Capabilities:\n                Intel(R) Xe Graphics (TGL GT2) (ID: 0):\n                        Can present images from the following devices: count = 1\n                                Intel(R) Xe Graphics (TGL GT2) (ID: 0)\n                Present modes: count = 1\n                        DEVICE_GROUP_PRESENT_MODE_LOCAL_BIT_KHR\n</code></pre> <p>\u4e0d\u8fc7\u76ee\u524d\u8fd8\u6ca1\u627e\u5230\u663e\u793a\u8f93\u51fa\u7684\u65b9\u6cd5\uff0c\u53ea\u80fd\u7528 VMware SVGA \u6216\u8005\u8fdc\u7a0b\u684c\u9762\u3002</p>","tags":["windows","win11","esxi","vmware","gpu","igpu","passthrough"]},{"location":"system/2022/05/05/nuc11-igpu-passthrough/#\u5410\u69fd","title":"\u5410\u69fd","text":"<p>\u9700\u8981\u5410\u69fd\u7684\u662f\uff0c11 \u4ee3\u7684\u6838\u663e\u4e0d\u518d\u652f\u6301 Intel GVT-g\uff0c\u800c\u662f\u63d0\u4f9b\u4e86 SR-IOV \u7684\u865a\u62df\u5316\u3002\u4f46\u662f\uff0cLinux i915 \u9a71\u52a8\u6ca1\u6709\u505a\u76f8\u5e94\u7684\u652f\u6301\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ul> <li>Passthrough of Integrated GPU (iGPU) for standard Intel NUC</li> <li>PCI Passthrough \u2013 \u201cModule \u2018DevicePowerOn\u2019 power on failed\u201d</li> </ul>","tags":["windows","win11","esxi","vmware","gpu","igpu","passthrough"]},{"location":"system/2023/08/11/openbmc-qemu/","title":"\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC","text":"","tags":["bmc","openbmc","qemu"]},{"location":"system/2023/08/11/openbmc-qemu/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u60f3\u7ed9\u67d0\u53f0\u673a\u5668\u914d\u4e00\u4e2a BMC\uff0c\u4e8e\u662f\u8c03\u7814 OpenBMC \u53d1\u884c\u7248\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u627e\u5230\u53ef\u4ee5\u4e70\u5230\u7684\u5408\u9002\u7684 BMC\uff0c\u56e0\u6b64\u5148\u5728\u865a\u62df\u673a\u4e2d\u8fdb\u884c\u5c1d\u8bd5\u3002</p>","tags":["bmc","openbmc","qemu"]},{"location":"system/2023/08/11/openbmc-qemu/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"<p>\u8fd0\u884c\u8fc7\u7a0b\u53c2\u8003\u5b98\u65b9\u7684 OpenBMC Development Environment \u6587\u6863\u8fdb\u884c\uff0c\u9996\u5148\u5b89\u88c5\u4f9d\u8d56\u548c\u514b\u9686\u4ed3\u5e93\uff1a</p> <pre><code>sudo apt install git python3-distutils gcc g++ make file wget \\\n    gawk diffstat bzip2 cpio chrpath zstd lz4 bzip2\ngit clone git@github.com:openbmc/openbmc.git\ncd openbmc\n</code></pre>","tags":["bmc","openbmc","qemu"]},{"location":"system/2023/08/11/openbmc-qemu/#romulus","title":"romulus","text":"<p>\u63a5\u7740\uff0c\u7f16\u8bd1\u9488\u5bf9 romulus BMC \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p> <pre><code>. setup romulus\nbitbake obmc-phosphor-image\n</code></pre> <p>\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u7f16\u8bd1\u597d\u7684 32MB \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p> <pre><code>ls -al tmp/deploy/images/romulus/obmc-phosphor-image-romulus.static.mtd\n</code></pre> <p>\u6574\u4e2a\u6784\u5efa\u5b8c\u7528\u4e86 27 GB \u7684\u78c1\u76d8\u7a7a\u95f4\u3002</p> <p>\u63a5\u7740\uff0c\u4e0d\u9700\u8981\u6309\u7167\u6587\u6863\u91cc\u7684\u65b9\u6cd5\u53bb\u7528 qemu fork\uff0c\u800c\u662f\u76f4\u63a5\u53ef\u4ee5\u7528\u7cfb\u7edf\u81ea\u5e26\u7684\u4e0a\u6e38\u7248 qemu \u542f\u52a8\u865a\u62df\u673a\uff1a</p> <pre><code>qemu-system-arm -m 256 -M romulus-bmc -nographic -drive file=./obmc-phosphor-image-romulus.static.mtd,format=raw,if=mtd -net nic -net user,hostfwd=:127.0.0.1:2222-:22,hostfwd=:127.0.0.1:2443-:443,hostfwd=udp:127.0.0.1:2623-:623,hostname=qemu\n</code></pre> <p>\u8fd9\u6837\u5c31\u628a SSH\uff0cHTTPS \u548c IPMI \u8f6c\u53d1\u5230\u672c\u673a\u4e0a\u4e86\uff0c\u53ef\u4ee5\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u7528\u6237\u662f root\uff0c\u9ed8\u8ba4\u5bc6\u7801\u662f 0penBmc\u3002</p> <pre><code>ssh root@localhost -p 2222\nipmitool -I lanplus -H 127.0.0.1 -U root -P 0penBmc -p 2623 mc info\n</code></pre> <p>\u8fd9\u4e5f\u662f\u7528 OpenBMC \u7684\u4e00\u5927\u597d\u5904\uff1a\u6709\u771f\u6b63\u7684 SSH \u53ef\u4ee5\u7528\uff0c\u53ef\u4ee5\u770b\u5230\u5185\u90e8\u7684\u60c5\u51b5\u3002\u901a\u8fc7 uname \u53ef\u4ee5\u770b\u5230\uff0c\u6a21\u62df\u7684\u5904\u7406\u5668\u67b6\u6784\u662f armv6l\uff0c\u8fd8\u662f\u6bd4\u8f83\u65e7\u7684\u3002\u6839\u636e QEMU \u6587\u6863\uff0cromulus \u662f\u57fa\u4e8e AST2500 \u7684 OpenPOWER Romulus POWER9 BMC\u3002AST2500 \u91c7\u7528\u7684\u662f 800MHz ARM11 \u6838\u5fc3\uff0c\u786e\u5b9e\u662f\u6bd4\u8f83\u8001\u4e86\u3002</p>","tags":["bmc","openbmc","qemu"]},{"location":"system/2023/08/11/openbmc-qemu/#ast2600","title":"AST2600","text":"<p>\u63a5\u4e0b\u6765\u8bd5\u8bd5\u57fa\u4e8e Cortex-A7 \u7684 AST2600\uff0c\u6784\u5efa evb-ast2600 target\uff1a</p> <pre><code>cd openbmc\n. setup evb-ast2600\nbitbake obmc-phosphor-image\n</code></pre> <p>\u8fd9\u6b21\u4e5f\u7f16\u8bd1\u51fa\u4e86\u4e00\u4e2a 64MB \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p> <pre><code>ls -al tmp/deploy/images/evb-ast2600/obmc-phosphor-image-evb-ast2600.static.mtd\n</code></pre> <p>\u5728 qemu \u4e2d\u8fd0\u884c\uff1a</p> <pre><code>qemu-system-arm -m 1024 -M ast2600-evb -nographic -drive file=./obmc-phosphor-image-evb-ast2600.static.mtd,format=raw,if=mtd -net nic -net user,hostfwd=:127.0.0.1:2222-:22,hostfwd=:127.0.0.1:2443-:443,hostfwd=udp:127.0.0.1:2623-:623,hostname=qemu\n</code></pre> <p>\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u53ef\u4ee5\u901a\u8fc7 SSH\uff0cHTTPS \u548c IPMI \u8bbf\u95ee\uff0c\u4f46\u662f\u6ca1\u6709 WebUI\uff0c\u53ea\u6709 redfish\u3002\u8fdb\u7cfb\u7edf\u4ee5\u540e\u53ef\u4ee5\u770b\u5230 uname \u7684\u67b6\u6784\u53d8\u6210\u4e86 armv7l\u3002</p> <p>\u6b64\u65f6\u6309\u7167 \u3010OpenBMC \u7cfb\u5217\u30114.\u542f\u52a8\u6d41\u7a0b \u4f7f\u7528 qume \u6a21\u62df ast2600-evb \u7684\u6587\u6863\uff0c\u7ed9 ast2600-evb target \u52a0\u4e0a webui\uff1a</p> <p>\u8fdb\u5165 openbmc \u76ee\u5f55\uff0c\u7f16\u8f91 <code>build/evb-ast2600/conf/local.conf</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p> <pre><code>CORE_IMAGE_EXTRA_INSTALL  += \"webui-vue\"\n</code></pre> <p>\u7f16\u8f91 <code>meta-phosphor/recipes-phosphor/images/obmc-phosphor-image.bbapend</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p> <pre><code>OBMC_IMAGE_EXTRA_INSTALL_${MACHINE} += \"webui-vue\"\n</code></pre> <p>\u6ce8\uff1aCSDN \u6587\u7ae0\u91cc\u8def\u5f84\u6253\u9519\u4e86\uff0cimage \u5e94\u8be5\u4e3a images\u3002</p> <p>\u7f16\u8f91 <code>meta-phosphor/recipes-phosphor/packagegroups/packagegroup-obmc-apps.bbappend</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p> <pre><code>RDEPENDS_${PN}-inventory_${MACHINE} += \"webui-vue\"\n</code></pre> <p>\u6ce8\uff1aromulus \u53ef\u4ee5\u5de5\u4f5c\u662f\u56e0\u4e3a\u5728 <code>meta-ibm/meta-romulus/recipes-phosphor/packagegroups/packagegroup-obmc-apps.bbappend</code> \u91cc\u9762\u6709 <code>RDEPENDS:${PN}-extras:append:romulus = \" webui-vue phosphor-image-signing\"</code>\u3002</p> <p>\u91cd\u65b0\u6784\u5efa\u7cfb\u7edf\u955c\u50cf\uff1a</p> <pre><code>cd openbmc\n. setup evb-ast2600\nbitbake obmc-phosphor-image -c clean\nbitbake obmc-phosphor-image\n</code></pre> <p>\u6b64\u65f6\u5c31\u4f1a\u628a webui-vue \u4e5f\u6784\u5efa\u8fdb\u53bb\uff0c\u518d\u6b21\u542f\u52a8 QEMU \u7684\u65f6\u5019\u5c31\u6709 WebUI \u4e86\u3002</p>","tags":["bmc","openbmc","qemu"]},{"location":"system/2023/02/07/openbsd-xonly/","title":"OpenBSD xonly \u5b9e\u73b0\u539f\u7406","text":"","tags":["openbsd","xonly","security"]},{"location":"system/2023/02/07/openbsd-xonly/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u770b\u5230 xonly status\uff0c\u770b\u5230 OpenBSD \u6700\u8fd1\u5728\u5b9e\u73b0 xonly\uff0c\u4e5f\u5c31\u662f\u8ba9\u4e00\u4e9b\u9875\u53ea\u80fd\u6267\u884c\uff0c\u4e0d\u80fd\u8bfb\u4e0d\u80fd\u5199\u3002\u4ee5\u5f80\u7c7b\u4f3c\u7684\u505a\u6cd5\u662f <code>W^X</code>\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u6267\u884c\u7684\u65f6\u5019\u4e0d\u80fd\u5199\uff0c\u53ef\u4ee5\u5199\u7684\u65f6\u5019\u4e0d\u80fd\u6267\u884c\u3002\u663e\u7136\uff0cxonly \u662f\u66f4\u52a0\u4e25\u683c\u7684\uff0c\u8fde\u8bfb\u90fd\u4e0d\u53ef\u4ee5\u3002\u67e5\u4e86\u4e00\u4e0b\u5386\u53f2\uff0c<code>W^X</code> \u6700\u65e9\u4e5f\u662f\u5728 OpenBSD \u4e2d\u5b9e\u73b0\u7684\uff0c\u8bf4\u4e0d\u5b9a\u4ee5\u540e xonly \u4e5f\u4f1a\u88ab\u5404\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u3002</p>","tags":["openbsd","xonly","security"]},{"location":"system/2023/02/07/openbsd-xonly/#amd64-\u4e0a\u7684\u5b9e\u73b0","title":"amd64 \u4e0a\u7684\u5b9e\u73b0","text":"<p>\u5728 amd64 \u7684\u9875\u8868\u4e2d\uff0c\u51b3\u5b9a\u6267\u884c/\u8bfb/\u5199\u6743\u9650\u7684\u662f\uff08\u89c1 Intel \u6587\u6863 <code>Table 4-20. Format of a Page-Table Entry that Maps a 4-KByte Page</code>\uff09\uff1a</p> <ul> <li>Bit 1(R/W): <code>Read/write; if 0, writes may not be allowed to the 4-KByte page referenced by this entry (see Section 4.6)</code></li> <li>Bit 63(XD): <code>If IA32_EFER.NXE = 1, execute-disable (if 1, instruction fetches are not allowed from the 4-KByte page controlled by this entry; see Section 4.6); otherwise, reserved (must be 0)</code></li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u8fd9\u4e2a\u5b9a\u4e49\u4e0b\uff0c\u53ef\u80fd\u51fa\u73b0\u7684\u6743\u9650\u7ec4\u5408\uff1a</p> R W X R/W=0, NXE=0 Y N Y R/W=1, NXE=0 Y Y Y R/W=0, NXE=1, XD=0 Y N Y R/W=1, NXE=1, XD=0 Y Y Y R/W=0, NXE=1, XD=1 Y N N R/W=1, NXE=1, XD=1 Y Y N <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>IA32_EFER.NXE</code> \u662f\u5168\u5c40\u7684\uff0c\u800c <code>R/W</code> \u548c <code>XD</code> \u7684\u7c92\u5ea6\u662f\u9875\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u7684\u6240\u6709\u7ec4\u5408\u4e2d\uff0c\u90fd\u662f\u53ef\u4ee5\u8bfb\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u600e\u4e48\u5b9e\u73b0 x-only \u5462\uff1fOpenBSD \u7684\u5b9e\u73b0\u65b9\u6cd5\u662f Protection Keys\u3002\u5728\u6bd4\u8f83\u65b0\u7684 CPU \u4e2d\uff0c\u9875\u8868\u7684 4 \u4e2a\u4f4d\u7528\u6765\u8868\u793a\u4f7f\u7528\u7684 Protection Key \u4e0b\u6807\uff0c\u4e00\u5171\u6709 16 \u4e2a\uff1a</p> <ul> <li>Bits 62:59: <code>Protection key; if CR4.PKE = 1 or CR4.PKS = 1, this may control the page's access rights (see Section 4.6.2); otherwise, it is ignored and not used to control access rights.</code></li> </ul> <p>\u90a3\u4e48 CPU \u5728\u67e5\u9875\u8868\u7684\u65f6\u5019\uff0c\u5982\u679c <code>CR4.PKE=1 or CR4.PKS=1</code>\uff0c\u5c31\u4f1a\u6839\u636e\u8fd9\u56db\u4e2a\u4f4d\u53bb\u67e5\u627e PKRU \u5bc4\u5b58\u5668\u7684\u53d6\u503c\u3002PKRU \u662f\u4e00\u4e2a 32 \u4f4d\u7684\u5bc4\u5b58\u5668\uff0c\u6bcf\u4e24\u4f4d\u5bf9\u5e94\u4e00\u4e2a Protection Key\uff0c\u8fd9\u4e24\u4f4d\u8868\u793a\u662f\u5426\u5141\u8bb8\u8bfb\u5199\uff1a</p> <pre><code>The PKRU register (protection-key rights for user pages) is a 32-bit\nregister with the following format: for each i (0 \u2264 i \u2264 15), PKRU[2i] is\nthe access-disable bit for protection key i (ADi); PKRU[2i+1] is the\nwrite-disable bit for protection key i (WDi). The IA32_PKRS MSR has the\nsame format (bits 63:32 of the MSR are reserved and must be zero).\n</code></pre> <p>\u6709\u4e86\u8fd9\u4e2a\u673a\u5236\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u51fa xonly \u7684\u9875\u8868\u9879\uff1a</p> <ul> <li>R/W=0\uff1a\u4e0d\u5141\u8bb8\u5199</li> <li>NXE=1, XD=0\uff1a\u5141\u8bb8\u6267\u884c</li> <li>\u8bbe\u7f6e 62:59 \u4f4d\u4e3a\u4e00\u4e2a Key \u7f16\u53f7\uff0c\u5c06\u5bf9\u5e94\u7684 PKRU \u7684\u4e24\u4e2a\u4f4d\u8bbe\u4e3a 1\uff1a\u4e0d\u5141\u8bb8\u8bfb\uff0c\u4e0d\u5141\u8bb8\u5199</li> </ul> <p>\u63a5\u4e0b\u6765\u770b OpenBSD \u7684\u4ee3\u7801\uff1a</p> <p>\u9996\u5148\uff0c\u68c0\u6d4b CPU \u662f\u5426\u652f\u6301 PKU \u673a\u5236\uff1a</p> <pre><code>/*\n * If PKU is available, initialize PROT_EXEC entry correctly,\n * and enable the feature before it gets used\n * XXX Some Hypervisors forget to save/restore PKU\n */\nif (cpuid_level &gt;= 0x7) {\n    uint32_t ecx, dummy;\n    CPUID_LEAF(0x7, 0, dummy, dummy, ecx, dummy);\n    if ((ecx &amp; SEFF0ECX_PKU) &amp;&amp;\n        (cpu_ecxfeature &amp; CPUIDECX_HV) == 0) {\n        lcr4(rcr4() | CR4_PKE);\n        pg_xo = PG_XO;\n    }\n}\n</code></pre> <p>\u5176\u4e2d <code>PG_XO</code> \u7684\u503c\u662f <code>0x0800000000000000UL</code>\uff0c\u4e5f\u5c31\u662f\u53ea\u6709 bit 59 \u4f4d 1\uff0c\u5bf9\u5e94 Protection Key #1\u3002OpenBSD \u5185\u6838\u8bbe\u7f6e PKRU \u5bc4\u5b58\u5668\u4e3a <code>0xfffffffc</code>\uff0c\u5373\u53ea\u6709 Protection Key #0 \u4e0d\u4fee\u6539\u6743\u9650\uff0c\u5176\u4ed6 Protection Key \u90fd\u662f\u7981\u6b62\u8bfb\u5199\u3002\u5269\u4e0b\u7684\u4ee3\u7801\u5c31\u662f\u7ef4\u62a4 PKRU \u5bc4\u5b58\u5668\u7684\u53d6\u503c\uff0c\u7136\u540e\u628a xonly \u7684\u9875\u7684 Protection Key \u90fd\u8bbe\u4e3a 1\uff0c\u5426\u5219\u8bbe\u4e3a 0\u3002</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cPKRU \u5bc4\u5b58\u5668\u7528\u6237\u6001\u4e5f\u53ef\u4ee5\u8bfb\u5199\u3002Linux \u628a PKRU \u66b4\u9732\u7ed9\u4e86\u7528\u6237\u6001\uff0c\u5141\u8bb8\u7528\u6237\u6001\u6765\u81ea\u5df1\u8bbe\u7f6e\u9875\u8868\u7684 Protection Key\u3002OpenBSD \u7684\u5b9e\u73b0\u65b9\u6cd5\u5219\u662f\u8fdb\u5185\u6838\u4ee5\u540e\uff0c\u68c0\u67e5 PKRU \u5bc4\u5b58\u5668\uff0c\u5982\u679c\u503c\u4fee\u6539\u4e86\uff0c\u5c31 SIGABRT\u3002\u8fd9\u6709\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u5982\u679c\u653b\u51fb\u4ee3\u7801\u4fee\u6539\u4e86 PKRU \u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u662f\u6709\u53ef\u80fd\u8bfb\u53d6\u672c\u6765 xonly \u7684\u9875\u7684\u5185\u5bb9\u7684\u3002</p>","tags":["openbsd","xonly","security"]},{"location":"system/2023/02/07/openbsd-xonly/#powerpc64-\u4e0a\u7684\u5b9e\u73b0","title":"powerpc64 \u4e0a\u7684\u5b9e\u73b0","text":"<p>powerpc64 \u7684\u5b9e\u73b0\u65b9\u6cd5\u548c amd64 \u7c7b\u4f3c\uff0c\u89c1 commit\u3002\u673a\u5236\u548c AMD64 \u5f88\u50cf\uff0c\u4e0b\u9762\u5f15\u7528\u4e00\u6bb5 PowerISA \u6587\u6863\uff1a</p> <pre><code>The Virtual Page Class Key Protection mechanism provides the means to\nassign virtual pages to one of 32 classes, and to modify data access\npermissions for each class by modifying the Authority Mask Register\n(AMR), shown in Figure 28, and to modify instruction access permissions\nfor each class by modifying the Instruction Authority Mask Register\n(IAMR) shown in Figure 29.\n</code></pre> <p>\u5bf9\u5e94\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>// sys/arch/powerpc64/powerpc64/cpu.c\n    /*\n     * Set AMR to inhibit loads and stores for all virtual page\n     * class keys, except for Key0 which is used for normal kernel\n     * access.  This means we can pick any other key to implement\n     * execute-only mappings.  But we pick Key1 since that allows\n     * us to use the same bit in the PTE as was used to enable the\n     * Data Access Compare mechanism on CPUs based on older\n     * versions of the architecture (such as the PowerPC 970).\n     *\n     * Set UAMOR (and AMOR just to be safe) to zero to prevent\n     * userland from modifying any bits in AMR.\n     */\n    mtamr(0x3fffffffffffffff);\n    mtuamor(0);\n    mtamor(0);\n    isync();\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u65b9\u6cd5\u662f\u4e00\u6837\u7684\uff0cKey0 \u6b63\u5e38\uff0c\u5176\u4ed6 Key \u7981\u6b62\u8bfb\u5199\u3002\u989d\u5916\u5730\uff0cPowerISA \u8fd8\u53ef\u4ee5\u8bbe\u7f6e Protection Key \u7981\u6b62\u6267\u884c\u3002\u5e76\u4e14\u901a\u8fc7\u8bbe\u7f6e UAMOR \u5bc4\u5b58\u5668\uff0c\u7528\u6237\u6001\u4e0d\u53ef\u4ee5\u4fee\u6539 AMR \u5bc4\u5b58\u5668\uff0c\u8fd9\u8ba9 xonly \u6bd4 AMD64 \u4e0a\u66f4\u4e3a\u5b8c\u5907\u3002</p> <p>\u6700\u540e\u4e00\u6b65\uff0c\u5c31\u662f\u4fee\u6539 PTE \u5c5e\u6027\uff0c\u6307\u5b9a Key \u5373\u53ef\uff1a</p> <pre><code>// sys/arch/powerpc64/include/pte.h\n#define PTE_AC          0x0000000000000200ULL\n// sys/arch/powerpc64/powerpc64/pmap.c\n    if ((prot &amp; (PROT_READ | PROT_WRITE)) == 0)\n        pte-&gt;pte_lo |= PTE_AC;\n</code></pre>","tags":["openbsd","xonly","security"]},{"location":"system/2023/02/07/openbsd-xonly/#\u5176\u4ed6\u6307\u4ee4\u96c6\u67b6\u6784","title":"\u5176\u4ed6\u6307\u4ee4\u96c6\u67b6\u6784","text":"<p>\u4e00\u4e9b\u6307\u4ee4\u96c6\u67b6\u6784\u7684\u9875\u8868\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5c31\u6709\u72ec\u7acb\u7684 R W X \u6743\u9650\u4f4d\uff0c\u4e8e\u662f\u4e0d\u9700\u8981\u7279\u6b8a\u7684\u5904\u7406\uff0c\u76f4\u63a5\u628a mmap \u7684\u53c2\u6570\u6620\u5c04\u8fc7\u53bb\u5373\u53ef\u3002</p>","tags":["openbsd","xonly","security"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/","title":"\u4e00\u6b21\u4ece RHEL 6 \u5230 CentOS 7 \u7684\u66f4\u65b0","text":"","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6709\u4e00\u53f0 RHEL 6 \u7684\u670d\u52a1\u5668\uff0c\u5404\u79cd\u8f6f\u4ef6\u7248\u672c\u592a\u8001\u4e86\uff0c\u7528\u8d77\u6765\u5f88\u96be\u53d7\uff0c\u56e0\u6b64\u60f3\u5347\u7ea7\u3002\u4e00\u5f00\u59cb\u60f3\u5347\u7ea7\u5230 RHEL 7\uff0c\u4f46\u662f\u53d1\u73b0\u5fc5\u987b\u8981\u4ece RedHat \u4e0b\u8f7d ISO\uff0c\u6bd4\u8f83\u6162\uff0c\u6240\u4ee5\u6211\u5c31\u5148\u5207\u6362\u5230 CentOS 6\uff0c\u518d\u5347\u7ea7\u5230 CentOS 7</p>","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#rhel-6-pre-upgrade","title":"RHEL 6 Pre upgrade","text":"<p>\u4e00\u5f00\u59cb\u8fd8\u662f\u6253\u7b97\u5347\u7ea7\u5230 RHEL 7\uff0c\u6240\u4ee5\u8ddf\u968f RedHat \u7684\u6587\u6863\u53bb\u505a pre upgrade check\uff0c\u53d1\u73b0\u6709\u4e00\u6b65\u8981\u8dd1\u597d\u4e45\uff0c\u7f51\u4e0a\u641c\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u8fd9\u4e2a\u6b65\u9aa4\u4f1a\u626b\u63cf\u5df2\u6709\u7684\u5404\u79cd\u7a0b\u5e8f\uff0c\u68c0\u67e5\u5347\u7ea7\u4ee5\u540e\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u4e0d\u80fd\u8fd0\u884c\u7684\u95ee\u9898\u3002\u4f46\u662f\u5982\u679c\u6709\u5f88\u591a\u5c0f\u6587\u4ef6\uff0c\u8fd9\u4e00\u4e2a\u8fc7\u7a0b\u5c31\u4f1a\u8fdb\u884c\u5f88\u4e45\uff0c\u597d\u5728\u53ef\u4ee5\u8bbe\u7f6e exclusion \u76ee\u5f55\u3002\u6700\u540e\u68c0\u67e5\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u662f GNOME \u6ca1\u6cd5\u5347\u7ea7\uff0c\u5efa\u8bae\u5378\u8f7d\u3002</p> <p>\u5012\u817e\u4e86\u4e00\u4e0b\u5347\u7ea7\u5de5\u5177\uff0c\u53d1\u73b0\u9700\u8981\u79bb\u7ebf\u5b89\u88c5\uff0c\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6211\u5c31\u5e72\u8106\u6362 CentOS \u4e86\u3002</p>","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#rhel-6---centos-6","title":"RHEL 6 -&gt; CentOS 6","text":"<p>\u9996\u5148\uff0c\u628a\u8f6f\u4ef6\u6e90\u90fd\u5207\u6362\u5230 CentOS\uff0c\u8fd9\u4e00\u6b65\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u5305\u90fd\u662f\u4e00\u6837\u7684\u3002\u53ea\u4e0d\u8fc7\uff0c\u56e0\u4e3a CentOS 6 \u5728 centos-vault \u91cc\u9762\uff0c\u6240\u4ee5\u7528\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\u3002</p>","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#centos-6---centos-7","title":"CentOS 6 -&gt; CentOS 7","text":"<p>\u7531\u4e8e CentOS 6 \u5230 CentOS 7 \u5347\u7ea7\u6d89\u53ca\u7684\u6539\u52a8\u6bd4\u8f83\u591a\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5347\u7ea7\u5de5\u5177\u3002\u4e00\u5f00\u59cb\uff0c\u6211\u60f3\u76f4\u63a5\u5347\u7ea7\u5230 CentOS 7 \u6700\u65b0\u7248\u672c\uff0c\u4f46\u662f\u62a5\u9519\uff0c\u770b\u5230\u7f51\u4e0a\u8bf4\u53ef\u4ee5\u5347\u7ea7\u5230 CentOS 7 \u7684\u65e9\u671f\u7248\u672c\uff0c\u8bd5\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u6ca1\u95ee\u9898\u3002</p> <p>\u4e00\u901a\u5347\u7ea7\u4ee5\u540e\uff0c\u91cd\u542f\uff0c\u8fdb\u5165\u66f4\u65b0\u8fc7\u7a0b\uff0c\u53d1\u73b0\u5f88\u591a\u5305\u90fd\u5b89\u88c5\u5931\u8d25\u4e86\u3002\u91cd\u542f\u4ee5\u540e\uff0c\u56e0\u4e3a\u627e\u4e0d\u5230 rootfs\uff0c\u6302\u5728\u4e86 dracut \u7684 initramfs \u91cc\u9762\u3002</p>","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2021/08/30/rhel6-upgrade-centos7/#\u6f2b\u957f\u7684\u4fee\u590d\u8fc7\u7a0b","title":"\u6f2b\u957f\u7684\u4fee\u590d\u8fc7\u7a0b","text":"<p>\u7b80\u5355\u8bd5\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0 dracut \u7684 initramfs \u91cc\u7a0b\u5e8f\u592a\u5c11\u4e86\uff0c\u8c03\u8bd5\u8d77\u6765\u5f88\u75db\u82e6\u3002\u6240\u4ee5\uff0c\u6211\u5728 BMC \u91cc\u901a\u8fc7 Virtual Media \u6302\u4e86\u4e00\u4e2a Arch Linux \u7684 Live CD\u3002\u56e0\u4e3a\u901a\u8fc7 Web \u8bbf\u95ee\u5ef6\u8fdf\u592a\u9ad8\uff0c\u6211\u8bbe\u4e86\u4e00\u4e2a root \u5bc6\u7801\uff0c\u7136\u540e\u76f4\u63a5 ssh \u5230 live cd \u7cfb\u7edf\u4e2d\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u53d1\u73b0\uff0c\u53ef\u4ee5\u6b63\u5e38\u627e\u5230\u76d8\u548c\u91cc\u9762\u7684\u5404\u4e2a\u5206\u533a\uff0c\u6240\u4ee5\u6000\u7591\u662f\u4e4b\u524d initramfs \u91cc\u7f3a\u4e86\u4ec0\u4e48\u4e1c\u897f\uff0c\u5bfc\u81f4\u627e\u4e0d\u5230\u786c\u76d8\u3002\u6211 arch-chroot \u5230 root \u5206\u533a\u91cc\uff0c\u7136\u540e\u624b\u52a8\u66f4\u65b0\u5404\u4e2a\u5305\uff0c\u7279\u522b\u9ebb\u70e6\uff1a\u6211\u9996\u5148\u5347\u7ea7\u4e86 yum repos \u5230\u6700\u65b0\u7684 CentOS 7\uff0c\u7136\u540e\u624b\u52a8\u5220\u6389/\u5347\u7ea7 el6 \u7684\u5404\u4e2a\u8f6f\u4ef6\u5305\u3002\u6700\u540e\u597d\u4e0d\u5bb9\u6613\u628a kernel \u7ec8\u4e8e\u5347\u7ea7\u597d\u4e86\uff0c\u53c8\u91cd\u65b0\u751f\u6210 grub2 \u7684\u914d\u7f6e\uff0c\u56e0\u4e3a CentOS 6 \u662f grub1\u3002\u8fd9\u65f6\u5019\uff0c\u91cd\u542f\u8fdb\u5165\u7cfb\u7edf\uff0c\u53d1\u73b0\u53ef\u4ee5\u627e\u5230 rootfs \u4e86\uff0c\u4f46\u662f\u7ecf\u8fc7 selinux relabel \u4ee5\u540e\uff0c\u4ecd\u7136\u4f1a\u9047\u5230 systemd-logind \u8d77\u4e0d\u6765\u7684\u95ee\u9898\uff0c\u4f34\u968f\u7740\u4e00\u7cfb\u5217\u7684 audit \u62a5\u8b66\u3002</p> <p>\u6700\u540e\uff0c\u4f7f\u51fa\u4e86\u66b4\u529b\u7684\u89e3\u51b3\u529e\u6cd5\uff1a\u5728 cmdline \u4e2d\u8bbe\u7f6e selinux=0 audit=0\uff0c\u7136\u540e\u7ec8\u4e8e\u8fdb\u5165\u7cfb\u7edf\u4e86\u3002\u518d\u7ee7\u7eed\u5220\u6389\u4e00\u4e9b el6 \u7684\u5305\uff0c\u7136\u540e\u5347\u7ea7\u5404\u79cd\u5305\uff0c\u6700\u540e\u7ec8\u4e8e\u662f\u6062\u590d\u4e86\u6b63\u5e38\u3002</p>","tags":["rhel","centos","upgrade","linux"]},{"location":"system/2023/04/09/sco5/","title":"SCO OpenServer 5.0.7 \u865a\u62df\u673a\u5b89\u88c5","text":"","tags":["sco","unixware","unix"]},{"location":"system/2023/04/09/sco5/#\u5b89\u88c5\u8fc7\u7a0b","title":"\u5b89\u88c5\u8fc7\u7a0b","text":"<p>\u9996\u5148\u4ece https://www.sco.com/support/update/download/release.php?rid=218 \u4e0b\u8f7d SCO OpenServer \u7684\u5b89\u88c5 ISO \u548c\u4ece https://www.sco.com/support/update/download/release.php?rid=187 \u4e0b\u8f7d Supplement CD 5 ISO\uff0c\u7136\u540e\u7528 QEMU \u542f\u52a8\uff0c\u8fd9\u6b21\u9700\u8981\u7528\u56fe\u5f62\u754c\u9762\uff1a</p> <pre><code>qemu-system-i386 -accel kvm -m 16384 -serial mon:stdio -drive file=sco-hdd.qcow2,if=ide -cdrom ../../ISOs/OpenServer-5.0.7Hw-10Jun05_1800.iso\n</code></pre> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u8be2\u95ee License number \u548c License code\uff0c\u6309\u7167 https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/ \u8fdb\u884c\u8f93\u5165\u3002</p> <p>\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u5728 hard disk setup \u90a3\u4e00\u6b65\uff0c\u8bb0\u5f97\u5173\u6389 bad tracking\uff0c\u5426\u5219\u4f1a\u628a\u6574\u4e2a\u76d8\u626b\u4e00\u904d\uff0c\u6211\u4e00\u5f00\u59cb\u5efa\u4e86 20GB \u7684 qcow2\uff0c\u7ed3\u679c\u8fd9\u4e00\u6b65\u8dd1\u4e86\u4e00\u665a\u4e0a\uff0c\u800c\u4e14\u628a qcow2 \u6491\u6ee1\u4e86\u3002</p> <p>\u5b89\u88c5\u540e\uff0c\u91cd\u65b0\u542f\u52a8\uff0c\u8fd9\u6b21\u6253\u5f00\u7f51\u7edc\uff0c\u540c\u65f6\u6302\u8f7d Supplement CD 5 ISO\uff1a</p> <pre><code>qemu-system-i386 -accel kvm -m 16384 -serial chardev:mouse -drive file=sco-hdd.qcow2,if=ide -cdrom osr507suppcd5.iso -net nic -net tap,script=no,ifname=tap0 -chardev msmouse,id=mouse\n</code></pre> <p>\u542f\u52a8\u4ee5\u540e\uff0c\u8fd0\u884c custom \u547d\u4ee4\uff0c\u7136\u540e\u4ece CD-ROM \u5b89\u88c5 Graphics and NIC Drivers\u3002\u6211\u5c1d\u8bd5\u4e86\u5b89\u88c5 Maintenance Pack 5\uff0c\u4f46\u662f\u542f\u52a8\u4ee5\u540e\u4f1a\u627e\u4e0d\u5230\u786c\u76d8\uff0c\u53ea\u597d\u6062\u590d\u4e4b\u524d\u7684 qcow2 \u5907\u4efd\u3002\u53ef\u80fd\u662f\u7f3a\u5c11\u4e86\u8fd0\u884c <code>/etc/conf/cf.d/link_unix</code> \u547d\u4ee4\u3002</p> <p>\u4e3a\u4e86\u8ba9\u56fe\u5f62\u754c\u9762\u7684\u9f20\u6807\u5de5\u4f5c\uff0c\u5728\u547d\u4ee4\u884c\u91cc\u8fd0\u884c <code>mkdev mouse</code>\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a Serial mouse -&gt; Microsoft Serial Mouse\uff0cRelink kernel \u518d\u91cd\u542f\u3002\u6ce8\u610f\u8981\u548c QEMU \u7684 <code>-serial chardev:mouse -chardev msmouse,id=mouse</code> \u914d\u5408\u3002\u4f46\u662f\u5916\u9762\u9f20\u6807\u548c\u91cc\u9762\u9f20\u6807\u79fb\u52a8\u7684\u8ddd\u79bb\u4e0d\u4e00\u6837\u3002</p> <p>\u7136\u540e\u8fd0\u884c <code>netconfig</code> \u547d\u4ee4\uff0c\u6dfb\u52a0 LAN adapter\uff0c\u9009\u62e9 Intel \u7f51\u5361\uff0c\u7136\u540e\u9000\u51fa\uff0cRelink kernel \u7136\u540e\u91cd\u542f\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u7f51\u7edc\u4e86\u3002\u53ef\u4ee5\u7528 <code>ifconfig net0 10.0.2.16</code> \u8bbe\u7f6e IP \u5730\u5740\uff0c <code>route add default 10.0.2.15</code> \u6765\u8bbe\u7f6e\u9ed8\u8ba4\u8def\u7531\u3002\u53ef\u4ee5\u901a\u8fc7\u964d\u4f4e\u5b89\u5168\u6027\uff0c\u517c\u5bb9\u8001\u7cfb\u7edf\u6765 SSH\uff1a</p> <pre><code>ssh -oCiphers=aes128-cbc -oHostKeyAlgorithms=ssh-rsa -oKexAlgorithms=+diffie-hellman-group1-sha1 root@10.0.2.16\n</code></pre> <p>\u7c7b\u4f3c\u5730\uff0cscp \u4e5f\u8981\u5e26\u4e0a\u4e0a\u9762\u7684\u53c2\u6570\uff0c\u518d\u6253\u5f00 <code>-O</code> \u6a21\u5f0f\u3002</p>","tags":["sco","unixware","unix"]},{"location":"system/2023/04/09/sco5/#\u5b89\u88c5\u8f6f\u4ef6","title":"\u5b89\u88c5\u8f6f\u4ef6","text":"<p>OpenServer \u6709\u81ea\u5e26\u7684\u5de5\u5177\u94fe\uff1a\u6302\u8f7d\u5b89\u88c5 ISO\uff0c\u4f7f\u7528 custom \u547d\u4ee4\u5b89\u88c5 OpenServer Development System \u548c SCO OpenServer Linker and Application Development Libraries\u3002\u4f46\u662f\u9700\u8981 License \u624d\u80fd\u4f7f\u7528\u3002</p> <p>\u53e6\u4e00\u4e2a\u65b9\u6cd5\u662f\u901a\u8fc7 FTP \u8bbf\u95ee ftp://ftp2.sco.com/pub/skunkware/osr5/vols/\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u8f6f\u4ef6\u7684\u5b89\u88c5\u5305\uff0c\u5728\u91cc\u9762\u4e0b\u8f7d\u8f6f\u4ef6\u5e76\u5b89\u88c5\u3002\u4f8b\u5982\uff0c\u8981\u5b89\u88c5 gcc\uff1a</p> <pre><code>wget ftp://ftp2.sco.com/pub/skunkware/osr5/vols/gcc-2.95.2-VOLS.tar\nscp -r -O -oCiphers=aes128-cbc -oHostKeyAlgorithms=ssh-rsa -oKexAlgorithms=+diffie-hellman-group1-sha1 gcc-2.95.2-VOLS.tar root@10.0.2.16:/\n# in sco5\ntar xf gcc-2.95.2-VOLS.tar\n# Install from Media Images\ncustom\n/usr/local/bin/gcc --version\n</code></pre> <p>\u4f9d\u6cd5\u70ae\u5236\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc\u3001bash\u3001make\u3001git \u7b49\u5e38\u7528\u8f6f\u4ef6\uff0c\u53ea\u4e0d\u8fc7\u7248\u672c\u90fd\u5f88\u8001\u3002</p>","tags":["sco","unixware","unix"]},{"location":"system/2023/04/09/sco5/#virtualbox","title":"VirtualBox","text":"<p>\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u5728 VirtualBox 7.0.6 \u4e2d\uff0c\u53ef\u4ee5\u6b63\u5e38\u5b89\u88c5 SCO OpenServer 5\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u8bbe\u7f6e\uff0c\u6309\u7167\u4e0a\u9762\u4e00\u6837\u7684\u65b9\u6cd5\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\uff0c\u9f20\u6807\u9009\u62e9 PS/2 Microsoft Mouse\uff0c\u548c QEMU \u4e00\u6837\u6709\u79fb\u52a8\u8ddd\u79bb\u4e0d\u5bf9\u7684\u60c5\u51b5\u3002\u5b89\u88c5\u5b8c\uff0c\u628a\u786c\u76d8\u542f\u52a8\u987a\u5e8f\u8c03\u5230\u524d\u9762\uff0c\u91cd\u542f\u5373\u53ef\u3002</p> <p>\u7f51\u5361\u7684\u8bdd\uff0c\u7167\u5e38 <code>netconfig</code>\uff0c\u7136\u540e\u6dfb\u52a0 AMD PCNet \u7f51\u5361\u5373\u53ef\u3002</p>","tags":["sco","unixware","unix"]},{"location":"system/2023/04/09/sco5/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<p>\u672c\u535a\u5ba2\u53c2\u8003\u4e86\u4ee5\u4e0b\u6587\u6863\u4e2d\u7684\u547d\u4ee4\uff1a</p> <ul> <li>https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/</li> </ul>","tags":["sco","unixware","unix"]},{"location":"system/2023/04/10/sco6/","title":"SCO OpenServer 6.0.0 \u865a\u62df\u673a\u5b89\u88c5","text":"","tags":["sco","unixware","unix"]},{"location":"system/2023/04/10/sco6/#\u5b89\u88c5\u8fc7\u7a0b","title":"\u5b89\u88c5\u8fc7\u7a0b","text":"<p>\u9996\u5148\u4ece https://www.sco.com/support/update/download/product.php?pfid=12&amp;prid=20 \u4e0b\u8f7d SCO OpenServer \u7684\u5b89\u88c5 ISO\u3002\u5c1d\u8bd5\u8fc7\u7528 QEMU \u542f\u52a8\uff0c\u4f46\u662f\u4f1a\u5361\u5728\u65e0\u6cd5\u8bfb\u53d6\u786c\u76d8\u7684\u9519\u8bef\u4e0a\u3002</p> <p>\u6700\u540e\u4f7f\u7528 VirtualBox 7.0.6 \u6210\u529f\u542f\u52a8\uff0c\u6ce8\u610f\u521b\u5efa\u865a\u62df\u673a\u7684\u65f6\u5019\u4e0d\u8981\u7ed9\u592a\u591a\u5185\u5b58\uff0c\u4f8b\u5982 4GB \u5c31\u8d77\u4e0d\u6765\uff0c2GB \u53ef\u4ee5\u3002\u786c\u76d8\u6211\u4e5f\u53ea\u7ed9\u4e86 4GB \u7684\u7a7a\u95f4\u3002</p> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u8be2\u95ee License number \u548c License code\uff0c\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 Evaluation License\uff0c\u6216\u8005\u4f7f\u7528\u4e0b\u9762\u53c2\u8003\u6587\u6863\u4e2d\u63d0\u4f9b\u7684 License\u3002\u6309\u7167\u6d41\u7a0b\u4e00\u76f4\u8d70\u5c31\u53ef\u4ee5\u4e86\u3002\u5982\u679c\u91cd\u542f\u51fa\u73b0\u65e0\u6cd5 mount root \u7684\u95ee\u9898\uff0c\u5c31 poweroff \u518d\u5f00\u673a\u3002</p>","tags":["sco","unixware","unix"]},{"location":"system/2023/04/10/sco6/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<p>\u672c\u535a\u5ba2\u53c2\u8003\u4e86\u4ee5\u4e0b\u6587\u6863\u4e2d\u7684\u547d\u4ee4\uff1a</p> <ul> <li>https://virtuallyfun.com/2020/11/21/fun-with-openserver-6-and-mergepro/</li> </ul>","tags":["sco","unixware","unix"]},{"location":"system/2023/02/03/solaris/","title":"Solaris 11.4 \u5b89\u88c5","text":"","tags":["solaris"]},{"location":"system/2023/02/03/solaris/#\u4e0b\u8f7d\u5b89\u88c5\u955c\u50cf","title":"\u4e0b\u8f7d\u5b89\u88c5\u955c\u50cf","text":"<p>\u8bbf\u95ee https://www.oracle.com/solaris/solaris11/downloads/solaris-downloads.html\uff0c\u70b9\u51fb\u4e0b\u8f7d\uff0c\u767b\u5f55\u540e\u8df3\u8f6c\u5230\u4e00\u4e2a\u65b0\u7684\u9875\u9762\u3002\u5728 Platform \u4e0b\u62c9\u6846\u9009\u62e9 x86\uff0c\u4f1a\u51fa\u73b0\u4e00\u7cfb\u5217\u53ef\u4ee5\u4e0b\u8f7d\u7684\u6587\u4ef6\u3002\u4ee5 11.4.42.111.0 \u4e3a\u4f8b\uff0c\u9700\u8981\u4e0b\u8f7d\u7684\u662f\uff1aV1019840-01.iso Oracle Solaris 11.4.42.111.0 Interactive Text Install ISO (x86) for (Oracle Solaris on x86-64 (64-bit)), 890.5 MB\u3002\u53ef\u4ee5\u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u4e2d\u4e0b\u8f7d\uff0c\u4e5f\u53ef\u4ee5\u70b9\u51fb\u7f51\u9875\u4e2d\u7684 WGET Options\uff0c\u7528 wget \u811a\u672c\u4e0b\u8f7d\u3002</p> <p>\u4e0b\u8f7d\u4ee5\u540e\uff0c\u6302\u8f7d ISO \u5230\u865a\u62df\u673a\uff0c\u6b63\u5e38\u6309\u7167\u6307\u793a\u8fdb\u884c\u5b89\u88c5\u3002</p>","tags":["solaris"]},{"location":"system/2023/02/03/solaris/#\u914d\u7f6e\u8f6f\u4ef6\u6e90","title":"\u914d\u7f6e\u8f6f\u4ef6\u6e90","text":"<p>Solaris \u7684\u5728\u7ebf\u8f6f\u4ef6\u6e90\u9700\u8981\u8ba2\u9605\uff0c\u5982\u679c\u4e0d\u60f3\u8ba2\u9605\uff0c\u9700\u8981\u4e0b\u8f7d\u548c Solaris \u7248\u672c\u4e00\u81f4 \u7684 IPS \u4ed3\u5e93\u3002\u4e0b\u8f7d\u7684\u5730\u5740\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u9700\u8981 7 \u4e2a zip \u6587\u4ef6\uff0c\u5982 V1019847-01_1of7.zip Oracle Solaris 11.4.42.111.0 IPS Repository (SPARC, x86) for (Oracle Solaris on x86-64 (64-bit)), 2.2 GB\u3002\u5efa\u8bae\u7528 wget \u811a\u672c\u6279\u91cf\u4e0b\u8f7d\u3002</p> <p>UPDATE: \u6839\u636e https://blogs.oracle.com/solaris/post/building-open-source-software-on-oracle-solaris-114-cbe-release\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u4e0d\u4e0b\u8f7d IPS \u4ed3\u5e93\uff0c\u800c\u662f\u7528\u5728\u7ebf\u7684\u4ed3\u5e93\uff0c\u5185\u5bb9\u548c\u4e0b\u8f7d\u7684\u4e00\u81f4\uff1a</p> <pre><code>sudo pkg set-publisher -G '*' -g http://pkg.oracle.com/solaris/release/ solaris\n</code></pre> <p>\u4e0b\u8f7d\u597d\u4e86\u4ee5\u540e\uff0c\u5168\u90e8\u89e3\u538b\u5230\u4e00\u4e2a\u76ee\u5f55\u4e2d\uff0c\u5982 <code>/export/home/user/solaris</code>\uff0c\u7136\u540e\u542f\u52a8\u672c\u5730\u7684\u8f6f\u4ef6\u6e90\u670d\u52a1\uff1a</p> <pre><code>sudo svccfg -s application/pkg/server setprop pkg/inst_root=/export/home/user/solaris\nsudo svccfg -s application/pkg/server setprop pkg/readonly=true\nsudo svccfg -s application/pkg/server setprop pkg/port=8081\nsudo svcadm refresh application/pkg/server\nsudo svcadm enable application/pkg/server\n</code></pre> <p>\u7136\u540e\u914d\u7f6e <code>pkg</code> \u4f7f\u7528\u672c\u5730\u8f6f\u4ef6\u6e90\uff1a</p> <pre><code>sudo pkg set-publisher -G '*' -g http://localhost:8081 solaris\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86\uff1a</p> <pre><code>sudo pkg install gcc-11\n</code></pre> <p>\u547d\u4ee4\u53c2\u8003\uff1ahttps://www.oracle.com/docs/tech/solaris-11-cheat-sheet.pdf</p>","tags":["solaris"]},{"location":"system/2021/03/29/static-ipmitool/","title":"\u9759\u6001\u7f16\u8bd1 ipmitool","text":"<p>\u4e3a\u4e86\u5728 ESXi \u4e0a\u8fd0\u884c ipmitool\uff0c\u9700\u8981\u9759\u6001\u7f16\u8bd1 ipmitool\u3002\u7f51\u4e0a\u5df2\u7ecf\u6709\u4e00\u4e9b\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>https://github.com/ryanbarrie/ESXI-ipmitool https://github.com/hobbsh/static-ipmitool https://github.com/ewenmcneill/docker-build-static-ipmitool</p> <p>\u6211\u7a0d\u5fae\u4fee\u6539\u4e86\u4e00\u4e0b\uff0c\u7528\u6765\u7f16\u8bd1\u6700\u65b0 ipmitool\uff1a</p> <pre><code>#!/bin/bash\nset -x\nexport VERSION=1.8.18\nrm -rf ipmitool_$VERSION\ncurl -L -o ipmitool_$VERSION.tar.bz2 http://deb.debian.org/debian/pool/main/i/ipmitool/ipmitool_$VERSION.orig.tar.bz2\ntar xvf ipmitool_$VERSION.tar.bz2\ncd ipmitool-$VERSION\nCC=gcc CFLAGS=-m64 LDFLAGS=-static ./configure\nmake -j24\ncd src\n../libtool --silent --tag=CC --mode=link gcc -m64 -fno-strict-aliasing -Wreturn-type -all-static -o ipmitool.static ipmitool.o ipmishell.o ../lib/libipmitool.la plugins/libintf.la\nfile $PWD/ipmitool.static\n</code></pre> <p>\u590d\u5236\u4e0b\u6765\uff0c\u7f16\u8bd1\u5b8c\u6210\u540e scp \u5230 esxi \u4e2d\u5373\u53ef\u4f7f\u7528\u3002</p>","tags":["ipmitool","static"]},{"location":"system/2023/04/10/unixware7/","title":"UnixWare 7.1.4 \u865a\u62df\u673a\u5b89\u88c5","text":"","tags":["unixware","unix"]},{"location":"system/2023/04/10/unixware7/#\u5b89\u88c5\u8fc7\u7a0b","title":"\u5b89\u88c5\u8fc7\u7a0b","text":"<p>\u5728 https://www.sco.com/support/update/download/product.php?pfid=1&amp;prid=6 \u53ef\u4ee5\u770b\u5230 UnixWare 7.1.4 \u7684\u76f8\u5173\u4e0b\u8f7d\uff0c\u5176\u4e2d\u9996\u5148\u8981\u4e0b\u8f7d UnixWare \u7684\u5b89\u88c5 ISO\uff1ahttps://www.sco.com/support/update/download/release.php?rid=346\uff0c\u5c1d\u8bd5\u8fc7\u7528 QEMU \u542f\u52a8\uff0c\u4f1a\u9047\u5230\u627e\u4e0d\u5230 CD-ROM \u7684\u95ee\u9898\uff0c\u867d\u7136\u901a\u8fc7\u8bbe\u7f6e <code>ATAPI_DMA_DISABLE=YES</code> \u89e3\u51b3\u4e86\uff0c\u4f46\u662f\u53c8\u9047\u5230\u4e86\u627e\u4e0d\u5230\u786c\u76d8\u7684\u95ee\u9898\u3002</p> <p>\u6700\u540e\u6362\u6210\u4e86 VirtualBox 7.0.6\u3002\u7528 VirtualBox \u521b\u5efa\u865a\u62df\u673a\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u7ed9\u592a\u591a\u5185\u5b58\uff0c4GB \u5c31\u4f1a\u65e0\u6cd5\u542f\u52a8\uff0c2GB \u53ef\u4ee5\uff0c\u786c\u76d8\u4e5f\u4e0d\u8981\u7ed9\u592a\u591a\uff0c4GB \u5c31\u8db3\u591f\u3002</p> <p>\u5269\u4e0b\u5c31\u662f\u6309\u7167\u5b89\u88c5\u754c\u9762\u4e00\u8def\u9ed8\u8ba4\u5373\u53ef\uff0cLicense \u53ef\u4ee5\u9009\u62e9 Defer\uff0c\u4f7f\u7528 Evaluation License\u3002</p> <p>\u5173\u673a\u4ee5\u540e\uff0c\u4fee\u6539\u542f\u52a8\u987a\u5e8f\uff0c\u628a\u786c\u76d8\u653e\u5230 CD \u524d\uff0c\u7136\u540e\u542f\u52a8\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u7cfb\u7edf\u4e86\u3002\u5982\u679c\u91cd\u542f\u51fa\u73b0\u65e0\u6cd5 mount root \u7684\u95ee\u9898\uff0c\u5c31 poweroff \u518d\u5f00\u673a\u3002</p>","tags":["unixware","unix"]},{"location":"system/2023/04/10/unixware7/#\u53c2\u8003\u6587\u6863","title":"\u53c2\u8003\u6587\u6863","text":"<p>\u672c\u535a\u5ba2\u53c2\u8003\u4e86\u4ee5\u4e0b\u6587\u6863\u4e2d\u7684\u547d\u4ee4\uff1a</p> <ul> <li>https://virtuallyfun.com/2018/01/31/revisiting-a-unixware-7-1-1-install-on-qemu-kvm/</li> </ul>","tags":["unixware","unix"]},{"location":"system/2020/10/09/upgrade-power8-bmc/","title":"IBM Power S822LC(8335-GTB) BMC \u5347\u7ea7","text":"","tags":["bmc","ipmi","power","ibm"]},{"location":"system/2020/10/09/upgrade-power8-bmc/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1\u62ff\u5230\u4e00\u53f0 IBM Power S822LC\uff088335-GTB\uff09\u673a\u5668\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u8fd9\u4e5f\u662f\u6211\u7b2c\u4e00\u6b21\u78b0 ppc64le \u6307\u4ee4\u96c6\u7684\u670d\u52a1\u5668\u3002\u7136\u540e\u53d1\u73b0\uff0c\u5b83\u7684 BMC \u7248\u672c\u6bd4\u8f83\u8001\uff0c\u6211\u60f3\u8fde\u63a5 Remote Control \u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f JViewer \u4e0d\u652f\u6301 macOS\uff0c\u6211\u5c31\u60f3\u7740\u80fd\u4e0d\u80fd\u5347\u7ea7\u4e00\u4e0b\u3002</p>","tags":["bmc","ipmi","power","ibm"]},{"location":"system/2020/10/09/upgrade-power8-bmc/#\u5347\u7ea7\u8fc7\u7a0b","title":"\u5347\u7ea7\u8fc7\u7a0b","text":"<p>\u9996\u5148\uff0c\u5728\u7f51\u4e0a\u627e\u4e86\u4e00\u4e0b\u6587\u6863\uff0c\u9996\u5148\u7528 ipmitool \u627e\u4e00\u4e0b\u673a\u5668\u578b\u53f7\uff1a</p> <pre><code>$ sudo ipmitool fru print 3\n Chassis Type          : Unknown\n Chassis Part Number   : 8335-GTB\n Chassis Serial        : REDACTED\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u53f0\u673a\u5668\u662f 8335-GTB \u578b\u53f7\uff0c\u6309\u7167\u8fd9\u4e2a\u578b\u53f7\u5728 Fix Central \u4e0a\u641c\u7d22\uff0c\u53ef\u4ee5\u627e\u5230\u82e5\u5e72\u4e2a\u7248\u672c\u7684 firmware\uff0c\u5176\u4e2d\u6700\u8001\u7684\u7248\u672c\u662f <code>OP8_v1.11_2.1</code>\uff0c\u5bf9\u6bd4\u4e86\u4e00\u4e0b\uff0c\u548c\u539f\u6765\u7684\u7248\u672c\u4e00\u81f4\uff1a</p> <pre><code>$ sudo ipmitool fru print 47\n Product Name          : OpenPOWER Firmware\n Product Version       : IBM-garrison-ibm-OP8_v1.11_2.1\n Product Extra         :        op-build-da02863\n Product Extra         :        buildroot-81b8d98\n Product Extra         :        skiboot-5.3.6\n Product Extra         :        hostboot-1f6784d-3408af7\n Product Extra         :        linux-4.4.16-openpower1-bc83f92\n Product Extra         :        petitboot-v1.2.4-de6cda2\n Product Extra         :        garrison-xml-3db7b6e\n Product Extra         :        occ-69fb587\n Product Extra         :        hostboot-binar\n</code></pre> <p>\u4e8e\u662f\uff0c\u6211\u4e0b\u8f7d\u4e86\u6bd4\u8f83\u65b0\u7684\u7248\u672c\uff0c\u4e00\u4e2a hpm \u6587\u4ef6\uff0c\u7136\u540e\u5728 BMC \u7f51\u9875\u4e0a\u8fdb\u884c\u5347\u7ea7\u3002\u7b2c\u4e00\u6b21\u5347\u7ea7\u6bd4\u8f83\u4fdd\u5b88\uff0c\u9009\u62e9\u4e86 2017 \u5e74\u7684\u7248\u672c\uff1a</p> <pre><code>$ sudo ipmitool fru print 47\nProduct Name          : OpenPOWER Firmware\n Product Version       : IBM-garrison-ibm-OP8_v1.12_2.72\n Product Extra         :        op-build-14a75d0\n Product Extra         :        buildroot-211bd05\n Product Extra         :        skiboot-5.4.3\n Product Extra         :        hostboot-2eb7706-69b1432\n Product Extra         :        linux-4.4.30-openpower1-084eb48\n Product Extra         :        petitboot-v1.3.2-d709207\n Product Extra         :        garrison-xml-19a5164\n Product Extra         :        occ-d7efe30-47b58cb\n Product Extra         :        hostb\n</code></pre> <p>\u8fd9\u6b21\u5347\u7ea7\u6bd4\u8f83\u987a\u5229\uff0c\u6ca1\u6709\u9047\u5230\u4ec0\u4e48\u969c\u788d\u3002\u4f46\u662f\u6211\u53d1\u73b0\uff0cBMC \u91cc\u9762\u663e\u793a\u7684 BIOS \u7248\u672c\u548c hpm \u5bf9\u4e0d\u4e0a\uff0c\u5b83\u603b\u662f\u8ba4\u4e3a BIOS \u7248\u672c\u662f\u843d\u540e\u7684\uff0c\u9700\u8981\u66f4\u65b0\uff0c\u800c Firmware \u90e8\u5206\uff08BOOT \u548c APP\uff09\u662f\u66f4\u65b0\u540e\u7684\u7248\u672c\u3002\u4f46 BIOS \u7248\u672c\u548c\u539f\u6765\u7684\u7248\u672c\u4e5f\u4e0d\u4e00\u6837\u3002\u4e8e\u662f\u6211\u91cd\u65b0\u5347\u7ea7\u4e86\u51e0\u6b21\uff0c\u90fd\u6ca1\u6709\u6548\u679c\uff0c\u6000\u7591\u662f\u5347\u7ea7\u51fa\u4e86\u95ee\u9898\u3002\u540e\u6765\u4ed4\u7ec6\u8bfb\u6587\u6863\u624d\u53d1\u73b0\uff0c\u786e\u5b9e\u662f BMC \u8f6f\u4ef6\u7684\u95ee\u9898\uff08\u6587\u6863\uff09\uff1a</p> <pre><code>Note: BMC Dashboard shows an incorrect level for the BIOS caused by improper translation of the level subfields. The Bios number should reflect the PNOR level for the system of \"IBM-garrison-ibm-OP8_v1.11_2.19\". In this case, the BIOS version should be 1.11_2.19 but shows as 1.17.19 instead with the \"11_2\" converted into the \"17\".\n\nThe Firmware Revision for the BMC firmware shows correctly as \"2.13.58\".\n\nHere is an example output of the Dashboard with an errant BIOS Version:\n\nDashboard gives the overall information about the status of the device and remote server.\n\nDevice Information\n\nFirmware Revision: 2.13.58\n\nFirmware Build Time: Oct 26 2016 11:40:55 CDT\n\nBIOS Version: 1.17.19\n</code></pre> <p>\u4e00\u756a\u6363\u9f13\u4e4b\u540e\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u4e86\uff0cBMC \u5c31\u6302\u4e86\uff0c\u600e\u4e48\u8bbf\u95ee\u90fd\u4e0d\u901a\u3002\u53ea\u597d\u7269\u7406\u65ad\u7535\uff0c\u91cd\u65b0\u6765\u8fc7\u3002\u6309\u7167\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u5347\u7ea7\u5230\u4e86 2019 \u5e74\u7684\u7248\u672c\uff1a</p> <pre><code> Product Name          : OpenPOWER Firmware\n Product Version       : IBM-garrison-OP8_v1.12_2.96\n Product Extra         :        op-build-v2.3-7-g99a6bc8\n Product Extra         :        buildroot-2019.02.1-16-ge01dcd0\n Product Extra         :        skiboot-v6.3.1\n Product Extra         :        hostboot-p8-c893515-pd6f049d\n Product Extra         :        occ-p8-a2856b7\n Product Extra         :        linux-5.0.7-openpower1-p8e31f00\n Product Extra         :        petitboot-v1.10.3\n Product Extra         :        machine-xml-c5c3\n</code></pre> <p>\u4e2d\u9014\u4e5f\u9047\u5230\u4e86\u51e0\u6b21\u5947\u602a\u7684\u95ee\u9898\uff0c\u591a\u6b21\u901a\u8fc7 IPMI reset \u4e4b\u540e\u5c31\u597d\u4e86\u3002</p>","tags":["bmc","ipmi","power","ibm"]},{"location":"system/2020/10/09/upgrade-power8-bmc/#\u8fdc\u7a0b\u8bbf\u95ee","title":"\u8fdc\u7a0b\u8bbf\u95ee","text":"<p>\u4f46\u662f\uff0c\u6700\u65b0\u7248\u7684 BMC \u56fa\u4ef6\u4e2d\uff0cJViewer \u4f9d\u7136\u6ca1\u6709 macOS \u652f\u6301\u3002\u6211\u4e5f SSH \u8fdb\u53bb\u786e\u8ba4\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u6ca1\u6709\u5bf9\u5e94\u7684\u652f\u6301\u6587\u4ef6\u3002\u53ea\u597d\u5728 Linux \u673a\u5668\u4e0a\u8bbf\u95ee\uff0c\u5b89\u88c5 icedtea \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6253\u5f00 jnlp \u6587\u4ef6\uff0c\u4e4b\u540e\u4e00\u5207\u90fd\u5f88\u6b63\u5e38\u3002</p> <p>\u4e00\u4e2a\u53ef\u80fd\u7684\u66ff\u4ee3\u65b9\u6848\uff1ahttps://github.com/sciapp/nojava-ipmi-kvm</p>","tags":["bmc","ipmi","power","ibm"]},{"location":"system/2018/05/05/windows-ad-linux-pam/","title":"\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55","text":"<p>\u4f5c\u4e3a\u4e0d\u6e05\u771f\u7684\u7f51\u7edc\u7ba1\u7406\u5458\uff0c\u4e3a\u4e86\u914d\u7f6e\u4e00\u5957\u5b8c\u6574\u7684\u7edf\u4e00\u8ba4\u8bc1\u7cfb\u7edf\uff0c\u9648\u8001\u5e08\u91c7\u7528\u4e86 Windows AD \u7684\u65b9\u6cd5\u7ed9\u8fd9\u91cc\u914d\u7f6e\u7edf\u4e00\u8ba4\u8bc1\u3002\u91cd\u88c5\u4e86\u7cfb\u7edf\uff0c\u81ea\u7136\u8981\u628a\u4e4b\u524d\u7684\u7edf\u4e00\u8ba4\u8bc1\u518d\u914d\u5230\u65b0\u88c5\u7684 Archlinux \u4e0a\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a Active Directory Integration</p> <p>\u9996\u5148\u5b89\u88c5\u76f8\u5e94\u7684\u5305\uff1a</p> <pre><code>pacman -S samba\n</code></pre> <p>\u6211\u4eec\u8fd8\u6ca1\u6709\u914d\u597d Kerberos\uff0c\u6240\u4ee5\u8df3\u8fc7\u3002</p> <p>\u7136\u540e\u914d\u7f6e /etc/samba/smb.conf\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002\u53ef\u4ee5\u6839\u636e\u6587\u6863\u5fae\u8c03\u3002</p> <pre><code>[global]\n        security = ads\n        realm = YOUR-AD-HERE\n        workgroup = YOUR-GROUP-HERE\n        idmap uid = 10000-20000\n        idmap gid = 10000-20000\n        winbind enum users = yes\n        winbind enum groups = yes\n        template homedir = /home/%D/%U\n        template shell = /bin/bash\n        client use spnego = yes\n        client ntlmv2 auth = yes\n        encrypt passwords = yes\n        winbind use default domain = yes\n        restrict anonymous = 2\n</code></pre> <p>\u8fd9\u6837\uff0c\u57df\u4e0a\u7684\u7528\u6237 user \u4f1a\u62ff\u5230 home \u76ee\u5f55\u4e3a /home/YOUR-DOMAIN-HERE/user\uff0cuid \u5728 10000-2000 \u8303\u56f4\u5185\u7684\u7528\u6237\u3002\u5728\u4e00\u4f1a\u7ecf\u8fc7\u914d\u7f6e\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>getent passwd</code> \u9a8c\u8bc1\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u628a\u672c\u673a\u7684 samba \u767b\u5165\u5230\u57df\u7684\u7ba1\u7406\u5458\uff0c\u5e76\u4e14\u542f\u52a8\u670d\u52a1\u3002</p> <pre><code>net ads join -U your-user-name\nsystemctl enable --now smb\nsystemctl enable --now nmb\nsystemctl enable --now winbind\n</code></pre> <p>\u66f4\u6539 /etc/nsswitch.conf\uff0c\u5728 passwd, shadow \u548c group \u90fd\u589e\u6dfb winbind\uff1a</p> <pre><code>passwd: files mymachines systemd winbind\ngroup: files mymachines systemd winbind\nshadow: files winbind\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u9a8c\u8bc1\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff1a</p> <pre><code>wbinfo -u\nwbinfo -g\ngetent passwd\ngetent group\nnet ads info\nnet ads lookup\n</code></pre> <p>\u63a5\u4e0b\u6765\u53ef\u4ee5\u914d\u7f6e PAM \u4e86\u3002\u8fd9\u4e00\u90e8\u5206\u8e29\u5230\u4e86\u4e00\u4e9b\u5751\uff0c\u73b0\u5728\u7ec8\u4e8e\u505a\u5f97\u5dee\u4e0d\u591a\u4e86\u3002</p> <p>\u9700\u6c42\uff1a</p> <ol> <li>\u5982\u679c\u4e00\u4e2a\u7528\u6237\u540d\u65e2\u6709\u672c\u5730\u7528\u6237\u4e5f\u6709\u57df\u4e0a\u7684\u7528\u6237\uff0c\u9009\u62e9\u524d\u8005</li> <li>\u7528\u6237\u8981\u4fee\u6539\u5bc6\u7801\u7684\u8bdd\uff0c\u5982\u679c\u662f\u57df\u7528\u6237\uff0c\u5219\u8981\u6c42\u8d70 Windows AD \u90a3\u5957\u65b9\u6cd5\u6539\u5bc6\u7801\uff1b\u5426\u5219\u4ec5\u4fee\u6539\u672c\u5730\u7528\u6237\u5bc6\u7801\u3002</li> </ol> <p>\u5b9e\u73b0\uff1a</p> <p>\u4fee\u6539 /etc/pam.d/system-auth:</p> <p>\u7b2c\u4e00\u90e8\u5206\uff1aauth</p> <pre><code>auth [success=1 default=ignore]         pam_localuser.so\nauth [success=2 default=die]            pam_winbind.so krb5_auth krb5_ccache_type=FILE cached_login try_first_pass\nauth [success=1 default=die]            pam_unix.so nullok_secure\nauth requisite                          pam_deny.so\nauth optional                           pam_permit.so\nauth required                           pam_env.so\n</code></pre> <p>\u9996\u5148\u5229\u7528 pam_localuser.so \u5339\u914d\u7528\u6237\u540d\u548c <code>/etc/passwd</code> \uff0c\u5982\u679c\u6709\uff0c <code>success=1</code> \u4ee3\u8868\u8df3\u8fc7\u4e0b\u9762\u4e00\u6761\u89c4\u5219\uff0c\u6545\u4f1a\u8df3\u5230 pam_unix.so \u8fd9\u4e00\u884c\u3002\u5982\u679c\u5931\u8d25\uff0c<code>default=ignore</code> \u8868\u793a\u5ffd\u7565\u5b83\u7684\u7ed3\u679c\u3002\u5982\u679c\u662f\u672c\u5730\u7528\u6237\uff0c\u5339\u914d pam_localuser.so \u6210\u529f\u540e\u8df3\u5230 pam_unix.so\uff0c\u5982\u679c\u6210\u529f\u4e86\u5219\u8df3\u5230\u7b2c\u4e94\u884c\uff0cpam_permit.so \u4ee3\u8868\u901a\u8fc7\uff0c\u6700\u540e\u7531 pam_env.so \u914d\u7f6e\u73af\u5883\u53d8\u91cf\u3002\u5982\u679c\u662f\u57df\u7528\u6237\uff0c\u5219\u7531 pam_winbind.so \u5904\u7406\uff0c\u5982\u679c\u6210\u529f\uff0c\u540c\u6837\u8df3\u5230\u7b2c 5 \u6761\u3002\u5982\u679c\u672c\u5730\u7528\u6237\u548c\u57df\u7528\u6237\u90fd\u5931\u8d25\uff0c\u5c31 pam_deny.so \u8ba4\u8bc1\u5931\u8d25\u3002</p> <p>\u7b2c\u4e8c\u90e8\u5206\uff1aaccount</p> <pre><code>account required                        pam_unix.so\naccount [success=1 default=ignore]      pam_localuser.so\naccount required                        pam_winbind.so\naccount optional                        pam_permit.so\naccount required                        pam_time.so\n</code></pre> <p>\u8fd9\u4e00\u90e8\u5206\u4ecd\u6709\u7591\u95ee\u3002\u7559\u5f85\u4ee5\u540e\u6765\u8865\u5145\u3002</p> <p>\u7b2c\u4e09\u90e8\u5206\uff1apassword</p> <pre><code>password [success=1 default=ignore]     pam_localuser.so\npassword [default=die]                  pam_echo.so file=/etc/pam.d/messages/ad_reject_change_passwd.txt\npassword optional                       pam_echo.so file=/etc/pam.d/messages/local_user_passwd.txt\npassword [success=1 default=die]        pam_unix.so sha512 shadow\npassword requisite                      pam_deny.so\npassword optional                       pam_permit.so\n</code></pre> <p>\u8fd9\u91cc\u5b9e\u73b0\u4e86\u6211\u4eec\u7684\u9700\u6c42\uff1a\u5982\u679c\u662f\u672c\u5730\u7528\u6237\uff0c\u63d0\u9192\u7528\u6237\u5f53\u524d\u8981\u4fee\u6539\u7684\u662f\u672c\u5730\u7528\u6237\u7684\u5bc6\u7801\uff1b\u5982\u679c\u662f\u57df\u7528\u6237\uff0c\u5219\u8f93\u51fa\u4fe1\u606f\u540e\u76f4\u63a5\u62d2\u7edd\u3002</p> <p>\u8fd9\u91cc\u7684 /etc/pam.d/messages/ad_reject_change_passwd.txt \u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>Hi %u, please go to xxxxxxx to change your Active Directory password!\n</code></pre> <p>\u7b2c\u56db\u90e8\u5206\uff1asession</p> <pre><code>session   required                      pam_limits.so\nsession   required                      pam_mkhomedir.so skel=/etc/skel/ umask=0022\nsession   required                      pam_unix.so\nsession   [success=1 default=ignore]    pam_localuser.so\nsession   required                      pam_winbind.so\nsession   optional                      pam_permit.so\n</code></pre> <p>\u8fd9\u91cc\u4e0e Wiki \u4e0a\u5185\u5bb9\u65e0\u5f02\u3002</p> <p>\u7136\u540e\u4fee\u6539 /etc/pam.d/passwd :</p> <pre><code>password        required        pam_cracklib.so difok=2 minlen=8 dcredit=2 ocredit=2 retry=3\npassword        include         system-auth\n#password       requisite       pam_deny.so\n#password       required        pam_unix.so sha512 shadow nullok\n</code></pre> <p>\u9996\u5148\u5224\u65ad\u5bc6\u7801\u5f3a\u5ea6\u3002\u901a\u8fc7\u540e\u5219\u76f4\u63a5\u7528\u521a\u624d\u66f4\u6539\u7684 system-auth \u4e2d\u7684 password \u90e8\u5206\u89c4\u5219\u3002</p> <p>\u8fd9\u6837\u5c31\u914d\u597d\u4e86\u8ba4\u8bc1\u3002\u81ea\u5df1\u5bf9\u8fd9\u5957\u4e1c\u897f\u7684\u7406\u89e3\u8fd8\u4e0d\u591f\u6df1\uff0c\u4ee5\u540e\u9047\u5230\u4e86\u8981\u7ee7\u7eed\u94bb\u7814\u3002</p> <p>\u6269\u5c55\u9605\u8bfb\uff1a PAM \u914d\u7f6e\u7b80\u4ecb - \u738b\u9088</p>","tags":["windows","ad","pam","winbind","samba"]},{"location":"unboxing/2017/08/08/huawei-portable-wifi/","title":"\u534e\u4e3a\u968f\u884c WiFi 2 mini \u5f00\u7bb1","text":"<p>\u524d\u6bb5\u65f6\u95f4\uff0c\u6211\u529e\u4e86 4G \u5347\u7ea7\uff0c\u79fb\u52a8\u9001\u4e86\u4e00\u5f20\u526f\u5361\uff0c\u6709\u4e0d\u5c11\u514d\u8d39\u7684\u6d41\u91cf\uff0c\u7531\u4e8e\u6211\u7684\u624b\u673a\u662f iPhone \u4e0d\u652f\u6301\u53cc\u5361\uff0c\u8001\u7238\u5c31\u501f\u4e86\u6211\u4ed6\u7684 GlocalMe \u5f53\u6210 MiFi \u6765\u7528\uff0c\u4e0d\u8fc7\u5462 GlocalMe \u653e\u5728\u8fd9\u91cc\u5f53\u7136\u662f\u5927\u6750\u5c0f\u7528\u4e86\uff0c\u6240\u4ee5\u6211\u5c31\u7f51\u8d2d\u4e86\u534e\u4e3a\u968f\u884c WiFi 2 mini\uff0c\u628a\u6211\u7684\u526f\u5361\u88c5\u4e0a\u4e00\u4e2a\u58f3\u653e\u8fdb\u53bb\u5c31\u53ef\u4ee5\u4e86\uff01\u628a\u8fd9\u4e2a MiFi \u63d2\u5165\u7535\u8111\uff0c\u4f1a\u5f39\u51fa\u4e00\u4e2a\u76ee\u5f55\uff0c\u91cc\u9762\u6709 Win/Mac \u7684\u9a71\u52a8\u5b89\u88c5\u6587\u4ef6\uff0c\u6253\u5f00\u540e\u5728\u7f51\u7edc\u8bbe\u7f6e\u91cc\u5c31\u6709 HUAWEI_MOBILE \u7684\u8fde\u63a5\u4e86\uff0c\u5e76\u81ea\u52a8\u6253\u5f00\u7f51\u7edc\u914d\u7f6e\u754c\u9762\u3002\u8bbe\u7f6e\u4e00\u4e0b SSID \u548c\u5bc6\u7801\uff0c\u5c31\u80fd\u6b63\u5e38\u4f7f\u7528\u4e86\uff0c\u624b\u673a\u8fde\u4e0a\u4e5f\u5f88\u6b63\u5e38\uff0c\u624b\u673a\u4e0a\u53ef\u4ee5\u4e0b\u8f7d HUAWEI HiLink \u6765\u914d\u7f6e MiFi\uff0c\u633a\u723d\u7684\u3002\u968f\u8d60\u7684\u6709\u8054\u901a\u7684\u4e0a\u7f51\u5361\uff0c\u4e0d\u8fc7\u6211\u51c6\u5907\u5728\u5317\u4eac\u4e70\u4e2a\u4e0a\u7f51\u5361\u653e MiFi \u91cc\u9762\u7528\u3002</p>","tags":["huawei","wifi"]},{"location":"projects/","title":"jiegec \u7684\u9879\u76ee","text":"<p>\u53d7 wangrunji0408/UndergraduateProjects \u542f\u53d1\uff0c\u6211\u4e5f\u6765\u603b\u7ed3\u4e00\u4e0b\u3002</p> <p>Q\uff1a\u65f6\u95f4\u90fd\u53bb\u54ea\u513f\u4e86\uff1f</p> <p>A\uff1a\u521a\u521a\u7761\u9192 \u4ec0\u4e48\u4e8b</p>"},{"location":"projects/#\u76ee\u5f55","title":"\u76ee\u5f55","text":""},{"location":"projects/#\u8ba1\u7b97\u673a\u7cfb\u8bfe\u7a0b\u53ca\u76f8\u5173\u4f5c\u4e1a","title":"\u8ba1\u7b97\u673a\u7cfb\u8bfe\u7a0b\u53ca\u76f8\u5173\u4f5c\u4e1a","text":"\u65f6\u95f4 \u8bfe\u7a0b \u9879\u76ee 2017.10 \u79bb\u6563\u6570\u5b66 Props 2017.11 \u7a0b\u5e8f\u8bbe\u8ba1\u57fa\u7840 SimpleExtFs 2018.05 \u9762\u5411\u5bf9\u8c61\u7a0b\u5e8f\u8bbe\u8ba1\u57fa\u7840 OnePassSynthesisDMFB\uff0cNaiveLedger 2018.06 \u6982\u7387\u8bba\u4e0e\u6570\u7406\u7edf\u8ba1 HLLeBPF 2018.07 \u7a0b\u5e8f\u8bbe\u8ba1\u5c0f\u5b66\u671f DMCD\uff0cChineseChess\uff0cSearchEngine 2018.11 \u8f6f\u4ef6\u5de5\u7a0b Info9 2019.02 \u64cd\u4f5c\u7cfb\u7edf rCore 2019.04 \u4eba\u5de5\u667a\u80fd\u5bfc\u8bba Pinyin\uff0cFourChess\uff0cEmotionClassifier 2019.04 \u5b58\u50a8\u6280\u672f\u57fa\u7840 KVEngine\uff0cHERMES 2019.05 \u591a\u5a92\u4f53\u6280\u672f\u57fa\u7840 RBSplit\uff0cMultimediaCompression\uff0cMultimediaSound\uff0cMultimediaAnalysis 2019.06 \u6570\u5b57\u903b\u8f91\u8bbe\u8ba1 NaiveRouter\uff0crouter\uff0crouter_mb\uff0crouter_ksz8795\uff0crgmiimux 2019.06 \u8ba1\u7b97\u673a\u7f51\u7edc\u539f\u7406 Router-Lab 2019.07 \u4e13\u4e1a\u5b9e\u8df5 GuGuMIPS\uff0cGuGuMIPSSoC\uff0clinux-gugumips\uff0cu-boot-gugumips\uff0cucore-gugumips\uff0cusbh 2019.08 Java \u7a0b\u5e8f\u8bbe\u8ba1\u4e0e\u8bad\u7ec3 JabaHomework\uff0cNewsApp 2019.08 \u6c47\u7f16\u8bed\u8a00\u7a0b\u5e8f\u8bbe\u8ba1 asm-homework 2019.09 \u8ba1\u7b97\u673a\u7f51\u7edc\u5b89\u5168\u6280\u672f sdes-visualization 2019.10 \u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406 booth-visualization\uff0cinteger-divide-visualization\uff0crocket2thinpad 2019.10 \u7f16\u8bd1\u539f\u7406 online_tac_vm\uff0conline_decaf\uff0cgll-pg\uff0cdecaf-lsp\uff0cdecaf-rs-pa 2020.01 \u4fe1\u53f7\u5904\u7406\u539f\u7406 SignalProcessing 2020.03 \u8f6f\u4ef6\u5206\u6790\u4e0e\u9a8c\u8bc1 dpll 2020.04 \u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784 cache\uff0ctomasulo 2020.04 \u73b0\u4ee3\u5bc6\u7801\u5b66 crypto\uff0cmiller-rabin 2020.05 \u7f51\u7edc\u7f16\u7a0b\u6280\u672f file-server 2021.10 \u9ad8\u7b49\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784 cache-advanced 2021.10 \u9ad8\u6027\u80fd\u8ba1\u7b97\u5b9e\u9a8c sgemm-optimize"},{"location":"projects/#\u53c2\u52a0\u6bd4\u8d5b\u7684\u9879\u76ee","title":"\u53c2\u52a0\u6bd4\u8d5b\u7684\u9879\u76ee","text":"\u65f6\u95f4 \u6bd4\u8d5b \u9879\u76ee 2018.09 THUCTF2018 ctf-writeups 2019.07 \u9f99\u82af\u676f GuGuMIPS\uff0cGuGuMIPSSoC\uff0clinux-gugumips\uff0cu-boot-gugumips\uff0cucore-gugumips\uff0cusbh\uff0cnontrivial-mips\uff0clinux-nontrivial-mips\uff0cu-boot-nontrivial-mips 2020.08 \u534e\u4e3a\u676f trivialcompiler 2020.06 ISC20 SCC Elmerfem 2020.11 SC20 VSCC MemXCT\uff0cminiVite 2021.05 ASC20-21 SCC PRESTO\uff0cHPL 2021.07 ISC21 SCC Coding Challenge\uff0cHPL"},{"location":"projects/#\u4e2a\u4eba\u53c2\u4e0e\u6216\u7f16\u5199\u7684\u9879\u76ee","title":"\u4e2a\u4eba\u53c2\u4e0e\u6216\u7f16\u5199\u7684\u9879\u76ee","text":"\u65f6\u95f4 \u5185\u5bb9 \u9879\u76ee 2016.03 MacGesture macOS \u4e0a\u7684\u624b\u52bf\u8f6f\u4ef6 MacGesture 2017.10 clone-learn-tsinghua \u6e05\u534e\u7f51\u7edc\u5b66\u5802\u7684\u5907\u4efd\u5de5\u5177 clone-learn-tsinghua 2018.02 cs140e Stanford CS140e \u5b9e\u9a8c\u8bfe\u7a0b CS140e 2019.02 rustup-mirror Rustup \u955c\u50cf\u5de5\u5177 rustup-mirror 2019.02 thuip \u4ece BGP \u4fe1\u606f\u4e2d\u5bfc\u51fa\u6e05\u534e IP \u5730\u5740\u6bb5 thuip 2019.02 tantivy-jieba \u628a\u7ed3\u5df4\u5206\u8bcd\u7528\u4e8e Tantivy tantivy-jieba 2019.07 classroom-helper GitHub Classroom \u8f85\u52a9 TUI classroom-helper 2019.09 verilog-format Verilog/SystemVerilog \u683c\u5f0f\u5316 verilog-format 2019.10 decode-bcbp \u5728\u7ebf\u89e3\u7801\u673a\u7968 BCBP \u4fe1\u606f decode-bcbp 2020.02 JieLabs \u6570\u5b57\u903b\u8f91\u5b9e\u9a8c\u5e73\u53f0 JieLabs 2020.02 verilog-lang \u9012\u5f52\u4e0b\u964d\u7684 Verilog Parser verilog-lang 2020.02 maze-routing Rust \u8bed\u8a00\u5b9e\u73b0\u7684 Grid Router \u7b97\u6cd5 maze-routing 2020.05 webhookd \u5bf9 Gitlab/GitHub \u7684 webhook \u8fdb\u884c\u54cd\u5e94 webhookd 2020.05 usbip \u7528 Rust \u5b9e\u73b0\u7684 USB/IP \u670d\u52a1\u7aef usbip 2020.06 cluster-job-monitor \u96c6\u7fa4\u4efb\u52a1\u72b6\u6001\u76d1\u6d4b cluster-job-monitor 2020.07 netconf-rs RFC2641 NETCONF \u5ba2\u6237\u7aef\u5e93 netconf-rs 2020.08 TANLabs \u7f51\u7edc\u539f\u7406\u5b9e\u9a8c\u5e73\u53f0 TANLabs 2020.09 aws-static-website-cdk AWS CDK \u90e8\u7f72\u9759\u6001\u7f51\u7ad9 aws-static-website-cdk 2020.10 ddns \u8de8\u5e73\u53f0 DDNS \u5ba2\u6237\u7aef ddns 2020.11 machine-tester \u96c6\u7fa4\u673a\u5668\u6d4b\u8bd5\u5de5\u5177 machine-tester 2020.12 HT42B534 USB to UART \u5f00\u6e90 PCB \u8bbe\u8ba1 HT42B534USB2UART 2020.12 jieplag \u4ee3\u7801\u67e5\u91cd\u8f6f\u4ef6 jieplag 2021.01 EspinalLib \u4f7f\u7528 SpinalHDL \u5b9e\u73b0\u7684 HDL \u6a21\u5757 EspinalLib 2021.02 daccountd \u5206\u5e03\u5f0f\u5f3a\u4e00\u81f4 LDAP \u670d\u52a1\u5668 daccountd 2021.02 minipxe \u7528\u4e8e PXE \u7684\u8ff7\u4f60 DHCP+TFTP \u670d\u52a1\u5668 minipxe 2021.02 wechat-dump \u4ece iOS \u5907\u4efd\u4e2d\u5bfc\u51fa\u5fae\u4fe1\u804a\u5929\u8bb0\u5f55 wechat-dump 2021.03 WM8731PMOD \u97f3\u9891 PMOD \u6269\u5c55\u677f WM8731PMOD 2021.03 YXPortal \u5b9e\u9a8c\u7528\u6237\u7ba1\u7406\u7cfb\u7edf YXPortal 2021.07 cpu-micro-benchmarks \u9488\u5bf9 CPU \u67b6\u6784\u7684\u5fae\u6027\u80fd\u6d4b\u8bd5 cpu-micro-benchmarks 2021.09 fpu-wrappers \u6d6e\u70b9\u8ba1\u7b97\u5355\u5143\u5c01\u88c5 fpu-wrappers 2021.09 feishu-backup \u98de\u4e66\u6587\u6863\u5907\u4efd\u5bfc\u51fa\u5de5\u5177 feishu-backup 2021.09 rocket-chip-vcu128 \u5728 VCU128 \u5f00\u53d1\u677f\u4e0a\u8fd0\u884c Rocket Chip rocket-chip-vcu128 2021.09 dcst-facts \u8bb0\u5f55\u6e05\u534e\u5927\u5b66\u8ba1\u7b97\u673a\u7cfb\u5ba2\u89c2\u6570\u636e dcst-facts 2021.10 gitlab-cloner GitLab \u9879\u76ee\u6279\u91cf\u514b\u9686\u5de5\u5177 gitlab-cloner 2021.12 jtag-remote-server \u8fdc\u7a0b JTAG \u8c03\u8bd5\u5de5\u5177 jtag-remote-server 2022.01 video2srt \u4f7f\u7528\u4e91\u670d\u52a1\u751f\u6210\u89c6\u9891\u7684\u5b57\u5e55 video2srt 2022.01 rvv-kernels \u4f7f\u7528 RISC-V \u5411\u91cf\u6269\u5c55\u5b9e\u73b0\u7b97\u6cd5 rvv-kernels 2022.07 ifupdown-to-systemd-networkd \u5c06 ifupdown \u914d\u7f6e\u8f6c\u6362\u4e3a systemd-networkd \u914d\u7f6e ifupdown-to-systemd-networkd 2022.09 kicad-symbol-gen KiCad \u7b26\u53f7\u751f\u6210\u5668 kicad-symbol-gen 2023.02 china_bean_importers \u5c06\u652f\u4ed8\u8bb0\u5f55\u5bfc\u5165\u5230 beancount china_bean_importers 2023.04 chisel-memory-lower \u8f6c\u6362 chisel \u5185\u5b58\u4e3a\u539f\u8bed chisel-memory-lower 2023.04 kb \u4e2a\u4eba\u77e5\u8bc6\u5e93 kb 2023.06 dntt \u6279\u91cf\u5bfc\u51fa\u4ea4\u6362\u673a\u7684\u914d\u7f6e\u6587\u4ef6 dntt 2023.08 la-inst \u7814\u7a76 LoongArch \u6307\u4ee4\u7684\u5de5\u5177 la-inst 2023.10 fatbinary \u64cd\u4f5c CUDA fatbinary \u6587\u4ef6\u683c\u5f0f\u7684 Rust \u5e93 fatbinary 2023.11 data-link-protocols \u7f51\u7edc\u539f\u7406\u6570\u636e\u94fe\u8def\u5c42\u534f\u8bae\u53ef\u89c6\u5316 data-link-protocols 2023.12 unofficial-loongarch-intrinsics-guide \u975e\u5b98\u65b9 LoongArch Intrinsics \u6587\u6863 unofficial-loongarch-intrinsics-guide 2023.12 loongarch-csr \u975e\u5b98\u65b9 LoongArch CSR/IOCSR \u6587\u6863 loongarch-csr 2023.12 buildit AOSC \u6784\u5efa\u81ea\u52a8\u5316 buildit 2023.12 la_ow_ptrace \u57fa\u4e8e PTrace \u7684\u5728 LoongArch \u65b0\u4e16\u754c\u4e0a\u8fd0\u884c\u65e7\u4e16\u754c\u7a0b\u5e8f\u7684\u65b9\u6848 la_ow_ptrace 2024.02 cold \u73a9\u5177 ELF \u94fe\u63a5\u5668 cold"},{"location":"projects/#\u8ba1\u7b97\u673a\u7cfb\u8bfe\u7a0b\u53ca\u76f8\u5173\u4f5c\u4e1a_1","title":"\u8ba1\u7b97\u673a\u7cfb\u8bfe\u7a0b\u53ca\u76f8\u5173\u4f5c\u4e1a","text":""},{"location":"projects/#props","title":"Props","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684\u5bf9\u4e8e\u547d\u9898\u7684\u8ba1\u7b97\u5668\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++\uff0cFlex\uff0cBison</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#simpleextfs","title":"SimpleExtFs","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684\u5185\u5b58\u6587\u4ef6\u7cfb\u7edf\uff0c\u652f\u6301\u53ef\u6301\u4e45\u5316\u548c\u4e00\u4e9b\u7b80\u5355\u7684 shell \u6307\u4ee4\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC\uff0cFS</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#onepasssynthesisdmfb","title":"OnePassSynthesisDMFB","text":"<p>DMFB \u662f Digital MicroFluidic Biochips \u7684\u7f29\u5199\u3002\u9700\u8981\u5b9e\u73b0\u4e00\u7bc7\u6587\u7ae0\u91cc\u7684\u7b97\u6cd5\uff0c\u751f\u6210 SAT \u89c4\u5219\u540e\u4e22\u7ed9 z3 \u6c42\u89e3\uff0c\u518d\u628a\u7ed3\u679c\u53ef\u89c6\u5316\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++\uff0cGraphviz\uff0cZ3\uff0cSAT</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a0</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#naiveledger","title":"NaiveLedger","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684 AlgoRand \u5b9e\u73b0\u3002</p> <ul> <li>\u5408\u4f5c\u540c\u5b66\uff1awjd jl lxy lwb</li> <li>GitHub \u672a\u516c\u5f00</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++\uff0c\u5bc6\u7801\u5b66</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e00\u822c</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#hllebpf","title":"HLLeBPF","text":"<p>\u628a HyperLogLog \u7528 eBPF \u5b9e\u73b0\u4e86\uff0c\u53ef\u4ee5\u4f30\u8ba1\u4e00\u6bb5\u65f6\u95f4\u5185\u8bbf\u95ee\u672c\u673a\u7684 IP \u6570\u91cf\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC\uff0ceBPF\uff0cHyperLogLog</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#dmcd","title":"DMCD","text":"<p>DMCD \u662f Digital Microfluidic Chip Designer \u7684\u7f29\u5199\u3002\u540c\u6837\u5b9e\u73b0\u4e00\u4e2a\u7b97\u6cd5\uff0c\u6309\u7167\u7ed9\u5b9a\u7684\u7f51\u7edc\u89e3\u4e00\u5806\u65b9\u7a0b\uff0c\u7136\u540e\u7528 Qt \u53ef\u89c6\u5316\u3002\u53ef\u4ee5\u5728 Qt \u4e0a\u8fdb\u884c\u53c2\u6570\u7684\u8c03\u6574\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u9057\u4f20\u7b97\u6cd5\u53bb\u6c42\u89e3\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aQt\uff0c\u9057\u4f20\u7b97\u6cd5</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a0</li> <li>\u6536\u83b7\uff1a0</li> </ul>"},{"location":"projects/#chinesechess","title":"ChineseChess","text":"<p>Qt \u7f16\u5199\u7684\u4e2d\u56fd\u8c61\u68cb\u5728\u7ebf\u5bf9\u6218\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aQt\uff0cSocket</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a2</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#searchengine","title":"SearchEngine","text":"<p>\u7528 Python \u7f16\u5199\u722c\u866b\uff0c\u5e76\u5b9e\u73b0\u7b80\u5355\u7684\u641c\u7d22\u5f15\u64ce\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPython\uff0cDjango\uff0cWeb\uff0cReverse Index\uff0cTF-IDF\uff0cORM</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a2</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#info9","title":"Info9","text":"<p>\u7528 Vue.js \u7f16\u5199\u524d\u7aef\uff0cPython Django \u7f16\u5199\u540e\u7aef\uff0c\u5b9e\u73b0\u4e00\u5806\u529f\u80fd\u7684\u7f51\u7ad9\u3002</p> <ul> <li>\u5408\u4f5c\u540c\u5b66\uff1axlq wxp</li> <li>GitHub \u672a\u516c\u5f00</li> <li>\u76f8\u5173\u6280\u672f\uff1aVue\uff0cPython\uff0cDjango\uff0cWeb\uff0cMongoDB</li> <li>\u6295\u5165\u65f6\u95f4\uff1a&gt;100h</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#rcore","title":"rCore","text":"<p>\u5b8c\u5584\u7528 Rust \u7f16\u5199\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <ul> <li>\u5408\u4f5c\u540c\u5b66\uff1a\u592a\u591a\u4e86</li> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6587\u4ef6\u7cfb\u7edf\uff0c\u7f51\u7edc</li> <li>\u6295\u5165\u65f6\u95f4\uff1a&gt;200h</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a100</li> </ul>"},{"location":"projects/#pinyin","title":"Pinyin","text":"<p>\u7528 Rust \u5b9e\u73b0\u7684\u57fa\u4e8e\u9a6c\u5c14\u53ef\u592b\u94fe\u7684\u8f93\u5165\u6cd5\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0c\u9a6c\u5c14\u53ef\u592b\u94fe</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#fourchess","title":"FourChess","text":"<p>\u56db\u5b57\u68cb AI\uff0c\u7528 MCTS\uff08UCT\uff09\u5b9e\u73b0\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aMCTS\uff0cUCT</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#emotionclassifier","title":"EmotionClassifier","text":"<p>\u7528 CNN/RNN/MLP \u5b9e\u73b0\u4e00\u4e2a\u5206\u7c7b\u4efb\u52a1\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPyTorch</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a0</li> <li>\u6536\u83b7\uff1a0</li> </ul>"},{"location":"projects/#kvengine","title":"KVEngine","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 KV \u5f15\u64ce\uff0c\u4fdd\u8bc1 Write Consistency \u548c Crash Consistency\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++\uff0cWAL</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a4</li> </ul>"},{"location":"projects/#hermes","title":"HERMES","text":"<p>\u5b9e\u73b0\u4e00\u4e2a FUSE \u6587\u4ef6\u7cfb\u7edf\uff0c\u80cc\u540e\u91c7\u7528 KV \u6765\u5b58\u50a8\u6570\u636e\u3002</p> <ul> <li>\u5408\u4f5c\u540c\u5b66\uff1acsq gj lxy</li> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++\uff0cFUSE</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#rbsplit","title":"RbSplit","text":"<p>\u628a\u56fe\u7247\u7684\u989c\u8272\u62c6\u5f00\uff0c\u7136\u540e\u9519\u4f4d\u540e\u518d\u62fc\u5728\u4e00\u8d77\uff0c\u53d8\u6210\u4e00\u4e2a\u65b0\u7684\u56fe\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPython</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#multimediacompression","title":"MultimediaCompression","text":"<p>\u7b2c\u4e00\u90e8\u5206\u662f\u7528\u4e0d\u540c\u7684\u65b9\u6cd5\u8ba1\u7b97\u56fe\u7247\u7684 DCT\uff0c\u7136\u540e\u518d\u9006\u56de\u6765\u5bf9\u6bd4\u56fe\u7247\u8d28\u91cf\u3002\u5bf9\u6bd4\u4e0d\u540c\u91cf\u5316\u77e9\u9635\u5bf9\u4e8e\u56fe\u7247\u7684\u8d28\u91cf\u7684\u5f71\u54cd\u3002\u7b2c\u4e8c\u90e8\u5206\u662f\u5b9e\u73b0\u4e00\u4e2a\u52a8\u4f5c\u4f30\u8ba1\uff0c\u4ece\u4e00\u7cfb\u5217\u56fe\u4e2d\u6355\u6349\u4e00\u4e2a\u7269\u4f53\u7684\u8f68\u8ff9\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPython</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#multimediasound","title":"MultimediaSound","text":"<p>\u7528 MATLAB \u7684 STRAIGHT \u5de5\u5177\u7bb1\u8fdb\u884c\u58f0\u97f3\u7684\u8c03\u6574\uff0c\u4f8b\u5982\u7537\u58f0-&gt;\u5973\u751f\u3002\u7136\u540e\u7528 Python \u8861\u91cf\u58f0\u97f3\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPython\uff0cMATLAB</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#multimediaanalysis","title":"MultimediaAnalysis","text":"<p>\u8ba1\u7b97\u6bcf\u4e2a\u56fe\u7684\u989c\u8272\u5206\u5e03\u7acb\u65b9\u56fe\uff0c\u6839\u636e\u7acb\u65b9\u56fe\u6765\u8fdb\u884c\u805a\u7c7b\u8ba1\u7b97\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aPython</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a4</li> <li>\u6536\u83b7\uff1a4</li> </ul>"},{"location":"projects/#naiverouter","title":"NaiveRouter","text":"<p>\u786c\u4ef6\u8f6c\u53d1\u7684\u8def\u7531\u5668 IP \u5b9e\u73b0\uff0c\u901a\u8fc7 AXI \u4e0e CPU \u4ea4\u4e92\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aSystemVerilog\uff0c\u7f51\u7edc\uff0cAXI</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#router","title":"router","text":"<p>\u5728\u9ed1\u91d1 AX7021 \u5f00\u53d1\u677f\u4e0a\u7684 SoC\uff0c\u91c7\u7528\u4e86 NaiveRouter \u8fdb\u884c\u786c\u4ef6\u8f6c\u53d1\uff0c\u5728 PS \u4e0a\u5b9e\u73b0 RIP \u534f\u8bae\u548c\u8def\u7531\u4fe1\u606f\u7684\u66f4\u65b0\u3002\u53e6\u5916\u8fd8\u5b9e\u73b0\u4e86 HDMI \u7684\u8def\u7531\u72b6\u6001\u53ef\u89c6\u5316\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVivado</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#router_mb","title":"router_mb","text":"<p>\u540c\u6837\u5728\u9ed1\u91d1 AX7021 \u5f00\u53d1\u677f\u4e0a\u7684 SoC\uff0c\u4e5f\u662f\u91c7\u7528 NaiveRouter \u8fdb\u884c\u786c\u4ef6\u8f6c\u53d1\uff0c\u53ea\u4e0d\u8fc7\u628a\u8f6f\u4ef6\u90e8\u5206\u4ece PS \u79fb\u5230\u4e86 MicroBlaze \u4e2d\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVivado</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a8</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#router_ksz8795","title":"router_ksz8795","text":"<p>\u5728 Pynq \u5916\u63a5 KSZ8795 \u6269\u5c55\u677f\u4e0a\u5f00\u53d1\u7684 SoC\uff0c\u91c7\u7528 MicroBlaze \u8fd0\u884c\u4ee3\u7801\uff0c\u5bf9 KSZ8795 \u82af\u7247\u7684\u7f16\u7a0b\u548c\u64cd\u4f5c\u8fdb\u884c\u4e86\u9a8c\u8bc1\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVivado</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a8</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#rgmiimux","title":"rgmiimux","text":"<p>\u4e00\u4e2a RGMII\u201c\u4e00\u5206\u56db\u201d\u7684 IP\uff0c\u901a\u8fc7 VLAN \u8fdb\u884c\u533a\u5206\uff0c\u7c7b\u4f3c KSZ8795 \u7684\u90e8\u5206\u529f\u80fd\uff0c\u53ea\u4e0d\u8fc7\u662f\u5728 FPGA \u5185\u90e8\u5b9e\u73b0\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVivado</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#router-lab","title":"Router-Lab","text":"<p>2019 \u8ba1\u7b97\u673a\u7f51\u7edc\u539f\u7406\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aNetworking</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#gugumips","title":"GuGuMIPS","text":"<p>\u81ea\u5df1\u7f16\u5199\u7684\u5c0f\u7aef MIPS32 \u5b9e\u73b0\uff0c\u80fd\u591f\u542f\u52a8 Linux\uff0c\u81ea\u5df1\u7f16\u5199\u7684 Cache \u5904\u4e8e\u672a\u5b8c\u6210\u72b6\u6001\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aSystemVerilog</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#gugumipssoc","title":"GuGuMIPSSoC","text":"<p>\u4ee5 GuGuMIPS \u4e3a CPU\uff0c\u5728\u9f99\u82af\u5b9e\u9a8c\u7bb1\u4e0a\u8fd0\u884c\u7684\u4e00\u4e2a SoC\uff0c\u652f\u6301\u7f51\u7edc\uff0cUSB\uff0cLCD \u7b49\u5916\u8bbe</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVivado</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#linux-gugumips","title":"linux-gugumips","text":"<p>\u4e3a GuGuMIPS \u9002\u914d\u7684 Linux \u4ee3\u7801\uff0c\u4ece\u4e3b\u7ebf\u5185\u6838\u4e0a\u76f4\u63a5 patch\uff0c\u53ef\u4ee5\u968f\u65f6\u66f4\u65b0\u5230\u6700\u65b0\u5185\u6838\u3002\u5927\u90e8\u5206\u4ee3\u7801\u53c2\u8003\u4e86 z4yx/linux-kernel</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aLinux Kernel</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#u-boot-gugumips","title":"u-boot-gugumips","text":"<p>\u4e3a GuGuMIPS \u9002\u914d\u7684 U-Boot \u4ee3\u7801\uff0c\u4ece U-Boot \u4e3b\u7ebf\u4e0a fork \u800c\u6765\u3002\u5927\u90e8\u5206\u4ee3\u7801\u53c2\u8003\u4e86 z4yx/u-boot-naivemips</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aU-Boot</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#ucore-gugumips","title":"ucore-gugumips","text":"<p>\u4e3a GuGuMIPS \u9002\u914d\u7684 uCore \u4ee3\u7801\uff0c\u53ea\u5728\u5916\u8bbe\u65b9\u9762\u505a\u4e86\u5fae\u5c0f\u7684\u6539\u52a8\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aKernel</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#usbh","title":"usbh","text":"<p>USB 2.0 FS \u63a7\u5236\u5668\uff0c\u4ece UltraEmbedded USB Host Controller \u4fee\u6539\u800c\u6765\uff0c\u5e76\u4e14\u6253\u5305\u4e3a\u4e86 Vivado IP\u3002\u5bf9\u5e94\u7684\u9a71\u52a8\u5728\u4e0a\u9762\u7684 Linux \u548c U-Boot \u4ed3\u5e93\u4e2d\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aHardware</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#jabahomework","title":"JabaHomework","text":"<p>Java OJ \u4e0a\u7684\u4f5c\u4e1a\u5916\u52a0\u8003\u8bd5\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aJava</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#newsapp","title":"NewsApp","text":"<p>Java \u5927\u4f5c\u4e1a\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u65b0\u95fb App\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aJava\uff0cAndroid</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#asm-homework","title":"asm-homework","text":"<p>\u6c47\u7f16\u5c0f\u5b66\u671f\u7684\u4f5c\u4e1a\uff0c\u5305\u62ec\u5c0f\u4f5c\u4e1a\u548c\u4e24\u6b21\u5b9e\u9a8c\u7684\u4ee3\u7801\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1a\u6c47\u7f16\uff0cx86\uff0cMIPS</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#sdes-visualization","title":"sdes-visualization","text":"<p>\u5bf9 S-DES \u52a0\u5bc6\u8fc7\u7a0b\u7684\u53ef\u89c6\u5316\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aElm\uff0cCSS</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#booth-visualization","title":"booth-visualization","text":"<p>\u5bf9 Booth \u4e58\u6cd5\u8fc7\u7a0b\u7684\u53ef\u89c6\u5316\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aElm</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#integer-divide-visualization","title":"integer-divide-visualization","text":"<p>\u5bf9\u6574\u6570\u9664\u6cd5\u8fc7\u7a0b\u7684\u53ef\u89c6\u5316\uff0c\u975e\u8bfe\u7a0b\u8981\u6c42\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aElm</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#rocket2thinpad","title":"rocket2thinpad","text":"<p>\u628a Rocket Chip \u8fd0\u884c\u5728 Thinpad \u4e0a\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aVerilog\uff0cVivado\uff0cRocket Chip\uff0cChisel\uff0cScala</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a7</li> </ul>"},{"location":"projects/#online_tac_vm","title":"online_tac_vm","text":"<p>\u5728\u7ebf\u7684 TAC \u865a\u62df\u673a\uff0c\u53ef\u4ee5\u5728\u7ebf\u6267\u884c\u7f16\u8bd1\u539f\u7406 PA3 \u751f\u6210\u7684 TAC\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cYew</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#online_decaf","title":"online_decaf","text":"<p>\u5728\u7ebf\u7684 Decaf \u7f16\u8bd1\u5668\uff0c\u53ef\u4ee5\u5728\u7ebf\u8fd0\u884c\u7f16\u8bd1\u539f\u7406\u7684 PA\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cYew</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#gll-pg","title":"gll-pg","text":"<p>\u4e00\u4e2a GLL \u7684 Parser Generator\uff0c\u53c2\u8003\u4e86 MashPlant/lalr1 \u548c GLL \u8bba\u6587\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cProc macro\uff0cParsing</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#decaf-lsp","title":"decaf-lsp","text":"<p>Decaf \u8bed\u8a00\u7684 LSP Server \u5b9e\u73b0\uff0c\u652f\u6301 Hover\u3001Symbol \u7b49\u529f\u80fd\uff0c\u914d\u5408 decaf-vscode \u4f7f\u7528\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cLSP\uff0cVSCode</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#decaf-rs-pa","title":"decaf-rs-pa","text":"<p>\u7f16\u8bd1\u539f\u7406\u7684 PA\uff0c\u57fa\u4e8e @MashPlant \u7684 Rust \u6846\u67b6\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#signalprocessing","title":"SignalProcessing","text":"<p>\u4fe1\u53f7\u5904\u7406\u539f\u7406\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1a\u4fe1\u53f7\u5904\u7406</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u5c11</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#dpll","title":"dpll","text":"<p>\u8f6f\u4ef6\u5206\u6790\u4e0e\u9a8c\u8bc1\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u8981\u6c42\u5b9e\u73b0 DPLL \u7b97\u6cd5\u6765\u89e3\u51b3 SAT \u95ee\u9898\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#cache","title":"cache","text":"<p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u6a21\u62df\u4e00\u4e2a Cache \u7684\u884c\u4e3a\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#tomasulo","title":"tomasulo","text":"<p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u5b9e\u73b0 Tomasulo \u7b97\u6cd5\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC++</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a1</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#crypto","title":"crypto","text":"<p>\u73b0\u4ee3\u5bc6\u7801\u5b66\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u8981\u6c42\u5b9e\u73b0\u51e0\u4e2a\u5bc6\u7801\u5b66\u7b97\u6cd5\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1a\u5bc6\u7801\u5b66</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u5c11</li> <li>\u559c\u7231\uff1a5</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#miller-rabin","title":"miller-rabin","text":"<p>\u73b0\u4ee3\u5bc6\u7801\u5b66\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u8981\u6c42\u5b9e\u73b0 Miller-Rabin \u7b97\u6cd5\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1a\u5bc6\u7801\u5b66</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#file-server","title":"file-server","text":"<p>\u7f51\u7edc\u7f16\u7a0b\u6280\u672f\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u8981\u6c42\u5b9e\u73b0\u652f\u6301\u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684\u6587\u4ef6\u670d\u52a1\u5668\u548c\u914d\u5957\u7684\u5ba2\u6237\u7aef\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1a\u7f51\u7edc\u7f16\u7a0b</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a2</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#cache-advanced","title":"cache-advanced","text":"<p>\u9ad8\u7b49\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u8bfe\u7a0b\u7684\u5b9e\u9a8c\u3002\u548c\u672c\u79d1\u751f\u8bfe\u5b9e\u9a8c\u7c7b\u4f3c\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aC</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u5c11</li> <li>\u559c\u7231\uff1a0</li> <li>\u6536\u83b7\uff1a0</li> </ul>"},{"location":"projects/#sgemm-optimize","title":"sgemm-optimize","text":"<p>\u9ad8\u6027\u80fd\u8ba1\u7b97\u5b9e\u9a8c\u8bfe\u7a0b\u7684\u5b9e\u9a8c\uff0c\u5728 Kunpeng \u5e73\u53f0\u4e0a\u4f18\u5316 SGEMM\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aOpenMP, MPI</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u591a</li> <li>\u559c\u7231\uff1a8</li> <li>\u6536\u83b7\uff1a8</li> </ul>"},{"location":"projects/#\u4e2a\u4eba\u53c2\u4e0e\u6216\u7f16\u5199\u7684\u9879\u76ee_1","title":"\u4e2a\u4eba\u53c2\u4e0e\u6216\u7f16\u5199\u7684\u9879\u76ee","text":""},{"location":"projects/#macgesture","title":"MacGesture","text":"<p>\u9ad8\u4e2d\u65f6\u5019\u63a5\u624b\u7684\u4e00\u4e2a\u9879\u76ee\uff0c\u5728 macOS \u4e0a\u8fdb\u884c\u624b\u52bf\u8bc6\u522b\uff0c\u7136\u540e\u6267\u884c\u76f8\u5e94\u7684\u52a8\u4f5c\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aObjective-C</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a3</li> <li>\u6536\u83b7\uff1a2</li> </ul>"},{"location":"projects/#clone-learn-tsinghua","title":"clone-learn-tsinghua","text":"<p>\u6e05\u534e\u7f51\u7edc\u5b66\u5802\u7684\u5907\u4efd\u5de5\u5177\u3002\u7528\u4e8e\u6bd5\u4e1a\u751f\u7684\u8d44\u6599\u5f52\u6863\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aTypeScript</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a8</li> <li>\u6536\u83b7\uff1a1</li> </ul>"},{"location":"projects/#cs140e","title":"CS140e","text":"<p>\u5927\u4e00\u5bd2\u5047\u7684\u65f6\u5019\uff0cStanford CS140e \u9996\u6b21\u505a\u51fa\u4e86\u7528 Rust \u5199\u64cd\u4f5c\u7cfb\u7edf\u4f5c\u4e3a\u5b9e\u9a8c\u8bfe\u7a0b\u7684\u5c1d\u8bd5\uff0c\u6211\u4e5f\u8ddf\u7740\u505a\u4e86\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0c\u64cd\u4f5c\u7cfb\u7edf</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u8f83\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#rustup-mirror","title":"rustup-mirror","text":"<p>\u628a rustup \u540c\u6b65\u5230\u672c\u5730\u7684\u5de5\u5177\uff0c\u7528\u4e8e TUNA \u7b49\u955c\u50cf\u7ad9\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#classroom-helper","title":"classroom-helper","text":"<p>\u4e3a\u201c\u5b9e\u9a8c\u7269\u7406\u7684\u5927\u6570\u636e\u65b9\u6cd5\u201d\u8bfe\u7a0b\u7f16\u5199\u7684\u5de5\u5177\uff0c\u914d\u5408 GitHub Classroom \u4f7f\u7528\u7684\u5de5\u5177\uff0c\u81ea\u52a8\u6279\u91cf clone \u4f5c\u4e1a\u4ed3\u5e93\uff0c\u5e76\u4e14\u6267\u884c\u811a\u672c\u8fdb\u884c\u8bc4\u5206\uff0c\u663e\u793a\u4ee3\u7801\u66f4\u6539\u5386\u53f2\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cTUI</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#verilog-format","title":"verilog-format","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684 Verilog / SystemVerilog \u683c\u5f0f\u5316\u5de5\u5177\u3002\u672a\u5b8c\u6210\uff0c\u52ff\u7528\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust\uff0cNom\uff0cParsing</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a5</li> </ul>"},{"location":"projects/#jielabs","title":"JieLabs","text":"<p>\u6570\u5b57\u903b\u8f91\u5b9e\u9a8c\u5e73\u53f0\uff0c\u8fdc\u7a0b\u64cd\u4f5c FPGA \u548c\u4e00\u4e9b\u5143\u4ef6\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aReact\u3001Rust\u3001WebSocket\u3001Buildroot</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#webhookd","title":"webhookd","text":"<p>\u4e00\u4e2a\u7528\u4e8e\u5904\u7406 webhook \u6d88\u606f\u5e76\u6267\u884c\u64cd\u4f5c\u7684\u670d\u52a1\u3002\u652f\u6301 Gitlab \u548c GitHub\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a3</li> </ul>"},{"location":"projects/#usbip","title":"usbip","text":"<p>\u8fd0\u884c\u4e00\u4e2a USB/IP \u670d\u52a1\uff0c\u53ef\u4ee5\u6a21\u62df\u8bbe\u5907\u6216\u8005\u8f6c\u53d1\u5230 libusb\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aRust</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a8</li> </ul>"},{"location":"projects/#tanlabs","title":"TANLabs","text":"<p>\u7f51\u7edc\u539f\u7406\u5b9e\u9a8c\u5e73\u53f0\uff0c\u5305\u542b CI \u81ea\u52a8\u8bc4\u6d4b\uff0c\u6811\u8393\u6d3e\u8bc4\u6d4b\u7b49\u529f\u80fd\u3002</p> <ul> <li>\u76f8\u5173\u6280\u672f\uff1aReact\u3001Rust\u3001S3\u3001SQS</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u5f88\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#ht42b534usb2uart","title":"HT42B534USB2UART","text":"<p>\u4e00\u4e2a USB 2 UART \u677f\u5b50\uff0c\u91c7\u7528\u7684\u82af\u7247\u662f HT42B534\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aKiCad\u3001JLC</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#daccountd","title":"daccountd","text":"<p>\u57fa\u4e8e etcd \u7f16\u5199\u7684 LDAP \u670d\u52a1\u5668\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aGo\u3001Etcd</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#wm8731pmod","title":"WM8731PMOD","text":"<p>\u4e00\u4e2a PMOD \u63a5\u53e3\u7684\u6269\u5c55\u677f\uff0c\u4e0a\u6709 WM8731 \u82af\u7247\u7528\u4e8e\u97f3\u9891\u5904\u7406\u3002</p> <ul> <li>GitHub</li> <li>\u76f8\u5173\u6280\u672f\uff1aLCEDA\u3001JLC</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a10</li> </ul>"},{"location":"projects/#yxportal","title":"YXPortal","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684 OAuth \u5ba2\u6237\u7aef + \u670d\u52a1\u7aef\uff0c\u7528\u4e8e\u5b9e\u9a8c\u7cfb\u7edf\u7684\u7528\u6237\u8ba4\u8bc1\u3002</p> <ul> <li>\u76f8\u5173\u6280\u672f\uff1aGo\u3001Elm</li> <li>\u6295\u5165\u65f6\u95f4\uff1a\u4e0d\u591a</li> <li>\u559c\u7231\uff1a10</li> <li>\u6536\u83b7\uff1a8</li> </ul>"},{"location":"projects/#\u672a\u5b8c\u5f85\u7eed","title":"\u672a\u5b8c\u5f85\u7eed","text":""},{"location":"archive/2024/","title":"2024","text":""},{"location":"archive/2023/","title":"2023","text":""},{"location":"archive/2022/","title":"2022","text":""},{"location":"archive/2021/","title":"2021","text":""},{"location":"archive/2020/","title":"2020","text":""},{"location":"archive/2019/","title":"2019","text":""},{"location":"archive/2018/","title":"2018","text":""},{"location":"archive/2017/","title":"2017","text":""},{"location":"archive/2016/","title":"2016","text":""},{"location":"archive/2014/","title":"2014","text":""},{"location":"category/hardware/","title":"hardware","text":""},{"location":"category/software/","title":"software","text":""},{"location":"category/meta/","title":"meta","text":""},{"location":"category/os/","title":"os","text":""},{"location":"category/system/","title":"system","text":""},{"location":"category/others/","title":"others","text":""},{"location":"category/devops/","title":"devops","text":""},{"location":"category/crypto/","title":"crypto","text":""},{"location":"category/programming/","title":"programming","text":""},{"location":"category/networking/","title":"networking","text":""},{"location":"category/misc/","title":"misc","text":""},{"location":"category/ctf/","title":"ctf","text":""},{"location":"category/unboxing/","title":"unboxing","text":""},{"location":"category/news/","title":"news","text":""},{"location":"category/life/","title":"life","text":""},{"location":"category/speech/","title":"speech","text":""},{"location":"category/logo/","title":"logo","text":""},{"location":"category/csdn/","title":"csdn","text":""},{"location":"page/2/","title":"\u535a\u5ba2","text":""},{"location":"page/3/","title":"\u535a\u5ba2","text":""},{"location":"page/4/","title":"\u535a\u5ba2","text":""},{"location":"page/5/","title":"\u535a\u5ba2","text":""},{"location":"page/6/","title":"\u535a\u5ba2","text":""},{"location":"page/7/","title":"\u535a\u5ba2","text":""},{"location":"page/8/","title":"\u535a\u5ba2","text":""},{"location":"page/9/","title":"\u535a\u5ba2","text":""},{"location":"page/10/","title":"\u535a\u5ba2","text":""},{"location":"page/11/","title":"\u535a\u5ba2","text":""},{"location":"page/12/","title":"\u535a\u5ba2","text":""},{"location":"page/13/","title":"\u535a\u5ba2","text":""},{"location":"page/14/","title":"\u535a\u5ba2","text":""},{"location":"page/15/","title":"\u535a\u5ba2","text":""},{"location":"page/16/","title":"\u535a\u5ba2","text":""},{"location":"page/17/","title":"\u535a\u5ba2","text":""},{"location":"archive/2023/page/2/","title":"2023","text":""},{"location":"archive/2023/page/3/","title":"2023","text":""},{"location":"archive/2022/page/2/","title":"2022","text":""},{"location":"archive/2021/page/2/","title":"2021","text":""},{"location":"archive/2020/page/2/","title":"2020","text":""},{"location":"archive/2019/page/2/","title":"2019","text":""},{"location":"archive/2019/page/3/","title":"2019","text":""},{"location":"archive/2019/page/4/","title":"2019","text":""},{"location":"archive/2018/page/2/","title":"2018","text":""},{"location":"archive/2018/page/3/","title":"2018","text":""},{"location":"archive/2018/page/4/","title":"2018","text":""},{"location":"category/devops/page/2/","title":"devops","text":""},{"location":"category/hardware/page/2/","title":"hardware","text":""},{"location":"category/hardware/page/3/","title":"hardware","text":""},{"location":"category/hardware/page/4/","title":"hardware","text":""},{"location":"category/misc/page/2/","title":"misc","text":""},{"location":"category/misc/page/3/","title":"misc","text":""},{"location":"category/networking/page/2/","title":"networking","text":""},{"location":"category/programming/page/2/","title":"programming","text":""},{"location":"category/programming/page/3/","title":"programming","text":""},{"location":"category/software/page/2/","title":"software","text":""},{"location":"category/software/page/3/","title":"software","text":""},{"location":"category/software/page/4/","title":"software","text":""},{"location":"tags/","title":"\u6807\u7b7e","text":""},{"location":"tags/#010editor","title":"010editor","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#7series","title":"7series","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#80211ax","title":"80211ax","text":"<ul> <li>Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax</li> </ul>"},{"location":"tags/#a64fx","title":"a64fx","text":"<ul> <li>Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> </ul>"},{"location":"tags/#aarch64","title":"aarch64","text":"<ul> <li>\u8bb0\u5f55\u4e00\u6b21 CentOS AArch64 7 \u5230 8 \u7684\u5347\u7ea7</li> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> <li>\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> <li>\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a</li> <li>Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#abi","title":"abi","text":"<ul> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> </ul>"},{"location":"tags/#acpi","title":"acpi","text":"<ul> <li>ACPI \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#acquire","title":"acquire","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#ad","title":"ad","text":"<ul> <li>\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55</li> </ul>"},{"location":"tags/#adb","title":"adb","text":"<ul> <li>\u901a\u8fc7 SSH \u96a7\u9053\u8fde\u63a5 ADB \u548c Android \u8bbe\u5907</li> </ul>"},{"location":"tags/#adi","title":"adi","text":"<ul> <li>\u56de\u987e\u6628\u5929\u7684\u9152\u4e95\u77e5\u8bc6\u7ade\u8d5b</li> </ul>"},{"location":"tags/#admission","title":"admission","text":"<ul> <li>\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b</li> </ul>"},{"location":"tags/#adobe","title":"adobe","text":"<ul> <li>Farewell, Flash</li> </ul>"},{"location":"tags/#agetty","title":"agetty","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#ahci","title":"ahci","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> </ul>"},{"location":"tags/#airpurifier","title":"airpurifier","text":"<ul> <li>\u4f7f\u7528 HomeBridge \u628a\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\u52a0\u5165\u5230 HomeKit \u4e2d</li> </ul>"},{"location":"tags/#aix","title":"aix","text":"<ul> <li>AIX 7.2 \u865a\u62df\u673a\u5b89\u88c5</li> </ul>"},{"location":"tags/#alacritty","title":"alacritty","text":"<ul> <li>\u8c03\u6574 Alacritty \u7684 Powerline \u5b57\u4f53\u663e\u793a\u504f\u79fb</li> </ul>"},{"location":"tags/#algorithm","title":"algorithm","text":"<ul> <li>\u4e00\u4e2a\u641e\u7b11\u7684\u4f38\u5c55\u6811\u7684 Wiki</li> <li>\u89e3\u91ca BB84 \u534f\u8bae</li> <li>\u5206\u6790\u4e00\u4e2a\u6211\u7b2c\u4e00\u6b21\u89c1\u7684\u7d20\u6570\u6d4b\u8bd5\u51fd\u6570</li> </ul>"},{"location":"tags/#alignment","title":"alignment","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> </ul>"},{"location":"tags/#alinx","title":"alinx","text":"<ul> <li>\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG</li> </ul>"},{"location":"tags/#alpine","title":"alpine","text":"<ul> <li>\u5728 rpi4 \u4e0a\u7528 PXE \u8fd0\u884c Alpine Linux</li> <li>\u5728\u53e4\u8001\u7684 OS \u4e0a\u8fd0\u884c\u4e00\u4e2a\u5e72\u51c0\u7684\u65b0\u7684\u73af\u5883</li> </ul>"},{"location":"tags/#amd","title":"amd","text":"<ul> <li>AMD \u5904\u7406\u5668</li> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#android","title":"android","text":"<ul> <li>Android Studio \u624b\u5de5\u66f4\u65b0\u5c0f\u8bb0</li> <li>\u5199\u4e86\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5206\u6790\u5404\u4e2a\u6e90\u6587\u4ef6\u4e4b\u95f4\u7684 include \u5173\u7cfb\u3002</li> <li>Linux on Android \u7b80\u5355\u6559\u7a0b</li> <li>\"@\u5fae\u4fe1 SDK \u5f00\u53d1\u8005\uff0c\u53d1\u73b0\u4e00\u4e2a BUG~\"</li> <li>\u5728 Android \u4e0a\u6253\u5f00 LTE \u7684 IPv6</li> <li>\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5</li> </ul>"},{"location":"tags/#androidstudio","title":"androidstudio","text":"<ul> <li>Android Studio \u624b\u5de5\u66f4\u65b0\u5c0f\u8bb0</li> <li>\"@\u5fae\u4fe1 SDK \u5f00\u53d1\u8005\uff0c\u53d1\u73b0\u4e00\u4e2a BUG~\"</li> </ul>"},{"location":"tags/#angler","title":"angler","text":"<ul> <li>\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5</li> <li>\u5728 ArchLinux \u4e0a\u7f16\u8bd1 LineageOS for Huawei Angler</li> </ul>"},{"location":"tags/#apn","title":"apn","text":"<ul> <li>\u5728 Android \u4e0a\u6253\u5f00 LTE \u7684 IPv6</li> </ul>"},{"location":"tags/#apple","title":"apple","text":"<ul> <li>Apple \u5904\u7406\u5668</li> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> </ul>"},{"location":"tags/#applesilicon","title":"applesilicon","text":"<ul> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> </ul>"},{"location":"tags/#aprilfool","title":"aprilfool","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> </ul>"},{"location":"tags/#aqara","title":"aqara","text":"<ul> <li>\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90</li> </ul>"},{"location":"tags/#arch","title":"arch","text":"<ul> <li>\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Archlinux \u8bb0\u5f55</li> </ul>"},{"location":"tags/#archlinux","title":"archlinux","text":"<ul> <li>Building emacs git version with xwidgets and modules in archlinux</li> <li>\u5728 ArchLinux \u4e0a\u7f16\u8bd1 LineageOS for Huawei Angler</li> </ul>"},{"location":"tags/#arm","title":"arm","text":"<ul> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> <li>\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0</li> <li>\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer</li> <li>Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#arm64","title":"arm64","text":"<ul> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> <li>\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer</li> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> </ul>"},{"location":"tags/#artix7","title":"artix7","text":"<ul> <li>\u5728 macOS \u70e7\u5199 Artix7 FPGA</li> </ul>"},{"location":"tags/#arty","title":"arty","text":"<ul> <li>\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux</li> </ul>"},{"location":"tags/#atags","title":"atags","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> </ul>"},{"location":"tags/#auth","title":"auth","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5</li> </ul>"},{"location":"tags/#avago","title":"avago","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#avc","title":"avc","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#awk","title":"awk","text":"<ul> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> </ul>"},{"location":"tags/#aws","title":"aws","text":"<ul> <li>\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM</li> </ul>"},{"location":"tags/#ax7021","title":"ax7021","text":"<ul> <li>\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG</li> </ul>"},{"location":"tags/#axi","title":"axi","text":"<ul> <li>\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae</li> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> </ul>"},{"location":"tags/#babel","title":"babel","text":"<ul> <li>\u5728 WireGuard \u6784\u5efa\u7684 Overlay Network \u4e0a\u8dd1 babel \u8def\u7531\u534f\u8bae</li> </ul>"},{"location":"tags/#backup","title":"backup","text":"<ul> <li>Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999</li> </ul>"},{"location":"tags/#baremetal","title":"baremetal","text":"<ul> <li>\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7</li> </ul>"},{"location":"tags/#bash","title":"bash","text":"<ul> <li>\u5199\u4e00\u4e2a bash zsh \u548c fish \u90fd\u80fd\u8dd1\u7684\u811a\u672c</li> </ul>"},{"location":"tags/#bb84","title":"bb84","text":"<ul> <li>\u89e3\u91ca BB84 \u534f\u8bae</li> </ul>"},{"location":"tags/#bcm43602","title":"bcm43602","text":"<ul> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#benchmark","title":"benchmark","text":"<ul> <li>SPEC CPU 2006 \u6027\u80fd\u6d4b\u8bd5</li> </ul>"},{"location":"tags/#bifurcation","title":"bifurcation","text":"<ul> <li>PCIe Bifurcation</li> </ul>"},{"location":"tags/#bigsur","title":"bigsur","text":"<ul> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> </ul>"},{"location":"tags/#binary","title":"binary","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#binutils","title":"binutils","text":"<ul> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#bitstream","title":"bitstream","text":"<ul> <li>\u5bfc\u51fa Vivado \u4e0b\u8f7d Bitstream \u7684 SVF \u6587\u4ef6</li> </ul>"},{"location":"tags/#blog","title":"blog","text":"<ul> <li>\u8d85\u8fc7 100 \u7bc7\u535a\u6587\u4e86\uff01</li> </ul>"},{"location":"tags/#bmc","title":"bmc","text":"<ul> <li>\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC</li> <li>IBM Power S822LC(8335-GTB) BMC \u5347\u7ea7</li> </ul>"},{"location":"tags/#boot","title":"boot","text":"<ul> <li>Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae</li> <li>\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Archlinux \u8bb0\u5f55</li> </ul>"},{"location":"tags/#bootloader","title":"bootloader","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> </ul>"},{"location":"tags/#box2d","title":"box2d","text":"<ul> <li>\u5199\u4e86\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5206\u6790\u5404\u4e2a\u6e90\u6587\u4ef6\u4e4b\u95f4\u7684 include \u5173\u7cfb\u3002</li> </ul>"},{"location":"tags/#bp","title":"bp","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> <li>IBM z15 Mainframe CPU \u5206\u652f\u9884\u6d4b\u5668\u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#bram","title":"bram","text":"<ul> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> </ul>"},{"location":"tags/#branch","title":"branch","text":"<ul> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> </ul>"},{"location":"tags/#brcmfmac","title":"brcmfmac","text":"<ul> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#bridge","title":"bridge","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#brief-into-ooo","title":"brief-into-ooo","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> </ul>"},{"location":"tags/#broadcom","title":"broadcom","text":"<ul> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#broadlink","title":"broadlink","text":"<ul> <li>\u914d\u7f6e homebridge-broadlink-rm-pro</li> </ul>"},{"location":"tags/#brouter","title":"brouter","text":"<ul> <li>\u4f7f\u7528 veth \u5b9e\u73b0 IPv6-only \u7684 Brouter \u529f\u80fd</li> </ul>"},{"location":"tags/#bscan","title":"bscan","text":"<ul> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> </ul>"},{"location":"tags/#buffer","title":"buffer","text":"<ul> <li>Skid Buffer</li> </ul>"},{"location":"tags/#buildroot","title":"buildroot","text":"<ul> <li>\u5728 Rpi4 \u4e0a\u8fd0\u884c buildroot</li> </ul>"},{"location":"tags/#builtin","title":"builtin","text":"<ul> <li>C/C++ \u6570\u53c2\u6570\u4e2a\u6570\u7684\u7279\u522b\u65b9\u6cd5</li> </ul>"},{"location":"tags/#bus","title":"bus","text":"<ul> <li>\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae</li> <li>CHI \u5b66\u4e60\u7b14\u8bb0</li> <li>CXL \u5b66\u4e60\u7b14\u8bb0</li> <li>\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5</li> <li>PCIe Bifurcation</li> <li>PCIe \u5b66\u4e60\u7b14\u8bb0</li> <li>TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790</li> <li>\u300c\u6559\u5b66\u300dWishbone \u603b\u7ebf\u534f\u8bae</li> </ul>"},{"location":"tags/#c","title":"c","text":"<ul> <li>C/C++ \u6570\u53c2\u6570\u4e2a\u6570\u7684\u7279\u522b\u65b9\u6cd5</li> <li>IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior</li> <li>\u518d\u6b21\u5410\u69fd VS \u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5728 Linux \u4e2d\u7528 C \u4ee3\u7801\u83b7\u53d6 DNS \u670d\u52a1\u5668\u5217\u8868</li> </ul>"},{"location":"tags/#c_1","title":"c++","text":"<ul> <li>\u3016\u65b0\u624b\u5411\u3017\u7ed5\u8fc7 C++ \u7c7b\u7684\u8bbf\u95ee\u9650\u5236</li> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> <li>\u518d\u6b21\u5410\u69fd VS \u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5728 Jupyter Notebook \u4e2d\u8fd0\u884c C++ \u4ee3\u7801</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> </ul>"},{"location":"tags/#c11","title":"c++11","text":"<ul> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> </ul>"},{"location":"tags/#ca","title":"ca","text":"<ul> <li>News</li> </ul>"},{"location":"tags/#cache","title":"cache","text":"<ul> <li>\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> <li>TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790</li> <li>VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#cameron","title":"cameron","text":"<ul> <li>Listen and write down subtitles of Cameron's speech</li> </ul>"},{"location":"tags/#catalina","title":"catalina","text":"<ul> <li>\u5728 macOS \u4e0a\u5e26\u6267\u884c\u6743\u9650 mmap \u4e00\u4e2a\u5df2\u5220\u9664\u6587\u4ef6\u9047\u5230\u7684\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#cd","title":"cd","text":"<ul> <li>\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0</li> </ul>"},{"location":"tags/#centos","title":"centos","text":"<ul> <li>\u5728\u53e4\u8001\u7684 OS \u4e0a\u8fd0\u884c\u4e00\u4e2a\u5e72\u51c0\u7684\u65b0\u7684\u73af\u5883</li> <li>\u8bb0\u5f55\u4e00\u6b21 CentOS AArch64 7 \u5230 8 \u7684\u5347\u7ea7</li> <li>\u9ad8\u4e91 FPGA \u8e29\u5751</li> <li>\u4e00\u6b21\u4ece RHEL 6 \u5230 CentOS 7 \u7684\u66f4\u65b0</li> </ul>"},{"location":"tags/#ceph","title":"ceph","text":"<ul> <li>Ceph Cookbook</li> <li>\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm</li> <li>\u901a\u8fc7 rook \u5728 k8s \u4e0a\u90e8\u7f72 ceph \u96c6\u7fa4</li> </ul>"},{"location":"tags/#cephadm","title":"cephadm","text":"<ul> <li>\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm</li> </ul>"},{"location":"tags/#cephfs","title":"cephfs","text":"<ul> <li>\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm</li> </ul>"},{"location":"tags/#cert-manager","title":"cert-manager","text":"<ul> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> </ul>"},{"location":"tags/#certbot","title":"certbot","text":"<ul> <li>\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM</li> </ul>"},{"location":"tags/#ch32","title":"ch32","text":"<ul> <li>\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> </ul>"},{"location":"tags/#ch32v307","title":"ch32v307","text":"<ul> <li>\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> </ul>"},{"location":"tags/#checksum","title":"checksum","text":"<ul> <li>IP \u548c UDP Checksum \u7684\u589e\u91cf\u66f4\u65b0\u95ee\u9898</li> </ul>"},{"location":"tags/#chi","title":"chi","text":"<ul> <li>CHI \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#child-frame","title":"child frame","text":"<ul> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> </ul>"},{"location":"tags/#chinese","title":"chinese","text":"<ul> <li>Using chinese pyim</li> <li>\u5b9e\u73b0 VSCodeVim \u4e2d\u652f\u6301\u4e2d\u6587\u5206\u8bcd\u7684\u5355\u8bcd\u79fb\u52a8</li> </ul>"},{"location":"tags/#chisel","title":"chisel","text":"<ul> <li>Chisel3 Cookbook</li> <li>\u5206\u6790 Rocket Chip \u4e2d Diplomacy \u7cfb\u7edf</li> <li>firtool \u5c1d\u8bd5</li> <li>\u5728 Rocket Chip \u4e0a\u6302\u63a5 TLRAM</li> <li>\u5728 Vivado \u4e2d\u5bf9 chisel3 \u4ea7\u751f\u7684 verilog \u4ee3\u7801\u4eff\u771f</li> </ul>"},{"location":"tags/#chromium","title":"chromium","text":"<ul> <li>Chromium \u6784\u5efa\u4e0e\u79fb\u690d</li> </ul>"},{"location":"tags/#chroot","title":"chroot","text":"<ul> <li>\u7528 jailkit \u9650\u5236\u7528\u6237\u4ec5 scp</li> </ul>"},{"location":"tags/#ci","title":"ci","text":"<ul> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI</li> <li>\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0</li> </ul>"},{"location":"tags/#cidr","title":"cidr","text":"<ul> <li>IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior</li> </ul>"},{"location":"tags/#circt","title":"circt","text":"<ul> <li>firtool \u5c1d\u8bd5</li> </ul>"},{"location":"tags/#circuit","title":"circuit","text":"<ul> <li>PCB \u7b14\u8bb0</li> </ul>"},{"location":"tags/#cisco","title":"cisco","text":"<ul> <li>\u4e3a Cisco WLC \u914d\u7f6e Telegraf</li> <li>ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0</li> <li>\u4f7f\u7528 Cisco AC + AP \u7ec4\u5408\u642d\u5efa\u7f51\u7edc\u5b9e\u8df5</li> </ul>"},{"location":"tags/#clang","title":"clang","text":"<ul> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> <li>LSP \u548c C++</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f</li> <li>COMMON \u7b26\u53f7</li> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#clangd","title":"clangd","text":"<ul> <li>LSP \u548c C++</li> </ul>"},{"location":"tags/#cling","title":"cling","text":"<ul> <li>\u5728 Jupyter Notebook \u4e2d\u8fd0\u884c C++ \u4ee3\u7801</li> </ul>"},{"location":"tags/#clone","title":"clone","text":"<ul> <li>Tips on git shallow clone</li> </ul>"},{"location":"tags/#cni","title":"cni","text":"<ul> <li>\u7814\u7a76 k8s \u7f51\u7edc\u5de5\u4f5c\u539f\u7406</li> </ul>"},{"location":"tags/#code-server","title":"code-server","text":"<ul> <li>\u5728 k8s \u4e2d\u90e8\u7f72 code-server</li> <li>\u5728 FreeBSD \u4e0a\u8fd0\u884c code-server</li> </ul>"},{"location":"tags/#codesign","title":"codesign","text":"<ul> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> </ul>"},{"location":"tags/#coding","title":"coding","text":"<ul> <li>The end of senior two</li> <li>Good software engineering rules</li> </ul>"},{"location":"tags/#coherence","title":"coherence","text":"<ul> <li>\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae</li> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> <li>CHI \u5b66\u4e60\u7b14\u8bb0</li> <li>CXL \u5b66\u4e60\u7b14\u8bb0</li> <li>TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790</li> </ul>"},{"location":"tags/#collision","title":"collision","text":"<ul> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> </ul>"},{"location":"tags/#common","title":"common","text":"<ul> <li>Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898</li> </ul>"},{"location":"tags/#compilation_database","title":"compilation_database","text":"<ul> <li>LSP \u548c C++</li> </ul>"},{"location":"tags/#compression","title":"compression","text":"<ul> <li>A good way to show git diff for compressed files</li> </ul>"},{"location":"tags/#connectx4","title":"connectx4","text":"<ul> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#container","title":"container","text":"<ul> <li>\u901a\u8fc7 systemd-run \u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4</li> </ul>"},{"location":"tags/#cookbook","title":"cookbook","text":"<ul> <li>Chisel3 Cookbook</li> <li>Nix Cookbook</li> <li>FreeBSD/NetBSD/OpenBSD/DragonFlyBSD Cookbook</li> </ul>"},{"location":"tags/#cortex","title":"cortex","text":"<ul> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> </ul>"},{"location":"tags/#cosim","title":"cosim","text":"<ul> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> </ul>"},{"location":"tags/#cpp","title":"cpp","text":"<ul> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> <li>IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior</li> <li>LSP \u548c C++</li> <li>libc++ \u7684 uniform_int_distribution \u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#cpu","title":"cpu","text":"<ul> <li>AMD \u5904\u7406\u5668</li> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Apple \u5904\u7406\u5668</li> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> <li>CPU \u5fae\u67b6\u6784\u9006\u5411\u65b9\u6cd5\u5b66</li> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> <li>IBM z15 Mainframe CPU \u5206\u652f\u9884\u6d4b\u5668\u5b66\u4e60\u7b14\u8bb0</li> <li>Intel \u5904\u7406\u5668</li> <li>LoongArch \u5904\u7406\u5668</li> <li>Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae</li> <li>\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0</li> <li>Sunway \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> <li>VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb</li> <li>\u7528 CPUID \u83b7\u53d6\u8bc4\u6d4b\u673a\u5668\u7684 CPU</li> <li>Verilog \u521d\u4f53\u9a8c</li> <li>Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76</li> </ul>"},{"location":"tags/#cpuid","title":"cpuid","text":"<ul> <li>\u7528 CPUID \u83b7\u53d6\u8bc4\u6d4b\u673a\u5668\u7684 CPU</li> </ul>"},{"location":"tags/#cquery","title":"cquery","text":"<ul> <li>LSP \u548c C++</li> </ul>"},{"location":"tags/#cron","title":"cron","text":"<ul> <li>OpenWRT \u4e0a\u914d\u7f6e Gandi DDNS</li> </ul>"},{"location":"tags/#crosscompiling","title":"crosscompiling","text":"<ul> <li>\u4ea4\u53c9\u7f16\u8bd1 Nginx 1.14.2 \u5230 RISC-V</li> </ul>"},{"location":"tags/#crypto","title":"crypto","text":"<ul> <li>\u5404\u79cd ecc \u66f2\u7ebf</li> <li>ECDSA</li> <li>Montgomery \u6a21\u4e58</li> </ul>"},{"location":"tags/#cs","title":"cs","text":"<ul> <li>\u56de\u987e\u6628\u5929\u7684\u9152\u4e95\u77e5\u8bc6\u7ade\u8d5b</li> <li>\u5206\u6790\u4e00\u4e2a\u6211\u7b2c\u4e00\u6b21\u89c1\u7684\u7d20\u6570\u6d4b\u8bd5\u51fd\u6570</li> <li>\u518d\u6b21\u5410\u69fd VS \u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> </ul>"},{"location":"tags/#cs140e","title":"cs140e","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#ctap","title":"ctap","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#ctf","title":"ctf","text":"<ul> <li>THUCTF 2018 \u548c Teaser Dragon CTF 2018 \u5c0f\u8bb0</li> </ul>"},{"location":"tags/#cu","title":"cu","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#cuda","title":"cuda","text":"<ul> <li>Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f</li> <li>NVIDIA \u9a71\u52a8\u548c CUDA \u5b89\u88c5\u901f\u67e5</li> <li>NVIDIA \u9a71\u52a8\u548c CUDA \u7248\u672c\u4fe1\u606f\u901f\u67e5</li> </ul>"},{"location":"tags/#cxl","title":"cxl","text":"<ul> <li>CXL \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#darkmode","title":"darkmode","text":"<ul> <li>\u5f3a\u5236\u542f\u7528 Google Chrome \u539f\u751f\u7684 Dark Mode</li> </ul>"},{"location":"tags/#darwin","title":"darwin","text":"<ul> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> </ul>"},{"location":"tags/#dashboard","title":"dashboard","text":"<ul> <li>\u4f53\u9a8c Tencent Kubernetes Engine</li> </ul>"},{"location":"tags/#date","title":"date","text":"<ul> <li>invalid date \u62a5\u9519\u4e0e\u65f6\u533a\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#datetime-formatting","title":"datetime formatting","text":"<ul> <li>\u6709\u8da3\u7684 Java \u65e5\u671f\u683c\u5f0f\u5316\u95ee\u9898</li> </ul>"},{"location":"tags/#dc","title":"dc","text":"<ul> <li>Synopsys Design Compiler \u7efc\u5408\u5b9e\u8df5</li> </ul>"},{"location":"tags/#dcst","title":"dcst","text":"<ul> <li>\u6559\u5b66\u968f\u60f3</li> </ul>"},{"location":"tags/#dd","title":"dd","text":"<ul> <li>\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM</li> </ul>"},{"location":"tags/#ddns","title":"ddns","text":"<ul> <li>OpenWRT \u4e0a\u914d\u7f6e Gandi DDNS</li> </ul>"},{"location":"tags/#ddr","title":"ddr","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> <li>DRAM \u7684\u62d3\u6251\u548c\u8bad\u7ec3</li> <li>\u300c\u6559\u5b66\u300dDRAM \u7ed3\u6784\u548c\u7279\u6027</li> </ul>"},{"location":"tags/#debian","title":"debian","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> <li>\u7528 MuSSH \u5feb\u901f\u5bf9\u591a\u53f0\u673a\u5668\u8fdb\u884c\u8f6f\u4ef6\u5305\u5347\u7ea7</li> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> <li>\u914d\u7f6e fcitx-fbterm \u5b9e\u73b0\u5728\u7ec8\u7aef\u4e0b\u663e\u793a\u548c\u8f93\u5165\u4e2d\u6587</li> <li>\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a</li> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> </ul>"},{"location":"tags/#debug","title":"debug","text":"<ul> <li>\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae</li> <li>\u5411 Rocket Chip \u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7</li> </ul>"},{"location":"tags/#decaf","title":"decaf","text":"<ul> <li>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 Decaf LSP</li> </ul>"},{"location":"tags/#dell","title":"dell","text":"<ul> <li>iDRAC \u5404\u7248\u672c</li> </ul>"},{"location":"tags/#descriptor","title":"descriptor","text":"<ul> <li>\u8f6f\u786c\u4ef6\u961f\u5217\u63a5\u53e3</li> </ul>"},{"location":"tags/#designcompiler","title":"designcompiler","text":"<ul> <li>Synopsys Design Compiler \u7efc\u5408\u5b9e\u8df5</li> </ul>"},{"location":"tags/#devicetree","title":"devicetree","text":"<ul> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> </ul>"},{"location":"tags/#digilent","title":"digilent","text":"<ul> <li>\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux</li> </ul>"},{"location":"tags/#digital","title":"digital","text":"<ul> <li>\u6570\u5b57\u8c03\u5236</li> </ul>"},{"location":"tags/#diplomacy","title":"diplomacy","text":"<ul> <li>\u5206\u6790 Rocket Chip \u4e2d Diplomacy \u7cfb\u7edf</li> </ul>"},{"location":"tags/#disk","title":"disk","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> <li>Nginx \u5904\u7406 POST \u8bf7\u6c42\u51fa\u73b0 Internal Server Error \u6392\u67e5\u4e00\u5219</li> </ul>"},{"location":"tags/#display","title":"display","text":"<ul> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> </ul>"},{"location":"tags/#diy","title":"diy","text":"<ul> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#dkms","title":"dkms","text":"<ul> <li>TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5</li> </ul>"},{"location":"tags/#dns","title":"dns","text":"<ul> <li>NAT64 \u521d\u5c1d\u8bd5</li> <li>\u5728 Linux \u4e2d\u7528 C \u4ee3\u7801\u83b7\u53d6 DNS \u670d\u52a1\u5668\u5217\u8868</li> </ul>"},{"location":"tags/#dns64","title":"dns64","text":"<ul> <li>NAT64 \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#docker","title":"docker","text":"<ul> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u7528 Kubernetes \u90e8\u7f72\u65e0\u72b6\u6001\u670d\u52a1</li> <li>\u7814\u7a76 k8s \u7f51\u7edc\u5de5\u4f5c\u539f\u7406</li> <li>\u90e8\u7f72 adminMongo \u7684 Docker \u955c\u50cf</li> <li>Podman \u548c Docker Rootless \u5b9e\u8df5</li> <li>\u4f7f\u7528 Docker \u90e8\u7f72 OpenLDAP</li> </ul>"},{"location":"tags/#domain","title":"domain","text":"<ul> <li>jiegec.xyz \u57df\u540d\u5373\u5c06\u505c\u7528</li> </ul>"},{"location":"tags/#dongle","title":"dongle","text":"<ul> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> </ul>"},{"location":"tags/#dram","title":"dram","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> <li>DRAM \u7684\u62d3\u6251\u548c\u8bad\u7ec3</li> <li>\u300c\u6559\u5b66\u300dDRAM \u7ed3\u6784\u548c\u7279\u6027</li> <li>\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5</li> </ul>"},{"location":"tags/#driver","title":"driver","text":"<ul> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8</li> <li>VFIO - Virtual Function I/O</li> </ul>"},{"location":"tags/#drone","title":"drone","text":"<ul> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI</li> </ul>"},{"location":"tags/#dts","title":"dts","text":"<ul> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> </ul>"},{"location":"tags/#dvi","title":"dvi","text":"<ul> <li>\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b</li> </ul>"},{"location":"tags/#e1000","title":"e1000","text":"<ul> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 e1000 \u9a71\u52a8</li> </ul>"},{"location":"tags/#e8450","title":"e8450","text":"<ul> <li>Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax</li> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> </ul>"},{"location":"tags/#ebpf","title":"ebpf","text":"<ul> <li>\u7f16\u5199 eBPF \u7a0b\u5e8f\u548c\u5229\u7528 HyperLogLog \u7edf\u8ba1\u5305\u7684\u4fe1\u606f</li> </ul>"},{"location":"tags/#ebtables","title":"ebtables","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> <li>\u4f7f\u7528 veth \u5b9e\u73b0 IPv6-only \u7684 Brouter \u529f\u80fd</li> </ul>"},{"location":"tags/#ecc","title":"ecc","text":"<ul> <li>\u5404\u79cd ecc \u66f2\u7ebf</li> <li>ECDSA</li> </ul>"},{"location":"tags/#ecdsa","title":"ecdsa","text":"<ul> <li>ECDSA</li> </ul>"},{"location":"tags/#edid","title":"edid","text":"<ul> <li>macOS \u4e0b\u8bfb\u53d6\u5e76\u89e3\u6790 EDID</li> </ul>"},{"location":"tags/#education","title":"education","text":"<ul> <li>\u6559\u5b66\u968f\u60f3</li> </ul>"},{"location":"tags/#efi","title":"efi","text":"<ul> <li>\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6</li> <li>\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Archlinux \u8bb0\u5f55</li> </ul>"},{"location":"tags/#elf","title":"elf","text":"<ul> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09</li> </ul>"},{"location":"tags/#elk","title":"elk","text":"<ul> <li>\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e</li> </ul>"},{"location":"tags/#emacs","title":"emacs","text":"<ul> <li>Building emacs git version with xwidgets and modules in archlinux</li> <li>Exciting new software updates</li> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> <li>Using chinese pyim</li> </ul>"},{"location":"tags/#email","title":"email","text":"<ul> <li>\u8f76\u4e8b\u4e00\u5219</li> </ul>"},{"location":"tags/#emoji","title":"emoji","text":"<ul> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> </ul>"},{"location":"tags/#encoding","title":"encoding","text":"<ul> <li>\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV</li> </ul>"},{"location":"tags/#esp","title":"esp","text":"<ul> <li>\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6</li> </ul>"},{"location":"tags/#esxcli","title":"esxcli","text":"<ul> <li>ESXi \u7f51\u7edc\u914d\u7f6e</li> </ul>"},{"location":"tags/#esxi","title":"esxi","text":"<ul> <li>\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7</li> <li>\u5728 VMware ESXi \u4e0a\u90e8\u7f72 vCSA \u5b9e\u8df5</li> <li>ESXi \u914d\u7f6e LACP \u94fe\u8def\u805a\u5408</li> <li>ESXi \u5e38\u7528\u4fe1\u606f</li> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> <li>ESXi \u7f51\u7edc\u914d\u7f6e</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#etc","title":"etc","text":"<ul> <li>ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0</li> </ul>"},{"location":"tags/#ethernet","title":"ethernet","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#eval","title":"eval","text":"<ul> <li>\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> </ul>"},{"location":"tags/#ext4","title":"ext4","text":"<ul> <li>\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM</li> </ul>"},{"location":"tags/#extfs","title":"extfs","text":"<ul> <li>\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM</li> </ul>"},{"location":"tags/#exynos","title":"exynos","text":"<ul> <li>\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#fakeroot","title":"fakeroot","text":"<ul> <li>Buildroot 2020.08 \u7684 Fakeroot \u7248\u672c\u8fc7\u65e7\u5bfc\u81f4\u7684\u517c\u5bb9\u6027\u95ee\u9898</li> </ul>"},{"location":"tags/#fat32","title":"fat32","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> <li>\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Archlinux \u8bb0\u5f55</li> </ul>"},{"location":"tags/#fb","title":"fb","text":"<ul> <li>\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer</li> </ul>"},{"location":"tags/#fbdump","title":"fbdump","text":"<ul> <li>\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer</li> </ul>"},{"location":"tags/#fbgrab","title":"fbgrab","text":"<ul> <li>\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer</li> </ul>"},{"location":"tags/#fbterm","title":"fbterm","text":"<ul> <li>\u914d\u7f6e fcitx-fbterm \u5b9e\u73b0\u5728\u7ec8\u7aef\u4e0b\u663e\u793a\u548c\u8f93\u5165\u4e2d\u6587</li> </ul>"},{"location":"tags/#fcitx","title":"fcitx","text":"<ul> <li>\u914d\u7f6e fcitx-fbterm \u5b9e\u73b0\u5728\u7ec8\u7aef\u4e0b\u663e\u793a\u548c\u8f93\u5165\u4e2d\u6587</li> </ul>"},{"location":"tags/#fedora","title":"fedora","text":"<ul> <li>\u4f53\u9a8c Fedora on RISCV</li> </ul>"},{"location":"tags/#ffi","title":"ffi","text":"<ul> <li>Rust \u83b7\u53d6 Linker Script \u4e2d\u7684\u5730\u5740</li> </ul>"},{"location":"tags/#fiber","title":"fiber","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#fido","title":"fido","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#fido2","title":"fido2","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#firestorm","title":"firestorm","text":"<ul> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#firmware","title":"firmware","text":"<ul> <li>\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6</li> </ul>"},{"location":"tags/#firtool","title":"firtool","text":"<ul> <li>firtool \u5c1d\u8bd5</li> </ul>"},{"location":"tags/#fish","title":"fish","text":"<ul> <li>\u5199\u4e00\u4e2a bash zsh \u548c fish \u90fd\u80fd\u8dd1\u7684\u811a\u672c</li> </ul>"},{"location":"tags/#flannel","title":"flannel","text":"<ul> <li>\u7814\u7a76 k8s \u7f51\u7edc\u5de5\u4f5c\u539f\u7406</li> </ul>"},{"location":"tags/#flash","title":"flash","text":"<ul> <li>\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash</li> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> <li>Farewell, Flash</li> </ul>"},{"location":"tags/#fluentd","title":"fluentd","text":"<ul> <li>\u7528 fluentd \u6536\u96c6 k8s \u4e2d\u5bb9\u5668\u7684\u65e5\u5fd7</li> </ul>"},{"location":"tags/#flukenetworks","title":"flukenetworks","text":"<ul> <li>ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0</li> </ul>"},{"location":"tags/#flv","title":"flv","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#fm","title":"fm","text":"<ul> <li>\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad</li> </ul>"},{"location":"tags/#font","title":"font","text":"<ul> <li>\u8c03\u6574 Alacritty \u7684 Powerline \u5b57\u4f53\u663e\u793a\u504f\u79fb</li> </ul>"},{"location":"tags/#footprint","title":"footprint","text":"<ul> <li>PCB \u7b14\u8bb0</li> </ul>"},{"location":"tags/#fortran","title":"fortran","text":"<ul> <li>Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> </ul>"},{"location":"tags/#forwarding","title":"forwarding","text":"<ul> <li>\u642d\u5efa FTP server behind NAT</li> <li>\u4f7f\u7528 iptables \u548c\u7b56\u7565\u8def\u7531\u8fdb\u884c\u5e26\u6e90\u5730\u5740\u7684 forwarding</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>\u901a\u8fc7 SSH \u96a7\u9053\u8fde\u63a5 ADB \u548c Android \u8bbe\u5907</li> </ul>"},{"location":"tags/#fpga","title":"fpga","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> <li>\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux</li> <li>\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG</li> <li>\u5728\u8354\u679d\u7cd6\uff08Lichee Tang\uff09\u4e0a\u521d\u6b21\u4f53\u9a8c FPGA</li> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u5728 macOS \u70e7\u5199 Artix7 FPGA</li> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff082\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff083\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> <li>\u9ad8\u4e91 FPGA \u8e29\u5751</li> <li>Verilog \u521d\u4f53\u9a8c</li> </ul>"},{"location":"tags/#fpnew","title":"fpnew","text":"<ul> <li>\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868</li> </ul>"},{"location":"tags/#fpu","title":"fpu","text":"<ul> <li>\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868</li> </ul>"},{"location":"tags/#frame","title":"frame","text":"<ul> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> </ul>"},{"location":"tags/#framebuffer","title":"framebuffer","text":"<ul> <li>\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer</li> </ul>"},{"location":"tags/#freebsd","title":"freebsd","text":"<ul> <li>\u5728 FreeBSD \u4e0a\u8fd0\u884c code-server</li> <li>FreeBSD/NetBSD/OpenBSD/DragonFlyBSD Cookbook</li> </ul>"},{"location":"tags/#frontend","title":"frontend","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> <li>\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV</li> </ul>"},{"location":"tags/#fs","title":"fs","text":"<ul> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> </ul>"},{"location":"tags/#ft4232","title":"ft4232","text":"<ul> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> </ul>"},{"location":"tags/#ftp","title":"ftp","text":"<ul> <li>\u642d\u5efa FTP server behind NAT</li> </ul>"},{"location":"tags/#fuzz-test","title":"fuzz test","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> </ul>"},{"location":"tags/#gandi","title":"gandi","text":"<ul> <li>OpenWRT \u4e0a\u914d\u7f6e Gandi DDNS</li> </ul>"},{"location":"tags/#gaokao","title":"gaokao","text":"<ul> <li>\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b</li> </ul>"},{"location":"tags/#gbk","title":"gbk","text":"<ul> <li>\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV</li> </ul>"},{"location":"tags/#gcc","title":"gcc","text":"<ul> <li>C/C++ \u6570\u53c2\u6570\u4e2a\u6570\u7684\u7279\u522b\u65b9\u6cd5</li> <li>C++ 11 \u7684 ABI \u95ee\u9898</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> <li>LoongArch64 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#gdb","title":"gdb","text":"<ul> <li>\u628a GDB \u964d\u7ea7\u5230 8.0.1</li> </ul>"},{"location":"tags/#gdkoi","title":"gdkoi","text":"<ul> <li>Start next term tomorrow</li> </ul>"},{"location":"tags/#gentoo","title":"gentoo","text":"<ul> <li>\u5728 Apple M1 \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> <li>\u5728 macOS \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> </ul>"},{"location":"tags/#gentoo-prefix","title":"gentoo-prefix","text":"<ul> <li>\u5728 Apple M1 \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> <li>\u5728 macOS \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> </ul>"},{"location":"tags/#getty","title":"getty","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#ghc","title":"ghc","text":"<ul> <li>Exciting new software updates</li> <li>Exciting new software updates</li> </ul>"},{"location":"tags/#gigabitethernet","title":"gigabitethernet","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#git","title":"git","text":"<ul> <li>A good way to show git diff for compressed files</li> <li>Building emacs git version with xwidgets and modules in archlinux</li> <li>Tips on git shallow clone</li> </ul>"},{"location":"tags/#gitlab","title":"gitlab","text":"<ul> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u90e8\u7f72 gitlab\u2014runner</li> <li>\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0</li> </ul>"},{"location":"tags/#gitlab-runner","title":"gitlab-runner","text":"<ul> <li>\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u90e8\u7f72 gitlab\u2014runner</li> </ul>"},{"location":"tags/#gitlabci","title":"gitlabci","text":"<ul> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> </ul>"},{"location":"tags/#gll","title":"gll","text":"<ul> <li>\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser</li> </ul>"},{"location":"tags/#gnome","title":"gnome","text":"<ul> <li>Gnome \u7684 Fractional Scaling</li> </ul>"},{"location":"tags/#gnuradio","title":"gnuradio","text":"<ul> <li>\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad</li> </ul>"},{"location":"tags/#go","title":"go","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> <li>\u5728 WireGuard \u6784\u5efa\u7684 Overlay Network \u4e0a\u8dd1 babel \u8def\u7531\u534f\u8bae</li> </ul>"},{"location":"tags/#goauthing","title":"goauthing","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#googlechrome","title":"googlechrome","text":"<ul> <li>\u5f3a\u5236\u542f\u7528 Google Chrome \u539f\u751f\u7684 Dark Mode</li> </ul>"},{"location":"tags/#googlepinyin","title":"googlepinyin","text":"<ul> <li>\u914d\u7f6e fcitx-fbterm \u5b9e\u73b0\u5728\u7ec8\u7aef\u4e0b\u663e\u793a\u548c\u8f93\u5165\u4e2d\u6587</li> </ul>"},{"location":"tags/#gowin","title":"gowin","text":"<ul> <li>\u9ad8\u4e91 FPGA \u8e29\u5751</li> </ul>"},{"location":"tags/#gpg","title":"gpg","text":"<ul> <li>\u7ed5\u8fc7 GPGMail \u7684\u6fc0\u6d3b\u68c0\u6d4b</li> </ul>"},{"location":"tags/#gpgmail","title":"gpgmail","text":"<ul> <li>\u7ed5\u8fc7 GPGMail \u7684\u6fc0\u6d3b\u68c0\u6d4b</li> </ul>"},{"location":"tags/#gpio","title":"gpio","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#gpu","title":"gpu","text":"<ul> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#grafana","title":"grafana","text":"<ul> <li>\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90</li> <li>Grafana \u4e2d\u53ef\u89c6\u5316 Ping \u65f6\u628a Timeout \u663e\u793a\u4e3a\u6307\u5b9a\u503c</li> <li>Grafana Variable \u7684 regex \u8fc7\u6ee4\u65b9\u5f0f</li> <li>Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009</li> <li>\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e</li> </ul>"},{"location":"tags/#grc","title":"grc","text":"<ul> <li>\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad</li> </ul>"},{"location":"tags/#gre","title":"gre","text":"<ul> <li>\u5728 macOS \u4e0b\u5b9e\u73b0 GRETAP</li> </ul>"},{"location":"tags/#gretap","title":"gretap","text":"<ul> <li>\u5728 macOS \u4e0b\u5b9e\u73b0 GRETAP</li> </ul>"},{"location":"tags/#h264","title":"h264","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#hack","title":"hack","text":"<ul> <li>\u3016\u65b0\u624b\u5411\u3017\u7ed5\u8fc7 C++ \u7c7b\u7684\u8bbf\u95ee\u9650\u5236</li> </ul>"},{"location":"tags/#hardware","title":"hardware","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#haskell","title":"haskell","text":"<ul> <li>Exciting new software updates</li> </ul>"},{"location":"tags/#hdl","title":"hdl","text":"<ul> <li>Chisel3 Cookbook</li> <li>firtool \u5c1d\u8bd5</li> <li>Skid Buffer</li> <li>\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868</li> </ul>"},{"location":"tags/#helm","title":"helm","text":"<ul> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus</li> </ul>"},{"location":"tags/#hex","title":"hex","text":"<ul> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#hls","title":"hls","text":"<ul> <li>\u7528 Nginx \u4f5c\u4e3a RTMP \u670d\u52a1\u5668\u5e76\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1</li> </ul>"},{"location":"tags/#homebrew","title":"homebrew","text":"<ul> <li>\u628a GDB \u964d\u7ea7\u5230 8.0.1</li> </ul>"},{"location":"tags/#homebridge","title":"homebridge","text":"<ul> <li>\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90</li> <li>\u914d\u7f6e homebridge-broadlink-rm-pro</li> <li>\u4f7f\u7528 HomeBridge \u628a\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\u52a0\u5165\u5230 HomeKit \u4e2d</li> </ul>"},{"location":"tags/#homekit","title":"homekit","text":"<ul> <li>\u4f7f\u7528 HomeBridge \u628a\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\u52a0\u5165\u5230 HomeKit \u4e2d</li> </ul>"},{"location":"tags/#homework","title":"homework","text":"<ul> <li>Start next term tomorrow</li> </ul>"},{"location":"tags/#hpe","title":"hpe","text":"<ul> <li>\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3</li> </ul>"},{"location":"tags/#http","title":"http","text":"<ul> <li>\u7528 htpdate \u66ff\u4ee3 ntpdate \u5b9e\u73b0\u65f6\u95f4\u540c\u6b65</li> <li>\u5728 Nginx \u5c06\u67d0\u4e2a\u5b50\u8def\u5f84\u53cd\u4ee3</li> <li>Nginx \u5904\u7406 POST \u8bf7\u6c42\u51fa\u73b0 Internal Server Error \u6392\u67e5\u4e00\u5219</li> <li>\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898</li> </ul>"},{"location":"tags/#httpdate","title":"httpdate","text":"<ul> <li>\u7528 htpdate \u66ff\u4ee3 ntpdate \u5b9e\u73b0\u65f6\u95f4\u540c\u6b65</li> </ul>"},{"location":"tags/#https","title":"https","text":"<ul> <li>Nginx \u53cd\u4ee3\u5230 HTTPS \u4e0a\u6e38</li> </ul>"},{"location":"tags/#huawei","title":"huawei","text":"<ul> <li>\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5</li> <li>\u534e\u4e3a\u968f\u884c WiFi 2 mini \u5f00\u7bb1</li> </ul>"},{"location":"tags/#hyperloglog","title":"hyperloglog","text":"<ul> <li>\u7f16\u5199 eBPF \u7a0b\u5e8f\u548c\u5229\u7528 HyperLogLog \u7edf\u8ba1\u5305\u7684\u4fe1\u606f</li> </ul>"},{"location":"tags/#i2c","title":"i2c","text":"<ul> <li>I2C \u534f\u8bae</li> </ul>"},{"location":"tags/#iam","title":"iam","text":"<ul> <li>\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM</li> </ul>"},{"location":"tags/#ib","title":"ib","text":"<ul> <li>InfiniBand \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#ibm","title":"ibm","text":"<ul> <li>IBM z15 Mainframe CPU \u5206\u652f\u9884\u6d4b\u5668\u5b66\u4e60\u7b14\u8bb0</li> <li>IBM Power S822LC(8335-GTB) BMC \u5347\u7ea7</li> </ul>"},{"location":"tags/#icestorm","title":"icestorm","text":"<ul> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#icmp","title":"icmp","text":"<ul> <li>\u7528 multicast \u5730\u5740\u627e\u5230\u540c\u4e00\u7f51\u6bb5\u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#iconv","title":"iconv","text":"<ul> <li>\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV</li> </ul>"},{"location":"tags/#idrac","title":"idrac","text":"<ul> <li>iDRAC \u5404\u7248\u672c</li> </ul>"},{"location":"tags/#ieee","title":"ieee","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#ieee80211","title":"ieee802.11","text":"<ul> <li>802.11 \u5b66\u4e60</li> </ul>"},{"location":"tags/#igpu","title":"igpu","text":"<ul> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#ilo","title":"ilo","text":"<ul> <li>\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3</li> </ul>"},{"location":"tags/#ilo4","title":"ilo4","text":"<ul> <li>\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3</li> </ul>"},{"location":"tags/#infiniband","title":"infiniband","text":"<ul> <li>InfiniBand \u5b66\u4e60\u7b14\u8bb0</li> <li>\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6</li> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#influxdb","title":"influxdb","text":"<ul> <li>\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90</li> <li>Grafana \u4e2d\u53ef\u89c6\u5316 Ping \u65f6\u628a Timeout \u663e\u793a\u4e3a\u6307\u5b9a\u503c</li> <li>Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009</li> <li>\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90</li> </ul>"},{"location":"tags/#ingress","title":"ingress","text":"<ul> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> </ul>"},{"location":"tags/#initramfs","title":"initramfs","text":"<ul> <li>\u6784\u5efa\u7b80\u6613\u7684 initramfs</li> </ul>"},{"location":"tags/#initrd","title":"initrd","text":"<ul> <li>\u6784\u5efa\u7b80\u6613\u7684 initramfs</li> </ul>"},{"location":"tags/#instant","title":"instant","text":"<ul> <li>mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9</li> </ul>"},{"location":"tags/#intc","title":"intc","text":"<ul> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> </ul>"},{"location":"tags/#intel","title":"intel","text":"<ul> <li>Intel \u5904\u7406\u5668</li> <li>Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> <li>\u8f76\u4e8b\u4e00\u5219</li> <li>Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76</li> </ul>"},{"location":"tags/#intellijidea","title":"intellijidea","text":"<ul> <li>Android Studio \u624b\u5de5\u66f4\u65b0\u5c0f\u8bb0</li> <li>IntelliJ IDEA \u624b\u52a8\u66f4\u65b0\u65b9\u6cd5</li> <li>\"@\u5fae\u4fe1 SDK \u5f00\u53d1\u8005\uff0c\u53d1\u73b0\u4e00\u4e2a BUG~\"</li> </ul>"},{"location":"tags/#interrupt","title":"interrupt","text":"<ul> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> </ul>"},{"location":"tags/#intrinsics","title":"intrinsics","text":"<ul> <li>\u8f76\u4e8b\u4e00\u5219</li> </ul>"},{"location":"tags/#ip","title":"ip","text":"<ul> <li>IP \u548c UDP Checksum \u7684\u589e\u91cf\u66f4\u65b0\u95ee\u9898</li> <li>\u901a\u8fc7 iptables \u5728\u540c\u4e00\u4e2a\u7aef\u53e3\u6839\u636e\u6e90\u5730\u5740\u89e3\u590d\u7528\uff08demux\uff09</li> <li>IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior</li> </ul>"},{"location":"tags/#ipmi","title":"ipmi","text":"<ul> <li>\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3</li> <li>IBM Power S822LC(8335-GTB) BMC \u5347\u7ea7</li> </ul>"},{"location":"tags/#ipmitool","title":"ipmitool","text":"<ul> <li>\u901a\u8fc7 ipmitool \u914d\u7f6e iLO 4 \u7ba1\u7406\u7aef\u53e3</li> <li>\u9759\u6001\u7f16\u8bd1 ipmitool</li> </ul>"},{"location":"tags/#iproute2","title":"iproute2","text":"<ul> <li>\u7f16\u5199 eBPF \u7a0b\u5e8f\u548c\u5229\u7528 HyperLogLog \u7edf\u8ba1\u5305\u7684\u4fe1\u606f</li> </ul>"},{"location":"tags/#iptables","title":"iptables","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> <li>\u901a\u8fc7 iptables \u5728\u540c\u4e00\u4e2a\u7aef\u53e3\u6839\u636e\u6e90\u5730\u5740\u89e3\u590d\u7528\uff08demux\uff09</li> </ul>"},{"location":"tags/#ipv6","title":"ipv6","text":"<ul> <li>\u5728 macOS \u4e0a TAP Interface \u4e0a\u542f\u7528 IPv6 \u81ea\u52a8\u914d\u7f6e</li> <li>\u5728 Android \u4e0a\u6253\u5f00 LTE \u7684 IPv6</li> <li>ESXi \u7f51\u7edc\u914d\u7f6e</li> <li>NAT64 \u521d\u5c1d\u8bd5</li> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> <li>\u4f7f\u7528 veth \u5b9e\u73b0 IPv6-only \u7684 Brouter \u529f\u80fd</li> </ul>"},{"location":"tags/#iso14443","title":"iso14443","text":"<ul> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#ixgbe","title":"ixgbe","text":"<ul> <li>rCore \u8f6f\u8def\u7531\u5b9e\u73b0</li> </ul>"},{"location":"tags/#jailkit","title":"jailkit","text":"<ul> <li>\u7528 jailkit \u9650\u5236\u7528\u6237\u4ec5 scp</li> </ul>"},{"location":"tags/#janestreet","title":"janestreet","text":"<ul> <li>ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0</li> </ul>"},{"location":"tags/#java","title":"java","text":"<ul> <li>Android Studio \u624b\u5de5\u66f4\u65b0\u5c0f\u8bb0</li> <li>\u5199\u4e86\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5206\u6790\u5404\u4e2a\u6e90\u6587\u4ef6\u4e4b\u95f4\u7684 include \u5173\u7cfb\u3002</li> <li>IntelliJ IDEA \u624b\u52a8\u66f4\u65b0\u65b9\u6cd5</li> <li>\"@\u5fae\u4fe1 SDK \u5f00\u53d1\u8005\uff0c\u53d1\u73b0\u4e00\u4e2a BUG~\"</li> <li>\u6709\u8da3\u7684 Java \u65e5\u671f\u683c\u5f0f\u5316\u95ee\u9898</li> </ul>"},{"location":"tags/#jessie","title":"jessie","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> </ul>"},{"location":"tags/#jflash","title":"jflash","text":"<ul> <li>\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash</li> </ul>"},{"location":"tags/#jiegecxyz","title":"jiegecxyz","text":"<ul> <li>jiegec.xyz \u57df\u540d\u5373\u5c06\u505c\u7528</li> </ul>"},{"location":"tags/#jlink","title":"jlink","text":"<ul> <li>\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash</li> </ul>"},{"location":"tags/#js","title":"js","text":"<ul> <li>\u524d\u7aef\u89e3\u6790\u4e0a\u4f20\u7684 CSV</li> </ul>"},{"location":"tags/#jtag","title":"jtag","text":"<ul> <li>\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae</li> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5bfc\u51fa Vivado \u4e0b\u8f7d Bitstream \u7684 SVF \u6587\u4ef6</li> </ul>"},{"location":"tags/#jupyter","title":"jupyter","text":"<ul> <li>\u5728 Jupyter Notebook \u4e2d\u8fd0\u884c C++ \u4ee3\u7801</li> </ul>"},{"location":"tags/#k3s","title":"k3s","text":"<ul> <li>\u7528 k3s \u90e8\u7f72 k8s</li> <li>\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898</li> </ul>"},{"location":"tags/#k8s","title":"k8s","text":"<ul> <li>\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm</li> <li>\u901a\u8fc7 rook \u5728 k8s \u4e0a\u90e8\u7f72 ceph \u96c6\u7fa4</li> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u7528 k3s \u90e8\u7f72 k8s</li> <li>\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 code-server</li> <li>\u7528 Kubernetes \u90e8\u7f72\u65e0\u72b6\u6001\u670d\u52a1</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI</li> <li>\u7528 fluentd \u6536\u96c6 k8s \u4e2d\u5bb9\u5668\u7684\u65e5\u5fd7</li> <li>\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u90e8\u7f72 gitlab\u2014runner</li> <li>\u7814\u7a76 k8s \u7f51\u7edc\u5de5\u4f5c\u539f\u7406</li> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus</li> <li>\u4f53\u9a8c Tencent Kubernetes Engine</li> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> </ul>"},{"location":"tags/#karabiner-elements","title":"karabiner-elements","text":"<ul> <li>In macOS Sierra, Karabiner-Elements finally support complex modifications</li> </ul>"},{"location":"tags/#kernel","title":"kernel","text":"<ul> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#kext","title":"kext","text":"<ul> <li>\u5728 macOS \u4e0a\u8bfb\u53d6\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T. \u4fe1\u606f</li> </ul>"},{"location":"tags/#keyboard","title":"keyboard","text":"<ul> <li>\u66f4\u6539 macOS \u5c4f\u5e55\u4eae\u5ea6\u7684\u6309\u952e</li> <li>In macOS Sierra, Karabiner-Elements finally support complex modifications</li> </ul>"},{"location":"tags/#kintex7","title":"kintex7","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#kubernetes","title":"kubernetes","text":"<ul> <li>\u901a\u8fc7 rook \u5728 k8s \u4e0a\u90e8\u7f72 ceph \u96c6\u7fa4</li> <li>\u7528 gitlab ci \u6784\u5efa\u5e76\u90e8\u7f72\u5e94\u7528\u5230 k8s</li> <li>\u7528 k3s \u90e8\u7f72 k8s</li> <li>\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 code-server</li> <li>\u7528 Kubernetes \u90e8\u7f72\u65e0\u72b6\u6001\u670d\u52a1</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI</li> <li>\u7528 fluentd \u6536\u96c6 k8s \u4e2d\u5bb9\u5668\u7684\u65e5\u5fd7</li> <li>\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u90e8\u7f72 gitlab\u2014runner</li> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus</li> <li>\u4f53\u9a8c Tencent Kubernetes Engine</li> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> </ul>"},{"location":"tags/#la","title":"la","text":"<ul> <li>\u7528 PulseView \u914d\u5408 DSLogic \u8c03\u8bd5 SPI Flash</li> </ul>"},{"location":"tags/#la32","title":"la32","text":"<ul> <li>LoongArch \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#la32r","title":"la32r","text":"<ul> <li>LoongArch \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#la64","title":"la64","text":"<ul> <li>LoongArch \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#lacp","title":"lacp","text":"<ul> <li>ESXi \u914d\u7f6e LACP \u94fe\u8def\u805a\u5408</li> </ul>"},{"location":"tags/#latex","title":"latex","text":"<ul> <li>\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b</li> </ul>"},{"location":"tags/#lceda","title":"lceda","text":"<ul> <li>PCB \u7b14\u8bb0</li> </ul>"},{"location":"tags/#ld","title":"ld","text":"<ul> <li>Rust \u83b7\u53d6 Linker Script \u4e2d\u7684\u5730\u5740</li> <li>Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> <li>\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u539f\u7406</li> </ul>"},{"location":"tags/#ldap","title":"ldap","text":"<ul> <li>\u4f7f\u7528 Docker \u90e8\u7f72 OpenLDAP</li> <li>\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1</li> </ul>"},{"location":"tags/#learn","title":"learn","text":"<ul> <li>ACPI \u5b66\u4e60\u7b14\u8bb0</li> <li>CHI \u5b66\u4e60\u7b14\u8bb0</li> <li>CXL \u5b66\u4e60\u7b14\u8bb0</li> <li>InfiniBand \u5b66\u4e60\u7b14\u8bb0</li> <li>PCIe \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#learnproject","title":"learnproject","text":"<ul> <li>\u9884\u544a Learn-Project 4.0 \u7248</li> </ul>"},{"location":"tags/#lede","title":"lede","text":"<ul> <li>\u5728 LEDE\uff08OpenWrt\uff09\u4e0a\u542f\u7528 wpad</li> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#lemote","title":"lemote","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> </ul>"},{"location":"tags/#lenovo","title":"lenovo","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#letsencrypt","title":"letsencrypt","text":"<ul> <li>\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM</li> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> </ul>"},{"location":"tags/#libc","title":"libc","text":"<ul> <li>\u5728 Linux \u4e2d\u7528 C \u4ee3\u7801\u83b7\u53d6 DNS \u670d\u52a1\u5668\u5217\u8868</li> </ul>"},{"location":"tags/#libgdx","title":"libgdx","text":"<ul> <li>\u5199\u4e86\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5206\u6790\u5404\u4e2a\u6e90\u6587\u4ef6\u4e4b\u95f4\u7684 include \u5173\u7cfb\u3002</li> </ul>"},{"location":"tags/#libvirt","title":"libvirt","text":"<ul> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> </ul>"},{"location":"tags/#libvirtd","title":"libvirtd","text":"<ul> <li>\u4ece libvirtd \u8fc1\u79fb\u5230 Proxmox VE</li> </ul>"},{"location":"tags/#licheetang","title":"licheetang","text":"<ul> <li>\u5728\u8354\u679d\u7cd6\uff08Lichee Tang\uff09\u4e0a\u521d\u6b21\u4f53\u9a8c FPGA</li> </ul>"},{"location":"tags/#lineageos","title":"lineageos","text":"<ul> <li>\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5</li> <li>\u5728 ArchLinux \u4e0a\u7f16\u8bd1 LineageOS for Huawei Angler</li> </ul>"},{"location":"tags/#linker","title":"linker","text":"<ul> <li>Rust \u83b7\u53d6 Linker Script \u4e2d\u7684\u5730\u5740</li> <li>\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u539f\u7406</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09</li> </ul>"},{"location":"tags/#linking","title":"linking","text":"<ul> <li>Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898</li> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> </ul>"},{"location":"tags/#links","title":"links","text":"<ul> <li>Interesting links</li> </ul>"},{"location":"tags/#linksys","title":"linksys","text":"<ul> <li>Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax</li> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> </ul>"},{"location":"tags/#linux","title":"linux","text":"<ul> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> <li>\u642d\u5efa FTP server behind NAT</li> <li>\u4f7f\u7528 iptables \u548c\u7b56\u7565\u8def\u7531\u8fdb\u884c\u5e26\u6e90\u5730\u5740\u7684 forwarding</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>\u5728 macOS \u548c Linux \u4e4b\u95f4\u642d\u5efa tinc \u7f51\u7edc</li> <li>\u6784\u5efa\u7b80\u6613\u7684 initramfs</li> <li>Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae</li> <li>WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76</li> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8</li> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> <li>Buildroot 2020.08 \u7684 Fakeroot \u7248\u672c\u8fc7\u65e7\u5bfc\u81f4\u7684\u517c\u5bb9\u6027\u95ee\u9898</li> <li>Chromium \u6784\u5efa\u4e0e\u79fb\u690d</li> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> <li>\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6</li> <li>\u5728 Linux \u4e0b\u6355\u83b7 Framebuffer</li> <li>\u5728 Linux \u4e2d\u7528 C \u4ee3\u7801\u83b7\u53d6 DNS \u670d\u52a1\u5668\u5217\u8868</li> <li>invalid date \u62a5\u9519\u4e0e\u65f6\u533a\u7684\u5173\u7cfb</li> <li>Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76</li> <li>Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76</li> <li>How a Linux 6.2.13 BUG stops Vivado from recognizing FPGA</li> <li>Linux 6.2.13 \u5f15\u5165\u7684 BUG \u5bfc\u81f4 Vivado \u65e0\u6cd5\u8bc6\u522b FPGA</li> <li>\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5</li> <li>rsyslog \u6536\u96c6\u8fdc\u7a0b\u65e5\u5fd7</li> <li>USB/IP \u6a21\u62df USB \u8bbe\u5907</li> <li>USB/IP \u5b9e\u8df5</li> <li>VFIO - Virtual Function I/O</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09</li> <li>XRDP \u548c NVIDIA \u663e\u5361\u517c\u5bb9\u6027\u95ee\u9898</li> <li>Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999</li> <li>TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5</li> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> <li>\u4e00\u6b21\u4ece RHEL 6 \u5230 CentOS 7 \u7684\u66f4\u65b0</li> </ul>"},{"location":"tags/#linuxonandroid","title":"linuxonandroid","text":"<ul> <li>Linux on Android \u7b80\u5355\u6559\u7a0b</li> </ul>"},{"location":"tags/#lisp","title":"lisp","text":"<ul> <li>Logo is a lisp dialect</li> </ul>"},{"location":"tags/#litex","title":"litex","text":"<ul> <li>\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux</li> <li>\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG</li> </ul>"},{"location":"tags/#lk99","title":"lk99","text":"<ul> <li>LK-99 \u76f8\u5173\u94fe\u63a5</li> </ul>"},{"location":"tags/#llvm","title":"llvm","text":"<ul> <li>Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f</li> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#locale","title":"locale","text":"<ul> <li>Locale \u5f71\u54cd\u6392\u5e8f\u7684\u7279\u6b8a\u526f\u4f5c\u7528</li> </ul>"},{"location":"tags/#lock","title":"lock","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#logging","title":"logging","text":"<ul> <li>\u7528 fluentd \u6536\u96c6 k8s \u4e2d\u5bb9\u5668\u7684\u65e5\u5fd7</li> <li>rsyslog \u6536\u96c6\u8fdc\u7a0b\u65e5\u5fd7</li> </ul>"},{"location":"tags/#logicanalyzer","title":"logicanalyzer","text":"<ul> <li>\u7528 PulseView \u914d\u5408 DSLogic \u8c03\u8bd5 SPI Flash</li> </ul>"},{"location":"tags/#logo","title":"logo","text":"<ul> <li>Logo is a lisp dialect</li> </ul>"},{"location":"tags/#loongarch","title":"loongarch","text":"<ul> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> <li>LoongArch \u5904\u7406\u5668</li> <li>LoongArch \u521d\u5c1d\u8bd5</li> <li>Chromium \u6784\u5efa\u4e0e\u79fb\u690d</li> <li>LoongArch64 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#loongson","title":"loongson","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> <li>LoongArch \u5904\u7406\u5668</li> </ul>"},{"location":"tags/#ls3a6000","title":"ls3a6000","text":"<ul> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#lsi","title":"lsi","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#lsp","title":"lsp","text":"<ul> <li>LSP \u548c C++</li> <li>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 Decaf LSP</li> </ul>"},{"location":"tags/#lsu","title":"lsu","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> </ul>"},{"location":"tags/#lxc","title":"lxc","text":"<ul> <li>\u901a\u8fc7 systemd-run \u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4</li> </ul>"},{"location":"tags/#m1","title":"m1","text":"<ul> <li>\u5728 Apple M1 \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> <li>\u5728 M1 \u4e0a\u8fd0\u884c Windows ARM \u865a\u62df\u673a</li> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> <li>\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a</li> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> </ul>"},{"location":"tags/#macos","title":"macOS","text":"<ul> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> </ul>"},{"location":"tags/#macbookair","title":"macbookair","text":"<ul> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> </ul>"},{"location":"tags/#macbookpro","title":"macbookpro","text":"<ul> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#machine","title":"machine","text":"<ul> <li>\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#macos_1","title":"macos","text":"<ul> <li>\u5728 Apple M1 \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> <li>\u5728 macOS \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> <li>ARM M1 MacBook Air \u5f00\u7bb1</li> <li>\u5728 macOS \u70e7\u5199 Artix7 FPGA</li> <li>\u5728 macOS \u4e0a\u8bfb\u53d6\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T. \u4fe1\u606f</li> <li>\u5728 macOS \u548c Linux \u4e4b\u95f4\u642d\u5efa tinc \u7f51\u7edc</li> <li>\u5728 macOS \u7684 VirtualBox \u4e0a\u4ece USB \u542f\u52a8</li> <li>\u628a GDB \u964d\u7ea7\u5230 8.0.1</li> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> <li>\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a</li> <li>Archive \u4e2d COMMON \u7b26\u53f7\u7684\u94fe\u63a5\u95ee\u9898</li> <li>\u7ed5\u8fc7 GPGMail \u7684\u6fc0\u6d3b\u68c0\u6d4b</li> <li>\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6</li> <li>\u5f3a\u5236\u542f\u7528 Google Chrome \u539f\u751f\u7684 Dark Mode</li> <li>\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90</li> <li>\u5728 macOS \u4e0a\u5e26\u6267\u884c\u6743\u9650 mmap \u4e00\u4e2a\u5df2\u5220\u9664\u6587\u4ef6\u9047\u5230\u7684\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848</li> <li>macOS \u4e0b\u8bfb\u53d6\u5e76\u89e3\u6790 EDID</li> <li>Screen Capturing Tips in macOS</li> <li>Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999</li> <li>In macOS Sierra, Karabiner-Elements finally support complex modifications</li> </ul>"},{"location":"tags/#manycore","title":"manycore","text":"<ul> <li>Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> </ul>"},{"location":"tags/#markdown","title":"markdown","text":"<ul> <li>mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9</li> </ul>"},{"location":"tags/#math","title":"math","text":"<ul> <li>\u7528\u6570\u5b66\u65b9\u6cd5 + \u6570\u5b66\u8f6f\u4ef6\u53bb\u505a\u4e00\u4e2a\u7269\u7406\u9898~</li> </ul>"},{"location":"tags/#mca","title":"mca","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#mediawiki","title":"mediawiki","text":"<ul> <li>\u8c03\u6574 Nginx \u548c PHP \u7684\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236</li> </ul>"},{"location":"tags/#megaraid","title":"megaraid","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#mellanox","title":"mellanox","text":"<ul> <li>\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6</li> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#memo","title":"memo","text":"<ul> <li>Good software engineering rules</li> </ul>"},{"location":"tags/#memory","title":"memory","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5</li> </ul>"},{"location":"tags/#mesi","title":"mesi","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> </ul>"},{"location":"tags/#meta","title":"meta","text":"<ul> <li>The beginning of my blog</li> </ul>"},{"location":"tags/#metaprogramming","title":"metaprogramming","text":"<ul> <li>\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser</li> </ul>"},{"location":"tags/#mft","title":"mft","text":"<ul> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#mi","title":"mi","text":"<ul> <li>\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90</li> </ul>"},{"location":"tags/#mib","title":"mib","text":"<ul> <li>\u4e3a Cisco WLC \u914d\u7f6e Telegraf</li> </ul>"},{"location":"tags/#mic","title":"mic","text":"<ul> <li>Manycore \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> </ul>"},{"location":"tags/#microarchitecture","title":"microarchitecture","text":"<ul> <li>IBM z15 Mainframe CPU \u5206\u652f\u9884\u6d4b\u5668\u5b66\u4e60\u7b14\u8bb0</li> <li>\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#mifare","title":"mifare","text":"<ul> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#mifareclassic","title":"mifareclassic","text":"<ul> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#mig","title":"mig","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#miio","title":"miio","text":"<ul> <li>\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90</li> </ul>"},{"location":"tags/#miniupnpd","title":"miniupnpd","text":"<ul> <li>\u5229\u7528 UPnP \u534f\u8bae\u8fdb\u884c mosh NAT \u7a7f\u900f\u7684\u7814\u7a76</li> </ul>"},{"location":"tags/#mips","title":"mips","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> </ul>"},{"location":"tags/#mit","title":"mit","text":"<ul> <li>\u7f16\u7a0b\u4f5c\u4e1a\u4e2d\u7684\u5b66\u672f\u8bda\u4fe1</li> </ul>"},{"location":"tags/#mit-6828","title":"mit 6.828","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> </ul>"},{"location":"tags/#mkdocs","title":"mkdocs","text":"<ul> <li>mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9</li> </ul>"},{"location":"tags/#mkdocsmaterial","title":"mkdocsmaterial","text":"<ul> <li>mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9</li> </ul>"},{"location":"tags/#mknod","title":"mknod","text":"<ul> <li>Buildroot 2020.08 \u7684 Fakeroot \u7248\u672c\u8fc7\u65e7\u5bfc\u81f4\u7684\u517c\u5bb9\u6027\u95ee\u9898</li> </ul>"},{"location":"tags/#mlnx","title":"mlnx","text":"<ul> <li>\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6</li> </ul>"},{"location":"tags/#mmap","title":"mmap","text":"<ul> <li>\u5728 macOS \u4e0a\u5e26\u6267\u884c\u6743\u9650 mmap \u4e00\u4e2a\u5df2\u5220\u9664\u6587\u4ef6\u9047\u5230\u7684\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848</li> </ul>"},{"location":"tags/#mod","title":"mod","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> </ul>"},{"location":"tags/#modulation","title":"modulation","text":"<ul> <li>\u6570\u5b57\u8c03\u5236</li> </ul>"},{"location":"tags/#moesi","title":"moesi","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> </ul>"},{"location":"tags/#mongodb","title":"mongodb","text":"<ul> <li>\u6700\u8fd1\u5199 Node.js \u9047\u5230\u7684\u82e5\u5e72\u5751</li> <li>\u5347\u7ea7 MongoDB \u5230 4.0</li> <li>\u90e8\u7f72 adminMongo \u7684 Docker \u955c\u50cf</li> <li>\u5728 Ubuntu \u4e0a\u8de8\u7248\u672c\u8fc1\u79fb MongoDB</li> <li>\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e</li> </ul>"},{"location":"tags/#mongoose","title":"mongoose","text":"<ul> <li>\u6700\u8fd1\u5199 Node.js \u9047\u5230\u7684\u82e5\u5e72\u5751</li> </ul>"},{"location":"tags/#montgomery","title":"montgomery","text":"<ul> <li>Montgomery \u6a21\u4e58</li> </ul>"},{"location":"tags/#mosh","title":"mosh","text":"<ul> <li>\u5229\u7528 UPnP \u534f\u8bae\u8fdb\u884c mosh NAT \u7a7f\u900f\u7684\u7814\u7a76</li> </ul>"},{"location":"tags/#msi","title":"msi","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> </ul>"},{"location":"tags/#mst","title":"mst","text":"<ul> <li>\u5207\u6362 ConnectX-4 \u4e3a\u4ee5\u592a\u7f51\u6a21\u5f0f</li> </ul>"},{"location":"tags/#mstp","title":"mstp","text":"<ul> <li>\u751f\u6210\u6811\u534f\u8bae</li> </ul>"},{"location":"tags/#mulmod","title":"mulmod","text":"<ul> <li>Montgomery \u6a21\u4e58</li> </ul>"},{"location":"tags/#multicast","title":"multicast","text":"<ul> <li>\u7528 multicast \u5730\u5740\u627e\u5230\u540c\u4e00\u7f51\u6bb5\u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#multicolor-font","title":"multicolor font","text":"<ul> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> </ul>"},{"location":"tags/#musl","title":"musl","text":"<ul> <li>\u4ea4\u53c9\u7f16\u8bd1 Nginx 1.14.2 \u5230 RISC-V</li> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> </ul>"},{"location":"tags/#mussh","title":"mussh","text":"<ul> <li>\u7528 MuSSH \u5feb\u901f\u5bf9\u591a\u53f0\u673a\u5668\u8fdb\u884c\u8f6f\u4ef6\u5305\u5347\u7ea7</li> </ul>"},{"location":"tags/#nat","title":"nat","text":"<ul> <li>NAT64 \u521d\u5c1d\u8bd5</li> <li>\u642d\u5efa FTP server behind NAT</li> <li>\u5229\u7528 UPnP \u534f\u8bae\u8fdb\u884c mosh NAT \u7a7f\u900f\u7684\u7814\u7a76</li> <li>\u4f7f\u7528 iptables \u548c\u7b56\u7565\u8def\u7531\u8fdb\u884c\u5e26\u6e90\u5730\u5740\u7684 forwarding</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> </ul>"},{"location":"tags/#nat64","title":"nat64","text":"<ul> <li>NAT64 \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#ndef","title":"ndef","text":"<ul> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#neoverse","title":"neoverse","text":"<ul> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#netgear","title":"netgear","text":"<ul> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> </ul>"},{"location":"tags/#network","title":"network","text":"<ul> <li>\u8f6f\u786c\u4ef6\u961f\u5217\u63a5\u53e3</li> <li>\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898</li> </ul>"},{"location":"tags/#networking","title":"networking","text":"<ul> <li>NAT64 \u521d\u5c1d\u8bd5</li> <li>\u4e00\u4e2a\u4ee3\u66ff Pulse Secure \u5ba2\u6237\u7aef\u7684\u5de5\u5177</li> </ul>"},{"location":"tags/#newifi","title":"newifi","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#nexus6p","title":"nexus6p","text":"<ul> <li>\u5411 Nexus 6P \u4e2d\u5237\u5165 LineageOS \u5b9e\u8df5</li> </ul>"},{"location":"tags/#nfc","title":"nfc","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#nginx","title":"nginx","text":"<ul> <li>\u5728 Nginx \u5c06\u67d0\u4e2a\u5b50\u8def\u5f84\u53cd\u4ee3</li> <li>Nginx \u53cd\u4ee3\u5230 HTTPS \u4e0a\u6e38</li> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>\u8c03\u6574 Nginx \u548c PHP \u7684\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236</li> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> <li>Nginx \u5904\u7406 POST \u8bf7\u6c42\u51fa\u73b0 Internal Server Error \u6392\u67e5\u4e00\u5219</li> <li>\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898</li> <li>\u7528 Nginx \u4f5c\u4e3a RTMP \u670d\u52a1\u5668\u5e76\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1</li> </ul>"},{"location":"tags/#nginx-ingress","title":"nginx-ingress","text":"<ul> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> </ul>"},{"location":"tags/#nic","title":"nic","text":"<ul> <li>\u8f6f\u786c\u4ef6\u961f\u5217\u63a5\u53e3</li> </ul>"},{"location":"tags/#nice","title":"nice","text":"<ul> <li>Unix nice</li> </ul>"},{"location":"tags/#nix","title":"nix","text":"<ul> <li>Nix Cookbook</li> <li>\u5728 ppc64le Linux \u4e0a\u8fd0\u884c Nix</li> <li>\u7528 Nix \u7f16\u8bd1 Rust \u9879\u76ee</li> </ul>"},{"location":"tags/#nixos","title":"nixos","text":"<ul> <li>Nix Cookbook</li> </ul>"},{"location":"tags/#nodejs","title":"nodejs","text":"<ul> <li>\u6700\u8fd1\u5199 Node.js \u9047\u5230\u7684\u82e5\u5e72\u5751</li> <li>Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009</li> </ul>"},{"location":"tags/#nor","title":"nor","text":"<ul> <li>\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash</li> </ul>"},{"location":"tags/#notes","title":"notes","text":"<ul> <li>ACPI \u5b66\u4e60\u7b14\u8bb0</li> <li>CHI \u5b66\u4e60\u7b14\u8bb0</li> <li>CXL \u5b66\u4e60\u7b14\u8bb0</li> <li>InfiniBand \u5b66\u4e60\u7b14\u8bb0</li> <li>PCIe \u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#nss","title":"nss","text":"<ul> <li>\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1</li> </ul>"},{"location":"tags/#ntp","title":"ntp","text":"<ul> <li>\u7528 htpdate \u66ff\u4ee3 ntpdate \u5b9e\u73b0\u65f6\u95f4\u540c\u6b65</li> </ul>"},{"location":"tags/#ntpdate","title":"ntpdate","text":"<ul> <li>\u7528 htpdate \u66ff\u4ee3 ntpdate \u5b9e\u73b0\u65f6\u95f4\u540c\u6b65</li> </ul>"},{"location":"tags/#nvidia","title":"nvidia","text":"<ul> <li>\u5347\u7ea7 Mellanox \u7f51\u5361\u56fa\u4ef6</li> <li>Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f</li> <li>NVIDIA \u9a71\u52a8\u548c CUDA \u5b89\u88c5\u901f\u67e5</li> <li>NVIDIA \u9a71\u52a8\u548c CUDA \u7248\u672c\u4fe1\u606f\u901f\u67e5</li> <li>XRDP \u548c NVIDIA \u663e\u5361\u517c\u5bb9\u6027\u95ee\u9898</li> </ul>"},{"location":"tags/#nvme","title":"nvme","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> </ul>"},{"location":"tags/#objdump","title":"objdump","text":"<ul> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> </ul>"},{"location":"tags/#obs","title":"obs","text":"<ul> <li>\u7528 Nginx \u4f5c\u4e3a RTMP \u670d\u52a1\u5668\u5e76\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1</li> </ul>"},{"location":"tags/#oi","title":"oi","text":"<ul> <li>THUWC 2019 \u5c0f\u8bb0</li> </ul>"},{"location":"tags/#oj","title":"oj","text":"<ul> <li>\u7528 CPUID \u83b7\u53d6\u8bc4\u6d4b\u673a\u5668\u7684 CPU</li> </ul>"},{"location":"tags/#ooo","title":"ooo","text":"<ul> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e8c\uff1a\u8bbf\u5b58\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> </ul>"},{"location":"tags/#openbmc","title":"openbmc","text":"<ul> <li>\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC</li> </ul>"},{"location":"tags/#openbsd","title":"openbsd","text":"<ul> <li>OpenBSD xonly \u5b9e\u73b0\u539f\u7406</li> </ul>"},{"location":"tags/#openldap","title":"openldap","text":"<ul> <li>\u4f7f\u7528 Docker \u90e8\u7f72 OpenLDAP</li> </ul>"},{"location":"tags/#openmpi","title":"openmpi","text":"<ul> <li>\u5728 Spack \u4e2d\u7528 external \u7684 Slurm \u4f9d\u8d56\u7f16\u8bd1 OpenMPI</li> </ul>"},{"location":"tags/#openocd","title":"openocd","text":"<ul> <li>\u5728 macOS \u70e7\u5199 Artix7 FPGA</li> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> </ul>"},{"location":"tags/#openroad","title":"openroad","text":"<ul> <li>OpenROAD Flow \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#openwrt","title":"openwrt","text":"<ul> <li>Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax</li> <li>OpenWRT \u4e0a\u914d\u7f6e Gandi DDNS</li> <li>\u5728 LEDE\uff08OpenWrt\uff09\u4e0a\u542f\u7528 wpad</li> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> </ul>"},{"location":"tags/#ordering","title":"ordering","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#oryon","title":"oryon","text":"<ul> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#os","title":"os","text":"<ul> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 e1000 \u9a71\u52a8</li> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> <li>rCore \u8f6f\u8def\u7531\u5b9e\u73b0</li> </ul>"},{"location":"tags/#osx","title":"osx","text":"<ul> <li>Screen Capturing Tips in macOS</li> </ul>"},{"location":"tags/#outoforder","title":"outoforder","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> </ul>"},{"location":"tags/#pac","title":"pac","text":"<ul> <li>\u5728 LEDE\uff08OpenWrt\uff09\u4e0a\u542f\u7528 wpad</li> </ul>"},{"location":"tags/#package-manager","title":"package-manager","text":"<ul> <li>\u5728 macOS \u4e0a\u8bd5\u7528 Gentoo/Prefix</li> </ul>"},{"location":"tags/#packaging","title":"packaging","text":"<ul> <li>\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5</li> </ul>"},{"location":"tags/#paging","title":"paging","text":"<ul> <li>VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#pam","title":"pam","text":"<ul> <li>\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1</li> <li>\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55</li> </ul>"},{"location":"tags/#parser","title":"parser","text":"<ul> <li>\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser</li> <li>\u7f16\u5199 010 Editor \u7684 FLV Template</li> </ul>"},{"location":"tags/#parsing","title":"parsing","text":"<ul> <li>\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser</li> </ul>"},{"location":"tags/#passthrough","title":"passthrough","text":"<ul> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#patch","title":"patch","text":"<ul> <li>\u6211\u6b63\u5728\u4f7f\u7528\u7684\u4e24\u4e2a Emacs \u7684 Patch</li> </ul>"},{"location":"tags/#pcb","title":"pcb","text":"<ul> <li>PCB \u7b14\u8bb0</li> </ul>"},{"location":"tags/#pci","title":"pci","text":"<ul> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> </ul>"},{"location":"tags/#pcie","title":"pcie","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> <li>PCIe Bifurcation</li> <li>PCIe \u5b66\u4e60\u7b14\u8bb0</li> <li>VFIO - Virtual Function I/O</li> </ul>"},{"location":"tags/#pdf","title":"pdf","text":"<ul> <li>Unicode En Dash \u5c0f\u5751</li> <li>\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b</li> </ul>"},{"location":"tags/#perc","title":"perc","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#perccli","title":"perccli","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#perf","title":"perf","text":"<ul> <li>Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#performance","title":"performance","text":"<ul> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#perl","title":"perl","text":"<ul> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> </ul>"},{"location":"tags/#php","title":"php","text":"<ul> <li>\u8c03\u6574 Nginx \u548c PHP \u7684\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236</li> </ul>"},{"location":"tags/#physics","title":"physics","text":"<ul> <li>\u7b49\u65f6\u5706</li> </ul>"},{"location":"tags/#ping","title":"ping","text":"<ul> <li>\u7528 multicast \u5730\u5740\u627e\u5230\u540c\u4e00\u7f51\u6bb5\u7684\u4e3b\u673a</li> </ul>"},{"location":"tags/#pinyin","title":"pinyin","text":"<ul> <li>Using chinese pyim</li> </ul>"},{"location":"tags/#pipeline","title":"pipeline","text":"<ul> <li>Skid Buffer</li> </ul>"},{"location":"tags/#plagiarism","title":"plagiarism","text":"<ul> <li>\u7f16\u7a0b\u4f5c\u4e1a\u4e2d\u7684\u5b66\u672f\u8bda\u4fe1</li> </ul>"},{"location":"tags/#pmu","title":"pmu","text":"<ul> <li>Linux \u7684\u6027\u80fd\u5206\u6790\uff08Perf\uff09\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#podman","title":"podman","text":"<ul> <li>Podman \u548c Docker Rootless \u5b9e\u8df5</li> </ul>"},{"location":"tags/#port","title":"port","text":"<ul> <li>Chromium \u6784\u5efa\u4e0e\u79fb\u690d</li> </ul>"},{"location":"tags/#post","title":"post","text":"<ul> <li>Nginx \u5904\u7406 POST \u8bf7\u6c42\u51fa\u73b0 Internal Server Error \u6392\u67e5\u4e00\u5219</li> </ul>"},{"location":"tags/#power","title":"power","text":"<ul> <li>\u5728 ppc64le Linux \u4e0a\u8fd0\u884c Nix</li> <li>IBM Power S822LC(8335-GTB) BMC \u5347\u7ea7</li> </ul>"},{"location":"tags/#poweredge","title":"poweredge","text":"<ul> <li>iDRAC \u5404\u7248\u672c</li> </ul>"},{"location":"tags/#powerpc","title":"powerpc","text":"<ul> <li>\u5728 ppc64le Linux \u4e0a\u8fd0\u884c Nix</li> </ul>"},{"location":"tags/#ppc64le","title":"ppc64le","text":"<ul> <li>\u5728 ppc64le Linux \u4e0a\u8fd0\u884c Nix</li> </ul>"},{"location":"tags/#prediction","title":"prediction","text":"<ul> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e09\uff1a\u524d\u7aef\uff09</li> </ul>"},{"location":"tags/#predictor","title":"predictor","text":"<ul> <li>\u5206\u652f\u9884\u6d4b\u7684 2-taken \u548c 2-ahead</li> </ul>"},{"location":"tags/#preview","title":"preview","text":"<ul> <li>\u9884\u544a Learn-Project 4.0 \u7248</li> </ul>"},{"location":"tags/#prime","title":"prime","text":"<ul> <li>\u5206\u6790\u4e00\u4e2a\u6211\u7b2c\u4e00\u6b21\u89c1\u7684\u7d20\u6570\u6d4b\u8bd5\u51fd\u6570</li> </ul>"},{"location":"tags/#printf","title":"printf","text":"<ul> <li>C/C++ \u6570\u53c2\u6570\u4e2a\u6570\u7684\u7279\u522b\u65b9\u6cd5</li> </ul>"},{"location":"tags/#process","title":"process","text":"<ul> <li>Unix nice</li> </ul>"},{"location":"tags/#programmer","title":"programmer","text":"<ul> <li>\u9ad8\u4e91 FPGA \u8e29\u5751</li> </ul>"},{"location":"tags/#prometheus","title":"prometheus","text":"<ul> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus</li> </ul>"},{"location":"tags/#proxmoxve","title":"proxmoxve","text":"<ul> <li>\u4ece libvirtd \u8fc1\u79fb\u5230 Proxmox VE</li> </ul>"},{"location":"tags/#proxy","title":"proxy","text":"<ul> <li>\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898</li> </ul>"},{"location":"tags/#ps","title":"ps","text":"<ul> <li>\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b</li> </ul>"},{"location":"tags/#pulseview","title":"pulseview","text":"<ul> <li>\u7528 PulseView \u914d\u5408 DSLogic \u8c03\u8bd5 SPI Flash</li> </ul>"},{"location":"tags/#pve","title":"pve","text":"<ul> <li>\u4ece libvirtd \u8fc1\u79fb\u5230 Proxmox VE</li> </ul>"},{"location":"tags/#pvst","title":"pvst","text":"<ul> <li>\u751f\u6210\u6811\u534f\u8bae</li> </ul>"},{"location":"tags/#pxe","title":"pxe","text":"<ul> <li>\u5728 rpi4 \u4e0a\u7528 PXE \u8fd0\u884c Alpine Linux</li> <li>\u5728 Rpi4 \u4e0a\u8fd0\u884c buildroot</li> </ul>"},{"location":"tags/#pyim","title":"pyim","text":"<ul> <li>Using chinese pyim</li> </ul>"},{"location":"tags/#python2","title":"python2","text":"<ul> <li>\u5728 ArchLinux \u4e0a\u7f16\u8bd1 LineageOS for Huawei Angler</li> </ul>"},{"location":"tags/#qcom","title":"qcom","text":"<ul> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> </ul>"},{"location":"tags/#qemu","title":"qemu","text":"<ul> <li>LoongArch \u521d\u5c1d\u8bd5</li> <li>\u4f53\u9a8c Fedora on RISCV</li> <li>\u5728 M1 \u4e0a\u7528 QEMU \u8fd0\u884c Debian \u865a\u62df\u673a</li> <li>\u4ece libvirtd \u8fc1\u79fb\u5230 Proxmox VE</li> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> <li>\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC</li> </ul>"},{"location":"tags/#qkd","title":"qkd","text":"<ul> <li>\u89e3\u91ca BB84 \u534f\u8bae</li> </ul>"},{"location":"tags/#qsfp","title":"qsfp","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#qsgmii","title":"qsgmii","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#qualcomm","title":"qualcomm","text":"<ul> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76</li> </ul>"},{"location":"tags/#quantom","title":"quantom","text":"<ul> <li>\u89e3\u91ca BB84 \u534f\u8bae</li> </ul>"},{"location":"tags/#radare2","title":"radare2","text":"<ul> <li>\u7ed5\u8fc7 GPGMail \u7684\u6fc0\u6d3b\u68c0\u6d4b</li> </ul>"},{"location":"tags/#raid","title":"raid","text":"<ul> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> </ul>"},{"location":"tags/#random","title":"random","text":"<ul> <li>libc++ \u7684 uniform_int_distribution \u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#raspi","title":"raspi","text":"<ul> <li>USB/IP \u5b9e\u8df5</li> </ul>"},{"location":"tags/#rcore","title":"rcore","text":"<ul> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 e1000 \u9a71\u52a8</li> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8</li> <li>\u4ea4\u53c9\u7f16\u8bd1 Nginx 1.14.2 \u5230 RISC-V</li> <li>rCore \u8f6f\u8def\u7531\u5b9e\u73b0</li> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> </ul>"},{"location":"tags/#rdp","title":"rdp","text":"<ul> <li>XRDP \u548c NVIDIA \u663e\u5361\u517c\u5bb9\u6027\u95ee\u9898</li> </ul>"},{"location":"tags/#readunderwrite","title":"readunderwrite","text":"<ul> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> </ul>"},{"location":"tags/#redhat","title":"redhat","text":"<ul> <li>\u5728\u53e4\u8001\u7684 OS \u4e0a\u8fd0\u884c\u4e00\u4e2a\u5e72\u51c0\u7684\u65b0\u7684\u73af\u5883</li> </ul>"},{"location":"tags/#regex","title":"regex","text":"<ul> <li>Grafana Variable \u7684 regex \u8fc7\u6ee4\u65b9\u5f0f</li> </ul>"},{"location":"tags/#register","title":"register","text":"<ul> <li>Skid Buffer</li> </ul>"},{"location":"tags/#release","title":"release","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#remote","title":"remote","text":"<ul> <li>rsyslog \u6536\u96c6\u8fdc\u7a0b\u65e5\u5fd7</li> </ul>"},{"location":"tags/#renaming","title":"renaming","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> </ul>"},{"location":"tags/#rfc","title":"rfc","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> </ul>"},{"location":"tags/#rfc8367","title":"rfc8367","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> </ul>"},{"location":"tags/#rgmii","title":"rgmii","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#rhel","title":"rhel","text":"<ul> <li>\u4e00\u6b21\u4ece RHEL 6 \u5230 CentOS 7 \u7684\u66f4\u65b0</li> </ul>"},{"location":"tags/#riscv","title":"riscv","text":"<ul> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae</li> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5411 Rocket Chip \u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5728 Rocket Chip \u4e0a\u6302\u63a5 TLRAM</li> <li>\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> <li>Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae</li> <li>\u4f53\u9a8c Fedora on RISCV</li> <li>\u4ea4\u53c9\u7f16\u8bd1 Nginx 1.14.2 \u5230 RISC-V</li> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#rm","title":"rm","text":"<ul> <li>\u914d\u7f6e homebridge-broadlink-rm-pro</li> </ul>"},{"location":"tags/#rocketchip","title":"rocketchip","text":"<ul> <li>\u5206\u6790 Rocket Chip \u4e2d Diplomacy \u7cfb\u7edf</li> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u7814\u7a76 Rocket Chip \u7684 BSCAN \u8c03\u8bd5\u539f\u7406</li> <li>\u901a\u8fc7 BSCAN JTAG \u5bf9 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5411 Rocket Chip \u6dfb\u52a0\u81ea\u5b9a\u4e49\u8c03\u8bd5\u4fe1\u53f7</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> <li>\u5728 Rocket Chip \u4e0a\u6302\u63a5 TLRAM</li> </ul>"},{"location":"tags/#rook","title":"rook","text":"<ul> <li>\u5c06 k8s rook ceph \u96c6\u7fa4\u8fc1\u79fb\u5230 cephadm</li> <li>\u901a\u8fc7 rook \u5728 k8s \u4e0a\u90e8\u7f72 ceph \u96c6\u7fa4</li> </ul>"},{"location":"tags/#rootless","title":"rootless","text":"<ul> <li>Podman \u548c Docker Rootless \u5b9e\u8df5</li> </ul>"},{"location":"tags/#route53","title":"route53","text":"<ul> <li>\u7528 certbot \u7533\u8bf7 route53 \u4e0a\u7684\u57df\u540d\u7684 LetsEncrypt \u8bc1\u4e66\u5e76\u4e0a\u4f20\u5230 IAM</li> </ul>"},{"location":"tags/#router","title":"router","text":"<ul> <li>\u5e38\u7528\u4ea4\u6362\u673a\u547d\u4ee4</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff082\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff083\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668</li> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> <li>rCore \u8f6f\u8def\u7531\u5b9e\u73b0</li> </ul>"},{"location":"tags/#router-on-fpga","title":"router-on-fpga","text":"<ul> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff082\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668\uff083\uff09</li> <li>\u5728 FPGA \u4e0a\u5b9e\u73b0\u8def\u7531\u5668</li> </ul>"},{"location":"tags/#routing","title":"routing","text":"<ul> <li>\u5728 WireGuard \u6784\u5efa\u7684 Overlay Network \u4e0a\u8dd1 babel \u8def\u7531\u534f\u8bae</li> </ul>"},{"location":"tags/#rpi","title":"rpi","text":"<ul> <li>\u5728 rpi4 \u4e0a\u7528 PXE \u8fd0\u884c Alpine Linux</li> <li>\u5728 Rpi4 \u4e0a\u8fd0\u884c buildroot</li> </ul>"},{"location":"tags/#rpi3","title":"rpi3","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#rpi4","title":"rpi4","text":"<ul> <li>\u5728 rpi4 \u4e0a\u7528 PXE \u8fd0\u884c Alpine Linux</li> <li>\u5728 Rpi4 \u4e0a\u8fd0\u884c buildroot</li> </ul>"},{"location":"tags/#rstp","title":"rstp","text":"<ul> <li>\u751f\u6210\u6811\u534f\u8bae</li> </ul>"},{"location":"tags/#rsyslog","title":"rsyslog","text":"<ul> <li>rsyslog \u6536\u96c6\u8fdc\u7a0b\u65e5\u5fd7</li> </ul>"},{"location":"tags/#rtl8822bu","title":"rtl8822bu","text":"<ul> <li>TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5</li> </ul>"},{"location":"tags/#rtlsdr","title":"rtlsdr","text":"<ul> <li>\u5728 GNURadio Companion \u4e2d\u6536\u542c FM \u5e7f\u64ad</li> </ul>"},{"location":"tags/#rtmp","title":"rtmp","text":"<ul> <li>\u7528 Nginx \u4f5c\u4e3a RTMP \u670d\u52a1\u5668\u5e76\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1</li> </ul>"},{"location":"tags/#rust","title":"rust","text":"<ul> <li>\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer</li> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 e1000 \u9a71\u52a8</li> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> <li>Rust \u83b7\u53d6 Linker Script \u4e2d\u7684\u5730\u5740</li> <li>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 Decaf LSP</li> <li>\u7528 Rust Procedure Macro \u5b9e\u73b0 GLL Parser</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> <li>\u7528 Nix \u7f16\u8bd1 Rust \u9879\u76ee</li> </ul>"},{"location":"tags/#rust-analyzer","title":"rust-analyzer","text":"<ul> <li>\u5728 arm64 \u4e0a\u4f7f\u7528 rust-analyzer</li> </ul>"},{"location":"tags/#rustc","title":"rustc","text":"<ul> <li>Rust \u5728 M1 \u4e0a\u7684 Code Signing \u95ee\u9898\u548c\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5</li> </ul>"},{"location":"tags/#rv64","title":"rv64","text":"<ul> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> </ul>"},{"location":"tags/#rvv","title":"rvv","text":"<ul> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#ryzen","title":"ryzen","text":"<ul> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#saltedfishpi","title":"saltedfishpi","text":"<ul> <li>\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM</li> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> </ul>"},{"location":"tags/#samba","title":"samba","text":"<ul> <li>\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55</li> </ul>"},{"location":"tags/#sampling","title":"sampling","text":"<ul> <li>libc++ \u7684 uniform_int_distribution \u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#samsung","title":"samsung","text":"<ul> <li>\u4e09\u661f Exynos CPU \u5fae\u67b6\u6784\u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"tags/#sas","title":"sas","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> </ul>"},{"location":"tags/#sata","title":"sata","text":"<ul> <li>\u786c\u76d8\u76f8\u5173\u7684\u6982\u5ff5</li> </ul>"},{"location":"tags/#sbt","title":"sbt","text":"<ul> <li>\u5728 sbt \u4e2d fork \u5e76\u4e14\u5e76\u884c\u8fd0\u884c\u6d4b\u8bd5</li> </ul>"},{"location":"tags/#scala","title":"scala","text":"<ul> <li>\u5728 sbt \u4e2d fork \u5e76\u4e14\u5e76\u884c\u8fd0\u884c\u6d4b\u8bd5</li> </ul>"},{"location":"tags/#scaling","title":"scaling","text":"<ul> <li>Gnome \u7684 Fractional Scaling</li> </ul>"},{"location":"tags/#scheduler","title":"scheduler","text":"<ul> <li>Linux \u5927\u5c0f\u6838\u7684\u8c03\u5ea6\u7b97\u6cd5\u63a2\u7a76</li> </ul>"},{"location":"tags/#schematic","title":"schematic","text":"<ul> <li>PCB \u7b14\u8bb0</li> </ul>"},{"location":"tags/#school","title":"school","text":"<ul> <li>Start next term tomorrow</li> </ul>"},{"location":"tags/#sco","title":"sco","text":"<ul> <li>SCO OpenServer 5.0.7 \u865a\u62df\u673a\u5b89\u88c5</li> <li>SCO OpenServer 6.0.0 \u865a\u62df\u673a\u5b89\u88c5</li> </ul>"},{"location":"tags/#scp","title":"scp","text":"<ul> <li>\u7528 jailkit \u9650\u5236\u7528\u6237\u4ec5 scp</li> </ul>"},{"location":"tags/#scraper","title":"scraper","text":"<ul> <li>Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009</li> </ul>"},{"location":"tags/#sd-card","title":"sd card","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> </ul>"},{"location":"tags/#sdram","title":"sdram","text":"<ul> <li>DRAM \u7684\u62d3\u6251\u548c\u8bad\u7ec3</li> </ul>"},{"location":"tags/#secoder","title":"secoder","text":"<ul> <li>\u90e8\u7f72 adminMongo \u7684 Docker \u955c\u50cf</li> <li>\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0</li> </ul>"},{"location":"tags/#security","title":"security","text":"<ul> <li>News</li> <li>OpenBSD xonly \u5b9e\u73b0\u539f\u7406</li> </ul>"},{"location":"tags/#serial","title":"serial","text":"<ul> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> </ul>"},{"location":"tags/#session","title":"session","text":"<ul> <li>\u6700\u8fd1\u5199 Node.js \u9047\u5230\u7684\u82e5\u5e72\u5751</li> </ul>"},{"location":"tags/#sfp","title":"sfp","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#sfpi","title":"sfpi","text":"<ul> <li>\u5411\u54b8\u9c7c\u6d3e\u5199\u5165 ArchlinuxARM</li> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> <li>USB/IP \u5b9e\u8df5</li> </ul>"},{"location":"tags/#sfs","title":"sfs","text":"<ul> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> </ul>"},{"location":"tags/#sgmii","title":"sgmii","text":"<ul> <li>\u4ee5\u592a\u7f51\u7684\u7269\u7406\u63a5\u53e3</li> </ul>"},{"location":"tags/#share","title":"share","text":"<ul> <li>Good software engineering rules</li> <li>Interesting links</li> <li>Some interesting links</li> </ul>"},{"location":"tags/#shell","title":"shell","text":"<ul> <li>\u5199\u4e00\u4e2a bash zsh \u548c fish \u90fd\u80fd\u8dd1\u7684\u811a\u672c</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> </ul>"},{"location":"tags/#sigrok","title":"sigrok","text":"<ul> <li>\u7528 PulseView \u914d\u5408 DSLogic \u8c03\u8bd5 SPI Flash</li> </ul>"},{"location":"tags/#sigs","title":"sigs","text":"<ul> <li>\u8f76\u4e8b\u4e00\u5219</li> </ul>"},{"location":"tags/#simulation","title":"simulation","text":"<ul> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> <li>\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c Vivado \u4eff\u771f</li> </ul>"},{"location":"tags/#site","title":"site","text":"<ul> <li>\u57df\u540d\u5df2\u7ecf\u8fc1\u79fb\u5230 jiege.ch</li> <li>\u628a\u8bc4\u8bba\u7cfb\u7edf\u4ece Disqus \u8fc1\u79fb\u5230 Giscus</li> <li>\u628a\u535a\u5ba2\u751f\u6210\u5668\u4ece Hugo \u8fc1\u79fb\u5230 Mkdocs</li> <li>\u628a\u535a\u5ba2\u751f\u6210\u5668\u4ece Jekyll \u8fc1\u79fb\u5230 Hugo</li> </ul>"},{"location":"tags/#skid","title":"skid","text":"<ul> <li>Skid Buffer</li> </ul>"},{"location":"tags/#slacc","title":"slacc","text":"<ul> <li>\u5728 macOS \u4e0a TAP Interface \u4e0a\u542f\u7528 IPv6 \u81ea\u52a8\u914d\u7f6e</li> </ul>"},{"location":"tags/#slurm","title":"slurm","text":"<ul> <li>\u5728\u53e4\u8001\u7684 OS \u4e0a\u8fd0\u884c\u4e00\u4e2a\u5e72\u51c0\u7684\u65b0\u7684\u73af\u5883</li> <li>\u5728 Spack \u4e2d\u7528 external \u7684 Slurm \u4f9d\u8d56\u7f16\u8bd1 OpenMPI</li> </ul>"},{"location":"tags/#smart","title":"smart","text":"<ul> <li>\u5728 macOS \u4e0a\u8bfb\u53d6\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T. \u4fe1\u606f</li> </ul>"},{"location":"tags/#smartmontools","title":"smartmontools","text":"<ul> <li>\u5728 macOS \u4e0a\u8bfb\u53d6\u79fb\u52a8\u786c\u76d8\u7684 S.M.A.R.T. \u4fe1\u606f</li> </ul>"},{"location":"tags/#snmp","title":"snmp","text":"<ul> <li>\u4e3a Cisco WLC \u914d\u7f6e Telegraf</li> </ul>"},{"location":"tags/#softwarengineering","title":"softwarengineering","text":"<ul> <li>\u8f6f\u5de5\u5e73\u53f0\u8e29\u5751\u8bb0</li> </ul>"},{"location":"tags/#solaris","title":"solaris","text":"<ul> <li>Transport Layer Interface \u8003\u53e4</li> <li>Solaris 11.4 \u5b89\u88c5</li> </ul>"},{"location":"tags/#sort","title":"sort","text":"<ul> <li>Locale \u5f71\u54cd\u6392\u5e8f\u7684\u7279\u6b8a\u526f\u4f5c\u7528</li> </ul>"},{"location":"tags/#spa","title":"spa","text":"<ul> <li>mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9</li> </ul>"},{"location":"tags/#spack","title":"spack","text":"<ul> <li>\u5728 Spack \u4e2d\u7528 external \u7684 Slurm \u4f9d\u8d56\u7f16\u8bd1 OpenMPI</li> </ul>"},{"location":"tags/#spec","title":"spec","text":"<ul> <li>SPEC CPU 2006 \u6027\u80fd\u6d4b\u8bd5</li> </ul>"},{"location":"tags/#spi","title":"spi","text":"<ul> <li>\u4f7f\u7528 JLink \u64cd\u4f5c SPI NOR Flash</li> <li>SPI \u534f\u8bae</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> </ul>"},{"location":"tags/#spike","title":"spike","text":"<ul> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> </ul>"},{"location":"tags/#spinalhdl","title":"spinalhdl","text":"<ul> <li>Skid Buffer</li> </ul>"},{"location":"tags/#sqlite","title":"sqlite","text":"<ul> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> </ul>"},{"location":"tags/#sram","title":"sram","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u5f02\u6b65 SRAM \u65f6\u5e8f</li> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> </ul>"},{"location":"tags/#ssh","title":"ssh","text":"<ul> <li>\u901a\u8fc7 SSH \u96a7\u9053\u8fde\u63a5 ADB \u548c Android \u8bbe\u5907</li> </ul>"},{"location":"tags/#sslvpn","title":"sslvpn","text":"<ul> <li>\u4e00\u4e2a\u4ee3\u66ff Pulse Secure \u5ba2\u6237\u7aef\u7684\u5de5\u5177</li> </ul>"},{"location":"tags/#sssd","title":"sssd","text":"<ul> <li>\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1</li> </ul>"},{"location":"tags/#stanford","title":"stanford","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff083\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff084\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff085\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff086\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff087\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff088\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff089\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#starttls","title":"starttls","text":"<ul> <li>\u4f7f\u7528 SSSD \u7684 LDAP \u8ba4\u8bc1</li> </ul>"},{"location":"tags/#static","title":"static","text":"<ul> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> <li>\u9759\u6001\u7f16\u8bd1 ipmitool</li> </ul>"},{"location":"tags/#stl","title":"stl","text":"<ul> <li>libc++ \u7684 uniform_int_distribution \u6027\u80fd\u95ee\u9898</li> </ul>"},{"location":"tags/#stp","title":"stp","text":"<ul> <li>\u751f\u6210\u6811\u534f\u8bae</li> </ul>"},{"location":"tags/#stretch","title":"stretch","text":"<ul> <li>\u7528 MuSSH \u5feb\u901f\u5bf9\u591a\u53f0\u673a\u5668\u8fdb\u884c\u8f6f\u4ef6\u5305\u5347\u7ea7</li> </ul>"},{"location":"tags/#study","title":"study","text":"<ul> <li>The end of senior two</li> </ul>"},{"location":"tags/#subtitles","title":"subtitles","text":"<ul> <li>Listen and write down subtitles of Cameron's speech</li> </ul>"},{"location":"tags/#sunway","title":"sunway","text":"<ul> <li>Sunway \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> </ul>"},{"location":"tags/#surface","title":"surface","text":"<ul> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> </ul>"},{"location":"tags/#sv2v","title":"sv2v","text":"<ul> <li>\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868</li> </ul>"},{"location":"tags/#svf","title":"svf","text":"<ul> <li>\u5bfc\u51fa Vivado \u4e0b\u8f7d Bitstream \u7684 SVF \u6587\u4ef6</li> </ul>"},{"location":"tags/#sw26010","title":"sw26010","text":"<ul> <li>Sunway \u5904\u7406\u5668\u67b6\u6784\u5206\u6790</li> </ul>"},{"location":"tags/#switch","title":"switch","text":"<ul> <li>\u5e38\u7528\u4ea4\u6362\u673a\u547d\u4ee4</li> </ul>"},{"location":"tags/#symbols","title":"symbols","text":"<ul> <li>\u5728 Big Sur(M1) \u4e0a\u89e3\u51b3 LaTeX \u627e\u4e0d\u5230\u6977\u4f53\u5b57\u4f53\u7684\u95ee\u9898</li> <li>COMMON \u7b26\u53f7</li> </ul>"},{"location":"tags/#synopsys","title":"synopsys","text":"<ul> <li>Synopsys Design Compiler \u7efc\u5408\u5b9e\u8df5</li> </ul>"},{"location":"tags/#synthesis","title":"synthesis","text":"<ul> <li>Synopsys Design Compiler \u7efc\u5408\u5b9e\u8df5</li> <li>OpenROAD Flow \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#syscall","title":"syscall","text":"<ul> <li>\u5b9e\u73b0\u7f51\u7edc\u7684 syscall</li> <li>\u5728 rCore \u4e0a\u8fd0\u884c nginx</li> </ul>"},{"location":"tags/#systemd-networkd","title":"systemd-networkd","text":"<ul> <li>Wireguard \u96a7\u9053\u642d\u5efa</li> </ul>"},{"location":"tags/#systemd-nspawn","title":"systemd-nspawn","text":"<ul> <li>\u901a\u8fc7 systemd-run \u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4</li> </ul>"},{"location":"tags/#systemd-run","title":"systemd-run","text":"<ul> <li>\u901a\u8fc7 systemd-run \u76f4\u63a5\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4</li> </ul>"},{"location":"tags/#sysv","title":"sysv","text":"<ul> <li>Transport Layer Interface \u8003\u53e4</li> </ul>"},{"location":"tags/#tap","title":"tap","text":"<ul> <li>\u5728 macOS \u4e0a TAP Interface \u4e0a\u542f\u7528 IPv6 \u81ea\u52a8\u914d\u7f6e</li> <li>\u5728 macOS \u4e0b\u5b9e\u73b0 GRETAP</li> </ul>"},{"location":"tags/#tar","title":"tar","text":"<ul> <li>Tar \u6587\u4ef6\u683c\u5f0f</li> </ul>"},{"location":"tags/#tc","title":"tc","text":"<ul> <li>\u7f16\u5199 eBPF \u7a0b\u5e8f\u548c\u5229\u7528 HyperLogLog \u7edf\u8ba1\u5305\u7684\u4fe1\u606f</li> </ul>"},{"location":"tags/#tcl","title":"tcl","text":"<ul> <li>\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c Vivado \u4eff\u771f</li> </ul>"},{"location":"tags/#teaching","title":"teaching","text":"<ul> <li>\u300c\u6559\u5b66\u300dACE \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae</li> <li>\u300c\u6559\u5b66\u300d\u5f02\u6b65 SRAM \u65f6\u5e8f</li> <li>\u300c\u6559\u5b66\u300d\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u5206\u6790</li> <li>\u300c\u6559\u5b66\u300dDRAM \u7ed3\u6784\u548c\u7279\u6027</li> <li>\u300c\u6559\u5b66\u300d\u5185\u5b58\u8ba4\u8bc1\u7b97\u6cd5</li> <li>\u300c\u6559\u5b66\u300dRISC-V Debug \u534f\u8bae</li> <li>\u300c\u6559\u5b66\u300dWishbone \u603b\u7ebf\u534f\u8bae</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> </ul>"},{"location":"tags/#telegraf","title":"telegraf","text":"<ul> <li>\u4e3a Cisco WLC \u914d\u7f6e Telegraf</li> <li>\u914d\u7f6e Grafana+InfluxDB+Telegraf \u5e76\u6dfb\u52a0 MIIO \u6570\u636e\u6765\u6e90</li> <li>Grafana \u4e2d\u53ef\u89c6\u5316 Ping \u65f6\u628a Timeout \u663e\u793a\u4e3a\u6307\u5b9a\u503c</li> <li>Grafana \u53ef\u89c6\u5316\u5b9e\u8df5\uff1a\u6e05\u534e\u5927\u5b66 2018 \u5e74\u5ea6\u4eba\u7269\u8bc4\u9009</li> <li>\u914d\u7f6e homebridge-mi-aqara \u5e76\u6dfb\u52a0\u4e3a telegraf \u7684\u6570\u636e\u6e90</li> </ul>"},{"location":"tags/#tencentcloud","title":"tencentcloud","text":"<ul> <li>\u5728 k8s \u4e2d\u90e8\u7f72 code-server</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Drone \u7528\u4e8e CI</li> <li>\u5728 k8s \u5185\u7528 Cert Manager \u914d\u5408 Nginx Ingress Controller \u914d\u7f6e Let's Encrypt HTTPS \u8bc1\u4e66</li> <li>\u5728 k8s \u4e2d\u90e8\u7f72 Prometheus</li> <li>\u4f53\u9a8c Tencent Kubernetes Engine</li> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> </ul>"},{"location":"tags/#terminal","title":"terminal","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#testing","title":"testing","text":"<ul> <li>\u5728 sbt \u4e2d fork \u5e76\u4e14\u5e76\u884c\u8fd0\u884c\u6d4b\u8bd5</li> </ul>"},{"location":"tags/#tex","title":"tex","text":"<ul> <li>\u4ece TeX \u5230 PDF \u7684\u8fc7\u7a0b</li> </ul>"},{"location":"tags/#thuctf","title":"thuctf","text":"<ul> <li>THUCTF 2018 \u548c Teaser Dragon CTF 2018 \u5c0f\u8bb0</li> </ul>"},{"location":"tags/#thuwc","title":"thuwc","text":"<ul> <li>THUWC 2019 \u5c0f\u8bb0</li> </ul>"},{"location":"tags/#tilelink","title":"tilelink","text":"<ul> <li>TileLink \u603b\u7ebf\u534f\u8bae\u5206\u6790</li> </ul>"},{"location":"tags/#timemachine","title":"timemachine","text":"<ul> <li>Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999</li> </ul>"},{"location":"tags/#timezone","title":"timezone","text":"<ul> <li>invalid date \u62a5\u9519\u4e0e\u65f6\u533a\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#timing","title":"timing","text":"<ul> <li>\u300c\u6559\u5b66\u300d\u5f02\u6b65 SRAM \u65f6\u5e8f</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> </ul>"},{"location":"tags/#tinc","title":"tinc","text":"<ul> <li>\u5728 macOS \u548c Linux \u4e4b\u95f4\u642d\u5efa tinc \u7f51\u7edc</li> </ul>"},{"location":"tags/#tips","title":"tips","text":"<ul> <li>News</li> <li>Tips on git shallow clone</li> <li>Screen Capturing Tips in macOS</li> </ul>"},{"location":"tags/#tke","title":"tke","text":"<ul> <li>\u5728 TKE \u4e0a\u914d\u7f6e\u4e0d\u4f7f\u7528 LB \u7684 Nginx Ingress Controller</li> </ul>"},{"location":"tags/#tli","title":"tli","text":"<ul> <li>Transport Layer Interface \u8003\u53e4</li> </ul>"},{"location":"tags/#tokio","title":"tokio","text":"<ul> <li>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 Decaf LSP</li> </ul>"},{"location":"tags/#tomasulo","title":"tomasulo","text":"<ul> <li>\u6d45\u8c08\u4e71\u5e8f\u6267\u884c CPU\uff08\u4e00\uff1a\u4e71\u5e8f\uff09</li> </ul>"},{"location":"tags/#toolchain","title":"toolchain","text":"<ul> <li>LoongArch64 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#tplink","title":"tplink","text":"<ul> <li>TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5</li> </ul>"},{"location":"tags/#traefik","title":"traefik","text":"<ul> <li>\u89e3\u51b3 k3s \u4e2d traefik \u4e0d\u4f1a\u8f6c\u53d1 X-Forwarded-For \u7b49\u5934\u90e8\u7684\u95ee\u9898</li> </ul>"},{"location":"tags/#transaction","title":"transaction","text":"<ul> <li>\u5347\u7ea7 MongoDB \u5230 4.0</li> </ul>"},{"location":"tags/#tsinghua","title":"tsinghua","text":"<ul> <li>\u8f76\u4e8b\u4e00\u5219</li> <li>\u4e00\u4e2a\u4ee3\u66ff Pulse Secure \u5ba2\u6237\u7aef\u7684\u5de5\u5177</li> <li>\u56de\u987e\u6628\u5929\u7684\u9152\u4e95\u77e5\u8bc6\u7ade\u8d5b</li> </ul>"},{"location":"tags/#tso","title":"tso","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> </ul>"},{"location":"tags/#tun","title":"tun","text":"<ul> <li>Wireguard \u96a7\u9053\u642d\u5efa</li> </ul>"},{"location":"tags/#tuntaposx","title":"tuntaposx","text":"<ul> <li>\u5728 macOS \u4e0a TAP Interface \u4e0a\u542f\u7528 IPv6 \u81ea\u52a8\u914d\u7f6e</li> <li>\u5728 macOS \u4e0b\u5b9e\u73b0 GRETAP</li> </ul>"},{"location":"tags/#twitter","title":"twitter","text":"<ul> <li>News</li> <li>Some interesting links</li> <li>Unix nice</li> </ul>"},{"location":"tags/#tyche","title":"tyche","text":"<ul> <li>\u7528 CPUID \u83b7\u53d6\u8bc4\u6d4b\u673a\u5668\u7684 CPU</li> </ul>"},{"location":"tags/#typea","title":"typea","text":"<ul> <li>MIFARE Classic \u4e0a\u914d\u7f6e NDEF</li> </ul>"},{"location":"tags/#tzdata","title":"tzdata","text":"<ul> <li>invalid date \u62a5\u9519\u4e0e\u65f6\u533a\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#u2f","title":"u2f","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#uarch-review","title":"uarch-review","text":"<ul> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>Apple M1 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>ARM Neoverse V2 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> <li>CPU \u5fae\u67b6\u6784\u9006\u5411\u65b9\u6cd5\u5b66</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#uart","title":"uart","text":"<ul> <li>\u5728\u8354\u679d\u7cd6\uff08Lichee Tang\uff09\u4e0a\u521d\u6b21\u4f53\u9a8c FPGA</li> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> </ul>"},{"location":"tags/#uartlite","title":"uartlite","text":"<ul> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> </ul>"},{"location":"tags/#ub","title":"ub","text":"<ul> <li>IP \u524d\u7f00\u8f6c\u6362\u4e0a\u610f\u5916\u9047\u5230\u7684 Undefined Behavior</li> </ul>"},{"location":"tags/#ubi","title":"ubi","text":"<ul> <li>\u5347\u7ea7 Linksys E8450 \u7684 OpenWRT \u7cfb\u7edf\u5230 UBI</li> </ul>"},{"location":"tags/#uboot","title":"uboot","text":"<ul> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u54b8\u9c7c\u6d3e\u7684\u542f\u52a8\u914d\u7f6e</li> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> <li>Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae</li> </ul>"},{"location":"tags/#ubuntu","title":"ubuntu","text":"<ul> <li>Linux on Android \u7b80\u5355\u6559\u7a0b</li> <li>\u5728 Ubuntu \u4e0a\u8de8\u7248\u672c\u8fc1\u79fb MongoDB</li> </ul>"},{"location":"tags/#udp","title":"udp","text":"<ul> <li>IP \u548c UDP Checksum \u7684\u589e\u91cf\u66f4\u65b0\u95ee\u9898</li> </ul>"},{"location":"tags/#uefi","title":"uefi","text":"<ul> <li>Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae</li> </ul>"},{"location":"tags/#unicode","title":"unicode","text":"<ul> <li>Unicode En Dash \u5c0f\u5751</li> </ul>"},{"location":"tags/#unix","title":"unix","text":"<ul> <li>Transport Layer Interface \u8003\u53e4</li> <li>Unix nice</li> <li>AIX 7.2 \u865a\u62df\u673a\u5b89\u88c5</li> <li>SCO OpenServer 5.0.7 \u865a\u62df\u673a\u5b89\u88c5</li> <li>SCO OpenServer 6.0.0 \u865a\u62df\u673a\u5b89\u88c5</li> <li>UnixWare 7.1.4 \u865a\u62df\u673a\u5b89\u88c5</li> </ul>"},{"location":"tags/#unixware","title":"unixware","text":"<ul> <li>SCO OpenServer 5.0.7 \u865a\u62df\u673a\u5b89\u88c5</li> <li>SCO OpenServer 6.0.0 \u865a\u62df\u673a\u5b89\u88c5</li> <li>UnixWare 7.1.4 \u865a\u62df\u673a\u5b89\u88c5</li> </ul>"},{"location":"tags/#upgrade","title":"upgrade","text":"<ul> <li>\u4e00\u6b21\u4ece RHEL 6 \u5230 CentOS 7 \u7684\u66f4\u65b0</li> </ul>"},{"location":"tags/#upnp","title":"upnp","text":"<ul> <li>\u5229\u7528 UPnP \u534f\u8bae\u8fdb\u884c mosh NAT \u7a7f\u900f\u7684\u7814\u7a76</li> </ul>"},{"location":"tags/#usb","title":"usb","text":"<ul> <li>FIDO U2F\u3001FIDO2 \u548c CTAP \u7684\u5173\u7cfb</li> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> </ul>"},{"location":"tags/#usbip","title":"usbip","text":"<ul> <li>USB/IP \u6a21\u62df USB \u8bbe\u5907</li> <li>USB/IP \u5b9e\u8df5</li> </ul>"},{"location":"tags/#vbst","title":"vbst","text":"<ul> <li>\u751f\u6210\u6811\u534f\u8bae</li> </ul>"},{"location":"tags/#vcsa","title":"vcsa","text":"<ul> <li>\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7</li> <li>\u5728 VMware ESXi \u4e0a\u90e8\u7f72 vCSA \u5b9e\u8df5</li> </ul>"},{"location":"tags/#vcu128","title":"vcu128","text":"<ul> <li>\u79fb\u690d\u7cfb\u7edf\u5230 Rocket Chip on VCU128</li> <li>\u901a\u8fc7 JTAG \u5bf9 VCU128 \u4e0a\u7684 Rocket Chip \u8fdb\u884c\u8c03\u8bd5</li> </ul>"},{"location":"tags/#vector","title":"vector","text":"<ul> <li>RISC-V Vector 1.0 \u5de5\u5177\u94fe\u6784\u5efa</li> </ul>"},{"location":"tags/#verilator","title":"verilator","text":"<ul> <li>\u5355\u6838\u5904\u7406\u5668\u7684\u534f\u540c\u4eff\u771f</li> <li>Verilog \u521d\u4f53\u9a8c</li> </ul>"},{"location":"tags/#verilog","title":"verilog","text":"<ul> <li>Chisel3 Cookbook</li> <li>firtool \u5c1d\u8bd5</li> <li>\u5728\u8354\u679d\u7cd6\uff08Lichee Tang\uff09\u4e0a\u521d\u6b21\u4f53\u9a8c FPGA</li> <li>\u5728 Vivado \u4e2d\u5bf9 chisel3 \u4ea7\u751f\u7684 verilog \u4ee3\u7801\u4eff\u771f</li> <li>\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c Vivado \u4eff\u771f</li> <li>Verilog \u521d\u4f53\u9a8c</li> </ul>"},{"location":"tags/#vfio","title":"vfio","text":"<ul> <li>VFIO - Virtual Function I/O</li> </ul>"},{"location":"tags/#vim","title":"vim","text":"<ul> <li>News</li> <li>Some interesting links</li> <li>\u5728 Xcode 9 \u4e0a\u542f\u7528 Vim \u6a21\u62df\uff08XVim 2\uff09</li> <li>\u5b9e\u73b0 VSCodeVim \u4e2d\u652f\u6301\u4e2d\u6587\u5206\u8bcd\u7684\u5355\u8bcd\u79fb\u52a8</li> </ul>"},{"location":"tags/#vipt","title":"vipt","text":"<ul> <li>VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb</li> </ul>"},{"location":"tags/#virtio","title":"virtio","text":"<ul> <li>\u4f7f\u7528 Rust \u5b9e\u73b0 VirtIO \u9a71\u52a8</li> </ul>"},{"location":"tags/#virtmanager","title":"virtmanager","text":"<ul> <li>\u5728 libvirt \u4e2d\u8fd0\u884c RISC-V \u865a\u62df\u673a</li> </ul>"},{"location":"tags/#virtualbox","title":"virtualbox","text":"<ul> <li>\u5728 macOS \u7684 VirtualBox \u4e0a\u4ece USB \u542f\u52a8</li> </ul>"},{"location":"tags/#visualization","title":"visualization","text":"<ul> <li>\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7</li> </ul>"},{"location":"tags/#vivado","title":"vivado","text":"<ul> <li>\u5728 Vivado \u4e2d\u5bf9 chisel3 \u4ea7\u751f\u7684 verilog \u4ee3\u7801\u4eff\u771f</li> <li>\u5bfc\u51fa Vivado \u4e0b\u8f7d Bitstream \u7684 SVF \u6587\u4ef6</li> <li>\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c Vivado \u4eff\u771f</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> <li>How a Linux 6.2.13 BUG stops Vivado from recognizing FPGA</li> <li>Linux 6.2.13 \u5f15\u5165\u7684 BUG \u5bfc\u81f4 Vivado \u65e0\u6cd5\u8bc6\u522b FPGA</li> </ul>"},{"location":"tags/#vlan","title":"vlan","text":"<ul> <li>\u4f7f\u7528 Cisco AC + AP \u7ec4\u5408\u642d\u5efa\u7f51\u7edc\u5b9e\u8df5</li> </ul>"},{"location":"tags/#vm","title":"vm","text":"<ul> <li>\u5728 M1 \u4e0a\u8fd0\u884c Windows ARM \u865a\u62df\u673a</li> </ul>"},{"location":"tags/#vmware","title":"vmware","text":"<ul> <li>\u5728\u88f8\u673a\u4e0a\u90e8\u7f72 ESXi \u548c vCSA 7</li> <li>\u5728 VMware ESXi \u4e0a\u90e8\u7f72 vCSA \u5b9e\u8df5</li> <li>ESXi \u914d\u7f6e LACP \u94fe\u8def\u805a\u5408</li> <li>ESXi \u5e38\u7528\u4fe1\u606f</li> <li>\u5728 ESXi \u4e2d\u7528 PERCCli \u6362 RAID \u4e2d\u7684\u76d8</li> <li>\u4f7f\u7528 Nginx \u8f6c\u53d1 VMware ESXi</li> <li>\u5728 M1 \u4e0a\u8fd0\u884c Windows ARM \u865a\u62df\u673a</li> <li>\u5728 macOS \u4e0a\u521b\u5efa ESP \u955c\u50cf\u6587\u4ef6</li> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#vs","title":"vs","text":"<ul> <li>\u518d\u6b21\u5410\u69fd VS \u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> <li>\u5173\u4e8e scanf \u548c scanf_s \u7684\u95ee\u9898</li> </ul>"},{"location":"tags/#vscode","title":"vscode","text":"<ul> <li>\u5728 k8s \u4e2d\u90e8\u7f72 code-server</li> <li>\u5728 FreeBSD \u4e0a\u8fd0\u884c code-server</li> <li>\u5b9e\u73b0 VSCodeVim \u4e2d\u652f\u6301\u4e2d\u6587\u5206\u8bcd\u7684\u5355\u8bcd\u79fb\u52a8</li> </ul>"},{"location":"tags/#vscodevim","title":"vscodevim","text":"<ul> <li>\u5b9e\u73b0 VSCodeVim \u4e2d\u652f\u6301\u4e2d\u6587\u5206\u8bcd\u7684\u5355\u8bcd\u79fb\u52a8</li> </ul>"},{"location":"tags/#wayland","title":"wayland","text":"<ul> <li>Gnome \u7684 Fractional Scaling</li> </ul>"},{"location":"tags/#wc","title":"wc","text":"<ul> <li>THUWC 2019 \u5c0f\u8bb0</li> </ul>"},{"location":"tags/#wch","title":"wch","text":"<ul> <li>\u8bd5\u7528\u6c81\u6052 CH32V307 \u8bc4\u4f30\u677f</li> </ul>"},{"location":"tags/#website","title":"website","text":"<ul> <li>jiege.ch \u505c\u7528</li> </ul>"},{"location":"tags/#wechat","title":"wechat","text":"<ul> <li>\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e</li> </ul>"},{"location":"tags/#weeklysharing","title":"weeklysharing","text":"<ul> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 10 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 11 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 12 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 13 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 14 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 15 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 16 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 17 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 18 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 19 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 2 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 20 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 21 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 22 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 23 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 24 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 25 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 26 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 27 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 28 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 29 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 3 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 30 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 31 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 32 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 33 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 34 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 35 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 36 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 37 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 38 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 39 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 4 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 40 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 41 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 42 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 43 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 44 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 45 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 46 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 47 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 48 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 49 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 5 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 50 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 51 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 52 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 53 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 54 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 55 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 56 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 6 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 7 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 8 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 9 \u671f</li> <li>\u6bcf\u5468\u5206\u4eab\u7b2c 1 \u671f</li> </ul>"},{"location":"tags/#wifi","title":"wifi","text":"<ul> <li>Linksys E8450 OpenWRT \u914d\u7f6e w/ 802.11ax</li> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> <li>802.11 \u5b66\u4e60</li> <li>ETC \u6bd4\u8d5b\u65e0\u7ebf\u7f51\u7edc\u642d\u5efa\u5c0f\u8bb0</li> <li>\u4f7f\u7528 Cisco AC + AP \u7ec4\u5408\u642d\u5efa\u7f51\u7edc\u5b9e\u8df5</li> <li>TP-Link Archer T4U V3 Linux \u9a71\u52a8\u5b89\u88c5</li> <li>MacBookPro 14,3 Wi-Fi \u9a71\u52a8\u95ee\u9898\u89e3\u51b3\u65b9\u6848</li> <li>\u534e\u4e3a\u968f\u884c WiFi 2 mini \u5f00\u7bb1</li> </ul>"},{"location":"tags/#wiki","title":"wiki","text":"<ul> <li>\u4e00\u4e2a\u641e\u7b11\u7684\u4f38\u5c55\u6811\u7684 Wiki</li> </ul>"},{"location":"tags/#win11","title":"win11","text":"<ul> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> </ul>"},{"location":"tags/#winbind","title":"winbind","text":"<ul> <li>\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55</li> </ul>"},{"location":"tags/#windows","title":"windows","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> <li>\u5728 M1 \u4e0a\u8fd0\u884c Windows ARM \u865a\u62df\u673a</li> <li>WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76</li> <li>NUC11 ESXi \u4e2d iGPU \u76f4\u901a\u865a\u62df\u673a</li> <li>\u5728 Archlinux \u4e0a\u7528 winbind \u914d\u5408 pam \u914d\u7f6e Windows AD \u8ba4\u8bc1\u767b\u5f55</li> </ul>"},{"location":"tags/#wireguard","title":"wireguard","text":"<ul> <li>\u5728 WireGuard \u6784\u5efa\u7684 Overlay Network \u4e0a\u8dd1 babel \u8def\u7531\u534f\u8bae</li> <li>Wireguard \u96a7\u9053\u642d\u5efa</li> </ul>"},{"location":"tags/#wireless","title":"wireless","text":"<ul> <li>\u5728 Linux \u4e0a\u4f7f\u7528 Netgear A6210 USB \u65e0\u7ebf\u7f51\u5361</li> <li>802.11 \u5b66\u4e60</li> </ul>"},{"location":"tags/#wishbone","title":"wishbone","text":"<ul> <li>\u300c\u6559\u5b66\u300dWishbone \u603b\u7ebf\u534f\u8bae</li> </ul>"},{"location":"tags/#wlan","title":"wlan","text":"<ul> <li>802.11 \u5b66\u4e60</li> </ul>"},{"location":"tags/#wlc","title":"wlc","text":"<ul> <li>\u4e3a Cisco WLC \u914d\u7f6e Telegraf</li> </ul>"},{"location":"tags/#wolframalpha","title":"wolframalpha","text":"<ul> <li>\u7528\u6570\u5b66\u65b9\u6cd5 + \u6570\u5b66\u8f6f\u4ef6\u53bb\u505a\u4e00\u4e2a\u7269\u7406\u9898~</li> </ul>"},{"location":"tags/#wpad","title":"wpad","text":"<ul> <li>\u5728 LEDE\uff08OpenWrt\uff09\u4e0a\u542f\u7528 wpad</li> </ul>"},{"location":"tags/#write-a-linker","title":"write-a-linker","text":"<ul> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09</li> <li>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09</li> </ul>"},{"location":"tags/#wsl","title":"wsl","text":"<ul> <li>\u5728 WSL \u4e0a\u5f00\u542f\u4e00\u4e2a getty \u5230\u4e32\u53e3\u7684\u65b9\u6cd5</li> <li>WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#wsl2","title":"wsl2","text":"<ul> <li>WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76</li> </ul>"},{"location":"tags/#wuwenhu","title":"wuwenhu","text":"<ul> <li>\u5076\u9047\u6e05\u534e\u5434\u6587\u864e\u6559\u6388</li> </ul>"},{"location":"tags/#wxapp","title":"wxapp","text":"<ul> <li>\u300a\u52a0\u901f\u5954\u5411 2019\u300b\u5c0f\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u8425\u56de\u987e</li> </ul>"},{"location":"tags/#x11","title":"x11","text":"<ul> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> <li>Gnome \u7684 Fractional Scaling</li> </ul>"},{"location":"tags/#x86","title":"x86","text":"<ul> <li>\u5185\u5b58\u6a21\u578b\u548c\u5185\u5b58\u5e8f</li> <li>\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta</li> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> </ul>"},{"location":"tags/#x86_64","title":"x86_64","text":"<ul> <li>\u9759\u6001\u7f16\u8bd1 sqlite3</li> </ul>"},{"location":"tags/#xauthority","title":"xauthority","text":"<ul> <li>\u5728\u811a\u672c\u4e2d\u5bfb\u627e X11 \u7684 DISPLAY \u548c XAUTHORITY</li> </ul>"},{"location":"tags/#xcode","title":"xcode","text":"<ul> <li>\u5728 Xcode 9 \u4e0a\u542f\u7528 Vim \u6a21\u62df\uff08XVim 2\uff09</li> </ul>"},{"location":"tags/#xelite","title":"xelite","text":"<ul> <li>\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux</li> <li>Qualcomm Oryon \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#xiaomi","title":"xiaomi","text":"<ul> <li>\u4f7f\u7528 HomeBridge \u628a\u5c0f\u7c73\u7a7a\u6c14\u51c0\u5316\u5668\u52a0\u5165\u5230 HomeKit \u4e2d</li> </ul>"},{"location":"tags/#xilinx","title":"xilinx","text":"<ul> <li>DRAM \u5728 Kintex 7 FPGA \u4e0a\u5185\u90e8 Vref \u7684\u6027\u80fd\u95ee\u9898</li> <li>\u5728 Arty A7 \u4e0a\u7528 LiteX \u548c VexRiscv \u8dd1 Linux</li> <li>\u5728 LiteX \u4e2d\u4f7f\u7528 UART over JTAG</li> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> <li>\u300c\u6559\u5b66\u300dAXI Quad SPI \u65f6\u5e8f\u5206\u6790</li> <li>\u7ed9 Rocket Chip \u6302\u63a5\u4e32\u53e3\u5916\u8bbe</li> </ul>"},{"location":"tags/#xmodem","title":"xmodem","text":"<ul> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003\uff082\uff09</li> <li>\u8fd1\u6765\u505a Stanford CS140e \u7684\u4e00\u4e9b\u8fdb\u5c55\u548c\u601d\u8003</li> </ul>"},{"location":"tags/#xonly","title":"xonly","text":"<ul> <li>OpenBSD xonly \u5b9e\u73b0\u539f\u7406</li> </ul>"},{"location":"tags/#xpm","title":"xpm","text":"<ul> <li>RAM \u8bfb\u5199\u51b2\u7a81</li> </ul>"},{"location":"tags/#xrdp","title":"xrdp","text":"<ul> <li>XRDP \u548c NVIDIA \u663e\u5361\u517c\u5bb9\u6027\u95ee\u9898</li> </ul>"},{"location":"tags/#xtables","title":"xtables","text":"<ul> <li>\u901a\u8fc7 Ipfilter Extension \u5b9e\u73b0 RFC8367</li> </ul>"},{"location":"tags/#xti","title":"xti","text":"<ul> <li>Transport Layer Interface \u8003\u53e4</li> </ul>"},{"location":"tags/#xvim","title":"xvim","text":"<ul> <li>\u5728 Xcode 9 \u4e0a\u542f\u7528 Vim \u6a21\u62df\uff08XVim 2\uff09</li> </ul>"},{"location":"tags/#xwayland","title":"xwayland","text":"<ul> <li>Gnome \u7684 Fractional Scaling</li> </ul>"},{"location":"tags/#xwidgets","title":"xwidgets","text":"<ul> <li>Building emacs git version with xwidgets and modules in archlinux</li> </ul>"},{"location":"tags/#yeeloong","title":"yeeloong","text":"<ul> <li>\u5728 Lemote Yeeloong \u4e0a\u5b89\u88c5 Debian jessie</li> </ul>"},{"location":"tags/#yosys","title":"yosys","text":"<ul> <li>\u7528 sv2v+yosys \u628a fpnew \u8f6c\u4e3a verilog \u7f51\u8868</li> <li>OpenROAD Flow \u521d\u5c1d\u8bd5</li> </ul>"},{"location":"tags/#z4yx","title":"z4yx","text":"<ul> <li>\u5411 Lenovo y1s \u5237\u5165 OpenWRT 17.01.5 \u56fa\u4ef6\uff0c\u5e76\u628a IPv6 bridge \u5230\u5185\u7f51\u4e2d\u548c\u914d\u7f6e\u8ba4\u8bc1\u811a\u672c</li> </ul>"},{"location":"tags/#zen5","title":"zen5","text":"<ul> <li>AMD Zen 5 \u5fae\u67b6\u6784\u8bc4\u6d4b</li> </ul>"},{"location":"tags/#zfs","title":"zfs","text":"<ul> <li>Mac \u4e0a\u5b89\u88c5 Arch Linux\uff0cZFS \u771f\u9999</li> </ul>"},{"location":"tags/#zsh","title":"zsh","text":"<ul> <li>\u5199\u4e00\u4e2a bash zsh \u548c fish \u90fd\u80fd\u8dd1\u7684\u811a\u672c</li> </ul>"}]}