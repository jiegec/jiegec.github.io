
<!DOCTYPE html>

<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="杰哥的{运维,编程,调板子}小笔记" name="description"/>
<link href="https://jia.je/page/13/" rel="canonical"/>
<link href="../../about/" rel="next"/>
<link href="../../feed_rss_created.xml" rel="alternate" title="RSS 订阅" type="application/rss+xml"/>
<link href="../../feed_rss_updated.xml" rel="alternate" title="已更新内容的 RSS 订阅" type="application/rss+xml"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-9.2.0-b0" name="generator"/>
<title>博客 - 杰哥的{运维,编程,调板子}小笔记</title>
<link href="../../assets/stylesheets/main.0c456da8.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="杰哥的{运维,编程,调板子}小笔记" class="md-header__button md-logo" data-md-component="logo" href="../.." title="杰哥的{运维,编程,调板子}小笔记">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            杰哥的{运维,编程,调板子}小笔记
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              博客
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../..">
        
  
    
  
  博客

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../about/">
        
  
    
  
  关于

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../open-source-contributions/">
        
  
    
  
  开源

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../tags/">
        
  
    
  
  标签

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="/kb/">
        
  
    
  
  知识库

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../series/">
        
  
    
  
  系列

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../projects/">
        
  
    
  
  项目

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../tools/">
        
  
    
  
  工具

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="/feed.xml">
        
  
    
  
  订阅

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../archive/2023/">
          
  
  归档

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../category/crypto/">
          
  
  分类

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="杰哥的{运维,编程,调板子}小笔记" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="杰哥的{运维,编程,调板子}小笔记">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    杰哥的{运维,编程,调板子}小笔记
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    博客
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/">
<span class="md-ellipsis">
    关于
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../open-source-contributions/">
<span class="md-ellipsis">
    开源
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tags/">
<span class="md-ellipsis">
    标签
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="/kb/">
<span class="md-ellipsis">
    知识库
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../series/">
<span class="md-ellipsis">
    系列
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../projects/">
<span class="md-ellipsis">
    项目
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tools/">
<span class="md-ellipsis">
    工具
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="/feed.xml">
<span class="md-ellipsis">
    订阅
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    归档
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            归档
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2023/">
<span class="md-ellipsis">
    2023
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2022/">
<span class="md-ellipsis">
    2022
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2021/">
<span class="md-ellipsis">
    2021
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2020/">
<span class="md-ellipsis">
    2020
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2019/">
<span class="md-ellipsis">
    2019
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2018/">
<span class="md-ellipsis">
    2018
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2017/">
<span class="md-ellipsis">
    2017
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2016/">
<span class="md-ellipsis">
    2016
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../archive/2014/">
<span class="md-ellipsis">
    2014
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
<span class="md-ellipsis">
    分类
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_11">
<span class="md-nav__icon md-icon"></span>
            分类
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/crypto/">
<span class="md-ellipsis">
    crypto
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/csdn/">
<span class="md-ellipsis">
    csdn
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/ctf/">
<span class="md-ellipsis">
    ctf
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/devops/">
<span class="md-ellipsis">
    devops
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/hardware/">
<span class="md-ellipsis">
    hardware
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/life/">
<span class="md-ellipsis">
    life
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/logo/">
<span class="md-ellipsis">
    logo
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/meta/">
<span class="md-ellipsis">
    meta
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/misc/">
<span class="md-ellipsis">
    misc
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/networking/">
<span class="md-ellipsis">
    networking
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/news/">
<span class="md-ellipsis">
    news
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/os/">
<span class="md-ellipsis">
    os
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/others/">
<span class="md-ellipsis">
    others
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/programming/">
<span class="md-ellipsis">
    programming
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/software/">
<span class="md-ellipsis">
    software
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/speech/">
<span class="md-ellipsis">
    speech
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/system/">
<span class="md-ellipsis">
    system
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/unboxing/">
<span class="md-ellipsis">
    unboxing
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="_1"><a class="toclink" href="#_1">博客</a></h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-12-27 00:00:00">2020年12月27日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/hardware/">hardware</a></li>
<li class="md-meta__item">
            
              需要 15 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="_1"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/">以太网的物理接口</a></h2>
<p>本文的内容已经整合到<a href="/kb/networking/ethernet.html">知识库</a>中。</p>
<h3 id="_2"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#_2">背景</a></h3>
<p>最近逐渐接触到了一些高速的以太网的接口，被一大堆的名字搞得有点懵，所以特意学习了一下并整理成这篇博客。</p>
<p>更新：经 <a href="https://github.com/z4yx">@z4yx</a> 指出，还可以看<a href="https://support.huawei.com/hedex/hdx.do?docid=EDOC1100156553&amp;id=ZH-CN_TOPIC_0250303640&amp;lang=zh">华为的介绍文档</a></p>
<h3 id="base"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#base">几几 BASE 杠什么是什么意思</a></h3>
<p>在下文里，经常可以看到类似 100BASE-TX 这种写法，它表示的意思是：</p>
<ol>
<li>BASE 前面的数字表示速率，比如 10，100，1000，10G 等等</li>
<li>BASE 之后的第一个字母，常见的 T 表示双绞线，S 表示 850nm 光纤，L 表示 1310nm 光纤，C 表示同轴电缆</li>
<li>之后可能还有别的字母，比如 X 表示 8b/10b 或者 4b/5b（FE）的编码，R 表示 64b/66b 的编码</li>
<li>之后可能还有别的数字，如果是 LAN PHY 表示的是所使用的 lane 数量；如果是 WAN PHY 表示的是传输的公里数</li>
</ol>
<p>详见 <a href="https://en.wikipedia.org/wiki/Ethernet_physical_layer#Naming_conventions">Wikipedia - Ethernet Physical Layer # Naming Conventions</a> 和 IEEE 802.3 1.2.3 节 Physical Layer and media notation：</p>
<div class="language-text highlight"><pre><span></span><code>The data rate, if only a number, is in Mb/s, and if suffixed by a “G”, is in
Gb/s. The modulation type (e.g., BASE) indicates how encoded data is
transmitted on the medium. The additional distinction may identify
characteristics of transmission or medium and, in some cases, the type of PCS
encoding used (examples of additional distinctions are “T” for twisted pair,
“B” for bidirectional optics, and “X” for a block PCS coding used for that
speed of operation). Expansions for defined Physical Layer types are included
in 1.4.
</code></pre></div>
<p>和 IEEE 802.3 1.4 节 Definitions 中的几个例子：</p>
<ul>
<li>100BASE-T: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network. (See IEEE Std 802.3, Clause 22 and Clause 28.)</li>
<li>100BASE-TX: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network over two pairs of Category 5 twisted-pair cabling. (See IEEE Std 802.3, Clause 24 and Clause 25.)</li>
<li>1000BASE-T: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN using four pairs of Category 5 balanced copper cabling. (See IEEE Std 802.3, Clause 40.)</li>
<li>1000BASE-X: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN that uses a Physical Layer derived from ANSI X3.230-1994 (FC-PH) [B21]23. (See IEEE Std 802.3, Clause 36.)</li>
<li>2.5GBASE-T: IEEE 802.3 Physical Layer specification for a 2.5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li>
<li>5GBASE-T: IEEE 802.3 Physical Layer specification for a 5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li>
<li>10GBASE-T: IEEE 802.3 Physical Layer specification for a 10 Gb/s LAN using four pairs of Class E or Class F balanced copper cabling. (See IEEE Std 802.3, Clause 55.)</li>
</ul>
<h3 id="_3"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#_3">各个速率对应的英文单词是什么</a></h3>
<ul>
<li>Fast Ethernet: 100Mbps</li>
<li>Gigabit Ethernet: 1Gbps</li>
<li>Multi Gigabit Ethernet: 2.5Gbps</li>
<li>Ten Gigabit Ethernet: 10Gbps</li>
<li>Forty Gigabit Ethernet: 40Gbps</li>
<li>Hundred Gigabit Ethernet: 100Gbps</li>
</ul>
<h3 id="_4"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#_4">常见的连接器</a></h3>
<p>连接器（connector）一般来说指的就是线缆和网络设备之间的物理接口了。常见的有：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Modular_connector#8P8C">8P8C</a>：一般我们会称之为 RJ45，关于它们俩的关系，可以看 Wikipedia 上面的说明，不过在日常生活中，这两个混用其实也没有什么大问题</li>
<li><a href="https://en.wikipedia.org/wiki/Optical_fiber_connector#LC">LC</a>：一种光纤的接口，有两个突出来的插到 SFP 光模块中的突起，比较常见</li>
<li><a href="https://en.wikipedia.org/wiki/Twinaxial_cabling#SFP+_Direct-Attach_Copper_(10GSFP+Cu)">SFP+ DAC</a>：一般是 DAC（Direct Attatched Cable）线，线的两端直接就是 SFP+ 的接口，直接插到 SFP+ 笼子中，不需要光模块；更高速率的也有 DAC 线</li>
</ul>
<p>对于光纤的接口，注意购买的时候要和光模块对应，不然可能插不进去。常见的有 LC-LC，SC-LC，SC-SC 等等，表示线的两端分别是什么接口。</p>
<h3 id="mdi-mdi-x"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#mdi-mdi-x">MDI 和 MDI-X</a></h3>
<p>这其实就是大家常见的 RJ45 里面 8 根线对应的信号，在十兆和百兆的时候，需要区分 MDI 和 MDI-X，在同种类型的端口之间用交叉线，在不同类型的端口之间用直通线。在后来，有了 Auto MDI-X，也就是会按照实际情况自动检测并且匹配。从千兆开始，设备都支持 Auto MDI-X 了，所以线本身是交叉还是直通就无所谓了。</p>
<h3 id="sfp"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#sfp">各种 SFP</a></h3>
<p><a href="https://en.wikipedia.org/wiki/Small_form-factor_pluggable_transceiver">SFP</a> 是很常见的，特别是在高速的网络之中。而它又分为几种，对应不同的速率：</p>
<ul>
<li>SFP: 1Gbps/100Mbps</li>
<li>SFP+: 10Gbps</li>
<li>SFP28: 25Gbps</li>
<li>SFP56: 50Gbps</li>
<li>QSFP: 4Gbps</li>
<li>QSFP+: 40Gbps</li>
<li>QSFP28: 100Gbps/50Gbps</li>
<li>QSFP56: 200Gbps</li>
<li>QSFP-DD: 400Gbps/200Gbps</li>
<li>QSFP-DD112: 800Gbps</li>
<li>OSFP: 800Gbps/400Gbps</li>
</ul>
<p>可以看到，名字前面加了个 Q（Quad），速率就翻了 4 倍，因为有 4 个 lane，同时物理接口的尺寸也变大了。所以，不带 Q 的 SFP 的物理尺寸都一样，带 Q 的 SFP 物理尺寸都一样大，但后者比前者大一些（SFP 是 113.9 mm^2，QSFP 是 156 mm^2）。OSFP 又比 QSFP 更大一些，O 表示 Octal，就是 8 个 lane 的意思。</p>
<p>可以在 <a href="https://community.fs.com/blog/400g-qsfp-dd-transceiver-types-overview.html">400G QSFP Transceiver Types and Fiber Connections</a> 和 <a href="https://community.fs.com/blog/400g-osfp-transceiver-types-overview.html">400G OSFP Transceiver Types Overview</a> 看到 QSFP-DD 和 OSFP 的对比。</p>
<p>通常，网络设备也会支持把一个 QSFP 接口拆成多个 SFP 接口来使用，比如有的线，一边是 QSFP28，另一边是 4xSFP28，只要设备支持即可，目的是节省空间。</p>
<p><a href="https://members.snia.org/document/dl/26184">SFP 标准 SFF INF-8074</a> 规定了 <a href="https://en.wikipedia.org/wiki/Small_form-factor_pluggable_transceiver#Signals">20 根信号线</a>，正反面各 10 根，重要的是下面的这些（括号里写得是 Pin 的编号）：</p>
<ol>
<li>Mod_ABS（6）：模块是否插入</li>
<li>RD+（13）、RD-（12）：接收数据的差分对</li>
<li>TD+（18）、TD-（19）：传输数据的差分对</li>
<li>SDA（4）、SCL（5）：模块的 I2C</li>
<li>Tx_Fault（2）、Tx_Disable（3）、Rx_LOS（8）：一些状态信号</li>
</ol>
<p>可以看到，收和发各有一个差分对共 4 条数据线。相对应的，QSFP 收和发各有四对差分对共 16 条数据线，一共 38 根线。并且有一些信号是复用了同样的 pin，这样的设计可以节省一些 pin，是很常见的。</p>
<h3 id="mii"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#mii">MII</a></h3>
<p>有时候，还会遇到各种 <a href="https://en.wikipedia.org/wiki/Media-independent_interface">MII</a> 接口，也就是 MAC 和 PHY 之间的接口。有时候，还会伴随着 MDIO 接口，来进行控制信息的传输。它又分不同的类型：</p>
<ul>
<li>Standard MII：速率是 100Mbps（25MHz*4）或者 10Mbps（2.5Mhz*4），TX 7 根线（4 DATA+CLK+EN+ER），RX 7+2 根线（4 DATA+CLK+DV+ER+CRS+COL），加上 MDIO 2 根线共 18 根线</li>
<li>RMII：速率是 100Mbps 或者 10Mbps，频率都是 50MHz，一共 10 根线（4 DATA+CLK+TX_EN+CRS_DV+RX_ER+MDIO+MDC），数据线是 TX 和 RX 各 2 根</li>
<li>GMII：速率是 1000Mbps（125MHz*8），数据线是 TX 和 RX 各 8 根；也支持速率 100Mbps（25MHz）和 10Mbps（2.5MHz）</li>
<li>RGMII：速率是 1000Mbps（125MHz*4*2，DDR），数据线是 TX 和 RX 各 4 根；也支持速率 100Mbps（25MHz*4）和 10Mbps（2.5MHz*4），一共是 5+5+2 根线</li>
<li>SGMII：速率是 1000Mbps（625MHz*2*8/10），采用 625MHz DDR 差分对 SerDes，采用 8b/10b 的编码</li>
<li>XGMII：支持 2500Mbps/5000Mbps/10000Mbps（156.25 MHz*32*2，DDR）速率，数据线是 TX 和 RX 各 32 根</li>
</ul>
<p>有的时候，MAC 和 PHY 是独立的，比如很多常见的 FPGA 开发板，在使用千兆网的时候，在板子上是 PHY 芯片，从 FPGA 到 PHY 通过 RGMII 连接，然后 PHY 再连接到 8P8C（RJ45）的连接器上。一般还会把 MDIO 也接到 FPGA 上面。如果有多个 PHY，就会吧 MDIO 通过总线的方式合并起来，给每个 PHY 配置不同的地址（一般是在指定的 PIN 上设置上拉/下拉电阻实现），就可以保证不冲突的访问。</p>
<p>扩展阅读：<a href="https://ww1.microchip.com/downloads/en/DeviceDoc/00002117F.pdf">KXZ9031RNX Datasheet</a></p>
<h3 id="sgmii"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#sgmii">SGMII</a></h3>
<p>上面比较常见的是 GMII/RGMII/SGMII。其中比较特殊的是 <a href="https://archive.org/details/sgmii/mode/2up">SGMII</a>，首先可以发现它信号很少，只有两对差分线 TX_P TX_N RX_P RX_N，其中时钟是可选的，因为可以从数据中恢复。你可能感到很奇怪，那么其他的信号，比如 DV/ER/CRS 等都去哪里了呢？其实是因为，SGMII 采用了 <a href="https://zh.wikipedia.org/wiki/8b/10b">8b/10b</a> 的编码的同时，把这些控制信号通过一定的方式顺便编码进去了。具体来说，就是从 8 位的数据信号编码为 10 位的时候，有一些特殊的 10 位符号是没有对应 8 位的数据的，因此可以用这些特殊符号来表示一些信号，比如用 SPD（Start_of_Packet Delimiter，对应 /S/）和 EPD（End_of_Packet Delimiter，对应 /T/R/ 等）表示传输数据的开始和结尾，对应 TX_EN/RX_DV 信号；用 Error_Propagation（/V/）表示错误，对应 RX_ER 信号等等。所以，SGMII 其实还是一个 GMII 的变种，只不过采用 SerDes 的方式减少了引脚，MAC 内部或者 PHY 内部也是经过一个 GMII-SGMII 的转换，而其余部分是一样的。</p>
<p>关于 8b/10b 的编码方式，可以阅读 IEEE 802.3 标准中的 <code>Table 36–1a—Valid data code-groups</code>，里面提到了两类的 Code Group：D 打头的，表示数据，有 256 种，从 8b 映射到 10b 的表达方式，并且为了保持直流平衡，有一种到两种表示方法。此外还有 12 个特殊的 Code Group：K 打头，它们的 10b 表达方式不会和数据冲突。表 <code>Table 36–3—Defined ordered sets</code> 中定义了 K 打头的 Code Group 含义：</p>
<ul>
<li>/C/ Configuration:</li>
<li>/C1/ Configuration 1: /K28.5/D21.5/Config_Reg</li>
<li>/C2/ Configuration 2: /K28.5/D2.2/Config_Reg</li>
<li>/I/ IDLE:</li>
<li>/I1/ IDLE 1: /K28.5/D5.6/</li>
<li>/I2/ IDLE 2: /K28.5/D16.2/</li>
<li>Encapsulation:</li>
<li>/R/ Carrier_Extend: /K23.7/</li>
<li>/S/ Start_of_Packet: /K27.7/</li>
<li>/T/ End_of_Packet: /K29.7/</li>
<li>/V/ Error_Propagation: /K30.7/</li>
<li>/LI/ LPI (Low Power Idle):</li>
<li>/LI1/ LPI 1: /K28.5/D6.5/</li>
<li>/LI2/ LPI 2: /K28.5/D26.4/</li>
</ul>
<p>IEEE 802.3 Figure 36-4 中给了一个例子，就是在发送一段数据的时候，首先是 /I/，然后 /S/，接着一系列的 /D/，最后结束的时候 /T/R/I/。</p>
<p>扩展阅读：</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/programmable/solutions/technology/transceiver/protocols/pro-sgmii.html">Serial Gigabit Media Independent Interface</a></li>
<li><a href="https://www.xilinx.com/support/documentation/ip_documentation/gig_ethernet_pcs_pma/v16_0/pg047-gig-eth-pcs-pma.pdf">1G/2.5G Ethernet PCS/PMA or SGMII v16.0</a></li>
<li><a href="https://en.wikipedia.org/wiki/Physical_coding_sublayer">https://en.wikipedia.org/wiki/Physical_coding_sublayer</a></li>
</ul>
<h3 id="1000base-x-sfp"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#1000base-x-sfp">1000BASE-X 与 SFP 的关系</a></h3>
<p>1000BASE-X 在 802.3 Clause 36 中定义，它的层级是这样的：</p>
<p><img alt="" src="/images/1000basex.png"/></p>
<p>它支持三种不同的介质，对应了三个 PMD 层，也就是 LX、SX 和 CX。这些体现在设备上，其实就是不同的 SFP 模块。SFP 模块实际上就是图中的 PMD 层，SFP 接口上连接的是 1000BASE-X 的 PCS/PMA，这也就是为什么说在带有 SFP 的 FPGA 上，Xilinx 的 IP 叫做 1G/2.5G Ethernet PCS/PMA。在这里，PCS 和 PMA 层在 FPGA 内部通过 IP 实现，通过 PCB 连接到 SFP 上，光模块就是 PMD 层。见下图：</p>
<p><img alt="" src="/images/xilinx_pcs_pma.png"/></p>
<p>左边通过 GMII 连接到内部的 MAC，右边连接到 SFP 上，通过光模块，连接到光纤。这里光模块只需要负责光电转换。另一种比较常见的形式，就是 MAC 在 FPGA 内部，PHY（包括 PCS/PMA/PMD）都在 FPGA 外部，此时 FPGA IO 上就是各种 MII。</p>
<p>那么 SFP 电口模块是怎么工作的呢？我们知道，电口采用的是 1000BASE-T 标准。实际上，它里面有一个 PHY 芯片，发送的时候，首先解码 1000BASE-X 变回原始数据，再按照 1000BASE-T 的方式编码再发出去；接收的时候，按照 1000BASE-T 进行解码，再重新编码为 1000BASE-X 发送给 PMA 层。</p>
<p>还有一类电口模块，与上面不同的地方在于，SFP 上走的是 SGMII，而不是 1000BASE-X。这两种模式没有太大的区别，都是两对差分线，一收一发，所以很多时候二者是同时支持，可以切换的。例如 <a href="https://www.fs.com/products/177936.html?attribute=44906&amp;id=1109184">Cisco Compatible 10/100/1000BASE-T SFP SGMII Copper RJ-45 100m Industrial Transceiver Module (LOS)</a> 就是在 SFP 上走 SGMII 协议。</p>
<p>推荐阅读 <a href="https://ww1.microchip.com/downloads/en/Appnotes/VPPD-01080.pdf">Designing a Copper SFP using the VSC8221 10/100/1000BASE-T PHY</a>，它里面讲了如何将 VSC8221 芯片用于电口模块：VSC8221 芯片一头是 1000BASEX（又称 802.3z SerDes，802.3z 就是 1000BASE-X）或者 SGMII，另一头是 1000BASE-T MDI。</p>
<h3 id="_5"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#_5">物理层</a></h3>
<h4 id="100base-tx"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#100base-tx">100BASE-TX</a></h4>
<p>在 IEEE 802.3 的 Clause 24 和 25 中定义。</p>
<p>100BASE-TX 的物理层分为 PCS，PMA，PMD。与 MAC 的连接是 MII 接口，MII 频率是 25MHz，每周期传输 4 bit 的数据。然后 PCS 负责把 4 bit 的数据通过 4B/5B 转换为 5 bit 的 code group；PMA 使用 NRZI 进行编码；PMD 层借用了 FDDI 协议的 PMD 层，只使用 MDI 的 1-3 和 6 四根线传输，两对差分对，一收一发。</p>
<h4 id="1000base-t"><a class="toclink" href="../../hardware/2020/12/27/ethernet-physical-interfaces/#1000base-t">1000BASE-T</a></h4>
<p>在 IEEE 802.3ab-1999 中定义，具体位置是 Clause 40。</p>
<p><img alt="" src="/images/1000baset.png"/></p>
<p>物理层往上通过 GMII 连接 MAC，往下通过 MDI 连接其他网络设备。物理层又包括 PCS 和 PMA。</p>
<p>1000BASE-T 使用四对差分线，每对差分线上都是全双工传输，波特率 125Mbaud，symbol 的范围是 <code>{2, 1, 0, -1, -2}</code>，通过 PAM5 传输。</p>
<p>具体来讲，PCS 从 MAC 的 GMII 接口接收要发送的数据，GMII 是 125MHz，每个周期 8 位数据。这些数据与 scrambler 一起，生成 9 位的 <code>Sd_n[8:0]</code>，然后再编码为 <code>(TA_n, TB_n, TC_n, TD_n)</code>，也就是在四对差分线上传输的 symbol，取值范围是 <code>[-2, 2]</code>。简单总结一下，就是每个周期 8 位数据，先变成 9 位数据，再变成 4 个 symbol，每个 symbol 取值范围是 -2 到 2，这就叫做 8B1Q4，<code>converting GMII data (8B-8 bits) to four quinary symbols (Q4) that are transmitted during one clock (1Q4)</code>，把 8 位的数据转换为四个 symbol，每个 symbol 有五种取值（Quinary 表示 5）。</p>
<nav class="md-post__action">
<a href="../../hardware/2020/12/27/ethernet-physical-interfaces/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-12-04 00:00:00">2020年12月4日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/programming/">programming</a></li>
<li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="rust-m1-code-signing"><a class="toclink" href="../../programming/2020/12/04/workaround-rust-on-m1/">Rust 在 M1 上的 Code Signing 问题和临时解决方法</a></h2>
<p>不久前，rust 添加了 Tier2 的 aarch64-apple-darwin 的支持，试了一下，确实可以运行，不过当我编译的时候，出现：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>error: failed to run custom build command for `xxxx v1.0 (/path/to/xxxx)`
</span><span id="__span-0-2"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>Caused by:
</span><span id="__span-0-4"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>  process didn't exit successfully: `/path/to/xxx/target/debug/build/xxx-xxxx/build-script-build` (signal: 9, SIGKILL: kill)
</span></code></pre></div>
<p>看了一下 Console.app 里面的 crash 日志，发现是 codesigning 问题。解决方法是，用 codesign 命令来签名：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">## for build.rs</span>
</span><span id="__span-1-2"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>codesign<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>target/debug/build/*/build-script-build
</span><span id="__span-1-3"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1">## for dylib of some crates</span>
</span><span id="__span-1-4"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>codesign<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>target/debug/deps/*.dylib
</span><span id="__span-1-5"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1">## for final executable</span>
</span><span id="__span-1-6"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>codesign<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>target/debug/xxx
</span></code></pre></div>
<p>多次编译并签名后，就可以正常运行最后的二进制了：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../programming/2020/12/04/workaround-rust-on-m1/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>target/debug/xxxx:<span class="w"> </span>Mach-O<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>executable<span class="w"> </span>arm64
</span></code></pre></div>
<p>然后就可以了。等待上游添加 code signing 支持吧。</p>
<p>2020-12-07 更新：找了找 cargo 的 issues，找到了<a href="https://github.com/rust-lang/cargo/issues/8913">同样的问题</a>，看来并不是 code signing 支持的问题，而是在 Intel 的 Alacritty 下面，运行 Apple 的 rustc 工具链的时候，才会出现的 BUG。我也自己试了一下，在 Apple 的 Terminal 下跑编译就没有问题。</p>
<nav class="md-post__action">
<a href="../../programming/2020/12/04/workaround-rust-on-m1/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-11-19 00:00:00">2020年11月19日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/hardware/">hardware</a></li>
<li class="md-meta__item">
            
              需要 11 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="arm-m1-macbook-air"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/">ARM M1 MacBook Air 开箱</a></h2>
<h3 id="_1"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_1">购买</a></h3>
<p>我是 11.12 的时候在 Apple Store 上下单的，选的是 MacBookAir，带 M1 芯片，8 核 CPU + 8 核 GPU，加了一些内存和硬盘。今天（11.19）的时候顺丰到货，比 Apple Store 上显示的预计到达时间 21-28 号要更早。另外，我也听朋友说现在一些线下的店也有货，也有朋友直接在京东上买到了 Mac mini，总之第一波 M1 的用户最近应该都可以拿到设备了。</p>
<p>现在这篇博客，就是在 ARM MBA 上编写的，使用的是 Intel 的 VSCode，毕竟 VSCode 的 ARM64 版不久后才正式发布。</p>
<h3 id="_2"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_2">开箱</a></h3>
<p>从外观来看，一切都和 Intel MBA 一样，包装上也看不出区别，模具也是一样的。</p>
<p><img alt="" src="/images/arm_mac_1.png"/></p>
<p>进了系统才能看得出区别。预装的系统是 macOS Big Sur 11.0，之后手动更新到了目前最新的 11.0.1。</p>
<p>顺带 <a href="https://github.com/FactorialN">@FactorialN</a> 同学提醒我在这里提一句：包装里有电源适配器，不太环保。</p>
<h3 id="_3"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_3">体验</a></h3>
<h4 id="arm64"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#arm64">ARM64</a></h4>
<p>首先自然是传统艺能，证明一下确实是 Apple Silicon：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>$<span class="w"> </span>uname<span class="w"> </span>-a
</span><span id="__span-0-2"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>Darwin<span class="w"> </span>macbookair.lan<span class="w"> </span><span class="m">20</span>.1.0<span class="w"> </span>Darwin<span class="w"> </span>Kernel<span class="w"> </span>Version<span class="w"> </span><span class="m">20</span>.1.0:<span class="w"> </span>Sat<span class="w"> </span>Oct<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">00</span>:07:10<span class="w"> </span>PDT<span class="w"> </span><span class="m">2020</span><span class="p">;</span><span class="w"> </span>root:xnu-7195.50.7~2/RELEASE_ARM64_T8101<span class="w"> </span>x86_64
</span></code></pre></div>
<p>啊对不起我用错了，上面是在 Rosetta 里面跑的 shell 看到的结果。实际是这样子的：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>$<span class="w"> </span>uname<span class="w"> </span>-a
</span><span id="__span-1-2"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>Darwin<span class="w"> </span>macbookair.lan<span class="w"> </span><span class="m">20</span>.1.0<span class="w"> </span>Darwin<span class="w"> </span>Kernel<span class="w"> </span>Version<span class="w"> </span><span class="m">20</span>.1.0:<span class="w"> </span>Sat<span class="w"> </span>Oct<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">00</span>:07:10<span class="w"> </span>PDT<span class="w"> </span><span class="m">2020</span><span class="p">;</span><span class="w"> </span>root:xnu-7195.50.7~2/RELEASE_ARM64_T8101<span class="w"> </span>arm64
</span></code></pre></div>
<p>货真价实的 ARM64 内核，系统的很多 binary 也都是 Universal 的：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>$<span class="w"> </span>file<span class="w"> </span>/bin/bash
</span><span id="__span-2-2"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>/bin/bash:<span class="w"> </span>Mach-O<span class="w"> </span>universal<span class="w"> </span>binary<span class="w"> </span>with<span class="w"> </span><span class="m">2</span><span class="w"> </span>architectures:<span class="w"> </span><span class="o">[</span>x86_64:Mach-O<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>executable<span class="w"> </span>x86_64<span class="o">]</span><span class="w"> </span><span class="o">[</span>arm64e:Mach-O<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>executable<span class="w"> </span>arm64e<span class="o">]</span>
</span><span id="__span-2-3"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>/bin/bash<span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span>architecture<span class="w"> </span>x86_64<span class="o">)</span>:<span class="w">    </span>Mach-O<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>executable<span class="w"> </span>x86_64
</span><span id="__span-2-4"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>/bin/bash<span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span>architecture<span class="w"> </span>arm64e<span class="o">)</span>:<span class="w">    </span>Mach-O<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>executable<span class="w"> </span>arm64e
</span></code></pre></div>
<h4 id="rosetta"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#rosetta">Rosetta</a></h4>
<p>接着，就是重头戏 Rosetta 了。第一次打开 Intel 的程序的时候，会弹出窗口安装 Rosetta，确定以后立马就装好了。接着常用的各种软件啥的，都没有什么问题。</p>
<p>唯一能看出区别的，就是在 Activity Monitor 可以看到架构的区别：</p>
<p><img alt="" src="/images/arm_mac_2.png"/></p>
<p>实际体验的时候，其实没有什么感觉。默认情况下，在 Terminal 下打开的是 ARM64 架构的，如果要切换的话，只需要：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>$<span class="w"> </span>uname<span class="w"> </span>-m
</span><span id="__span-3-2"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>arm64
</span><span id="__span-3-3"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>$<span class="w"> </span>arch<span class="w"> </span>-arch<span class="w"> </span>x86_64<span class="w"> </span>uname<span class="w"> </span>-m
</span><span id="__span-3-4"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>x86_64
</span></code></pre></div>
<p>这样就可以了。如果开了一个 x86_64 的 shell，在 shell 里面执行的命令就都是 x86_64 架构的了。</p>
<h4 id="homebrew"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#homebrew">Homebrew</a></h4>
<p>目前，Homebrew 的支持是这样子的，Intel 的 Homebrew 工作很正常，没有遇到任何问题。。ARM 的 Homebrew 目前还在进行移植，由于官方的 build farm 还没有支持 ARM，所以各种包都需要自己编译，试了几个常用的软件都没问题。</p>
<p>目前 Homebrew 推荐的方法是，在老地方 <code>/usr/local/Homebrew</code> 下面放 Intel 的 Homebrew，在 <code>/opt/homebrew</code> 下面放 ARM 的 Homebrew。虽然还是有很多警告，但目前来看基本使用都没有什么问题。Homebrew cask 也正常，毕竟基本就是一个下载器。</p>
<p>另外，试了一下用 ARM Homebrew 从源码编译 GCC，编译中途失败了。</p>
<h4 id="_4"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_4">其他软件</a></h4>
<p>换到 ARM 上自然会想到，之前的那些软件还能不能跑。答案是，大多都可以，只是很多还是 Intel 版走翻译而已。</p>
<p>目前已经测试过正常使用的：VSCode、Google Chrome、Alacrity、iStat Menus、Alfred、Rectangle、Typora、Microsoft Office、Karabiner Elements、Jetbrains Toolbox、WeChat、CineBench、Dozer、Squirrel、Zoom、Tencent Meeting、Seafile、Skim、Mendeley、1 Password、Wireshark、Slack、iMazing、Office for Mac。</p>
<p>这些里面已经移植到 ARM64 的有 Alfred、iStat Menus、Karabiner Elements、Rectangle、Google Chrome、Slack、Typora、iMazing、Office for Mac、Zoom、VSCode Insiders。</p>
<p>这里有一部分是已经移植到 ARM64 的，有一些也很快就会移植过来。其中 iStat Menus 的电池健康显示有点 BUG，其他没发现问题（更新：已修复）。</p>
<p>另外，大家也知道 ARM Mac 很重要的一点是可以跑 iOS Apps，我们也确实跑了一些，不过都有一些问题：</p>
<ul>
<li>Doodle Jump：跑起来很正常，就是卡关了，别问为什么，没有加速度计，再怎么晃电脑也不会动</li>
<li>Bilibili：部分内容可以加载出来，部分不可以，估计是什么组件没有配置好</li>
<li>QQ Music：可以跑起来，但是在启动之后的引导页面，期望用户点一下屏幕，但怎么用鼠标点都没反应</li>
<li>Weibo：毕竟正常，可以正常浏览啥都，就是 UI 有点错位，估计是因为显示窗口和实际都不大一样，小问题。</li>
<li>Network Tools：很正常，各种网络信息都可以正常取出来。</li>
<li>NFSee：没有 NFC 读卡功能，自然没法用。</li>
<li>彩云天气（ColorfulClouds Weather）：正常使用。</li>
</ul>
<p>其他还有很多 App 还没有测试。</p>
<h4 id="_5"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_5">发热</a></h4>
<p>大家也知道，这款 MBA 是没有风扇的。但我实际测试的过程中发现，确实不大需要。拿 stress 跑了一段时间 CPU 满载运行，也没感觉到电脑发热，只是在更新 macOS Big Sur 11.0.1 的时候稍微热了一点点，也只是一点点，距离烫手还有很长的距离。</p>
<p>续航方面目前来看也挺好的，捣鼓了一个下午，也没耗多少电。</p>
<h4 id="_6"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_6">性能测试</a></h4>
<p>在不同平台上进行 OpenSSL 测试：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>$<span class="w"> </span>openssl<span class="w"> </span>speed<span class="w"> </span>-evp<span class="w"> </span>aes-128-cbc<span class="w"> </span>aes-256-cbc<span class="w"> </span>des-ede3<span class="w"> </span>rsa2048<span class="w"> </span>sha256
</span><span id="__span-4-2"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c1">## M1 MacBookAir</span>
</span><span id="__span-4-3"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.1.1j<span class="w">  </span><span class="m">16</span><span class="w"> </span>Feb<span class="w"> </span><span class="m">2021</span>
</span><span id="__span-4-4"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>built<span class="w"> </span>on:<span class="w"> </span>Wed<span class="w"> </span>Feb<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">12</span>:34:00<span class="w"> </span><span class="m">2021</span><span class="w"> </span>UTC
</span><span id="__span-4-5"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>idea<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>ptr<span class="o">)</span><span class="w"> </span>
</span><span id="__span-4-6"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>compiler:<span class="w"> </span>clang<span class="w"> </span>-fPIC<span class="w"> </span>-arch<span class="w"> </span>arm64<span class="w"> </span>-O3<span class="w"> </span>-Wall<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_CPUID_OBJ<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DKECCAK1600_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DECP_NISTZ256_ASM<span class="w"> </span>-DPOLY1305_ASM<span class="w"> </span>-D_REENTRANT<span class="w"> </span>-DNDEBUG
</span><span id="__span-4-7"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-8"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes<span class="w">  </span><span class="m">16384</span><span class="w"> </span>bytes
</span><span id="__span-4-9"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">30466</span>.76k<span class="w">    </span><span class="m">30644</span>.63k<span class="w">    </span><span class="m">30592</span>.26k<span class="w">    </span><span class="m">30106</span>.97k<span class="w">    </span><span class="m">29961</span>.69k<span class="w">    </span><span class="m">29951</span>.49k
</span><span id="__span-4-10"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>aes-256<span class="w"> </span>cbc<span class="w">     </span><span class="m">229863</span>.42k<span class="w">   </span><span class="m">238671</span>.82k<span class="w">   </span><span class="m">232654</span>.34k<span class="w">   </span><span class="m">237194</span>.70k<span class="w">   </span><span class="m">238092</span>.29k<span class="w">   </span><span class="m">237791</span>.91k
</span><span id="__span-4-11"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>aes-128-cbc<span class="w">    </span><span class="m">1020384</span>.58k<span class="w">  </span><span class="m">1427866</span>.73k<span class="w">  </span><span class="m">1521123</span>.84k<span class="w">  </span><span class="m">1558199</span>.30k<span class="w">  </span><span class="m">1569978</span>.99k<span class="w">  </span><span class="m">1566288</span>.55k
</span><span id="__span-4-12"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>sha256<span class="w">          </span><span class="m">378646</span>.12k<span class="w">  </span><span class="m">1140355</span>.52k<span class="w">  </span><span class="m">1894169</span>.69k<span class="w">  </span><span class="m">2287211</span>.18k<span class="w">  </span><span class="m">2445602</span>.42k<span class="w">  </span><span class="m">2453209</span>.09k
</span><span id="__span-4-13"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-14"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.000561s<span class="w"> </span><span class="m">0</span>.000014s<span class="w">   </span><span class="m">1782</span>.0<span class="w">  </span><span class="m">69645</span>.9
</span><span id="__span-4-15"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="c1">## AMD EPYC 7742</span>
</span><span id="__span-4-16"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.1.1d<span class="w">  </span><span class="m">10</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2019</span>
</span><span id="__span-4-17"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>built<span class="w"> </span>on:<span class="w"> </span>Mon<span class="w"> </span>Dec<span class="w">  </span><span class="m">7</span><span class="w"> </span><span class="m">20</span>:44:45<span class="w"> </span><span class="m">2020</span><span class="w"> </span>UTC
</span><span id="__span-4-18"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>8x,int<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>ptr<span class="o">)</span>
</span><span id="__span-4-19"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>compiler:<span class="w"> </span>gcc<span class="w"> </span>-fPIC<span class="w"> </span>-pthread<span class="w"> </span>-m64<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-Wall<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-fdebug-prefix-map<span class="o">=</span>/build/openssl-CKx7Fo/openssl-1.1.1d<span class="o">=</span>.<span class="w"> </span>-fstack-protector-strong<span class="w"> </span>-Wformat<span class="w"> </span>-Werror<span class="o">=</span>format-security<span class="w"> </span>-DOPENSSL_USE_NODELETE<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_CPUID_OBJ<span class="w"> </span>-DOPENSSL_IA32_SSE2<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DOPENSSL_BN_ASM_MONT5<span class="w"> </span>-DOPENSSL_BN_ASM_GF2m<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DKECCAK1600_ASM<span class="w"> </span>-DRC4_ASM<span class="w"> </span>-DMD5_ASM<span class="w"> </span>-DAESNI_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DGHASH_ASM<span class="w"> </span>-DECP_NISTZ256_ASM<span class="w"> </span>-DX25519_ASM<span class="w"> </span>-DPOLY1305_ASM<span class="w"> </span>-DNDEBUG<span class="w"> </span>-Wdate-time<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span>
</span><span id="__span-4-20"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-21"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes<span class="w">  </span><span class="m">16384</span><span class="w"> </span>bytes
</span><span id="__span-4-22"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">28734</span>.07k<span class="w">    </span><span class="m">28942</span>.08k<span class="w">    </span><span class="m">28982</span>.78k<span class="w">    </span><span class="m">29217</span>.91k<span class="w">    </span><span class="m">29136</span>.21k<span class="w">    </span><span class="m">29103</span>.45k
</span><span id="__span-4-23"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a>aes-256<span class="w"> </span>cbc<span class="w">     </span><span class="m">176843</span>.84k<span class="w">   </span><span class="m">183040</span>.83k<span class="w">   </span><span class="m">183156</span>.82k<span class="w">   </span><span class="m">184132</span>.61k<span class="w">   </span><span class="m">184464</span>.73k<span class="w">   </span><span class="m">184642</span>.22k
</span><span id="__span-4-24"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-24" id="__codelineno-4-24" name="__codelineno-4-24"></a>aes-128-cbc<span class="w">     </span><span class="m">602680</span>.15k<span class="w">  </span><span class="m">1178207</span>.32k<span class="w">  </span><span class="m">1239931</span>.82k<span class="w">  </span><span class="m">1251810</span>.30k<span class="w">  </span><span class="m">1258359</span>.47k<span class="w">  </span><span class="m">1261316</span>.78k
</span><span id="__span-4-25"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-25" id="__codelineno-4-25" name="__codelineno-4-25"></a>sha256<span class="w">          </span><span class="m">201482</span>.20k<span class="w">   </span><span class="m">513504</span>.00k<span class="w">  </span><span class="m">1075572</span>.14k<span class="w">  </span><span class="m">1474850</span>.82k<span class="w">  </span><span class="m">1648746</span>.50k<span class="w">  </span><span class="m">1663030</span>.61k
</span><span id="__span-4-26"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-26" id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-27"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-27" id="__codelineno-4-27" name="__codelineno-4-27"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.000620s<span class="w"> </span><span class="m">0</span>.000018s<span class="w">   </span><span class="m">1613</span>.7<span class="w">  </span><span class="m">54756</span>.4
</span><span id="__span-4-28"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-28" id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="c1">## AMD EPYC 7282</span>
</span><span id="__span-4-29"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-29" id="__codelineno-4-29" name="__codelineno-4-29"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.1.1d<span class="w">  </span><span class="m">10</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2019</span>
</span><span id="__span-4-30"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-30" id="__codelineno-4-30" name="__codelineno-4-30"></a>built<span class="w"> </span>on:<span class="w"> </span>Mon<span class="w"> </span>Apr<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">20</span>:23:01<span class="w"> </span><span class="m">2020</span><span class="w"> </span>UTC
</span><span id="__span-4-31"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-31" id="__codelineno-4-31" name="__codelineno-4-31"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>8x,int<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>ptr<span class="o">)</span>
</span><span id="__span-4-32"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-32" id="__codelineno-4-32" name="__codelineno-4-32"></a>compiler:<span class="w"> </span>gcc<span class="w"> </span>-fPIC<span class="w"> </span>-pthread<span class="w"> </span>-m64<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-Wall<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-fdebug-prefix-map<span class="o">=</span>/build/openssl-8Ocme2/openssl-1.1.1d<span class="o">=</span>.<span class="w"> </span>-fstack-protector-strong<span class="w"> </span>-Wformat<span class="w"> </span>-Werror<span class="o">=</span>format-security<span class="w"> </span>-DOPENSSL_USE_NODELETE<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_CPUID_OBJ<span class="w"> </span>-DOPENSSL_IA32_SSE2<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DOPENSSL_BN_ASM_MONT5<span class="w"> </span>-DOPENSSL_BN_ASM_GF2m<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DKECCAK1600_ASM<span class="w"> </span>-DRC4_ASM<span class="w"> </span>-DMD5_ASM<span class="w"> </span>-DAESNI_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DGHASH_ASM<span class="w"> </span>-DECP_NISTZ256_ASM<span class="w"> </span>-DX25519_ASM<span class="w"> </span>-DPOLY1305_ASM<span class="w"> </span>-DNDEBUG<span class="w"> </span>-Wdate-time<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span>
</span><span id="__span-4-33"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-33" id="__codelineno-4-33" name="__codelineno-4-33"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-34"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-34" id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes<span class="w">  </span><span class="m">16384</span><span class="w"> </span>bytes
</span><span id="__span-4-35"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-35" id="__codelineno-4-35" name="__codelineno-4-35"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">27052</span>.31k<span class="w">    </span><span class="m">27392</span>.85k<span class="w">    </span><span class="m">27455</span>.57k<span class="w">    </span><span class="m">27569</span>.49k<span class="w">    </span><span class="m">27503</span>.27k<span class="w">    </span><span class="m">27514</span>.20k
</span><span id="__span-4-36"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-36" id="__codelineno-4-36" name="__codelineno-4-36"></a>aes-256<span class="w"> </span>cbc<span class="w">     </span><span class="m">158578</span>.10k<span class="w">   </span><span class="m">168502</span>.21k<span class="w">   </span><span class="m">172365</span>.91k<span class="w">   </span><span class="m">173904</span>.90k<span class="w">   </span><span class="m">174391</span>.30k<span class="w">   </span><span class="m">174429</span>.53k
</span><span id="__span-4-37"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-37" id="__codelineno-4-37" name="__codelineno-4-37"></a>aes-128-cbc<span class="w">     </span><span class="m">594506</span>.35k<span class="w">  </span><span class="m">1111762</span>.07k<span class="w">  </span><span class="m">1169014</span>.02k<span class="w">  </span><span class="m">1184384</span>.00k<span class="w">  </span><span class="m">1192793</span>.56k<span class="w">  </span><span class="m">1189167</span>.10k
</span><span id="__span-4-38"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-38" id="__codelineno-4-38" name="__codelineno-4-38"></a>sha256<span class="w">          </span><span class="m">194382</span>.61k<span class="w">   </span><span class="m">487875</span>.93k<span class="w">  </span><span class="m">1017121</span>.56k<span class="w">  </span><span class="m">1390122</span>.33k<span class="w">  </span><span class="m">1558735</span>.53k<span class="w">  </span><span class="m">1572274</span>.18k
</span><span id="__span-4-39"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-39" id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-40"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-40" id="__codelineno-4-40" name="__codelineno-4-40"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.000655s<span class="w"> </span><span class="m">0</span>.000019s<span class="w">   </span><span class="m">1526</span>.8<span class="w">  </span><span class="m">52089</span>.2
</span><span id="__span-4-41"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-41" id="__codelineno-4-41" name="__codelineno-4-41"></a><span class="c1">## AMD EPYC 7551</span>
</span><span id="__span-4-42"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-42" id="__codelineno-4-42" name="__codelineno-4-42"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.1.1d<span class="w">  </span><span class="m">10</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2019</span>
</span><span id="__span-4-43"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-43" id="__codelineno-4-43" name="__codelineno-4-43"></a>built<span class="w"> </span>on:<span class="w"> </span>Tue<span class="w"> </span>Feb<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">22</span>:08:43<span class="w"> </span><span class="m">2021</span><span class="w"> </span>UTC
</span><span id="__span-4-44"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-44" id="__codelineno-4-44" name="__codelineno-4-44"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>8x,int<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>ptr<span class="o">)</span>
</span><span id="__span-4-45"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-45" id="__codelineno-4-45" name="__codelineno-4-45"></a>compiler:<span class="w"> </span>gcc<span class="w"> </span>-fPIC<span class="w"> </span>-pthread<span class="w"> </span>-m64<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-Wall<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-fdebug-prefix-map<span class="o">=</span>/build/openssl-m9Qnvk/openssl-1.1.1d<span class="o">=</span>.<span class="w"> </span>-fstack-protector-strong<span class="w"> </span>-Wformat<span class="w"> </span>-Werror<span class="o">=</span>format-security<span class="w"> </span>-DOPENSSL_USE_NODELETE<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_CPUID_OBJ<span class="w"> </span>-DOPENSSL_IA32_SSE2<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DOPENSSL_BN_ASM_MONT5<span class="w"> </span>-DOPENSSL_BN_ASM_GF2m<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DKECCAK1600_ASM<span class="w"> </span>-DRC4_ASM<span class="w"> </span>-DMD5_ASM<span class="w"> </span>-DAESNI_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DGHASH_ASM<span class="w"> </span>-DECP_NISTZ256_ASM<span class="w"> </span>-DX25519_ASM<span class="w"> </span>-DPOLY1305_ASM<span class="w"> </span>-DNDEBUG<span class="w"> </span>-Wdate-time<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span>
</span><span id="__span-4-46"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-46" id="__codelineno-4-46" name="__codelineno-4-46"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-47"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-47" id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes<span class="w">  </span><span class="m">16384</span><span class="w"> </span>bytes
</span><span id="__span-4-48"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-48" id="__codelineno-4-48" name="__codelineno-4-48"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">20850</span>.88k<span class="w">    </span><span class="m">21260</span>.78k<span class="w">    </span><span class="m">21315</span>.84k<span class="w">    </span><span class="m">21368</span>.49k<span class="w">    </span><span class="m">21321</span>.05k<span class="w">    </span><span class="m">21392</span>.04k
</span><span id="__span-4-49"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-49" id="__codelineno-4-49" name="__codelineno-4-49"></a>aes-256<span class="w"> </span>cbc<span class="w">     </span><span class="m">122059</span>.94k<span class="w">   </span><span class="m">125701</span>.42k<span class="w">   </span><span class="m">126591</span>.06k<span class="w">   </span><span class="m">126770</span>.52k<span class="w">   </span><span class="m">127049</span>.73k<span class="w">   </span><span class="m">126937</span>.77k
</span><span id="__span-4-50"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-50" id="__codelineno-4-50" name="__codelineno-4-50"></a>aes-128-cbc<span class="w">     </span><span class="m">441625</span>.34k<span class="w">   </span><span class="m">883733</span>.48k<span class="w">   </span><span class="m">928208</span>.21k<span class="w">   </span><span class="m">941480</span>.96k<span class="w">   </span><span class="m">944889</span>.86k<span class="w">   </span><span class="m">945307</span>.65k
</span><span id="__span-4-51"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-51" id="__codelineno-4-51" name="__codelineno-4-51"></a>sha256<span class="w">          </span><span class="m">151161</span>.13k<span class="w">   </span><span class="m">388304</span>.60k<span class="w">   </span><span class="m">809272</span>.15k<span class="w">  </span><span class="m">1106645</span>.33k<span class="w">  </span><span class="m">1238966</span>.27k<span class="w">  </span><span class="m">1249219</span>.93k
</span><span id="__span-4-52"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-52" id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-53"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-53" id="__codelineno-4-53" name="__codelineno-4-53"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.001096s<span class="w"> </span><span class="m">0</span>.000033s<span class="w">    </span><span class="m">912</span>.8<span class="w">  </span><span class="m">30284</span>.7
</span><span id="__span-4-54"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-54" id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="c1">## Intel Xeon E5-2699 v4 (Broadwell)</span>
</span><span id="__span-4-55"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-55" id="__codelineno-4-55" name="__codelineno-4-55"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.0.2u<span class="w">  </span><span class="m">20</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2019</span>
</span><span id="__span-4-56"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-56" id="__codelineno-4-56" name="__codelineno-4-56"></a>built<span class="w"> </span>on:<span class="w"> </span>reproducible<span class="w"> </span>build,<span class="w"> </span>date<span class="w"> </span>unspecified
</span><span id="__span-4-57"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-57" id="__codelineno-4-57" name="__codelineno-4-57"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>16x,int<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>idx,cisc,16,int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>idea<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>idx<span class="o">)</span>
</span><span id="__span-4-58"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-58" id="__codelineno-4-58" name="__codelineno-4-58"></a>compiler:<span class="w"> </span>gcc<span class="w"> </span>-I.<span class="w"> </span>-I..<span class="w"> </span>-I../include<span class="w">  </span>-fPIC<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_THREADS<span class="w"> </span>-D_REENTRANT<span class="w"> </span>-DDSO_DLFCN<span class="w"> </span>-DHAVE_DLFCN_H<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-m64<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-O3<span class="w"> </span>-Wall<span class="w"> </span>-DOPENSSL_IA32_SSE2<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DOPENSSL_BN_ASM_MONT5<span class="w"> </span>-DOPENSSL_BN_ASM_GF2m<span class="w"> </span>-DRC4_ASM<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DMD5_ASM<span class="w"> </span>-DAES_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DBSAES_ASM<span class="w"> </span>-DWHIRLPOOL_ASM<span class="w"> </span>-DGHASH_ASM<span class="w"> </span>-DECP_NISTZ256_ASM
</span><span id="__span-4-59"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-59" id="__codelineno-4-59" name="__codelineno-4-59"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-60"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-60" id="__codelineno-4-60" name="__codelineno-4-60"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes
</span><span id="__span-4-61"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-61" id="__codelineno-4-61" name="__codelineno-4-61"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">29863</span>.80k<span class="w">    </span><span class="m">30156</span>.69k<span class="w">    </span><span class="m">30243</span>.07k<span class="w">    </span><span class="m">30237</span>.70k<span class="w">    </span><span class="m">30302</span>.21k
</span><span id="__span-4-62"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-62" id="__codelineno-4-62" name="__codelineno-4-62"></a>aes-256<span class="w"> </span>cbc<span class="w">     </span><span class="m">103491</span>.45k<span class="w">   </span><span class="m">110240</span>.94k<span class="w">   </span><span class="m">112029</span>.95k<span class="w">   </span><span class="m">112400</span>.38k<span class="w">   </span><span class="m">112833</span>.88k
</span><span id="__span-4-63"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-63" id="__codelineno-4-63" name="__codelineno-4-63"></a>aes-128-cbc<span class="w">     </span><span class="m">734225</span>.68k<span class="w">   </span><span class="m">788483</span>.88k<span class="w">   </span><span class="m">802857</span>.39k<span class="w">   </span><span class="m">805860</span>.69k<span class="w">   </span><span class="m">807848</span>.62k
</span><span id="__span-4-64"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-64" id="__codelineno-4-64" name="__codelineno-4-64"></a>sha256<span class="w">           </span><span class="m">82720</span>.89k<span class="w">   </span><span class="m">184528</span>.45k<span class="w">   </span><span class="m">342888</span>.28k<span class="w">   </span><span class="m">425826</span>.30k<span class="w">   </span><span class="m">457149</span>.10k
</span><span id="__span-4-65"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-65" id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-66"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-66" id="__codelineno-4-66" name="__codelineno-4-66"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.000573s<span class="w"> </span><span class="m">0</span>.000017s<span class="w">   </span><span class="m">1745</span>.5<span class="w">  </span><span class="m">60236</span>.3
</span><span id="__span-4-67"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-67" id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="c1">## Intel Xeon E5-2680 v4 (Broadwell) TODO</span>
</span><span id="__span-4-68"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-68" id="__codelineno-4-68" name="__codelineno-4-68"></a><span class="c1">## Intel Xeon Gold 5218 (Cascade Lake) TODO</span>
</span><span id="__span-4-69"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-69" id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="c1">## IBM POWER8NVL</span>
</span><span id="__span-4-70"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-70" id="__codelineno-4-70" name="__codelineno-4-70"></a>OpenSSL<span class="w"> </span><span class="m">1</span>.1.1<span class="w">  </span><span class="m">11</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2018</span>
</span><span id="__span-4-71"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-71" id="__codelineno-4-71" name="__codelineno-4-71"></a>built<span class="w"> </span>on:<span class="w"> </span>Wed<span class="w"> </span>Feb<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">12</span>:35:54<span class="w"> </span><span class="m">2021</span><span class="w"> </span>UTC
</span><span id="__span-4-72"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-72" id="__codelineno-4-72" name="__codelineno-4-72"></a>options:bn<span class="o">(</span><span class="m">64</span>,64<span class="o">)</span><span class="w"> </span>rc4<span class="o">(</span>char<span class="o">)</span><span class="w"> </span>des<span class="o">(</span>int<span class="o">)</span><span class="w"> </span>aes<span class="o">(</span>partial<span class="o">)</span><span class="w"> </span>blowfish<span class="o">(</span>ptr<span class="o">)</span>
</span><span id="__span-4-73"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-73" id="__codelineno-4-73" name="__codelineno-4-73"></a>compiler:<span class="w"> </span>gcc<span class="w"> </span>-fPIC<span class="w"> </span>-pthread<span class="w"> </span>-m64<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-Wall<span class="w"> </span>-Wa,--noexecstack<span class="w"> </span>-g<span class="w"> </span>-O3<span class="w"> </span>-fdebug-prefix-map<span class="o">=</span>/build/openssl-avwOZX/openssl-1.1.1<span class="o">=</span>.<span class="w"> </span>-fstack-protector-strong<span class="w"> </span>-Wformat<span class="w"> </span>-Werror<span class="o">=</span>format-security<span class="w"> </span>-DOPENSSL_USE_NODELETE<span class="w"> </span>-DL_ENDIAN<span class="w"> </span>-DOPENSSL_PIC<span class="w"> </span>-DOPENSSL_CPUID_OBJ<span class="w"> </span>-DOPENSSL_BN_ASM_MONT<span class="w"> </span>-DSHA1_ASM<span class="w"> </span>-DSHA256_ASM<span class="w"> </span>-DSHA512_ASM<span class="w"> </span>-DKECCAK1600_ASM<span class="w"> </span>-DAES_ASM<span class="w"> </span>-DVPAES_ASM<span class="w"> </span>-DECP_NISTZ256_ASM<span class="w"> </span>-DX25519_ASM<span class="w"> </span>-DPOLY1305_ASM<span class="w"> </span>-DNDEBUG<span class="w"> </span>-Wdate-time<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span>
</span><span id="__span-4-74"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-74" id="__codelineno-4-74" name="__codelineno-4-74"></a>The<span class="w"> </span><span class="s1">'numbers'</span><span class="w"> </span>are<span class="w"> </span><span class="k">in</span><span class="w"> </span>1000s<span class="w"> </span>of<span class="w"> </span>bytes<span class="w"> </span>per<span class="w"> </span>second<span class="w"> </span>processed.
</span><span id="__span-4-75"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-75" id="__codelineno-4-75" name="__codelineno-4-75"></a><span class="nb">type</span><span class="w">             </span><span class="m">16</span><span class="w"> </span>bytes<span class="w">     </span><span class="m">64</span><span class="w"> </span>bytes<span class="w">    </span><span class="m">256</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">1024</span><span class="w"> </span>bytes<span class="w">   </span><span class="m">8192</span><span class="w"> </span>bytes<span class="w">  </span><span class="m">16384</span><span class="w"> </span>bytes
</span><span id="__span-4-76"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-76" id="__codelineno-4-76" name="__codelineno-4-76"></a>des<span class="w"> </span>ede3<span class="w">         </span><span class="m">25120</span>.65k<span class="w">    </span><span class="m">25479</span>.70k<span class="w">    </span><span class="m">25570</span>.13k<span class="w">    </span><span class="m">25604</span>.10k<span class="w">    </span><span class="m">25616</span>.38k<span class="w">    </span><span class="m">25613</span>.65k
</span><span id="__span-4-77"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-77" id="__codelineno-4-77" name="__codelineno-4-77"></a>aes-256<span class="w"> </span>cbc<span class="w">      </span><span class="m">79140</span>.44k<span class="w">    </span><span class="m">82350</span>.23k<span class="w">    </span><span class="m">83815</span>.94k<span class="w">    </span><span class="m">84183</span>.72k<span class="w">    </span><span class="m">84290</span>.22k<span class="w">    </span><span class="m">84306</span>.60k
</span><span id="__span-4-78"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-78" id="__codelineno-4-78" name="__codelineno-4-78"></a>aes-128-cbc<span class="w">     </span><span class="m">310027</span>.28k<span class="w">   </span><span class="m">647168</span>.64k<span class="w">   </span><span class="m">890896</span>.81k<span class="w">   </span><span class="m">984001</span>.19k<span class="w">  </span><span class="m">1014827</span>.69k<span class="w">  </span><span class="m">1017096</span>.87k
</span><span id="__span-4-79"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-79" id="__codelineno-4-79" name="__codelineno-4-79"></a>sha256<span class="w">           </span><span class="m">58347</span>.98k<span class="w">   </span><span class="m">151006</span>.68k<span class="w">   </span><span class="m">286465</span>.28k<span class="w">   </span><span class="m">373490</span>.69k<span class="w">   </span><span class="m">411044</span>.52k<span class="w">   </span><span class="m">414012</span>.76k
</span><span id="__span-4-80"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-80" id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="w">                  </span>sign<span class="w">    </span>verify<span class="w">    </span>sign/s<span class="w"> </span>verify/s
</span><span id="__span-4-81"><a href="../../hardware/2020/11/19/arm-m1-macbookair/#__codelineno-4-81" id="__codelineno-4-81" name="__codelineno-4-81"></a>rsa<span class="w"> </span><span class="m">2048</span><span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.001442s<span class="w"> </span><span class="m">0</span>.000040s<span class="w">    </span><span class="m">693</span>.5<span class="w">  </span><span class="m">25212</span>.7
</span></code></pre></div>
<h3 id="_7"><a class="toclink" href="../../hardware/2020/11/19/arm-m1-macbookair/#_7">总结</a></h3>
<p>总的来说，还是挺香的。不错的性能，没有风扇的喧闹，没有烫手的键盘。可能有少部分软件还不能正常运行，然后很多程序还需要 Rosetta 翻译，但目前来看兼容性还是挺不错的，并且这些应该明年就都适配地差不多了吧。</p>
<nav class="md-post__action">
<a href="../../hardware/2020/11/19/arm-m1-macbookair/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-11-08 00:00:00">2020年11月8日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/software/">software</a></li>
<li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="spack-external-slurm-openmpi"><a class="toclink" href="../../software/2020/11/08/spack-openmpi-slurm-external/">在 Spack 中用 external 的 Slurm 依赖编译 OpenMPI</a></h2>
<p>最近在一个集群上，需要用一个自己编译的 openmpi，但并没有 root 权限，所以需要自己搞一个 spack，在 spack 里面装 openmpi。但默认的安装选项下，它没有打开 slurm 支持，所以 srun 的话会出问题，只能 sbatch 然后指定 host 去做。于是我研究了一下怎么在 spack 里引入 external 的 slurm，然后用它来编译 openmpi</p>
<p>首先，编译 <code>~/.spack/packages.yaml</code>：</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">packages</span><span class="p">:</span>
</span><span id="__span-0-2"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">slurm</span><span class="p">:</span>
</span><span id="__span-0-3"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nt">buildable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</span><span id="__span-0-4"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-0-5"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">      </span><span class="s">"slurm@15-08-7-1%gcc@8.3.0</span><span class="nv"> </span><span class="s">arch=linux-ubuntu16.04-haswell"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr</span>
</span></code></pre></div>
<p>这里 slurm 版本是 <code>15.08.7</code>，我就按照 spack 里面 slurm 的版本号来写了。可以用 <code>spack spec openmpi schedulers=slurm +pmi</code> 来确认一下外部的 slurm 确实出现在了依赖之中。</p>
<p>这一步配好的话，安装的时候就会直接跳过 spack 里面 slurm 的安装。但又出现了 configure 错误，找不到 pmi 的库。于是，先用 external 的 mpirun 看一下配置：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>openmpi-3.0.0
</span><span id="__span-1-2"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>$<span class="w"> </span>ompi_info
</span><span id="__span-1-3"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>...
</span><span id="__span-1-4"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>--with-pmi<span class="o">=</span>/usr
</span><span id="__span-1-5"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>--with-pmi-libdir<span class="o">=</span>/usr/lib/x86_64-linux-gnu
</span><span id="__span-1-6"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>...
</span></code></pre></div>
<p>可以看到，需要两个 config 参数。然后，在 spack 的 openmpi package.py 中：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'schedulers=slurm'</span><span class="p">):</span>
</span><span id="__span-2-2"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>  <span class="n">config_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'--with-pmi=</span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">'slurm'</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="p">))</span>
</span><span id="__span-2-3"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>  <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'@3.1.3:'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'@3.0.3'</span><span class="p">):</span>
</span><span id="__span-2-4"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="k">if</span> <span class="s1">'+static'</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
</span><span id="__span-2-5"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>      <span class="n">config_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'--enable-static'</span><span class="p">)</span>
</span></code></pre></div>
<p>所以，需要加一个小 patch：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'schedulers=slurm'</span><span class="p">):</span>
</span><span id="__span-3-2"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>  <span class="n">config_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'--with-pmi=</span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">'slurm'</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="p">))</span>
</span><span id="__span-3-3"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>  <span class="c1"># patched here</span>
</span><span id="__span-3-4"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>  <span class="n">config_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'--with-pmi-libdir=</span><span class="si">{0}</span><span class="s1">/lib/x86_64-linux-gnu'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">'slurm'</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="p">))</span>
</span><span id="__span-3-5"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>  <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'@3.1.3:'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">'@3.0.3'</span><span class="p">):</span>
</span><span id="__span-3-6"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">if</span> <span class="s1">'+static'</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
</span><span id="__span-3-7"><a href="../../software/2020/11/08/spack-openmpi-slurm-external/#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>      <span class="n">config_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'--enable-static'</span><span class="p">)</span>
</span></code></pre></div>
<p>然后，就可以编译通过了。</p>
<nav class="md-post__action">
<a href="../../software/2020/11/08/spack-openmpi-slurm-external/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-10-18 00:00:00">2020年10月18日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/devops/">devops</a></li>
<li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="esxi-vcsa-7"><a class="toclink" href="../../devops/2020/10/18/deploy-esxi-vcsa-7/">在裸机上部署 ESXi 和 vCSA 7</a></h2>
<p>之前在另一篇文章里提到过 vCSA 的安装，这次又在另一台机器上重新做了一遍，特此记录一下。</p>
<p>首先在官网上下载 <a href="https://my.vmware.com/group/vmware/evalcenter?p=vsphere-eval-7">ESXi+VCSA 7.0</a> ，应该得到两个文件：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../devops/2020/10/18/deploy-esxi-vcsa-7/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>7.9G VMware-VCSA-all-7.0.1-16860138.iso
</span><span id="__span-0-2"><a href="../../devops/2020/10/18/deploy-esxi-vcsa-7/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>358M VMware-VMvisor-Installer-7.0U1-16850804.x86_64.iso
</span></code></pre></div>
<p>首先安装 ESXi，用 UNetBootin 制作 ESXi 的安装光盘。注意不能用 dd，因为它是 CDFS 格式的，不能直接 boot。启动以后，按照界面要求，一路安装即可。</p>
<p>接着，就可以用网页访问 ESXi 进行配置。比如安装一些 Linux 发行版，然后在 Linux 虚拟机里面 mount 上面的 VCSA 的 iso：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../devops/2020/10/18/deploy-esxi-vcsa-7/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sr0<span class="w"> </span>/mnt
</span></code></pre></div>
<p>接着，复制并修改 <code>/mnt/vcsa-cli-installer/templates/install/embedded_vCSA_on_ESi.json</code>，按照代码注释进行修改。需要注意几点：</p>
<ol>
<li>密码都可以设为空，然后运行 cli 的时候输入</li>
<li>ESXi 的密码和 vCSA 的密码是不一样的</li>
<li>可以把 ceip 关掉，设置 ceip_enabled: false</li>
</ol>
<p>接着，进行安装：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../devops/2020/10/18/deploy-esxi-vcsa-7/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>/mnt/vcsa-cli-installer/lin64/vcsa-deploy<span class="w"> </span>install<span class="w"> </span>--accept-eula<span class="w"> </span>/path/to/customized.json<span class="w"> </span>-v
</span></code></pre></div>
<p>慢慢等待它安装成功即可。</p>
<p>安装完成后，进入 vCSA，新建一个 Datacenter，然后选择新建的 Datacenter，选择 Add host，输入 ESXi 的地址和用户密码信息即可。</p>
<nav class="md-post__action">
<a href="../../devops/2020/10/18/deploy-esxi-vcsa-7/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-10-09 00:00:00">2020年10月9日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/system/">system</a></li>
<li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="ibm-power-s822lc8335-gtb-bmc"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/">IBM Power S822LC(8335-GTB) BMC 升级</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_1">背景</a></h3>
<p>最近拿到一台 IBM Power S822LC（8335-GTB）机器的访问权限，这也是我第一次碰 ppc64le 指令集的服务器。然后发现，它的 BMC 版本比较老，我想连接 Remote Control 失败了，原因是 JViewer 不支持 macOS，我就想着能不能升级一下。</p>
<h3 id="_2"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_2">升级过程</a></h3>
<p>首先，在网上找了一下文档，首先用 ipmitool 找一下机器型号：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">3</span>
</span><span id="__span-0-2"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w"> </span>Chassis<span class="w"> </span>Type<span class="w">          </span>:<span class="w"> </span>Unknown
</span><span id="__span-0-3"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w"> </span>Chassis<span class="w"> </span>Part<span class="w"> </span>Number<span class="w">   </span>:<span class="w"> </span><span class="m">8335</span>-GTB
</span><span id="__span-0-4"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w"> </span>Chassis<span class="w"> </span>Serial<span class="w">        </span>:<span class="w"> </span>REDACTED
</span></code></pre></div>
<p>可以看到，这台机器是 8335-GTB 型号，按照这个型号在 <a href="https://www.ibm.com/support/fixcentral">Fix Central</a> 上搜索，可以找到若干个版本的 firmware，其中最老的版本是 <code>OP8_v1.11_2.1</code>，对比了一下，和原来的版本一致：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">47</span>
</span><span id="__span-1-2"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w"> </span>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-1-3"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-ibm-OP8_v1.11_2.1
</span><span id="__span-1-4"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-da02863
</span><span id="__span-1-5"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-81b8d98
</span><span id="__span-1-6"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-5.3.6
</span><span id="__span-1-7"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-1f6784d-3408af7
</span><span id="__span-1-8"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-4.4.16-openpower1-bc83f92
</span><span id="__span-1-9"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.2.4-de6cda2
</span><span id="__span-1-10"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>garrison-xml-3db7b6e
</span><span id="__span-1-11"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-69fb587
</span><span id="__span-1-12"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-binar
</span></code></pre></div>
<p>于是，我下载了比较新的版本，一个 hpm 文件，然后在 BMC 网页上进行升级。第一次升级比较保守，选择了 2017 年的版本：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">47</span>
</span><span id="__span-2-2"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-2-3"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-ibm-OP8_v1.12_2.72
</span><span id="__span-2-4"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-14a75d0
</span><span id="__span-2-5"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-211bd05
</span><span id="__span-2-6"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-5.4.3
</span><span id="__span-2-7"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-2eb7706-69b1432
</span><span id="__span-2-8"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-4.4.30-openpower1-084eb48
</span><span id="__span-2-9"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.3.2-d709207
</span><span id="__span-2-10"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>garrison-xml-19a5164
</span><span id="__span-2-11"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-d7efe30-47b58cb
</span><span id="__span-2-12"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostb
</span></code></pre></div>
<p>这次升级比较顺利，没有遇到什么障碍。但是我发现，BMC 里面显示的 BIOS 版本和 hpm 对不上，它总是认为 BIOS 版本是落后的，需要更新，而 Firmware 部分（BOOT 和 APP）是更新后的版本。但 BIOS 版本和原来的版本也不一样。于是我重新升级了几次，都没有效果，怀疑是升级出了问题。后来仔细读文档才发现，确实是 BMC 软件的问题（<a href="https://ak-delivery04-mul.dhe.ibm.com/sar/CMA/SFA/08cu1/0/8335GTB_820.1923.20190613n.xhtml">文档</a>）：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>Note: BMC Dashboard shows an incorrect level for the BIOS caused by improper translation of the level subfields. The Bios number should reflect the PNOR level for the system of "IBM-garrison-ibm-OP8_v1.11_2.19". In this case, the BIOS version should be 1.11_2.19 but shows as 1.17.19 instead with the "11_2" converted into the "17".
</span><span id="__span-3-2"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
</span><span id="__span-3-3"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>The Firmware Revision for the BMC firmware shows correctly as "2.13.58".
</span><span id="__span-3-4"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>
</span><span id="__span-3-5"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>Here is an example output of the Dashboard with an errant BIOS Version:
</span><span id="__span-3-6"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>
</span><span id="__span-3-7"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>Dashboard gives the overall information about the status of the device and remote server.
</span><span id="__span-3-8"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
</span><span id="__span-3-9"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>Device Information
</span><span id="__span-3-10"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>
</span><span id="__span-3-11"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>Firmware Revision: 2.13.58
</span><span id="__span-3-12"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>
</span><span id="__span-3-13"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>Firmware Build Time: Oct 26 2016 11:40:55 CDT
</span><span id="__span-3-14"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>
</span><span id="__span-3-15"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>BIOS Version: 1.17.19
</span></code></pre></div>
<p>一番捣鼓之后，不知道怎么了，BMC 就挂了，怎么访问都不通。只好物理断电，重新来过。按照同样的方法，升级到了 2019 年的版本：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="w"> </span>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-4-2"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-OP8_v1.12_2.96
</span><span id="__span-4-3"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-v2.3-7-g99a6bc8
</span><span id="__span-4-4"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-2019.02.1-16-ge01dcd0
</span><span id="__span-4-5"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-v6.3.1
</span><span id="__span-4-6"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-p8-c893515-pd6f049d
</span><span id="__span-4-7"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-p8-a2856b7
</span><span id="__span-4-8"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-5.0.7-openpower1-p8e31f00
</span><span id="__span-4-9"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.10.3
</span><span id="__span-4-10"><a href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>machine-xml-c5c3
</span></code></pre></div>
<p>中途也遇到了几次奇怪的问题，多次通过 IPMI reset 之后就好了。</p>
<h3 id="_3"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_3">远程访问</a></h3>
<p>但是，最新版的 BMC 固件中，JViewer 依然没有 macOS 支持。我也 SSH 进去确认了一下，确实没有对应的支持文件。只好在 Linux 机器上访问，安装 icedtea 以后，就可以打开 jnlp 文件，之后一切都很正常。</p>
<p>一个可能的替代方案：https://github.com/sciapp/nojava-ipmi-kvm</p>
<nav class="md-post__action">
<a href="../../system/2020/10/09/upgrade-power8-bmc/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-09-13 00:00:00">2020年9月13日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/programming/">programming</a></li>
<li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="arm64-rust-analyzer"><a class="toclink" href="../../programming/2020/09/13/aarch64-rust-analyzer/">在 arm64 上使用 rust-analyzer</a></h2>
<p>远程到 arm64 的机器上进行开发，发现没有 rust-analyzer 的支持。研究了一下，发现在 rustup 里面可以找到，不过要配置一下：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../programming/2020/09/13/aarch64-rust-analyzer/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>&gt;<span class="w"> </span>rustup<span class="w"> </span>toolchain<span class="w"> </span>add<span class="w"> </span>nightly
</span><span id="__span-0-2"><a href="../../programming/2020/09/13/aarch64-rust-analyzer/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>&gt;<span class="w"> </span>rustup<span class="w"> </span>component<span class="w"> </span>add<span class="w"> </span>--toolchain<span class="w"> </span>nightly<span class="w"> </span>rust-analyzer-preview
</span></code></pre></div>
<p>这个时候，应该可以找到 <code>~/.rustup/toolchains/nightly-aarch64-unknown-linux-gnu/bin/rust-analyzer</code> 文件，接下来，配置 VSCode 插件即可：</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../programming/2020/09/13/aarch64-rust-analyzer/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a href="../../programming/2020/09/13/aarch64-rust-analyzer/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nt">"rust-analyzer.serverPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~/.rustup/toolchains/nightly-aarch64-unknown-linux-gnu/bin/rust-analyzer"</span>
</span><span id="__span-1-3"><a href="../../programming/2020/09/13/aarch64-rust-analyzer/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="p">}</span>
</span></code></pre></div>
<p>路径在 <code>~/.vscode-server/data/Machine/settings.json</code>。</p>
<p>参考：https://github.com/rust-analyzer/rust-analyzer/issues/5256</p>
<nav class="md-post__action">
<a href="../../programming/2020/09/13/aarch64-rust-analyzer/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-09-12 00:00:00">2020年9月12日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/devops/">devops</a></li>
<li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="rpi4-buildroot"><a class="toclink" href="../../devops/2020/09/12/buildroot-rpi-pxe/">在 Rpi4 上运行 buildroot</a></h2>
<h3 id="_1"><a class="toclink" href="../../devops/2020/09/12/buildroot-rpi-pxe/#_1">背景</a></h3>
<p>需要给 rpi 配置一个 pxe 的最小环境，在上一篇博文了提到可以用 alpine，但发现有一些不好用的地方，所以试了试 buildroot。</p>
<h3 id="pxe"><a class="toclink" href="../../devops/2020/09/12/buildroot-rpi-pxe/#pxe">PXE 设置和路由器设置</a></h3>
<p>见“在 Rpi4 上运行 Alpine Linux”文章。</p>
<h3 id="buildroot"><a class="toclink" href="../../devops/2020/09/12/buildroot-rpi-pxe/#buildroot">Buildroot 配置</a></h3>
<p>下载 buildroot：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>&gt;<span class="w"> </span>wget<span class="w"> </span>https://buildroot.org/downloads/buildroot-2020.08.tar.gz
</span><span id="__span-0-2"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>&gt;<span class="w"> </span>unar<span class="w"> </span>buildroot-2020.08.tar.gz
</span><span id="__span-0-3"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>buildroot-2020.08
</span><span id="__span-0-4"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>&gt;<span class="w"> </span>make<span class="w"> </span>raspberrypi4_64_defconfig
</span></code></pre></div>
<p>然后运行 <code>make menuconfig</code> ，在 <code>Filesystem images</code> 中打开 initramfs，并设置 cpio 压缩为 gz。然后直接编译：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>&gt;<span class="w"> </span>make<span class="w"> </span>-j4
</span><span id="__span-1-2"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>$<span class="w"> </span>ls<span class="w"> </span>-al<span class="w"> </span>target/images
</span><span id="__span-1-3"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>bcm2711-rpi-4-b.dtb*<span class="w">  </span>boot.vfat<span class="w">  </span>Image<span class="w">  </span>rootfs.cpio<span class="w">  </span>rootfs.cpio.gz<span class="w">  </span>rootfs.ext2<span class="w">  </span>rootfs.ext4@<span class="w">  </span>rpi-firmware/<span class="w">  </span>sdcard.img
</span></code></pre></div>
<p>接着，在一个单独的目录里，把这些文件整理一下</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/rpi-buildroot
</span><span id="__span-2-2"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>&gt;<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>~/buildroot-2020.08/output/images/rpi-firmware/*<span class="w"> </span>.
</span><span id="__span-2-3"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>&gt;<span class="w"> </span>cp<span class="w"> </span>~/buildroot-2020.08/output/images/bcm2711-rpi-4-b.dtb<span class="w"> </span>.
</span><span id="__span-2-4"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>&gt;<span class="w"> </span>cp<span class="w"> </span>~/buildroot-2020.08/output/images/Image<span class="w"> </span>.
</span><span id="__span-2-5"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>&gt;<span class="w"> </span>cp<span class="w"> </span>~/buildroot-2020.08/output/images/rootfs.cpio.gz<span class="w"> </span>.
</span><span id="__span-2-6"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>&gt;<span class="w"> </span><span class="c1"># edit cmdline.txt: remove root= and rootwait</span>
</span><span id="__span-2-7"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>&gt;<span class="w"> </span><span class="c1"># edit config.txt: uncomment initramfs rootfs.cpio.gz line</span>
</span><span id="__span-2-8"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="c1">## ls</span>
</span><span id="__span-2-9"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>bcm2711-rpi-4-b.dtb*<span class="w">  </span>cmdline.txt<span class="w">  </span>config.txt<span class="w">  </span>fixup.dat<span class="w">  </span>Image<span class="w">  </span>overlays/<span class="w">  </span>rootfs.cpio.gz<span class="w">  </span>start.elf
</span></code></pre></div>
<p>最后开启 TFTP 服务器即可：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>&gt;<span class="w"> </span>sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>py3tftp<span class="w"> </span>-p<span class="w"> </span><span class="m">69</span>
</span></code></pre></div>
<h3 id="_2"><a class="toclink" href="../../devops/2020/09/12/buildroot-rpi-pxe/#_2">树莓派启动</a></h3>
<p>连接树莓派的串口，用 115200 Baudrate 打开，可以看到启动信息：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>PM_RSTS: 0x00001000
</span><span id="__span-4-2"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>RPi: BOOTLOADER release VERSION:a5e1b95f DATE: Apr 16 2020 TIME: 18:11:29 BOOTMODE: 0x00000006 part: 0 BUILD_TIMESTAMP=1587057086 0xa049cc2f 0x00c03111
</span><span id="__span-4-3"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>uSD voltage 3.3V
</span><span id="__span-4-4"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>... 
</span><span id="__span-4-5"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>Welcome to Buildroot
</span><span id="__span-4-6"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>buildroot login: root
</span><span id="__span-4-7"><a href="../../devops/2020/09/12/buildroot-rpi-pxe/#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>##
</span></code></pre></div>
<p>默认用户是 root，没有密码。</p>
<nav class="md-post__action">
<a href="../../devops/2020/09/12/buildroot-rpi-pxe/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-09-11 00:00:00">2020年9月11日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/devops/">devops</a></li>
<li class="md-meta__item">
            
              需要 3 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="rpi4-pxe-alpine-linux"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/">在 rpi4 上用 PXE 运行 Alpine Linux</a></h2>
<h3 id="_1"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/#_1">背景</a></h3>
<p>需要给 rpi 配置一个 pxe 的最小环境，然后看到 alpine 有 rpi 的支持，所以尝试给 rpi4 配置 alpine。</p>
<h3 id="pxe"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/#pxe">PXE 设置</a></h3>
<p>第一步是设置 rpi4 的启动模式，打开 BOOT UART 并且打开 网络启动：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/lib/firmware/raspberrypi/bootloader/critical
</span><span id="__span-0-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>&gt;<span class="w"> </span>rpi-eeprom-config<span class="w"> </span>pieeprom-2021-04-29.bin<span class="w"> </span>&gt;<span class="w"> </span>config.txt
</span><span id="__span-0-3"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>$<span class="w"> </span>cat<span class="w"> </span>config.txt
</span><span id="__span-0-4"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="o">[</span>all<span class="o">]</span>
</span><span id="__span-0-5"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="nv">BOOT_UART</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-0-6"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="nv">WAKE_ON_GPIO</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-0-7"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="nv">POWER_OFF_ON_HALT</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-0-8"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="nv">DHCP_TIMEOUT</span><span class="o">=</span><span class="m">45000</span>
</span><span id="__span-0-9"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="nv">DHCP_REQ_TIMEOUT</span><span class="o">=</span><span class="m">4000</span>
</span><span id="__span-0-10"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="nv">TFTP_FILE_TIMEOUT</span><span class="o">=</span><span class="m">30000</span>
</span><span id="__span-0-11"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="nv">TFTP_IP</span><span class="o">=</span>
</span><span id="__span-0-12"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="nv">TFTP_PREFIX</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-0-13"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="nv">BOOT_ORDER</span><span class="o">=</span>0x1
</span><span id="__span-0-14"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="nv">SD_BOOT_MAX_RETRIES</span><span class="o">=</span><span class="m">3</span>
</span><span id="__span-0-15"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="nv">NET_BOOT_MAX_RETRIES</span><span class="o">=</span><span class="m">5</span>
</span><span id="__span-0-16"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="o">[</span>none<span class="o">]</span>
</span><span id="__span-0-17"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="nv">FREEZE_VERSION</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-0-18"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>&gt;<span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/BOOT_UART=0/BOOT_UART=1/;s/BOOT_ORDER=0x1/BOOR_ORDER=0x12/'</span><span class="w"> </span>config.txt<span class="w"> </span>&gt;<span class="w"> </span>config-pxe.txt
</span><span id="__span-0-19"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>&gt;<span class="w"> </span>rpi-eeprom-config<span class="w"> </span>--out<span class="w"> </span>pieeprom-2021-04-29-pxe.bin<span class="w"> </span>--config<span class="w"> </span>config-pxe.txt<span class="w"> </span>pieeprom-2021-04-29.bin
</span><span id="__span-0-20"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>&gt;<span class="w"> </span>rpi-eeprom-update<span class="w"> </span>-d<span class="w"> </span>-f<span class="w"> </span>pieeprom-2021-04-29-pxe.bin
</span><span id="__span-0-21"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>&gt;<span class="w"> </span>reboot
</span></code></pre></div>
<p>重启以后，可以用 <code>vcgencmd bootloader_config</code> 查看当前的启动配置，看是否正确地更新了启动配置。比较重要的是 BOOT_ORDER，<code>0x12</code> 表示先尝试网络启动，再尝试 SD 卡启动。</p>
<h3 id="_2"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/#_2">路由器配置</a></h3>
<p>第二步，需要配置路由器，以 OpenWrt 为例：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>&gt;<span class="w"> </span>uci<span class="w"> </span>add_list<span class="w"> </span>dhcp.lan.dhcp_option<span class="o">=</span><span class="s2">"66,ip_address_of_tftp_server"</span>
</span><span id="__span-1-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>&gt;<span class="w"> </span>uci<span class="w"> </span>commit<span class="w"> </span>dhcp
</span><span id="__span-1-3"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>&gt;<span class="w"> </span>/etc/init.d/dnsmasq<span class="w"> </span>restart
</span><span id="__span-1-4"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>$<span class="w"> </span>cat<span class="w"> </span>/etc/config/dhcp
</span><span id="__span-1-5"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>...
</span><span id="__span-1-6"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-1-7"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">        </span>...
</span><span id="__span-1-8"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span>list<span class="w"> </span>dhcp_option<span class="w"> </span><span class="s1">'66,ip_address_of_tftp_server'</span>
</span><span id="__span-1-9"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>...
</span></code></pre></div>
<p>这样就配置完毕了。如果是 isc-dhcp-server，修改 <code>/etc/dhcp/dhcpd.conf</code>：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>subnet 10.0.1.0 netmask 255.255.255.0 {
</span><span id="__span-2-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    range 10.0.1.100 10.0.1.199;
</span><span id="__span-2-3"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>    option routers 10.0.1.1;
</span><span id="__span-2-4"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    option tftp-server-name "10.0.1.1";
</span><span id="__span-2-5"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>}
</span></code></pre></div>
<h3 id="tftp"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/#tftp">TFTP 服务器配置</a></h3>
<p>下载 alpine linux 的 rpi boot，解压到指定目录：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>&gt;<span class="w"> </span>wget<span class="w"> </span>http://mirrors.tuna.tsinghua.edu.cn/alpine/v3.12/releases/aarch64/alpine-rpi-3.12.0-aarch64.tar.gz
</span><span id="__span-3-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>&gt;<span class="w"> </span>unar<span class="w"> </span>alpine-rpi-3.12.0-aarch64.tar.gz
</span><span id="__span-3-3"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>alpine-rpi-3.12.0-aarch64
</span></code></pre></div>
<p>修改 <code>cmdline.txt</code> ，把 <code>console=tty1</code> 改成 <code>console=ttyAMA0,115200</code>，并且去掉 <code>quiet</code>；修改 <code>usercfg.txt</code> 为：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>dtoverlay=disable-bt
</span><span id="__span-4-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>enable_uart=1
</span></code></pre></div>
<p>接着，启动 TFTP 服务器：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>&gt;<span class="w"> </span>sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>py3tftp<span class="w"> </span>-p<span class="w"> </span><span class="m">69</span>
</span></code></pre></div>
<h3 id="_3"><a class="toclink" href="../../devops/2020/09/11/alpine-rpi-pxe/#_3">树莓派启动</a></h3>
<p>连接树莓派的串口，用 115200 Baudrate 打开，可以看到启动信息：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>PM_RSTS: 0x00001000
</span><span id="__span-6-2"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>RPi: BOOTLOADER release VERSION:a5e1b95f DATE: Apr 16 2020 TIME: 18:11:29 BOOTMODE: 0x00000006 part: 0 BUILD_TIMESTAMP=1587057086 0xa049cc2f 0x00c03111
</span><span id="__span-6-3"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>uSD voltage 3.3V
</span><span id="__span-6-4"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>... 
</span><span id="__span-6-5"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>initramfs emergency recovery shell launched. Type 'exit' to continue boot
</span><span id="__span-6-6"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>sh: can't access tty; job control turned off
</span><span id="__span-6-7"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>/ #
</span></code></pre></div>
<p>然后，按照需要自定义 initramfs 即可。解压后，修改文件，然后运行：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a href="../../devops/2020/09/11/alpine-rpi-pxe/#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>&gt;<span class="w"> </span>find<span class="w"> </span>.<span class="w"> </span>-print0<span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>--null<span class="w"> </span>-ov<span class="w"> </span>--format<span class="o">=</span>newc<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>../initramfs-rpi4
</span></code></pre></div>
<p>把自带的 initramfs 替换掉。</p>
<nav class="md-post__action">
<a href="../../devops/2020/09/11/alpine-rpi-pxe/">
        继续阅读
      </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2020-08-12 00:00:00">2020年8月12日</time></li>
<li class="md-meta__item">
            分类于
            
              <a class="md-meta__link" href="../../category/devops/">devops</a></li>
<li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="certbot-route53-letsencrypt-iam"><a class="toclink" href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/">用 certbot 申请 route53 上的域名的 LetsEncrypt 证书并上传到 IAM</a></h2>
<p>最近遇到了 AWS Certificate Manager 的一些限制，所以只能用 IAM 证书。于是上网找到了通过 certbot 申请 LE 证书，通过 route53 API 验证的方法。</p>
<p>首先配置 aws 的 credential。然后，按照 certbot：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>certbot<span class="w"> </span>certbot_dns_route53
</span></code></pre></div>
<p>然后，就可以申请证书了：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>certbot<span class="w"> </span>certonly<span class="w"> </span>--dns-route53<span class="w"> </span>--config-dir<span class="w"> </span><span class="s2">"./letsencrypt"</span><span class="w"> </span>--work-dir<span class="w"> </span><span class="s2">"./letsencrypt"</span><span class="w"> </span>--logs-dir<span class="w"> </span><span class="s2">"./letsencrypt"</span><span class="w">  </span>-d<span class="w"> </span>example.com<span class="w"> </span>--email<span class="w"> </span>a@b.com<span class="w"> </span>--agree-tos
</span></code></pre></div>
<p>如果申请成功，在当前目录下可以找到证书。然后上传到 IAM：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>aws<span class="w"> </span>iam<span class="w"> </span>upload-server-certificate<span class="w"> </span>--server-certificate-name<span class="w"> </span>NameHere<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span>--certificate-body<span class="w"> </span>file://letsencrypt/live/example.com/cert.pem<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-3"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span>--private-key<span class="w"> </span>file://letsencrypt/live/example.com/privkey.pem<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-4"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span>--certificate-chain<span class="w"> </span>file://letsencrypt/live/example.com/chain.pem<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-5"><a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span>--path<span class="w"> </span>/cloudfront/
</span></code></pre></div>
<p>如果要用于 cloudfront，才需要最后的路径参数；否则可以去掉。这样就完成了 IAM 证书的上传。</p>
<nav class="md-post__action">
<a href="../../devops/2020/08/12/certbot-route53-letsencrypt-iam/">
        继续阅读
      </a>
</nav>
</div>
</article>
<nav class="md-pagination">
<a class="md-pagination__link" href="../..">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../11/">11</a> <a class="md-pagination__link" href="../12/">12</a> <span class="md-pagination__current">13</span> <a class="md-pagination__link" href="../14/">14</a> <a class="md-pagination__link" href="../15/">15</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../36/">36</a>
</nav>
</div>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="页脚" class="md-footer__inner md-grid">
<a aria-label="下一页: 关于" class="md-footer__link md-footer__link--next" href="../../about/" rel="next">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一页
              </span>
<div class="md-ellipsis">
                关于
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/jiegec" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.780af0f4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../assets/javascripts/bundle.f11ae8b1.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
</body>
</html>