<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jiajie Chen's blog</title>
    <description>This is the personal blog of Jiajie Chen, a NANO(uNix hAcker aNd lOver).
</description>
    <link>https://jiegec.github.io/</link>
    <atom:link href="https://jiegec.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 27 Feb 2018 22:58:45 +0800</pubDate>
    <lastBuildDate>Tue, 27 Feb 2018 22:58:45 +0800</lastBuildDate>
    <generator>Jekyll v3.6.2</generator>
    
      <item>
        <title>近来做 Stanford CS140e 的一些进展和思考（4）</title>
        <description>&lt;p&gt;在&lt;a href=&quot;/programming/2018/02/16/thoughts-on-stanford-cs140e-3/&quot;&gt;上一篇文章&lt;/a&gt;之后，作者多次延期跳票之后，终于放出了 &lt;code class=&quot;highlighter-rouge&quot;&gt;Assignment 2 Phase 2:32-bit Lipids&lt;/code&gt; ，这两天就把只读 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT32&lt;/code&gt; 写完了（不过封装得并不好，许多地方利用了 &lt;code class=&quot;highlighter-rouge&quot;&gt;pub(super)&lt;/code&gt; 把变量可以访问的范围控制到 &lt;code class=&quot;highlighter-rouge&quot;&gt;vfat&lt;/code&gt; 中，然后直接读，只有少数需要特殊处理的进行了函数的封装）。首先当然是研究了半天 &lt;code class=&quot;highlighter-rouge&quot;&gt;MBR&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT32&lt;/code&gt; 的结构，拿了不同来源的 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT&lt;/code&gt; 结构说明进行对比和验证，最后终于把格式搞清楚了，先实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;MasterBootRecord&lt;/code&gt; ，这个其实很好实现，以前也有接触过 &lt;code class=&quot;highlighter-rouge&quot;&gt;MBR&lt;/code&gt; ，本身也很简单。然后就是根据 &lt;code class=&quot;highlighter-rouge&quot;&gt;MBR&lt;/code&gt; 找到第一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT32&lt;/code&gt; 的分区，根据偏移找到分区的开头，开头的第一个扇区就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;EBPB&lt;/code&gt; 数据结构，里面保存了 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT32&lt;/code&gt; 分区的各种信息。根据里面的信息，可以找到 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT&lt;/code&gt; 表的位置和数量，还有数据部分的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cluster&lt;/code&gt; 的位置和数量。接着，解析一下 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT&lt;/code&gt; 表，实际上是一个与 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cluster&lt;/code&gt; 一一对应的链表结构，用特殊的数据代表链表的尾和空、坏扇区。利用这些，和 &lt;code class=&quot;highlighter-rouge&quot;&gt;EBPB&lt;/code&gt; 中根目录所在的第一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cluster&lt;/code&gt; ，先在 &lt;code class=&quot;highlighter-rouge&quot;&gt;VFat&lt;/code&gt; 里面实现了读取一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cluster&lt;/code&gt; 链的内容的函数，利用这个函数读取一个一个的目录项，解析目录项，把长文件名的项合并到一个之中，然后对应地丢到 &lt;code class=&quot;highlighter-rouge&quot;&gt;Entry&lt;/code&gt; 对象中，目录则可以枚举子目录项，根据名字比较去找子目录或者子文件夹，文件则实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;io::Read&lt;/code&gt;和 &lt;code class=&quot;highlighter-rouge&quot;&gt;io::Seek&lt;/code&gt; 使得可以读取文件的内容。实现好了这些以后，就拿了 &lt;code class=&quot;highlighter-rouge&quot;&gt;raspbian-strech-lite.img&lt;/code&gt; 作为硬盘映像，从文件里读取文件信息，成功地把 &lt;code class=&quot;highlighter-rouge&quot;&gt;config.txt&lt;/code&gt; 读取出来。&lt;/p&gt;

&lt;p&gt;其中还是遇到许多困难，如各种偏移的计算，如何处理跨 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cluster&lt;/code&gt; 和跨 &lt;code class=&quot;highlighter-rouge&quot;&gt;Sector&lt;/code&gt; 的读写，等等，有不少的坑在其中，花了两天的空余时间才差不多完善了这个功能。还有就是利用 &lt;code class=&quot;highlighter-rouge&quot;&gt;Rust&lt;/code&gt; 现有的功能完成 &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt; 里面很轻易就可以实现的指针操作，也花了不少时间。&lt;/p&gt;
</description>
        <pubDate>Tue, 27 Feb 2018 22:42:59 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/02/27/thoughts-on-stanford-cs140e-4/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/02/27/thoughts-on-stanford-cs140e-4/</guid>
        
        <category>Rust</category>
        
        <category>OS</category>
        
        <category>Stanford</category>
        
        <category>CS140e</category>
        
        <category>RPi3</category>
        
        <category>FAT32</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>近来做 Stanford CS140e 的一些进展和思考（3）</title>
        <description>&lt;p&gt;由于 &lt;code class=&quot;highlighter-rouge&quot;&gt;Assignment 2: File System &lt;/code&gt; 延期发布，所以中间那段时间转向 &lt;code class=&quot;highlighter-rouge&quot;&gt;MIT 6.828&lt;/code&gt; 稍微研究了一下。前几天放出了新的任务，在&lt;a href=&quot;/programming/2018/02/06/thoughts-on-stanford-cs140e-2/&quot;&gt;上一篇文章&lt;/a&gt;之后，我又有了一些进展： 实现了从内存中读取 &lt;code class=&quot;highlighter-rouge&quot;&gt;ATAGS(ARM Tags)&lt;/code&gt; 信息的代码，从而可以获得内存大小的信息，根据这个信息，实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;bump&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;bin&lt;/code&gt; 两种内存分配器，并且把二者之一注册为全局内存分配器，利用上更新了的 &lt;code class=&quot;highlighter-rouge&quot;&gt;std&lt;/code&gt; 就可以使用需要动态分配内存的相关工具了。利用这个，我实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; 输入历史的回溯，把输入历史保存在一个动态增长的数组中，再特殊处理上下键，把当前的行替换为历史。&lt;/p&gt;

&lt;p&gt;这个过程也不是没有踩坑。一开始代码放出来了，但是题目说明还没出，我就自己按照代码做了 &lt;code class=&quot;highlighter-rouge&quot;&gt;ATAGS&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;bump&lt;/code&gt; 分配器，后来做完了，看到说明出了以后，发现理解还是有偏差，把代码更改了并修复了分配器的 BUG 。看到 &lt;code class=&quot;highlighter-rouge&quot;&gt;bin&lt;/code&gt; 分配器的时候，我按照网上的 &lt;code class=&quot;highlighter-rouge&quot;&gt;buddy memory allocation&lt;/code&gt; 实现了一个内存分配器，原理看起来简单实现起来还是有很多细节问题，后来按照新放出的单元测试，修修补补才写得差不多可用了。同时，原来的 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; 因为用了新的 &lt;code class=&quot;highlighter-rouge&quot;&gt;std&lt;/code&gt; 而缺失了 &lt;code class=&quot;highlighter-rouge&quot;&gt;alloc&lt;/code&gt; 不能编译，我就把 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 下的相关文件软连接过去，调了数次后把问题解决。此时， &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 文件大小已经有 40K ，按照 115200 Baudrate 发送需要几秒才能传输过去，我就调到了 230400 Baudrate ，果然现在的传输速度就有所提升，可以接受了。等之后写了 &lt;code class=&quot;highlighter-rouge&quot;&gt;EMMC(SD card)&lt;/code&gt; 的驱动和 &lt;code class=&quot;highlighter-rouge&quot;&gt;FAT32&lt;/code&gt; 的文件系统后，就可以实现更多的 &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; 的功能了。中间还遇到一个问题，就是如果给 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 开启了 &lt;code class=&quot;highlighter-rouge&quot;&gt;bin&lt;/code&gt; 分配器，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;exit&lt;/code&gt; 回到 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; 就无法传新的 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 上去了，结果发现是因为 &lt;code class=&quot;highlighter-rouge&quot;&gt;bin&lt;/code&gt; 中用到的侵入式 &lt;code class=&quot;highlighter-rouge&quot;&gt;LinkedList&lt;/code&gt; 实现覆盖了部分 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; 的代码，换回不能回收内存的 &lt;code class=&quot;highlighter-rouge&quot;&gt;bump&lt;/code&gt; 分配器即可，反正目前远远还用不了那么多内存。&lt;/p&gt;

&lt;p&gt;之后还要在 &lt;code class=&quot;highlighter-rouge&quot;&gt;aarch64&lt;/code&gt; 上用 &lt;code class=&quot;highlighter-rouge&quot;&gt;MMU&lt;/code&gt; 实现虚拟内存，之前在 &lt;code class=&quot;highlighter-rouge&quot;&gt;MIT 6.828&lt;/code&gt; 里被页表整得脑子眩晕，希望到时我还活着吧（逃&lt;/p&gt;
</description>
        <pubDate>Fri, 16 Feb 2018 20:09:00 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/02/16/thoughts-on-stanford-cs140e-3/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/02/16/thoughts-on-stanford-cs140e-3/</guid>
        
        <category>Rust</category>
        
        <category>OS</category>
        
        <category>Stanford</category>
        
        <category>CS140e</category>
        
        <category>kernel</category>
        
        <category>hardware</category>
        
        <category>RPi3</category>
        
        <category>shell</category>
        
        <category>bootloader</category>
        
        <category>MIT 6.828</category>
        
        <category>ATAGS</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>近来做 Stanford CS140e 的一些进展和思考（2）</title>
        <description>&lt;p&gt;在&lt;a href=&quot;/programming/2018/02/04/thoughts-on-stanford-cs140e/&quot;&gt;上一篇文章&lt;/a&gt;之后，我又有了一些进展：&lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; ，简易的&lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; ，修复了之前写的 &lt;code class=&quot;highlighter-rouge&quot;&gt;xmodem&lt;/code&gt; 中的 BUG，一个可以从 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; 接收一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 写入到内存中再跳转过去的 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; 。&lt;/p&gt;

&lt;p&gt;首先是 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; ，就是通过两个 &lt;code class=&quot;highlighter-rouge&quot;&gt;GPIO pin&lt;/code&gt; 进行数据传输，首先在 &lt;code class=&quot;highlighter-rouge&quot;&gt;memory mapped IO&lt;/code&gt; 上进行相应的初始化，然后包装了 &lt;code class=&quot;highlighter-rouge&quot;&gt;io::Read&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;io::Write&lt;/code&gt; （这里实现一开始有 BUG，后来修复了），然后很快地完成了一个仅仅能 &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 。&lt;/p&gt;

&lt;p&gt;然后实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;CONSOLE&lt;/code&gt; ，一个对 &lt;code class=&quot;highlighter-rouge&quot;&gt;MiniUart&lt;/code&gt; 和单例封装，就可以用 &lt;code class=&quot;highlighter-rouge&quot;&gt;kprint!/kprintln!&lt;/code&gt; 宏来输出到 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; ，接着实现了一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; ，读入一行输出一行。然后实现退格键和方向键，这里的难点在于要控制光标并且用读入的或者空格覆盖掉屏幕上已经显示而不应该显示的内容。接着，利用 &lt;code class=&quot;highlighter-rouge&quot;&gt;skeleton&lt;/code&gt; 中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Command&lt;/code&gt; 做了一个简单的 &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; 命令。&lt;/p&gt;

&lt;p&gt;接着，利用之前编写的 &lt;code class=&quot;highlighter-rouge&quot;&gt;tty&lt;/code&gt; ，配合上新编写的 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; ，实现通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; 把新的 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;XMODEM&lt;/code&gt; 协议发送到设备，写入 &lt;code class=&quot;highlighter-rouge&quot;&gt;0x80000&lt;/code&gt; 启动地址并且调转到新加载的 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; 中执行。&lt;/p&gt;

&lt;p&gt;最后，又实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;uptime&lt;/code&gt; （输出设备启动到现在的时间）和 &lt;code class=&quot;highlighter-rouge&quot;&gt;exit&lt;/code&gt; （跳转回 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootloader&lt;/code&gt; ，可以上传新的 &lt;code class=&quot;highlighter-rouge&quot;&gt;kernel&lt;/code&gt; ）。并添加了 &lt;code class=&quot;highlighter-rouge&quot;&gt;TUNA&lt;/code&gt; 作为 &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; 启动时输出的 &lt;code class=&quot;highlighter-rouge&quot;&gt;BANNER&lt;/code&gt; 。&lt;/p&gt;

&lt;p&gt;整个过程挺虐的，踩了很多的坑，由于很多东西都没有，输入输出目前也只有 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; ，写了 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; 后又遇到 &lt;code class=&quot;highlighter-rouge&quot;&gt;XMODEM&lt;/code&gt; 难以调试的问题。十分感谢 &lt;code class=&quot;highlighter-rouge&quot;&gt;#tuna&lt;/code&gt; 上的 @BenYip 及时地指出了代码的几处问题，节省了我许多时间。&lt;/p&gt;
</description>
        <pubDate>Tue, 06 Feb 2018 12:52:59 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/02/06/thoughts-on-stanford-cs140e-2/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/02/06/thoughts-on-stanford-cs140e-2/</guid>
        
        <category>Rust</category>
        
        <category>OS</category>
        
        <category>Stanford</category>
        
        <category>CS140e</category>
        
        <category>kernel</category>
        
        <category>GPIO</category>
        
        <category>hardware</category>
        
        <category>RPi3</category>
        
        <category>shell</category>
        
        <category>bootloader</category>
        
        <category>XMODEM</category>
        
        <category>UART</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>近来做 Stanford CS140e 的一些进展和思考</title>
        <description>&lt;p&gt;最近，受各路安利，剁手买下了 &lt;a href=&quot;https://item.taobao.com/item.htm?id=537501616420&quot;&gt;这个淘宝商家的树莓派的套餐C&lt;/a&gt; ，还买了许多 LED 灯泡、杜邦线和电阻，开始按照 &lt;a href=&quot;http://web.stanford.edu/class/cs140e/&quot;&gt;CS 140e&lt;/a&gt; 学习 Rust 并且用 Rust 编译写一个简易的操作系统。Assignment 0 的目标就是编写一个向 GPIO 16 连接的 LED 灯闪烁。首先当然就是愉快地按照教程下载 bootloader ，下载交叉编译工具链，顺带装一个 Raspbian 到机器上，随时可以当成一个低性能的 ARM/ARM64 （实际上，Raspbian 只用了armv7l，没有用 64bit）机器来用，以后如果配上 &lt;a href=&quot;https://scateu.me&quot;&gt;@scateu&lt;/a&gt; 团购的 Motorola Laptop Dock 的话就是一个几百块的笔记本了。把课程上的文件丢上去，可以看到绿色的活动指示灯闪烁，后面又把 CP2102 模块连上去，又能看到 Blink on, Blink off 的输出。然后按照要求，自己先码一段 C 语言，实现 blinky:&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define GPIO_BASE (0x3F000000 + 0x200000)
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_FSEL1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_SET0&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_CLR0&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x28&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;spin_sleep_us&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;asm&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nop&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;spin_sleep_us&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// STEP 1: Set GPIO Pin 16 as output.
&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_FSEL1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b001&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// STEP 2: Continuously set and clear GPIO 16.
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_SET0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_CLR0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其中大部分代码都已经给出了，自己要实现也只是查询一下 BCM2837 SoC 的 GPIO 文档，按照文档把该做的内存操作和位运算都写一下即可。最后发现，闪烁的频率特别慢，几秒钟才闪烁一次。毕竟是按照 CPU 的 clock speed 进行粗略的计时，而生成的代码也不是很高效，没有 inline。接着则是用 Rust 再实现一下上面这部分的代码：&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compiler_builtins_lib&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lang_items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pointer_methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no_builtins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no_std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compiler_builtins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lang_items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x3F000000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x200000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO_FSEL1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO_SET0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x1C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO_CLR0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GPIO_BASE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x28&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[inline(never)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;asm!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nop&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;::::&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;volatile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[no_mangle]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;C&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;kmain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// STEP 1: Set GPIO Pin 16 as output.&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GPIO_FSEL1&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.write_volatile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// STEP 2: Continuously set and clear GPIO 16.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;GPIO_SET0&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.write_volatile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;GPIO_CLR0&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.write_volatile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这边和上面一样，很多东西都已经给出了，只是重新改写一下而已。不过，这边的实测结果则是，一秒钟会闪烁很多下，看了下汇编，生成的循环比较紧凑，所以也没有达到想要的效果，不过后面到我实现了 Timer 的读取之后，就很精准了。&lt;/p&gt;

&lt;p&gt;接下来就是痛苦的学习 Rust 的过程，Assignment 1 上来就是解答关于 Rust 语言的一些问题，在过程中被 Rust 十分严格的 Lifetime 和 Borrow checker 弄得想死，好歹最后还是让测试都通过了。接下来就是真正地提供一些封装硬件接口的 API，然后利用这些 API 去实现更多功能，首先是利用栈上分配的空间模拟一个变长数组的 API：&lt;code class=&quot;highlighter-rouge&quot;&gt;stack-vec&lt;/code&gt; ，然后是把底层的直接操作硬件的内存操作封装成类型安全的 &lt;code class=&quot;highlighter-rouge&quot;&gt;volatile&lt;/code&gt; ，然后实现一个简单的支持断点续传的传文件的协议 &lt;code class=&quot;highlighter-rouge&quot;&gt;xmodem&lt;/code&gt; ，又做了一个辅助电脑上使用 TTY+XMODEM 的小工具 &lt;code class=&quot;highlighter-rouge&quot;&gt;ttywrite&lt;/code&gt; ，然后就开始撸硬件了：时钟 &lt;code class=&quot;highlighter-rouge&quot;&gt;timer&lt;/code&gt; ，针对 GPIO pin 的类型安全的状态机 &lt;code class=&quot;highlighter-rouge&quot;&gt;GPIO&lt;/code&gt; 。目前只实现到这里，然后做出了一个准确一秒闪烁的 blinky （令人惊讶的是，因为这里的 kernel 直接从文件头开始就是代码，最后的 binary 异常地小，而之前的代码从文件的偏移 0x8000 开始。目前看来，是因为之前的代码是整个文件加载到 0x0000 上，而代码默认了从  0x8000 开始，所以除了最开头的一个跳转指令，中间留了许多空余的空间。而这里的代码是直接被 bootloader 加载到了 0x80000 处并且跳转到这里执行，所以省去了许多空间）：&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;blinky&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Gpio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin_out16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin16&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into_output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pin_out16&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pin_out16&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;spin_sleep_ms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[no_mangle]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;C&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;kmain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// FIXME: Start the shell.&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;blinky&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;目前只做到这里。后面还有大把的坑要踩，难写的 Rust 还得继续啃下去。我的代码都以 diff 的形式放在了 &lt;a href=&quot;https://github.com/jiegec/cs140e&quot;&gt;jiegec/cs140e&lt;/a&gt; ，写得并不美观。接下来就是实现 &lt;code class=&quot;highlighter-rouge&quot;&gt;UART&lt;/code&gt; 了，终于要实现串口通信了。&lt;/p&gt;

&lt;p&gt;2018-01-06 更新： &lt;a href=&quot;/programming/2018/02/06/thoughts-on-stanford-cs140e-2/&quot;&gt;下一篇文章已经更新&lt;/a&gt; 。&lt;/p&gt;
</description>
        <pubDate>Sun, 04 Feb 2018 22:28:23 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/02/04/thoughts-on-stanford-cs140e/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/02/04/thoughts-on-stanford-cs140e/</guid>
        
        <category>Rust</category>
        
        <category>OS</category>
        
        <category>Stanford</category>
        
        <category>CS140e</category>
        
        <category>kernel</category>
        
        <category>GPIO</category>
        
        <category>hardware</category>
        
        <category>RPi3</category>
        
        <category>XMODEM</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>再次吐槽 VS 关于 scanf 和 scanf_s 的问题</title>
        <description>&lt;p&gt;继&lt;a href=&quot;https://jiegec.github.io/programming/2017/10/17/on-scanf-and-scanf_s/&quot;&gt;上次的吐槽&lt;/a&gt;后，今天再次遇到同学因为 &lt;code class=&quot;highlighter-rouge&quot;&gt;scanf&lt;/code&gt; 在 VS 下的 &lt;code class=&quot;highlighter-rouge&quot;&gt;deprecation error&lt;/code&gt; 感到十分迷茫，在知乎上求助又因为拍照的原因被说，我就在此再次吐槽一下 VS 这对初学者很不友善很不友善的两点。&lt;/p&gt;

&lt;p&gt;一点就是上面提到的这个，另一点就是程序结束后任意键以退出这一功能要做得更加醒目一点 。前者由于大多数新手在学习 &lt;code class=&quot;highlighter-rouge&quot;&gt;C/C++&lt;/code&gt; 的时候都会跟着书上或者网上的代码敲一遍输入输出的代码，很容易就会撞到这个问题。后者则会让新手习惯性地以为程序闪退了，没有出结果，而不知道其实是程序执行结束后关闭而已。&lt;/p&gt;
</description>
        <pubDate>Tue, 30 Jan 2018 16:05:33 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/01/30/more-on-scanf-and-scanf_s/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/01/30/more-on-scanf-and-scanf_s/</guid>
        
        <category>VS</category>
        
        <category>C</category>
        
        <category>CS</category>
        
        <category>C++</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>我正在使用的两个 Emacs 的 Patch</title>
        <description>&lt;p&gt;我在本地对 &lt;code class=&quot;highlighter-rouge&quot;&gt;emacs.rb&lt;/code&gt; 进行了修改：&lt;/p&gt;

&lt;div class=&quot;language-patch highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gh&quot;&gt;diff --git a/Formula/emacs.rb b/Formula/emacs.rb
index d0138cd..de3c5ff 100644
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;--- a/Formula/emacs.rb
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+++ b/Formula/emacs.rb
&lt;/span&gt;&lt;span class=&quot;gu&quot;&gt;@@ -4,6 +4,14 @@ class Emacs &amp;lt; Formula
&lt;/span&gt;   url &quot;https://ftp.gnu.org/gnu/emacs/emacs-25.3.tar.xz&quot;
   sha256 &quot;253ac5e7075e594549b83fd9ec116a9dc37294d415e2f21f8ee109829307c00b&quot;

&lt;span class=&quot;gi&quot;&gt;+  patch do
+    url &quot;https://gist.githubusercontent.com/aatxe/260261daf70865fbf1749095de9172c5/raw/214b50c62450be1cbee9f11cecba846dd66c7d06/patch-multicolor-font.diff&quot;
+  end
+
+  patch do
+    url &quot;https://debbugs.gnu.org/cgi/bugreport.cgi?filename=0001-Fix-child-frame-placement-issues-bug-29953.patch;bug=29953;att=1;msg=8&quot;
+  end
+
&lt;/span&gt;   bottle do
     sha256 &quot;d5ce62eb55d64830264873a363a99f3de58c35c0bd1602cb7fd0bc37137b0c9d&quot; =&amp;gt; :high_sierra
     sha256 &quot;4d7ff7f96c9812a9f58cd45796aef789a1b5d26c58e3e68ecf520fab34af524d&quot; =&amp;gt; :sierra

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;主要涉及到两个 Patch ：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;启用对 Multicolor font ，比如 Emoji 的支持。由于一些 ethic problems 暂时在 Emacs 中被禁用了，所以自己启用回来。&lt;/li&gt;
  &lt;li&gt;打上我前几天上报的 &lt;a href=&quot;https://debbugs.gnu.org/cgi/bugreport.cgi?bug=29953&quot;&gt;BUG #29953&lt;/a&gt; 的修复。已经在上游 Merge 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;emacs-26&lt;/code&gt; 分支中，这个修复会在下一个版本中。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;有了第一个，就可以正常显示 Emoji （对不起，RMS）；有了第二个，就解决了 &lt;code class=&quot;highlighter-rouge&quot;&gt;pyim&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;lsp-ui-peek&lt;/code&gt; 用 &lt;code class=&quot;highlighter-rouge&quot;&gt;child-frame&lt;/code&gt; 显示的一些问题了。&lt;/p&gt;

&lt;p&gt;另外还有一个我自己在用的 &lt;code class=&quot;highlighter-rouge&quot;&gt;recoll.rb&lt;/code&gt; ：&lt;/p&gt;
&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Documentation: https://docs.brew.sh/Formula-Cookbook.html&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Recoll&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Formula&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;desc&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Recoll is a desktop full-text search tool.&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;homepage&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://www.lesbonscomptes.com/recoll/&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://www.lesbonscomptes.com/recoll/recoll-1.23.5.tar.gz&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sha256&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;9b6b6941efc3e87c8325e95a69a5d0a37c022c3c45773c71dccd0fb3f364475f&quot;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;xapian&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;qt&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aspell&quot;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;install&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inreplace&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Makefile.in&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;-Wl,--no-undefined -Wl,--warn-unresolved-symbols&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;--no-undefined --warn-unresolved-symbols&quot;&lt;/span&gt;

    &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;./configure&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;--disable-dependency-tracking&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--disable-silent-rules&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--without-x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--disable-x11mon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--with-aspell&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--enable-recollq&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--disable-webkit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# requires qtwebkit, which is not bundled with qt5&lt;/span&gt;
                          &lt;span class=&quot;s2&quot;&gt;&quot;--prefix=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;make&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;install&quot;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libexec&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;recoll.app&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libexec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;recoll.app&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# `test do` will create, run in and delete a temporary directory.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# This test will fail and we won't accept that! For Homebrew/homebrew-core&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# this will need to be a test that verifies the functionality of the&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# software. Run the test with `brew test recoll`. Options passed&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# to `brew install` such as `--HEAD` also need to be provided to `brew test`.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# The installed folder is not in the path, so use the entire path to any&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# executables being tested: `system &quot;#{bin}/program&quot;, &quot;do&quot;, &quot;something&quot;`.&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Sun, 07 Jan 2018 14:24:24 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2018/01/07/two-patches-of-Emacs-I-am-using/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2018/01/07/two-patches-of-Emacs-I-am-using/</guid>
        
        <category>emacs</category>
        
        <category>patch</category>
        
        <category>multicolor font</category>
        
        <category>Emoji</category>
        
        <category>frame</category>
        
        <category>child frame</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>NAT64 初尝试</title>
        <description>&lt;p&gt;最近宿舍里有线网络的 IPv4 总是拿不到地址，只能连无线网，不禁对计算机系学生的可怕的设备数量有了深刻的认识。不过，作为一个有道德（误）的良好青年，还是不要给已经枯竭的 IPv4 地址填堵了，还是赶紧玩玩 IPv6 的网络吧。然后在 TUNA 群里受青年千人续本达 (@heroxbd) 的安利，本地搭建一下 NAT64+DNS64 的环境。不过考虑到宿舍还是拿不到有线的 IPv4 地址，我就先利用苹果先前在强制 iOS 的应用支持 NAT64 网络的同时，在 macOS 上为了方便开发者调试，提供的便捷的建立 NAT64 网络的能力。&lt;/p&gt;

&lt;p&gt;首先在设置中按住 Option 键打开 Sharing ， 点击 Internet Sharing ，勾上 Create NAT64 Network 然后把网络共享给设备。然后在手机上关掉 Wi-Fi 和 Cellular ，发现还能正常上网。此时可以打开 Wireshark 验证我们的成果了：&lt;/p&gt;

&lt;p&gt;在手机上打开浏览器，浏览千度，得到如下的 Wireshark 截图：
&lt;img src=&quot;/assets/baidu-nat64.jpg&quot; alt=&quot;baidu-nat64&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里，&lt;code class=&quot;highlighter-rouge&quot;&gt;2001:2:0:aab1::1&lt;/code&gt; 是本机在这个子网中的地址，&lt;code class=&quot;highlighter-rouge&quot;&gt;2001:2::aab1:cda2:5de:87f6:fd78&lt;/code&gt; 是我的 iOS 设备的地址，然后 iOS 向 macOS 发出了 DNS请求， macOS 发送 DNS 请求后得到 &lt;code class=&quot;highlighter-rouge&quot;&gt;baidu.com&lt;/code&gt; 的 IPv4 地址之一为 &lt;code class=&quot;highlighter-rouge&quot;&gt;111.13.101.208&lt;/code&gt; ：
&lt;img src=&quot;/assets/baidu-dns.jpg&quot; alt=&quot;baidu-dns&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上图中，我们可以看到， &lt;code class=&quot;highlighter-rouge&quot;&gt;baidu.com&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;AAAA&lt;/code&gt; 记录是 &lt;code class=&quot;highlighter-rouge&quot;&gt;2001:2:0:1baa::6f0d:65d0&lt;/code&gt; ，这个就是 DNS64 转译的地址，前面为网关的 &lt;code class=&quot;highlighter-rouge&quot;&gt;prefix&lt;/code&gt; ，后面就是对应的 IPv4 地址： &lt;code class=&quot;highlighter-rouge&quot;&gt;0x6f=111, 0x0d=13, 0x65=101, 0xd0=208&lt;/code&gt; ，当客户端向这个地址发包的时候，网关发现前缀符合条件，把最后的这部分 IPv4 地址取出来，自己把包发送到真实的地址上去，再把返回来的包再转为 IPv6 的地址返还给客户端。可以验证，剩下的几个地址也符合这个转译规则。&lt;/p&gt;

&lt;p&gt;这就实现了：利用一台连接着 IPv6 和 IPv4 两种网络的网关，可以使得 IPv6 这个网络通过网关访问 IPv4 。通过配置，也可以使得 IPv4 访问 IPv6 中的地址（即 Stateful 和 Stateless 的区分，需要手动配置映射）。&lt;/p&gt;

&lt;p&gt;好处：作为比较成熟的 IPv4 到 IPv6 过渡方案之一，可以让自己组建的 IPv6 网络访问一些仅 IPv4 的网站。
坏处：依赖于 DNS64 ，必须要经过一层翻译，一些应用或协议可能写死了 IPv4 的地址，该方法可能会失效。&lt;/p&gt;
</description>
        <pubDate>Tue, 02 Jan 2018 19:41:22 +0800</pubDate>
        <link>https://jiegec.github.io/networking/2018/01/02/first-trial-of-NAT64/</link>
        <guid isPermaLink="true">https://jiegec.github.io/networking/2018/01/02/first-trial-of-NAT64/</guid>
        
        <category>networking</category>
        
        <category>NAT</category>
        
        <category>IPv6</category>
        
        <category>NAT64</category>
        
        <category>DNS</category>
        
        <category>DNS64</category>
        
        
        <category>networking</category>
        
      </item>
    
      <item>
        <title>有趣的 Java 日期格式化问题</title>
        <description>&lt;p&gt;今天在群里看到有人说， Java 的日期格式化有问题，如果用 &lt;code class=&quot;highlighter-rouge&quot;&gt;YYYY-MM-dd&lt;/code&gt; ，今天的日期就会显示 &lt;code class=&quot;highlighter-rouge&quot;&gt;2018-12-31&lt;/code&gt; 。我立马在本地用 Java REPL (aka Groovy) 跑了一下，果然如此：&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;31&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CST&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2017&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.text.SimpleDateFormat&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SimpleDateFormat&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SimpleDateFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;YYYY-MM-dd&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2018&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;31&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;解决方案是，把格式换为 &lt;code class=&quot;highlighter-rouge&quot;&gt;yyyy-MM-dd&lt;/code&gt; ，确实就可以了。于是我就去研究了一下文档： &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html&quot;&gt;Class SimpleDateFormat&lt;/a&gt; ，发现了问题：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;y&lt;/code&gt; 代表 &lt;code class=&quot;highlighter-rouge&quot;&gt;year&lt;/code&gt; ，而 &lt;code class=&quot;highlighter-rouge&quot;&gt;Y&lt;/code&gt; 代表 &lt;code class=&quot;highlighter-rouge&quot;&gt;week year&lt;/code&gt; 。根据 &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html#week_year&quot;&gt;week year&lt;/a&gt; ，因为今年最后的一个星期在明年的部分更多，于是这个星期被归在了明年，所以这一周属于 2018 ，这就可以解释之前的那个输出问题了。&lt;/p&gt;
</description>
        <pubDate>Sun, 31 Dec 2017 10:55:23 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2017/12/31/interesting-java-formatting-problem/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2017/12/31/interesting-java-formatting-problem/</guid>
        
        <category>java</category>
        
        <category>datetime formatting</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>在 macOS 上试用 Gentoo/Prefix</title>
        <description>&lt;p&gt;前几天参加了&lt;a href=&quot;https://keybase.io/jsteward&quot;&gt;许朋程&lt;/a&gt;主讲的Tunight，对Gentoo有了一定的了解，不过看到如此复杂的安装过程和长久的编译时间，又看看我的CPU，只能望而却步了。不过，有Gentoo/Prefix这个工具，使得我们可以在其它的操作系统（如macOS,Solaris等）上在一个 $EPREFIX 下跑 Portage ，也就是把 Portage 运行在别的操作系统，当作一个包管理器，并且可以和别的操作系统并存。&lt;/p&gt;

&lt;p&gt;首先还是祭出官网：&lt;a href=&quot;https://wiki.gentoo.org/wiki/Project:Prefix&quot;&gt;Project:Prefix&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;首先设定好环境变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;$EPREFIX&lt;/code&gt; ，之后所有的东西都会安装到这个目录下，把 &lt;code class=&quot;highlighter-rouge&quot;&gt;bootstrap-prefix.sh&lt;/code&gt; 下载到 &lt;code class=&quot;highlighter-rouge&quot;&gt;$EPREFIX&lt;/code&gt; ，然后 &lt;code class=&quot;highlighter-rouge&quot;&gt;./bootstrap-prefix.sh&lt;/code&gt; ，会进行一系列的问题，一一回答即可。建议在运行前设置好 &lt;code class=&quot;highlighter-rouge&quot;&gt;GENTOO_MIRRORS=http://mirrors.tuna.tsinghua.edu.cn/gentoo&lt;/code&gt; 由于TUNA没有对gentoo_prefix做镜像，只能把distfiles切换到TUNA的镜像上。&lt;/p&gt;

&lt;p&gt;然后。。。&lt;/p&gt;

&lt;p&gt;stage1…&lt;/p&gt;

&lt;p&gt;stage2..&lt;/p&gt;

&lt;p&gt;stage3.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;emerge -e @world&lt;/code&gt; BOOM&lt;/p&gt;

&lt;p&gt;经过 n 次跑挂以后，终于搞完了 stage3 ，然后 &lt;code class=&quot;highlighter-rouge&quot;&gt;SHELL=bash ./bootstrap-prefix.sh $EPREFIX startscript&lt;/code&gt; 生成 &lt;code class=&quot;highlighter-rouge&quot;&gt;startprefix&lt;/code&gt; ，在外面的SHELL中向切进来的时候运行这个即可。&lt;/p&gt;

&lt;p&gt;然后就可以使用Gentoo/Prefix了。注意！此时的 &lt;code class=&quot;highlighter-rouge&quot;&gt;$PATH&lt;/code&gt; 仅限于 &lt;code class=&quot;highlighter-rouge&quot;&gt;$EPREFIX&lt;/code&gt; 下几个目录和 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin&lt;/code&gt; 所以很多东西都会出问题（Emacs, Vim, Fish etc）。小心不要把自己的目录什么的搞挂了。&lt;/p&gt;

&lt;p&gt;然后就可以假装试用Gentoo了！&lt;/p&gt;

&lt;p&gt;哈哈哈哈哈哈哈&lt;/p&gt;

&lt;p&gt;死于编译 libgcrypt 和 llvm 。&lt;/p&gt;
</description>
        <pubDate>Wed, 27 Dec 2017 20:25:23 +0800</pubDate>
        <link>https://jiegec.github.io/macos/2017/12/27/try-gentoo-prefix-on-macOS/</link>
        <guid isPermaLink="true">https://jiegec.github.io/macos/2017/12/27/try-gentoo-prefix-on-macOS/</guid>
        
        <category>gentoo</category>
        
        <category>gentoo-prefix</category>
        
        <category>macOS</category>
        
        <category>package-manager</category>
        
        
        <category>macOS</category>
        
      </item>
    
      <item>
        <title>Lsp And Cpp</title>
        <description>&lt;p&gt;之前时间，巨硬发布了LSP（Language Server Protocol），目的是解决目前IDE和各语言的m+n问题。想法很好，不过直到最近，终于有我觉得可以用的工具出来了，并且已经代替了我在使用的其它的插件。&lt;/p&gt;

&lt;p&gt;由于我最近主要就是做做程设作业，做做OJ这些，主要就是和C++打交道。所以我当然就开始找一些比较成熟的C++的LSP server。有一个 Sourcegraph 维护的 &lt;a href=&quot;https://langserver.org/&quot;&gt;langserver.org&lt;/a&gt; ，上面有着目前的各个语言和编辑器/IDE的支持情况，我刚才提到的cquery也会加入到这个列表里去。从这个列表里可以看到，我用的比较多的Python和Haskell都已经有不错的的LSP server，我已经开始在本地体验pyls和hie了，感觉做得挺不错的。&lt;/p&gt;

&lt;p&gt;回到C++，我的主力编辑器是Emacs，其次是CLion，而Emacs上的&lt;a href=&quot;https://github.com/emacs-lsp/lsp-mode&quot;&gt;LSP支持 lsp-mode&lt;/a&gt;也在快速发展，与之配合的&lt;a href=&quot;https://github.com/emacs-lsp/lsp-ui&quot;&gt;lsp-ui&lt;/a&gt; 也出现了很多很棒的功能。&lt;/p&gt;

&lt;p&gt;下面开始编译并配置&lt;a href=&quot;https://github.com/jacobdufault/cquery&quot;&gt;cquery&lt;/a&gt;：&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/jacobdufault/cquery &lt;span class=&quot;nt&quot;&gt;--recursive&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;cquery
./waf configure &lt;span class=&quot;c&quot;&gt;# to use system clang, append --use-system-clang&lt;/span&gt;
./waf build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后配置Emacs：&lt;/p&gt;

&lt;div class=&quot;language-elisp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;use-package&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lsp-mode&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:ensure&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:diminish&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;lsp-mode&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:commands&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lsp-mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:config&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lsp-define-stdio-client&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;lsp-pyls&lt;/span&gt;
   &lt;span class=&quot;s&quot;&gt;&quot;python&quot;&lt;/span&gt;
   &lt;span class=&quot;nf&quot;&gt;#'&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-project-root&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/usr/local/bin/pyls&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;use-package&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lsp-ui&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:commands&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;lsp-ui-mode&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:init&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-hook&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;'lsp-mode-hook&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;'lsp-ui-mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;use-package&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cquery&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:load-path&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;&quot;path_to_cquery/emacs&quot;&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:config&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;cquery-executable&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;path_to_cquery/build/app&quot;&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;cquery-resource-dir&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;path_to_cquery/clang_resource_dir&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;接下来，需要配置 基于Clang的 工具都需要的 Compilation Database 。Sacrasm对这个有一个非常完整的&lt;a href=&quot;https://sarcasm.github.io/notes/dev/compilation-database.html&quot;&gt;总结&lt;/a&gt; ，可以查看里面的方法。我这里推荐在CMake项目中用CMake自带的，加上&lt;a href=&quot;https://github.com/nickdiego/compiledb-generator&quot;&gt;nickdiego/compiledb-generator&lt;/a&gt; 应付基于Makefile/Autotools的项目。如果都不适用，就按照cquery的README写一个简单的.cquery文件即可，不需要Bear那种必须关闭SIP的方案。&lt;/p&gt;

&lt;p&gt;然后就可以享受很多功能了！还是挺好用的。&lt;/p&gt;
</description>
        <pubDate>Tue, 12 Dec 2017 08:13:40 +0800</pubDate>
        <link>https://jiegec.github.io/programming/2017/12/12/lsp-and-cpp/</link>
        <guid isPermaLink="true">https://jiegec.github.io/programming/2017/12/12/lsp-and-cpp/</guid>
        
        <category>lsp</category>
        
        <category>cpp</category>
        
        <category>clang</category>
        
        <category>compilation_database</category>
        
        <category>cquery</category>
        
        <category>clangd</category>
        
        
        <category>programming</category>
        
      </item>
    
  </channel>
</rss>
