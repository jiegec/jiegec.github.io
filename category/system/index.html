
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="杰哥的{运维,编程,调板子}小笔记">
      
      
      
        <link rel="canonical" href="https://jia.je/category/system/">
      
      
        <link rel="prev" href="../speech/">
      
      
        <link rel="next" href="../unboxing/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.2.0-b0">
    
    
      
        <title>system - 杰哥的{运维,编程,调板子}小笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0c456da8.min.css">
      
      

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-3109FRSVTT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-3109FRSVTT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#system" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="杰哥的{运维,编程,调板子}小笔记" class="md-header__button md-logo" aria-label="杰哥的{运维,编程,调板子}小笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            杰哥的{运维,编程,调板子}小笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              system
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../open-source-contributions/" class="md-tabs__link">
        
  
    
  
  开源

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tags/" class="md-tabs__link">
        
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="/kb/" class="md-tabs__link">
        
  
    
  
  知识库

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../series/" class="md-tabs__link">
        
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../projects/" class="md-tabs__link">
        
  
    
  
  项目

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tools/" class="md-tabs__link">
        
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="/feed.xml" class="md-tabs__link">
        
  
    
  
  订阅

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../archive/2023/" class="md-tabs__link">
          
  
  归档

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../crypto/" class="md-tabs__link">
          
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="杰哥的{运维,编程,调板子}小笔记" class="md-nav__button md-logo" aria-label="杰哥的{运维,编程,调板子}小笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    杰哥的{运维,编程,调板子}小笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-contributions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开源
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    标签
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="/kb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    知识库
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../series/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系列
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    项目
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="/feed.xml" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    订阅
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    归档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2017
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2016/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2016
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/2014/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2014
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    分类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crypto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../csdn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    csdn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../ctf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ctf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    devops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../life/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    life
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../logo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../meta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    misc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../news/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    news
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../os/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    os
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../others/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    others
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    software
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../speech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    speech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    system
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    system
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sco-openserver-600" class="md-nav__link">
    SCO OpenServer 6.0.0 虚拟机安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unixware-714" class="md-nav__link">
    UnixWare 7.1.4 虚拟机安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aix-72" class="md-nav__link">
    AIX 7.2 虚拟机安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sco-openserver-507" class="md-nav__link">
    SCO OpenServer 5.0.7 虚拟机安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openbsd-xonly" class="md-nav__link">
    OpenBSD xonly 实现原理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solaris-114" class="md-nav__link">
    Solaris 11.4 安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freebsdnetbsdopenbsddragonflybsd-cookbook" class="md-nav__link">
    FreeBSD/NetBSD/OpenBSD/DragonFlyBSD Cookbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nuc11-esxi-igpu" class="md-nav__link">
    NUC11 ESXi 中 iGPU 直通虚拟机
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rhel-6-centos-7" class="md-nav__link">
    一次从 RHEL 6 到 CentOS 7 的更新
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipmitool-ilo-4" class="md-nav__link">
    通过 ipmitool 配置 iLO 4 管理端口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipmitool" class="md-nav__link">
    静态编译 ipmitool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#idrac" class="md-nav__link">
    iDRAC 各版本
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ibm-power-s822lc8335-gtb-bmc" class="md-nav__link">
    IBM Power S822LC(8335-GTB) BMC 升级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tp-link-archer-t4u-v3-linux" class="md-nav__link">
    TP-Link Archer T4U V3 Linux 驱动安装
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macbookpro-143-wi-fi" class="md-nav__link">
    MacBookPro 14,3 Wi-Fi 驱动问题解决方案
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archlinux-winbind-pam-windows-ad" class="md-nav__link">
    在 Archlinux 上用 winbind 配合 pam 配置 Windows AD 认证登录
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archlinux" class="md-nav__link">
    在服务器上安装 Archlinux 记录
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-macos-sierra-karabiner-elements-finally-support-complex-modifications" class="md-nav__link">
    In macOS Sierra, Karabiner-Elements finally support complex modifications
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../unboxing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    unboxing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="system">system<a class="headerlink" href="#system" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-04-10 00:00:00">2023年4月10日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="sco-openserver-600"><a class="toclink" href="../../system/2023/04/10/sco6/">SCO OpenServer 6.0.0 虚拟机安装</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/04/10/sco6/#_1">安装过程</a></h3>
<p>首先从 <a href="https://www.sco.com/support/update/download/product.php?pfid=12&amp;prid=20">https://www.sco.com/support/update/download/product.php?pfid=12&amp;prid=20</a> 下载 SCO OpenServer 的安装 ISO。尝试过用 QEMU 启动，但是会卡在无法读取硬盘的错误上。</p>
<p>最后使用 VirtualBox 7.0.6 成功启动，注意创建虚拟机的时候不要给太多内存，例如 4GB 就起不来，2GB 可以。硬盘我也只给了 4GB 的空间。</p>
<p>安装过程中会询问 License number 和 License code，可以选择使用 Evaluation License，或者使用下面参考文档中提供的 License。按照流程一直走就可以了。如果重启出现无法 mount root 的问题，就 poweroff 再开机。</p>
<h3 id="_2"><a class="toclink" href="../../system/2023/04/10/sco6/#_2">参考文档</a></h3>
<p>本博客参考了以下文档中的命令：</p>
<ul>
<li><a href="https://virtuallyfun.com/2020/11/21/fun-with-openserver-6-and-mergepro/">https://virtuallyfun.com/2020/11/21/fun-with-openserver-6-and-mergepro/</a></li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2023/04/10/sco6/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-04-10 00:00:00">2023年4月10日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="unixware-714"><a class="toclink" href="../../system/2023/04/10/unixware7/">UnixWare 7.1.4 虚拟机安装</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/04/10/unixware7/#_1">安装过程</a></h3>
<p>在 <a href="https://www.sco.com/support/update/download/product.php?pfid=1&amp;prid=6">https://www.sco.com/support/update/download/product.php?pfid=1&amp;prid=6</a> 可以看到 UnixWare 7.1.4 的相关下载，其中首先要下载 UnixWare 的安装 ISO：<a href="https://www.sco.com/support/update/download/release.php?rid=346">https://www.sco.com/support/update/download/release.php?rid=346</a>，尝试过用 QEMU 启动，会遇到找不到 CD-ROM 的问题，虽然通过设置 <code>ATAPI_DMA_DISABLE=YES</code> 解决了，但是又遇到了找不到硬盘的问题。</p>
<p>最后换成了 VirtualBox 7.0.6。用 VirtualBox 创建虚拟机的时候，不要给太多内存，4GB 就会无法启动，2GB 可以，硬盘也不要给太多，4GB 就足够。</p>
<p>剩下就是按照安装界面一路默认即可，License 可以选择 Defer，使用 Evaluation License。</p>
<p>关机以后，修改启动顺序，把硬盘放到 CD 前，然后启动，就可以进入系统了。如果重启出现无法 mount root 的问题，就 poweroff 再开机。</p>
<h3 id="_2"><a class="toclink" href="../../system/2023/04/10/unixware7/#_2">参考文档</a></h3>
<p>本博客参考了以下文档中的命令：</p>
<ul>
<li><a href="https://virtuallyfun.com/2018/01/31/revisiting-a-unixware-7-1-1-install-on-qemu-kvm/">https://virtuallyfun.com/2018/01/31/revisiting-a-unixware-7-1-1-install-on-qemu-kvm/</a></li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2023/04/10/unixware7/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-04-09 00:00:00">2023年4月9日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="aix-72"><a class="toclink" href="../../system/2023/04/09/aix/">AIX 7.2 虚拟机安装</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/04/09/aix/#_1">安装过程</a></h3>
<p>宿主机环境是 Debian bookworm，不需要像其他教程那样自己编译 qemu，直接 apt install 即可。</p>
<p>通过 google 可以搜索到 AIX 7.2 的 ISO，下载第一个 ISO 到本地，然后在 QEMU 中启动安装镜像：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2023/04/09/aix/#__codelineno-0-1"></a>qemu-img<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>qcow2<span class="w"> </span>aix-hdd.qcow2<span class="w"> </span>20G
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2023/04/09/aix/#__codelineno-0-2"></a>qemu-system-ppc64<span class="w"> </span>-cpu<span class="w"> </span>POWER8<span class="w"> </span>-machine<span class="w"> </span>pseries<span class="w"> </span>-m<span class="w"> </span><span class="m">16384</span><span class="w"> </span>-serial<span class="w"> </span>mon:stdio<span class="w"> </span>-drive<span class="w"> </span><span class="nv">file</span><span class="o">=</span>aix-hdd.qcow2,if<span class="o">=</span>none,id<span class="o">=</span>drive-virtio-disk0<span class="w"> </span>-device<span class="w"> </span>virtio-scsi-pci,id<span class="o">=</span>scsi<span class="w"> </span>-device<span class="w"> </span>scsi-hd,drive<span class="o">=</span>drive-virtio-disk0<span class="w"> </span>-cdrom<span class="w"> </span>aix_7200-04-02-2027_1of2_072020.iso<span class="w"> </span>-prom-env<span class="w"> </span>boot-command<span class="o">=</span><span class="s1">&#39;boot cdrom:\ppc\chrp\bootfile.exe&#39;</span><span class="w"> </span>-display<span class="w"> </span>none
</span></code></pre></div>
<p>进去以后，耐心等待，直到进入安装界面，按照提示进行安装，建议安装上 SSH Server，关掉图形界面，这样安装会比较快。安装需要几十分钟，安装完成后会进入 bootloop，关掉 QEMU。接着，准备好网络：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2023/04/09/aix/#__codelineno-1-1"></a>sudo<span class="w"> </span>ip<span class="w"> </span>tuntap<span class="w"> </span>add<span class="w"> </span>tap0<span class="w"> </span>mode<span class="w"> </span>tap
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2023/04/09/aix/#__codelineno-1-2"></a>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>tap0<span class="w"> </span>up
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2023/04/09/aix/#__codelineno-1-3"></a>sudo<span class="w"> </span>ip<span class="w"> </span>a<span class="w"> </span>add<span class="w"> </span><span class="m">10</span>.0.2.15/24<span class="w"> </span>dev<span class="w"> </span>tap0
</span></code></pre></div>
<p>再启动虚拟机，注意启动选项修改了，并且多了网络的配置：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2023/04/09/aix/#__codelineno-2-1"></a>qemu-system-ppc64<span class="w"> </span>-cpu<span class="w"> </span>POWER8<span class="w"> </span>-machine<span class="w"> </span>pseries<span class="w"> </span>-m<span class="w"> </span><span class="m">16384</span><span class="w"> </span>-serial<span class="w"> </span>mon:stdio<span class="w"> </span>-drive<span class="w"> </span><span class="nv">file</span><span class="o">=</span>aix-hdd.qcow2,if<span class="o">=</span>none,id<span class="o">=</span>drive-virtio-disk0<span class="w"> </span>-device<span class="w"> </span>virtio-scsi-pci,id<span class="o">=</span>scsi<span class="w"> </span>-device<span class="w"> </span>scsi-hd,drive<span class="o">=</span>drive-virtio-disk0<span class="w"> </span>-cdrom<span class="w"> </span>aix_7200-04-02-2027_1of2_072020.iso<span class="w"> </span>-prom-env<span class="w"> </span>boot-command<span class="o">=</span><span class="s1">&#39;boot disk:&#39;</span><span class="w"> </span>-display<span class="w"> </span>none<span class="w"> </span>-net<span class="w"> </span>nic<span class="w"> </span>-net<span class="w"> </span>tap,script<span class="o">=</span>no,ifname<span class="o">=</span>tap0
</span></code></pre></div>
<p>第一次启动系统时，会进入配置界面，修改好 root 密码，然后配置网络：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2023/04/09/aix/#__codelineno-3-1"></a>chdev<span class="w"> </span>-l<span class="w"> </span>en0<span class="w"> </span>-a<span class="w"> </span><span class="nv">netaddr</span><span class="o">=</span><span class="m">10</span>.0.2.16<span class="w"> </span>-a<span class="w"> </span><span class="nv">netmask</span><span class="o">=</span><span class="m">255</span>.255.255.0<span class="w"> </span>-a<span class="w"> </span><span class="nv">state</span><span class="o">=</span>up
</span></code></pre></div>
<p>到这里了以后，就可以通过 ssh 访问虚拟机：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="../../system/2023/04/09/aix/#__codelineno-4-1"></a>ssh<span class="w"> </span>root@10.0.2.16
</span></code></pre></div>
<h3 id="kvm"><a class="toclink" href="../../system/2023/04/09/aix/#kvm">KVM</a></h3>
<p>另外测试了一下，在 powerpc64 机器上，可以开启 KVM 来加速 QEMU，但是需要首先关掉 SMT。另外在使用过程中出现了玄学问题，最后还是在 x86 上跑了虚拟机。</p>
<h3 id="_2"><a class="toclink" href="../../system/2023/04/09/aix/#_2">安装软件</a></h3>
<p>接下来，可以从 <a href="https://www.ibm.com/support/pages/node/882892">AIX Toolbox for Open Source Software</a> 安装软件：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="../../system/2023/04/09/aix/#__codelineno-5-1"></a><span class="c1">## in aix</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="../../system/2023/04/09/aix/#__codelineno-5-2"></a>chfs<span class="w"> </span>-a<span class="w"> </span><span class="nv">size</span><span class="o">=</span>+200M<span class="w"> </span>/home
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="../../system/2023/04/09/aix/#__codelineno-5-3"></a>chfs<span class="w"> </span>-a<span class="w"> </span><span class="nv">size</span><span class="o">=</span>+400M<span class="w"> </span>/opt
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="../../system/2023/04/09/aix/#__codelineno-5-4"></a>chfs<span class="w"> </span>-a<span class="w"> </span><span class="nv">size</span><span class="o">=</span>+400M<span class="w"> </span>/tmp
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="../../system/2023/04/09/aix/#__codelineno-5-5"></a><span class="c1">## setup default gateway</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="../../system/2023/04/09/aix/#__codelineno-5-6"></a>route<span class="w"> </span>add<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">10</span>.0.2.15<span class="w"> </span>-if<span class="w"> </span>en0
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="../../system/2023/04/09/aix/#__codelineno-5-7"></a><span class="c1">## edit /etc/resolv.conf</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="../../system/2023/04/09/aix/#__codelineno-5-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;nameserver 1.1.1.1&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="../../system/2023/04/09/aix/#__codelineno-5-9"></a><span class="c1">## in host</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="../../system/2023/04/09/aix/#__codelineno-5-10"></a>wget<span class="w"> </span>https://public.dhe.ibm.com/aix/freeSoftware/aixtoolbox/ezinstall/ppc/dnf_aixtoolbox.sh
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="../../system/2023/04/09/aix/#__codelineno-5-11"></a>scp<span class="w"> </span>dnf_aixtoolbox.sh<span class="w"> </span>root@10.0.2.16:/
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="../../system/2023/04/09/aix/#__codelineno-5-12"></a><span class="c1">## in aix</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="../../system/2023/04/09/aix/#__codelineno-5-13"></a>rpm<span class="w"> </span>--rebuilddb
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="../../system/2023/04/09/aix/#__codelineno-5-14"></a>ksh<span class="w"> </span>/dnf_aixtoolbox.sh<span class="w"> </span>-y
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="../../system/2023/04/09/aix/#__codelineno-5-15"></a>/opt/freeware/bin/dnf<span class="w"> </span>update
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="../../system/2023/04/09/aix/#__codelineno-5-16"></a>/opt/freeware/bin/dnf<span class="w"> </span>install<span class="w"> </span>gcc
</span></code></pre></div>
<p>安装好的包会放到 /opt/freeware 路径下。</p>
<p>安装过程中可能需要继续扩大各个 fs 的大小。</p>
<p>dnf 如果提示缺少 <code>libssl.a</code>，参考 <a href="https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors">https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors</a> 进行解决：</p>
<ol>
<li>
<p>访问 <a href="https://www.ibm.com/resources/mrs/assets?source=aixbp&amp;S_PKG=openssl">https://www.ibm.com/resources/mrs/assets?source=aixbp&amp;S_PKG=openssl</a> 下载安装包，例如 <code>openssl-1.1.2.2000.tar.Z</code>。</p>
</li>
<li>
<p>scp 到 AXI 上安装：</p>
</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="../../system/2023/04/09/aix/#__codelineno-6-1"></a>uncompress<span class="w"> </span>openssl-1.1.2.2000.tar.Z
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="../../system/2023/04/09/aix/#__codelineno-6-2"></a>tar<span class="w"> </span>-xvf<span class="w"> </span>openssl-1.1.2.2000.tar
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="../../system/2023/04/09/aix/#__codelineno-6-3"></a><span class="c1">## install openssl.base using smitty</span>
</span></code></pre></div>
<p>为了方便，可以修改 <code>/etc/environment</code> 文件，把 <code>/opt/freeware/bin</code> 目录加到 PATH 目录中。</p>
<h3 id="_3"><a class="toclink" href="../../system/2023/04/09/aix/#_3">参考文档</a></h3>
<p>本博客参考了以下文档中的命令：</p>
<ul>
<li><a href="https://aix4admins.blogspot.com/2020/04/qemu-aix-on-x86-qemu-quick-emulator-is.html">https://aix4admins.blogspot.com/2020/04/qemu-aix-on-x86-qemu-quick-emulator-is.html</a></li>
<li><a href="https://virtuallyfun.com/2019/04/22/installing-aix-on-qemu/">https://virtuallyfun.com/2019/04/22/installing-aix-on-qemu/</a></li>
<li><a href="https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors">https://www.ibm.com/support/pages/resolving-rpm-libssla-and-libcryptoa-errors</a></li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2023/04/09/aix/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-04-09 00:00:00">2023年4月9日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="sco-openserver-507"><a class="toclink" href="../../system/2023/04/09/sco5/">SCO OpenServer 5.0.7 虚拟机安装</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/04/09/sco5/#_1">安装过程</a></h3>
<p>首先从 <a href="https://www.sco.com/support/update/download/release.php?rid=218">https://www.sco.com/support/update/download/release.php?rid=218</a> 下载 SCO OpenServer 的安装 ISO 和从 <a href="https://www.sco.com/support/update/download/release.php?rid=187">https://www.sco.com/support/update/download/release.php?rid=187</a> 下载 Supplement CD 5 ISO，然后用 QEMU 启动，这次需要用图形界面：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2023/04/09/sco5/#__codelineno-0-1"></a>qemu-system-i386<span class="w"> </span>-accel<span class="w"> </span>kvm<span class="w"> </span>-m<span class="w"> </span><span class="m">16384</span><span class="w"> </span>-serial<span class="w"> </span>mon:stdio<span class="w"> </span>-drive<span class="w"> </span><span class="nv">file</span><span class="o">=</span>sco-hdd.qcow2,if<span class="o">=</span>ide<span class="w"> </span>-cdrom<span class="w"> </span>../../ISOs/OpenServer-5.0.7Hw-10Jun05_1800.iso
</span></code></pre></div>
<p>安装过程中会询问 License number 和 License code，按照 <a href="https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/">https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/</a> 进行输入。</p>
<p>安装的时候，在 hard disk setup 那一步，记得关掉 bad tracking，否则会把整个盘扫一遍，我一开始建了 20GB 的 qcow2，结果这一步跑了一晚上，而且把 qcow2 撑满了。</p>
<p>安装后，重新启动，这次打开网络，同时挂载 Supplement CD 5 ISO：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2023/04/09/sco5/#__codelineno-1-1"></a>qemu-system-i386<span class="w"> </span>-accel<span class="w"> </span>kvm<span class="w"> </span>-m<span class="w"> </span><span class="m">16384</span><span class="w"> </span>-serial<span class="w"> </span>chardev:mouse<span class="w"> </span>-drive<span class="w"> </span><span class="nv">file</span><span class="o">=</span>sco-hdd.qcow2,if<span class="o">=</span>ide<span class="w"> </span>-cdrom<span class="w"> </span>osr507suppcd5.iso<span class="w"> </span>-net<span class="w"> </span>nic<span class="w"> </span>-net<span class="w"> </span>tap,script<span class="o">=</span>no,ifname<span class="o">=</span>tap0<span class="w"> </span>-chardev<span class="w"> </span>msmouse,id<span class="o">=</span>mouse
</span></code></pre></div>
<p>启动以后，运行 custom 命令，然后从 CD-ROM 安装 Graphics and NIC Drivers。我尝试了安装 Maintenance Pack 5，但是启动以后会找不到硬盘，只好恢复之前的 qcow2 备份。可能是缺少了运行 <code>/etc/conf/cf.d/link_unix</code> 命令。</p>
<p>为了让图形界面的鼠标工作，在命令行里运行 <code>mkdev mouse</code>，然后创建一个 Serial mouse -&gt; Microsoft Serial Mouse，Relink kernel 再重启。注意要和 QEMU 的 <code>-serial chardev:mouse -chardev msmouse,id=mouse</code> 配合。但是外面鼠标和里面鼠标移动的距离不一样。</p>
<p>然后运行 <code>netconfig</code> 命令，添加 LAN adapter，选择 Intel 网卡，然后退出，Relink kernel 然后重启，就可以访问网络了。可以用 <code>ifconfig net0 10.0.2.16</code> 设置 IP 地址， <code>route add default 10.0.2.15</code> 来设置默认路由。可以通过降低安全性，兼容老系统来 SSH：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2023/04/09/sco5/#__codelineno-2-1"></a>ssh<span class="w"> </span>-oCiphers<span class="o">=</span>aes128-cbc<span class="w"> </span>-oHostKeyAlgorithms<span class="o">=</span>ssh-rsa<span class="w"> </span>-oKexAlgorithms<span class="o">=</span>+diffie-hellman-group1-sha1<span class="w"> </span>root@10.0.2.16
</span></code></pre></div>
<p>类似地，scp 也要带上上面的参数，再打开 <code>-O</code> 模式。</p>
<h3 id="_2"><a class="toclink" href="../../system/2023/04/09/sco5/#_2">安装软件</a></h3>
<p>OpenServer 有自带的工具链：挂载安装 ISO，使用 custom 命令安装 OpenServer Development System 和 SCO OpenServer Linker and Application Development Libraries。但是需要 License 才能使用。</p>
<p>另一个方法是通过 FTP 访问 <a href="ftp://ftp2.sco.com/pub/skunkware/osr5/vols/">ftp://ftp2.sco.com/pub/skunkware/osr5/vols/</a>，可以看到一些软件的安装包，在里面下载软件并安装。例如，要安装 gcc：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2023/04/09/sco5/#__codelineno-3-1"></a>wget<span class="w"> </span>ftp://ftp2.sco.com/pub/skunkware/osr5/vols/gcc-2.95.2-VOLS.tar
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2023/04/09/sco5/#__codelineno-3-2"></a>scp<span class="w"> </span>-r<span class="w"> </span>-O<span class="w"> </span>-oCiphers<span class="o">=</span>aes128-cbc<span class="w"> </span>-oHostKeyAlgorithms<span class="o">=</span>ssh-rsa<span class="w"> </span>-oKexAlgorithms<span class="o">=</span>+diffie-hellman-group1-sha1<span class="w"> </span>gcc-2.95.2-VOLS.tar<span class="w"> </span>root@10.0.2.16:/
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="../../system/2023/04/09/sco5/#__codelineno-3-3"></a><span class="c1">## in sco5</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="../../system/2023/04/09/sco5/#__codelineno-3-4"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-2.95.2-VOLS.tar
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="../../system/2023/04/09/sco5/#__codelineno-3-5"></a><span class="c1">## Install from Media Images</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="../../system/2023/04/09/sco5/#__codelineno-3-6"></a>custom
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="../../system/2023/04/09/sco5/#__codelineno-3-7"></a>/usr/local/bin/gcc<span class="w"> </span>--version
</span></code></pre></div>
<p>依法炮制，可以安装 gcc、bash、make、git 等常用软件，只不过版本都很老。</p>
<h3 id="virtualbox"><a class="toclink" href="../../system/2023/04/09/sco5/#virtualbox">VirtualBox</a></h3>
<p>测试了一下，在 VirtualBox 7.0.6 中，可以正常安装 SCO OpenServer 5，不需要额外的设置，按照上面一样的方法进行安装即可，鼠标选择 PS/2 Microsoft Mouse，和 QEMU 一样有移动距离不对的情况。安装完，把硬盘启动顺序调到前面，重启即可。</p>
<p>网卡的话，照常 <code>netconfig</code>，然后添加 AMD PCNet 网卡即可。</p>
<h3 id="_3"><a class="toclink" href="../../system/2023/04/09/sco5/#_3">参考文档</a></h3>
<p>本博客参考了以下文档中的命令：</p>
<ul>
<li><a href="https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/">https://virtuallyfun.com/2020/11/03/fun-with-openserver-and-merge/</a></li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2023/04/09/sco5/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-02-07 00:00:00">2023年2月7日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 6 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="openbsd-xonly"><a class="toclink" href="../../system/2023/02/07/openbsd-xonly/">OpenBSD xonly 实现原理</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/02/07/openbsd-xonly/#_1">背景</a></h3>
<p>最近看到 <a href="https://marc.info/?l=openbsd-tech&amp;m=167501519712725&amp;w=2">xonly status</a>，看到 OpenBSD 最近在实现 xonly，也就是让一些页只能执行，不能读不能写。以往类似的做法是 <code>W^X</code>，也就是可以执行的时候不能写，可以写的时候不能执行。显然，xonly 是更加严格的，连读都不可以。查了一下历史，<code>W^X</code> 最早也是在 OpenBSD 中实现的，说不定以后 xonly 也会被各个操作系统实现。</p>
<h3 id="amd64"><a class="toclink" href="../../system/2023/02/07/openbsd-xonly/#amd64">amd64 上的实现</a></h3>
<p>在 amd64 的页表中，决定执行/读/写权限的是（见 Intel 文档 <code>Table 4-20. Format of a Page-Table Entry that Maps a 4-KByte Page</code>）：</p>
<ul>
<li>Bit 1(R/W): <code>Read/write; if 0, writes may not be allowed to the 4-KByte page referenced by this entry (see Section 4.6)</code></li>
<li>Bit 63(XD): <code>If IA32_EFER.NXE = 1, execute-disable (if 1, instruction fetches are not allowed from the 4-KByte page controlled by this entry; see Section 4.6); otherwise, reserved (must be 0)</code></li>
</ul>
<p>可以看到，在这个定义下，可能出现的权限组合：</p>
<table>
<thead>
<tr>
<th></th>
<th>R</th>
<th>W</th>
<th>X</th>
</tr>
</thead>
<tbody>
<tr>
<td>R/W=0, NXE=0</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>R/W=1, NXE=0</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>R/W=0, NXE=1, XD=0</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>R/W=1, NXE=1, XD=0</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>R/W=0, NXE=1, XD=1</td>
<td>Y</td>
<td>N</td>
<td>N</td>
</tr>
<tr>
<td>R/W=1, NXE=1, XD=1</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>需要注意的是，<code>IA32_EFER.NXE</code> 是全局的，而 <code>R/W</code> 和 <code>XD</code> 的粒度是页。可以看到，上面的所有组合中，都是可以读的。</p>
<p>那么，怎么实现 x-only 呢？OpenBSD 的实现方法是 Protection Keys。在比较新的 CPU 中，页表的 4 个位用来表示使用的 Protection Key 下标，一共有 16 个：</p>
<ul>
<li>Bits 62:59: <code>Protection key; if CR4.PKE = 1 or CR4.PKS = 1, this may control the page's access rights (see Section 4.6.2); otherwise, it is ignored and not used to control access rights.</code></li>
</ul>
<p>那么 CPU 在查页表的时候，如果 <code>CR4.PKE=1 or CR4.PKS=1</code>，就会根据这四个位去查找 PKRU 寄存器的取值。PKRU 是一个 32 位的寄存器，每两位对应一个 Protection Key，这两位表示是否允许读写：</p>
<div class="language-text highlight"><pre><span></span><code>The PKRU register (protection-key rights for user pages) is a 32-bit
register with the following format: for each i (0 ≤ i ≤ 15), PKRU[2i] is
the access-disable bit for protection key i (ADi); PKRU[2i+1] is the
write-disable bit for protection key i (WDi). The IA32_PKRS MSR has the
same format (bits 63:32 of the MSR are reserved and must be zero).
</code></pre></div>
<p>有了这个机制以后，就可以构造出 xonly 的页表项：</p>
<ul>
<li>R/W=0：不允许写</li>
<li>NXE=1, XD=0：允许执行</li>
<li>设置 62:59 位为一个 Key 编号，将对应的 PKRU 的两个位设为 1：不允许读，不允许写</li>
</ul>
<p>接下来看 OpenBSD 的<a href="https://github.com/openbsd/src/commit/e9e0c464329db9b56e1f2db65b0f536e53aa7e5f#diff-ab04285d8fd81f41887d9c9de2eb231be5e44c2d465f5c479943a1e21cf977ce">代码</a>：</p>
<p>首先，检测 CPU 是否支持 PKU 机制：</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-1"></a><span class="cm">/*</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-2"></a><span class="cm"> * If PKU is available, initialize PROT_EXEC entry correctly,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-3"></a><span class="cm"> * and enable the feature before it gets used</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-4"></a><span class="cm"> * XXX Some Hypervisors forget to save/restore PKU</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-5"></a><span class="cm"> */</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cpuid_level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mh">0x7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-7"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-8"></a><span class="w">    </span><span class="n">CPUID_LEAF</span><span class="p">(</span><span class="mh">0x7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">);</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ecx</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SEFF0ECX_PKU</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-10"></a><span class="w">        </span><span class="p">(</span><span class="n">cpu_ecxfeature</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CPUIDECX_HV</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-11"></a><span class="w">        </span><span class="n">lcr4</span><span class="p">(</span><span class="n">rcr4</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CR4_PKE</span><span class="p">);</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-12"></a><span class="w">        </span><span class="n">pg_xo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PG_XO</span><span class="p">;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-0-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>其中 <code>PG_XO</code> 的值是 <code>0x0800000000000000UL</code>，也就是只有 bit 59 位 1，对应 Protection Key #1。OpenBSD 内核设置 PKRU 寄存器为 <code>0xfffffffc</code>，即只有 Protection Key #0 不修改权限，其他 Protection Key 都是禁止读写。剩下的代码就是维护 PKRU 寄存器的取值，然后把 xonly 的页的 Protection Key 都设为 1，否则设为 0。</p>
<p>但需要注意的是，PKRU 寄存器用户态也可以读写。Linux 把 PKRU 暴露给了<a href="https://www.kernel.org/doc/html/latest/core-api/protection-keys.html">用户态</a>，允许用户态来自己设置页表的 Protection Key。OpenBSD 的实现方法则是进内核以后，检查 PKRU 寄存器，如果值修改了，就 SIGABRT。这有一定的风险，如果攻击代码修改了 PKRU 寄存器的内容，是有可能读取本来 xonly 的页的内容的。</p>
<h3 id="powerpc64"><a class="toclink" href="../../system/2023/02/07/openbsd-xonly/#powerpc64">powerpc64 上的实现</a></h3>
<p>powerpc64 的实现方法和 amd64 类似，见 <a href="https://github.com/openbsd/src/commit/6bd9427e6879f79e0e2c1e03d8411439da5bb69">commit</a>。机制和 AMD64 很像，下面引用一段 PowerISA 文档：</p>
<div class="language-text highlight"><pre><span></span><code>The Virtual Page Class Key Protection mechanism provides the means to
assign virtual pages to one of 32 classes, and to modify data access
permissions for each class by modifying the Authority Mask Register
(AMR), shown in Figure 28, and to modify instruction access permissions
for each class by modifying the Instruction Authority Mask Register
(IAMR) shown in Figure 29.
</code></pre></div>
<p>对应如下代码：</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-1"></a><span class="c1">// sys/arch/powerpc64/powerpc64/cpu.c</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-2"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-3"></a><span class="cm">     * Set AMR to inhibit loads and stores for all virtual page</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-4"></a><span class="cm">     * class keys, except for Key0 which is used for normal kernel</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-5"></a><span class="cm">     * access.  This means we can pick any other key to implement</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-6"></a><span class="cm">     * execute-only mappings.  But we pick Key1 since that allows</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-7"></a><span class="cm">     * us to use the same bit in the PTE as was used to enable the</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-8"></a><span class="cm">     * Data Access Compare mechanism on CPUs based on older</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-9"></a><span class="cm">     * versions of the architecture (such as the PowerPC 970).</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-10"></a><span class="cm">     *</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-11"></a><span class="cm">     * Set UAMOR (and AMOR just to be safe) to zero to prevent</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-12"></a><span class="cm">     * userland from modifying any bits in AMR.</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-13"></a><span class="cm">     */</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-14"></a><span class="w">    </span><span class="n">mtamr</span><span class="p">(</span><span class="mh">0x3fffffffffffffff</span><span class="p">);</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-15"></a><span class="w">    </span><span class="n">mtuamor</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-16"></a><span class="w">    </span><span class="n">mtamor</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-1-17"></a><span class="w">    </span><span class="n">isync</span><span class="p">();</span>
</span></code></pre></div>
<p>可以看到方法是一样的，Key0 正常，其他 Key 禁止读写。额外地，PowerISA 还可以设置 Protection Key 禁止执行。并且通过设置 UAMOR 寄存器，用户态不可以修改 AMR 寄存器，这让 xonly 比 AMD64 上更为完备。</p>
<p>最后一步，就是修改 PTE 属性，指定 Key 即可：</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-2-1"></a><span class="c1">// sys/arch/powerpc64/include/pte.h</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-2-2"></a><span class="cp">##define PTE_AC         0x0000000000000200ULL</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-2-3"></a><span class="c1">// sys/arch/powerpc64/powerpc64/pmap.c</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-2-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">prot</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">PROT_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PROT_WRITE</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="../../system/2023/02/07/openbsd-xonly/#__codelineno-2-5"></a><span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">pte_lo</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">PTE_AC</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="_2"><a class="toclink" href="../../system/2023/02/07/openbsd-xonly/#_2">其他指令集架构</a></h3>
<p>一些指令集架构的页表在设计的时候，就有独立的 R W X 权限位，于是不需要特殊的处理，直接把 mmap 的参数映射过去即可。</p>

    <nav class="md-post__action">
      <a href="../../system/2023/02/07/openbsd-xonly/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-02-03 00:00:00">2023年2月3日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="solaris-114"><a class="toclink" href="../../system/2023/02/03/solaris/">Solaris 11.4 安装</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/02/03/solaris/#_1">下载安装镜像</a></h3>
<p>访问 <a href="https://www.oracle.com/solaris/solaris11/downloads/solaris-downloads.html">https://www.oracle.com/solaris/solaris11/downloads/solaris-downloads.html</a>，点击下载，登录后跳转到一个新的页面。在 Platform 下拉框选择 x86，会出现一系列可以下载的文件。以 11.4.42.111.0 为例，需要下载的是：V1019840-01.iso Oracle Solaris 11.4.42.111.0 Interactive Text Install ISO (x86) for (Oracle Solaris on x86-64 (64-bit)), 890.5 MB。可以直接在浏览器中下载，也可以点击网页中的 WGET Options，用 wget 脚本下载。</p>
<p>下载以后，挂载 ISO 到虚拟机，正常按照指示进行安装</p>
<h3 id="_2"><a class="toclink" href="../../system/2023/02/03/solaris/#_2">配置软件源</a></h3>
<p>Solaris 的在线软件源需要订阅，如果不想订阅，需要下载和 Solaris <strong>版本一致</strong> 的 IPS 仓库。下载的地址和上面一样，需要 7 个 zip 文件，如 V1019847-01_1of7.zip Oracle Solaris 11.4.42.111.0 IPS Repository (SPARC, x86) for (Oracle Solaris on x86-64 (64-bit)), 2.2 GB。建议用 wget 脚本批量下载。</p>
<p>UPDATE: 根据 <a href="https://blogs.oracle.com/solaris/post/building-open-source-software-on-oracle-solaris-114-cbe-release">https://blogs.oracle.com/solaris/post/building-open-source-software-on-oracle-solaris-114-cbe-release</a>，实际上可以不下载 IPS 仓库，而是用在线的仓库，内容和下载的一致：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2023/02/03/solaris/#__codelineno-0-1"></a>sudo<span class="w"> </span>pkg<span class="w"> </span>set-publisher<span class="w"> </span>-G<span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="w"> </span>-g<span class="w"> </span>http://pkg.oracle.com/solaris/release/<span class="w"> </span>solaris
</span></code></pre></div>
<p>下载好了以后，全部解压到一个目录中，如 <code>/export/home/user/solaris</code>，然后启动本地的软件源服务：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2023/02/03/solaris/#__codelineno-1-1"></a>sudo<span class="w"> </span>svccfg<span class="w"> </span>-s<span class="w"> </span>application/pkg/server<span class="w"> </span>setprop<span class="w"> </span>pkg/inst_root<span class="o">=</span>/export/home/user/solaris
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2023/02/03/solaris/#__codelineno-1-2"></a>sudo<span class="w"> </span>svccfg<span class="w"> </span>-s<span class="w"> </span>application/pkg/server<span class="w"> </span>setprop<span class="w"> </span>pkg/readonly<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2023/02/03/solaris/#__codelineno-1-3"></a>sudo<span class="w"> </span>svccfg<span class="w"> </span>-s<span class="w"> </span>application/pkg/server<span class="w"> </span>setprop<span class="w"> </span>pkg/port<span class="o">=</span><span class="m">8081</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="../../system/2023/02/03/solaris/#__codelineno-1-4"></a>sudo<span class="w"> </span>svcadm<span class="w"> </span>refresh<span class="w"> </span>application/pkg/server
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="../../system/2023/02/03/solaris/#__codelineno-1-5"></a>sudo<span class="w"> </span>svcadm<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>application/pkg/server
</span></code></pre></div>
<p>然后配置 <code>pkg</code> 使用本地软件源：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2023/02/03/solaris/#__codelineno-2-1"></a>sudo<span class="w"> </span>pkg<span class="w"> </span>set-publisher<span class="w"> </span>-G<span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="w"> </span>-g<span class="w"> </span>http://localhost:8081<span class="w"> </span>solaris
</span></code></pre></div>
<p>之后就可以正常使用了：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2023/02/03/solaris/#__codelineno-3-1"></a>sudo<span class="w"> </span>pkg<span class="w"> </span>install<span class="w"> </span>gcc-11
</span></code></pre></div>
<p>命令参考：<a href="https://www.oracle.com/docs/tech/solaris-11-cheat-sheet.pdf">https://www.oracle.com/docs/tech/solaris-11-cheat-sheet.pdf</a></p>

    <nav class="md-post__action">
      <a href="../../system/2023/02/03/solaris/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-01-21 00:00:00">2023年1月21日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 7 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="freebsdnetbsdopenbsddragonflybsd-cookbook"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/">FreeBSD/NetBSD/OpenBSD/DragonFlyBSD Cookbook</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_1">背景</a></h3>
<p>最近在维护 lsof 的时候，需要在 FreeBSD/NetBSD/OpenBSD/DragonFlyBSD 上进行开发和测试，于是就装了虚拟机，特此记录我在使用过程中，与 Linux 不一样的一些常用 FreeBSD/NetBSD/OpenBSD/DragonFlyBSD 命令。</p>
<h3 id="freebsd"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#freebsd">FreeBSD</a></h3>
<p>文档参考：<a href="https://docs.freebsd.org/en/books/handbook">https://docs.freebsd.org/en/books/handbook</a></p>
<h4 id="_2"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_2">安装</a></h4>
<p>在 <a href="https://www.freebsd.org/where/">https://www.freebsd.org/where/</a> 找到最新版下载，对于虚拟机的需求，用 <code>-disk1.iso</code>，1 GB 左右。安装过程按照 UI 一步步走即可。</p>
<h4 id="root"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#root">root 权限</a></h4>
<p>FreeBSD 的 su 默认只有 wheel 组可以 su 到 root，所以安装的时候，建议给创建的帐号加上 wheel 组。也可以通过 pw 命令：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-0-1"></a>pw<span class="w"> </span>groupmod<span class="w"> </span>wheel<span class="w"> </span>-m<span class="w"> </span>freebsd
</span></code></pre></div>
<p>sudo 需要通过包管理器安装，用法和 Linux 一样。</p>
<h4 id="_3"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_3">包管理</a></h4>
<p>使用 <code>pkg</code> 命令进行包管理：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-1-1"></a>pkg<span class="w"> </span>update
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-1-2"></a>pkg<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>sudo<span class="w"> </span>vim<span class="w"> </span>fish
</span></code></pre></div>
<p><code>-U</code> 表示在 install 的时候不要再 update。</p>
<p>也可以从 Ports 源码编译，如：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-2-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://git.FreeBSD.org/ports.git<span class="w"> </span>/usr/ports
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-2-2"></a><span class="nb">cd</span><span class="w"> </span>/usr/ports/sysutils/lsof
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-2-3"></a>make<span class="w"> </span>install
</span></code></pre></div>
<h4 id="_4"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_4">升级</a></h4>
<p>使用 <code>freebsd-update</code> 命令升级：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-3-1"></a>freebsd-update<span class="w"> </span>fetch
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-3-2"></a>freebsd-update<span class="w"> </span>install
</span></code></pre></div>
<h4 id="_5"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_5">网络配置</a></h4>
<p>显示路由表：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-4-1"></a>netstat<span class="w"> </span>-nr
</span></code></pre></div>
<p>修改路由：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-5-1"></a><span class="c1">## ip route add 1.2.3.0/24 via 4.5.6.7</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-5-2"></a>route<span class="w"> </span>add<span class="w"> </span>-net<span class="w"> </span><span class="m">1</span>.2.3.0/24<span class="w"> </span><span class="m">4</span>.5.6.7
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-5-3"></a><span class="c1">## ip route del 1.2.3.0/24</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-5-4"></a>route<span class="w"> </span>delete<span class="w"> </span>-net<span class="w"> </span><span class="m">1</span>.2.3.0/24
</span></code></pre></div>
<p>网络接口：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-1"></a><span class="c1">## ip a</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-2"></a>ifconfig
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-3"></a><span class="c1">## ip link set dev abc up</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-4"></a>ifconfig<span class="w"> </span>abc<span class="w"> </span>up
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-5"></a><span class="c1">## ip a add 1.2.3.4/24 dev abc</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-6-6"></a>iconfig<span class="w"> </span>abc<span class="w"> </span>inet<span class="w"> </span><span class="m">1</span>.2.3.4/24
</span></code></pre></div>
<p>网路配置在 <code>/etc/rc.conf</code>：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-1"></a>## DHCP
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-2"></a>ifconfig_xxx=&quot;DHCP&quot;
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-3"></a>## Default Gateway
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-4"></a>defaultrouter=&quot;1.2.3.4&quot;
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-5"></a>## Static IP
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-6"></a>ifconfig_xxx=&quot;inet 1.2.3.4/24&quot;
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-7"></a>## Static route
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-8"></a>static_routes=&quot;name1 name2&quot;
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-9"></a>route_name1=&quot;-net 1.2.3.0/24 4.5.6.7&quot;
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-10"></a>route_name2=&quot;-net 3.2.1.0/24 7.6.5.4&quot;
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-11"></a>## Bridge
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-12"></a>cloned_interfaces=&quot;bridge0&quot;
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-13"></a>ifconfig_bridge0=&quot;addm net0 addm net1 up&quot;
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-14"></a>ifconfig_net0=&quot;up&quot;
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-7-15"></a>ifconfig_net1=&quot;up&quot;
</span></code></pre></div>
<h4 id="_6"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_6">换源</a></h4>
<p>USTC <a href="https://mirrors.ustc.edu.cn/help/freebsd-pkg.html">https://mirrors.ustc.edu.cn/help/freebsd-pkg.html</a>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-8-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/usr/local/etc/pkg/repos/
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-8-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;FreeBSD: { url: &quot;pkg+http://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/quarterly&quot; }&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-8-3"></a><span class="w">        </span>&gt;<span class="w"> </span>/usr/local/etc/pkg/repos/FreeBSD.conf
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-8-4"></a>pkg<span class="w"> </span>update
</span></code></pre></div>
<h4 id="truss"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#truss">truss</a></h4>
<p>truss 相当于 Linux 中的 strace。</p>
<h4 id="_7"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_7">编译内核</a></h4>
<p>文档：<a href="https://docs.freebsd.org/en/books/handbook/kernelconfig/">https://docs.freebsd.org/en/books/handbook/kernelconfig/</a></p>
<p>首先下载内核源码，然后创建内核配置：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-9-1"></a><span class="nb">cd</span><span class="w"> </span>/path/to/kernel/src
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-9-2"></a><span class="nb">cd</span><span class="w"> </span>sys/amd64/conf
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-9-3"></a>cp<span class="w"> </span>GENERIC<span class="w"> </span>MYKERNEL
</span></code></pre></div>
<p>编译和安装：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-10-1"></a>make<span class="w"> </span>buildkernel<span class="w"> </span><span class="nv">KERNCONF</span><span class="o">=</span>MYKERNEL
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-10-2"></a>make<span class="w"> </span>installkernel<span class="w"> </span><span class="nv">KERNCONF</span><span class="o">=</span>MYKERNEL
</span></code></pre></div>
<p>提交 patch：<a href="https://wiki.freebsd.org/Phabricator">https://wiki.freebsd.org/Phabricator</a></p>
<h4 id="_8"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_8">关机</a></h4>
<p>FreeBSD 的 shutdown 默认会停留在 halt 的状态，但是不会断电，需要添加 <code>-p</code> 选项。</p>
<h3 id="netbsd"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#netbsd">NetBSD</a></h3>
<h4 id="_9"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_9">包管理</a></h4>
<p>参考：<a href="https://www.netbsd.org/docs/pkgsrc/using.html">https://www.netbsd.org/docs/pkgsrc/using.html</a></p>
<p>使用 pkgin 做二进制包的包管理，首先安装 pkgin：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-11-1"></a><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/pkg/sbin:/usr/pkg/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-11-2"></a><span class="nv">PKG_PATH</span><span class="o">=</span><span class="s2">&quot;https://cdn.NetBSD.org/pub/pkgsrc/packages&quot;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-11-3"></a><span class="nv">PKG_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PKG_PATH</span><span class="s2">/NetBSD/amd64/9.3/All/&quot;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-11-4"></a><span class="nb">export</span><span class="w"> </span>PATH<span class="w"> </span>PKG_PATH
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-11-5"></a>pkg_add<span class="w"> </span>pkgin
</span></code></pre></div>
<p>包管理：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-12-1"></a>pkgin<span class="w"> </span>install<span class="w"> </span>sudo<span class="w"> </span>vim<span class="w"> </span>fish
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-12-2"></a>pkgin<span class="w"> </span>upgrade
</span></code></pre></div>
<p>和 FreeBSD 一样，NetBSD 的 su 默认只有 wheel 组可以 su 到 root，建议在安装创建新用户的时候就把自己的帐号加入到 wheel 组中。sudo 使用之前需要 visudo 修改配置。</p>
<p>也可以从源码 pkgsrc 进行编译，在 /usr/pkgsrc 路径下，编译好的程序会安装到 /usr/pkg/bin。</p>
<p>克隆并初始化 pkgsrc：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-13-1"></a><span class="nb">cd</span><span class="w"> </span>/usr<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cvs<span class="w"> </span>-q<span class="w"> </span>-z2<span class="w"> </span>-d<span class="w"> </span>anoncvs@anoncvs.NetBSD.org:/cvsroot<span class="w"> </span>checkout<span class="w"> </span>-P<span class="w"> </span>pkgsrc
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-13-2"></a><span class="nb">cd</span><span class="w"> </span>/usr/pkgsrc/bootstrap
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-13-3"></a>./bootstrap
</span></code></pre></div>
<p>编译 pkgsrc 中的软件：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-14-1"></a><span class="nb">cd</span><span class="w"> </span>/usr/pkgsrc/sysutils/lsof
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-14-2"></a>make
</span></code></pre></div>
<h4 id="_10"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_10">网络配置</a></h4>
<p>网络配置的命令和 FreeBSD 基本一样：</p>
<ul>
<li><code>netstat -nr</code>：查看路由表</li>
<li><code>route</code>：修改路由表</li>
<li><code>ifconfig</code>：配置网络接口</li>
</ul>
<p>但是 <code>/etc/rc.conf</code> 的配置语法不同，见 <code>man rc.conf</code> 和 <a href="https://www.netbsd.org/docs/network/#configuration_files">https://www.netbsd.org/docs/network/#configuration_files</a>。</p>
<h4 id="_11"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_11">升级</a></h4>
<p>参考 <a href="https://www.netbsd.org/docs/guide/en/chap-upgrading.html">https://www.netbsd.org/docs/guide/en/chap-upgrading.html</a></p>
<p>使用 sysupgrade 命令升级：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-15-1"></a>pkgin install sysupgrade
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-15-2"></a>sysupgrade auto https://cdn.NetBSD.org/pub/NetBSD/NetBSD-9.3/amd64
</span></code></pre></div>
<h4 id="_12"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_12">安装内核源码</a></h4>
<p>内核源码可以从 <a href="https://mirrors.tuna.tsinghua.edu.cn/NetBSD/NetBSD-9.3/source/sets/">https://mirrors.tuna.tsinghua.edu.cn/NetBSD/NetBSD-9.3/source/sets/</a> 下载。对于 lsof 只需要其中的 syssrc.tgz。</p>
<p>解压：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-16-1"></a>tar<span class="w"> </span>-xzf<span class="w"> </span>syssrc.tgz<span class="w"> </span>-C<span class="w"> </span>/
</span></code></pre></div>
<h3 id="openbsd"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#openbsd">OpenBSD</a></h3>
<h4 id="_13"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_13">安装</a></h4>
<p>文档：<a href="https://www.openbsd.org/faq/faq4.html">https://www.openbsd.org/faq/faq4.html</a></p>
<p>下载 <a href="https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/amd64/install72.iso">https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/amd64/install72.iso</a>，然后按照 UI 提示进行安装。使用 virt-manager 安装 OpenBSD 虚拟机的时候，在安装界面会遇到无法输入的问题，可以创建一个 USB Keyboard 来解决。</p>
<h4 id="_14"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_14">包管理</a></h4>
<p>文档：<a href="https://www.openbsdhandbook.com/package_management/">https://www.openbsdhandbook.com/package_management/</a></p>
<p>常用命令：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-1"></a><span class="c1">## Use TUNA Mirrors</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/installurl
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-3"></a><span class="c1">## Search</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-4"></a>pkg_info<span class="w"> </span>-Q<span class="w"> </span>fish
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-5"></a><span class="c1">## Install</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-6"></a>pkg_add<span class="w"> </span>sudo<span class="w"> </span>fish<span class="w"> </span>vim
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-7"></a><span class="c1">## Update packages</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-17-8"></a>pkg_add<span class="w"> </span>-u
</span></code></pre></div>
<p>另一个方法是从源码编译，首先下载 ports：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-18-1"></a>wget<span class="w"> </span>https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/ports.tar.gz
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span>/usr/src
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-18-3"></a>tar<span class="w"> </span>xzf<span class="w"> </span>/path/to/ports.tar.gz
</span></code></pre></div>
<h4 id="_15"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_15">系统升级</a></h4>
<p>参考：<a href="https://www.openbsdhandbook.com/system_management/updates/">https://www.openbsdhandbook.com/system_management/updates/</a></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-19-1"></a>syspatch<span class="w"> </span>-c
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-19-2"></a>syspatch
</span></code></pre></div>
<h4 id="autotools"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#autotools">autotools</a></h4>
<p>OpenBSD 允许存在多个版本的 autoconf/automake，所以在运行的时候需要用环境变量指定版本，如：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-20-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AUTOCONF_VERSION</span><span class="o">=</span><span class="m">2</span>.71
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-20-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AUTOMAKE_VERSION</span><span class="o">=</span><span class="m">1</span>.16
</span></code></pre></div>
<h4 id="_16"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_16">获取内核源码</a></h4>
<p>文档：<a href="https://www.openbsd.org/faq/faq5.html">https://www.openbsd.org/faq/faq5.html</a></p>
<p>命令：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-1"></a><span class="c1">## Add exampleuser to group wsrc</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-2"></a>user<span class="w"> </span>mod<span class="w"> </span>-G<span class="w"> </span>wsrc<span class="w"> </span>exampleuser
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-3"></a><span class="c1">## Download and extract</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-4"></a>wget<span class="w"> </span>https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/7.2/sys.tar.gz
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-5"></a><span class="nb">cd</span><span class="w"> </span>/usr/src
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-21-6"></a>tar<span class="w"> </span>xzf<span class="w"> </span>/path/to/sys.tar.gz
</span></code></pre></div>
<h4 id="ktrace"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#ktrace">ktrace</a></h4>
<p>ktrace 相当于 Linux 中的 strace。结果会保存在文件中，用 kdump 命令显示。</p>
<h3 id="dragonflybsd"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#dragonflybsd">DragonFlyBSD</a></h3>
<h4 id="_17"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_17">安装</a></h4>
<p>下载 ISO 文件：<a href="https://mirror-master.dragonflybsd.org/iso-images/dfly-x86_64-6.4.0_REL.iso">https://mirror-master.dragonflybsd.org/iso-images/dfly-x86_64-6.4.0_REL.iso</a></p>
<p>用 installer 用户登录开始安装。</p>
<h4 id="_18"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_18">用户管理</a></h4>
<p>和 FreeBSD 一样，su 需要 wheel 组，所以需要手动添加用户到 wheel 组中：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-22-1"></a>pw<span class="w"> </span>groupmod<span class="w"> </span>wheel<span class="w"> </span>-m<span class="w"> </span>username
</span></code></pre></div>
<h4 id="sshd"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#sshd">SSHD</a></h4>
<p>DragonFlyBSD 默认 sshd 配置不允许密码登录，如果要允许，需要修改 <code>/etc/ssh/sshd_config</code>，然后重启 ssh：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-23-1"></a>/etc/rc.d/sshd<span class="w"> </span>restart
</span></code></pre></div>
<h4 id="_19"><a class="toclink" href="../../system/2023/01/21/bsd-cookbook/#_19">包管理</a></h4>
<p>DragonFlyBSD 可以下载二进制包：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-24-1"></a>pkg<span class="w"> </span>update
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-24-2"></a>pkg<span class="w"> </span>upgrade
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="../../system/2023/01/21/bsd-cookbook/#__codelineno-24-3"></a>pkg<span class="w"> </span>install<span class="w"> </span>sudo<span class="w"> </span>vim<span class="w"> </span>fish
</span></code></pre></div>
<p>也可以从源码编译，见 <a href="https://www.dragonflybsd.org/docs/howtos/HowToDPorts/">https://www.dragonflybsd.org/docs/howtos/HowToDPorts/</a></p>

    <nav class="md-post__action">
      <a href="../../system/2023/01/21/bsd-cookbook/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2022-05-05 00:00:00">2022年5月5日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="nuc11-esxi-igpu"><a class="toclink" href="../../system/2022/05/05/nuc11-igpu-passthrough/">NUC11 ESXi 中 iGPU 直通虚拟机</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2022/05/05/nuc11-igpu-passthrough/#_1">背景</a></h3>
<p>之前在 NUC11PAKi5 上装了 ESXI 加几个虚拟机系统，但是自带的 iGPU Intel Iris Xe Graphics(Tiger Lake GT-2) 没用上，感觉有些浪费。因此想要给 Windows 直通。在直通到 Windows 后发现会无限重启，最后直通到 Linux 中。</p>
<h3 id="_2"><a class="toclink" href="../../system/2022/05/05/nuc11-igpu-passthrough/#_2">步骤</a></h3>
<p>第一步是到 esxi 的设备设置的地方，把 iGPU 的 Passthrough 打开，这时候会提示需要重启，但是如果重启，会发现还是处于 Needs reboot 状态。网上进行搜索，发现是 ESXi 自己占用了 iGPU 的输出，<a href="https://williamlam.com/2020/06/passthrough-of-integrated-gpu-igpu-for-standard-intel-nuc.html">解决方法</a>如下：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-0-1"></a>$<span class="w"> </span>esxcli<span class="w"> </span>system<span class="w"> </span>settings<span class="w"> </span>kernel<span class="w"> </span><span class="nb">set</span><span class="w"> </span>-s<span class="w"> </span>vga<span class="w"> </span>-v<span class="w"> </span>FALSE
</span></code></pre></div>
<p>这样设置以后就不会在显卡输出上显示 dcui 了，这是一个比较大的缺点，但是平时也不用自带的显示输出，就无所谓了。</p>
<p>第二步，重启以后，这时候看设备状态就是 Active。回到 Windows 虚拟机，添加 PCI device，然后启动。这时候，我遇到了这样的错误：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-1-1"></a>Module ‘DevicePowerOn’ power on failed
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-1-2"></a>Failed to register the device pciPassthru0
</span></code></pre></div>
<p>搜索了一番，<a href="https://shuttletitan.com/vsphere/pci-passthrough-module-devicepoweron-power-on-failed/">解决方法</a>是关掉 IOMMU。在虚拟机设计中关掉 IOMMU，就可以正常启动了。</p>
<p>第三步，进入 Windows，这时候就可以看到有一个新的未知设备了，VID=8086，PID=9a49；等待一段时间，Windows 自动安装好了驱动，就可以正常识别了。GPU-Z 中可以看到效果如下：</p>
<p><img alt="" src="/images/igpu-passthrough.png" /></p>
<p>不过关机重启的时候会蓝屏，可能还有一些问题，有人在<a href="https://community.intel.com/t5/Graphics/SR-IOV-support-for-intel-Iris-Xe-Graphics-on-i7-1165G7/td-p/1293264">论坛</a>上也说 passthrough 之后会蓝屏。这个问题一直没有解决。</p>
<p>再尝试 Passthrough 到 Linux：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>i915
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-2"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.173500<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span>enabling<span class="w"> </span>device<span class="w"> </span><span class="o">(</span><span class="m">0000</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0003</span><span class="o">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-3"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.180137<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>VT-d<span class="w"> </span>active<span class="w"> </span><span class="k">for</span><span class="w"> </span>gfx<span class="w"> </span>access
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-4"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.182109<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span>BAR<span class="w"> </span><span class="m">6</span>:<span class="w"> </span>can<span class="err">&#39;</span>t<span class="w"> </span>assign<span class="w"> </span><span class="o">[</span>???<span class="w"> </span>0x00000000<span class="w"> </span>flags<span class="w"> </span>0x20000000<span class="o">]</span><span class="w"> </span><span class="o">(</span>bogus<span class="w"> </span>alignment<span class="o">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-5"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.182110<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>find<span class="w"> </span>VBIOS<span class="w"> </span>tables<span class="w"> </span><span class="o">(</span>VBT<span class="o">)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-6"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.182541<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span>vgaarb:<span class="w"> </span>changed<span class="w"> </span>VGA<span class="w"> </span>decodes:<span class="w"> </span><span class="nv">olddecodes</span><span class="o">=</span>io+mem,decodes<span class="o">=</span>none:owns<span class="o">=</span>none
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-7"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.197374<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span>firmware:<span class="w"> </span>direct-loading<span class="w"> </span>firmware<span class="w"> </span>i915/tgl_dmc_ver2_08.bin
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-8"></a><span class="o">[</span><span class="w">    </span><span class="m">2</span>.198037<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>Finished<span class="w"> </span>loading<span class="w"> </span>DMC<span class="w"> </span>firmware<span class="w"> </span>i915/tgl_dmc_ver2_08.bin<span class="w"> </span><span class="o">(</span>v2.8<span class="o">)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-9"></a><span class="o">[</span><span class="w">    </span><span class="m">3</span>.401676<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>retrieve<span class="w"> </span>link<span class="w"> </span>info,<span class="w"> </span>disabling<span class="w"> </span>eDP
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-10"></a><span class="o">[</span><span class="w">    </span><span class="m">3</span>.515822<span class="o">]</span><span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>Initialized<span class="w"> </span>i915<span class="w"> </span><span class="m">1</span>.6.0<span class="w"> </span><span class="m">20200917</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0000</span>:13:00.0<span class="w"> </span>on<span class="w"> </span>minor<span class="w"> </span><span class="m">0</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-11"></a><span class="o">[</span><span class="w">    </span><span class="m">3</span>.516054<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>Cannot<span class="w"> </span>find<span class="w"> </span>any<span class="w"> </span>crtc<span class="w"> </span>or<span class="w"> </span>sizes
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-2-12"></a><span class="o">[</span><span class="w">    </span><span class="m">3</span>.516144<span class="o">]</span><span class="w"> </span>i915<span class="w"> </span><span class="m">0000</span>:13:00.0:<span class="w"> </span><span class="o">[</span>drm<span class="o">]</span><span class="w"> </span>Cannot<span class="w"> </span>find<span class="w"> </span>any<span class="w"> </span>crtc<span class="w"> </span>or<span class="w"> </span>sizes
</span></code></pre></div>
<p>OpenCL 也可以检测到：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>intel-opencl-icd<span class="w"> </span>clinfo
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-2"></a>Number<span class="w"> </span>of<span class="w"> </span>devices<span class="w">                                 </span><span class="m">1</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-3"></a><span class="w">  </span>Device<span class="w"> </span>Name<span class="w">                                     </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Graphics<span class="w"> </span>Gen12LP<span class="w"> </span><span class="o">[</span>0x9a49<span class="o">]</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-4"></a><span class="w">  </span>Device<span class="w"> </span>Vendor<span class="w">                                   </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Corporation
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-5"></a><span class="w">  </span>Device<span class="w"> </span>Vendor<span class="w"> </span>ID<span class="w">                                </span>0x8086
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-6"></a><span class="w">  </span>Device<span class="w"> </span>Version<span class="w">                                  </span>OpenCL<span class="w"> </span><span class="m">3</span>.0<span class="w"> </span>NEO
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-7"></a><span class="w">  </span>Device<span class="w"> </span>Numeric<span class="w"> </span>Version<span class="w">                          </span>0xc00000<span class="w"> </span><span class="o">(</span><span class="m">3</span>.0.0<span class="o">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-3-8"></a><span class="w">  </span>Driver<span class="w"> </span>Version<span class="w">                                  </span><span class="m">1</span>.0.0
</span></code></pre></div>
<p>Vulkan：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-1"></a>$<span class="w"> </span>vulkaninfo
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-2"></a>Group<span class="w"> </span><span class="m">1</span>:
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-3"></a><span class="w">        </span>Properties:
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-4"></a><span class="w">                </span>physicalDevices:<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-5"></a><span class="w">                        </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Xe<span class="w"> </span>Graphics<span class="w"> </span><span class="o">(</span>TGL<span class="w"> </span>GT2<span class="o">)</span><span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-6"></a><span class="w">                </span><span class="nv">subsetAllocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-8"></a><span class="w">        </span>Present<span class="w"> </span>Capabilities:
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-9"></a><span class="w">                </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Xe<span class="w"> </span>Graphics<span class="w"> </span><span class="o">(</span>TGL<span class="w"> </span>GT2<span class="o">)</span><span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">0</span><span class="o">)</span>:
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-10"></a><span class="w">                        </span>Can<span class="w"> </span>present<span class="w"> </span>images<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>devices:<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-11"></a><span class="w">                                </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Xe<span class="w"> </span>Graphics<span class="w"> </span><span class="o">(</span>TGL<span class="w"> </span>GT2<span class="o">)</span><span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-12"></a><span class="w">                </span>Present<span class="w"> </span>modes:<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="../../system/2022/05/05/nuc11-igpu-passthrough/#__codelineno-4-13"></a><span class="w">                        </span>DEVICE_GROUP_PRESENT_MODE_LOCAL_BIT_KHR
</span></code></pre></div>
<p>不过目前还没找到显示输出的方法，只能用 VMware SVGA 或者远程桌面。</p>
<h3 id="_3"><a class="toclink" href="../../system/2022/05/05/nuc11-igpu-passthrough/#_3">吐槽</a></h3>
<p>需要吐槽的是，11 代的核显不再支持 Intel GVT-g，而是提供了 SR-IOV 的虚拟化。但是，Linux i915 驱动没有做相应的支持。</p>
<p>参考文档：</p>
<ul>
<li><a href="https://williamlam.com/2020/06/passthrough-of-integrated-gpu-igpu-for-standard-intel-nuc.html">Passthrough of Integrated GPU (iGPU) for standard Intel NUC</a></li>
<li><a href="https://shuttletitan.com/vsphere/pci-passthrough-module-devicepoweron-power-on-failed/">PCI Passthrough – “Module ‘DevicePowerOn’ power on failed”</a></li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2022/05/05/nuc11-igpu-passthrough/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-08-30 00:00:00">2021年8月30日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="rhel-6-centos-7"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/">一次从 RHEL 6 到 CentOS 7 的更新</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#_1">背景</a></h3>
<p>有一台 RHEL 6 的服务器，各种软件版本太老了，用起来很难受，因此想升级。一开始想升级到 RHEL 7，但是发现必须要从 RedHat 下载 ISO，比较慢，所以我就先切换到 CentOS 6，再升级到 CentOS 7</p>
<h3 id="_2"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#_2">过程</a></h3>
<h4 id="rhel-6-pre-upgrade"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#rhel-6-pre-upgrade">RHEL 6 Pre upgrade</a></h4>
<p>一开始还是打算升级到 RHEL 7，所以跟随 RedHat 的文档去做 pre upgrade check，发现有一步要跑好久，网上搜了一下，发现这个步骤会扫描已有的各种程序，检查升级以后会不会出现不能运行的问题。但是如果有很多小文件，这一个过程就会进行很久，好在可以设置 exclusion 目录。最后检查出来的结果就是 GNOME 没法升级，建议卸载。</p>
<p>倒腾了一下升级工具，发现需要离线安装，比较麻烦，我就干脆换 CentOS 了。</p>
<h4 id="rhel-6-centos-6"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#rhel-6-centos-6">RHEL 6 -&gt; CentOS 6</a></h4>
<p>首先，把软件源都切换到 CentOS，这一步很简单，因为包都是一样的。只不过，因为 CentOS 6 在 centos-vault 里面，所以用起来比较麻烦。</p>
<h4 id="centos-6-centos-7"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#centos-6-centos-7">CentOS 6 -&gt; CentOS 7</a></h4>
<p>由于 CentOS 6 到 CentOS 7 升级涉及的改动比较多，官方提供了一个升级工具。一开始，我想直接升级到 CentOS 7 最新版本，但是报错，看到网上说可以升级到 CentOS 7 的早期版本，试了一下，确实没问题。</p>
<p>一通升级以后，重启，进入更新过程，发现很多包都安装失败了。重启以后，因为找不到 rootfs，挂在了 dracut 的 initramfs 里面。</p>
<h4 id="_3"><a class="toclink" href="../../system/2021/08/30/rhel6-upgrade-centos7/#_3">漫长的修复过程</a></h4>
<p>简单试了一下，发现 dracut 的 initramfs 里程序太少了，调试起来很痛苦。所以，我在 BMC 里通过 Virtual Media 挂了一个 Arch Linux 的 Live CD。因为通过 Web 访问延迟太高，我设了一个 root 密码，然后直接 ssh 到 live cd 系统中。</p>
<p>接着，我发现，可以正常找到盘和里面的各个分区，所以怀疑是之前 initramfs 里缺了什么东西，导致找不到硬盘。我 arch-chroot 到 root 分区里，然后手动更新各个包，特别麻烦：我首先升级了 yum repos 到最新的 CentOS 7，然后手动删掉/升级 el6 的各个软件包。最后好不容易把 kernel 终于升级好了，又重新生成 grub2 的配置，因为 CentOS 6 是 grub1。这时候，重启进入系统，发现可以找到 rootfs 了，但是经过 selinux relabel 以后，仍然会遇到 systemd-logind 起不来的问题，伴随着一系列的 audit 报警。</p>
<p>最后，使出了暴力的解决办法：在 cmdline 中设置 selinux=0 audit=0，然后终于进入系统了。再继续删掉一些 el6 的包，然后升级各种包，最后终于是恢复了正常。</p>

    <nav class="md-post__action">
      <a href="../../system/2021/08/30/rhel6-upgrade-centos7/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-03-29 00:00:00">2021年3月29日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 3 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ipmitool-ilo-4"><a class="toclink" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/">通过 ipmitool 配置 iLO 4 管理端口</a></h2>
<p>ipmitool 自带了对 iDRAC 的支持，可以通过 <code>ipmitool delloem</code> 设置 iDRAC 的管理端口。但是对 iLO 的支持并没有实现。研究了一番，找到了通过 raw command 配置 iLO 4 管理端口的方法。</p>
<p><a href="https://computercheese.blogspot.com/2013/05/ipmi-lan-commands.html">这篇文章</a> 讲述了 <code>ipmitool lan</code> 命令实际会发送的命令：</p>
<p>读取配置：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/#__codelineno-0-1"></a>$<span class="w"> </span>ipmitool<span class="w"> </span>raw<span class="w"> </span>0x0c<span class="w"> </span>0x02<span class="w"> </span>CHANNEL<span class="w"> </span>KEY<span class="w"> </span>SET<span class="w"> </span>BLOCK
</span></code></pre></div>
<p>一般来说 SET 和 BLOCK 都是 0。KEY 的常见取值：</p>
<ul>
<li>3: IP 地址</li>
<li>4: IP 地址来源</li>
<li>5: MAC 地址</li>
<li>6: 子网掩码</li>
<li>12: 默认网关</li>
</ul>
<p>返回的数据中，第一个字节忽略，剩下的就是数据了。</p>
<p>写入配置：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/#__codelineno-1-1"></a>$<span class="w"> </span>ipmitool<span class="w"> </span>raw<span class="w"> </span>0x0c<span class="w"> </span>0x01<span class="w"> </span>CHANNEL<span class="w"> </span>KEY<span class="w"> </span>DATA...
</span></code></pre></div>
<p>知道如何读取配置后，接下来就是找到 iLO 4 配置 NIC 的地方了。一番搜索，找到了 <a href="https://support.hpe.com/hpesc/public/docDisplay?docId=c04530505&amp;docLocale=en_US">HPE iLO IPMI User Guide</a>。在第 101 页，可以找到一个用于配置 iLO NIC 选择的设置：</p>
<div class="language-text highlight"><pre><span></span><code>Index: 224
iLO Dedicated/Shared NIC Selection.
data 3:
• Selected iLO NIC.
◦ 0h = iLO Dedicated NIC is selected.
◦ 1h = iLO Shared NIC is selected.
◦ All others = reserved
• To switch to another iLO NIC:
1. Write this (and possibly parameter 197) to the desired NIC selection
2. Configure all other relevant network parameters for the desin
3. Reset iLO. The desired NIC will be in use after iLO reset.
• When writing changes to data 3, NIC selection:
◦ data 1 must be AAh
◦ data 2 must be 55h
◦ data 4 must be FFh
</code></pre></div>
<p>有这样的信息以后，可以通过下面的命令来设置 Shared NIC：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/#__codelineno-2-1"></a>$<span class="w"> </span>ipmitool<span class="w"> </span>raw<span class="w"> </span>0x0c<span class="w"> </span>0x01<span class="w"> </span>0x01<span class="w"> </span><span class="m">224</span><span class="w"> </span>0xAA<span class="w"> </span>0x55<span class="w"> </span>0x01<span class="w"> </span>0xFF
</span></code></pre></div>
<p>再读出来 224，发现它的 data 4 表示 <code>iLO reset needed for some settings changes that have been made</code>。于是，执行 <code>ipmitool mc reset warm</code> 之后，就可以看到 NIC 选择已经更新：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/#__codelineno-3-1"></a>$<span class="w"> </span>ipmitool<span class="w"> </span>raw<span class="w"> </span>0x0c<span class="w"> </span>0x02<span class="w"> </span>0x01<span class="w"> </span><span class="m">197</span><span class="w"> </span>0x00<span class="w"> </span>0x00
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2021/03/29/ilo-nic-selection-ipmitool/#__codelineno-3-2"></a><span class="m">11</span><span class="w"> </span><span class="m">02</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">02</span>
</span></code></pre></div>
<p>数据分别表示：</p>
<ul>
<li>0x02: Shared NIC Selection = ALOM</li>
<li>0x01: Shared NIC Port Number = Port 1</li>
<li>0x02: Platform supports ALOM shared NIC</li>
</ul>
<p>如果想要的端口和默认选择不一样，可以写入 197 来更新。详见上面的文档链接。</p>
<p>超微的机器也有类似的办法：https://www.supermicro.org.cn/support/faqs/faq.cfm?faq=15868，可以用 <code>ipmiutil smcoem lanport</code> 命令来读取/修改。</p>
<p>Update：我给 IPMITOOL 提交了 <a href="https://github.com/ipmitool/ipmitool/pull/278">PR</a>，来简化这个过程</p>

    <nav class="md-post__action">
      <a href="../../system/2021/03/29/ilo-nic-selection-ipmitool/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-03-29 00:00:00">2021年3月29日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ipmitool"><a class="toclink" href="../../system/2021/03/29/static-ipmitool/">静态编译 ipmitool</a></h2>
<p>为了在 ESXi 上运行 ipmitool，需要静态编译 ipmitool。网上已经有一些解决方案：</p>
<p>https://github.com/ryanbarrie/ESXI-ipmitool
https://github.com/hobbsh/static-ipmitool
https://github.com/ewenmcneill/docker-build-static-ipmitool</p>
<p>我稍微修改了一下，用来编译最新 ipmitool：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-1"></a><span class="c1">##!/bin/bash</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-2"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="m">1</span>.8.18
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-4"></a>rm<span class="w"> </span>-rf<span class="w"> </span>ipmitool_<span class="nv">$VERSION</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-5"></a>curl<span class="w"> </span>-L<span class="w"> </span>-o<span class="w"> </span>ipmitool_<span class="nv">$VERSION</span>.tar.bz2<span class="w"> </span>http://deb.debian.org/debian/pool/main/i/ipmitool/ipmitool_<span class="nv">$VERSION</span>.orig.tar.bz2
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-6"></a>tar<span class="w"> </span>xvf<span class="w"> </span>ipmitool_<span class="nv">$VERSION</span>.tar.bz2
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-7"></a><span class="nb">cd</span><span class="w"> </span>ipmitool-<span class="nv">$VERSION</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-8"></a><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">CFLAGS</span><span class="o">=</span>-m64<span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span>-static<span class="w"> </span>./configure
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-9"></a>make<span class="w"> </span>-j24
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-10"></a><span class="nb">cd</span><span class="w"> </span>src
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-11"></a>../libtool<span class="w"> </span>--silent<span class="w"> </span>--tag<span class="o">=</span>CC<span class="w"> </span>--mode<span class="o">=</span>link<span class="w"> </span>gcc<span class="w"> </span>-m64<span class="w"> </span>-fno-strict-aliasing<span class="w"> </span>-Wreturn-type<span class="w"> </span>-all-static<span class="w"> </span>-o<span class="w"> </span>ipmitool.static<span class="w"> </span>ipmitool.o<span class="w"> </span>ipmishell.o<span class="w"> </span>../lib/libipmitool.la<span class="w"> </span>plugins/libintf.la
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="../../system/2021/03/29/static-ipmitool/#__codelineno-0-12"></a>file<span class="w"> </span><span class="nv">$PWD</span>/ipmitool.static
</span></code></pre></div>
<p>复制下来，编译完成后 scp 到 esxi 中即可使用。</p>

    <nav class="md-post__action">
      <a href="../../system/2021/03/29/static-ipmitool/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-03-03 00:00:00">2021年3月3日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="idrac"><a class="toclink" href="../../system/2021/03/03/idrac-versions/">iDRAC 各版本</a></h2>
<h3 id="idrac_1"><a class="toclink" href="../../system/2021/03/03/idrac-versions/#idrac_1">iDRAC 版本</a></h3>
<p>目前接触到的 iDRAC 版本有：7 8 9。一些常见的服务器型号和 iDRAC 版本对应关系：</p>
<ul>
<li>7: PowerEdge R320, PowerEdge R720</li>
<li>8: <a href="https://www.dell.com/support/home/en-us/product-support/product/poweredge-r730xd/drivers">PowerEdge R730xd</a>，PowerEdge R630，PowerEdge R730，PowerEdge C4130</li>
<li>9: <a href="https://www.dell.com/support/home/en-us/product-support/product/poweredge-r7425/drivers">PowerEdge R7425</a></li>
</ul>
<p>基本上，如果是 PowerEdge R 什么的，就看第二位数字，就可以推断出版本号了。</p>
<p>下面列举了一下可能会用到的版本。</p>
<h3 id="idrac-7"><a class="toclink" href="../../system/2021/03/03/idrac-versions/#idrac-7">iDRAC 7</a></h3>
<p><a href="https://www.dell.com/support/kbdoc/en-us/000175831/support-for-integrated-dell-remote-access-controller-7-idrac7">iDRAC 7 在 2020 年 2 月停止更新了</a>，最新版本是 2.65.65.65。</p>
<p>升级路线参考：<a href="https://www.reddit.com/r/homelab/comments/abuc09/psa_read_this_before_you_upgrade_your_firmware_on/">Reddit</a>。</p>
<ul>
<li>1.66.65 <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=3f4wv">下载页面</a>，2014 年 12 月版本。</li>
<li>2.10.10.10 <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverId=Y5K20">下载页面</a>，2015 年 4 月版本。</li>
<li>2.65.65.65 <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=0ghf4">下载页面</a>，2020 年 3 月版本，添加了 HSTS。</li>
</ul>
<h3 id="idrac-8"><a class="toclink" href="../../system/2021/03/03/idrac-versions/#idrac-8">iDRAC 8</a></h3>
<ul>
<li>2.10.10.10 <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=fm1pc">下载页面</a>，2015 年 3 月版本。</li>
<li>2.30.30.30: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=5gchc">下载页面</a>，2016 年 2 月版本，添加了 HTML5 virtual console 支持。</li>
<li>2.60.60.60: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=cx8n2">下载页面</a>，2018 年 6 月版本，添加了 virtual media over HTTP 支持。</li>
<li>2.70.70.70: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=dnh17">下载页面</a>，2019 年 10 月版本。</li>
<li>2.75.75.75: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=krcxx">下载页面</a>，2020 年 6 月版本。</li>
<li>2.75.100.75: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=dpv0r">下载页面</a>，2021 年 1 月版本。</li>
</ul>
<h3 id="idrac-9"><a class="toclink" href="../../system/2021/03/03/idrac-versions/#idrac-9">iDRAC 9</a></h3>
<ul>
<li>4.00.00.00: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=4jcpk">下载页面</a>，2019 年 12 月版本。LLDP 连接视图。</li>
<li>4.22.00.00: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=9f2tg">下载页面</a>，2020 年 7 月版本。</li>
<li>4.40.00.00: <a href="https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=62gw1">下载页面</a>，2020 年 12 月版本，下一代的 iDRAC virtual console 和 virtual media，支持 Infiniband。</li>
</ul>

    <nav class="md-post__action">
      <a href="../../system/2021/03/03/idrac-versions/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-10-09 00:00:00">2020年10月9日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 4 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ibm-power-s822lc8335-gtb-bmc"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/">IBM Power S822LC(8335-GTB) BMC 升级</a></h2>
<h3 id="_1"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_1">背景</a></h3>
<p>最近拿到一台 IBM Power S822LC（8335-GTB）机器的访问权限，这也是我第一次碰 ppc64le 指令集的服务器。然后发现，它的 BMC 版本比较老，我想连接 Remote Control 失败了，原因是 JViewer 不支持 macOS，我就想着能不能升级一下。</p>
<h3 id="_2"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_2">升级过程</a></h3>
<p>首先，在网上找了一下文档，首先用 ipmitool 找一下机器型号：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">3</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-2"></a><span class="w"> </span>Chassis<span class="w"> </span>Type<span class="w">          </span>:<span class="w"> </span>Unknown
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-3"></a><span class="w"> </span>Chassis<span class="w"> </span>Part<span class="w"> </span>Number<span class="w">   </span>:<span class="w"> </span><span class="m">8335</span>-GTB
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-0-4"></a><span class="w"> </span>Chassis<span class="w"> </span>Serial<span class="w">        </span>:<span class="w"> </span>REDACTED
</span></code></pre></div>
<p>可以看到，这台机器是 8335-GTB 型号，按照这个型号在 <a href="https://www.ibm.com/support/fixcentral">Fix Central</a> 上搜索，可以找到若干个版本的 firmware，其中最老的版本是 <code>OP8_v1.11_2.1</code>，对比了一下，和原来的版本一致：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">47</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-2"></a><span class="w"> </span>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-3"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-ibm-OP8_v1.11_2.1
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-da02863
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-81b8d98
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-5.3.6
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-1f6784d-3408af7
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-4.4.16-openpower1-bc83f92
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.2.4-de6cda2
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>garrison-xml-3db7b6e
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-11"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-69fb587
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-1-12"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-binar
</span></code></pre></div>
<p>于是，我下载了比较新的版本，一个 hpm 文件，然后在 BMC 网页上进行升级。第一次升级比较保守，选择了 2017 年的版本：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>ipmitool<span class="w"> </span>fru<span class="w"> </span>print<span class="w"> </span><span class="m">47</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-2"></a>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-3"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-ibm-OP8_v1.12_2.72
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-14a75d0
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-211bd05
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-5.4.3
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-2eb7706-69b1432
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-4.4.30-openpower1-084eb48
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.3.2-d709207
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>garrison-xml-19a5164
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-11"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-d7efe30-47b58cb
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-2-12"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostb
</span></code></pre></div>
<p>这次升级比较顺利，没有遇到什么障碍。但是我发现，BMC 里面显示的 BIOS 版本和 hpm 对不上，它总是认为 BIOS 版本是落后的，需要更新，而 Firmware 部分（BOOT 和 APP）是更新后的版本。但 BIOS 版本和原来的版本也不一样。于是我重新升级了几次，都没有效果，怀疑是升级出了问题。后来仔细读文档才发现，确实是 BMC 软件的问题（<a href="https://ak-delivery04-mul.dhe.ibm.com/sar/CMA/SFA/08cu1/0/8335GTB_820.1923.20190613n.xhtml">文档</a>）：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-1"></a>Note: BMC Dashboard shows an incorrect level for the BIOS caused by improper translation of the level subfields. The Bios number should reflect the PNOR level for the system of &quot;IBM-garrison-ibm-OP8_v1.11_2.19&quot;. In this case, the BIOS version should be 1.11_2.19 but shows as 1.17.19 instead with the &quot;11_2&quot; converted into the &quot;17&quot;.
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-3"></a>The Firmware Revision for the BMC firmware shows correctly as &quot;2.13.58&quot;.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-5"></a>Here is an example output of the Dashboard with an errant BIOS Version:
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-7"></a>Dashboard gives the overall information about the status of the device and remote server.
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-9"></a>Device Information
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-11"></a>Firmware Revision: 2.13.58
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-13"></a>Firmware Build Time: Oct 26 2016 11:40:55 CDT
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-3-15"></a>BIOS Version: 1.17.19
</span></code></pre></div>
<p>一番捣鼓之后，不知道怎么了，BMC 就挂了，怎么访问都不通。只好物理断电，重新来过。按照同样的方法，升级到了 2019 年的版本：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-1"></a><span class="w"> </span>Product<span class="w"> </span>Name<span class="w">          </span>:<span class="w"> </span>OpenPOWER<span class="w"> </span>Firmware
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-2"></a><span class="w"> </span>Product<span class="w"> </span>Version<span class="w">       </span>:<span class="w"> </span>IBM-garrison-OP8_v1.12_2.96
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-3"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>op-build-v2.3-7-g99a6bc8
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-4"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>buildroot-2019.02.1-16-ge01dcd0
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-5"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>skiboot-v6.3.1
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-6"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>hostboot-p8-c893515-pd6f049d
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-7"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>occ-p8-a2856b7
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-8"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>linux-5.0.7-openpower1-p8e31f00
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-9"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>petitboot-v1.10.3
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="../../system/2020/10/09/upgrade-power8-bmc/#__codelineno-4-10"></a><span class="w"> </span>Product<span class="w"> </span>Extra<span class="w">         </span>:<span class="w">        </span>machine-xml-c5c3
</span></code></pre></div>
<p>中途也遇到了几次奇怪的问题，多次通过 IPMI reset 之后就好了。</p>
<h3 id="_3"><a class="toclink" href="../../system/2020/10/09/upgrade-power8-bmc/#_3">远程访问</a></h3>
<p>但是，最新版的 BMC 固件中，JViewer 依然没有 macOS 支持。我也 SSH 进去确认了一下，确实没有对应的支持文件。只好在 Linux 机器上访问，安装 icedtea 以后，就可以打开 jnlp 文件，之后一切都很正常。</p>
<p>一个可能的替代方案：https://github.com/sciapp/nojava-ipmi-kvm</p>

    <nav class="md-post__action">
      <a href="../../system/2020/10/09/upgrade-power8-bmc/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-01-05 00:00:00">2020年1月5日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="tp-link-archer-t4u-v3-linux"><a class="toclink" href="../../system/2020/01/05/archer-t4u-v3-driver/">TP-Link Archer T4U V3 Linux 驱动安装</a></h2>
<p>之前因为 MacBookPro 内置的 Wi-Fi 总是有问题，就找了个 USB 的无线网卡：TP-Link Archer T4U V3（VID：2357，PID：0115），这个网卡也没有主线的驱动，在网上找到了现成的驱动：<a href="https://github.com/cilynx/rtl88x2bu">cilynx/rtl88x2bu</a>，按照 README 用 DKMS 安装即可，实测可用。</p>
<p>Update: Linux 6.2+ 已经支持，见 <a href="https://linux-hardware.org/?id=usb:2357-0115">https://linux-hardware.org/?id=usb:2357-0115</a></p>

    <nav class="md-post__action">
      <a href="../../system/2020/01/05/archer-t4u-v3-driver/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-01-05 00:00:00">2020年1月5日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="macbookpro-143-wi-fi"><a class="toclink" href="../../system/2020/01/05/macbookpro-linux-wifi/">MacBookPro 14,3 Wi-Fi 驱动问题解决方案</a></h2>
<p>之前在 MacBookPro 14,3 安装 Linux 后，很多东西的驱动都有了解决方法，<a href="https://gist.github.com/TRPB/437f663b545d23cc8a2073253c774be3">参考 1</a>，<a href="https://github.com/roadrunner2/macbook12-spi-driver">参考 2</a>，触摸板和键盘等等都可以正常使用，触摸板的使用效果比我意料要好一些，虽然还是没有 macOS 原生那么好。但 Wi-Fi 一直有能扫到信号但连不上的问题，最近终于有了比较完善的解决方案，<a href="https://bugzilla.kernel.org/show_bug.cgi?id=193121#c52">地址</a>，也是两个月前才出来的方案，我测试了一下，确实可以很好的解决网络问题，网卡型号是 BCM43602，驱动用的是 brcmfmac。</p>
<p>另一方面，带 T2 的 MacBook 似乎也有了支持，见 <a href="https://github.com/aunali1/linux-mbp-arch">aunali1/linux-mbp-arch</a>，有一些尚未 upstream 的 patch，但我没有设备，就没有测试了。需要吐槽的是 ArchWiki 不怎么更新新 Model 的 MacBook 的教程，都是到处找散落的 github repo 和 gist 找别人的方案。</p>
<p>P.S. 可以正常工作的有：Wi-Fi，键盘，触摸板，Touchbar，内置摄像头，键盘背光，蓝牙
P.P.S MacBookPro11,2 的网卡是 BCM4360，直接用 broadcom-wl 驱动就可以。</p>

    <nav class="md-post__action">
      <a href="../../system/2020/01/05/macbookpro-linux-wifi/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-05-05 00:00:00">2018年5月5日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 5 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="archlinux-winbind-pam-windows-ad"><a class="toclink" href="../../system/2018/05/05/windows-ad-linux-pam/">在 Archlinux 上用 winbind 配合 pam 配置 Windows AD 认证登录</a></h2>
<p>作为不清真的网络管理员，为了配置一套完整的统一认证系统，陈老师采用了 Windows AD 的方法给这里配置统一认证。重装了系统，自然要把之前的统一认证再配到新装的 Archlinux 上。</p>
<p>参考资料： <a href="https://wiki.archlinux.org/index.php/Active_Directory_Integration">Active Directory Integration</a></p>
<p>首先安装相应的包：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-0-1"></a>pacman<span class="w"> </span>-S<span class="w"> </span>samba
</span></code></pre></div>
<p>我们还没有配好 Kerberos，所以跳过。</p>
<p>然后配置 /etc/samba/smb.conf，以下是一个例子。可以根据文档微调。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-1"></a>[global]
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-2"></a>        security = ads
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-3"></a>        realm = YOUR-AD-HERE
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-4"></a>        workgroup = YOUR-GROUP-HERE
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-5"></a>        idmap uid = 10000-20000
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-6"></a>        idmap gid = 10000-20000
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-7"></a>        winbind enum users = yes
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-8"></a>        winbind enum groups = yes
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-9"></a>        template homedir = /home/%D/%U
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-10"></a>        template shell = /bin/bash
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-11"></a>        client use spnego = yes
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-12"></a>        client ntlmv2 auth = yes
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-13"></a>        encrypt passwords = yes
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-14"></a>        winbind use default domain = yes
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-1-15"></a>        restrict anonymous = 2
</span></code></pre></div>
<p>这样，域上的用户 user 会拿到 home 目录为 /home/YOUR-DOMAIN-HERE/user，uid 在 10000-2000 范围内的用户。在一会经过配置之后，可以通过 <code>getent passwd</code> 验证。</p>
<p>接下来，需要把本机的 samba 登入到域的管理员，并且启动服务。</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-2-1"></a>net<span class="w"> </span>ads<span class="w"> </span>join<span class="w"> </span>-U<span class="w"> </span>your-user-name
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-2-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>smb
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-2-3"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>nmb
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-2-4"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>winbind
</span></code></pre></div>
<p>更改 /etc/nsswitch.conf，在 passwd, shadow 和 group 都增添 winbind：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-3-1"></a>passwd: files mymachines systemd winbind
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-3-2"></a>group: files mymachines systemd winbind
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-3-3"></a>shadow: files winbind
</span></code></pre></div>
<p>接下来，可以进一步验证配置是否正确：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-1"></a>wbinfo<span class="w"> </span>-u
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-2"></a>wbinfo<span class="w"> </span>-g
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-3"></a>getent<span class="w"> </span>passwd
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-4"></a>getent<span class="w"> </span>group
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-5"></a>net<span class="w"> </span>ads<span class="w"> </span>info
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-4-6"></a>net<span class="w"> </span>ads<span class="w"> </span>lookup
</span></code></pre></div>
<p>接下来可以配置 PAM 了。这一部分踩到了一些坑，现在终于做得差不多了。</p>
<p>需求：</p>
<ol>
<li>如果一个用户名既有本地用户也有域上的用户，选择前者</li>
<li>用户要修改密码的话，如果是域用户，则要求走 Windows AD 那套方法改密码；否则仅修改本地用户密码。</li>
</ol>
<p>实现：</p>
<p>修改 /etc/pam.d/system-auth:</p>
<p>第一部分：auth</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-1"></a>auth [success=1 default=ignore]         pam_localuser.so
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-2"></a>auth [success=2 default=die]            pam_winbind.so krb5_auth krb5_ccache_type=FILE cached_login try_first_pass
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-3"></a>auth [success=1 default=die]            pam_unix.so nullok_secure
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-4"></a>auth requisite                          pam_deny.so
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-5"></a>auth optional                           pam_permit.so
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-5-6"></a>auth required                           pam_env.so
</span></code></pre></div>
<p>首先利用 pam_localuser.so 匹配用户名和 <code>/etc/passwd</code> ，如果有， <code>success=1</code> 代表跳过下面一条规则，故会跳到 pam_unix.so 这一行。如果失败，<code>default=ignore</code> 表示忽略它的结果。如果是本地用户，匹配 pam_localuser.so 成功后跳到 pam_unix.so，如果成功了则跳到第五行，pam_permit.so 代表通过，最后由 pam_env.so 配置环境变量。如果是域用户，则由 pam_winbind.so 处理，如果成功，同样跳到第 5 条。如果本地用户和域用户都失败，就 pam_deny.so 认证失败。</p>
<p>第二部分：account</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-6-1"></a>account required                        pam_unix.so
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-6-2"></a>account [success=1 default=ignore]      pam_localuser.so
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-6-3"></a>account required                        pam_winbind.so
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-6-4"></a>account optional                        pam_permit.so
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-6-5"></a>account required                        pam_time.so
</span></code></pre></div>
<p>这一部分仍有疑问。留待以后来补充。</p>
<p>第三部分：password</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-1"></a>password [success=1 default=ignore]     pam_localuser.so
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-2"></a>password [default=die]                  pam_echo.so file=/etc/pam.d/messages/ad_reject_change_passwd.txt
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-3"></a>password optional                       pam_echo.so file=/etc/pam.d/messages/local_user_passwd.txt
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-4"></a>password [success=1 default=die]        pam_unix.so sha512 shadow
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-5"></a>password requisite                      pam_deny.so
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-7-6"></a>password optional                       pam_permit.so
</span></code></pre></div>
<p>这里实现了我们的需求：如果是本地用户，提醒用户当前要修改的是本地用户的密码；如果是域用户，则输出信息后直接拒绝。</p>
<p>这里的 /etc/pam.d/messages/ad_reject_change_passwd.txt 内容如下：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-8-1"></a>Hi %u, please go to xxxxxxx to change your Active Directory password!
</span></code></pre></div>
<p>第四部分：session</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-1"></a>session   required                      pam_limits.so
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-2"></a>session   required                      pam_mkhomedir.so skel=/etc/skel/ umask=0022
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-3"></a>session   required                      pam_unix.so
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-4"></a>session   [success=1 default=ignore]    pam_localuser.so
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-5"></a>session   required                      pam_winbind.so
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-9-6"></a>session   optional                      pam_permit.so
</span></code></pre></div>
<p>这里与 Wiki 上内容无异。</p>
<p>然后修改 /etc/pam.d/passwd :</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-10-1"></a>password        required        pam_cracklib.so difok=2 minlen=8 dcredit=2 ocredit=2 retry=3
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-10-2"></a>password        include         system-auth
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-10-3"></a>##password       requisite       pam_deny.so
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="../../system/2018/05/05/windows-ad-linux-pam/#__codelineno-10-4"></a>##password       required        pam_unix.so sha512 shadow nullok
</span></code></pre></div>
<p>首先判断密码强度。通过后则直接用刚才更改的 system-auth 中的 password 部分规则。</p>
<p>这样就配好了认证。自己对这套东西的理解还不够深，以后遇到了要继续钻研。</p>
<p>扩展阅读： <a href="https://innull.com/pam-configuration-how-to/">PAM 配置简介 - 王邈</a></p>

    <nav class="md-post__action">
      <a href="../../system/2018/05/05/windows-ad-linux-pam/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-05-01 00:00:00">2018年5月1日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 3 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="archlinux"><a class="toclink" href="../../system/2018/05/01/installing-arch-experience/">在服务器上安装 Archlinux 记录</a></h2>
<p>有一台服务器的 Ubuntu 挂了，我们想在上面重装一个 Archlinux。我们首先下载了 archlinux-2018.04.01 的 ISO, 直接 dd 到 U 盘上，但是遇到了问题。</p>
<p>首先遇到的问题是，一启动之后就会花屏。我们一开始怀疑是 NVIDIA 驱动的问题，于是想改 kernel param 但是发现，这个 ISO 是 hybrid 的，我们在 macOS 和 Windows 上都不能 mount 上这种类型的盘。于是我们选择自己搞分区表。我们把 U 盘插到电脑上，然后在 Linux 虚拟机内重新分区为 GPT，然后 mount 到 /mnt/usb，再重新下载 archlinux iso，不过此时刚好上游更新了 archlinux-2018.05.01 的影响。我们把 ISO 中根分区 mount 到 /mnt/iso 上来，然后 <code>cp -a /mnt/iso/* /mnt/usb</code> 。调整了 grub 中的内核参数，仍然无果。我们认为问题可能在显卡上，就把那张显卡拔下来了，果然显示就正常了，但是新的问题就来了。</p>
<p>一启动，fstab 尝试把 LABEL=ARCHISO_201805 挂在上来，但是失败。于是我们把 U 盘插到 mac 上，用 Disk Utility 给分区命了名，再插回去，然后这个 Live CD 的 Systemd 就成功起来了。接下来就是根据官方的 Installation Guide 进行安装各种东西。安装完后，在 /boot/EFI 的操作上也出现了一些问题，一开始忘记调用 <code>grub-mkconfig</code> ，导致重启以后进入 grub-rescue，所以又回到 Live CD 重新 <code>grub-mkconfig</code>  。同时对 systemd-networkd 也进行了相应的调整，这样开机以后可以配好网络。主要就是在网卡上配上两个 VLAN 和相应的 DHCP 和静态地址。</p>
<p>接下来对以前的东西进行迁移。主要就是按照十分详细的 Arch Wiki 进行相应的配置。由于空间所限，我们把原来的 home 目录直接 mount --bind 到 /home，但是不可避免地，会出现用户 id 不对应的问题。于是我们把需要用到的用户的 /etc/{passwd,group,shadow} 统统拷贝到新的系统的相应地方。然后是配置 winbind，就是按部就班地按照 Arch Wiki 和以前的配置进行更新，然后成功地把 AD 上的用户获取到。此时再次出现了 uid 不对应的问题，此时我们使用 <code>chown -R user:user /home/user</code> 的方法。</p>
<p>剩下的工作就是琐碎的安装各种常用软件。不必多说。</p>
<p>P.S. 我研究出了一个很好用的 mosh + tmux 的 fish function: (但是有时工作有时不工作，不明白什么回事)
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2018/05/01/installing-arch-experience/#__codelineno-0-1"></a>function tmosh
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2018/05/01/installing-arch-experience/#__codelineno-0-2"></a>    mosh $argv -- tmux new-session bash -c &#39;tmux set -g mouse on; tmux setw -g mode-keys vi; fish&#39;
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="../../system/2018/05/01/installing-arch-experience/#__codelineno-0-3"></a>end
</span></code></pre></div></p>

    <nav class="md-post__action">
      <a href="../../system/2018/05/01/installing-arch-experience/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2017-06-15 00:00:00">2017年6月15日</time></li>
        
          <li class="md-meta__item">
            分类于
            
              <a href="./" class="md-meta__link">system</a></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="in-macos-sierra-karabiner-elements-finally-support-complex-modifications"><a class="toclink" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/">In macOS Sierra, Karabiner-Elements finally support complex modifications</a></h2>
<p>In favor of this <a href="https://github.com/tekezo/Karabiner-Elements/commit/f37815dcf58fd1e91d3cd3d154c2ed3749a2510e">commit</a>, Karabiner-Elements now supports the much welcomed yet long-lost feature, namely complex modifications that enable users to trigger complex keypress.</p>
<p>Now I can achieve this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-0-1"></a>If I press &lt;Enter&gt;, then:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-0-2"></a>1. If &lt;Enter&gt; is pressed alone, then send &lt;Enter&gt;.
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-0-3"></a>2. If &lt;Enter&gt; is pressed along with other keys, then send &lt;Control&gt; + Other.
</span></code></pre></div></p>
<p>By adding this code to ~/.config/karabiner/karabiner.json :
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-1"></a>&quot;complex_modifications&quot;: {
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-2"></a>    &quot;rules&quot;: [
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-3"></a>        {
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-4"></a>            &quot;manipulators&quot;: [
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-5"></a>                {
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-6"></a>                    &quot;description&quot;: &quot;Change return_or_enter to left_control. (Post return_or_enter if pressed alone)&quot;,
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-7"></a>                    &quot;from&quot;: {
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-8"></a>                        &quot;key_code&quot;: &quot;return_or_enter&quot;,
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-9"></a>                        &quot;modifiers&quot;: {
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-10"></a>                            &quot;optional&quot;: [
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-11"></a>                                &quot;any&quot;
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-12"></a>                            ]
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-13"></a>                        }
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-14"></a>                    },
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-15"></a>                    &quot;to&quot;: [
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-16"></a>                        {
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-17"></a>                            &quot;key_code&quot;: &quot;left_control&quot;
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-18"></a>                        }
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-19"></a>                    ],
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-20"></a>                    &quot;to_if_alone&quot;: [
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-21"></a>                        {
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-22"></a>                            &quot;key_code&quot;: &quot;return_or_enter&quot;
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-23"></a>                        }
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-24"></a>                    ],
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-25"></a>                    &quot;type&quot;: &quot;basic&quot;
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-26"></a>                }
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-27"></a>            ]
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-28"></a>        }
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-29"></a>    ]
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/#__codelineno-1-30"></a>},
</span></code></pre></div>
in one of profiles.</p>
<p>Note: the snippet above is adopted from <a href="https://github.com/tekezo/Karabiner-Elements/blob/61df6ff04ce34adf1cbb00cfd7c5dd49c14c0889/examples/spacebar_to_shift.json">this example</a>. You can explore more examples since the GUI is not updated accordingly yet.</p>
<p>Important: Until NOW (2017-06-15), this feature is only implemented in beta versions of Karabiner-Elements (at least 0.91.1).</p>

    <nav class="md-post__action">
      <a href="../../system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/">
        继续阅读
      </a>
    </nav>
  </div>
</article>
      
    </div>
  </div>

          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../speech/" class="md-footer__link md-footer__link--prev" aria-label="上一页: speech" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                speech
              </div>
            </div>
          </a>
        
        
          
          <a href="../unboxing/" class="md-footer__link md-footer__link--next" aria-label="下一页: unboxing" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                unboxing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jiegec" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.780af0f4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f11ae8b1.min.js"></script>
      
        
          <script src="../../javascripts/mathjax.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
        
          <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
        
      
        
          <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
        
      
    
  </body>
</html>