<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 <title>Tag - macos</title>
 <link href="https://jiegec.me/tag/macos/index.xml" rel="self"/>
 <link href="https://jiegec.me/tag/macos.html"/>
 <updated>2018-10-07T22:32:08+08:00</updated>
 <id>https://jiegec.me/tag/macos.html</id>
 <author>
   <name>Jiege Chen</name>
 </author>
 
 <entry>
   <title>绕过 GPGMail 的激活检测</title>
   <link href="https://jiegec.me/software/2018/10/04/bypass-gpgmail-activation/"/>
   <updated>2018-10-04T11:47:00+08:00</updated>
   <id>https://jiegec.me/software/2018/10/04/bypass-gpgmail-activation</id>
   <content type="html">前段时间 GPGMail [宣布不再免费](https://gpgtools.org/support-plan)，在三十天的试用期后就不给用了。唉，可能是官方实在没钱维护了，也可能是官方想赚钱了。不过，既然 GPGMail 采用的是[自由的许可证](https://github.com/GPGTools/GPGMail/blob/high-sierra/LICENSE.txt)，意味着我们可以自己对代码进行更改。和许可证验证相关的[代码](https://github.com/GPGTools/GPGMail/blob/c08ce21eee08a1089c82c04af1fab5b85d72de68/Source/GPGMailBundle.m#L846)如下：

```
- (BOOL)hasActiveContract {
    NSDictionary *contractInformation = [self contractInformation];
    return [contractInformation[@&quot;Active&quot;] boolValue];
}
```

我们只要改成 `return TRUE` ，在自己的电脑上手动编译、并复制到 `/Library/Application Support/GPGTools/GPGMail` 下即可。

另：还有一个直接对二进制打 patch 的方法（仍然符合许可证），利用了最近打 CTF 学到的一些知识。找到以上这个函数，然后把返回值修改成非零即可。这里就不提供方法了。最后的更改：

```
$ radiff2 -D
--- 0x0000282f  410fbec7
- movsx eax, r15b
+++ 0x0000282f  4c89e090
+ mov rax, r12
+ nop
```

当然了，还需要额外 `codesign --remove-signature` 一下。

谨慎对非自由软件采用这个方法。可能有法律风险。</content>
 </entry>
 
 <entry>
   <title>在 macOS 的 VirtualBox 上从 USB 启动</title>
   <link href="https://jiegec.me/os/2018/09/14/virtualbox-booting-from-usb-on-mac/"/>
   <updated>2018-09-14T23:57:00+08:00</updated>
   <id>https://jiegec.me/os/2018/09/14/virtualbox-booting-from-usb-on-mac</id>
   <content type="html">做了一个 Windows 10 安装 U 盘，想测试一下能不能启动，于是想用 VirtualBox 起一个虚拟机。但是发现，一般情况下要从 ISO 或者把 U 盘克隆成一个 vdi/vmdk etc 再启动。不过找到了 Cem Arslan 的 [VirtualBox - Booting From USB (MAC)](https://www.linkedin.com/pulse/virtualbox-booting-from-usb-mac-cem-arslan) 实验了一下，确实可以用，以 `/dev/disk2` 为例方法如下：

```shell
$ diskutil unmountDisk /dev/disk2
$ sudo chown $(whoami) /dev/disk2
$ VBoxManage internalcommands createrawvmdk -filename PATH_TO_VMDK -rawdisk /dev/disk2
$ # Now boot from VirtualBox
```

对于其它平台，可以参考 Tu Nguyen 的 [How to boot from USB in VirtualBox](https://www.aioboot.com/en/boot-from-usb-in-virtualbox/) 。

研究了一下生成的 vmdk 文件，大概是这样的：

```
# Disk DescriptorFile
version=1
CID=12345678
parentCID=ffffffff
createType=&quot;fullDevice&quot;

# Extent description
RW 12345678 FLAT &quot;/dev/disk2&quot; 0

# The disk Data Base 
#DDB

ddb.virtualHWVersion = &quot;4&quot;
ddb.adapterType=&quot;ide&quot;
ddb.geometry.cylinders=&quot;1234&quot;
ddb.geometry.heads=&quot;1234&quot;
ddb.geometry.sectors=&quot;1234&quot;
ddb.uuid.image=&quot;12341234-1234-1234-1234-123412341234&quot;
ddb.uuid.parent=&quot;00000000-0000-0000-0000-000000000000&quot;
ddb.uuid.modification=&quot;00000000-0000-0000-0000-000000000000&quot;
ddb.uuid.parentmodification=&quot;00000000-0000-0000-0000-000000000000&quot;
ddb.geometry.biosCylinders=&quot;1234&quot;
ddb.geometry.biosHeads=&quot;1234&quot;
ddb.geometry.biosSectors=&quot;1234&quot;
```

</content>
 </entry>
 
 <entry>
   <title>在 macOS 上读取移动硬盘的 S.M.A.R.T. 信息</title>
   <link href="https://jiegec.me/hardware/2018/09/07/reading-smart-info-of-external-drives-under-macOS/"/>
   <updated>2018-09-07T10:20:00+08:00</updated>
   <id>https://jiegec.me/hardware/2018/09/07/reading-smart-info-of-external-drives-under-macOS</id>
   <content type="html">之前想看看自己各个盘的情况，但是发现只能看电脑内置的 SSD 的 S.M.A.R.T 信息，而移动硬盘的都显示：

```
$ smartctl -a /dev/disk2
smartctl 6.6 2017-11-05 r4594 [Darwin 17.7.0 x86_64] (local build)
Copyright (C) 2002-17, Bruce Allen, Christian Franke, www.smartmontools.org

/dev/disk2: Unable to detect device type
Please specify device type with the -d option.

Use smartctl -h to get a usage summary
```

一开始我怀疑是个别盘不支持，但换了几个盘都不能工作，问题应该出现在了 USB 上。查了下资料，果然如此。根据 [USB devices and smartmontools](https://www.smartmontools.org/wiki/USB) ，获取 S.M.A.R.T 信息需要直接发送 ATA 命令，但是由于经过了 USB ，于是需要进行一个转换，导致无法直接发送 ATA 命令。这个问题自然是有解决方案，大概就是直接把 ATA 命令发送过去（pass-through）。上面这个地址里写到，如果需要在 macOS 上使用，需要安装一个内核驱动。可以找到，源码在 [kasbert/OS-X-SAT-SMART-Driver](https://github.com/kasbert/OS-X-SAT-SMART-Driver) 并且有一个带签名的安装包在 [External USB / FireWire drive diagnostics support](https://binaryfruit.com/drivedx/usb-drive-support) 中可以下载。丢到 VirusTotal 上没查出问题，用 v0.8 版本安装好后就成功地读取到了移动硬盘的 S.M.A.R.T 信息了。

然后我又简单研究了一下各个 S.M.A.R.T 各个值的含义是什么。 `VALUE` 代表当前的值， `WORST` 代表目前检测到的最差的值， `THRESH` 代表损坏阈值。这些值都是从 `RAW_VALUE` 进行计算后归一化而来。然后 `TYPE` 分为两种，一是 `Pre-fail` ，代表如果这一项的值小于阈值，代表这个机器很危险了，赶紧拷数据丢掉吧。二是 `Old_age` ，代表如果这一项小于阈值，代表这个机器比较老了，但还没坏。真正要看是否坏了，可以看 `When_Failed` 一栏。
</content>
 </entry>
 
 <entry>
   <title>在 macOS 和 Linux 之间搭建 tinc 网络</title>
   <link href="https://jiegec.me/networking/2018/05/09/tinc-between-macos-and-linux/"/>
   <updated>2018-05-09T10:02:00+08:00</updated>
   <id>https://jiegec.me/networking/2018/05/09/tinc-between-macos-and-linux</id>
   <content type="html">一直听说 tinc 比较科学，所以尝试自己用 tinc 搭建一个网络。这里，macOS 这段没有固定 IP 地址，Linux 机器有固定 IP 地址 linux_ip 。假设网络名称为 example , macOS 端名为 macos 地址为 192.168.0.2, linux 端名为 linux 地址为 192.168.0.1。

在 macOS 上配置：
```shell
brew install tinc
mkdir -p /usr/local/etc/tinc/example
```

新建 /usr/local/etc/tinc/example/tinc.conf:
```
Name = macos
Device = utun0 # use an unused number
ConnectTo = linux
```

编辑 /usr/local/etc/tinc/example/tinc-up:
```
#!/bin/sh
ifconfig $INTERFACE 192.168.0.2 192.168.0.1 mtu 1500 netmask 255.255.255.255
```

和 /usr/local/etc/tinc/example/tinc-down:
```
#!/bin/sh
ifconfig $INTERFACE down
```

还有 /usr/local/etc/tinc/example/subnet-up:
```
#!/bin/sh
[ &quot;$NAME&quot; = &quot;$NODE&quot; ] &amp;&amp; exit 0
/usr/local/opt/iproute2mac/bin/ip route add $SUBNET dev $INTERFACE
```

以及 /usr/local/etc/tinc/example/subnet-down:
```
#!/bin/sh
[ &quot;$NAME&quot; = &quot;$NODE&quot; ] &amp;&amp; exit 0
/usr/local/opt/iproute2mac/bin/ip route del $SUBNET dev $INTERFACE
```

然后将它们都设为可执行的：
```
chmod +x tinc-up
chmod +x tinc-down
chmod +x subnet-down
chmod +x subnet-down
```

编辑 /usr/local/etc/tinc/example/macos:
```
Port = 655
Subnet = 192.168.0.1/24
```

执行 `tincd -n example -K` 生成密钥。

到 Linux 机器上：
编辑以下文件：
```shell
$ mkdir -p /etc/tinc/example/hosts
$ cat /etc/tinc/example/tinc.conf
Name = linux
$ cat /etc/tinc/example/tinc-up
$!/bin/sh
ip link set $INTERFACE up
ip addr add 192.168.0.1/24 dev $INTERFACE
$ cat /etc/tinc/example/tinc-down
$!/bin/sh
ip addr del 192.168.0.1/24 dev $INTERFACE
ip link set $INTERFACE down
$ cat /etc/tinc/example/hosts/linux
Address = linux_ip
Port = 655
Subnet = 192.168.0.1/24
$ tincd -n example -K
```

接着，把 linux 上 /etc/tinc/example/hosts/linux 拷贝到 macos 的 /usr/local/etc/tinc/example/hosts/linux ，然后把 macos 上 /usr/local/etc/tinc/example/hosts/macos 拷贝到 /etc/tinc/example/hosts/macos 。在两台机器上都 `tinc -n example -D -d3` 即可看到连接的建立，通过 ping 即可验证网络建立成功。

2018-05-29 Update: Android 上，利用 Tinc GUI 也可以把 Tinc 运行起来，只是配置不大一样：

```shell
$ cat tinc.conf
Name = example
Device = /dev/tun
Mode = switch
ConnectTo = remote
ScriptsInterpreter = /system/bin/sh
$ cat tinc-up
#!/bin/sh
ip link set $INTERFACE up
ip addr add local_ip/24 dev $INTERFACE
$ cat tinc-down
#!/bin/sh
ip addr del local_ip/24 dev $INTERFACE
ip link set $INTERFACE down
$ cat subnet-up
$!/bin/bash
[ &quot;$NAME&quot; = &quot;$NODE&quot; ] &amp;&amp; exit 0
ip route add $SUBNET dev $INTERFACE metric $WEIGHT table local
$ cat subnet-down
#!/bin/bash
[ &quot;$NAME&quot; = &quot;$NODE&quot; ] &amp;&amp; exit 0
ip route del $SUBNET dev $INTERFACE table local
```

注意 table local 的使用。需要 Root 。
</content>
 </entry>
 
 <entry>
   <title>把 GDB 降级到 8.0.1</title>
   <link href="https://jiegec.me/programming/2018/04/17/downgrade-gdb/"/>
   <updated>2018-04-17T13:08:00+08:00</updated>
   <id>https://jiegec.me/programming/2018/04/17/downgrade-gdb</id>
   <content type="html">在 macOS 上使用 GDB 需要 codesigning 。但是在 GDB 升级到 8.1 后这种方法不知道为何失效了。所以我安装回了 GDB 8.0.1 并且重新 codesigning ，现在又可以正常升级了。

对 Formula 进行 patch：

```patch
diff --git a/Formula/gdb.rb b/Formula/gdb.rb
index 29a1c590..25360893 100644
--- a/Formula/gdb.rb
+++ b/Formula/gdb.rb
@@ -1,14 +1,15 @@
 class Gdb &lt; Formula
   desc &quot;GNU debugger&quot;
   homepage &quot;https://www.gnu.org/software/gdb/&quot;
-  url &quot;https://ftp.gnu.org/gnu/gdb/gdb-8.1.tar.xz&quot;
-  mirror &quot;https://ftpmirror.gnu.org/gdb/gdb-8.1.tar.xz&quot;
-  sha256 &quot;af61a0263858e69c5dce51eab26662ff3d2ad9aa68da9583e8143b5426be4b34&quot;
+  url &quot;https://ftp.gnu.org/gnu/gdb/gdb-8.0.1.tar.xz&quot;
+  mirror &quot;https://ftpmirror.gnu.org/gdb/gdb-8.0.1.tar.xz&quot;
+  sha256 &quot;3dbd5f93e36ba2815ad0efab030dcd0c7b211d7b353a40a53f4c02d7d56295e3&quot;
 
   bottle do
-    sha256 &quot;43a6d6cca157ef70d13848f35c04e11d832dc0c96f5bcf53a43330f524b3ac40&quot; =&gt; :high_sierra
-    sha256 &quot;fe7c6261f9164e7a744c9c512ba7e5afff0e74e373ece9b5aa19d5da6443bfc2&quot; =&gt; :sierra
-    sha256 &quot;cd89001bcf8c93b5d6425ab91a400aeffe0cd5bbb0eccd8ab38c719ab5ca34ba&quot; =&gt; :el_capitan
+    sha256 &quot;e98ad847402592bd48a9b1468fefb2fac32aff1fa19c2681c3cea7fb457baaa0&quot; =&gt; :high_sierra
+    sha256 &quot;0fdd20562170c520cfb16e63d902c13a01ec468cb39a85851412e7515b6241e9&quot; =&gt; :sierra
+    sha256 &quot;f51136c70cff44167dfb8c76b679292d911bd134c2de3fef40777da5f1f308a0&quot; =&gt; :el_capitan
+    sha256 &quot;2b32a51703f6e254572c55575f08f1e0c7bc2f4e96778cb1fa6582eddfb1d113&quot; =&gt; :yosemite
   end
 
   deprecated_option &quot;with-brewed-python&quot; =&gt; &quot;with-python@2&quot;
```
</content>
 </entry>
 
 <entry>
   <title>在 macOS 上试用 Gentoo/Prefix</title>
   <link href="https://jiegec.me/macos/2017/12/27/try-gentoo-prefix-on-macOS/"/>
   <updated>2017-12-27T20:25:23+08:00</updated>
   <id>https://jiegec.me/macos/2017/12/27/try-gentoo-prefix-on-macOS</id>
   <content type="html">前几天参加了[许朋程](https://keybase.io/jsteward)主讲的Tunight，对Gentoo有了一定的了解，不过看到如此复杂的安装过程和长久的编译时间，又看看我的CPU，只能望而却步了。不过，有Gentoo/Prefix这个工具，使得我们可以在其它的操作系统（如macOS,Solaris等）上在一个 $EPREFIX 下跑 Portage ，也就是把 Portage 运行在别的操作系统，当作一个包管理器，并且可以和别的操作系统并存。

首先还是祭出官网：[Project:Prefix](https://wiki.gentoo.org/wiki/Project:Prefix)。

首先设定好环境变量 `$EPREFIX` ，之后所有的东西都会安装到这个目录下，把 `bootstrap-prefix.sh` 下载到 `$EPREFIX` ，然后 `./bootstrap-prefix.sh` ，会进行一系列的问题，一一回答即可。建议在运行前设置好 `GENTOO_MIRRORS=http://mirrors.tuna.tsinghua.edu.cn/gentoo` 由于TUNA没有对gentoo_prefix做镜像，只能把distfiles切换到TUNA的镜像上。

然后。。。

stage1...


stage2..


stage3.


`emerge -e @world` BOOM


经过 n 次跑挂以后，终于搞完了 stage3 ，然后 `SHELL=bash ./bootstrap-prefix.sh $EPREFIX startscript` 生成 `startprefix` ，在外面的SHELL中向切进来的时候运行这个即可。

然后就可以使用Gentoo/Prefix了。注意！此时的 `$PATH` 仅限于 `$EPREFIX` 下几个目录和 `/usr/bin` `/bin` 所以很多东西都会出问题（Emacs, Vim, Fish etc）。小心不要把自己的目录什么的搞挂了。

然后就可以假装试用Gentoo了！


哈哈哈哈哈哈哈


死于编译 libgcrypt 和 llvm 。
</content>
 </entry>
 
 <entry>
   <title>In macOS Sierra, Karabiner-Elements finally support complex modifications</title>
   <link href="https://jiegec.me/system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications/"/>
   <updated>2017-06-15T17:22:20+08:00</updated>
   <id>https://jiegec.me/system/2017/06/15/macos-sierra-karabiner-finally-support-complex-modifications</id>
   <content type="html">In favor of this [commit](https://github.com/tekezo/Karabiner-Elements/commit/f37815dcf58fd1e91d3cd3d154c2ed3749a2510e), Karabiner-Elements now supports the much welcomed yet long-lost feature, namely complex modifications that enable users to trigger complex keypress.

Now I can achieve this:
```
If I press &lt;Enter&gt;, then:
1. If &lt;Enter&gt; is pressed alone, then send &lt;Enter&gt;.
2. If &lt;Enter&gt; is pressed along with other keys, then send &lt;Control&gt; + Other.
```

By adding this code to ~/.config/karabiner/karabiner.json :
```
&quot;complex_modifications&quot;: {
    &quot;rules&quot;: [
        {
            &quot;manipulators&quot;: [
                {
                    &quot;description&quot;: &quot;Change return_or_enter to left_control. (Post return_or_enter if pressed alone)&quot;,
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;return_or_enter&quot;,
                        &quot;modifiers&quot;: {
                            &quot;optional&quot;: [
                                &quot;any&quot;
                            ]
                        }
                    },
                    &quot;to&quot;: [
                        {
                            &quot;key_code&quot;: &quot;left_control&quot;
                        }
                    ],
                    &quot;to_if_alone&quot;: [
                        {
                            &quot;key_code&quot;: &quot;return_or_enter&quot;
                        }
                    ],
                    &quot;type&quot;: &quot;basic&quot;
                }
            ]
        }
    ]
},
```
in one of profiles.

Note: the snippet above is adopted from [this example](https://github.com/tekezo/Karabiner-Elements/blob/61df6ff04ce34adf1cbb00cfd7c5dd49c14c0889/examples/spacebar_to_shift.json). You can explore more examples since the GUI is not updated accordingly yet.

Important: Until NOW (2017-06-15), this feature is only implemented in beta versions of Karabiner-Elements (at least 0.91.1).
</content>
 </entry>
 
 <entry>
   <title>Screen Capturing Tips in macOS</title>
   <link href="https://jiegec.me/osx/2016/02/17/tips-in-os-x/"/>
   <updated>2016-02-17T19:12:49+08:00</updated>
   <id>https://jiegec.me/osx/2016/02/17/tips-in-os-x</id>
   <content type="html">I'm sure many people have already known this. But i haven't memorize it yet.

How to screen capture:

    Shift+Command+3: Capture fullscreen.
    Shift+Command+4: Capture region.
                   : Press space to capture window. 
                   : Hold option and drag, then
                   : you will capture a region with its center in where you started dragging 
                   : and one of its corners under your cursor.
    Ctrl+OneOfTheTwoAbove: Capture to clipboard.
    defaults write com.apple.screencapture location: Change the default location storing the images.

Apps enhancing the snapshots: [Snappy](http://go-snappy.com/) and [Mapture](http://anatoo.jp/mapture/).

See more detailed [here](https://sspai.com/post/25978).
</content>
 </entry>
 
</feed>
