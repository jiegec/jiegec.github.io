<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 <title>Tag - ip</title>
 <link href="https://jiege.ch/tag/ip/index.xml" rel="self"/>
 <link href="https://jiege.ch/tag/ip.html"/>
 <updated>2019-02-10T00:48:21+08:00</updated>
 <id>https://jiege.ch/tag/ip.html</id>
 <author>
   <name>Jiege Chen</name>
 </author>
 
 <entry>
   <title>通过 iptables 在同一个端口根据源地址解复用（demux）</title>
   <link href="https://jiege.ch/networking/2018/07/06/use-iptables-to-serve-different-services-on-one-port/"/>
   <updated>2018-07-06T09:36:00+08:00</updated>
   <id>https://jiege.ch/networking/2018/07/06/use-iptables-to-serve-different-services-on-one-port</id>
   <content type="html">&lt;p&gt;现在遇到一个场景，原来的一个服务只给一个客户端用，但现在增加了一个客户端，由于客户端配置相同，但是服务端需要区别对待两个客户端的服务端配置，所以利用 iptables 根据源地址做了一个端口转发，实现了 demux 。&lt;/p&gt;

&lt;p&gt;假设：服务器在 192.168.0.1 ，客户端分别在 192.168.0.2 和 192.168.0.3 。客户端配置的服务端地址是 192.168.0.1:8000 。之前，在服务器上只跑了一个服务，监听着 8000 端口。&lt;/p&gt;

&lt;p&gt;现在，在服务器上再跑一个服务，监听 8001 端口，同时根据需求进行相应的配置。然后，加上如下 iptables 规则：&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 192.168.0.3 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 192.168.0.1 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 8000 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 8001
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这样，在不需要更改客户端的情况下，完成了需要的效果。&lt;/p&gt;
</content>
 </entry>
 
</feed>
