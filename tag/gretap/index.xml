<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 <title>Tag - gretap</title>
 <link href="https://jiegec.me/tag/gretap/index.xml" rel="self"/>
 <link href="https://jiegec.me/tag/gretap.html"/>
 <updated>2018-11-17T07:54:19+08:00</updated>
 <id>https://jiegec.me/tag/gretap.html</id>
 <author>
   <name>Jiege Chen</name>
 </author>
 
 <entry>
   <title>在 macOS 下实现 GRETAP</title>
   <link href="https://jiegec.me/networking/2018/08/21/implementing-gretap-in-macos/"/>
   <updated>2018-08-21T09:42:00+08:00</updated>
   <id>https://jiegec.me/networking/2018/08/21/implementing-gretap-in-macos</id>
   <content type="html">&lt;p&gt;由于没有找到 macOS 下现成的 GRETAP 实现，我就想到自己实现一个。由于&lt;a href=&quot;http://tuntaposx.sourceforge.net/&quot;&gt;tuntaposx&lt;/a&gt;提供了一个和 Linux 下基本一样的 TAP Interface，于是自己利用 raw socket 和 TAP Interface 实现了一下，主要方法：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;打开 raw socket ，读取收到的 proto 47 的包，判断是否为 GRETAP 包，是，则写入内层包到打开的 TAP Interface 中。&lt;/li&gt;
  &lt;li&gt;从 TAP Interface 中读入包，自己加上 GRE 头和 IP 头，然后发送。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;主要的难度是在 raw socket 部分，macOS 继承了 BSD ，与 Linux 不大一样。于是参考了&lt;a href=&quot;https://sock-raw.org/papers/sock_raw&quot;&gt;SOCK_RAW Demystified&lt;/a&gt;，成功地实现了这个功能。&lt;/p&gt;

&lt;p&gt;代码放在&lt;a href=&quot;https://github.com/jiegec/gretapmac&quot;&gt;jiegec/gretapmac&lt;/a&gt;。写得并不高效，仅仅可用，用了一百多行。&lt;/p&gt;

&lt;p&gt;UPDATE: 之后又随手实现了一个类似的协议，L2TPv3 over UDP。代码在&lt;a href=&quot;https://github.com/jiegec/l2tpv3udptap&quot;&gt;jiegc/l2tpv3udptap&lt;/a&gt;。&lt;/p&gt;
</content>
 </entry>
 
</feed>
