<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 <title>Tag - timemachine</title>
 <link href="https://jiege.ch/tag/timemachine/index.xml" rel="self"/>
 <link href="https://jiege.ch/tag/timemachine.html"/>
 <updated>2019-04-05T23:38:48+08:00</updated>
 <id>https://jiege.ch/tag/timemachine.html</id>
 <author>
   <name>Jiege Chen</name>
 </author>
 
 <entry>
   <title>Mac 上安装 Arch Linux ， ZFS 真香</title>
   <link href="https://jiege.ch/software/2018/11/26/zfs-on-macos-and-linux/"/>
   <updated>2018-11-26T20:51:00+08:00</updated>
   <id>https://jiege.ch/software/2018/11/26/zfs-on-macos-and-linux</id>
   <content type="html">&lt;p&gt;最近在 Mac 上装了 Arch Linux ，按照 &lt;a href=&quot;https://wiki.archlinux.org/index.php/Mac&quot;&gt;Mac - Arch Linux Wiki&lt;/a&gt; 一路一路走，创建单独的一个 EFI 分区给 Arch Linux 放 GRUB 和内核，一个 ext4 作为根分区。由于 Arch ISO 不支持 Broadcom 的无线网卡，于是先拿 Apple Ethernet Adapter 连到路由器上装机。然后把一些需要的驱动装上了，桌面用的 KDE Plasma ，Trackpad 用的 xf86-input-mtrack-git ， HiDPI 设置为 2x Scale ，各种体验都还可以，就是 Wi-Fi 的 802.1X 没配置好，然后 kwalletd5 老是崩没找到原因。常见的应用除了微信基本都有，也终于可以体验 Steam Play ，利用 Proton 在 Linux 上跑一些只支持 Windows 的游戏，不过我已经很少玩游戏了。&lt;/p&gt;

&lt;p&gt;然后我就想，怎么做 macOS 和 Linux 之间的文件共享。典型的操作可能是 exFAT ，但是作为数据盘的话，这还是不大适合。或者就直接用 ext4 ，配合 extFS For Mac by Paragon 使用，也可以，最后我选择了 ZFS 。&lt;/p&gt;

&lt;p&gt;在 macOS 上安装 &lt;a href=&quot;https://openzfsonosx.org/&quot;&gt;OpenZFS on OSX&lt;/a&gt; ，在 Linux 上安装 &lt;a href=&quot;https://zfsonlinux.org/&quot;&gt;ZFS on Linux&lt;/a&gt; 。具体命令就是：&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;brew cask install openzfs &lt;span class=&quot;c&quot;&gt;# macOS&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;yay zfs-dkms-git &lt;span class=&quot;c&quot;&gt;# Arch Linux&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;由于硬盘空间所限，我只用了一个分区作为 vdev ，没有采用 mirror 、 raidz 等方案。我首先在 macOS 上创建了一个 zpool ，参考 &lt;a href=&quot;https://openzfsonosx.org/wiki/Zpool#Creating_a_pool&quot;&gt;Creating a pool - OpenZFS on OSX&lt;/a&gt; ：&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;zpool create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ashift&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;13 Data diskxsy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;此时应该能够看到 /Volumes/Data 上已经挂载了一个 ZFS Dataset 。我采用 &lt;a href=&quot;https://github.com/cbreak-black/ZetaWatch&quot;&gt;cbreak-black/ZetaWatch&lt;/a&gt; 在菜单栏里查看 ZFS 信息。此时回到 Arch Linux 上，通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;zfs import&lt;/code&gt; 可以找到并且挂载这个 ZFS Dataset 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;/Data&lt;/code&gt; 处。&lt;/p&gt;

&lt;p&gt;我还尝试创建了一个加密的 ZFS Dataset ，对加密的部分的粒度控制可以很细。另外，我参考 &lt;a href=&quot;https://openzfsonosx.org/wiki/Time_Machine_Backups&quot;&gt;Time Machine Backups - OpenZFS on OSX&lt;/a&gt; 也在移动硬盘上划出一个新的分区作为 ZFS ，在上面创建了一个加密的 Sparse Bundle ，把它作为 Time Machine 的目标。之后还会尝试一下 &lt;code class=&quot;highlighter-rouge&quot;&gt;zfs send&lt;/code&gt; 作为替代的备份方案。&lt;/p&gt;
</content>
 </entry>
 
</feed>
