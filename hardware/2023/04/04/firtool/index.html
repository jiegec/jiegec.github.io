<!DOCTYPE html>
<html>
<head>
    <title>firtool 尝试 // 杰哥的{运维,编程,调板子}小笔记</title>

    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    

        <meta property="og:title" content="firtool 尝试" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en" />
    <meta property="og:url" content="https://jia.je/hardware/2023/04/04/firtool/" />
    

    <link rel="shortcut icon" href="/favicon.ico">

    <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="/css/style.css">
    
    <script src="/js/wavedrom/default.js" type="text/javascript"></script>
    <script src="/js/wavedrom/wavedrom.min.js" type="text/javascript" /></script>

    <meta name="generator" content="Hugo 0.111.3">
</head>


<body onload="WaveDrom.ProcessAll()">
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="/">杰哥的{运维,编程,调板子}小笔记</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="/about/">关于</a>
                
                <a class="main-nav-link" href="/category/">分类</a>
                
                <a class="main-nav-link" href="/open-source-contributions/">开源</a>
                
                <a class="main-nav-link" href="/tags/">标签</a>
                
                <a class="main-nav-link" href="/series/">系列</a>
                
                <a class="main-nav-link" href="/feed.xml">订阅</a>
                
                <a class="main-nav-link" href="/projects/readme/">项目</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>

    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">firtool 尝试</h1>
        </header>
        
        <div class="article-meta">
            <a href="/hardware/2023/04/04/firtool/" class="article-date">
                <time datetime='2023-04-04T20:33:00.000&#43;08:00' itemprop="datePublished">2023-04-04</time>
            </a>
            
            
            
            <div class="article-comment-link-wrap">
                <a href="/hardware/2023/04/04/firtool/#disqus_thread" class="article-comment-link">Comments</a>
            </div>
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <h2 id="背景">背景</h2>
<p>Chisel 3.6 很快就要发布了（目前最新版本是 3.6.0-RC2），这个大版本的主要更新内容就是引入了 CIRCT 的 firtool 作为 FIRRTL 到 Verilog 的转换流程：</p>
<pre><code>The primary change in Chisel v3.6.0 is the transition from the Scala FIRRTL
Compiler to the new MLIR FIRRTL Compiler. This will have a minimal impact on
typical Chisel user APIs but a large impact on custom compiler flows. For
more information, please see the ROADMAP.
</code></pre>
<p>因此提前测试一下 firtool，看看其和 Scala FIRRTL Compiler 有哪些区别，是否有更好的输出。</p>
<h2 id="使用-firtool">使用 firtool</h2>
<p>使用 firtool 有两种方法：</p>
<ol>
<li>使用 chisel3 3.6 的 <code>circt.stage.ChiselStage</code> 对象：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>circt<span style="color:#f92672">.</span>stage<span style="color:#f92672">.</span><span style="color:#a6e22e">ChiselStage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>emitSystemVerilogFile<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Top</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>代码中会生成 Chisel 模块对应的 FIRRTL 文件，然后喂给 firtool。也可以通过 <code>circt.stage.ChiselMain</code> 来运行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sbt <span style="color:#e6db74">&#34;runMain circt.stage.ChiselMain --help&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>info<span style="color:#f92672">]</span> running circt.stage.ChiselMain --help
</span></span><span style="display:flex;"><span>Usage: circt <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>&lt;arg&gt;...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Shell Options
</span></span><span style="display:flex;"><span>  &lt;arg&gt;...                 optional unbounded args
</span></span><span style="display:flex;"><span>  -td, --target-dir &lt;directory&gt;
</span></span><span style="display:flex;"><span>                           Work directory <span style="color:#f92672">(</span>default: <span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  -faf, --annotation-file &lt;file&gt;
</span></span><span style="display:flex;"><span>                           An input annotation file
</span></span><span style="display:flex;"><span>  -foaf, --output-annotation-file &lt;file&gt;
</span></span><span style="display:flex;"><span>                           An output annotation file
</span></span><span style="display:flex;"><span>  --show-registrations     print discovered registered libraries and transforms
</span></span><span style="display:flex;"><span>  --help                   prints this usage text
</span></span><span style="display:flex;"><span>Logging Options
</span></span><span style="display:flex;"><span>  -ll, --log-level <span style="color:#f92672">{</span>error|warn|info|debug|trace<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                           Set global logging verbosity <span style="color:#f92672">(</span>default: None
</span></span><span style="display:flex;"><span>  -cll, --class-log-level &lt;FullClassName:<span style="color:#f92672">{</span>error|warn|info|debug|trace<span style="color:#f92672">}</span>&gt;...
</span></span><span style="display:flex;"><span>                           Set per-class logging verbosity
</span></span><span style="display:flex;"><span>  --log-file &lt;file&gt;        Log to a file instead of STDOUT
</span></span><span style="display:flex;"><span>  -lcn, --log-class-names  Show class names and log level in logging output
</span></span><span style="display:flex;"><span>CIRCT <span style="color:#f92672">(</span>MLIR FIRRTL Compiler<span style="color:#f92672">)</span> options
</span></span><span style="display:flex;"><span>  --target <span style="color:#f92672">{</span>chirrtl|firrtl|hw|verilog|systemverilog<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                           The CIRCT
</span></span><span style="display:flex;"><span>  --preserve-aggregate &lt;value&gt;
</span></span><span style="display:flex;"><span>                           Do not lower aggregate types to ground types
</span></span><span style="display:flex;"><span>  --module &lt;package&gt;.&lt;module&gt;
</span></span><span style="display:flex;"><span>                           The name of a Chisel module to elaborate <span style="color:#f92672">(</span>module must be in the classpath<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  --full-stacktrace        Show full stack trace when an exception is thrown
</span></span><span style="display:flex;"><span>  --throw-on-first-error   Throw an exception on the first error instead of continuing
</span></span><span style="display:flex;"><span>  --warnings-as-errors     Treat warnings as errors
</span></span><span style="display:flex;"><span>  --source-root &lt;file&gt;     Root directory <span style="color:#66d9ef">for</span> source files, used <span style="color:#66d9ef">for</span> enhanced error reporting
</span></span><span style="display:flex;"><span>  --split-verilog          Indicates that <span style="color:#e6db74">&#34;firtool&#34;</span> should emit one-file-per-module and write separate outputs to separate files
</span></span><span style="display:flex;"><span>FIRRTL Transform Options
</span></span><span style="display:flex;"><span>  --no-dce                 Disable dead code elimination
</span></span><span style="display:flex;"><span>  --no-check-comb-loops    Disable combinational loop checking
</span></span><span style="display:flex;"><span>  -fil, --inline &lt;circuit&gt;<span style="color:#f92672">[</span>.&lt;module&gt;<span style="color:#f92672">[</span>.&lt;instance&gt;<span style="color:#f92672">]][</span>,...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                           Inline selected modules
</span></span><span style="display:flex;"><span>  -clks, --list-clocks -c:&lt;circuit&gt;:-m:&lt;module&gt;:-o:&lt;filename&gt;
</span></span><span style="display:flex;"><span>                           List which signal drives each clock of every descendent of specified modules
</span></span><span style="display:flex;"><span>  --no-asa                 Disable assert submodule assumptions
</span></span><span style="display:flex;"><span>  --no-constant-propagation
</span></span><span style="display:flex;"><span>                           Disable constant propagation elimination
</span></span><span style="display:flex;"><span>AspectLibrary
</span></span><span style="display:flex;"><span>  --with-aspect &lt;package&gt;.&lt;aspect&gt;
</span></span><span style="display:flex;"><span>                           The name/class of an aspect to compile with <span style="color:#f92672">(</span>must be a class/object without arguments!<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MemLib Options
</span></span><span style="display:flex;"><span>  -firw, --infer-rw        Enable read/write port inference <span style="color:#66d9ef">for</span> memories
</span></span><span style="display:flex;"><span>  -frsq, --repl-seq-mem -c:&lt;circuit&gt;:-i:&lt;file&gt;:-o:&lt;file&gt;
</span></span><span style="display:flex;"><span>                           Blackbox and emit a configuration file <span style="color:#66d9ef">for</span> each sequential memory
</span></span><span style="display:flex;"><span>  -gmv, --gen-mem-verilog &lt;blackbox|full&gt;
</span></span><span style="display:flex;"><span>                           Blackbox and emit a Verilog behavior model <span style="color:#66d9ef">for</span> each sequential memory
</span></span></code></pre></div><ol start="2">
<li>在 Scala 中生成 FIRRTL 文件，然后用 firtool 命令转换 <code>.fir</code> 为 <code>.sv</code>。由于 Rocket Chip 还没有迁移，所以需要通过 firtool 来转换。</li>
</ol>
<p>由于目前 chisel3 并没有打包 firtool，目前需要自己装 firtool，例如通过 nix 或下载 GitHub 上的 Release 文件。本文采用的是 firtool 1.34.0。</p>
<h2 id="对比">对比</h2>
<p>把同一份源码，通过两种方式来生成 Verilog 然后进行观察，下面是一些生成的代码的区别。</p>
<h3 id="状态机">状态机</h3>
<p>首先是一个状态机的例子（取自 chisel3 的 DetectTwoOnes 样例）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>is<span style="color:#f92672">(</span><span style="color:#a6e22e">State</span><span style="color:#f92672">.</span>sTwo1s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  when<span style="color:#f92672">(!</span>io<span style="color:#f92672">.</span>in<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    state <span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">State</span><span style="color:#f92672">.</span>sNone
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Scala FIRRTL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span>  <span style="color:#66d9ef">wire</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] _GEN_2 <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>io_in <span style="color:#f92672">?</span> <span style="color:#ae81ff">2&#39;h0</span> <span style="color:#f92672">:</span> state; <span style="color:#75715e">// @[src/main/scala/DetectTwoOnes.scala 33:20 34:15 15:22]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">2&#39;h2</span> <span style="color:#f92672">==</span> state) <span style="color:#66d9ef">begin</span> <span style="color:#75715e">// @[src/main/scala/DetectTwoOnes.scala 19:17]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      state <span style="color:#f92672">&lt;=</span> _GEN_2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>CIRCT firtool:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (state <span style="color:#f92672">==</span> <span style="color:#ae81ff">2&#39;h2</span> <span style="color:#f92672">&amp;</span> <span style="color:#f92672">~</span>io_in)	<span style="color:#75715e">// src/main/scala/DetectTwoOnes.scala:15:22, :17:20, :19:17, :33:{12,20}, :34:15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      state <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2&#39;h0</span>;	<span style="color:#75715e">// src/main/scala/DetectTwoOnes.scala:15:22, :29:15
</span></span></span></code></pre></div><p>这个例子里，Scala FIRRTL Compiler 多生成了一个 <code>_GEN_2</code>，需要把前后一起看才知道是什么意思，而 CIRCT 生成的与源码比较接近，可读性较好。</p>
<h3 id="syncreadmem">SyncReadMem</h3>
<p>接下来看 SyncReadMem。在 Scala FIRRTL Compiler 中，默认是直接在模块中嵌入代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  reg <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">31</span><span style="color:#f92672">];</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire  mem_rdata_MPORT_en<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem_rdata_MPORT_addr<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem_rdata_MPORT_data<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem_MPORT_data<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem_MPORT_addr<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire  mem_MPORT_mask<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  wire  mem_MPORT_en<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  reg  mem_rdata_MPORT_en_pipe_0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  reg <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> mem_rdata_MPORT_addr_pipe_0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_rdata_MPORT_en <span style="color:#66d9ef">=</span> mem_rdata_MPORT_en_pipe_0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_rdata_MPORT_addr <span style="color:#66d9ef">=</span> mem_rdata_MPORT_addr_pipe_0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_rdata_MPORT_data <span style="color:#66d9ef">=</span> mem<span style="color:#f92672">[</span><span style="color:#66d9ef">mem_rdata_MPORT_addr</span><span style="color:#f92672">];</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  assign mem_MPORT_data <span style="color:#66d9ef">=</span> wdata<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_MPORT_addr <span style="color:#66d9ef">=</span> waddr<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_MPORT_mask <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">1</span>&#39;h1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign mem_MPORT_en <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">1</span>&#39;h1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  assign rdata <span style="color:#66d9ef">=</span> mem_rdata_MPORT_data<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 11:9]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  always <span style="color:#f92672">@(</span>posedge clock<span style="color:#f92672">)</span> begin
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mem_MPORT_en <span style="color:#f92672">&amp;</span> mem_MPORT_mask<span style="color:#f92672">)</span> begin
</span></span><span style="display:flex;"><span>      mem<span style="color:#f92672">[</span><span style="color:#66d9ef">mem_MPORT_addr</span><span style="color:#f92672">]</span> <span style="color:#f92672">&lt;=</span> mem_MPORT_data<span style="color:#f92672">;</span> <span style="color:#75715e">// @[src/main/scala/Memory.scala 10:24]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    end
</span></span><span style="display:flex;"><span>    mem_rdata_MPORT_en_pipe_0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>&#39;h1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>&#39;h1<span style="color:#f92672">)</span> begin
</span></span><span style="display:flex;"><span>      mem_rdata_MPORT_addr_pipe_0 <span style="color:#f92672">&lt;=</span> raddr<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    end
</span></span><span style="display:flex;"><span>  end
</span></span></code></pre></div><p>当然了，它有 repl-seq-mem 的选项，可以生成 BlackBox 方便替换为实际的 SRAM IP：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sbt <span style="color:#e6db74">&#34;runMain firrtl.stage.FirrtlMain -i Memory.fir --repl-seq-mem -c:Memory:-o:Memory.conf&#34;</span>
</span></span><span style="display:flex;"><span>$ cat Memory.v
</span></span><span style="display:flex;"><span>module mem<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  input  <span style="color:#f92672">[</span>4:0<span style="color:#f92672">]</span>  R0_addr,
</span></span><span style="display:flex;"><span>  input         R0_clk,
</span></span><span style="display:flex;"><span>  output <span style="color:#f92672">[</span>31:0<span style="color:#f92672">]</span> R0_data,
</span></span><span style="display:flex;"><span>  input  <span style="color:#f92672">[</span>4:0<span style="color:#f92672">]</span>  W0_addr,
</span></span><span style="display:flex;"><span>  input         W0_clk,
</span></span><span style="display:flex;"><span>  input  <span style="color:#f92672">[</span>31:0<span style="color:#f92672">]</span> W0_data
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  wire <span style="color:#f92672">[</span>4:0<span style="color:#f92672">]</span> mem_ext_R0_addr;
</span></span><span style="display:flex;"><span>  wire  mem_ext_R0_en;
</span></span><span style="display:flex;"><span>  wire  mem_ext_R0_clk;
</span></span><span style="display:flex;"><span>  wire <span style="color:#f92672">[</span>31:0<span style="color:#f92672">]</span> mem_ext_R0_data;
</span></span><span style="display:flex;"><span>  wire <span style="color:#f92672">[</span>4:0<span style="color:#f92672">]</span> mem_ext_W0_addr;
</span></span><span style="display:flex;"><span>  wire  mem_ext_W0_en;
</span></span><span style="display:flex;"><span>  wire  mem_ext_W0_clk;
</span></span><span style="display:flex;"><span>  wire <span style="color:#f92672">[</span>31:0<span style="color:#f92672">]</span> mem_ext_W0_data;
</span></span><span style="display:flex;"><span>  mem_ext mem_ext <span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    .R0_addr<span style="color:#f92672">(</span>mem_ext_R0_addr<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .R0_en<span style="color:#f92672">(</span>mem_ext_R0_en<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .R0_clk<span style="color:#f92672">(</span>mem_ext_R0_clk<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .R0_data<span style="color:#f92672">(</span>mem_ext_R0_data<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .W0_addr<span style="color:#f92672">(</span>mem_ext_W0_addr<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .W0_en<span style="color:#f92672">(</span>mem_ext_W0_en<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .W0_clk<span style="color:#f92672">(</span>mem_ext_W0_clk<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    .W0_data<span style="color:#f92672">(</span>mem_ext_W0_data<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  assign mem_ext_R0_clk <span style="color:#f92672">=</span> R0_clk;
</span></span><span style="display:flex;"><span>  assign mem_ext_R0_en <span style="color:#f92672">=</span> 1<span style="color:#e6db74">&#39;h1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  assign mem_ext_R0_addr = R0_addr;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  assign R0_data = mem_ext_R0_data;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  assign mem_ext_W0_clk = W0_clk;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  assign mem_ext_W0_en = 1&#39;</span>h1;
</span></span><span style="display:flex;"><span>  assign mem_ext_W0_addr <span style="color:#f92672">=</span> W0_addr;
</span></span><span style="display:flex;"><span>  assign mem_ext_W0_data <span style="color:#f92672">=</span> W0_data;
</span></span><span style="display:flex;"><span>endmodule
</span></span><span style="display:flex;"><span>$ cat Memory.conf
</span></span><span style="display:flex;"><span>name mem_ext depth <span style="color:#ae81ff">32</span> width <span style="color:#ae81ff">32</span> ports write,read  
</span></span></code></pre></div><p>下游工具读取 Memory.conf 去生成对应的 mem_ext 模块。这里只考虑了 Read Latency 为 1 的情况，如果是 Mem，就不会生成 BlackBox，毕竟参数名字是 sequential memory。</p>
<p>CIRCT firtool 也有类似的表现，只不过默认情况下就会用一个单独的模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> Memory(	<span style="color:#75715e">// &lt;stdin&gt;:3:10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">input</span>         clock,	<span style="color:#75715e">// &lt;stdin&gt;:4:11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                reset,	<span style="color:#75715e">// &lt;stdin&gt;:5:11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">input</span>  [<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]  raddr,	<span style="color:#75715e">// src/main/scala/Memory.scala:4:17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                waddr,	<span style="color:#75715e">// src/main/scala/Memory.scala:7:17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">input</span>  [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] wdata,	<span style="color:#75715e">// src/main/scala/Memory.scala:8:17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">output</span> [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] rdata	<span style="color:#75715e">// src/main/scala/Memory.scala:5:17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mem_combMem mem_ext (	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .R0_addr (raddr),
</span></span><span style="display:flex;"><span>    .R0_en   (<span style="color:#ae81ff">1&#39;h1</span>),	<span style="color:#75715e">// &lt;stdin&gt;:3:10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .R0_clk  (clock),
</span></span><span style="display:flex;"><span>    .W0_addr (waddr),
</span></span><span style="display:flex;"><span>    .W0_en   (<span style="color:#ae81ff">1&#39;h1</span>),	<span style="color:#75715e">// &lt;stdin&gt;:3:10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .W0_clk  (clock),
</span></span><span style="display:flex;"><span>    .W0_data (wdata),
</span></span><span style="display:flex;"><span>    .R0_data (rdata)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> mem_combMem(	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">input</span>  [<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]  R0_addr,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">input</span>         R0_en,
</span></span><span style="display:flex;"><span>                R0_clk,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">input</span>  [<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]  W0_addr,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">input</span>         W0_en,
</span></span><span style="display:flex;"><span>                W0_clk,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">input</span>  [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] W0_data,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">output</span> [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] R0_data
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] Memory[<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">31</span>];	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">reg</span>        _GEN;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]  _GEN_0;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">always</span> @(<span style="color:#66d9ef">posedge</span> R0_clk) <span style="color:#66d9ef">begin</span>	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    _GEN <span style="color:#f92672">&lt;=</span> R0_en;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    _GEN_0 <span style="color:#f92672">&lt;=</span> R0_addr;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">end</span> <span style="color:#75715e">// always @(posedge)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">always</span> @(<span style="color:#66d9ef">posedge</span> W0_clk) <span style="color:#66d9ef">begin</span>	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (W0_en)	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      Memory[W0_addr] <span style="color:#f92672">&lt;=</span> W0_data;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">end</span> <span style="color:#75715e">// always @(posedge)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">assign</span> R0_data <span style="color:#f92672">=</span> _GEN <span style="color:#f92672">?</span> Memory[_GEN_0] <span style="color:#f92672">:</span> <span style="color:#ae81ff">32</span>&#39;bx;	<span style="color:#75715e">// src/main/scala/Memory.scala:10:24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">endmodule</span>
</span></span></code></pre></div><p>firtool 也支持 <code>-repl-seq-mem</code> 参数，用法和输出与 Scala FIRRTL Compiler 类似。</p>
<p>我最近也写了一个小工具：<a href="https://github.com/jiegec/chisel-memory-lower">chisel-memory-lower</a>来解析生成的 conf 文件，生成对应的 BlackBox。</p>
<h3 id="复杂组合逻辑">复杂组合逻辑</h3>
<p>再来看 Hardfloat 的例子。代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> exp <span style="color:#66d9ef">=</span> in<span style="color:#f92672">(</span>expWidth <span style="color:#f92672">+</span> sigWidth <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> sigWidth <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> isZero    <span style="color:#66d9ef">=</span> exp<span style="color:#f92672">(</span>expWidth<span style="color:#f92672">,</span> expWidth <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0.</span>U
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> isSpecial <span style="color:#66d9ef">=</span> exp<span style="color:#f92672">(</span>expWidth<span style="color:#f92672">,</span> expWidth <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">3.</span>U
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> out <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Wire</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RawFloat</span><span style="color:#f92672">(</span>expWidth<span style="color:#f92672">,</span> sigWidth<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>out<span style="color:#f92672">.</span>isNaN  <span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> isSpecial <span style="color:#f92672">&amp;&amp;</span>   exp<span style="color:#f92672">(</span>expWidth <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Scala FIRRTL Compiler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>wire <span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#f92672">]</span> rawA_exp <span style="color:#66d9ef">=</span> io_a<span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">23</span><span style="color:#f92672">];</span> <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 51:21]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>wire  rawA_isZero <span style="color:#66d9ef">=</span> rawA_exp<span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>&#39;h0<span style="color:#f92672">;</span> <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 52:53]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>wire  rawA_isSpecial <span style="color:#66d9ef">=</span> rawA_exp<span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">7</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>&#39;h3<span style="color:#f92672">;</span> <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 53:53]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>wire  rawA__isNaN <span style="color:#66d9ef">=</span> rawA_isSpecial <span style="color:#f92672">&amp;</span> rawA_exp<span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#f92672">];</span> <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 56:33]
</span></span></span></code></pre></div><p>基本是忠实的翻译。</p>
<p>CIRCT Firtool:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">wire</span>        rawA_isNaN <span style="color:#f92672">=</span> (<span style="color:#f92672">&amp;</span>(io_a[<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span>])) <span style="color:#f92672">&amp;</span> io_a[<span style="color:#ae81ff">29</span>];	<span style="color:#75715e">// submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala:51:21, :53:{28,53}, :56:{33,41}
</span></span></span></code></pre></div><p>可以看到，这里对代码进行了变换，把 <code>=== 3.U</code> 变成了 AND，不再忠实原来的代码，而是采取了更加间接的表达方式。</p>
<p>再看一个类似的例子，源码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> signProd <span style="color:#66d9ef">=</span> rawA<span style="color:#f92672">.</span>sign <span style="color:#f92672">^</span> rawB<span style="color:#f92672">.</span>sign <span style="color:#f92672">^</span> io<span style="color:#f92672">.</span>op<span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Scala FIRRTL Compiler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span>  <span style="color:#66d9ef">wire</span>  rawA__sign <span style="color:#f92672">=</span> io_a[<span style="color:#ae81ff">32</span>]; <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 59:25]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>  rawB__sign <span style="color:#f92672">=</span> io_b[<span style="color:#ae81ff">32</span>]; <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala 59:25]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>  signProd <span style="color:#f92672">=</span> rawA__sign <span style="color:#f92672">^</span> rawB__sign <span style="color:#f92672">^</span> io_op[<span style="color:#ae81ff">1</span>]; <span style="color:#75715e">// @[submodules/berkeley-hardfloat/src/main/scala/MulAddRecFN.scala 96:42]
</span></span></span></code></pre></div><p>CIRCT firtool:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span>  <span style="color:#66d9ef">wire</span>        signProd <span style="color:#f92672">=</span> io_a[<span style="color:#ae81ff">32</span>] <span style="color:#f92672">^</span> io_b[<span style="color:#ae81ff">32</span>] <span style="color:#f92672">^</span> io_op[<span style="color:#ae81ff">1</span>];	<span style="color:#75715e">// submodules/berkeley-hardfloat/src/main/scala/MulAddRecFN.scala:96:{42,49}, submodules/berkeley-hardfloat/src/main/scala/rawFloatFromRecFN.scala:59:25
</span></span></span></code></pre></div><p>可以看到，CIRCT firtool 比较倾向于内联一些简单的连线。当然了，这个不是绝对的，通过修改命令行参数，可能得到不同的结果。</p>
<h3 id="rocket-chip">Rocket Chip</h3>
<p>在 rocket-chip-vcu128 项目中测试了一下，迁移到 CIRCT firtool 比较简单，只需要把 FirrtlMain 的调用改成直接运行 firtool。但是，在综合的时候，发现 Vivado 无法推断出一个 SyncReadMem，导致 LUT 和 Register 占用特别多。解决思路有两个：</p>
<ol>
<li>利用上面所说的 <code>--repl-seq-mem</code> 生成 BlackBox，然后生成 XPM Macro 接起来</li>
<li>添加 <code>--lower-memories</code> 参数，简化 SRAM，然后 Vivado 就可以识别出来了。</li>
</ol>
<h3 id="速度">速度</h3>
<p>运行大项目的时候，Scala FIRRTL Compiler 的速度明显比 CIRCT Firtool 慢，体验还是不错的。</p>

        </div>

        
        
        <div class="article-toc" style="display:none;">
            <h3>Contents</h3>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#背景">背景</a></li>
    <li><a href="#使用-firtool">使用 firtool</a></li>
    <li><a href="#对比">对比</a>
      <ul>
        <li><a href="#状态机">状态机</a></li>
        <li><a href="#syncreadmem">SyncReadMem</a></li>
        <li><a href="#复杂组合逻辑">复杂组合逻辑</a></li>
        <li><a href="#rocket-chip">Rocket Chip</a></li>
        <li><a href="#速度">速度</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
        
        

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
        <script>
            (function() {
                var $toc = $('#TableOfContents');
                if ($toc.length > 0) {
                    var $window = $(window);

                    function onScroll(){
                        var currentScroll = $window.scrollTop();
                        var h = $('.article-entry h1, .article-entry h2, .article-entry h3, .article-entry h4, .article-entry h5, .article-entry h6');
                        var id = "";
                        h.each(function (i, e) {
                            e = $(e);
                            if (e.offset().top - 10 <= currentScroll) {
                                id = e.attr('id');
                            }
                        });
                        var active = $toc.find('a.active');
                        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

                        active.each(function (i, e) {
                            $(e).removeClass('active').siblings('ul').hide();
                        });
                        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                            $(e).children('a').addClass('active').siblings('ul').show();
                        });
                    }

                    $window.on('scroll', onScroll);
                    $(document).ready(function() {
                        $toc.find('a').parent('li').find('ul').hide();
                        onScroll();
                        document.getElementsByClassName('article-toc')[0].style.display = '';
                    });
                }
            })();
        </script>
        


        
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/chisel">chisel
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/verilog">verilog
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/hdl">hdl
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/firtool">firtool
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/circt">circt
                    </a>
                </li>
                
            </ul>
        </footer>
        
    </div>
    
<nav id="article-nav">
    
    
    <a href="/hardware/2023/03/23/core-cosim/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">单核处理器的协同仿真&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>


</article>

        
            <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jiegec" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2023 杰哥的{运维,编程,调板子}小笔记
            <br />
            Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/carsonip/hugo-theme-minos" target="_blank">Minos</a>
        </div>
    </div>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-3109FRSVTT', { 'anonymize_ip': false });
}
</script>


    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.css" integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.js" integrity="sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
        <script>renderMathInElement(document.body);</script>
    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
</footer>

</div>
</body>
</html>
