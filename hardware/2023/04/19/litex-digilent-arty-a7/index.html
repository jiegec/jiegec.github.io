<!DOCTYPE html>
<html>
<head>
    <title>在 Arty A7 上用 LiteX 和 VexRiscv 跑 Linux // 杰哥的{运维,编程,调板子}小笔记</title>

    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    

        <meta property="og:title" content="在 Arty A7 上用 LiteX 和 VexRiscv 跑 Linux" />
    <meta property="og:description" content="litex 安装 litex 安装过程按照 https://github.com/enjoy-digital/litex/wiki/Installation 进行，由于需要 pip install，建议用 venv 来开一个干净的环境：
python3 -m venv venv source venv/bin/activate cd litex ./litex_setup.py --init --install 构建 bitstream litex-boards 已经内建了 Arty A7 的支持，直接运行下列命令，就可以得到 bitstream：
python3 -m litex_boards.targets.digilent_arty --build --with-ethernet 这样就可以在 build/digilent_arty/gateware 目录下找到 bitstream。可以通过命令行参数来自定义需要的功能，详见 https://github.com/litex-hub/litex-boards/blob/f5e51d72bca6ed0325c1213791a78362326002f8/litex_boards/targets/digilent_arty.py#L162-L180。
如果想切换 CPU 为 Rocket Chip 的话，克隆并安装 https://github.com/litex-hub/pythondata-cpu-rocket，添加 --cpu-type rocket --cpu-variant small 参数即可。
下载 bitstream 最后，连接 microUSB 和网线到电脑，然后下载 bitstream：
openFPGALoader -b arty digilent_arty.bit screen /dev/tty.usbserial-XXXXXXXXXXXXX 115200 就可以看到 litex 的输出：
--=============== SoC ==================-- CPU: VexRiscv @ 100MHz BUS: WISHBONE 32-bit @ 4GiB CSR: 32-bit data ROM: 128." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en" />
    <meta property="og:url" content="https://jia.je/hardware/2023/04/19/litex-digilent-arty-a7/" />
    

    <link rel="shortcut icon" href="/favicon.ico">

    <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="/css/style.css">
    
    <script src="/js/wavedrom/default.js" type="text/javascript"></script>
    <script src="/js/wavedrom/wavedrom.min.js" type="text/javascript" /></script>

    <meta name="generator" content="Hugo 0.111.3">
</head>


<body onload="WaveDrom.ProcessAll()">
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="/">杰哥的{运维,编程,调板子}小笔记</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="/about/">关于</a>
                
                <a class="main-nav-link" href="/category/">分类</a>
                
                <a class="main-nav-link" href="/open-source-contributions/">开源</a>
                
                <a class="main-nav-link" href="/tags/">标签</a>
                
                <a class="main-nav-link" href="/kb/">知识库</a>
                
                <a class="main-nav-link" href="/series/">系列</a>
                
                <a class="main-nav-link" href="/feed.xml">订阅</a>
                
                <a class="main-nav-link" href="/projects/readme/">项目</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>

    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">在 Arty A7 上用 LiteX 和 VexRiscv 跑 Linux</h1>
        </header>
        
        <div class="article-meta">
            <a href="/hardware/2023/04/19/litex-digilent-arty-a7/" class="article-date">
                <time datetime='2023-04-19T15:55:00.000&#43;08:00' itemprop="datePublished">2023-04-19</time>
            </a>
            
            
            
            <div class="article-comment-link-wrap">
                <a href="/hardware/2023/04/19/litex-digilent-arty-a7/#disqus_thread" class="article-comment-link">Comments</a>
            </div>
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <h2 id="litex-安装">litex 安装</h2>
<p>litex 安装过程按照 <a href="https://github.com/enjoy-digital/litex/wiki/Installation">https://github.com/enjoy-digital/litex/wiki/Installation</a> 进行，由于需要 pip install，建议用 venv 来开一个干净的环境：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>cd litex
</span></span><span style="display:flex;"><span>./litex_setup.py --init --install
</span></span></code></pre></div><h2 id="构建-bitstream">构建 bitstream</h2>
<p>litex-boards 已经内建了 Arty A7 的支持，直接运行下列命令，就可以得到 bitstream：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python3 -m litex_boards.targets.digilent_arty --build --with-ethernet
</span></span></code></pre></div><p>这样就可以在 build/digilent_arty/gateware 目录下找到 bitstream。可以通过命令行参数来自定义需要的功能，详见 <a href="https://github.com/litex-hub/litex-boards/blob/f5e51d72bca6ed0325c1213791a78362326002f8/litex_boards/targets/digilent_arty.py#L162-L180">https://github.com/litex-hub/litex-boards/blob/f5e51d72bca6ed0325c1213791a78362326002f8/litex_boards/targets/digilent_arty.py#L162-L180</a>。</p>
<p>如果想切换 CPU 为 Rocket Chip 的话，克隆并安装 <a href="https://github.com/litex-hub/pythondata-cpu-rocket">https://github.com/litex-hub/pythondata-cpu-rocket</a>，添加 <code>--cpu-type rocket --cpu-variant small</code> 参数即可。</p>
<h2 id="下载-bitstream">下载 bitstream</h2>
<p>最后，连接 microUSB 和网线到电脑，然后下载 bitstream：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>openFPGALoader -b arty digilent_arty.bit
</span></span><span style="display:flex;"><span>screen /dev/tty.usbserial-XXXXXXXXXXXXX <span style="color:#ae81ff">115200</span>
</span></span></code></pre></div><p>就可以看到 litex 的输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>--<span style="color:#f92672">===============</span> SoC <span style="color:#f92672">==================</span>--
</span></span><span style="display:flex;"><span>CPU:            VexRiscv @ 100MHz
</span></span><span style="display:flex;"><span>BUS:            WISHBONE 32-bit @ 4GiB
</span></span><span style="display:flex;"><span>CSR:            32-bit data
</span></span><span style="display:flex;"><span>ROM:            128.0KiB
</span></span><span style="display:flex;"><span>SRAM:           8.0KiB
</span></span><span style="display:flex;"><span>L2:             8.0KiB
</span></span><span style="display:flex;"><span>SDRAM:          256.0MiB 16-bit @ 800MT/s <span style="color:#f92672">(</span>CL-7 CWL-5<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MAIN-RAM:       256.0MiB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--<span style="color:#f92672">==========</span> Initialization <span style="color:#f92672">============</span>--
</span></span><span style="display:flex;"><span>Ethernet init...
</span></span><span style="display:flex;"><span>Initializing SDRAM @0x40000000...
</span></span><span style="display:flex;"><span>Switching SDRAM to software control.
</span></span><span style="display:flex;"><span>Read leveling:
</span></span><span style="display:flex;"><span>  m0, b00: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m0, b01: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m0, b02: |11111111110000000000000000000000| delays: 04+-04
</span></span><span style="display:flex;"><span>  m0, b03: |00000000000000111111111111000000| delays: 19+-05
</span></span><span style="display:flex;"><span>  m0, b04: |00000000000000000000000000000011| delays: 30+-00
</span></span><span style="display:flex;"><span>  m0, b05: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m0, b06: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m0, b07: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  best: m0, b03 delays: 19+-05
</span></span><span style="display:flex;"><span>  m1, b00: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m1, b01: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m1, b02: |11111111110000000000000000000000| delays: 04+-04
</span></span><span style="display:flex;"><span>  m1, b03: |00000000000000111111111111000000| delays: 19+-05
</span></span><span style="display:flex;"><span>  m1, b04: |00000000000000000000000000000011| delays: 30+-00
</span></span><span style="display:flex;"><span>  m1, b05: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m1, b06: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  m1, b07: |00000000000000000000000000000000| delays: -
</span></span><span style="display:flex;"><span>  best: m1, b03 delays: 19+-05
</span></span><span style="display:flex;"><span>Switching SDRAM to hardware control.
</span></span><span style="display:flex;"><span>Memtest at 0x40000000 <span style="color:#f92672">(</span>2.0MiB<span style="color:#f92672">)</span>...
</span></span><span style="display:flex;"><span>  Write: 0x40000000-0x40200000 2.0MiB
</span></span><span style="display:flex;"><span>   Read: 0x40000000-0x40200000 2.0MiB
</span></span><span style="display:flex;"><span>Memtest OK
</span></span><span style="display:flex;"><span>Memspeed at 0x40000000 <span style="color:#f92672">(</span>Sequential, 2.0MiB<span style="color:#f92672">)</span>...
</span></span><span style="display:flex;"><span>  Write speed: 37.0MiB/s
</span></span><span style="display:flex;"><span>   Read speed: 48.7MiB/s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--<span style="color:#f92672">==============</span> Boot <span style="color:#f92672">==================</span>--
</span></span><span style="display:flex;"><span>Booting from serial...
</span></span><span style="display:flex;"><span>Press Q or ESC to abort boot completely.
</span></span><span style="display:flex;"><span>sL5DdSMmkekro
</span></span><span style="display:flex;"><span>Timeout
</span></span><span style="display:flex;"><span>Booting from network...
</span></span><span style="display:flex;"><span>Local IP: 192.168.1.50
</span></span><span style="display:flex;"><span>Remote IP: 192.168.1.100
</span></span><span style="display:flex;"><span>Booting from boot.json...
</span></span><span style="display:flex;"><span>Booting from boot.bin...
</span></span><span style="display:flex;"><span>Copying boot.bin to 0x40000000...
</span></span><span style="display:flex;"><span>Network boot failed.
</span></span><span style="display:flex;"><span>No boot medium found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--<span style="color:#f92672">=============</span> Console <span style="color:#f92672">================</span>--
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>litex&gt; 
</span></span></code></pre></div><p>可见是非常方便的。之后可以用 litex_term 来往里面传程序，也可以直接通过 TFTP 来传。</p>
<h2 id="启动-linux">启动 Linux</h2>
<p>接下来，可以使用项目 <a href="https://github.com/litex-hub/linux-on-litex-vexriscv">https://github.com/litex-hub/linux-on-litex-vexriscv</a> 来启动 Linux。参考项目 README，编译 Linux 并启动。不想折腾的话，可以从 <a href="https://github.com/litex-hub/linux-on-litex-vexriscv/issues/164">https://github.com/litex-hub/linux-on-litex-vexriscv/issues/164</a> 下载编译好的结果。</p>
<p>首先克隆项目到本地，然后运行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/litex-hub/linux-on-litex-vexriscv.git
</span></span><span style="display:flex;"><span>cd linux-on-litex-vexriscv
</span></span><span style="display:flex;"><span>./make.py --board<span style="color:#f92672">=</span>arty
</span></span></code></pre></div><p>这样就生成了 bitstream，接下来构建 Linux 和 rootfs：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone http://github.com/buildroot/buildroot
</span></span><span style="display:flex;"><span>cd buildroot
</span></span><span style="display:flex;"><span>make BR2_EXTERNAL<span style="color:#f92672">=</span>../linux-on-litex-vexriscv/buildroot/ litex_vexriscv_defconfig
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p>再构建 OpenSBI：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/litex-hub/opensbi --branch 0.8-linux-on-litex-vexriscv
</span></span><span style="display:flex;"><span>cd opensbi
</span></span><span style="display:flex;"><span><span style="color:#75715e"># riscv32-unknown-elf toolchain is built by ct-ng</span>
</span></span><span style="display:flex;"><span>make CROSS_COMPILE<span style="color:#f92672">=</span>riscv32-unknown-elf- PLATFORM<span style="color:#f92672">=</span>litex/vexriscv
</span></span></code></pre></div><p>但是实践过程中发现 ct-ng 编译的是 hardfloat 工具链，而默认配置下 vexriscv 不带 FPU，所以编译时用的是 rv32ima 作为 target，链接的时候报错，最后就直接用编译好的版本。</p>
<p>最后得到如下的几个文件：</p>
<ul>
<li>boot.json: linux-on-litex-vexriscv/images/boot.json</li>
<li>rv32.dtb: linux-on-litex-vexriscv/images/rv32.dtb</li>
<li>Image: buildroot/output/images/Image</li>
<li>rootfs.cpio: buildroot/output/images/rootfs.cpio</li>
<li>opensbi.bin</li>
</ul>
<p>把这些文件复制到 TFTP 服务的目录下，重新 Program linux-on-litex-vexriscv/build/arty/gateware/arty.bit，即可启动 Linux：</p>
<pre tabindex="0"><code>--============== Boot ==================--
Booting from serial...
Press Q or ESC to abort boot completely.
sL5DdSMmkekro
Timeout
Booting from SDCard in SD-Mode...
Booting from boot.json...
Booting from boot.bin...
SDCard boot failed.
Booting from network...
Local IP: 192.168.1.50
Remote IP: 192.168.1.100
Booting from boot.json...
Copying Image to 0x40000000... (7726264 bytes)
Copying rv32.dtb to 0x40ef0000... (5294 bytes)
Copying rootfs.cpio to 0x41000000... (3566592 bytes)
Copying opensbi.bin to 0x40f00000... (53640 bytes)
Executing booted program at 0x40f00000

--============= Liftoff! ===============--

OpenSBI v0.8-1-gecf7701
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | &#39;_ \ / _ \ &#39;_ \ \___ \|  _ &lt; | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|____/_____|
        | |
        |_|

Platform Name       : LiteX / VexRiscv-SMP
Platform Features   : timer,mfdeleg
Platform HART Count : 8
Boot HART ID        : 0
Boot HART ISA       : rv32imas
BOOT HART Features  : time
BOOT HART PMP Count : 0
Firmware Base       : 0x40f00000
Firmware Size       : 124 KB
Runtime SBI Version : 0.2

MIDELEG : 0x00000222
MEDELEG : 0x0000b101
[    0.000000] Linux version 6.1.0-rc2 (jiegec@linux) (riscv32-buildroot-linux-gnu-gcc.br_real (Buildroot 2023.02-270-gb100440bff) 11.3.0, GNU ld (GNU Binutils) 2.38) #1 SMP Wed Apr 19 16:21:39 CST 2023
[    0.000000] earlycon: liteuart0 at I/O port 0x0 (options &#39;&#39;)
[    0.000000] Malformed early option &#39;console&#39;
[    0.000000] earlycon: liteuart0 at MMIO 0xf0001000 (options &#39;&#39;)
[    0.000000] printk: bootconsole [liteuart0] enabled
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x0000000040000000-0x000000004fffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000040000000-0x000000004fffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000004fffffff]
[    0.000000] SBI specification v0.2 detected
[    0.000000] SBI implementation ID=0x1 Version=0x8
[    0.000000] SBI TIME extension detected
[    0.000000] SBI IPI extension detected
[    0.000000] SBI RFENCE extension detected
[    0.000000] SBI HSM extension detected
[    0.000000] riscv: base ISA extensions aim
[    0.000000] riscv: ELF capabilities aim
[    0.000000] percpu: Embedded 8 pages/cpu s11732 r0 d21036 u32768
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 65024
[    0.000000] Kernel command line: console=liteuart earlycon=liteuart,0xf0001000 rootwait root=/dev/ram0
[    0.000000] Dentry cache hash table entries: 32768 (order: 5, 131072 bytes, linear)
[    0.000000] Inode-cache hash table entries: 16384 (order: 4, 65536 bytes, linear)
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.000000] Memory: 243336K/262144K available (5848K kernel code, 571K rwdata, 906K rodata, 215K init, 254K bss, 18808K reserved, 0K cma-reserved)
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] rcu: Hierarchical RCU implementation.
[    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=32 to nr_cpu_ids=1.
[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.000000] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=1
[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0
[    0.000000] riscv-intc: 32 local interrupts mapped
[    0.000000] plic: interrupt-controller@f0c00000: mapped 32 interrupts with 1 handlers for 2 contexts.
[    0.000000] rcu: srcu_init: Setting srcu_struct sizes based on contention.
[    0.000000] riscv-timer: riscv_timer_init_dt: Registering clocksource cpuid [0] hartid [0]
[    0.000000] clocksource: riscv_clocksource: mask: 0xffffffffffffffff max_cycles: 0x171024e7e0, max_idle_ns: 440795205315 ns
[    0.000018] sched_clock: 64 bits at 100MHz, resolution 10ns, wraps every 4398046511100ns
[    0.010246] Console: colour dummy device 80x25
[    0.014169] Calibrating delay loop (skipped), value calculated using timer frequency.. 200.00 BogoMIPS (lpj=400000)
[    0.024255] pid_max: default: 32768 minimum: 301
[    0.033262] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)
[    0.039790] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)
[    0.080128] ASID allocator using 9 bits (512 entries)
[    0.086947] rcu: Hierarchical SRCU implementation.
[    0.090826] rcu:     Max phase no-delay instances is 1000.
[    0.103556] smp: Bringing up secondary CPUs ...
[    0.107186] smp: Brought up 1 node, 1 CPU
[    0.118798] devtmpfs: initialized
[    0.169571] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.178637] futex hash table entries: 256 (order: 2, 16384 bytes, linear)
[    0.214981] NET: Registered PF_NETLINK/PF_ROUTE protocol family
[    0.455944] pps_core: LinuxPPS API ver. 1 registered
[    0.460007] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;
[    0.469508] PTP clock support registered
[    0.476324] FPGA manager framework
[    0.493464] clocksource: Switched to clocksource riscv_clocksource
[    0.722433] NET: Registered PF_INET protocol family
[    0.731210] IP idents hash table entries: 4096 (order: 3, 32768 bytes, linear)
[    0.752236] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 4096 bytes, linear)
[    0.760269] Table-perturb hash table entries: 65536 (order: 6, 262144 bytes, linear)
[    0.767834] TCP established hash table entries: 2048 (order: 1, 8192 bytes, linear)
[    0.775654] TCP bind hash table entries: 2048 (order: 3, 32768 bytes, linear)
[    0.783026] TCP: Hash tables configured (established 2048 bind 2048)
[    0.789689] UDP hash table entries: 256 (order: 1, 8192 bytes, linear)
[    0.795620] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes, linear)
[    0.816406] Unpacking initramfs...
[    0.926651] workingset: timestamp_bits=30 max_order=16 bucket_order=0
[    1.186672] io scheduler mq-deadline registered
[    1.190309] io scheduler kyber registered
[    1.570624] No litex,nclkout entry in the dts file
[    1.607895] LiteX SoC Controller driver initialized
[    2.358518] Initramfs unpacking failed: invalid magic at start of compressed archive
[    2.448554] Freeing initrd memory: 8192K
[    3.423827] f0001000.serial: ttyLXU0 at MMIO 0x0 (irq = 0, base_baud = 0) is a liteuart
[    3.431446] printk: console [liteuart0] enabled
[    3.431446] printk: console [liteuart0] enabled
[    3.440068] printk: bootconsole [liteuart0] disabled
[    3.440068] printk: bootconsole [liteuart0] disabled
[    3.499884] liteeth f0002000.mac eth0: irq 2 slots: tx 2 rx 2 size 2048
[    3.510055] i2c_dev: i2c /dev entries driver
[    3.520573] i2c i2c-0: Not I2C compliant: can&#39;t read SCL
[    3.525314] i2c i2c-0: Bus may be unreliable
[    3.577560] litex-mmc f0009000.mmc: LiteX MMC controller initialized.
[    3.623272] NET: Registered PF_INET6 protocol family
[    3.653652] Segment Routing with IPv6
[    3.657870] In-situ OAM (IOAM) with IPv6
[    3.662630] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver
[    3.683817] NET: Registered PF_PACKET protocol family
[    3.699016] Freeing unused kernel image (initmem) memory: 208K
[    3.704055] Kernel memory protection not selected by kernel config.
[    3.710506] Run /init as init process
Starting syslogd: OK
Starting klogd: OK
Running sysctl: OK
Saving 256 bits of non-creditable seed for next boot
Starting network: OK

Welcome to Buildroot
buildroot login: root
                   __   _
                  / /  (_)__  __ ____ __
                 / /__/ / _ \/ // /\ \ /
                /____/_/_//_/\_,_//_\_\
                      / _ \/ _ \
   __   _ __      _  _\___/_//_/         ___  _
  / /  (_) /____ | |/_/__| | / /____ __ / _ \(_)__ _____  __
 / /__/ / __/ -_)&gt;  &lt;/___/ |/ / -_) \ // , _/ (_-&lt;/ __/ |/ /
/____/_/\__/\__/_/|_|____|___/\__/_\_\/_/|_/_/___/\__/|___/
                  / __/  |/  / _ \
                 _\ \/ /|_/ / ___/
                /___/_/  /_/_/
  32-bit RISC-V Linux running on LiteX / VexRiscv-SMP.

login[70]: root login on &#39;console&#39;
root@buildroot:~# 
</code></pre><p>Linux 中也可以访问网络（通过主线内的 liteeth 驱动）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dmesg | grep liteeth
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>    3.499861<span style="color:#f92672">]</span> liteeth f0002000.mac eth0: irq <span style="color:#ae81ff">2</span> slots: tx <span style="color:#ae81ff">2</span> rx <span style="color:#ae81ff">2</span> size <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>$ ip link set eth0 up
</span></span><span style="display:flex;"><span>$ ip a add 192.168.1.50/24 dev eth0
</span></span><span style="display:flex;"><span>$ ping 192.168.1.100
</span></span></code></pre></div><h2 id="其他开发板">其他开发板</h2>
<p>除了 Digilent Arty A7，我还做了以下开发板的 LiteX 支持：</p>
<ul>
<li><a href="https://github.com/jiegec/litex-boards/tree/vcu128">VCU128</a>，支持 UART，SDRAM 和 HBM；以太网因为是 SGMII 暂时无法解决</li>
<li><a href="https://github.com/jiegec/litex-boards/tree/ma703fa-35t">MA703FA-35T</a>，支持 UART，SDRAM，ETH 和 HDMI；尚未测试 SD 卡，估计实现难度不大</li>
<li><a href="https://github.com/jiegec/litex-boards/tree/alinx_ax7021">Alinx AX7021</a>，支持 UART over JTAG 和 HDMI</li>
<li><a href="https://lab.cs.tsinghua.edu.cn/digital-design/doc/hardware/board/">THU Digital Design</a>，基于 @gaoyichuan 的实现，支持 UART，SDRAM，ETH，SD 卡和 VGA</li>
</ul>

        </div>

        
        
        <div class="article-toc" style="display:none;">
            <h3>Contents</h3>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#litex-安装">litex 安装</a></li>
    <li><a href="#构建-bitstream">构建 bitstream</a></li>
    <li><a href="#下载-bitstream">下载 bitstream</a></li>
    <li><a href="#启动-linux">启动 Linux</a></li>
    <li><a href="#其他开发板">其他开发板</a></li>
  </ul>
</nav>
        </div>
        
        

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
        <script>
            (function() {
                var $toc = $('#TableOfContents');
                if ($toc.length > 0) {
                    var $window = $(window);

                    function onScroll(){
                        var currentScroll = $window.scrollTop();
                        var h = $('.article-entry h1, .article-entry h2, .article-entry h3, .article-entry h4, .article-entry h5, .article-entry h6');
                        var id = "";
                        h.each(function (i, e) {
                            e = $(e);
                            if (e.offset().top - 10 <= currentScroll) {
                                id = e.attr('id');
                            }
                        });
                        var active = $toc.find('a.active');
                        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

                        active.each(function (i, e) {
                            $(e).removeClass('active').siblings('ul').hide();
                        });
                        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                            $(e).children('a').addClass('active').siblings('ul').show();
                        });
                    }

                    $window.on('scroll', onScroll);
                    $(document).ready(function() {
                        $toc.find('a').parent('li').find('ul').hide();
                        onScroll();
                        document.getElementsByClassName('article-toc')[0].style.display = '';
                    });
                }
            })();
        </script>
        


        
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/digilent">digilent
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/arty">arty
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/xilinx">xilinx
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/fpga">fpga
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="/tags/litex">litex
                    </a>
                </li>
                
            </ul>
        </footer>
        
    </div>
    
<nav id="article-nav">
    
    <a href="/hardware/2023/04/20/dram-topology-training/" id="article-nav-newer" class="article-nav-link-wrap">
        <div class="article-nav-title"><span>&lt;</span>&nbsp;
            DRAM 的拓扑和训练
        </div>
    </a>
    
    
    <a href="/programming/2023/04/14/counting-arguments/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">C/C&#43;&#43; 数参数个数的特别方法&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>


</article>

        
            <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jiegec" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2023 杰哥的{运维,编程,调板子}小笔记
            <br />
            Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/carsonip/hugo-theme-minos" target="_blank">Minos</a>
        </div>
    </div>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-3109FRSVTT', { 'anonymize_ip': false });
}
</script>


    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.css" integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.js" integrity="sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
        <script>renderMathInElement(document.body);</script>
    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
</footer>

</div>
</body>
</html>
