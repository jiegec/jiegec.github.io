<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>traefik on 杰哥的{运维,编程,调板子}小笔记</title>
    <link>https://jia.je/tags/traefik/</link>
    <description>Recent content in traefik on 杰哥的{运维,编程,调板子}小笔记</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 22 Feb 2022 17:20:00 +0800</lastBuildDate><atom:link href="https://jia.je/tags/traefik/feed.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>解决 k3s 中 traefik 不会转发 X-Forwarded-For 等头部的问题</title>
      <link>https://jia.je/devops/2022/02/22/k3s-traefik-client-ip/</link>
      <pubDate>Tue, 22 Feb 2022 17:20:00 +0800</pubDate>
      
      <guid>https://jia.je/devops/2022/02/22/k3s-traefik-client-ip/</guid>
      <description>背景 把应用迁移到 k3s 中，然后用了 traefik 作为 Ingress Controller，发现无法获得真实的用户 IP 地址，而是 cni 内部的地址。搜索了一番，找到了靠谱的解决方案：
Traefik Kubernetes Ingress and X-Forwarded-Headers
具体来说，需要给 traefik 传额外的参数，方法是在 k3s 的配置目录下，添加一个 HelmChartConfig：
# edit /var/lib/rancher/k3s/server/manifests/traefik-config.yaml # content: apiVersion: helm.cattle.io/v1 kind: HelmChartConfig metadata: name: traefik namespace: kube-system spec: valuesContent: |- additionalArguments: - &amp;#34;--entryPoints.web.proxyProtocol.insecure&amp;#34; - &amp;#34;--entryPoints.web.forwardedHeaders.insecure&amp;#34; 这样相当于让 traefik 信任前一级代理传过来的这些头部。更精细的话，还可以设置信任的 IP 地址范围，不过如果 traefik 不会直接暴露出去，就不用考虑这个问题了。</description>
    </item>
    
  </channel>
</rss>
