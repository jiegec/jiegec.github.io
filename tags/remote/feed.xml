<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>remote on 杰哥的{运维,编程,调板子}小笔记</title>
    <link>https://jia.je/tags/remote/</link>
    <description>Recent content in remote on 杰哥的{运维,编程,调板子}小笔记</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 01 Jul 2022 20:14:00 +0800</lastBuildDate><atom:link href="https://jia.je/tags/remote/feed.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>rsyslog 收集远程日志</title>
      <link>https://jia.je/software/2022/07/01/rsyslog-remote/</link>
      <pubDate>Fri, 01 Jul 2022 20:14:00 +0800</pubDate>
      
      <guid>https://jia.je/software/2022/07/01/rsyslog-remote/</guid>
      <description>背景 最近在运维的时候发现网络设备（如交换机）有一个远程发送日志的功能，即可以通过 syslog udp 协议发送日志到指定的服务器。为此，可以在服务器上运行 rsyslog 并收集日志。
rsyslog 配置 默认的 rsyslog 配置是收集系统本地的配置，因此我们需要编写一个 rsyslog 配置，用于收集远程的日志。
首先复制 /etc/rsyslog.conf 到 /etc/rsyslog-remote.conf，然后修改：
注释掉 imuxsock 和 imklog 相关的 module 加载 去掉 imudp 和 imtcp 相关的注释，这样就会监听在相应的端口上 修改 $WorkDirectory，例如 $WorkDirectory /var/spool/rsyslog-remote，防止与已有的 rsyslog 冲突 注释 $IncludeConfig，防止引入了不必要的配置 注释所有已有的 RULES 下面的配置 添加如下配置： $template FromIp,&amp;#34;/var/log/rsyslog-remote/%FROMHOST-IP%.log&amp;#34; *.* ?FromIp 这样，就会按照来源的 IP 地址进行分类，然后都写入到 /var/log/rsyslog-remote/x.x.x.x.log 文件里。
systemd service 最后，写一个 systemd service 让它自动启动：
[Unit] ConditionPathExists=/etc/rsyslog-remote.conf Description=Remote Syslog Service [Service] Type=simple PIDFile=/var/run/rsyslogd-remote.pid ExecStart=/usr/sbin/rsyslogd -n -f /etc/rsyslog-remote.conf -i /var/run/rsyslogd-remote.</description>
    </item>
    
  </channel>
</rss>
