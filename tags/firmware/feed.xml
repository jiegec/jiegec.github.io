<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>firmware on 杰哥的{运维,编程,调板子}小笔记</title>
    <link>https://jia.je/tags/firmware/</link>
    <description>Recent content in firmware on 杰哥的{运维,编程,调板子}小笔记</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 23 Nov 2022 19:24:00 +0800</lastBuildDate><atom:link href="https://jia.je/tags/firmware/feed.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>升级 Mellanox 网卡固件</title>
      <link>https://jia.je/hardware/2022/11/23/upgrade-mlnx-firmware/</link>
      <pubDate>Wed, 23 Nov 2022 19:24:00 +0800</pubDate>
      
      <guid>https://jia.je/hardware/2022/11/23/upgrade-mlnx-firmware/</guid>
      <description>背景 最近发现有一台机器，插上 ConnectX-4 IB 网卡后，内核模块可以识别到设备，但是无法使用，现象是 ibstat 等命令都看不到设备。降级 OFED 从 5.8 到 5.4 以后问题消失，所以认为可能是新的 OFED 与比较旧的固件版本有兼容性问题，所以尝试升级网卡固件。升级以后，问题就消失了。
安装 MFT 首先，在 https://network.nvidia.com/products/adapter-software/firmware-tools/ 下载 MFT，按照指示解压，安装后，启动 mst 服务，就可以使用 mlxfwmanager 得到网卡的型号以及固件版本：
Device Type: ConnectX4 Description: Mellanox ConnectX-4 Single Port EDR PCIE Adapter LP PSID: DEL2180110032 Versions: Current FW 12.20.1820 升级固件 从 PSID 可以看到，这是 DELL OEM 版本的网卡，可以在 https://network.nvidia.com/support/firmware/dell/ 处寻找最新固件，注意需要保证 PSID 一致，可以找到这个 PSID 的 DELL 固件地址：https://www.mellanox.com/downloads/firmware/fw-ConnectX4-rel-12_28_4512-06W1HY_0JJN39_Ax-FlexBoot-3.6.203.bin.zip。
下载以后，解压，然后就可以升级固件：
mlxfwmanager -u -i fw-ConnectX4-rel-12_28_4512-06W1HY_0JJN39_Ax-FlexBoot-3.6.203.bin 升级以后重启就工作了。
考虑到类似的情况之后还可能发生，顺便还升级了其他几台机器的网卡，下面是一个例子：
Device Type: ConnectX4 Description: ConnectX-4 VPI adapter card; FDR IB (56Gb/s) and 40GbE; dual-port QSFP28; PCIe3.</description>
    </item>
    
  </channel>
</rss>
