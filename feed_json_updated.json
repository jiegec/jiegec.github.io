{"version": "https://jsonfeed.org/version/1", "title": "\u6770\u54e5\u7684{\u8fd0\u7ef4\uff0c\u7f16\u7a0b\uff0c\u8c03\u677f\u5b50}\u5c0f\u7b14\u8bb0", "home_page_url": "https://jia.je/", "feed_url": "https://jia.je/feed_json_updated.json", "description": "\u6770\u54e5\u7684{\u8fd0\u7ef4\uff0c\u7f16\u7a0b\uff0c\u8c03\u677f\u5b50}\u5c0f\u7b14\u8bb0", "icon": null, "authors": [], "language": "zh", "items": [{"id": "https://jia.je/hardware/2024/07/30/debian-linux-on-surface-laptop-7/", "url": "https://jia.je/hardware/2024/07/30/debian-linux-on-surface-laptop-7/", "title": "\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux", "content_html": "<h1 id=\"\u5728-surface-laptop-7-\u4e0a\u8fd0\u884c-debian-linux\">\u5728 Surface Laptop 7 \u4e0a\u8fd0\u884c Debian Linux<a class=\"headerlink\" href=\"#\u5728-surface-laptop-7-\u4e0a\u8fd0\u884c-debian-linux\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u8fd1\u501f\u5230\u4e00\u53f0 Surface Laptop 7 \u53ef\u4ee5\u62ff\u6765\u6298\u817e\uff0c\u5b83\u7528\u7684\u662f\u9ad8\u901a Snapdragon X Elite \u5904\u7406\u5668\uff0c\u8dd1\u7684\u662f Windows on Arm \u7cfb\u7edf\u3002\u4f46\u4f5c\u4e3a Linux \u7528\u6237\uff0c\u80af\u5b9a\u4e0d\u6ee1\u8db3\u4e8e WSL\uff0c\u800c\u8981\u88f8\u673a\u4e0a\u5b89\u88c5 Linux\u3002\u7531\u4e8e\u8fd9\u4e2a\u673a\u5668\u592a\u65b0\uff0c\u6240\u4ee5\u5b89\u88c5\u7684\u8fc7\u7a0b\u9047\u5230\u4e86\u5f88\u591a\u574e\u5777\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u4e0a\u6e38\u8fdb\u5c55\">\u4e0a\u6e38\u8fdb\u5c55<a class=\"headerlink\" href=\"#\u4e0a\u6e38\u8fdb\u5c55\" title=\"Permanent link\">&para;</a></h2>\n<p>\u76ee\u524d X Elite \u5904\u7406\u5668\u7684\u4e0a\u6e38\u652f\u6301\u5df2\u7ecf\u9010\u6b65\u5b8c\u5584\uff0c\u4f46\u662f\u8fd8\u662f\u9700\u8981\u5f88\u65b0\u7684\u5185\u6838\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1\u624d\u5408\u5e76\u4e86 X Elite \u7684\u4e24\u4e2a\u7b14\u8bb0\u672c\u7684 device tree \u652f\u6301\u8fdb\u5185\u6838\u3002\u6211\u7528\u7684\u662f v6.11-rc1-43-g94ede2a3e913 \u7248\u672c\u7684\u5185\u6838\uff0c\u76ee\u524d\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\uff0cWi-Fi \u6b63\u5e38\uff0cUSB Type-C \u53e3\u6b63\u5e38\u5de5\u4f5c\uff08\u952e\u76d8\uff0c\u9f20\u6807\uff0c\u6709\u7ebf\u7f51\u90fd\u53ef\u4ee5\u901a\u8fc7 USB \u63a5\u5230\u7535\u8111\u4e0a\uff09\uff0c\u5185\u7f6e\u7684\u952e\u76d8\u3001\u89e6\u6478\u677f\u548c\u89e6\u6478\u5c4f\u4e0d\u5de5\u4f5c\u3002\u5e0c\u671b\u540e\u7eed\u53ef\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u786c\u4ef6\u652f\u6301\u3002</p>\n<h2 id=\"\u6298\u817e\u8fc7\u7a0b\">\u6298\u817e\u8fc7\u7a0b<a class=\"headerlink\" href=\"#\u6298\u817e\u8fc7\u7a0b\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9ad8\u901a\u548c Linaro \u5728\u53bb\u5e74\u7684\u65f6\u5019\u63a8\u51fa\u4e86\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684 Debian Installer Image\uff1ahttps://git.codelinaro.org/linaro/qcomlt/demos/debian-12-installer-image\uff0c\u5b83\u9488\u5bf9\u7684\u8bbe\u5907\u662f\u9ad8\u901a\u81ea\u5df1\u7684 CRD \u8bbe\u5907\uff0c\u548c Surface Laptop 7 \u4e0d\u540c\u3002\u81ea\u7136\uff0c\u628a\u8fd9\u4e2a image \u5199\u5230 U \u76d8\u91cc\u5e76\u542f\u52a8\u662f\u4e0d\u884c\u7684\u3002</p>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSurface Laptop 7 \u9ed8\u8ba4\u5b89\u88c5\u4e86 Windows\uff0c\u5e76\u4e14\u5f00\u542f\u4e86\u5b89\u5168\u542f\u52a8\uff0c\u800c\u6211\u4eec\u81ea\u5df1\u7f16\u8bd1\u7684 Linux \u5185\u6838\u81ea\u7136\u662f\u8fc7\u4e0d\u4e86\u5b89\u5168\u542f\u52a8\u7684\uff0c\u6240\u4ee5\u8981\u53bb\u56fa\u4ef6\u5173\u95ed\u5b89\u5168\u542f\u52a8\u3002\u7531\u4e8e Windows \u7684 Bitlocker \u9ed8\u8ba4\u662f\u6253\u5f00\u7684\uff0c\u8bf7\u5148\u4fdd\u8bc1\u4f60\u53ef\u4ee5\u83b7\u53d6 Bitlocker recovery key\uff0c\u4e0d\u7136\u4e4b\u540e\u53ef\u80fd\u8fdb\u4e0d\u53bb Windows \u7cfb\u7edf\u4e86\u3002\u5b89\u88c5\u53cc\u7cfb\u7edf\u524d\uff0c\u8bb0\u5f97\u5728 Windows \u91cc\u51c6\u5907\u597d\u5206\u533a\u8868\uff0c\u7a7a\u95f4\u4e0d\u591f\u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u7ebf\u7f29\u5c0f NTFS\u3002</p>\n<p>\u8fdb\u5165\u56fa\u4ef6\u7684\u65b9\u6cd5\uff1a\u6309\u4f4f\u97f3\u91cf\u4e0a\u952e\u5f00\u673a\u3002\u5f00\u673a\u540e\uff0c\u53ef\u4ee5\u770b\u5230 Surface UEFI \u7684\u754c\u9762\uff0c\u53ef\u4ee5\u8c03\u542f\u52a8\u987a\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u5173\u95ed\u5b89\u5168\u542f\u52a8\u3002\u4e3a\u4e86\u5b89\u88c5\u65b9\u4fbf\uff0c\u5efa\u8bae\u628a USB Storage \u653e\u5230\u7b2c\u4e00\u4e2a\u3002</p>\n<p>\u63a5\u7740\u5c31\u5f00\u59cb\u542f\u52a8 U \u76d8\u91cc\u7684 Debian Installer Image \u4e86\u3002\u542f\u52a8\u4ee5\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fdb\u5165\u4e86 grub shell\uff0c\u76ee\u6d4b\u662f grub \u627e\u4e0d\u5230\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728 (hd1,msdos1)/boot/grub \u4e0b\u9762\u627e\u5230\u3002\u4f46\u662f\u8fd9\u4e2a image \u7684 device tree \u548c kernel \u90fd\u6bd4\u8f83\u8001\uff0c\u76f4\u63a5\u542f\u52a8\u4f1a\u53d1\u73b0\uff0cDebian Install \u8fdb\u53bb\u4e86\uff0c\u4f46\u662f\u5185\u7f6e\u952e\u76d8\u548c\u5916\u7f6e USB \u952e\u76d8\u90fd\u4e0d\u5de5\u4f5c\uff0c\u4e8e\u662f\u6ca1\u6cd5\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5b89\u88c5\u3002</p>\n<p>\u8fd9\u65f6\u5019\uff0c\u5728\u7f51\u4e0a\u641c\u7d22\u4e86\u4e00\u4e0b\u5df2\u6709\u7684\u5728 X Elite \u4e0a\u8fd0\u884c Linux \u7684\u5c1d\u8bd5\uff0c\u53d1\u73b0\u6709\u4eba\u5728 ASUS \u7684 X Elite \u7b14\u8bb0\u672c\u4e0a\u88c5\u597d\u4e86\uff08<a href=\"https://matrix.org/_matrix/media/v3/download/matrix.org/hrxnkHBVEacnUGKSnHPMUHRX/1000004724.jpg\">\u6765\u6e90</a>\uff09\uff0c\u6211\u5c31\u8bd5\u7740\u7528 ASUS \u5bf9\u5e94\u578b\u53f7\u7b14\u8bb0\u672c\u7684 device tree \u53bb\u542f\u52a8\uff0c\u4f9d\u7136\u4e0d\u884c\uff0c\u7ecf\u8fc7\u4e86\u89e3\u540e\uff08\u611f\u8c22 @imbushuo\uff09\uff0c\u5f97\u77e5 Surface \u7684\u5185\u7f6e\u952e\u76d8\u7b49\u5916\u8bbe\u9700\u8981\u901a\u8fc7 SAM \u8bbf\u95ee\uff0c\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\uff0c\u76ee\u524d\u4e0d\u786e\u5b9a\u80fd\u5426\u901a\u8fc7 device tree \u542f\u7528\u3002</p>\n<p>\u4f46\u5f88\u5feb\u4e5f\u53d1\u73b0\u6709\u4eba\u5728 Surface Laptop 7 \u4e0a\u8dd1\u8d77\u6765\u4e86\uff08<a href=\"https://x.com/merckhung/status/1804972131182354604\">\u6765\u6e90</a>\uff09\uff0c\u6211\u53d1\u90ae\u4ef6\u95ee\u4e86\u8fd9\u4e2a\u4f5c\u8005\uff0c\u4f5c\u8005\u8bf4\u4ed6\u7528\u7684\u662f\u5916\u7f6e\u7684\u952e\u76d8\uff0c\u5185\u7f6e\u7684\u952e\u76d8\u4e5f\u4e0d\u5de5\u4f5c\u3002\u653e\u5927\u89c2\u5bdf\u4f5c\u8005\u5f55\u7684\u89c6\u9891\uff0c\u53d1\u73b0\u7528\u7684\u662f\u6700\u65b0\u7684 master \u5206\u652f\u7684 Linux \u5185\u6838\uff0c\u5e76\u4e14\u7528\u7684\u5c31\u662f CRD \u7684 device tree\u3002\u5230\u8fd9\u91cc\u5c31\u6bd4\u8f83\u6709\u601d\u8def\u4e86\uff1a\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e2a\u5185\u6838\uff0c\u7136\u540e\u7528 x1e80100-crd.dtb \u4f5c\u4e3a device tree\u3002</p>\n<p>\u4e8e\u662f\u9b54\u6539\u4e86 Debian Installer Image\uff1a\u66ff\u6362\u6389 linux \u5185\u6838\uff0c\u6362\u6210\u81ea\u5df1\u7f16\u8bd1\u7684\u6700\u65b0\u7248\uff0c\u89e3\u5f00 initrd\uff0c\u628a\u91cc\u9762\u7684 kernel modules \u4e5f\u6362\u6210\u65b0\u5185\u6838\u7684\u7248\u672c\uff0c\u518d\u628a\u65b0\u7684 x1e80100-crd.dtb \u590d\u5236\u4e0a\u53bb\uff0c\u518d\u7528 grub \u542f\u52a8\u65b0\u5185\u6838 + \u65b0 initrd + \u65b0 Device Tree\uff0c\u53d1\u73b0 USB \u5916\u63a5\u952e\u76d8\u5de5\u4f5c\u4e86\uff01\u867d\u7136\u53ea\u6709 Type-C \u5de5\u4f5c\uff0c\u4f46\u662f\u4e5f\u8db3\u591f\u5b8c\u6210\u5269\u4e0b\u7684\u5de5\u4f5c\u4e86\u3002</p>\n<p>\u4e0d\u8fc7\u5728\u5b89\u88c5 Debian \u7684\u65f6\u5019\uff0c\u8fd8\u9047\u5230\u4e86\u5c0f\u63d2\u66f2\uff1aglibc \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u4f30\u8ba1\u662f Linaro \u7684 Image \u592a\u8001\u4e86\u3002\u4e8e\u662f\u6211\u4ece\u65b0\u7684 debian arm64 \u91cc\u590d\u5236\u4e86 libc.so.6 \u548c ld-linux-aarch64.so.1\uff0c\u8986\u76d6\u6389 initrd \u91cc\u7684\u65e7\u7248\u672c\uff0c\u8fd9\u6837\u5c31\u597d\u4e86\u3002</p>\n<p>\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u5b89\u88c5\u7684\u7cfb\u7edf\u91cc\u7684\u5185\u6838\u662f debian \u7684\u6700\u65b0\u5185\u6838\uff0c\u4f46\u662f\u4e0d\u591f\u65b0\uff0c\u4e8e\u662f\u53c8\u8001\u4f20\u7edf\uff1a\u624b\u52a8 arch-chroot \u8fdb\u65b0\u7684 sysroot\uff0c\u5b89\u88c5\u65b0\u7684\u5185\u6838\u3002\u4e5f\u53ef\u4ee5\u50cf Linaro \u4ed3\u5e93\u91cc\u6307\u51fa\u7684\u90a3\u6837\uff0c\u76f4\u63a5\u66ff\u6362 Debian Installer Image \u91cc\u7684 deb\uff0c\u4f46\u662f\u6211\u53d1\u73b0\u6211\u6253\u7684 deb \u592a\u5927\u4e86\uff08\u6bd5\u7adf defconfig\uff09\uff0c\u653e\u4e0d\u8fdb\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ea\u597d\u6700\u540e\u81ea\u5df1\u624b\u52a8\u88c5\u3002</p>\n<p>\u6700\u540e\u5728 grub \u914d\u7f6e\u91cc\u6dfb\u52a0 devicetree \u52a0\u8f7d\u547d\u4ee4\uff0c\u518d\u4ece Debian Installer Image \u7684 grub \u914d\u7f6e\u5077 linux cmdline\uff0c\u6700\u7ec8\u662f grub \u914d\u7f6e\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>devicetree<span class=\"w\"> </span>/boot/x1e80100-crd.dtb\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"nb\">echo</span><span class=\"w\">    </span><span class=\"s1\">&#39;Loading Linux 6.11.0-rc1-00043-g94ede2a3e913 ...&#39;</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>linux<span class=\"w\">   </span>/boot/vmlinuz-6.11.0-rc1-00043-g94ede2a3e913<span class=\"w\"> </span><span class=\"nv\">root</span><span class=\"o\">=</span><span class=\"nv\">UUID</span><span class=\"o\">=</span>aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee<span class=\"w\"> </span>ro<span class=\"w\"> </span><span class=\"nv\">efi</span><span class=\"o\">=</span>novamap<span class=\"w\"> </span>pd_ignore_unused<span class=\"w\"> </span>clk_ignore_unused<span class=\"w\"> </span><span class=\"nv\">fw_devlink</span><span class=\"o\">=</span>off<span class=\"w\"> </span><span class=\"nv\">cma</span><span class=\"o\">=</span>128M<span class=\"w\"> </span>quiet\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"nb\">echo</span><span class=\"w\">    </span><span class=\"s1\">&#39;Loading initial ramdisk ...&#39;</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>initrd<span class=\"w\">  </span>/boot/initrd.img-6.11.0-rc1-00043-g94ede2a3e913\n</span></code></pre></div>\n<p>\u8fd9\u6837\u641e\u5b8c\uff0cDebian \u7cfb\u7edf\u5c31\u6b63\u5e38\u8d77\u6765\u4e86\uff01</p>\n<p>\u672c\u6587\u4e5f\u53d1\u5230\u4e86 Reddit \u4e0a\uff1ahttps://www.reddit.com/r/SurfaceLinux/comments/1efmyb3/managed_to_install_baremetal_linux_on_snapdragon/</p>", "image": null, "date_modified": "2024-07-30T00:00:00+00:00", "authors": [], "tags": ["aarch64", "debian", "hardware", "linux", "qcom", "qualcomm", "surface", "xelite"]}, {"id": "https://jia.je/software/2024/04/07/write-a-linker-4/", "url": "https://jia.je/software/2024/04/07/write-a-linker-4/", "title": "\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09", "content_html": "<h1 id=\"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56684\">\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff084\uff09<a class=\"headerlink\" href=\"#\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56684\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u524d\u8a00\">\u524d\u8a00<a class=\"headerlink\" href=\"#\u524d\u8a00\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e09\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u52a8\u6001\u5e93\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u8fdb\u4e00\u6b65\u652f\u6301\u52a8\u6001\u5e93\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u751f\u6210\u52a8\u6001\u5e93\uff0c\u8fd8\u652f\u6301\u8ba9\u52a8\u6001\u5e93\u53c2\u4e0e\u5230\u9759\u6001\u94fe\u63a5\u5f53\u4e2d\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u56de\u987e\">\u56de\u987e<a class=\"headerlink\" href=\"#\u56de\u987e\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e09\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005 ELF \u52a8\u6001\u5e93\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p>\n<ol>\n<li>\u89e3\u6790\u8f93\u5165\u7684\u82e5\u5e72\u4e2a ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u5408\u5e76\u6765\u81ea\u4e0d\u540c ELF \u7684\u540c\u540d section</li>\n<li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li>\n<li>\u5982\u679c\u8981\u751f\u6210\u52a8\u6001\u5e93\uff0c\u8fd8\u9700\u8981\u9488\u5bf9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u6784\u9020\u4e00\u4e9b\u989d\u5916\u7684 section\uff08<code>.dynamic</code>\uff0c<code>.dynsym</code> \u548c <code>.dynstr</code>\uff09</li>\n<li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff0c\u8fdb\u800c\u66f4\u65b0\u7b26\u53f7\u8868\uff0c\u5f97\u5230\u6bcf\u4e2a\u7b26\u53f7\u5728\u8fd0\u884c\u65f6\u4f1a\u5904\u5728\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li>\n<li>\u5982\u679c\u8981\u751f\u6210\u52a8\u6001\u5e93\uff0c\u56e0\u4e3a\u8fd0\u884c\u65f6\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u5730\u5740\u4e0d\u786e\u5b9a\uff0c\u6240\u4ee5\u5728 ELF \u4e2d\u628a\u52a0\u8f7d\u5730\u5740\u8bbe\u4e3a 0\uff0c\u5e76\u4e14\u8981\u6c42\u4ee3\u7801\u662f\u5730\u5740\u65e0\u5173\u4ee3\u7801\uff08PIC\uff0cPosition Independent Code\uff09</li>\n<li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li>\n</ol>\n<p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u652f\u6301\u94fe\u63a5\u52a8\u6001\u5e93\uff0c\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6700\u540e\u7684\u8fd9\u4e00\u6b65\u662f\u7528 GNU ld \u5b8c\u6210\u7684\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># assemble sources</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>main.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>main.o\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>printer.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"c1\"># ld -shared: generate shared library</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"c1\"># we have implemented this in the previous blog post</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-shared<span class=\"w\"> </span>printer.o<span class=\"w\"> </span>-o<span class=\"w\"> </span>libprinter.so\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"c1\"># ld -dynamic-linker: Set path to dynamic linker for the executable</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"c1\"># we are going to implement this one</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-dynamic-linker<span class=\"w\"> </span>/lib64/ld-linux-x86-64.so.2<span class=\"w\"> </span>main.o<span class=\"w\"> </span>libprinter.so<span class=\"w\"> </span>-o<span class=\"w\"> </span>main\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a>$<span class=\"w\"> </span><span class=\"nv\">LD_LIBRARY_PATH</span><span class=\"o\">=</span><span class=\"nv\">$PWD</span><span class=\"w\"> </span>./main\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a>Hello<span class=\"w\"> </span>world!\n</span></code></pre></div>\n<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u5c31\u662f <code>ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 main.o libprinter.so -o main</code> \u547d\u4ee4\u7684\u529f\u80fd\u3002</p>\n<h2 id=\"\u5206\u6790\">\u5206\u6790<a class=\"headerlink\" href=\"#\u5206\u6790\" title=\"Permanent link\">&para;</a></h2>\n<h3 id=\"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\">\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\" title=\"Permanent link\">&para;</a></h3>\n<p>\u9996\u5148\u8981\u5206\u6790\u4e00\u4e0b ld \u5728\u5b9e\u73b0\u52a8\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\u3002\u89c2\u5bdf\u94fe\u63a5\u5f97\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6 <code>main</code>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-dynamic-linker<span class=\"w\"> </span>/lib64/ld-linux-x86-64.so.2<span class=\"w\"> </span>main.o<span class=\"w\"> </span>libprinter.so<span class=\"w\"> </span>-o<span class=\"w\"> </span>main\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>$<span class=\"w\"> </span>readelf<span class=\"w\"> </span>-a<span class=\"w\"> </span>main\n</span></code></pre></div>\n<p>\u9996\u5148\u662f ELF Header \u90e8\u5206\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>ELF<span class=\"w\"> </span>Header:\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">  </span>Magic:<span class=\"w\">   </span>7f<span class=\"w\"> </span><span class=\"m\">45</span><span class=\"w\"> </span>4c<span class=\"w\"> </span><span class=\"m\">46</span><span class=\"w\"> </span><span class=\"m\">02</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">  </span>Class:<span class=\"w\">                             </span>ELF64\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">  </span>Data:<span class=\"w\">                              </span><span class=\"m\">2</span><span class=\"err\">&#39;</span>s<span class=\"w\"> </span>complement,<span class=\"w\"> </span>little<span class=\"w\"> </span>endian\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>current<span class=\"o\">)</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">  </span>OS/ABI:<span class=\"w\">                            </span>UNIX<span class=\"w\"> </span>-<span class=\"w\"> </span>System<span class=\"w\"> </span>V\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">  </span>ABI<span class=\"w\"> </span>Version:<span class=\"w\">                       </span><span class=\"m\">0</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">  </span>Type:<span class=\"w\">                              </span>EXEC<span class=\"w\"> </span><span class=\"o\">(</span>Executable<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-2-9\"><a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">  </span>Machine:<span class=\"w\">                           </span>Advanced<span class=\"w\"> </span>Micro<span class=\"w\"> </span>Devices<span class=\"w\"> </span>X86-64\n</span><span id=\"__span-2-10\"><a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span>0x1\n</span><span id=\"__span-2-11\"><a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">  </span>Entry<span class=\"w\"> </span>point<span class=\"w\"> </span>address:<span class=\"w\">               </span>0x401030\n</span><span id=\"__span-2-12\"><a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-2-13\"><a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">12696</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-2-14\"><a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">  </span>Flags:<span class=\"w\">                             </span>0x0\n</span><span id=\"__span-2-15\"><a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>this<span class=\"w\"> </span>header:<span class=\"w\">               </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-2-16\"><a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">56</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-2-17\"><a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">8</span>\n</span><span id=\"__span-2-18\"><a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-2-19\"><a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">15</span>\n</span><span id=\"__span-2-20\"><a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">  </span>Section<span class=\"w\"> </span>header<span class=\"w\"> </span>string<span class=\"w\"> </span>table<span class=\"w\"> </span>index:<span class=\"w\"> </span><span class=\"m\">14</span>\n</span></code></pre></div>\n<p>\u548c\u4e4b\u524d\u770b\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6ca1\u4ec0\u4e48\u4e0d\u540c\uff1aType \u662f EXEC \u8868\u793a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5165\u53e3\u5730\u5740\u6307\u5411\u4e86 <code>main</code> \u7684\u5730\u5740 <code>0x401030</code>\u3002</p>\n<p>\u63a5\u4e0b\u6765\u770b Section \u90e8\u5206\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>Section<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">  </span><span class=\"o\">[</span>Nr<span class=\"o\">]</span><span class=\"w\"> </span>Name<span class=\"w\">              </span>Type<span class=\"w\">             </span>Address<span class=\"w\">           </span>Offset\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">       </span>Size<span class=\"w\">              </span>EntSize<span class=\"w\">          </span>Flags<span class=\"w\">  </span>Link<span class=\"w\">  </span>Info<span class=\"w\">  </span>Align\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"o\">]</span><span class=\"w\">                   </span>NULL<span class=\"w\">             </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000000</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">]</span><span class=\"w\"> </span>.interp<span class=\"w\">           </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000400200</span><span class=\"w\">  </span><span class=\"m\">00000200</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">       </span>000000000000001c<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">]</span><span class=\"w\"> </span>.hash<span class=\"w\">             </span>HASH<span class=\"w\">             </span><span class=\"m\">0000000000400220</span><span class=\"w\">  </span><span class=\"m\">00000220</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000018</span><span class=\"w\">  </span><span class=\"m\">0000000000000004</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"o\">]</span><span class=\"w\"> </span>.gnu.hash<span class=\"w\">         </span>GNU_HASH<span class=\"w\">         </span><span class=\"m\">0000000000400238</span><span class=\"w\">  </span><span class=\"m\">00000238</span>\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">       </span>000000000000001c<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynsym<span class=\"w\">           </span>DYNSYM<span class=\"w\">           </span><span class=\"m\">0000000000400258</span><span class=\"w\">  </span><span class=\"m\">00000258</span>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000048</span><span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">5</span><span class=\"w\">     </span><span class=\"m\">1</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynstr<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span>00000000004002a0<span class=\"w\">  </span>000002a0\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">       </span>000000000000001a<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">6</span><span class=\"o\">]</span><span class=\"w\"> </span>.rela.plt<span class=\"w\">         </span>RELA<span class=\"w\">             </span>00000000004002c0<span class=\"w\">  </span>000002c0\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000030</span><span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">  </span>AI<span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">    </span><span class=\"m\">11</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">7</span><span class=\"o\">]</span><span class=\"w\"> </span>.plt<span class=\"w\">              </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000401000</span><span class=\"w\">  </span><span class=\"m\">00001000</span>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000030</span><span class=\"w\">  </span><span class=\"m\">0000000000000010</span><span class=\"w\">  </span>AX<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">16</span>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">8</span><span class=\"o\">]</span><span class=\"w\"> </span>.text<span class=\"w\">             </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000401030</span><span class=\"w\">  </span><span class=\"m\">00001030</span>\n</span><span id=\"__span-3-21\"><a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">       </span>000000000000000a<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>AX<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-3-22\"><a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">9</span><span class=\"o\">]</span><span class=\"w\"> </span>.eh_frame<span class=\"w\">         </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000402000</span><span class=\"w\">  </span><span class=\"m\">00002000</span>\n</span><span id=\"__span-3-23\"><a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-24\"><a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">10</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynamic<span class=\"w\">          </span>DYNAMIC<span class=\"w\">          </span>0000000000402ec8<span class=\"w\">  </span>00002ec8\n</span><span id=\"__span-3-25\"><a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000120</span><span class=\"w\">  </span><span class=\"m\">0000000000000010</span><span class=\"w\">  </span>WA<span class=\"w\">       </span><span class=\"m\">5</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-26\"><a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">11</span><span class=\"o\">]</span><span class=\"w\"> </span>.got.plt<span class=\"w\">          </span>PROGBITS<span class=\"w\">         </span>0000000000402fe8<span class=\"w\">  </span>00002fe8\n</span><span id=\"__span-3-27\"><a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000028</span><span class=\"w\">  </span><span class=\"m\">0000000000000008</span><span class=\"w\">  </span>WA<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-28\"><a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">12</span><span class=\"o\">]</span><span class=\"w\"> </span>.symtab<span class=\"w\">           </span>SYMTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00003010</span>\n</span><span id=\"__span-3-29\"><a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a><span class=\"w\">       </span>00000000000000d8<span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">          </span><span class=\"m\">13</span><span class=\"w\">     </span><span class=\"m\">3</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-3-30\"><a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">13</span><span class=\"o\">]</span><span class=\"w\"> </span>.strtab<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000030e8\n</span><span id=\"__span-3-31\"><a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000043</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-3-32\"><a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">14</span><span class=\"o\">]</span><span class=\"w\"> </span>.shstrtab<span class=\"w\">         </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>0000312b\n</span><span id=\"__span-3-33\"><a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\" href=\"#__codelineno-3-33\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000069</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-3-34\"><a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\" href=\"#__codelineno-3-34\"></a>Key<span class=\"w\"> </span>to<span class=\"w\"> </span>Flags:\n</span><span id=\"__span-3-35\"><a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\" href=\"#__codelineno-3-35\"></a><span class=\"w\">  </span>W<span class=\"w\"> </span><span class=\"o\">(</span>write<span class=\"o\">)</span>,<span class=\"w\"> </span>A<span class=\"w\"> </span><span class=\"o\">(</span>alloc<span class=\"o\">)</span>,<span class=\"w\"> </span>X<span class=\"w\"> </span><span class=\"o\">(</span>execute<span class=\"o\">)</span>,<span class=\"w\"> </span>M<span class=\"w\"> </span><span class=\"o\">(</span>merge<span class=\"o\">)</span>,<span class=\"w\"> </span>S<span class=\"w\"> </span><span class=\"o\">(</span>strings<span class=\"o\">)</span>,<span class=\"w\"> </span>I<span class=\"w\"> </span><span class=\"o\">(</span>info<span class=\"o\">)</span>,\n</span><span id=\"__span-3-36\"><a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\" href=\"#__codelineno-3-36\"></a><span class=\"w\">  </span>L<span class=\"w\"> </span><span class=\"o\">(</span>link<span class=\"w\"> </span>order<span class=\"o\">)</span>,<span class=\"w\"> </span>O<span class=\"w\"> </span><span class=\"o\">(</span>extra<span class=\"w\"> </span>OS<span class=\"w\"> </span>processing<span class=\"w\"> </span>required<span class=\"o\">)</span>,<span class=\"w\"> </span>G<span class=\"w\"> </span><span class=\"o\">(</span>group<span class=\"o\">)</span>,<span class=\"w\"> </span>T<span class=\"w\"> </span><span class=\"o\">(</span>TLS<span class=\"o\">)</span>,\n</span><span id=\"__span-3-37\"><a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\" href=\"#__codelineno-3-37\"></a><span class=\"w\">  </span>C<span class=\"w\"> </span><span class=\"o\">(</span>compressed<span class=\"o\">)</span>,<span class=\"w\"> </span>x<span class=\"w\"> </span><span class=\"o\">(</span>unknown<span class=\"o\">)</span>,<span class=\"w\"> </span>o<span class=\"w\"> </span><span class=\"o\">(</span>OS<span class=\"w\"> </span>specific<span class=\"o\">)</span>,<span class=\"w\"> </span>E<span class=\"w\"> </span><span class=\"o\">(</span>exclude<span class=\"o\">)</span>,\n</span><span id=\"__span-3-38\"><a id=\"__codelineno-3-38\" name=\"__codelineno-3-38\" href=\"#__codelineno-3-38\"></a><span class=\"w\">  </span>D<span class=\"w\"> </span><span class=\"o\">(</span>mbind<span class=\"o\">)</span>,<span class=\"w\"> </span>l<span class=\"w\"> </span><span class=\"o\">(</span>large<span class=\"o\">)</span>,<span class=\"w\"> </span>p<span class=\"w\"> </span><span class=\"o\">(</span>processor<span class=\"w\"> </span>specific<span class=\"o\">)</span>\n</span><span id=\"__span-3-39\"><a id=\"__codelineno-3-39\" name=\"__codelineno-3-39\" href=\"#__codelineno-3-39\"></a>\n</span><span id=\"__span-3-40\"><a id=\"__codelineno-3-40\" name=\"__codelineno-3-40\" href=\"#__codelineno-3-40\"></a>There<span class=\"w\"> </span>are<span class=\"w\"> </span>no<span class=\"w\"> </span>section<span class=\"w\"> </span>groups<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>this<span class=\"w\"> </span>file.\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u51fa\u73b0\u4e86\u4e00\u4e9b\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u91cc\u51fa\u73b0\u8fc7\u7684\u548c\u52a8\u6001\u94fe\u63a5\u76f8\u5173\u7684\u6bb5\uff1a</p>\n<ol>\n<li><code>.hash</code> \u548c <code>.gnu.hash</code>\uff1a\u4e0d\u540c\u683c\u5f0f\u7684\u54c8\u5e0c\u8868\uff0c\u63d0\u4f9b\u4e86\u4ece\u7b26\u53f7\u540d\u5b57\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff0c\u63d0\u9ad8\u52a8\u6001\u94fe\u63a5\u5668\u67e5\u627e\u7b26\u53f7\u7684\u6027\u80fd</li>\n<li><code>.dynsym</code>\uff1aDynamic Symbol\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u52a8\u6001\u7b26\u53f7\u8868</li>\n<li><code>.dynstr</code>\uff1aDynamic String\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u5b57\u7b26\u4e32\u7684\u8868</li>\n<li><code>.dynamic</code>\uff1aDynamic\uff0c\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fe1\u606f</li>\n</ol>\n<p>\u6b64\u5916\uff0c\u8fd8\u51fa\u73b0\u4e86\u4e00\u4e9b\u65b0\u7684\u6bb5\uff1a</p>\n<ol>\n<li><code>.interp</code>\uff1a\u8fd9\u4e2a\u6bb5\u8bb0\u5f55\u4e86 Program Interpreter \u7684\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u7528\u547d\u4ee4\u884c <code>ld -dynamic-linker /lib64/ld-linux-x86-64.so.2</code> \u6240\u6307\u5b9a\u7684 <code>/lib64/ld-linux-x86-64.so.2</code>\uff0c\u7528\u6765\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8981\u8fd0\u884c\u8fd9\u4e2a\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u9700\u8981\u4f9d\u9760\u8fd9\u4e2a Program Interpreter\uff0c\u5b83\u540c\u65f6\u4e5f\u662f\u52a8\u6001\u94fe\u63a5\u5668</li>\n<li><code>.plt</code>\uff1aProcedure Linkage Table\uff0c\u6d89\u53ca\u5230\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u51fd\u6570\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li>\n<li><code>.rela.plt</code>\uff1a\u9488\u5bf9 Procedure Linkage Table \u7684\u91cd\u5b9a\u4f4d\uff08Relocation\uff09\u4fe1\u606f\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li>\n<li><code>.got.plt</code>\uff1a\u9488\u5bf9 Procedure Linkage Table \u7684 Global Offset Table\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd</li>\n</ol>\n<p>\u8fd9\u65f6\u5019\u4f60\u89c9\u5f97\u5f88\u5947\u602a\uff1a\u901a\u5e38\u770b\u5230 <code>.rela</code> \u5f00\u5934\u7684\u6bb5\uff0c\u90fd\u662f\u5728\u5bf9\u8c61\u6587\u4ef6\u91cc\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u6bb5\u7684\u91cd\u5b9a\u4f4d\u4fe1\u606f\u3002\u4f46\u662f\u4e3a\u5565\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u8fd8\u6709\u5462\uff1f\u5728\u524d\u9762\u7684\u51e0\u7bc7\u535a\u5ba2\u4e2d\uff0c\u9759\u6001\u94fe\u63a5\u5668\u5df2\u7ecf\u89e3\u51b3\u4e86\u6240\u6709\u91cd\u5b9a\u4f4d\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u6ca1\u6709\u91cd\u5b9a\u4f4d\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u52a8\u6001\u5e93\uff0c\u7531\u4e8e\u9759\u6001\u94fe\u63a5\u5668\u65e0\u6cd5\u77e5\u9053\u52a8\u6001\u5e93\u4f1a\u88ab\u52a0\u8f7d\u5230\u4ec0\u4e48\u5730\u5740\u4e0a\u53bb\uff0c\u53ea\u597d\u4fdd\u7559\u4e86\u4e00\u4e9b\u91cd\u5b9a\u4f4d\u4fe1\u606f\uff0c\u800c\u8fd9\u4e9b\u4f1a\u7559\u7ed9\u540e\u6765\u7684\u52a8\u6001\u94fe\u63a5\u5668\uff1a\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u8d1f\u8d23\u52a0\u8f7d\u52a8\u6001\u5e93\uff0c\u4e5f\u5c31\u77e5\u9053\u4e86\u52a8\u6001\u5e93\u7684\u5730\u5740\uff0c\u56e0\u6b64\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5269\u4e0b\u7684\u8fd9\u4e9b\u9488\u5bf9\u52a8\u6001\u5e93\u7684\u91cd\u5b9a\u4f4d\u4e86\u3002</p>\n<p>\u7ee7\u7eed\u5f80\u4e0b\u770b Program Headers \u90e8\u5206\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>Program<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">  </span>Type<span class=\"w\">           </span>Offset<span class=\"w\">             </span>VirtAddr<span class=\"w\">           </span>PhysAddr\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">                 </span>FileSiz<span class=\"w\">            </span>MemSiz<span class=\"w\">              </span>Flags<span class=\"w\">  </span>Align\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">  </span>PHDR<span class=\"w\">           </span>0x0000000000000040<span class=\"w\"> </span>0x0000000000400040<span class=\"w\"> </span>0x0000000000400040\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">                 </span>0x00000000000001c0<span class=\"w\"> </span>0x00000000000001c0<span class=\"w\">  </span>R<span class=\"w\">      </span>0x8\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">  </span>INTERP<span class=\"w\">         </span>0x0000000000000200<span class=\"w\"> </span>0x0000000000400200<span class=\"w\"> </span>0x0000000000400200\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">                 </span>0x000000000000001c<span class=\"w\"> </span>0x000000000000001c<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">      </span><span class=\"o\">[</span>Requesting<span class=\"w\"> </span>program<span class=\"w\"> </span>interpreter:<span class=\"w\"> </span>/lib64/ld-linux-x86-64.so.2<span class=\"o\">]</span>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000000000<span class=\"w\"> </span>0x0000000000400000<span class=\"w\"> </span>0x0000000000400000\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">                 </span>0x00000000000002f0<span class=\"w\"> </span>0x00000000000002f0<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1000\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000001000<span class=\"w\"> </span>0x0000000000401000<span class=\"w\"> </span>0x0000000000401000\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">                 </span>0x000000000000003a<span class=\"w\"> </span>0x000000000000003a<span class=\"w\">  </span>R<span class=\"w\"> </span>E<span class=\"w\">    </span>0x1000\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000002000<span class=\"w\"> </span>0x0000000000402000<span class=\"w\"> </span>0x0000000000402000\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">                 </span>0x0000000000000000<span class=\"w\"> </span>0x0000000000000000<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1000\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000002ec8<span class=\"w\"> </span>0x0000000000402ec8<span class=\"w\"> </span>0x0000000000402ec8\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">                 </span>0x0000000000000148<span class=\"w\"> </span>0x0000000000000148<span class=\"w\">  </span>RW<span class=\"w\">     </span>0x1000\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">  </span>DYNAMIC<span class=\"w\">        </span>0x0000000000002ec8<span class=\"w\"> </span>0x0000000000402ec8<span class=\"w\"> </span>0x0000000000402ec8\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">                 </span>0x0000000000000120<span class=\"w\"> </span>0x0000000000000120<span class=\"w\">  </span>RW<span class=\"w\">     </span>0x8\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">  </span>GNU_RELRO<span class=\"w\">      </span>0x0000000000002ec8<span class=\"w\"> </span>0x0000000000402ec8<span class=\"w\"> </span>0x0000000000402ec8\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">                 </span>0x0000000000000138<span class=\"w\"> </span>0x0000000000000138<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a <code>INTERP</code> \u9879\uff0c\u5b83\u6307\u5411\u4e86 <code>.interp</code> \u6bb5\u7684\u5730\u5740\uff0c\u8fd9\u4e2a\u6bb5\u91cc\u4fdd\u5b58\u7684\u5c31\u662f <code>/lib64/ld-linux-x86-64.so.2</code> \u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5176\u5b9e\u5c31\u662f\u5728\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ece\u8fd9\u4e2a\u5730\u5740\u8bfb\u53d6 Program Interpreter \u7684\u8def\u5f84\u3002\u548c\u4e4b\u524d\u7684\u52a8\u6001\u5e93\u4e00\u6837\uff0c\u4e5f\u51fa\u73b0\u4e86 <code>DYNAMIC</code>\uff0c\u6307\u5411\u4e86 <code>.dynamic</code> \u6bb5\uff0c\u610f\u5473\u7740\u8fd9\u5373\u4f7f\u662f\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e5f\u548c\u52a8\u6001\u5e93\u6709\u4e00\u4e9b\u76f8\u4f3c\u7684\u5730\u65b9\u3002</p>\n<p>\u4e0b\u9762\u53ef\u4ee5\u770b\u5230 <code>.dynamic</code> \u6bb5\u7684\u5185\u5bb9\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>Dynamic<span class=\"w\"> </span>section<span class=\"w\"> </span>at<span class=\"w\"> </span>offset<span class=\"w\"> </span>0x2ec8<span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">13</span><span class=\"w\"> </span>entries:\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"w\">  </span>Tag<span class=\"w\">        </span>Type<span class=\"w\">                         </span>Name/Value\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"w\"> </span>0x0000000000000001<span class=\"w\"> </span><span class=\"o\">(</span>NEEDED<span class=\"o\">)</span><span class=\"w\">             </span>Shared<span class=\"w\"> </span>library:<span class=\"w\"> </span><span class=\"o\">[</span>libprinter.so<span class=\"o\">]</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"w\"> </span>0x0000000000000004<span class=\"w\"> </span><span class=\"o\">(</span>HASH<span class=\"o\">)</span><span class=\"w\">               </span>0x400220\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"w\"> </span>0x000000006ffffef5<span class=\"w\"> </span><span class=\"o\">(</span>GNU_HASH<span class=\"o\">)</span><span class=\"w\">           </span>0x400238\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\"> </span>0x0000000000000005<span class=\"w\"> </span><span class=\"o\">(</span>STRTAB<span class=\"o\">)</span><span class=\"w\">             </span>0x4002a0\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\"> </span>0x0000000000000006<span class=\"w\"> </span><span class=\"o\">(</span>SYMTAB<span class=\"o\">)</span><span class=\"w\">             </span>0x400258\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\"> </span>0x000000000000000a<span class=\"w\"> </span><span class=\"o\">(</span>STRSZ<span class=\"o\">)</span><span class=\"w\">              </span><span class=\"m\">26</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\"> </span>0x000000000000000b<span class=\"w\"> </span><span class=\"o\">(</span>SYMENT<span class=\"o\">)</span><span class=\"w\">             </span><span class=\"m\">24</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\"> </span>0x0000000000000015<span class=\"w\"> </span><span class=\"o\">(</span>DEBUG<span class=\"o\">)</span><span class=\"w\">              </span>0x0\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\"> </span>0x0000000000000003<span class=\"w\"> </span><span class=\"o\">(</span>PLTGOT<span class=\"o\">)</span><span class=\"w\">             </span>0x402fe8\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\"> </span>0x0000000000000002<span class=\"w\"> </span><span class=\"o\">(</span>PLTRELSZ<span class=\"o\">)</span><span class=\"w\">           </span><span class=\"m\">48</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\"> </span>0x0000000000000014<span class=\"w\"> </span><span class=\"o\">(</span>PLTREL<span class=\"o\">)</span><span class=\"w\">             </span>RELA\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a><span class=\"w\"> </span>0x0000000000000017<span class=\"w\"> </span><span class=\"o\">(</span>JMPREL<span class=\"o\">)</span><span class=\"w\">             </span>0x4002c0\n</span><span id=\"__span-5-15\"><a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"w\"> </span>0x0000000000000000<span class=\"w\"> </span><span class=\"o\">(</span>NULL<span class=\"o\">)</span><span class=\"w\">               </span>0x0\n</span></code></pre></div>\n<p>\u548c\u4e4b\u524d\u770b\u5230\u7684\u52a8\u6001\u5e93\u5bf9\u6bd4\uff0c\u591a\u51fa\u73b0\u4e86\u8fd9\u4e9b\u9879\uff1a</p>\n<ol>\n<li><code>NEEDED</code>\uff1a\u8868\u793a\u8fd0\u884c\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6240\u9700\u8981\u52a0\u8f7d\u7684\u52a8\u6001\u5e93\u6587\u4ef6\u540d\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u52a8\u6001\u5e93\uff0c\u5c31\u4f1a\u51fa\u73b0\u719f\u6089\u7684 <code>error while loading shared libraries</code> \u9519\u8bef</li>\n<li><code>DEBUG</code>\uff1a\u7528\u4e8e\u8c03\u8bd5\uff0c\u8fd9\u91cc\u4e0d\u8ba8\u8bba</li>\n<li><code>PLTGOT</code>\uff1a\u6307\u5411\u4e86 <code>.got.plt</code> \u6bb5\u7684\u5730\u5740</li>\n<li><code>PLTRELSZ</code>\uff1a\u8bb0\u5f55\u4e86 <code>.rela.plt</code> \u6bcf\u4e00\u9879\u7684\u5927\u5c0f</li>\n<li><code>PLTREL</code>\uff1a<code>RELA</code> \u8868\u793a <code>.rela.plt</code> \u6bcf\u4e00\u9879\u91cc\u5305\u542b addend \u9879\uff08RELA = REL with Addend\uff09</li>\n<li><code>JMPREL</code>\uff1a\u6307\u5411\u4e86 <code>.rela.plt</code> \u6bb5\u7684\u5730\u5740</li>\n</ol>\n<p>\u52a8\u6001\u94fe\u63a5\u5668\u5728\u52a0\u8f7d\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u53bb\u5bfb\u627e <code>NEEDED</code> \u6240\u6307\u5411\u7684\u90a3\u4e9b\u52a8\u6001\u5e93\u5e76\u52a0\u8f7d\u8fdb\u6765\u3002\u90a3\u4e48\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u4fdd\u5b58\u5728\u54ea\u91cc\u5462\uff1f\u548c\u6267\u884c\u7a0b\u5e8f\u8981\u53bb <code>PATH</code> \u4e2d\u5bfb\u627e\u7c7b\u4f3c\uff0c\u52a8\u6001\u5e93\u4e5f\u4f1a\u6839\u636e\u73af\u5883\u53d8\u91cf\u4ee5\u53ca\u7cfb\u7edf\u914d\u7f6e\u7684\u8def\u5f84\u53bb\u5bfb\u627e\u3002\u7531\u4e8e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u9891\u7e41\u8fdb\u884c\u7684\u64cd\u4f5c\uff0c\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\uff0c\u7cfb\u7edf\u4e2d\u4f1a\u6709\u4e00\u4efd\u7f13\u5b58\uff0c\u8fd9\u4e2a\u7f13\u5b58\u7684\u5185\u5bb9\u53ef\u4ee5\u901a\u8fc7 <code>ldconfig -p</code> \u547d\u4ee4\u67e5\u770b\u3002</p>\n<p>\u4e0a\u9762\u63d0\u5230\u4e86\u5f88\u591a\u6b21 Procedure Linkage Table\uff08PLT\uff09\uff0c\u90a3\u4e48\u5b83\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u4e0b\u9762\u6765\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4ee3\u7801\u6bb5\u3002</p>\n<h3 id=\"\u89c2\u5bdf\u4ee3\u7801\u6bb5\u548c-plt\">\u89c2\u5bdf\u4ee3\u7801\u6bb5\u548c PLT<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u4ee3\u7801\u6bb5\u548c-plt\" title=\"Permanent link\">&para;</a></h3>\n<p>\u7528 <code>objdump -S main</code> \u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4ee3\u7801\u6bb5\u548c PLT\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>main\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a>main:<span class=\"w\">     </span>file<span class=\"w\"> </span>format<span class=\"w\"> </span>elf64-x86-64\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.plt:\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"m\">0000000000401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;:\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">  </span><span class=\"m\">401000</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">35</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>push<span class=\"w\">   </span>0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span>\n</span><span id=\"__span-6-10\"><a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">  </span><span class=\"m\">401006</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ec<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fec<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span>\n</span><span id=\"__span-6-11\"><a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">  </span>40100c:<span class=\"w\">   </span>0f<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">             </span>nopl<span class=\"w\">   </span>0x0<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-6-12\"><a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a>\n</span><span id=\"__span-6-13\"><a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"m\">0000000000401010</span><span class=\"w\"> </span>&lt;print@plt&gt;:\n</span><span id=\"__span-6-14\"><a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">  </span><span class=\"m\">401010</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403000 &lt;print&gt;</span>\n</span><span id=\"__span-6-15\"><a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">  </span><span class=\"m\">401016</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x0\n</span><span id=\"__span-6-16\"><a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">  </span>40101b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>e0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span><span id=\"__span-6-17\"><a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a>\n</span><span id=\"__span-6-18\"><a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"m\">0000000000401020</span><span class=\"w\"> </span>&lt;exit@plt&gt;:\n</span><span id=\"__span-6-19\"><a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">  </span><span class=\"m\">401020</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>e2<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fe2<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403008 &lt;exit&gt;</span>\n</span><span id=\"__span-6-20\"><a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">  </span><span class=\"m\">401026</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x1\n</span><span id=\"__span-6-21\"><a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"w\">  </span>40102b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>d0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span><span id=\"__span-6-22\"><a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a>\n</span><span id=\"__span-6-23\"><a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.text:\n</span><span id=\"__span-6-24\"><a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a>\n</span><span id=\"__span-6-25\"><a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"m\">0000000000401030</span><span class=\"w\"> </span>&lt;_start&gt;:\n</span><span id=\"__span-6-26\"><a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"w\">  </span><span class=\"m\">401030</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span>db<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>call<span class=\"w\">   </span><span class=\"m\">401010</span><span class=\"w\"> </span>&lt;print@plt&gt;\n</span><span id=\"__span-6-27\"><a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"w\">  </span><span class=\"m\">401035</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span>e6<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>call<span class=\"w\">   </span><span class=\"m\">401020</span><span class=\"w\"> </span>&lt;exit@plt&gt;\n</span></code></pre></div>\n<p>\u4f1a\u53d1\u73b0\u5728 <code>.plt</code> \u6bb5\u4e2d\u51fa\u73b0\u4e86\u4e24\u4e2a\u51fd\u6570\uff1a<code>print@plt</code> \u548c <code>exit@plt</code>\uff0c\u6b63\u597d\u662f <code>main</code> \u51fd\u6570\u8c03\u7528\u7684\uff0c\u7531\u52a8\u6001\u94fe\u63a5\u5e93\u63d0\u4f9b\u7684\u51fd\u6570\u3002\u5728 <code>main</code> \u51fd\u6570\u91cc\uff0c\u4e5f\u4e0d\u662f\u76f4\u63a5\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5e93\u7684 <code>print</code> \u548c <code>exit</code>\uff0c\u800c\u662f\u8c03\u7528 <code>.plt</code> \u6bb5\u91cc\u5bf9\u5e94\u7684\u5e26 <code>@plt</code> \u540e\u7f00\u7684\u7248\u672c\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f\u800c\u4e14\uff0c<code>.plt</code> \u6bb5\u5f00\u5934\u7684\u90a3\u6bb5\u4ee3\u7801\u53c8\u662f\u505a\u4ec0\u4e48\u7684\uff1f\u4e3a\u4ec0\u4e48 <code>print@plt</code> \u548c <code>exit@plt</code> \u51fd\u6570\u90fd\u8981\u8df3\u5230 <code>0x401000</code> \u5904\u7684\u4ee3\u7801\uff1f</p>\n<p>\u8fd9\u65f6\u5019\u5c31\u8981\u4e86\u89e3 PLT \u7684\u7528\u9014\u4e86\u3002\u5728\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u94fe\u63a5\u5668\u53ef\u4ee5\u77e5\u9053\u6240\u6709\u51fd\u6570\u7684\u5730\u5740\uff0c\u6240\u4ee5\u91cd\u5b9a\u4f4d\u90fd\u53ef\u4ee5\u8ba1\u7b97\u51fa\uff0c\u8df3\u8f6c\u548c\u8c03\u7528\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u5b9e\u9645\u7684\u7edd\u5bf9\u5730\u5740\u6216\u8005\u504f\u79fb\u91cf\u3002\u4f46\u5982\u679c\u94fe\u63a5\u4e86\u4e00\u4e2a\u52a8\u6001\u5e93\uff0c\u94fe\u63a5\u5668\u65e0\u6cd5\u77e5\u9053\u52a8\u6001\u5e93\u7684\u5730\u5740\uff0c\u6240\u4ee5\u91cd\u5b9a\u4f4d\u8fd8\u662f\u5f97\u7ee7\u7eed\u7559\u7740\uff0c\u4ea4\u7ed9\u6700\u540e\u7684\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u91cd\u5b9a\u4f4d\u3002\u90a3\u4e48\uff0c\u4e00\u4e2a\u6734\u7d20\u7684\u65b9\u6cd5\u5c31\u662f\uff0c\u4fdd\u7559\u5bf9\u52a8\u6001\u5e93\u7684\u6240\u6709\u91cd\u5b9a\u4f4d\u4fe1\u606f\u3002\u7b80\u5355\u5730\u628a\u5de5\u4f5c\u63a8\u8fdf\u7ed9\u4e86\u52a8\u6001\u94fe\u63a5\u5668\u3002\u4f46\u662f\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u5de5\u4f5c\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\uff0c\u7528\u6237\u80af\u5b9a\u4e0d\u671f\u671b\u7a0b\u5e8f\u6bcf\u6b21\u542f\u52a8\u7684\u65f6\u5019\uff0c\u90fd\u8981\u82b1\u5f88\u957f\u7684\u65f6\u95f4\u5728\u52a8\u6001\u94fe\u63a5\u4e0a\uff0c\u6240\u4ee5\u52a8\u6001\u94fe\u63a5\u8fd8\u5f97\u8db3\u591f\u5feb\uff1a\u524d\u9762\u4e5f\u770b\u5230\u4e86\uff0c\u5404\u79cd\u54c8\u5e0c\u8868\u5404\u79cd\u4f18\u5316\uff0c\u5c31\u662f\u4e3a\u4e86\u63d0\u5347\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u3002\u8981\u662f\u6bcf\u4e2a\u8c03\u7528\u90fd\u6709\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u9700\u8981\u5904\u7406\uff0c\u90a3\u4e48\u6027\u80fd\u80af\u5b9a\u4e0d\u597d\u3002</p>\n<p>\u90a3\u4e48\u600e\u4e48\u529e\u5462\uff1f\u5f88\u591a\u5e38\u7528\u51fd\u6570\uff0c\u6bd4\u5982 <code>malloc</code> \u548c <code>free</code> \u7b49\u7b49\uff0c\u8c03\u7528\u7684\u5730\u65b9\u662f\u975e\u5e38\u591a\u7684\u3002\u4e0d\u8fc7\uff0c\u8f6c\u5ff5\u4e00\u60f3\uff0c\u867d\u7136\u8c03\u7528\u7684\u5730\u65b9\u5f88\u591a\uff0c\u4f46\u662f\u88ab\u8c03\u7528\u7684\u51fd\u6570\u76f8\u6bd4\u4e4b\u4e0b\u5374\u4f1a\u5c11\u5f88\u591a\uff1a\u53ef\u80fd\u6709\u4e00\u5343\u4e2a\u5730\u65b9\u8c03\u7528 <code>malloc</code>\uff0c\u4f46\u662f <code>malloc</code> \u51fd\u6570\u53ea\u6709\u4e00\u4e2a\uff0c\u5982\u679c\u53ea\u91cd\u5b9a\u4f4d\u4e00\u6b21\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3\u6240\u6709\u5bf9 <code>malloc</code> \u7684\u8c03\u7528\uff0c\u90a3\u8be5\u591a\u597d\uff01\u4f46\u662f\u91cd\u5b9a\u4f4d\u4e00\u6b21\u53ea\u80fd\u4fee\u6539\u4e00\u4e2a\u5730\u65b9\u7684\u4ee3\u7801\uff0c\u600e\u4e48\u529e\u5462\uff1f\u90a3\u5c31\u8ba9\u4e00\u5343\u4e2a\u5730\u65b9\u90fd\u8c03\u7528\u4e00\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\uff0c\u8fd9\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\u901a\u8fc7\u91cd\u5b9a\u4f4d\u8c03\u7528\u771f\u5b9e\u7684 <code>malloc</code> \u51fd\u6570\uff0c\u8fd9\u6837\u91cd\u5b9a\u4f4d\u53ea\u6709\u4e00\u6b21\uff0c\u4ee3\u4ef7\u5c31\u662f\u591a\u4e86\u4e00\u6b21\u8df3\u8f6c\u3002\u6211\u4eec\u628a\u8fd9\u4e2a\u4e34\u65f6\u7684 <code>malloc</code> \u51fd\u6570\u53eb\u505a <code>malloc@plt</code>\uff0c\u628a\u8bb0\u5f55\u6240\u6709\u8fd9\u4e9b\u4e34\u65f6\u51fd\u6570\u7684\u8868\u79f0\u4e3a Procedure Linkage Table\uff08PLT\uff09\uff0c\u90a3\u4e48\u4ee3\u7801\u53d8\u6210\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.plt</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"nl\">malloc@plt:</span>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">real_malloc</span><span class=\"w\"> </span><span class=\"c1\"># emit relocation to the real malloc</span>\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"nl\">func1:</span>\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">malloc@plt</span>\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">    </span><span class=\"c1\"># ...</span>\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a>\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"nl\">func2:</span>\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">malloc@plt</span>\n</span><span id=\"__span-7-12\"><a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">    </span><span class=\"c1\"># ...</span>\n</span></code></pre></div>\n<p>\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u91cd\u5b9a\u4f4d\u6570\u91cf\u592a\u591a\u7684\u95ee\u9898\uff1a\u4ece\u6bcf\u4e2a\u8c03\u7528\u90fd\u8981\u4e00\u4e2a\u91cd\u5b9a\u4f4d\uff0c\u964d\u4f4e\u5230\u6bcf\u4e2a\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u7684 PLT \u548c\u5b9e\u9645\u770b\u5230\u7684\u8fd8\u662f\u6709\u5f88\u5927\u7684\u533a\u522b\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"m\">0000000000401010</span><span class=\"w\"> </span>&lt;print@plt&gt;:\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"w\">  </span><span class=\"m\">401010</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403000 &lt;print&gt;</span>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">  </span><span class=\"m\">401016</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x0\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">  </span>40101b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>e0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span></code></pre></div>\n<p>\u8fd9\u4e09\u6761\u6307\u4ee4\u662f\u5728\u505a\u4ec0\u4e48\u5462\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u751f\u6210\u4e00\u4e2a\u91cd\u5b9a\u4f4d\uff0c\u76f4\u63a5\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 print \u51fd\u6570\uff1f\u800c\u8981\u641e\u5f97\u8fd9\u4e48\u9ebb\u70e6\uff1f</p>\n<p>\u7b54\u6848\u662f\u8fd8\u4e0d\u6ee1\u8db3\u4e8e\u5f53\u524d\u7684\u6027\u80fd\uff1a\u5b8c\u6574\u7684\u4ee3\u7801\u91cc\u53ef\u80fd\u4f1a\u8c03\u7528\u52a8\u6001\u5e93\u91cc\u7684\u7684\u4e00\u5343\u4e2a\u51fd\u6570\uff0c\u4f46\u662f\u5b9e\u9645\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5e76\u975e\u6240\u6709\u4ee3\u7801\u90fd\u4f1a\u88ab\u6267\u884c\uff0c\u4e8e\u662f\u53ef\u80fd\u53ea\u6709\u4e00\u5c0f\u90e8\u5206\u52a8\u6001\u5e93\u7684\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u65f6\u5019\uff0c\u5c31\u5e0c\u671b\u5b9e\u73b0\u4e00\u70b9\uff1a\u7b2c\u4e00\u6b21\u8c03\u7528\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u7684\u65f6\u5019\uff0c\u518d\u8fdb\u884c\u91cd\u5b9a\u4f4d\uff0c\u4e4b\u540e\u5c31\u4e00\u76f4\u7528\u8fd9\u4e2a\u91cd\u5b9a\u4f4d\u597d\u7684\u7ed3\u679c\u3002\u90a3\u4e48\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u4ece\u6765\u6ca1\u6709\u88ab\u8c03\u7528\u8fc7\uff0c\u90a3\u5c31\u7701\u4e0b\u4e86\u91cd\u5b9a\u4f4d\u7684\u65f6\u95f4\u3002\u8fd9\u5c31\u662f\u60f0\u6027\uff08Lazy\uff09\u6216\u8005\u8bf4\u5ef6\u8fdf\uff08Deferred\uff09\u7684\u601d\u60f3\u3002</p>\n<p>\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u5b83\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u6b21\u8c03\u7528\u7684\u65f6\u5019\uff0c\u4f1a\u8df3\u8f6c\u5230\u52a8\u6001\u94fe\u63a5\u5668\u91cc\uff0c\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u91cd\u5b9a\u4f4d\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570</li>\n<li>\u7b2c\u4e8c\u6b21\u548c\u4e4b\u540e\u8c03\u7528\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u8df3\u8f6c\u5230\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570</li>\n</ol>\n<p>\u90a3\u4e48\u600e\u4e48\u53bb\u8bb0\u5f55\u5b9e\u9645\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u7684\u5730\u5740\u5462\uff1f\u90a3\u5c31\u627e\u4e2a\u5730\u65b9\uff0c\u628a\u8fd9\u4e2a\u5730\u5740\u5b58\u4e0b\u6765\u5c31\u597d\u3002\u7b2c\u4e00\u6b21\u8c03\u7528\u7684\u65f6\u5019\uff0c\u60f3\u529e\u6cd5\u8fdb\u5165\u5230\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u8ba9\u5b83\u8fdb\u884c\u91cd\u5b9a\u4f4d\u3002\u91cd\u5b9a\u4f4d\u5b8c\u4ee5\u540e\uff0c\u5c31\u628a\u8fd9\u4e2a\u5730\u5740\u4fdd\u5b58\u4e0b\u6765\uff0c\u4e0b\u6b21\u8c03\u7528\u5c31\u4f1a\u76f4\u63a5\u8df3\u8f6c\u8fc7\u53bb\u4e86\u3002\u518d\u56de\u770b <code>print@plt</code> \u7684\u7b2c\u4e00\u6761\u6307\u4ee4\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"m\">0000000000401010</span><span class=\"w\"> </span>&lt;print@plt&gt;:\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"w\">  </span><span class=\"m\">401010</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403000 &lt;print&gt;</span>\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">  </span><span class=\"m\">401016</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x0\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"w\">  </span>40101b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>e0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span></code></pre></div>\n<p>\u5b83\u8df3\u8f6c\u5230 <code>0x1fea(%rip) # 0x403000</code> \u6307\u5411\u7684\u5730\u5740\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u4fdd\u5b58\u4e86\u672a\u6765 <code>print</code> \u5728\u52a8\u6001\u5e93\u4e2d\u7684\u771f\u5b9e\u5730\u5740\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u600e\u4e48\u5b9e\u73b0\u7b2c\u4e00\u6b21\u8c03\u7528 <code>print@plt</code> \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8fdb\u5165\u5230\u52a8\u6001\u94fe\u63a5\u5668\u5462\uff1f<code>0x1fea(%rip) # 0x403000</code> \u6307\u5411\u7684\u5730\u5740\u7684\u5185\u5bb9\u7684\u521d\u59cb\u503c\u53c8\u662f\u4ec0\u4e48\u5462\uff1f\u4e0b\u9762\u7684 <code>push</code> \u548c <code>jmp</code> \u53c8\u662f\u5728\u505a\u4ec0\u4e48\uff1f</p>\n<p>\u5176\u5b9e\uff0c\u591a\u4f59\u7684\u4e24\u6761\u6307\u4ee4\uff0c\u7ed3\u5408\u524d\u9762\u7684 <code>0x4010000</code> \u5730\u5740\u7684\u4ee3\u7801\uff0c\u5c31\u5b9e\u73b0\u4e86\u7b2c\u4e00\u6b21\u8c03\u7528\u8fdb\u52a8\u6001\u94fe\u63a5\u5668\u7684\u529f\u80fd\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"m\">0000000000401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;:\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"w\">  </span><span class=\"m\">401000</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">35</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>push<span class=\"w\">   </span>0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span>\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">  </span><span class=\"m\">401006</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ec<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fec<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span>\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">  </span>40100c:<span class=\"w\">   </span>0f<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">             </span>nopl<span class=\"w\">   </span>0x0<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a>\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"m\">0000000000401010</span><span class=\"w\"> </span>&lt;print@plt&gt;:\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">  </span><span class=\"m\">401010</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>ea<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fea<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403000 &lt;print&gt;</span>\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">  </span><span class=\"m\">401016</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x0\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">  </span>40101b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>e0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a>\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"m\">0000000000401020</span><span class=\"w\"> </span>&lt;exit@plt&gt;:\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a><span class=\"w\">  </span><span class=\"m\">401020</span>:<span class=\"w\">   </span>ff<span class=\"w\"> </span><span class=\"m\">25</span><span class=\"w\"> </span>e2<span class=\"w\"> </span>1f<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">       </span>jmp<span class=\"w\">    </span>*0x1fe2<span class=\"o\">(</span>%rip<span class=\"o\">)</span><span class=\"w\">        </span><span class=\"c1\"># 403008 &lt;exit&gt;</span>\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">  </span><span class=\"m\">401026</span>:<span class=\"w\">   </span><span class=\"m\">68</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>push<span class=\"w\">   </span><span class=\"nv\">$0</span>x1\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">  </span>40102b:<span class=\"w\">   </span>e9<span class=\"w\"> </span>d0<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\"> </span>ff<span class=\"w\">          </span>jmp<span class=\"w\">    </span><span class=\"m\">401000</span><span class=\"w\"> </span>&lt;print@plt-0x10&gt;\n</span></code></pre></div>\n<p>\u521d\u59cb\u60c5\u51b5\u4e0b\uff0c<code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5730\u5740\u662f <code>0x401016</code>\uff0c\u4e5f\u5c31\u662f <code>print@plt</code> \u7684 <code>push</code> \u6307\u4ee4\u7684\u5730\u5740\u3002\u90a3\u4e48\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528 <code>print@plt</code> \u4f1a\u53d1\u751f\u7684\u4e8b\u60c5\u662f\uff1a</p>\n<ol>\n<li>\u8c03\u7528 <code>print@plt</code>\uff0c\u6267\u884c <code>401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;</code>\uff0c\u6b64\u65f6 <code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\u662f <code>0x401016</code>\uff0c\u4e5f\u5c31\u662f\u8df3\u8f6c\u5230 <code>0x401016</code></li>\n<li>\u6267\u884c <code>401016:  68 00 00 00 00          push   $0x0</code>\uff0c\u5411\u6808\u4e0a\u538b\u5165\u4e86 <code>0</code>\uff0c\u5177\u4f53\u4ec0\u4e48\u542b\u4e49\uff0c\u4e0b\u9762\u4f1a\u8fdb\u884c\u5206\u6790</li>\n<li>\u6267\u884c <code>40101b:  e9 e0 ff ff ff          jmp    401000 &lt;print@plt-0x10&gt;</code>\uff0c\u8df3\u8f6c\u5230 <code>0x401000</code></li>\n<li>\u6267\u884c <code>401000:  ff 35 ea 1f 00 00       push   0x1fea(%rip)        # 402ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</code>\uff0c\u5177\u4f53\u4ec0\u4e48\u542b\u4e49\uff0c\u4e0b\u9762\u4f1a\u8fdb\u884c\u5206\u6790</li>\n<li>\u6267\u884c <code>401006:  ff 25 ec 1f 00 00       jmp    *0x1fec(%rip)        # 402ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</code>\uff0c\u8fd9\u4e00\u6761\u6307\u4ee4\u8df3\u8f6c\u5230 <code>0x402ff8</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u5185\u5bb9\u5c31\u662f\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u5b83\u4f1a\u8d1f\u8d23\u8fdb\u884c\u91cd\u5b9a\u4f4d\uff0c\u91cd\u5b9a\u4f4d\u4ee5\u540e\uff0c\u5c31\u4f1a\u628a\u7ed3\u679c\u5199\u5230 <code>0x403000</code> \u5730\u5740\u91cc</li>\n</ol>\n<p>\u90a3\u4e48\uff0c\u4e4b\u540e\u8c03\u7528 <code>print@plt</code> \u4f1a\u53d1\u751f\u7684\u4e8b\u60c5\u662f\uff1a</p>\n<ol>\n<li>\u8c03\u7528 <code>print@plt</code>\uff0c\u6267\u884c <code>401010:   ff 25 ea 1f 00 00       jmp    *0x1fea(%rip)        # 403000 &lt;print&gt;</code>\uff0c\u6b64\u65f6 <code>0x403000</code> \u5730\u5740\u4fdd\u5b58\u7684\u5185\u5bb9\u662f\u7ecf\u8fc7\u91cd\u5b9a\u4f4d\u540e\u7684\u771f\u5b9e\u7684 <code>print</code> \u51fd\u6570\u7684\u5730\u5740</li>\n</ol>\n<p>\u90a3\u4e48\u8fd9\u4e2a\u903b\u8f91\u5c31\u6e05\u695a\u4e86\uff1a<code>0x403000</code> \u4fdd\u5b58\u4e86 <code>print</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u5982\u679c\u8fd8\u6ca1\u6709\u91cd\u5b9a\u4f4d\uff0c\u5c31\u6307\u5411\u521d\u59cb\u5316\u7684\u4ee3\u7801 <code>0x401016</code>\u3002\u8fd9\u6bb5\u4ee3\u7801\u5411\u6808\u4e0a\u538b\u5165\u4e86\u4e24\u4e2a\u5185\u5bb9\uff1a</p>\n<ol>\n<li><code>print@plt</code> \u538b\u5165\u4e86 0\uff0c<code>exit@plt</code> \u538b\u5165\u4e86 1\uff0c\u8fd9\u5bf9\u5e94\u4e86\u52a8\u6001\u7b26\u53f7\u8868\u91cc\u8fd9\u4e24\u4e2a\u7b26\u53f7\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u7f16\u53f7\uff0c\u5c31\u53ef\u4ee5\u67e5\u5230\u8981\u627e\u7684\u7b26\u53f7\u540d\u79f0</li>\n<li>\u538b\u5165\u4e86 <code>0x402ff0</code> \u5730\u5740\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u5185\u5bb9\u7531\u52a8\u6001\u94fe\u63a5\u5668\u521d\u59cb\u5316\uff0c\u53ef\u4ee5\u60f3\u5230\u5927\u6982\u662f\u7528\u6765\u8868\u793a\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u67d0\u4e2a\u6307\u9488</li>\n</ol>\n<p>\u90a3\u4e48\u6700\u540e\u8df3\u8f6c\u5230\u52a8\u6001\u94fe\u63a5\u5668\u91cc\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u538b\u6808\u7684\u5185\u5bb9\uff0c\u627e\u5230\u8981\u91cd\u5b9a\u4f4d\u7684\u51fd\u6570\uff0c\u8fdb\u884c\u91cd\u5b9a\u4f4d\u3002</p>\n<p>\u4e3a\u4e86\u4fdd\u5b58\u4e0a\u9762\u7684\u8fd9\u4e9b\u6570\u636e\uff1a<code>0x403000</code> \u4fdd\u5b58\u7684 <code>print</code> \u51fd\u6570\u5730\u5740\uff0c\u6216\u662f\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u7684 <code>0x402ff0</code> \u4ee5\u53ca <code>0x402ff8</code>\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2a <code>.got.plt</code> \u6bb5\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a>0000000000402fe8<span class=\"w\"> </span>&lt;_GLOBAL_OFFSET_TABLE_&gt;:\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"w\">  </span>402fe8:<span class=\"w\">   </span>c8<span class=\"w\"> </span>2e<span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">             </span>enter<span class=\"w\">  </span><span class=\"nv\">$0</span>x402e,<span class=\"nv\">$0</span>x0\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"w\">    </span>...\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"w\">  </span><span class=\"m\">403000</span>:<span class=\"w\">   </span><span class=\"m\">16</span><span class=\"w\">                      </span><span class=\"o\">(</span>bad<span class=\"o\">)</span>\n</span><span id=\"__span-11-5\"><a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a><span class=\"w\">  </span><span class=\"m\">403001</span>:<span class=\"w\">   </span><span class=\"m\">10</span><span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">                </span>adc<span class=\"w\">    </span>%al,0x0<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-11-6\"><a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a><span class=\"w\">  </span><span class=\"m\">403004</span>:<span class=\"w\">   </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">                   </span>add<span class=\"w\">    </span>%al,<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-11-7\"><a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a><span class=\"w\">  </span><span class=\"m\">403006</span>:<span class=\"w\">   </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">                   </span>add<span class=\"w\">    </span>%al,<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-11-8\"><a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a><span class=\"w\">  </span><span class=\"m\">403008</span>:<span class=\"w\">   </span><span class=\"m\">26</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">             </span>es<span class=\"w\"> </span>adc<span class=\"w\"> </span>%al,0x0<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-11-9\"><a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a><span class=\"w\">  </span>40300c:<span class=\"w\">   </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">                   </span>add<span class=\"w\">    </span>%al,<span class=\"o\">(</span>%rax<span class=\"o\">)</span>\n</span><span id=\"__span-11-10\"><a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\" href=\"#__codelineno-11-10\"></a><span class=\"w\">    </span>...\n</span></code></pre></div>\n<p>\u8fd9\u4e2a\u5c31\u53eb\u505a Global Offset Table\uff0c\u8fd9\u91cc\u5c55\u793a\u7684\u662f\u7528\u4e8e PLT \u7684 GOT\u3002\u5b83\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p>\n<ol>\n<li>0x402fe8 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u5b58\u4e86 .dynamic \u6bb5\u7684\u5730\u5740</li>\n<li>0x402ff0 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u7559\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li>\n<li>0x402ff8 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a\u4fdd\u7559\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li>\n<li>0x403000 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a<code>print</code> \u7684\u5730\u5740\uff0c\u521d\u59cb\u5316\u4e3a <code>0x401016</code></li>\n<li>0x403008 \u5f00\u59cb\u7684 8 \u4e2a\u5b57\u8282\uff1a<code>exit</code> \u7684\u5730\u5740\uff0c\u521d\u59cb\u5316\u4e3a <code>0x401026</code></li>\n</ol>\n<p>\u90a3\u4e48\u5230\u8fd9\u91cc\uff0c\u5c31\u5b8c\u6210\u4e86 PLT \u4ee5\u53ca GOT \u7684\u5206\u6790\u4e86\u3002</p>\n<p>\u7b80\u5355\u5c0f\u7ed3\u4e00\u4e0b\uff1a</p>\n<ol>\n<li>\u4e3a\u4e86\u51cf\u5c11\u52a8\u6001\u94fe\u63a5\u8981\u8017\u8d39\u7684\u65f6\u95f4\uff0c\u91c7\u7528\u4e86\u60f0\u6027\u91cd\u5b9a\u4f4d\u7684\u65b9\u6cd5</li>\n<li>\u4e3a\u4e86\u51cf\u5c11\u91cd\u5b9a\u4f4d\u6b21\u6570\uff0c\u5728 PLT \u91cc\u7ed9\u6bcf\u4e2a\u8981\u8c03\u7528\u7684\u52a8\u6001\u5e93\u91cc\u7684\u51fd\u6570\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8df3\u677f\u51fd\u6570</li>\n<li>\u4e3a\u4e86\u5b9e\u73b0\u60f0\u6027\u91cd\u5b9a\u4f4d\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528\u8df3\u677f\u51fd\u6570\uff0c\u4f1a\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5668\u7684\u51fd\u6570\u6765\u5b9e\u73b0\u91cd\u5b9a\u4f4d\uff0c\u901a\u8fc7\u538b\u6808\u6765\u533a\u5206\u8981\u91cd\u5b9a\u4f4d\u7684\u51fd\u6570</li>\n<li>\u60f0\u6027\u91cd\u5b9a\u4f4d\u5b8c\u6210\u4ee5\u540e\uff0c\u8df3\u677f\u51fd\u6570\u76f4\u63a5 jmp \u5230\u76ee\u6807\u51fd\u6570</li>\n</ol>\n<h2 id=\"\u5b9e\u73b0\">\u5b9e\u73b0<a class=\"headerlink\" href=\"#\u5b9e\u73b0\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7efc\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u843d\u5230\u5b9e\u73b0\u4e0a\uff0c\u9700\u8981\u505a\u8fd9\u4e9b\u5904\u7406\uff1a</p>\n<ol>\n<li>\u9047\u5230\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u590d\u5236\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5185\u5bb9\u5230\u5404\u4e2a\u6bb5\u4e2d\uff0c\u66f4\u65b0\u7b26\u53f7\u8868\u5e76\u6253\u4e0a\u6807\u8bb0</li>\n<li>\u751f\u6210 .plt \u548c .got.plt \u6bb5\u7684\u5f00\u5934<ol>\n<li>.plt \u5f00\u5934\u8981\u751f\u6210 push\uff0cjmp \u548c nop \u7684\u6307\u4ee4\u5e8f\u5217</li>\n<li>.got.plt \u6bb5\u5f00\u5934\u4fdd\u5b58 .dynamic \u6bb5\u7684\u5730\u5740\uff0c\u7136\u540e\u9884\u7559 16 \u5b57\u8282\u7ed9\u52a8\u6001\u94fe\u63a5\u5668</li>\n</ol>\n</li>\n<li>\u8981\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5e93\u91cc\u7684\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5728 PLT \u548c GOT \u91cc\u751f\u6210\u5bf9\u5e94\u7684\u9879\uff1a<ol>\n<li>.plt \u91cc\u8981\u751f\u6210 jmp\uff0cpush \u548c jmp \u4e09\u6761\u6307\u4ee4\u7684\u5e8f\u5217</li>\n<li>.got.plt \u8981\u6dfb\u52a0\u7528\u4e8e\u4fdd\u5b58\u5b9e\u9645\u5730\u5740\u7684\u4e00\u9879</li>\n<li>.rela.plt \u4e5f\u76f8\u5e94\u5730\u66f4\u65b0\uff0c\u6307\u5411 .got.plt \u91cc\u5bf9\u5e94\u9879\u7684\u5730\u5740</li>\n</ol>\n</li>\n<li>\u6839\u636e\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bbe\u7f6e DT_INTERP\uff1b\u5bf9\u4e8e\u4f9d\u8d56\u7684\u52a8\u6001\u5e93\uff0c\u6dfb\u52a0 DT_NEEDED</li>\n<li>\u628a .plt\u3001.got.plt \u76f8\u5173\u7684\u4fe1\u606f\u8bb0\u5f55\u5230 .dynamic \u6bb5\u4e2d</li>\n</ol>\n<p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 1000 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 400 \u884c\u3002</p>\n<h2 id=\"\u603b\u7ed3\">\u603b\u7ed3<a class=\"headerlink\" href=\"#\u603b\u7ed3\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8fd9\u5c31\u662f\u300a\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\u300b\u7cfb\u5217\u535a\u5ba2\u7684\u6700\u540e\u4e00\u7bc7\u535a\u5ba2\u4e86\u3002\u56de\u987e\u4e00\u4e0b\uff0c\u6211\u4eec\u90fd\u5b8c\u6210\u4e86\u54ea\u4e9b\u529f\u80fd\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u5355\u4e2a ELF \u5bf9\u8c61\u6587\u4ef6\u7684\u94fe\u63a5</li>\n<li>\u7b2c\u4e8c\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u591a\u4e2a ELF \u5bf9\u8c61\u6587\u4ef6\u7684\u94fe\u63a5</li>\n<li>\u7b2c\u4e09\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u751f\u6210\u52a8\u6001\u5e93</li>\n<li>\u7b2c\u56db\u7bc7\u535a\u5ba2\uff1a\u652f\u6301\u52a8\u6001\u94fe\u63a5</li>\n</ol>\n<p>\u8fd9\u8ddd\u79bb\u4e00\u4e2a\u771f\u6b63\u80fd\u7528\u7684\u94fe\u63a5\u5668\u8fd8\u5dee\u5f88\u591a\u4e1c\u897f\uff1aPIE\uff0cLinker Script\uff0c\u524d\u9762\u51fa\u73b0\u8fc7\u4f46\u662f\u6ca1\u6709\u8ba8\u8bba\u7684 <code>.eh_frame</code> \u7684\u5904\u7406\u7b49\u7b49\u3002\u4f46\u5e0c\u671b\u8fd9\u4e2a\u7cfb\u5217\u535a\u5ba2\u53ef\u4ee5\u8ba9\u4f60\u5bf9\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u65b9\u5f0f\u6709\u8fdb\u4e00\u6b65\u7684\u4e86\u89e3\u3002</p>\n<p>\u6211\u5b9e\u73b0\u7684\u94fe\u63a5\u5668\u4ee3\u7801\u5df2\u7ecf\u5f00\u6e90\u5728 <a href=\"https://github.com/jiegec/cold\">jiegec/cold</a>\uff0c\u7f16\u5199\u7684\u8fc7\u7a0b\u548c\u535a\u5ba2\u7684\u65f6\u95f4\u57fa\u672c\u662f\u4e00\u81f4\u7684\uff0c\u9488\u5bf9\u76f8\u5e94\u535a\u5ba2\u7684\u8fdb\u5ea6\uff0c\u53ef\u4ee5\u627e git commit \u5386\u53f2\uff0c\u67e5\u770b\u5bf9\u5e94\u7248\u672c\u7684\u5b9e\u73b0\u3002</p>\n<h2 id=\"\u53c2\u8003\">\u53c2\u8003<a class=\"headerlink\" href=\"#\u53c2\u8003\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p>\n<ul>\n<li><a href=\"https://maskray.me/blog/2021-09-19-all-about-procedure-linkage-table\">All about Procedure Linkage Table</a></li>\n</ul>", "image": null, "date_modified": "2024-04-07T00:00:00+00:00", "authors": [], "tags": ["elf", "linker", "linux", "software", "write-a-linker"]}, {"id": "https://jia.je/software/2024/04/06/write-a-linker-3/", "url": "https://jia.je/software/2024/04/06/write-a-linker-3/", "title": "\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09", "content_html": "<h1 id=\"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56683\">\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff083\uff09<a class=\"headerlink\" href=\"#\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56683\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u524d\u8a00\">\u524d\u8a00<a class=\"headerlink\" href=\"#\u524d\u8a00\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e24\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8fdb\u4e00\u6b65\u652f\u6301\u52a8\u6001\u5e93\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u52a8\u6001\u5e93\u3002</p>\n<!-- more -->\n\n<p>\u6ce8\u610f\uff0c\u672c\u7bc7\u535a\u5ba2\u53ea\u8ba8\u8bba\u5982\u4f55\u751f\u6210 ELF \u52a8\u6001\u5e93\uff0c\u5e76\u4e0d\u6d89\u53ca\u5982\u4f55\u94fe\u63a5 ELF \u52a8\u6001\u5e93\uff0c\u8fd9\u5c06\u4f1a\u4f5c\u4e3a\u540e\u7eed\u6587\u7ae0\u7684\u5185\u5bb9\u3002</p>\n<h2 id=\"\u56de\u987e\">\u56de\u987e<a class=\"headerlink\" href=\"#\u56de\u987e\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u524d\u4e24\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u82e5\u5e72\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p>\n<ol>\n<li>\u89e3\u6790\u8f93\u5165\u7684\u82e5\u5e72\u4e2a ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u5408\u5e76\u6765\u81ea\u4e0d\u540c ELF \u7684\u540c\u540d section</li>\n<li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li>\n<li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff0c\u8fdb\u800c\u66f4\u65b0\u7b26\u53f7\u8868\uff0c\u5f97\u5230\u6bcf\u4e2a\u7b26\u53f7\u5728\u8fd0\u884c\u65f6\u4f1a\u5904\u5728\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li>\n<li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li>\n</ol>\n<p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5b9e\u73b0\u751f\u6210\u52a8\u6001\u5e93\u6587\u4ef6\uff0c\u8ba9\u6211\u4eec\u9996\u5148\u5206\u6790\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7684\u4e0d\u540c\u5728\u54ea\u91cc\u3002</p>\n<h2 id=\"\u5206\u6790\">\u5206\u6790<a class=\"headerlink\" href=\"#\u5206\u6790\" title=\"Permanent link\">&para;</a></h2>\n<h3 id=\"\u52a8\u6001\u94fe\u63a5\">\u52a8\u6001\u94fe\u63a5<a class=\"headerlink\" href=\"#\u52a8\u6001\u94fe\u63a5\" title=\"Permanent link\">&para;</a></h3>\n<p>\u672c\u7cfb\u5217\u7684\u524d\u9762\u4e24\u7bc7\u6587\u7ae0\u535a\u5ba2\u5b9e\u73b0\u7684\u90fd\u662f\u9759\u6001\u94fe\u63a5\uff1a\u7531\u9759\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u6240\u6709\u7684\u4e8b\u60c5\uff0c\u5f97\u5230\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u5c31\u53ef\u4ee5\u8dd1\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u64cd\u4f5c\u3002\u4f46\u662f\u9759\u6001\u94fe\u63a5\u4e5f\u6709\u4e00\u4e9b\u7f3a\u70b9\uff1a</p>\n<ol>\n<li>\u4e8c\u8fdb\u5236\u4f53\u79ef\u5927\uff0c\u540c\u6837\u7684\u4ee3\u7801\u51fa\u73b0\u5728\u5f88\u591a\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\uff0c\u540c\u65f6\u56e0\u4e3a\u8fd9\u4e9b\u4ee3\u7801\u7ecf\u8fc7\u4e86\u91cd\u5b9a\u4f4d\uff0c\u5185\u5bb9\u6709\u4e9b\u8bb8\u5dee\u522b\uff0c\u65e0\u6cd5\u590d\u7528\uff0c\u6d6a\u8d39\u786c\u76d8\u548c\u5185\u5b58\u7a7a\u95f4</li>\n<li>\u5982\u679c\u67d0\u4e2a\u5e95\u5c42\u5e93\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u7531\u4e8e\u8fd9\u4e2a\u5e93\u53ef\u80fd\u9759\u6001\u94fe\u63a5\u5230\u4e86\u5f88\u591a\u4e0d\u540c\u7684\u7a0b\u5e8f\u91cc\uff0c\u4e3a\u4e86\u53bb\u9664\u6709\u95ee\u9898\u7684\u4ee3\u7801\uff0c\u9700\u8981\u628a\u6240\u6709\u7528\u5230\u8fd9\u4e2a\u5e93\u7684\u7a0b\u5e8f\u90fd\u91cd\u65b0\u7f16\u8bd1\u4e00\u904d\uff0c\u624d\u80fd\u4fdd\u8bc1\u5b89\u5168\u7684\u4ee3\u7801\u88ab\u94fe\u63a5\u8fdb\u53bb</li>\n</ol>\n<p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u5e38\u7528\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u52a8\u6001\u94fe\u63a5\uff1a\u9759\u6001\u94fe\u63a5\u5668\u53ea\u5b8c\u6210\u4e00\u90e8\u5206\u7684\u94fe\u63a5\uff0c\u5269\u4e0b\u7684\u4e00\u90e8\u5206\u5de5\u4f5c\uff0c\u8981\u7b49\u5230\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\u5b8c\u6210\uff0c\u90a3\u4e48\u7a0b\u5e8f\u5728\u542f\u52a8\u65f6\u7531\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u7684\u94fe\u63a5\uff0c\u5c31\u662f\u52a8\u6001\u94fe\u63a5\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u6bb5 C \u4ee3\u7801\u8c03\u7528\u4e86\u6807\u51c6\u5e93\u91cc\u7684 C \u51fd\u6570\uff0c\u8981\u4e48\u7528\u9759\u6001\u94fe\u63a5\uff0c\u628a\u6574\u4e2a\u6807\u51c6\u5e93\u8fde\u63a5\u5230\u53ef\u6267\u884c\u6587\u4ef6\u91cc\uff1b\u8981\u4e48\u5c31\u7528\u52a8\u6001\u94fe\u63a5\uff0c\u5728\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u4fdd\u7559\u4e0e\u51fd\u6570\u8c03\u7528\u76f8\u5173\u7684\u91cd\u5b9a\u4f4d\uff0c\u5728\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u518d\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u6700\u540e\u7684\u94fe\u63a5\u8fc7\u7a0b\u3002\u52a8\u6001\u94fe\u63a5\u89e3\u51b3\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u95ee\u9898\uff1a</p>\n<ol>\n<li>\u7531\u4e8e\u52a8\u6001\u94fe\u63a5\u7b49\u5230\u6700\u540e\u7a0b\u5e8f\u542f\u52a8\u65f6\u624d\u8fdb\u884c\uff0c\u6240\u4ee5\u53ef\u6267\u884c\u6587\u4ef6\u672c\u8eab\u7684\u4f53\u79ef\u5c31\u53ef\u4ee5\u505a\u5230\u5f88\u5c0f\uff0c\u4e0d\u518d\u9700\u8981\u9759\u6001\u94fe\u63a5\u4e00\u4e2a\u53ef\u80fd\u5de8\u5927\u7684\u9759\u6001\u5e93</li>\n<li>\u52a8\u6001\u94fe\u63a5\u662f\u6bcf\u6b21\u7a0b\u5e8f\u542f\u52a8\u65f6\u8fdb\u884c\uff0c\u6240\u4ee5\u5982\u679c\u52a8\u6001\u5e93\u6587\u4ef6\u66ff\u6362\u4e86\uff0c\u90a3\u4e48\u7a0b\u5e8f\u672a\u6765\u518d\u6b21\u542f\u52a8\u65f6\uff0c\u81ea\u7136\u5c31\u4f1a\u7528\u5230\u65b0\u7684\u52a8\u6001\u5e93\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u7a0b\u5e8f</li>\n</ol>\n<p>\u5f53\u7136\u4e86\uff0c\u52a8\u6001\u94fe\u63a5\u4e5f\u5e26\u6765\u4e86\u65b0\u7684\u8981\u6c42\u548c\u6311\u6218\uff1a</p>\n<ol>\n<li>\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u91cc\u53ea\u4f1a\u52a0\u8f7d\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6240\u4ee5\u6240\u6709\u5730\u5740\u90fd\u53ef\u4ee5\u9884\u5148\u7b97\u597d\uff0c\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u51b2\u7a81\uff1b\u800c\u52a8\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u540c\u4e00\u4e2a\u52a8\u6001\u5e93\u6ca1\u529e\u6cd5\u4fdd\u8bc1\u603b\u662f\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u5730\u5740\u4e0a\uff1a\u5982\u679c\u6bcf\u4e2a\u52a8\u6001\u5e93\u90fd\u5199\u6b7b\u4e86\u81ea\u5df1\u8981\u52a0\u8f7d\u5230\u7684\u5730\u5740\uff0c\u90a3\u4e48\u4e0d\u540c\u7684\u52a8\u6001\u5e93\u9009\u4e86\u540c\u6837\u7684\u5730\u5740\uff0c\u662f\u5426\u5c31\u610f\u5473\u7740\u4e0d\u80fd\u540c\u65f6\u7528\u8fd9\u4e24\u4e2a\u52a8\u6001\u5e93\u4e86\uff1f\u56e0\u6b64\u52a8\u6001\u5e93\u8981\u652f\u6301\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5730\u5740\u4e0a\uff0c\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u6807\uff0c\u5c31\u9700\u8981\u5728\u7f16\u8bd1\u52a8\u6001\u5e93\u7684\u65f6\u5019\uff0c\u4ee5 PIC\uff08Position Independent Code\uff0c\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff09\u7684\u65b9\u5f0f\u7f16\u8bd1\uff0c\u4f7f\u5f97\u65e0\u8bba\u52a8\u6001\u5e93\u52a0\u8f7d\u5230\u54ea\u91cc\uff0c\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u4e0b\u9762\u4f1a\u7ed9\u51fa\u4e00\u4e2a\u4f8b\u5b50</li>\n<li>\u7531\u4e8e\u7a0b\u5e8f\u6bcf\u6b21\u542f\u52a8\u90fd\u9700\u8981\u52a8\u6001\u94fe\u63a5\uff0c\u90a3\u4e48\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u5c31\u8981\u5c3d\u91cf\u597d\uff1b\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\uff0c\u540e\u9762\u4f1a\u770b\u5230\u9759\u6001\u94fe\u63a5\u5668\u548c\u52a8\u6001\u94fe\u63a5\u5668\u662f\u5982\u4f55\u914d\u5408\u7740\u63d0\u9ad8\u6027\u80fd\u7684</li>\n</ol>\n<h3 id=\"\u751f\u6210\u52a8\u6001\u5e93\">\u751f\u6210\u52a8\u6001\u5e93<a class=\"headerlink\" href=\"#\u751f\u6210\u52a8\u6001\u5e93\" title=\"Permanent link\">&para;</a></h3>\n<p>\u56de\u987e\u4e00\u4e0b\uff0c\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u628a\u4ee3\u7801\u5206\u6210\u4e86\u4e24\u90e8\u5206\uff1a<code>main.s</code> \u548c <code>printer.s</code>\uff0c\u524d\u8005\u8c03\u7528\u540e\u8005\u5b9e\u73b0\u7684 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># https://gist.github.com/adrianratnapala/1321776</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"c1\"># printer.s</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.rodata</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"nl\">hello:</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">    </span><span class=\"na\">.string</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello world!\\n&quot;</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">print</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"nl\">print:</span>\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">    </span><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-0-14\"><a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-0-15\"><a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-0-16\"><a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span><span id=\"__span-0-17\"><a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"w\">    </span><span class=\"nf\">ret</span>\n</span><span id=\"__span-0-18\"><a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a>\n</span><span id=\"__span-0-19\"><a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">exit</span>\n</span><span id=\"__span-0-20\"><a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"nl\">exit:</span>\n</span><span id=\"__span-0-21\"><a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"c1\"># _exit(0)</span>\n</span><span id=\"__span-0-22\"><a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"nf\">xor</span><span class=\"w\">     </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-23\"><a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-0-24\"><a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\"># main.s</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">_start</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"nl\">_start:</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">print</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">exit</span>\n</span></code></pre></div>\n<p>\u90a3\u4e48\u6211\u4eec\u5c31\u60f3\u628a <code>printer.s</code> \u7f16\u8bd1\u6210\u4e00\u4e2a\u52a8\u6001\u5e93 <code>libprinter.so</code>\uff0c\u7136\u540e <code>main.s</code> \u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u52a8\u6001\u94fe\u63a5\u5230 <code>libprinter.so</code>\u3002\u4e3a\u4e86\u751f\u6210\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u9700\u8981\u4e3a <code>ld</code> \u6dfb\u52a0 <code>-shared</code> \u547d\u4ee4\u884c\u53c2\u6570\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>main.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>main.o\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>printer.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"c1\"># ld -shared: generate shared library</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-shared<span class=\"w\"> </span>printer.o<span class=\"w\"> </span>-o<span class=\"w\"> </span>libprinter.so\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>ld:<span class=\"w\"> </span>printer.o:<span class=\"w\"> </span>relocation<span class=\"w\"> </span>R_X86_64_32S<span class=\"w\"> </span>against<span class=\"w\"> </span><span class=\"sb\">`</span>.rodata<span class=\"err\">&#39;</span><span class=\"w\"> </span>can<span class=\"w\"> </span>not<span class=\"w\"> </span>be<span class=\"w\"> </span>used<span class=\"w\"> </span>when<span class=\"w\"> </span>making<span class=\"w\"> </span>a<span class=\"w\"> </span>shared<span class=\"w\"> </span>object<span class=\"p\">;</span><span class=\"w\"> </span>recompile<span class=\"w\"> </span>with<span class=\"w\"> </span>-fPIC\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>ld:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"nb\">set</span><span class=\"w\"> </span>dynamic<span class=\"w\"> </span>section<span class=\"w\"> </span>sizes:<span class=\"w\"> </span>bad<span class=\"w\"> </span>value\n</span></code></pre></div>\n<p>\u548c\u5f80\u5e38\u4e00\u6837\uff0c\u6211\u4eec\u5206\u522b\u4e3a <code>main.s</code> \u548c <code>printer.s</code> \u8c03\u7528\u6c47\u7f16\u5668 <code>as</code>\uff0c\u4f46\u8fd9\u6b21\uff0c\u5355\u72ec\u7528 <code>printer.o</code> \u94fe\u63a5\u51fa\u52a8\u6001\u5e93 <code>libprinter.so</code>\uff0c\u4e0d\u5e78\u7684\u662f\uff0c\u5b83\u62a5\u9519\u4e86\uff0c\u544a\u8bc9\u6211\u4eec\u751f\u6210\u52a8\u6001\u5e93\u7684\u65f6\u5019\uff0c\u4e0d\u5141\u8bb8\u51fa\u73b0 <code>R_X86_64_32S</code> \u7684 relocation \u7c7b\u578b\uff1a<code>ld: printer.o: relocation R_X86_64_32S against ``.rodata' can not be used when making a shared object</code>\u3002\u56de\u5fc6\u7b2c\u4e00\u7bc7\u535a\u5ba2\uff0c<code>R_X86_64_32S</code> \u7684\u610f\u601d\u662f\u628a\u76ee\u7684\u7b26\u53f7\u7684\u7edd\u5bf9\u5730\u5740\u4ee5 32 \u4f4d\u6709\u7b26\u53f7\u6570\u7684\u5f62\u5f0f\u586b\u5199\uff0c\u4f46\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u52a8\u6001\u5e93\u662f\u65e0\u6cd5\u63d0\u524d\u77e5\u9053\u81ea\u5df1\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\u7684\uff0c\u94fe\u63a5\u5668\u6ca1\u529e\u6cd5\u63d0\u524d\u77e5\u9053\u76ee\u7684\u7b26\u53f7\u7684\u7edd\u5bf9\u5730\u5740\u3002\u8fd9\u8bf4\u660e\u6211\u4eec\u9700\u8981\u628a <code>printer.s</code> \u6539\u5199\u6210\u53ea\u7528\u76f8\u5bf9\u5730\u5740\uff0c\u4e0d\u7528\u7edd\u5bf9\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u6210\u4e3a\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08PIC\uff09\u4e86\u3002\u94fe\u63a5\u5668\u8fd8\u8d34\u5fc3\u5730\u544a\u8bc9\u6211\u4eec\uff0c\u53ef\u4ee5\u7ed9\u7f16\u8bd1\u5668\u4f20 <code>-fPIC</code> \u53c2\u6570\u6765\u8ba9\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1 C \u4ee3\u7801\u7684\u65f6\u5019\u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08PIC\uff09\u3002\u4e0d\u8fc7\u6211\u4eec\u6b63\u5728\u624b\u5199\u6c47\u7f16\uff0c\u90a3\u5c31\u5fc5\u987b\u624b\u52a8\u6539\u5199\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\u4e86\uff0c\u600e\u4e48\u6539\u5462\uff1f</p>\n<p>\u65e2\u7136\u4e0d\u5141\u8bb8\u51fa\u73b0\u7684\u662f <code>R_X86_64_32S</code>\uff0c\u6211\u4eec\u8981\u627e\u5230\u4ea7\u751f\u8fd9\u4e2a relocation \u7684\u6c47\u7f16\u4ee3\u7801\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span></code></pre></div>\n<p>\u5b83\u7684\u76ee\u7684\u662f\u628a <code>hello</code> \u7684\u5730\u5740\u5199\u5230 <code>%rsi</code> \u5bc4\u5b58\u5668\u4e2d\uff0c\u4f46\u662f\u8fd9\u4e2a\u5199\u6cd5\u4f1a\u8981\u6c42\u94fe\u63a5\u5668\u4ee5\u7acb\u5373\u6570\u7684\u5f62\u5f0f\u628a\u7edd\u5bf9\u5730\u5740\u5199\u8fdb\u53bb\u3002\u800c\u6211\u4eec\u60f3\u8981\u7684\u662f\u5730\u5740\u65e0\u5173\u4ee3\u7801\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7528\u5230\u76f8\u5bf9\u5730\u5740\u3002\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u5728\u4ec0\u4e48\u5730\u65b9\u51fa\u73b0\u4e86\u76f8\u5bf9\u5730\u5740\uff1f\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c<code>main.s</code> \u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u65f6\u7528\u5230\u4e86 <code>R_X86_64_PC32</code>\uff0c\u5b83\u7684\u7acb\u5373\u6570\u8bb0\u5f55\u7684\u662f\u76f8\u5bf9\u5730\u5740\u504f\u79fb\u3002\u5982\u679c\u5728\u8fd9\u91cc\uff0c\u4e5f\u8ba9\u94fe\u63a5\u5668\u751f\u6210\u4e00\u4e2a\u76f8\u5bf9\u7684 relocation\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5730\u5740\u65e0\u5173\u4e86\uff0c\u8fd9\u6761\u6307\u4ee4\u662f\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"w\">    </span><span class=\"nf\">lea</span><span class=\"w\">     </span><span class=\"no\">hello</span><span class=\"p\">(</span><span class=\"nv\">%rip</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span></code></pre></div>\n<p><code>lea</code> \u662f x86 \u7684 LEA\uff08Load Effective Address\uff09\u6307\u4ee4\uff0c\u5b83\u7684\u529f\u80fd\u662f\u8ba1\u7b97 <code>%rip</code> \u52a0\u7acb\u5373\u6570\u7684\u503c\uff0c\u5199\u5165\u5230 <code>%rsi</code> \u7684\u503c\uff0c\u800c\u8fd9\u4e2a\u7acb\u5373\u6570\u5c31\u662f <code>hello</code> \u76f8\u5bf9\u4e8e <code>%rip</code> \u7684\u76f8\u5bf9\u5730\u5740\u504f\u79fb\u3002\u5f88\u9057\u61be\uff0c\u6c47\u7f16\u5668\u6ca1\u529e\u6cd5\u5e2e\u6211\u4eec\u505a\u8fd9\u4e2a\u6539\u5199\uff0c\u5fc5\u987b\u5728\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5c31\u60f3\u7740\u8981\u5199\u5730\u5740\u65e0\u5173\u4ee3\u7801\u3002\u6539\u5199\u540e\u7684 <code>printer.s</code> \u5982\u4e0b\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"c1\"># https://gist.github.com/adrianratnapala/1321776</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"c1\"># printer.s</span>\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.rodata</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"nl\">hello:</span>\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"w\">    </span><span class=\"na\">.string</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello world!\\n&quot;</span>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a>\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">print</span>\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"nl\">print:</span>\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\">    </span><span class=\"c1\"># this instruction requires absolute addressing</span>\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a><span class=\"w\">    </span><span class=\"c1\"># mov     $hello, %rsi</span>\n</span><span id=\"__span-5-15\"><a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"w\">    </span><span class=\"c1\"># this one is position independent</span>\n</span><span id=\"__span-5-16\"><a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a><span class=\"w\">    </span><span class=\"nf\">lea</span><span class=\"w\">     </span><span class=\"no\">hello</span><span class=\"p\">(</span><span class=\"nv\">%rip</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-5-17\"><a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-5-18\"><a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-5-19\"><a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span><span id=\"__span-5-20\"><a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a><span class=\"w\">    </span><span class=\"nf\">ret</span>\n</span><span id=\"__span-5-21\"><a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a>\n</span><span id=\"__span-5-22\"><a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">exit</span>\n</span><span id=\"__span-5-23\"><a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a><span class=\"nl\">exit:</span>\n</span><span id=\"__span-5-24\"><a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\" href=\"#__codelineno-5-24\"></a><span class=\"w\">    </span><span class=\"c1\"># _exit(0)</span>\n</span><span id=\"__span-5-25\"><a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\" href=\"#__codelineno-5-25\"></a><span class=\"w\">    </span><span class=\"nf\">xor</span><span class=\"w\">     </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-5-26\"><a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\" href=\"#__codelineno-5-26\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-5-27\"><a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\" href=\"#__codelineno-5-27\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5b83\u786e\u5b9e\u4ea7\u751f\u4e86\u4e00\u4e2a\u76f8\u5bf9\u7684 relocation <code>R_X86_64_PC32</code>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>printer.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>-r<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>printer.o:<span class=\"w\">     </span>file<span class=\"w\"> </span>format<span class=\"w\"> </span>elf64-x86-64\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.text:\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a>\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>&lt;print&gt;:\n</span><span id=\"__span-6-10\"><a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">   </span><span class=\"m\">0</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c7<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rdi\n</span><span id=\"__span-6-11\"><a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">   </span><span class=\"m\">7</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>8d<span class=\"w\"> </span><span class=\"m\">35</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>lea<span class=\"w\">    </span>0x0<span class=\"o\">(</span>%rip<span class=\"o\">)</span>,%rsi<span class=\"w\">        </span><span class=\"c1\"># e &lt;print+0xe&gt;</span>\n</span><span id=\"__span-6-12\"><a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">                        </span>a:<span class=\"w\"> </span>R_X86_64_PC32<span class=\"w\">        </span>.rodata-0x4\n</span><span id=\"__span-6-13\"><a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">   </span>e:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c2<span class=\"w\"> </span>0d<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>xd,%rdx\n</span><span id=\"__span-6-14\"><a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">  </span><span class=\"m\">15</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rax\n</span><span id=\"__span-6-15\"><a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">  </span>1c:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span><span id=\"__span-6-16\"><a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">  </span>1e:<span class=\"w\">   </span>c3<span class=\"w\">                      </span>ret\n</span><span id=\"__span-6-17\"><a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a>\n</span><span id=\"__span-6-18\"><a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a>000000000000001f<span class=\"w\"> </span>&lt;exit&gt;:\n</span><span id=\"__span-6-19\"><a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">  </span>1f:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span><span class=\"m\">31</span><span class=\"w\"> </span>ff<span class=\"w\">                </span>xor<span class=\"w\">    </span>%rdi,%rdi\n</span><span id=\"__span-6-20\"><a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">  </span><span class=\"m\">22</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span>3c<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x3c,%rax\n</span><span id=\"__span-6-21\"><a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"w\">  </span><span class=\"m\">29</span>:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span></code></pre></div>\n<p>\u867d\u7136\u7edd\u5bf9\u5730\u5740\u65e0\u6cd5\u786e\u5b9a\uff0c\u4f46\u9759\u6001\u94fe\u63a5\u5668\u4f9d\u7136\u53ef\u4ee5\u8ba1\u7b97\u51fa\u76f8\u5bf9\u5730\u5740\u504f\u79fb\uff0c\u5b8c\u6210 relocation \u7684\u8ba1\u7b97\u3002\u91cd\u65b0\u94fe\u63a5\uff0c\u53d1\u73b0\u5b83\u786e\u5b9e\u6210\u529f\u751f\u6210\u4e86\u52a8\u6001\u5e93\uff0c\u4e0d\u518d\u62a5\u9519\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-shared<span class=\"w\"> </span>printer.o<span class=\"w\"> </span>-o<span class=\"w\"> </span>libprinter.so\n</span></code></pre></div>\n<h3 id=\"\u89c2\u5bdf\u52a8\u6001\u5e93\">\u89c2\u5bdf\u52a8\u6001\u5e93<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u52a8\u6001\u5e93\" title=\"Permanent link\">&para;</a></h3>\n<p>\u63a5\u4e0b\u6765\u5c31\u6765\u770b\u770b\u65b0\u751f\u6210\u7684 <code>libprinter.so</code> \u548c\u4e4b\u524d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u9996\u5148\u662f <code>ELF Header</code> \u90e8\u5206\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>$<span class=\"w\"> </span>readelf<span class=\"w\"> </span>-a<span class=\"w\"> </span>libprinter.so\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>ELF<span class=\"w\"> </span>Header:\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">  </span>Magic:<span class=\"w\">   </span>7f<span class=\"w\"> </span><span class=\"m\">45</span><span class=\"w\"> </span>4c<span class=\"w\"> </span><span class=\"m\">46</span><span class=\"w\"> </span><span class=\"m\">02</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">  </span>Class:<span class=\"w\">                             </span>ELF64\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">  </span>Data:<span class=\"w\">                              </span><span class=\"m\">2</span><span class=\"err\">&#39;</span>s<span class=\"w\"> </span>complement,<span class=\"w\"> </span>little<span class=\"w\"> </span>endian\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>current<span class=\"o\">)</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">  </span>OS/ABI:<span class=\"w\">                            </span>UNIX<span class=\"w\"> </span>-<span class=\"w\"> </span>System<span class=\"w\"> </span>V\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">  </span>ABI<span class=\"w\"> </span>Version:<span class=\"w\">                       </span><span class=\"m\">0</span>\n</span><span id=\"__span-8-9\"><a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"w\">  </span>Type:<span class=\"w\">                              </span>DYN<span class=\"w\"> </span><span class=\"o\">(</span>Shared<span class=\"w\"> </span>object<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-8-10\"><a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"w\">  </span>Machine:<span class=\"w\">                           </span>Advanced<span class=\"w\"> </span>Micro<span class=\"w\"> </span>Devices<span class=\"w\"> </span>X86-64\n</span><span id=\"__span-8-11\"><a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span>0x1\n</span><span id=\"__span-8-12\"><a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"w\">  </span>Entry<span class=\"w\"> </span>point<span class=\"w\"> </span>address:<span class=\"w\">               </span>0x0\n</span><span id=\"__span-8-13\"><a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-8-14\"><a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">12584</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-8-15\"><a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">  </span>Flags:<span class=\"w\">                             </span>0x0\n</span><span id=\"__span-8-16\"><a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>this<span class=\"w\"> </span>header:<span class=\"w\">               </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-8-17\"><a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">56</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-8-18\"><a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">6</span>\n</span><span id=\"__span-8-19\"><a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-8-20\"><a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">12</span>\n</span><span id=\"__span-8-21\"><a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a><span class=\"w\">  </span>Section<span class=\"w\"> </span>header<span class=\"w\"> </span>string<span class=\"w\"> </span>table<span class=\"w\"> </span>index:<span class=\"w\"> </span><span class=\"m\">11</span>\n</span></code></pre></div>\n<p>\u548c\u53ef\u6267\u884c\u6587\u4ef6\u7684\u533a\u522b\u5728\u4e8e\uff0c<code>Type</code> \u662f <code>DYN (Shared object file)</code>\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u52a8\u6001\u5e93\u6587\u4ef6\uff1b<code>Entry point address</code> \u7b49\u4e8e\u96f6\uff0c\u56e0\u4e3a\u52a8\u6001\u5e93\u6ca1\u6709\u5165\u53e3\uff0c\u5165\u53e3\u5730\u5740\u8fd8\u662f\u7531\u53ef\u6267\u884c\u7a0b\u5e8f\u63d0\u4f9b\u3002</p>\n<p>\u63a5\u4e0b\u6765\u662f Section \u90e8\u5206\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>Section<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"w\">  </span><span class=\"o\">[</span>Nr<span class=\"o\">]</span><span class=\"w\"> </span>Name<span class=\"w\">              </span>Type<span class=\"w\">             </span>Address<span class=\"w\">           </span>Offset\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">       </span>Size<span class=\"w\">              </span>EntSize<span class=\"w\">          </span>Flags<span class=\"w\">  </span>Link<span class=\"w\">  </span>Info<span class=\"w\">  </span>Align\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"o\">]</span><span class=\"w\">                   </span>NULL<span class=\"w\">             </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000000</span>\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span>\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">]</span><span class=\"w\"> </span>.hash<span class=\"w\">             </span>HASH<span class=\"w\">             </span><span class=\"m\">0000000000000190</span><span class=\"w\">  </span><span class=\"m\">00000190</span>\n</span><span id=\"__span-9-7\"><a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000018</span><span class=\"w\">  </span><span class=\"m\">0000000000000004</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-8\"><a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">]</span><span class=\"w\"> </span>.gnu.hash<span class=\"w\">         </span>GNU_HASH<span class=\"w\">         </span>00000000000001a8<span class=\"w\">  </span>000001a8\n</span><span id=\"__span-9-9\"><a id=\"__codelineno-9-9\" name=\"__codelineno-9-9\" href=\"#__codelineno-9-9\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000028</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-10\"><a id=\"__codelineno-9-10\" name=\"__codelineno-9-10\" href=\"#__codelineno-9-10\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynsym<span class=\"w\">           </span>DYNSYM<span class=\"w\">           </span>00000000000001d0<span class=\"w\">  </span>000001d0\n</span><span id=\"__span-9-11\"><a id=\"__codelineno-9-11\" name=\"__codelineno-9-11\" href=\"#__codelineno-9-11\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000048</span><span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">     </span><span class=\"m\">1</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-12\"><a id=\"__codelineno-9-12\" name=\"__codelineno-9-12\" href=\"#__codelineno-9-12\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynstr<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000218</span><span class=\"w\">  </span><span class=\"m\">00000218</span>\n</span><span id=\"__span-9-13\"><a id=\"__codelineno-9-13\" name=\"__codelineno-9-13\" href=\"#__codelineno-9-13\"></a><span class=\"w\">       </span>000000000000000c<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-9-14\"><a id=\"__codelineno-9-14\" name=\"__codelineno-9-14\" href=\"#__codelineno-9-14\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"o\">]</span><span class=\"w\"> </span>.text<span class=\"w\">             </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000001000</span><span class=\"w\">  </span><span class=\"m\">00001000</span>\n</span><span id=\"__span-9-15\"><a id=\"__codelineno-9-15\" name=\"__codelineno-9-15\" href=\"#__codelineno-9-15\"></a><span class=\"w\">       </span>000000000000002b<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>AX<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-9-16\"><a id=\"__codelineno-9-16\" name=\"__codelineno-9-16\" href=\"#__codelineno-9-16\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">6</span><span class=\"o\">]</span><span class=\"w\"> </span>.rodata<span class=\"w\">           </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000002000</span><span class=\"w\">  </span><span class=\"m\">00002000</span>\n</span><span id=\"__span-9-17\"><a id=\"__codelineno-9-17\" name=\"__codelineno-9-17\" href=\"#__codelineno-9-17\"></a><span class=\"w\">       </span>000000000000000e<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-9-18\"><a id=\"__codelineno-9-18\" name=\"__codelineno-9-18\" href=\"#__codelineno-9-18\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">7</span><span class=\"o\">]</span><span class=\"w\"> </span>.eh_frame<span class=\"w\">         </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000002010</span><span class=\"w\">  </span><span class=\"m\">00002010</span>\n</span><span id=\"__span-9-19\"><a id=\"__codelineno-9-19\" name=\"__codelineno-9-19\" href=\"#__codelineno-9-19\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-20\"><a id=\"__codelineno-9-20\" name=\"__codelineno-9-20\" href=\"#__codelineno-9-20\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">8</span><span class=\"o\">]</span><span class=\"w\"> </span>.dynamic<span class=\"w\">          </span>DYNAMIC<span class=\"w\">          </span>0000000000003f40<span class=\"w\">  </span>00002f40\n</span><span id=\"__span-9-21\"><a id=\"__codelineno-9-21\" name=\"__codelineno-9-21\" href=\"#__codelineno-9-21\"></a><span class=\"w\">       </span>00000000000000c0<span class=\"w\">  </span><span class=\"m\">0000000000000010</span><span class=\"w\">  </span>WA<span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-22\"><a id=\"__codelineno-9-22\" name=\"__codelineno-9-22\" href=\"#__codelineno-9-22\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">9</span><span class=\"o\">]</span><span class=\"w\"> </span>.symtab<span class=\"w\">           </span>SYMTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00003000</span>\n</span><span id=\"__span-9-23\"><a id=\"__codelineno-9-23\" name=\"__codelineno-9-23\" href=\"#__codelineno-9-23\"></a><span class=\"w\">       </span>00000000000000a8<span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">          </span><span class=\"m\">10</span><span class=\"w\">     </span><span class=\"m\">5</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-9-24\"><a id=\"__codelineno-9-24\" name=\"__codelineno-9-24\" href=\"#__codelineno-9-24\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">10</span><span class=\"o\">]</span><span class=\"w\"> </span>.strtab<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000030a8\n</span><span id=\"__span-9-25\"><a id=\"__codelineno-9-25\" name=\"__codelineno-9-25\" href=\"#__codelineno-9-25\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000025</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-9-26\"><a id=\"__codelineno-9-26\" name=\"__codelineno-9-26\" href=\"#__codelineno-9-26\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"m\">11</span><span class=\"o\">]</span><span class=\"w\"> </span>.shstrtab<span class=\"w\">         </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000030cd\n</span><span id=\"__span-9-27\"><a id=\"__codelineno-9-27\" name=\"__codelineno-9-27\" href=\"#__codelineno-9-27\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000056</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-9-28\"><a id=\"__codelineno-9-28\" name=\"__codelineno-9-28\" href=\"#__codelineno-9-28\"></a>Key<span class=\"w\"> </span>to<span class=\"w\"> </span>Flags:\n</span><span id=\"__span-9-29\"><a id=\"__codelineno-9-29\" name=\"__codelineno-9-29\" href=\"#__codelineno-9-29\"></a><span class=\"w\">  </span>W<span class=\"w\"> </span><span class=\"o\">(</span>write<span class=\"o\">)</span>,<span class=\"w\"> </span>A<span class=\"w\"> </span><span class=\"o\">(</span>alloc<span class=\"o\">)</span>,<span class=\"w\"> </span>X<span class=\"w\"> </span><span class=\"o\">(</span>execute<span class=\"o\">)</span>,<span class=\"w\"> </span>M<span class=\"w\"> </span><span class=\"o\">(</span>merge<span class=\"o\">)</span>,<span class=\"w\"> </span>S<span class=\"w\"> </span><span class=\"o\">(</span>strings<span class=\"o\">)</span>,<span class=\"w\"> </span>I<span class=\"w\"> </span><span class=\"o\">(</span>info<span class=\"o\">)</span>,\n</span><span id=\"__span-9-30\"><a id=\"__codelineno-9-30\" name=\"__codelineno-9-30\" href=\"#__codelineno-9-30\"></a><span class=\"w\">  </span>L<span class=\"w\"> </span><span class=\"o\">(</span>link<span class=\"w\"> </span>order<span class=\"o\">)</span>,<span class=\"w\"> </span>O<span class=\"w\"> </span><span class=\"o\">(</span>extra<span class=\"w\"> </span>OS<span class=\"w\"> </span>processing<span class=\"w\"> </span>required<span class=\"o\">)</span>,<span class=\"w\"> </span>G<span class=\"w\"> </span><span class=\"o\">(</span>group<span class=\"o\">)</span>,<span class=\"w\"> </span>T<span class=\"w\"> </span><span class=\"o\">(</span>TLS<span class=\"o\">)</span>,\n</span><span id=\"__span-9-31\"><a id=\"__codelineno-9-31\" name=\"__codelineno-9-31\" href=\"#__codelineno-9-31\"></a><span class=\"w\">  </span>C<span class=\"w\"> </span><span class=\"o\">(</span>compressed<span class=\"o\">)</span>,<span class=\"w\"> </span>x<span class=\"w\"> </span><span class=\"o\">(</span>unknown<span class=\"o\">)</span>,<span class=\"w\"> </span>o<span class=\"w\"> </span><span class=\"o\">(</span>OS<span class=\"w\"> </span>specific<span class=\"o\">)</span>,<span class=\"w\"> </span>E<span class=\"w\"> </span><span class=\"o\">(</span>exclude<span class=\"o\">)</span>,\n</span><span id=\"__span-9-32\"><a id=\"__codelineno-9-32\" name=\"__codelineno-9-32\" href=\"#__codelineno-9-32\"></a><span class=\"w\">  </span>D<span class=\"w\"> </span><span class=\"o\">(</span>mbind<span class=\"o\">)</span>,<span class=\"w\"> </span>l<span class=\"w\"> </span><span class=\"o\">(</span>large<span class=\"o\">)</span>,<span class=\"w\"> </span>p<span class=\"w\"> </span><span class=\"o\">(</span>processor<span class=\"w\"> </span>specific<span class=\"o\">)</span>\n</span><span id=\"__span-9-33\"><a id=\"__codelineno-9-33\" name=\"__codelineno-9-33\" href=\"#__codelineno-9-33\"></a>\n</span><span id=\"__span-9-34\"><a id=\"__codelineno-9-34\" name=\"__codelineno-9-34\" href=\"#__codelineno-9-34\"></a>There<span class=\"w\"> </span>are<span class=\"w\"> </span>no<span class=\"w\"> </span>section<span class=\"w\"> </span>groups<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>this<span class=\"w\"> </span>file.\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u89c2\u5bdf\u5230\u591a\u4e86\u51e0\u4e2a\u6ca1\u6709\u89c1\u5230\u8fc7\u7684 section\uff0c\u8fd9\u91cc\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u540e\u9762\u4f1a\u8be6\u7ec6\u89e3\u91ca\uff1a</p>\n<ol>\n<li><code>.hash</code> \u548c <code>.gnu.hash</code>\uff1a\u4ece\u540d\u5b57\u53ef\u4ee5\u731c\u51fa\u6765\uff0c\u8fd9\u662f\u67d0\u79cd\u54c8\u5e0c\u8868\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u63d0\u4f9b\u4e00\u4e2a\u7b26\u53f7\u540d\u5b57\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff0c\u63d0\u9ad8\u52a8\u6001\u94fe\u63a5\u5668\u67e5\u627e\u7b26\u53f7\u7684\u6027\u80fd</li>\n<li><code>.dynsym</code>\uff1aDynamic Symbol\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u52a8\u6001\u7b26\u53f7\u8868</li>\n<li><code>.dynstr</code>\uff1aDynamic String\uff0c\u548c\u52a8\u6001\u94fe\u63a5\u6709\u5173\u7684\u5b57\u7b26\u4e32\u7684\u8868</li>\n<li><code>.dynamic</code>\uff1aDynamic\uff0c\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fe1\u606f</li>\n</ol>\n<p>\u6b64\u5916\uff0c\u8fd9\u4e9b\u6bb5\u7684\u5730\u5740\u90fd\u4ece 0 \u5f00\u59cb\uff0c\u800c\u4e0d\u662f\u53ef\u6267\u884c\u6587\u4ef6\u90a3\u6837\uff0c\u4ece 0x400000 \u5f00\u59cb\uff0c\u6bd5\u7adf\u52a8\u6001\u5e93\u662f\u53ef\u80fd\u88ab\u52a0\u8f7d\u5230\u4e0d\u540c\u5730\u5740\u4e0a\u7684\uff0c\u662f\u6ca1\u529e\u6cd5\u63d0\u524d\u786e\u5b9a\u7684\u3002</p>\n<p>\u63a5\u4e0b\u6765\u662f Program Header \u90e8\u5206\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"nf\">Program</span><span class=\"w\"> </span><span class=\"no\">Headers</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"w\">  </span><span class=\"nf\">Type</span><span class=\"w\">           </span><span class=\"no\">Offset</span><span class=\"w\">             </span><span class=\"no\">VirtAddr</span><span class=\"w\">           </span><span class=\"no\">PhysAddr</span>\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">                 </span><span class=\"nf\">FileSiz</span><span class=\"w\">            </span><span class=\"no\">MemSiz</span><span class=\"w\">              </span><span class=\"no\">Flags</span><span class=\"w\">  </span><span class=\"no\">Align</span>\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">  </span><span class=\"nf\">LOAD</span><span class=\"w\">           </span><span class=\"mi\">0x0000000000000000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000000000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000000000</span>\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x0000000000000224</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000000224</span><span class=\"w\">  </span><span class=\"no\">R</span><span class=\"w\">      </span><span class=\"mi\">0x1000</span>\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"w\">  </span><span class=\"nf\">LOAD</span><span class=\"w\">           </span><span class=\"mi\">0x0000000000001000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000001000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000001000</span>\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x000000000000002b</span><span class=\"w\"> </span><span class=\"mi\">0x000000000000002b</span><span class=\"w\">  </span><span class=\"no\">R</span><span class=\"w\"> </span><span class=\"no\">E</span><span class=\"w\">    </span><span class=\"mi\">0x1000</span>\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">  </span><span class=\"nf\">LOAD</span><span class=\"w\">           </span><span class=\"mi\">0x0000000000002000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000002000</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000002000</span>\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x0000000000000010</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000000010</span><span class=\"w\">  </span><span class=\"no\">R</span><span class=\"w\">      </span><span class=\"mi\">0x1000</span>\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"w\">  </span><span class=\"nf\">LOAD</span><span class=\"w\">           </span><span class=\"mi\">0x0000000000002f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span>\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x00000000000000c0</span><span class=\"w\"> </span><span class=\"mi\">0x00000000000000c0</span><span class=\"w\">  </span><span class=\"no\">RW</span><span class=\"w\">     </span><span class=\"mi\">0x1000</span>\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a><span class=\"w\">  </span><span class=\"nf\">DYNAMIC</span><span class=\"w\">        </span><span class=\"mi\">0x0000000000002f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span>\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x00000000000000c0</span><span class=\"w\"> </span><span class=\"mi\">0x00000000000000c0</span><span class=\"w\">  </span><span class=\"no\">RW</span><span class=\"w\">     </span><span class=\"mi\">0x8</span>\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">  </span><span class=\"nf\">GNU_RELRO</span><span class=\"w\">      </span><span class=\"mi\">0x0000000000002f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span><span class=\"w\"> </span><span class=\"mi\">0x0000000000003f40</span>\n</span><span id=\"__span-10-15\"><a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a><span class=\"w\">                 </span><span class=\"err\">0</span><span class=\"nf\">x00000000000000c0</span><span class=\"w\"> </span><span class=\"mi\">0x00000000000000c0</span><span class=\"w\">  </span><span class=\"no\">R</span><span class=\"w\">      </span><span class=\"mi\">0x1</span>\n</span><span id=\"__span-10-16\"><a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a>\n</span><span id=\"__span-10-17\"><a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\"> </span><span class=\"nf\">Section</span><span class=\"w\"> </span><span class=\"no\">to</span><span class=\"w\"> </span><span class=\"no\">Segment</span><span class=\"w\"> </span><span class=\"no\">mapping</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-18\"><a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">  </span><span class=\"nf\">Segment</span><span class=\"w\"> </span><span class=\"no\">Sections...</span>\n</span><span id=\"__span-10-19\"><a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"w\">   </span><span class=\"err\">00</span><span class=\"w\">     </span><span class=\"na\">.hash</span><span class=\"w\"> </span><span class=\"no\">.gnu.hash</span><span class=\"w\"> </span><span class=\"no\">.dynsym</span><span class=\"w\"> </span><span class=\"no\">.dynstr</span><span class=\"w\"> </span>\n</span><span id=\"__span-10-20\"><a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a><span class=\"w\">   </span><span class=\"mi\">01</span><span class=\"w\">     </span><span class=\"no\">.text</span><span class=\"w\"> </span>\n</span><span id=\"__span-10-21\"><a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">   </span><span class=\"mi\">02</span><span class=\"w\">     </span><span class=\"no\">.rodata</span><span class=\"w\"> </span>\n</span><span id=\"__span-10-22\"><a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\" href=\"#__codelineno-10-22\"></a><span class=\"w\">   </span><span class=\"mi\">03</span><span class=\"w\">     </span><span class=\"no\">.dynamic</span><span class=\"w\"> </span>\n</span><span id=\"__span-10-23\"><a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\" href=\"#__codelineno-10-23\"></a><span class=\"w\">   </span><span class=\"mi\">04</span><span class=\"w\">     </span><span class=\"no\">.dynamic</span><span class=\"w\"> </span>\n</span><span id=\"__span-10-24\"><a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\" href=\"#__codelineno-10-24\"></a><span class=\"w\">   </span><span class=\"mi\">05</span><span class=\"w\">     </span><span class=\"no\">.dynamic</span><span class=\"w\"> </span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86\u5df2\u6709\u7684 <code>LOAD</code> \u4ee5\u5916\uff0c\u8fd8\u51fa\u73b0\u4e86\u65b0\u7684\u9879\u76ee\uff1a</p>\n<ol>\n<li><code>DYNAMIC</code>\uff1a\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c<code>.dynamic</code> section \u5728\u54ea\u4e2a\u5730\u65b9</li>\n<li><code>GNU_RELRO</code>\uff1a\u8fd9\u662f GNU \u94fe\u63a5\u5668\u5b89\u5168\u6027\u6269\u5c55\uff0c\u610f\u601d\u662f\u5728\u52a8\u6001\u94fe\u63a5\u5668\u5b8c\u6210\u91cd\u5b9a\u4f4d\u540e\uff0c\u54ea\u4e9b\u5185\u5b58\u533a\u57df\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff0c\u9632\u6b62\u7a0b\u5e8f\u7be1\u6539</li>\n</ol>\n<p>\u7d27\u63a5\u7740\u5c31\u662f <code>.dynamic</code> section \u7684\u5185\u5bb9\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a>Dynamic<span class=\"w\"> </span>section<span class=\"w\"> </span>at<span class=\"w\"> </span>offset<span class=\"w\"> </span>0x2f40<span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">7</span><span class=\"w\"> </span>entries:\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"w\">  </span>Tag<span class=\"w\">        </span>Type<span class=\"w\">                         </span>Name/Value\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"w\"> </span>0x0000000000000004<span class=\"w\"> </span><span class=\"o\">(</span>HASH<span class=\"o\">)</span><span class=\"w\">               </span>0x190\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"w\"> </span>0x000000006ffffef5<span class=\"w\"> </span><span class=\"o\">(</span>GNU_HASH<span class=\"o\">)</span><span class=\"w\">           </span>0x1a8\n</span><span id=\"__span-11-5\"><a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a><span class=\"w\"> </span>0x0000000000000005<span class=\"w\"> </span><span class=\"o\">(</span>STRTAB<span class=\"o\">)</span><span class=\"w\">             </span>0x218\n</span><span id=\"__span-11-6\"><a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a><span class=\"w\"> </span>0x0000000000000006<span class=\"w\"> </span><span class=\"o\">(</span>SYMTAB<span class=\"o\">)</span><span class=\"w\">             </span>0x1d0\n</span><span id=\"__span-11-7\"><a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a><span class=\"w\"> </span>0x000000000000000a<span class=\"w\"> </span><span class=\"o\">(</span>STRSZ<span class=\"o\">)</span><span class=\"w\">              </span><span class=\"m\">12</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-11-8\"><a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a><span class=\"w\"> </span>0x000000000000000b<span class=\"w\"> </span><span class=\"o\">(</span>SYMENT<span class=\"o\">)</span><span class=\"w\">             </span><span class=\"m\">24</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-11-9\"><a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a><span class=\"w\"> </span>0x0000000000000000<span class=\"w\"> </span><span class=\"o\">(</span>NULL<span class=\"o\">)</span><span class=\"w\">               </span>0x0\n</span></code></pre></div>\n<p>\u8868\u793a\u8fd9\u4e2a\u52a8\u6001\u5e93\u5411\u52a8\u6001\u94fe\u63a5\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4f1a\u5728\u52a8\u6001\u94fe\u63a5\u4e2d\u7528\u5230\u7684\u4fe1\u606f\uff1a</p>\n<ol>\n<li><code>HASH</code>\uff1a<code>.hash</code> section \u7684\u5730\u5740</li>\n<li><code>GNU_HASH</code>\uff1a<code>.gnu.hash</code> section \u7684\u5730\u5740</li>\n<li><code>STRTAB</code>: <code>.dynstr</code> section \u7684\u5730\u5740</li>\n<li><code>SYMTAB</code>: <code>.dynsym</code> section \u7684\u5730\u5740</li>\n<li><code>STRSZ</code>: <code>.dynstr</code> section \u7684\u5927\u5c0f</li>\n<li><code>SYMENT</code>: <code>.dynsym</code> \u6bcf\u4e00\u9879\u7684\u5927\u5c0f</li>\n<li><code>NULL</code>: \u8868\u793a\u540e\u9762\u6ca1\u6709\u66f4\u591a\u5185\u5bb9\u4e86</li>\n</ol>\n<p>\u4f60\u53ef\u80fd\u4f1a\u5947\u602a\uff0c\u8fd9\u91cc\u9762\u7684\u5730\u5740\u548c\u5927\u5c0f\u4fe1\u606f\uff0c\u5176\u5b9e\u90fd\u53ef\u4ee5\u4ece Section Headers \u91cc\u627e\u5230\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u591a\u6b64\u4e00\u4e3e\uff0c\u653e\u5230\u8fd9\u91cc\u5462\uff1f\u9996\u5148\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5b58\u7684\u4e1c\u897f\u8fd8\u6709\u5f88\u591a\uff0c\u4e0d\u6b62\u662f\u8fd9\u4e9b\uff0c\u540e\u7eed\u4f1a\u770b\u5230\u66f4\u591a\u7684\u4f8b\u5b50\uff08\u4f8b\u5982 <code>DT_NEEDED</code>\uff0c<code>DT_SONAME</code>\uff0c<code>DT_RPATH</code> \u7b49\u7b49\uff09\uff1b\u5176\u6b21\uff0c\u524d\u6587\u63d0\u5230\uff0c\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\u8981\u6c42\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u4e3a\u4e86\u51cf\u5c11\u5b83\u89e3\u6790 ELF \u7684\u8d1f\u62c5\uff0c\u63d0\u524d\u628a\u8981\u7528\u7684\u6570\u636e\u51c6\u5907\u597d\u3002</p>\n<p>\u4e0b\u9762\u662f relocation \u7684\u90e8\u5206\uff0c\u4e0d\u51fa\u610f\u6599\uff0c\u6ca1\u6709 relocation\uff0c\u56e0\u4e3a\u9759\u6001\u94fe\u63a5\u5668\u5df2\u7ecf\u628a <code>printer.s</code> \u91cc\u6d89\u53ca\u5230\u7684 relocation \u90fd\u8ba1\u7b97\u5b8c\u6210\u4e86\u3002</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-12-1\"><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a>There<span class=\"w\"> </span>are<span class=\"w\"> </span>no<span class=\"w\"> </span>relocations<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>this<span class=\"w\"> </span>file.\n</span><span id=\"__span-12-2\"><a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a>No<span class=\"w\"> </span>processor<span class=\"w\"> </span>specific<span class=\"w\"> </span>unwind<span class=\"w\"> </span>information<span class=\"w\"> </span>to<span class=\"w\"> </span>decode\n</span></code></pre></div>\n<p>\u63a5\u4e0b\u6765\u662f\u7b26\u53f7\u8868\uff0c\u6709\u4e24\u4efd\uff0c<code>.dynsym</code> \u662f\u52a8\u6001\u7b26\u53f7\u8868\uff0c<code>.symtab</code> \u662f\u539f\u6765\u9759\u6001\u94fe\u63a5\u4f7f\u7528\u7684\u7b26\u53f7\u8868\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-13-1\"><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\" href=\"#__codelineno-13-1\"></a>Symbol<span class=\"w\"> </span>table<span class=\"w\"> </span><span class=\"s1\">&#39;.dynsym&#39;</span><span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span>entries:\n</span><span id=\"__span-13-2\"><a id=\"__codelineno-13-2\" name=\"__codelineno-13-2\" href=\"#__codelineno-13-2\"></a><span class=\"w\">   </span>Num:<span class=\"w\">    </span>Value<span class=\"w\">          </span>Size<span class=\"w\"> </span>Type<span class=\"w\">    </span>Bind<span class=\"w\">   </span>Vis<span class=\"w\">      </span>Ndx<span class=\"w\"> </span>Name\n</span><span id=\"__span-13-3\"><a id=\"__codelineno-13-3\" name=\"__codelineno-13-3\" href=\"#__codelineno-13-3\"></a><span class=\"w\">     </span><span class=\"m\">0</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">  </span>UND<span class=\"w\"> </span>\n</span><span id=\"__span-13-4\"><a id=\"__codelineno-13-4\" name=\"__codelineno-13-4\" href=\"#__codelineno-13-4\"></a><span class=\"w\">     </span><span class=\"m\">1</span>:<span class=\"w\"> </span><span class=\"m\">0000000000001000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>GLOBAL<span class=\"w\"> </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span>print\n</span><span id=\"__span-13-5\"><a id=\"__codelineno-13-5\" name=\"__codelineno-13-5\" href=\"#__codelineno-13-5\"></a><span class=\"w\">     </span><span class=\"m\">2</span>:<span class=\"w\"> </span>000000000000101f<span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>GLOBAL<span class=\"w\"> </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"nb\">exit</span>\n</span><span id=\"__span-13-6\"><a id=\"__codelineno-13-6\" name=\"__codelineno-13-6\" href=\"#__codelineno-13-6\"></a>\n</span><span id=\"__span-13-7\"><a id=\"__codelineno-13-7\" name=\"__codelineno-13-7\" href=\"#__codelineno-13-7\"></a>Symbol<span class=\"w\"> </span>table<span class=\"w\"> </span><span class=\"s1\">&#39;.symtab&#39;</span><span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">7</span><span class=\"w\"> </span>entries:\n</span><span id=\"__span-13-8\"><a id=\"__codelineno-13-8\" name=\"__codelineno-13-8\" href=\"#__codelineno-13-8\"></a><span class=\"w\">   </span>Num:<span class=\"w\">    </span>Value<span class=\"w\">          </span>Size<span class=\"w\"> </span>Type<span class=\"w\">    </span>Bind<span class=\"w\">   </span>Vis<span class=\"w\">      </span>Ndx<span class=\"w\"> </span>Name\n</span><span id=\"__span-13-9\"><a id=\"__codelineno-13-9\" name=\"__codelineno-13-9\" href=\"#__codelineno-13-9\"></a><span class=\"w\">     </span><span class=\"m\">0</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">  </span>UND<span class=\"w\"> </span>\n</span><span id=\"__span-13-10\"><a id=\"__codelineno-13-10\" name=\"__codelineno-13-10\" href=\"#__codelineno-13-10\"></a><span class=\"w\">     </span><span class=\"m\">1</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>FILE<span class=\"w\">    </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">  </span>ABS<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-13-11\"><a id=\"__codelineno-13-11\" name=\"__codelineno-13-11\" href=\"#__codelineno-13-11\"></a><span class=\"w\">     </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"m\">0000000000002000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">6</span><span class=\"w\"> </span>hello\n</span><span id=\"__span-13-12\"><a id=\"__codelineno-13-12\" name=\"__codelineno-13-12\" href=\"#__codelineno-13-12\"></a><span class=\"w\">     </span><span class=\"m\">3</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>FILE<span class=\"w\">    </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">  </span>ABS<span class=\"w\"> </span>\n</span><span id=\"__span-13-13\"><a id=\"__codelineno-13-13\" name=\"__codelineno-13-13\" href=\"#__codelineno-13-13\"></a><span class=\"w\">     </span><span class=\"m\">4</span>:<span class=\"w\"> </span>0000000000003f40<span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>OBJECT<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">8</span><span class=\"w\"> </span>_DYNAMIC\n</span><span id=\"__span-13-14\"><a id=\"__codelineno-13-14\" name=\"__codelineno-13-14\" href=\"#__codelineno-13-14\"></a><span class=\"w\">     </span><span class=\"m\">5</span>:<span class=\"w\"> </span><span class=\"m\">0000000000001000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>GLOBAL<span class=\"w\"> </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span>print\n</span><span id=\"__span-13-15\"><a id=\"__codelineno-13-15\" name=\"__codelineno-13-15\" href=\"#__codelineno-13-15\"></a><span class=\"w\">     </span><span class=\"m\">6</span>:<span class=\"w\"> </span>000000000000101f<span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>GLOBAL<span class=\"w\"> </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"nb\">exit</span>\n</span></code></pre></div>\n<p>\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c<code>.dynsym</code> \u53ea\u4fdd\u7559\u4e86\u90a3\u4e9b\u5916\u90e8\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u7b26\u53f7\uff08<code>Bind=GLOBAL</code>\uff09\uff0c\u4e5f\u5c31\u662f <code>print</code> \u548c <code>exit</code>\uff0c\u800c\u5185\u90e8\u81ea\u5df1\u7528\u7684 <code>hello</code> \u6ca1\u6709\u653e\u5728\u91cc\u9762\uff0c\u53ea\u4fdd\u7559\u53ef\u80fd\u8981\u7528\u5230\u7684\u4e1c\u897f\uff0c\u7ed9\u52a8\u6001\u94fe\u63a5\u5668\u51cf\u8d1f\u3002\u6b64\u5916\uff0c<code>.symtab</code> \u8fd8\u4f1a\u591a\u51fa\u4e00\u4e2a <code>_DYNAMIC</code> \u7b26\u53f7\uff0c\u6307\u5411 <code>.dynamic</code> section\u3002</p>\n<p>\u6700\u540e\uff0c<code>readelf</code> \u8fd8\u8d34\u5fc3\u5730\u8ba1\u7b97\u4e86\u4e00\u4e0b\u54c8\u5e0c\u8868\u7684\u5e73\u5747\u67e5\u8be2\u6b21\u6570\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-14-1\"><a id=\"__codelineno-14-1\" name=\"__codelineno-14-1\" href=\"#__codelineno-14-1\"></a>Histogram<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>bucket<span class=\"w\"> </span>list<span class=\"w\"> </span>length<span class=\"w\"> </span><span class=\"o\">(</span>total<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span>bucket<span class=\"o\">)</span>:\n</span><span id=\"__span-14-2\"><a id=\"__codelineno-14-2\" name=\"__codelineno-14-2\" href=\"#__codelineno-14-2\"></a><span class=\"w\"> </span>Length<span class=\"w\">  </span>Number<span class=\"w\">     </span>%<span class=\"w\"> </span>of<span class=\"w\"> </span>total<span class=\"w\">  </span>Coverage\n</span><span id=\"__span-14-3\"><a id=\"__codelineno-14-3\" name=\"__codelineno-14-3\" href=\"#__codelineno-14-3\"></a><span class=\"w\">      </span><span class=\"m\">0</span><span class=\"w\">  </span><span class=\"m\">0</span><span class=\"w\">          </span><span class=\"o\">(</span><span class=\"w\">  </span><span class=\"m\">0</span>.0%<span class=\"o\">)</span>\n</span><span id=\"__span-14-4\"><a id=\"__codelineno-14-4\" name=\"__codelineno-14-4\" href=\"#__codelineno-14-4\"></a><span class=\"w\">      </span><span class=\"m\">1</span><span class=\"w\">  </span><span class=\"m\">0</span><span class=\"w\">          </span><span class=\"o\">(</span><span class=\"w\">  </span><span class=\"m\">0</span>.0%<span class=\"o\">)</span><span class=\"w\">      </span><span class=\"m\">0</span>.0%\n</span><span id=\"__span-14-5\"><a id=\"__codelineno-14-5\" name=\"__codelineno-14-5\" href=\"#__codelineno-14-5\"></a><span class=\"w\">      </span><span class=\"m\">2</span><span class=\"w\">  </span><span class=\"m\">1</span><span class=\"w\">          </span><span class=\"o\">(</span><span class=\"m\">100</span>.0%<span class=\"o\">)</span><span class=\"w\">    </span><span class=\"m\">100</span>.0%\n</span><span id=\"__span-14-6\"><a id=\"__codelineno-14-6\" name=\"__codelineno-14-6\" href=\"#__codelineno-14-6\"></a>\n</span><span id=\"__span-14-7\"><a id=\"__codelineno-14-7\" name=\"__codelineno-14-7\" href=\"#__codelineno-14-7\"></a>Histogram<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"sb\">`</span>.gnu.hash<span class=\"err\">&#39;</span><span class=\"w\"> </span>bucket<span class=\"w\"> </span>list<span class=\"w\"> </span>length<span class=\"w\"> </span><span class=\"o\">(</span>total<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span>buckets<span class=\"o\">)</span>:\n</span><span id=\"__span-14-8\"><a id=\"__codelineno-14-8\" name=\"__codelineno-14-8\" href=\"#__codelineno-14-8\"></a><span class=\"w\"> </span>Length<span class=\"w\">  </span>Number<span class=\"w\">     </span>%<span class=\"w\"> </span>of<span class=\"w\"> </span>total<span class=\"w\">  </span>Coverage\n</span><span id=\"__span-14-9\"><a id=\"__codelineno-14-9\" name=\"__codelineno-14-9\" href=\"#__codelineno-14-9\"></a><span class=\"w\">      </span><span class=\"m\">0</span><span class=\"w\">  </span><span class=\"m\">0</span><span class=\"w\">          </span><span class=\"o\">(</span><span class=\"w\">  </span><span class=\"m\">0</span>.0%<span class=\"o\">)</span>\n</span><span id=\"__span-14-10\"><a id=\"__codelineno-14-10\" name=\"__codelineno-14-10\" href=\"#__codelineno-14-10\"></a><span class=\"w\">      </span><span class=\"m\">1</span><span class=\"w\">  </span><span class=\"m\">2</span><span class=\"w\">          </span><span class=\"o\">(</span><span class=\"m\">100</span>.0%<span class=\"o\">)</span><span class=\"w\">    </span><span class=\"m\">100</span>.0%\n</span><span id=\"__span-14-11\"><a id=\"__codelineno-14-11\" name=\"__codelineno-14-11\" href=\"#__codelineno-14-11\"></a>\n</span><span id=\"__span-14-12\"><a id=\"__codelineno-14-12\" name=\"__codelineno-14-12\" href=\"#__codelineno-14-12\"></a>No<span class=\"w\"> </span>version<span class=\"w\"> </span>information<span class=\"w\"> </span>found<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>this<span class=\"w\"> </span>file.\n</span></code></pre></div>\n<p>\u540e\u9762\u4f1a\u518d\u7ec6\u8bb2\u4e00\u4e0b\u5b83\u6240\u91c7\u7528\u7684\u54c8\u5e0c\u8868\u7684\u67b6\u6784\u3002</p>\n<p>\u7ed3\u5408\u4e0a\u9762\u7684\u89c2\u5bdf\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u521d\u6b65\u7684\u5370\u8c61\uff0c\u6bd4\u8f83\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u4e0e\u751f\u6210\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u533a\u522b\uff1a</p>\n<ol>\n<li>ELF \u6587\u4ef6\u7c7b\u578b\u4e0d\u540c\uff0cDYN (Shared object file) vs EXEC (Executable file)</li>\n<li>\u52a8\u6001\u5e93\u6709\u989d\u5916\u7684\u4e00\u5957\u7528\u4e8e\u52a8\u6001\u94fe\u63a5\u7684 section\uff0c\u5305\u62ec\u52a8\u6001\u7684\u7b26\u53f7\u8868\uff0c\u52a8\u6001\u7684\u5b57\u7b26\u4e32\u8868\uff0c\u52a8\u6001\u8868\uff08<code>.dynamic</code>\uff09\uff0c\u4ee5\u53ca\u54c8\u5e0c\u8868\uff08\u5b9e\u73b0\u7b26\u53f7\u540d\u79f0\u5230\u7b26\u53f7\u7684\u6620\u5c04\uff09</li>\n<li>\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u5730\u5740\u4e0d\u786e\u5b9a\uff0c\u5728 ELF \u4e2d\u4ece 0 \u5f00\u59cb\u8ba1\u7b97\uff0c\u9700\u8981\u5730\u5740\u65e0\u5173\u4ee3\u7801</li>\n</ol>\n<h3 id=\"\u4f7f\u7528\u52a8\u6001\u5e93\">\u4f7f\u7528\u52a8\u6001\u5e93<a class=\"headerlink\" href=\"#\u4f7f\u7528\u52a8\u6001\u5e93\" title=\"Permanent link\">&para;</a></h3>\n<p>\u751f\u6210\u52a8\u6001\u5e93 <code>libprinter.so</code> \u4ee5\u540e\uff0c\u6700\u540e\u8fd8\u9700\u8981\u8ba9 <code>main.o</code> \u52a8\u6001\u94fe\u63a5 <code>libprinter.so</code>\uff0c\u5e76\u8fd0\u884c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-15-1\"><a id=\"__codelineno-15-1\" name=\"__codelineno-15-1\" href=\"#__codelineno-15-1\"></a><span class=\"c1\"># ld -dynamic-linker: Set path to dynamic linker for the executable</span>\n</span><span id=\"__span-15-2\"><a id=\"__codelineno-15-2\" name=\"__codelineno-15-2\" href=\"#__codelineno-15-2\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>-dynamic-linker<span class=\"w\"> </span>/lib64/ld-linux-x86-64.so.2<span class=\"w\"> </span>main.o<span class=\"w\"> </span>libprinter.so<span class=\"w\"> </span>-o<span class=\"w\"> </span>main\n</span><span id=\"__span-15-3\"><a id=\"__codelineno-15-3\" name=\"__codelineno-15-3\" href=\"#__codelineno-15-3\"></a>$<span class=\"w\"> </span><span class=\"nv\">LD_LIBRARY_PATH</span><span class=\"o\">=</span><span class=\"nv\">$PWD</span><span class=\"w\"> </span>./main\n</span><span id=\"__span-15-4\"><a id=\"__codelineno-15-4\" name=\"__codelineno-15-4\" href=\"#__codelineno-15-4\"></a>Hello<span class=\"w\"> </span>world!\n</span></code></pre></div>\n<p>\u8fd9\u91cc\u7279\u522b\u6307\u5b9a\u4e86 <code>main</code> \u7684\u52a8\u6001\u94fe\u63a5\u5668\u8def\u5f84\u4e3a <code>/lib64/ld-linux-x86-64.so.2</code>\uff0c\u8fd9\u662f\u56e0\u4e3a <code>main</code> \u5728\u542f\u52a8\u65f6\uff0c\u9700\u8981\u7531\u52a8\u6001\u94fe\u63a5\u5668\u6765\u5b8c\u6210\u6700\u540e\u7684\u52a8\u6001\u94fe\u63a5\uff0c\u90a3\u4e48\u7528\u54ea\u4e2a\u52a8\u6001\u94fe\u63a5\u5668\u53bb\u505a\u8fd9\u4e2a\u4e8b\u60c5\u5462\uff1f\u8fd9\u91cc\u5c31\u662f\u5728\u6307\u5b9a\u52a8\u6001\u94fe\u63a5\u5668\u7684\u8def\u5f84\u3002\u542f\u52a8 <code>main</code> \u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u8ba9\u52a8\u6001\u94fe\u63a5\u5668\u627e\u5230\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 <code>libprinter.so</code>\uff0c\u6dfb\u52a0\u4e86\u73af\u5883\u53d8\u91cf <code>LD_LIBRARY_PATH</code> \u5e76\u8bbe\u7f6e\u4e3a\u5f53\u524d\u76ee\u5f55\u3002\u8fd9\u6837 <code>main</code> \u7a0b\u5e8f\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u8d77\u6765\u4e86\u3002</p>\n<p>\u867d\u7136 <code>libprinter.so</code> \u51fa\u73b0\u5728\u4e86 <code>ld</code> \u7684\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\uff0c\u4f46\u5e76\u4e0d\u4ee3\u8868\u5b83\u7684\u5185\u5bb9\u4f1a\u88ab\u9759\u6001\u94fe\u63a5\u5230 <code>main</code> \u5f53\u4e2d\uff1a\u5b9e\u9645\u4e0a\uff0c\u9759\u6001\u94fe\u63a5\u5668\u4f1a\u4ee5\u67d0\u79cd\u5f62\u5f0f\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u5728 <code>main</code> \u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u5982\u4f55\u53bb\u52a8\u6001\u94fe\u63a5 <code>libprinter.so</code>\u3002\u8fd9\u4e2a\u5177\u4f53\u5f62\u5f0f\uff0c\u4f1a\u5728\u4e0b\u4e00\u7bc7\u535a\u5ba2\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u3002\u73b0\u5728\u5148\u8ba8\u8bba\u4e00\u4e0b\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u53ef\u80fd\u9700\u8981\u505a\u4e9b\u4ec0\u4e48\uff1a</p>\n<ol>\n<li>\u6839\u636e <code>main</code> \u7a0b\u5e8f\u8bb0\u5f55\u7684\u4fe1\u606f\uff0c\u53bb\u52a0\u8f7d <code>libprinter.so</code> \u7684\u5185\u5bb9\uff0c\u52a0\u8f7d\u5230\u67d0\u4e2a\u5185\u5b58\u5730\u5740\u4e0a</li>\n<li><code>main</code> \u7a0b\u5e8f\u9700\u8981\u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\uff0c\u90a3\u4e48\u52a8\u6001\u94fe\u63a5\u5668\u5c31\u9700\u8981\u53bb\u67e5\u8be2\uff0c<code>libprinter.so</code> \u6709\u6ca1\u6709\u8fd9\u4e9b\u51fd\u6570\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5730\u5740\u662f\u4ec0\u4e48</li>\n</ol>\n<p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u5c31\u4f1a\u7528\u5230\u4e0a\u9762\u51fa\u73b0\u7684 <code>.dynamic</code> section\uff0c\u6839\u636e\u5b83\u7684\u5185\u5bb9\uff0c\u8bb0\u5f55\u4e0b\u54c8\u5e0c\u8868\u7684\u4f4d\u7f6e\u3002\u7a0b\u5e8f\u8981\u8c03\u7528 <code>print</code> \u51fd\u6570\uff0c\u90a3\u5c31\u5728\u54c8\u5e0c\u8868\u91cc\u67e5\u8be2 <code>print</code> \u51fd\u6570\u5bf9\u5e94\u7684\u7b26\u53f7\uff0c\u5982\u679c\u627e\u5230\u4e86\uff0c\u90a3\u5c31\u53ef\u4ee5\u5f97\u5230 <code>print</code> \u51fd\u6570\u5728 <code>libprinter.so</code> \u91cc\u7684\u504f\u79fb\uff0c\u504f\u79fb\u518d\u52a0\u4e0a <code>libprinter.so</code> \u52a8\u6001\u52a0\u8f7d\u7684\u57fa\u5730\u5740\uff0c\u5c31\u5f97\u5230\u4e86\u5b9e\u9645\u662f <code>print</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u8c03\u7528\u51fd\u6570\u4e86\u3002</p>\n<p>\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u53d1\u751f\u5f88\u591a\u6b21\uff0c\u6240\u4ee5\u6027\u80fd\u662f\u5f88\u91cd\u8981\u7684\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u54c8\u5e0c\u8868\u3002\u90a3\u4e48\u8fd9\u4e2a\u54c8\u5e0c\u8868\u5177\u4f53\u662f\u600e\u4e48\u4e00\u4e2a\u6784\u9020\u5462\uff1f\u4ee5\u5f80\u5728\u6570\u636e\u7ed3\u6784\u8bfe\u4e0a\u8bb2\u54c8\u5e0c\u8868\u7684\u65f6\u5019\uff0c\u66f4\u591a\u662f\u5728\u5185\u5b58\u4e2d\u7528\u54c8\u5e0c\u8868\uff0c\u7528\u62c9\u94fe\u6cd5\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u8bdd\uff0c\u76f4\u63a5\u7528\u6307\u9488\u6570\u7ec4\u5c31\u53ef\u4ee5\u4e86\uff1b\u800c\u8fd9\u91cc\u7684\u54c8\u5e0c\u8868\u9700\u8981\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u6240\u4ee5\u90fd\u662f\u7528\u4e0b\u6807\u6765\u66ff\u4ee3\u6307\u9488\u3002</p>\n<p>\u9996\u5148\u8bb2\u4f20\u7edf\u7684 SystemV Hash \u5b9e\u73b0\uff0c\u5b83\u4fdd\u5b58\u5728 <code>.hash</code> \u6bb5\u5185\uff0c\u4f7f\u7528\u62c9\u94fe\u6cd5\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u3002\u5b83\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684\uff1a</p>\n<ol>\n<li>\u4e24\u4e2a 32 \u4f4d\u6570 <code>nbucket</code> \u548c <code>nchain</code>\uff0c\u5206\u522b\u4fdd\u5b58\u6709\u591a\u5c11\u4e2a bucket \u548c\u591a\u5c11\u4e2a chain</li>\n<li>\u63a5\u4e0b\u6765\u662f <code>nbucket</code> \u4e2a 32 \u4f4d\u6570\uff08bucket \u6570\u7ec4\uff09\uff0c\u5bf9\u5e94\u54c8\u5e0c\u8868\u7684 bucket\uff0c\u5185\u5bb9\u662f chain \u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u4e5f\u5c31\u662f\u62c9\u94fe\u6cd5\u91cc\uff0c\u94fe\u8868\u7684\u8d77\u59cb\u7ed3\u70b9\u4e0b\u6807</li>\n<li>\u6700\u540e\u662f <code>nchain</code> \u4e2a 32 \u4f4d\u6570\uff08chain \u6570\u7ec4\uff09\uff0c\u8bb0\u5f55\u94fe\u8868\u7684\u4e0b\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e0b\u6807\uff0c\u5982\u679c\u94fe\u8868\u540e\u7ee7\u7ed3\u70b9\u4e0d\u5b58\u5728\uff0c\u5219\u4fdd\u5b58 <code>STN_UNDEF</code></li>\n</ol>\n<p>chain \u6570\u7ec4\u548c\u52a8\u6001\u7b26\u53f7\u8868\u5927\u5c0f\u76f8\u540c\uff0c\u5143\u7d20\u4e00\u4e00\u5bf9\u5e94\u3002\u90a3\u4e48\u7528\u54c8\u5e0c\u8868\u67e5\u8be2\u7b26\u53f7\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p>\n<ol>\n<li>\u5bf9\u7b26\u53f7\u540d\u79f0\u6c42\u54c8\u5e0c\u503c\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u89c4\u5b9a\u597d\u7684\uff0c\u8f93\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8f93\u51fa\u4e00\u4e2a 32 \u4f4d\u6574\u6570</li>\n<li>\u67e5\u8be2\u54c8\u5e0c\u503c\u5bf9\u5e94\u7684 bucket\uff0c\u5f97\u5230 chain \u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u8fd9\u4e2a\u4e0b\u6807\u4e5f\u5bf9\u5e94\u4e86\u4e00\u4e2a\u7b26\u53f7</li>\n<li>\u53bb\u7b26\u53f7\u8868\u67e5\u770b\u8fd9\u4e2a\u7b26\u53f7\u662f\u5426\u662f\u8981\u67e5\u8be2\u7684\u7b26\u53f7\uff08\u5b57\u7b26\u4e32\u6bd4\u8f83\uff09\uff0c\u5982\u679c\u662f\uff0c\u90a3\u5c31\u627e\u5230\u4e86\u76ee\u6807\u7b26\u53f7</li>\n<li>\u5982\u679c\u4e0d\u662f\uff0c\u68c0\u67e5 chain \u6570\u7ec4\uff0c\u67e5\u770b\u94fe\u8868\u662f\u5426\u6709\u540e\u7ee7\u7ed3\u70b9\uff0c\u5982\u679c\u6709\uff0c\u90a3\u4e48\u6cbf\u7740\u94fe\u8868\uff0c\u9010\u4e2a\u68c0\u67e5\u7b26\u53f7\u8868\u4e2d\u7684\u7b26\u53f7</li>\n<li>\u5982\u679c\u904d\u5386\u5230 <code>STT_UNDEF</code> \u90fd\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u7b26\u53f7\uff0c\u8bf4\u660e\u76ee\u6807\u7b26\u53f7\u4e0d\u5b58\u5728</li>\n</ol>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u662f\u6bd4\u8f83\u539f\u59cb\u7684\u54c8\u5e0c\u8868\u5b9e\u73b0\u65b9\u6cd5\uff0c\u4e3a\u4e86\u51cf\u5c11\u78b0\u649e\uff0c\u5c31\u9700\u8981\u6bd4\u8f83\u5927\u7684 <code>nbucket</code>\uff0c\u4f46\u5c31\u9700\u8981\u66f4\u591a\u7684\u7a7a\u95f4\u4e86\u3002</p>\n<p>\u4e3a\u4e86\u89e3\u51b3\u52a8\u6001\u5e93\u65e5\u76ca\u589e\u957f\u7684\u7b26\u53f7\u8868\u5927\u5c0f\u548c\u4e0d\u591f\u9ad8\u7684\u52a8\u6001\u94fe\u63a5\u6027\u80fd\u4e4b\u95f4\u7684\u77db\u76fe\uff0c\u76ee\u524d\u5e38\u89c1\u53e6\u4e00\u79cd\u54c8\u5e0c\u8868\u7684\u5b9e\u73b0\uff1aGNU Hash\uff0c\u5b83\u4fdd\u5b58\u5728 <code>.gnu.hash</code> \u6bb5\u5185\u3002\u867d\u8bf4\u662f\u54c8\u5e0c\u8868\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u7684\u7ec4\u5408\uff1a</p>\n<ol>\n<li>Bloom Filter\uff1aBloom Filter \u662f\u4e00\u79cd\u5feb\u901f\u5224\u65ad\u67d0\u4e2a\u503c\u662f\u5426\u4e0d\u5728\u67d0\u4e2a\u96c6\u5408\u4e2d\u7684\u6570\u636e\u7ed3\u6784 <sup id=\"fnref:1\"><a class=\"footnote-ref\" href=\"#fn:1\">1</a></sup>\uff0c\u5728\u8fd9\u91cc\uff0c\u5c31\u662f\u5224\u65ad\u7b26\u53f7\u662f\u5426\u4e0d\u5728\u8be5\u52a8\u6001\u5e93\u7684\u7b26\u53f7\u8868\u4e2d\uff0c\u5982\u679c\u4e0d\u5728\uff0c\u90a3\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u540e\u7eed\u7684\u54c8\u5e0c\u67e5\u8868</li>\n<li>\u54c8\u5e0c\u8868\uff1a\u76f8\u6bd4 SystemV Hash\uff0c\u505a\u4e86\u8fd9\u4e9b\u6539\u52a8\uff1a<ol>\n<li>\u62c9\u94fe\u6cd5\u7684\u5185\u5b58\u8bbf\u95ee\u6bd4\u8f83\u968f\u673a\uff0c\u7f13\u5b58\u5c40\u90e8\u6027\u5dee\uff1b\u6240\u4ee5\u6539\u6210\u4e86\u7ebf\u6027\u6cd5\uff1a\u628a\u7b26\u53f7\u6309\u7167 bucket \u6392\u5e8f\uff0c\u4f7f\u5f97\u540c\u4e00\u4e2a bucket \u5185\u7684\u6240\u6709\u7b26\u53f7\u5728\u6570\u7ec4\u4e2d\u8fde\u7eed\u5b58\u653e\uff0c\u6539\u8fdb\u4e86\u7f13\u5b58\u5c40\u90e8\u6027</li>\n<li>\u5728 SystemV Hash \u4e2d\uff0c\u5728\u94fe\u8868\u904d\u5386\u7684\u65f6\u5019\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u90fd\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83\uff0c\u8fd9\u662f\u6bd4\u8f83\u6162\u7684\uff1b\u5728 GNU Hash \u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u4fdd\u5b58\u94fe\u8868\u7684\u540e\u7ee7\u7ed3\u70b9\u7684\u53d8\u5316\uff0c\u6539\u4e3a\u4fdd\u5b58\u5bf9\u5e94\u7b26\u53f7\u7684\u54c8\u5e0c\u503c\uff0c\u90a3\u4e48\u5728\u904d\u5386\u8fde\u7eed\u7684 bucket \u5185\u7684\u7b26\u53f7\u65f6\uff0c\u9996\u5148\u6bd4\u8f83\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u65f6\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u5b57\u7b26\u4e32\u6bd4\u8f83\u4e86</li>\n<li>\u4e3a\u4e86\u5224\u65ad\u5f53\u524d bucket \u5185\u7b26\u53f7\u662f\u5426\u904d\u5386\u5b8c\u6210\uff0c\u62ff\u54c8\u5e0c\u7684\u6700\u4f4e\u4f4d\u505a\u6807\u8bc6\uff0c\u6bd4\u8f83\u54c8\u5e0c\u65f6\u4e0d\u8003\u8651\u6700\u4f4e\u4f4d</li>\n</ol>\n</li>\n</ol>\n<p>\u90a3\u4e48\u7528 GNU Hash \u67e5\u8be2\u7b26\u53f7\u8868\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p>\n<ol>\n<li>\u5728 Bloom Filter \u4e2d\u67e5\u8be2\u76ee\u6807\u7b26\u53f7\u662f\u5426\u4e0d\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u8bf4\u660e\u76ee\u6807\u7b26\u53f7\u4e0d\u5b58\u5728</li>\n<li>\u8ba1\u7b97\u51fa\u7b26\u53f7\u540d\u79f0\u7684\u54c8\u5e0c\uff0c\u627e\u5230\u5bf9\u5e94\u7684 bucket\uff0c\u904d\u5386 bucket \u5185\u7684\u5143\u7d20\uff0c\u5224\u65ad\u76ee\u6807\u7b26\u53f7\u4e0e\u5f53\u524d\u5143\u7d20\u7684\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5e76\u4e14\u5b57\u7b26\u4e32\u6bd4\u8f83\u4e5f\u76f8\u540c\uff0c\u90a3\u5c31\u627e\u5230\u4e86\u76ee\u6807\u7b26\u53f7\uff1b\u5982\u679c\u6ca1\u67e5\u5230\uff0c\u5c31\u67e5\u5230\u76f4\u5230 bucket \u7ed3\u675f</li>\n</ol>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u4f1a\u6bd4 SystemV Hash \u6027\u80fd\u66f4\u9ad8\uff0c\u6784\u5efa\u8d77\u6765\u81ea\u7136\u4e5f\u66f4\u52a0\u590d\u6742\u3002</p>\n<h2 id=\"\u5b9e\u73b0\">\u5b9e\u73b0<a class=\"headerlink\" href=\"#\u5b9e\u73b0\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7ed3\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0a\u4e00\u6b21\u535a\u5ba2\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7b2c\u4e09\u7248\u7684\u94fe\u63a5\u5668\uff0c\u8fd9\u4e2a\u94fe\u63a5\u5668\u53ef\u4ee5\u652f\u6301\u8f93\u5165\u591a\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u52a8\u6001\u5e93\u3002\u989d\u5916\u7684\u9700\u8981\u5b9e\u73b0\u7684\u5185\u5bb9\uff0c\u5305\u62ec\uff1a</p>\n<ol>\n<li>\u4ece\u7b26\u53f7\u8868\uff08<code>.symtab</code>\uff09\u4e2d\uff0c\u53d6\u51fa\u90a3\u4e9b GLOBAL \u7684\u7b26\u53f7\uff0c\u6784\u5efa\u51fa\u52a8\u6001\u7b26\u53f7\u8868\uff08<code>.dynsym</code>\uff09\uff0c\u8ba1\u7b97\u51fa\u54c8\u5e0c\u8868\uff0c\u4fdd\u5b58\u5728 <code>.hash</code> \u548c <code>.gnu.hash</code> \u6bb5\u4e2d</li>\n<li>\u6784\u9020 <code>.dynamic</code> section\uff0c\u5e76\u5728 Program Header \u4e2d\u6dfb\u52a0 DYNAMIC\uff0c\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u52a8\u6001\u94fe\u63a5\u65f6\u6240\u9700\u8981\u7684\u5404\u79cd\u4fe1\u606f</li>\n</ol>\n<p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 600 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 200 \u884c\u3002</p>\n<h2 id=\"\u53c2\u8003\">\u53c2\u8003<a class=\"headerlink\" href=\"#\u53c2\u8003\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p>\n<ul>\n<li><a href=\"https://refspecs.linuxbase.org/elf/gabi4+/ch5.dynamic.html\">Dynamic Linking</a></li>\n<li><a href=\"https://flapenguin.me/elf-dt-gnu-hash\">ELF: better symbol lookup via DT_GNU_HASH</a></li>\n<li><a href=\"https://blogs.oracle.com/solaris/post/gnu-hash-elf-sections\">GNU Hash ELF Sections</a></li>\n</ul>\n<div class=\"footnote\">\n<hr />\n<ol>\n<li id=\"fn:1\">\n<p>\u8fd9\u53e5\u8bdd\u6709\u70b9\u62d7\u53e3\uff0c\u4f46\u662f\u4f60\u6ca1\u6709\u770b\u9519\uff0cBloom Filter \u53ea\u80fd\u786e\u5b9a\u67d0\u4e2a\u5143\u7d20\u4e0d\u5728\u96c6\u5408\u4e2d\uff0c\u4f46\u53cd\u4e4b\uff0c\u4e0d\u80fd\u786e\u5b9a\u5143\u7d20\u662f\u5426\u4e00\u5b9a\u5728\u96c6\u5408\u4e2d\u3002\u5b83\u7684\u539f\u7406\u662f\uff0c\u8ba1\u7b97\u96c6\u5408\u7684\u6bcf\u4e2a\u5143\u7d20\u7684\u54c8\u5e0c\u503c\uff0c\u6784\u5efa\u51fa\u4e00\u4e2a bitset\uff0c\u628a\u54c8\u5e0c\u503c\u5bf9\u5e94\u7684\u4f4d\u8bbe\u4e3a 1\uff0c\u5176\u4f59\u8bbe\u4e3a 0\uff1b\u67e5\u8be2\u65f6\uff0c\u8ba1\u7b97\u5143\u7d20\u7684\u54c8\u5e0c\u503c\uff0c\u68c0\u67e5 bitset \u4e2d\u5bf9\u5e94\u4f4d\u662f\u5426\u4e3a 0\uff1a\u5982\u679c\u4e3a 0\uff0c\u90a3\u4e48\u5143\u7d20\u4e00\u5b9a\u4e0d\u5728\u96c6\u5408\u4e2d\uff1b\u5982\u679c\u4e3a 1\uff0c\u7531\u4e8e\u53ef\u80fd\u51fa\u73b0\u54c8\u5e0c\u51b2\u7a81\uff0c\u4e0d\u80fd\u786e\u5b9a\u8be5\u5143\u7d20\u4e00\u5b9a\u5728\u96c6\u5408\u4e2d\u3002&#160;<a class=\"footnote-backref\" href=\"#fnref:1\" title=\"Jump back to footnote 1 in the text\">&#8617;</a></p>\n</li>\n</ol>\n</div>", "image": null, "date_modified": "2024-04-06T00:00:00+00:00", "authors": [], "tags": ["elf", "linker", "linux", "software", "write-a-linker"]}, {"id": "https://jia.je/software/2024/03/30/write-a-linker-2/", "url": "https://jia.je/software/2024/03/30/write-a-linker-2/", "title": "\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09", "content_html": "<h1 id=\"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56682\">\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff082\uff09<a class=\"headerlink\" href=\"#\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56682\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u524d\u8a00\">\u524d\u8a00<a class=\"headerlink\" href=\"#\u524d\u8a00\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u535a\u5ba2\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u5b83\u53ef\u4ee5\u8f93\u5165\u5355\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u5347\u7ea7\u5230\u652f\u6301\u8f93\u5165\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u7684 ELF .o \u6587\u4ef6\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u56de\u987e\">\u56de\u987e<a class=\"headerlink\" href=\"#\u56de\u987e\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\uff1a\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u4e86\u73b0\u6709\u94fe\u63a5\u5668\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff1a\u8f93\u5165\u4e00\u4e2a ELF object\uff0c\u94fe\u63a5\u6210\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\uff1a</p>\n<ol>\n<li>\u89e3\u6790\u8f93\u5165\u7684 ELF\uff0c\u6536\u96c6\u5404\u4e2a section \u9700\u8981\u4fdd\u7559\u4e0b\u6765\u7684\u5185\u5bb9</li>\n<li>\u89c4\u5212\u5c06\u8981\u751f\u6210\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u7684\u5185\u5bb9\u5e03\u5c40\uff1a\u5f00\u59cb\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\u5934\uff0c\u4e4b\u540e\u662f\u5404\u4e2a section\uff0c\u8ba1\u7b97\u51fa\u5b83\u4eec\u4ece\u54ea\u91cc\u5f00\u59cb\u5230\u54ea\u91cc\u7ed3\u675f</li>\n<li>\u7b2c\u4e8c\u6b65\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5728\u8fd0\u884c\u65f6\uff0c\u5404\u4e2a section \u5c06\u4f1a\u88ab\u52a0\u8f7d\u5230\u54ea\u4e2a\u5730\u5740\u4e0a\uff1b\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u91cd\u5b9a\u4f4d\uff0c\u628a\u5730\u5740\u6309\u7167\u9884\u8bbe\u7684\u89c4\u5219\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5730\u65b9</li>\n<li>\u6700\u540e\u6309\u7167\u9884\u8bbe\u7684\u6587\u4ef6\u5e03\u5c40\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230 ELF \u6587\u4ef6\u4e2d</li>\n</ol>\n<p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5b9e\u73b0\u5355\u6587\u4ef6\u8f93\u5165\u5230\u591a\u6587\u4ef6\u8f93\u5165\u7684\u8de8\u8d8a\uff0c\u8ba9\u6211\u4eec\u9996\u5148\u5206\u6790\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7684\u4e0d\u540c\u5728\u54ea\u91cc\u3002</p>\n<h2 id=\"\u5206\u6790\">\u5206\u6790<a class=\"headerlink\" href=\"#\u5206\u6790\" title=\"Permanent link\">&para;</a></h2>\n<h3 id=\"\u62c6\u5206\u4ee3\u7801\">\u62c6\u5206\u4ee3\u7801<a class=\"headerlink\" href=\"#\u62c6\u5206\u4ee3\u7801\" title=\"Permanent link\">&para;</a></h3>\n<p>\u8f93\u5165\u53ea\u6709\u4e00\u4e2a ELF object\uff08.o\uff09\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a object \u6587\u4ef6\u91cc\u9700\u8981\u7684\u6240\u6709\u4e1c\u897f\u90fd\u53ea\u80fd\u7531\u8fd9\u4e2a object \u81ea\u5df1\u6765\u63d0\u4f9b\uff0c\u6240\u4ee5\u6bd4\u8f83\u597d\u5b9e\u73b0\u3002\u4f46\u5982\u679c\u8981\u8f93\u5165\u591a\u4e2a ELF object \u6587\u4ef6\uff0c\u6b64\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u9700\u8981\u4f9d\u8d56\u7684\u60c5\u51b5\u3002\u9996\u5148\u56de\u5fc6\u4e00\u4e0b\u4e4b\u524d\u5b66\u4e60\u7684 C/C++ \u7684\u5185\u5bb9\uff0c\u5728\u7f16\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u4f1a\u628a\u58f0\u660e\uff08declaration\uff09\u653e\u5230\u5934\u6587\u4ef6\uff08.h\uff09\u91cc\uff0c\u5b9e\u73b0\uff08definition\uff09\u653e\u5728\u6e90\u6587\u4ef6\uff08.c/cpp\uff09\uff1a\u8fd9\u6837\u53ef\u4ee5\u5728 <code>A.cpp</code> \u4e2d\u8c03\u7528 <code>B.cpp</code> \u91cc\u7684\u51fd\u6570\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5927\u5bb6\u7ecf\u5e38\u9047\u5230\u7684 <code>duplicate symbol</code> \u9519\u8bef\u3002\u90a3\u4e48\u8fd9\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5462\uff1f</p>\n<p>\u6211\u4eec\u9996\u5148\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\u6a21\u62df\u8fd9\u4e2a\u573a\u666f\u3002\u9996\u5148\u56de\u987e\u4e00\u4e0b\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\u7528\u6c47\u7f16\u5b9e\u73b0\u7684 Hello World \u4f8b\u5b50\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># From https://gist.github.com/adrianratnapala/1321776</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"c1\"># Hello World on amd64 under Linux.</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"c1\"># One way to build this is with: </span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"c1\">#    gcc hello.S  -s -nostartfiles -nostdlib -o hello</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"c1\"># for syscall numbers look in /usr/include/asm/unistd_64.h</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"c1\"># for examples look at http://99-bottles-of-beer.net/language-assembler-(amd64)-933.html</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"c1\"># for insipration look at http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html</span>\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.rodata</span>\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"nl\">hello:</span>\n</span><span id=\"__span-0-14\"><a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">    </span><span class=\"na\">.string</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello world!\\n&quot;</span>\n</span><span id=\"__span-0-15\"><a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a>\n</span><span id=\"__span-0-16\"><a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a>\n</span><span id=\"__span-0-17\"><a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-0-18\"><a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">_start</span>\n</span><span id=\"__span-0-19\"><a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"nl\">_start:</span>\n</span><span id=\"__span-0-20\"><a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"w\">    </span><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-0-21\"><a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-22\"><a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-0-23\"><a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-0-24\"><a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span><span class=\"w\"> </span>\n</span><span id=\"__span-0-25\"><a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a><span class=\"w\">    </span><span class=\"no\">syscall</span>\n</span><span id=\"__span-0-26\"><a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a>\n</span><span id=\"__span-0-27\"><a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\" href=\"#__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"c1\"># _exit(0)</span>\n</span><span id=\"__span-0-28\"><a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\" href=\"#__codelineno-0-28\"></a><span class=\"w\">    </span><span class=\"nf\">xor</span><span class=\"w\">     </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-29\"><a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\" href=\"#__codelineno-0-29\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-0-30\"><a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\" href=\"#__codelineno-0-30\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\u4ee3\u7801\u5b9e\u9645\u4e0a\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5\uff0c\u9996\u5148\u8f93\u51fa Hello World\uff0c\u7136\u540e\u9000\u51fa\u7a0b\u5e8f\u3002\u6211\u4eec\u628a\u8fd9\u4e24\u90e8\u5206\u5206\u522b\u5b9e\u73b0\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u653e\u5230\u53e6\u4e00\u4e2a <code>.s</code> \u6587\u4ef6\uff08<code>printer.s</code>\uff09\u4e2d\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\"># https://gist.github.com/adrianratnapala/1321776</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"c1\"># printer.s</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.rodata</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"nl\">hello:</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"na\">.string</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello world!\\n&quot;</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">print</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"nl\">print:</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">    </span><span class=\"nf\">ret</span>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">exit</span>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"nl\">exit:</span>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"c1\"># _exit(0)</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">    </span><span class=\"nf\">xor</span><span class=\"w\">     </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u628a\u4e0a\u9762\u7684\u4e24\u6bb5\u6c47\u7f16\u5206\u522b\u653e\u5728 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u4e2d\uff0c\u5e76\u4e14\u52a0\u4e0a\u4e86 <code>ret</code> \u6307\u4ee4\u4ee5\u5b9e\u73b0\u8fd4\u56de\u51fd\u6570\u7684\u8c03\u7528\u8005\u3002<code>exit</code> \u51fd\u6570\u6ca1\u6709\u6dfb\u52a0 <code>ret</code> \uff0c\u662f\u56e0\u4e3a\u8c03\u7528 <code>exit</code> \u7cfb\u7edf\u8c03\u7528\u540e\uff0c\u8fdb\u7a0b\u5c31\u9000\u51fa\u4e86\uff0c\u540e\u9762\u7684\u6307\u4ee4\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u5728\u5165\u53e3\u51fd\u6570\u4e2d\u8c03\u7528\u8fd9\u4e24\u4e2a\u51fd\u6570\u6765\u5b9e\u73b0 <code>Hello world</code> \u7684\u6253\u5370\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\"># main.s</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">_start</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"nl\">_start:</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">print</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">    </span><span class=\"nf\">call</span><span class=\"w\"> </span><span class=\"no\">exit</span>\n</span></code></pre></div>\n<p>\u8c03\u7528 GNU as \u5206\u522b\u6c47\u7f16\u4e24\u4e2a\u6587\u4ef6\u7136\u540e\u94fe\u63a5\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"c1\"># Use assembler (GNU as) to assemble</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>main.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>main.o\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>printer.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"c1\"># Use ld (GNU ld.bfd) to link</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>main.o<span class=\"w\"> </span>printer.o<span class=\"w\"> </span>-o<span class=\"w\"> </span>helloworld\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a>$<span class=\"w\"> </span>./helloworld\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a>Hello<span class=\"w\"> </span>world!\n</span></code></pre></div>\n<h3 id=\"\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6\">\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6\" title=\"Permanent link\">&para;</a></h3>\n<p>\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u8981\u63a2\u7a76\uff0c\u6c47\u7f16\u5668\u548c\u94fe\u63a5\u5668\u662f\u5982\u4f55\u534f\u4f5c\uff0c\u4f7f\u5f97 <code>main.s</code> \u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u8c03\u7528 <code>printer.s</code> \u4e2d\u7684\u51fd\u6570\u3002\u5f53\u7136\u4e86\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u7528\u7684\u662f\u6c47\u7f16\u8bed\u8a00\uff0c\u6c47\u7f16\u5668\u9047\u5230\u4e0d\u5b58\u5728\u7684\u51fd\u6570\u540d\u5c31\u4f1a\u8ba4\u4e3a\u662f\u5916\u90e8\u51fd\u6570\u3002\u5982\u679c\u662f C/C++ \u8bed\u8a00\uff0c\u5219\u8981\u5148\u5728 <code>main.c</code> \u4e2d\u58f0\u660e\u8fd9\u4e24\u4e2a\u51fd\u6570\uff08\u6216\u8005 <code>#include</code> \u4e86\u4e00\u4e2a\u58f0\u660e\u4e86\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u5934\u6587\u4ef6\uff09\u518d\u8c03\u7528\uff08\u6bd4\u8f83\u8001\u7684 C \u6807\u51c6\u5141\u8bb8\u4e0d\u58f0\u660e\u76f4\u63a5\u8c03\u7528\uff0c\u4f46\u8fd9\u662f\u4e0d\u63a8\u8350\u7684\uff09\u3002</p>\n<p>\u9996\u5148\u89c2\u5bdf <code>main.s</code> \u7ecf\u8fc7\u6c47\u7f16\u5f97\u5230\u7684 <code>main.o</code>\uff0c\u770b\u5b83\u662f\u600e\u4e48\u8c03\u7528 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u7684\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"c1\"># objdump -S: Display assembly and intermix source code with disassembly</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>main.o\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a>\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a>main.o:<span class=\"w\">     </span>file<span class=\"w\"> </span>format<span class=\"w\"> </span>elf64-x86-64\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.text:\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>&lt;_start&gt;:\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">   </span><span class=\"m\">0</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>call<span class=\"w\">   </span><span class=\"m\">5</span><span class=\"w\"> </span>&lt;_start+0x5&gt;\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">   </span><span class=\"m\">5</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>call<span class=\"w\">   </span>a<span class=\"w\"> </span>&lt;_start+0xa&gt;\n</span></code></pre></div>\n<p>\u53cd\u6c47\u7f16\u51fa\u6765\u53ef\u4ee5\u770b\u5230\u4e24\u6761 <code>call</code> \u6307\u4ee4\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u5730\u5740\u90fd\u5f88\u5947\u602a\uff1a\u7b2c\u4e00\u6761\u6307\u4ee4\u662f <code>call 5</code>\uff0c\u800c 0x5 \u662f\u7b2c\u4e8c\u6761 call \u5730\u5740\u7684\u5730\u5740\uff1b\u7b2c\u4e8c\u6761\u6307\u4ee4\u662f <code>call a</code>\uff0c\u6309\u7167\u89c4\u5f8b\uff0c\u53ef\u4ee5\u731c\u51fa\u6765 0xa \u662f\u7b2c\u4e8c\u6761\u6307\u4ee4\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\uff0c\u6bcf\u6761\u6307\u4ee4 5 \u4e2a\u5b57\u8282\uff0c\u4e24\u6761\u6307\u4ee4\u521a\u597d 10 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 0xa\u3002\u8fd9\u4f3c\u4e4e\u4e0e <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u90fd\u6ca1\u6709\u5173\u7cfb\uff0c\u6267\u884c\u7684\u65f6\u5019\u600e\u4e48\u4f1a\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u5462\uff1f</p>\n<p>\u56de\u5fc6\u4e00\u4e0b\uff0c\u5728\u8fd9\u4e2a\u7cfb\u5217\u7684\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u53cd\u6c47\u7f16 <code>.o</code> \u6587\u4ef6\u7684\u65f6\u5019\u4e5f\u51fa\u73b0\u8fc7\u7c7b\u4f3c\u7684\u60c5\u51b5\uff1a<code>_start</code> \u51fd\u6570\u9700\u8981\u77e5\u9053 <code>.rodata</code> \u6bb5\u91cc\u7684 <code>hello</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\uff0c\u4f46\u662f\u6c47\u7f16\u7684\u65f6\u5019\u8fd9\u4e2a\u5730\u5740\u65e0\u6cd5\u77e5\u9053\uff0c\u6240\u4ee5\u6c47\u7f16\u5668\u751f\u6210\u4e86\u4e00\u4e2a relocation\uff08relocation \u7684\u4e2d\u6587\u7ffb\u8bd1\u662f\u91cd\u5b9a\u4f4d\uff0c\u4f46\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u7ffb\u8bd1\uff0c\u6240\u4ee5\u4e0b\u6587\u8fd8\u662f\u7528 relocation\uff09\uff0c\u544a\u8bc9\u94fe\u63a5\u5668\u53bb\u586b\u5165\u6b63\u786e\u7684\u5730\u5740\u3002\u8fd9\u91cc\u4e5f\u662f\u7c7b\u4f3c\u7684\uff1a\u6c47\u7f16\u5668\u5728\u6c47\u7f16 <code>main.s</code> \u7684\u65f6\u5019\uff0c\u4e5f\u65e0\u6cd5\u77e5\u9053 <code>print</code> \u548c <code>exit</code> \u51fd\u6570\u4f1a\u5728\u4ec0\u4e48\u5730\u5740\uff0c\u6240\u4ee5\u53ea\u80fd\u751f\u6210\u4e00\u4e2a relocation\uff0c\u628a\u504f\u79fb\u521d\u59cb\u5316\u4e3a\u96f6\uff0c\u7b49\u7740\u94fe\u63a5\u5668\u6765\u586b\u5199\u3002\u800c x86 \u4e0a <code>call</code> \u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u8ba1\u7b97\u65b9\u6cd5\u662f <code>call</code> \u6307\u4ee4\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u5730\u5740\u52a0\u4e0a\u504f\u79fb\uff0c\u8fd9\u4e2a\u504f\u79fb\u521d\u59cb\u5316\u4e3a 0\uff0c\u90a3\u4e48\u53cd\u6c47\u7f16\u770b\u5230\u7684\u5c31\u597d\u50cf\u662f <code>call</code> \u8981\u8c03\u7528\u5b83\u81ea\u5df1\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e0a\u9762\u89c2\u5bdf\u5230\u7684\u73b0\u8c61\u3002</p>\n<p>\u6b63\u597d <code>objdump</code> \u53ef\u4ee5\u5e2e\u6211\u4eec\u663e\u793a\u51fa relocation\uff0c\u53ea\u9700\u8981\u6dfb\u52a0 <code>-r</code> \u53c2\u6570\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"c1\"># objdump -r, --reloc: Display the relocation entries in the file</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>-r<span class=\"w\"> </span>main.o\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a>main.o:<span class=\"w\">     </span>file<span class=\"w\"> </span>format<span class=\"w\"> </span>elf64-x86-64\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.text:\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>&lt;_start&gt;:\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">   </span><span class=\"m\">0</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>call<span class=\"w\">   </span><span class=\"m\">5</span><span class=\"w\"> </span>&lt;_start+0x5&gt;\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">                        </span><span class=\"m\">1</span>:<span class=\"w\"> </span>R_X86_64_PLT32<span class=\"w\">       </span>print-0x4\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\">   </span><span class=\"m\">5</span>:<span class=\"w\">   </span>e8<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">          </span>call<span class=\"w\">   </span>a<span class=\"w\"> </span>&lt;_start+0xa&gt;\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\">                        </span><span class=\"m\">6</span>:<span class=\"w\"> </span>R_X86_64_PLT32<span class=\"w\">       </span>exit-0x4\n</span></code></pre></div>\n<p>\u8fd9\u65f6\u5019\u4f1a\u53d1\u73b0\uff0c<code>print</code> \u548c <code>exit</code> \u679c\u7136\u51fa\u73b0\u4e86\uff0c\u6240\u4ee5\u6c47\u7f16\u5668\u662f\u901a\u8fc7\u8fd9\u4e24\u6761 relocation \u544a\u8bc9\u94fe\u63a5\u5668\uff0c\u8fd9\u91cc\u5b9e\u9645\u4e0a\u8981\u8c03\u7528\u54ea\u4e2a\u51fd\u6570\u3002\u4f46\u662f\u8fd9\u91cc\u51fa\u73b0\u7684 <code>R_X86_64_PLT32</code> \u662f\u4ec0\u4e48\u610f\u601d\uff1f<code>print</code> \u548c <code>exit</code> \u540e\u9762\u7684 <code>-0x4</code> \u662f\u4ec0\u4e48\u610f\u601d\uff0c\u4e3a\u4ec0\u4e48\u8981\u51cf 4\uff1f\u5982\u679c\u8003\u8651\u5230\u524d\u9762\u6240\u8bf4\u7684\uff0c<code>call</code> \u6307\u4ee4\u5360\u7528 5 \u4e2a\u5b57\u8282\uff0c\u90a3\u4e0d\u5e94\u8be5\u662f\u51cf 5 \u624d\u5bf9\u5417\uff1f\u4e0b\u9762\u6765\u89e3\u91ca\u8fd9\u4e9b\u95ee\u9898\uff1a</p>\n<div class=\"admonition question\">\n<p class=\"admonition-title\">\u4ec0\u4e48\u662f <code>R_X86_64_PLT32</code> \uff1f</p>\n<p>\u5728\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u51fa\u73b0\u8fc7 <code>R_X86_64_32S</code> \u8fd9\u79cd relocation \u7c7b\u578b\uff0c\u5b83\u7684\u610f\u601d\u662f\u628a\u76ee\u6807\u7b26\u53f7\u7684\u5730\u5740\u4ee5 32 \u4f4d\u6709\u7b26\u53f7\u6570\u7684\u683c\u5f0f\u5199\u5230\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u7528\u7684\u662f\u7edd\u5bf9\u5730\u5740\uff0c\u4f8b\u5982 <code>0x402000</code>\u3002\u4f46\u662f\uff0c\u521a\u624d\u63d0\u5230\uff0cx86 \u7684 <code>call</code> \u6307\u4ee4\u7684\u76ee\u7684\u5730\u5740\u8ba1\u7b97\u65b9\u6cd5\u662f\uff0c<code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\uff0c\u52a0\u4e0a\u5730\u5740\u504f\u79fb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u5730\u5740\u504f\u79fb\u662f\u76f8\u5bf9\u7684\uff0c\u518d\u586b\u5165\u7edd\u5bf9\u5730\u5740\u5c31\u51fa\u9519\u4e86\u3002\u5b9e\u9645\u4e0a\uff0c<code>R_X86_64_PLT32</code> \u8fd8\u6d89\u53ca\u5230\u4e00\u4e2a\u65b0\u7684\u8fd8\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u6982\u5ff5 PLT\uff08Procedure Linkage Table\uff09\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u5148\u4e0d\u6d89\u53ca PLT\uff0c\u628a\u5b83\u5f53\u6210\u5355\u7eaf\u7684\u76f8\u5bf9\u5730\u5740\u8ba1\u7b97\u53bb\u5904\u7406\u3002\u8fd9\u4e2a\u5355\u7eaf\u7684\u76f8\u5bf9\u5730\u5740\u8ba1\u7b97\u7684 relocation \u4e5f\u6709\u6b63\u5f0f\u540d\u5b57\uff0c\u4e5f\u5c31\u662f <code>R_X86_64_PC32</code>\uff0c\u610f\u601d\u662f\u6839\u636e PC\uff08Program Counter\uff09\u8ba1\u7b97\u51fa\u548c\u76ee\u7684\u5730\u5740\u7684\u76f8\u5bf9\u504f\u79fb\uff0832 \u4f4d\uff09\u3002</p>\n</div>\n<div class=\"admonition question\">\n<p class=\"admonition-title\">\u4e3a\u4ec0\u4e48\u662f <code>print-0x4</code>\uff1f\u8fd9\u4e2a\u51cf\u53bb 0x4 \u662f\u600e\u4e48\u6765\u7684\uff1f</p>\n<p>\u521a\u624d\u63d0\u5230\uff0cx86 \u7684 <code>call</code> \u6307\u4ee4\u662f\u7528 <code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\u52a0\u4e0a\u5730\u5740\u504f\u79fb\uff0c\u6c42\u7684\u548c\u5c31\u662f\u8981\u8c03\u7528\u7684\u51fd\u6570\u7684\u5730\u5740\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u4e0b\u9762\u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1a</p>\n<p>\u4ee5\u4e0a\u9762\u7684 <code>call exit</code> \u6307\u4ee4\u4e3a\u4f8b\uff0c\u4e5f\u5c31\u662f\u53cd\u6c47\u7f16\u51fa\u6765\u7684\u7b2c\u4e8c\u6761\u6307\u4ee4\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"w\">   </span><span class=\"err\">5:</span><span class=\"w\">   </span><span class=\"nf\">e8</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"no\">call</span><span class=\"w\">   </span><span class=\"mh\">a</span> <span class=\"p\">&lt;</span><span class=\"no\">_start</span><span class=\"p\">+</span><span class=\"mi\">0xa</span><span class=\"p\">&gt;</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"w\">                        </span><span class=\"err\">6:</span><span class=\"w\"> </span><span class=\"nf\">R_X86_64_PLT32</span><span class=\"w\">       </span><span class=\"no\">exit-0x4</span>\n</span></code></pre></div>\n<p>\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053 <code>print</code> \u51fd\u6570\u7684\u5730\u5740\u5c31\u662f <code>0xbbbb</code>\uff0c\u4e5f\u5047\u8bbe\u8fd9\u6761 <code>call</code> \u6307\u4ee4\u6700\u7ec8\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u4e5f\u662f <code>0x5</code>\u3002\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u586b\u5199\u8fd9\u6761 <code>call</code> \u6307\u4ee4\u7684\u5730\u5740\u504f\u79fb\u5462\uff1f</p>\n<p>\u5047\u8bbe\u5730\u5740\u504f\u79fb\u7b49\u4e8e <code>X</code>\uff0c\u5df2\u77e5 <code>call</code> \u6307\u4ee4\u7684\u5730\u5740\u662f 0x5\uff0c<code>call</code> \u6307\u4ee4\u5360\u7528 0x5 \u4e2a\u5b57\u8282\uff0c\u90a3\u4e48 <code>call</code> \u6307\u4ee4\u540e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5730\u5740\u5c31\u662f <code>0x5 + 0x5</code>\uff0c\u6309\u7167 x86 \u7684\u89c4\u5b9a\uff0c\u8981\u8c03\u7528\u7684\u51fd\u6570\u7684\u5730\u5740\u5c31\u662f <code>0x5 + 0x5 + X</code>\u3002\u800c\u6211\u4eec\u77e5\u9053\u8981\u8c03\u7528\u7684\u51fd\u6570\u662f <code>print</code>\uff0c<code>print</code> \u51fd\u6570\u7684\u5730\u5740\u662f <code>0xbbbb</code>\uff0c\u53cd\u89e3\u51fa <code>X = 0xbbb1</code>\uff0c\u90a3\u4e48\u8981\u586b\u8fdb\u53bb\u7684\u5730\u5740\u504f\u79fb\u5c31\u662f 0xbbb1 \u8fd9\u4e2a\u6570\u3002</p>\n<p>\u5982\u679c\u6309\u7167\u8fd9\u4e2a\u903b\u8f91\uff0c\u8981\u8ba1\u7b97 X \u7684\u8bdd\uff0c\u5e94\u8be5\u662f <code>print - 0x5 - 0x5</code> \u624d\u5bf9\uff0c\u7b2c\u4e00\u4e2a <code>0x5</code> \u662f <code>call</code> \u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u7b2c\u4e8c\u4e2a <code>0x5</code> \u662f <code>call</code> \u6307\u4ee4\u7684\u957f\u5ea6\u3002\u4f46\u662f\u4e3a\u4ec0\u4e48\u770b\u5230\u7684\u662f <code>print - 0x4</code> \u5462\uff1f\u4e3a\u4ec0\u4e48\u53ea\u51cf\u4e86\u4e00\u4e2a\u6570\uff08<code>-0x4</code>\uff09\uff0c\u800c\u4e0d\u662f\u4e24\u4e2a\uff08<code>- 0x5 - 0x5</code>\uff09\uff1f</p>\n<p>\u7ec6\u5fc3\u7684\u8bfb\u8005\u53ef\u80fd\u89c2\u5bdf\u5230\uff0c\u5728 <code>R_X86_64_PLT32</code> \u7684\u524d\u9762\uff0c\u663e\u793a\u7684\u662f <code>6:</code>\uff0c\u8fd9\u8868\u793a\u7684\u662f relocation \u6807\u8bb0\u7684\u5730\u5740\u662f 0x6\uff0c\u800c\u4e0d\u662f 0x5\uff08<code>call</code> \u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff09\u3002\u8fdb\u4e00\u6b65\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0 <code>call</code> \u6307\u4ee4\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282 <code>0xe8</code> \u51b3\u5b9a\u4e86\u8fd9\u662f\u4e00\u6761 <code>call</code> \u6307\u4ee4\uff0c\u5269\u4e0b\u7684\u56db\u4e2a\u5b57\u8282\u90fd\u662f\u5730\u5740\u504f\u79fb\uff0c\u800c\u94fe\u63a5\u5668\u8981\u6539\u7684\u4e5f\u5c31\u662f\u8fd9\u4e2a\u5730\u5740\u504f\u79fb\uff1a\u65e2\u7136\u8981\u6539\u7684\u662f\u4ece 0x6 \u5f00\u59cb\u7684\u56db\u4e2a\u5b57\u8282\uff0c\u90a3 relocation \u81ea\u7136\u6307\u5411\u7684\u5c31\u662f 0x6\uff01\u6362\u53e5\u8bdd\u8bf4\uff0c\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u77e5\u9053\u8fd9\u662f\u4e00\u6761 <code>call</code> \u6307\u4ee4\uff0c\u53ea\u9700\u8981\u6309\u7167 relocation \u7684\u89c4\u5219\u8ba1\u7b97\u51fa\u503c\u586b\u8fdb\u53bb\u5c31\u597d\u4e86\u3002</p>\n<p>\u65e2\u7136\u8d77\u59cb\u5730\u5740\u8981\u4ece 0x6 \u5f00\u59cb\u7b97\u4e86\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u51fa\u73b0 <code>0x4</code> \u5c31\u53ef\u4ee5\u89e3\u91ca\u4e86\uff1a\u4ece relocation \u7684 0x6 \u5730\u5740\u5f00\u59cb\u7b97\uff0c\u53ea\u9700\u8981\u51cf\u53bb 4\uff08<code>call</code> \u6307\u4ee4\u5185\u5730\u5740\u504f\u79fb\u7684\u957f\u5ea6\uff09\uff0c\u800c\u4e0d\u662f\u51cf\u53bb 5\uff08<code>call</code> \u6307\u4ee4\u7684\u957f\u5ea6\uff09\u3002\u53e6\u4e00\u65b9\u9762\uff0c<code>R_X86_64_PLT32</code> \u672c\u8eab\u5c31\u544a\u8bc9\u94fe\u63a5\u5668\uff0c\u8ba9\u94fe\u63a5\u5668\u8ba1\u7b97\u7684\u65f6\u5019\uff0c\u8981\u51cf\u53bb\u5f53\u524d relocation \u7684\u8d77\u59cb\u5730\u5740\u4e86\u3002\u6309\u7167\u8fd9\u4e2a\u89c4\u5219\uff0c\u6211\u4eec\u518d\u590d\u73b0\u4e00\u904d\u521a\u624d\u7684\u4f8b\u5b50\uff1a</p>\n<p>\u94fe\u63a5\u5668\u89c2\u5bdf\u5230\u4e00\u4e2a <code>R_X86_64_PLT32</code> \u7684 relocation\uff0crelocation \u81ea\u8eab\u7684\u5730\u5740\u662f 0x6\uff0c\u76ee\u6807\u5730\u5740\u662f <code>print-0x4</code>\uff0c<code>print</code> \u51fd\u6570\u7684\u5730\u5740\u662f <code>0xbbbb</code>\uff0c\u90a3\u4e48\u8981\u586b\u5165\u7684\u5730\u5740\u504f\u79fb\u5c31\u7b49\u4e8e <code>0xbbbb - 0x4 - 0x6 = 0xbbb1</code>\u3002\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u7528 ABI \u6587\u6863\u4e2d\u7684\u8868\u793a\u65b9\u6cd5\uff0c\u5c31\u662f <code>S + A - P</code>\uff0cS\uff08Symbol\uff09\u8868\u793a\u7b26\u53f7\u7684\u5730\u5740\uff08<code>print</code> \u7684\u5730\u5740\uff0c<code>S=0xbbbb</code>\uff09\uff0cA\uff08Addend\uff09\u8868\u793a\u989d\u5916\u52a0\u6216\u8005\u51cf\u53bb\u7684\u6570\uff08\u8fd9\u91cc\u662f\u51cf\u53bb 0x4\uff0c\u4e5f\u5c31\u662f <code>A=-0x4</code>\uff09\uff0cP \u8868\u793a relocation \u81ea\u5df1\u7684\u5730\u5740\uff08<code>P=0x6</code>\uff09\u3002</p>\n<p>\u8ba1\u7b97\u7ed3\u679c\u548c\u4e4b\u524d\u6211\u4eec\u624b\u52a8\u63a8\u5bfc\u7684\u662f\u4e00\u81f4\u7684\uff0c\u770b\u8d77\u6765\u8fd9\u4e24\u4e2a\u8ba1\u7b97\u65b9\u6cd5\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u53cd\u6b63\u7ed3\u679c\u90fd\u4e00\u6837\uff1f\u533a\u522b\u5728\u4e8e\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0c\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u77e5\u9053\u6307\u4ee4\u662f\u4ec0\u4e48\uff0c\u4e0d\u7ba1\u662f\u4e0d\u662f <code>call</code> \u6307\u4ee4\uff0c\u53ea\u7ba1\u8ba1\u7b97\u548c\u586b\u6570\u3002\u90a3\u4e48\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\uff0c\u6216\u8bb8\u53ef\u4ee5\u590d\u7528\u76f8\u540c\u7684 relocation \u7c7b\u578b\u3002</p>\n</div>\n<p>relocation \u7684\u60c5\u51b5\u5206\u6790\u5b8c\u4e86\uff0c\u6211\u4eec\u5b66\u4e60\u5230\u6c47\u7f16\u5668\u5728\u9047\u5230\u5916\u90e8\u51fd\u6570\u65f6\uff0c\u5982\u4f55\u751f\u6210\u770b\u8d77\u6765\u9519\u8bef\u7684 <code>call</code> \u6307\u4ee4\uff0c\u53c8\u662f\u5982\u4f55\u8f93\u51fa relocation \u8ba9\u94fe\u63a5\u5668\u586b\u5165\u6b63\u786e\u7684\u504f\u79fb\uff0c\u4f7f\u5f97 <code>call</code> \u6307\u4ee4\u53ef\u4ee5\u8c03\u7528\u6b63\u786e\u7684\u51fd\u6570\u3002</p>\n<p>\u6b64\u65f6\u518d\u770b <code>printer.o</code> \u7684\u53cd\u6c47\u7f16\u7ed3\u679c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>-r<span class=\"w\"> </span>printer.o\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a>printer.o:<span class=\"w\">     </span>file<span class=\"w\"> </span>format<span class=\"w\"> </span>elf64-x86-64\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a>Disassembly<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>.text:\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a>\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>&lt;print&gt;:\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">   </span><span class=\"m\">0</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c7<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rdi\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">   </span><span class=\"m\">7</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c6<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x0,%rsi\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">                        </span>a:<span class=\"w\"> </span>R_X86_64_32S<span class=\"w\"> </span>.rodata\n</span><span id=\"__span-7-12\"><a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">   </span>e:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c2<span class=\"w\"> </span>0d<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>xd,%rdx\n</span><span id=\"__span-7-13\"><a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">  </span><span class=\"m\">15</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rax\n</span><span id=\"__span-7-14\"><a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">  </span>1c:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span><span id=\"__span-7-15\"><a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">  </span>1e:<span class=\"w\">   </span>c3<span class=\"w\">                      </span>ret\n</span><span id=\"__span-7-16\"><a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a>\n</span><span id=\"__span-7-17\"><a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a>000000000000001f<span class=\"w\"> </span>&lt;exit&gt;:\n</span><span id=\"__span-7-18\"><a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">  </span>1f:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span><span class=\"m\">31</span><span class=\"w\"> </span>ff<span class=\"w\">                </span>xor<span class=\"w\">    </span>%rdi,%rdi\n</span><span id=\"__span-7-19\"><a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">  </span><span class=\"m\">22</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span>3c<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x3c,%rax\n</span><span id=\"__span-7-20\"><a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">  </span><span class=\"m\">29</span>:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span></code></pre></div>\n<p>\u4e0d\u51fa\u610f\u5916\uff0c\u4e24\u4e2a\u51fd\u6570\u90fd\u51fa\u73b0\u4e86\uff0c\u540c\u65f6\u4e5f\u51fa\u73b0\u4e86\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\u63d0\u5230\u7684 <code>R_X86_64_32S</code> \u7684 relocation \u7c7b\u578b\u3002\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a relocation \u7684\u5730\u5740\u662f <code>0xa</code>\uff0c\u800c\u4e0d\u662f <code>mov</code> \u6307\u4ee4\u7684\u5730\u5740 <code>0x7</code>\uff0c\u806a\u660e\u7684\u4f60\u5e94\u8be5\u5df2\u7ecf\u89c2\u5bdf\u51fa\u6765\uff1a<code>mov</code> \u6307\u4ee4\u524d\u4e09\u4e2a\u5b57\u8282\u8868\u793a\u4e86\u8fd9\u662f\u4e00\u6761 <code>mov</code> \u6307\u4ee4\uff0c\u76ee\u7684\u5bc4\u5b58\u5668\u662f <code>%rsi</code>\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u5c31\u662f\u8981 <code>mov</code> \u7684\u7acb\u5373\u6570\uff0c\u6240\u4ee5 relocation \u76f4\u63a5\u6307\u5411\u4e86\u540e\u56db\u4e2a\u5b57\u8282\u7684\u5730\u5740\u3002\u94fe\u63a5\u5668\u4e0d\u9700\u8981\u53cd\u6c47\u7f16\uff0c\u4e0d\u9700\u8981\u77e5\u9053\u8fd9\u662f\u4e00\u6761 <code>mov</code> \u6307\u4ee4\uff0c\u53ea\u7ba1\u627e relocation \u5f80\u91cc\u586b\u3002</p>\n<h3 id=\"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\">\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5173\u4e8e\u4e24\u4e2a <code>.o</code> \u6587\u4ef6\u5206\u6790\u5f97\u5dee\u4e0d\u591a\u4e86\uff0c\u63a5\u4e0b\u6765\u770b\u6700\u540e\u8fd0\u884c <code>ld main.o printer.o -o helloworld</code> \u5f97\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"nl\">helloworld:</span><span class=\"w\">     </span><span class=\"nf\">file</span><span class=\"w\"> </span><span class=\"no\">format</span><span class=\"w\"> </span><span class=\"no\">elf64-x86-64</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"nf\">Disassembly</span><span class=\"w\"> </span><span class=\"no\">of</span><span class=\"w\"> </span><span class=\"no\">section</span><span class=\"w\"> </span><span class=\"no\">.text</span><span class=\"p\">:</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a>\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"err\">0000000000401000</span><span class=\"w\"> </span><span class=\"err\">&lt;</span><span class=\"nf\">_start</span><span class=\"err\">&gt;</span><span class=\"p\">:</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">  </span><span class=\"err\">401000:</span><span class=\"w\">       </span><span class=\"nf\">e8</span><span class=\"w\"> </span><span class=\"mi\">05</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"no\">call</span><span class=\"w\">   </span><span class=\"mh\">40100a</span> <span class=\"p\">&lt;</span><span class=\"no\">print</span><span class=\"p\">&gt;</span>\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">  </span><span class=\"err\">401005:</span><span class=\"w\">       </span><span class=\"nf\">e8</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"no\">f</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"no\">call</span><span class=\"w\">   </span><span class=\"mh\">401029</span> <span class=\"p\">&lt;</span><span class=\"no\">exit</span><span class=\"p\">&gt;</span>\n</span><span id=\"__span-8-9\"><a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a>\n</span><span id=\"__span-8-10\"><a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"err\">000000000040100</span><span class=\"nf\">a</span><span class=\"w\"> </span><span class=\"err\">&lt;</span><span class=\"no\">print</span><span class=\"err\">&gt;</span><span class=\"p\">:</span>\n</span><span id=\"__span-8-11\"><a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">  </span><span class=\"err\">40100</span><span class=\"nl\">a:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"nf\">c7</span><span class=\"w\"> </span><span class=\"no\">c7</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"no\">mov</span><span class=\"w\">    </span><span class=\"no\">$0x1</span><span class=\"p\">,</span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-8-12\"><a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"w\">  </span><span class=\"err\">401011:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"nf\">c7</span><span class=\"w\"> </span><span class=\"no\">c6</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"no\">mov</span><span class=\"w\">    </span><span class=\"no\">$0x402000</span><span class=\"p\">,</span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-8-13\"><a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">  </span><span class=\"err\">401018:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"nf\">c7</span><span class=\"w\"> </span><span class=\"no\">c2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"no\">d</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"no\">mov</span><span class=\"w\">    </span><span class=\"no\">$0xd</span><span class=\"p\">,</span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-8-14\"><a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">  </span><span class=\"err\">40101</span><span class=\"nl\">f:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"nf\">c7</span><span class=\"w\"> </span><span class=\"no\">c0</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"no\">mov</span><span class=\"w\">    </span><span class=\"no\">$0x1</span><span class=\"p\">,</span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-8-15\"><a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">  </span><span class=\"err\">401026:</span><span class=\"w\">       </span><span class=\"err\">0</span><span class=\"nf\">f</span><span class=\"w\"> </span><span class=\"mi\">05</span><span class=\"w\">                   </span><span class=\"no\">syscall</span>\n</span><span id=\"__span-8-16\"><a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">  </span><span class=\"err\">401028:</span><span class=\"w\">       </span><span class=\"nf\">c3</span><span class=\"w\">                      </span><span class=\"no\">ret</span>\n</span><span id=\"__span-8-17\"><a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a>\n</span><span id=\"__span-8-18\"><a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"err\">0000000000401029</span><span class=\"w\"> </span><span class=\"err\">&lt;</span><span class=\"nf\">exit</span><span class=\"err\">&gt;</span><span class=\"p\">:</span>\n</span><span id=\"__span-8-19\"><a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">  </span><span class=\"err\">401029:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"err\">31</span><span class=\"w\"> </span><span class=\"nf\">ff</span><span class=\"w\">                </span><span class=\"no\">xor</span><span class=\"w\">    </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-8-20\"><a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">  </span><span class=\"err\">40102</span><span class=\"nl\">c:</span><span class=\"w\">       </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"nf\">c7</span><span class=\"w\"> </span><span class=\"no\">c0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"no\">c</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"no\">mov</span><span class=\"w\">    </span><span class=\"no\">$0x3c</span><span class=\"p\">,</span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-8-21\"><a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a><span class=\"w\">  </span><span class=\"err\">401033:</span><span class=\"w\">       </span><span class=\"err\">0</span><span class=\"nf\">f</span><span class=\"w\"> </span><span class=\"mi\">05</span><span class=\"w\">                   </span><span class=\"no\">syscall</span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u5f97\u5230\u51e0\u70b9\u89c2\u5bdf\uff1a</p>\n<ol>\n<li><code>_start</code> \u51fd\u6570\u91cc\u51fd\u6570\u8c03\u7528\u7684\u6307\u4ee4 <code>call print</code> \u548c <code>call exit</code> \u5df2\u7ecf\u88ab\u94fe\u63a5\u5668\u4fee\u590d\uff0c<code>print</code> \u51fd\u6570\u5185\u5f15\u7528 <code>hello</code> \u5b57\u7b26\u4e32\u5730\u5740\u4e5f\u6b63\u786e\u88ab\u586b\u5199</li>\n<li>\u6765\u81ea\u4e24\u4e2a <code>.o</code> \u6587\u4ef6\u7684\u4ee3\u7801\u6bb5 <code>.text</code> \u7684\u5185\u5bb9\u88ab\u62fc\u63a5\u8d77\u6765\uff0c\u5f97\u5230\u4e86\u8f93\u51fa\u7684 ELF \u91cc\u7684 <code>.text</code> \u6bb5\u5185\u5bb9\uff1b\u7c7b\u4f3c\u5730\uff0c<code>printer.o</code> \u91cc\u9762\u7684\u53ea\u8bfb\u6570\u636e\u6bb5 <code>.rodata</code> \u7684\u5185\u5bb9\u4e5f\u590d\u5236\u5230\u4e86\u8f93\u51fa\u7684 ELF \u4e2d\uff0c\u5730\u5740\u662f <code>0x402000</code></li>\n<li>\u867d\u7136 <code>objdump</code> \u53c2\u6570\u91cc\u5199\u4e86 <code>-r</code>\uff0c\u8981\u6c42 <code>objdump</code> \u663e\u793a\u4ee3\u7801\u4e2d\u7684 relocation\uff0c\u4f46\u662f\u94fe\u63a5\u5668\u5df2\u7ecf\u5b8c\u6210\u4e86\u6240\u6709 relocation \u7684\u8ba1\u7b97\u5e76\u66f4\u65b0\u4e86\u5bf9\u5e94\u7684\u6570\uff0c\u56e0\u6b64\u8f93\u51fa\u7684 ELF \u91cc\u5c31\u6ca1\u6709 relocation \u4e86\u3002\u5728\u672a\u6765\u7684\u535a\u5ba2\u4e2d\uff0c\u6211\u4eec\u4f1a\u770b\u5230\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u4e5f\u53ef\u4ee5\u6709 relocation</li>\n</ol>\n<h3 id=\"\u5c0f\u7ed3\">\u5c0f\u7ed3<a class=\"headerlink\" href=\"#\u5c0f\u7ed3\" title=\"Permanent link\">&para;</a></h3>\n<p>\u6309\u7167\u8fd9\u4e9b\u89c2\u5bdf\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\uff0c\u4e3a\u4e86\u652f\u6301\u7b2c\u4e8c\u7248\u7684\u94fe\u63a5\u5668\uff0c\u4e5f\u5c31\u662f\u652f\u6301\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u4e2a .o \u6587\u4ef6\u7684\u94fe\u63a5\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u9700\u8981\u505a\u7684\u989d\u5916\u5de5\u4f5c\uff1a</p>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">\u5408\u5e76\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u7684\u540c\u4e00\u4e2a section</p>\n<p>\u4e0a\u9762\u5df2\u7ecf\u89c2\u5bdf\u5230\uff0c\u6765\u81ea\u4e0d\u540c .o \u7684 <code>.text</code> \u6bb5\u88ab\u5408\u5e76\u8d77\u6765\uff0c\u5199\u5165\u5230\u4e86\u6700\u7ec8\u8f93\u51fa\u7684 ELF \u7684 <code>.text</code> \u6bb5\u3002\u540c\u7406\uff0c\u5176\u4ed6\u9700\u8981\u8f93\u51fa\u5230\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u7684\u6bb5\uff0c\u4e5f\u9700\u8981\u5408\u5e76</p>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">\u5b8c\u5584\u6307\u5411 section \u7684 relocation \u7684\u5904\u7406</p>\n<p>\u4e0a\u4e00\u7bc7\u6587\u7ae0\u91cc\uff0c\u53ea\u6d89\u53ca\u5230\u4e00\u4e2a\u8f93\u5165\u7684 ELF object \u6587\u4ef6\uff0c\u5e76\u4e14\u4e5f\u53ea\u6d89\u53ca\u5230\u5bf9 section \u7684 relocation\uff0c\u6240\u4ee5\u6bcf\u4e2a section \u53ea\u6709\u4e00\u4efd\uff0c\u53ea\u9700\u8981\u4fdd\u5b58\u6bcf\u4e2a section \u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\u3002\u4f46\u6b64\u65f6\uff0c\u6bcf\u4e2a ELF object \u6587\u4ef6\u90fd\u53ef\u80fd\u6709\u81ea\u5df1\u7684 <code>.text</code> <code>.rodata</code> section\uff0c\u6b64\u65f6\u518d\u51fa\u73b0\u5bf9 section \u7684 relocation \u65f6\uff0c\u662f\u5bf9\u8f93\u5165\u7684 ELF object \u81ea\u5df1\u7684 <code>.rodata</code>\uff0c\u800c\u4e0d\u662f\u5bf9\u8f93\u51fa ELF executable \u7684 <code>.rodata</code>\u3002</p>\n<p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u5982\u679c <code>main.s</code> \u548c <code>printer.s</code> \u90fd\u5f80 <code>.rodata</code> \u6bb5\u5199\u4e86\u6570\u636e\uff0c\u5047\u5982 <code>main.s</code> \u4ea7\u751f\u4e86 0x10 \u5b57\u8282\u7684\u6570\u636e\uff0c<code>printer.s</code> \u4ea7\u751f\u4e86 0x20 \u5b57\u8282\u7684\u6570\u636e\uff0c\u5047\u8bbe\u8f93\u51fa\u7684 <code>.rodata</code> \u6bb5\u4ece <code>0x402000</code> \u5730\u5740\u5f00\u59cb\uff0c\u5148\u5b58 <code>main.o</code> \u7684 <code>.rodata</code> \u7684\u5185\u5bb9\uff0c\u518d\u5b58 <code>printer.o</code> \u7684 <code>.rodata</code> \u7684\u5185\u5bb9\uff0c\u90a3\u4e48 <code>printer.o</code> \u7684 <code>.rodata</code> \u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\u5c31\u662f <code>0x402000 + 0x10 = 0x402010</code>\u3002</p>\n<p>\u540c\u65f6\uff0c\u5728 <code>printer.o</code> \u4e2d\uff0c<code>print</code> \u51fd\u6570\u4ea7\u751f\u4e86\u5bf9 <code>.rodata</code> \u7684 relocation\uff0c\u5b9e\u9645\u4e0a\u662f\u8981\u5f97\u5230 <code>printer.o</code> \u7684 <code>.rodata</code> \u6bb5\u4e2d\u7684 <code>Hello world</code> \u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u5730\u5740\u3002\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u8ba1\u7b97 relocation \u7684\u65f6\u5019\uff0c\u5e94\u8be5\u7528 <code>0x402010</code>\uff08<code>printer.o</code> \u7684 <code>.rodata</code> \u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\uff09\uff0c\u800c\u4e0d\u662f <code>0x402000</code>\uff08\u8f93\u51fa\u7684 <code>.rodata</code> \u7684\u8d77\u59cb\u5730\u5740\uff09 \u4f5c\u4e3a <code>Hello world</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002</p>\n<p>\u7b80\u800c\u8a00\u4e4b\uff0c\u73b0\u5728\u9700\u8981\u8bb0\u5f55\u6765\u81ea\u4e0d\u540c .o \u6587\u4ef6\u7684 section \u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u5728\u5b9e\u73b0\u4e0a\u4e5f\u5e76\u4e0d\u590d\u6742\uff0c\u53ea\u662f\u4e0d\u8981\u5fd8\u8bb0\u8fd9\u4ef6\u4e8b\u60c5\u3002</p>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">\u89e3\u6790\u548c\u7ef4\u62a4\u7b26\u53f7\u8868\uff0c\u627e\u5230\u7b26\u53f7\u5bf9\u5e94\u7684\u5730\u5740</p>\n<p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u7b26\u53f7\u8868\uff0c\u8bb0\u5f55\u5404\u4e2a\u7b26\u53f7\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\uff0c\u90a3\u4e48\u540e\u7eed\u8ba1\u7b97 relocation \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u5730\u5740\u4f1a\u53c2\u4e0e\u5230\u8ba1\u7b97\u5f53\u4e2d\u3002</p>\n<p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c<code>main.s</code> \u548c <code>printer.s</code> \u90fd\u5f80 <code>.text</code> \u6bb5\u5199\u4e86\u6307\u4ee4\u3002<code>main.s</code> \u4ea7\u751f\u4e86 0xa \u5b57\u8282\u7684\u6307\u4ee4\uff0c<code>printer.s</code> \u4ea7\u751f\u4e86 0x2b \u5b57\u8282\u7684\u6307\u4ee4\u3002\u8f93\u51fa\u65f6\uff0c\u5047\u5982 <code>.text</code> \u6bb5\u4ece <code>0x401000</code> \u5f00\u59cb\uff0c\u6309\u7167\u4e0b\u9762\u7684\u903b\u8f91\u8ba1\u7b97\u5404\u4e2a\u7b26\u53f7\u7684\u5730\u5740\uff1a</p>\n<ol>\n<li>\u5148\u590d\u5236 <code>main.o</code> \u7684 <code>.text</code> \u4ee3\u7801\u6bb5\u7684\u5185\u5bb9\u5230\u8f93\u51fa\u7684 <code>.text</code> \u6bb5\uff0c\u6b64\u65f6\u8fd9\u90e8\u5206\u6307\u4ee4\u7684\u7684\u8d77\u59cb\u5185\u5b58\u5730\u5740\u5c31\u662f <code>0x401000</code></li>\n<li>\u7531\u4e8e <code>_start</code> \u51fd\u6570\u5728 <code>main.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x0</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x401000 + 0x0 = 0x401000</code></li>\n<li>\u63a5\u7740\u590d\u5236 <code>printer.o</code> \u7684 <code>.text</code> \u4ee3\u7801\u6bb5\u7684\u5185\u5bb9\u5230\u8f93\u51fa\u7684 <code>.text</code> \u6bb5\uff0c\u7531\u4e8e\u524d\u9762\u5df2\u7ecf\u6709 0xa \u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u6307\u4ee4\u7684\u8d77\u59cb\u5185\u5b58\u5730\u5740\u5c31\u662f <code>0x40100a</code></li>\n<li><code>print</code> \u51fd\u6570\u5728 <code>printer.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x0</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x40100a + 0x0 = 0x40100a</code></li>\n<li><code>exit</code> \u51fd\u6570\u5728 <code>printer.o</code> \u7684 <code>.text</code> \u6bb5\u5185\u7684\u504f\u79fb\u662f <code>0x1f</code>\uff0c\u6240\u4ee5\u5b83\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u5c31\u662f <code>0x40100a + 0x1f = 0x401029</code></li>\n</ol>\n<p>\u6240\u4ee5\u5728\u590d\u5236\u6bb5\u5185\u5bb9\u7684\u540c\u65f6\uff0c\u5404\u4e2a\u7b26\u53f7\u7684\u5730\u5740\u4e5f\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6765\u4e86\u3002\u6709\u4e86\u7b26\u53f7\u8868\u4ee5\u540e\uff0c\u4e4b\u540e\u8ba1\u7b97\u9488\u5bf9 <code>print</code> \u548c <code>exit</code> \u7684 relocation \u7684\u65f6\u5019\uff0c\u67e5\u7b26\u53f7\u8868\u5c31\u53ef\u4ee5\u77e5\u9053\u5730\u5740\u4e86\u3002</p>\n</div>\n<h2 id=\"\u5b9e\u73b0\">\u5b9e\u73b0<a class=\"headerlink\" href=\"#\u5b9e\u73b0\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7ed3\u5408\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0a\u4e00\u6b21\u535a\u5ba2\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7b2c\u4e8c\u7248\u7684\u94fe\u63a5\u5668\uff0c\u8fd9\u4e2a\u94fe\u63a5\u5668\u53ef\u4ee5\u652f\u6301\u8f93\u5165\u591a\u4e2a ELF .o \u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 400 \u884c\uff0c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u591a 200 \u884c\u3002</p>", "image": null, "date_modified": "2024-03-30T00:00:00+00:00", "authors": [], "tags": ["elf", "linker", "linux", "software", "write-a-linker"]}, {"id": "https://jia.je/software/2024/02/18/write-a-linker-1/", "url": "https://jia.je/software/2024/02/18/write-a-linker-1/", "title": "\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09", "content_html": "<h1 id=\"\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56681\">\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff081\uff09<a class=\"headerlink\" href=\"#\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u56681\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u524d\u8a00\">\u524d\u8a00<a class=\"headerlink\" href=\"#\u524d\u8a00\" title=\"Permanent link\">&para;</a></h2>\n<p>\u65e0\u8bba\u662f\u5728\u8bfe\u7a0b\u4e2d\u8fd8\u662f\u5b9e\u8df5\u4e2d\uff0c\u90fd\u7ecf\u5e38\u548c\u94fe\u63a5\u5668\u6253\u4ea4\u9053\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5927\u6982\u4e86\u89e3\u4e86\u5b83\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5bf9\u4e8e\u5e38\u89c1\u7684\u9519\u8bef\u53ef\u4ee5\u77e5\u9053\u5927\u6982\u662f\u600e\u4e48\u4e00\u56de\u4e8b\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u51b3\u3002\u4f46\u6700\u8fd1\u9047\u5230\u4e00\u4e9b\u6d89\u53ca\u5230\u94fe\u63a5\u5668\u5185\u90e8\u7684\u95ee\u9898\uff0c\u624d\u53d1\u73b0\u81ea\u5df1\u5bf9\u94fe\u63a5\u5668\u7684\u5185\u90e8\u7684\u4e86\u89e3\u8fd8\u662f\u6bd4\u8f83\u532e\u4e4f\u7684\u3002\u56e0\u6b64\u60f3\u5230\u81ea\u5df1\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff0c\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u5b66\u4e60\u3002</p>\n<!-- more -->\n\n<p>\u672c\u6587\u5047\u5b9a\u8bfb\u8005\u5df2\u7ecf\u5bf9\u94fe\u63a5\u5668\u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u4e86\u89e3\u94fe\u63a5\u7684\u5927\u81f4\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u5148\u5b66\u4e60\u7f51\u7edc\u4e0a\u7684\u8d44\u6599\u3002</p>\n<p>\u8fd9\u4e2a\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u535a\u5ba2\u7684\u76ee\u6807\u662f\uff1a\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u9759\u6001\u94fe\u63a5\u5668\uff0c\u8f93\u5165\u5355\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002</p>\n<h2 id=\"\u5206\u6790\">\u5206\u6790<a class=\"headerlink\" href=\"#\u5206\u6790\" title=\"Permanent link\">&para;</a></h2>\n<h3 id=\"\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6\">\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u5bf9\u8c61\u6587\u4ef6\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5f00\u53d1\u4e00\u4e2a\u94fe\u63a5\u5668\uff0c\u5148\u4ece\u6700\u7b80\u5355\u7684\u60c5\u51b5\u5f00\u59cb\uff1a\u8f93\u5165\u4e00\u4e2a ELF .o \u6587\u4ef6\uff0c\u8f93\u51fa\u4e00\u4e2a ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002\u4e3a\u4e86\u907f\u514d\u5f15\u5165 libc \u7b49\u4f9d\u8d56\uff0c\u4ece\u7f51\u4e0a\u627e\u4e86\u4e00\u6bb5\u76f4\u63a5\u7528 syscall \u6253\u5370\u5b57\u7b26\u4e32\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u505a\u4e86\u7b80\u5355\u4fee\u6539\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># From https://gist.github.com/adrianratnapala/1321776</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"c1\"># Hello World on amd64 under Linux.</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"c1\"># One way to build this is with: </span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"c1\">#    gcc hello.S  -s -nostartfiles -nostdlib -o hello</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"c1\">#</span>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"c1\"># for syscall numbers look in /usr/include/asm/unistd_64.h</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"c1\"># for examples look at http://99-bottles-of-beer.net/language-assembler-(amd64)-933.html</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"c1\"># for inspiration look at http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html</span>\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.rodata</span>\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"nl\">hello:</span>\n</span><span id=\"__span-0-14\"><a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">    </span><span class=\"na\">.string</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello world!\\n&quot;</span>\n</span><span id=\"__span-0-15\"><a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a>\n</span><span id=\"__span-0-16\"><a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a>\n</span><span id=\"__span-0-17\"><a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"no\">.text</span>\n</span><span id=\"__span-0-18\"><a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\"> </span><span class=\"no\">_start</span>\n</span><span id=\"__span-0-19\"><a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"nl\">_start:</span>\n</span><span id=\"__span-0-20\"><a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"w\">    </span><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-0-21\"><a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-22\"><a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-0-23\"><a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-0-24\"><a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-0-25\"><a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span><span id=\"__span-0-26\"><a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a>\n</span><span id=\"__span-0-27\"><a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\" href=\"#__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"c1\"># _exit(0)</span>\n</span><span id=\"__span-0-28\"><a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\" href=\"#__codelineno-0-28\"></a><span class=\"w\">    </span><span class=\"nf\">xor</span><span class=\"w\">     </span><span class=\"nv\">%rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-0-29\"><a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\" href=\"#__codelineno-0-29\"></a><span class=\"w\">    </span><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-0-30\"><a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\" href=\"#__codelineno-0-30\"></a><span class=\"w\">    </span><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<details class=\"question\">\n<summary>\u8fd9\u6bb5\u6c47\u7f16\u505a\u4e86\u4ec0\u4e48\uff1f</summary>\n<p>\u8fd9\u6bb5\u6c47\u7f16\u8981\u5b9e\u73b0\u7684\u662f\u5411\u6807\u51c6\u8f93\u51fa\u6253\u5370 <code>Hello world!\\n</code>\uff0c\u4f46\u4e3a\u4e86\u907f\u514d\u5f15\u5165 C \u6807\u51c6\u5e93\uff08libc\uff09\uff0c\u53ea\u80fd\u76f4\u63a5\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u6765\u5b8c\u6210\u6253\u5370\u3002\u5728 Linux \u4e2d\uff0c\u5411\u6807\u51c6\u8f93\u51fa\u6253\u5370\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5411\u6807\u51c6\u8f93\u51fa\u5bf9\u5e94\u7684 file handle\uff08\u7b80\u79f0 fd\uff0c\u901a\u5e38\u7ea6\u5b9a\u6807\u51c6\u8f93\u5165 stdin \u662f 0\uff0c\u6807\u51c6\u8f93\u51fa stdout \u662f 1\uff0c\u6807\u51c6\u9519\u8bef\u8f93\u51fa stderr \u662f 2\uff09\u5199\u5165\u8981\u6253\u5370\u7684\u5185\u5bb9\u3002\u800c\u8fd9\u4e2a\u9700\u8981\u901a\u8fc7\u8c03\u7528 <code>write</code> syscall \u6765\u5b9e\u73b0\u3002</p>\n<p>\u77e5\u9053\u8fd9\u4e00\u70b9\u4ee5\u540e\uff0c\u5c31\u8981\u53bb\u67e5\u627e Linux \u7684 <a href=\"https://man7.org/linux/man-pages/man2/write.2.html\">write syscall</a> \u7684\u6587\u6863\u3002\u6587\u6863\u544a\u8bc9\u4f60\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f <code>fd</code>\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>buf</code> \u6307\u5411\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570 <code>count</code> \u662f\u8981\u5199\u5165\u7684\u6570\u636e\u7684\u957f\u5ea6\u3002\u7ed3\u5408\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u4e3a\u4e86\u6253\u5370 <code>Hello world!\\n</code>\uff0c\u5b9e\u9645\u4e0a\u8981\u5b8c\u6210\u7684\u76f8\u5f53\u4e8e\u662f C \u4ee3\u7801\u4e2d\u7684 <code>write(1, hello, 13)</code>\uff0c\u5176\u4e2d 1 \u5c31\u662f stdout \u7684 fd\uff0c<code>hello</code> \u6307\u5411\u4fdd\u5b58 <code>Hello world!\\n</code> \u5b57\u7b26\u4e32\u7684\u5730\u5740\uff0c13 \u662f\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u8981\u7814\u7a76\uff0c\u5982\u4f55\u7528\u6c47\u7f16\u8c03\u7528 syscall\u3002</p>\n<p>\u63a5\u4e0b\u6765\uff0c\u8981\u77e5\u9053\u5728 amd64 Linux \u4e0b\uff0c\u5982\u4f55\u7528\u6c47\u7f16\u8c03\u7528 syscall\u3002\u9996\u5148\u627e\u5230 <a href=\"https://www.ucw.cz/~hubicka/papers/abi/node33.html#features\">amd64 Linux syscall \u8c03\u7528\u7ea6\u5b9a</a>\uff0c\u5b83\u544a\u8bc9\u6211\u4eec\uff1a</p>\n<ol>\n<li>syscall \u7f16\u53f7\u4fdd\u5b58\u5728 rax \u5bc4\u5b58\u5668\u4e2d</li>\n<li>syscall \u7684\u53c2\u6570\u6309\u987a\u5e8f\uff0c\u4f9d\u6b21\u4fdd\u5b58\u5728 rdi, rsi, rdx, r10, r8, r9 \u5bc4\u5b58\u5668\u4e2d</li>\n<li>\u7528 syscall \u6307\u4ee4\u8c03\u7528 syscall</li>\n<li>syscall \u7684\u8fd4\u56de\u503c\u4e5f\u4f1a\u4fdd\u5b58\u5728 rax \u5bc4\u5b58\u5668\u4e2d</li>\n</ol>\n<p>\u65e2\u7136\u8981\u8c03\u7528 <code>write(1, hello, 13)</code>\uff0c\u90a3\u5c31\u6309\u7167\u4e0a\u9762\u7684\u8981\u6c42\uff0c\u8bbe\u7f6e <code>rdi=1</code>\u3001<code>rsi=hello</code> \u548c <code>rdx=13</code>\uff0c\u6700\u540e\u5728 <a href=\"https://filippo.io/linux-syscall-table/\">amd64 Linux syscall table</a> \u4e2d\u627e\u5230 <code>write</code> syscall \u7684\u7f16\u53f7\u662f 1\uff0c\u6240\u4ee5\u8bbe\u7f6e <code>rax=1</code>\u3002\u5230\u8fd9\u91cc\uff0c\u8c03\u7528 <code>write</code> syscall \u7684\u6240\u6709\u51c6\u5907\u4efb\u52a1\u90fd\u5df2\u7ecf\u5b8c\u6210\uff0c\u8c03\u7528 <code>syscall</code> \u6307\u4ee4\u5373\u53ef\u5b8c\u6210\u7cfb\u7edf\u8c03\u7528\u3002\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u4e00\u6b21 <code>Hello world!\\n</code> \u7684\u6253\u5370\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\"># write(1, hello, 13)</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdi</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rsi</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rdx</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"nf\">mov</span><span class=\"w\">     </span><span class=\"no\">$1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">%rax</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"nf\">syscall</span>\n</span></code></pre></div>\n<p>\u540e\u9762 <code>exit(0)</code> \u7684\u7cfb\u7edf\u8c03\u7528\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\u4ee3\u7801\u4e2d\u5199 <code>_exit(0)</code> \u662f\u4e3a\u4e86\u548c C \u6807\u51c6\u5e93\u4e2d\u7684 <code>exit(0)</code> \u505a\u533a\u5206\uff1a\u524d\u8005\u76f4\u63a5\u9000\u51fa\u7a0b\u5e8f\uff08\u53ea\u4f1a\u7ed3\u675f\u5f53\u524d\u7ebf\u7a0b\uff0c\u4f46\u662f\u7531\u4e8e\u5f53\u524d\u8fdb\u7a0b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u6574\u4e2a\u8fdb\u7a0b\u90fd\u7ed3\u675f\u4e86\uff09\uff0c\u800c\u540e\u8005\u4f1a\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u89c1 <a href=\"https://man7.org/linux/man-pages/man2/exit.2.html\">_exit manpage</a>\u3002</p>\n</details>\n<p>\u7531\u4e8e\u662f\u6c47\u7f16\u4ee3\u7801\uff0c\u6240\u4ee5\u76f4\u63a5\u8c03\u7528\u6c47\u7f16\u5668\u751f\u6210 ELF .o \u6587\u4ef6\uff0c\u7136\u540e\u89c2\u5bdf\u5b83\u7684\u5185\u5bb9\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\"># Use assembler (GNU as) to assemble</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>$<span class=\"w\"> </span>as<span class=\"w\"> </span>helloworld_asm.s<span class=\"w\"> </span>-o<span class=\"w\"> </span>helloworld_asm.o\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"c1\"># readelf -a, --all: Equivalent to: -h -l -S -s -r -d -V -A -I</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"c1\">#         -h, --file-header: Display the ELF file header</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"c1\">#         -l, --program-headers: Display the program headers</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"c1\">#         -S, --section-headers: Display the sections&#39; header</span>\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"c1\">#         -s, --syms: Display the symbol table</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"c1\">#         -r, --relocs: Display the relocations (if present)</span>\n</span><span id=\"__span-2-9\"><a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"c1\">#         -d, --dynamic: Display the dynamic section (if present)</span>\n</span><span id=\"__span-2-10\"><a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"c1\">#         -V, --version-info: Display the version sections (if present)</span>\n</span><span id=\"__span-2-11\"><a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"c1\">#         -A, --arch-specific: Display architecture specific information (if any)</span>\n</span><span id=\"__span-2-12\"><a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"c1\">#         -I, --histogram: Display histogram of bucket list lengths</span>\n</span><span id=\"__span-2-13\"><a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a>$<span class=\"w\"> </span>readelf<span class=\"w\"> </span>-a<span class=\"w\"> </span>helloworld_asm.o\n</span><span id=\"__span-2-14\"><a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"c1\"># Output is shown below</span>\n</span></code></pre></div>\n<p>\u4e0b\u9762\u89c2\u5bdf readelf \u547d\u4ee4\u7684\u8f93\u51fa\uff0c\u9996\u5148\u662f ELF \u7684\u5934\u90e8\uff0c\u4ea4\u4ee3\u4e86\u6587\u4ef6\u7c7b\u578b\uff0c\u6267\u884c\u5728\u4ec0\u4e48\u6307\u4ee4\u96c6\u67b6\u6784\u4e0a\u7b49\u7b49\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>ELF<span class=\"w\"> </span>Header:\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">  </span>Magic:<span class=\"w\">   </span>7f<span class=\"w\"> </span><span class=\"m\">45</span><span class=\"w\"> </span>4c<span class=\"w\"> </span><span class=\"m\">46</span><span class=\"w\"> </span><span class=\"m\">02</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">  </span>Class:<span class=\"w\">                             </span>ELF64\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">  </span>Data:<span class=\"w\">                              </span><span class=\"m\">2</span><span class=\"err\">&#39;</span>s<span class=\"w\"> </span>complement,<span class=\"w\"> </span>little<span class=\"w\"> </span>endian\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>current<span class=\"o\">)</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">  </span>OS/ABI:<span class=\"w\">                            </span>UNIX<span class=\"w\"> </span>-<span class=\"w\"> </span>System<span class=\"w\"> </span>V\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">  </span>ABI<span class=\"w\"> </span>Version:<span class=\"w\">                       </span><span class=\"m\">0</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">  </span>Type:<span class=\"w\">                              </span>REL<span class=\"w\"> </span><span class=\"o\">(</span>Relocatable<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">  </span>Machine:<span class=\"w\">                           </span>Advanced<span class=\"w\"> </span>Micro<span class=\"w\"> </span>Devices<span class=\"w\"> </span>X86-64\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span>0x1\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">  </span>Entry<span class=\"w\"> </span>point<span class=\"w\"> </span>address:<span class=\"w\">               </span>0x0\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">320</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">  </span>Flags:<span class=\"w\">                             </span>0x0\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>this<span class=\"w\"> </span>header:<span class=\"w\">               </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">0</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">9</span>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">  </span>Section<span class=\"w\"> </span>header<span class=\"w\"> </span>string<span class=\"w\"> </span>table<span class=\"w\"> </span>index:<span class=\"w\"> </span><span class=\"m\">8</span>\n</span></code></pre></div>\n<p>\u63a5\u4e0b\u6765\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u90e8\u5206\uff0cELF \u5305\u62ec\u591a\u4e2a section\uff0c\u6839\u636e\u7528\u9014\uff0c\u4e0d\u540c\u7684\u6307\u4ee4\u548c\u6570\u636e\u4f1a\u653e\u5728\u5bf9\u5e94\u7684 section \u4e2d\uff0c\u4f8b\u5982 .text \u5b58\u653e\u6307\u4ee4\uff0c.data .bss .rodata \u5b58\u653e\u5404\u79cd\u6570\u636e\uff0c.rela \u5b58\u653e\u91cd\u5b9a\u4f4d\uff08relocation\uff09\u3002</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>Section<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">  </span><span class=\"o\">[</span>Nr<span class=\"o\">]</span><span class=\"w\"> </span>Name<span class=\"w\">              </span>Type<span class=\"w\">             </span>Address<span class=\"w\">           </span>Offset\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">       </span>Size<span class=\"w\">              </span>EntSize<span class=\"w\">          </span>Flags<span class=\"w\">  </span>Link<span class=\"w\">  </span>Info<span class=\"w\">  </span>Align\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"o\">]</span><span class=\"w\">                   </span>NULL<span class=\"w\">             </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000000</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">]</span><span class=\"w\"> </span>.text<span class=\"w\">             </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000040</span>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">       </span>000000000000002a<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>AX<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">]</span><span class=\"w\"> </span>.rela.text<span class=\"w\">        </span>RELA<span class=\"w\">             </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000000e8\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000018</span><span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">   </span>I<span class=\"w\">       </span><span class=\"m\">6</span><span class=\"w\">     </span><span class=\"m\">1</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"o\">]</span><span class=\"w\"> </span>.data<span class=\"w\">             </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>0000006a\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>WA<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"o\">]</span><span class=\"w\"> </span>.bss<span class=\"w\">              </span>NOBITS<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>0000006a\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>WA<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"o\">]</span><span class=\"w\"> </span>.rodata<span class=\"w\">           </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>0000006a\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">       </span>000000000000000e<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">6</span><span class=\"o\">]</span><span class=\"w\"> </span>.symtab<span class=\"w\">           </span>SYMTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000078</span>\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000060</span><span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">           </span><span class=\"m\">7</span><span class=\"w\">     </span><span class=\"m\">3</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">7</span><span class=\"o\">]</span><span class=\"w\"> </span>.strtab<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000000d8\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">       </span>000000000000000e<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">8</span><span class=\"o\">]</span><span class=\"w\"> </span>.shstrtab<span class=\"w\">         </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000100</span>\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000039</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a>Key<span class=\"w\"> </span>to<span class=\"w\"> </span>Flags:\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">  </span>W<span class=\"w\"> </span><span class=\"o\">(</span>write<span class=\"o\">)</span>,<span class=\"w\"> </span>A<span class=\"w\"> </span><span class=\"o\">(</span>alloc<span class=\"o\">)</span>,<span class=\"w\"> </span>X<span class=\"w\"> </span><span class=\"o\">(</span>execute<span class=\"o\">)</span>,<span class=\"w\"> </span>M<span class=\"w\"> </span><span class=\"o\">(</span>merge<span class=\"o\">)</span>,<span class=\"w\"> </span>S<span class=\"w\"> </span><span class=\"o\">(</span>strings<span class=\"o\">)</span>,<span class=\"w\"> </span>I<span class=\"w\"> </span><span class=\"o\">(</span>info<span class=\"o\">)</span>,\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">  </span>L<span class=\"w\"> </span><span class=\"o\">(</span>link<span class=\"w\"> </span>order<span class=\"o\">)</span>,<span class=\"w\"> </span>O<span class=\"w\"> </span><span class=\"o\">(</span>extra<span class=\"w\"> </span>OS<span class=\"w\"> </span>processing<span class=\"w\"> </span>required<span class=\"o\">)</span>,<span class=\"w\"> </span>G<span class=\"w\"> </span><span class=\"o\">(</span>group<span class=\"o\">)</span>,<span class=\"w\"> </span>T<span class=\"w\"> </span><span class=\"o\">(</span>TLS<span class=\"o\">)</span>,\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">  </span>C<span class=\"w\"> </span><span class=\"o\">(</span>compressed<span class=\"o\">)</span>,<span class=\"w\"> </span>x<span class=\"w\"> </span><span class=\"o\">(</span>unknown<span class=\"o\">)</span>,<span class=\"w\"> </span>o<span class=\"w\"> </span><span class=\"o\">(</span>OS<span class=\"w\"> </span>specific<span class=\"o\">)</span>,<span class=\"w\"> </span>E<span class=\"w\"> </span><span class=\"o\">(</span>exclude<span class=\"o\">)</span>,\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">  </span>D<span class=\"w\"> </span><span class=\"o\">(</span>mbind<span class=\"o\">)</span>,<span class=\"w\"> </span>l<span class=\"w\"> </span><span class=\"o\">(</span>large<span class=\"o\">)</span>,<span class=\"w\"> </span>p<span class=\"w\"> </span><span class=\"o\">(</span>processor<span class=\"w\"> </span>specific<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>\u90a3\u4e48\u94fe\u63a5\u5668\u9700\u8981\u7279\u522b\u5173\u6ce8\u548c\u5904\u7406\u7684\u5c31\u662f\u91cc\u9762\u7684 relocation \u4ee5\u53ca\u7b26\u53f7\u8868\uff08Symbol table\uff09\u4e86\uff1a\u5728\u6c47\u7f16\u751f\u6210 .o \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6307\u4ee4\u5f15\u7528\u4e86\u6570\u636e\uff08\"Hello world!\\n\"\uff09\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u63d0\u524d\u77e5\u9053\u6570\u636e\u6240\u5904\u7684\u5730\u5740\uff0c\u56e0\u6b64\u6c47\u7f16\u5668\u4f1a\u751f\u6210\u4e00\u4e2a relocation \u6761\u76ee\uff0c\u4e5f\u5c31\u662f\u4e0b\u9762\u7684 <code>R_X86_64_32S</code>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>Relocation<span class=\"w\"> </span>section<span class=\"w\"> </span><span class=\"s1\">&#39;.rela.text&#39;</span><span class=\"w\"> </span>at<span class=\"w\"> </span>offset<span class=\"w\"> </span>0xe8<span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span>entry:\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"w\">  </span>Offset<span class=\"w\">          </span>Info<span class=\"w\">           </span>Type<span class=\"w\">           </span>Sym.<span class=\"w\"> </span>Value<span class=\"w\">    </span>Sym.<span class=\"w\"> </span>Name<span class=\"w\"> </span>+<span class=\"w\"> </span>Addend\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>00000000000a<span class=\"w\">  </span>00010000000b<span class=\"w\"> </span>R_X86_64_32S<span class=\"w\">      </span><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>.rodata<span class=\"w\"> </span>+<span class=\"w\"> </span><span class=\"m\">0</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a>No<span class=\"w\"> </span>processor<span class=\"w\"> </span>specific<span class=\"w\"> </span>unwind<span class=\"w\"> </span>information<span class=\"w\"> </span>to<span class=\"w\"> </span>decode\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>Symbol<span class=\"w\"> </span>table<span class=\"w\"> </span><span class=\"s1\">&#39;.symtab&#39;</span><span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>entries:\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">   </span>Num:<span class=\"w\">    </span>Value<span class=\"w\">          </span>Size<span class=\"w\"> </span>Type<span class=\"w\">    </span>Bind<span class=\"w\">   </span>Vis<span class=\"w\">      </span>Ndx<span class=\"w\"> </span>Name\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">     </span><span class=\"m\">0</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">  </span>UND<span class=\"w\"> </span>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">     </span><span class=\"m\">1</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>SECTION<span class=\"w\"> </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span>.rodata\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">     </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>LOCAL<span class=\"w\">  </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">5</span><span class=\"w\"> </span>hello\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">     </span><span class=\"m\">3</span>:<span class=\"w\"> </span><span class=\"m\">0000000000000000</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\"> </span>NOTYPE<span class=\"w\">  </span>GLOBAL<span class=\"w\"> </span>DEFAULT<span class=\"w\">    </span><span class=\"m\">1</span><span class=\"w\"> </span>_start\n</span></code></pre></div>\n<p>\u800c\u5f53\u94fe\u63a5\u5668\u786e\u5b9a\u4e86\u4ee3\u7801\u548c\u6570\u636e\u7684\u5730\u5740\u4ee5\u540e\uff0c\u53d1\u73b0\u90e8\u5206 relocation \u7684\u5730\u5740\u5df2\u7ecf\u53ef\u4ee5\u786e\u5b9a\u4e0b\u6765\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u5730\u5740\u5199\u5165\u5230\u6307\u4ee4\u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u52a8\u6001\u7684 relocation\u3002\u7b26\u53f7\u8868\u5219\u63d0\u4f9b\u4e86\u7b26\u53f7\u5230\u5730\u5740\u7684\u6620\u5c04\uff0c\u505a\u7b26\u53f7\u89e3\u6790\u7684\u65f6\u5019\u4f1a\u7528\u5230\u3002</p>\n<h3 id=\"\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\">\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6<a class=\"headerlink\" href=\"#\u89c2\u5bdf\u53ef\u6267\u884c\u6587\u4ef6\" title=\"Permanent link\">&para;</a></h3>\n<p>\u4e0b\u9762\u6211\u4eec\u8981\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff0c\u5c31\u628a\u8fd9\u4e00\u4e2a ELF .o \u751f\u6210\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002\u53ef\u4ee5\u5148\u8ba9\u73b0\u6709\u7684 ld \u94fe\u63a5\u51fa\u6765\uff0c\u770b\u770b\u5b83\u7684\u6700\u7ec8\u6548\u679c\u662f\u4ec0\u4e48\u6837\u7684\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\"># Use ld (GNU ld.bfd) to link</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>$<span class=\"w\"> </span>ld<span class=\"w\"> </span>helloworld_asm.o<span class=\"w\"> </span>-o<span class=\"w\"> </span>helloworld_asm\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a>$<span class=\"w\"> </span>readelf<span class=\"w\"> </span>-a<span class=\"w\"> </span>helloworld_asm\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"c1\"># Output is shown below</span>\n</span></code></pre></div>\n<p>\u9996\u5148\u662f ELF \u7684\u5934\u90e8\uff0c\u8fd9\u6b21\u53ef\u4ee5\u770b\u5230\u6587\u4ef6\u7c7b\u578b\u53d8\u6210\u4e86\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u4e14\u6709\u4e86\u4e00\u4e2a\u5165\u53e3\u5730\u5740\uff080x401000\uff09\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>ELF<span class=\"w\"> </span>Header:\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"w\">  </span>Magic:<span class=\"w\">   </span>7f<span class=\"w\"> </span><span class=\"m\">45</span><span class=\"w\"> </span>4c<span class=\"w\"> </span><span class=\"m\">46</span><span class=\"w\"> </span><span class=\"m\">02</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">  </span>Class:<span class=\"w\">                             </span>ELF64\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">  </span>Data:<span class=\"w\">                              </span><span class=\"m\">2</span><span class=\"err\">&#39;</span>s<span class=\"w\"> </span>complement,<span class=\"w\"> </span>little<span class=\"w\"> </span>endian\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>current<span class=\"o\">)</span>\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">  </span>OS/ABI:<span class=\"w\">                            </span>UNIX<span class=\"w\"> </span>-<span class=\"w\"> </span>System<span class=\"w\"> </span>V\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">  </span>ABI<span class=\"w\"> </span>Version:<span class=\"w\">                       </span><span class=\"m\">0</span>\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">  </span>Type:<span class=\"w\">                              </span>EXEC<span class=\"w\"> </span><span class=\"o\">(</span>Executable<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">  </span>Machine:<span class=\"w\">                           </span>Advanced<span class=\"w\"> </span>Micro<span class=\"w\"> </span>Devices<span class=\"w\"> </span>X86-64\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">  </span>Version:<span class=\"w\">                           </span>0x1\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">  </span>Entry<span class=\"w\"> </span>point<span class=\"w\"> </span>address:<span class=\"w\">               </span>0x401000\n</span><span id=\"__span-7-12\"><a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-7-13\"><a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">  </span>Start<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">          </span><span class=\"m\">8472</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"w\"> </span>into<span class=\"w\"> </span>file<span class=\"o\">)</span>\n</span><span id=\"__span-7-14\"><a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">  </span>Flags:<span class=\"w\">                             </span>0x0\n</span><span id=\"__span-7-15\"><a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>this<span class=\"w\"> </span>header:<span class=\"w\">               </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-7-16\"><a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">56</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-7-17\"><a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>program<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">3</span>\n</span><span id=\"__span-7-18\"><a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">  </span>Size<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">           </span><span class=\"m\">64</span><span class=\"w\"> </span><span class=\"o\">(</span>bytes<span class=\"o\">)</span>\n</span><span id=\"__span-7-19\"><a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">  </span>Number<span class=\"w\"> </span>of<span class=\"w\"> </span>section<span class=\"w\"> </span>headers:<span class=\"w\">         </span><span class=\"m\">6</span>\n</span><span id=\"__span-7-20\"><a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">  </span>Section<span class=\"w\"> </span>header<span class=\"w\"> </span>string<span class=\"w\"> </span>table<span class=\"w\"> </span>index:<span class=\"w\"> </span><span class=\"m\">5</span>\n</span></code></pre></div>\n<p>\u800c section \u4e5f\u53d8\u5f97\u66f4\u5c11\uff1a\u6ca1\u7528\u5230\u7684 .data .bss \u6bb5\u90fd\u5220\u6389\u4e86\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u4e86 relocation\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fd9\u4e2a\u7a0b\u5e8f\u91cc\u6240\u6709\u7684 relocation \u90fd\u662f\u5185\u90e8\u7684\uff0c\u94fe\u63a5\u7684\u65f6\u5019\u5c31\u76f4\u63a5\u8ba1\u7b97\u51fa\u5730\u5740\u4e86\u5e76\u586b\u8fdb\u53bb\u4e86\u3002</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>Section<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"w\">  </span><span class=\"o\">[</span>Nr<span class=\"o\">]</span><span class=\"w\"> </span>Name<span class=\"w\">              </span>Type<span class=\"w\">             </span>Address<span class=\"w\">           </span>Offset\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">       </span>Size<span class=\"w\">              </span>EntSize<span class=\"w\">          </span>Flags<span class=\"w\">  </span>Link<span class=\"w\">  </span>Info<span class=\"w\">  </span>Align\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"o\">]</span><span class=\"w\">                   </span>NULL<span class=\"w\">             </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00000000</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span>\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">]</span><span class=\"w\"> </span>.text<span class=\"w\">             </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000401000</span><span class=\"w\">  </span><span class=\"m\">00001000</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">       </span>000000000000002a<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>AX<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">]</span><span class=\"w\"> </span>.rodata<span class=\"w\">           </span>PROGBITS<span class=\"w\">         </span><span class=\"m\">0000000000402000</span><span class=\"w\">  </span><span class=\"m\">00002000</span>\n</span><span id=\"__span-8-9\"><a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"w\">       </span>000000000000000e<span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">   </span>A<span class=\"w\">       </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-8-10\"><a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"o\">]</span><span class=\"w\"> </span>.symtab<span class=\"w\">           </span>SYMTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span><span class=\"m\">00002010</span>\n</span><span id=\"__span-8-11\"><a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">       </span>00000000000000a8<span class=\"w\">  </span><span class=\"m\">0000000000000018</span><span class=\"w\">           </span><span class=\"m\">4</span><span class=\"w\">     </span><span class=\"m\">3</span><span class=\"w\">     </span><span class=\"m\">8</span>\n</span><span id=\"__span-8-12\"><a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"o\">]</span><span class=\"w\"> </span>.strtab<span class=\"w\">           </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000020b8\n</span><span id=\"__span-8-13\"><a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000030</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-8-14\"><a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"o\">]</span><span class=\"w\"> </span>.shstrtab<span class=\"w\">         </span>STRTAB<span class=\"w\">           </span><span class=\"m\">0000000000000000</span><span class=\"w\">  </span>000020e8\n</span><span id=\"__span-8-15\"><a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">       </span><span class=\"m\">0000000000000029</span><span class=\"w\">  </span><span class=\"m\">0000000000000000</span><span class=\"w\">           </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">1</span>\n</span><span id=\"__span-8-16\"><a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a>Key<span class=\"w\"> </span>to<span class=\"w\"> </span>Flags:\n</span><span id=\"__span-8-17\"><a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a><span class=\"w\">  </span>W<span class=\"w\"> </span><span class=\"o\">(</span>write<span class=\"o\">)</span>,<span class=\"w\"> </span>A<span class=\"w\"> </span><span class=\"o\">(</span>alloc<span class=\"o\">)</span>,<span class=\"w\"> </span>X<span class=\"w\"> </span><span class=\"o\">(</span>execute<span class=\"o\">)</span>,<span class=\"w\"> </span>M<span class=\"w\"> </span><span class=\"o\">(</span>merge<span class=\"o\">)</span>,<span class=\"w\"> </span>S<span class=\"w\"> </span><span class=\"o\">(</span>strings<span class=\"o\">)</span>,<span class=\"w\"> </span>I<span class=\"w\"> </span><span class=\"o\">(</span>info<span class=\"o\">)</span>,\n</span><span id=\"__span-8-18\"><a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"w\">  </span>L<span class=\"w\"> </span><span class=\"o\">(</span>link<span class=\"w\"> </span>order<span class=\"o\">)</span>,<span class=\"w\"> </span>O<span class=\"w\"> </span><span class=\"o\">(</span>extra<span class=\"w\"> </span>OS<span class=\"w\"> </span>processing<span class=\"w\"> </span>required<span class=\"o\">)</span>,<span class=\"w\"> </span>G<span class=\"w\"> </span><span class=\"o\">(</span>group<span class=\"o\">)</span>,<span class=\"w\"> </span>T<span class=\"w\"> </span><span class=\"o\">(</span>TLS<span class=\"o\">)</span>,\n</span><span id=\"__span-8-19\"><a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">  </span>C<span class=\"w\"> </span><span class=\"o\">(</span>compressed<span class=\"o\">)</span>,<span class=\"w\"> </span>x<span class=\"w\"> </span><span class=\"o\">(</span>unknown<span class=\"o\">)</span>,<span class=\"w\"> </span>o<span class=\"w\"> </span><span class=\"o\">(</span>OS<span class=\"w\"> </span>specific<span class=\"o\">)</span>,<span class=\"w\"> </span>E<span class=\"w\"> </span><span class=\"o\">(</span>exclude<span class=\"o\">)</span>,\n</span><span id=\"__span-8-20\"><a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">  </span>D<span class=\"w\"> </span><span class=\"o\">(</span>mbind<span class=\"o\">)</span>,<span class=\"w\"> </span>l<span class=\"w\"> </span><span class=\"o\">(</span>large<span class=\"o\">)</span>,<span class=\"w\"> </span>p<span class=\"w\"> </span><span class=\"o\">(</span>processor<span class=\"w\"> </span>specific<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6bd4\u8f83\u7279\u6b8a\u7684\u70b9\uff0c\u5b83\u6709 segment \u7684\u6982\u5ff5\uff0c\u6307\u793a\u5185\u6838\u5e94\u8be5\u600e\u6837\u628a\u7a0b\u5e8f\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>Program<span class=\"w\"> </span>Headers:\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"w\">  </span>Type<span class=\"w\">           </span>Offset<span class=\"w\">             </span>VirtAddr<span class=\"w\">           </span>PhysAddr\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">                 </span>FileSiz<span class=\"w\">            </span>MemSiz<span class=\"w\">              </span>Flags<span class=\"w\">  </span>Align\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000000000<span class=\"w\"> </span>0x0000000000400000<span class=\"w\"> </span>0x0000000000400000\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"w\">                 </span>0x00000000000000e8<span class=\"w\"> </span>0x00000000000000e8<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1000\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000001000<span class=\"w\"> </span>0x0000000000401000<span class=\"w\"> </span>0x0000000000401000\n</span><span id=\"__span-9-7\"><a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"w\">                 </span>0x000000000000002a<span class=\"w\"> </span>0x000000000000002a<span class=\"w\">  </span>R<span class=\"w\"> </span>E<span class=\"w\">    </span>0x1000\n</span><span id=\"__span-9-8\"><a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"w\">  </span>LOAD<span class=\"w\">           </span>0x0000000000002000<span class=\"w\"> </span>0x0000000000402000<span class=\"w\"> </span>0x0000000000402000\n</span><span id=\"__span-9-9\"><a id=\"__codelineno-9-9\" name=\"__codelineno-9-9\" href=\"#__codelineno-9-9\"></a><span class=\"w\">                 </span>0x000000000000000e<span class=\"w\"> </span>0x000000000000000e<span class=\"w\">  </span>R<span class=\"w\">      </span>0x1000\n</span><span id=\"__span-9-10\"><a id=\"__codelineno-9-10\" name=\"__codelineno-9-10\" href=\"#__codelineno-9-10\"></a>\n</span><span id=\"__span-9-11\"><a id=\"__codelineno-9-11\" name=\"__codelineno-9-11\" href=\"#__codelineno-9-11\"></a><span class=\"w\"> </span>Section<span class=\"w\"> </span>to<span class=\"w\"> </span>Segment<span class=\"w\"> </span>mapping:\n</span><span id=\"__span-9-12\"><a id=\"__codelineno-9-12\" name=\"__codelineno-9-12\" href=\"#__codelineno-9-12\"></a><span class=\"w\">  </span>Segment<span class=\"w\"> </span>Sections...\n</span><span id=\"__span-9-13\"><a id=\"__codelineno-9-13\" name=\"__codelineno-9-13\" href=\"#__codelineno-9-13\"></a><span class=\"w\">   </span><span class=\"m\">00</span><span class=\"w\">     </span>\n</span><span id=\"__span-9-14\"><a id=\"__codelineno-9-14\" name=\"__codelineno-9-14\" href=\"#__codelineno-9-14\"></a><span class=\"w\">   </span><span class=\"m\">01</span><span class=\"w\">     </span>.text<span class=\"w\"> </span>\n</span><span id=\"__span-9-15\"><a id=\"__codelineno-9-15\" name=\"__codelineno-9-15\" href=\"#__codelineno-9-15\"></a><span class=\"w\">   </span><span class=\"m\">02</span><span class=\"w\">     </span>.rodata<span class=\"w\"> </span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6307\u793a\u5185\u6838\u4ece\u6587\u4ef6\u7684\u4e09\u4e2a\u504f\u79fb\u5904\u52a0\u8f7d\u4e09\u4e2a\u90e8\u5206\u5185\u5bb9\u5230\u5185\u5b58\u91cc\uff0c\u5206\u522b\u662f\u6587\u4ef6\u5934\u3001.text \u6bb5\u4ee5\u53ca .rodata \u6bb5\u3002\u52a0\u8f7d\u5b8c\u4ee5\u540e\uff0c\u5185\u6838\u4ece\u5934\u90e8\u91cc\u5199\u7684\u5165\u53e3\u5730\u5740\u5f00\u59cb\u6267\u884c\uff0c\u5c31\u53ef\u4ee5\u628a\u7a0b\u5e8f\u8dd1\u8d77\u6765\u3002\u8fd9\u65f6\u5019\u518d\u53bb\u770b\u6c47\u7f16\uff0c\u53ef\u4ee5\u53d1\u73b0\u94fe\u63a5\u540e\u7684\u4ee3\u7801\u4ece 0x4001000 \u5f00\u59cb\uff0c\u5e76\u4e14\u76f4\u63a5\u628a .rodata \u7684\u5730\u5740\u5199\u5230\u4e86\u6307\u4ee4\u7684\u7acb\u5373\u6570\u4e4b\u4e2d\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"c1\"># objdump -S: Display assembly and intermix source code with disassembly</span>\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>helloworld_asm.o\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"m\">0000000000000000</span><span class=\"w\"> </span>&lt;_start&gt;:\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">   </span><span class=\"m\">0</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c7<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rdi\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"w\">   </span><span class=\"m\">7</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c6<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x0,%rsi\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"w\">   </span>e:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c2<span class=\"w\"> </span>0d<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>xd,%rdx\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">  </span><span class=\"m\">15</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rax\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">  </span>1c:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">  </span>1e:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span><span class=\"m\">31</span><span class=\"w\"> </span>ff<span class=\"w\">                </span>xor<span class=\"w\">    </span>%rdi,%rdi\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"w\">  </span><span class=\"m\">21</span>:<span class=\"w\">   </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span>3c<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x3c,%rax\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">  </span><span class=\"m\">28</span>:<span class=\"w\">   </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a>$<span class=\"w\"> </span>objdump<span class=\"w\"> </span>-S<span class=\"w\"> </span>helloworld_asm\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"m\">0000000000401000</span><span class=\"w\"> </span>&lt;_start&gt;:\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">  </span><span class=\"m\">401000</span>:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c7<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rdi\n</span><span id=\"__span-10-15\"><a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a><span class=\"w\">  </span><span class=\"m\">401007</span>:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c6<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">20</span><span class=\"w\"> </span><span class=\"m\">40</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x402000,%rsi\n</span><span id=\"__span-10-16\"><a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a><span class=\"w\">  </span>40100e:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c2<span class=\"w\"> </span>0d<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>xd,%rdx\n</span><span id=\"__span-10-17\"><a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\">  </span><span class=\"m\">401015</span>:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x1,%rax\n</span><span id=\"__span-10-18\"><a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">  </span>40101c:<span class=\"w\">       </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span><span id=\"__span-10-19\"><a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"w\">  </span>40101e:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span><span class=\"m\">31</span><span class=\"w\"> </span>ff<span class=\"w\">                </span>xor<span class=\"w\">    </span>%rdi,%rdi\n</span><span id=\"__span-10-20\"><a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a><span class=\"w\">  </span><span class=\"m\">401021</span>:<span class=\"w\">       </span><span class=\"m\">48</span><span class=\"w\"> </span>c7<span class=\"w\"> </span>c0<span class=\"w\"> </span>3c<span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\"> </span><span class=\"m\">00</span><span class=\"w\">    </span>mov<span class=\"w\">    </span><span class=\"nv\">$0</span>x3c,%rax\n</span><span id=\"__span-10-21\"><a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">  </span><span class=\"m\">401028</span>:<span class=\"w\">       </span>0f<span class=\"w\"> </span><span class=\"m\">05</span><span class=\"w\">                   </span>syscall\n</span></code></pre></div>\n<h3 id=\"\u5c0f\u7ed3\">\u5c0f\u7ed3<a class=\"headerlink\" href=\"#\u5c0f\u7ed3\" title=\"Permanent link\">&para;</a></h3>\n<p>\u4ece\u8fd9\u91cc\u53ef\u4ee5\u5f52\u7eb3\u51fa\uff0c\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u94fe\u63a5\u5668\uff0c\u628a\u4e0a\u8ff0\u7684 .o \u94fe\u63a5\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5927\u81f4\u9700\u8981\u505a\u54ea\u4e9b\u4e8b\u60c5\uff1a</p>\n<ol>\n<li>\u89e3\u6790 ELF \u6587\u4ef6\uff0c\u89e3\u6790\u91cc\u9762\u7684\u5185\u5bb9</li>\n<li>\u8003\u8651\u5c06\u8981\u8f93\u51fa\u7684 ELF \u6587\u4ef6\u7684\u5e03\u5c40\uff0c\u8ba1\u7b97\u51fa\u5404\u4e2a section \u9700\u8981\u4fdd\u5b58\u7684\u5185\u5bb9\u4ee5\u53ca\u5730\u5740\uff0c\u9700\u8981\u8003\u8651 segment \u7684\u5e03\u5c40\u4ee5\u53ca\u5bf9\u9f50</li>\n<li>\u6839\u636e\u5730\u5740\uff0c\u5b8c\u6210 relocation \u6240\u9700\u8981\u7684\u8ba1\u7b97\u5e76\u586b\u5165\u5bf9\u5e94\u7684\u4f4d\u7f6e</li>\n</ol>\n<h2 id=\"\u5b9e\u73b0\">\u5b9e\u73b0<a class=\"headerlink\" href=\"#\u5b9e\u73b0\" title=\"Permanent link\">&para;</a></h2>\n<p>\u63a5\u4e0b\u6765\u63cf\u8ff0\u4e00\u4e0b\u5b9e\u73b0\u7684\u5177\u4f53\u601d\u8def\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u6b65\u5c31\u662f\u89e3\u6790\u8f93\u5165\u7684 ELF \u6587\u4ef6\uff0c\u63d0\u53d6\u51fa\u4e2d\u95f4\u7684\u5185\u5bb9\uff0c\u5305\u62ec\u6709\u54ea\u4e9b section\uff0c\u89e3\u6790 relocation \u7684\u5185\u5bb9\u7b49\u7b49\uff1b\u8fd9\u4e2a\u53ef\u4ee5\u7528\u73b0\u6210\u7684\u5e93\u6765\u8f85\u52a9\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199\u3002</li>\n<li>\u628a section \u7684\u5185\u5bb9\u6536\u96c6\u4e0b\u6765\uff0c\u4f8b\u5982 .text .rodata \u7b49\u7b49\uff0c\u8fd9\u4e9b\u6570\u636e\u4e4b\u540e\u4f1a\u5199\u5165\u5230\u53ef\u6267\u884c ELF \u6587\u4ef6\u4e2d\u3002</li>\n<li>\u6536\u96c6\u5b8c\u4ee5\u540e\uff0c\u5c31\u77e5\u9053\u8f93\u51fa\u7684 ELF \u5927\u6982\u9700\u8981\u54ea\u4e9b\u5185\u5bb9\u4e86\u3002\u5728\u8fdb\u884c relocation \u4e4b\u524d\uff0c\u56e0\u4e3a\u76ee\u524d\u5b9e\u73b0\u7684\u662f\u91c7\u7528\u7edd\u5bf9\u5730\u5740\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u5148\u786e\u5b9a\u597d\u5404\u4e2a section \u548c symbol \u7684\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0 relocation \u7684\u8ba1\u7b97\u3002\u89c2\u5bdf ld.bfd \u8f93\u51fa\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230 ELF \u6587\u4ef6\u5305\u62ec\u5982\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a<ol>\n<li>ELF file header\uff1aELF \u5934\u90e8\uff0c\u586b\u5199\u5404\u79cd\u4fe1\u606f\uff0c\u4ee5\u53ca\u5230\u540e\u7eed\u5404\u4e2a header \u7684\u5730\u5740\u504f\u79fb</li>\n<li>ELF program header\uff1a\u8ba9 ELF Loader \u77e5\u9053\u6709\u54ea\u4e9b Segment \u8981\u52a0\u8f7d</li>\n<li>section data\uff1a\u5404\u4e2a section \u7684\u5185\u5bb9\uff0c\u7531\u4e8e section \u9700\u8981\u4fdd\u8bc1\u5bf9\u9f50\uff0c\u56e0\u6b64\u4e2d\u95f4\u9700\u8981\u586b\u4e00\u4e9b\u989d\u5916\u7684\u96f6\u5b57\u8282</li>\n<li>ELF section header\uff1a\u4fdd\u5b58 section header\uff0c\u8bb0\u5f55\u4e86 section \u7684\u4fe1\u606f</li>\n</ol>\n</li>\n<li>\u800c\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\u7684\u65f6\u5019\uff0c\u5c31\u662f\u76f4\u63a5\u5927\u6bb5\u5730\u8fde\u7eed\u5730\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u63d0\u524d\u8ba1\u7b97\u597d\u5404\u4e2a\u90e8\u5206\u7684\u5730\u5740\u3002\u4f8b\u5982\u8981\u628a ELF \u52a0\u8f7d\u5230 0x400000\uff0c\u90a3\u5c31\u628a file header \u548c program header \u653e\u5728\u5f00\u5934\uff0c\u7136\u540e\u56e0\u4e3a segment \u9700\u8981\u5bf9\u9f50\u5230\u9875\u7684\u8fb9\u754c <sup id=\"fnref:1\"><a class=\"footnote-ref\" href=\"#fn:1\">1</a></sup> \uff0c\u4f8b\u5982\u5bf9\u9f50\u5230 0x1000\uff084 KB\uff09\uff0c\u90a3\u5c31\u628a\u8fde\u7eed\u7684\u76f8\u540c\u8bbf\u95ee\u6743\u9650\u7684 section \u653e\u5230\u4e00\u4e2a segment \u5185\uff0c\u7136\u540e\u7b2c\u4e00\u4e2a segment \u653e\u5230 0x401000\uff0c\u5f80\u540e\u518d\u5bf9\u9f50\u518d\u653e\u4e0b\u4e00\u4e2a segment\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u628a\u6240\u6709 segment \u90fd\u653e\u4e0b\u4e3a\u6b62\u3002</li>\n<li>\u8ba1\u7b97\u597d\u5404\u4e2a\u90e8\u5206\u7684\u5730\u5740\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5404\u4e2a section \u548c symbol \u5728\u6700\u7ec8\u7684\u5185\u5b58\u91cc\u4f1a\u5904\u4e8e\u4ec0\u4e48\u5730\u5740\u4e86\u3002\u6b64\u65f6\u5c31\u6309\u7167 relocation \u7684\u8981\u6c42\u8fdb\u884c\u8ba1\u7b97\uff08\u4f8b\u5982\u524d\u9762\u51fa\u73b0\u8fc7\u7684 <code>R_X86_64_32S</code> \u5c31\u662f\u540e\u5199\u5165 64 \u4f4d\u7684\u5730\u5740\u7684\u4f4e 32 \u4f4d\uff0c\u5e76\u4e14\u68c0\u67e5\u5b83\u7b26\u53f7\u6269\u5c55\u540e\u7b49\u4e8e\u539f\u6765 64 \u4f4d\u7684\u5730\u5740\uff0c\u5982\u679c\u68c0\u67e5\u5931\u8d25\uff0c\u5c31\u4f1a\u5f97\u5230\u5927\u5bb6\u719f\u6089\u7684 <code>relocation truncated to fit</code> \u9519\u8bef\uff09\uff0c\u76f4\u63a5\u628a\u8ba1\u7b97\u7ed3\u679c\u586b\u5165\u5230\u6570\u636e\u4e2d\u3002\u7531\u4e8e\u76ee\u524d\u53ea\u8003\u8651\u6700\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u4e0d\u6d89\u53ca\u5230\u52a8\u6001\u91cd\u5b9a\u4f4d\uff0c\u6240\u4ee5\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u6240\u6709\u91cd\u5b9a\u4f4d\u90fd\u4f1a\u88ab\u94fe\u63a5\u5668\u5b8c\u6210\u3002</li>\n<li>\u9488\u5bf9\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd8\u9700\u8981\u751f\u6210 segment \u653e\u5230 program header \u91cc\u3002\u7b80\u5355\u7c97\u66b4\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u6574\u4e2a\u6587\u4ef6\u76f4\u63a5\u6620\u5c04\u5230\u5185\u5b58\u7684 0x400000\uff0c\u8bbe\u7f6e\u6743\u9650\u4e3a read + write + execute\u3002\u66f4\u7cbe\u7ec6\u7684\u505a\u6cd5\uff0c\u5219\u662f\u628a\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u6309\u7167\u5408\u9002\u7684\u6743\u9650\u6620\u5c04\uff0c\u4f8b\u5982 .rodata \u653e\u5230 read only \u7684 segment \u91cc\uff0c.text \u653e\u5230 read + execute \u7684 segment \u91cc\u3002</li>\n<li>\u518d\u6309\u7167\u524d\u9762\u6240\u8ff0\u7684\u6d41\u7a0b\uff0c\u6309\u7167\u9884\u8ba1\u597d\u7684\u5e03\u5c40\uff0c\u628a ELF \u7684\u5185\u5bb9\u5199\u5230\u6587\u4ef6\u91cc\u3002</li>\n</ol>\n<p>\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u6ca1\u6709\u4ea4\u4ee3\uff0c\u4f8b\u5982 section string table (.shstrtab) \u7684\u7ef4\u62a4\u7b49\u7b49\u3002\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u8dd1\u8d77\u6765\uff0c\u7b26\u53f7\u8868\u90fd\u53ef\u4ee5\u76f4\u63a5\u5220\u6389\u4e0d\u8981\u3002</p>\n<p>\u5b9e\u73b0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7075\u6d3b\u8fd0\u7528 readelf \u548c objdump \u7b49\u5de5\u5177\uff0c\u786e\u8ba4\u81ea\u5df1\u8f93\u51fa\u7684 ELF \u6587\u4ef6\u5185\u5bb9\u662f\u6b63\u786e\u7684\u3002\u5982\u679c\u5b9e\u73b0\u6210\u529f\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6210\u529f\u6253\u5370 <code>Hello world\uff01</code>\u3002</p>\n<p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528 Rust \u5b8c\u6210\u4e86\u5b9e\u73b0\uff0c\u4f7f\u7528\u4e86\u73b0\u6210\u7684 ELF \u8bfb\u5199\u5e93 <code>object</code>\uff0c\u94fe\u63a5\u5668\u90e8\u5206\u7684\u4ee3\u7801\u91cf\u5927\u6982\u662f 200 \u884c\u3002</p>\n<h2 id=\"\u53c2\u8003\">\u53c2\u8003<a class=\"headerlink\" href=\"#\u53c2\u8003\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u540e\u7ed9\u51fa\u4e00\u4e9b\u6587\u6863\uff0c\u53ef\u4f9b\u5b9e\u73b0\u65f6\u53c2\u8003\uff1a</p>\n<ul>\n<li><a href=\"https://refspecs.linuxfoundation.org/elf/elf.pdf\">Tool Interface Standard (TIS) Executable and Linking Format (ELF) Specification</a></li>\n<li><a href=\"https://refspecs.linuxbase.org/elf/x86_64-abi-0.99.pdf\">System V Application Binary Interface AMD64 Architecture Processor Supplement Draft Version 0.99.6</a></li>\n</ul>\n<div class=\"footnote\">\n<hr />\n<ol>\n<li id=\"fn:1\">\n<p>\u8fd9\u662f\u4e3a\u4e86\u5728\u52a0\u8f7d ELF \u65f6\u53ef\u4ee5\u76f4\u63a5 mmap\uff0c\u800c\u4e0d\u9700\u8981\u7acb\u5373\u628a\u6587\u4ef6\u5185\u5bb9\u8bfb\u53d6\u5230\u5185\u5b58\u91cc\uff1b\u66f4\u8fdb\u4e00\u6b65\uff0cmmap \u662f\u5141\u8bb8\u591a\u4e2a\u865a\u62df\u9875\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\u4e0a\u7684\uff0c\u6240\u4ee5\u5141\u8bb8\u4e00\u4e9b\u51fa\u73b0\u4e00\u4e9b\u201c\u4e0d\u5bf9\u9f50\u201d\u7684\u60c5\u51b5\uff0c\u5f97\u4ee5\u8282\u7701\u56e0\u4e3a\u5bf9\u9f50\u800c\u6d6a\u8d39\u7684\u7a7a\u95f4\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u8bdd\u9898\u7684\u8fdb\u4e00\u6b65\u4e86\u89e3\uff0c\u5efa\u8bae\u9605\u8bfb <a href=\"https://maskray.me/blog/2023-12-17-exploring-the-section-layout-in-linker-output\">Exploring the section layout in linker output</a>\u3002&#160;<a class=\"footnote-backref\" href=\"#fnref:1\" title=\"Jump back to footnote 1 in the text\">&#8617;</a></p>\n</li>\n</ol>\n</div>", "image": null, "date_modified": "2024-02-18T00:00:00+00:00", "authors": [], "tags": ["elf", "linker", "linux", "software", "write-a-linker"]}, {"id": "https://jia.je/software/2024/01/25/chromium-build-port/", "url": "https://jia.je/software/2024/01/25/chromium-build-port/", "title": "Chromium \u6784\u5efa\u4e0e\u79fb\u690d", "content_html": "<h1 id=\"chromium-\u6784\u5efa\u4e0e\u79fb\u690d\">Chromium \u6784\u5efa\u4e0e\u79fb\u690d<a class=\"headerlink\" href=\"#chromium-\u6784\u5efa\u4e0e\u79fb\u690d\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>Google Chrome \u4e5f\u7528\u4e86\u5f88\u957f\u65f6\u95f4\u4e86\uff0c\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u5c1d\u8bd5\u8fc7\u6784\u5efa Chromium\uff0c\u8fd9\u6b21\u8d81\u7740\u5f80 LoongArch \u79fb\u690d Chromium \u7684\u673a\u4f1a\uff0c\u5b66\u4e60\u4e86\u4e00\u4e0b Chromium \u7684\u6784\u5efa\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u514b\u9686\u4ee3\u7801\">\u514b\u9686\u4ee3\u7801<a class=\"headerlink\" href=\"#\u514b\u9686\u4ee3\u7801\" title=\"Permanent link\">&para;</a></h2>\n<p>Chromium \u5b98\u65b9\u7684\u6784\u5efa\u6587\u6863\u94fe\u63a5\u662f <a href=\"https://chromium.googlesource.com/chromium/src/+/main/docs/linux/build_instructions.md\">Checking out and building Chromium on Linux</a>\uff0c\u6309\u7167\u6d41\u7a0b\u505a\u5c31\u53ef\u4ee5\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>build-chromium\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"c1\"># setup depot_tools</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://chromium.googlesource.com/chromium/tools/depot_tools.git\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"c1\"># fish syntax to add depot_tools to PATH</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"nb\">set</span><span class=\"w\"> </span>-x<span class=\"w\"> </span>PATH<span class=\"w\"> </span><span class=\"nv\">$PWD</span>/depot_tools<span class=\"w\"> </span><span class=\"nv\">$PATH</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"c1\"># clone chromium using fetch from depot_tools</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a>mkdir<span class=\"w\"> </span>chromium\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>chromium\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>fetch<span class=\"w\"> </span>--nohooks<span class=\"w\"> </span>chromium\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"c1\"># or</span>\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a>fetch<span class=\"w\"> </span>--nohooks<span class=\"w\"> </span>--no-history<span class=\"w\"> </span>chromium\n</span><span id=\"__span-0-14\"><a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a>\n</span><span id=\"__span-0-15\"><a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"c1\"># setup build dependencies</span>\n</span><span id=\"__span-0-16\"><a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>src\n</span><span id=\"__span-0-17\"><a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a>./build/install-build-deps.sh\n</span><span id=\"__span-0-18\"><a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a>gclient<span class=\"w\"> </span>runhooks\n</span></code></pre></div>\n<p>\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u662f\u4e3a\u4e86\u5f00\u53d1 chromium \u505a\u7684\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u505a\u4e00\u4e9b\u7b80\u5316\uff1a\u5982\u679c\u53ea\u662f\u8981\u7f16\u8bd1\u4e00\u4e2a\u5df2\u7ecf\u53d1\u5e03\u6b63\u5f0f\u7248\u7684 chromium\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d tarball\uff0c\u4f8b\u5982 <a href=\"https://commondatastorage.googleapis.com/chromium-browser-official/chromium-120.0.6099.216.tar.xz\">https://commondatastorage.googleapis.com/chromium-browser-official/chromium-120.0.6099.216.tar.xz</a>\uff0c\u628a\u94fe\u63a5\u91cc\u7684\u7248\u672c\u53f7\u6539\u6389\u5373\u53ef\uff1b\u8fd9\u6837\u53ef\u4ee5\u7701\u53bb\u514b\u9686 git repo \u4ee5\u53ca\u4e00\u5806 submodule \u7684\u5927\u91cf\u65f6\u95f4\u3002\u5f53\u7136\u4e86\uff0c\u89e3\u538b\u672c\u8eab\u4e5f\u9700\u8981\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\uff0c\u5bf9\u4ed8\u8fd9\u79cd\u5927\u578b\u8f6f\u4ef6\u5fc5\u987b\u8981\u6709\u8010\u5fc3\u3002\u540c\u7406\uff0cdepot_tools \u4e5f\u53ef\u4ee5\u4e0d\u8981\uff0c\u6bd5\u7adf\u81ea\u5df1\u628a\u4ee3\u7801\u4e0b\u8f7d\u4e0b\u6765\u4e86\uff0c\u53ea\u9700\u8981\u518d\u88c5\u4e00\u4e2a gn\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u5269\u4e0b\u7684\u6784\u5efa\u3002</p>\n<h2 id=\"\u6784\u5efa\">\u6784\u5efa<a class=\"headerlink\" href=\"#\u6784\u5efa\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6309\u7167\u9ed8\u8ba4\u914d\u7f6e\u6784\u5efa\uff0c\u53ea\u9700\u8981\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>gn<span class=\"w\"> </span>gen<span class=\"w\"> </span>out/Default\n</span></code></pre></div>\n<p>\u610f\u601d\u662f\u7528 <code>gn</code> \u5de5\u5177\u751f\u6210\u4e00\u5957\u7528 Ninja \u6784\u5efa\u7684\u914d\u7f6e\uff0c\u76ee\u5f55\u5728 <code>out/Default</code> \u4e0b\u9762\uff0c\u7136\u540e\u4e0d\u6dfb\u52a0\u989d\u5916\u7684\u8bbe\u7f6e\u3002\u8981\u6784\u5efa Chromium\uff0c\u90a3\u5c31\u5728\u91cc\u9762\u8dd1 ninja\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>ninja<span class=\"w\"> </span>-C<span class=\"w\"> </span>out/Default<span class=\"w\"> </span>chrome\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"c1\"># or</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>autoninja<span class=\"w\"> </span>-C<span class=\"w\"> </span>out/Default<span class=\"w\"> </span>chrome\n</span></code></pre></div>\n<p>\u4f46\u662f\u5982\u679c\u4f60\u53bb\u7ffb\u5404\u4e2a Linux \u53d1\u884c\u7248\uff0c\u5c31\u4f1a\u53d1\u73b0\u5b83\u4eec\u90fd\u4f1a\u4f20\u5f88\u591a\u7684\u53c2\u6570\u7ed9 gn\uff0c\u5b9e\u73b0\u5404\u79cd\u76ee\u7684\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>gn<span class=\"w\"> </span>gen<span class=\"w\"> </span>out/Default<span class=\"w\"> </span>--args<span class=\"o\">=</span><span class=\"s1\">&#39;...&#39;</span>\n</span></code></pre></div>\n<p>\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e9b\u94fe\u63a5\uff1a</p>\n<ul>\n<li><a href=\"https://github.com/AOSC-Dev/aosc-os-abbs/tree/stable/app-web/chromium/autobuild\">AOSC OS</a></li>\n<li><a href=\"https://gitlab.archlinux.org/archlinux/packaging/packages/chromium/-/blob/main/PKGBUILD?ref_type=heads\">Arch Linux</a></li>\n<li><a href=\"https://salsa.debian.org/chromium-team/chromium/-/blob/master/debian/rules?ref_type=heads\">Debian</a></li>\n<li><a href=\"https://src.fedoraproject.org/rpms/chromium/blob/rawhide/f/chromium.spec\">Fedora</a></li>\n</ul>\n<p>\u8fd9\u91cc\u7684\u95e8\u95e8\u9053\u9053\u5c31\u5f88\u591a\u4e86\uff0c\u5f88\u591a\u7f16\u8bd1\u53c2\u6570\u5f71\u54cd\u4e86\u6700\u7ec8 Chromium \u7684\u529f\u80fd\u3001\u6027\u80fd\u7b49\u7b49\u91cd\u8981\u7684\u6307\u6807\u3002</p>\n<p>\u9996\u5148\u662f\u5de5\u5177\u94fe\u7684\u9009\u62e9\uff1aChromium \u5f00\u53d1\u7684\u65f6\u5019\u7528\u7684\u662f\u5f88\u65b0\u7684 Clang\uff0c\u8fd8\u81ea\u5e26\u4e86\u4e00\u4efd libc++\uff0c\u4f46\u662f\u5f88\u81ea\u7136\u5730\u5404\u5927\u53d1\u884c\u7248\u90fd\u4f1a\u503e\u5411\u4e8e\u7528\u81ea\u5df1\u7684\u5de5\u5177\u94fe\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5de5\u5177\u94fe\u53ef\u80fd\u662f\u7a0d\u5fae\u65e7\u4e00\u4e9b\u7684 Clang\uff0c\u6216\u8005\u662f GCC\uff0c\u8fd9\u91cc\u5c31\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u95ee\u9898\uff1aChromium \u5f00\u53d1\u7684\u65f6\u5019\u662f\u4e0d\u5728\u65e7 Clang \u6216\u8005 GCC \u4e0a\u6d4b\u8bd5\u7684\uff0c\u6240\u4ee5\u5404\u4e2a\u53d1\u884c\u7248\u90fd\u8981\u7ef4\u62a4\u4e00\u5806\u7684 patch\uff0c\u4f7f\u5f97\u7528\u7a0d\u5fae\u65e7\u4e00\u70b9\u7684\u6b63\u5f0f\u7248 Clang/GCC \u4e5f\u53ef\u4ee5\u6784\u5efa Chromium\u3002\u8fd9\u4e9b patch \u53ef\u4ee5\u5728\u4e0a\u9762\u7684\u94fe\u63a5\u4e2d\u627e\u5230\u3002</p>\n<p>\u9664\u4e86\u7f16\u8bd1\u5668\u4ee5\u5916\uff0c\u8fd8\u6709\u5f88\u591a\u4f9d\u8d56\u4e5f\u53ef\u4ee5\u9009\u62e9\u7528 chromium \u81ea\u5e26\u7684\u7248\u672c\uff0c\u8fd8\u662f\u7cfb\u7edf\u81ea\u5e26\u7684\u7248\u672c\uff0c\u8fd9\u91cc\u4e5f\u6709\u5f88\u591a\u53ef\u80fd\u6027\u3002\u4f8b\u5982\u8981\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 Clang\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>host_toolchain=&quot;//build/toolchain/linux/unbundle:default&quot;\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>custom_toolchain=&quot;//build/toolchain/linux/unbundle:default&quot;\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a>clang_base_path=&quot;/usr&quot; \n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a>clang_use_chrome_plugins=false\n</span></code></pre></div>\n<p>\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u7528 GCC\uff0c\u4f46\u662f\u9700\u8981\u6253\u4e0d\u5c11\u7684 patch\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>CC=gcc CXX=g++ AR=ar NM=nm gn gen out/Default --args=&#39;is_clang=false ...&#39;\n</span></code></pre></div>\n<p>\u7b49\u7b49\uff0c\u8fd8\u6709\u5f88\u591a\u53ef\u80fd\u7684\u914d\u7f6e\u9009\u9879\uff0c\u8fd9\u4e9b\u53ef\u4ee5\u5728 Chromium \u7684\u6e90\u7801\u4e2d\u627e\u5230\uff1a\u5b83\u4eec\u4f1a\u7528 gn \u7684\u914d\u7f6e\u8bed\u8a00\u7f16\u5199\uff0c\u653e\u5728 <code>declare_args</code> \u91cc\u9762\u3002</p>\n<h2 id=\"\u79fb\u690d\">\u79fb\u690d<a class=\"headerlink\" href=\"#\u79fb\u690d\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9664\u4e86\u5728 amd64 \u6784\u5efa\u4ee5\u5916\uff0cChromium \u4e3b\u8981\u8fd8\u652f\u6301 arm64 \u67b6\u6784\uff0c\u5176\u4ed6\u67b6\u6784\u5c5e\u4e8e\u6709\u7b2c\u4e09\u65b9 patch\uff0c\u4f46\u662f Chromium \u5904\u4e8e\u4e00\u4e2a\u4ed8\u51fa\u989d\u5916\u7ef4\u62a4\u8d1f\u62c5\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u5176\u4ed6\u67b6\u6784\u7684\u8865\u4e01\u5c31\u6ca1\u6709\u5408\u5e76\uff0c\u56e0\u6b64\u4f60\u4f1a\u53d1\u73b0 riscv64 \u548c ppc64le \u67b6\u6784\u4e0a\u80fd\u627e\u5230\u4e00\u4e9b\u53d1\u884c\u7248\u81ea\u5df1\u7ef4\u62a4\u7684 patch\uff0c\u5e76\u4e14\u6ca1\u6709\u5408\u5e76\u5230\u4e0a\u6e38\u3002loongarch64 \u7684\u5904\u5883\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u9f99\u82af\u4e4b\u524d\u505a\u8fc7\u4e00\u4e9b\u79fb\u690d\uff0c\u5c1d\u8bd5\u63d0\u4ea4\u4e0a\u6e38\uff0c\u4f46\u662f\u6700\u540e\u6ca1\u6709\u5408\u5e76\u8fdb\u53bb\u3002</p>\n<p>\u4f46\u662f Chromium \u5bf9\u4e8e\u684c\u9762\u6765\u8bf4\u53c8\u662f\u6bd4\u8f83\u91cd\u8981\u7684\uff0c\u65e0\u8bba\u662f\u4f5c\u4e3a\u6d4f\u89c8\u5668\uff0c\u8fd8\u662f\u7528\u5728 Electron \u6216\u8005 QT \u751f\u6001\u4e2d\u3002\u56e0\u6b64\u501f\u7740\u9f99\u82af\u628a\u79fb\u690d Electron \u7684 patch \u653e\u51fa\u6765\u7684\u673a\u4f1a\uff0c\u987a\u4fbf\u628a Chromium \u7684\u79fb\u690d\u505a\u4e86\uff1a\u6700\u65e9\u662f <a href=\"https://github.com/prcups\">@prcups</a> \u628a\u8865\u4e01\u79fb\u690d\u5230 qt6-webengine \u4e0a\uff0c\u8bc1\u5b9e\u4e86\u8865\u4e01\u7684\u53ef\u7528\u6027\uff1b\u4e4b\u540e\u6211\u53c8\u79fb\u690d\u5230\u4e86\u6700\u65b0\u7248\u7684 Chromium \u4e0a\uff0c\u8865\u4e01\u53d1\u5e03\u5728 <a href=\"https://github.com/AOSC-Dev/chromium-loongarch64\">AOSC-Dev/chromium-loongarch64</a>\u3002\u76ee\u524d 120 \u5df2\u7ecf\u9002\u914d\u4e86\uff0c\u4f46\u662f\u8fd9\u51e0\u5929 121 \u53c8\u53d1\u5e03\u4e86\uff0c\u9700\u8981\u518d\u6b21\u66f4\u65b0\u8865\u4e01\u3002\u65b0\u7248 Electron \u7684\u8865\u4e01\u4e5f\u8fd8\u6ca1\u6709\u505a\u3002</p>\n<p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53d1\u73b0\u9f99\u82af\u539f\u6765\u7684 patch \u5185\u7f6e\u7684 bug\uff1a\u4e0e seccomp sandbox \u6709\u5173\uff0c\u539f\u6765\u7684\u4ee3\u7801\u628a\u5bf9 stat \u7684\u5904\u7406\u7167\u6284\u5230\u4e86 statx \u4e0a\uff0c\u4f46\u662f\u5b83\u7684\u53c2\u6570\u987a\u5e8f\u548c\u542b\u4e49\u90fd\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4e0d\u80fd\u76f4\u63a5\u7167\u6284\u3002\u5bf9\u7740\u4ee3\u7801\uff0c\u5927\u6982\u662f\u6b63\u786e\u5730\u5b9e\u73b0\u4e86\u51fa\u6765\u3002\u4e4b\u524d\u6ca1\u6709\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u5927\u6982\u7387\u662f Electron \u4e0b\u4e0d\u4f1a\u7528\u5230\u8fd9\u4e2a sandbox\u3002\u56de\u987e\u4e0b\u6765\uff0c\u79fb\u690d\u7684\u8865\u4e01\u4e0d\u7b97\u591a\uff0c\u4e3b\u8981\u662f crashpad \u548c sandbox \u4e24\u90e8\u5206\u4ee3\u7801\uff0c\u89c2\u5bdf\u4e86\u4e00\u4e0b archriscv \u7ef4\u62a4\u7684 riscv \u8865\u4e01\uff0c\u5176\u5b9e\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p>\n<p>\u8fd9\u4e2a\u8fc7\u7a0b\u9047\u5230\u4e86\u5f88\u591a\u56f0\u96be\uff1a\u4e00\u5f00\u59cb Clang \u6784\u5efa\u9047\u5230\u95ee\u9898\uff0c\u4e8e\u662f\u6539\u7528 GCC\uff0c\u4f46\u662f\u524d\u9762\u4e5f\u8bf4\u4e86\uff0cChromium \u6ca1\u6709\u7528 GCC \u6d4b\u8bd5\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u5f88\u591a\u95ee\u9898\uff0c\u9700\u8981\u7ec6\u5fc3\u5730\u4fee\u590d\uff1b\u6700\u540e\u7ec8\u4e8e\u641e\u597d\u4e86\u4ee5\u540e\uff0c\u518d\u56de\u5230 Clang\uff0c\u53d1\u73b0 Clang \u7684\u95ee\u9898\u5df2\u7ecf\u88ab Fedora/Debian \u7b49\u53d1\u884c\u7248\u89e3\u51b3\uff0c\u53ea\u9700\u8981\u5bfc\u5165\u5df2\u6709\u7684\u8865\u4e01\u5373\u53ef\u3002\u8fd9\u6837\u6298\u817e\u4e0b\u6765\uff0c\u7ec8\u4e8e\u662f\u641e\u5b9a\u4e86\u3002\u800c\u76ee\u524d\u9f99\u82af\u7684\u6784\u5efa\u673a\u5668\uff083C5000\uff09\u6027\u80fd\u8fd8\u662f\u4e0d\u591f\u597d\uff0c\u6784\u5efa\u4e00\u6b21\u5b8c\u6574\u7684 Chromium \u9700\u8981\u4e5d\u4e2a\u5c0f\u65f6\uff0c\u672a\u6765\u7b49\u9f99\u82af\u670d\u52a1\u5668\u6027\u80fd\u63d0\u5347\u4ee5\u540e\uff0c\u53ef\u4ee5\u9884\u89c1\u5230\u7ef4\u62a4\u6210\u672c\u7684\u964d\u4f4e\u3002</p>", "image": null, "date_modified": "2024-01-25T00:00:00+00:00", "authors": [], "tags": ["chromium", "linux", "loongarch", "port", "software"]}, {"id": "https://jia.je/hardware/2023/12/08/vipt-l1-cache-page-size/", "url": "https://jia.je/hardware/2023/12/08/vipt-l1-cache-page-size/", "title": "VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb", "content_html": "<h1 id=\"vipt-\u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb\">VIPT \u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb<a class=\"headerlink\" href=\"#vipt-\u4e0e\u7f13\u5b58\u5927\u5c0f\u548c\u9875\u8868\u5927\u5c0f\u7684\u5173\u7cfb\" title=\"Permanent link\">&para;</a></h1>\n<p>VIPT\uff08Virtual Index Physical Tag\uff09\u662f L1 \u6570\u636e\u7f13\u5b58\u5e38\u7528\u7684\u6280\u672f\uff0c\u5229\u7528\u4e86\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684 Index \u76f8\u540c\u7684\u7279\u6027\uff0c\u5f97\u4ee5\u4f18\u5316 L1 \u6570\u636e\u7f13\u5b58\u7684\u8bfb\u53d6\u3002\u4f46\u662f VIPT \u7684\u4f7f\u7528\uff0c\u4e0e\u9875\u8868\u5927\u5c0f\u548c L1 \u6570\u636e\u7f13\u5b58\u5927\u5c0f\u90fd\u6709\u5173\u7cfb\u3002\u8fd9\u7bc7\u535a\u5ba2\u63a2\u8ba8\u4e00\u4e0b\uff0cVIPT \u6280\u672f\u80cc\u540e\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p>\n<!-- more -->\n\n<h2 id=\"vipt-\u662f\u4ec0\u4e48\">VIPT \u662f\u4ec0\u4e48<a class=\"headerlink\" href=\"#vipt-\u662f\u4ec0\u4e48\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4ee5\u9632\u8bfb\u8005\u4e0d\u8bb0\u5f97 VIPT \u662f\u4ec0\u4e48\uff0c\u8fd9\u91cc\u518d\u590d\u4e60\u4e00\u4e0b\u7f13\u5b58\u7684\u539f\u7406\u3002\u9996\u5148\uff0c\u628a\u6570\u636e\u7684\u7269\u7406\u5730\u5740\u5212\u5206\u4e3a\u4e09\u6bb5\uff1a</p>\n<ol>\n<li>Tag</li>\n<li>Index</li>\n<li>Offset</li>\n</ol>\n<p>\u7f13\u5b58\u7ec4\u7ec7\u6210\u591a\u8def\uff0c\u6bcf\u4e00\u8def\u6709\u82e5\u5e72\u4e2a\u9879\uff0c\u6bcf\u9879\u91cc\u9762\u662f\u4e00\u4e2a\u7f13\u5b58\u884c\u3002\u67e5\u8be2\u65f6\uff0c\u9996\u5148\u6839\u636e Index \u4f5c\u4e3a\u4e0b\u6807\uff0c\u53bb\u7d22\u5f15\u7f13\u5b58\uff0c\u5f97\u5230\u591a\u8def\u7684\u7f13\u5b58\u884c\uff1b\u7136\u540e\u518d\u7528 Tag \u548c\u591a\u8def\u7f13\u5b58\u884c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u6709\u5339\u914d\uff0c\u5219\u8bf4\u660e\u662f\u547d\u4e2d\uff1b\u5426\u5219\u5c31\u662f\u7f13\u5b58\u7f3a\u5931\u3002</p>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5148\u7528 Index\uff0c\u540e\u7528 Tag\uff0c\u56e0\u6b64\u5982\u679c\u53ef\u4ee5\u5148\u5f97\u5230 Index\uff0c\u5c31\u53ef\u4ee5\u63d0\u524d\u5b8c\u6210\u7b2c\u4e00\u6b65\u3002\u56de\u987e\u4e00\u4e0b\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684\u8f6c\u6362\uff1a\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684\u9875\u5185\u504f\u79fb\u662f\u76f8\u540c\u7684\uff0c\u53ea\u4f1a\u4fee\u6539\u9875\u53f7\u3002\u90a3\u4e48\uff0c\u5982\u679c\u628a Index \u653e\u5728\u9875\u5185\u504f\u79fb\u7684\u90e8\u5206\uff0c\u90a3\u5c31\u53ef\u4ee5\u5728\u865a\u5b9e\u5730\u5740\u8f6c\u6362\u4e4b\u524d\uff0c\u76f4\u63a5\u4ece\u865a\u62df\u5730\u5740\u83b7\u53d6\u5230 Index\uff0c\u5e76\u4e14\u8fd9\u4e2a Index \u4e00\u5b9a\u662f\u7269\u7406\u5730\u5740\u7684 Index\uff0c\u6bd5\u7adf\u865a\u5b9e\u5730\u5740\u8f6c\u6362\u4e0d\u4f1a\u4fee\u6539 Index\u3002\u8fd9\u5c31\u662f VIPT\u3002</p>\n<p>\u6240\u4ee5\u5f88\u660e\u663e\uff0cVIPT \u662f\u4e00\u79cd\u4f18\u5316\u65b9\u6cd5\uff0c\u5229\u7528\u865a\u5b9e\u8f6c\u6362\u4e2d\u9875\u5185\u504f\u79fb\u4e0d\u53d8\u7684\u7279\u6027\uff0c\u5b9e\u73b0\u66f4\u5feb\u7684\u6570\u636e\u7f13\u5b58\u8bfb\u53d6\u3002</p>\n<h2 id=\"vipt-\u7684\u5c40\u9650\u6027\">VIPT \u7684\u5c40\u9650\u6027<a class=\"headerlink\" href=\"#vipt-\u7684\u5c40\u9650\u6027\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4f46\u540c\u65f6\uff0cVIPT \u4e5f\u7ed9 L1 \u6570\u636e\u7f13\u5b58\u5e26\u6765\u4e86\u5c40\u9650\u6027\u3002\u524d\u9762\u63d0\u5230\uff0cVIPT \u8981\u6c42 Index \u88ab\u5305\u542b\u5728\u9875\u5185\u504f\u79fb\u4e2d\uff0c\u90a3\u4e48\u53ef\u4ee5\u6765\u7b97\u4e00\u7b97\uff0cIndex \u6700\u5927\u662f\u591a\u5c11\uff1a</p>\n<p>\u5047\u5982\u9875\u5927\u5c0f\u662f <span class=\"arithmatex\">\\(P\\)</span>\uff0c\u6bcf\u4e2a\u7f13\u5b58\u884c\u5927\u5c0f\u662f <span class=\"arithmatex\">\\(C\\)</span>\uff0c\u4e3a\u4e86\u8ba9 Index \u5305\u542b\u5728\u9875\u5185\u504f\u79fb\u4e2d\uff0cIndex \u7684\u4e2a\u6570\uff08\u4e5f\u53eb\u505a Sets\uff09<span class=\"arithmatex\">\\(I\\)</span> \u9700\u8981\u6ee1\u8db3 <span class=\"arithmatex\">\\(I * C \\le P\\)</span>\u3002</p>\n<p>\u6b64\u65f6\u8003\u8651\u4e00\u4e0b\u6570\u636e\u7f13\u5b58\u7684\u603b\u5927\u5c0f\uff1a\u6bcf\u4e2a Index \u6709 Way \u8def\u7f13\u5b58\u884c\uff0c\u6240\u4ee5\u603b\u5927\u5c0f\u662f <span class=\"arithmatex\">\\(I * C * W\\)</span>\uff0c\u5176\u4e2d <span class=\"arithmatex\">\\(W\\)</span> \u6307\u7684\u662f\u8def\u6570\u3002\u6b64\u65f6\u4f60\u4f1a\u53d1\u73b0\uff0c\u6570\u636e\u7f13\u5b58\u7684\u603b\u5927\u5c0f\u4e0d\u5927\u4e8e <span class=\"arithmatex\">\\(W * P\\)</span>\uff0c\u4e5f\u5c31\u662f\u8def\u6570\u4e58\u4ee5\u9875\u7684\u5927\u5c0f\u3002</p>\n<p>\u6362\u53e5\u8bdd\u8bf4\uff0cL1 \u6570\u636e\u7f13\u5b58\u5927\u5c0f\uff0c\u53d7\u9650\u4e8e\u8def\u6570\u4e58\u4ee5\u9875\u7684\u5927\u5c0f\u3002\u5982\u679c\u4f60\u53bb\u67e5\u770b\u4e00\u4e9b\u5904\u7406\u5668\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u4eec\u90fd\u53d6\u5230\u4e86\u8fd9\u4e2a\u6700\u5927\u503c\uff1a</p>\n<ol>\n<li>i9-13900K: L1 \u6570\u636e\u7f13\u5b58 48KB\uff0c<span class=\"arithmatex\">\\(W=12, P=4096\\)</span></li>\n<li>i9-10980XE: L1 \u6570\u636e\u7f13\u5b58 32KB\uff0c<span class=\"arithmatex\">\\(W=8, P=4096\\)</span></li>\n<li>EPYC 7551: L1 \u6570\u636e\u7f13\u5b58 32KB\uff0c<span class=\"arithmatex\">\\(W=8, P=4096\\)</span></li>\n<li>3A6000: L1 \u6570\u636e\u7f13\u5b58 64KB\uff0c<span class=\"arithmatex\">\\(W=4, P=16384\\)</span></li>\n</ol>\n<p>\u6bd5\u7adf\u6bd4\u8f83\u5927\u7684 L1 \u6570\u636e\u7f13\u5b58\u5bf9\u6027\u80fd\u662f\u6709\u5e2e\u52a9\u7684\uff0c\u5f53\u7136\u4e86\uff0c\u592a\u5927\u4e86\u4e5f\u4f1a\u5bfc\u81f4 Load To Use \u5ef6\u8fdf\u589e\u52a0\uff0c\u53ef\u80fd\u5f97\u4e0d\u507f\u5931\u3002</p>\n<p>\u5f53\u7136\u4e86\uff0cL2 L3 \u7b49\u7f13\u5b58\u5c31\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236\u4e86\uff0c\u6bd5\u7adf\u901a\u5e38\u662f\u91c7\u7528\u7269\u7406\u5730\u5740\uff0c\u4e0d\u6d89\u53ca VIPT\u3002</p>\n<p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u8981\u8bf4\u4e86\uff0c\u7b49\u7b49\uff01\u4e3a\u5565\u6709\u4e00\u4e9b\u5904\u7406\u5668\u4e0d\u7b26\u5408\u8fd9\u4e2a\u89c4\u5219\uff1a</p>\n<ol>\n<li>Kunpeng-920: L1 \u6570\u636e\u7f13\u5b58 64KB\uff0c<span class=\"arithmatex\">\\(W=4, P=4096\\)</span></li>\n</ol>\n<p>\u6b64\u65f6 <span class=\"arithmatex\">\\(W * P\\)</span> \u53ea\u6709 16KB\uff0c\u4e3a\u4ec0\u4e48\u80fd\u591f\u5b9e\u73b0 64KB \u7684\u6570\u636e\u7f13\u5b58\uff1f\u5b9e\u9645\u4e0a\uff0c\u524d\u9762\u7684\u8ba8\u8bba\u90fd\u57fa\u4e8e\u4e00\u4e2a\u5047\u8bbe\uff1a\u9875\u8868\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\u3002\u8981\u662f\u9875\u8868\u5927\u5c0f\u4e0d\u552f\u4e00\u5462\uff1f</p>\n<h2 id=\"\u591a\u53d8\u7684\u9875\u8868\u5927\u5c0f\">\u591a\u53d8\u7684\u9875\u8868\u5927\u5c0f<a class=\"headerlink\" href=\"#\u591a\u53d8\u7684\u9875\u8868\u5927\u5c0f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u73b0\u5728\u4e00\u4e9b\u5904\u7406\u5668\uff0c\u7279\u522b\u662f\u975e x86 \u7684\u5904\u7406\u5668\uff0c\u901a\u5e38\u4f1a\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff1a4KB\u300116KB \u548c 64KB\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u79cd\u3002\u4f8b\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cKunpeng-920 \u5c31\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff0c\u5982\u679c\u4f60\u7528\u6570\u636e\u7f13\u5b58\u5927\u5c0f\u5012\u63a8\uff0c\u4f1a\u5f97\u5230\u9875\u8868\u662f 16KB \u7684\u7ed3\u8bba\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u8981\u652f\u6301\u591a\u79cd\u9875\u8868\u5927\u5c0f\uff0cVIPT \u8fd8\u80fd\u6b63\u5e38\u5de5\u4f5c\u5417\uff1f</p>\n<p>\u5047\u8bbe\u6709\u4e00\u4e2a CPU\uff0c\u6570\u636e\u7f13\u5b58\u5927\u5c0f\u662f 64KB\uff0c4 \u8def\uff0c\u7f13\u5b58\u884c\u5927\u5c0f\u662f 64 \u5b57\u8282\u3002\u90a3\u4e48\uff0c\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\uff0c\u53ef\u4ee5\u8ba1\u7b97\u51fa\u7f13\u5b58\u6709 256 \u4e2a Set\uff0c\u4e5f\u5c31\u662f Index \u53ef\u4ee5\u53d6 0 \u5230 255\uff0c\u5360\u7528\u5730\u5740\u7684 8 \u4e2a\u4f4d\u3002\u7f13\u5b58\u884c\u5927\u5c0f\u662f 64 \u5b57\u8282\uff0c\u884c\u5185\u4fbf\u5b9c\u5360\u7528\u5730\u5740\u7684 6 \u4f4d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cIndex \u5bf9\u5e94\u7684\u662f\u5730\u5740\u7684 <code>[13:6]</code> \u4f4d\u3002\u63a5\u4e0b\u6765\u5bf9\u9875\u8868\u5927\u5c0f\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff1a</p>\n<p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 64 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[15:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[15:0]</code> \u4f4d\u76f8\u7b49\uff0c\u81ea\u7136 Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u4e5f\u76f8\u7b49\uff0cVIPT \u4e0d\u4f1a\u9047\u5230\u95ee\u9898\u3002</p>\n<p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 16 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[13:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[13:0]</code> \u4f4d\u76f8\u7b49\uff0c\u81ea\u7136 Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u4e5f\u76f8\u7b49\uff0cVIPT \u4e0d\u4f1a\u9047\u5230\u95ee\u9898\u3002</p>\n<p>\u5047\u5982\u9875\u8868\u5927\u5c0f\u662f 4 KB\uff0c\u90a3\u4e48\u9875\u5185\u504f\u79fb\u5c31\u662f\u5730\u5740\u7684\u7b2c <code>[11:0]</code> \u4f4d\uff0c\u90a3\u4e48\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684 <code>[11:0]</code> \u4f4d\u76f8\u7b49\uff0c\u4f46\u662f Index \u5bf9\u5e94\u7684 <code>[13:6]</code> \u4f4d\u5c31\u4e0d\u4e00\u5b9a\u76f8\u7b49\u4e86\u3002\u8fd9\u65f6\u5019\u4f1a\u51fa\u73b0\u4ec0\u4e48\u95ee\u9898\u5462\uff1f</p>\n<p>\u5982\u679c\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u90fd\u662f\u4e00\u4e00\u5bf9\u5e94\uff0c\u90a3\u4e48\u5373\u4f7f\u6620\u5c04\u65f6\u4fee\u6539\u4e86 <code>[13:12]</code> \u4f4d\uff0cIndex \u53d8\u4e86\uff0c\u4e5f\u6ca1\u95ee\u9898\uff0c\u53ea\u8981\u4fdd\u5b58\u7684 Tag \u662f\u5b8c\u6574\u7684 <code>[VALEN-1:12]</code> \u4f4d\uff0c\u6570\u636e\u4f9d\u7136\u53ef\u4ee5\u7cbe\u786e\u5730\u627e\u5230\uff0c\u4e0d\u4f1a\u8bbf\u95ee\u5230\u9519\u8bef\u7684\u6570\u636e\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u591a\u4e2a\u865a\u62df\u5730\u5740\u5bf9\u5e94\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\uff0c\u4f8b\u5982\u5171\u4eab\u5185\u5b58\u7b49\u7b49\u3002\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li>\n<li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80001000 -&gt; 0x00000000</li>\n</ol>\n<p>\u8fd9\u4e24\u4e2a\u865a\u62df\u9875\u5bf9\u5e94\u540c\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u865a\u62df\u9875\u7684 Index \u5374\u4e0d\u76f8\u540c\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u7b2c <code>[13:12]</code> \u4f4d\u4e0d\u76f8\u7b49\u3002\u56de\u987e L1 \u6570\u636e\u7f13\u5b58\u8bbf\u95ee\u7684\u6d41\u7a0b\uff0c\u7b2c\u4e00\u6b65\u5c31\u662f\u7528 Index \u4f5c\u4e3a\u4e0b\u6807\u53bb\u8bbf\u95ee\uff0c\u65e2\u7136\u4e24\u4e2a\u865a\u62df\u9875\u7684\u8bbf\u95ee\u65f6\u4e0b\u6807\u5c31\u4e0d\u4e00\u6837\uff0c\u81ea\u7136\u4e5f\u6ca1\u6cd5\u8bbf\u95ee\u5230\u540c\u6837\u7684\u6570\u636e\uff0c\u5f80\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5199\u6570\u636e\uff0c\u4ece\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5374\u8bfb\u4e0d\u51fa\u6765\uff0c\u8fd9\u5c31\u574f\u4e8b\u4e86\u3002\u8fd9\u4e2a\u73b0\u8c61\u53eb\u505a virtual aliasing\u3002</p>\n<p>\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u9605\u8bfb <a href=\"https://www.kernel.org/doc/Documentation/cachetlb.txt\">Cache and TLB Flushing Under Linux</a>\uff0c\u91cc\u9762\u6709\u4e00\u6bb5\u8bdd\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>Is your port susceptible to virtual aliasing in its D-cache?\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>Well, if your D-cache is virtually indexed, is larger in size than\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>PAGE_SIZE, and does not prevent multiple cache lines for the same\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>physical address from existing at once, you have this problem.\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>If your D-cache has this problem, first define asm/shmparam.h SHMLBA\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a>properly, it should essentially be the size of your virtually\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a>addressed D-cache (or if the size is variable, the largest possible\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a>size).  This setting will force the SYSv IPC layer to only allow user\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a>processes to mmap shared memory at address which are a multiple of\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>this value.\n</span></code></pre></div>\n<p>\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u610f\u601d\u5c31\u662f\uff0c\u5047\u5982\u6570\u636e\u7f13\u5b58\u7684 VIPT \u662f\u57fa\u4e8e\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u9875\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\u662f 16KB\uff09\uff0c\u6bd4\u5b9e\u9645\u7684\u9875\u8868\u5927\u5c0f\u66f4\u5927\uff084KB\uff09\uff0c\u5e76\u4e14\u6ca1\u6709\u9632\u6b62\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\u7684\u7f13\u5b58\u884c\u51fa\u73b0\u591a\u6b21\uff0c\u5c31\u4f1a\u9047\u5230\u95ee\u9898\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5728 Linux \u91cc\u8bbe\u7f6e <code>SHMLBA</code> \u53c2\u6570\uff0c\u5b83\u7684\u5927\u5c0f\u5e94\u8be5\u662f VIPT \u5bf9\u5e94\u7684\u9875\u5927\u5c0f\uff0816KB\uff09\u3002\u5b83\u4f1a\u8981\u6c42\u5171\u4eab\u5185\u5b58\u7684\u57fa\u5730\u5740\u4e00\u5b9a\u662f <code>SHMLBA</code> \u7684\u500d\u6570\u3002</p>\n<p>\u8fd9\u5c31\u89e3\u51b3\u4e86\u524d\u9762\u7684\u95ee\u9898\uff1a\u51fa\u73b0\u591a\u4e2a\u865a\u62df\u5730\u5740\u6620\u5c04\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\u65f6\uff0c\u65e2\u7136 Index \u4e0d\u4e00\u81f4\u4f1a\u6709\u95ee\u9898\uff0c\u90a3\u5c31\u8f6f\u4ef6\u4e0a\u53bb\u4fdd\u8bc1 Index \u4e00\u81f4\uff0c\u800c\u4fdd\u8bc1 Index \u4e00\u81f4\uff0c\u5176\u5b9e\u5c31\u662f\u5bf9\u9f50\u5230 <code>SHMLBA</code> \u7684\u500d\u6570\u3002\u56de\u987e\u4e0a\u9762\u7684\u4f8b\u5b50\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li>\n<li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80001000 -&gt; 0x00000000</li>\n</ol>\n<p>\u7b2c\u4e8c\u4e2a\u9875\u5c31\u6ca1\u6709\u5bf9\u9f50\u5230 <code>SHMLBA</code>\uff0c\u4e5f\u5c31\u662f 16KB \u7684\u8fb9\u754c\u4e0a\u3002\u5047\u5982\u6620\u5c04\u7684\u65f6\u5019\uff0c\u5c31\u4fdd\u8bc1\u7b2c\u4e8c\u4e2a\u9875\u5bf9\u9f50\u5230 16KB \u7684\u8fb9\u754c\u4e0a\uff0c\u5c31\u53d8\u6210\u4e86\uff1a</p>\n<ol>\n<li>\u7b2c\u4e00\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80000000 -&gt; 0x00000000</li>\n<li>\u7b2c\u4e8c\u4e2a\u865a\u62df\u9875\u5230\u7269\u7406\u9875\u7684\u6620\u5c04\uff1a0x80004000 -&gt; 0x00000000</li>\n</ol>\n<p>\u6b64\u65f6\u8fd9\u4e24\u4e2a\u9875\u7684\u865a\u62df\u5730\u5740\u7684 <code>[13:12]</code> \u4f4d\u5c31\u76f8\u540c\u4e86\uff0c\u4e0d\u4f1a\u51fa\u73b0 virtual aliasing \u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u53eb Page Coloring\uff08\u7684\u4e00\u79cd\uff09\uff0c\u989d\u5916\u8981\u6c42\u5171\u4eab\u5185\u5b58\u4e2d\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684\u7b2c <code>[13:12]</code> \u4f4d\u76f8\u540c\u3002</p>\n<p>\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u5fd8\u8bb0\u4e86\u5bf9\u9f50\u5230 <code>SHMLBA</code>\uff0c\u5b83\u4e0d\u4e00\u5b9a\u662f\u9875\u8868\u7684\u5927\u5c0f\u3002</p>\n<p>\u8fd9\u662f\u8f6f\u4ef6\u505a\u6cd5\uff0c\u6709\u6ca1\u6709\u786c\u4ef6\u505a\u6cd5\u5462\uff1f\u7b54\u6848\u662f\uff0c\u6709\uff0c\u53ef\u4ee5\u53c2\u8003 <a href=\"https://cs.stackexchange.com/a/32302\">What problem does cache coloring solve?</a> \u548c <a href=\"https://ntnuopen.ntnu.no/ntnu-xmlui/handle/11250/2467634\">Designing a Virtual Memory System for the SHMAC Research Infrastructure</a> \u7b2c 3.7 \u8282\u3002\u8fd9\u91cc\u5217\u51fa\u6765\u51e0\u79cd\u6bd4\u8f83\u597d\u7406\u89e3\u7684\u65b9\u6cd5\uff1a</p>\n<ol>\n<li>\u7f13\u5b58\u7f3a\u5931\u7684\u65f6\u5019\uff0c\u53bb\u5176\u4ed6 set \u91cc\u5bfb\u627e\u5339\u914d\uff0c\u5982\u679c\u53d1\u73b0\u4e86\uff0c\u5c31\u628a\u6570\u636e\u632a\u5230\u5f53\u524d\u7684 virtual index \u5bf9\u5e94\u7684\u4f4d\u7f6e\u3002\u8fd9\u4e2a\u65b9\u6cd5\u590d\u6742\u70b9\u5728\u4e8e\u9700\u8981\u53bb\u5176\u4ed6 set \u91cc\u5bfb\u627e\u53ef\u80fd\u7684\u5339\u914d\u3002</li>\n<li>\u5728 L2 \u7f13\u5b58\u4e2d\u8bb0\u5f55\u7f13\u5b58\u884c\u5bf9\u5e94\u7684 virtual index\uff0c\u7f13\u5b58\u7f3a\u5931\u7684\u65f6\u5019\uff0c\u53bb\u8be2\u95ee L2\uff0cL2 \u53d1\u73b0\u6709 alias \u7684\u60c5\u51b5\uff0c\u544a\u8bc9 L1 \u7f13\u5b58\uff0c\u8ba9\u4ed6\u53bb\u6307\u5b9a\u7684 set \u91cc\u5bfb\u627e\u6570\u636e\uff0c\u5e76\u4e14\u8fc1\u79fb\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u597d\u5904\u662f\u4e0d\u9700\u8981\u50cf\u7b2c\u4e00\u79cd\u65b9\u6cd5\u90a3\u6837\u53bb\u5bfb\u627e\u53ef\u80fd\u7684\u5339\u914d\uff0c\u800c\u662f\u8ba9 L2 \u53bb\u8bb0\u5f55\u4fe1\u606f\u3002\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u8bb0\u5f55\u66f4\u591a\u4fe1\u606f\uff0c\u53e6\u5916\u8981\u6c42 L2 \u7f13\u5b58\u9700\u8981\u662f inclusive \u7684\u3002\u89c1 <a href=\"https://xiangshan-doc.readthedocs.io/zh-cn/latest/huancun/cache_alias/\">XiangShan Cache \u522b\u540d\u95ee\u9898</a></li>\n</ol>\n<p>\u6b64\u5916\u8fd8\u6709\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u65b9\u6cd5\uff0c\u5efa\u8bae\u9605\u8bfb\u4e0a\u9762\u7684\u53c2\u8003\u8bba\u6587\u3002</p>\n<p>\u56e0\u6b64 VIPT \u4e5f\u53ef\u4ee5\u4e0d\u53d7\u5b9e\u9645\u7684\u9875\u5927\u5c0f\u7684\u9650\u5236\uff0c\u4f46\u662f\u4e3a\u4e86\u89e3\u51b3 aliasing \u7684\u95ee\u9898\uff0c\u9700\u8981\u5728\u8f6f\u4ef6\u4e0a\u6216\u8005\u786c\u4ef6\u4e0a\u627e\u8865\u3002</p>\n<h2 id=\"\u53c2\u8003\">\u53c2\u8003<a class=\"headerlink\" href=\"#\u53c2\u8003\" title=\"Permanent link\">&para;</a></h2>\n<ul>\n<li><a href=\"https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/page-colouring-on-armv6-and-a-bit-on-armv7\">Page Colouring on ARMv6 (and a bit on ARMv7)</a></li>\n<li>\u63a8\u8350\u9605\u8bfb\uff1a<a href=\"https://blog.cyyself.name/why-the-big-l1-cache-is-so-hard/\">\u6d45\u8c08\u73b0\u4ee3\u5904\u7406\u5668\u5b9e\u73b0\u8d85\u5927 L1 Cache \u7684\u65b9\u5f0f</a></li>\n</ul>", "image": null, "date_modified": "2023-12-08T00:00:00+00:00", "authors": [], "tags": ["cache", "cpu", "hardware", "paging", "vipt"]}, {"id": "https://jia.je/software/2023/12/07/reverse-proxy-partial-transfer/", "url": "https://jia.je/software/2023/12/07/reverse-proxy-partial-transfer/", "title": "\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898", "content_html": "<h1 id=\"\u53cd\u5411\u4ee3\u7406\u7684-partial-transfer-\u95ee\u9898\">\u53cd\u5411\u4ee3\u7406\u7684 Partial Transfer \u95ee\u9898<a class=\"headerlink\" href=\"#\u53cd\u5411\u4ee3\u7406\u7684-partial-transfer-\u95ee\u9898\" title=\"Permanent link\">&para;</a></h1>\n<p>\u53cd\u5411\u4ee3\u7406\u5df2\u7ecf\u662f\u65e0\u5904\u4e0d\u5728\uff0c\u4f46\u662f\u5982\u679c\u53cd\u5411\u4ee3\u7406\u6ca1\u6709\u6839\u636e\u4f7f\u7528\u573a\u666f\u8c03\u4f18\uff0c\u6216\u8005\u51fa\u73b0\u4e86\u4e00\u4e9b\u5f02\u5e38\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u4e0d\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u5e76\u4e14\u73b0\u8c61\u5341\u5206\u5947\u602a\uff0c\u4f8b\u5982\u8bbf\u95ee\u67d0 GitLab \u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u5076\u5c14\u4f1a\u51fa\u73b0\u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u7684\u60c5\u51b5\u3002</p>\n<p>\u8fd9\u4e9b\u95ee\u9898\u56f0\u6270\u4e86\u6211\u4eec\u5f88\u4e45\uff0c\u5230\u6700\u540e\u624d\u53d1\u73b0\uff0c\u539f\u6765\u95ee\u9898\u5728\u53cd\u5411\u4ee3\u7406\u4e0a\u3002\u4e0b\u9762\u5c31\u6765\u56de\u987e\u4e00\u4e0b\u4e8b\u60c5\u7684\u7ecf\u8fc7\u3002</p>\n<!-- more -->\n\n<h2 id=\"gitlab-\u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u73b0\u8c61\">GitLab \u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u73b0\u8c61<a class=\"headerlink\" href=\"#gitlab-\u9875\u9762\u52a0\u8f7d\u4e0d\u5b8c\u6574\u73b0\u8c61\" title=\"Permanent link\">&para;</a></h2>\n<p>\u67d0 GitLab \u5b9e\u4f8b\u4ece\u67d0\u4e00\u5929\u5f00\u59cb\uff0c\u7528\u6237\u5c31\u5f00\u59cb\u53cd\u9988\u9875\u9762\u7ecf\u5e38\u5237\u4e0d\u51fa\u6765\u7684\u95ee\u9898\u3002\u6253\u5f00\u6d4f\u89c8\u5668\u7684 Developer Tools \u67e5\u770b HTTP \u8bf7\u6c42\uff0c\u4f1a\u53d1\u73b0\u51fa\u73b0\u62a5\u9519 <code>ERR_CONTENT_LENGTH_MISMATCH</code>\uff08Chrome\uff09\u6216\u8005 <code>NS_ERROR_NET_PARTIAL_TRANSFER</code>\uff08Firefox\uff09\u3002\u4ece\u540d\u5b57\u6765\u770b\uff0c\u8fd9\u4e2a\u9519\u8bef\u7684\u610f\u601d\u662f\uff0c\u6d4f\u89c8\u5668\u53ea\u6536\u5230\u4e86 HTTP \u54cd\u5e94\u7684\u4e00\u90e8\u5206\uff0c\u4f46\u662f HTTP \u54cd\u5e94\u5934\u90e8\u7684 Content-Length \u5374\u6bd4\u5b9e\u9645\u6536\u5230\u7684\u5185\u5bb9\u8981\u591a\uff0c\u8bf4\u660e\u786e\u5b9e\u662f\u6ca1\u53d1\u5168\u3002\u7528 Wireshark \u6293\u5305\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u7f51\u7ad9\u4e3b\u52a8\u53d1\u7684 FIN\uff0c\u4e5f\u4e0d\u50cf\u662f NAT \u7f51\u5173\u7684\u95ee\u9898\u3002</p>\n<p>\u8fd9\u4e2a\u95ee\u9898\u56f0\u6270\u4e86\u7528\u6237\u548c\u7ba1\u7406\u5458\u5f88\u4e45\uff0c\u4e00\u76f4\u6ca1\u6709\u627e\u5230\u539f\u56e0\u3002\u505a\u4e00\u4e9b\u7b80\u5355\u7684\u6d4b\u8bd5\uff0c\u4f1a\u53d1\u73b0\u4e0b\u8f7d\u662f\u5426\u5b8c\u5168\u548c HTTP \u54cd\u5e94\u7684\u5185\u5bb9\u5927\u5c0f\u6709\u5173\uff0c\u4f8b\u5982\u6d4f\u89c8\u4e00\u4e9b\u5927\u7684 HTML\uff0c\u5c31\u5bb9\u6613\u88ab\u622a\u65ad\uff0c\u5e76\u4e14\u622a\u65ad\u4ee5\u540e\u7684\u957f\u5ea6\u6bd4\u8f83\u7a33\u5b9a\u5730\u51fa\u73b0\u5728\u51e0\u4e2a\u6570\u5b57\u4e4b\u95f4\uff1a130304 \u548c 130269\uff0c\u5927\u6982 130 KB\u3002</p>\n<p>\u5728\u7f51\u4e0a\u641c\u7d22\u5173\u952e\u8bcd\uff0c\u53ef\u4ee5\u627e\u5230\u8fd9\u4e48\u4e00\u7bc7 <a href=\"https://stackoverflow.com/questions/37908967/express-and-nginx-neterr-content-length-mismatch/46694782#46694782\">StackOverflow \u56de\u7b54</a>\uff1a<code>Express and nginx net::ERR_CONTENT_LENGTH_MISMATCH</code>\uff0c\u770b\u8d77\u6765\u548c\u6211\u4eec\u9047\u5230\u7684\u73b0\u8c61\u5f88\u7c7b\u4f3c\u3002\u56de\u7b54\u4e2d\u63d0\u5230\uff0cNginx \u6709\u5185\u5efa\u7684 buffering \u673a\u5236\uff0c\u5173\u6389\u5b83\u5c31\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u662f\u8fd9\u770b\u8d77\u6765\u592a\u66b4\u529b\u4e86\uff0c\u4e0d\u50cf\u662f\u5408\u7406\u7684\u89e3\u51b3\u529e\u6cd5\uff0c\u6bd5\u7adf buffering \u673a\u5236\u662f\u6709\u7528\u7684\u3002</p>\n<p>\u4ece <a href=\"http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering\">Nginx \u5b98\u7f51</a>\u53ef\u4ee5\u627e\u5230 buffering \u673a\u5236\u7684\u8bf4\u660e\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>When buffering is enabled, nginx receives a response from the proxied server as\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>soon as possible, saving it into the buffers set by the proxy_buffer_size and\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>proxy_buffers directives. If the whole response does not fit into memory, a part\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>of it can be saved to a temporary file on the disk. Writing to temporary files\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>is controlled by the proxy_max_temp_file_size and proxy_temp_file_write_size\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>directives.\n</span></code></pre></div>\n<p>\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u610f\u601d\u5c31\u662f Nginx \u6253\u5f00 buffering \u673a\u5236\u540e\uff0c\u4f1a\u5c3d\u91cf\u5feb\u5730\u4ece\u540e\u7aef\u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u3002\u8fd9\u5f88\u5408\u7406\uff0c\u56e0\u4e3a\u4e00\u822c\u540e\u7aef\u670d\u52a1\u5668\u7684\u8d44\u6e90\u6bd4\u8f83\u5b9d\u8d35\uff0c\u5982\u679c\u6709\u5f88\u591a\u4e2a\u94fe\u63a5\u5835\u585e\u4e86\uff0cTCP \u53d1\u9001\u7a97\u53e3\u6ee1\u4e86\uff0c\u53d1\u4e0d\u4e86\u65b0\u7684\u6570\u636e\uff0c\u4e00\u76f4\u5728\u7b49\u5f85\u5ba2\u6237\u7aef\u56de\u590d ACK\uff0c\u8fd9\u6837\u5c31\u4f1a\u7ef4\u6301\u5f88\u591a TCP \u8fde\u63a5\uff0c\u5f71\u54cd\u670d\u52a1\u5668\u5904\u7406\u65b0\u8fde\u63a5\u7684\u80fd\u529b\uff0c\u8fd9\u79cd\u7d2f\u6d3b\u5e94\u8be5\u8fd8\u662f\u7531 Nginx \u6765\u5e72\u3002\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff1aNginx \u4ece\u540e\u7aef\u5c3d\u91cf\u5feb\u5730\u8bfb\u53d6\u54cd\u5e94\uff0c\u4f46\u6d4f\u89c8\u5668\u5e76\u4e0d\u4e00\u5b9a\u80fd\u591f\u5f88\u5feb\u5730\u4ece Nginx \u8bfb\u53d6\u54cd\u5e94\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u5230 Nginx \u7684\u7f51\u7edc\u53ef\u80fd\u5f88\u6162\u3002\u901f\u7387\u4e0d\u5339\u914d\uff0c\u90a3\u4e48 Nginx \u80af\u5b9a\u8981\u5b9e\u73b0\u4e00\u5b9a\u7684\u7f13\u5b58\uff0c\u8fd9\u5c31\u662f buffering \u673a\u5236\u3002</p>\n<p>\u5177\u4f53\u5730\uff0c\u4e3a\u4e86\u5b9e\u73b0\u9ad8\u6548\u7684 buffering \u673a\u5236\uff0c\u5f88\u81ea\u7136\u5730\u56de\u60f3\u5230\u7528\u5185\u5b58\u505a buffer\u3002\u4f46\u662f\u5185\u5b58\u5bb9\u91cf\u4e5f\u662f\u76f8\u5bf9\u6709\u9650\u7684\uff0c\u5185\u5b58\u653e\u4e0d\u4e0b\uff0c\u81ea\u7136\u5c31\u53ea\u80fd\u5199\u5230\u786c\u76d8\u91cc\u9762\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u8981\u662f\u786c\u76d8\u4e5f\u6ee1\u4e86\uff0c\u6216\u8005\u5199\u5165\u786c\u76d8\u5931\u8d25\u4e86\uff0c\u600e\u4e48\u529e\uff1f\u4e00\u65b9\u9762\uff0c\u8fd8\u5f97\u8d76\u7d27\u4ece\u540e\u7aef\u8bfb\u53d6\u54cd\u5e94\uff0c\u8ba9\u540e\u7aef\u53bb\u505a\u522b\u7684\u4e8b\u60c5\uff1b\u53e6\u4e00\u65b9\u9762\uff0c\u5ba2\u6237\u7aef\u5728\u6162\u541e\u541e\u5730\u6536\u6570\u636e\uff0c\u786c\u76d8\u53c8\u5199\u4e0d\u8fdb\u53bb\u3002\u8fd9\u65f6\u5019 Nginx \u53ea\u80fd\u653e\u5f03\u6323\u624e\uff0c\u628a\u8fde\u63a5\u65ad\u6389\u3002\u4e8e\u662f\u5ba2\u6237\u7aef\u5c31\u770b\u5230\u4e86 HTTP \u54cd\u5e94\u4f20\u4e86\u4e00\u534a\u7684\u60c5\u51b5\u3002</p>\n<p>\u8fd9\u4e5f\u5c31\u80fd\u89e3\u91ca\u4e4b\u524d\u89c2\u5bdf\u5230\u7684\u4e00\u4e2a\u73b0\u8c61\uff1a\u6709\u7684\u7f51\u9875\uff0c\u8d70\u6709\u7ebf\u7f51\u80fd\u591f\u5b8c\u6574\u6253\u5f00\uff0c\u8d70\u65e0\u7ebf\u7f51\u6253\u5f00\u662f\u4e0d\u5b8c\u6574\u7684\u3002\u4ece buffering \u673a\u5236\u6765\u89e3\u91ca\uff0c\u5c31\u662f\u6709\u7ebf\u7f51\u80fd\u591f\u5728 buffer \u6ee1\u4e4b\u524d\u628a\u6570\u636e\u90fd\u4f20\u5b8c\uff0c\u800c\u65e0\u7ebf\u7f51\u6765\u4e0d\u53ca\u3002</p>\n<h2 id=\"\u672c\u5730\u590d\u73b0\">\u672c\u5730\u590d\u73b0<a class=\"headerlink\" href=\"#\u672c\u5730\u590d\u73b0\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7406\u8bba\u7406\u89e3\u4e86\uff0c\u4e0b\u9762\u6765\u5b9e\u8df5\u4e00\u4e0b\u3002\u6211\u4eec\u7528 docker compose \u542f\u52a8\u4e24\u4e2a\u5bb9\u5668\uff0c\u4e00\u4e2a\u5bb9\u5668 proxy \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\uff0c\u8fd0\u884c\u4e00\u4e2a nginx\uff1b\u53e6\u4e00\u4e2a\u5bb9\u5668 backend \u4f5c\u4e3a\u540e\u7aef\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u4e5f\u8dd1\u4e86\u4e2a nginx\uff0c\u670d\u52a1\u4e00\u4e2a\u7b80\u5355\u7684\u5927 HTML \u6587\u4ef6\u3002\u540e\u7aef\u7528\u5176\u4ed6\u8f6f\u4ef6\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u53ea\u8981\u53ef\u4ee5\u6784\u5efa\u51fa\u8db3\u591f\u5927\u7684 HTTP \u54cd\u5e94\uff08MB \u91cf\u7ea7\uff09\u3002</p>\n<p>Docker compose \u914d\u7f6e\uff1a</p>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"nt\">services</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">  </span><span class=\"nt\">backend</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"nt\">image</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">nginx:stable</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"nt\">ports</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"s\">&quot;127.0.0.1:8001:80&quot;</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"nt\">volumes</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">./backend.conf:/etc/nginx/conf.d/default.conf:ro</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">./backend:/web:ro</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">  </span><span class=\"nt\">proxy</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">    </span><span class=\"nt\">image</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">nginx:stable</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"nt\">ports</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"s\">&quot;127.0.0.1:8002:80&quot;</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">    </span><span class=\"nt\">volumes</span><span class=\"p\">:</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">./proxy.conf:/etc/nginx/conf.d/default.conf:ro</span>\n</span></code></pre></div>\n<p>\u540e\u7aef Nginx \u914d\u7f6e\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>server {\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>    listen 80;\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>    location / {\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>        root /web;\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>    }\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>}\n</span></code></pre></div>\n<p>\u53cd\u5411\u4ee3\u7406 Nginx \u914d\u7f6e\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>server {\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>    listen 80;\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>    location / {\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>        proxy_pass http://backend;\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a>    }\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a>}\n</span></code></pre></div>\n<p>\u90a3\u4e48\u5bf9\u53cd\u4ee3\u7684\u8bbf\u95ee\uff0c\u5c31\u80fd\u8bbf\u95ee\u5230\u540e\u7aef\u4e0a\u7684 <code>index.html</code> \u4e86\u3002\u5728\u672c\u5730\u521b\u5efa\u4e00\u4e2a\u8db3\u591f\u5927\u7684 <code>index.html</code> \u6587\u4ef6\uff0c\u786e\u8ba4\u4e0b\u8f7d\u90fd\u6ca1\u6709\u95ee\u9898\u3002</p>\n<p>\u5728\u641e\u7834\u574f\u4e4b\u524d\uff0c\u53ef\u4ee5\u5148\u7528 <code>inotifywait</code> \u5de5\u5177\u6765\u89c2\u5bdf Nginx \u8bfb\u5199\u6587\u4ef6\u7684\u884c\u4e3a\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>apt<span class=\"w\"> </span>update\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>inotify-tools\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a>docker<span class=\"w\"> </span><span class=\"nb\">exec</span><span class=\"w\"> </span>-it<span class=\"w\"> </span>nginx-partial-content-test-proxy-1<span class=\"w\"> </span>/bin/bash\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a>inotifywait<span class=\"w\"> </span>-r<span class=\"w\"> </span>-m<span class=\"w\"> </span>/var/cache/nginx\n</span></code></pre></div>\n<p>\u7528 ApacheBench \u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\uff1a<code>ab -n 10000 -c 10 http://localhost:8002/</code>\uff0c\u53ef\u4ee5\u770b\u5230 <code>inotifywait</code> \u663e\u793a Nginx \u8fdb\u7a0b\u5bf9 <code>/var/cache/nginx/proxy_temp</code> \u76ee\u5f55\u4e0b\u8fdb\u884c\u4e86\u5927\u91cf\u7684\u8bfb\u5199\uff0c\u8fd9\u5c31\u662f\u524d\u9762\u6240\u8ff0\u7684 buffering \u673a\u5236\uff0c\u7528\u6765\u4fdd\u5b58\u6587\u4ef6\u7684\u8def\u5f84\u3002</p>\n<p>\u63a5\u4e0b\u6765\u4fee\u6539\u6743\u9650\uff0c\u8ba9 Nginx \u65e0\u6cd5\u8bfb\u53d6\u8be5\u76ee\u5f55\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>docker<span class=\"w\"> </span><span class=\"nb\">exec</span><span class=\"w\"> </span>-it<span class=\"w\"> </span>nginx-partial-content-test-proxy-1<span class=\"w\"> </span>/bin/bash\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>chmod<span class=\"w\"> </span><span class=\"m\">000</span><span class=\"w\"> </span>/var/cache/nginx/proxy_temp\n</span></code></pre></div>\n<p>\u6b64\u65f6\u518d\u53bb\u8dd1 ApacheBench\uff0c\u4f1a\u53d1\u73b0\u5927\u90e8\u5206\u8bf7\u6c42\u90fd\u56e0\u4e3a\u957f\u5ea6\u95ee\u9898\u5931\u8d25\u4e86\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>Concurrency Level:      10\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>Time taken for tests:   5.707 seconds\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a>Complete requests:      10000\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>Failed requests:        9999\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a>   (Connect: 0, Receive: 0, Length: 9999, Exceptions: 0)\n</span></code></pre></div>\n<p>\u7528 curl \u4e5f\u53ef\u4ee5\u6d4b\u8bd5\u51fa\u7c7b\u4f3c\u7684\u9519\u8bef\uff1a<code>curl: (18) transfer closed with 455593 bytes remaining to read</code>\u3002\u6b64\u65f6 proxy \u5bb9\u5668\u4e5f\u4f1a\u62a5\u9519\uff1a<code>open() \"/var/cache/nginx/proxy_temp/7/63/0000014637\" failed (13: Permission denied) while reading upstream, client: 172.18.0.1, server: , request: \"GET / HTTP/1.1\", upstream: \"http://172.18.0.3:80/\", host: \"localhost:8002\"</code>\u3002\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u4e5f\u590d\u73b0\u4e86\u4e4b\u524d\u5728 GitLab \u5b9e\u4f8b\u4e0a\u770b\u5230\u7684\u73b0\u8c61\u3002\u6062\u590d\u76ee\u5f55\u6743\u9650\u4ee5\u540e\uff0c\u4e00\u5207\u90fd\u6b63\u5e38\u4e86\u3002</p>\n<p>\u8fd9\u5370\u8bc1\u4e86\u4e4b\u524d\u7684\u731c\u60f3\uff1a<code>proxy_temp</code> \u76ee\u5f55\u5199\u4e0d\u8fdb\u53bb\uff0c\u5c31\u6709\u6982\u7387\u51fa\u73b0 Partial Transfer \u7684\u60c5\u51b5\u3002\u4f46\u662f\uff0c\u6b64\u65f6\u4e0b\u8f7d\u7684\u6587\u4ef6\u5927\u5c0f\u6bd4\u8f83\u968f\u673a\uff0c\u4e0d\u50cf\u4e4b\u524d\u90a3\u6837\u96c6\u4e2d\u5728 130 KB\u3002\u8fd9\u65f6\u5019\u5c31\u8981\u601d\u8003 Partial Transfer \u7684\u539f\u7406\u4e86\uff1a\u5ba2\u6237\u7aef\u53d1\u8d77 HTTP \u8bf7\u6c42\uff0cproxy \u5bb9\u5668\u6536\u5230\u8bf7\u6c42\uff0c\u8f6c\u53d1\u7ed9 backend\uff1bbackend \u6536\u5230 HTTP \u8bf7\u6c42\u540e\uff0c\u5c31\u7ed9 proxy \u53d1\u9001 HTTP \u54cd\u5e94\u3002\u7136\u540e proxy \u5bb9\u5668\u4e00\u8fb9\u4ece backend \u63a5\u6536 HTTP \u54cd\u5e94\uff0c\u53e6\u4e00\u8fb9\u8fd8\u8981\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u65ad\u5f00\u5462\uff1f\u5c31\u662f\u5185\u5b58\u91cc\u7684 buffer \u90fd\u7528\u5b8c\u4e86\uff0cbackend \u7ed9 proxy \u53d1\u9001\u5f97\u5feb\uff0cproxy \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u5f97\u6162\uff0c\u901f\u5ea6\u7684\u5dee\uff0c\u51b3\u5b9a\u4e86\u5185\u5b58\u91cc\u7684 buffer \u53ef\u4ee5\u6491\u591a\u4e45\u3002</p>\n<p>\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u7406\u8bba\uff0c\u624b\u52a8\u7ed9\u5ba2\u6237\u7aef\u5230 proxy \u5bb9\u5668\u7684\u94fe\u8def\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5ef6\u8fdf\uff0c\u8fd9\u6837\u5c31\u62d6\u6162\u4e86 proxy \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u901f\u5f55\u3002\u5728 Linux \u4e0a\uff0c\u53ef\u4ee5\u7528 <a href=\"https://medium.com/@kazushi/simulate-high-latency-network-using-docker-containerand-tc-commands-a3e503ea4307\">tc \u7ed9\u7f51\u7edc\u63a5\u53e3\u4eba\u4e3a\u5730\u6dfb\u52a0\u5ef6\u8fdf</a>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>tc<span class=\"w\"> </span>qdisc<span class=\"w\"> </span>add<span class=\"w\"> </span>dev<span class=\"w\"> </span><span class=\"o\">[</span>bridge_name<span class=\"o\">]</span><span class=\"w\"> </span>root<span class=\"w\"> </span>netem<span class=\"w\"> </span>delay<span class=\"w\"> </span>100ms\n</span></code></pre></div>\n<p>`bridge_name`` \u662f\u4ee5 br- \u5f00\u5934\u7684 bridge \u7f51\u7edc\u63a5\u53e3\u540d\u3002\u6b64\u65f6\u7528 ping \u6d4b\u91cf\uff0c\u4ece proxy \u5bb9\u5668\u8bbf\u95ee host \u8981 100 ms\uff0cproxy \u5bb9\u5668\u8bbf\u95ee backend \u5bb9\u5668\u8981 0.02 ms\u3002\u8fd9\u5c31\u8fbe\u6210\u4e86\u4e0d\u5bf9\u79f0\u7684\u76ee\u7684\u3002\u6dfb\u52a0\u4e86\u5ef6\u8fdf\u540e\uff0c\u53d1\u73b0 curl \u4e0b\u8f7d\u7684\u6587\u4ef6\u5927\u5c0f\u7a33\u5b9a\u5728 109312 \u5b57\u8282\u9644\u8fd1\uff0c\u4e5f\u5c31\u662f 109 KB\u3002\u867d\u7136\u548c\u524d\u9762\u7684 130 KB \u4e0d\u76f8\u7b49\uff0c\u4f46\u662f\u4e5f\u8db3\u4ee5\u8bc1\u660e\u4e86\u662f\u7c7b\u4f3c\u7684\u60c5\u51b5\u3002\u8fd9\u4e2a\u5927\u5c0f\uff0c\u5e94\u8be5\u548c nginx \u5728\u5185\u5b58\u4e2d\u7ed9\u6bcf\u4e2a\u94fe\u63a5\u7ef4\u62a4\u7684 buffer \u5927\u5c0f\u6709\u5173\uff0c\u4e5f\u548c\u7f51\u7edc\u4e0a\u4f20\u8f93\u7684\u8fc7\u7a0b\u6709\u5173\u3002</p>\n<p>\u5c0f\u7ed3\uff1a</p>\n<ol>\n<li>\u56e0 nginx \u5bb9\u5668\u4e0a proxy_temp \u8def\u5f84\u4e0b\u65e0\u6cd5\u5199\u5165\u6587\u4ef6\uff08\u4f8b\u5982\u6743\u9650\u4e0d\u6b63\u786e\u3001\u76d8\u6ee1\u4e86\uff09\uff0cnginx \u7684 buffering \u673a\u5236\u5728\u9047\u5230\u5185\u5b58\u4e2d buffer \u7528\u5b8c\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u622a\u65ad HTTP \u54cd\u5e94\uff1b</li>\n<li>\u6839\u636e\u5ba2\u6237\u7aef\u5230 nginx\uff0cnginx \u5230\u540e\u7aef\u7684\u5e26\u5bbd\u548c\u5ef6\u8fdf\u60c5\u51b5\uff0c\u53ef\u80fd\u4f1a\u622a\u65ad\u5230\u4e0d\u540c\u7684\u4f4d\u7f6e\u3002</li>\n</ol>\n<h2 id=\"\u6743\u9650\u95ee\u9898\">\u6743\u9650\u95ee\u9898<a class=\"headerlink\" href=\"#\u6743\u9650\u95ee\u9898\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6709\u610f\u601d\u7684\u662f\uff0c\u7ba1\u7406\u5458\u8868\u793a\u4e4b\u524d\u5e76\u6ca1\u6709\u6539\u8fc7\u76ee\u5f55\u7684\u6743\u9650\u3002\u5728\u7f51\u4e0a\u67e5\u4e86\u4e00\u4e0b\uff0c\u6709\u7f51\u53cb\u53cd\u9988\u9047\u5230\u4e86\u7c7b\u4f3c\u7684\u95ee\u9898\uff1a<a href=\"https://forum.nginx.org/read.php?2,296793,296793#msg-296793\">Changing ownership of proxy_temp and other temp directories</a>\u3002\u7f51\u53cb\u8868\u793a\uff0c\u4ed6\u5347\u7ea7 nginx \u4e4b\u524d\uff0cproxy_temp \u8def\u5f84\u7684\u6743\u9650\u662f\u5f52 nobody \u6240\u6709\uff0cnginx \u4e5f\u662f\u7528 nobody \u7528\u6237\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u6ca1\u6709\u95ee\u9898\u3002\u5347\u7ea7 nginx \u4ee5\u540e\uff0cnginx \u7528\u5355\u72ec\u7684 nginx \u7528\u6237\u53bb\u6267\u884c\uff0c\u6b64\u65f6\u5b83\u6ca1\u6709\u529e\u6cd5\u8bbf\u95ee nobody \u7528\u6237\u521b\u5efa\u7684\u6587\u4ef6\u5939\uff0c\u56e0\u4e3a\u6743\u9650\u662f <code>rwx------</code>\u3002</p>\n<p>\u5982\u679c\u6df1\u5165\u89c2\u5bdf\u90ae\u4ef6\u56de\u590d\uff0c\u4f1a\u53d1\u73b0\u6700\u7ec8\u5f15\u5230\u4e86\u4e00\u4e2a <a href=\"https://github.com/vmware/photon/commit/abbfedfda7dfd7905d2953745cf1332fde80689c#diff-9a5cc4e7b91577cbccbb6aacc4bc2ee46672ccbe984b89581fc600b2877729f5\">GitHub commit</a>\uff0c\u5b83\u5728\u7ed9 nginx \u6dfb\u52a0\u65b0\u529f\u80fd\u7684\u540c\u65f6\uff0c\u4fee\u6539\u4e86\u9ed8\u8ba4\u7684 nginx \u7528\u6237\u8bbe\u7f6e\uff0c\u4f7f\u5f97\u9ed8\u8ba4\u7528\u6237\u53d8\u6210\u4e86 nginx\u3002\u4ece\u7ef4\u62a4\u8005\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u628a nobody \u6362\u6210 nginx \u7528\u6237\uff0c\u5e94\u8be5\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\u3002\u5374\u4e0d\u77e5\u9053 nginx \u4f1a\u7528 nobody \u7528\u6237\u521b\u5efa proxy_temp \u7b49\u76ee\u5f55\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u4e25\u683c\u7684\u6743\u9650\u3002\u4e00\u5347\u7ea7\uff0c\u7528\u6237\u4e00\u53d8\uff0cnginx \u81ea\u5df1\u5c31\u7528\u4e0d\u4e86\u4e86\u3002\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u95ee\u9898\u3002</p>\n<p>\u5728\u67d0 GitLab \u5b9e\u4f8b\u7684\u95ee\u9898\u4e0a\uff0c\u6700\u540e\u53d1\u73b0\u786e\u5b9e\u662f\u6743\u9650\u95ee\u9898\u3002\u4f46\u662f\u7ec6\u8282\u548c\u4e0a\u9762\u7684\u4e5f\u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u5177\u4f53\u6743\u9650\u600e\u4e48\u574f\u7684\uff0c\u76ee\u524d\u8fd8\u662f\u4e00\u4e2a\u8c1c\u3002</p>", "image": null, "date_modified": "2023-12-07T00:00:00+00:00", "authors": [], "tags": ["http", "network", "nginx", "proxy", "software"]}, {"id": "https://jia.je/software/2023/12/05/packaging-cookbook/", "url": "https://jia.je/software/2023/12/05/packaging-cookbook/", "title": "\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5", "content_html": "<h1 id=\"\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5\">\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5<a class=\"headerlink\" href=\"#\u5305\u7ba1\u7406\u5668\u6253\u5305\u547d\u4ee4\u901f\u67e5\" title=\"Permanent link\">&para;</a></h1>\n<p>\u968f\u7740 Linux \u4f7f\u7528\u9010\u6e10\u6df1\u5165\uff0c\u5f00\u59cb\u5c1d\u8bd5\u53c2\u4e0e\u5230\u4e00\u4e9b\u53d1\u884c\u7248/\u5305\u7ba1\u7406\u5668\u7684\u7ef4\u62a4\u5f53\u4e2d\u3002\u5728\u6b64\u8bb0\u5f55\u4e00\u4e0b\u6253\u5305\u76f8\u5173\u547d\u4ee4\uff0c\u65b9\u4fbf\u81ea\u5df1\u901f\u67e5\u3002</p>\n<!-- more -->\n\n<h2 id=\"aosc-os\">AOSC OS<a class=\"headerlink\" href=\"#aosc-os\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6587\u6863\uff1a<a href=\"https://wiki.aosc.io/developer/packaging/basics/\">Intro to Package Maintenance: Basics</a></p>\n<p>\u7528 ciel \u5de5\u5177\u514b\u9686\u8f6f\u4ef6\u6e90 + \u5728\u5bb9\u5668\u4e2d\u6784\u5efa\u3002\u521b\u5efa\u4e00\u4e2a\u6253\u5305\u73af\u5883\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>ciel<span class=\"w\"> </span>new\n</span></code></pre></div>\n<p>\u6b64\u65f6\u76ee\u5f55\u4e0b\u5305\u62ec\uff1a</p>\n<ol>\n<li>TREE \u76ee\u5f55\uff1a<a href=\"https://github.com/AOSC-Dev/aosc-os-abbs\">AOSC-Dev/aosc-os-abbs</a> \u7684\u514b\u9686</li>\n<li>OUTPUT-* \u76ee\u5f55\uff1a\u653e\u7f6e\u6253\u5305\u51fa\u6765\u7684 deb</li>\n</ol>\n<p>\u53ef\u4ee5\u5728 TREE \u76ee\u5f55\u4e0b\u8fdb\u884c\u5305\u7684\u66f4\u65b0\u7b49\u7b49\u64cd\u4f5c\u3002\u5982\u679c\u8981\u6784\u5efa\u5305\uff0c\u5047\u8bbe\u5728\u4e0a\u4e00\u6b65\u521b\u5efa\u6253\u5305\u73af\u5883\u65f6\uff0c\u540d\u5b57\u8bbe\u7f6e\u4e3a main\uff0c\u7528\u547d\u4ee4\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>ciel<span class=\"w\"> </span>build<span class=\"w\"> </span>-i<span class=\"w\"> </span>main<span class=\"w\"> </span><span class=\"o\">[</span>packages<span class=\"o\">]</span>\n</span></code></pre></div>\n<p>\u6784\u5efa\u5b8c\u6210\u7684 deb \u4f1a\u653e\u5230 <code>OUTPUT-[branch]</code> \u4e0b\uff0c\u4f8b\u5982\u9ed8\u8ba4\u662f stable \u5206\u652f\u7684\u8bdd\uff0c\u9ed8\u8ba4\u4f1a\u653e\u5230 <code>OUTPUT-stable</code> \u4e0b\u3002</p>\n<p>\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u5982\u679c\u8981\u63d0\u4ea4\u5230\u8f6f\u4ef6\u6e90\uff0c\u8fdb\u5165\u67d0\u4e2a OUTPUT \u76ee\u5f55\uff0c\u7528 <code>pushpkg</code> \u547d\u4ee4\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>pushpkg<span class=\"w\"> </span><span class=\"o\">[</span>-d<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>user_name<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>branch<span class=\"o\">]</span>\n</span></code></pre></div>\n<p><code>-d</code> \u53c2\u6570\u8868\u793a\u63d0\u4ea4\u540e\u5220\u9664\u672c\u5730\u7684\u6587\u4ef6\u3002</p>\n<p>\u8d21\u732e\u6d41\u7a0b\uff1a</p>\n<ol>\n<li>\u4ece stable checkout \u51fa\u65b0\u7684\u5206\u652f</li>\n<li>\u4fee\u6539 TREE \u91cc\u9762\u7684\u5185\u5bb9</li>\n<li>\u7528 <code>ciel build -i main [packages]</code> \u6784\u5efa\uff0c\u53ef\u4ee5\u7528\u793e\u533a\u63d0\u4f9b\u7684 Buildbot</li>\n<li>\uff08\u53ef\u9009\uff09pushpkg \u63a8\u5230\u8f6f\u4ef6\u6e90</li>\n<li>Push \u5230 GitHub \u7684\u5206\u652f\uff0c\u6253\u5f00 pr</li>\n<li>\u7b49\u5f85\u5ba1\u6838\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u5408\u5e76\u5e76 pushpkg \u5230 stable</li>\n</ol>\n<h2 id=\"debian\">Debian<a class=\"headerlink\" href=\"#debian\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6211\u8fd8\u6ca1\u6709\u6210\u4e3a Debian \u7ef4\u62a4\u8005\uff0c\u56e0\u6b64\u5e76\u4e0d\u4e86\u89e3\u5b8c\u6574\u6d41\u7a0b\u3002</p>\n<p>\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u6709\u7684\u5305\uff0c\u7528 <code>apt source</code> \u4e0b\u8f7d\u6e90\u7801\u548c debian \u7684\u6587\u4ef6\u3002\u5f88\u591a\u5305\u5df2\u7ecf\u632a\u5230\u4e86 salsa\uff0c\u4e5f\u5c31\u662f debian \u7684 gitlab \u5b9e\u4f8b\u4e0a\uff0c\u5982\u679c\u6709\uff0c<code>apt source</code> \u4f1a\u63d0\u793a\u4f60\u53ef\u4ee5\u76f4\u63a5\u4ece salsa \u4e0a\u514b\u9686\u4ed3\u5e93\u3002</p>\n<p>\u4e0b\u8f7d\u4e86\u4ee5\u540e\uff0c\u5f97\u5230\u7684\u662f\u4e00\u4efd\u6e90\u7801\uff0c\u5916\u52a0 <code>debian</code> \u76ee\u5f55\u3002\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u662f <code>debian/control</code>\uff08\u8bb0\u5f55\u4e86\u5305\u7684\u5143\u6570\u636e\uff09\u548c <code>debian/rules</code>\uff08\u5982\u4f55\u6784\u5efa\uff09\u3002</p>\n<p>\u4e3a\u4e86\u6784\u5efa\u5305\uff0c\u7b80\u5355\u7684\u529e\u6cd5\u662f\u7528 <code>dpkg-buildpackage</code> \u547d\u4ee4\u3002\u5e38\u7528\u53c2\u6570\uff1a</p>\n<ol>\n<li><code>-b</code>\uff1a\u53ea\u6784\u5efa\u4e8c\u8fdb\u5236\u5305</li>\n<li><code>-us -uc</code>\uff1a\u6ca1\u6709\u914d\u7f6e GPG\uff0c\u6ca1\u6cd5\u7b7e\u540d\uff0c\u81ea\u7528\u7684\u65f6\u5019\u9009\u62e9\u4e0d\u7b7e\u540d</li>\n<li><code>-nc</code>\uff1a\u6784\u5efa\u524d\u4e0d clean</li>\n<li><code>-d</code>\uff1a\u5373\u4f7f\u4f9d\u8d56\u4e0d\u80fd\u6ee1\u8db3\uff0c\u4e5f\u8981\u6784\u5efa</li>\n</ol>\n<p>\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</p>\n<ol>\n<li><code>DEB_BUILD_PROFILES</code>\uff1a\u8bbe\u7f6e profile\uff0c\u5e38\u89c1\u7684\u6709 nocheck nodoc \u7b49\u7b49\uff0c\u548c debian/control \u6587\u4ef6\u91cc\u7684 <code>&lt;profile&gt;</code> \u5bf9\u5e94</li>\n<li><a href=\"https://www.debian.org/doc/debian-policy/ch-source.html#debian-rules-and-deb-build-options\"><code>DEB_BUILD_OPTIONS</code></a>\uff1a\u548c profile \u7c7b\u4f3c\uff0c\u4f46\u662f\u7528\u6cd5\u7565\u6709\u4e0d\u540c\uff0c\u5e38\u89c1\u7684\u6709 nocheck nodoc noopt nostrip \u7b49\u7b49</li>\n</ol>\n<p>\u5bf9\u4e8e<a href=\"https://wiki.debian.org/PackagingWithGit\">\u57fa\u4e8e git \u7684\u5305</a>\uff0c\u4f8b\u5982\u4ece salsa \u4e0a clone \u7684\u5305\uff0c\u53ef\u4ee5\u7528 gbp \u5de5\u5177\uff1a</p>\n<ol>\n<li><code>gbp buildpackage</code>\uff1a\u529f\u80fd\u5bf9\u5e94 dpkg-buildpackage\u3002</li>\n<li><code>gbp import-orig</code>\uff1a\u5bfc\u5165\u4e00\u4e2a\u4e0a\u6e38\u6e90\u7801\u7684 tarball \u5230\u4ed3\u5e93\u4e2d\uff0c\u53ef\u4ee5\u6dfb\u52a0 <code>--uscan</code> \u53c2\u6570\u8ba9\u5b83\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e0b\u8f7d\u65b0\u7248\uff1b\u53ef\u4ee5\u6dfb\u52a0 <code>--pristine-tar</code> \u53c2\u6570\u8ba9\u5b83\u4fdd\u7559\u4e00\u4efd\u539f\u59cb tarball\uff08\u7684 delta\uff09\u3002</li>\n</ol>\n<p>dpkg-buildpackage \u9ed8\u8ba4\u4f1a\u5728\u5f53\u524d\u73af\u5883\u4e0b\u6784\u5efa\u65b0\u5305\uff0c\u56e0\u6b64\u5982\u679c\u7f3a\u4e86\u4f9d\u8d56\uff0c\u5c31\u9700\u8981\u5168\u5c40\u5b89\u88c5\u3002\u5982\u679c\u4e0d\u60f3\u8fd9\u6837\uff0c\u53ef\u4ee5\u914d\u7f6e sbuild\uff0c\u5728 chroot \u4e2d\u8fdb\u884c\u6784\u5efa\u3002</p>\n<p>\u914d\u7f6e <a href=\"https://wiki.debian.org/sbuild\">sbuild</a> \u7684\u7b80\u5355\u529e\u6cd5\u662f\u7528 <a href=\"https://manpages.debian.org/unstable/sbuild/sbuild-debian-developer-setup.1\">sbuild-debian-developer-setup</a> \u547d\u4ee4\u3002\u5b83\u4f1a\u5728 <code>/srv/chroot</code> \u4e0b\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u5bb9\u5668\u7684 sysroot\uff0c\u91cc\u9762\u662f\u4e00\u4e2a\u5e72\u51c0\u7684 debian \u73af\u5883\u3002\u4e4b\u540e\uff0c\u53ef\u4ee5\u7528 sbuild \u547d\u4ee4\uff0c\u5728\u5bb9\u5668\u91cc\u9762\u6784\u5efa\u3002</p>\n<h2 id=\"nixpkgs\">Nixpkgs<a class=\"headerlink\" href=\"#nixpkgs\" title=\"Permanent link\">&para;</a></h2>\n<p>Nixpkgs \u6253\u5305\u8fc7\u7a0b\u6bd4\u8f83\u7b80\u5355\uff1a</p>\n<ol>\n<li>\u4fee\u6539 Nixpkgs \u4ed3\u5e93</li>\n<li>\u7528 nix \u547d\u4ee4\u6784\u5efa\u65b0\u5305\uff1a<code>nix build -L .#package</code></li>\n<li>\uff08\u53ef\u9009\uff09\u7528 nixpkgs-review \u6784\u5efa\u6240\u6709\u9700\u8981\u91cd\u65b0\u6784\u5efa\u7684\u5305</li>\n<li>Push \u5230 GitHub\uff0c\u521b\u5efa PR</li>\n<li>\u7b49\u5f85\u5ba1\u6838\u548c\u5408\u5e76</li>\n</ol>\n<p>Homebrew \u4e5f\u662f\u7c7b\u4f3c\u7684\u3002</p>", "image": null, "date_modified": "2023-12-05T00:00:00+00:00", "authors": [], "tags": ["linux", "packaging", "software"]}, {"id": "https://jia.je/software/2023/11/26/mkdocs-material-instant-navigation/", "url": "https://jia.je/software/2023/11/26/mkdocs-material-instant-navigation/", "title": "mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9", "content_html": "<h1 id=\"mkdocs-material-\u7684-instant-navigation-\u529f\u80fd\u5751\u70b9\">mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5751\u70b9<a class=\"headerlink\" href=\"#mkdocs-material-\u7684-instant-navigation-\u529f\u80fd\u5751\u70b9\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>mkdocs-material \u652f\u6301 <a href=\"https://squidfunk.github.io/mkdocs-material/setup/setting-up-navigation/#instant-loading\">Instant Navigation</a>\uff1a\u542f\u7528\u4e86\u4ee5\u540e\uff0c\u5728\u7f51\u9875\u91cc\u70b9\u51fb\u5176\u4ed6\u9875\u9762\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u7528\u7c7b\u4f3c SPA \u7684\u65b9\u6cd5\uff0c\u53bb fetch \u65b0\u7684\u7f51\u9875\uff0c\u7136\u540e\u539f\u5730\u66ff\u6362\uff0c\u800c\u4e0d\u662f\u8ba9\u6d4f\u89c8\u5668\u8df3\u8f6c\u8fc7\u53bb\uff0c\u53ef\u4ee5\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002</p>\n<p>\u4f46\u662f\u5728\u7528\u8fd9\u4e2a\u529f\u80fd\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u73b0\u5176\u5b9e\u5e76\u4e0d\u662f\u90a3\u4e48\u7b80\u5355\u3002\u3002\u3002</p>\n<!-- more -->\n\n<h2 id=\"sitemap\">Sitemap<a class=\"headerlink\" href=\"#sitemap\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4f7f\u7528 Instant Navigation \u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff1a\u672c\u5730 <code>mkdocs serve</code> \u7684\u65f6\u5019\u53ef\u4ee5\u5de5\u4f5c\uff0c\u800c\u7ebf\u4e0a <code>mkdocs build</code> \u518d\u7528 nginx \u90e8\u7f72\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u5de5\u4f5c\u4e86\uff0c\u8fd9\u662f\u4e3a\u5565\u5462\uff1f</p>\n<p>\u9605\u8bfb <a href=\"https://github.com/squidfunk/mkdocs-material/blob/bf6e66bddd6cc94ab4fd9becf9fb9d9a2d33f6e2/src/templates/assets/javascripts/integrations/instant/index.ts\">instant/index.ts</a> \u6e90\u4ee3\u7801\uff0c\u53d1\u73b0\u5b83\u4f1a\u68c0\u67e5\u70b9\u51fb\u7684\u94fe\u63a5\u662f\u5426\u5728 sitemap \u4e2d\u51fa\u73b0\uff1a</p>\n<div class=\"language-typescript highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"w\">        </span><span class=\"c1\">// Skip, if URL is not included in the sitemap - this could be the case</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">        </span><span class=\"c1\">// when linking between versions or languages, or to another page that</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">        </span><span class=\"c1\">// the author included as part of the build, but that is not managed by</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">        </span><span class=\"c1\">// MkDocs. In that case we must not continue with instant navigation.</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">sitemap</span><span class=\"p\">.</span><span class=\"nx\">includes</span><span class=\"p\">(</span><span class=\"sb\">`</span><span class=\"si\">${</span><span class=\"nx\">url</span><span class=\"si\">}</span><span class=\"sb\">`</span><span class=\"p\">))</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">          </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nx\">EMPTY</span>\n</span></code></pre></div>\n<p>\u4f46\u662f\u89c2\u5bdf\u4e86\u4e00\u4e0b\u751f\u6210\u7684 <code>site</code> \u76ee\u5f55\uff0c\u53d1\u73b0\u4e0b\u9762\u7684 sitemap.xml \u662f\u7a7a\u7684\u3002\u67e5\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u9700\u8981\u914d\u7f6e <code>site_url</code> \u624d\u4f1a\u751f\u6210 sitemap.xml \u7684\u5185\u5bb9\u3002\u8fd9\u4e5f\u53ef\u4ee5\u7406\u89e3\uff0c\u6bd5\u7adf sitemap.xml \u91cc\u9762\u5199\u5f97\u662f\u7edd\u5bf9 URL\u3002</p>\n<p>\u6dfb\u52a0 <code>site_url</code> \u4ee5\u540e\uff0c\u7ec8\u4e8e\u751f\u6210\u4e86 sitemap\uff0c\u4f46\u662f instant navigation \u4f9d\u7136\u4e0d\u5de5\u4f5c\uff1a\u7528 Chrome Developer Tools \u8c03\u8bd5\uff0c\u53d1\u73b0\u4ee3\u7801\u8bfb\u53d6\u51fa\u6765\u7684 sitemap \u4f9d\u7136\u4e3a\u7a7a\u3002\u9605\u8bfb<a href=\"https://github.com/squidfunk/mkdocs-material/blob/bf6e66bddd6cc94ab4fd9becf9fb9d9a2d33f6e2/src/templates/assets/javascripts/integrations/sitemap/index.ts#L91\">\u4ee3\u7801</a>\uff0c\u53d1\u73b0\uff1a</p>\n<div class=\"language-typescript highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"w\">  </span><span class=\"kd\">const</span><span class=\"w\"> </span><span class=\"nx\">cached</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nx\">__md_get</span><span class=\"o\">&lt;</span><span class=\"nx\">Sitemap</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s2\">&quot;__sitemap&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">sessionStorage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">base</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">cached</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">of</span><span class=\"p\">(</span><span class=\"nx\">cached</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"kd\">const</span><span class=\"w\"> </span><span class=\"nx\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nx\">configuration</span><span class=\"p\">()</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nx\">requestXML</span><span class=\"p\">(</span><span class=\"ow\">new</span><span class=\"w\"> </span><span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"s2\">&quot;sitemap.xml&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">base</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"nx\">base</span><span class=\"p\">))</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">      </span><span class=\"p\">.</span><span class=\"nx\">pipe</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">        </span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">sitemap</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"nx\">preprocess</span><span class=\"p\">(</span><span class=\"nx\">getElements</span><span class=\"p\">(</span><span class=\"s2\">&quot;loc&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">sitemap</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">          </span><span class=\"p\">.</span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">node</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"nx\">node</span><span class=\"p\">.</span><span class=\"nx\">textContent</span><span class=\"o\">!</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">        </span><span class=\"p\">)),</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">        </span><span class=\"nx\">catchError</span><span class=\"p\">(()</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"nx\">EMPTY</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"c1\">// @todo refactor instant loading</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">        </span><span class=\"nx\">defaultIfEmpty</span><span class=\"p\">([]),</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">        </span><span class=\"nx\">tap</span><span class=\"p\">(</span><span class=\"nx\">sitemap</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"nx\">__md_set</span><span class=\"p\">(</span><span class=\"s2\">&quot;__sitemap&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">sitemap</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">sessionStorage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">base</span><span class=\"p\">))</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">      </span><span class=\"p\">)</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u4ee3\u7801\u91cc\u7f13\u5b58\u4e86 sitemap \u7684\u5185\u5bb9\u5230 session storage \u4e2d\uff0c\u8fdb\u5165 developer tools\uff0c\u4ece session storage \u4e2d\u5220\u6389 sitemap\uff0c\u5c31\u53ef\u4ee5\u53d1\u73b0\u5b83\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684 sitemap\uff0cinstant navigation \u4e5f\u5de5\u4f5c\u4e86\u3002</p>\n<h2 id=\"wavedrom\">Wavedrom<a class=\"headerlink\" href=\"#wavedrom\" title=\"Permanent link\">&para;</a></h2>\n<p>Instant Navigation \u867d\u7136\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u70b9\u51fb\u7528\u4e86 WaveDrom \u7684\u7f51\u9875\u540e\uff0c\u4f1a\u53d1\u73b0\u91cc\u9762\u7684 WaveDrom \u4ee3\u7801\u6ca1\u6709\u88ab\u6e32\u67d3\u51fa\u6765\uff0c\u5e76\u4e14 Developer Tools \u4f1a\u62a5\u9519\u3002</p>\n<p>\u9605\u8bfb\u4ee3\u7801\uff0c\u53d1\u73b0 Instant Navigation \u4f1a\u91cd\u65b0\u8fd0\u884c\u65b0\u9875\u9762\u4e0a\u5185\u5d4c\u7684 <code>&lt;script&gt;</code> \u6807\u7b7e\uff0c\u7136\u800c WaveDrom \u4e5f\u6b63\u597d\u4f1a\u4f7f\u7528 <code>&lt;script&gt;</code> \u6807\u7b7e\u6765\u5199\u5b83\u7684 WaveJSON \u914d\u7f6e\uff0c\u53ea\u4e0d\u8fc7\u662f <code>&lt;script type=\"WaveDrom\"&gt;</code>\uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u6d4f\u89c8\u5668\u6267\u884c\u3002</p>\n<p>\u7136\u800c Instant Navigation \u91cd\u65b0\u8fd0\u884c\u7684\u65f6\u5019\uff0c<a href=\"https://github.com/squidfunk/mkdocs-material/blob/bf6e66bddd6cc94ab4fd9becf9fb9d9a2d33f6e2/src/templates/assets/javascripts/integrations/instant/index.ts#L355-L357\">\u6ca1\u6709\u8003\u8651\u5230\u8fd9\u79cd\u60c5\u51b5</a>\uff1a</p>\n<div class=\"language-typescript highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"w\">              </span><span class=\"kd\">const</span><span class=\"w\"> </span><span class=\"nx\">script</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nx\">next</span><span class=\"p\">.</span><span class=\"nx\">createElement</span><span class=\"p\">(</span><span class=\"s2\">&quot;script&quot;</span><span class=\"p\">)</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">              </span><span class=\"c1\">// ...</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">              </span><span class=\"nx\">script</span><span class=\"p\">.</span><span class=\"nx\">textContent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nx\">el</span><span class=\"p\">.</span><span class=\"nx\">textContent</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">              </span><span class=\"nx\">el</span><span class=\"p\">.</span><span class=\"nx\">replaceWith</span><span class=\"p\">(</span><span class=\"nx\">script</span><span class=\"p\">)</span>\n</span></code></pre></div>\n<p>\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 <code>&lt;script&gt;</code> tag\uff0c\u4ece\u65e7\u7684\u590d\u5236\u4e86 textContent\uff0c\u4f46\u662f\u6ca1\u6709\u590d\u5236 type\u3002\u56e0\u6b64\u6d4f\u89c8\u5668\u4f1a\u628a\u5185\u5bb9\u5f53\u6210 JavaScript \u53bb\u6267\u884c\uff0c\u81ea\u7136\u5c31\u5931\u8d25\u4e86\u3002</p>\n<p>\u8fd9\u65f6\u5019\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u6709\u4ee5\u4e0b\u51e0\u79cd\u89e3\u51b3\u529e\u6cd5\uff1a</p>\n<ol>\n<li>\u4fee\u6539 mkdocs-material \u4ee3\u7801\uff0c\u8ba9\u5b83\u628a type \u5b57\u6bb5\u4e5f\u7ee7\u627f\u4e0b\u6765</li>\n<li>\u8ba9 wavedrom \u7528\u5176\u4ed6 tag\uff0c\u56e0\u4e3a wavedrom \u53ea\u4f1a\u68c0\u67e5 type \u662f\u5426\u7b49\u4e8e wavedrom\uff0c\u4e0d\u4f1a\u68c0\u67e5\u662f\u4ec0\u4e48 tag</li>\n<li>\u63d0\u524d\u6e32\u67d3 wavedrom \u5230 svg\uff0c\u76f4\u63a5\u5185\u5d4c svg</li>\n</ol>\n<p>\u6700\u540e\u5728\u81ea\u5df1 fork \u7684 <a href=\"https://github.com/jiegec/mkdocs-wavedrom-plugin\">mkdocs-wavedrom-plugin</a> \u4e2d\u7528\u4e86\u7b2c\u4e09\u79cd\u65b9\u6cd5\u3002\u5982\u679c\u8bfb\u8005\u6709\u5174\u8da3\uff0c\u53ef\u4ee5\u7ed9 mkdocs-material \u63d0\u4ea4 pr\u3002</p>\n<p>\u6b64\u5916\uff0c\u524d\u4e24\u79cd\u65b9\u6cd5\u8fd8\u9700\u8981\u4fee\u6539 WaveDrom.ProcessAll \u7684\u8c03\u7528\u65b9\u6cd5\uff1a\u6a21\u4eff mkdocs-material \u7684 MathJax \u6e32\u67d3\u65b9\u6cd5\uff0c\u53bb\u8c03\u7528 <code>document$.subscribe</code>\uff1a</p>\n<div class=\"language-javascript highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"nb\">document</span><span class=\"nx\">$</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(()</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">  </span><span class=\"nx\">WaveDrom</span><span class=\"p\">.</span><span class=\"nx\">ProcessAll</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"p\">})</span>\n</span></code></pre></div>\n<p>\u8fd9\u6837 Instant Navigation \u5728\u201c\u91cd\u65b0\u52a0\u8f7d\u201d\u9875\u9762\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u91cd\u65b0\u8c03\u7528 <code>WaveDrom.ProcessAll</code>\u3002</p>\n<h2 id=\"math\">Math<a class=\"headerlink\" href=\"#math\" title=\"Permanent link\">&para;</a></h2>\n<p>\u548c WaveDrom \u7c7b\u4f3c\uff0cArithmatex \u6269\u5c55\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e5f\u4f1a\u7ed9\u6570\u5b66\u516c\u5f0f\u751f\u6210 <code>&lt;script&gt;</code> tag\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u662f <a href=\"https://github.com/facelessuser/pymdown-extensions/blob/main/docs/src/markdown/extensions/arithmatex.md#mathjax-output-format\">MathJax \u7684\u65e7\u683c\u5f0f</a>\uff1a</p>\n<div class=\"language-html highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"p\">&lt;</span><span class=\"nt\">script</span> <span class=\"na\">type</span><span class=\"o\">=</span><span class=\"s\">&quot;math/tex&quot;</span><span class=\"p\">&gt;</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">  </span><span class=\"mf\">1234</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"p\">&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span>\n</span></code></pre></div>\n<p>\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\u5728\u6bd4\u8f83\u65b0\u7684 mkdocs-material \u6587\u6863\u91cc\u5df2\u7ecf<a href=\"https://squidfunk.github.io/mkdocs-material/setup/extensions/python-markdown-extensions/#arithmatex\">\u7ed9\u51fa</a>\uff1a</p>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"c1\"># in mkdocs.yaml</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"nt\">markdown_extensions</span><span class=\"p\">:</span>\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">pymdownx.arithmatex</span><span class=\"p\">:</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"w\">      </span><span class=\"nt\">generic</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"nt\">extra_javascript</span><span class=\"p\">:</span>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">javascripts/mathjax.js</span>\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">https://polyfill.io/v3/polyfill.min.js?features=es6</span>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js</span>\n</span></code></pre></div>\n<div class=\"language-javascript highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\">// in docs/javascripts/mathjax.js</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">MathJax</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">  </span><span class=\"nx\">tex</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"nx\">inlineMath</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"p\">[[</span><span class=\"s2\">&quot;\\\\(&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;\\\\)&quot;</span><span class=\"p\">]],</span>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"nx\">displayMath</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"p\">[[</span><span class=\"s2\">&quot;\\\\[&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;\\\\]&quot;</span><span class=\"p\">]],</span>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">    </span><span class=\"nx\">processEscapes</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"nx\">processEnvironments</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">  </span><span class=\"p\">},</span>\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">  </span><span class=\"nx\">options</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-10\"><a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">    </span><span class=\"nx\">ignoreHtmlClass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;.*|&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-6-11\"><a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">    </span><span class=\"nx\">processHtmlClass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;arithmatex&quot;</span>\n</span><span id=\"__span-6-12\"><a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n</span><span id=\"__span-6-13\"><a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"p\">};</span>\n</span><span id=\"__span-6-14\"><a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a>\n</span><span id=\"__span-6-15\"><a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"nb\">document</span><span class=\"nx\">$</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(()</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-16\"><a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">  </span><span class=\"nx\">MathJax</span><span class=\"p\">.</span><span class=\"nx\">typesetPromise</span><span class=\"p\">()</span>\n</span><span id=\"__span-6-17\"><a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"p\">})</span>\n</span></code></pre></div>\n<p>\u6ce8\u610f\u5230\u719f\u6089\u7684 <code>document$</code>\uff0c\u8fd9\u4e5f\u662f\u5b83\u53ef\u4ee5\u5728 Instant Navigation \u4e0b\u6b63\u5e38\u5de5\u4f5c\u7684\u539f\u56e0\u3002</p>\n<h2 id=\"\u5c0f\u7ed3\">\u5c0f\u7ed3<a class=\"headerlink\" href=\"#\u5c0f\u7ed3\" title=\"Permanent link\">&para;</a></h2>\n<p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u8ba9 mkdocs-material \u7684 Instant Navigation \u529f\u80fd\u5de5\u4f5c\uff0c\u4f60\u9700\u8981\u4fdd\u8bc1\uff1a</p>\n<ol>\n<li>\u8bbe\u7f6e site_url\uff0c\u4fdd\u8bc1 sitemap \u6b63\u5e38\u751f\u6210</li>\n<li>\u4fdd\u8bc1\u4ee3\u7801\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u975e javascript \u7684 <code>&lt;script&gt;</code> tag\uff0c\u5982 wavedrom \u548c math/tex</li>\n<li>\u5982\u679c\u6d89\u53ca\u5230\u9700\u8981\u7528 javascript \u52a8\u6001\u6e32\u67d3\u7684\u5185\u5bb9\uff0c\u9700\u8981\u5728 <code>document$</code> \u4e0a\u6ce8\u518c\u56de\u8c03\u4ee5\u91cd\u65b0\u6e32\u67d3\u65b0\u9875\u9762</li>\n</ol>", "image": null, "date_modified": "2023-11-26T00:00:00+00:00", "authors": [], "tags": ["instant", "markdown", "mkdocs", "mkdocsmaterial", "software", "spa"]}, {"id": "https://jia.je/software/2023/11/23/apple-silicon-linux-rosetta/", "url": "https://jia.je/software/2023/11/23/apple-silicon-linux-rosetta/", "title": "\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta", "content_html": "<h1 id=\"\u5728-apple-silicon-macos-\u4e0a\u8dd1-linux-\u865a\u62df\u673a--rosetta\">\u5728 Apple Silicon macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta<a class=\"headerlink\" href=\"#\u5728-apple-silicon-macos-\u4e0a\u8dd1-linux-\u865a\u62df\u673a--rosetta\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u8fd1\u9700\u8981\u8dd1\u67d0\u4e2a x86 only \u4e14\u9700\u8981 GUI \u7684\u7a0b\u5e8f\uff0c\u4ee5\u5f80\u90fd\u662f\u8dd1\u5728\u8fdc\u7a0b Linux/Windows \u673a\u5668\u4e0a\u518d\u8fdc\u7a0b\u684c\u9762\u53bb\u4f7f\u7528\u3002\u6700\u8fd1\u770b\u5230\u4e86\u4e00\u4e9b\u6bd4\u8f83\u6210\u719f\u7684\u5728 macOS \u4e0a\u8dd1 Linux \u865a\u62df\u673a + Rosetta \u7684\u529e\u6cd5\uff08<a href=\"https://qiita.com/jin0g/items/692fde40cd895b81f39e\">M1 Mac \u3067 Vivado \u304c\u52d5\u3044\u305f\uff01</a>\uff09\uff0c\u56e0\u6b64\u8bb0\u5f55\u4e0b\u6765\u3002</p>\n<!-- more -->\n\n<p>\u672c\u6587\u53c2\u8003\u4e86\u5f88\u591a <a href=\"https://qiita.com/jin0g/items/692fde40cd895b81f39e\">M1 Mac \u3067 Vivado \u304c\u52d5\u3044\u305f\uff01</a> \u7684\u5185\u5bb9\u3002</p>\n<h2 id=\"\u5b89\u88c5-lima-\u548c-xquartz\">\u5b89\u88c5 lima \u548c xquartz<a class=\"headerlink\" href=\"#\u5b89\u88c5-lima-\u548c-xquartz\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7528 homebrew \u5b89\u88c5\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>brew<span class=\"w\"> </span>install<span class=\"w\"> </span>lima\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>brew<span class=\"w\"> </span>install<span class=\"w\"> </span>xquartz\n</span></code></pre></div>\n<p>lima \u662f\u7528\u6765\u7ba1\u7406\u865a\u62df\u673a\u7684\u5de5\u5177\uff0cXQuartz \u662f\u4e3a\u4e86\u8ba9\u865a\u62df\u673a\u91cc\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5728 macOS \u4e0a\u901a\u8fc7 X11 \u663e\u793a GUI\u3002</p>\n<p>\u56e0\u4e3a\u9700\u8981\u8dd1 x86\uff0c\u8fd8\u9700\u8981 rosetta\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>softwareupdate<span class=\"w\"> </span>--install-rosetta\n</span></code></pre></div>\n<h2 id=\"\u521b\u5efa-linux-\u865a\u62df\u673a\">\u521b\u5efa Linux \u865a\u62df\u673a<a class=\"headerlink\" href=\"#\u521b\u5efa-linux-\u865a\u62df\u673a\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7528 lima \u521b\u5efa Linux \u865a\u62df\u673a\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>limactl<span class=\"w\"> </span>start<span class=\"w\"> </span>template://debian<span class=\"w\"> </span>--rosetta<span class=\"w\"> </span>--vm-type<span class=\"o\">=</span>vz\n</span></code></pre></div>\n<p>\u521b\u5efa\u7684\u65f6\u5019\uff0c\u9009\u62e9\u7f16\u8f91\u914d\u7f6e\uff0c\u8ba9 ssh \u8f6c\u53d1 X11\uff1a</p>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"nt\">ssh</span><span class=\"p\">:</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">  </span><span class=\"nt\">forwardX11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">  </span><span class=\"nt\">forwardX11Trusted</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span></code></pre></div>\n<p>\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u8fd0\u884c <code>limactl shell debian</code>\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u5230 Linux shell \u4e86\u3002</p>\n<p>\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u989d\u5916\u7684 mount\uff0c\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\uff0c\u6216\u8005\u5728 <code>limactl start</code> \u547d\u4ee4\u884c\u53c2\u6570\u4e0a\u6dfb\u52a0 <code>--mount</code>\uff0c\u4f8b\u5982\uff1a<code>limactl start template://debian --rosetta --vm-type=vz --mount /Volumes/Data:w</code>\u3002</p>\n<h2 id=\"\u8fd0\u884c-x11-\u7a0b\u5e8f\">\u8fd0\u884c X11 \u7a0b\u5e8f<a class=\"headerlink\" href=\"#\u8fd0\u884c-x11-\u7a0b\u5e8f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u542f\u52a8 XQuartz\uff0c\u5728 XQuartz \u7684 Terminal \u91cc\u542f\u52a8\u5e76\u8fde\u63a5 lima\uff0c\u5b89\u88c5 x11-app \u5e76\u663e\u793a\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>limactl<span class=\"w\"> </span>shell<span class=\"w\"> </span>debian\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"c1\"># In Linux</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>xauth\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"c1\"># Back to macOS</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"nv\">$DISPLAY</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a>limactl<span class=\"w\"> </span>shell<span class=\"w\"> </span>debian\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"c1\"># In Linux</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>x11-apps\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"nv\">$DISPLAY</span>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a>xeyes\n</span></code></pre></div>\n<p>\u5c31\u53ef\u4ee5\u5728 macOS \u4e0a\u770b\u5230 xeyes \u7684\u8f93\u51fa\u4e86\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u8fd0\u884c\u5728 Linux \u865a\u62df\u673a\u91cc\u9762\uff0c\u901a\u8fc7 ssh \u8f6c\u53d1\u51fa\u6765\u3002\u5982\u679c\u6ca1\u6709\u5b89\u88c5 xauth\uff0c\u4f1a\u51fa\u73b0 X11 \u8f6c\u53d1\u5931\u8d25\uff08\u89c1 <a href=\"https://stackoverflow.com/a/42735336/2148614\">X11 forwarding request failed on channel 0</a>\uff09\u3002</p>\n<p>Rosetta \u4e5f\u5df2\u7ecf\u6ce8\u518c\u5230 binfmt \u4e2d\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>/proc/sys/fs/binfmt_misc/rosetta\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>enabled\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>interpreter<span class=\"w\"> </span>/mnt/lima-rosetta/rosetta\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a>flags:<span class=\"w\"> </span>OCF\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a>offset<span class=\"w\"> </span><span class=\"m\">0</span>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>magic<span class=\"w\"> </span>7f454c4602010100000000000000000002003e00\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a>mask<span class=\"w\"> </span>fffffffffffefe00fffffffffffffffffeffffff\n</span></code></pre></div>\n<p>\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c x86_64 \u7684\u7a0b\u5e8f\u3002\u5f53\u7136\u4e86\uff0c\u5982\u679c x86 \u7684\u7a0b\u5e8f\u9700\u8981\u52a8\u6001\u5e93\uff0c\u8fd8\u9700\u8981\u5b83\u7684\u52a8\u6001\u5e93\u4f9d\u8d56\u3002\u6bd4\u8f83\u7b80\u5355\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u7528 docker/podman\u3002lima \u9ed8\u8ba4\u5b89\u88c5\u4e86 containerd\uff0c\u53ef\u4ee5\u7528 nerdctl \u6765\u8fd0\u884c\u5bb9\u5668\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\"># AMD64 container</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>nerdctl<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--platform<span class=\"w\"> </span>amd64<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"c1\"># ARM64 container</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>nerdctl<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span></code></pre></div>\n<p>\u4e0d\u559c\u6b22 containerd\uff0c\u4e5f\u53ef\u4ee5\u7528 podman\uff1a<code>sudo apt install podman</code>\uff0c</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\"># AMD64 rootful container</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>sudo<span class=\"w\"> </span>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--arch<span class=\"w\"> </span>amd64<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"c1\"># AMD64 rootless container</span>\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--arch<span class=\"w\"> </span>amd64<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5728 AMD64 container \u4e2d\u8fd0\u884c wine\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>limactl<span class=\"w\"> </span>shell<span class=\"w\"> </span>debian\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"c1\"># In Linux</span>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a>sudo<span class=\"w\"> </span>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>--arch<span class=\"w\"> </span>amd64<span class=\"w\"> </span>--network<span class=\"w\"> </span>host<span class=\"w\"> </span>-e<span class=\"w\"> </span><span class=\"nv\">DISPLAY</span><span class=\"o\">=</span><span class=\"nv\">$DISPLAY</span><span class=\"w\"> </span>-e<span class=\"w\"> </span><span class=\"nv\">HOME</span><span class=\"o\">=</span><span class=\"nv\">$HOME</span><span class=\"w\"> </span>-u<span class=\"w\"> </span><span class=\"k\">$(</span>id<span class=\"w\"> </span>-u<span class=\"k\">)</span>:<span class=\"k\">$(</span>id<span class=\"w\"> </span>-g<span class=\"k\">)</span><span class=\"w\"> </span>-v<span class=\"w\"> </span><span class=\"nv\">$HOME</span>:<span class=\"nv\">$HOME</span><span class=\"w\"> </span>-v<span class=\"w\"> </span>/Volumes/Data:/Volumes/Data<span class=\"w\"> </span>docker.io/tobix/wine:stable\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"c1\"># In container</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a>wine64<span class=\"w\"> </span>regedit\n</span></code></pre></div>", "image": null, "date_modified": "2023-11-23T00:00:00+00:00", "authors": [], "tags": ["apple", "arm64", "linux", "m1", "macOS", "software", "x86"]}, {"id": "https://jia.je/hardware/2023/10/31/apple-silicon/", "url": "https://jia.je/hardware/2023/10/31/apple-silicon/", "title": "Apple \u5904\u7406\u5668", "content_html": "<h1 id=\"apple-\u5904\u7406\u5668\">Apple \u5904\u7406\u5668<a class=\"headerlink\" href=\"#apple-\u5904\u7406\u5668\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"m-\u7cfb\u5217\">M \u7cfb\u5217<a class=\"headerlink\" href=\"#m-\u7cfb\u5217\" title=\"Permanent link\">&para;</a></h2>\n<table>\n<thead>\n<tr>\n<th>\u540d\u79f0</th>\n<th>CPU \u6838\u5fc3</th>\n<th>GPU \u6838\u5fc3</th>\n<th>\u795e\u7ecf\u7f51\u7edc\u5f15\u64ce</th>\n<th>\u5185\u5b58\u5e26\u5bbd</th>\n<th>\u5185\u5b58\u5927\u5c0f</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>M1</td>\n<td>4+4</td>\n<td>7/8</td>\n<td>16</td>\n<td></td>\n<td>8GB/16GB</td>\n</tr>\n<tr>\n<td>M1 Pro</td>\n<td>6+2/8+2</td>\n<td>14/16</td>\n<td>16</td>\n<td>200GB/s</td>\n<td>16GB/32GB</td>\n</tr>\n<tr>\n<td>M1 Max</td>\n<td>8+2</td>\n<td>24/32</td>\n<td>16</td>\n<td>400GB/s</td>\n<td>32GB/64GB</td>\n</tr>\n<tr>\n<td>M1 Ultra</td>\n<td>16+4</td>\n<td>48/64</td>\n<td>32</td>\n<td>800GB/s</td>\n<td>64GB/128GB</td>\n</tr>\n<tr>\n<td>M2</td>\n<td>4+4</td>\n<td>8/10</td>\n<td>16</td>\n<td>100GB/s</td>\n<td>8GB/16GB/24GB</td>\n</tr>\n<tr>\n<td>M2 Pro</td>\n<td>6+4/8+4</td>\n<td>16/19</td>\n<td>16</td>\n<td>200GB/s</td>\n<td>16GB/32GB</td>\n</tr>\n<tr>\n<td>M2 Max</td>\n<td>8+4</td>\n<td>30/38</td>\n<td>16</td>\n<td>400GB/s</td>\n<td>32GB/64GB/96GB</td>\n</tr>\n<tr>\n<td>M2 Ultra</td>\n<td>16+8</td>\n<td>60/76</td>\n<td>32</td>\n<td>800GB/s</td>\n<td>64GB/128GB/192GB</td>\n</tr>\n<tr>\n<td>M3</td>\n<td>4+4</td>\n<td>10</td>\n<td>16</td>\n<td>100GB/s</td>\n<td>8GB/16GB/24GB</td>\n</tr>\n<tr>\n<td>M3 Pro</td>\n<td>5+6/6+6</td>\n<td>14/18</td>\n<td>16</td>\n<td>150GB/s</td>\n<td>18GB/36GB</td>\n</tr>\n<tr>\n<td>M3 Max</td>\n<td>10+4/12+4</td>\n<td>30/40</td>\n<td>16</td>\n<td>300GB/s/400GB/s</td>\n<td>36GB/48GB/64GB/96GB/128GB</td>\n</tr>\n</tbody>\n</table>\n<p>\u6765\u6e90\uff1a</p>\n<ul>\n<li><a href=\"https://support.apple.com/kb/SP854?viewlocale=en_US&amp;locale=en_US\">MacBook Pro (14-inch, 2021) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP839?viewlocale=en_US&amp;locale=en_US\">iMac (24-inch, M1, 2021) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP869?viewlocale=en_US&amp;locale=en_US\">MacBook Air (M2, 2022) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP890?viewlocale=en_US&amp;locale=en_US\">MacBook Pro (16-inch, 2023) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP891?viewlocale=en_US&amp;locale=en_US\">Mac mini (2023) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP865?locale=en_US\">Mac Studio (2022) - Technical Specifications</a></li>\n<li><a href=\"https://support.apple.com/kb/SP894?locale=en_US\">Mac Studio (2023) - Technical Specifications</a></li>\n</ul>\n<p>/proc/cpuinfo:</p>\n<p>Apple M1 Firestorm:</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>CPU implementer : 0x61\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>CPU architecture: 8\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>CPU variant     : 0x1\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>CPU part        : 0x023\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>CPU revision    : 1\n</span></code></pre></div>\n<p>Apple M1 Icestorm:</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>CPU implementer : 0x61\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a>CPU architecture: 8\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>CPU variant     : 0x1\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a>CPU part        : 0x022\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a>CPU revision    : 1\n</span></code></pre></div>\n<p>See also: https://github.com/util-linux/util-linux/blob/198e920aa24743ef6ace4e07cf6237de527f9261/sys-utils/lscpu-arm.c#L200.</p>", "image": null, "date_modified": "2023-10-31T00:00:00+00:00", "authors": [], "tags": ["apple", "cpu", "hardware"]}, {"id": "https://jia.je/software/2023/10/17/clang-cuda-support/", "url": "https://jia.je/software/2023/10/17/clang-cuda-support/", "title": "Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f", "content_html": "<h1 id=\"clang-\u5982\u4f55\u652f\u6301-cuda-\u7a0b\u5e8f\">Clang \u5982\u4f55\u652f\u6301 CUDA \u7a0b\u5e8f<a class=\"headerlink\" href=\"#clang-\u5982\u4f55\u652f\u6301-cuda-\u7a0b\u5e8f\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u524d\u8a00\">\u524d\u8a00<a class=\"headerlink\" href=\"#\u524d\u8a00\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7f16\u8bd1 CUDA \u7a0b\u5e8f\u7684\u4e3b\u8981\u5de5\u5177\u662f NVIDIA \u63d0\u4f9b\u7684\u95ed\u6e90\u7f16\u8bd1\u5668 NVCC\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0cNVCC \u662f\u57fa\u4e8e LLVM \u5f00\u53d1\u7684\uff08\u6765\u6e90\uff1a<a href=\"https://developer.nvidia.com/cuda-llvm-compiler\">NVIDIA CUDA Compiler</a>\uff09\uff0cNVIDIA \u4e5f\u628a NVCC \u5176\u4e2d\u4e00\u90e8\u5206\u903b\u8f91\u8d21\u732e\u7ed9\u4e86 LLVM \u4e0a\u6e38\uff0c\u4f7f\u5f97 <a href=\"https://llvm.org/docs/CompileCudaWithLLVM.html\">Clang \u4e5f\u53ef\u4ee5\u5728 CUDA \u7684\u914d\u5408\u4e0b\u7f16\u8bd1 CUDA \u7a0b\u5e8f</a>\u3002\u8fd9\u7bc7\u535a\u5ba2\u5c1d\u8bd5\u7814\u7a76 Clang/LLVM \u5982\u4f55\u5b9e\u73b0 CUDA \u7a0b\u5e8f\u7684\u7f16\u8bd1\uff0c\u4e3b\u8981\u662f Clang \u524d\u7aef\u90e8\u5206\uff0c\u540e\u7aef\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u4ece LLVM IR \u5230 NVPTX \u7684\u8fd9\u4e00\u6b65\u8fd8\u6ca1\u6709\u8fdb\u884c\u6df1\u5165\u7684\u7814\u7a76\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u7f16\u8bd1\u547d\u4ee4\">\u7f16\u8bd1\u547d\u4ee4<a class=\"headerlink\" href=\"#\u7f16\u8bd1\u547d\u4ee4\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u6309\u7167 <a href=\"https://llvm.org/docs/CompileCudaWithLLVM.html\">Compiling CUDA with clang</a> \u6587\u6863\uff0c\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528 clang \u7f16\u8bd1 CUDA \u7a0b\u5e8f\u7684\u547d\u4ee4\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>clang++<span class=\"w\"> </span>axpy.cu<span class=\"w\"> </span>-o<span class=\"w\"> </span>axpy<span class=\"w\"> </span>-L&lt;CUDA<span class=\"w\"> </span>install<span class=\"w\"> </span>path&gt;/&lt;lib64<span class=\"w\"> </span>or<span class=\"w\"> </span>lib&gt;<span class=\"w\"> </span>-lcudart/cudart_static<span class=\"w\"> </span><span class=\"o\">[</span>--cuda-gpu-arch<span class=\"o\">=</span>&lt;GPU<span class=\"w\"> </span>arch&gt;<span class=\"o\">]</span>\n</span></code></pre></div>\n<p>\u5176\u4e2d <code>-L&lt;CUDA install path&gt;/&lt;lib64 or lib&gt; -lcudart/cudart_static</code> \u8868\u793a\u7684\u662f\u94fe\u63a5 CUDA \u63d0\u4f9b\u7684 libcudart\uff0c\u5b83\u6709\u9759\u6001\u5e93\u548c\u52a8\u6001\u5e93\u4e24\u79cd\u5f62\u5f0f\uff0c\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9\u3002<code>--cuda-gpu-arch=&lt;GPU arch&gt;</code> \u5c31\u548c NVCC \u4e00\u6837\uff0c\u6307\u5b9a GPU \u7684 SM Architecture \u7248\u672c\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a\u3002\u5982\u679c CUDA \u5b89\u88c5\u5230 <code>/usr/local/cuda</code>\uff0c\u4e00\u4e2a\u4f8b\u5b50\u5982\u4e0b\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>clang++<span class=\"w\"> </span>axpy.cu<span class=\"w\"> </span>-o<span class=\"w\"> </span>axpy<span class=\"w\"> </span>-L<span class=\"w\"> </span>/usr/local/cuda/lib64<span class=\"w\"> </span>-lcudart\n</span></code></pre></div>\n<p>\u7f16\u8bd1\u51fa\u6765\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u5c31\u548c NVCC \u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u9700\u8981\u624b\u52a8\u94fe\u63a5 libcudart\u3002</p>\n<h2 id=\"\u7f16\u8bd1\u6d41\u7a0b\">\u7f16\u8bd1\u6d41\u7a0b<a class=\"headerlink\" href=\"#\u7f16\u8bd1\u6d41\u7a0b\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4e3a\u4e86\u67e5\u770b clang \u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u547d\u4ee4\u4e2d\uff0c\u6dfb\u52a0 <code>-v</code> \u9009\u9879\u8ba9\u5b83\u6253\u5370\u51fa\u4e2d\u95f4\u6267\u884c\u7684\u547d\u4ee4\uff0c\u518d\u6dfb\u52a0 <code>--save-temps</code> \u547d\u4ee4\u53ef\u4ee5\u628a\u4e2d\u9014\u7684\u7f16\u8bd1\u4ea7\u7269\u4fdd\u7559\u5728\u5f53\u524d\u8def\u5f84\u4e0b\u3002\u89c2\u5bdf\u8f93\u51fa\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u8fdb\u884c\u4e86\u5982\u4e0b\u64cd\u4f5c\uff08\u7701\u7565\u4e86\u5927\u91cf\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff09\uff1a</p>\n<ol>\n<li><code>clang -triple nvptx64-nvidia-cuda -S -target-cpu sm_70 axpy.cu -o axpy-sm_70.s</code>\uff1a\u4ee5 NVPTX \u4e3a target\uff0c\u7f16\u8bd1\u6e90\u4ee3\u7801\uff0c\u751f\u6210 PTX \u6c47\u7f16</li>\n<li><code>ptxas --gpu-name sm_70 --output-file axpy-sm_70.o axpy-sm_70.s</code>\uff1a\u4f7f\u7528 CUDA \u63d0\u4f9b\u7684 <code>ptxas</code> \u7a0b\u5e8f\uff0c\u628a PTX \u6c47\u7f16\u7ffb\u8bd1\u6210 SM 70 \u7684 SASS \u6307\u4ee4\uff0c\u6253\u5305\u5230\u4e00\u4e2a ELF object \u4e2d</li>\n<li><code>fatbinary --create axpy.fatbin --image=profile=sm_70,file=axpy-sm_70.o --image=profile=compute_70,file=axpy-sm_70.s</code>: \u4f7f\u7528 CUDA \u63d0\u4f9b\u7684 <code>fatbinary</code> \u7a0b\u5e8f\uff0c\u628a ptxas \u751f\u6210\u7684 ELF object \u548c clang \u751f\u6210\u7684 PTX \u6c47\u7f16\u5185\u5bb9\u6253\u5305\u6210\u4e00\u4e2a fatbin \u6587\u4ef6</li>\n<li><code>clang -triple x86_64-pc-linux-gnu -emit-obj axpy.cu -fcuda-include-gpubinary axpy.fatbin -o axpy.o</code>\uff1a\u7f16\u8bd1 Host \u4ee3\u7801\uff0c\u628a fatbin \u7684\u5185\u5bb9\u5d4c\u5165\u5230\u4e00\u4e2a <code>.nv_fatbin</code> section \u4e2d\uff0c\u751f\u6210\u4e00\u4e2a ELF object \u4e2d</li>\n<li><code>ld -o axpy axpy.o -lcudart</code>\uff1a\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5e38\u89c4\u7684\u94fe\u63a5\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6</li>\n</ol>\n<p>\u5b9e\u9645\u4e0a\u8fd8\u6709\u4e00\u6b65\u9884\u5904\u7406\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\u3002\u5bf9\u6bd4\u901a\u5e38 C++ \u7a0b\u5e8f\u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u8fd9\u91cc\u4e0d\u540c\u7684\u70b9\u5728\u4e8e\uff1a</p>\n<ol>\n<li>\u7528 Clang \u4ee5 NVPTX target \u7f16\u8bd1\u4e86\u4e00\u904d\uff0c\u5f97\u5230 PTX \u6c47\u7f16</li>\n<li>\u7528 CUDA \u7684 ptxas\uff0c\u628a PTX \u6c47\u7f16\u7ffb\u8bd1\u6210\u5bf9\u5e94 SM Architecture \u7684 SASS \u6307\u4ee4\uff0c\u653e\u5230\u4e00\u4e2a ELF object \u91cc</li>\n<li>\u7528 CUDA \u7684 fatbinary\uff0c\u628a\u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u7684\u7ed3\u679c\u653e\u5230\u4e00\u4e2a fatbin \u6587\u4ef6\u91cc</li>\n<li>\u628a fatbin \u6587\u4ef6\u5d4c\u5165\u5230 ELF \u4e2d</li>\n</ol>\n<p>\u5176\u4e2d\u7b2c\u4e00\u6b65\u548c\u7b2c\u56db\u6b65\u662f\u7531 LLVM \u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u627e\u5230\u76f8\u5e94\u7684\u4ee3\u7801\uff1b\u7b2c\u4e8c\u6b65\u548c\u7b2c\u4e09\u6b65\u5219\u6ca1\u6709\u6e90\u7801\uff0c\u4f46\u662f\u7f51\u4e0a\u6709\u5f88\u591a\u516c\u5f00\u7684\u9006\u5411\uff0c\u4f8b\u5982 <a href=\"https://dl.acm.org/doi/abs/10.5555/3314872.3314900\">Decoding CUDA binary</a>\u3001<a href=\"https://github.com/decodecudabinary/Decoding-CUDA-Binary/tree/master/tools\">decodecudabinary/Decoding-CUDA-Binary</a> \u548c <a href=\"https://github.com/n-eiling/cuda-fatbin-decompression\">n-eiling/cuda-fatbin-decompression</a>\u3002</p>\n<p>\u6b64\u5916\uff0cClang \u8fd8\u9700\u8981\u9488\u5bf9 Host \u90e8\u5206\u4ee3\u7801\uff0c\u8fdb\u884c\u7279\u6b8a\u5904\u7406\uff0c\u56e0\u4e3a CUDA \u6709\u4e00\u4e9b\u6269\u5c55\u8bed\u6cd5\uff08\u4e3b\u8981\u662f\u542f\u52a8 Kernel \u7684 <code>&lt;&lt;&lt;&gt;&gt;&gt;</code>\uff09\uff0c\u9700\u8981\u628a\u8fd9\u4e9b\u90e8\u5206\u66ff\u6362\u4e3a\u5bf9 CUDA Runtime\uff08\u4e5f\u5c31\u662f libcudart\uff09\u7684\u8c03\u7528\u3002\u63a5\u4e0b\u6765\u8981\u8ba8\u8bba\u7684\u5c31\u662f\u8fd9\u4e00\u90e8\u5206\u3002</p>\n<h2 id=\"host-\u4ee3\u7801\">Host \u4ee3\u7801<a class=\"headerlink\" href=\"#host-\u4ee3\u7801\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u7814\u7a76\u7684\u662f CUDA \u7684\u6269\u5c55\u8bed\u6cd5\u91cc\u7684\u542f\u52a8 Kernel \u8bed\u6cd5\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">axpy</span><span class=\"o\">&lt;&lt;&lt;</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kDataLen</span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"p\">(</span><span class=\"n\">kDataLen</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">device_x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">device_y</span><span class=\"p\">);</span>\n</span></code></pre></div>\n<p>\u5b9e\u9645\u4e0a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5462\uff1f\u5982\u679c\u53bb\u67e5\u770b LLVM IR\uff0c\u4f1a\u53d1\u73b0\u5b83\u7684\u903b\u8f91\u7c7b\u4f3c\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">success</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">__cudaPushCallConfiguration</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kDataLen</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">success</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">    </span><span class=\"n\">__device_stub__axpy</span><span class=\"p\">(</span><span class=\"n\">kDataLen</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">device_x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">device_y</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u751f\u6210\u903b\u8f91\u5728 <a href=\"https://github.com/llvm/llvm-project/blob/52db7e27458f774fa0c6c6a864ce197fa071a230/clang/lib/CodeGen/CGCUDARuntime.cpp#L26\">EmitCUDAKernelCallExpr</a> \u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u6784\u9020\u4e86\u4e24\u4e2a\u57fa\u672c\u5757\uff0c\u5bf9\u5e94 success \u5185\u7684 device stub \u8c03\u7528\uff08ConfigOKBlock\uff09\u548c\u5b8c\u6210\u8c03\u7528\u7684\u57fa\u672c\u5757\uff08ContBlock\uff09\u3002</p>\n<p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u9996\u5148\u628a <code>&lt;&lt;&lt;</code> \u548c <code>&gt;&gt;&gt;</code> \u4e4b\u95f4\u7684\u53c2\u6570\u4f20\u7ed9\u4e86 <code>__cudaPushCallConfiguration</code>\uff08\u5b9e\u9645\u4e0a\u662f\u6784\u9020\u4e86\u4e00\u4e2a <code>dim3</code> \u518d\u4f20\u8fdb\u53bb\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\uff09\uff0c\u5982\u679c\u5b83\u6210\u529f\u4e86\uff0c\u518d\u53bb\u8c03\u7528\u4e00\u4e2a <code>__device_stub__axpy</code>\u3002\u53ef\u4ee5\u731c\u60f3\uff0c\u5b83\u4f1a\u5bf9\u53c2\u6570\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u4e0d\u7b26\u5408 CUDA \u7684\u8981\u6c42\uff0c\u90a3\u5c31\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u4e0d\u53bb\u542f\u52a8 Kernel\u3002\u5982\u679c\u914d\u7f6e\u6ca1\u95ee\u9898\uff0c\u5c31\u53bb\u8c03\u7528 <code>__device_stub__axpy</code>\u3002\u90a3\u4e48\u8fd9\u4e2a\u51fd\u6570\u662f\u4ec0\u4e48\u5462\uff1f\u5b83\u662f\u5728 <a href=\"https://github.com/llvm/llvm-project/blob/ab6d5fa3d0643e68d6ec40d9190f20fb14190ed1/clang/lib/CodeGen/CGCUDANV.cpp#L324\">Clang \u4ee3\u7801</a> \u91cc\u751f\u6210\u7684\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"c1\">// CUDA 9.0+ uses new way to launch kernels. Parameters are packed in a local</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"c1\">// array and kernels are launched using cudaLaunchKernel().</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">CGNVCUDARuntime::emitDeviceStubBodyNew</span><span class=\"p\">(</span><span class=\"n\">CodeGenFunction</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">CGF</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">                                            </span><span class=\"n\">FunctionArgList</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">Args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">  </span><span class=\"c1\">// omitted</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">  </span><span class=\"c1\">// Calculate amount of space we will need for all arguments.  If we have no</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">  </span><span class=\"c1\">// args, allocate a single pointer so we still have a valid pointer to the</span>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">  </span><span class=\"c1\">// argument array that we can pass to runtime, even if it will be unused.</span>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">  </span><span class=\"c1\">// Store pointers to the arguments in a locally allocated launch_args.</span>\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">  </span><span class=\"c1\">// omitted</span>\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a>\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">  </span><span class=\"c1\">// Lookup cudaLaunchKernel/hipLaunchKernel function.</span>\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">  </span><span class=\"c1\">// cudaError_t cudaLaunchKernel(const void *func, dim3 gridDim, dim3 blockDim,</span>\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">  </span><span class=\"c1\">//                              void **args, size_t sharedMem,</span>\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">  </span><span class=\"c1\">//                              cudaStream_t stream);</span>\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">  </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">LaunchKernelName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">addPrefixToName</span><span class=\"p\">(</span><span class=\"n\">KernelLaunchAPI</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">  </span><span class=\"n\">IdentifierInfo</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">cudaLaunchKernelII</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">      </span><span class=\"n\">CGM</span><span class=\"p\">.</span><span class=\"n\">getContext</span><span class=\"p\">().</span><span class=\"n\">Idents</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">LaunchKernelName</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">  </span><span class=\"n\">FunctionDecl</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">cudaLaunchKernelFD</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a>\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">  </span><span class=\"c1\">// Create temporary dim3 grid_dim, block_dim.</span>\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">  </span><span class=\"n\">llvm</span><span class=\"o\">::</span><span class=\"n\">FunctionCallee</span><span class=\"w\"> </span><span class=\"n\">cudaPopConfigFn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">CGM</span><span class=\"p\">.</span><span class=\"n\">CreateRuntimeFunction</span><span class=\"p\">(</span>\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">      </span><span class=\"n\">llvm</span><span class=\"o\">::</span><span class=\"n\">FunctionType</span><span class=\"o\">::</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">IntTy</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">                              </span><span class=\"p\">{</span><span class=\"cm\">/*gridDim=*/</span><span class=\"n\">GridDim</span><span class=\"p\">.</span><span class=\"n\">getType</span><span class=\"p\">(),</span>\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">                               </span><span class=\"cm\">/*blockDim=*/</span><span class=\"n\">BlockDim</span><span class=\"p\">.</span><span class=\"n\">getType</span><span class=\"p\">(),</span>\n</span><span id=\"__span-4-27\"><a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">                               </span><span class=\"cm\">/*ShmemSize=*/</span><span class=\"n\">ShmemSize</span><span class=\"p\">.</span><span class=\"n\">getType</span><span class=\"p\">(),</span>\n</span><span id=\"__span-4-28\"><a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">                               </span><span class=\"cm\">/*Stream=*/</span><span class=\"n\">Stream</span><span class=\"p\">.</span><span class=\"n\">getType</span><span class=\"p\">()},</span>\n</span><span id=\"__span-4-29\"><a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a><span class=\"w\">                              </span><span class=\"cm\">/*isVarArg=*/</span><span class=\"nb\">false</span><span class=\"p\">),</span>\n</span><span id=\"__span-4-30\"><a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">      </span><span class=\"n\">addUnderscoredPrefixToName</span><span class=\"p\">(</span><span class=\"s\">&quot;PopCallConfiguration&quot;</span><span class=\"p\">));</span>\n</span><span id=\"__span-4-31\"><a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a>\n</span><span id=\"__span-4-32\"><a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a><span class=\"w\">  </span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">EmitRuntimeCallOrInvoke</span><span class=\"p\">(</span><span class=\"n\">cudaPopConfigFn</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-33\"><a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">                              </span><span class=\"p\">{</span><span class=\"n\">GridDim</span><span class=\"p\">.</span><span class=\"n\">getPointer</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">BlockDim</span><span class=\"p\">.</span><span class=\"n\">getPointer</span><span class=\"p\">(),</span>\n</span><span id=\"__span-4-34\"><a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">                               </span><span class=\"n\">ShmemSize</span><span class=\"p\">.</span><span class=\"n\">getPointer</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">Stream</span><span class=\"p\">.</span><span class=\"n\">getPointer</span><span class=\"p\">()});</span>\n</span><span id=\"__span-4-35\"><a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a>\n</span><span id=\"__span-4-36\"><a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a><span class=\"w\">  </span><span class=\"c1\">// Emit the call to cudaLaunch</span>\n</span><span id=\"__span-4-37\"><a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">  </span><span class=\"n\">llvm</span><span class=\"o\">::</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">Kernel</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">Builder</span><span class=\"p\">.</span><span class=\"n\">CreatePointerCast</span><span class=\"p\">(</span>\n</span><span id=\"__span-4-38\"><a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">      </span><span class=\"n\">KernelHandles</span><span class=\"p\">[</span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">CurFn</span><span class=\"o\">-&gt;</span><span class=\"n\">getName</span><span class=\"p\">()],</span><span class=\"w\"> </span><span class=\"n\">VoidPtrTy</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-39\"><a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">  </span><span class=\"n\">CallArgList</span><span class=\"w\"> </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-40\"><a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">Kernel</span><span class=\"p\">),</span>\n</span><span id=\"__span-4-41\"><a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">                       </span><span class=\"n\">cudaLaunchKernelFD</span><span class=\"o\">-&gt;</span><span class=\"n\">getParamDecl</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">getType</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-42\"><a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">getAggregate</span><span class=\"p\">(</span><span class=\"n\">GridDim</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">Dim3Ty</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-43\"><a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">getAggregate</span><span class=\"p\">(</span><span class=\"n\">BlockDim</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">Dim3Ty</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-44\"><a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">KernelArgs</span><span class=\"p\">.</span><span class=\"n\">getPointer</span><span class=\"p\">()),</span>\n</span><span id=\"__span-4-45\"><a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a><span class=\"w\">                       </span><span class=\"n\">cudaLaunchKernelFD</span><span class=\"o\">-&gt;</span><span class=\"n\">getParamDecl</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">getType</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-46\"><a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">Builder</span><span class=\"p\">.</span><span class=\"n\">CreateLoad</span><span class=\"p\">(</span><span class=\"n\">ShmemSize</span><span class=\"p\">)),</span>\n</span><span id=\"__span-4-47\"><a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">                       </span><span class=\"n\">cudaLaunchKernelFD</span><span class=\"o\">-&gt;</span><span class=\"n\">getParamDecl</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">getType</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-48\"><a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"w\">  </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">RValue</span><span class=\"o\">::</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">Builder</span><span class=\"p\">.</span><span class=\"n\">CreateLoad</span><span class=\"p\">(</span><span class=\"n\">Stream</span><span class=\"p\">)),</span>\n</span><span id=\"__span-4-49\"><a id=\"__codelineno-4-49\" name=\"__codelineno-4-49\" href=\"#__codelineno-4-49\"></a><span class=\"w\">                       </span><span class=\"n\">cudaLaunchKernelFD</span><span class=\"o\">-&gt;</span><span class=\"n\">getParamDecl</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">getType</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-50\"><a id=\"__codelineno-4-50\" name=\"__codelineno-4-50\" href=\"#__codelineno-4-50\"></a><span class=\"w\">  </span><span class=\"n\">llvm</span><span class=\"o\">::</span><span class=\"n\">FunctionCallee</span><span class=\"w\"> </span><span class=\"n\">cudaLaunchKernelFn</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</span><span id=\"__span-4-51\"><a id=\"__codelineno-4-51\" name=\"__codelineno-4-51\" href=\"#__codelineno-4-51\"></a><span class=\"w\">      </span><span class=\"n\">CGM</span><span class=\"p\">.</span><span class=\"n\">CreateRuntimeFunction</span><span class=\"p\">(</span><span class=\"n\">FTy</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">LaunchKernelName</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-52\"><a id=\"__codelineno-4-52\" name=\"__codelineno-4-52\" href=\"#__codelineno-4-52\"></a><span class=\"w\">  </span><span class=\"n\">CGF</span><span class=\"p\">.</span><span class=\"n\">EmitCall</span><span class=\"p\">(</span><span class=\"n\">FI</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CGCallee</span><span class=\"o\">::</span><span class=\"n\">forDirect</span><span class=\"p\">(</span><span class=\"n\">cudaLaunchKernelFn</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ReturnValueSlot</span><span class=\"p\">(),</span>\n</span><span id=\"__span-4-53\"><a id=\"__codelineno-4-53\" name=\"__codelineno-4-53\" href=\"#__codelineno-4-53\"></a><span class=\"w\">               </span><span class=\"n\">LaunchKernelArgs</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-54\"><a id=\"__codelineno-4-54\" name=\"__codelineno-4-54\" href=\"#__codelineno-4-54\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u4ee3\u7801\u6bd4\u8f83\u957f\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u5220\u51cf\uff0c\u5927\u6982\u7684\u903b\u8f91\u662f\uff1a\u628a device stub \u7684\u51fd\u6570\u53c2\u6570\u653e\u5230\u4e00\u4e2a\u6570\u7ec4\u91cc\uff0c\u7136\u540e\u901a\u8fc7\u8c03\u7528 <code>__cudaPopCallConfiguration</code> \u628a\u521a\u521a\u5728 <code>__cudaPushCallConfiguration</code> \u4f20\u5165\u7684\u542f\u52a8\u914d\u7f6e\u518d\u8bfb\u53d6\u51fa\u6765\uff0c\u518d\u8c03\u7528\u771f\u6b63\u542f\u52a8 CUDA Kernel \u7684\u51fd\u6570 <a href=\"https://docs.nvidia.com/cuda/cuda-runtime-api/group__CUDART__EXECUTION.html#group__CUDART__EXECUTION_1g5064cdf5d8e6741ace56fd8be951783c\"><code>cudaLaunchKernel</code></a>\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">__host__</span><span class=\"err\">\u200b</span><span class=\"n\">cudaError_t</span><span class=\"w\"> </span><span class=\"n\">cudaLaunchKernel</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dim3</span><span class=\"w\"> </span><span class=\"n\">gridDim</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dim3</span><span class=\"w\"> </span><span class=\"n\">blockDim</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"o\">**</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">size_t</span><span class=\"w\"> </span><span class=\"n\">sharedMem</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cudaStream_t</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"w\"> </span><span class=\"p\">)</span>\n</span></code></pre></div>\n<p>\u5176\u4e2d <code>const void* func</code> \u6307\u5411\u4e86 device stub function \u672c\u8eab\uff0c<code>args</code> \u662f device stub \u628a\u81ea\u5df1\u7684\u53c2\u6570\u4fdd\u5b58\u4e0b\u6765\u653e\u5230\u6570\u7ec4\u4e2d\u7684\uff0c\u5176\u4f59\u7684\u53c2\u6570\u662f\u7ecf\u8fc7 <code>__cudaPushCallConfiguration</code> \u4fdd\u5b58\u53c8\u7528 <code>__cudaPopCallConfiguration</code> \u53d6\u51fa\u7684\u542f\u52a8\u914d\u7f6e\u3002</p>\n<p>\u8fd9\u65f6\u5019\u4f60\u53ef\u80fd\u89c9\u5f97\u5f88\u5947\u602a\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f20 function \u672c\u8eab\u7684\u6307\u9488\uff0c\u6309\u7406\u8bf4\u8981\u542f\u52a8 GPU \u4e0a\u7684 CUDA Kernel\uff0c\u4e0d\u5e94\u8be5\u7ed9\u4e00\u4e2a CUDA Kernel \u7684\u6307\u9488\u5417\uff1fCUDA Runtime \u600e\u4e48\u80fd\u901a\u8fc7 device stub function \u7684\u6307\u9488\uff0c\u5224\u65ad\u5bf9\u5e94\u7684 CUDA Kernel \u662f\u54ea\u4e2a\u5462\uff1f\u4e0b\u9762\u6765\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002</p>\n<h2 id=\"cuda-runtime-\u6ce8\u518c\">CUDA Runtime \u6ce8\u518c<a class=\"headerlink\" href=\"#cuda-runtime-\u6ce8\u518c\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9664\u4e86\u542f\u52a8 Kernel \u4ee5\u5916\uff0cClang \u8fd8\u751f\u6210\u4e86\u5f88\u591a\u4ee3\u7801\uff0c\u7528\u6765\u5411 CUDA Runtime \u6ce8\u518c\u4e00\u4e9b\u4fe1\u606f\u3002\u56de\u5fc6\u524d\u9762\u7684\u6d41\u7a0b\uff0cKernel \u7f16\u8bd1\u6210 PTX \u6c47\u7f16\u4ee5\u540e\uff0c\u5148\u662f\u7f16\u8bd1\u6210 SASS \u6307\u4ee4\u6253\u5305\u5728\u4e86 ELF \u91cc\uff0c\u540e\u6765 PTX \u548c ELF \u4e00\u8d77\u6253\u5305\u6210\u4e86\u4e00\u4e2a fatbin \u6587\u4ef6\uff0c\u6700\u540e\u5d4c\u5165\u5230\u53ef\u6267\u884c\u7a0b\u5e8f\u91cc\u9762\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u8fd8\u6ca1\u6709\u7528\u5230\u5b83\uff0c\u800c\u5982\u679c\u8981\u542f\u52a8 Kernel\uff0c\u80af\u5b9a\u9700\u8981\u8ba9 CUDA Runtime \u53bb\u89e3\u6790 fatbin\uff0c\u627e\u5230\u91cc\u9762\u7684 Kernel \u6307\u4ee4\uff0c\u653e\u5230 GPU \u4e0a\u53bb\u6267\u884c\u3002\u53e6\u5916\uff0c\u6839\u636e\u4e0a\u4e00\u8282\u5185\u5bb9\uff0cCUDA Runtime \u8fd8\u9700\u8981\u77e5\u9053 device stub function \u548c Kernel \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u624d\u80fd\u77e5\u9053 Launch \u54ea\u4efd Kernel \u6307\u4ee4\u3002</p>\n<p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u662f\u7531 <a href=\"https://github.com/llvm/llvm-project/blob/ab6d5fa3d0643e68d6ec40d9190f20fb14190ed1/clang/lib/CodeGen/CGCUDANV.cpp#L695\">Clang \u751f\u6210\u7684\u521d\u59cb\u5316\u4ee3\u7801</a>\u5b8c\u6210\u7684\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\">/// Creates a global constructor function for the module:</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"c1\">///</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"c1\">/// For CUDA:</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"c1\">/// \\code</span>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"c1\">/// void __cuda_module_ctor() {</span>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"c1\">///     Handle = __cudaRegisterFatBinary(GpuBinaryBlob);</span>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"c1\">///     __cuda_register_globals(Handle);</span>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"c1\">/// }</span>\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"c1\">/// \\endcode</span>\n</span></code></pre></div>\n<p>Clang \u4f1a\u8d1f\u8d23\u751f\u6210\u4e00\u4e2a <code>__cuda_module_ctor</code> \u51fd\u6570\uff0c\u653e\u5230\u53ef\u6267\u884c\u7a0b\u5e8f\u91cc\u9762\uff0c\u5e76\u4e14\u628a\u5730\u5740\u6dfb\u52a0\u5230 <code>.init_array</code> \u4e2d\uff0c\u8fd9\u4e2a section \u91cc\u9762\u7684\u51fd\u6570\u5730\u5740\u4f1a\u88ab libc \u5728\u52a0\u8f7d\u7684\u65f6\u5019\u8c03\u7528\uff0c\u8fd9\u4e5f\u662f C++ \u91cc\u5168\u5c40\u7c7b\u53d8\u91cf\u81ea\u52a8\u8c03\u7528\u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\uff0c\u9996\u5148\u8c03\u7528 cudart \u7684 <code>__cudaRegisterFatBinary</code> \u51fd\u6570\uff0c\u628a fatbin \u5730\u5740\u4f20\u9012\u8fc7\u53bb\uff08\u6ce8\uff1a\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a<a href=\"https://github.com/shinpei0208/gdev/blob/e328438f3cca32bd84ce64807e322673d4b66c40/cuda/runtime/ocelot/cuda/interface/cudaFatBinary.h#L138\">\u7ed3\u6784\u4f53</a>\uff09\uff0c\u8fd9\u6837 cudart \u5c31\u77e5\u9053\u4e86\u8fd9\u4e2a\u7a0b\u5e8f\u91cc\u6253\u5305\u7684 fatbin\uff0c\u4e5f\u5c31\u62ff\u5230\u4e86\u6240\u6709\u7684 PTX \u4ee3\u7801\u548c SASS \u6307\u4ee4\u3002\u63a5\u7740\u8fd8\u8c03\u7528\u4e86 <code>__cuda_register_globals</code>\uff0c\u8fd9\u4e5f\u662f <a href=\"https://github.com/llvm/llvm-project/blob/ab6d5fa3d0643e68d6ec40d9190f20fb14190ed1/clang/lib/CodeGen/CGCUDANV.cpp#L523\">Clang \u751f\u6210\u7684</a>\uff1a</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\">/// Creates a function that sets up state on the host side for CUDA objects that</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"c1\">/// have a presence on both the host and device sides. Specifically, registers</span>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"c1\">/// the host side of kernel functions and device global variables with the CUDA</span>\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"c1\">/// runtime.</span>\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"c1\">/// \\code</span>\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"c1\">/// void __cuda_register_globals(void** GpuBinaryHandle) {</span>\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"c1\">///    __cudaRegisterFunction(GpuBinaryHandle,Kernel0,...);</span>\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"c1\">///    ...</span>\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"c1\">///    __cudaRegisterFunction(GpuBinaryHandle,KernelM,...);</span>\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"c1\">///    __cudaRegisterVar(GpuBinaryHandle, GlobalVar0, ...);</span>\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"c1\">///    ...</span>\n</span><span id=\"__span-7-12\"><a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"c1\">///    __cudaRegisterVar(GpuBinaryHandle, GlobalVarN, ...);</span>\n</span><span id=\"__span-7-13\"><a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"c1\">/// }</span>\n</span><span id=\"__span-7-14\"><a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"c1\">/// \\endcode</span>\n</span></code></pre></div>\n<p>Clang \u4f1a\u626b\u63cf\u4ee3\u7801\u91cc\u7684 Kernel \u51fd\u6570\u548c\u9700\u8981\u548c GPU \u4e92\u64cd\u4f5c\u7684\u5168\u5c40\u53d8\u91cf\uff08\u7528\u4e8e <code>cudaMemcpyFromSymbol</code> \u7b49\u51fd\u6570\uff09\uff0c\u7136\u540e\u53bb\u8c03\u7528 cudart \u7684 <code>__cudaRegisterFunction</code> \u548c <code>__cudaRegisterVar</code> \u51fd\u6570\u3002\u4e5f\u5c31\u662f\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u5efa\u7acb\u4e86 device stub function \u5730\u5740\u548c Kernel \u7684\u6620\u5c04\u5173\u7cfb\uff1acudart \u7684 <code>cudaLaunchKernel</code> \u5b9e\u73b0\u91cc\u9762\uff0c\u53ef\u4ee5\u6839\u636e device stub function \u7684\u5730\u5740\uff0c\u53bb\u67e5\u8be2 Kernel \u7684\u7b26\u53f7\uff0c\u518d\u6839\u636e\u7b26\u53f7\u53bb\u627e\u5230\u5bf9\u5e94\u7684 PTX \u548c SASS \u6307\u4ee4\u3002</p>\n<h2 id=\"fatbin\">fatbin<a class=\"headerlink\" href=\"#fatbin\" title=\"Permanent link\">&para;</a></h2>\n<p>\u5728\u524d\u9762\u63d0\u5230\u4e86 fatbin \u7684\u8fc7\u7a0b\uff0c\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\uff0c\u4fdd\u5b58\u4e86 PTX \u4ee3\u7801\u6216\u8005\u4f7f\u7528 ptxas \u7f16\u8bd1\u540e\u5f97\u5230\u7684 ELF \u6587\u4ef6\u3002\u5b83\u7684\u683c\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u53ef\u4ee5\u5728 <a href=\"https://github.com/n-eiling/cuda-fatbin-decompression\">n-eiling/cuda-fatbin-decompression</a> \u548c <a href=\"https://github.com/jiegec/fatbinary\">fatbinary</a> \u4e2d\u770b\u5230\u3002\u5b83\u7684\u7ed3\u6784\u5927\u4f53\u5982\u4e0b\uff1a</p>\n<ol>\n<li>\u5f00\u5934\u662f\u4e00\u4e2a fatbin \u5934\u90e8</li>\n<li>\u63a5\u4e0b\u6765\u662f\u82e5\u5e72\u4e2a entry:<ol>\n<li>\u6bcf\u4e2a entry \u6709\u4e00\u4e2a\u5934\u90e8</li>\n<li>\u6bcf\u4e2a entry \u6709\u4e00\u4e2a payload\uff0c\u91cc\u9762\u662f ELF \u6216\u8005 PTX\uff0c\u53ef\u9009\u538b\u7f29</li>\n</ol>\n</li>\n</ol>\n<p>\u5b83\u5728\u6bcf\u4e2a entry \u7684\u5934\u90e8\u91cc\u4f1a\u8bb0\u5f55\u4e00\u4e9b\u4fe1\u606f\uff0c\u4f8b\u5982 SM Architecture \u7b49\u7b49\uff0c\u65b9\u4fbf CUDA Runtime \u5feb\u901f\u5730\u5b9a\u4f4d\u5230\u8981\u53bb\u4f7f\u7528\u7684 ELF \u6216\u8005 PTX\uff0c\u514d\u5f97\u626b\u63cf\u5b8c\u6574\u7684 ELF \u6216\u8005 PTX \u5185\u5bb9\u3002\u8fd9\u6709\u70b9\u50cf .a\uff08archive\uff09\u6587\u4ef6\uff0c\u672c\u8eab\u662f\u4e00\u4e2a .o\uff08object\uff09\u6587\u4ef6\u7684\u5bb9\u5668\uff0c\u4f46\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7d22\u5f15\uff0c\u4ece\u7b26\u53f7\u5230 object \u6587\u4ef6\u7684\u6620\u5c04\u3002\u867d\u7136 fatbin \u6ca1\u6709\u505a\u6620\u5c04\uff0c\u4f46\u662f\u5b83\u6bcf\u4e2a entry \u5934\u90e8\u90fd\u8bb0\u5f55\u4e86 entry \u7684\u957f\u5ea6\uff0c\u89e3\u6790\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e0d\u5173\u5fc3\u7684 payload\u3002</p>\n<p>\u5982\u679c\u60f3\u770b fatbin \u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u7528 <code>cuobjdump</code> \u547d\u4ee4\u6765\u67e5\u770b\uff0c\u5b83\u53ef\u4ee5\u663e\u793a\u51fa\u6bcf\u4e2a entry \u5728\u5934\u90e8\u4e2d\u8bb0\u5f55\u7684\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u628a\u5185\u90e8\u7684 payload \u91ca\u653e\u51fa\u6765\u3002\u5982\u679c\u60f3\u751f\u6210 fatbin\uff0c\u53ef\u4ee5\u7528 <code>fatbinary</code> \u547d\u4ee4\uff0c\u5b83\u4f1a\u89e3\u6790 ELF \u548c PTX \u6587\u4ef6\uff0c\u63d0\u53d6\u4e00\u4e9b\u4fe1\u606f\uff0c\u653e\u5230 entry \u5934\u90e8\u4e2d\u3002</p>\n<p>fatbin \u8fd8\u91c7\u7528\u4e86\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684\u538b\u7f29\u7b97\u6cd5\uff1a\u5982\u679c\u51fa\u73b0\u4e86\u91cd\u590d\u7684\u90e8\u5206\uff0c\u628a\u91cd\u590d\u7684\u90e8\u5206\u66ff\u6362\u4e3a\u8ddd\u79bb\u4e0a\u4e00\u6b21\u91cd\u590d\u7684\u504f\u79fb\u548c\u91cd\u590d\u7684\u957f\u5ea6\uff0c\u90a3\u4e48\u89e3\u538b\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981 memcpy \u5373\u53ef\uff0c\u4e0d\u6d89\u53ca\u5230\u590d\u6742\u7684\u5b57\u5178\u64cd\u4f5c\uff0c\u89c1 <a href=\"https://github.com/n-eiling/cuda-fatbin-decompression/blob/9b194a9aa526b71131990ddd97ff5c41a273ace5/fatbin-decompress.c#L137\">decompress \u51fd\u6570</a>\u3002</p>", "image": null, "date_modified": "2023-10-17T00:00:00+00:00", "authors": [], "tags": ["clang", "cuda", "llvm", "nvidia", "software"]}, {"id": "https://jia.je/os/2023/10/03/wsl2-internals/", "url": "https://jia.je/os/2023/10/03/wsl2-internals/", "title": "WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76", "content_html": "<h1 id=\"wsl2-\u5185\u90e8\u5b9e\u73b0\u63a2\u7a76\">WSL2 \u5185\u90e8\u5b9e\u73b0\u63a2\u7a76<a class=\"headerlink\" href=\"#wsl2-\u5185\u90e8\u5b9e\u73b0\u63a2\u7a76\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u8fd1\u770b\u5230 <a href=\"https://devblogs.microsoft.com/commandline/windows-subsystem-for-linux-september-2023-update/\">Windows Subsystem for Linux September 2023 update</a> \u58f0\u79f0 WSL2 \u6700\u65b0\u7684\u9884\u89c8\u7248\u672c\u652f\u6301\u8ba9 Linux \u548c Windows \u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5171\u4eab\u7f51\u7edc\u5730\u5740\u7a7a\u95f4\uff0c\u5c31\u50cf WSL1 \u90a3\u6837\uff1a</p>\n<ul>\n<li>IPv6 support</li>\n<li>Connect to Windows servers from within Linux using the localhost address 127.0.0.1</li>\n<li>Connect to WSL directly from your local area network (LAN)</li>\n<li>Improved networking compatibility for VPNs</li>\n<li>Multicast support</li>\n</ul>\n<p>\u56e0\u6b64\u6bd4\u8f83\u60f3\u77e5\u9053\u8fd9\u662f\u600e\u4e48\u505a\u5230\u7684\uff0c\u4f46\u76ee\u524d\u6211\u624b\u4e0a\u8fd8\u6ca1\u6709\u9884\u89c8\u7248\u672c\u7684 windows\uff0c\u56e0\u6b64\u76ee\u524d\u5148\u7814\u7a76 WSL2 \u5df2\u6709\u7684\u529f\u80fd\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u672a\u6765\u518d\u56de\u6765\u66f4\u65b0\u8fd9\u4e00\u90e8\u5206\u3002</p>\n<!-- more -->\n\n<h2 id=\"wsl2\">WSL2<a class=\"headerlink\" href=\"#wsl2\" title=\"Permanent link\">&para;</a></h2>\n<p>WSL1 \u5b9e\u73b0\u7684\u662f proxy kernel \u6a21\u5f0f\uff0c\u867d\u7136\u8dd1\u7684\u662f linux \u7a0b\u5e8f\uff0c\u4f46\u5176\u5b9e\u8fd8\u662f windows \u5185\u6838\uff0c\u4e2d\u95f4\u5305\u4e86\u4e00\u5c42 syscall \u7684\u8f6c\u6362\uff0c\u6ca1\u6709\u5f00\u4e00\u4e2a\u865a\u62df\u673a\u3002\u8fd9\u4e2a\u5957\u8def\u548c MinGW/Cygwin \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u5728\u4e0d\u540c\u5c42\u6b21\u4e0a\u505a\u7684 syscall \u8f6c\u6362\u3002</p>\n<p>WSL2 \u5219\u662f\u56de\u5f52\u4f20\u7edf\u7684\u865a\u62df\u673a\u6a21\u5f0f\uff0c\u57fa\u4e8e Hyper-V \u5f00\u4e86\u865a\u62df\u673a\uff0c\u7136\u540e\u505a\u4e86\u6bd4\u8f83\u591a\u7684\u96c6\u6210\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u548c\u539f\u6765 WSL1 \u7684\u529f\u80fd\u4e00\u81f4\u3002\u4f46\u6b64\u65f6\u5c31\u662f\u4e24\u4e2a\u5206\u7acb\u7684\u7cfb\u7edf\u4e86\uff0c\u5728\u865a\u62df\u673a\u91cc\u8dd1\u4e00\u4efd Linux \u5185\u6838\uff0c\u8fd9\u4e2a\u5185\u6838\u6709\u5fae\u8f6f\u81ea\u5df1\u7684\u4e00\u4e9b\u4fee\u6539\uff0c\u53ef\u4ee5\u5728 <a href=\"https://github.com/microsoft/WSL2-Linux-Kernel\">microsoft/WSL2-Linux-Kernel</a> \u91cc\u770b\u5230\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u770b\u4e0d\u5230 bootloader\uff0c\u865a\u62df\u673a\u542f\u52a8\u7684\u6d41\u7a0b\u90fd\u88ab\u9690\u85cf\u8d77\u6765\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u6709\u5f88\u591a\u53ef\u4ee5\u505a\u9a9a\u64cd\u4f5c\u7684\u5730\u65b9\u4e86\uff0c\u4f8b\u5982\u690d\u5165\u4e00\u4e9b\u7a0b\u5e8f\uff0c\u63d0\u524d\u505a\u4e00\u4e9b\u914d\u7f6e\u7b49\u7b49\u3002</p>\n<p>\u4e0b\u9762\u5c1d\u8bd5\u63a2\u7a76 WSL2 \u7684\u4e00\u4e9b\u529f\u80fd\u80cc\u540e\u7684\u539f\u7406\u3002</p>\n<h3 id=\"drvfs\">drvfs<a class=\"headerlink\" href=\"#drvfs\" title=\"Permanent link\">&para;</a></h3>\n<p>drvfs \u6307\u7684\u662f\u4ece WSL \u91cc\u9762\u8bbf\u95ee Windows \u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f8b\u5982 C \u76d8\u4f1a\u88ab\u6620\u5c04\u5230 <code>/mnt/c</code> \u4e0b\u9762\u3002\u5728 WSL2 \u4e0b\u9762\uff0c\u7528 <code>mount</code> \u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a 9pfs\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>drvfs<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/c<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>9p<span class=\"w\"> </span><span class=\"o\">(</span>rw,noatime,dirsync,aname<span class=\"o\">=</span>drvfs<span class=\"p\">;</span><span class=\"nv\">path</span><span class=\"o\">=</span>C:<span class=\"se\">\\;</span><span class=\"nv\">uid</span><span class=\"o\">=</span><span class=\"m\">1000</span><span class=\"p\">;</span><span class=\"nv\">gid</span><span class=\"o\">=</span><span class=\"m\">1000</span><span class=\"p\">;</span><span class=\"nv\">symlinkroot</span><span class=\"o\">=</span>/mnt/,mmap,access<span class=\"o\">=</span>client,msize<span class=\"o\">=</span><span class=\"m\">262144</span>,trans<span class=\"o\">=</span>virtio<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>9pfs \u7c7b\u4f3c NFS\uff0c\u662f\u4e00\u4e2a\u8fdc\u7a0b\u7684\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u534f\u8bae\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u8d70\u7f51\u7edc\uff0c\u800c\u662f\u8d70\u7684 virtio\uff08<code>trans=virtio</code>\uff09\uff0c\u4ece PCIe \u603b\u7ebf\u4e0a\u4e5f\u80fd\u770b\u5230\u4e00\u5806 virtio \u8bbe\u5907\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>2a99:00:00.0<span class=\"w\"> </span>System<span class=\"w\"> </span>peripheral:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span>file<span class=\"w\"> </span>system<span class=\"w\"> </span><span class=\"o\">(</span>rev<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"o\">)</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">        </span>Subsystem:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span>file<span class=\"w\"> </span>system\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">        </span>Kernel<span class=\"w\"> </span>driver<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>use:<span class=\"w\"> </span>virtio-pci\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>lspci:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>load<span class=\"w\"> </span>libkmod<span class=\"w\"> </span>resources:<span class=\"w\"> </span>error<span class=\"w\"> </span>-2\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a>47ee:00:00.0<span class=\"w\"> </span>SCSI<span class=\"w\"> </span>storage<span class=\"w\"> </span>controller:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem<span class=\"w\"> </span><span class=\"o\">(</span>rev<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"o\">)</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">        </span>Subsystem:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">        </span>Kernel<span class=\"w\"> </span>driver<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>use:<span class=\"w\"> </span>virtio-pci\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a>7cd4:00:00.0<span class=\"w\"> </span>SCSI<span class=\"w\"> </span>storage<span class=\"w\"> </span>controller:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem<span class=\"w\"> </span><span class=\"o\">(</span>rev<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"o\">)</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">        </span>Subsystem:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">        </span>Kernel<span class=\"w\"> </span>driver<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>use:<span class=\"w\"> </span>virtio-pci\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a>b9dc:00:00.0<span class=\"w\"> </span>SCSI<span class=\"w\"> </span>storage<span class=\"w\"> </span>controller:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>console<span class=\"w\"> </span><span class=\"o\">(</span>rev<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"o\">)</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">        </span>Subsystem:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>console\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">        </span>Kernel<span class=\"w\"> </span>driver<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>use:<span class=\"w\"> </span>virtio-pci\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a>e7ba:00:00.0<span class=\"w\"> </span>SCSI<span class=\"w\"> </span>storage<span class=\"w\"> </span>controller:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem<span class=\"w\"> </span><span class=\"o\">(</span>rev<span class=\"w\"> </span><span class=\"m\">01</span><span class=\"o\">)</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">        </span>Subsystem:<span class=\"w\"> </span>Red<span class=\"w\"> </span>Hat,<span class=\"w\"> </span>Inc.<span class=\"w\"> </span>Virtio<span class=\"w\"> </span><span class=\"m\">1</span>.0<span class=\"w\"> </span>filesystem\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">        </span>Kernel<span class=\"w\"> </span>driver<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>use:<span class=\"w\"> </span>virtio-pci\n</span></code></pre></div>\n<h3 id=\"\u8fd0\u884c-windows-\u7a0b\u5e8f\">\u8fd0\u884c Windows \u7a0b\u5e8f<a class=\"headerlink\" href=\"#\u8fd0\u884c-windows-\u7a0b\u5e8f\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5728 WSL2 \u91cc\uff0c\u53ef\u4ee5\u8fd0\u884c Windows \u4e0a\u7684\u7a0b\u5e8f\uff0c\u8fd9\u662f\u901a\u8fc7 <code>binfmt_misc</code> \u5b9e\u73b0\u7684\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>/proc/sys/fs/binfmt_misc/WSLInterop\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>enabled\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>interpreter<span class=\"w\"> </span>/init\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>flags:<span class=\"w\"> </span>PF\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>offset<span class=\"w\"> </span><span class=\"m\">0</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>magic<span class=\"w\"> </span>4d5a\n</span></code></pre></div>\n<p>\u5f53 Linux \u5c1d\u8bd5\u6267\u884c PE \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5339\u914d\u4e0a <code>magic 4d5a</code>\uff08<code>MZ</code>\uff09\uff0c\u5c31\u4f1a\u7528 <code>/init</code> \u53bb\u6267\u884c\u5b83\u3002\u4e4b\u540e\u5c31\u7531 <code>/init</code> \u548c Windows \u8fdb\u884c\u901a\u4fe1\uff0c\u628a\u547d\u4ee4\u548c\u53c2\u6570\u4f20\u8fc7\u53bb\uff0c\u6700\u540e\u5728 Windows \u4e0a\u6267\u884c\u3002</p>\n<p><code>/init</code> \u5219\u662f\u4e00\u4e2a WSL2 \u81ea\u5e26\u7684\u7a0b\u5e8f\uff1a\u5b83\u4f1a\u4f5c\u4e3a WSL2 \u5185\u90e8\u7684 init \u7a0b\u5e8f\uff0c\u4e5f\u5c31\u662f PID 1\u3002\u540c\u65f6\u5b83\u4f1a\u8dd1\u591a\u4e2a\u8fdb\u7a0b\uff0c\u867d\u7136\u90fd\u662f\u7528\u540c\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>USER<span class=\"w\">       </span>PID<span class=\"w\"> </span>%CPU<span class=\"w\"> </span>%MEM<span class=\"w\">    </span>VSZ<span class=\"w\">   </span>RSS<span class=\"w\"> </span>TTY<span class=\"w\">      </span>STAT<span class=\"w\"> </span>START<span class=\"w\">   </span>TIME<span class=\"w\"> </span>COMMAND\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>root<span class=\"w\">         </span><span class=\"m\">1</span><span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">   </span><span class=\"m\">2324</span><span class=\"w\">  </span><span class=\"m\">1512</span><span class=\"w\"> </span>?<span class=\"w\">        </span>Sl<span class=\"w\">   </span><span class=\"m\">23</span>:20<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>/init\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>root<span class=\"w\">         </span><span class=\"m\">4</span><span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">   </span><span class=\"m\">2324</span><span class=\"w\">     </span><span class=\"m\">4</span><span class=\"w\"> </span>?<span class=\"w\">        </span>Sl<span class=\"w\">   </span><span class=\"m\">23</span>:20<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>plan9<span class=\"w\"> </span>--control-socket<span class=\"w\"> </span><span class=\"m\">5</span><span class=\"w\"> </span>--log-level<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>--server-fd<span class=\"w\"> </span><span class=\"m\">6</span><span class=\"w\"> </span>--pipe-fd<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"w\"> </span>--log-truncate\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>root<span class=\"w\">         </span><span class=\"m\">7</span><span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">   </span><span class=\"m\">2332</span><span class=\"w\">   </span><span class=\"m\">112</span><span class=\"w\"> </span>?<span class=\"w\">        </span>Ss<span class=\"w\">   </span><span class=\"m\">23</span>:20<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>/init\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a>root<span class=\"w\">         </span><span class=\"m\">8</span><span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">   </span><span class=\"m\">2348</span><span class=\"w\">   </span><span class=\"m\">116</span><span class=\"w\"> </span>?<span class=\"w\">        </span>S<span class=\"w\">    </span><span class=\"m\">23</span>:20<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>/init\n</span></code></pre></div>\n<p>WSL2 \u53ef\u4ee5\u6253\u5f00 systemd\uff0c\u89c1 <a href=\"https://learn.microsoft.com/en-us/windows/wsl/wsl-config\">Advanced settings configuration in WS</a>\uff0c\u6b64\u65f6 PID 1 \u662f systemd\uff0c\u800c PID 2 \u8fd8\u6709\u5176\u4ed6\u51e0\u4e2a\u8fdb\u7a0b\u5c31\u662f <code>/init</code>\uff1a\u53ef\u4ee5\u731c\u6d4b\uff0c\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148\u542f\u52a8\u8fd8\u662f\u7684 <code>/init</code>\uff0c\u7136\u540e PID 1 \u7684 <code>/init</code> \u8c03\u7528 <code>exec</code> \u5207\u6362\u5230 systemd PID 1\uff0c\u5176\u4f59\u8fdb\u7a0b\u7ee7\u7eed\u6267\u884c\u3002</p>\n<h3 id=\"kernel-\u548c-initramfs\">kernel \u548c initramfs<a class=\"headerlink\" href=\"#kernel-\u548c-initramfs\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5982\u679c\u67e5\u770b dmesg\uff0c\u4f1a\u53d1\u73b0 Linux \u7684\u542f\u52a8 cmdline \u662f\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>initrd=\\initrd.img WSL_ROOT_INIT=1 panic=-1 nr_cpus=8 bonding.max_bonds=0 dummy.numdummies=0 fb_tunnels=none swiotlb=force console=hvc0 debug pty.legacy_count=0\n</span></code></pre></div>\n<p>\u8fd9\u4e2a <code>initrd.img</code> \u53ef\u4ee5\u5728 <code>C:\\Windows\\System32\\lxss\\tools</code> \u4e0b\u9762\u627e\u5230\uff0c\u4e5f\u53ef\u4ee5\u4ece <a href=\"https://github.com/microsoft/WSL/releases/download/1.2.5/Microsoft.WSL_1.2.5.0_x64_ARM64.msixbundle\">WSL \u5b89\u88c5\u5305</a> \u4e2d\u89e3\u5305\u51fa\u6765\u3002\u8fdb\u4e00\u6b65\u53ef\u4ee5\u53d1\u73b0 <code>initrd.img</code> \u5185\u90e8\u53ea\u6709\u4e00\u4e2a <code>/init</code> \u6587\u4ef6\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>$<span class=\"w\"> </span>cpio<span class=\"w\"> </span>-itv<span class=\"w\"> </span>&lt;<span class=\"w\"> </span>initrd.img\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>-rwxrwxrwx<span class=\"w\">   </span><span class=\"m\">0</span><span class=\"w\"> </span>root<span class=\"w\">     </span>root<span class=\"w\">      </span><span class=\"m\">1978872</span><span class=\"w\"> </span>Apr<span class=\"w\"> </span><span class=\"m\">20</span><span class=\"w\"> </span><span class=\"m\">06</span>:55<span class=\"w\"> </span>init\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"m\">3866</span><span class=\"w\"> </span>blocks\n</span></code></pre></div>\n<p>\u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u542f\u52a8\u4ee5\u540e\u7684\u51c6\u5907\u5de5\u4f5c\u90fd\u5728\u8fd9\u4e2a init \u7a0b\u5e8f\u91cc\u505a\u5b8c\u4e86\u3002</p>\n<p>kernel \u7684\u683c\u5f0f\u5728\u4e0d\u540c\u7248\u672c\u4e5f\u4e0d\u4e00\u6837\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\"># WSL 1.2.5</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>kernel:<span class=\"w\"> </span>ELF<span class=\"w\"> </span><span class=\"m\">64</span>-bit<span class=\"w\"> </span>LSB<span class=\"w\"> </span>executable,<span class=\"w\"> </span>x86-64,<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>SYSV<span class=\"o\">)</span>,<span class=\"w\"> </span>statically<span class=\"w\"> </span>linked,<span class=\"w\"> </span>BuildID<span class=\"o\">[</span>sha1<span class=\"o\">]=</span>e87c738e1e340eaf67d8d0c99369d458cdb5e6a0,<span class=\"w\"> </span>stripped\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"c1\"># WSL 2.0.0</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>kernel:<span class=\"w\"> </span>Linux<span class=\"w\"> </span>kernel<span class=\"w\"> </span>x86<span class=\"w\"> </span>boot<span class=\"w\"> </span>executable<span class=\"w\"> </span>bzImage,<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">5</span>.15.123.1-microsoft-standard-WSL2<span class=\"w\"> </span><span class=\"o\">(</span>root@5a891d5fa777<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">#1 SMP Mon Aug 7 19:01:48 UTC 2023, RO-rootFS, swap_dev 0XD, Normal VGA</span>\n</span></code></pre></div>\n<p>\u6216\u8bb8\u9690\u542b\u4e86\u4ec0\u4e48\u542f\u52a8\u6d41\u7a0b\u4e0a\u7684\u53d8\u5316\uff0c\u8fd9\u91cc\u5e76\u4e0d\u786e\u5b9a\u3002</p>\n<h3 id=\"init\">/init<a class=\"headerlink\" href=\"#init\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5728 WSL2 \u6587\u4ef6\u7cfb\u7edf\u5185\uff0c\u6709\u591a\u4e2a\u5230 <code>/init</code> \u7684\u7b26\u53f7\u94fe\u63a5\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>/usr/bin/wslpath -&gt; /init\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>/usr/sbin/mount.drvfs -&gt; /init\n</span></code></pre></div>\n<p>\u540c\u65f6\u8fd8\u6709\u4e0a\u9762\u51fa\u73b0\u8fc7\u7684 <code>plan9</code>\uff0c\u5176\u5b9e\u4e5f\u662f <code>/init</code> \u53bb\u6267\u884c\u7684\uff0c\u8bf4\u660e <code>/init</code> \u5185\u90e8\u4f1a\u6709\u903b\u8f91\uff0c\u53bb\u5224\u65ad <code>argv[0]</code> \u662f\u4ec0\u4e48\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002\u53ef\u4ee5\u627e\u5230\u5982\u4e0b\u51e0\u4e2a usage \u6587\u672c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"c1\"># wslpath</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>Usage:\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span>-a<span class=\"w\">    </span>force<span class=\"w\"> </span>result<span class=\"w\"> </span>to<span class=\"w\"> </span>absolute<span class=\"w\"> </span>path<span class=\"w\"> </span>format\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">    </span>-u<span class=\"w\">    </span>translate<span class=\"w\"> </span>from<span class=\"w\"> </span>a<span class=\"w\"> </span>Windows<span class=\"w\"> </span>path<span class=\"w\"> </span>to<span class=\"w\"> </span>a<span class=\"w\"> </span>WSL<span class=\"w\"> </span>path<span class=\"w\"> </span><span class=\"o\">(</span>default<span class=\"o\">)</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">    </span>-w<span class=\"w\">    </span>translate<span class=\"w\"> </span>from<span class=\"w\"> </span>a<span class=\"w\"> </span>WSL<span class=\"w\"> </span>path<span class=\"w\"> </span>to<span class=\"w\"> </span>a<span class=\"w\"> </span>Windows<span class=\"w\"> </span>path\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span>-m<span class=\"w\">    </span>translate<span class=\"w\"> </span>from<span class=\"w\"> </span>a<span class=\"w\"> </span>WSL<span class=\"w\"> </span>path<span class=\"w\"> </span>to<span class=\"w\"> </span>a<span class=\"w\"> </span>Windows<span class=\"w\"> </span>path,<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"s1\">&#39;/&#39;</span><span class=\"w\"> </span>instead<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">&#39;\\&#39;</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a>\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a>EX:<span class=\"w\"> </span>wslpath<span class=\"w\"> </span><span class=\"s1\">&#39;c:\\users&#39;</span>\n</span><span id=\"__span-8-9\"><a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"c1\"># mount.drvfs: no usage?</span>\n</span><span id=\"__span-8-10\"><a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"c1\"># localhost</span>\n</span><span id=\"__span-8-11\"><a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a>Usage:<span class=\"w\"> </span>localhost<span class=\"w\"> </span>--port-tracker-fd<span class=\"w\"> </span>fd<span class=\"w\"> </span><span class=\"o\">[</span>--bpf-fd<span class=\"w\"> </span>fd<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>--netlink-fd<span class=\"w\"> </span>fd<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>--localhost-relay<span class=\"w\"> </span>fd<span class=\"o\">]</span>\n</span><span id=\"__span-8-12\"><a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"c1\"># plan9</span>\n</span><span id=\"__span-8-13\"><a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a>Usage:<span class=\"w\"> </span>plan9<span class=\"w\"> </span>--control-socket<span class=\"w\"> </span>fd<span class=\"w\"> </span>--socket-path<span class=\"w\"> </span>path<span class=\"w\"> </span>--server-fd<span class=\"w\"> </span>fd<span class=\"w\"> </span>--log-file<span class=\"w\"> </span>log-file<span class=\"w\"> </span>--log-level<span class=\"w\"> </span>level<span class=\"w\"> </span>pipe-fd<span class=\"w\"> </span>fd<span class=\"w\"> </span><span class=\"o\">[</span>--log-truncate<span class=\"o\">]</span>\n</span><span id=\"__span-8-14\"><a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"c1\"># gns</span>\n</span><span id=\"__span-8-15\"><a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a>Usage:<span class=\"w\"> </span>gns<span class=\"w\"> </span><span class=\"o\">[</span>--socket<span class=\"w\"> </span>fd<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>--dns_socket<span class=\"w\"> </span>fd<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>--adapter<span class=\"w\"> </span>guid<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>--msg_type<span class=\"w\"> </span>int<span class=\"o\">]</span>\n</span><span id=\"__span-8-16\"><a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"c1\"># telagent: no usage?</span>\n</span></code></pre></div>\n<p>\u5176\u4e2d <code>localhost</code> \u547d\u4ee4\u548c <code>gns</code> \u547d\u4ee4\u5e94\u8be5\u5c31\u662f WSL 2.0.0 \u5f15\u5165\u7684 mirrored networking mode \u6240\u7528\u5230\u7684\u5b50\u7a0b\u5e8f\u4e86\u3002<code>telagent</code> \u4ece\u540d\u5b57\u6765\u770b\u5e94\u8be5\u662f telemetry agent\u3002<code>plan9</code> \u548c <code>mount.drvfs</code> \u5e94\u8be5\u662f\u914d\u5408 9pfs \u4f7f\u7528\u7684\u8fdb\u7a0b\u4e86\u3002\u4f7f\u7528 <code>strings</code> \u53ef\u4ee5\u770b\u5230\u4e00\u4e9b mirrored networking mode \u76f8\u5173\u7684\u6587\u5b57\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>GnsPortTracker: Failed to deallocate port\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a>GnsPortTracker: Requested the host for port allocation on port (family %d, port %u, protocol %d) - returned %d\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a>GnsPortTracker: Tracking bind call: family (%d) port (%u) protocol (%d)\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a>GnsPortTracker: No longer tracking bind call: family (%d) port (%u) protocol (%d)\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a>GnsPortTracker: Fetch to read bind() call info with ID %llu for pid %d, %s\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a>GnsPortTracker: Request for a port that&#39;s already reserved (family %d, port %u, protocol %d)\n</span><span id=\"__span-9-7\"><a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a>GnsPortTracker: Failed to complete bind request, %s\n</span><span id=\"__span-9-8\"><a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a>GnsPortTracker: Failed to read bind request, %s\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u53ef\u4ee5\u5927\u6982\u9884\u6d4b\u4e00\u4e0b\u5b83\u7684\u5de5\u4f5c\u6a21\u5f0f\uff1a\u89c2\u6d4b Linux \u4e0a\u7684 bind \u7cfb\u7edf\u8c03\u7528\uff0c\u5982\u679c\u53d1\u73b0\u6709\u8fdb\u7a0b\u8981 bind \u7aef\u53e3\uff0c\u5c31\u53bb Windows \u4e0a\u4e5f\u5206\u914d\u540c\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u542f\u52a8\u4e00\u4e2a\u7aef\u53e3\u8f6c\u53d1\u7a0b\u5e8f\uff0c\u8ba9 Windows \u4e0a\u7684\u7a0b\u5e8f\u53ef\u4ee5\u8bbf\u95ee\u5230 Linux \u91cc\u9762\u7684\u670d\u52a1\u3002</p>\n<p>\u6b64\u5916 mirrored networking mode \u8fd8\u6709\u4e00\u4e2a\u7279\u6027\u662f\uff0c\u540c\u6b65 Windows \u548c Linux \u7684 IP \u5730\u5740\u7b49\u914d\u7f6e\uff0c\u8fd9\u4e2a\u529f\u80fd\u770b\u8d77\u6765\u4e5f\u662f\u7531 <code>gns</code> \u6765\u5b8c\u6210\u7684\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a>SetAdapterConfiguration setting the IPv4 address on endpointID (%s) to %s on interfaceName %s\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a>ModifyAddress: Restoring route %s after address change, on interfaceName %s\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a>ProcessRouteChange: Reset routes on interfaceName %s\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a>ProcessRouteChange: Remove route %s on interfaceName %s\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a>ProcessRouteChange: Update route %s on interfaceName %s\n</span></code></pre></div>\n<p>\u65b0\u7684 DNS tunneling \u529f\u80fd\u4e5f\u80fd\u627e\u5230\u76f8\u5e94\u7684\u6587\u672c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a>DnsTunnelingManager::DnsTunnelingManager - using DNS server IP %s\n</span></code></pre></div>\n<h3 id=\"kernel\">kernel<a class=\"headerlink\" href=\"#kernel\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5728\u5185\u6838\u65b9\u9762\uff0cWSL2 \u6253\u4e86\u4e00\u4e9b\u81ea\u5df1\u7684 <a href=\"https://github.com/microsoft/WSL2-Linux-Kernel/commits/linux-msft-wsl-5.15.y\">patch</a>\uff0c\u6db5\u76d6\u7684\u8303\u56f4\u6709\uff1a</p>\n<ul>\n<li>\u5185\u5b58\u76f8\u5173\uff1amemory-reclaim\uff0cpage-reporting</li>\n<li>WSLg \u76f8\u5173\uff1aHyper-V vGPU</li>\n<li>ARM64 \u76f8\u5173\uff1aHyper-V \u652f\u6301</li>\n</ul>\n<p>\u5176\u4e2d\u4fee\u6539\u91cf\u6700\u5927\u7684\u90e8\u5206\u5c31\u662f WSLg \u7684 vGPU\u3002</p>\n<h3 id=\"wslg\">WSLg<a class=\"headerlink\" href=\"#wslg\" title=\"Permanent link\">&para;</a></h3>\n<p>WSLg \u662f\u5141\u8bb8 WSL2 \u7684\u7a0b\u5e8f\u5728 Windows \u4e0a\u663e\u793a UI \u7684\u529f\u80fd\u3002\u9996\u5148\u80fd\u770b\u5230\u7684\u662f\uff0c\u5b83\u8bbe\u7f6e\u4e86\u4e00\u4e2a <code>DISPLAY=:0</code>\uff0c\u540c\u65f6\u8fd8 mount \u4e86\u4e0d\u5c11\u6587\u4ef6\u8fdb\u6765\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-12-1\"><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/usr/lib/wsl/drivers<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>9p<span class=\"w\"> </span><span class=\"o\">(</span>ro,nosuid,nodev,noatime,dirsync,aname<span class=\"o\">=</span>drivers<span class=\"p\">;</span><span class=\"nv\">fmask</span><span class=\"o\">=</span><span class=\"m\">222</span><span class=\"p\">;</span><span class=\"nv\">dmask</span><span class=\"o\">=</span><span class=\"m\">222</span>,mmap,access<span class=\"o\">=</span>client,msize<span class=\"o\">=</span><span class=\"m\">65536</span>,trans<span class=\"o\">=</span>fd,rfd<span class=\"o\">=</span><span class=\"m\">7</span>,wfd<span class=\"o\">=</span><span class=\"m\">7</span><span class=\"o\">)</span>\n</span><span id=\"__span-12-2\"><a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/usr/lib/wsl/lib<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>overlay<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime,lowerdir<span class=\"o\">=</span>/gpu_lib_packaged:/gpu_lib_inbox,upperdir<span class=\"o\">=</span>/gpu_lib/rw/upper,workdir<span class=\"o\">=</span>/gpu_lib/rw/work<span class=\"o\">)</span>\n</span><span id=\"__span-12-3\"><a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>tmpfs<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime<span class=\"o\">)</span>\n</span><span id=\"__span-12-4\"><a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a>/dev/sdc<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg/distro<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>ext4<span class=\"w\"> </span><span class=\"o\">(</span>ro,relatime,discard,errors<span class=\"o\">=</span>remount-ro,data<span class=\"o\">=</span>ordered<span class=\"o\">)</span>\n</span><span id=\"__span-12-5\"><a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg/versions.txt<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>overlay<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime,lowerdir<span class=\"o\">=</span>/systemvhd,upperdir<span class=\"o\">=</span>/system/rw/upper,workdir<span class=\"o\">=</span>/system/rw/work<span class=\"o\">)</span>\n</span><span id=\"__span-12-6\"><a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg/doc<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>overlay<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime,lowerdir<span class=\"o\">=</span>/systemvhd,upperdir<span class=\"o\">=</span>/system/rw/upper,workdir<span class=\"o\">=</span>/system/rw/work<span class=\"o\">)</span>\n</span><span id=\"__span-12-7\"><a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/tmp/.X11-unix<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>tmpfs<span class=\"w\"> </span><span class=\"o\">(</span>ro,relatime<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>\u5176\u4e2d <code>/tmp/.X11-unix</code> \u662f\u4ece <code>/mnt/wslg/.X11-unix</code> bind-mount \u800c\u6765\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-13-1\"><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\" href=\"#__codelineno-13-1\"></a>/bin/mount<span class=\"w\"> </span>-o<span class=\"w\"> </span>bind,ro,X-mount.mkdir<span class=\"w\"> </span>-t<span class=\"w\"> </span>none<span class=\"w\"> </span>/mnt/wslg/.X11-unix<span class=\"w\"> </span>/tmp/.X11-unix\n</span></code></pre></div>\n<p>\u8fd9\u70b9\u4e5f\u53ef\u4ee5\u5728\u6253\u5f00 systemd \u7684 WSL2 \u7cfb\u7edf\u91cc\uff0c\u5728 <code>/run/systemd/generator.early/wslg-mount.service</code> \u6587\u4ef6\u91cc\u770b\u5230\u3002</p>\n<p>\u5728 WSL2 \u7684\u5b89\u88c5\u7a0b\u5e8f\u91cc\uff0c\u8fd8\u80fd\u770b\u5230 RDP \u7684\u8eab\u5f71\uff0c\u56e0\u6b64\u8ba9\u4eba\u6000\u7591\uff0c\u662f\u5426\u662f\u5728 Windows \u4e0a\u542f\u52a8 RDP \u5ba2\u6237\u7aef\uff0c\u8fdc\u7a0b\u8fde\u63a5\u5230 WSL2 \u7684 Linux \u91cc\u9762\uff0c\u800c Linux \u91cc\u9762\u542f\u52a8\u4e86\u4e00\u4e2a\u7c7b\u4f3c xrdp \u7684\u7a0b\u5e8f\uff0c\u542f\u52a8\u4e86\u4e00\u4e2a X11 Server\uff0c\u901a\u8fc7 RDP \u628a\u754c\u9762\u5171\u4eab\u7ed9 Windows\u3002</p>\n<h3 id=\"systemvhd\">system.vhd<a class=\"headerlink\" href=\"#systemvhd\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5728 WSL2 \u5b89\u88c5\u5305\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a <code>system.vhd</code> \u6587\u4ef6\uff0c\u91cc\u9762\u662f\u4e00\u4e2a ext2 \u7684 rootfs\uff0c\u89e3\u5f00\u4ee5\u540e\uff0c\u4f1a\u770b\u5230\u662f <a href=\"https://github.com/microsoft/CBL-Mariner\">CBL-Mariner</a> \u7684\u53d1\u884c\u7248\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-14-1\"><a id=\"__codelineno-14-1\" name=\"__codelineno-14-1\" href=\"#__codelineno-14-1\"></a><span class=\"nv\">DISTRIB_ID</span><span class=\"o\">=</span><span class=\"s2\">&quot;Mariner&quot;</span>\n</span><span id=\"__span-14-2\"><a id=\"__codelineno-14-2\" name=\"__codelineno-14-2\" href=\"#__codelineno-14-2\"></a><span class=\"nv\">DISTRIB_RELEASE</span><span class=\"o\">=</span><span class=\"s2\">&quot;2.0.20230630&quot;</span>\n</span><span id=\"__span-14-3\"><a id=\"__codelineno-14-3\" name=\"__codelineno-14-3\" href=\"#__codelineno-14-3\"></a><span class=\"nv\">DISTRIB_CODENAME</span><span class=\"o\">=</span>Mariner\n</span><span id=\"__span-14-4\"><a id=\"__codelineno-14-4\" name=\"__codelineno-14-4\" href=\"#__codelineno-14-4\"></a><span class=\"nv\">DISTRIB_DESCRIPTION</span><span class=\"o\">=</span><span class=\"s2\">&quot;CBL-Mariner 2.0.20230630&quot;</span>\n</span></code></pre></div>\n<p>\u5728\u8fd9\u4e2a\u53d1\u884c\u7248\u7cfb\u7edf\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u88c5\u4e86\u5f88\u591a\u8f6f\u4ef6\uff0c\u5305\u62ec\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u60f3\u5230\u662f\u548c WSLg \u6709\u5173\uff08\u6bd5\u7adf\u7cfb\u7edf\u91cc\u53ea\u6709\u4e00\u4e2a\u7528\u6237\u76ee\u5f55 <code>/home/wslg</code>\uff09\uff0c\u628a\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u4f9d\u8d56\u90fd\u6253\u5305\u8fdb\u53bb\u4e86\u3002\u751a\u81f3\u8fd8\u6709\u4e00\u4e2a <code>etc/wsl.conf</code>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-15-1\"><a id=\"__codelineno-15-1\" name=\"__codelineno-15-1\" href=\"#__codelineno-15-1\"></a><span class=\"o\">[</span>boot<span class=\"o\">]</span>\n</span><span id=\"__span-15-2\"><a id=\"__codelineno-15-2\" name=\"__codelineno-15-2\" href=\"#__codelineno-15-2\"></a><span class=\"nv\">command</span><span class=\"o\">=</span>/usr/bin/WSLGd\n</span><span id=\"__span-15-3\"><a id=\"__codelineno-15-3\" name=\"__codelineno-15-3\" href=\"#__codelineno-15-3\"></a><span class=\"o\">[</span>user<span class=\"o\">]</span>\n</span><span id=\"__span-15-4\"><a id=\"__codelineno-15-4\" name=\"__codelineno-15-4\" href=\"#__codelineno-15-4\"></a><span class=\"nv\">default</span><span class=\"o\">=</span>wslg\n</span></code></pre></div>\n<p>\u6240\u4ee5\u53ef\u4ee5\u731c\u60f3\uff0cWSLg \u8fd0\u884c\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u907f\u514d\u6c61\u67d3 WSL2 Linux \u7684\u73af\u5883\uff0c\u628a WSLg \u7684\u5f88\u591a\u56fe\u5f62\u754c\u9762\u7684\u8fdb\u7a0b\u653e\u5230\u4e86\u4e00\u4e2a\u5355\u72ec\u7684 ns \u4e2d\uff0c\u4e24\u4e2a ns \u4e4b\u95f4\u901a\u8fc7 X11 unix socket \u8fdb\u884c\u4e92\u76f8\u8bbf\u95ee\uff0c\u8fd9\u6837 WSLg \u7684\u5185\u90e8\u5b9e\u73b0\u5bf9\u7528\u6237\u5c31\u662f\u900f\u660e\u7684\uff0c\u7528\u6237\u53ea\u4f1a\u770b\u5230\u4e00\u4e2a <code>DISPLAY=:0</code>\uff0c\u7528\u8fd9\u4e2a DISPLAY \u5c31\u53ef\u4ee5\u5728 Windows \u4e0a\u663e\u793a UI\u3002</p>\n<p>\u66f4\u8fdb\u4e00\u6b65\u731c\u60f3\uff0c\u7ed3\u5408 <code>mount</code> \u770b\u5230\u7684\u5404\u79cd overlayfs\uff0c\u8fd8\u6709\u4e0d\u5b58\u5728\u7684\u76ee\u5f55\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u662f\u4e0d\u662f\u81ea\u5df1\u8bbf\u95ee\u7684\u6574\u4e2a WSL2 Linux \u73af\u5883\uff0c\u5176\u5b9e\u662f\u5728\u4e00\u4e2a\u5bb9\u5668\u91cc\u9762\uff0c\u5bb9\u5668\u5916\u9762\u662f\u8fd9\u4e2a CBL-Mariner\uff0c\u5bb9\u5668\u91cc\u9762\u624d\u662f\u6211\u4eec\u770b\u5230\u7684\u90e8\u5206\u3002\u8fd9\u5b8c\u5168\u53ef\u4ee5\u505a\u5230\uff0c\u6bd5\u7adf systemd-nspawn \u5bb9\u5668\u662f\u53ef\u4ee5\u5728\u91cc\u9762 boot systemd \u7684\u3002\u53ef\u4ee5\u7528\u6765\u4f50\u8bc1\u8fd9\u4e2a\u731c\u6d4b\u7684\u4e00\u4e2a\u73b0\u8c61\u662f\uff0c\u7cfb\u7edf\u91cc\u627e\u4e0d\u5230\u76d1\u542c <code>/tmp/.X11-unix/X0</code> \u7684\u8fdb\u7a0b\u3002</p>\n<p>\u5728 WSL2 Linux \u91cc\u9762\uff0crootfs \u662f <code>/dev/sdc</code>\uff0c<code>/dev/sdb</code> \u662f SWAP \u5206\u533a\uff0c\u5982\u679c mount \u4e00\u4e0b <code>/dev/sda</code>\uff0c\u5c31\u4f1a\u53d1\u73b0\u5b83\u91cc\u9762\u7684\u5185\u5bb9\u5c31\u662f <code>systemd.vhd</code> \u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684 CBL-Mariner \u7cfb\u7edf\u3002\u540c\u65f6\uff0cCBL-Mariner \u7684 <code>/etc/versions.txt</code> \u5185\u5bb9\u548c WSL2 Linux \u7684 <code>/mnt/wslg/versions.txt</code> \u5185\u5bb9\u4e00\u6837\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-16-1\"><a id=\"__codelineno-16-1\" name=\"__codelineno-16-1\" href=\"#__codelineno-16-1\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg/versions.txt<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>overlay<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime,lowerdir<span class=\"o\">=</span>/systemvhd,upperdir<span class=\"o\">=</span>/system/rw/upper,workdir<span class=\"o\">=</span>/system/rw/work<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>\u53ef\u4ee5\u731c\u6d4b <code>/dev/sda</code> \u66fe\u7ecf\u88ab\u6302\u8f7d\u5230\u4e86 <code>/systemvhd</code>\uff0c\u7136\u540e\u5728\u4e0a\u9762\u5957\u4e86\u4e00\u5c42 overlayfs\uff0c\u6700\u540e mount \u5230 <code>/mnt/wslg</code> \u4e0b\u9762\u3002\u540c\u7406\uff0cCBL-Mariner \u7684 <code>/usr/share/doc</code> \u88ab\u6302\u8f7d\u5230\u4e86 <code>/mnt/wslg/doc</code> \u8def\u5f84\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-17-1\"><a id=\"__codelineno-17-1\" name=\"__codelineno-17-1\" href=\"#__codelineno-17-1\"></a>none<span class=\"w\"> </span>on<span class=\"w\"> </span>/mnt/wslg/doc<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>overlay<span class=\"w\"> </span><span class=\"o\">(</span>rw,relatime,lowerdir<span class=\"o\">=</span>/systemvhd,upperdir<span class=\"o\">=</span>/system/rw/upper,workdir<span class=\"o\">=</span>/system/rw/work<span class=\"o\">)</span>\n</span></code></pre></div>\n<p>\u63a5\u4e0b\u6765\u5c31\u662f\u9a8c\u8bc1\u731c\u60f3\u7684\u65f6\u523b\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u8fdb\u5165 CBL-Mariner \u8fd9\u4e2a\u7cfb\u7edf\uff0c\u8fd9\u4e2a\u7cfb\u7edf\u79f0\u4e3a WSLg System Distro\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-18-1\"><a id=\"__codelineno-18-1\" name=\"__codelineno-18-1\" href=\"#__codelineno-18-1\"></a>wsl<span class=\"w\"> </span>--system\n</span></code></pre></div>\n<p>\u5c31\u53ef\u4ee5\u770b\u5230\u5b83\u91cc\u9762\u786e\u5b9e\u8dd1\u4e86\u4e00\u4e2a Xwayland\uff0c\u5e76\u4e14\u548c WSL2 Linux \u62e5\u6709\u540c\u6837\u7684 IP \u5730\u5740\uff1a\u8fd9\u8bf4\u660e\u5b83\u4eec\u5171\u4eab\u4e86\u540c\u4e00\u4e2a network namespace\uff0c\u4f46\u5176\u4ed6\u662f\u72ec\u7acb\u7684\uff0c\u751a\u81f3\u4f60\u8fd8\u53ef\u4ee5\u5728 CBL-Mariner \u770b\u5230\u4f60\u5728 WSL2 Linux \u91cc\u9762\u7684\u8fdb\u7a0b\uff0c\u5c31\u597d\u50cf\u4f60\u8fd0\u884c\u4e86\u4e00\u4e2a <code>docker run --net=host</code> \u7684\u5bb9\u5668\u4e00\u6837\u3002</p>\n<p>\u5173\u4e8e WSL2 System Distro \u7684\u8ba8\u8bba\uff0c\u63a8\u8350\u9605\u8bfb\uff1a<a href=\"https://unix.stackexchange.com/a/732459/144358\">https://unix.stackexchange.com/a/732459/144358</a>\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u6784\u5efa\u4e00\u4e2a\uff1a<a href=\"https://github.com/microsoft/WSLG/blob/main/CONTRIBUTING.md#building-the-wslg-system-distro\">Building the WSLg System Distro</a>\uff0c\u5e76\u4e14\u66ff\u6362\u6389\u81ea\u5e26\u7684 WSLg System Distro\u3002</p>", "image": null, "date_modified": "2023-10-03T00:00:00+00:00", "authors": [], "tags": ["linux", "os", "windows", "wsl", "wsl2"]}, {"id": "https://jia.je/os/2023/10/01/linux-boot-protocol/", "url": "https://jia.je/os/2023/10/01/linux-boot-protocol/", "title": "Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae", "content_html": "<h1 id=\"linux-\u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae\">Linux \u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae<a class=\"headerlink\" href=\"#linux-\u5185\u6838\u683c\u5f0f\u4e0e\u542f\u52a8\u534f\u8bae\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4e4b\u524d\u5728\u5404\u79cd\u573a\u5408\u9047\u5230\u8fc7\u5404\u79cd Linux \u5185\u6838\u7684\u6587\u4ef6\u540d\u6216\u683c\u5f0f\uff0c\u4f8b\u5982\uff1a</p>\n<ul>\n<li>vmlinux</li>\n<li>vmlinuz</li>\n<li>uImage</li>\n<li>bzImage</li>\n<li>uImage</li>\n</ul>\n<p>\u5373\u4f7f\u662f\u540c\u6837\u7684\u6587\u4ef6\u540d\uff0c\u683c\u5f0f\u53ef\u80fd\u4e5f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u76f8\u5e94\u7684\u542f\u52a8\u534f\u8bae\u4e5f\u53ef\u80fd\u4e0d\u4e00\u6837\u3002\u8fd9\u7bc7\u535a\u5ba2\u5c1d\u8bd5\u7ed3\u5408 Linux\uff0c\u5404\u79cd Bootloader\uff08QEMU\uff0cEDK-II\uff0cU-Boot\uff0cOpenSBI\uff09\u7684\u4ee3\u7801\u6765\u7814\u7a76\u4e0d\u540c\u7684 Linux \u4e8c\u8fdb\u5236\u683c\u5f0f\u4ee5\u53ca\u542f\u52a8\u534f\u8bae\u3002</p>\n<!-- more -->\n\n<h2 id=\"amd64x86_64\">amd64/x86_64<a class=\"headerlink\" href=\"#amd64x86_64\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u662f\u5e38\u7528\u7684 amd64 \u67b6\u6784\uff0c\u627e\u51e0\u4e2a\u7cfb\u7edf\uff0c\u67e5\u770b <code>/boot</code> \u76ee\u5f55\u4e0b\u7684 kernel \u6587\u4ef6\u7684\u7c7b\u578b\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>/boot/vmlinuz-6.1.0-12-amd64: Linux kernel x86 boot executable bzImage, version 6.1.0-12-amd64 (debian-kernel@lists.debian.org) #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07), RO-rootFS, swap_dev 0X7, Normal VGA\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>/boot/vmlinuz-6.2.16-14-pve: Linux kernel x86 boot executable bzImage, version 6.2.16-14-pve (build@proxmox) #1 SMP PREEMPT_DYNAMIC PMX 6.2.16-14 (2023-09-19T08:17Z), RO-rootFS, swap_dev 0XC, Normal VGA\n</span></code></pre></div>\n<p>\u770b\u4e86\u51e0\u4e2a\u7cfb\u7edf\uff0c\u53d1\u73b0\u6587\u4ef6\u540d\u90fd\u662f <code>vmlinuz</code> \u5f00\u5934\uff0c\u6587\u4ef6\u7c7b\u578b\u90fd\u662f <code>Linux kernel x86 boot executable bzImage</code>\u3002</p>\n<h3 id=\"linuxx86-boot-protocol\">Linux/x86 Boot Protocol<a class=\"headerlink\" href=\"#linuxx86-boot-protocol\" title=\"Permanent link\">&para;</a></h3>\n<p>Linux \u5728 x86 \u4e0b\u5b9a\u4e49\u4e86\u4e00\u5957 <a href=\"https://www.kernel.org/doc/html/v5.6/x86/boot.html\">Linux/x86 Boot Protocol</a>\uff0c\u5b83\u89c4\u5b9a\u4e86 bootloader \u5728\u542f\u52a8 Linux \u7684\u65f6\u5019\uff0c\u9700\u8981\u505a\u54ea\u4e9b\u4e8b\u60c5\uff0c\u4f20\u9012\u54ea\u4e9b\u53c2\u6570\uff0c\u4ee5\u4ec0\u4e48\u5f62\u5f0f\u4f20\u9012\u53c2\u6570\uff0c\u90a3\u4e48 Linux \u5c31\u53ef\u4ee5\u5728\u8fd9\u7ed9\u57fa\u7840\u4e0a\u542f\u52a8\u8d77\u6765\u3002</p>\n<p>\u9996\u5148\uff0cBoot Protocol \u5b9a\u4e49\u4e86 Linux \u5185\u6838\u7684\u683c\u5f0f\uff0c\u4f7f\u5f97 Bootloader \u53ef\u4ee5\u5f97\u5230\u5173\u4e8e Linux \u5185\u6838\u7684\u4e00\u4e9b\u4fe1\u606f\u3002\u8fd9\u4e2a\u683c\u5f0f\u5b9a\u4e49\u5728 <a href=\"https://www.kernel.org/doc/html/v5.6/x86/boot.html#the-real-mode-kernel-header\">The Real-Mode Kernel Header</a>\uff0c\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u7ed3\u6784\u4f53\uff0c\u5bf9\u5e94\u7684<a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/arch/x86/boot/header.S#L283-L584\">\u4ee3\u7801</a>\u5982\u4e0b\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"s\">&quot;.header&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;a&quot;</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\">  </span><span class=\"no\">sentinel</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"nl\">sentinel:</span><span class=\"w\">   </span><span class=\"na\">.byte</span><span class=\"w\"> </span><span class=\"mi\">0xff</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0xff</span><span class=\"w\">        </span><span class=\"cm\">/* Used to detect broken loaders */</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"na\">.globl</span><span class=\"w\">  </span><span class=\"no\">hdr</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"nl\">hdr:</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"nl\">setup_sects:</span><span class=\"w\">    </span><span class=\"na\">.byte</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">         </span><span class=\"cm\">/* Filled in by build.c */</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"nl\">root_flags:</span><span class=\"w\"> </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"no\">ROOT_RDONLY</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"nl\">syssize:</span><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">         </span><span class=\"cm\">/* Filled in by build.c */</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"nl\">ram_size:</span><span class=\"w\">   </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">         </span><span class=\"cm\">/* Obsolete */</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"nl\">vid_mode:</span><span class=\"w\">   </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"no\">SVGA_MODE</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"nl\">root_dev:</span><span class=\"w\">   </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">         </span><span class=\"cm\">/* Filled in by build.c */</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"nl\">boot_flag:</span><span class=\"w\">  </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"mi\">0xAA55</span>\n</span></code></pre></div>\n<p>\u540e\u9762\u8fd8\u6709\u5f88\u957f\uff0c\u90fd\u662f\u8fd9\u4e2a\u7ed3\u6784\u4f53\u91cc\u7684\u5b57\u6bb5\u3002\u5176\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u719f\u6089\u7684 <code>0xAA55</code>\uff0c\u719f\u6089\u7684\u542f\u52a8\u5206\u533a\u7ed3\u5c3e\u3002\u8fd9\u7247\u6570\u636e\u901a\u8fc7 <a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/arch/x86/boot/setup.ld#L16-L21\">linker script</a> \u6765\u653e\u7f6e\u5230\u4ece\u6587\u4ef6\u5f00\u59cb\u504f\u79fb 0x1f1 \u5904\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>    . = 495;\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>    .header     : { *(.header) }\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>    .entrytext  : { *(.entrytext) }\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>    .inittext   : { *(.inittext) }\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>    .initdata   : { *(.initdata) }\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>    __end_init = .;\n</span></code></pre></div>\n<p>\u8fd9\u91cc <code>495=0x1ef</code>\uff0c\u518d\u52a0\u4e0a\u4e24\u4e2a <code>sentinel</code> \u5b57\u8282\uff0c\u6700\u7ec8 <code>hdr</code> \u5c31\u4f1a\u843d\u5728 0x1f1 \u5730\u5740\u5904\u3002\u524d\u9762\u770b\u5230\u7684 <code>file</code> \u547d\u4ee4\u8f93\u51fa\u91cc\u7684\u5404\u4e2a\u5b57\u6bb5\uff0c\u5176\u5b9e\u4e5f\u662f\u4ece\u8fd9\u91cc<a href=\"https://github.com/file/file/blob/de7d52dce3e7a0bb1a72f299a265c2b641187842/magic/Magdir/linux#L137-L163\">\u8bfb\u6765</a>\u7684\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>/boot/vmlinuz-6.1.0-12-amd64: Linux kernel x86 boot executable bzImage, version 6.1.0-12-amd64 (debian-kernel@lists.debian.org) #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07), RO-rootFS, swap_dev 0X7, Normal VGA\n</span></code></pre></div>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a># Linux kernel boot images, from Albert Cahalan &lt;acahalan@cs.uml.edu&gt;\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a># and others such as Axel Kohlmeyer &lt;akohlmey@rincewind.chemie.uni-ulm.de&gt;\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a># and Nicolas Lichtmaier &lt;nick@debian.org&gt;\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a># All known start with: b8 c0 07 8e d8 b8 00 90 8e c0 b9 00 01 29 f6 29\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a># Linux kernel boot images (i386 arch) (Wolfram Kleff)\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a># URL: https://www.kernel.org/doc/Documentation/x86/boot.txt\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a>514 string      HdrS        Linux kernel\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a>!:strength + 55\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a># often no extension like in linux, vmlinuz, bzimage or memdisk but sometimes\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a># Acronis Recovery kernel64.dat and Plop Boot Manager plpbtrom.bin\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a># DamnSmallLinux 1.5 damnsmll.lnx \n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a>!:ext   /dat/bin/lnx\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a>&gt;510    leshort     0xAA55      x86 boot executable\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a>&gt;&gt;518   leshort     &gt;0x1ff\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a>&gt;&gt;&gt;529  byte        0       zImage,\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a>&gt;&gt;&gt;529  byte        1       bzImage,\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a>&gt;&gt;&gt;526  lelong      &gt;0\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a>&gt;&gt;&gt;&gt;(526.s+0x200) string    &gt;\\0 version %s,\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a>&gt;&gt;498   leshort     1       RO-rootFS,\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a>&gt;&gt;498   leshort     0       RW-rootFS,\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a>&gt;&gt;508   leshort     &gt;0      root_dev %#X,\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a>&gt;&gt;502   leshort     &gt;0      swap_dev %#X,\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a>&gt;&gt;504   leshort     &gt;0      RAMdisksize %u KB,\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a>&gt;&gt;506   leshort     0xFFFF      Normal VGA\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a>&gt;&gt;506   leshort     0xFFFE      Extended VGA\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a>&gt;&gt;506   leshort     0xFFFD      Prompt for Videomode\n</span><span id=\"__span-4-27\"><a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a>&gt;&gt;506   leshort     &gt;0      Video mode %d\n</span></code></pre></div>\n<p>\u8fd9\u91cc\u7684\u5224\u65ad\u548c Linux \u6e90\u7801\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>514 string      HdrS        Linux kernel\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>        .ascii  &quot;HdrS&quot;      # header signature\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a>&gt;510    leshort     0xAA55      x86 boot executable\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a>boot_flag:  .word 0xAA55\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a>&gt;&gt;&gt;529  byte        0       zImage,\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a>&gt;&gt;&gt;529  byte        1       bzImage,\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a>loadflags:\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a>        .byte   LOADED_HIGH # The kernel is to be loaded high\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a>\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a>&gt;&gt;&gt;&gt;(526.s+0x200) string    &gt;\\0 version %s,\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a>        .word   kernel_version-512 # pointing to kernel version string\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a>                    # above section of header is compatible\n</span><span id=\"__span-5-15\"><a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a>                    # with loadlin-1.5 (header v1.5). Don&#39;t\n</span><span id=\"__span-5-16\"><a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a>                    # change it.\n</span><span id=\"__span-5-17\"><a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a>\n</span><span id=\"__span-5-18\"><a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a>&gt;&gt;498   leshort     1       RO-rootFS,\n</span><span id=\"__span-5-19\"><a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a>&gt;&gt;498   leshort     0       RW-rootFS,\n</span><span id=\"__span-5-20\"><a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a>root_flags: .word ROOT_RDONLY\n</span><span id=\"__span-5-21\"><a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a>\n</span><span id=\"__span-5-22\"><a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a>&gt;&gt;508   leshort     &gt;0      root_dev %#X,\n</span><span id=\"__span-5-23\"><a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a>root_dev:   .word 0         /* Filled in by build.c */\n</span><span id=\"__span-5-24\"><a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\" href=\"#__codelineno-5-24\"></a>\n</span><span id=\"__span-5-25\"><a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\" href=\"#__codelineno-5-25\"></a>&gt;&gt;502   leshort     &gt;0      swap_dev %#X,\n</span><span id=\"__span-5-26\"><a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\" href=\"#__codelineno-5-26\"></a>syssize:    .long 0         /* Filled in by build.c */\n</span><span id=\"__span-5-27\"><a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\" href=\"#__codelineno-5-27\"></a>\n</span><span id=\"__span-5-28\"><a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\" href=\"#__codelineno-5-28\"></a>&gt;&gt;504   leshort     &gt;0      RAMdisksize %u KB,\n</span><span id=\"__span-5-29\"><a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\" href=\"#__codelineno-5-29\"></a>ram_size:   .word 0         /* Obsolete */\n</span><span id=\"__span-5-30\"><a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\" href=\"#__codelineno-5-30\"></a>\n</span><span id=\"__span-5-31\"><a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\" href=\"#__codelineno-5-31\"></a>&gt;&gt;506   leshort     0xFFFF      Normal VGA\n</span><span id=\"__span-5-32\"><a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\" href=\"#__codelineno-5-32\"></a>&gt;&gt;506   leshort     0xFFFE      Extended VGA\n</span><span id=\"__span-5-33\"><a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\" href=\"#__codelineno-5-33\"></a>&gt;&gt;506   leshort     0xFFFD      Prompt for Videomode\n</span><span id=\"__span-5-34\"><a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\" href=\"#__codelineno-5-34\"></a>&gt;&gt;506   leshort     &gt;0      Video mode %d\n</span><span id=\"__span-5-35\"><a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\" href=\"#__codelineno-5-35\"></a>vid_mode:   .word SVGA_MODE\n</span></code></pre></div>\n<p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0cBootloader \u521d\u59cb\u5316 <a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/arch/x86/include/uapi/asm/bootparam.h#L184-L232\"><code>struct boot_params</code></a> \u5e76\u4f20\u7ed9 Linux \u5185\u6838\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"cm\">/* The so-called &quot;zeropage&quot; */</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">boot_params</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">screen_info</span><span class=\"w\"> </span><span class=\"n\">screen_info</span><span class=\"p\">;</span><span class=\"w\">         </span><span class=\"cm\">/* 0x000 */</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">apm_bios_info</span><span class=\"w\"> </span><span class=\"n\">apm_bios_info</span><span class=\"p\">;</span><span class=\"w\">     </span><span class=\"cm\">/* 0x040 */</span>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"n\">__u8</span><span class=\"w\">  </span><span class=\"n\">_pad2</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">];</span><span class=\"w\">                 </span><span class=\"cm\">/* 0x054 */</span>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">    </span><span class=\"n\">__u64</span><span class=\"w\">  </span><span class=\"n\">tboot_addr</span><span class=\"p\">;</span><span class=\"w\">              </span><span class=\"cm\">/* 0x058 */</span>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">ist_info</span><span class=\"w\"> </span><span class=\"n\">ist_info</span><span class=\"p\">;</span><span class=\"w\">           </span><span class=\"cm\">/* 0x060 */</span>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">    </span><span class=\"n\">__u64</span><span class=\"w\"> </span><span class=\"n\">acpi_rsdp_addr</span><span class=\"p\">;</span><span class=\"w\">               </span><span class=\"cm\">/* 0x070 */</span>\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">    </span><span class=\"cm\">/* omitted */</span>\n</span><span id=\"__span-6-10\"><a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a>\n</span><span id=\"__span-6-11\"><a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">    </span><span class=\"cm\">/*</span>\n</span><span id=\"__span-6-12\"><a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"cm\">     * The sentinel is set to a nonzero value (0xff) in header.S.</span>\n</span><span id=\"__span-6-13\"><a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"cm\">     *</span>\n</span><span id=\"__span-6-14\"><a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"cm\">     * A bootloader is supposed to only take setup_header and put</span>\n</span><span id=\"__span-6-15\"><a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"cm\">     * it into a clean boot_params buffer. If it turns out that</span>\n</span><span id=\"__span-6-16\"><a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"cm\">     * it is clumsy or too generous with the buffer, it most</span>\n</span><span id=\"__span-6-17\"><a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"cm\">     * probably will pick up the sentinel variable too. The fact</span>\n</span><span id=\"__span-6-18\"><a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"cm\">     * that this variable then is still 0xff will let kernel</span>\n</span><span id=\"__span-6-19\"><a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"cm\">     * know that some variables in boot_params are invalid and</span>\n</span><span id=\"__span-6-20\"><a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"cm\">     * kernel should zero out certain portions of boot_params.</span>\n</span><span id=\"__span-6-21\"><a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"cm\">     */</span>\n</span><span id=\"__span-6-22\"><a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"w\">    </span><span class=\"n\">__u8</span><span class=\"w\">  </span><span class=\"n\">sentinel</span><span class=\"p\">;</span><span class=\"w\">                 </span><span class=\"cm\">/* 0x1ef */</span>\n</span><span id=\"__span-6-23\"><a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"w\">    </span><span class=\"n\">__u8</span><span class=\"w\">  </span><span class=\"n\">_pad6</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span><span class=\"w\">                 </span><span class=\"cm\">/* 0x1f0 */</span>\n</span><span id=\"__span-6-24\"><a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">setup_header</span><span class=\"w\"> </span><span class=\"n\">hdr</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"cm\">/* setup header */</span><span class=\"w\">  </span><span class=\"cm\">/* 0x1f1 */</span>\n</span><span id=\"__span-6-25\"><a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"w\">    </span><span class=\"n\">__u8</span><span class=\"w\">  </span><span class=\"n\">_pad7</span><span class=\"p\">[</span><span class=\"mh\">0x290-0x1f1</span><span class=\"o\">-</span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">setup_header</span><span class=\"p\">)];</span>\n</span><span id=\"__span-6-26\"><a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"w\">    </span><span class=\"n\">__u32</span><span class=\"w\"> </span><span class=\"n\">edd_mbr_sig_buffer</span><span class=\"p\">[</span><span class=\"n\">EDD_MBR_SIG_MAX</span><span class=\"p\">];</span><span class=\"w\">  </span><span class=\"cm\">/* 0x290 */</span>\n</span><span id=\"__span-6-27\"><a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">boot_e820_entry</span><span class=\"w\"> </span><span class=\"n\">e820_table</span><span class=\"p\">[</span><span class=\"n\">E820_MAX_ENTRIES_ZEROPAGE</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"cm\">/* 0x2d0 */</span>\n</span><span id=\"__span-6-28\"><a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a><span class=\"w\">    </span><span class=\"cm\">/* omitted */</span>\n</span><span id=\"__span-6-29\"><a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u63a5\u7740 Kernel \u5c31\u4f1a\u542f\u52a8\uff0c\u6839\u636e <code>struct boot_params</code> \u7684\u5404\u4e2a\u5b57\u6bb5\u8fdb\u884c\u521d\u59cb\u5316\u3002</p>\n<h3 id=\"efi-boot-stub\">EFI boot stub<a class=\"headerlink\" href=\"#efi-boot-stub\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5982\u679c\u7528 <code>xxd</code> \u67e5\u770b\u6587\u4ef6\u5f00\u5934\uff0c\u4f1a\u53d1\u73b0\u5b83\u5177\u6709 PE \u548c COFF \u5934\u90e8\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>00000000: 4d5a ea07 00c0 078c c88e d88e c08e d031  MZ.............1\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>00000010: e4fb fcbe 4000 ac20 c074 09b4 0ebb 0700  ....@.. .t......\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a>00000020: cd10 ebf2 31c0 cd16 cd19 eaf0 ff00 f000  ....1...........\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>00000030: 0000 0000 0000 0000 cd23 8281 8200 0000  .........#......\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>00000040: 5573 6520 6120 626f 6f74 206c 6f61 6465  Use a boot loade\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a>00000050: 722e 0d0a 0a52 656d 6f76 6520 6469 736b  r....Remove disk\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a>00000060: 2061 6e64 2070 7265 7373 2061 6e79 206b   and press any k\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a>00000070: 6579 2074 6f20 7265 626f 6f74 2e2e 2e0d  ey to reboot....\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a>00000080: 0a00 5045 0000 6486 0400 0000 0000 0000  ..PE..d.........\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a>00000090: 0000 0100 0000 a000 0602 0b02 0214 00fe  ................\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a>000000a0: a504 0000 0000 0000 0000 9c07 cf00 0002  ................\n</span></code></pre></div>\n<p>\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u8ba9 UEFI \u8ba4\u4e3a vmlinux \u4e5f\u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UEFI \u7a0b\u5e8f\uff0c\u800c UEFI \u7684\u7a0b\u5e8f\u683c\u5f0f\u6b63\u662f <a href=\"https://learn.microsoft.com/en-us/windows/win32/debug/pe-format\">PE</a>\uff0c\u8fd9\u79cd\u505a\u6cd5\u5c31\u662f <a href=\"https://docs.kernel.org/admin-guide/efi-stub.html\">EFI boot stub</a>\uff0c\u751f\u6210\u4e00\u4e2a\u6ee1\u8db3 UEFI \u8981\u6c42\u7684\u5934\u90e8\u3002\u5728 Linux \u6e90\u7801 <a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/arch/x86/boot/header.S#L39-L96\">arch/x86/boot/header.S</a>\u4e2d\uff0c\u4f7f\u7528\u6c47\u7f16\u6765\u6784\u9020\u51fa\u4e00\u4e2a MS-DOS Stub\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"w\">    </span><span class=\"na\">.section</span><span class=\"w\"> </span><span class=\"s\">&quot;.bstext&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;ax&quot;</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span><span class=\"na\">.global</span><span class=\"w\"> </span><span class=\"no\">bootsect_start</span>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"nl\">bootsect_start:</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"c1\">#ifdef CONFIG_EFI_STUB</span>\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"c1\"># &quot;MZ&quot;, MS-DOS header</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">MZ_MAGIC</span>\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"c1\">#endif</span>\n</span></code></pre></div>\n<p>\u9996\u5148\u662f\u7ecf\u5178\u7684 <code>MZ</code>\uff0c\u4e5f\u5c31\u662f MS-DOS Stub \u7684 magic\u3002MS-DOS Stub \u5728\u504f\u79fb <code>0x3c</code> \u7684\u5730\u65b9\uff0c\u8bb0\u5f55\u4e86\u5230 PE \u5934\u90e8\u7684\u504f\u79fb\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"c1\">#ifdef CONFIG_EFI_STUB</span>\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"w\">    </span><span class=\"na\">.org</span><span class=\"w\">    </span><span class=\"mi\">0x38</span>\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">    </span><span class=\"c1\">#</span>\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"w\">    </span><span class=\"c1\"># Offset to the PE header.</span>\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"w\">    </span><span class=\"c1\">#</span>\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"no\">LINUX_PE_MAGIC</span>\n</span><span id=\"__span-9-7\"><a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"no\">pe_header</span>\n</span><span id=\"__span-9-8\"><a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"c1\">#endif /* CONFIG_EFI_STUB */</span>\n</span></code></pre></div>\n<p>\u540e\u9762\u624d\u662f\u5b9e\u9645\u7684 COFF \u5934\u90e8\uff0c\u5728\u6c47\u7f16\u4e2d\u586b\u5199 COFF \u5934\u90e8\u7684\u5404\u4e2a\u5b57\u6bb5\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"c1\">#ifdef CONFIG_EFI_STUB</span>\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"nl\">pe_header:</span>\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"no\">PE_MAGIC</span>\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a>\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"nl\">coff_header:</span>\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"c1\">#ifdef CONFIG_X86_32</span>\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">    </span><span class=\"na\">.set</span><span class=\"w\">    </span><span class=\"no\">image_file_add_flags</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">IMAGE_FILE_32BIT_MACHINE</span>\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">    </span><span class=\"na\">.set</span><span class=\"w\">    </span><span class=\"no\">pe_opt_magic</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">PE_OPT_MAGIC_PE32</span>\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">IMAGE_FILE_MACHINE_I386</span>\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"c1\">#else</span>\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">    </span><span class=\"na\">.set</span><span class=\"w\">    </span><span class=\"no\">image_file_add_flags</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a><span class=\"w\">    </span><span class=\"na\">.set</span><span class=\"w\">    </span><span class=\"no\">pe_opt_magic</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">PE_OPT_MAGIC_PE32PLUS</span>\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">IMAGE_FILE_MACHINE_AMD64</span>\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"c1\">#endif</span>\n</span><span id=\"__span-10-15\"><a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">section_count</span><span class=\"w\">           </span><span class=\"c1\"># nr_sections</span>\n</span><span id=\"__span-10-16\"><a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"w\">               </span><span class=\"c1\"># TimeDateStamp</span>\n</span><span id=\"__span-10-17\"><a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"w\">               </span><span class=\"c1\"># PointerToSymbolTable</span>\n</span><span id=\"__span-10-18\"><a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">    </span><span class=\"na\">.long</span><span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"w\">               </span><span class=\"c1\"># NumberOfSymbols</span>\n</span><span id=\"__span-10-19\"><a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">section_table</span><span class=\"w\"> </span><span class=\"p\">-</span><span class=\"w\"> </span><span class=\"no\">optional_header</span><span class=\"w\"> </span><span class=\"c1\"># SizeOfOptionalHeader</span>\n</span><span id=\"__span-10-20\"><a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\">   </span><span class=\"no\">IMAGE_FILE_EXECUTABLE_IMAGE</span><span class=\"w\"> </span><span class=\"err\">|</span><span class=\"w\"> </span><span class=\"err\">\\</span>\n</span><span id=\"__span-10-21\"><a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">        </span><span class=\"nf\">image_file_add_flags</span><span class=\"w\">        </span><span class=\"err\">|</span><span class=\"w\"> </span><span class=\"err\">\\</span>\n</span><span id=\"__span-10-22\"><a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\" href=\"#__codelineno-10-22\"></a><span class=\"w\">        </span><span class=\"nf\">IMAGE_FILE_DEBUG_STRIPPED</span><span class=\"w\">   </span><span class=\"err\">|</span><span class=\"w\"> </span><span class=\"err\">\\</span>\n</span><span id=\"__span-10-23\"><a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\" href=\"#__codelineno-10-23\"></a><span class=\"w\">        </span><span class=\"nf\">IMAGE_FILE_LINE_NUMS_STRIPPED</span><span class=\"w\">   </span><span class=\"c1\"># Characteristics</span>\n</span></code></pre></div>\n<p>\u540e\u9762\u8fd8\u6709\u5f88\u591a\u5185\u5bb9\uff0c\u8fd9\u91cc\u6ca1\u6709\u5b8c\u6574\u8d34\u51fa\u6765\u3002\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u662f AddressOfEntryPoint\uff0c\u4e5f\u5c31\u662f PE \u7a0b\u5e8f\u7684\u5165\u53e3\u3002UEFI \u5728\u6267\u884c PE \u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u6309\u7167\u4e0b\u9762\u7684<a href=\"https://uefi.org/specs/UEFI/2.10/07_Services_Boot_Services.html#efi-image-entry-point\">\u51fd\u6570\u7b7e\u540d\u8c03\u7528</a>\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a>typedef\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a>EFI_STATUS\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a>(EFIAPI *EFI_IMAGE_ENTRY_POINT) (\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a>   IN EFI_HANDLE                             ImageHandle,\n</span><span id=\"__span-11-5\"><a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a>   IN EFI_SYSTEM_TABLE                       *SystemTable\n</span><span id=\"__span-11-6\"><a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a>   );\n</span></code></pre></div>\n<p>\u6240\u4ee5 Linux \u4e5f\u6309\u7167\u8fd9\u4e2a\u7b7e\u540d\u5b9e\u73b0\u4e86\u4e00\u4e2a<a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/drivers/firmware/efi/libstub/x86-stub.c#L449\">\u51fd\u6570</a>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-12-1\"><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a><span class=\"cm\">/*</span>\n</span><span id=\"__span-12-2\"><a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a><span class=\"cm\"> * Because the x86 boot code expects to be passed a boot_params we</span>\n</span><span id=\"__span-12-3\"><a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a><span class=\"cm\"> * need to create one ourselves (usually the bootloader would create</span>\n</span><span id=\"__span-12-4\"><a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a><span class=\"cm\"> * one for us).</span>\n</span><span id=\"__span-12-5\"><a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a><span class=\"cm\"> */</span>\n</span><span id=\"__span-12-6\"><a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a><span class=\"n\">efi_status_t</span><span class=\"w\"> </span><span class=\"n\">__efiapi</span><span class=\"w\"> </span><span class=\"n\">efi_pe_entry</span><span class=\"p\">(</span><span class=\"n\">efi_handle_t</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"p\">,</span>\n</span><span id=\"__span-12-7\"><a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a><span class=\"w\">                   </span><span class=\"n\">efi_system_table_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">sys_table_arg</span><span class=\"p\">);</span>\n</span></code></pre></div>\n<p>\u90a3\u4e48\u5f53\u4ece UEFI \u6267\u884c vmlinuz \u7684\u65f6\u5019\uff0cUEFI \u5c31\u4f1a\u4ece COFF \u5934\u90e8\u627e\u5230 <code>efi_pe_entry</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u4f20\u5165\u4e24\u4e2a\u53c2\u6570\uff0c\u7136\u540e\u8c03\u7528\u5b83\u3002\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u7684\u662f\uff0c\u6a21\u4eff Bootloader \u7684\u884c\u4e3a\uff0c\u586b\u5199 <code>struct boot_param</code>\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u771f\u6b63\u7684\u5185\u6838 entrypoint\u3002</p>\n<h3 id=\"\u5185\u6838\u538b\u7f29\">\u5185\u6838\u538b\u7f29<a class=\"headerlink\" href=\"#\u5185\u6838\u538b\u7f29\" title=\"Permanent link\">&para;</a></h3>\n<p>Linux \u5185\u6838\u8fd8\u7ecf\u5e38\u4f1a\u4ee5\u538b\u7f29\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u538b\u7f29\u7684\u7b97\u6cd5\u53ef\u80fd\u91c7\u7528 gzip \u7b49\u7b49\u3002\u538b\u7f29\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u653e\u4e00\u4efd\u6ca1\u6709\u88ab\u538b\u7f29\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u7528\u6765\u89e3\u538b\u3002\u4e3a\u4e86\u533a\u5206\u5185\u6838\u662f\u5426\u7ecf\u8fc7\u538b\u7f29\uff0c\u901a\u5e38\u7ea6\u5b9a <code>vmlinux</code> \u8868\u793a\u6ca1\u6709\u7ecf\u8fc7\u538b\u7f29\uff0c<code>vmlinuz</code> \u8868\u793a\u7ecf\u8fc7\u538b\u7f29\u3002</p>\n<h3 id=\"imagezimagebzimageuimage\">Image/zImage/bzImage/uImage<a class=\"headerlink\" href=\"#imagezimagebzimageuimage\" title=\"Permanent link\">&para;</a></h3>\n<p>\u6709\u65f6\u5019\u8fd8\u4f1a\u770b\u5230\u53e6\u4e00\u79cd\u672f\u8bed\uff1aImage \u6dfb\u52a0\u4e00\u4e2a\u524d\u7f00\uff0c\u5982\uff1a</p>\n<ul>\n<li>Image\uff1a\u672a\u7ecf\u8fc7\u538b\u7f29\u7684 Linux \u5185\u6838</li>\n<li>zImage\uff1a\u7ecf\u8fc7\u538b\u7f29\u7684 Linux \u5185\u6838</li>\n<li>bzImage\uff1abig zImage\uff0c\u800c\u4e0d\u662f bzip Image\uff0c\u662f zImage \u7684\u540e\u7eed\u683c\u5f0f</li>\n</ul>\n<p>bzImage \u548c zImage \u4ece Boot Protocol \u6765\u770b\uff0c<a href=\"https://www.kernel.org/doc/html/v5.6/x86/boot.html#loading-the-rest-of-the-kernel\">\u52a0\u8f7d\u7684\u5730\u5740\u4e0d\u540c</a>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-13-1\"><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\" href=\"#__codelineno-13-1\"></a><span class=\"n\">is_bzImage</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">protocol</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mh\">0x0200</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">loadflags</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"mh\">0x01</span><span class=\"p\">);</span>\n</span><span id=\"__span-13-2\"><a id=\"__codelineno-13-2\" name=\"__codelineno-13-2\" href=\"#__codelineno-13-2\"></a><span class=\"n\">load_address</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">is_bzImage</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"mh\">0x100000</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mh\">0x10000</span><span class=\"p\">;</span>\n</span></code></pre></div>\n<p>\u8fd9\u6837\u89e3\u51b3\u4e86 Image/zImage \u7684\u5927\u5c0f\u4e0a\u9650\u95ee\u9898\uff08\u5730\u5740\u8303\u56f4 0x10000-0x90000\uff0c512KB\uff09\uff0c\u6240\u4ee5\u57fa\u672c\u53ea\u80fd\u89c1\u5230 bzImage \u4e86\u3002</p>\n<p>\u800c uImage \u5176\u5b9e\u662f U-Boot \u7684\u542f\u52a8\u955c\u50cf\u683c\u5f0f\uff0c\u5728 Linux \u5185\u6838\u5916\u9762\u5957\u4e86\u4e00\u5c42\u81ea\u5df1\u7684\u683c\u5f0f\u3002\u4f46\u73b0\u5728 U-Boot \u8bbe\u8ba1\u4e86\u65b0\u7684\u683c\u5f0f\uff1aU-Boot FIT Image\u3002\u7531\u4e8e x86 \u4e0a\u4e00\u822c\u4e0d\u4f1a\u7528 U-Boot\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6d89\u53ca\u4e86\u3002</p>\n<p>\u5728\u7f16\u8bd1\u5185\u6838\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5173\u7cfb\u662f\uff1a</p>\n<ul>\n<li>vmlinux: \u9996\u5148\u94fe\u63a5\u51fa\u6765\u7684 ELF</li>\n<li>arch/x86/boot/compressed/vmlinux.bin: \u4ece vmlinux objcopy \u5f97\u5230\u7684 ELF \u6587\u4ef6\uff0c\u53bb\u6389\u4e86 .comment section</li>\n<li>arch/x86/boot/compressed/vmlinux.bin.gz: \u5bf9 arch/x86/boot/compressed/vmlinux.bin \u8fdb\u884c\u538b\u7f29</li>\n<li>arch/x86/boot/compressed/vmlinux: \u628a arch/x86/boot/compressed/vmlinux.bin.gz\uff08\u901a\u8fc7 arch/x86/boot/compressed/piggy.S \u4f7f\u7528 .incbin \u5f15\u5165\uff09\u548c\u89e3\u538b\u7f29\u7a0b\u5e8f\u6253\u5305\u5728\u4e00\u8d77\uff0c\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684 vmlinux</li>\n<li>arch/x86/boot/vmlinux.bin: \u4ece arch/x86/boot/compressed/vmlinux objcopy \u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u53bb\u6389\u4e86 .note \u548c .comment section</li>\n<li>arch/x86/boot/bzImage: \u628a arch/x86/boot/vmlinux.bin \u7ec4\u88c5\u6210\u6700\u7ec8\u7684\u683c\u5f0f</li>\n</ul>\n<p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u4ece\u76ee\u5f55\u4e0b\u5bf9\u5e94\u7684 <code>.cmd</code> \u6587\u4ef6\u91cc\u627e\u5230\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-14-1\"><a id=\"__codelineno-14-1\" name=\"__codelineno-14-1\" href=\"#__codelineno-14-1\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/compressed/.vmlinux.bin.cmd\n</span><span id=\"__span-14-2\"><a id=\"__codelineno-14-2\" name=\"__codelineno-14-2\" href=\"#__codelineno-14-2\"></a>cmd_arch/x86/boot/compressed/vmlinux.bin<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>objcopy<span class=\"w\">  </span>-R<span class=\"w\"> </span>.comment<span class=\"w\"> </span>-S<span class=\"w\"> </span>vmlinux<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux.bin\n</span><span id=\"__span-14-3\"><a id=\"__codelineno-14-3\" name=\"__codelineno-14-3\" href=\"#__codelineno-14-3\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/compressed/.vmlinux.bin.gz.cmd\n</span><span id=\"__span-14-4\"><a id=\"__codelineno-14-4\" name=\"__codelineno-14-4\" href=\"#__codelineno-14-4\"></a>cmd_arch/x86/boot/compressed/vmlinux.bin.gz<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux.bin<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux.relocs<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>gzip<span class=\"w\"> </span>-n<span class=\"w\"> </span>-f<span class=\"w\"> </span>-9<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux.bin.gz\n</span><span id=\"__span-14-5\"><a id=\"__codelineno-14-5\" name=\"__codelineno-14-5\" href=\"#__codelineno-14-5\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/compressed/.vmlinux.cmd\n</span><span id=\"__span-14-6\"><a id=\"__codelineno-14-6\" name=\"__codelineno-14-6\" href=\"#__codelineno-14-6\"></a>cmd_arch/x86/boot/compressed/vmlinux<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>ld<span class=\"w\"> </span>-m<span class=\"w\"> </span>elf_x86_64<span class=\"w\"> </span>--no-ld-generated-unwind-info<span class=\"w\">  </span>-pie<span class=\"w\">  </span>--no-dynamic-linker<span class=\"w\"> </span>--orphan-handling<span class=\"o\">=</span>warn<span class=\"w\"> </span>-z<span class=\"w\"> </span>noexecstack<span class=\"w\"> </span>--no-warn-rwx-segments<span class=\"w\"> </span>-T<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux.lds<span class=\"w\"> </span>arch/x86/boot/compressed/kernel_info.o<span class=\"w\"> </span>arch/x86/boot/compressed/head_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/misc.o<span class=\"w\"> </span>arch/x86/boot/compressed/string.o<span class=\"w\"> </span>arch/x86/boot/compressed/cmdline.o<span class=\"w\"> </span>arch/x86/boot/compressed/error.o<span class=\"w\"> </span>arch/x86/boot/compressed/piggy.o<span class=\"w\"> </span>arch/x86/boot/compressed/cpuflags.o<span class=\"w\"> </span>arch/x86/boot/compressed/early_serial_console.o<span class=\"w\"> </span>arch/x86/boot/compressed/kaslr.o<span class=\"w\"> </span>arch/x86/boot/compressed/ident_map_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/idt_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/idt_handlers_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/mem_encrypt.o<span class=\"w\"> </span>arch/x86/boot/compressed/pgtable_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/sev.o<span class=\"w\"> </span>arch/x86/boot/compressed/acpi.o<span class=\"w\"> </span>arch/x86/boot/compressed/tdx.o<span class=\"w\"> </span>arch/x86/boot/compressed/tdcall.o<span class=\"w\"> </span>arch/x86/boot/compressed/efi_thunk_64.o<span class=\"w\"> </span>arch/x86/boot/compressed/efi.o<span class=\"w\"> </span>drivers/firmware/efi/libstub/lib.a<span class=\"w\"> </span>-o<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux\n</span><span id=\"__span-14-7\"><a id=\"__codelineno-14-7\" name=\"__codelineno-14-7\" href=\"#__codelineno-14-7\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/.vmlinux.bin.cmd\n</span><span id=\"__span-14-8\"><a id=\"__codelineno-14-8\" name=\"__codelineno-14-8\" href=\"#__codelineno-14-8\"></a>cmd_arch/x86/boot/vmlinux.bin<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>objcopy<span class=\"w\">  </span>-O<span class=\"w\"> </span>binary<span class=\"w\"> </span>-R<span class=\"w\"> </span>.note<span class=\"w\"> </span>-R<span class=\"w\"> </span>.comment<span class=\"w\"> </span>-S<span class=\"w\"> </span>arch/x86/boot/compressed/vmlinux<span class=\"w\"> </span>arch/x86/boot/vmlinux.bin\n</span><span id=\"__span-14-9\"><a id=\"__codelineno-14-9\" name=\"__codelineno-14-9\" href=\"#__codelineno-14-9\"></a>$<span class=\"w\"> </span>cat<span class=\"w\"> </span>arch/x86/boot/.bzImage.cmd\n</span><span id=\"__span-14-10\"><a id=\"__codelineno-14-10\" name=\"__codelineno-14-10\" href=\"#__codelineno-14-10\"></a>cmd_arch/x86/boot/bzImage<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>arch/x86/boot/tools/build<span class=\"w\"> </span>arch/x86/boot/setup.bin<span class=\"w\"> </span>arch/x86/boot/vmlinux.bin<span class=\"w\"> </span>arch/x86/boot/zoffset.h<span class=\"w\"> </span>arch/x86/boot/bzImage\n</span></code></pre></div>\n<p>\u6700\u540e\u5c31\u7531 <code>installkernel</code> \u547d\u4ee4\u628a <code>bzImage</code> \u590d\u5236\u5230 <code>/boot</code> \u4e0b\uff0c\u5e76\u6539\u540d\u4e3a <code>vmlinuz</code>\u3002</p>\n<p>\u5bf9\u4e8e\u8fd9\u4e00\u8fc7\u7a0b\u7684\u5b8c\u6574\u63cf\u8ff0\uff0c\u63a8\u8350\u9605\u8bfb <a href=\"https://richardweiyang-2.gitbook.io/kernel-exploring/00_index/06_building_vmlinux_under_root\">\u8001\u53f8\u673a\u5e26\u4f60\u63a2\u7d22\u5185\u6838\u7f16\u8bd1\u7cfb\u7edf</a>\uff0c\u5199\u7684\u6bd4\u8f83\u8be6\u7ec6\u3002</p>\n<h3 id=\"unified-kernel-image\">Unified Kernel Image<a class=\"headerlink\" href=\"#unified-kernel-image\" title=\"Permanent link\">&para;</a></h3>\n<p><a href=\"https://wiki.gentoo.org/wiki/Unified_Kernel_Image\">Unified Kernel Image</a> \u4e5f\u662f\u4e00\u79cd\u6bd4\u8f83\u65b0\u7684\u683c\u5f0f\uff0c\u5b83\u628a\u542f\u52a8\u65f6\u5019\u9700\u8981\u7684\u4e00\u4e9b\u6587\u4ef6\uff08Linux \u5185\u6838\uff0c\u5fae\u7801\uff0cinitramfs \u7b49\u7b49\uff09\uff0c\u90fd\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u8fd9\u6837\u65b9\u4fbf Secure Boot\uff0c\u53ea\u9700\u8981\u5bf9\u4e00\u4e2a\u5927\u6587\u4ef6\u8fdb\u884c\u7b7e\u540d\u5373\u53ef\u3002</p>\n<h2 id=\"riscv64\">riscv64<a class=\"headerlink\" href=\"#riscv64\" title=\"Permanent link\">&para;</a></h2>\n<p>RISC-V \u73b0\u5728\u901a\u5e38\u6709\u4e24\u5957\u56fa\u4ef6\u6807\u51c6\uff0c\u4e00\u5957\u662f SBI\uff08Supervisor Binary Interface\uff09\uff0c\u53e6\u4e00\u5957\u662f UEFI\u3002</p>\n<h3 id=\"sbi\">SBI<a class=\"headerlink\" href=\"#sbi\" title=\"Permanent link\">&para;</a></h3>\n<p><a href=\"https://github.com/riscv-non-isa/riscv-sbi-doc\">SBI</a> \u662f M \u6001\u7a0b\u5e8f\u63d0\u4f9b\u7ed9 S \u6001\u7a0b\u5e8f\u7684\u4e00\u5957\u63a5\u53e3\u3002SBI \u4e00\u4e2a\u7684\u5e38\u89c1\u5b9e\u73b0\u5c31\u662f OpenSBI\uff0c\u5f53 OpenSBI \u52a0\u8f7d Linux \u7684\u65f6\u5019\uff0c\u505a\u4e86\u5982\u4e0b<a href=\"https://github.com/riscv-software-src/opensbi/blob/b7e9d34edf4f728bb02d11f73a2f9f79ad4acce4/lib/sbi/sbi_hsm.c#L138-L157\">\u7ea6\u5b9a</a>\uff1a</p>\n<ul>\n<li>a0: hart id</li>\n<li>a1: dtb \u5730\u5740</li>\n</ul>\n<p>\u4ee3\u7801\u5982\u4e0b\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-15-1\"><a id=\"__codelineno-15-1\" name=\"__codelineno-15-1\" href=\"#__codelineno-15-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">__noreturn</span><span class=\"w\"> </span><span class=\"nf\">sbi_hsm_hart_start_finish</span><span class=\"p\">(</span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">sbi_scratch</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">scratch</span><span class=\"p\">,</span>\n</span><span id=\"__span-15-2\"><a id=\"__codelineno-15-2\" name=\"__codelineno-15-2\" href=\"#__codelineno-15-2\"></a><span class=\"w\">                      </span><span class=\"n\">u32</span><span class=\"w\"> </span><span class=\"n\">hartid</span><span class=\"p\">)</span>\n</span><span id=\"__span-15-3\"><a id=\"__codelineno-15-3\" name=\"__codelineno-15-3\" href=\"#__codelineno-15-3\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-15-4\"><a id=\"__codelineno-15-4\" name=\"__codelineno-15-4\" href=\"#__codelineno-15-4\"></a><span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">next_arg1</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-5\"><a id=\"__codelineno-15-5\" name=\"__codelineno-15-5\" href=\"#__codelineno-15-5\"></a><span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">next_addr</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-6\"><a id=\"__codelineno-15-6\" name=\"__codelineno-15-6\" href=\"#__codelineno-15-6\"></a><span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">next_mode</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-7\"><a id=\"__codelineno-15-7\" name=\"__codelineno-15-7\" href=\"#__codelineno-15-7\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">sbi_hsm_data</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">hdata</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sbi_scratch_offset_ptr</span><span class=\"p\">(</span><span class=\"n\">scratch</span><span class=\"p\">,</span>\n</span><span id=\"__span-15-8\"><a id=\"__codelineno-15-8\" name=\"__codelineno-15-8\" href=\"#__codelineno-15-8\"></a><span class=\"w\">                                </span><span class=\"n\">hart_data_offset</span><span class=\"p\">);</span>\n</span><span id=\"__span-15-9\"><a id=\"__codelineno-15-9\" name=\"__codelineno-15-9\" href=\"#__codelineno-15-9\"></a>\n</span><span id=\"__span-15-10\"><a id=\"__codelineno-15-10\" name=\"__codelineno-15-10\" href=\"#__codelineno-15-10\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">__sbi_hsm_hart_change_state</span><span class=\"p\">(</span><span class=\"n\">hdata</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SBI_HSM_STATE_START_PENDING</span><span class=\"p\">,</span>\n</span><span id=\"__span-15-11\"><a id=\"__codelineno-15-11\" name=\"__codelineno-15-11\" href=\"#__codelineno-15-11\"></a><span class=\"w\">                     </span><span class=\"n\">SBI_HSM_STATE_STARTED</span><span class=\"p\">))</span>\n</span><span id=\"__span-15-12\"><a id=\"__codelineno-15-12\" name=\"__codelineno-15-12\" href=\"#__codelineno-15-12\"></a><span class=\"w\">        </span><span class=\"n\">sbi_hart_hang</span><span class=\"p\">();</span>\n</span><span id=\"__span-15-13\"><a id=\"__codelineno-15-13\" name=\"__codelineno-15-13\" href=\"#__codelineno-15-13\"></a>\n</span><span id=\"__span-15-14\"><a id=\"__codelineno-15-14\" name=\"__codelineno-15-14\" href=\"#__codelineno-15-14\"></a><span class=\"w\">    </span><span class=\"n\">next_arg1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">scratch</span><span class=\"o\">-&gt;</span><span class=\"n\">next_arg1</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-15\"><a id=\"__codelineno-15-15\" name=\"__codelineno-15-15\" href=\"#__codelineno-15-15\"></a><span class=\"w\">    </span><span class=\"n\">next_addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">scratch</span><span class=\"o\">-&gt;</span><span class=\"n\">next_addr</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-16\"><a id=\"__codelineno-15-16\" name=\"__codelineno-15-16\" href=\"#__codelineno-15-16\"></a><span class=\"w\">    </span><span class=\"n\">next_mode</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">scratch</span><span class=\"o\">-&gt;</span><span class=\"n\">next_mode</span><span class=\"p\">;</span>\n</span><span id=\"__span-15-17\"><a id=\"__codelineno-15-17\" name=\"__codelineno-15-17\" href=\"#__codelineno-15-17\"></a><span class=\"w\">    </span><span class=\"n\">hsm_start_ticket_release</span><span class=\"p\">(</span><span class=\"n\">hdata</span><span class=\"p\">);</span>\n</span><span id=\"__span-15-18\"><a id=\"__codelineno-15-18\" name=\"__codelineno-15-18\" href=\"#__codelineno-15-18\"></a>\n</span><span id=\"__span-15-19\"><a id=\"__codelineno-15-19\" name=\"__codelineno-15-19\" href=\"#__codelineno-15-19\"></a><span class=\"w\">    </span><span class=\"n\">sbi_hart_switch_mode</span><span class=\"p\">(</span><span class=\"n\">hartid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">next_arg1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">next_addr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">next_mode</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">);</span>\n</span><span id=\"__span-15-20\"><a id=\"__codelineno-15-20\" name=\"__codelineno-15-20\" href=\"#__codelineno-15-20\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u8fd9\u91cc <code>sbi_hart_switch_mode</code> \u524d\u4e24\u4e2a\u53c2\u6570\u5c31\u662f\u6700\u7ec8\u8981\u4f20\u7ed9 Linux \u7684\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>hartid</code> \u901a\u8fc7 <code>a0</code> \u5bc4\u5b58\u5668\u4f20\u9012\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>next_arg1</code> \u901a\u8fc7 <code>a1</code> \u5bc4\u5b58\u5668\u4f20\u9012\u3002</p>\n<p>\u5f53 Linux \u542f\u52a8\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4ece dtb \u4e2d\u83b7\u53d6\u7cfb\u7edf\u7684\u5404\u9879\u4fe1\u606f\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u63a5\u53e3\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f20\u4e24\u4e2a\u5bc4\u5b58\u5668\uff0c\u4f46\u662f\u5f88\u591a\u4e1c\u897f\u5c31\u8981\u653e\u5230 dtb \u91cc\u9762\u53bb\u4f20\u4e86\uff0c\u4f8b\u5982 initrd \u7684\u5730\u5740\uff0ccmdline \u7b49\u7b49\u3002\u65e0\u8bba\u662f bootloader \u8fd8\u662f Linux\uff0c\u90fd\u9700\u8981\u9644\u5e26 dtb \u89e3\u6790\u548c\u4fee\u6539\u7684\u4ee3\u7801\uff0c\u4e0d\u50cf x86 \u90a3\u6837\uff0c\u53ea\u9700\u8981\u4f20\u4e00\u4e2a\u56fa\u5b9a\u7ed3\u6784\u7684\u7ed3\u6784\u4f53\u5373\u53ef\u3002</p>\n<p>QEMU \u652f\u6301\u76f4\u63a5\u52a0\u8f7d Kernel\uff0c\u4e5f\u5c31\u662f\u8bf4 QEMU \u4e5f\u8981\u8d1f\u8d23<a href=\"https://github.com/qemu/qemu/blob/36e9aab3c569d4c9ad780473596e18479838d1aa/target/riscv/kvm.c#L1010-L1021\">\u5b9e\u73b0</a>\u4e0a\u9762\u7684 Boot Protocol\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><span id=\"__span-16-1\"><a id=\"__codelineno-16-1\" name=\"__codelineno-16-1\" href=\"#__codelineno-16-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">kvm_riscv_reset_vcpu</span><span class=\"p\">(</span><span class=\"n\">RISCVCPU</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">cpu</span><span class=\"p\">)</span>\n</span><span id=\"__span-16-2\"><a id=\"__codelineno-16-2\" name=\"__codelineno-16-2\" href=\"#__codelineno-16-2\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-16-3\"><a id=\"__codelineno-16-3\" name=\"__codelineno-16-3\" href=\"#__codelineno-16-3\"></a><span class=\"w\">    </span><span class=\"n\">CPURISCVState</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">cpu</span><span class=\"o\">-&gt;</span><span class=\"n\">env</span><span class=\"p\">;</span>\n</span><span id=\"__span-16-4\"><a id=\"__codelineno-16-4\" name=\"__codelineno-16-4\" href=\"#__codelineno-16-4\"></a>\n</span><span id=\"__span-16-5\"><a id=\"__codelineno-16-5\" name=\"__codelineno-16-5\" href=\"#__codelineno-16-5\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">kvm_enabled</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-16-6\"><a id=\"__codelineno-16-6\" name=\"__codelineno-16-6\" href=\"#__codelineno-16-6\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n</span><span id=\"__span-16-7\"><a id=\"__codelineno-16-7\" name=\"__codelineno-16-7\" href=\"#__codelineno-16-7\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-16-8\"><a id=\"__codelineno-16-8\" name=\"__codelineno-16-8\" href=\"#__codelineno-16-8\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"o\">-&gt;</span><span class=\"n\">pc</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"o\">-&gt;</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">kernel_addr</span><span class=\"p\">;</span>\n</span><span id=\"__span-16-9\"><a id=\"__codelineno-16-9\" name=\"__codelineno-16-9\" href=\"#__codelineno-16-9\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"o\">-&gt;</span><span class=\"n\">gpr</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kvm_arch_vcpu_id</span><span class=\"p\">(</span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">cpu</span><span class=\"p\">));</span><span class=\"w\"> </span><span class=\"cm\">/* a0 */</span>\n</span><span id=\"__span-16-10\"><a id=\"__codelineno-16-10\" name=\"__codelineno-16-10\" href=\"#__codelineno-16-10\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"o\">-&gt;</span><span class=\"n\">gpr</span><span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"o\">-&gt;</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">fdt_addr</span><span class=\"p\">;</span><span class=\"w\">          </span><span class=\"cm\">/* a1 */</span>\n</span><span id=\"__span-16-11\"><a id=\"__codelineno-16-11\" name=\"__codelineno-16-11\" href=\"#__codelineno-16-11\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"o\">-&gt;</span><span class=\"n\">satp</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n</span><span id=\"__span-16-12\"><a id=\"__codelineno-16-12\" name=\"__codelineno-16-12\" href=\"#__codelineno-16-12\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<h3 id=\"uefi\">UEFI<a class=\"headerlink\" href=\"#uefi\" title=\"Permanent link\">&para;</a></h3>\n<p>RISC-V \u4e5f\u652f\u6301\u7528 UEFI \u542f\u52a8\uff0c\u5b83\u7684\u505a\u6cd5\u548c x86 \u7c7b\u4f3c\uff0c\u4e5f\u662f\u505a\u4e00\u4e2a EFI Boot Stub\u3002\u7a0d\u5fae\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u901a\u8fc7<a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/arch/riscv/kernel/head.S#L21-L39\">\u6784\u9020</a>\uff0cEFI boot stub \u53ef\u4ee5\u4fdd\u8bc1\u5b83\u5728\u76f4\u63a5\u5f53\u6210 RISC-V \u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff1a</p>\n<div class=\"language-asm highlight\"><pre><span></span><code><span id=\"__span-17-1\"><a id=\"__codelineno-17-1\" name=\"__codelineno-17-1\" href=\"#__codelineno-17-1\"></a><span class=\"nf\">__HEAD</span>\n</span><span id=\"__span-17-2\"><a id=\"__codelineno-17-2\" name=\"__codelineno-17-2\" href=\"#__codelineno-17-2\"></a><span class=\"nf\">ENTRY</span><span class=\"p\">(</span><span class=\"no\">_start</span><span class=\"p\">)</span>\n</span><span id=\"__span-17-3\"><a id=\"__codelineno-17-3\" name=\"__codelineno-17-3\" href=\"#__codelineno-17-3\"></a><span class=\"w\">    </span><span class=\"cm\">/*</span>\n</span><span id=\"__span-17-4\"><a id=\"__codelineno-17-4\" name=\"__codelineno-17-4\" href=\"#__codelineno-17-4\"></a><span class=\"cm\">     * Image header expected by Linux boot-loaders. The image header data</span>\n</span><span id=\"__span-17-5\"><a id=\"__codelineno-17-5\" name=\"__codelineno-17-5\" href=\"#__codelineno-17-5\"></a><span class=\"cm\">     * structure is described in asm/image.h.</span>\n</span><span id=\"__span-17-6\"><a id=\"__codelineno-17-6\" name=\"__codelineno-17-6\" href=\"#__codelineno-17-6\"></a><span class=\"cm\">     * Do not modify it without modifying the structure and all bootloaders</span>\n</span><span id=\"__span-17-7\"><a id=\"__codelineno-17-7\" name=\"__codelineno-17-7\" href=\"#__codelineno-17-7\"></a><span class=\"cm\">     * that expects this header format!!</span>\n</span><span id=\"__span-17-8\"><a id=\"__codelineno-17-8\" name=\"__codelineno-17-8\" href=\"#__codelineno-17-8\"></a><span class=\"cm\">     */</span>\n</span><span id=\"__span-17-9\"><a id=\"__codelineno-17-9\" name=\"__codelineno-17-9\" href=\"#__codelineno-17-9\"></a><span class=\"c1\">#ifdef CONFIG_EFI</span>\n</span><span id=\"__span-17-10\"><a id=\"__codelineno-17-10\" name=\"__codelineno-17-10\" href=\"#__codelineno-17-10\"></a><span class=\"w\">    </span><span class=\"cm\">/*</span>\n</span><span id=\"__span-17-11\"><a id=\"__codelineno-17-11\" name=\"__codelineno-17-11\" href=\"#__codelineno-17-11\"></a><span class=\"cm\">     * This instruction decodes to &quot;MZ&quot; ASCII required by UEFI.</span>\n</span><span id=\"__span-17-12\"><a id=\"__codelineno-17-12\" name=\"__codelineno-17-12\" href=\"#__codelineno-17-12\"></a><span class=\"cm\">     */</span>\n</span><span id=\"__span-17-13\"><a id=\"__codelineno-17-13\" name=\"__codelineno-17-13\" href=\"#__codelineno-17-13\"></a><span class=\"w\">    </span><span class=\"nf\">c.li</span><span class=\"w\"> </span><span class=\"no\">s4</span><span class=\"p\">,-</span><span class=\"mi\">13</span>\n</span><span id=\"__span-17-14\"><a id=\"__codelineno-17-14\" name=\"__codelineno-17-14\" href=\"#__codelineno-17-14\"></a><span class=\"w\">    </span><span class=\"nf\">j</span><span class=\"w\"> </span><span class=\"no\">_start_kernel</span>\n</span><span id=\"__span-17-15\"><a id=\"__codelineno-17-15\" name=\"__codelineno-17-15\" href=\"#__codelineno-17-15\"></a><span class=\"c1\">#else</span>\n</span><span id=\"__span-17-16\"><a id=\"__codelineno-17-16\" name=\"__codelineno-17-16\" href=\"#__codelineno-17-16\"></a><span class=\"w\">    </span><span class=\"cm\">/* jump to start kernel */</span>\n</span><span id=\"__span-17-17\"><a id=\"__codelineno-17-17\" name=\"__codelineno-17-17\" href=\"#__codelineno-17-17\"></a><span class=\"w\">    </span><span class=\"nf\">j</span><span class=\"w\"> </span><span class=\"no\">_start_kernel</span>\n</span><span id=\"__span-17-18\"><a id=\"__codelineno-17-18\" name=\"__codelineno-17-18\" href=\"#__codelineno-17-18\"></a><span class=\"w\">    </span><span class=\"cm\">/* reserved */</span>\n</span><span id=\"__span-17-19\"><a id=\"__codelineno-17-19\" name=\"__codelineno-17-19\" href=\"#__codelineno-17-19\"></a><span class=\"w\">    </span><span class=\"na\">.word</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</span><span id=\"__span-17-20\"><a id=\"__codelineno-17-20\" name=\"__codelineno-17-20\" href=\"#__codelineno-17-20\"></a><span class=\"c1\">#endif</span>\n</span></code></pre></div>\n<p>\u5728 RISC-V \u4e0b\uff0cPE \u5934\u90e8\u7684 <code>MZ</code> \u53ef\u4ee5\u88ab\u89e3\u6790\u6210\u5408\u6cd5\u7684\u6307\u4ee4\uff0c\u5728\u5b83\u540e\u9762\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 Kernel \u5165\u53e3\uff0c\u8fd9\u6837\u5373\u4f7f Bootloader \u6ca1\u6709\u5b9e\u73b0 UEFI\uff0c\u4f8b\u5982 OpenSBI\uff0c\u8df3\u8f6c\u5230 Kernel \u7b2c\u4e00\u6761\u6307\u4ee4\u5f00\u59cb\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fdb\u5165\u5230 <code>_start_kernel</code> \u5f53\u4e2d\u3002</p>\n<p>\u548c x86 \u7c7b\u4f3c\uff0cEFI boot stub \u7684\u5b9e\u9645 entry point \u662f\u4e00\u4e2a\u5355\u72ec\u7684<a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/drivers/firmware/efi/libstub/efi-stub-entry.c#L19-L26\">\u51fd\u6570</a>\uff0c\u800c\u4e0d\u662f\u539f\u6765\u7684 <code>_start_kernel</code>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-18-1\"><a id=\"__codelineno-18-1\" name=\"__codelineno-18-1\" href=\"#__codelineno-18-1\"></a><span class=\"cm\">/*</span>\n</span><span id=\"__span-18-2\"><a id=\"__codelineno-18-2\" name=\"__codelineno-18-2\" href=\"#__codelineno-18-2\"></a><span class=\"cm\"> * EFI entry point for the generic EFI stub used by ARM, arm64, RISC-V and</span>\n</span><span id=\"__span-18-3\"><a id=\"__codelineno-18-3\" name=\"__codelineno-18-3\" href=\"#__codelineno-18-3\"></a><span class=\"cm\"> * LoongArch. This is the entrypoint that is described in the PE/COFF header</span>\n</span><span id=\"__span-18-4\"><a id=\"__codelineno-18-4\" name=\"__codelineno-18-4\" href=\"#__codelineno-18-4\"></a><span class=\"cm\"> * of the core kernel.</span>\n</span><span id=\"__span-18-5\"><a id=\"__codelineno-18-5\" name=\"__codelineno-18-5\" href=\"#__codelineno-18-5\"></a><span class=\"cm\"> */</span>\n</span><span id=\"__span-18-6\"><a id=\"__codelineno-18-6\" name=\"__codelineno-18-6\" href=\"#__codelineno-18-6\"></a><span class=\"n\">efi_status_t</span><span class=\"w\"> </span><span class=\"n\">__efiapi</span><span class=\"w\"> </span><span class=\"n\">efi_pe_entry</span><span class=\"p\">(</span><span class=\"n\">efi_handle_t</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"p\">,</span>\n</span><span id=\"__span-18-7\"><a id=\"__codelineno-18-7\" name=\"__codelineno-18-7\" href=\"#__codelineno-18-7\"></a><span class=\"w\">                   </span><span class=\"n\">efi_system_table_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">systab</span><span class=\"p\">);</span>\n</span></code></pre></div>\n<p>\u8fd9\u4e2a\u51fd\u6570\u7684\u63a5\u53e3\u548c\u524d\u9762 amd64 UEFI \u662f\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u662f UEFI \u6807\u51c6\u89c4\u5b9a\u7684\u3002\u5b83\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u4ece UEFI \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\uff0c\u6784\u9020\u51fa\u4e00\u4e2a dtb\uff0c\u7136\u540e\u4ece UEFI \u4e2d\u83b7\u53d6 hart id\uff08\u89c1\u540e\uff09\uff0c\u7136\u540e\u518d<a href=\"https://github.com/torvalds/linux/blob/e402b08634b398e9feb94902c7adcf05bb8ba47d/drivers/firmware/efi/libstub/riscv.c#L90-L97\">\u8df3\u8f6c\u5230\u5b9e\u9645\u7684 <code>_start_kernel</code></a>\uff0c\u4f20\u9012\u7684\u53c2\u6570\u548c\u524d\u9762 SBI \u65f6\u662f\u4e00\u6837\u7684\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-19-1\"><a id=\"__codelineno-19-1\" name=\"__codelineno-19-1\" href=\"#__codelineno-19-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">__noreturn</span><span class=\"w\"> </span><span class=\"nf\">efi_enter_kernel</span><span class=\"p\">(</span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">entrypoint</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">fdt</span><span class=\"p\">,</span>\n</span><span id=\"__span-19-2\"><a id=\"__codelineno-19-2\" name=\"__codelineno-19-2\" href=\"#__codelineno-19-2\"></a><span class=\"w\">                 </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">fdt_size</span><span class=\"p\">)</span>\n</span><span id=\"__span-19-3\"><a id=\"__codelineno-19-3\" name=\"__codelineno-19-3\" href=\"#__codelineno-19-3\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-19-4\"><a id=\"__codelineno-19-4\" name=\"__codelineno-19-4\" href=\"#__codelineno-19-4\"></a><span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">kernel_entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">entrypoint</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">stext_offset</span><span class=\"p\">();</span>\n</span><span id=\"__span-19-5\"><a id=\"__codelineno-19-5\" name=\"__codelineno-19-5\" href=\"#__codelineno-19-5\"></a><span class=\"w\">    </span><span class=\"n\">jump_kernel_func</span><span class=\"w\"> </span><span class=\"n\">jump_kernel</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">jump_kernel_func</span><span class=\"p\">)</span><span class=\"n\">kernel_entry</span><span class=\"p\">;</span>\n</span><span id=\"__span-19-6\"><a id=\"__codelineno-19-6\" name=\"__codelineno-19-6\" href=\"#__codelineno-19-6\"></a>\n</span><span id=\"__span-19-7\"><a id=\"__codelineno-19-7\" name=\"__codelineno-19-7\" href=\"#__codelineno-19-7\"></a><span class=\"w\">    </span><span class=\"cm\">/*</span>\n</span><span id=\"__span-19-8\"><a id=\"__codelineno-19-8\" name=\"__codelineno-19-8\" href=\"#__codelineno-19-8\"></a><span class=\"cm\">     * Jump to real kernel here with following constraints.</span>\n</span><span id=\"__span-19-9\"><a id=\"__codelineno-19-9\" name=\"__codelineno-19-9\" href=\"#__codelineno-19-9\"></a><span class=\"cm\">     * 1. MMU should be disabled.</span>\n</span><span id=\"__span-19-10\"><a id=\"__codelineno-19-10\" name=\"__codelineno-19-10\" href=\"#__codelineno-19-10\"></a><span class=\"cm\">     * 2. a0 should contain hartid</span>\n</span><span id=\"__span-19-11\"><a id=\"__codelineno-19-11\" name=\"__codelineno-19-11\" href=\"#__codelineno-19-11\"></a><span class=\"cm\">     * 3. a1 should DT address</span>\n</span><span id=\"__span-19-12\"><a id=\"__codelineno-19-12\" name=\"__codelineno-19-12\" href=\"#__codelineno-19-12\"></a><span class=\"cm\">     */</span>\n</span><span id=\"__span-19-13\"><a id=\"__codelineno-19-13\" name=\"__codelineno-19-13\" href=\"#__codelineno-19-13\"></a><span class=\"w\">    </span><span class=\"n\">csr_write</span><span class=\"p\">(</span><span class=\"n\">CSR_SATP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">);</span>\n</span><span id=\"__span-19-14\"><a id=\"__codelineno-19-14\" name=\"__codelineno-19-14\" href=\"#__codelineno-19-14\"></a><span class=\"w\">    </span><span class=\"n\">jump_kernel</span><span class=\"p\">(</span><span class=\"n\">hartid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fdt</span><span class=\"p\">);</span>\n</span><span id=\"__span-19-15\"><a id=\"__codelineno-19-15\" name=\"__codelineno-19-15\" href=\"#__codelineno-19-15\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u4e3a\u4e86\u8ba9 EFI boot stub \u53ef\u4ee5\u83b7\u53d6\u5230 boot hart id\uff0c\u8fd8\u8bbe\u8ba1\u4e86 <a href=\"https://github.com/riscv-non-isa/riscv-uefi/blob/main/boot_protocol.adoc\"><code>RISCV_EFI_BOOT_PROTOCOL</code></a>\uff0c\u4f7f\u5f97 EFI boot stub \u53ef\u4ee5<a href=\"https://github.com/torvalds/linux/blob/ec8c298121e3616f8013d3cf1db9c7169c9b0b2d/drivers/firmware/efi/libstub/riscv.c#L46-L57\">\u83b7\u53d6 boot hart id</a>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-20-1\"><a id=\"__codelineno-20-1\" name=\"__codelineno-20-1\" href=\"#__codelineno-20-1\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">efi_status_t</span><span class=\"w\"> </span><span class=\"nf\">get_boot_hartid_from_efi</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"p\">)</span>\n</span><span id=\"__span-20-2\"><a id=\"__codelineno-20-2\" name=\"__codelineno-20-2\" href=\"#__codelineno-20-2\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-20-3\"><a id=\"__codelineno-20-3\" name=\"__codelineno-20-3\" href=\"#__codelineno-20-3\"></a><span class=\"w\">    </span><span class=\"n\">efi_guid_t</span><span class=\"w\"> </span><span class=\"n\">boot_protocol_guid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RISCV_EFI_BOOT_PROTOCOL_GUID</span><span class=\"p\">;</span>\n</span><span id=\"__span-20-4\"><a id=\"__codelineno-20-4\" name=\"__codelineno-20-4\" href=\"#__codelineno-20-4\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">riscv_efi_boot_protocol</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">boot_protocol</span><span class=\"p\">;</span>\n</span><span id=\"__span-20-5\"><a id=\"__codelineno-20-5\" name=\"__codelineno-20-5\" href=\"#__codelineno-20-5\"></a><span class=\"w\">    </span><span class=\"n\">efi_status_t</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">;</span>\n</span><span id=\"__span-20-6\"><a id=\"__codelineno-20-6\" name=\"__codelineno-20-6\" href=\"#__codelineno-20-6\"></a>\n</span><span id=\"__span-20-7\"><a id=\"__codelineno-20-7\" name=\"__codelineno-20-7\" href=\"#__codelineno-20-7\"></a><span class=\"w\">    </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">efi_bs_call</span><span class=\"p\">(</span><span class=\"n\">locate_protocol</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">boot_protocol_guid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span>\n</span><span id=\"__span-20-8\"><a id=\"__codelineno-20-8\" name=\"__codelineno-20-8\" href=\"#__codelineno-20-8\"></a><span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"p\">)</span><span class=\"o\">&amp;</span><span class=\"n\">boot_protocol</span><span class=\"p\">);</span>\n</span><span id=\"__span-20-9\"><a id=\"__codelineno-20-9\" name=\"__codelineno-20-9\" href=\"#__codelineno-20-9\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">EFI_SUCCESS</span><span class=\"p\">)</span>\n</span><span id=\"__span-20-10\"><a id=\"__codelineno-20-10\" name=\"__codelineno-20-10\" href=\"#__codelineno-20-10\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">;</span>\n</span><span id=\"__span-20-11\"><a id=\"__codelineno-20-11\" name=\"__codelineno-20-11\" href=\"#__codelineno-20-11\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">efi_call_proto</span><span class=\"p\">(</span><span class=\"n\">boot_protocol</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">get_boot_hartid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">hartid</span><span class=\"p\">);</span>\n</span><span id=\"__span-20-12\"><a id=\"__codelineno-20-12\" name=\"__codelineno-20-12\" href=\"#__codelineno-20-12\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u8fd9\u4e2a\u51fd\u6570\u5c31\u4f1a\u5728 UEFI \u56fa\u4ef6\u4e2d\u5b9e\u73b0\uff0c\u4f8b\u5982 <a href=\"https://github.com/tianocore/edk2/blob/f36e1ec1f0a5fd3be84913e09181d7813444b620/UefiCpuPkg/CpuDxeRiscV64/CpuDxe.c#L21-L45\">edk2</a>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-21-1\"><a id=\"__codelineno-21-1\" name=\"__codelineno-21-1\" href=\"#__codelineno-21-1\"></a><span class=\"cm\">/**</span>\n</span><span id=\"__span-21-2\"><a id=\"__codelineno-21-2\" name=\"__codelineno-21-2\" href=\"#__codelineno-21-2\"></a><span class=\"cm\">  Get the boot hartid</span>\n</span><span id=\"__span-21-3\"><a id=\"__codelineno-21-3\" name=\"__codelineno-21-3\" href=\"#__codelineno-21-3\"></a>\n</span><span id=\"__span-21-4\"><a id=\"__codelineno-21-4\" name=\"__codelineno-21-4\" href=\"#__codelineno-21-4\"></a><span class=\"cm\">  @param  This                   Protocol instance structure</span>\n</span><span id=\"__span-21-5\"><a id=\"__codelineno-21-5\" name=\"__codelineno-21-5\" href=\"#__codelineno-21-5\"></a><span class=\"cm\">  @param  BootHartId             Pointer to the Boot Hart ID variable</span>\n</span><span id=\"__span-21-6\"><a id=\"__codelineno-21-6\" name=\"__codelineno-21-6\" href=\"#__codelineno-21-6\"></a>\n</span><span id=\"__span-21-7\"><a id=\"__codelineno-21-7\" name=\"__codelineno-21-7\" href=\"#__codelineno-21-7\"></a><span class=\"cm\">  @retval EFI_SUCCESS            If BootHartId is returned</span>\n</span><span id=\"__span-21-8\"><a id=\"__codelineno-21-8\" name=\"__codelineno-21-8\" href=\"#__codelineno-21-8\"></a><span class=\"cm\">  @retval EFI_INVALID_PARAMETER  Either &quot;BootHartId&quot; is NULL or &quot;This&quot; is not</span>\n</span><span id=\"__span-21-9\"><a id=\"__codelineno-21-9\" name=\"__codelineno-21-9\" href=\"#__codelineno-21-9\"></a><span class=\"cm\">                                 a valid RISCV_EFI_BOOT_PROTOCOL instance.</span>\n</span><span id=\"__span-21-10\"><a id=\"__codelineno-21-10\" name=\"__codelineno-21-10\" href=\"#__codelineno-21-10\"></a>\n</span><span id=\"__span-21-11\"><a id=\"__codelineno-21-11\" name=\"__codelineno-21-11\" href=\"#__codelineno-21-11\"></a><span class=\"cm\">**/</span>\n</span><span id=\"__span-21-12\"><a id=\"__codelineno-21-12\" name=\"__codelineno-21-12\" href=\"#__codelineno-21-12\"></a><span class=\"n\">EFI_STATUS</span>\n</span><span id=\"__span-21-13\"><a id=\"__codelineno-21-13\" name=\"__codelineno-21-13\" href=\"#__codelineno-21-13\"></a><span class=\"n\">EFIAPI</span>\n</span><span id=\"__span-21-14\"><a id=\"__codelineno-21-14\" name=\"__codelineno-21-14\" href=\"#__codelineno-21-14\"></a><span class=\"n\">RiscvGetBootHartId</span><span class=\"w\"> </span><span class=\"p\">(</span>\n</span><span id=\"__span-21-15\"><a id=\"__codelineno-21-15\" name=\"__codelineno-21-15\" href=\"#__codelineno-21-15\"></a><span class=\"w\">  </span><span class=\"n\">IN</span><span class=\"w\"> </span><span class=\"n\">RISCV_EFI_BOOT_PROTOCOL</span><span class=\"w\">  </span><span class=\"o\">*</span><span class=\"n\">This</span><span class=\"p\">,</span>\n</span><span id=\"__span-21-16\"><a id=\"__codelineno-21-16\" name=\"__codelineno-21-16\" href=\"#__codelineno-21-16\"></a><span class=\"w\">  </span><span class=\"n\">OUT</span><span class=\"w\"> </span><span class=\"n\">UINTN</span><span class=\"w\">                   </span><span class=\"o\">*</span><span class=\"n\">BootHartId</span>\n</span><span id=\"__span-21-17\"><a id=\"__codelineno-21-17\" name=\"__codelineno-21-17\" href=\"#__codelineno-21-17\"></a><span class=\"w\">  </span><span class=\"p\">)</span>\n</span><span id=\"__span-21-18\"><a id=\"__codelineno-21-18\" name=\"__codelineno-21-18\" href=\"#__codelineno-21-18\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-21-19\"><a id=\"__codelineno-21-19\" name=\"__codelineno-21-19\" href=\"#__codelineno-21-19\"></a><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">gRiscvBootProtocol</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">BootHartId</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-21-20\"><a id=\"__codelineno-21-20\" name=\"__codelineno-21-20\" href=\"#__codelineno-21-20\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">EFI_INVALID_PARAMETER</span><span class=\"p\">;</span>\n</span><span id=\"__span-21-21\"><a id=\"__codelineno-21-21\" name=\"__codelineno-21-21\" href=\"#__codelineno-21-21\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n</span><span id=\"__span-21-22\"><a id=\"__codelineno-21-22\" name=\"__codelineno-21-22\" href=\"#__codelineno-21-22\"></a>\n</span><span id=\"__span-21-23\"><a id=\"__codelineno-21-23\" name=\"__codelineno-21-23\" href=\"#__codelineno-21-23\"></a><span class=\"w\">  </span><span class=\"o\">*</span><span class=\"n\">BootHartId</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mBootHartId</span><span class=\"p\">;</span>\n</span><span id=\"__span-21-24\"><a id=\"__codelineno-21-24\" name=\"__codelineno-21-24\" href=\"#__codelineno-21-24\"></a><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">EFI_SUCCESS</span><span class=\"p\">;</span>\n</span><span id=\"__span-21-25\"><a id=\"__codelineno-21-25\" name=\"__codelineno-21-25\" href=\"#__codelineno-21-25\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u4ee5\u53ca <a href=\"https://github.com/u-boot/u-boot/blob/2173c4a990664d8228d4dadd814bd64fdc12948f/lib/efi_loader/efi_riscv.c#L21-L44\">U-Boot</a>\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><span id=\"__span-22-1\"><a id=\"__codelineno-22-1\" name=\"__codelineno-22-1\" href=\"#__codelineno-22-1\"></a><span class=\"cm\">/**</span>\n</span><span id=\"__span-22-2\"><a id=\"__codelineno-22-2\" name=\"__codelineno-22-2\" href=\"#__codelineno-22-2\"></a><span class=\"cm\"> * efi_riscv_get_boot_hartid() - return boot hart ID</span>\n</span><span id=\"__span-22-3\"><a id=\"__codelineno-22-3\" name=\"__codelineno-22-3\" href=\"#__codelineno-22-3\"></a><span class=\"cm\"> * @this:       RISCV_EFI_BOOT_PROTOCOL instance</span>\n</span><span id=\"__span-22-4\"><a id=\"__codelineno-22-4\" name=\"__codelineno-22-4\" href=\"#__codelineno-22-4\"></a><span class=\"cm\"> * @boot_hartid:    caller allocated memory to return boot hart id</span>\n</span><span id=\"__span-22-5\"><a id=\"__codelineno-22-5\" name=\"__codelineno-22-5\" href=\"#__codelineno-22-5\"></a><span class=\"cm\"> * Return:      status code</span>\n</span><span id=\"__span-22-6\"><a id=\"__codelineno-22-6\" name=\"__codelineno-22-6\" href=\"#__codelineno-22-6\"></a><span class=\"cm\"> */</span>\n</span><span id=\"__span-22-7\"><a id=\"__codelineno-22-7\" name=\"__codelineno-22-7\" href=\"#__codelineno-22-7\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">efi_status_t</span><span class=\"w\"> </span><span class=\"n\">EFIAPI</span>\n</span><span id=\"__span-22-8\"><a id=\"__codelineno-22-8\" name=\"__codelineno-22-8\" href=\"#__codelineno-22-8\"></a><span class=\"n\">efi_riscv_get_boot_hartid</span><span class=\"p\">(</span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">riscv_efi_boot_protocol</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">this</span><span class=\"p\">,</span>\n</span><span id=\"__span-22-9\"><a id=\"__codelineno-22-9\" name=\"__codelineno-22-9\" href=\"#__codelineno-22-9\"></a><span class=\"w\">              </span><span class=\"n\">efi_uintn_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">boot_hartid</span><span class=\"p\">)</span>\n</span><span id=\"__span-22-10\"><a id=\"__codelineno-22-10\" name=\"__codelineno-22-10\" href=\"#__codelineno-22-10\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-22-11\"><a id=\"__codelineno-22-11\" name=\"__codelineno-22-11\" href=\"#__codelineno-22-11\"></a><span class=\"w\">    </span><span class=\"n\">EFI_ENTRY</span><span class=\"p\">(</span><span class=\"s\">&quot;%p, %p&quot;</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">this</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">boot_hartid</span><span class=\"p\">);</span>\n</span><span id=\"__span-22-12\"><a id=\"__codelineno-22-12\" name=\"__codelineno-22-12\" href=\"#__codelineno-22-12\"></a>\n</span><span id=\"__span-22-13\"><a id=\"__codelineno-22-13\" name=\"__codelineno-22-13\" href=\"#__codelineno-22-13\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">riscv_efi_boot_prot</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">boot_hartid</span><span class=\"p\">)</span>\n</span><span id=\"__span-22-14\"><a id=\"__codelineno-22-14\" name=\"__codelineno-22-14\" href=\"#__codelineno-22-14\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">EFI_EXIT</span><span class=\"p\">(</span><span class=\"n\">EFI_INVALID_PARAMETER</span><span class=\"p\">);</span>\n</span><span id=\"__span-22-15\"><a id=\"__codelineno-22-15\" name=\"__codelineno-22-15\" href=\"#__codelineno-22-15\"></a>\n</span><span id=\"__span-22-16\"><a id=\"__codelineno-22-16\" name=\"__codelineno-22-16\" href=\"#__codelineno-22-16\"></a><span class=\"w\">    </span><span class=\"o\">*</span><span class=\"n\">boot_hartid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">gd</span><span class=\"o\">-&gt;</span><span class=\"n\">arch</span><span class=\"p\">.</span><span class=\"n\">boot_hart</span><span class=\"p\">;</span>\n</span><span id=\"__span-22-17\"><a id=\"__codelineno-22-17\" name=\"__codelineno-22-17\" href=\"#__codelineno-22-17\"></a>\n</span><span id=\"__span-22-18\"><a id=\"__codelineno-22-18\" name=\"__codelineno-22-18\" href=\"#__codelineno-22-18\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">EFI_EXIT</span><span class=\"p\">(</span><span class=\"n\">EFI_SUCCESS</span><span class=\"p\">);</span>\n</span><span id=\"__span-22-19\"><a id=\"__codelineno-22-19\" name=\"__codelineno-22-19\" href=\"#__codelineno-22-19\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-22-20\"><a id=\"__codelineno-22-20\" name=\"__codelineno-22-20\" href=\"#__codelineno-22-20\"></a>\n</span><span id=\"__span-22-21\"><a id=\"__codelineno-22-21\" name=\"__codelineno-22-21\" href=\"#__codelineno-22-21\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">riscv_efi_boot_protocol</span><span class=\"w\"> </span><span class=\"n\">riscv_efi_boot_prot</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-22-22\"><a id=\"__codelineno-22-22\" name=\"__codelineno-22-22\" href=\"#__codelineno-22-22\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RISCV_EFI_BOOT_PROTOCOL_REVISION</span><span class=\"p\">,</span>\n</span><span id=\"__span-22-23\"><a id=\"__codelineno-22-23\" name=\"__codelineno-22-23\" href=\"#__codelineno-22-23\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">get_boot_hartid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">efi_riscv_get_boot_hartid</span>\n</span><span id=\"__span-22-24\"><a id=\"__codelineno-22-24\" name=\"__codelineno-22-24\" href=\"#__codelineno-22-24\"></a><span class=\"p\">};</span>\n</span></code></pre></div>", "image": null, "date_modified": "2023-10-01T00:00:00+00:00", "authors": [], "tags": ["boot", "linux", "os", "riscv", "uboot", "uefi"]}, {"id": "https://jia.je/software/2023/09/25/docker-rootless/", "url": "https://jia.je/software/2023/09/25/docker-rootless/", "title": "Podman \u548c Docker Rootless \u5b9e\u8df5", "content_html": "<h1 id=\"podman-\u548c-docker-rootless-\u5b9e\u8df5\">Podman \u548c Docker Rootless \u5b9e\u8df5<a class=\"headerlink\" href=\"#podman-\u548c-docker-rootless-\u5b9e\u8df5\" title=\"Permanent link\">&para;</a></h1>\n<p>\u6700\u8fd1\u5728\u914d\u7f6e\u516c\u7528\u673a\u5668\u7684\u73af\u5883\uff0c\u9700\u6c42\u662f\u5f88\u591a\u7528\u6237\u9700\u8981\u4f7f\u7528 docker\uff0c\u4f46\u662f\u4f17\u6240\u5468\u77e5\uff0c\u6709 docker \u6743\u9650\u5c31\u7b49\u4e8e\u6709\u4e86 root \u6743\u9650\uff0c\u56e0\u6b64\u6b63\u597d\u60f3\u5c1d\u8bd5\u4e00\u4e0b\u73b0\u5728\u7684 Rootless \u5bb9\u5668\u5316\u65b9\u6848\uff0c\u4f8b\u5982 docket rootless \u548c podman\u3002</p>\n<!-- more -->\n\n<h2 id=\"docker-rootless\">Docker Rootless<a class=\"headerlink\" href=\"#docker-rootless\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9996\u5148\u662f Docker\uff0c\u5b98\u65b9\u5df2\u7ecf\u652f\u6301 Rootless \u90e8\u7f72\uff0c\u6587\u6863\u5728 <a href=\"https://docs.docker.com/engine/security/rootless/\">https://docs.docker.com/engine/security/rootless/</a>\uff0c\u4f7f\u7528\u4e0a\u5206\u4e3a\u4e24\u6b65\uff1a</p>\n<ol>\n<li>\u7ba1\u7406\u5458\u7528 root \u6743\u9650\u914d\u7f6e\u597d\u5404\u9879\u4f9d\u8d56</li>\n<li>\u6bcf\u4e2a\u7528\u6237\u8dd1\u4e00\u6b21 setup \u811a\u672c\uff0c\u7136\u540e\u6b63\u5e38\u7528 docker</li>\n</ol>\n<p>\u7b2c\u4e00\u6b65\u5b89\u88c5 docker \u4e0d\u5fc5\u8d58\u8ff0\uff0c\u4e3a\u4e86 docker rootless\uff0c\u8fd8\u9700\u8981\u5b89\u88c5\u989d\u5916\u7684\u5305\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>uidmap<span class=\"w\"> </span>dbus-user-session<span class=\"w\"> </span>fuse-overlayfs<span class=\"w\"> </span>slirp4netns<span class=\"w\"> </span>docker-ce-rootless-extras\n</span></code></pre></div>\n<p>\u5efa\u8bae\u7528\u6bd4\u8f83\u65b0\u7684\u53d1\u884c\u7248\uff0c\u65e7\u53d1\u884c\u7248\u5bf9 docker rootless \u7684\u652f\u6301\u53ef\u80fd\u4f1a\u6bd4\u8f83\u5dee\u3002</p>\n<p>\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u6bcf\u4e2a\u7528\u6237\u81ea\u5df1\u6267\u884c\u4e00\u4e2a\u521d\u59cb\u5316\u811a\u672c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>dockerd-rootless-setuptool.sh<span class=\"w\"> </span>install\n</span></code></pre></div>\n<p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528 docker \u4e86\uff0c\u4ece <code>docker info</code> \u53ef\u4ee5\u770b\u5230\u76ee\u524d\u662f rootless \u6a21\u5f0f\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>docker<span class=\"w\"> </span>info<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>Context\n</span></code></pre></div>\n<p>\u66f4\u591a\u7684\u6ce8\u610f\u4e8b\u9879\u53ef\u4ee5\u770b Docker \u5b98\u65b9\u7684\u6587\u6863\u3002</p>\n<h3 id=\"gpu\">GPU<a class=\"headerlink\" href=\"#gpu\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5982\u679c\u60f3\u8981\u5728 Docker Rootless \u4e2d\u4f7f\u7528 NVIDIA GPU\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4f1a\u62a5\u9519\u7684\uff0c\u53ef\u4ee5\u53c2\u8003 <a href=\"https://stackoverflow.com/a/61489688/2148614\">GPU with rootless Docker</a> \u6587\u6863\u89e3\u51b3\u3002\u4fee\u6539\u6587\u4ef6\u540e\uff0c\u5c31\u4f1a\u53d1\u73b0\u53ef\u4ee5\u5728\u5bb9\u5668\u91cc\u4f7f\u7528 <code>nvidia-smi</code> \u4e86\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>docker<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>--gpus<span class=\"w\"> </span>all<span class=\"w\"> </span>debian<span class=\"w\"> </span>nvidia-smi\n</span></code></pre></div>\n<h2 id=\"podman-rootless\">Podman Rootless<a class=\"headerlink\" href=\"#podman-rootless\" title=\"Permanent link\">&para;</a></h2>\n<p>Podman Rootless \u7684\u5b98\u65b9\u6587\u6863\u5728 <a href=\"https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md\">https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md</a>\uff0c\u76f8\u6bd4 Docker\uff0cPodman Rootless \u914d\u7f6e\u66f4\u52a0\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u7528\u6237\u8fd0\u884c install \u811a\u672c\uff0c\u548c\u524d\u6587\u4e00\u6837\u914d\u7f6e\u597d\u4f9d\u8d56\u4ee5\u540e\uff0c\u76f4\u63a5\u8fd0\u884c podman \u5373\u53ef\u3002</p>\n<p>UPDATE: @Harry-Chen \u5efa\u8bae\uff1a\u5982\u679c\u8981\u89e3\u51b3 podman rootless \u4f1a\u4fdd\u5b58\u5f88\u591a\u4efd\u955c\u50cf\u5728\u5404\u4e2a\u7528\u6237\u7684 home \u76ee\u5f55\u4e0b\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u5168\u5c40\u7684\u955c\u50cf\u8def\u5f84\uff0c\u89c1 <a href=\"https://www.redhat.com/sysadmin/image-stores-podman\">Exploring additional image stores in Podman</a>\uff0c\u6216\u8005\u4f7f\u7528 FS\uff08\u5982 ZFS\uff09\u7684 Dedup \u529f\u80fd\u3002</p>\n<h3 id=\"gpu_1\">GPU<a class=\"headerlink\" href=\"#gpu_1\" title=\"Permanent link\">&para;</a></h3>\n<p>\u8981\u5728 Podman Rootless \u4e2d\u4f7f\u7528 NVIDIA GPU\uff0c\u4e5f\u9700\u8981\u50cf\u4e0a\u9762 Docker \u90a3\u6837\uff0c\u4fee\u6539\u914d\u7f6e <code>no-cgroups=true</code>\uff0c\u7136\u540e\u6309\u7167 <a href=\"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/cdi-support.html\">Support for Container Device Interface</a> \u914d\u7f6e <a href=\"https://github.com/cncf-tags/container-device-interface\">Container Device Interface</a>\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>sudo<span class=\"w\"> </span>nvidia-ctk<span class=\"w\"> </span>cdi<span class=\"w\"> </span>generate<span class=\"w\"> </span>--output<span class=\"o\">=</span>/etc/cdi/nvidia.yaml\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>nvidia-ctk<span class=\"w\"> </span>cdi<span class=\"w\"> </span>list\n</span></code></pre></div>\n<p>\u6b64\u65f6\u5c31\u4f1a\u751f\u6210 <code>/etc/cdi/nvidia.yaml</code> \u914d\u7f6e\u6587\u4ef6\uff0c\u91cc\u9762\u662f\u4e3a\u4e86\u8ba9\u5bb9\u5668\u53ef\u4ee5\u7528 NVIDIA GPU \u6240\u9700\u8981\u7684\u914d\u7f6e\u3002\u5982\u679c\u60f3\u5728 podman \u91cc\u4f7f\u7528 NVIDIA GPU\uff0c\u8fd0\u884c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>--device<span class=\"w\"> </span>nvidia.com/gpu<span class=\"o\">=</span>all<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian<span class=\"w\"> </span>nvidia-smi\n</span></code></pre></div>\n<p>\u5982\u679c Podman \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u53ef\u80fd\u4f1a\u9047\u5230 <code>nvidia-smi not found</code> \u7684\u95ee\u9898\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u867d\u7136 Podman \u4ece <a href=\"https://github.com/containers/podman/blob/main/RELEASE_NOTES.md#320\">3.2.0</a> \u7248\u672c\u5f00\u59cb\u652f\u6301 Container Device Interface\u3002\u4f46\u662f\u5982\u679c nvidia container \u7248\u672c\u6bd4\u8f83\u65b0\uff0c\u751f\u6210\u4e86 0.5.0 \u7248\u672c\u7684 CDI Spec\uff0c\u5c31\u9700\u8981\u6bd4\u8f83\u65b0\u7684 Podman \u7248\u672c\uff08\u5927\u6982 4.1.0 \u4ee5\u540e\uff09\u3002\u5b9e\u9645\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0cUbuntu 22.04 \u6253\u5305\u7684 Podman 3.4.4 \u7248\u672c\u4e0d\u591f\u65b0\uff0c\u53ef\u4ee5\u6309\u7167 <a href=\"https://podman.io/docs/installation#ubuntu\">Podman Installation Instrucions</a> \u6587\u6863\u5b89\u88c5\u6700\u65b0\u7684 Podman 4.6.2\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>sudo<span class=\"w\"> </span>mkdir<span class=\"w\"> </span>-p<span class=\"w\"> </span>/etc/apt/keyrings\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a>curl<span class=\"w\"> </span>-fsSL<span class=\"w\"> </span><span class=\"s2\">&quot;https://download.opensuse.org/repositories/devel:kubic:libcontainers:unstable/xUbuntu_</span><span class=\"k\">$(</span>lsb_release<span class=\"w\"> </span>-rs<span class=\"k\">)</span><span class=\"s2\">/Release.key&quot;</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">  </span><span class=\"p\">|</span><span class=\"w\"> </span>gpg<span class=\"w\"> </span>--dearmor<span class=\"w\"> </span><span class=\"se\">\\</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">  </span><span class=\"p\">|</span><span class=\"w\"> </span>sudo<span class=\"w\"> </span>tee<span class=\"w\"> </span>/etc/apt/keyrings/devel_kubic_libcontainers_unstable.gpg<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>/dev/null\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">  </span><span class=\"s2\">&quot;deb [arch=</span><span class=\"k\">$(</span>dpkg<span class=\"w\"> </span>--print-architecture<span class=\"k\">)</span><span class=\"s2\"> signed-by=/etc/apt/keyrings/devel_kubic_libcontainers_unstable.gpg]\\</span>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"s2\">    https://download.opensuse.org/repositories/devel:kubic:libcontainers:unstable/xUbuntu_</span><span class=\"k\">$(</span>lsb_release<span class=\"w\"> </span>-rs<span class=\"k\">)</span><span class=\"s2\">/ /&quot;</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">  </span><span class=\"p\">|</span><span class=\"w\"> </span>sudo<span class=\"w\"> </span>tee<span class=\"w\"> </span>/etc/apt/sources.list.d/devel:kubic:libcontainers:unstable.list<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>/dev/null\n</span><span id=\"__span-6-9\"><a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>update<span class=\"w\"> </span>-qq\n</span><span id=\"__span-6-10\"><a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>-qq<span class=\"w\"> </span>-y<span class=\"w\"> </span>install<span class=\"w\"> </span>podman\n</span></code></pre></div>\n<p>\u66f4\u65b0 podman \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u5bb9\u5668\u91cc\u4f7f\u7528 NVIDIA GPU\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>--device<span class=\"w\"> </span>nvidia.com/gpu<span class=\"o\">=</span>all<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian<span class=\"w\"> </span>nvidia-smi\n</span></code></pre></div>\n<p>\u6ce8\uff1a\u7f51\u4e0a\u53ef\u4ee5\u67e5\u5230\u4e00\u4e9b podman \u7528 nvidia gpu \u7684\u6559\u7a0b\uff0c\u4f7f\u7528\u7684\u662f\u65e7\u7684 oci hooks \u673a\u5236\uff0c\u53ef\u80fd\u5728\u65b0\u7248\u672c\u7cfb\u7edf\u4e0a\u65e0\u6cd5\u5de5\u4f5c\uff0c\u9700\u8981\u6309\u7167\u4e0a\u9762\u63d0\u793a\u7684 Container Device Interface \u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\u3002\u65b0\u7684 nvidia-container-toolkit \u5305\u5df2\u7ecf\u4e0d\u5305\u542b oci hooks \u914d\u7f6e\uff0c\u6240\u4ee5\u5efa\u8bae\u7528\u4e0a\u9762\u7684\u65b0\u4f7f\u7528\u65b9\u6cd5\u3002</p>\n<h2 id=\"\u603b\u7ed3\">\u603b\u7ed3<a class=\"headerlink\" href=\"#\u603b\u7ed3\" title=\"Permanent link\">&para;</a></h2>\n<p>\u603b\u800c\u8a00\u4e4b\uff0c\u5728\u6bd4\u8f83\u65b0\u7684\u53d1\u884c\u7248\u91cc\uff0c\u65e0\u8bba\u662f docker \u8fd8\u662f podman\uff0c\u5176 rootless \u90fd\u5df2\u7ecf\u6bd4\u8f83\u6210\u719f\uff0c\u5efa\u8bae\u5728\u5171\u4eab\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\uff0c\u51cf\u5c11 rootful docker \u7684\u4f7f\u7528\u3002\u76ee\u524d nvidia gpu \u7684\u652f\u6301\u65b9\u9762\uff0cdocker \u6bd4\u8f83\u6613\u7528\uff0cpodman \u8fd8\u9700\u8981\u6bd4\u8f83\u591a\u7684\u914d\u7f6e\uff0c\u4ee5\u53ca\u8db3\u591f\u65b0\u7684\u7248\u672c\u3002</p>\n<p>\u6d4b\u8bd5\u73af\u5883\uff1a</p>\n<ul>\n<li>Ubuntu 22.04 + <a href=\"https://build.opensuse.org/package/show/devel:kubic:libcontainers:unstable/podman\">Kubic repo</a></li>\n<li>docker 23.0.4</li>\n<li>containerd 1.6.16</li>\n<li>runc 1.1.4</li>\n<li>slirp4netns 1.2.2</li>\n<li>fuse-overlayfs 1.13</li>\n<li>crun 1.9</li>\n<li>podman 4.6.2</li>\n</ul>", "image": null, "date_modified": "2023-09-25T00:00:00+00:00", "authors": [], "tags": ["docker", "podman", "rootless", "software"]}, {"id": "https://jia.je/system/2023/08/11/openbmc-qemu/", "url": "https://jia.je/system/2023/08/11/openbmc-qemu/", "title": "\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC", "content_html": "<h1 id=\"\u5728-qemu-\u4e2d\u8fd0\u884c-openbmc\">\u5728 QEMU \u4e2d\u8fd0\u884c OpenBMC<a class=\"headerlink\" href=\"#\u5728-qemu-\u4e2d\u8fd0\u884c-openbmc\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u8fd1\u60f3\u7ed9\u67d0\u53f0\u673a\u5668\u914d\u4e00\u4e2a BMC\uff0c\u4e8e\u662f\u8c03\u7814 OpenBMC \u53d1\u884c\u7248\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u627e\u5230\u53ef\u4ee5\u4e70\u5230\u7684\u5408\u9002\u7684 BMC\uff0c\u56e0\u6b64\u5148\u5728\u865a\u62df\u673a\u4e2d\u8fdb\u884c\u5c1d\u8bd5\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u8fc7\u7a0b\">\u8fc7\u7a0b<a class=\"headerlink\" href=\"#\u8fc7\u7a0b\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8fd0\u884c\u8fc7\u7a0b\u53c2\u8003\u5b98\u65b9\u7684 <a href=\"https://github.com/openbmc/docs/blob/master/development/dev-environment.md\">OpenBMC Development Environment</a> \u6587\u6863\u8fdb\u884c\uff0c\u9996\u5148\u5b89\u88c5\u4f9d\u8d56\u548c\u514b\u9686\u4ed3\u5e93\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>git<span class=\"w\"> </span>python3-distutils<span class=\"w\"> </span>gcc<span class=\"w\"> </span>g++<span class=\"w\"> </span>make<span class=\"w\"> </span>file<span class=\"w\"> </span>wget<span class=\"w\"> </span><span class=\"se\">\\</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">    </span>gawk<span class=\"w\"> </span>diffstat<span class=\"w\"> </span>bzip2<span class=\"w\"> </span>cpio<span class=\"w\"> </span>chrpath<span class=\"w\"> </span>zstd<span class=\"w\"> </span>lz4<span class=\"w\"> </span>bzip2\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>git@github.com:openbmc/openbmc.git\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>openbmc\n</span></code></pre></div>\n<h3 id=\"romulus\">romulus<a class=\"headerlink\" href=\"#romulus\" title=\"Permanent link\">&para;</a></h3>\n<p>\u63a5\u7740\uff0c\u7f16\u8bd1\u9488\u5bf9 romulus BMC \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>.<span class=\"w\"> </span>setup<span class=\"w\"> </span>romulus\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>bitbake<span class=\"w\"> </span>obmc-phosphor-image\n</span></code></pre></div>\n<p>\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u7f16\u8bd1\u597d\u7684 32MB \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>ls<span class=\"w\"> </span>-al<span class=\"w\"> </span>tmp/deploy/images/romulus/obmc-phosphor-image-romulus.static.mtd\n</span></code></pre></div>\n<p>\u6574\u4e2a\u6784\u5efa\u5b8c\u7528\u4e86 27 GB \u7684\u78c1\u76d8\u7a7a\u95f4\u3002</p>\n<p>\u63a5\u7740\uff0c\u4e0d\u9700\u8981\u6309\u7167\u6587\u6863\u91cc\u7684\u65b9\u6cd5\u53bb\u7528 qemu fork\uff0c\u800c\u662f\u76f4\u63a5\u53ef\u4ee5\u7528\u7cfb\u7edf\u81ea\u5e26\u7684\u4e0a\u6e38\u7248 qemu \u542f\u52a8\u865a\u62df\u673a\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>qemu-system-arm<span class=\"w\"> </span>-m<span class=\"w\"> </span><span class=\"m\">256</span><span class=\"w\"> </span>-M<span class=\"w\"> </span>romulus-bmc<span class=\"w\"> </span>-nographic<span class=\"w\"> </span>-drive<span class=\"w\"> </span><span class=\"nv\">file</span><span class=\"o\">=</span>./obmc-phosphor-image-romulus.static.mtd,format<span class=\"o\">=</span>raw,if<span class=\"o\">=</span>mtd<span class=\"w\"> </span>-net<span class=\"w\"> </span>nic<span class=\"w\"> </span>-net<span class=\"w\"> </span>user,hostfwd<span class=\"o\">=</span>:127.0.0.1:2222-:22,hostfwd<span class=\"o\">=</span>:127.0.0.1:2443-:443,hostfwd<span class=\"o\">=</span>udp:127.0.0.1:2623-:623,hostname<span class=\"o\">=</span>qemu\n</span></code></pre></div>\n<p>\u8fd9\u6837\u5c31\u628a SSH\uff0cHTTPS \u548c IPMI \u8f6c\u53d1\u5230\u672c\u673a\u4e0a\u4e86\uff0c\u53ef\u4ee5\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u7528\u6237\u662f root\uff0c\u9ed8\u8ba4\u5bc6\u7801\u662f 0penBmc\u3002</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>ssh<span class=\"w\"> </span>root@localhost<span class=\"w\"> </span>-p<span class=\"w\"> </span><span class=\"m\">2222</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>ipmitool<span class=\"w\"> </span>-I<span class=\"w\"> </span>lanplus<span class=\"w\"> </span>-H<span class=\"w\"> </span><span class=\"m\">127</span>.0.0.1<span class=\"w\"> </span>-U<span class=\"w\"> </span>root<span class=\"w\"> </span>-P<span class=\"w\"> </span>0penBmc<span class=\"w\"> </span>-p<span class=\"w\"> </span><span class=\"m\">2623</span><span class=\"w\"> </span>mc<span class=\"w\"> </span>info\n</span></code></pre></div>\n<p>\u8fd9\u4e5f\u662f\u7528 OpenBMC \u7684\u4e00\u5927\u597d\u5904\uff1a\u6709\u771f\u6b63\u7684 SSH \u53ef\u4ee5\u7528\uff0c\u53ef\u4ee5\u770b\u5230\u5185\u90e8\u7684\u60c5\u51b5\u3002\u901a\u8fc7 uname \u53ef\u4ee5\u770b\u5230\uff0c\u6a21\u62df\u7684\u5904\u7406\u5668\u67b6\u6784\u662f armv6l\uff0c\u8fd8\u662f\u6bd4\u8f83\u65e7\u7684\u3002\u6839\u636e <a href=\"https://www.qemu.org/docs/master/system/arm/aspeed.html\">QEMU \u6587\u6863</a>\uff0cromulus \u662f\u57fa\u4e8e AST2500 \u7684 OpenPOWER Romulus POWER9 BMC\u3002AST2500 \u91c7\u7528\u7684\u662f 800MHz ARM11 \u6838\u5fc3\uff0c\u786e\u5b9e\u662f\u6bd4\u8f83\u8001\u4e86\u3002</p>\n<h3 id=\"ast2600\">AST2600<a class=\"headerlink\" href=\"#ast2600\" title=\"Permanent link\">&para;</a></h3>\n<p>\u63a5\u4e0b\u6765\u8bd5\u8bd5\u57fa\u4e8e Cortex-A7 \u7684 AST2600\uff0c\u6784\u5efa evb-ast2600 target\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>openbmc\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>.<span class=\"w\"> </span>setup<span class=\"w\"> </span>evb-ast2600\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>bitbake<span class=\"w\"> </span>obmc-phosphor-image\n</span></code></pre></div>\n<p>\u8fd9\u6b21\u4e5f\u7f16\u8bd1\u51fa\u4e86\u4e00\u4e2a 64MB \u7684\u7cfb\u7edf\u955c\u50cf\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>ls<span class=\"w\"> </span>-al<span class=\"w\"> </span>tmp/deploy/images/evb-ast2600/obmc-phosphor-image-evb-ast2600.static.mtd\n</span></code></pre></div>\n<p>\u5728 qemu \u4e2d\u8fd0\u884c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>qemu-system-arm<span class=\"w\"> </span>-m<span class=\"w\"> </span><span class=\"m\">1024</span><span class=\"w\"> </span>-M<span class=\"w\"> </span>ast2600-evb<span class=\"w\"> </span>-nographic<span class=\"w\"> </span>-drive<span class=\"w\"> </span><span class=\"nv\">file</span><span class=\"o\">=</span>./obmc-phosphor-image-evb-ast2600.static.mtd,format<span class=\"o\">=</span>raw,if<span class=\"o\">=</span>mtd<span class=\"w\"> </span>-net<span class=\"w\"> </span>nic<span class=\"w\"> </span>-net<span class=\"w\"> </span>user,hostfwd<span class=\"o\">=</span>:127.0.0.1:2222-:22,hostfwd<span class=\"o\">=</span>:127.0.0.1:2443-:443,hostfwd<span class=\"o\">=</span>udp:127.0.0.1:2623-:623,hostname<span class=\"o\">=</span>qemu\n</span></code></pre></div>\n<p>\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u53ef\u4ee5\u901a\u8fc7 SSH\uff0cHTTPS \u548c IPMI \u8bbf\u95ee\uff0c\u4f46\u662f\u6ca1\u6709 WebUI\uff0c\u53ea\u6709 redfish\u3002\u8fdb\u7cfb\u7edf\u4ee5\u540e\u53ef\u4ee5\u770b\u5230 uname \u7684\u67b6\u6784\u53d8\u6210\u4e86 armv7l\u3002</p>\n<p>\u6b64\u65f6\u6309\u7167 <a href=\"https://blog.csdn.net/Datapad/article/details/125929179\">\u3010OpenBMC \u7cfb\u5217\u30114.\u542f\u52a8\u6d41\u7a0b \u4f7f\u7528 qume \u6a21\u62df ast2600-evb</a> \u7684\u6587\u6863\uff0c\u7ed9 ast2600-evb target \u52a0\u4e0a webui\uff1a</p>\n<p>\u8fdb\u5165 openbmc \u76ee\u5f55\uff0c\u7f16\u8f91 <code>build/evb-ast2600/conf/local.conf</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>CORE_IMAGE_EXTRA_INSTALL  += &quot;webui-vue&quot;\n</span></code></pre></div>\n<p>\u7f16\u8f91 <code>meta-phosphor/recipes-phosphor/images/obmc-phosphor-image.bbapend</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>OBMC_IMAGE_EXTRA_INSTALL_${MACHINE} += &quot;webui-vue&quot;\n</span></code></pre></div>\n<p>\u6ce8\uff1aCSDN \u6587\u7ae0\u91cc\u8def\u5f84\u6253\u9519\u4e86\uff0cimage \u5e94\u8be5\u4e3a images\u3002</p>\n<p>\u7f16\u8f91 <code>meta-phosphor/recipes-phosphor/packagegroups/packagegroup-obmc-apps.bbappend</code>\uff0c\u6dfb\u52a0\u4e00\u884c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a>RDEPENDS_${PN}-inventory_${MACHINE} += &quot;webui-vue&quot;\n</span></code></pre></div>\n<p>\u6ce8\uff1aromulus \u53ef\u4ee5\u5de5\u4f5c\u662f\u56e0\u4e3a\u5728 <code>meta-ibm/meta-romulus/recipes-phosphor/packagegroups/packagegroup-obmc-apps.bbappend</code> \u91cc\u9762\u6709 <code>RDEPENDS:${PN}-extras:append:romulus = \" webui-vue phosphor-image-signing\"</code>\u3002</p>\n<p>\u91cd\u65b0\u6784\u5efa\u7cfb\u7edf\u955c\u50cf\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>openbmc\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a>.<span class=\"w\"> </span>setup<span class=\"w\"> </span>evb-ast2600\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a>bitbake<span class=\"w\"> </span>obmc-phosphor-image<span class=\"w\"> </span>-c<span class=\"w\"> </span>clean\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a>bitbake<span class=\"w\"> </span>obmc-phosphor-image\n</span></code></pre></div>\n<p>\u6b64\u65f6\u5c31\u4f1a\u628a webui-vue \u4e5f\u6784\u5efa\u8fdb\u53bb\uff0c\u518d\u6b21\u542f\u52a8 QEMU \u7684\u65f6\u5019\u5c31\u6709 WebUI \u4e86\u3002</p>", "image": null, "date_modified": "2023-08-11T00:00:00+00:00", "authors": [], "tags": ["bmc", "openbmc", "qemu", "system"]}, {"id": "https://jia.je/hardware/2023/08/10/diy-ls3a6000-machine/", "url": "https://jia.je/hardware/2023/08/10/diy-ls3a6000-machine/", "title": "\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a", "content_html": "<h1 id=\"\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af-3a6000-cpu-\u7684\u4e3b\u673a\">\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af 3A6000 CPU \u7684\u4e3b\u673a<a class=\"headerlink\" href=\"#\u7ec4\u88c5\u4e00\u53f0\u91c7\u7528\u9f99\u82af-3a6000-cpu-\u7684\u4e3b\u673a\" title=\"Permanent link\">&para;</a></h1>\n<h2 id=\"\u80cc\u666f\">\u80cc\u666f<a class=\"headerlink\" href=\"#\u80cc\u666f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6700\u8fd1\u4e70\u5230\u4e86\u9f99\u82af 3A6000 \u4ee5\u53ca\u914d\u5957\u4e3b\u677f\uff0c\u5728\u6b64\u8bb0\u5f55\u6211\u7ec4\u88c5\u53f0\u5f0f\u673a\u7684\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u5728\u5176\u4e0a\u7684\u4f53\u9a8c\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u8d2d\u4e70\">\u8d2d\u4e70<a class=\"headerlink\" href=\"#\u8d2d\u4e70\" title=\"Permanent link\">&para;</a></h2>\n<p>\u7ec4\u88c5\u7684\u7b2c\u4e00\u6b65\u662f\u8d2d\u4e70\u5404\u4e2a\u914d\u4ef6\uff0c\u6211\u4e70\u4e86\u5982\u4e0b\u7684\u914d\u4ef6\uff1a</p>\n<ol>\n<li>\u4e3b\u677f + CPU\uff1aLoongson-3A6000-7A2000-1w-V0.1-EVB\uff08LS3A6000-7A2000-1w-EVB-V1.21\uff0cXA612A0_V1.1\uff09\uff0c\u6682\u672a\u6b63\u5f0f\u4e0a\u5e02</li>\n<li>\u5185\u5b58\uff1aKingston HyperX HX426C16FB3/8 8GB\uff0c169 \u5143</li>\n<li>\u663e\u5361\uff1aAMD RADEON RX550 4G 379 \u5143</li>\n<li>\u65e0\u7ebf\u7f51\u5361\uff1aIntel AX200 79 \u5143</li>\n<li>\u786c\u76d8\uff1a\u81f4\u6001 TiPlus5000 Gen3 1TB\uff0c369 \u5143</li>\n<li>\u673a\u7bb1\uff1a\u7231\u56fd\u8005 A15 ATX\uff0c100 \u5143</li>\n<li>\u7535\u6e90\uff1a\u7231\u56fd\u8005 DK \u7cfb\u5217 500W\uff0c149 \u5143</li>\n</ol>\n<p>\u9664\u4e86\u4e3b\u677f\u548c CPU \u4ee5\u5916\u603b\u4ef7\u4e00\u5343\u51fa\u5934\u3002<del>\u76ee\u524d\u4e3b\u677f\u548c CPU \u8fd8\u6ca1\u6709\u6b63\u5f0f\u4e0a\u5e02\uff0c\u6309\u7167 3A5000 \u73b0\u5728\u7684\u4ef7\u683c\u7684\u4f30\u8ba1\u7684\u8bdd\u5927\u6982\u4e5f\u662f\u4e00\u5343\u591a\uff0c\u52a0\u8d77\u6765\u6574\u673a\u4e0d\u5230\u4e09\u5343\u3002\u5f53\u7136\u4e86\uff0c\u73b0\u5728 3A6000 \u624d\u521a\u51fa\u6765\uff0c\u6240\u4ee5\u6211\u4e70\u7684\u4ef7\u683c\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u4f46\u81ea\u5df1\u7ec4\u88c5\u4e5f\u80fd\u7701\u4e0b\u6765\u4e0d\u5c11\u94b1\u3002</del> 3A6000 \u5df2\u7ecf\u6b63\u5f0f\u4e0a\u5e02\u3002</p>\n<p>\u5b9e\u9645\u4e0a\u8fd9\u91cc\u7535\u6e90\u4e70\u7684\u504f\u5927\u4e86\uff0c\u4e0d\u8fc7 400W \u548c 500W \u4e5f\u53ea\u5dee 20 \u5757\u94b1\uff0c\u5c31\u6109\u5feb\u5730\u52a0\u4ef7\u4e86\u3002</p>\n<h3 id=\"\u5185\u5b58\u517c\u5bb9\u6027\">\u5185\u5b58\u517c\u5bb9\u6027<a class=\"headerlink\" href=\"#\u5185\u5b58\u517c\u5bb9\u6027\" title=\"Permanent link\">&para;</a></h3>\n<p>\u6211\u6d4b\u8bd5\u7684\u5185\u5b58\u6761\uff1a</p>\n<ol>\n<li>Kingston HyperX <a href=\"https://www.kingston.com/dataSheets/HX426C16FB3_8.pdf\">HX426C16FB3/8</a>(KHX2666C16/8G) 8GB DDR4-2666(PnP) 1Rx8\uff1a\u652f\u6301\uff0c\u80fd\u8fbe\u5230 2600 MT/s</li>\n<li>Kingston HyperX <a href=\"https://www.kingston.com/dataSheets/KF432C16BB_8.pdf\">KF432C16BB/8</a>(KF3200C16D4/8GX) 8GB DDR4-2400(JEDEC) 1Rx8\uff1a\u652f\u6301\uff0c\u80fd\u8fbe\u5230 2400 MT/s</li>\n<li><a href=\"https://www.kingbank.com/cn/h-pd-11.html\">\u91d1\u767e\u8fbe\uff08KingBank\uff09\u94f6\u7235 \u957f\u946b\u9897\u7c92 DDR4 3200MHz\uff08\u5b9e\u9645\u662f MT/s\uff0cJEDEC 2666\uff0916GB U-DIMM 1.35V CL 16</a>\uff1a<del>\u4e0d\u652f\u6301</del> \u56fa\u4ef6 V4.0.05634 \u652f\u6301\uff0c\u80fd\u8fbe\u5230 2600 MT/s</li>\n<li>\u7d2b\u5149 SCC16GP02H1F1C-26V 16GB 2666 ECC\uff1a\u4e0d\u652f\u6301</li>\n<li>\u7d2b\u5149 SCC32GP12H1F1C-26V 32GB 2666 ECC: \u4e0d\u652f\u6301</li>\n</ol>\n<p>\u5173\u4e8e 2600 MT/s vs 2666 MT/s \u7684\u95ee\u9898\uff1a\u4ece Memory PLL \u6765\u770b\uff0c\u662f 100 MHz \u7684\u9891\u7387\u901a\u8fc7 PLL \u5f97\u5230 1300 MHz\uff0c\u786e\u5b9e\u662f 2600 MT/s\uff0c\u4e0d\u8fc7\u5f53\u6210 2666 \u6765\u7528\u4e5f\u662f\u4e00\u6837\u7684\u3002</p>\n<p>\u7f51\u53cb\u8868\u793a\u5728 3A6000 \u4e0a\u53ef\u4ee5\u5de5\u4f5c\u7684\u5185\u5b58\u578b\u53f7\uff1a</p>\n<ol>\n<li>\u4e09\u661f M393A4G43AB3-CWEGY 32GB 2Rx8 PC4-3200AA-RE3-12-R80 RDIMM</li>\n<li>\u7d2b\u5149 <a href=\"https://www.unisemicon.com/uploadfile/2023/0228/20230228015641612.pdf\">SCC16GU03H2F1C-32AA</a> 16GB 1Rx8 PC4-3200U-22-22-22</li>\n<li>\u7d2b\u5149 SCE08GU04APA-32 8GB 1Rx16 PC4-3200U-22-22-22</li>\n<li>\u7d2b\u5149 SCE16GU03BPB-32 16GB 1Rx8 PC4-3200U-22-22-22</li>\n</ol>\n<p>\u7f51\u53cb\u8868\u793a\u5728 3A5000 \u4e0a\u53ef\u4ee5\u5de5\u4f5c\u7684\u5185\u5b58\u578b\u53f7\uff1a</p>\n<ol>\n<li>\u7d2b\u5149 <a href=\"https://www.unisemicon.com/uploadfile/2023/0228/20230228015608788.pdf\">SCC08GU03H3F1C-32AA</a> 8G UDIMM PC4-3200</li>\n<li>\u7d2b\u5149 <a href=\"https://www.unisemicon.com/uploadfile/2023/0228/20230228015735338.pdf\">SCC16GU03H4F1C-32AA</a> 16G UDIMM PC4-3200</li>\n</ol>\n<p>\u6ce8\uff1a\u517c\u5bb9\u6027\u968f UEFI \u56fa\u4ef6\u7248\u672c\u548c\u786c\u4ef6\u7248\u672c\u4e0d\u540c\u53ef\u80fd\u4e0d\u540c\uff0c\u56e0\u6b64\u8bfb\u8005\u9047\u5230\u4e0d\u540c\u7684\u517c\u5bb9\u6027\u60c5\u51b5\u4e5f\u662f\u53ef\u80fd\u7684\u3002\u6211\u76ee\u524d\u4f7f\u7528\u7684 UEFI \u56fa\u4ef6\u7248\u672c\u662f Loongson-UDK2018-V4.0.05420-stable202302\u3002</p>\n<h3 id=\"\u663e\u5361\u517c\u5bb9\u6027\">\u663e\u5361\u517c\u5bb9\u6027<a class=\"headerlink\" href=\"#\u663e\u5361\u517c\u5bb9\u6027\" title=\"Permanent link\">&para;</a></h3>\n<p>\u6211\u6d4b\u8bd5\u7684\u663e\u5361\uff1a</p>\n<ol>\n<li>AMD RX550\uff1a\u53ef\u7528</li>\n<li>AMD RX6400\uff1a<del>\u4e0d\u53ef\u7528\uff0c\u89c1\u4e0d\u5230 BIOS \u754c\u9762</del> \u66f4\u65b0\u56fa\u4ef6\u5e76\u5173\u95ed GPU Emulation \u540e\uff0c\u5728 BIOS \u4e0d\u53ef\u7528\uff0c\u4f46\u662f\u53ef\u4ee5\u8fdb Linux \u4ee5\u540e\u7528</li>\n</ol>\n<p>\u5728\u6211\u8fd9\u91cc\u4e3b\u677f\u4e0a\u7684 HDMI \u4e0d\u5de5\u4f5c\uff0c\u53ea\u6709\u72ec\u663e AMD RX550 \u7684 HDMI \u53ef\u4ee5\u5de5\u4f5c\uff0c\u4e0d\u786e\u5b9a\u662f\u5426\u548c 4K \u663e\u793a\u5668\u6709\u5173\u3002\u53e6\u5916\u6709\u7f51\u53cb\u8868\u793a\u4e3b\u677f\u4e0a\u7684 VGA \u53ef\u4ee5\u5de5\u4f5c\u3002\u56fa\u4ef6\u7248\u672c\u662f Loongson-UDK2018-V4.0.05420-stable202302\u3002</p>\n<p>UPDATE\uff1a\u66f4\u65b0\u56fa\u4ef6\u5230 Loongson-UDK2018-V4.0.05494-stable202305 \u4ee5\u540e\uff0c\u4e3b\u677f\u4e0a\u7684 HDMI \u4e5f\u5de5\u4f5c\u4e86\uff1a\u5177\u4f53\u5730\u8bb2\uff0c\u662f\u5728 VGA \u4e0b\u65b9\u7684 HDMI\u3002</p>\n<p>UPDATE\uff1a\u66f4\u65b0\u56fa\u4ef6\u5230 UDK2018-3A6000-7A2000_EVB_V4.0.05634_prestable2311dbg.fd \u4ee5\u540e\uff0c\u5173\u95ed GPU Emulation \u9009\u9879\uff0cAMD RX6400 \u4e5f\u53ef\u7528\u4e86\uff0c\u53ea\u4e0d\u8fc7\u5728\u56fa\u4ef6\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u8f93\u51fa\u5230\u4e3b\u677f\u4e0a\u7684 HDMI\uff0c\u89c1 <a href=\"https://github.com/loongson/Firmware/pull/79\">3A6000: Add EVB_XA61200 Board Support</a>\u3002</p>\n<p>\u5907\u6ce8\uff1a\u5df2\u77e5\u7684\u56fa\u4ef6\u7248\u672c\uff1a</p>\n<ul>\n<li>V4.0.05420-stable202302\uff1a\u9884\u88c5\u7248\u672c</li>\n<li>V4.0.05494-stable202305\uff1a\u4fee\u590d\u4e86\u4e3b\u677f\u4e0a\u7684 HDMI \u7684\u95ee\u9898\uff0c\u4fee\u590d\u4e86 ACPI PPTT \u8868</li>\n<li>V4.0.05569-stable202308\uff1a\u89c1\u4e8e <a href=\"https://gitea.whlug.cn/3A6000/3A6000/releases\">gitea whlug</a></li>\n<li>V4.0.05634-stable202308\uff1a\u6dfb\u52a0 GPU Emu Disable \u9009\u9879\u4ee5\u89e3\u51b3 AMD RX6400 \u7684\u95ee\u9898</li>\n</ul>\n<h2 id=\"linux-\u53d1\u884c\u7248\">Linux \u53d1\u884c\u7248<a class=\"headerlink\" href=\"#linux-\u53d1\u884c\u7248\" title=\"Permanent link\">&para;</a></h2>\n<p>\u76ee\u524d\u67e5\u5230\u7684\u652f\u6301 LoongArch \u7684\u53d1\u884c\u7248\u6709\uff1a</p>\n<ul>\n<li>AOSC OS: \u6709 LiveCD\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709 DeployKit\uff0c\u53ef\u4ee5\u7528\u89e3\u538b base tarball \u7684\u65b9\u6cd5\u5b89\u88c5</li>\n<li>LoongArchLinux\uff1a\u6709\u5b89\u88c5 CD\uff0c\u53ef\u7528</li>\n<li>Gentoo\uff1a\u6ca1\u6709\u5b89\u88c5 CD\uff0c\u9700\u8981\u501f\u522b\u7684\u53d1\u884c\u7248\u7684\u73af\u5883\u6765\u5b89\u88c5</li>\n<li>Debian\uff1a\u6ca1\u6709\u5b98\u65b9\u5b89\u88c5 CD\uff0c\u6709\u7b2c\u4e09\u65b9\u7684\u5b89\u88c5 CD</li>\n<li>UOS\uff1a\u6ca1\u8bd5\u8fc7</li>\n<li>openEuler\uff1a\u6ca1\u8bd5\u8fc7</li>\n<li>Loongnix\uff1a\u6ca1\u8bd5\u8fc7</li>\n<li>Anolis OS\uff1a\u6ca1\u8bd5\u8fc7</li>\n</ul>\n<p>\u65e2\u7136\u4e70\u7684\u76d8\u6bd4\u8f83\u5927\uff0c\u5c31\u9884\u7559\u4e86\u591a\u4e2a\u7cfb\u7edf\u5206\u533a\u7684\u7a7a\u95f4\uff0c\u7136\u540e\u4fdd\u7559\u4e00\u4e2a\u5927\u7684\u6570\u636e\u5206\u533a\u3002\u76ee\u524d\u88c5\u4e86 AOSC OS\u3001LoongArchLinux\u3001Debian\u3001Gentoo \u548c NixOS\u3002</p>\n<p>\u76ee\u524d Debian \u8fd8\u7f3a\u5f88\u591a\u5305\uff0c\u4f46\u662f\u53ef\u4ee5\u624b\u52a8 bootstrap \u8d77\u6765\u3002\u6211\u76ee\u524d\u7528\u7684\u662f AOSC OS \u7684 Kernel\uff0c\u5176\u4f59\u7684\u90e8\u5206\u662f\u5728 Debian \u4e2d\u4ece\u6e90\u7801\u5f00\u59cb\u7f16\u8bd1\u3002\u4e2d\u95f4\u4f1a\u9047\u5230\u5404\u79cd\u5faa\u73af\u4f9d\u8d56\uff0c\u9700\u8981\u901a\u8fc7 DEB_BUILD_PROFILES \u6765\u6253\u7834\u5faa\u73af\uff0c\u5f88\u591a\u5305\u9700\u8981\u624b\u52a8\u5904\u7406\uff0c\u5148\u628a\u4e00\u4e9b\u96be\u5904\u7406\u7684\u5305\u53bb\u6389\uff0c\u7136\u540e\u4e4b\u540e\u518d\u91cd\u65b0\u6253\u5305\u3002</p>\n<p>UPDATE: \u73b0\u5728\u5df2\u7ecf\u6709\u5f88\u591a\u5305\u53ef\u4ee5\u7528\u4e86\u3002Revy \u6307\u51fa\u53ef\u4ee5\u7528 debootstrap \u751f\u6210\u4e00\u4e2a rootfs\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>debootstrap<span class=\"w\"> </span>--no-check-gpg<span class=\"w\"> </span>--arch<span class=\"o\">=</span>loong64<span class=\"w\"> </span>--variant<span class=\"o\">=</span>buildd<span class=\"w\"> </span>--foreign<span class=\"w\"> </span>--include<span class=\"o\">=</span>ca-certificates,apt-transport-https,debian-ports-archive-keyring<span class=\"w\"> </span>--extra-suites<span class=\"o\">=</span>unreleased<span class=\"w\"> </span>unstable<span class=\"w\"> </span>sid-loong64-sbuild<span class=\"w\"> </span>http://mirror.sjtu.edu.cn/debian-ports\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>arch-chroot<span class=\"w\"> </span>sid-loong64-sbuild\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>/debootstrap/debootstrap<span class=\"w\"> </span>--second-stage\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>apt<span class=\"w\"> </span>-f<span class=\"w\"> </span>install\n</span></code></pre></div>\n<p>Gentoo \u7684\u8bdd\uff0c\u6309\u7167\u5b98\u65b9\u7684\u5b89\u88c5\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u7528 loongarch \u7684 stage3 tarball\u3002\u76ee\u524d\u9047\u5230\u4e86\u4e00\u4e2a\u5c0f\u5751\uff0c\u5c31\u662f linux stable 6.4 \u5185\u6838\u9047\u5230\u6700\u65b0\u7684 binutils \u4f1a\u6709\u95ee\u9898\uff0c\u8868\u73b0\u662f Unsupport relocation type 65, please add its support(R_LARCH_B21)\uff0c\u8fd9\u662f\u56e0\u4e3a\u7f3a\u4e86\u7f16\u8bd1\u53c2\u6570\uff0c\u5bfc\u81f4 binutils \u751f\u6210\u4e86 Linux \u5185\u6838\u4e0d\u652f\u6301\u7684 relocation type\u3002\u95ee\u9898\u5df2\u7ecf\u5728 6.5 \u89e3\u51b3\uff08<a href=\"https://github.com/torvalds/linux/commit/03c53eb90c0c61885b2175adf8675fb56df7f8db\">commit</a>\uff09\u3002\u53ef\u4ee5\u7528 sys-kernel/git-sources \u6765\u4f7f\u7528\u6700\u65b0\u7684 rc\u3002</p>\n<p>UPDATE: Linux 6.5 \u6b63\u5f0f\u7248\u51fa\u4e86\uff0c\u76f4\u63a5\u88c5 6.5 \u5373\u53ef\u3002</p>\n<p>NixOS \u7684\u8bdd\uff0c\u53ef\u4ee5\u5148\u5728 x86 \u4e0a\u751f\u6210\u4e00\u4e2a bootstrap tarball\uff0c\u7136\u540e\u5728 LoongArch64 \u4e0a\u7528\u8fd9\u4e2a bootstrap tarball\uff0c\u89c1 <a href=\"https://github.com/NixOS/nixpkgs/commit/88448caa371228f35c0a6c46f908c59e67a13475\">Add loongarch64 bootstrap tarball</a>\u3002\u9700\u8981\u4e00\u4e9b\u624b\u52a8\u64cd\u4f5c\uff0c\u4f46 bootstrap tarball \u914d\u597d\u4e86\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u7528 nixpkgs \u88c5\u4e1c\u897f\u4e86\u3002\u5982\u679c\u8981\u751f\u6210 NixOS \u7684\u5b89\u88c5\u955c\u50cf\uff0c\u53ef\u4ee5\u7528 nixos-generator\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>git@github.com:nix-community/nixos-generators\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>./nixos-generators/nixos-generate<span class=\"w\"> </span>-I<span class=\"w\"> </span><span class=\"nv\">nixpkgs</span><span class=\"o\">=</span>/path/to/nixpkgs<span class=\"w\"> </span>-f<span class=\"w\"> </span>install-iso<span class=\"w\"> </span>--system<span class=\"w\"> </span>loongarch64-linux\n</span></code></pre></div>\n<p>\u5982\u679c\u60f3\u8981\u8fdb\u4e00\u6b65\u7f29\u77ed ISO \u6784\u5efa\u65f6\u95f4\uff0c\u53ef\u4ee5\u4fee\u6539 <code>nixos-generators/formats/install-iso.nix</code>\uff0c\u628a installation-cd-base \u6539\u6210 installation-cd-minimal\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u5df2\u6709\u7684\u7cfb\u7edf\u4e0a\u88c5\u65b0\u7684 NixOS\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>nix<span class=\"w\"> </span>build<span class=\"w\"> </span>-L<span class=\"w\"> </span>.#nixos-install-tools\n</span></code></pre></div>\n<p>\u8fd9\u91cc\u9762\u8fd8\u6709\u5f88\u591a\u5c0f\u7684 trick\uff0c\u9700\u8981\u5bf9 nixpkgs \u505a\u4e00\u4e9b\u4fee\u6539\uff1a<a href=\"https://github.com/jiegec/nixpkgs/commits/loongarch64\">https://github.com/jiegec/nixpkgs/commits/loongarch64</a>\u3002</p>\n<h2 id=\"vscode\">VSCode<a class=\"headerlink\" href=\"#vscode\" title=\"Permanent link\">&para;</a></h2>\n<p>VSCode \u5b98\u65b9\u5927\u6982\u7387\u662f\u4e0d\u4f1a\u51fa loongarch \u7248\u672c\u7684\uff0c\u4f46\u662f\u81ea\u5df1\u53ef\u4ee5\u7f16\u8bd1\u4e00\u4e2a\u3002\u76ee\u524d\u8fd0\u884c VSCode \u7684\u4e3b\u8981\u969c\u788d\u662f Electron\u3002Electron \u7684\u4e0a\u6e38\u5316\u8fd8\u5728\u8fdb\u884c\uff0c\u4f46\u73b0\u5728\u4e5f\u6709\u4e00\u4e9b\u6253\u4e86 patch \u7684 Electron \u53ef\u7528\uff0c\u4f8b\u5982 LoongArchLinux \u7684<a href=\"https://mirrors.wsyu.edu.cn/loongarch/archlinux/laur/os/loong64/\">\u6e90</a>\u91cc\u63d0\u4f9b\u4e86 electron22 \u548c <a href=\"https://github.com/loongarchlinux/laur/tree/main/electron17-bin\">electron17-bin</a>\u3002LoongArchLinux \u7684\u6e90\u91cc\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a<a href=\"https://mirrors.wsyu.edu.cn/loongarch/archlinux/laur/os/loong64/visual-studio-code-bin-1.67.0-1-loong64.pkg.tar.zst\">\u6bd4\u8f83\u8001\u7684 vscode 1.67.0 \u7248\u672c</a>\uff08\u5bf9\u5e94\u7684 <a href=\"https://github.com/loongarchlinux/laur/tree/main/visual-studio-code-bin\">PKGBUILD</a>\uff09\u3002\u6709\u7fa4\u53cb\u5df2\u7ecf\u7528 electron22 \u628a vscode 1.84.2 \u8dd1\u8d77\u6765\u4e86\uff1a<a href=\"https://github.com/LiarOnce/vscodium-electron-loong64\">LiarOnce/vscodium-electron-loong64</a>\u3002</p>\n<p>Chrome \u7684\u60c5\u51b5\u548c VSCode \u7c7b\u4f3c\uff0c\u6838\u5fc3\u5176\u5b9e\u90fd\u662f Chromium \u5185\u6838\u7684\u79fb\u690d\u3002LoongArchLinux \u7684\u6e90\u91cc\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4efd <a href=\"https://mirrors.wsyu.edu.cn/loongarch/archlinux/laur/os/loong64/chromium-snapshot-bin-102.0.5005.63.r1-1-loong64.pkg.tar.zst\">Chromium 102.0.5005.63</a>\u3002Firefox \u5219\u5df2\u7ecf\u80fd\u6bd4\u8f83\u5bb9\u6613\u5730\u8dd1\u8d77\u6765\u3002</p>\n<h2 id=\"vscode-remote\">VSCode Remote<a class=\"headerlink\" href=\"#vscode-remote\" title=\"Permanent link\">&para;</a></h2>\n<p>VSCode Remote Server \u662f\u95ed\u6e90\u7684\uff08\u6ce8\uff1a\u8fd9\u91cc\u7684\u8868\u8ff0\u53ef\u80fd\u4e0d\u51c6\u786e\uff0c\u6709\u7fa4\u53cb\u53cd\u9988\u53ef\u4ee5\u5728 LoongArch \u4e0a\u7f16\u8bd1\u5f00\u6e90\u7248\u672c\uff09\uff0c\u4f46\u662f\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528 lat \u6765\u5bf9 nodejs \u505a\u4e8c\u8fdb\u5236\u7ffb\u8bd1\u3002\u53ea\u9700\u8981\u9b54\u6539 <code>~/.vscode/extensions/ms-vscode-remote.remote-ssh-0.102.0/out/extension.js</code>\uff08\u7248\u672c\u53f7\u53ef\u80fd\u4e0d\u540c\uff09\uff0c\u628a\u91cc\u9762\u5bf9 x86_64 \u67b6\u6784\u7684\u5224\u65ad\uff0c\u52a0\u4e0a loongarch64\uff0c\u4e5f\u5c31\u662f\u628a loongarch64 \u5f53\u6210 x86_64 \u53bb\u5904\u7406\uff0c\u90a3\u4e48 VSCode Remote \u5c31\u4f1a\u4e0b\u8f7d x86_64 \u7684 binary \u5e76\u8fd0\u884c\uff0c\u6b64\u65f6\u7528 lat \u5c31\u53ef\u4ee5\u8dd1 server \u4e86\u3002</p>\n<p>\u6309\u7167\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u8df5\u4e86\u4e00\u4e0b\uff1aQEMU \u8fd8\u6ca1\u652f\u6301 LASX \u6307\u4ee4\uff08\u6709 <a href=\"https://patchew.org/search?q=project%3AQEMU+LASX\">patch</a> \u4f46\u662f\u8fd8\u6ca1\u6709\u5408\u5e76\uff09\uff0c\u6240\u4ee5\u8dd1\u7684\u65f6\u5019\u4f1a SIGILL\u3002\u771f\u673a 3A6000 \u4e0a\u4f1a\u5728 lat \u91cc\u9762\u5931\u8d25\uff0c\u56e0\u4e3a\u6211\u7528\u7684\u662f\u65b0\u4e16\u754c\u53d1\u884c\u7248\uff0c\u548c\u65e7\u4e16\u754c\u53d1\u884c\u7248\u7684 syscall \u4e0d\u517c\u5bb9\u3002\u6216\u8bb8\u7528\u65e7\u4e16\u754c\u53d1\u884c\u7248\u53ef\u4ee5\u7528 lat \u6b63\u5e38\u8fd0\u884c\u3002</p>\n<p>UPDATE: \u4f7f\u7528 LoongArchLinux \u7684\u65b0\u4e16\u754c lat 1.3.1\uff0cVSCode Remote Server \u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u8fd8\u6709 BUG\u3002</p>\n<p>UPDATE: \u4f7f\u7528 LoongArchLinux \u7684\u65b0\u4e16\u754c lat 1.4.3\uff0cVSCode Remote Server \u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u6ca1\u6709\u4e86\u4e4b\u524d\u7684 BUG\u3002</p>\n<p>\u4e5f\u5c1d\u8bd5\u4e86\u7528 qemu user \u53bb\u8fd0\u884c x86 \u7684 nodejs\uff0c\u4f46\u662f\u9047\u5230\u4e86 page size \u4e0d\u5339\u914d\u7684\u95ee\u9898\uff1a16KB != 4KB\uff0c\u4e5f\u6ca1\u8dd1\u8d77\u6765\u3002</p>\n<p>\u53e6\u4e00\u4e2a\u66f2\u7ebf\u6551\u56fd\u7684\u65b9\u6cd5\u662f\uff0c\u4fee\u6539 extension.js \u8ba9 VSCode \u8ba4\u4e3a\u662f AArch64\uff0c\u7136\u540e\u7528 qemu-user \u6765\u8dd1\u3002\u8fd9\u6b21\u6ca1\u6709\u9047\u5230 page size \u7684\u95ee\u9898\u4e86\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>qemu-aarch64-static\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>wget<span class=\"w\"> </span>https://repo.aosc.io/debs/pool/stable/main/g/gcc-runtime_12.2.0-0_arm64.deb\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>wget<span class=\"w\"> </span>https://repo.aosc.io/debs/pool/stable/main/g/glibc_2.36-4_arm64.deb\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>dpkg<span class=\"w\"> </span>--extract<span class=\"w\"> </span>gcc-runtime_12.2.0-0_arm64.deb<span class=\"w\"> </span>/path/to/prefix\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a>dpkg<span class=\"w\"> </span>--extract<span class=\"w\"> </span>glibc_2.36-4_arm64.deb<span class=\"w\"> </span>/path/to/prefix\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"c1\"># add to shell init</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"nb\">export</span><span class=\"w\"> </span><span class=\"nv\">QEMU_LD_PREFIX</span><span class=\"o\">=</span>/path/to/prefix\n</span></code></pre></div>\n<p>\u8fd9\u6837\u6709\u4e2a\u4f18\u52bf\u4e5f\u662f\u52a3\u52bf\uff0c\u5c31\u662f Extension \u4e5f\u4f1a\u8ba4\u4e3a Remote \u662f AArch64\uff0c\u90a3\u4e48\u5c31\u4f1a\u8dd1\u81ea\u5e26\u7684 AArch64 \u7684\u7a0b\u5e8f\uff0c\u4f46\u5982\u679c\u6709\u539f\u751f\u7684 LoongArch64 \u7a0b\u5e8f\uff0c\u90a3\u8fd8\u662f\u7528\u540e\u8005\u66f4\u597d\u3002\u4e00\u4e2a\u4f8b\u5b50\u662f rust-analyzer\uff0c\u53ef\u4ee5\u6307\u5b9a native binary\uff1a</p>\n<div class=\"language-json highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"p\">{</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">    </span><span class=\"nt\">&quot;rust-analyzer.server.path&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;/usr/bin/rust-analyzer&quot;</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>\u8fd9\u6837\u53ea\u6709 vscode server \u672c\u8eab\u662f\u7528 qemu-aarch64-static \u8dd1\u7684\uff0c\u5176\u4ed6\u5219\u6ca1\u6709\u5f71\u54cd\u3002</p>\n<p>\u6b64\u5916\uff0ccode-server \u4e5f\u662f\u53ef\u4ee5\u7528\u7684\uff0c\u5b89\u88c5 node v16 \u548c npm\uff0c\u7136\u540e\u8fd0\u884c code-server \u5b89\u88c5\u811a\u672c\u5373\u53ef\u3002</p>\n<h2 id=\"\u5bb9\u5668\">\u5bb9\u5668<a class=\"headerlink\" href=\"#\u5bb9\u5668\" title=\"Permanent link\">&para;</a></h2>\n<p>\u53ef\u4ee5 podman \u8dd1\u5176\u4ed6\u67b6\u6784\u7684\u5bb9\u5668\uff0c\u4f8b\u5982\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>sudo<span class=\"w\"> </span>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>--arch<span class=\"w\"> </span>x86_64<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>sudo<span class=\"w\"> </span>podman<span class=\"w\"> </span>run<span class=\"w\"> </span>--arch<span class=\"w\"> </span>arm64<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>debian:stable\n</span></code></pre></div>\n<p>\u53ea\u8981\u8fd9\u4e2a image \u6709\u5bf9\u5e94\u67b6\u6784\u7684\u7248\u672c\uff0c\u5e76\u4e14\u63d0\u524d\u914d\u597d binfmt\uff0c\u6ce8\u610f binfmt \u7684 flags\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a POCF\uff0c\u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u662f F\uff0c\u4e0d\u7136 binfmt \u4f1a\u5728\u5bb9\u5668\u91cc\u627e binfmt \u7684 executable\uff0c\u81ea\u7136\u5c31\u627e\u4e0d\u5230\u4e86\uff0c\u4f1a\u62a5\u9519 <code>exec container process (missing dynamic library?)</code>\u3002</p>\n<p>docker \u6253\u4e0a\u7b80\u5355\u7684 patch \u4ee5\u652f\u6301 loong64 \u4ee5\u540e\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a>docker<span class=\"w\"> </span>run<span class=\"w\"> </span>-it<span class=\"w\"> </span>--rm<span class=\"w\"> </span>--platform<span class=\"w\"> </span>arm64<span class=\"w\"> </span>debian\n</span></code></pre></div>\n<h2 id=\"loong-arch-linux-\u4e0a-xrdp-\u517c\u5bb9\u6027\u95ee\u9898\">Loong Arch Linux \u4e0a XRDP \u517c\u5bb9\u6027\u95ee\u9898<a class=\"headerlink\" href=\"#loong-arch-linux-\u4e0a-xrdp-\u517c\u5bb9\u6027\u95ee\u9898\" title=\"Permanent link\">&para;</a></h2>\n<p>\u5728 Loong Arch Linux \u4e0a\u8fd0\u884c XRDP\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u542f\u52a8\u9ed1\u5c4f\u7684\u95ee\u9898\u3002\u5b83\u7684\u95ee\u9898\u6709\u4e24\u4e2a\uff1a</p>\n<ol>\n<li><code>/etc/xrdp/sesman.ini</code> \u4e2d\uff0c\u5e94\u8be5\u6307\u5b9a Xorg \u7684\u5b8c\u6574\u8def\u5f84\uff0c\u628a <code>param=Xorg</code> \u6539\u6210 <code>param=/usr/lib/Xorg</code>\u3002\u8fd9\u5728 <a href=\"https://aur.archlinux.org/packages/xrdp\">xrdp AUR</a> \u4e0b\u9762\u7684\u8ba8\u8bba\u91cc\u53ef\u4ee5\u770b\u5230\u3002</li>\n<li>\u5728 <code>/usr/share/X11/xorg.conf.d</code> \u4e2d\uff0c\u5982\u679c\u6709 <code>10-modeset.conf</code>\uff0c\u5b83\u4f1a\u5bfc\u81f4 xrdp \u542f\u52a8\u7684 Xorg \u5c1d\u8bd5\u6253\u5f00 virtual console\uff0c\u4f46\u662f\u56e0\u4e3a\u4e0d\u662f root \u7528\u6237\uff0c\u6240\u4ee5\u4f1a\u5931\u8d25\uff1b\u5373\u4f7f\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u6dfb\u52a0\u4e86 <code>-configdir /</code> \u53c2\u6570\u4e5f\u6ca1\u6709\u7528\uff0c\u56e0\u4e3a <code>/usr/share/X11/xorg.conf.d</code> \u662f\u5168\u5c40\u7684\u914d\u7f6e\u76ee\u5f55\uff0c\u4e0d\u53d7 <code>-configdir</code> \u9009\u9879\u5f71\u54cd\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u628a 10-modeset.conf \u6539\u540d\uff0c\u6216\u8005\u632a\u5230\u5176\u4ed6\u5730\u65b9\u3002\u4f46\u662f\u8981\u5c0f\u5fc3\u662f\u5426\u4f1a\u5f71\u54cd\u672c\u673a root \u81ea\u5df1\u7684 X11 \u670d\u52a1\u542f\u52a8\u3002</li>\n</ol>\n<p>\u5176\u4e2d <code>10-modeset.conf</code> \u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>Section &quot;Device&quot;\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>        Identifier &quot;Generic Kernel Modesetting Device&quot;\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a>        Driver &quot;modesetting&quot;\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>        Option &quot;kmsdev&quot; &quot;/dev/dri/card0&quot;\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>        Option &quot;ShadowFB&quot; &quot;true&quot;\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a>EndSection\n</span></code></pre></div>\n<p>\u8fd9\u4e2a\u6587\u4ef6\u7531 <code>xorg-server</code> \u5305\u5b89\u88c5\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>$<span class=\"w\"> </span>pacman<span class=\"w\"> </span>-F<span class=\"w\"> </span><span class=\"m\">10</span>-modeset.conf\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>extra/xorg-server<span class=\"w\"> </span><span class=\"m\">21</span>.1.8-3<span class=\"w\"> </span><span class=\"o\">(</span>xorg<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span>installed<span class=\"o\">]</span>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span>usr/share/X11/xorg.conf.d/10-modeset.conf\n</span></code></pre></div>\n<p>\u662f\u4ece <a href=\"https://github.com/loongarchlinux/extra/blob/main/xorg-server/10-modeset.conf\">10-modeset.conf</a> \u5b89\u88c5\u800c\u6765\u3002modesetting Driver \u7684\u6587\u6863\u89c1 <a href=\"https://man.archlinux.org/man/modesetting.4\">MODESETTING(4)</a>\u3002<a href=\"https://github.com/loongarchlinux/extra/commit/663460b1aa7a16e1c9ecd0342ef648c0961ae130#diff-2edba23ba1fb0b9b5e1666b4728c32c84dd3073c5e3771199e9d55846a4cdc6a\">\u8bbe\u7f6e\u8fd9\u4e2a</a>\u5e94\u8be5\u662f\u4e3a\u4e86 7A2000 \u7684 GPU\uff1a<code># fix modesetting driver for loongson and gsgpu</code>\uff0c\u4f46\u662f\u8bef\u4f24\u4e86 xrdp\u3002</p>\n<h2 id=\"benchmark\">Benchmark<a class=\"headerlink\" href=\"#benchmark\" title=\"Permanent link\">&para;</a></h2>\n<p>\u63a8\u8350\u9605\u8bfb\uff1a<a href=\"https://zhuanlan.zhihu.com/p/654721485\">\u534e\u4e3a VS \u9f99\u82af \u56fd\u4ea7 CPU \u67b6\u6784\u521d\u6b65\u63a2\u6d4b\u3001\u5bf9\u6bd4\u4e0e\u5206\u6790</a></p>\n<h3 id=\"aosc\">AOSC<a class=\"headerlink\" href=\"#aosc\" title=\"Permanent link\">&para;</a></h3>\n<p>\u5728 AOSC \u4e0a\u8dd1\u4e00\u4e9b\u6d4b\u8bd5\u8f6f\u4ef6\u7684\u6d4b\u8bd5\u7ed3\u679c\uff08\u5192\u53f7\u540e\u591a\u4e2a\u6570\u5b57\u4e3a\u8dd1\u591a\u6b21\u7684\u7ed3\u679c\uff09\uff0c\u4e0d\u4e00\u5b9a\u51c6\u786e\uff1a</p>\n<ul>\n<li>p7zip <code>7z -mmt1 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a3681 3678 3680</li>\n<li>p7zip <code>7z -mmt4 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a13998 13995 14038</li>\n<li>p7zip <code>7z -mmt8 b</code> 17.04 \u8f93\u51fa\u6700\u540e\u4e00\u4e2a\u503c\uff1a20585 20816 20407</li>\n<li>Coremark v1.01 \u5355\u7ebf\u7a0b\uff08<code>make</code>\uff09: 21134 21164 21161</li>\n<li>Coremark v1.01 \u56db\u7ebf\u7a0b\uff08<code>make XCFLAGS=\"-DMULTITHREAD=4 -DUSE_PTHREAD\"</code>\uff09\uff1a83571 83629 83565</li>\n<li>Coremark v1.01 \u516b\u7ebf\u7a0b\uff08<code>make XCFLAGS=\"-DMULTITHREAD=8 -DUSE_PTHREAD\"</code>\uff09\uff1a113111 113143 113250</li>\n</ul>\n<p>\u5176\u4e2d\u56db\u7ebf\u7a0b\u7684\u6d4b\u8bd5\u7ed1\u5b9a\u5230 <code>0,2,4,6</code> \u6838\u5fc3\u3002\u7f16\u8bd1\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u5411\u91cf\u5316\uff0cLSX/LASX \u53ea\u6709\u7279\u5b9a\u7684\u6c47\u7f16\u4f18\u5316\u3002</p>\n<h3 id=\"\u7f51\u53cb\u7684\u8bc4\u6d4b\">\u7f51\u53cb\u7684\u8bc4\u6d4b<a class=\"headerlink\" href=\"#\u7f51\u53cb\u7684\u8bc4\u6d4b\" title=\"Permanent link\">&para;</a></h3>\n<ul>\n<li><a href=\"https://www.bilibili.com/video/BV1gr4y1o7P8/\">https://www.bilibili.com/video/BV1gr4y1o7P8/</a></li>\n</ul>\n<p>\u5b98\u65b9\u53d1\u5e03\uff1a<a href=\"https://mp.weixin.qq.com/s/Lm_6varu0ovntPGfVzeGLw\">https://mp.weixin.qq.com/s/Lm_6varu0ovntPGfVzeGLw</a></p>\n<h3 id=\"microbenchmark\">Microbenchmark<a class=\"headerlink\" href=\"#microbenchmark\" title=\"Permanent link\">&para;</a></h3>\n<p>\u4e0b\u9762\u662f\u6211\u7528 microbenchmark \u65b9\u6cd5\u6d4b\u5230\u7684\u4e00\u4e9b\u5fae\u67b6\u6784\u6570\u636e\uff0c\u4e0d\u4e00\u5b9a\u51c6\u786e\uff1a</p>\n<p>3A6000:</p>\n<ol>\n<li>\u4e3b\u9891\uff1a2500 MHz</li>\n<li>L1 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a1.2ns\uff0c3 \u5468\u671f</li>\n<li>L2 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a4.81ns\uff0c12 \u5468\u671f</li>\n<li>L3 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a17.63ns\uff0c44 \u5468\u671f<ol>\n<li>add.w/d: 4 per cycle, 1 cycle latency</li>\n<li>mul.w/d: 2 per cycle, 4 cycle latency</li>\n<li>fadd.s/d: 4 per cycle, 3 cycle latency</li>\n<li>fmul.s/d: 2 per cycle, 5 cycle latency</li>\n<li>fmadd.s/d: 2 per cycle, 5 cycle latency</li>\n<li>crc.w.b.w: 2 per cycle, 1 cycle latency</li>\n<li>crc.w.h.w: 2 per cycle, 1 cycle latency</li>\n<li>crc.w.w.w: 2 per cycle, 1 cycle latency</li>\n<li>crc.w.d.w: 2 per cycle, 1 cycle latency</li>\n<li>xvadd/vadd.d: 4 per cycle, 1 cycle latency</li>\n<li>xvmul/vmul.d: 2 per cycle, 4 cycle latency</li>\n<li>xvfadd/vfadd.d: 4 per cycle, 3 cycle latency</li>\n<li>xvfmul/vfmul.d: 2 per cycle, 5 cycle latency</li>\n</ol>\n</li>\n<li>\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6027\u80fd\uff1a<ol>\n<li>\u5355\u6838\u6807\u91cf\uff1a2500 * 2 * 2 = 10 GFLOPS</li>\n<li>\u5355\u6838\u5411\u91cf\uff1a2500 * 2 * 2 * 4 = 40 GFLOPS</li>\n<li>\u5168\u6838\u5411\u91cf\uff1a4 * 40 = 160 GFLOPS</li>\n</ol>\n</li>\n</ol>\n<p>\u8bbf\u5b58\u5ef6\u8fdf\u4e0e\u5de5\u4f5c\u96c6\u5927\u5c0f\u7684\u5173\u7cfb\uff08\u4f7f\u7528 <a href=\"https://github.com/jiegec/cpu-micro-benchmarks\">jiegec/cpu-micro-benchmarks</a> \u6d4b\u8bd5\uff09\uff1a</p>\n<p><img alt=\"\" src=\"../../../../ls3a6000-memory-latency.png\" /></p>\n<p>\u4e3b\u8981\u5206\u4e09\u6bb5\uff1a</p>\n<ol>\n<li>&lt;64KB: \u547d\u4e2d L1D\uff0cLatency \u662f 1.2 ns\uff0c3 \u5468\u671f\u300264KB \u4e0e L1D \u5bb9\u91cf 64 KB \u4e00\u81f4\u3002</li>\n<li>&lt;320KB: \u547d\u4e2d L2\uff0cLatency \u662f 4.8 ns\uff0c12 \u5468\u671f\u3002320KB \u7b49\u4e8e L1D \u5bb9\u91cf 64 KB \u4e0e L2 \u5bb9\u91cf 256 KB \u603b\u548c\uff0c\u800c\u4e0d\u50cf\u5f88\u591a\u5fae\u67b6\u6784\u90a3\u6837\u7b49\u4e8e L2 \u5bb9\u91cf\u3002</li>\n<li>&lt;256MB: \u547d\u4e2d L3\uff0cLatency \u662f 17.6 ns\uff0c44 \u5468\u671f\u3002256MB \u4e0d\u7b49\u4e8e L3 \u5bb9\u91cf 16 MB\uff0c\u548c\u7f13\u5b58\u66ff\u6362\u7b56\u7565\u6216\u9884\u53d6\u5668\u884c\u4e3a\u6709\u5173\u3002</li>\n</ol>\n<p>3C5000:</p>\n<ol>\n<li>\u4e3b\u9891\uff1a2200 MHz</li>\n<li>L1 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a1.82ns\uff0c4 \u5468\u671f</li>\n<li>L2 \u7f13\u5b58\u547d\u4e2d Load To Use\uff1a6.37ns\uff0c14 \u5468\u671f</li>\n<li>\u6307\u4ee4\u541e\u5410/\u5ef6\u8fdf\uff1a<ol>\n<li>add.w/d: 4 per cycle, 1 cycle latency</li>\n<li>mul.w/d: 2 per cycle, 4 cycle latency</li>\n<li>fadd.s/d: 2 per cycle, 5 cycle latency</li>\n<li>fmul.s/d: 2 per cycle, 5 cycle latency</li>\n<li>fmadd.s/d: 2 per cycle, 5 cycle latency</li>\n<li>crc.w.b.w: 1/3.5 per cycle, 5 cycle latency</li>\n<li>crc.w.h.w: 1/4.5 per cycle, 7 cycle latency</li>\n<li>crc.w.w.w: 1/6.5 per cycle, 11 cycle latency</li>\n<li>crc.w.d.w: 1/10.5 per cycle, 19 cycle latency</li>\n<li>xvadd/vadd.d: 2 per cycle, 1 cycle latency</li>\n<li>xvmul/vmul.d: 2 per cycle, 4 cycle latency</li>\n<li>xvfadd/vfadd.d: 2 per cycle, 5 cycle latency</li>\n<li>xvfmul/vfmul.d: 2 per cycle, 5 cycle latency</li>\n</ol>\n</li>\n</ol>\n<p>\u5bf9\u6bd4\uff1a</p>\n<table>\n<thead>\n<tr>\n<th>Inst latency &amp; throughput</th>\n<th>3A6000 @ 2.5 GHz</th>\n<th>3C5000 @ 2.2 GHz</th>\n<th>Kunpeng 920 @ 2.6 GHz</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>64b int add</td>\n<td>4 per cyc, 1 cyc lat</td>\n<td>4 per cyc, 1 cyc lat</td>\n<td>3 per cyc, 1 cyc lat</td>\n</tr>\n<tr>\n<td>64b int mul</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>1 per cyc, 4 cyc lat</td>\n</tr>\n<tr>\n<td>64b fp add</td>\n<td>4 per cyc, 3 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>2 per cyc, 4 cyc lat</td>\n</tr>\n<tr>\n<td>64b fp mul</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n</tr>\n<tr>\n<td>128b vec 64b int add</td>\n<td>4 per cyc, 1 cyc lat</td>\n<td>2 per cyc, 1 cyc lat</td>\n<td>2 per cyc, 2 cyc lat</td>\n</tr>\n<tr>\n<td>128b vec 64b int mul</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td>128b vec 64b fp add</td>\n<td>4 per cyc, 3 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>1 per cyc, 4 cyc lat</td>\n</tr>\n<tr>\n<td>128b vec 64b fp mul</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>1 per cyc, 5 cyc lat</td>\n</tr>\n<tr>\n<td>256b vec 64b int add</td>\n<td>4 per cyc, 1 cyc lat</td>\n<td>2 per cyc, 1 cyc lat</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td>256b vec 64b int mul</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>2 per cyc, 4 cyc lat</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td>256b vec 64b fp add</td>\n<td>4 per cyc, 3 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td>256b vec 64b fp mul</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>2 per cyc, 5 cyc lat</td>\n<td>N/A</td>\n</tr>\n</tbody>\n</table>\n<p>\u53c2\u8003\uff1a</p>\n<ul>\n<li><a href=\"https://www.7-cpu.com/cpu/Loongson_3A5000.html\">https://www.7-cpu.com/cpu/Loongson_3A5000.html</a></li>\n<li><a href=\"https://chipsandcheese.com/2023/04/09/loongsons-3a5000-chinas-best-shot/\">https://chipsandcheese.com/2023/04/09/loongsons-3a5000-chinas-best-shot/</a></li>\n<li><a href=\"https://chipsandcheese.com/2023/02/26/loongsons-lsx-and-lasx-vector-extensions/\">https://chipsandcheese.com/2023/02/26/loongsons-lsx-and-lasx-vector-extensions/</a></li>\n</ul>\n<h2 id=\"\u5df2\u77e5\u95ee\u9898\">\u5df2\u77e5\u95ee\u9898<a class=\"headerlink\" href=\"#\u5df2\u77e5\u95ee\u9898\" title=\"Permanent link\">&para;</a></h2>\n<p>\u9664\u4e86\u524d\u9762\u6240\u8ff0\u7684\u5185\u5b58\u6761\u548c\u663e\u5361\u517c\u5bb9\u6027\u4ee5\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u5df2\u77e5\u95ee\u9898\uff1a</p>\n<ul>\n<li><del>AMD \u663e\u5361\u5173\u5c4f\u4e45\u4e86\u4ee5\u540e\uff0c\u53ef\u80fd\u4f1a hang\uff0c\u6000\u7591\u662f\u7535\u6e90\u7ba1\u7406\u95ee\u9898</del> \u5347\u7ea7 6.5 \u5185\u6838\u540e\u95ee\u9898\u6d88\u5931</li>\n<li><del>\u56fa\u4ef6\u7684 PCIe Above 4G \u529f\u80fd\u4e0d\u53ef\u7528</del> \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li>\n<li><del>\u56fa\u4ef6\u7684 ACPI PPTT \u8868\u5185\u5bb9\u6709\u95ee\u9898</del> \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li>\n<li><del>\u677f\u8f7d HDMI \u6709\u95ee\u9898</del> \u5df2\u5728\u65b0\u7248\u56fa\u4ef6\u4e2d\u4fee\u590d</li>\n</ul>", "image": null, "date_modified": "2023-08-10T00:00:00+00:00", "authors": [], "tags": ["cpu", "diy", "hardware", "loongarch", "loongson", "ls3a6000", "machine"]}, {"id": "https://jia.je/hardware/2023/08/10/loongarch-cpu/", "url": "https://jia.je/hardware/2023/08/10/loongarch-cpu/", "title": "LoongArch \u5904\u7406\u5668", "content_html": "<h1 id=\"loongarch-\u5904\u7406\u5668\">LoongArch \u5904\u7406\u5668<a class=\"headerlink\" href=\"#loongarch-\u5904\u7406\u5668\" title=\"Permanent link\">&para;</a></h1>\n<p>\u6574\u7406\u5e02\u9762\u4e0a\u7684 LoongArch \u5904\u7406\u5668\u4ee5\u53ca\u76f8\u5173\u4ea7\u54c1\u3002</p>\n<!-- more -->\n\n<h2 id=\"3a5000\">3A5000<a class=\"headerlink\" href=\"#3a5000\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=10\">\u4e3b\u9875</a></p>\n<p>4 \u6838 LA464</p>\n<p>\u4e0d\u540c\u7684\u7248\u672c\uff1a</p>\n<ul>\n<li>3A5000-HV: High Voltage, 2.5GHz</li>\n<li>3A5000-LL: 2.3GHz</li>\n<li>3A5000M: Mobile, 2.0GHz</li>\n<li>3A5000-iHV: Industrial High Voltage, 1.5/2.0GHz</li>\n<li>3A5000-i: Industrial: 1.5GHz</li>\n<li>3B5000: Server, 2.3GHz</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>\u578b\u53f7</th>\n<th>\u7c7b\u578b</th>\n<th>\u6865\u7247/\u663e\u5361</th>\n<th>\u5185\u5b58</th>\n<th>\u786c\u76d8</th>\n<th>\u4ef7\u683c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://item.jd.com/10074790246806.html\">PN-L520A</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>7A2000</td>\n<td>16GB</td>\n<td>512GB</td>\n<td>2699</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100017987513.html\">GPC-100</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>7A1000+\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>3825</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100044255754.html\">M540Z</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>4599</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100023656622.html\">\u60a6\u777f</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>4608</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100029037278.html\">EC-80G</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>AMD R5 230</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>7266</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_94/874.html\">ML5A-D01</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>7A1000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_94/873.html\">ML5C-D04</a></td>\n<td>\u53f0\u5f0f\u673a</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100043060855.html\">TR11A2</a></td>\n<td>\u53f0\u5f0f\u673a + \u663e\u793a\u5668</td>\n<td>\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>5890</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100044512026.html\">TL630-V001-2</a></td>\n<td>\u53f0\u5f0f\u673a + \u663e\u793a\u5668</td>\n<td>\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>6200</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100047587985.html\">JL630-V001</a></td>\n<td>\u53f0\u5f0f\u673a + \u663e\u793a\u5668</td>\n<td>\u72ec\u663e</td>\n<td>16GB</td>\n<td>512GB</td>\n<td>6999</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100016595171.html\">GDC-1401</a></td>\n<td>\u7b14\u8bb0\u672c</td>\n<td>7A1000+AMD R5 340</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>6375</td>\n</tr>\n<tr>\n<td><a href=\"https://item.jd.com/100037403828.html\">L860-T2</a></td>\n<td>\u7b14\u8bb0\u672c</td>\n<td>\u72ec\u663e</td>\n<td>8GB</td>\n<td>256GB</td>\n<td>6999</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_95/877.html\">L71</a></td>\n<td>\u7b14\u8bb0\u672c</td>\n<td>\u72ec\u663e</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_95/875.html\">L71S</a></td>\n<td>\u7b14\u8bb0\u672c</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_95/924.html\">L71F</a></td>\n<td>\u7b14\u8bb0\u672c</td>\n<td>7A1000+\u72ec\u663e</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://item.taobao.com/item.htm?id=682906828504\">\u9f99\u82af\u5f00\u53d1\u677f</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>1700</td>\n</tr>\n<tr>\n<td><a href=\"https://item.taobao.com/item.htm?id=717408690295\">\u667a\u82af\u5143</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>1798</td>\n</tr>\n<tr>\n<td><a href=\"https://item.taobao.com/item.htm?id=683776108019\">\u6211\u7231\u5f00\u53d1\u677f</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>1900</td>\n</tr>\n<tr>\n<td><a href=\"https://item.taobao.com/item.htm?id=690758505114\">\u8fc5\u4e3a</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A2000</td>\n<td>8GB</td>\n<td>128GB</td>\n<td>5910</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_92/853.html\">ML5A</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A1000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n<tr>\n<td><a href=\"https://www.eaecis.com/cp_92/872.html\">ML5C</a></td>\n<td>\u4e3b\u677f+CPU</td>\n<td>7A2000</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>N/A</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3c5000\">3C5000<a class=\"headerlink\" href=\"#3c5000\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=15\">\u4e3b\u9875</a></p>\n<p>16 \u6838 LA464</p>\n<p>\u4e0d\u540c\u7684\u7248\u672c\uff1a</p>\n<ul>\n<li>3C5000: 32MB L3 Cache, 2.2GHz</li>\n<li>3C5000-LL: 32MB L3 Cache, 2.0GHz</li>\n<li>3C5000L: 64MB L3 Cache, 2.2GHz</li>\n<li>3C5000L-LL: 64MB L3 Cache, 2.0GHz</li>\n</ul>\n<p>3C5000L \u662f\u7531\u56db\u4e2a 3A5000 \u82af\u7247\u96c6\u6210\uff0c\u800c 3C5000 \u4e0d\u662f\u3002</p>\n<ul>\n<li><a href=\"https://item.jd.com/100053674064.html\">https://item.jd.com/100053674064.html</a> GDC-2000 \u4e24\u8def 3C5000</li>\n<li><a href=\"https://item.jd.com/100054670954.html\">https://item.jd.com/100054670954.html</a> JL620-G3-00 \u4e24\u8def 3C5000L</li>\n<li><a href=\"https://item.jd.com/100054668922.html\">https://item.jd.com/100054668922.html</a> JL620-G3-01 \u4e24\u8def 3C5000</li>\n<li><a href=\"https://item.jd.com/10079447545921.html\">https://item.jd.com/10079447545921.html</a> G4129-ET25 \u4e24\u8def 3C5000</li>\n<li><a href=\"https://www.eaecis.com/chanpinleixingfenlei/334.html\">https://www.eaecis.com/chanpinleixingfenlei/334.html</a> SL12R-S01 \u4e24\u8def 3C5000</li>\n<li><a href=\"https://item.jd.com/100033473676.html\">https://item.jd.com/100033473676.html</a> GS6000L-4C5L \u56db\u8def 3C5000L</li>\n<li><a href=\"https://item.jd.com/100041722164.html\">https://item.jd.com/100041722164.html</a> GDC-2000 \u56db\u8def 3C5000L</li>\n<li><a href=\"https://item.jd.com/100060558727.html\">https://item.jd.com/100060558727.html</a> GS6000 LA240 \u56db\u8def 3C5000</li>\n</ul>\n<h2 id=\"3d5000\">3D5000<a class=\"headerlink\" href=\"#3d5000\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=21\">\u4e3b\u9875</a></p>\n<p>32 \u6838 LA464</p>\n<h2 id=\"3a6000\">3A6000<a class=\"headerlink\" href=\"#3a6000\" title=\"Permanent link\">&para;</a></h2>\n<p>4 \u6838 8 \u7ebf\u7a0b LA664</p>\n<p><img alt=\"\" src=\"../../../../3a6000.png\" /></p>\n<p>\u6765\u6e90\uff1a<a href=\"https://roadshow.sseinfo.com/roadshowIndex.do?id=14977\">\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u534a\u5e74\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</a></p>\n<p>\u6839\u636e <a href=\"http://basic.10jqka.com.cn/688047/interactive.html\">http://basic.10jqka.com.cn/688047/interactive.html</a>:</p>\n<ul>\n<li>ROB \u9879\u6570\u8fbe\u5230 256 \u9879</li>\n<li>\u56db\u5b9a\u70b9\u3001\u56db\u6d6e\u70b9\u3001\u56db\u8bbf\u5b58\u5171 12 \u4e2a\u529f\u80fd\u90e8\u4ef6</li>\n</ul>\n<p>\u5f00\u53d1\u677f <a href=\"https://bbs.loongarch.org/d/309-3a6000\">https://bbs.loongarch.org/d/309-3a6000</a>\uff1a</p>\n<ul>\n<li>XA612A0: 3A6000 + 7A2000</li>\n<li>XA61200: 3A6000 + 7A2000</li>\n</ul>\n<p>\u4e3b\u677f\uff1a</p>\n<ul>\n<li><a href=\"https://item.jd.com/10092331777554.html\">DL37</a> <a href=\"https://www.eaecis.com/cp_92/963.html\">\u5b98\u7f51</a></li>\n<li><a href=\"https://item.taobao.com/item.htm?id=743837636202\">\u9f99\u82af\u4ff1\u4e50\u90e8</a></li>\n</ul>\n<p>\u53f0\u5f0f\u673a\uff1a</p>\n<ul>\n<li><a href=\"https://item.jd.com/10092886566388.html\">ZKL360-TF</a>\uff1a16GB+1024GB\uff0c2699 \u5143</li>\n<li><a href=\"https://item.jd.com/10090990632336.html\">PN-L530A</a> <a href=\"https://pnxc.cn/Products-Center/12/262.html\">\u5b98\u7f51</a>: 16GB+512GB\uff0c2999 \u5143</li>\n<li><a href=\"https://item.jd.com/100076186619.html\">EC-80G</a>: 8GB+256GB+\u72ec\u663e\uff0c4699 \u5143</li>\n<li><a href=\"https://item.jd.com/10092330519232.html\">DL37-D05</a> <a href=\"https://www.eaecis.com/cp_94/960.html\">\u5b98\u7f51</a></li>\n<li><a href=\"https://item.taobao.com/item.htm?id=746096291480\">\u9f99\u82af\u4ff1\u4e50\u90e8</a></li>\n<li><a href=\"https://item.taobao.com/item.htm?id=747648718264\">F918</a> <a href=\"https://detail.tmall.com/item.htm?id=745565351633\">\u5929\u732b</a></li>\n</ul>\n<p>\u7b14\u8bb0\u672c\uff1a</p>\n<ul>\n<li><a href=\"https://item.jd.com/10092331328613.html\">NL38-N09</a> <a href=\"https://www.eaecis.com/cp_95/962.html\">\u5b98\u7f51</a></li>\n</ul>\n<h2 id=\"3c6000\">3C6000<a class=\"headerlink\" href=\"#3c6000\" title=\"Permanent link\">&para;</a></h2>\n<p><img alt=\"\" src=\"../../../../3c6000.png\" /></p>\n<p>\u6765\u6e90\uff1a<a href=\"https://roadshow.sseinfo.com/roadshowIndex.do?id=16536\">\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u7b2c\u4e09\u5b63\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</a></p>\n<h2 id=\"2k3000\">2K3000<a class=\"headerlink\" href=\"#2k3000\" title=\"Permanent link\">&para;</a></h2>\n<p><img alt=\"\" src=\"../../../../2k3000.png\" /></p>\n<p>\u6765\u6e90\uff1a<a href=\"https://roadshow.sseinfo.com/roadshowIndex.do?id=16536\">\u9f99\u82af\u4e2d\u79d1 2023 \u5e74\u7b2c\u4e09\u5b63\u5ea6\u4e1a\u7ee9\u8bf4\u660e\u4f1a</a></p>\n<h2 id=\"2k2000\">2K2000<a class=\"headerlink\" href=\"#2k2000\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=20\">2K2000</a>: 2 \u6838 LA364</p>\n<ul>\n<li><a href=\"https://www.taobao.com/list/item/744723394450.htm\">GM7-3002</a></li>\n<li><a href=\"http://www.chaec.com.cn/lx2k1000aqyypt/226.html\">\u9f99\u82af 2K2000 \u5168\u56fd\u4ea7\u5316\u5de5\u63a7\u673a</a></li>\n</ul>\n<h2 id=\"2k1500\">2K1500<a class=\"headerlink\" href=\"#2k1500\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=19\">2K1500</a>: 2 \u6838 LA264</p>\n<h2 id=\"2k1000la\">2K1000LA<a class=\"headerlink\" href=\"#2k1000la\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=8\">2K1000LA</a>: 2 \u6838 LA264</p>\n<ul>\n<li><a href=\"https://ic-item.jd.com/10075817807406.html\">\u5f00\u53d1\u677f</a></li>\n</ul>\n<h2 id=\"2k0500\">2K0500<a class=\"headerlink\" href=\"#2k0500\" title=\"Permanent link\">&para;</a></h2>\n<p><a href=\"https://www.loongson.cn/product/show?id=9\">2K0500</a>: 1 \u6838 LA264</p>\n<ul>\n<li><a href=\"https://ic-item.jd.com/10087557916057.html\">\u5f00\u53d1\u677f</a></li>\n</ul>\n<h2 id=\"\u5176\u4ed6\">\u5176\u4ed6<a class=\"headerlink\" href=\"#\u5176\u4ed6\" title=\"Permanent link\">&para;</a></h2>\n<ul>\n<li><a href=\"https://www.loongson.cn/product/show?id=18\">1C103</a>: 1 \u6838 LA132</li>\n</ul>\n<h2 id=\"\u56fa\u4ef6\">\u56fa\u4ef6<a class=\"headerlink\" href=\"#\u56fa\u4ef6\" title=\"Permanent link\">&para;</a></h2>\n<ul>\n<li><a href=\"https://github.com/loongson/Firmware\">https://github.com/loongson/Firmware</a></li>\n<li><a href=\"https://gitee.com/loongson/Firmware\">https://gitee.com/loongson/Firmware</a></li>\n<li><a href=\"https://gitea.whlug.cn/3A6000/3A6000\">https://gitea.whlug.cn/3A6000/3A6000</a></li>\n</ul>", "image": null, "date_modified": "2023-08-10T00:00:00+00:00", "authors": [], "tags": ["cpu", "hardware", "loongarch", "loongson"]}, {"id": "https://jia.je/others/2023/08/06/college-admission/", "url": "https://jia.je/others/2023/08/06/college-admission/", "title": "\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b", "content_html": "<h1 id=\"\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\">\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b<a class=\"headerlink\" href=\"#\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\" title=\"Permanent link\">&para;</a></h1>\n<p>\u672c\u6587\u662f\u672c\u4eba\u5bf9\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\u7684\u6574\u7406\uff0c\u53ef\u80fd\u6709\u8bef\uff0c\u6b22\u8fce\u6307\u51fa\u3002\u6587\u4e2d\u4e0d\u6d89\u53ca\u4e00\u4e9b\u7701\u4efd\u7684\u7279\u6b8a\u60c5\u51b5\u3002</p>\n<!-- more -->\n\n<h2 id=\"\u8ba1\u5212\">\u8ba1\u5212<a class=\"headerlink\" href=\"#\u8ba1\u5212\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8ba1\u5212\u6307\u7684\u662f\u666e\u901a\u9ad8\u6821\u6bcf\u5e74\u8981\u5f55\u53d6\u7684\u65b0\u751f\u4eba\u6570\uff0c\u6bcf\u5e74\u63d0\u524d\u5236\u5b9a\u597d\uff0c\u8ba1\u5212\u7684\u7ec4\u6210\u5305\u62ec\uff1a</p>\n<ol>\n<li>\u666e\u901a\u62db\u751f\uff0c\u9884\u5148\u7ed9\u6bcf\u4e2a\u7701\u5206\u914d\u4e00\u90e8\u5206\u8ba1\u5212</li>\n<li>\u9884\u7559\u8ba1\u5212\uff0c\u6bd4\u4f8b\u4f1a\u5728\u62db\u751f\u7ae0\u7a0b\u4e2d\u516c\u5f00\uff0c\u4f8b\u5982\u4e0d\u8d85\u8fc7 1%</li>\n<li>\u975e\u666e\u901a\u62db\u751f\uff0c\u4f8b\u5982\u7279\u6b8a\u7c7b\u578b\u62db\u751f\uff0c\u5404\u79cd\u4e13\u9879</li>\n</ol>\n<p>\u8ba1\u5212\u6570\u662f\u516c\u5f00\u7684\uff0c\u6bcf\u5e74\u53ef\u4ee5\u5728\u5404\u7701\u5370\u53d1\u7684\u5927\u539a\u672c\u4e2d\uff0c\u67e5\u770b\u672c\u5e74\u67d0\u9ad8\u6821\u5728\u672c\u7701\u5404\u4e13\u4e1a\u7ec4\u8ba1\u5212\u62db\u6536\u7684\u8ba1\u5212\u6570\u3002</p>\n<p>\u8ba1\u5212\u6570\u901a\u5e38\u60c5\u51b5\u4e0b\u53ea\u589e\u4e0d\u51cf\uff0c\u5982\u679c\u9700\u8981\u51cf\u5c11\uff0c\u6d89\u53ca\u5230\u6559\u80b2\u516c\u5e73\uff0c\u9700\u8981\u6709\u5408\u7406\u8981\u6c42\uff0c\u5e76\u7ecf\u8fc7\u6559\u80b2\u90e8\u5ba1\u6279\u3002\u5f53\u7136\u4e86\uff0c\u5982\u679c\u62db\u4e0d\u6ee1\uff0c\u4e5f\u5c31\u662f\u6ee1\u8db3\u5408\u7406\u8981\u6c42\u7684\u8003\u751f\u6570\u91cf\u4e0d\u8db3\u8ba1\u5212\u6570\uff0c\u662f\u53ef\u4ee5\u628a\u8ba1\u5212\u632a\u5230\u5176\u4ed6\u5730\u65b9\u7684\u3002</p>\n<p>\u56e0\u6b64\u9ad8\u6821\u4f1a\u9884\u7559\u4fdd\u7559\u8ba1\u5212\uff0c\u4ece\u9884\u7559\u8ba1\u5212\u8c03\u6574\u5230\u5404\u7701\u62db\u751f\u8ba1\u5212\u662f\u6bd4\u8f83\u5bb9\u6613\u7684\u3002\u4f46\u4fdd\u7559\u8ba1\u5212\u7684\u6570\u91cf\u6709\u9650\uff0c\u4f8b\u5982\u6e05\u534e\u62db\u751f\u7ae0\u7a0b\u4e2d\uff0c\u5199\u9053\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>\u5c06\u62db\u751f\u8ba1\u5212\u603b\u6570\u7684 1% \u4f5c\u4e3a\u9884\u7559\u8ba1\u5212\uff0c\u7528\u4e8e\u8c03\u8282\u5404\u5730\u7edf\u8003\u4e0a\u7ebf\u751f\u6e90\u4e0d\u5e73\u8861\u3002\u9884\u7559\u8ba1\u5212\u4f7f\u7528\u65f6\uff0c\u575a\u6301\u89c4\u8303\u6709\u5e8f\u3001\u8d28\u91cf\u4f18\u5148\u7684\u539f\u5219\u3002\n</code></pre></div>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0a\u8ff0\u8ba1\u5212\u9488\u5bf9\u7684\u662f\u9ad8\u6821\uff0c\u800c\u4e0d\u662f\u4e13\u4e1a\u3002\u8fd9\u610f\u5473\u7740\uff0c\u8ba1\u5212\u53ea\u9650\u5236\u4e86\u6bcf\u5e74\u6bcf\u4e2a\u9ad8\u6821\u901a\u8fc7\u6bcf\u4e2a\u9014\u5f84\u6216\u8005\u6bcf\u4e2a\u7701\u4efd\u62db\u6536\u591a\u5c11\u65b0\u751f\u3002\u4f46\u662f\u5e76\u4e0d\u9650\u5236\u4e13\u4e1a\uff0c\u9ad8\u6821\u5728\u6bcf\u4e2a\u4e13\u4e1a\u5f55\u53d6\u591a\u5c11\u65b0\u751f\u7684\u65b9\u9762\u5177\u6709\u8f83\u5927\u7684\u81ea\u4e3b\u6743\u3002</p>\n<p>\u56e0\u6b64\u5728\u5927\u539a\u672c\u91cc\uff0c\u5404\u4e13\u4e1a\u7ec4\u7684\u8ba1\u5212\u603b\u6570\u662f\u53ef\u9760\u7684\uff0c\u5404\u4e13\u4e1a\u7684\u8ba1\u5212\u6570\u662f\u4e0d\u53ef\u9760\u7684\uff1a\u5b9e\u9645\u5f55\u53d6\u7684\u6bcf\u4e2a\u4e13\u4e1a\u7684\u8ba1\u5212\u6570\u548c\u5927\u539a\u672c\u4e0a\u5199\u7684\u5f88\u53ef\u80fd\u4e0d\u4e00\u81f4\uff0c\u4f46\u603b\u6570\u5e94\u5f53\u662f\u5dee\u4e0d\u591a\u7684\u3002</p>\n<h2 id=\"\u5e73\u884c\u5fd7\u613f\">\u5e73\u884c\u5fd7\u613f<a class=\"headerlink\" href=\"#\u5e73\u884c\u5fd7\u613f\" title=\"Permanent link\">&para;</a></h2>\n<p>\u8003\u751f\u5728\u9ad8\u8003\u51fa\u5206\u540e\uff0c\u9700\u8981\u586b\u62a5\u5fd7\u613f\uff0c\u6bcf\u4e2a\u5fd7\u613f\u5bf9\u5e94\u4e00\u4e2a\u6295\u6863\u5355\u4f4d\uff0c\u4e5f\u5c31\u662f\u9ad8\u6821\u7684\u67d0\u4e2a\u4e13\u4e1a\u7ec4\u3002\u4f8b\u5982\u7269\u7406\u7ec4\u8981\u6c42\u8003\u751f\u9009\u62e9\u7269\u7406\uff0c\u7269\u5316\u7ec4\u8981\u6c42\u8003\u751f\u9009\u62e9\u4e86\u7269\u7406\u548c\u5316\u5b66\u3002\u4e13\u4e1a\u7ec4\u7684\u5236\u5b9a\u53d6\u51b3\u4e8e\u9ad8\u6821\uff0c\u9ad8\u6821\u4f1a\u6839\u636e\u62db\u751f\u7ae0\u7a0b\uff0c\u5236\u5b9a\u5404\u4e13\u4e1a\u7ec4\u3002\u5728\u5927\u539a\u672c\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u4e13\u4e1a\u7ec4\u5185\u6709\u54ea\u4e9b\u4e13\u4e1a\u3002</p>\n<p>\u586b\u62a5\u5fd7\u613f\u65f6\uff0c\u6bcf\u4e2a\u5fd7\u613f\u5185\u5305\u542b\u8be5\u4e13\u4e1a\u7ec4\u5185\u7684\u591a\u4e2a\u4e13\u4e1a\uff0c\u8003\u751f\u5bf9\u4e13\u4e1a\u8fdb\u884c\u6392\u5e8f\uff0c\u5e76\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u670d\u4ece\u8c03\u5242\u3002</p>\n<p>\u5e73\u884c\u5fd7\u613f\u7684\u610f\u601d\u662f\uff0c\u6295\u6863\u7684\u65f6\u5019\uff0c\u6309\u7167\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u904d\u5386\u8003\u751f\uff0c\u6309\u7167\u8003\u751f\u7684\u5fd7\u613f\u67e5\u770b\u662f\u5426\u6ee1\u8db3\u6295\u6863\u6761\u4ef6\uff0c\u5982\u679c\u6ee1\u8db3\uff0c\u5219\u6295\u6863\u5230\u5bf9\u5e94\u6295\u6863\u5355\u4f4d\uff0c\u7ed3\u675f\u6295\u6863\u8fc7\u7a0b\uff1b\u5982\u679c\u4e0d\u6ee1\u8db3\uff0c\u5219\u68c0\u67e5\u4e0b\u4e00\u4e2a\u5fd7\u613f\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6295\u6863\u7684\u65f6\u5019\u53ea\u770b\u5fd7\u613f\uff0c\u4e5f\u5c31\u662f\u4e13\u4e1a\u7ec4\uff0c\u800c\u4e0d\u770b\u4e13\u4e1a\u3002\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">for</span> <span class=\"n\">student</span> <span class=\"ow\">in</span> <span class=\"n\">all_students</span><span class=\"o\">.</span><span class=\"n\">sort_by</span><span class=\"p\">(</span><span class=\"n\">score</span><span class=\"p\">):</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>    <span class=\"k\">for</span> <span class=\"n\">choice</span> <span class=\"ow\">in</span> <span class=\"n\">student</span><span class=\"o\">.</span><span class=\"n\">all_choices</span><span class=\"p\">:</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>        <span class=\"k\">if</span> <span class=\"n\">meet</span><span class=\"p\">(</span><span class=\"n\">student</span><span class=\"p\">,</span> <span class=\"n\">choice</span><span class=\"p\">):</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>            <span class=\"n\">assign</span><span class=\"p\">(</span><span class=\"n\">student</span><span class=\"p\">,</span> <span class=\"n\">choice</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">)</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>            <span class=\"k\">break</span>\n</span></code></pre></div>\n<p>\u6295\u6863\u6761\u4ef6\u9996\u5148\u662f\u5206\u6570\uff0c\u8981\u6c42\u8003\u751f\u7684\u5206\u6570\u8d85\u8fc7\u8be5\u6295\u6863\u5355\u4f4d\u7684\u6295\u6863\u7ebf\uff1b\u5176\u6b21\uff0c\u90e8\u5206\u6295\u6863\u5355\u4f4d\u6709\u989d\u5916\u7684\u9650\u5236\uff0c\u4f8b\u5982\u4e0a\u9762\u63d0\u5230\u7684\u7269\u7406\u5316\u5b66\u7b49\u7b49\u3002</p>\n<p>\u518d\u6b21\u5f3a\u8c03\uff0c\u6295\u6863\u7684\u65f6\u5019\u4e0d\u4f1a\u770b\u586b\u4e86\u4e13\u4e1a\u7ec4\u91cc\u7684\u54ea\u4e9b\u4e13\u4e1a\uff0c\u4e5f\u4e0d\u4f1a\u770b\u662f\u5426\u9009\u62e9\u4e0d\u670d\u4ece\u5206\u914d\u3002</p>\n<p>\u5728\u5e73\u884c\u5fd7\u613f\u6a21\u5f0f\u4e0b\uff0c\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u9000\u6863\u7684\u65f6\u5019\uff0c\u8003\u751f\u4f1a\u5f88\u96be\u518d\u8fdb\u5165\u597d\u7684\u5b66\u6821\u3002\u89c2\u5bdf\u4e0a\u9762\u7684\u6295\u6863\u6d41\u7a0b\uff0c\u6bcf\u4e2a\u5b66\u751f\u53ea\u4f1a\u6295\u6863\u4e00\u6b21\uff0c\u5982\u679c\u6295\u6863\u4e86\u53c8\u9000\u6863\u4e86\uff0c\u662f\u4e0d\u4f1a\u7acb\u5373\u6295\u6863\u7684\u3002\u800c\u662f\u8981\u7b49\u5230\u6240\u6709\u5b66\u751f\u90fd\u6295\u6863\u548c\u5f55\u53d6\u5b8c\u6210\u4ee5\u540e\uff0c\u90e8\u5206\u9ad8\u6821\u6ca1\u6709\u5b8c\u6210\u62db\u751f\u8ba1\u5212\uff0c\u8fd8\u6709\u7a7a\u4f59\uff0c\u90a3\u4e48\u5728\u5f81\u96c6\u5fd7\u613f\u7684\u9636\u6bb5\uff0c\u8fd9\u4e9b\u9000\u6863\u7684\u5b66\u751f\u624d\u6709\u673a\u4f1a\u91cd\u65b0\u586b\u5fd7\u613f\uff0c\u91cd\u65b0\u6295\u6863\uff0c\u91cd\u65b0\u5f55\u53d6\u3002</p>\n<h2 id=\"\u6a21\u62df\u6295\u6863\">\u6a21\u62df\u6295\u6863<a class=\"headerlink\" href=\"#\u6a21\u62df\u6295\u6863\" title=\"Permanent link\">&para;</a></h2>\n<p>\u4e0a\u9762\u7684\u6295\u6863\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u5230\u4e00\u4e2a\u53c2\u6570\uff0c\u90a3\u5c31\u662f\u6295\u6863\u7ebf\u3002\u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u6982\u5ff5\uff0c\u6295\u6863\u6bd4\u4f8b\uff08\u4e5f\u53eb\u8c03\u6863\u6bd4\u4f8b\uff09\uff1a\u6295\u6863\u7684\u4eba\u6570\uff0c\u76f8\u6bd4\u8ba1\u5212\u6570\u7684\u6bd4\u4f8b\u3002\u4f8b\u5982 100% \u5c31\u662f\u8ba1\u5212\u6536 100 \u4e2a\u5b66\u751f\uff0c\u90a3\u5c31\u6295\u6863 100 \u4e2a\u5b66\u751f\uff1b105% \u5c31\u662f\u8ba1\u5212\u6536 100 \u4e2a\u5b66\u751f\uff0c\u6295\u6863 105 \u4e2a\u5b66\u751f\u3002</p>\n<p>\u90a3\u4e48\u6295\u6863\u7ebf\u662f\u600e\u4e48\u5b9a\u7684\u5462\uff1f\u7b54\u6848\u662f\u6a21\u62df\u6295\u6863\u3002\u5728\u6b63\u5f0f\u6295\u6863\u524d\uff0c\u9700\u8981\u8fdb\u884c\u591a\u8f6e\u7684\u6a21\u62df\u6295\u6863\uff0c\u6a21\u62df\u6295\u6863\u7684\u7ed3\u679c\u4f1a\u901a\u77e5\u5404\u9ad8\u6821\uff0c\u5404\u9ad8\u6821\u53ef\u4ee5\u8c03\u6574\u81ea\u5df1\u7684\u8ba1\u5212\u548c\u6295\u6863\u7ebf\uff0c\u8c03\u6574\u5b8c\u4ee5\u540e\u518d\u6b21\u6a21\u62df\u6295\u6863\u3002\u8fd9\u6837\u591a\u8f6e\u4ee5\u540e\uff0c\u6a21\u62df\u6295\u6863\u5c31\u4f1a\u6536\u655b\u5230\u4e00\u4e2a\u7a33\u5b9a\u7684\u72b6\u6001\uff0c\u6b64\u65f6\u5404\u4e2a\u9ad8\u6821\u90fd\u4f1a\u77e5\u9053\u81ea\u5df1\u7684\u6295\u6863\u7ebf\u662f\u591a\u5c11\uff0c\u53ef\u4ee5\u6295\u6863\u591a\u5c11\u4e2a\u5b66\u751f\uff0c\u4e5f\u4e0d\u6253\u7b97\u4fee\u6539\u53c2\u6570\u4e86\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u662f\u6b63\u5f0f\u7ed3\u679c\u3002</p>\n<p>\u6240\u4ee5\u6295\u6863\u7ebf\u5e76\u4e0d\u7b49\u4e8e\u5f55\u53d6\u7684\u6700\u540e\u4e00\u540d\u5b66\u751f\u7684\u5206\u6570\u7ebf\uff0c\u867d\u7136\u5f88\u591a\u65f6\u5019\u6070\u597d\u76f8\u7b49\u3002\u524d\u6587\u4e5f\u63d0\u5230\uff0c\u9000\u6863\u5728\u5e73\u884c\u5fd7\u613f\u7684\u6a21\u5f0f\u4e0b\uff0c\u662f\u4e00\u4e2a\u5bf9\u4e8e\u5b66\u751f\u6765\u8bf4\u5f88\u5403\u4e8f\u7684\u4e8b\u60c5\uff0c\u56e0\u6b64\u5b9e\u9645\u4e0a\u6295\u6863\u6bd4\u4f8b\u5927\u90e8\u5206\u65f6\u5019\u5c31\u662f 100%\u3002\u5177\u4f53\u64cd\u4f5c\u662f\uff0c\u5728\u6a21\u62df\u6295\u6863\u7684\u65f6\u5019\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u6295\u6863\u6bd4\u4f8b\u5927\u4e8e 100%\uff0c\u800c\u591a\u51fa\u6765\u7684\u90e8\u5206\u53c8\u4e0d\u4f1a\u5f55\u53d6\u8fdb\u6765\uff0c\u90a3\u5c31\u63d0\u9ad8\u6295\u6863\u7ebf\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u6295\u6863\u7684\u5b66\u751f\u90fd\u53ef\u4ee5\u5f55\u53d6\u3002\u4f46\u5982\u679c\u9047\u5230\u5206\u6570\u5728\u4e2d\u6e38\uff0c\u4e0d\u670d\u4ece\u4e13\u4e1a\u8c03\u5242\uff0c\u540c\u65f6\u65e0\u6cd5\u6ee1\u8db3\u4e13\u4e1a\uff0c\u6b64\u65f6\u53ef\u80fd\u4e5f\u4e0d\u5f97\u4e0d\u5148\u8c03\u6863\u518d\u9000\u6863\uff0c\u540c\u65f6\u6269\u5927\u6295\u6863\u6bd4\u4f8b\uff0c\u4fdd\u8bc1\u6709\u8db3\u591f\u8ba1\u5212\u6570\u7684\u8003\u751f\u53ef\u4ee5\u5f55\u53d6\u3002</p>\n<p>\u9ad8\u6821\u7684\u62db\u751f\u7ae0\u7a0b\u4f1a\u89c4\u5b9a\u8c03\u6863\u6bd4\u4f8b\u7684\u4e0a\u9650\uff0c\u5e38\u89c1\u7684\u662f 105%\uff0c\u4f46\u8fd9\u53ea\u662f\u4e0a\u9650\uff0c\u5b9e\u9645\u5927\u90e8\u5206\u90fd\u662f 100% \u7684\u6bd4\u4f8b\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c3d\u91cf\u51cf\u5c11\u9000\u6863\u7684\u60c5\u51b5\u53d1\u751f\u3002</p>\n<p>\u4ee5\u76ee\u524d\u7684\u8ba1\u7b97\u673a\u6027\u80fd\uff0c\u6295\u6863\u662f\u4e00\u4e2a\u5f88\u5feb\u7684\u4e8b\u60c5\uff0c\u51e0\u5206\u949f\u5c31\u53ef\u4ee5\u5b8c\u6210\uff0c\u6240\u4ee5\u6a21\u62df\u6295\u6863\u4e3b\u8981\u82b1\u7684\u65f6\u95f4\u8fd8\u662f\u5728\u9ad8\u6821\u4e00\u4fa7\u3002</p>\n<h2 id=\"\u6b63\u5f0f\u6295\u6863\">\u6b63\u5f0f\u6295\u6863<a class=\"headerlink\" href=\"#\u6b63\u5f0f\u6295\u6863\" title=\"Permanent link\">&para;</a></h2>\n<p>\u6b63\u5f0f\u6295\u6863\u65f6\uff0c\u4f1a\u6309\u7167\u524d\u8ff0\u5e73\u884c\u5fd7\u613f\u7684\u65b9\u5f0f\u8fdb\u884c\u6295\u6863\uff0c\u6bcf\u4e2a\u8003\u8bd5\u6295\u6863\u5230\u81f3\u591a\u4e00\u4e2a\u6295\u6863\u5355\u4f4d\uff0c\u4e5f\u5c31\u662f\u67d0\u9ad8\u6821\u7684\u67d0\u4e13\u4e1a\u7ec4\u3002\u9ad8\u6821\u8fdb\u884c\u9605\u6863\uff0c\u7136\u540e\u5bf9\u8be5\u8003\u8bd5\u8fdb\u884c\u4e13\u4e1a\u7684\u5206\u914d\uff0c\u9009\u62e9\u5f55\u53d6\u5230\u67d0\u4e2a\u4e13\u4e1a\uff0c\u6216\u8005\u9009\u62e9\u9000\u6863\u3002\u8fd9\u4e2a\u7ed3\u679c\u4f1a\u53cd\u9988\u5230\u7701\u8003\u8bd5\u9662\uff0c\u8003\u8bd5\u9662\u6309\u7167\u6559\u80b2\u516c\u5e73\u7684\u6807\u51c6\u8fdb\u884c\u5f55\u53d6\u68c0\u67e5\uff0c\u4f8b\u5982\uff1a</p>\n<ol>\n<li>\u9ad8\u5206\u8003\u751f\u4e13\u4e1a\u4f18\u5148</li>\n<li>\u9000\u6863\u9700\u7ed9\u51fa\u5fc5\u8981\u7406\u7531</li>\n</ol>\n<p>\u5176\u4e2d\u7b2c\u4e00\u70b9\u4fdd\u8bc1\u4e86\uff0c\u5982\u679c A \u6bd4 B \u5206\u9ad8\uff0c\u4e14\u90fd\u586b\u62a5\u4e86\u540c\u4e00\u4e2a\u4e13\u4e1a\uff0c\u90a3\u4e48 B \u80fd\u591f\u8fdb\u5165\u8fd9\u4e2a\u4e13\u4e1a\u7684\u524d\u63d0\u662f A \u4e5f\u80fd\u591f\u8fdb\u5165\u8fd9\u4e2a\u4e13\u4e1a\u3002\u5e76\u4e14\u8003\u751f\u7684\u4e13\u4e1a\u5f55\u53d6\u4e5f\u8981\u6309\u7167\u8003\u8bd5\u586b\u62a5\u7684\u4e13\u4e1a\u987a\u5e8f\u8fdb\u884c\u5339\u914d\u3002\u9ad8\u6821\u62db\u751f\u529e\u5fc5\u987b\u6309\u7167\u8fd9\u4e2a\u89c4\u5219\u8fdb\u884c\uff0c\u56e0\u6b64\u5176\u5b9e\u6240\u8c13\u7684\u4e13\u4e1a\u5206\u914d\uff0c\u4e5f\u5c31\u662f\u5728\u8ba1\u7b97\u673a\u4e0a\u8dd1\u4e00\u6bb5\u7c7b\u4f3c\u5e73\u884c\u5fd7\u613f\u7684\u7a0b\u5e8f\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u5206\u914d\u7684\u662f\u4e13\u4e1a\u3002</p>\n<p>\u8003\u8bd5\u9662\u53ef\u4ee5\u9009\u62e9\u5ba1\u6838\u901a\u8fc7\uff0c\u90a3\u4e48\u5f55\u53d6\u7684\u8003\u751f\u5c31\u5b8c\u6210\u4e86\u6574\u4e2a\u5f55\u53d6\u6d41\u7a0b\uff0c\u5f55\u53d6\u5230\u8be5\u9ad8\u6821\u7684\u8be5\u4e13\u4e1a\u3002\u5ba1\u6838\u4e0d\u901a\u8fc7\u65f6\uff0c\u9700\u8981\u9ad8\u6821\u62db\u751f\u529e\u91cd\u65b0\u5f55\u53d6\u3002</p>\n<h2 id=\"\u5c0f\u7ed3\">\u5c0f\u7ed3<a class=\"headerlink\" href=\"#\u5c0f\u7ed3\" title=\"Permanent link\">&para;</a></h2>\n<p>\u666e\u901a\u9ad8\u6821\u62db\u751f\u5f55\u53d6\u6d41\u7a0b\u662f\u4e00\u4e2a\u5341\u5206\u4e25\u8c28\u7684\u8fc7\u7a0b\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u517c\u987e\u4e86\u516c\u5e73\u548c\u6548\u7387\uff1a</p>\n<ol>\n<li>\u516c\u5e73\uff1a\u6295\u6863\u548c\u5f55\u53d6\u90fd\u6309\u7167\u65e2\u5b9a\u7684\u89c4\u5219\u6267\u884c\uff0c\u7531\u8ba1\u7b97\u673a\u7a0b\u5e8f\u81ea\u52a8\u8ba1\u7b97\u7ed3\u679c\uff0c\u7ed3\u679c\u7531\u591a\u4f4d\u8001\u5e08\u8fdb\u884c\u5ba1\u6838</li>\n<li>\u6548\u7387\uff1a\u4e0d\u540c\u5206\u6570\u6bb5\u7684\u8003\u751f\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\uff0c\u4e0d\u540c\u9ad8\u6821\u4e4b\u95f4\u4e5f\u53ef\u4ee5\u540c\u65f6\u5e76\u884c\uff0c\u4ee3\u4ef7\u662f\u9000\u6863\u7684\u98ce\u9669\u8f83\u5927</li>\n</ol>\n<p>\u6574\u4e2a\u6d41\u7a0b\u4e2d\u5927\u90e8\u5206\u51b3\u7b56\u90fd\u662f\u8ba1\u7b97\u673a\u7a0b\u5e8f\u81ea\u52a8\u8fdb\u884c\u8ba1\u7b97\uff0c\u6709\u9650\u7684\u81ea\u7531\u5728\u6559\u80b2\u516c\u5e73\u7684\u524d\u63d0\u4e0b\u5b9e\u73b0\u3002</p>", "image": null, "date_modified": "2023-08-06T00:00:00+00:00", "authors": [], "tags": ["admission", "gaokao", "others"]}]}